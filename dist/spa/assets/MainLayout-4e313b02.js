import{r as ref,i as isRuntimeSsrPreHydration,o as onMounted,c as createComponent,g as getCurrentInstance,a as onBeforeUnmount,n as noop,b as nextTick,h,l as listenOpts,d as inject,e as emptyRenderFn,f as computed,w as watch,j as hUniqueSlot,k as layoutKey,P as Platform,m as createDirective,p as client$1,q as leftClick,s as addEvt,t as preventDraggable,u as prevent,v as stop,x as position,y as cleanEvt,z as stopAndPrevent,A as useModelToggleProps,B as useDarkProps,C as useModelToggleEmits,D as useDark,E as useTimeout,F as useModelToggle,G as useHistory,H as withDirectives,I as hDir,J as hSlot,K as usePreventScroll,L as tabsKey,R as Ripple,M as isKeyCode,N as shouldIgnoreKey,Q as QIcon,O as hMergeSlot,S as isDeepEqual,T as uid$1,U as useTick,V as provide,W as onDeactivated,X as onActivated,Y as Transition,Z as getNormalizedVNodes,_ as KeepAlive,$ as useFieldProps,a0 as useFieldEmits,a1 as useField,a2 as useFieldState,a3 as useSizeProps,a4 as useSize,a5 as hMergeSlotSafely,a6 as useRouterLinkProps,a7 as useRouterLink,a8 as portalProxyList,a9 as getScrollbarWidth,aa as useTransitionProps,ab as useTransition,ac as usePortal,ad as addFocusout,ae as removeFocusout,af as removeEscapeKey,ag as getScrollTarget,ah as closePortalMenus,ai as addFocusFn,aj as addEscapeKey,ak as childHasFocus,al as debounce$2,am as onBeforeMount,an as useFormProps,ao as useFormInputNameAttr,ap as fieldValueIsFilled,aq as onBeforeUpdate,ar as onUpdated,as as useKeyComposition,at as QDialog,au as injectProp,av as QBtn,aw as vmHasRouter,ax as History,ay as isNumber$1,az as isDate,aA as isObject$1,aB as injectMultipleProps,aC as QCheckbox,aD as QSeparator,aE as pageContainerKey,aF as getVerticalScrollPosition,aG as getHorizontalScrollPosition,aH as reactive,aI as onUnmounted,aJ as getPortalProxy,aK as closePortals,aL as quasarKey,aM as _export_sfc,aN as openBlock,aO as createElementBlock,aP as createBaseVNode,aQ as createVNode,aR as withCtx,aS as QOptionGroup,aT as createTextVNode,aU as toDisplayString,aV as QCard,aW as QCardSection,aX as QCardActions,aY as Fragment,aZ as pushScopeId,a_ as popScopeId,a$ as QSpinner,b0 as toRaw,b1 as vShow,b2 as QInput,b3 as createBlock,b4 as isProxy,b5 as Notify,b6 as resolveComponent,b7 as createCommentVNode,b8 as withKeys}from"./index-8f15c89c.js";import{Q as QPage}from"./QPage-d3d5c790.js";function _mergeNamespaces(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in e)){const l=Object.getOwnPropertyDescriptor(r,s);l&&Object.defineProperty(e,s,l.get?l:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function useCanRender(){const e=ref(!isRuntimeSsrPreHydration.value);return e.value===!1&&onMounted(()=>{e.value=!0}),e}const hasObserver=typeof ResizeObserver<"u",resizeProps=hasObserver===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},QResizeObserver=createComponent({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:t}){let n=null,r,s={width:-1,height:-1};function l(x){x===!0||e.debounce===0||e.debounce==="0"?p():n===null&&(n=setTimeout(p,e.debounce))}function p(){if(n!==null&&(clearTimeout(n),n=null),r){const{offsetWidth:x,offsetHeight:M}=r;(x!==s.width||M!==s.height)&&(s={width:x,height:M},t("resize",s))}}const{proxy:o}=getCurrentInstance();if(hasObserver===!0){let x;const M=P=>{r=o.$el.parentNode,r?(x=new ResizeObserver(l),x.observe(r),p()):P!==!0&&nextTick(()=>{M(!0)})};return onMounted(()=>{M()}),onBeforeUnmount(()=>{n!==null&&clearTimeout(n),x!==void 0&&(x.disconnect!==void 0?x.disconnect():r&&x.unobserve(r))}),noop}else{let P=function(){n!==null&&(clearTimeout(n),n=null),M!==void 0&&(M.removeEventListener!==void 0&&M.removeEventListener("resize",l,listenOpts.passive),M=void 0)},he=function(){P(),r&&r.contentDocument&&(M=r.contentDocument.defaultView,M.addEventListener("resize",l,listenOpts.passive),p())};const x=useCanRender();let M;return onMounted(()=>{nextTick(()=>{r=o.$el,r&&he()})}),onBeforeUnmount(P),o.trigger=l,()=>{if(x.value===!0)return h("object",{style:resizeProps.style,tabindex:-1,type:"text/html",data:resizeProps.url,"aria-hidden":"true",onLoad:he})}}}}),QHeader=createComponent({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:t,emit:n}){const{proxy:{$q:r}}=getCurrentInstance(),s=inject(layoutKey,emptyRenderFn);if(s===emptyRenderFn)return console.error("QHeader needs to be child of QLayout"),emptyRenderFn;const l=ref(parseInt(e.heightHint,10)),p=ref(!0),o=computed(()=>e.reveal===!0||s.view.value.indexOf("H")>-1||r.platform.is.ios&&s.isContainer.value===!0),x=computed(()=>{if(e.modelValue!==!0)return 0;if(o.value===!0)return p.value===!0?l.value:0;const rl=l.value-s.scroll.value.position;return rl>0?rl:0}),M=computed(()=>e.modelValue!==!0||o.value===!0&&p.value!==!0),P=computed(()=>e.modelValue===!0&&M.value===!0&&e.reveal===!0),he=computed(()=>"q-header q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(M.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),nt=computed(()=>{const rl=s.rows.value.top,Co={};return rl[0]==="l"&&s.left.space===!0&&(Co[r.lang.rtl===!0?"right":"left"]=`${s.left.size}px`),rl[2]==="r"&&s.right.space===!0&&(Co[r.lang.rtl===!0?"left":"right"]=`${s.right.size}px`),Co});function _e(rl,Co){s.update("header",rl,Co)}function Bt(rl,Co){rl.value!==Co&&(rl.value=Co)}function Fn({height:rl}){Bt(l,rl),_e("size",rl)}function yr(rl){P.value===!0&&Bt(p,!0),n("focusin",rl)}watch(()=>e.modelValue,rl=>{_e("space",rl),Bt(p,!0),s.animate()}),watch(x,rl=>{_e("offset",rl)}),watch(()=>e.reveal,rl=>{rl===!1&&Bt(p,e.modelValue)}),watch(p,rl=>{s.animate(),n("reveal",rl)}),watch(s.scroll,rl=>{e.reveal===!0&&Bt(p,rl.direction==="up"||rl.position<=e.revealOffset||rl.position-rl.inflectionPoint<100)});const Io={};return s.instances.header=Io,e.modelValue===!0&&_e("size",l.value),_e("space",e.modelValue),_e("offset",x.value),onBeforeUnmount(()=>{s.instances.header===Io&&(s.instances.header=void 0,_e("size",0),_e("offset",0),_e("space",!1))}),()=>{const rl=hUniqueSlot(t.default,[]);return e.elevated===!0&&rl.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),rl.push(h(QResizeObserver,{debounce:0,onResize:Fn})),h("header",{class:he.value,style:nt.value,onFocusin:yr},rl)}}}),modifiersAll={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},directionList=Object.keys(modifiersAll);modifiersAll.all=!0;function getModifierDirections(e){const t={};for(const n of directionList)e[n]===!0&&(t[n]=!0);return Object.keys(t).length===0?modifiersAll:(t.horizontal===!0?t.left=t.right=!0:t.left===!0&&t.right===!0&&(t.horizontal=!0),t.vertical===!0?t.up=t.down=!0:t.up===!0&&t.down===!0&&(t.vertical=!0),t.horizontal===!0&&t.vertical===!0&&(t.all=!0),t)}const avoidNodeNamesList=["INPUT","TEXTAREA"];function shouldStart(e,t){return t.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof t.handler=="function"&&avoidNodeNamesList.includes(e.target.nodeName.toUpperCase())===!1&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(t.uid)===-1)}function clearSelection(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),Platform.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function getChanges(e,t,n){const r=position(e);let s,l=r.left-t.event.x,p=r.top-t.event.y,o=Math.abs(l),x=Math.abs(p);const M=t.direction;M.horizontal===!0&&M.vertical!==!0?s=l<0?"left":"right":M.horizontal!==!0&&M.vertical===!0?s=p<0?"up":"down":M.up===!0&&p<0?(s="up",o>x&&(M.left===!0&&l<0?s="left":M.right===!0&&l>0&&(s="right"))):M.down===!0&&p>0?(s="down",o>x&&(M.left===!0&&l<0?s="left":M.right===!0&&l>0&&(s="right"))):M.left===!0&&l<0?(s="left",o<x&&(M.up===!0&&p<0?s="up":M.down===!0&&p>0&&(s="down"))):M.right===!0&&l>0&&(s="right",o<x&&(M.up===!0&&p<0?s="up":M.down===!0&&p>0&&(s="down")));let P=!1;if(s===void 0&&n===!1){if(t.event.isFirst===!0||t.event.lastDir===void 0)return{};s=t.event.lastDir,P=!0,s==="left"||s==="right"?(r.left-=l,o=0,l=0):(r.top-=p,x=0,p=0)}return{synthetic:P,payload:{evt:e,touch:t.event.mouse!==!0,mouse:t.event.mouse===!0,position:r,direction:s,isFirst:t.event.isFirst,isFinal:n===!0,duration:Date.now()-t.event.time,distance:{x:o,y:x},offset:{x:l,y:p},delta:{x:r.left-t.event.lastX,y:r.top-t.event.lastY}}}}let uid=0;const TouchPan=createDirective({name:"touch-pan",beforeMount(e,{value:t,modifiers:n}){if(n.mouse!==!0&&client$1.has.touch!==!0)return;function r(l,p){n.mouse===!0&&p===!0?stopAndPrevent(l):(n.stop===!0&&stop(l),n.prevent===!0&&prevent(l))}const s={uid:"qvtp_"+uid++,handler:t,modifiers:n,direction:getModifierDirections(n),noop,mouseStart(l){shouldStart(l,s)&&leftClick(l)&&(addEvt(s,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),s.start(l,!0))},touchStart(l){if(shouldStart(l,s)){const p=l.target;addEvt(s,"temp",[[p,"touchmove","move","notPassiveCapture"],[p,"touchcancel","end","passiveCapture"],[p,"touchend","end","passiveCapture"]]),s.start(l)}},start(l,p){if(client$1.is.firefox===!0&&preventDraggable(e,!0),s.lastEvt=l,p===!0||n.stop===!0){if(s.direction.all!==!0&&(p!==!0||s.modifiers.mouseAllDir!==!0&&s.modifiers.mousealldir!==!0)){const M=l.type.indexOf("mouse")>-1?new MouseEvent(l.type,l):new TouchEvent(l.type,l);l.defaultPrevented===!0&&prevent(M),l.cancelBubble===!0&&stop(M),Object.assign(M,{qKeyEvent:l.qKeyEvent,qClickOutside:l.qClickOutside,qAnchorHandled:l.qAnchorHandled,qClonedBy:l.qClonedBy===void 0?[s.uid]:l.qClonedBy.concat(s.uid)}),s.initialEvent={target:l.target,event:M}}stop(l)}const{left:o,top:x}=position(l);s.event={x:o,y:x,time:Date.now(),mouse:p===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:x}},move(l){if(s.event===void 0)return;const p=position(l),o=p.left-s.event.x,x=p.top-s.event.y;if(o===0&&x===0)return;s.lastEvt=l;const M=s.event.mouse===!0,P=()=>{r(l,M);let _e;n.preserveCursor!==!0&&n.preservecursor!==!0&&(_e=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),M===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),s.styleCleanup=Bt=>{if(s.styleCleanup=void 0,_e!==void 0&&(document.documentElement.style.cursor=_e),document.body.classList.remove("non-selectable"),M===!0){const Fn=()=>{document.body.classList.remove("no-pointer-events--children")};Bt!==void 0?setTimeout(()=>{Fn(),Bt()},50):Fn()}else Bt!==void 0&&Bt()}};if(s.event.detected===!0){s.event.isFirst!==!0&&r(l,s.event.mouse);const{payload:_e,synthetic:Bt}=getChanges(l,s,!1);_e!==void 0&&(s.handler(_e)===!1?s.end(l):(s.styleCleanup===void 0&&s.event.isFirst===!0&&P(),s.event.lastX=_e.position.left,s.event.lastY=_e.position.top,s.event.lastDir=Bt===!0?void 0:_e.direction,s.event.isFirst=!1));return}if(s.direction.all===!0||M===!0&&(s.modifiers.mouseAllDir===!0||s.modifiers.mousealldir===!0)){P(),s.event.detected=!0,s.move(l);return}const he=Math.abs(o),nt=Math.abs(x);he!==nt&&(s.direction.horizontal===!0&&he>nt||s.direction.vertical===!0&&he<nt||s.direction.up===!0&&he<nt&&x<0||s.direction.down===!0&&he<nt&&x>0||s.direction.left===!0&&he>nt&&o<0||s.direction.right===!0&&he>nt&&o>0?(s.event.detected=!0,s.move(l)):s.end(l,!0))},end(l,p){if(s.event!==void 0){if(cleanEvt(s,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),p===!0)s.styleCleanup!==void 0&&s.styleCleanup(),s.event.detected!==!0&&s.initialEvent!==void 0&&s.initialEvent.target.dispatchEvent(s.initialEvent.event);else if(s.event.detected===!0){s.event.isFirst===!0&&s.handler(getChanges(l===void 0?s.lastEvt:l,s).payload);const{payload:o}=getChanges(l===void 0?s.lastEvt:l,s,!0),x=()=>{s.handler(o)};s.styleCleanup!==void 0?s.styleCleanup(x):x()}s.event=void 0,s.initialEvent=void 0,s.lastEvt=void 0}}};if(e.__qtouchpan=s,n.mouse===!0){const l=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";addEvt(s,"main",[[e,"mousedown","mouseStart",`passive${l}`]])}client$1.has.touch===!0&&addEvt(s,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const n=e.__qtouchpan;n!==void 0&&(t.oldValue!==t.value&&(typeof value!="function"&&n.end(),n.handler=t.value),n.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchpan;t!==void 0&&(t.event!==void 0&&t.end(),cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchpan)}});function between(e,t,n){return n<=t?t:Math.min(n,Math.max(t,e))}function normalizeToInterval(e,t,n){if(n<=t)return t;const r=n-t+1;let s=t+(e-t)%r;return s<t&&(s=r+s),s===0?0:s}const duration=150,QDrawer=createComponent({name:"QDrawer",inheritAttrs:!1,props:{...useModelToggleProps,...useDarkProps,side:{type:String,default:"left",validator:e=>["left","right"].includes(e)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:e=>["default","desktop","mobile"].includes(e),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...useModelToggleEmits,"onLayout","miniState"],setup(e,{slots:t,emit:n,attrs:r}){const s=getCurrentInstance(),{proxy:{$q:l}}=s,p=useDark(e,l),{preventBodyScroll:o}=usePreventScroll(),{registerTimeout:x,removeTimeout:M}=useTimeout(),P=inject(layoutKey,emptyRenderFn);if(P===emptyRenderFn)return console.error("QDrawer needs to be child of QLayout"),emptyRenderFn;let he,nt=null,_e;const Bt=ref(e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint),Fn=computed(()=>e.mini===!0&&Bt.value!==!0),yr=computed(()=>Fn.value===!0?e.miniWidth:e.width),Io=ref(e.showIfAbove===!0&&Bt.value===!1?!0:e.modelValue===!0),rl=computed(()=>e.persistent!==!0&&(Bt.value===!0||md.value===!0));function Co(Xh,Ld){if(ch(),Xh!==!1&&P.animate(),jf(0),Bt.value===!0){const Kf=P.instances[cd.value];Kf!==void 0&&Kf.belowBreakpoint===!0&&Kf.hide(!1),yd(1),P.isContainer.value!==!0&&o(!0)}else yd(0),Xh!==!1&&Qd(!1);x(()=>{Xh!==!1&&Qd(!0),Ld!==!0&&n("show",Xh)},duration)}function as(Xh,Ld){Zu(),Xh!==!1&&P.animate(),yd(0),jf(sh.value*yr.value),Qh(),Ld!==!0?x(()=>{n("hide",Xh)},duration):M()}const{show:Js,hide:lh}=useModelToggle({showing:Io,hideOnRouteChange:rl,handleShow:Co,handleHide:as}),{addToHistory:ch,removeFromHistory:Zu}=useHistory(Io,lh,rl),th={belowBreakpoint:Bt,hide:lh},sl=computed(()=>e.side==="right"),sh=computed(()=>(l.lang.rtl===!0?-1:1)*(sl.value===!0?1:-1)),xh=ref(0),Mh=ref(!1),Dh=ref(!1),Uh=ref(yr.value*sh.value),cd=computed(()=>sl.value===!0?"left":"right"),Tf=computed(()=>Io.value===!0&&Bt.value===!1&&e.overlay===!1?e.miniToOverlay===!0?e.miniWidth:yr.value:0),yf=computed(()=>e.overlay===!0||e.miniToOverlay===!0||P.view.value.indexOf(sl.value?"R":"L")>-1||l.platform.is.ios===!0&&P.isContainer.value===!0),Af=computed(()=>e.overlay===!1&&Io.value===!0&&Bt.value===!1),md=computed(()=>e.overlay===!0&&Io.value===!0&&Bt.value===!1),vd=computed(()=>"fullscreen q-drawer__backdrop"+(Io.value===!1&&Mh.value===!1?" hidden":"")),qd=computed(()=>({backgroundColor:`rgba(0,0,0,${xh.value*.4})`})),Ed=computed(()=>sl.value===!0?P.rows.value.top[2]==="r":P.rows.value.top[0]==="l"),Td=computed(()=>sl.value===!0?P.rows.value.bottom[2]==="r":P.rows.value.bottom[0]==="l"),Fd=computed(()=>{const Xh={};return P.header.space===!0&&Ed.value===!1&&(yf.value===!0?Xh.top=`${P.header.offset}px`:P.header.space===!0&&(Xh.top=`${P.header.size}px`)),P.footer.space===!0&&Td.value===!1&&(yf.value===!0?Xh.bottom=`${P.footer.offset}px`:P.footer.space===!0&&(Xh.bottom=`${P.footer.size}px`)),Xh}),Cd=computed(()=>{const Xh={width:`${yr.value}px`,transform:`translateX(${Uh.value}px)`};return Bt.value===!0?Xh:Object.assign(Xh,Fd.value)}),Gd=computed(()=>"q-drawer__content fit "+(P.isContainer.value!==!0?"scroll":"overflow-auto")),bf=computed(()=>`q-drawer q-drawer--${e.side}`+(Dh.value===!0?" q-drawer--mini-animate":"")+(e.bordered===!0?" q-drawer--bordered":"")+(p.value===!0?" q-drawer--dark q-dark":"")+(Mh.value===!0?" no-transition":Io.value===!0?"":" q-layout--prevent-focus")+(Bt.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${Fn.value===!0?"mini":"standard"}`+(yf.value===!0||Af.value!==!0?" fixed":"")+(e.overlay===!0||e.miniToOverlay===!0?" q-drawer--on-top":"")+(Ed.value===!0?" q-drawer--top-padding":""))),Id=computed(()=>{const Xh=l.lang.rtl===!0?e.side:cd.value;return[[TouchPan,bp,void 0,{[Xh]:!0,mouse:!0}]]}),td=computed(()=>{const Xh=l.lang.rtl===!0?cd.value:e.side;return[[TouchPan,fp,void 0,{[Xh]:!0,mouse:!0}]]}),$d=computed(()=>{const Xh=l.lang.rtl===!0?cd.value:e.side;return[[TouchPan,fp,void 0,{[Xh]:!0,mouse:!0,mouseAllDir:!0}]]});function np(){ad(Bt,e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint)}watch(Bt,Xh=>{Xh===!0?(he=Io.value,Io.value===!0&&lh(!1)):e.overlay===!1&&e.behavior!=="mobile"&&he!==!1&&(Io.value===!0?(jf(0),yd(0),Qh()):Js(!1))}),watch(()=>e.side,(Xh,Ld)=>{P.instances[Ld]===th&&(P.instances[Ld]=void 0,P[Ld].space=!1,P[Ld].offset=0),P.instances[Xh]=th,P[Xh].size=yr.value,P[Xh].space=Af.value,P[Xh].offset=Tf.value}),watch(P.totalWidth,()=>{(P.isContainer.value===!0||document.qScrollPrevented!==!0)&&np()}),watch(()=>e.behavior+e.breakpoint,np),watch(P.isContainer,Xh=>{Io.value===!0&&o(Xh!==!0),Xh===!0&&np()}),watch(P.scrollbarWidth,()=>{jf(Io.value===!0?0:void 0)}),watch(Tf,Xh=>{Yd("offset",Xh)}),watch(Af,Xh=>{n("onLayout",Xh),Yd("space",Xh)}),watch(sl,()=>{jf()}),watch(yr,Xh=>{jf(),Zd(e.miniToOverlay,Xh)}),watch(()=>e.miniToOverlay,Xh=>{Zd(Xh,yr.value)}),watch(()=>l.lang.rtl,()=>{jf()}),watch(()=>e.mini,()=>{e.noMiniAnimation||e.modelValue===!0&&(op(),P.animate())}),watch(Fn,Xh=>{n("miniState",Xh)});function jf(Xh){Xh===void 0?nextTick(()=>{Xh=Io.value===!0?0:yr.value,jf(sh.value*Xh)}):(P.isContainer.value===!0&&sl.value===!0&&(Bt.value===!0||Math.abs(Xh)===yr.value)&&(Xh+=sh.value*P.scrollbarWidth.value),Uh.value=Xh)}function yd(Xh){xh.value=Xh}function Qd(Xh){const Ld=Xh===!0?"remove":P.isContainer.value!==!0?"add":"";Ld!==""&&document.body.classList[Ld]("q-body--drawer-toggle")}function op(){nt!==null&&clearTimeout(nt),s.proxy&&s.proxy.$el&&s.proxy.$el.classList.add("q-drawer--mini-animate"),Dh.value=!0,nt=setTimeout(()=>{nt=null,Dh.value=!1,s&&s.proxy&&s.proxy.$el&&s.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function bp(Xh){if(Io.value!==!1)return;const Ld=yr.value,Kf=between(Xh.distance.x,0,Ld);if(Xh.isFinal===!0){Kf>=Math.min(75,Ld)===!0?Js():(P.animate(),yd(0),jf(sh.value*Ld)),Mh.value=!1;return}jf((l.lang.rtl===!0?sl.value!==!0:sl.value)?Math.max(Ld-Kf,0):Math.min(0,Kf-Ld)),yd(between(Kf/Ld,0,1)),Xh.isFirst===!0&&(Mh.value=!0)}function fp(Xh){if(Io.value!==!0)return;const Ld=yr.value,Kf=Xh.direction===e.side,If=(l.lang.rtl===!0?Kf!==!0:Kf)?between(Xh.distance.x,0,Ld):0;if(Xh.isFinal===!0){Math.abs(If)<Math.min(75,Ld)===!0?(P.animate(),yd(1),jf(0)):lh(),Mh.value=!1;return}jf(sh.value*If),yd(between(1-If/Ld,0,1)),Xh.isFirst===!0&&(Mh.value=!0)}function Qh(){o(!1),Qd(!0)}function Yd(Xh,Ld){P.update(e.side,Xh,Ld)}function ad(Xh,Ld){Xh.value!==Ld&&(Xh.value=Ld)}function Zd(Xh,Ld){Yd("size",Xh===!0?e.miniWidth:Ld)}return P.instances[e.side]=th,Zd(e.miniToOverlay,yr.value),Yd("space",Af.value),Yd("offset",Tf.value),e.showIfAbove===!0&&e.modelValue!==!0&&Io.value===!0&&e["onUpdate:modelValue"]!==void 0&&n("update:modelValue",!0),onMounted(()=>{n("onLayout",Af.value),n("miniState",Fn.value),he=e.showIfAbove===!0;const Xh=()=>{(Io.value===!0?Co:as)(!1,!0)};if(P.totalWidth.value!==0){nextTick(Xh);return}_e=watch(P.totalWidth,()=>{_e(),_e=void 0,Io.value===!1&&e.showIfAbove===!0&&Bt.value===!1?Js(!1):Xh()})}),onBeforeUnmount(()=>{_e!==void 0&&_e(),nt!==null&&(clearTimeout(nt),nt=null),Io.value===!0&&Qh(),P.instances[e.side]===th&&(P.instances[e.side]=void 0,Yd("size",0),Yd("offset",0),Yd("space",!1))}),()=>{const Xh=[];Bt.value===!0&&(e.noSwipeOpen===!1&&Xh.push(withDirectives(h("div",{key:"open",class:`q-drawer__opener fixed-${e.side}`,"aria-hidden":"true"}),Id.value)),Xh.push(hDir("div",{ref:"backdrop",class:vd.value,style:qd.value,"aria-hidden":"true",onClick:lh},void 0,"backdrop",e.noSwipeBackdrop!==!0&&Io.value===!0,()=>$d.value)));const Ld=Fn.value===!0&&t.mini!==void 0,Kf=[h("div",{...r,key:""+Ld,class:[Gd.value,r.class]},Ld===!0?t.mini():hSlot(t.default))];return e.elevated===!0&&Io.value===!0&&Kf.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Xh.push(hDir("aside",{ref:"content",class:bf.value,style:Cd.value},Kf,"contentclose",e.noSwipeClose!==!0&&Bt.value===!0,()=>td.value)),h("div",{class:"q-drawer-container"},Xh)}}});let id=0;const useTabEmits=["click","keydown"],useTabProps={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${id++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function useTab(e,t,n,r){const s=inject(tabsKey,emptyRenderFn);if(s===emptyRenderFn)return console.error("QTab/QRouteTab component needs to be child of QTabs"),emptyRenderFn;const{proxy:l}=getCurrentInstance(),p=ref(null),o=ref(null),x=ref(null),M=computed(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),P=computed(()=>s.currentModel.value===e.name),he=computed(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(P.value===!0?" q-tab--active"+(s.tabProps.value.activeClass?" "+s.tabProps.value.activeClass:"")+(s.tabProps.value.activeColor?` text-${s.tabProps.value.activeColor}`:"")+(s.tabProps.value.activeBgColor?` bg-${s.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&s.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||s.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")+(r!==void 0?r.linkClass.value:"")),nt=computed(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(s.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),_e=computed(()=>e.disable===!0||s.hasFocus.value===!0||P.value===!1&&s.hasActiveTab.value===!0?-1:e.tabindex||0);function Bt(Co,as){if(as!==!0&&p.value!==null&&p.value.focus(),e.disable===!0){r!==void 0&&r.hasRouterLink.value===!0&&stopAndPrevent(Co);return}if(r===void 0){s.updateModel({name:e.name}),n("click",Co);return}if(r.hasRouterLink.value===!0){const Js=(lh={})=>{let ch;const Zu=lh.to===void 0||isDeepEqual(lh.to,e.to)===!0?s.avoidRouteWatcher=uid$1():null;return r.navigateToRouterLink(Co,{...lh,returnRouterError:!0}).catch(th=>{ch=th}).then(th=>{if(Zu===s.avoidRouteWatcher&&(s.avoidRouteWatcher=!1,ch===void 0&&(th===void 0||th.message.startsWith("Avoided redundant navigation")===!0)&&s.updateModel({name:e.name})),lh.returnRouterError===!0)return ch!==void 0?Promise.reject(ch):th})};n("click",Co,Js),Co.defaultPrevented!==!0&&Js();return}n("click",Co)}function Fn(Co){isKeyCode(Co,[13,32])?Bt(Co,!0):shouldIgnoreKey(Co)!==!0&&Co.keyCode>=35&&Co.keyCode<=40&&Co.altKey!==!0&&Co.metaKey!==!0&&s.onKbdNavigate(Co.keyCode,l.$el)===!0&&stopAndPrevent(Co),n("keydown",Co)}function yr(){const Co=s.tabProps.value.narrowIndicator,as=[],Js=h("div",{ref:x,class:["q-tab__indicator",s.tabProps.value.indicatorClass]});e.icon!==void 0&&as.push(h(QIcon,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&as.push(h("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&as.push(e.alertIcon!==void 0?h(QIcon,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):h("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),Co===!0&&as.push(Js);const lh=[h("div",{class:"q-focus-helper",tabindex:-1,ref:p}),h("div",{class:nt.value},hMergeSlot(t.default,as))];return Co===!1&&lh.push(Js),lh}const Io={name:computed(()=>e.name),rootRef:o,tabIndicatorRef:x,routeData:r};onBeforeUnmount(()=>{s.unregisterTab(Io)}),onMounted(()=>{s.registerTab(Io)});function rl(Co,as){const Js={ref:o,class:he.value,tabindex:_e.value,role:"tab","aria-selected":P.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:Bt,onKeydown:Fn,...as};return withDirectives(h(Co,Js,yr()),[[Ripple,M.value]])}return{renderTab:rl,$tabs:s}}const QTab=createComponent({name:"QTab",props:useTabProps,emits:useTabEmits,setup(e,{slots:t,emit:n}){const{renderTab:r}=useTab(e,t,n);return()=>r("div")}});let rtlHasScrollBug=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const t=document.createElement("div");Object.assign(t.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,rtlHasScrollBug=e.scrollLeft>=0,e.remove()}function getIndicatorClass(e,t,n){const r=n===!0?["left","right"]:["top","bottom"];return`absolute-${t===!0?r[0]:r[1]}${e?` text-${e}`:""}`}const alignValues=["left","center","right","justify"],QTabs=createComponent({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>alignValues.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:t,emit:n}){const{proxy:r}=getCurrentInstance(),{$q:s}=r,{registerTick:l}=useTick(),{registerTick:p}=useTick(),{registerTick:o}=useTick(),{registerTimeout:x,removeTimeout:M}=useTimeout(),{registerTimeout:P,removeTimeout:he}=useTimeout(),nt=ref(null),_e=ref(null),Bt=ref(e.modelValue),Fn=ref(!1),yr=ref(!0),Io=ref(!1),rl=ref(!1),Co=[],as=ref(0),Js=ref(!1);let lh=null,ch=null,Zu;const th=computed(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:getIndicatorClass(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),sl=computed(()=>{const ad=as.value,Zd=Bt.value;for(let Xh=0;Xh<ad;Xh++)if(Co[Xh].name.value===Zd)return!0;return!1}),sh=computed(()=>`q-tabs__content--align-${Fn.value===!0?"left":rl.value===!0?"justify":e.align}`),xh=computed(()=>`q-tabs row no-wrap items-center q-tabs--${Fn.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),Mh=computed(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+sh.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),Dh=computed(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),Uh=computed(()=>e.vertical!==!0&&s.lang.rtl===!0),cd=computed(()=>rtlHasScrollBug===!1&&Uh.value===!0);watch(Uh,qd),watch(()=>e.modelValue,ad=>{Tf({name:ad,setCurrent:!0,skipEmit:!0})}),watch(()=>e.outsideArrows,yf);function Tf({name:ad,setCurrent:Zd,skipEmit:Xh}){Bt.value!==ad&&(Xh!==!0&&e["onUpdate:modelValue"]!==void 0&&n("update:modelValue",ad),(Zd===!0||e["onUpdate:modelValue"]===void 0)&&(md(Bt.value,ad),Bt.value=ad))}function yf(){l(()=>{Af({width:nt.value.offsetWidth,height:nt.value.offsetHeight})})}function Af(ad){if(Dh.value===void 0||_e.value===null)return;const Zd=ad[Dh.value.container],Xh=Math.min(_e.value[Dh.value.scroll],Array.prototype.reduce.call(_e.value.children,(Kf,If)=>Kf+(If[Dh.value.content]||0),0)),Ld=Zd>0&&Xh>Zd;Fn.value=Ld,Ld===!0&&p(qd),rl.value=Zd<parseInt(e.breakpoint,10)}function md(ad,Zd){const Xh=ad!=null&&ad!==""?Co.find(Kf=>Kf.name.value===ad):null,Ld=Zd!=null&&Zd!==""?Co.find(Kf=>Kf.name.value===Zd):null;if(Xh&&Ld){const Kf=Xh.tabIndicatorRef.value,If=Ld.tabIndicatorRef.value;lh!==null&&(clearTimeout(lh),lh=null),Kf.style.transition="none",Kf.style.transform="none",If.style.transition="none",If.style.transform="none";const Df=Kf.getBoundingClientRect(),Jf=If.getBoundingClientRect();If.style.transform=e.vertical===!0?`translate3d(0,${Df.top-Jf.top}px,0) scale3d(1,${Jf.height?Df.height/Jf.height:1},1)`:`translate3d(${Df.left-Jf.left}px,0,0) scale3d(${Jf.width?Df.width/Jf.width:1},1,1)`,o(()=>{lh=setTimeout(()=>{lh=null,If.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",If.style.transform="none"},70)})}Ld&&Fn.value===!0&&vd(Ld.rootRef.value)}function vd(ad){const{left:Zd,width:Xh,top:Ld,height:Kf}=_e.value.getBoundingClientRect(),If=ad.getBoundingClientRect();let Df=e.vertical===!0?If.top-Ld:If.left-Zd;if(Df<0){_e.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(Df),qd();return}Df+=e.vertical===!0?If.height-Kf:If.width-Xh,Df>0&&(_e.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(Df),qd())}function qd(){const ad=_e.value;if(ad===null)return;const Zd=ad.getBoundingClientRect(),Xh=e.vertical===!0?ad.scrollTop:Math.abs(ad.scrollLeft);Uh.value===!0?(yr.value=Math.ceil(Xh+Zd.width)<ad.scrollWidth-1,Io.value=Xh>0):(yr.value=Xh>0,Io.value=e.vertical===!0?Math.ceil(Xh+Zd.height)<ad.scrollHeight:Math.ceil(Xh+Zd.width)<ad.scrollWidth)}function Ed(ad){ch!==null&&clearInterval(ch),ch=setInterval(()=>{Id(ad)===!0&&Cd()},5)}function Td(){Ed(cd.value===!0?Number.MAX_SAFE_INTEGER:0)}function Fd(){Ed(cd.value===!0?0:Number.MAX_SAFE_INTEGER)}function Cd(){ch!==null&&(clearInterval(ch),ch=null)}function Gd(ad,Zd){const Xh=Array.prototype.filter.call(_e.value.children,Jf=>Jf===Zd||Jf.matches&&Jf.matches(".q-tab.q-focusable")===!0),Ld=Xh.length;if(Ld===0)return;if(ad===36)return vd(Xh[0]),Xh[0].focus(),!0;if(ad===35)return vd(Xh[Ld-1]),Xh[Ld-1].focus(),!0;const Kf=ad===(e.vertical===!0?38:37),If=ad===(e.vertical===!0?40:39),Df=Kf===!0?-1:If===!0?1:void 0;if(Df!==void 0){const Jf=Uh.value===!0?-1:1,Nf=Xh.indexOf(Zd)+Df*Jf;return Nf>=0&&Nf<Ld&&(vd(Xh[Nf]),Xh[Nf].focus({preventScroll:!0})),!0}}const bf=computed(()=>cd.value===!0?{get:ad=>Math.abs(ad.scrollLeft),set:(ad,Zd)=>{ad.scrollLeft=-Zd}}:e.vertical===!0?{get:ad=>ad.scrollTop,set:(ad,Zd)=>{ad.scrollTop=Zd}}:{get:ad=>ad.scrollLeft,set:(ad,Zd)=>{ad.scrollLeft=Zd}});function Id(ad){const Zd=_e.value,{get:Xh,set:Ld}=bf.value;let Kf=!1,If=Xh(Zd);const Df=ad<If?-1:1;return If+=Df*5,If<0?(Kf=!0,If=0):(Df===-1&&If<=ad||Df===1&&If>=ad)&&(Kf=!0,If=ad),Ld(Zd,If),qd(),Kf}function td(ad,Zd){for(const Xh in ad)if(ad[Xh]!==Zd[Xh])return!1;return!0}function $d(){let ad=null,Zd={matchedLen:0,queryDiff:9999,hrefLen:0};const Xh=Co.filter(Df=>Df.routeData!==void 0&&Df.routeData.hasRouterLink.value===!0),{hash:Ld,query:Kf}=r.$route,If=Object.keys(Kf).length;for(const Df of Xh){const Jf=Df.routeData.exact.value===!0;if(Df.routeData[Jf===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:Nf,query:Wf,matched:Cp,href:Tp}=Df.routeData.resolvedLink.value,Pp=Object.keys(Wf).length;if(Jf===!0){if(Nf!==Ld||Pp!==If||td(Kf,Wf)===!1)continue;ad=Df.name.value;break}if(Nf!==""&&Nf!==Ld||Pp!==0&&td(Wf,Kf)===!1)continue;const Yf={matchedLen:Cp.length,queryDiff:If-Pp,hrefLen:Tp.length-Nf.length};if(Yf.matchedLen>Zd.matchedLen){ad=Df.name.value,Zd=Yf;continue}else if(Yf.matchedLen!==Zd.matchedLen)continue;if(Yf.queryDiff<Zd.queryDiff)ad=Df.name.value,Zd=Yf;else if(Yf.queryDiff!==Zd.queryDiff)continue;Yf.hrefLen>Zd.hrefLen&&(ad=Df.name.value,Zd=Yf)}ad===null&&Co.some(Df=>Df.routeData===void 0&&Df.name.value===Bt.value)===!0||Tf({name:ad,setCurrent:!0})}function np(ad){if(M(),Js.value!==!0&&nt.value!==null&&ad.target&&typeof ad.target.closest=="function"){const Zd=ad.target.closest(".q-tab");Zd&&nt.value.contains(Zd)===!0&&(Js.value=!0,Fn.value===!0&&vd(Zd))}}function jf(){x(()=>{Js.value=!1},30)}function yd(){fp.avoidRouteWatcher===!1?P($d):he()}function Qd(){if(Zu===void 0){const ad=watch(()=>r.$route.fullPath,yd);Zu=()=>{ad(),Zu=void 0}}}function op(ad){Co.push(ad),as.value++,yf(),ad.routeData===void 0||r.$route===void 0?P(()=>{if(Fn.value===!0){const Zd=Bt.value,Xh=Zd!=null&&Zd!==""?Co.find(Ld=>Ld.name.value===Zd):null;Xh&&vd(Xh.rootRef.value)}}):(Qd(),ad.routeData.hasRouterLink.value===!0&&yd())}function bp(ad){Co.splice(Co.indexOf(ad),1),as.value--,yf(),Zu!==void 0&&ad.routeData!==void 0&&(Co.every(Zd=>Zd.routeData===void 0)===!0&&Zu(),yd())}const fp={currentModel:Bt,tabProps:th,hasFocus:Js,hasActiveTab:sl,registerTab:op,unregisterTab:bp,verifyRouteModel:yd,updateModel:Tf,onKbdNavigate:Gd,avoidRouteWatcher:!1};provide(tabsKey,fp);function Qh(){lh!==null&&clearTimeout(lh),Cd(),Zu!==void 0&&Zu()}let Yd;return onBeforeUnmount(Qh),onDeactivated(()=>{Yd=Zu!==void 0,Qh()}),onActivated(()=>{Yd===!0&&Qd(),yf()}),()=>h("div",{ref:nt,class:xh.value,role:"tablist",onFocusin:np,onFocusout:jf},[h(QResizeObserver,{onResize:Af}),h("div",{ref:_e,class:Mh.value,onScroll:qd},hSlot(t.default)),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(yr.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||s.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:Td,onTouchstartPassive:Td,onMouseupPassive:Cd,onMouseleavePassive:Cd,onTouchendPassive:Cd}),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(Io.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||s.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:Fd,onTouchstartPassive:Fd,onMouseupPassive:Cd,onMouseleavePassive:Cd,onTouchendPassive:Cd})])}});function parseArg(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((n,r)=>{const s=parseFloat(n);s&&(t[r]=s)}),t}const TouchSwipe=createDirective({name:"touch-swipe",beforeMount(e,{value:t,arg:n,modifiers:r}){if(r.mouse!==!0&&client$1.has.touch!==!0)return;const s=r.mouseCapture===!0?"Capture":"",l={handler:t,sensitivity:parseArg(n),direction:getModifierDirections(r),noop,mouseStart(p){shouldStart(p,l)&&leftClick(p)&&(addEvt(l,"temp",[[document,"mousemove","move",`notPassive${s}`],[document,"mouseup","end","notPassiveCapture"]]),l.start(p,!0))},touchStart(p){if(shouldStart(p,l)){const o=p.target;addEvt(l,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","notPassiveCapture"],[o,"touchend","end","notPassiveCapture"]]),l.start(p)}},start(p,o){client$1.is.firefox===!0&&preventDraggable(e,!0);const x=position(p);l.event={x:x.left,y:x.top,time:Date.now(),mouse:o===!0,dir:!1}},move(p){if(l.event===void 0)return;if(l.event.dir!==!1){stopAndPrevent(p);return}const o=Date.now()-l.event.time;if(o===0)return;const x=position(p),M=x.left-l.event.x,P=Math.abs(M),he=x.top-l.event.y,nt=Math.abs(he);if(l.event.mouse!==!0){if(P<l.sensitivity[1]&&nt<l.sensitivity[1]){l.end(p);return}}else if(window.getSelection().toString()!==""){l.end(p);return}else if(P<l.sensitivity[2]&&nt<l.sensitivity[2])return;const _e=P/o,Bt=nt/o;l.direction.vertical===!0&&P<nt&&P<100&&Bt>l.sensitivity[0]&&(l.event.dir=he<0?"up":"down"),l.direction.horizontal===!0&&P>nt&&nt<100&&_e>l.sensitivity[0]&&(l.event.dir=M<0?"left":"right"),l.direction.up===!0&&P<nt&&he<0&&P<100&&Bt>l.sensitivity[0]&&(l.event.dir="up"),l.direction.down===!0&&P<nt&&he>0&&P<100&&Bt>l.sensitivity[0]&&(l.event.dir="down"),l.direction.left===!0&&P>nt&&M<0&&nt<100&&_e>l.sensitivity[0]&&(l.event.dir="left"),l.direction.right===!0&&P>nt&&M>0&&nt<100&&_e>l.sensitivity[0]&&(l.event.dir="right"),l.event.dir!==!1?(stopAndPrevent(p),l.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),l.styleCleanup=Fn=>{l.styleCleanup=void 0,document.body.classList.remove("non-selectable");const yr=()=>{document.body.classList.remove("no-pointer-events--children")};Fn===!0?setTimeout(yr,50):yr()}),l.handler({evt:p,touch:l.event.mouse!==!0,mouse:l.event.mouse,direction:l.event.dir,duration:o,distance:{x:P,y:nt}})):l.end(p)},end(p){l.event!==void 0&&(cleanEvt(l,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),l.styleCleanup!==void 0&&l.styleCleanup(!0),p!==void 0&&l.event.dir!==!1&&stopAndPrevent(p),l.event=void 0)}};if(e.__qtouchswipe=l,r.mouse===!0){const p=r.mouseCapture===!0||r.mousecapture===!0?"Capture":"";addEvt(l,"main",[[e,"mousedown","mouseStart",`passive${p}`]])}client$1.has.touch===!0&&addEvt(l,"main",[[e,"touchstart","touchStart",`passive${r.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const n=e.__qtouchswipe;n!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&n.end(),n.handler=t.value),n.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});function useCache(){const e=new Map;return{getCache:function(t,n){return e[t]===void 0?e[t]=n:e[t]},getCacheWithFn:function(t,n){return e[t]===void 0?e[t]=n():e[t]}}}const usePanelChildProps={name:{required:!0},disable:Boolean},PanelWrapper={setup(e,{slots:t}){return()=>h("div",{class:"q-panel scroll",role:"tabpanel"},hSlot(t.default))}},usePanelProps={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},usePanelEmits=["update:modelValue","beforeTransition","transition"];function usePanel(){const{props:e,emit:t,proxy:n}=getCurrentInstance(),{getCacheWithFn:r}=useCache();let s,l;const p=ref(null),o=ref(null);function x(Mh){const Dh=e.vertical===!0?"up":"left";ch((n.$q.lang.rtl===!0?-1:1)*(Mh.direction===Dh?1:-1))}const M=computed(()=>[[TouchSwipe,x,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),P=computed(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),he=computed(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),nt=computed(()=>`--q-transition-duration: ${e.transitionDuration}ms`),_e=computed(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),Bt=computed(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),Fn=computed(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);watch(()=>e.modelValue,(Mh,Dh)=>{const Uh=Co(Mh)===!0?as(Mh):-1;l!==!0&&lh(Uh===-1?0:Uh<as(Dh)?-1:1),p.value!==Uh&&(p.value=Uh,t("beforeTransition",Mh,Dh),nextTick(()=>{t("transition",Mh,Dh)}))});function yr(){ch(1)}function Io(){ch(-1)}function rl(Mh){t("update:modelValue",Mh)}function Co(Mh){return Mh!=null&&Mh!==""}function as(Mh){return s.findIndex(Dh=>Dh.props.name===Mh&&Dh.props.disable!==""&&Dh.props.disable!==!0)}function Js(){return s.filter(Mh=>Mh.props.disable!==""&&Mh.props.disable!==!0)}function lh(Mh){const Dh=Mh!==0&&e.animated===!0&&p.value!==-1?"q-transition--"+(Mh===-1?P.value:he.value):null;o.value!==Dh&&(o.value=Dh)}function ch(Mh,Dh=p.value){let Uh=Dh+Mh;for(;Uh>-1&&Uh<s.length;){const cd=s[Uh];if(cd!==void 0&&cd.props.disable!==""&&cd.props.disable!==!0){lh(Mh),l=!0,t("update:modelValue",cd.props.name),setTimeout(()=>{l=!1});return}Uh+=Mh}e.infinite===!0&&s.length!==0&&Dh!==-1&&Dh!==s.length&&ch(Mh,Mh===-1?s.length:-1)}function Zu(){const Mh=as(e.modelValue);return p.value!==Mh&&(p.value=Mh),!0}function th(){const Mh=Co(e.modelValue)===!0&&Zu()&&s[p.value];return e.keepAlive===!0?[h(KeepAlive,Bt.value,[h(Fn.value===!0?r(_e.value,()=>({...PanelWrapper,name:_e.value})):PanelWrapper,{key:_e.value,style:nt.value},()=>Mh)])]:[h("div",{class:"q-panel scroll",style:nt.value,key:_e.value,role:"tabpanel"},[Mh])]}function sl(){if(s.length!==0)return e.animated===!0?[h(Transition,{name:o.value},th)]:th()}function sh(Mh){return s=getNormalizedVNodes(hSlot(Mh.default,[])).filter(Dh=>Dh.props!==null&&Dh.props.slot===void 0&&Co(Dh.props.name)===!0),s.length}function xh(){return s}return Object.assign(n,{next:yr,previous:Io,goTo:rl}),{panelIndex:p,panelDirectives:M,updatePanelsList:sh,updatePanelIndex:Zu,getPanelContent:sl,getEnabledPanels:Js,getPanels:xh,isValidPanelName:Co,keepAliveProps:Bt,needsUniqueKeepAliveWrapper:Fn,goToPanelByOffset:ch,goToPanel:rl,nextPanel:yr,previousPanel:Io}}const QTabPanel=createComponent({name:"QTabPanel",props:usePanelChildProps,setup(e,{slots:t}){return()=>h("div",{class:"q-tab-panel",role:"tabpanel"},hSlot(t.default))}}),QField=createComponent({name:"QField",inheritAttrs:!1,props:useFieldProps,emits:useFieldEmits,setup(){return useField(useFieldState())}}),defaultSizes$1={xs:8,sm:10,md:14,lg:20,xl:24},QChip=createComponent({name:"QChip",props:{...useDarkProps,...useSizeProps,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:n}){const{proxy:{$q:r}}=getCurrentInstance(),s=useDark(e,r),l=useSize(e,defaultSizes$1),p=computed(()=>e.selected===!0||e.icon!==void 0),o=computed(()=>e.selected===!0?e.iconSelected||r.iconSet.chip.selected:e.icon),x=computed(()=>e.iconRemove||r.iconSet.chip.remove),M=computed(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),P=computed(()=>{const yr=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(yr?` text-${yr} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(M.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(s.value===!0?" q-chip--dark q-dark":"")}),he=computed(()=>{const yr=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},Io={...yr,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||r.lang.label.remove};return{chip:yr,remove:Io}});function nt(yr){yr.keyCode===13&&_e(yr)}function _e(yr){e.disable||(n("update:selected",!e.selected),n("click",yr))}function Bt(yr){(yr.keyCode===void 0||yr.keyCode===13)&&(stopAndPrevent(yr),e.disable===!1&&(n("update:modelValue",!1),n("remove")))}function Fn(){const yr=[];M.value===!0&&yr.push(h("div",{class:"q-focus-helper"})),p.value===!0&&yr.push(h(QIcon,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const Io=e.label!==void 0?[h("div",{class:"ellipsis"},[e.label])]:void 0;return yr.push(h("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},hMergeSlotSafely(t.default,Io))),e.iconRight&&yr.push(h(QIcon,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&yr.push(h(QIcon,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:x.value,...he.value.remove,onClick:Bt,onKeyup:Bt})),yr}return()=>{if(e.modelValue===!1)return;const yr={class:P.value,style:l.value};return M.value===!0&&Object.assign(yr,he.value.chip,{onClick:_e,onKeyup:nt}),hDir("div",yr,Fn(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ripple,e.ripple]])}}}),QItem=createComponent({name:"QItem",props:{...useDarkProps,...useRouterLinkProps,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:t,emit:n}){const{proxy:{$q:r}}=getCurrentInstance(),s=useDark(e,r),{hasLink:l,linkAttrs:p,linkClass:o,linkTag:x,navigateOnClick:M}=useRouterLink(),P=ref(null),he=ref(null),nt=computed(()=>e.clickable===!0||l.value===!0||e.tag==="label"),_e=computed(()=>e.disable!==!0&&nt.value===!0),Bt=computed(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(s.value===!0?" q-item--dark":"")+(l.value===!0&&e.active===null?o.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(_e.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),Fn=computed(()=>e.insetLevel===void 0?null:{["padding"+(r.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function yr(Co){_e.value===!0&&(he.value!==null&&(Co.qKeyEvent!==!0&&document.activeElement===P.value?he.value.focus():document.activeElement===he.value&&P.value.focus()),M(Co))}function Io(Co){if(_e.value===!0&&isKeyCode(Co,13)===!0){stopAndPrevent(Co),Co.qKeyEvent=!0;const as=new MouseEvent("click",Co);as.qKeyEvent=!0,P.value.dispatchEvent(as)}n("keyup",Co)}function rl(){const Co=hUniqueSlot(t.default,[]);return _e.value===!0&&Co.unshift(h("div",{class:"q-focus-helper",tabindex:-1,ref:he})),Co}return()=>{const Co={ref:P,class:Bt.value,style:Fn.value,role:"listitem",onClick:yr,onKeyup:Io};return _e.value===!0?(Co.tabindex=e.tabindex||"0",Object.assign(Co,p.value)):nt.value===!0&&(Co["aria-disabled"]="true"),h(x.value,Co,rl())}}}),QItemSection=createComponent({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:t}){const n=computed(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>h("div",{class:n.value},hSlot(t.default))}}),QItemLabel=createComponent({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(e,{slots:t}){const n=computed(()=>parseInt(e.lines,10)),r=computed(()=>"q-item__label"+(e.overline===!0?" q-item__label--overline text-overline":"")+(e.caption===!0?" q-item__label--caption text-caption":"")+(e.header===!0?" q-item__label--header":"")+(n.value===1?" ellipsis":"")),s=computed(()=>e.lines!==void 0&&n.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":n.value}:null);return()=>h("div",{style:s.value,class:r.value},hSlot(t.default))}}),useAnchorProps={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function useAnchor({showing:e,avoidEmit:t,configureAnchorEl:n}){const{props:r,proxy:s,emit:l}=getCurrentInstance(),p=ref(null);let o=null;function x(_e){return p.value===null?!1:_e===void 0||_e.touches===void 0||_e.touches.length<=1}const M={};n===void 0&&(Object.assign(M,{hide(_e){s.hide(_e)},toggle(_e){s.toggle(_e),_e.qAnchorHandled=!0},toggleKey(_e){isKeyCode(_e,13)===!0&&M.toggle(_e)},contextClick(_e){s.hide(_e),prevent(_e),nextTick(()=>{s.show(_e),_e.qAnchorHandled=!0})},prevent,mobileTouch(_e){if(M.mobileCleanup(_e),x(_e)!==!0)return;s.hide(_e),p.value.classList.add("non-selectable");const Bt=_e.target;addEvt(M,"anchor",[[Bt,"touchmove","mobileCleanup","passive"],[Bt,"touchend","mobileCleanup","passive"],[Bt,"touchcancel","mobileCleanup","passive"],[p.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{o=null,s.show(_e),_e.qAnchorHandled=!0},300)},mobileCleanup(_e){p.value.classList.remove("non-selectable"),o!==null&&(clearTimeout(o),o=null),e.value===!0&&_e!==void 0&&clearSelection()}}),n=function(_e=r.contextMenu){if(r.noParentEvent===!0||p.value===null)return;let Bt;_e===!0?s.$q.platform.is.mobile===!0?Bt=[[p.value,"touchstart","mobileTouch","passive"]]:Bt=[[p.value,"mousedown","hide","passive"],[p.value,"contextmenu","contextClick","notPassive"]]:Bt=[[p.value,"click","toggle","passive"],[p.value,"keyup","toggleKey","passive"]],addEvt(M,"anchor",Bt)});function P(){cleanEvt(M,"anchor")}function he(_e){for(p.value=_e;p.value.classList.contains("q-anchor--skip");)p.value=p.value.parentNode;n()}function nt(){if(r.target===!1||r.target===""||s.$el.parentNode===null)p.value=null;else if(r.target===!0)he(s.$el.parentNode);else{let _e=r.target;if(typeof r.target=="string")try{_e=document.querySelector(r.target)}catch{_e=void 0}_e!=null?(p.value=_e.$el||_e,n()):(p.value=null,console.error(`Anchor: target "${r.target}" not found`))}}return watch(()=>r.contextMenu,_e=>{p.value!==null&&(P(),n(_e))}),watch(()=>r.target,()=>{p.value!==null&&P(),nt()}),watch(()=>r.noParentEvent,_e=>{p.value!==null&&(_e===!0?P():n())}),onMounted(()=>{nt(),t!==!0&&r.modelValue===!0&&p.value===null&&l("update:modelValue",!1)}),onBeforeUnmount(()=>{o!==null&&clearTimeout(o),P()}),{anchorEl:p,canShow:x,anchorEvents:M}}function useScrollTarget(e,t){const n=ref(null);let r;function s(o,x){const M=`${x!==void 0?"add":"remove"}EventListener`,P=x!==void 0?x:r;o!==window&&o[M]("scroll",P,listenOpts.passive),window[M]("scroll",P,listenOpts.passive),r=x}function l(){n.value!==null&&(s(n.value),n.value=null)}const p=watch(()=>e.noParentEvent,()=>{n.value!==null&&(l(),t())});return onBeforeUnmount(p),{localScrollTarget:n,unconfigureScrollTarget:l,changeScrollEvent:s}}const{notPassiveCapture}=listenOpts,registeredList=[];function globalHandler(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let n=portalProxyList.length-1;for(;n>=0;){const r=portalProxyList[n].$;if(r.type.name!=="QDialog")break;if(r.props.seamless!==!0)return;n--}for(let r=registeredList.length-1;r>=0;r--){const s=registeredList[r];if((s.anchorEl.value===null||s.anchorEl.value.contains(t)===!1)&&(t===document.body||s.innerRef.value!==null&&s.innerRef.value.contains(t)===!1))e.qClickOutside=!0,s.onClickOutside(e);else return}}function addClickOutside(e){registeredList.push(e),registeredList.length===1&&(document.addEventListener("mousedown",globalHandler,notPassiveCapture),document.addEventListener("touchstart",globalHandler,notPassiveCapture))}function removeClickOutside(e){const t=registeredList.findIndex(n=>n===e);t>-1&&(registeredList.splice(t,1),registeredList.length===0&&(document.removeEventListener("mousedown",globalHandler,notPassiveCapture),document.removeEventListener("touchstart",globalHandler,notPassiveCapture)))}let vpLeft,vpTop;function validatePosition(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function validateOffset(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const horizontalPos={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{horizontalPos[`${e}#ltr`]=e,horizontalPos[`${e}#rtl`]=e});function parsePosition(e,t){const n=e.split(" ");return{vertical:n[0],horizontal:horizontalPos[`${n[1]}#${t===!0?"rtl":"ltr"}`]}}function getAnchorProps(e,t){let{top:n,left:r,right:s,bottom:l,width:p,height:o}=e.getBoundingClientRect();return t!==void 0&&(n-=t[1],r-=t[0],l+=t[1],s+=t[0],p+=t[0],o+=t[1]),{top:n,bottom:l,height:o,left:r,right:s,width:p,middle:r+(s-r)/2,center:n+(l-n)/2}}function getAbsoluteAnchorProps(e,t,n){let{top:r,left:s}=e.getBoundingClientRect();return r+=t.top,s+=t.left,n!==void 0&&(r+=n[1],s+=n[0]),{top:r,bottom:r+1,height:1,left:s,right:s+1,width:1,middle:s,center:r}}function getTargetProps(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function getTopLeftProps(e,t,n){return{top:e[n.anchorOrigin.vertical]-t[n.selfOrigin.vertical],left:e[n.anchorOrigin.horizontal]-t[n.selfOrigin.horizontal]}}function setPosition(e){if(client$1.is.ios===!0&&window.visualViewport!==void 0){const o=document.body.style,{offsetLeft:x,offsetTop:M}=window.visualViewport;x!==vpLeft&&(o.setProperty("--q-pe-left",x+"px"),vpLeft=x),M!==vpTop&&(o.setProperty("--q-pe-top",M+"px"),vpTop=M)}const{scrollLeft:t,scrollTop:n}=e.el,r=e.absoluteOffset===void 0?getAnchorProps(e.anchorEl,e.cover===!0?[0,0]:e.offset):getAbsoluteAnchorProps(e.anchorEl,e.absoluteOffset,e.offset);let s={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(s.minWidth=r.width+"px",e.cover===!0&&(s.minHeight=r.height+"px")),Object.assign(e.el.style,s);const l=getTargetProps(e.el);let p=getTopLeftProps(r,l,e);if(e.absoluteOffset===void 0||e.offset===void 0)applyBoundaries(p,r,l,e.anchorOrigin,e.selfOrigin);else{const{top:o,left:x}=p;applyBoundaries(p,r,l,e.anchorOrigin,e.selfOrigin);let M=!1;if(p.top!==o){M=!0;const P=2*e.offset[1];r.center=r.top-=P,r.bottom-=P+2}if(p.left!==x){M=!0;const P=2*e.offset[0];r.middle=r.left-=P,r.right-=P+2}M===!0&&(p=getTopLeftProps(r,l,e),applyBoundaries(p,r,l,e.anchorOrigin,e.selfOrigin))}s={top:p.top+"px",left:p.left+"px"},p.maxHeight!==void 0&&(s.maxHeight=p.maxHeight+"px",r.height>p.maxHeight&&(s.minHeight=s.maxHeight)),p.maxWidth!==void 0&&(s.maxWidth=p.maxWidth+"px",r.width>p.maxWidth&&(s.minWidth=s.maxWidth)),Object.assign(e.el.style,s),e.el.scrollTop!==n&&(e.el.scrollTop=n),e.el.scrollLeft!==t&&(e.el.scrollLeft=t)}function applyBoundaries(e,t,n,r,s){const l=n.bottom,p=n.right,o=getScrollbarWidth(),x=window.innerHeight-o,M=document.body.clientWidth;if(e.top<0||e.top+l>x)if(s.vertical==="center")e.top=t[r.vertical]>x/2?Math.max(0,x-l):0,e.maxHeight=Math.min(l,x);else if(t[r.vertical]>x/2){const P=Math.min(x,r.vertical==="center"?t.center:r.vertical===s.vertical?t.bottom:t.top);e.maxHeight=Math.min(l,P),e.top=Math.max(0,P-l)}else e.top=Math.max(0,r.vertical==="center"?t.center:r.vertical===s.vertical?t.top:t.bottom),e.maxHeight=Math.min(l,x-e.top);if(e.left<0||e.left+p>M)if(e.maxWidth=Math.min(p,M),s.horizontal==="middle")e.left=t[r.horizontal]>M/2?Math.max(0,M-p):0;else if(t[r.horizontal]>M/2){const P=Math.min(M,r.horizontal==="middle"?t.middle:r.horizontal===s.horizontal?t.right:t.left);e.maxWidth=Math.min(p,P),e.left=Math.max(0,P-e.maxWidth)}else e.left=Math.max(0,r.horizontal==="middle"?t.middle:r.horizontal===s.horizontal?t.left:t.right),e.maxWidth=Math.min(p,M-e.left)}const QMenu=createComponent({name:"QMenu",inheritAttrs:!1,props:{...useAnchorProps,...useModelToggleProps,...useDarkProps,...useTransitionProps,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:validatePosition},self:{type:String,validator:validatePosition},offset:{type:Array,validator:validateOffset},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...useModelToggleEmits,"click","escapeKey"],setup(e,{slots:t,emit:n,attrs:r}){let s=null,l,p,o;const x=getCurrentInstance(),{proxy:M}=x,{$q:P}=M,he=ref(null),nt=ref(!1),_e=computed(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),Bt=useDark(e,P),{registerTick:Fn,removeTick:yr}=useTick(),{registerTimeout:Io}=useTimeout(),{transitionProps:rl,transitionStyle:Co}=useTransition(e),{localScrollTarget:as,changeScrollEvent:Js,unconfigureScrollTarget:lh}=useScrollTarget(e,Ed),{anchorEl:ch,canShow:Zu}=useAnchor({showing:nt}),{hide:th}=useModelToggle({showing:nt,canShow:Zu,handleShow:md,handleHide:vd,hideOnRouteChange:_e,processOnMount:!0}),{showPortal:sl,hidePortal:sh,renderPortal:xh}=usePortal(x,he,bf,"menu"),Mh={anchorEl:ch,innerRef:he,onClickOutside(Id){if(e.persistent!==!0&&nt.value===!0)return th(Id),(Id.type==="touchstart"||Id.target.classList.contains("q-dialog__backdrop"))&&stopAndPrevent(Id),!0}},Dh=computed(()=>parsePosition(e.anchor||(e.cover===!0?"center middle":"bottom start"),P.lang.rtl)),Uh=computed(()=>e.cover===!0?Dh.value:parsePosition(e.self||"top start",P.lang.rtl)),cd=computed(()=>(e.square===!0?" q-menu--square":"")+(Bt.value===!0?" q-menu--dark q-dark":"")),Tf=computed(()=>e.autoClose===!0?{onClick:Td}:{}),yf=computed(()=>nt.value===!0&&e.persistent!==!0);watch(yf,Id=>{Id===!0?(addEscapeKey(Cd),addClickOutside(Mh)):(removeEscapeKey(Cd),removeClickOutside(Mh))});function Af(){addFocusFn(()=>{let Id=he.value;Id&&Id.contains(document.activeElement)!==!0&&(Id=Id.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||Id.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||Id.querySelector("[autofocus], [data-autofocus]")||Id,Id.focus({preventScroll:!0}))})}function md(Id){if(s=e.noRefocus===!1?document.activeElement:null,addFocusout(Fd),sl(),Ed(),l=void 0,Id!==void 0&&(e.touchPosition||e.contextMenu)){const td=position(Id);if(td.left!==void 0){const{top:$d,left:np}=ch.value.getBoundingClientRect();l={left:td.left-np,top:td.top-$d}}}p===void 0&&(p=watch(()=>P.screen.width+"|"+P.screen.height+"|"+e.self+"|"+e.anchor+"|"+P.lang.rtl,Gd)),e.noFocus!==!0&&document.activeElement.blur(),Fn(()=>{Gd(),e.noFocus!==!0&&Af()}),Io(()=>{P.platform.is.ios===!0&&(o=e.autoClose,he.value.click()),Gd(),sl(!0),n("show",Id)},e.transitionDuration)}function vd(Id){yr(),sh(),qd(!0),s!==null&&(Id===void 0||Id.qClickOutside!==!0)&&(((Id&&Id.type.indexOf("key")===0?s.closest('[tabindex]:not([tabindex^="-"])'):void 0)||s).focus(),s=null),Io(()=>{sh(!0),n("hide",Id)},e.transitionDuration)}function qd(Id){l=void 0,p!==void 0&&(p(),p=void 0),(Id===!0||nt.value===!0)&&(removeFocusout(Fd),lh(),removeClickOutside(Mh),removeEscapeKey(Cd)),Id!==!0&&(s=null)}function Ed(){(ch.value!==null||e.scrollTarget!==void 0)&&(as.value=getScrollTarget(ch.value,e.scrollTarget),Js(as.value,Gd))}function Td(Id){o!==!0?(closePortalMenus(M,Id),n("click",Id)):o=!1}function Fd(Id){yf.value===!0&&e.noFocus!==!0&&childHasFocus(he.value,Id.target)!==!0&&Af()}function Cd(Id){n("escapeKey"),th(Id)}function Gd(){const Id=he.value;Id===null||ch.value===null||setPosition({el:Id,offset:e.offset,anchorEl:ch.value,anchorOrigin:Dh.value,selfOrigin:Uh.value,absoluteOffset:l,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function bf(){return h(Transition,rl.value,()=>nt.value===!0?h("div",{role:"menu",...r,ref:he,tabindex:-1,class:["q-menu q-position-engine scroll"+cd.value,r.class],style:[r.style,Co.value],...Tf.value},hSlot(t.default)):null)}return onBeforeUnmount(qd),Object.assign(M,{focus:Af,updatePosition:Gd}),xh}}),aggBucketSize=1e3,scrollToEdges=["start","center","end","start-force","center-force","end-force"],filterProto=Array.prototype.filter,setOverflowAnchor=window.getComputedStyle(document.body).overflowAnchor===void 0?noop:function(e,t){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const n=e.children||[];filterProto.call(n,s=>s.dataset&&s.dataset.qVsAnchor!==void 0).forEach(s=>{delete s.dataset.qVsAnchor});const r=n[t];r&&r.dataset&&(r.dataset.qVsAnchor="")}))};function sumFn(e,t){return e+t}function getScrollDetails(e,t,n,r,s,l,p,o){const x=e===window?document.scrollingElement||document.documentElement:e,M=s===!0?"offsetWidth":"offsetHeight",P={scrollStart:0,scrollViewSize:-p-o,scrollMaxSize:0,offsetStart:-p,offsetEnd:-o};if(s===!0?(e===window?(P.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,P.scrollViewSize+=document.documentElement.clientWidth):(P.scrollStart=x.scrollLeft,P.scrollViewSize+=x.clientWidth),P.scrollMaxSize=x.scrollWidth,l===!0&&(P.scrollStart=(rtlHasScrollBug===!0?P.scrollMaxSize-P.scrollViewSize:0)-P.scrollStart)):(e===window?(P.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,P.scrollViewSize+=document.documentElement.clientHeight):(P.scrollStart=x.scrollTop,P.scrollViewSize+=x.clientHeight),P.scrollMaxSize=x.scrollHeight),n!==null)for(let he=n.previousElementSibling;he!==null;he=he.previousElementSibling)he.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetStart+=he[M]);if(r!==null)for(let he=r.nextElementSibling;he!==null;he=he.nextElementSibling)he.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetEnd+=he[M]);if(t!==e){const he=x.getBoundingClientRect(),nt=t.getBoundingClientRect();s===!0?(P.offsetStart+=nt.left-he.left,P.offsetEnd-=nt.width):(P.offsetStart+=nt.top-he.top,P.offsetEnd-=nt.height),e!==window&&(P.offsetStart+=P.scrollStart),P.offsetEnd+=P.scrollMaxSize-P.offsetStart}return P}function setScroll(e,t,n,r){t==="end"&&(t=(e===window?document.body:e)[n===!0?"scrollWidth":"scrollHeight"]),e===window?n===!0?(r===!0&&(t=(rtlHasScrollBug===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-t),window.scrollTo(t,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,t):n===!0?(r===!0&&(t=(rtlHasScrollBug===!0?e.scrollWidth-e.offsetWidth:0)-t),e.scrollLeft=t):e.scrollTop=t}function sumSize(e,t,n,r){if(n>=r)return 0;const s=t.length,l=Math.floor(n/aggBucketSize),p=Math.floor((r-1)/aggBucketSize)+1;let o=e.slice(l,p).reduce(sumFn,0);return n%aggBucketSize!==0&&(o-=t.slice(l*aggBucketSize,n).reduce(sumFn,0)),r%aggBucketSize!==0&&r!==s&&(o-=t.slice(r,p*aggBucketSize).reduce(sumFn,0)),o}const commonVirtScrollProps={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},commonVirtPropsList=Object.keys(commonVirtScrollProps),useVirtualScrollProps={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...commonVirtScrollProps};function useVirtualScroll({virtualScrollLength:e,getVirtualScrollTarget:t,getVirtualScrollEl:n,virtualScrollItemSizeComputed:r}){const s=getCurrentInstance(),{props:l,emit:p,proxy:o}=s,{$q:x}=o;let M,P,he,nt=[],_e;const Bt=ref(0),Fn=ref(0),yr=ref({}),Io=ref(null),rl=ref(null),Co=ref(null),as=ref({from:0,to:0}),Js=computed(()=>l.tableColspan!==void 0?l.tableColspan:100);r===void 0&&(r=computed(()=>l.virtualScrollItemSize));const lh=computed(()=>r.value+";"+l.virtualScrollHorizontal),ch=computed(()=>lh.value+";"+l.virtualScrollSliceRatioBefore+";"+l.virtualScrollSliceRatioAfter);watch(ch,()=>{cd()}),watch(lh,Zu);function Zu(){Uh(P,!0)}function th(vd){Uh(vd===void 0?P:vd)}function sl(vd,qd){const Ed=t();if(Ed==null||Ed.nodeType===8)return;const Td=getScrollDetails(Ed,n(),Io.value,rl.value,l.virtualScrollHorizontal,x.lang.rtl,l.virtualScrollStickySizeStart,l.virtualScrollStickySizeEnd);he!==Td.scrollViewSize&&cd(Td.scrollViewSize),xh(Ed,Td,Math.min(e.value-1,Math.max(0,parseInt(vd,10)||0)),0,scrollToEdges.indexOf(qd)>-1?qd:P>-1&&vd>P?"end":"start")}function sh(){const vd=t();if(vd==null||vd.nodeType===8)return;const qd=getScrollDetails(vd,n(),Io.value,rl.value,l.virtualScrollHorizontal,x.lang.rtl,l.virtualScrollStickySizeStart,l.virtualScrollStickySizeEnd),Ed=e.value-1,Td=qd.scrollMaxSize-qd.offsetStart-qd.offsetEnd-Fn.value;if(M===qd.scrollStart)return;if(qd.scrollMaxSize<=0){xh(vd,qd,0,0);return}he!==qd.scrollViewSize&&cd(qd.scrollViewSize),Mh(as.value.from);const Fd=Math.floor(qd.scrollMaxSize-Math.max(qd.scrollViewSize,qd.offsetEnd)-Math.min(_e[Ed],qd.scrollViewSize/2));if(Fd>0&&Math.ceil(qd.scrollStart)>=Fd){xh(vd,qd,Ed,qd.scrollMaxSize-qd.offsetEnd-nt.reduce(sumFn,0));return}let Cd=0,Gd=qd.scrollStart-qd.offsetStart,bf=Gd;if(Gd<=Td&&Gd+qd.scrollViewSize>=Bt.value)Gd-=Bt.value,Cd=as.value.from,bf=Gd;else for(let Id=0;Gd>=nt[Id]&&Cd<Ed;Id++)Gd-=nt[Id],Cd+=aggBucketSize;for(;Gd>0&&Cd<Ed;)Gd-=_e[Cd],Gd>-qd.scrollViewSize?(Cd++,bf=Gd):bf=_e[Cd]+Gd;xh(vd,qd,Cd,bf)}function xh(vd,qd,Ed,Td,Fd){const Cd=typeof Fd=="string"&&Fd.indexOf("-force")>-1,Gd=Cd===!0?Fd.replace("-force",""):Fd,bf=Gd!==void 0?Gd:"start";let Id=Math.max(0,Ed-yr.value[bf]),td=Id+yr.value.total;td>e.value&&(td=e.value,Id=Math.max(0,td-yr.value.total)),M=qd.scrollStart;const $d=Id!==as.value.from||td!==as.value.to;if($d===!1&&Gd===void 0){yf(Ed);return}const{activeElement:np}=document,jf=Co.value;$d===!0&&jf!==null&&jf!==np&&jf.contains(np)===!0&&(jf.addEventListener("focusout",Dh),setTimeout(()=>{jf!==null&&jf.removeEventListener("focusout",Dh)})),setOverflowAnchor(jf,Ed-Id);const yd=Gd!==void 0?_e.slice(Id,Ed).reduce(sumFn,0):0;if($d===!0){const Qd=td>=as.value.from&&Id<=as.value.to?as.value.to:td;as.value={from:Id,to:Qd},Bt.value=sumSize(nt,_e,0,Id),Fn.value=sumSize(nt,_e,td,e.value),requestAnimationFrame(()=>{as.value.to!==td&&M===qd.scrollStart&&(as.value={from:as.value.from,to:td},Fn.value=sumSize(nt,_e,td,e.value))})}requestAnimationFrame(()=>{if(M!==qd.scrollStart)return;$d===!0&&Mh(Id);const Qd=_e.slice(Id,Ed).reduce(sumFn,0),op=Qd+qd.offsetStart+Bt.value,bp=op+_e[Ed];let fp=op+Td;if(Gd!==void 0){const Qh=Qd-yd,Yd=qd.scrollStart+Qh;fp=Cd!==!0&&Yd<op&&bp<Yd+qd.scrollViewSize?Yd:Gd==="end"?bp-qd.scrollViewSize:op-(Gd==="start"?0:Math.round((qd.scrollViewSize-_e[Ed])/2))}M=fp,setScroll(vd,fp,l.virtualScrollHorizontal,x.lang.rtl),yf(Ed)})}function Mh(vd){const qd=Co.value;if(qd){const Ed=filterProto.call(qd.children,Id=>Id.classList&&Id.classList.contains("q-virtual-scroll--skip")===!1),Td=Ed.length,Fd=l.virtualScrollHorizontal===!0?Id=>Id.getBoundingClientRect().width:Id=>Id.offsetHeight;let Cd=vd,Gd,bf;for(let Id=0;Id<Td;){for(Gd=Fd(Ed[Id]),Id++;Id<Td&&Ed[Id].classList.contains("q-virtual-scroll--with-prev")===!0;)Gd+=Fd(Ed[Id]),Id++;bf=Gd-_e[Cd],bf!==0&&(_e[Cd]+=bf,nt[Math.floor(Cd/aggBucketSize)]+=bf),Cd++}}}function Dh(){Co.value!==null&&Co.value!==void 0&&Co.value.focus()}function Uh(vd,qd){const Ed=1*r.value;(qd===!0||Array.isArray(_e)===!1)&&(_e=[]);const Td=_e.length;_e.length=e.value;for(let Cd=e.value-1;Cd>=Td;Cd--)_e[Cd]=Ed;const Fd=Math.floor((e.value-1)/aggBucketSize);nt=[];for(let Cd=0;Cd<=Fd;Cd++){let Gd=0;const bf=Math.min((Cd+1)*aggBucketSize,e.value);for(let Id=Cd*aggBucketSize;Id<bf;Id++)Gd+=_e[Id];nt.push(Gd)}P=-1,M=void 0,Bt.value=sumSize(nt,_e,0,as.value.from),Fn.value=sumSize(nt,_e,as.value.to,e.value),vd>=0?(Mh(as.value.from),nextTick(()=>{sl(vd)})):Af()}function cd(vd){if(vd===void 0&&typeof window<"u"){const Gd=t();Gd!=null&&Gd.nodeType!==8&&(vd=getScrollDetails(Gd,n(),Io.value,rl.value,l.virtualScrollHorizontal,x.lang.rtl,l.virtualScrollStickySizeStart,l.virtualScrollStickySizeEnd).scrollViewSize)}he=vd;const qd=parseFloat(l.virtualScrollSliceRatioBefore)||0,Ed=parseFloat(l.virtualScrollSliceRatioAfter)||0,Td=1+qd+Ed,Fd=vd===void 0||vd<=0?1:Math.ceil(vd/r.value),Cd=Math.max(1,Fd,Math.ceil((l.virtualScrollSliceSize>0?l.virtualScrollSliceSize:10)/Td));yr.value={total:Math.ceil(Cd*Td),start:Math.ceil(Cd*qd),center:Math.ceil(Cd*(.5+qd)),end:Math.ceil(Cd*(1+qd)),view:Fd}}function Tf(vd,qd){const Ed=l.virtualScrollHorizontal===!0?"width":"height",Td={["--q-virtual-scroll-item-"+Ed]:r.value+"px"};return[vd==="tbody"?h(vd,{class:"q-virtual-scroll__padding",key:"before",ref:Io},[h("tr",[h("td",{style:{[Ed]:`${Bt.value}px`,...Td},colspan:Js.value})])]):h(vd,{class:"q-virtual-scroll__padding",key:"before",ref:Io,style:{[Ed]:`${Bt.value}px`,...Td}}),h(vd,{class:"q-virtual-scroll__content",key:"content",ref:Co,tabindex:-1},qd.flat()),vd==="tbody"?h(vd,{class:"q-virtual-scroll__padding",key:"after",ref:rl},[h("tr",[h("td",{style:{[Ed]:`${Fn.value}px`,...Td},colspan:Js.value})])]):h(vd,{class:"q-virtual-scroll__padding",key:"after",ref:rl,style:{[Ed]:`${Fn.value}px`,...Td}})]}function yf(vd){P!==vd&&(l.onVirtualScroll!==void 0&&p("virtualScroll",{index:vd,from:as.value.from,to:as.value.to-1,direction:vd<P?"decrease":"increase",ref:o}),P=vd)}cd();const Af=debounce$2(sh,x.platform.is.ios===!0?120:35);onBeforeMount(()=>{cd()});let md=!1;return onDeactivated(()=>{md=!0}),onActivated(()=>{if(md!==!0)return;const vd=t();M!==void 0&&vd!==void 0&&vd!==null&&vd.nodeType!==8?setScroll(vd,M,l.virtualScrollHorizontal,x.lang.rtl):sl(P)}),onBeforeUnmount(()=>{Af.cancel()}),Object.assign(o,{scrollTo:sl,reset:Zu,refresh:th}),{virtualScrollSliceRange:as,virtualScrollSliceSizeComputed:yr,setVirtualScrollSize:cd,onVirtualScrollEvt:Af,localResetVirtualScroll:Uh,padVirtualScroll:Tf,scrollTo:sl,reset:Zu,refresh:th}}const validateNewValueMode=e=>["add","add-unique","toggle"].includes(e),reEscapeList=".*+?^${}()|[]\\",fieldPropsList=Object.keys(useFieldProps),QSelect=createComponent({name:"QSelect",inheritAttrs:!1,props:{...useVirtualScrollProps,...useFormProps,...useFieldProps,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:validateNewValueMode},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...useFieldEmits,"add","remove","inputValue","newValue","keyup","keypress","keydown","filterAbort"],setup(e,{slots:t,emit:n}){const{proxy:r}=getCurrentInstance(),{$q:s}=r,l=ref(!1),p=ref(!1),o=ref(-1),x=ref(""),M=ref(!1),P=ref(!1);let he=null,nt,_e,Bt,Fn=null,yr,Io,rl,Co;const as=ref(null),Js=ref(null),lh=ref(null),ch=ref(null),Zu=ref(null),th=useFormInputNameAttr(e),sl=useKeyComposition(Dd),sh=computed(()=>Array.isArray(e.options)?e.options.length:0),xh=computed(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Mh,virtualScrollSliceSizeComputed:Dh,localResetVirtualScroll:Uh,padVirtualScroll:cd,onVirtualScrollEvt:Tf,scrollTo:yf,setVirtualScrollSize:Af}=useVirtualScroll({virtualScrollLength:sh,getVirtualScrollTarget:hp,getVirtualScrollEl:Tm,virtualScrollItemSizeComputed:xh}),md=useFieldState(),vd=computed(()=>{const Ah=e.mapOptions===!0&&e.multiple!==!0,Jd=e.modelValue!==void 0&&(e.modelValue!==null||Ah===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const Od=e.mapOptions===!0&&nt!==void 0?nt:[],qf=Jd.map(mp=>Tp(mp,Od));return e.modelValue===null&&Ah===!0?qf.filter(mp=>mp!==null):qf}return Jd}),qd=computed(()=>{const Ah={};return fieldPropsList.forEach(Jd=>{const Od=e[Jd];Od!==void 0&&(Ah[Jd]=Od)}),Ah}),Ed=computed(()=>e.optionsDark===null?md.isDark.value:e.optionsDark),Td=computed(()=>fieldValueIsFilled(vd.value)),Fd=computed(()=>{let Ah="q-field__input q-placeholder col";return e.hideSelected===!0||vd.value.length===0?[Ah,e.inputClass]:(Ah+=" q-field__input--padding",e.inputClass===void 0?Ah:[Ah,e.inputClass])}),Cd=computed(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),Gd=computed(()=>sh.value===0),bf=computed(()=>vd.value.map(Ah=>ad.value(Ah)).join(", ")),Id=computed(()=>e.displayValue!==void 0?e.displayValue:bf.value),td=computed(()=>e.optionsHtml===!0?()=>!0:Ah=>Ah!=null&&Ah.html===!0),$d=computed(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||vd.value.some(td.value))),np=computed(()=>md.focused.value===!0?e.tabindex:-1),jf=computed(()=>{const Ah={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":l.value===!0?"true":"false","aria-controls":`${md.targetUid.value}_lb`};return o.value>=0&&(Ah["aria-activedescendant"]=`${md.targetUid.value}_${o.value}`),Ah}),yd=computed(()=>({id:`${md.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),Qd=computed(()=>vd.value.map((Ah,Jd)=>({index:Jd,opt:Ah,html:td.value(Ah),selected:!0,removeAtIndex:Df,toggleOption:Nf,tabindex:np.value}))),op=computed(()=>{if(sh.value===0)return[];const{from:Ah,to:Jd}=Mh.value;return e.options.slice(Ah,Jd).map((Od,qf)=>{const mp=Zd.value(Od)===!0,Vp=Ah+qf,om={clickable:!0,active:!1,activeClass:Qh.value,manualFocus:!0,focused:!1,disable:mp,tabindex:-1,dense:e.optionsDense,dark:Ed.value,role:"option",id:`${md.targetUid.value}_${Vp}`,onClick:()=>{Nf(Od)}};return mp!==!0&&(Yf(Od)===!0&&(om.active=!0),o.value===Vp&&(om.focused=!0),om["aria-selected"]=om.active===!0?"true":"false",s.platform.is.desktop===!0&&(om.onMousemove=()=>{l.value===!0&&Wf(Vp)})),{index:Vp,opt:Od,html:td.value(Od),label:ad.value(Od),selected:om.active,focused:om.focused,toggleOption:Nf,setOptionIndex:Wf,itemProps:om}})}),bp=computed(()=>e.dropdownIcon!==void 0?e.dropdownIcon:s.iconSet.arrow.dropdown),fp=computed(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Qh=computed(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),Yd=computed(()=>Pp(e.optionValue,"value")),ad=computed(()=>Pp(e.optionLabel,"label")),Zd=computed(()=>Pp(e.optionDisable,"disable")),Xh=computed(()=>vd.value.map(Ah=>Yd.value(Ah))),Ld=computed(()=>{const Ah={onInput:Dd,onChange:sl,onKeydown:nm,onKeyup:Xd,onKeypress:Op,onFocus:qp,onClick(Jd){_e===!0&&stop(Jd)}};return Ah.onCompositionstart=Ah.onCompositionupdate=Ah.onCompositionend=sl,Ah});watch(vd,Ah=>{nt=Ah,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&md.innerLoading.value!==!0&&(p.value!==!0&&l.value!==!0||Td.value!==!0)&&(Bt!==!0&&Fh(),(p.value===!0||l.value===!0)&&Jh(""))},{immediate:!0}),watch(()=>e.fillInput,Fh),watch(l,Ad),watch(sh,wd);function Kf(Ah){return e.emitValue===!0?Yd.value(Ah):Ah}function If(Ah){if(Ah>-1&&Ah<vd.value.length)if(e.multiple===!0){const Jd=e.modelValue.slice();n("remove",{index:Ah,value:Jd.splice(Ah,1)[0]}),n("update:modelValue",Jd)}else n("update:modelValue",null)}function Df(Ah){If(Ah),md.focus()}function Jf(Ah,Jd){const Od=Kf(Ah);if(e.multiple!==!0){e.fillInput===!0&&mh(ad.value(Ah),!0,!0),n("update:modelValue",Od);return}if(vd.value.length===0){n("add",{index:0,value:Od}),n("update:modelValue",e.multiple===!0?[Od]:Od);return}if(Jd===!0&&Yf(Ah)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const qf=e.modelValue.slice();n("add",{index:qf.length,value:Od}),qf.push(Od),n("update:modelValue",qf)}function Nf(Ah,Jd){if(md.editable.value!==!0||Ah===void 0||Zd.value(Ah)===!0)return;const Od=Yd.value(Ah);if(e.multiple!==!0){Jd!==!0&&(mh(e.fillInput===!0?ad.value(Ah):"",!0,!0),Ph()),Js.value!==null&&Js.value.focus(),(vd.value.length===0||isDeepEqual(Yd.value(vd.value[0]),Od)!==!0)&&n("update:modelValue",e.emitValue===!0?Od:Ah);return}if((_e!==!0||M.value===!0)&&md.focus(),qp(),vd.value.length===0){const Vp=e.emitValue===!0?Od:Ah;n("add",{index:0,value:Vp}),n("update:modelValue",e.multiple===!0?[Vp]:Vp);return}const qf=e.modelValue.slice(),mp=Xh.value.findIndex(Vp=>isDeepEqual(Vp,Od));if(mp>-1)n("remove",{index:mp,value:qf.splice(mp,1)[0]});else{if(e.maxValues!==void 0&&qf.length>=e.maxValues)return;const Vp=e.emitValue===!0?Od:Ah;n("add",{index:qf.length,value:Vp}),qf.push(Vp)}n("update:modelValue",qf)}function Wf(Ah){if(s.platform.is.desktop!==!0)return;const Jd=Ah>-1&&Ah<sh.value?Ah:-1;o.value!==Jd&&(o.value=Jd)}function Cp(Ah=1,Jd){if(l.value===!0){let Od=o.value;do Od=normalizeToInterval(Od+Ah,-1,sh.value-1);while(Od!==-1&&Od!==o.value&&Zd.value(e.options[Od])===!0);o.value!==Od&&(Wf(Od),yf(Od),Jd!==!0&&e.useInput===!0&&e.fillInput===!0&&Hf(Od>=0?ad.value(e.options[Od]):yr))}}function Tp(Ah,Jd){const Od=qf=>isDeepEqual(Yd.value(qf),Ah);return e.options.find(Od)||Jd.find(Od)||Ah}function Pp(Ah,Jd){const Od=Ah!==void 0?Ah:Jd;return typeof Od=="function"?Od:qf=>qf!==null&&typeof qf=="object"&&Od in qf?qf[Od]:qf}function Yf(Ah){const Jd=Yd.value(Ah);return Xh.value.find(Od=>isDeepEqual(Od,Jd))!==void 0}function qp(Ah){e.useInput===!0&&Js.value!==null&&(Ah===void 0||Js.value===Ah.target&&Ah.target.value===bf.value)&&Js.value.select()}function am(Ah){isKeyCode(Ah,27)===!0&&l.value===!0&&(stop(Ah),Ph(),Fh()),n("keyup",Ah)}function Xd(Ah){const{value:Jd}=Ah.target;if(Ah.keyCode!==void 0){am(Ah);return}if(Ah.target.value="",he!==null&&(clearTimeout(he),he=null),Fh(),typeof Jd=="string"&&Jd.length!==0){const Od=Jd.toLocaleLowerCase(),qf=Vp=>{const om=e.options.find(Pd=>Vp.value(Pd).toLocaleLowerCase()===Od);return om===void 0?!1:(vd.value.indexOf(om)===-1?Nf(om):Ph(),!0)},mp=Vp=>{qf(Yd)!==!0&&(qf(ad)===!0||Vp===!0||Jh(Jd,!0,()=>mp(!0)))};mp()}else md.clearValue(Ah)}function Op(Ah){n("keypress",Ah)}function nm(Ah){if(n("keydown",Ah),shouldIgnoreKey(Ah)===!0)return;const Jd=x.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),Od=Ah.shiftKey!==!0&&e.multiple!==!0&&(o.value>-1||Jd===!0);if(Ah.keyCode===27){prevent(Ah);return}if(Ah.keyCode===9&&Od===!1){dh();return}if(Ah.target===void 0||Ah.target.id!==md.targetUid.value)return;if(Ah.keyCode===40&&md.innerLoading.value!==!0&&l.value===!1){stopAndPrevent(Ah),yh();return}if(Ah.keyCode===8&&e.hideSelected!==!0&&x.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?If(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&n("update:modelValue",null);return}(Ah.keyCode===35||Ah.keyCode===36)&&(typeof x.value!="string"||x.value.length===0)&&(stopAndPrevent(Ah),o.value=-1,Cp(Ah.keyCode===36?1:-1,e.multiple)),(Ah.keyCode===33||Ah.keyCode===34)&&Dh.value!==void 0&&(stopAndPrevent(Ah),o.value=Math.max(-1,Math.min(sh.value,o.value+(Ah.keyCode===33?-1:1)*Dh.value.view)),Cp(Ah.keyCode===33?1:-1,e.multiple)),(Ah.keyCode===38||Ah.keyCode===40)&&(stopAndPrevent(Ah),Cp(Ah.keyCode===38?-1:1,e.multiple));const qf=sh.value;if((rl===void 0||Co<Date.now())&&(rl=""),qf>0&&e.useInput!==!0&&Ah.key!==void 0&&Ah.key.length===1&&Ah.altKey===!1&&Ah.ctrlKey===!1&&Ah.metaKey===!1&&(Ah.keyCode!==32||rl.length!==0)){l.value!==!0&&yh(Ah);const mp=Ah.key.toLocaleLowerCase(),Vp=rl.length===1&&rl[0]===mp;Co=Date.now()+1500,Vp===!1&&(stopAndPrevent(Ah),rl+=mp);const om=new RegExp("^"+rl.split("").map(Hg=>reEscapeList.indexOf(Hg)>-1?"\\"+Hg:Hg).join(".*"),"i");let Pd=o.value;if(Vp===!0||Pd<0||om.test(ad.value(e.options[Pd]))!==!0)do Pd=normalizeToInterval(Pd+1,-1,qf-1);while(Pd!==o.value&&(Zd.value(e.options[Pd])===!0||om.test(ad.value(e.options[Pd]))!==!0));o.value!==Pd&&nextTick(()=>{Wf(Pd),yf(Pd),Pd>=0&&e.useInput===!0&&e.fillInput===!0&&Hf(ad.value(e.options[Pd]))});return}if(!(Ah.keyCode!==13&&(Ah.keyCode!==32||e.useInput===!0||rl!=="")&&(Ah.keyCode!==9||Od===!1))){if(Ah.keyCode!==9&&stopAndPrevent(Ah),o.value>-1&&o.value<qf){Nf(e.options[o.value]);return}if(Jd===!0){const mp=(Vp,om)=>{if(om){if(validateNewValueMode(om)!==!0)return}else om=e.newValueMode;if(Vp==null)return;mh("",e.multiple!==!0,!0),(om==="toggle"?Nf:Jf)(Vp,om==="add-unique"),e.multiple!==!0&&(Js.value!==null&&Js.value.focus(),Ph())};if(e.onNewValue!==void 0?n("newValue",x.value,mp):mp(x.value),e.multiple!==!0)return}l.value===!0?dh():md.innerLoading.value!==!0&&yh()}}function Tm(){return _e===!0?Zu.value:lh.value!==null&&lh.value.contentEl!==null?lh.value.contentEl:void 0}function hp(){return Tm()}function Em(){return e.hideSelected===!0?[]:t["selected-item"]!==void 0?Qd.value.map(Ah=>t["selected-item"](Ah)).slice():t.selected!==void 0?[].concat(t.selected()):e.useChips===!0?Qd.value.map((Ah,Jd)=>h(QChip,{key:"option-"+Jd,removable:md.editable.value===!0&&Zd.value(Ah.opt)!==!0,dense:!0,textColor:e.color,tabindex:np.value,onRemove(){Ah.removeAtIndex(Jd)}},()=>h("span",{class:"ellipsis",[Ah.html===!0?"innerHTML":"textContent"]:ad.value(Ah.opt)}))):[h("span",{[$d.value===!0?"innerHTML":"textContent"]:Id.value})]}function Qp(){if(Gd.value===!0)return t["no-option"]!==void 0?t["no-option"]({inputValue:x.value}):void 0;const Ah=t.option!==void 0?t.option:Od=>h(QItem,{key:Od.index,...Od.itemProps},()=>h(QItemSection,()=>h(QItemLabel,()=>h("span",{[Od.html===!0?"innerHTML":"textContent"]:Od.label}))));let Jd=cd("div",op.value.map(Ah));return t["before-options"]!==void 0&&(Jd=t["before-options"]().concat(Jd)),hMergeSlot(t["after-options"],Jd)}function lm(Ah,Jd){const Od=Jd===!0?{...jf.value,...md.splitAttrs.attributes.value}:void 0,qf={ref:Jd===!0?Js:void 0,key:"i_t",class:Fd.value,style:e.inputStyle,value:x.value!==void 0?x.value:"",type:"search",...Od,id:Jd===!0?md.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":Ah===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Ld.value};return Ah!==!0&&_e===!0&&(Array.isArray(qf.class)===!0?qf.class=[...qf.class,"no-pointer-events"]:qf.class+=" no-pointer-events"),h("input",qf)}function Dd(Ah){he!==null&&(clearTimeout(he),he=null),!(Ah&&Ah.target&&Ah.target.qComposing===!0)&&(Hf(Ah.target.value||""),Bt=!0,yr=x.value,md.focused.value!==!0&&(_e!==!0||M.value===!0)&&md.focus(),e.onFilter!==void 0&&(he=setTimeout(()=>{he=null,Jh(x.value)},e.inputDebounce)))}function Hf(Ah){x.value!==Ah&&(x.value=Ah,n("inputValue",Ah))}function mh(Ah,Jd,Od){Bt=Od!==!0,e.useInput===!0&&(Hf(Ah),(Jd===!0||Od!==!0)&&(yr=Ah),Jd!==!0&&Jh(Ah))}function Jh(Ah,Jd,Od){if(e.onFilter===void 0||Jd!==!0&&md.focused.value!==!0)return;md.innerLoading.value===!0?n("filterAbort"):(md.innerLoading.value=!0,P.value=!0),Ah!==""&&e.multiple!==!0&&vd.value.length!==0&&Bt!==!0&&Ah===ad.value(vd.value[0])&&(Ah="");const qf=setTimeout(()=>{l.value===!0&&(l.value=!1)},10);Fn!==null&&clearTimeout(Fn),Fn=qf,n("filter",Ah,(mp,Vp)=>{(Jd===!0||md.focused.value===!0)&&Fn===qf&&(clearTimeout(Fn),typeof mp=="function"&&mp(),P.value=!1,nextTick(()=>{md.innerLoading.value=!1,md.editable.value===!0&&(Jd===!0?l.value===!0&&Ph():l.value===!0?Ad(!0):l.value=!0),typeof Vp=="function"&&nextTick(()=>{Vp(r)}),typeof Od=="function"&&nextTick(()=>{Od(r)})}))},()=>{md.focused.value===!0&&Fn===qf&&(clearTimeout(Fn),md.innerLoading.value=!1,P.value=!1),l.value===!0&&(l.value=!1)})}function Wu(){return h(QMenu,{ref:lh,class:Cd.value,style:e.popupContentStyle,modelValue:l.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&Gd.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:Ed.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:fp.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...yd.value,onScrollPassive:Tf,onBeforeShow:xf,onBeforeHide:al,onShow:Xr},Qp)}function al(Ah){Ff(Ah),dh()}function Xr(){Af()}function mr(Ah){stop(Ah),Js.value!==null&&Js.value.focus(),M.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function cs(Ah){stop(Ah),nextTick(()=>{M.value=!1})}function $u(){const Ah=[h(QField,{class:`col-auto ${md.fieldClass.value}`,...qd.value,for:md.targetUid.value,dark:Ed.value,square:!0,loading:P.value,itemAligned:!1,filled:!0,stackLabel:x.value.length!==0,...md.splitAttrs.listeners.value,onFocus:mr,onBlur:cs},{...t,rawControl:()=>md.getControl(!0),before:void 0,after:void 0})];return l.value===!0&&Ah.push(h("div",{ref:Zu,class:Cd.value+" scroll",style:e.popupContentStyle,...yd.value,onClick:prevent,onScrollPassive:Tf},Qp())),h(QDialog,{ref:ch,modelValue:p.value,position:e.useInput===!0?"top":void 0,transitionShow:Io,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:xf,onBeforeHide:eh,onHide:rh,onShow:uh},()=>h("div",{class:"q-select__dialog"+(Ed.value===!0?" q-select__dialog--dark q-dark":"")+(M.value===!0?" q-select__dialog--focused":"")},Ah))}function eh(Ah){Ff(Ah),ch.value!==null&&ch.value.__updateRefocusTarget(md.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),md.focused.value=!1}function rh(Ah){Ph(),md.focused.value===!1&&n("blur",Ah),Fh()}function uh(){const Ah=document.activeElement;(Ah===null||Ah.id!==md.targetUid.value)&&Js.value!==null&&Js.value!==Ah&&Js.value.focus(),Af()}function dh(){p.value!==!0&&(o.value=-1,l.value===!0&&(l.value=!1),md.focused.value===!1&&(Fn!==null&&(clearTimeout(Fn),Fn=null),md.innerLoading.value===!0&&(n("filterAbort"),md.innerLoading.value=!1,P.value=!1)))}function yh(Ah){md.editable.value===!0&&(_e===!0?(md.onControlFocusin(Ah),p.value=!0,nextTick(()=>{md.focus()})):md.focus(),e.onFilter!==void 0?Jh(x.value):(Gd.value!==!0||t["no-option"]!==void 0)&&(l.value=!0))}function Ph(){p.value=!1,dh()}function Fh(){e.useInput===!0&&mh(e.multiple!==!0&&e.fillInput===!0&&vd.value.length!==0&&ad.value(vd.value[0])||"",!0,!0)}function Ad(Ah){let Jd=-1;if(Ah===!0){if(vd.value.length!==0){const Od=Yd.value(vd.value[0]);Jd=e.options.findIndex(qf=>isDeepEqual(Yd.value(qf),Od))}Uh(Jd)}Wf(Jd)}function wd(Ah,Jd){l.value===!0&&md.innerLoading.value===!1&&(Uh(-1,!0),nextTick(()=>{l.value===!0&&md.innerLoading.value===!1&&(Ah>Jd?Uh():Ad(!0))}))}function Kd(){p.value===!1&&lh.value!==null&&lh.value.updatePosition()}function xf(Ah){Ah!==void 0&&stop(Ah),n("popupShow",Ah),md.hasPopupOpen=!0,md.onControlFocusin(Ah)}function Ff(Ah){Ah!==void 0&&stop(Ah),n("popupHide",Ah),md.hasPopupOpen=!1,md.onControlFocusout(Ah)}function rp(){_e=s.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?t["no-option"]!==void 0||e.onFilter!==void 0||Gd.value===!1:!0),Io=s.platform.is.ios===!0&&_e===!0&&e.useInput===!0?"fade":e.transitionShow}return onBeforeUpdate(rp),onUpdated(Kd),rp(),onBeforeUnmount(()=>{he!==null&&clearTimeout(he)}),Object.assign(r,{showPopup:yh,hidePopup:Ph,removeAtIndex:If,add:Jf,toggleOption:Nf,getOptionIndex:()=>o.value,setOptionIndex:Wf,moveOptionSelection:Cp,filter:Jh,updateMenuPosition:Kd,updateInputValue:mh,isOptionSelected:Yf,getEmittingOptionValue:Kf,isOptionDisabled:(...Ah)=>Zd.value.apply(null,Ah)===!0,getOptionValue:(...Ah)=>Yd.value.apply(null,Ah),getOptionLabel:(...Ah)=>ad.value.apply(null,Ah)}),Object.assign(md,{innerValue:vd,fieldClass:computed(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:as,targetRef:Js,hasValue:Td,showPopup:yh,floatingLabel:computed(()=>e.hideSelected!==!0&&Td.value===!0||typeof x.value=="number"||x.value.length!==0||fieldValueIsFilled(e.displayValue)),getControlChild:()=>{if(md.editable.value!==!1&&(p.value===!0||Gd.value!==!0||t["no-option"]!==void 0))return _e===!0?$u():Wu();md.hasPopupOpen===!0&&(md.hasPopupOpen=!1)},controlEvents:{onFocusin(Ah){md.onControlFocusin(Ah)},onFocusout(Ah){md.onControlFocusout(Ah,()=>{Fh(),dh()})},onClick(Ah){if(prevent(Ah),_e!==!0&&l.value===!0){dh(),Js.value!==null&&Js.value.focus();return}yh(Ah)}},getControl:Ah=>{const Jd=Em(),Od=Ah===!0||p.value!==!0||_e!==!0;if(e.useInput===!0)Jd.push(lm(Ah,Od));else if(md.editable.value===!0){const mp=Od===!0?jf.value:void 0;Jd.push(h("input",{ref:Od===!0?Js:void 0,key:"d_t",class:"q-select__focus-target",id:Od===!0?md.targetUid.value:void 0,value:Id.value,readonly:!0,"data-autofocus":Ah===!0||e.autofocus===!0||void 0,...mp,onKeydown:nm,onKeyup:am,onKeypress:Op})),Od===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&Jd.push(h("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:Xd}))}if(th.value!==void 0&&e.disable!==!0&&Xh.value.length!==0){const mp=Xh.value.map(Vp=>h("option",{value:Vp,selected:!0}));Jd.push(h("select",{class:"hidden",name:th.value,multiple:e.multiple},mp))}const qf=e.useInput===!0||Od!==!0?void 0:md.splitAttrs.attributes.value;return h("div",{class:"q-field__native row items-center",...qf,...md.splitAttrs.listeners.value},Jd)},getInnerAppend:()=>e.loading!==!0&&P.value!==!0&&e.hideDropdownIcon!==!0?[h(QIcon,{class:"q-select__dropdown-icon"+(l.value===!0?" rotate-180":""),name:bp.value})]:null}),useField(md)}}),QTd=createComponent({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const n=getCurrentInstance(),r=computed(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return h("td",{class:r.value},hSlot(t.default));const s=n.vnode.key,l=(e.props.colsMap!==void 0?e.props.colsMap[s]:null)||e.props.col;if(l===void 0)return;const{row:p}=e.props;return h("td",{class:r.value+l.__tdClass(p),style:l.__tdStyle(p)},hSlot(t.default))}}});function cloneDeep(e,t=new WeakMap){if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const r=e.valueOf();if(Object(r)!==r){const s=new e.constructor(r);return t.set(e,s),s}}return t.set(e,n),e instanceof Set?e.forEach(r=>{n.add(cloneDeep(r,t))}):e instanceof Map&&e.forEach((r,s)=>{n.set(s,cloneDeep(r,t))}),Object.assign(n,...Object.keys(e).map(r=>({[r]:cloneDeep(e[r],t)})))}const QPopupEdit=createComponent({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:n}){const{proxy:r}=getCurrentInstance(),{$q:s}=r,l=ref(null),p=ref(""),o=ref("");let x=!1;const M=computed(()=>injectProp({initialValue:p.value,validate:e.validate,set:P,cancel:he,updatePosition:nt},"value",()=>o.value,as=>{o.value=as}));function P(){e.validate(o.value)!==!1&&(_e()===!0&&(n("save",o.value,p.value),n("update:modelValue",o.value)),Bt())}function he(){_e()===!0&&n("cancel",o.value,p.value),Bt()}function nt(){nextTick(()=>{l.value.updatePosition()})}function _e(){return isDeepEqual(o.value,p.value)===!1}function Bt(){x=!0,l.value.hide()}function Fn(){x=!1,p.value=cloneDeep(e.modelValue),o.value=cloneDeep(e.modelValue),n("beforeShow")}function yr(){n("show")}function Io(){x===!1&&_e()===!0&&(e.autoSave===!0&&e.validate(o.value)===!0?(n("save",o.value,p.value),n("update:modelValue",o.value)):n("cancel",o.value,p.value)),n("beforeHide")}function rl(){n("hide")}function Co(){const as=t.default!==void 0?[].concat(t.default(M.value)):[];return e.title&&as.unshift(h("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&as.push(h("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[h(QBtn,{flat:!0,color:e.color,label:e.labelCancel||s.lang.label.cancel,onClick:he}),h(QBtn,{flat:!0,color:e.color,label:e.labelSet||s.lang.label.set,onClick:P})])),as}return Object.assign(r,{set:P,cancel:he,show(as){l.value!==null&&l.value.show(as)},hide(as){l.value!==null&&l.value.hide(as)},updatePosition:nt}),()=>{if(e.disable!==!0)return h(QMenu,{ref:l,class:"q-popup-edit",cover:e.cover,onBeforeShow:Fn,onShow:yr,onBeforeHide:Io,onHide:rl,onEscapeKey:he},Co)}}}),QTr=createComponent({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const n=computed(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>h("tr",{class:n.value},hSlot(t.default))}}),QTh=createComponent({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:n}){const r=getCurrentInstance(),{proxy:{$q:s}}=r,l=p=>{n("click",p)};return()=>{if(e.props===void 0)return h("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:l},hSlot(t.default));let p,o;const x=r.vnode.key;if(x){if(p=e.props.colsMap[x],p===void 0)return}else p=e.props.col;if(p.sortable===!0){const P=p.align==="right"?"unshift":"push";o=hUniqueSlot(t.default,[]),o[P](h(QIcon,{class:p.__iconClass,name:s.iconSet.table.arrowUp}))}else o=hSlot(t.default);const M={class:p.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:p.headerStyle,onClick:P=>{p.sortable===!0&&e.props.sort(p),l(P)}};return h("th",M,o)}}}),QList=createComponent({name:"QList",props:{...useDarkProps,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:t}){const n=getCurrentInstance(),r=useDark(e,n.proxy.$q),s=computed(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(r.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>h(e.tag,{class:s.value},hSlot(t.default))}}),separatorValues=["horizontal","vertical","cell","none"],QMarkupTable=createComponent({name:"QMarkupTable",props:{...useDarkProps,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>separatorValues.includes(e)}},setup(e,{slots:t}){const n=getCurrentInstance(),r=useDark(e,n.proxy.$q),s=computed(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(r.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>h("div",{class:s.value},[h("table",{class:"q-table"},hSlot(t.default))])}});function getTableMiddle(e,t){return h("div",e,[h("table",{class:"q-table"},t)])}const comps={list:QList,table:QMarkupTable},typeOptions=["list","table","__qtable"],QVirtualScroll=createComponent({name:"QVirtualScroll",props:{...useVirtualScrollProps,type:{type:String,default:"list",validator:e=>typeOptions.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:n}){let r;const s=ref(null),l=computed(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:p,localResetVirtualScroll:o,padVirtualScroll:x,onVirtualScrollEvt:M}=useVirtualScroll({virtualScrollLength:l,getVirtualScrollTarget:Bt,getVirtualScrollEl:_e}),P=computed(()=>{if(l.value===0)return[];const rl=(Co,as)=>({index:p.value.from+as,item:Co});return e.itemsFn===void 0?e.items.slice(p.value.from,p.value.to).map(rl):e.itemsFn(p.value.from,p.value.to-p.value.from).map(rl)}),he=computed(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),nt=computed(()=>e.scrollTarget!==void 0?{}:{tabindex:0});watch(l,()=>{o()}),watch(()=>e.scrollTarget,()=>{yr(),Fn()});function _e(){return s.value.$el||s.value}function Bt(){return r}function Fn(){r=getScrollTarget(_e(),e.scrollTarget),r.addEventListener("scroll",M,listenOpts.passive)}function yr(){r!==void 0&&(r.removeEventListener("scroll",M,listenOpts.passive),r=void 0)}function Io(){let rl=x(e.type==="list"?"div":"tbody",P.value.map(t.default));return t.before!==void 0&&(rl=t.before().concat(rl)),hMergeSlot(t.after,rl)}return onBeforeMount(()=>{o()}),onMounted(()=>{Fn()}),onActivated(()=>{Fn()}),onDeactivated(()=>{yr()}),onBeforeUnmount(()=>{yr()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?getTableMiddle({ref:s,class:"q-table__middle "+he.value},Io()):h(comps[e.type],{...n,ref:s,class:[n.class,he.value],...nt.value},Io)}}}),defaultSizes={xs:2,sm:4,md:6,lg:10,xl:14};function width(e,t,n){return{transform:t===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const QLinearProgress=createComponent({name:"QLinearProgress",props:{...useDarkProps,...useSizeProps,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:n}=getCurrentInstance(),r=useDark(e,n.$q),s=useSize(e,defaultSizes),l=computed(()=>e.indeterminate===!0||e.query===!0),p=computed(()=>e.reverse!==e.query),o=computed(()=>({...s.value!==null?s.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),x=computed(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),M=computed(()=>width(e.buffer!==void 0?e.buffer:1,p.value,n.$q)),P=computed(()=>`with${e.instantFeedback===!0?"out":""}-transition`),he=computed(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${P.value} q-linear-progress__track--${r.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),nt=computed(()=>width(l.value===!0?1:e.value,p.value,n.$q)),_e=computed(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${P.value} q-linear-progress__model--${l.value===!0?"in":""}determinate`),Bt=computed(()=>({width:`${e.value*100}%`})),Fn=computed(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${P.value}`);return()=>{const yr=[h("div",{class:he.value,style:M.value}),h("div",{class:_e.value,style:nt.value})];return e.stripe===!0&&l.value===!1&&yr.push(h("div",{class:Fn.value,style:Bt.value})),h("div",{class:x.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},hMergeSlot(t.default,yr))}}});let counter=0;const useFullscreenProps={fullscreen:Boolean,noRouteFullscreenExit:Boolean},useFullscreenEmits=["update:fullscreen","fullscreen"];function useFullscreen(){const e=getCurrentInstance(),{props:t,emit:n,proxy:r}=e;let s,l,p;const o=ref(!1);vmHasRouter(e)===!0&&watch(()=>r.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&P()}),watch(()=>t.fullscreen,he=>{o.value!==he&&x()}),watch(o,he=>{n("update:fullscreen",he),n("fullscreen",he)});function x(){o.value===!0?P():M()}function M(){o.value!==!0&&(o.value=!0,p=r.$el.parentNode,p.replaceChild(l,r.$el),document.body.appendChild(r.$el),counter++,counter===1&&document.body.classList.add("q-body--fullscreen-mixin"),s={handler:P},History.add(s))}function P(){o.value===!0&&(s!==void 0&&(History.remove(s),s=void 0),p.replaceChild(r.$el,l),o.value=!1,counter=Math.max(0,counter-1),counter===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),r.$el.scrollIntoView!==void 0&&setTimeout(()=>{r.$el.scrollIntoView()})))}return onBeforeMount(()=>{l=document.createElement("span")}),onMounted(()=>{t.fullscreen===!0&&M()}),onBeforeUnmount(P),Object.assign(r,{toggleFullscreen:x,setFullscreen:M,exitFullscreen:P}),{inFullscreen:o,toggleFullscreen:x}}function sortDate(e,t){return new Date(e)-new Date(t)}const useTableSortProps={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function useTableSort(e,t,n,r){const s=computed(()=>{const{sortBy:o}=t.value;return o&&n.value.find(x=>x.name===o)||null}),l=computed(()=>e.sortMethod!==void 0?e.sortMethod:(o,x,M)=>{const P=n.value.find(_e=>_e.name===x);if(P===void 0||P.field===void 0)return o;const he=M===!0?-1:1,nt=typeof P.field=="function"?_e=>P.field(_e):_e=>_e[P.field];return o.sort((_e,Bt)=>{let Fn=nt(_e),yr=nt(Bt);return Fn==null?-1*he:yr==null?1*he:P.sort!==void 0?P.sort(Fn,yr,_e,Bt)*he:isNumber$1(Fn)===!0&&isNumber$1(yr)===!0?(Fn-yr)*he:isDate(Fn)===!0&&isDate(yr)===!0?sortDate(Fn,yr)*he:typeof Fn=="boolean"&&typeof yr=="boolean"?(Fn-yr)*he:([Fn,yr]=[Fn,yr].map(Io=>(Io+"").toLocaleString().toLowerCase()),Fn<yr?-1*he:Fn===yr?0:he)})});function p(o){let x=e.columnSortOrder;if(isObject$1(o)===!0)o.sortOrder&&(x=o.sortOrder),o=o.name;else{const he=n.value.find(nt=>nt.name===o);he!==void 0&&he.sortOrder&&(x=he.sortOrder)}let{sortBy:M,descending:P}=t.value;M!==o?(M=o,P=x==="da"):e.binaryStateSort===!0?P=!P:P===!0?x==="ad"?M=null:P=!1:x==="ad"?P=!0:M=null,r({sortBy:M,descending:P,page:1})}return{columnToSort:s,computedSortMethod:l,sort:p}}const useTableFilterProps={filter:[String,Object],filterMethod:Function};function useTableFilter(e,t){const n=computed(()=>e.filterMethod!==void 0?e.filterMethod:(r,s,l,p)=>{const o=s?s.toLowerCase():"";return r.filter(x=>l.some(M=>{const P=p(M,x)+"";return(P==="undefined"||P==="null"?"":P.toLowerCase()).indexOf(o)!==-1}))});return watch(()=>e.filter,()=>{nextTick(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:n}}function samePagination(e,t){for(const n in t)if(t[n]!==e[n])return!1;return!0}function fixPagination(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const useTablePaginationProps={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function useTablePaginationState(e,t){const{props:n,emit:r}=e,s=ref(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:n.rowsPerPageOptions.length!==0?n.rowsPerPageOptions[0]:5},n.pagination)),l=computed(()=>{const P=n["onUpdate:pagination"]!==void 0?{...s.value,...n.pagination}:s.value;return fixPagination(P)}),p=computed(()=>l.value.rowsNumber!==void 0);function o(P){x({pagination:P,filter:n.filter})}function x(P={}){nextTick(()=>{r("request",{pagination:P.pagination||l.value,filter:P.filter||n.filter,getCellValue:t})})}function M(P,he){const nt=fixPagination({...l.value,...P});if(samePagination(l.value,nt)===!0){p.value===!0&&he===!0&&o(nt);return}if(p.value===!0){o(nt);return}n.pagination!==void 0&&n["onUpdate:pagination"]!==void 0?r("update:pagination",nt):s.value=nt}return{innerPagination:s,computedPagination:l,isServerSide:p,requestServerInteraction:x,setPagination:M}}function useTablePagination(e,t,n,r,s,l){const{props:p,emit:o,proxy:{$q:x}}=e,M=computed(()=>r.value===!0?n.value.rowsNumber||0:l.value),P=computed(()=>{const{page:as,rowsPerPage:Js}=n.value;return(as-1)*Js}),he=computed(()=>{const{page:as,rowsPerPage:Js}=n.value;return as*Js}),nt=computed(()=>n.value.page===1),_e=computed(()=>n.value.rowsPerPage===0?1:Math.max(1,Math.ceil(M.value/n.value.rowsPerPage))),Bt=computed(()=>he.value===0?!0:n.value.page>=_e.value),Fn=computed(()=>(p.rowsPerPageOptions.includes(t.value.rowsPerPage)?p.rowsPerPageOptions:[t.value.rowsPerPage].concat(p.rowsPerPageOptions)).map(Js=>({label:Js===0?x.lang.table.allRows:""+Js,value:Js})));watch(_e,(as,Js)=>{if(as===Js)return;const lh=n.value.page;as&&!lh?s({page:1}):as<lh&&s({page:as})});function yr(){s({page:1})}function Io(){const{page:as}=n.value;as>1&&s({page:as-1})}function rl(){const{page:as,rowsPerPage:Js}=n.value;he.value>0&&as*Js<M.value&&s({page:as+1})}function Co(){s({page:_e.value})}return p["onUpdate:pagination"]!==void 0&&o("update:pagination",{...n.value}),{firstRowIndex:P,lastRowIndex:he,isFirstPage:nt,isLastPage:Bt,pagesNumber:_e,computedRowsPerPageOptions:Fn,computedRowsNumber:M,firstPage:yr,prevPage:Io,nextPage:rl,lastPage:Co}}const useTableRowSelectionProps={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},useTableRowSelectionEmits=["update:selected","selection"];function useTableRowSelection(e,t,n,r){const s=computed(()=>{const Bt={};return e.selected.map(r.value).forEach(Fn=>{Bt[Fn]=!0}),Bt}),l=computed(()=>e.selection!=="none"),p=computed(()=>e.selection==="single"),o=computed(()=>e.selection==="multiple"),x=computed(()=>n.value.length!==0&&n.value.every(Bt=>s.value[r.value(Bt)]===!0)),M=computed(()=>x.value!==!0&&n.value.some(Bt=>s.value[r.value(Bt)]===!0)),P=computed(()=>e.selected.length);function he(Bt){return s.value[Bt]===!0}function nt(){t("update:selected",[])}function _e(Bt,Fn,yr,Io){t("selection",{rows:Fn,added:yr,keys:Bt,evt:Io});const rl=p.value===!0?yr===!0?Fn:[]:yr===!0?e.selected.concat(Fn):e.selected.filter(Co=>Bt.includes(r.value(Co))===!1);t("update:selected",rl)}return{hasSelectionMode:l,singleSelection:p,multipleSelection:o,allRowsSelected:x,someRowsSelected:M,rowsSelectedNumber:P,isRowSelected:he,clearSelection:nt,updateSelection:_e}}function getVal(e){return Array.isArray(e)?e.slice():[]}const useTableRowExpandProps={expanded:Array},useTableRowExpandEmits=["update:expanded"];function useTableRowExpand(e,t){const n=ref(getVal(e.expanded));watch(()=>e.expanded,p=>{n.value=getVal(p)});function r(p){return n.value.includes(p)}function s(p){e.expanded!==void 0?t("update:expanded",p):n.value=p}function l(p,o){const x=n.value.slice(),M=x.indexOf(p);o===!0?M===-1&&(x.push(p),s(x)):M!==-1&&(x.splice(M,1),s(x))}return{isRowExpanded:r,setExpanded:s,updateExpanded:l}}const useTableColumnSelectionProps={visibleColumns:Array};function useTableColumnSelection(e,t,n){const r=computed(()=>{if(e.columns!==void 0)return e.columns;const o=e.rows[0];return o!==void 0?Object.keys(o).map(x=>({name:x,label:x.toUpperCase(),field:x,align:isNumber$1(o[x])?"right":"left",sortable:!0})):[]}),s=computed(()=>{const{sortBy:o,descending:x}=t.value;return(e.visibleColumns!==void 0?r.value.filter(P=>P.required===!0||e.visibleColumns.includes(P.name)===!0):r.value).map(P=>{const he=P.align||"right",nt=`text-${he}`;return{...P,align:he,__iconClass:`q-table__sort-icon q-table__sort-icon--${he}`,__thClass:nt+(P.headerClasses!==void 0?" "+P.headerClasses:"")+(P.sortable===!0?" sortable":"")+(P.name===o?` sorted ${x===!0?"sort-desc":""}`:""),__tdStyle:P.style!==void 0?typeof P.style!="function"?()=>P.style:P.style:()=>null,__tdClass:P.classes!==void 0?typeof P.classes!="function"?()=>nt+" "+P.classes:_e=>nt+" "+P.classes(_e):()=>nt}})}),l=computed(()=>{const o={};return s.value.forEach(x=>{o[x.name]=x}),o}),p=computed(()=>e.tableColspan!==void 0?e.tableColspan:s.value.length+(n.value===!0?1:0));return{colList:r,computedCols:s,computedColsMap:l,computedColspan:p}}const bottomClass="q-table__bottom row items-center",commonVirtPropsObj={};commonVirtPropsList.forEach(e=>{commonVirtPropsObj[e]={}});const QTable=createComponent({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...commonVirtPropsObj,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...useDarkProps,...useFullscreenProps,...useTableColumnSelectionProps,...useTableFilterProps,...useTablePaginationProps,...useTableRowExpandProps,...useTableRowSelectionProps,...useTableSortProps},emits:["request","virtualScroll",...useFullscreenEmits,...useTableRowExpandEmits,...useTableRowSelectionEmits],setup(e,{slots:t,emit:n}){const r=getCurrentInstance(),{proxy:{$q:s}}=r,l=useDark(e,s),{inFullscreen:p,toggleFullscreen:o}=useFullscreen(),x=computed(()=>typeof e.rowKey=="function"?e.rowKey:Dd=>Dd[e.rowKey]),M=ref(null),P=ref(null),he=computed(()=>e.grid!==!0&&e.virtualScroll===!0),nt=computed(()=>" q-table__card"+(l.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),_e=computed(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":nt.value)+(l.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(p.value===!0?" fullscreen scroll":"")),Bt=computed(()=>_e.value+(e.loading===!0?" q-table--loading":""));watch(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+_e.value,()=>{he.value===!0&&P.value!==null&&P.value.reset()});const{innerPagination:Fn,computedPagination:yr,isServerSide:Io,requestServerInteraction:rl,setPagination:Co}=useTablePaginationState(r,Cp),{computedFilterMethod:as}=useTableFilter(e,Co),{isRowExpanded:Js,setExpanded:lh,updateExpanded:ch}=useTableRowExpand(e,n),Zu=computed(()=>{let Dd=e.rows;if(Io.value===!0||Dd.length===0)return Dd;const{sortBy:Hf,descending:mh}=yr.value;return e.filter&&(Dd=as.value(Dd,e.filter,vd.value,Cp)),Td.value!==null&&(Dd=Fd.value(e.rows===Dd?Dd.slice():Dd,Hf,mh)),Dd}),th=computed(()=>Zu.value.length),sl=computed(()=>{let Dd=Zu.value;if(Io.value===!0)return Dd;const{rowsPerPage:Hf}=yr.value;return Hf!==0&&(Gd.value===0&&e.rows!==Dd?Dd.length>bf.value&&(Dd=Dd.slice(0,bf.value)):Dd=Dd.slice(Gd.value,bf.value)),Dd}),{hasSelectionMode:sh,singleSelection:xh,multipleSelection:Mh,allRowsSelected:Dh,someRowsSelected:Uh,rowsSelectedNumber:cd,isRowSelected:Tf,clearSelection:yf,updateSelection:Af}=useTableRowSelection(e,n,sl,x),{colList:md,computedCols:vd,computedColsMap:qd,computedColspan:Ed}=useTableColumnSelection(e,yr,sh),{columnToSort:Td,computedSortMethod:Fd,sort:Cd}=useTableSort(e,yr,md,Co),{firstRowIndex:Gd,lastRowIndex:bf,isFirstPage:Id,isLastPage:td,pagesNumber:$d,computedRowsPerPageOptions:np,computedRowsNumber:jf,firstPage:yd,prevPage:Qd,nextPage:op,lastPage:bp}=useTablePagination(r,Fn,yr,Io,Co,th),fp=computed(()=>sl.value.length===0),Qh=computed(()=>{const Dd={};return commonVirtPropsList.forEach(Hf=>{Dd[Hf]=e[Hf]}),Dd.virtualScrollItemSize===void 0&&(Dd.virtualScrollItemSize=e.dense===!0?28:48),Dd});function Yd(){he.value===!0&&P.value.reset()}function ad(){if(e.grid===!0)return lm();const Dd=e.hideHeader!==!0?qp:null;if(he.value===!0){const mh=t["top-row"],Jh=t["bottom-row"],Wu={default:al=>Kf(al.item,t.body,al.index)};if(mh!==void 0){const al=h("tbody",mh({cols:vd.value}));Wu.before=Dd===null?()=>al:()=>[Dd()].concat(al)}else Dd!==null&&(Wu.before=Dd);return Jh!==void 0&&(Wu.after=()=>h("tbody",Jh({cols:vd.value}))),h(QVirtualScroll,{ref:P,class:e.tableClass,style:e.tableStyle,...Qh.value,scrollTarget:e.virtualScrollTarget,items:sl.value,type:"__qtable",tableColspan:Ed.value,onVirtualScroll:Xh},Wu)}const Hf=[If()];return Dd!==null&&Hf.unshift(Dd()),getTableMiddle({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},Hf)}function Zd(Dd,Hf){if(P.value!==null){P.value.scrollTo(Dd,Hf);return}Dd=parseInt(Dd,10);const mh=M.value.querySelector(`tbody tr:nth-of-type(${Dd+1})`);if(mh!==null){const Jh=M.value.querySelector(".q-table__middle.scroll"),Wu=mh.offsetTop-e.virtualScrollStickySizeStart,al=Wu<Jh.scrollTop?"decrease":"increase";Jh.scrollTop=Wu,n("virtualScroll",{index:Dd,from:0,to:Fn.value.rowsPerPage-1,direction:al})}}function Xh(Dd){n("virtualScroll",Dd)}function Ld(){return[h(QLinearProgress,{class:"q-table__linear-progress",color:e.color,dark:l.value,indeterminate:!0,trackColor:"transparent"})]}function Kf(Dd,Hf,mh){const Jh=x.value(Dd),Wu=Tf(Jh);if(Hf!==void 0)return Hf(Df({key:Jh,row:Dd,pageIndex:mh,__trClass:Wu?"selected":""}));const al=t["body-cell"],Xr=vd.value.map(cs=>{const $u=t[`body-cell-${cs.name}`],eh=$u!==void 0?$u:al;return eh!==void 0?eh(Jf({key:Jh,row:Dd,pageIndex:mh,col:cs})):h("td",{class:cs.__tdClass(Dd),style:cs.__tdStyle(Dd)},Cp(cs,Dd))});if(sh.value===!0){const cs=t["body-selection"],$u=cs!==void 0?cs(Nf({key:Jh,row:Dd,pageIndex:mh})):[h(QCheckbox,{modelValue:Wu,color:e.color,dark:l.value,dense:e.dense,"onUpdate:modelValue":(eh,rh)=>{Af([Jh],[Dd],eh,rh)}})];Xr.unshift(h("td",{class:"q-table--col-auto-width"},$u))}const mr={key:Jh,class:{selected:Wu}};return e.onRowClick!==void 0&&(mr.class["cursor-pointer"]=!0,mr.onClick=cs=>{n("RowClick",cs,Dd,mh)}),e.onRowDblclick!==void 0&&(mr.class["cursor-pointer"]=!0,mr.onDblclick=cs=>{n("RowDblclick",cs,Dd,mh)}),e.onRowContextmenu!==void 0&&(mr.class["cursor-pointer"]=!0,mr.onContextmenu=cs=>{n("RowContextmenu",cs,Dd,mh)}),h("tr",mr,Xr)}function If(){const Dd=t.body,Hf=t["top-row"],mh=t["bottom-row"];let Jh=sl.value.map((Wu,al)=>Kf(Wu,Dd,al));return Hf!==void 0&&(Jh=Hf({cols:vd.value}).concat(Jh)),mh!==void 0&&(Jh=Jh.concat(mh({cols:vd.value}))),h("tbody",Jh)}function Df(Dd){return Wf(Dd),Dd.cols=Dd.cols.map(Hf=>injectProp({...Hf},"value",()=>Cp(Hf,Dd.row))),Dd}function Jf(Dd){return Wf(Dd),injectProp(Dd,"value",()=>Cp(Dd.col,Dd.row)),Dd}function Nf(Dd){return Wf(Dd),Dd}function Wf(Dd){Object.assign(Dd,{cols:vd.value,colsMap:qd.value,sort:Cd,rowIndex:Gd.value+Dd.pageIndex,color:e.color,dark:l.value,dense:e.dense}),sh.value===!0&&injectProp(Dd,"selected",()=>Tf(Dd.key),(Hf,mh)=>{Af([Dd.key],[Dd.row],Hf,mh)}),injectProp(Dd,"expand",()=>Js(Dd.key),Hf=>{ch(Dd.key,Hf)})}function Cp(Dd,Hf){const mh=typeof Dd.field=="function"?Dd.field(Hf):Hf[Dd.field];return Dd.format!==void 0?Dd.format(mh,Hf):mh}const Tp=computed(()=>({pagination:yr.value,pagesNumber:$d.value,isFirstPage:Id.value,isLastPage:td.value,firstPage:yd,prevPage:Qd,nextPage:op,lastPage:bp,inFullscreen:p.value,toggleFullscreen:o}));function Pp(){const Dd=t.top,Hf=t["top-left"],mh=t["top-right"],Jh=t["top-selection"],Wu=sh.value===!0&&Jh!==void 0&&cd.value>0,al="q-table__top relative-position row items-center";if(Dd!==void 0)return h("div",{class:al},[Dd(Tp.value)]);let Xr;if(Wu===!0?Xr=Jh(Tp.value).slice():(Xr=[],Hf!==void 0?Xr.push(h("div",{class:"q-table__control"},[Hf(Tp.value)])):e.title&&Xr.push(h("div",{class:"q-table__control"},[h("div",{class:["q-table__title",e.titleClass]},e.title)]))),mh!==void 0&&(Xr.push(h("div",{class:"q-table__separator col"})),Xr.push(h("div",{class:"q-table__control"},[mh(Tp.value)]))),Xr.length!==0)return h("div",{class:al},Xr)}const Yf=computed(()=>Uh.value===!0?null:Dh.value);function qp(){const Dd=am();return e.loading===!0&&t.loading===void 0&&Dd.push(h("tr",{class:"q-table__progress"},[h("th",{class:"relative-position",colspan:Ed.value},Ld())])),h("thead",Dd)}function am(){const Dd=t.header,Hf=t["header-cell"];if(Dd!==void 0)return Dd(Xd({header:!0})).slice();const mh=vd.value.map(Jh=>{const Wu=t[`header-cell-${Jh.name}`],al=Wu!==void 0?Wu:Hf,Xr=Xd({col:Jh});return al!==void 0?al(Xr):h(QTh,{key:Jh.name,props:Xr},()=>Jh.label)});if(xh.value===!0&&e.grid!==!0)mh.unshift(h("th",{class:"q-table--col-auto-width"}," "));else if(Mh.value===!0){const Jh=t["header-selection"],Wu=Jh!==void 0?Jh(Xd({})):[h(QCheckbox,{color:e.color,modelValue:Yf.value,dark:l.value,dense:e.dense,"onUpdate:modelValue":Op})];mh.unshift(h("th",{class:"q-table--col-auto-width"},Wu))}return[h("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},mh)]}function Xd(Dd){return Object.assign(Dd,{cols:vd.value,sort:Cd,colsMap:qd.value,color:e.color,dark:l.value,dense:e.dense}),Mh.value===!0&&injectProp(Dd,"selected",()=>Yf.value,Op),Dd}function Op(Dd){Uh.value===!0&&(Dd=!1),Af(sl.value.map(x.value),sl.value,Dd)}const nm=computed(()=>{const Dd=[e.iconFirstPage||s.iconSet.table.firstPage,e.iconPrevPage||s.iconSet.table.prevPage,e.iconNextPage||s.iconSet.table.nextPage,e.iconLastPage||s.iconSet.table.lastPage];return s.lang.rtl===!0?Dd.reverse():Dd});function Tm(){if(e.hideBottom===!0)return;if(fp.value===!0){if(e.hideNoData===!0)return;const mh=e.loading===!0?e.loadingLabel||s.lang.table.loading:e.filter?e.noResultsLabel||s.lang.table.noResults:e.noDataLabel||s.lang.table.noData,Jh=t["no-data"],Wu=Jh!==void 0?[Jh({message:mh,icon:s.iconSet.table.warning,filter:e.filter})]:[h(QIcon,{class:"q-table__bottom-nodata-icon",name:s.iconSet.table.warning}),mh];return h("div",{class:bottomClass+" q-table__bottom--nodata"},Wu)}const Dd=t.bottom;if(Dd!==void 0)return h("div",{class:bottomClass},[Dd(Tp.value)]);const Hf=e.hideSelectedBanner!==!0&&sh.value===!0&&cd.value>0?[h("div",{class:"q-table__control"},[h("div",[(e.selectedRowsLabel||s.lang.table.selectedRecords)(cd.value)])])]:[];if(e.hidePagination!==!0)return h("div",{class:bottomClass+" justify-end"},Em(Hf));if(Hf.length!==0)return h("div",{class:bottomClass},Hf)}function hp(Dd){Co({page:1,rowsPerPage:Dd.value})}function Em(Dd){let Hf;const{rowsPerPage:mh}=yr.value,Jh=e.paginationLabel||s.lang.table.pagination,Wu=t.pagination,al=e.rowsPerPageOptions.length>1;if(Dd.push(h("div",{class:"q-table__separator col"})),al===!0&&Dd.push(h("div",{class:"q-table__control"},[h("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||s.lang.table.recordsPerPage]),h(QSelect,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:mh,options:np.value,displayValue:mh===0?s.lang.table.allRows:mh,dark:l.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":hp})])),Wu!==void 0)Hf=Wu(Tp.value);else if(Hf=[h("span",mh!==0?{class:"q-table__bottom-item"}:{},[mh?Jh(Gd.value+1,Math.min(bf.value,jf.value),jf.value):Jh(1,th.value,jf.value)])],mh!==0&&$d.value>1){const Xr={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&(Xr.size="sm"),$d.value>2&&Hf.push(h(QBtn,{key:"pgFirst",...Xr,icon:nm.value[0],disable:Id.value,onClick:yd})),Hf.push(h(QBtn,{key:"pgPrev",...Xr,icon:nm.value[1],disable:Id.value,onClick:Qd}),h(QBtn,{key:"pgNext",...Xr,icon:nm.value[2],disable:td.value,onClick:op})),$d.value>2&&Hf.push(h(QBtn,{key:"pgLast",...Xr,icon:nm.value[3],disable:td.value,onClick:bp}))}return Dd.push(h("div",{class:"q-table__control"},Hf)),Dd}function Qp(){const Dd=e.gridHeader===!0?[h("table",{class:"q-table"},[qp()])]:e.loading===!0&&t.loading===void 0?Ld():void 0;return h("div",{class:"q-table__middle"},Dd)}function lm(){const Dd=t.item!==void 0?t.item:Hf=>{const mh=Hf.cols.map(Wu=>h("div",{class:"q-table__grid-item-row"},[h("div",{class:"q-table__grid-item-title"},[Wu.label]),h("div",{class:"q-table__grid-item-value"},[Wu.value])]));if(sh.value===!0){const Wu=t["body-selection"],al=Wu!==void 0?Wu(Hf):[h(QCheckbox,{modelValue:Hf.selected,color:e.color,dark:l.value,dense:e.dense,"onUpdate:modelValue":(Xr,mr)=>{Af([Hf.key],[Hf.row],Xr,mr)}})];mh.unshift(h("div",{class:"q-table__grid-item-row"},al),h(QSeparator,{dark:l.value}))}const Jh={class:["q-table__grid-item-card"+nt.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(Jh.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(Jh.onClick=Wu=>{n("RowClick",Wu,Hf.row,Hf.pageIndex)}),e.onRowDblclick!==void 0&&(Jh.onDblclick=Wu=>{n("RowDblclick",Wu,Hf.row,Hf.pageIndex)})),h("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(Hf.selected===!0?" q-table__grid-item--selected":"")},[h("div",Jh,mh)])};return h("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},sl.value.map((Hf,mh)=>Dd(Df({key:x.value(Hf),row:Hf,pageIndex:mh}))))}return Object.assign(r.proxy,{requestServerInteraction:rl,setPagination:Co,firstPage:yd,prevPage:Qd,nextPage:op,lastPage:bp,isRowSelected:Tf,clearSelection:yf,isRowExpanded:Js,setExpanded:lh,sort:Cd,resetVirtualScroll:Yd,scrollTo:Zd,getCellValue:Cp}),injectMultipleProps(r.proxy,{filteredSortedRows:()=>Zu.value,computedRows:()=>sl.value,computedRowsNumber:()=>jf.value}),()=>{const Dd=[Pp()],Hf={ref:M,class:Bt.value};return e.grid===!0?Dd.push(Qp()):Object.assign(Hf,{class:[Hf.class,e.cardClass],style:e.cardStyle}),Dd.push(ad(),Tm()),e.loading===!0&&t.loading!==void 0&&Dd.push(t.loading()),h("div",Hf,Dd)}}}),QTabPanels=createComponent({name:"QTabPanels",props:{...usePanelProps,...useDarkProps},emits:usePanelEmits,setup(e,{slots:t}){const n=getCurrentInstance(),r=useDark(e,n.proxy.$q),{updatePanelsList:s,getPanelContent:l,panelDirectives:p}=usePanel(),o=computed(()=>"q-tab-panels q-panel-parent"+(r.value===!0?" q-tab-panels--dark q-dark":""));return()=>(s(t),hDir("div",{class:o.value},l(),"pan",e.swipeable,()=>p.value))}}),QPageContainer=createComponent({name:"QPageContainer",setup(e,{slots:t}){const{proxy:{$q:n}}=getCurrentInstance(),r=inject(layoutKey,emptyRenderFn);if(r===emptyRenderFn)return console.error("QPageContainer needs to be child of QLayout"),emptyRenderFn;provide(pageContainerKey,!0);const s=computed(()=>{const l={};return r.header.space===!0&&(l.paddingTop=`${r.header.size}px`),r.right.space===!0&&(l[`padding${n.lang.rtl===!0?"Left":"Right"}`]=`${r.right.size}px`),r.footer.space===!0&&(l.paddingBottom=`${r.footer.size}px`),r.left.space===!0&&(l[`padding${n.lang.rtl===!0?"Right":"Left"}`]=`${r.left.size}px`),l});return()=>h("div",{class:"q-page-container",style:s.value},hSlot(t.default))}}),{passive}=listenOpts,axisValues=["both","horizontal","vertical"],QScrollObserver=createComponent({name:"QScrollObserver",props:{axis:{type:String,validator:e=>axisValues.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:t}){const n={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let r=null,s,l;watch(()=>e.scrollTarget,()=>{x(),o()});function p(){r!==null&&r();const he=Math.max(0,getVerticalScrollPosition(s)),nt=getHorizontalScrollPosition(s),_e={top:he-n.position.top,left:nt-n.position.left};if(e.axis==="vertical"&&_e.top===0||e.axis==="horizontal"&&_e.left===0)return;const Bt=Math.abs(_e.top)>=Math.abs(_e.left)?_e.top<0?"up":"down":_e.left<0?"left":"right";n.position={top:he,left:nt},n.directionChanged=n.direction!==Bt,n.delta=_e,n.directionChanged===!0&&(n.direction=Bt,n.inflectionPoint=n.position),t("scroll",{...n})}function o(){s=getScrollTarget(l,e.scrollTarget),s.addEventListener("scroll",M,passive),M(!0)}function x(){s!==void 0&&(s.removeEventListener("scroll",M,passive),s=void 0)}function M(he){if(he===!0||e.debounce===0||e.debounce==="0")p();else if(r===null){const[nt,_e]=e.debounce?[setTimeout(p,e.debounce),clearTimeout]:[requestAnimationFrame(p),cancelAnimationFrame];r=()=>{_e(nt),r=null}}}const{proxy:P}=getCurrentInstance();return watch(()=>P.$q.lang.rtl,p),onMounted(()=>{l=P.$el.parentNode,o()}),onBeforeUnmount(()=>{r!==null&&r(),x()}),Object.assign(P,{trigger:M,getPosition:()=>n}),noop}}),QLayout=createComponent({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:t,emit:n}){const{proxy:{$q:r}}=getCurrentInstance(),s=ref(null),l=ref(r.screen.height),p=ref(e.container===!0?0:r.screen.width),o=ref({position:0,direction:"down",inflectionPoint:0}),x=ref(0),M=ref(isRuntimeSsrPreHydration.value===!0?0:getScrollbarWidth()),P=computed(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),he=computed(()=>e.container===!1?{minHeight:r.screen.height+"px"}:null),nt=computed(()=>M.value!==0?{[r.lang.rtl===!0?"left":"right"]:`${M.value}px`}:null),_e=computed(()=>M.value!==0?{[r.lang.rtl===!0?"right":"left"]:0,[r.lang.rtl===!0?"left":"right"]:`-${M.value}px`,width:`calc(100% + ${M.value}px)`}:null);function Bt(as){if(e.container===!0||document.qScrollPrevented!==!0){const Js={position:as.position.top,direction:as.direction,directionChanged:as.directionChanged,inflectionPoint:as.inflectionPoint.top,delta:as.delta.top};o.value=Js,e.onScroll!==void 0&&n("scroll",Js)}}function Fn(as){const{height:Js,width:lh}=as;let ch=!1;l.value!==Js&&(ch=!0,l.value=Js,e.onScrollHeight!==void 0&&n("scrollHeight",Js),Io()),p.value!==lh&&(ch=!0,p.value=lh),ch===!0&&e.onResize!==void 0&&n("resize",as)}function yr({height:as}){x.value!==as&&(x.value=as,Io())}function Io(){if(e.container===!0){const as=l.value>x.value?getScrollbarWidth():0;M.value!==as&&(M.value=as)}}let rl=null;const Co={instances:{},view:computed(()=>e.view),isContainer:computed(()=>e.container),rootRef:s,height:l,containerHeight:x,scrollbarWidth:M,totalWidth:computed(()=>p.value+M.value),rows:computed(()=>{const as=e.view.toLowerCase().split(" ");return{top:as[0].split(""),middle:as[1].split(""),bottom:as[2].split("")}}),header:reactive({size:0,offset:0,space:!1}),right:reactive({size:300,offset:0,space:!1}),footer:reactive({size:0,offset:0,space:!1}),left:reactive({size:300,offset:0,space:!1}),scroll:o,animate(){rl!==null?clearTimeout(rl):document.body.classList.add("q-body--layout-animate"),rl=setTimeout(()=>{rl=null,document.body.classList.remove("q-body--layout-animate")},155)},update(as,Js,lh){Co[as][Js]=lh}};if(provide(layoutKey,Co),getScrollbarWidth()>0){let lh=function(){as=null,Js.classList.remove("hide-scrollbar")},ch=function(){if(as===null){if(Js.scrollHeight>r.screen.height)return;Js.classList.add("hide-scrollbar")}else clearTimeout(as);as=setTimeout(lh,300)},Zu=function(th){as!==null&&th==="remove"&&(clearTimeout(as),lh()),window[`${th}EventListener`]("resize",ch)},as=null;const Js=document.body;watch(()=>e.container!==!0?"add":"remove",Zu),e.container!==!0&&Zu("add"),onUnmounted(()=>{Zu("remove")})}return()=>{const as=hMergeSlot(t.default,[h(QScrollObserver,{onScroll:Bt}),h(QResizeObserver,{onResize:Fn})]),Js=h("div",{class:P.value,style:he.value,ref:e.container===!0?void 0:s,tabindex:-1},as);return e.container===!0?h("div",{class:"q-layout-container overflow-hidden",ref:s},[h(QResizeObserver,{onResize:yr}),h("div",{class:"absolute-full",style:nt.value},[h("div",{class:"scroll",style:_e.value},[Js])])]):Js}}});function getDepth$1(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const ClosePopup=createDirective({name:"close-popup",beforeMount(e,{value:t}){const n={depth:getDepth$1(t),handler(r){n.depth!==0&&setTimeout(()=>{const s=getPortalProxy(e);s!==void 0&&closePortals(s,r,n.depth)})},handlerKey(r){isKeyCode(r,13)===!0&&n.handler(r)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:t,oldValue:n}){t!==n&&(e.__qclosepopup.depth=getDepth$1(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),QToolbar=createComponent({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:t}){const n=computed(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>h("div",{class:n.value,role:"toolbar"},hSlot(t.default))}});class Store{constructor(t="unreal-mapbox",n="keyval"){this.storeName=n,this._dbp=new Promise((r,s)=>{const l=indexedDB.open(t,3);l.onerror=()=>s(l.error),l.onsuccess=()=>r(l.result),l.onupgradeneeded=()=>{try{l.result.deleteObjectStore(n)}catch{}l.result.createObjectStore(n)}})}_withIDBStore(t,n){return this._dbp.then(r=>new Promise((s,l)=>{const p=r.transaction(this.storeName,t);p.oncomplete=()=>s(),p.onabort=p.onerror=()=>l(p.error),n(p.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get$1(e,t=getDefaultStore()){let n;return t._withIDBStore("readonly",r=>{n=r.get(e)}).then(()=>n.result)}function set(e,t,n=getDefaultStore()){return n._withIDBStore("readwrite",r=>{r.put(t,e)})}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",n=>{n.delete(e)})}function clear(e=getDefaultStore()){return e._withIDBStore("readwrite",t=>{t.clear()})}function keys(e=getDefaultStore()){const t=[];return e._withIDBStore("readonly",n=>{(n.openKeyCursor||n.openCursor).call(n).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}const idbKeyval={keys,clear,del,set,get:get$1};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(e=>e[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(e=>e)}async function verifyPermission(e,t){const n={};return t&&(n.writable=!0,n.mode="readwrite"),await e.queryPermission(n)==="granted"||await e.requestPermission(n)==="granted"}async function writeFileToDisk(e,t,n){let s=await(await e.getFileHandle(t,{create:!0})).createWritable();await s.write(n),await s.close()}async function fileExists(e,t){try{return await e.getFileHandle(t),!0}catch(n){if(n.name==="NotFoundError")return!1;if(n.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(e,t){return await(await(await e.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport(){let e;return"showDirectoryPicker"in window?e=!0:e=!1,e}const fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){if(this instanceof r){var s=[null];s.push.apply(s,arguments);var l=Function.bind.apply(t,s);return new l}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var mapboxGl={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(commonjsGlobal,function(){var n,r,s;function l(o,x){if(!n)n=x;else if(!r)r=x;else{var M="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",P={};n(P),s=x(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}l(["exports"],function(o){var x=typeof self<"u"?self:{},M="2.14.1";let P;const he={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{P=c}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!he.API_URL)return null;try{const c=new URL(he.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nt={supported:!1,testSupport:function(c){!Fn&&Bt&&(yr?Io(c):_e=c)}};let _e,Bt,Fn=!1,yr=!1;function Io(c){const a=c.createTexture();c.bindTexture(c.TEXTURE_2D,a);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Bt),c.isContextLost())return;nt.supported=!0}catch{}c.deleteTexture(a),Fn=!0}x.document&&(Bt=x.document.createElement("img"),Bt.onload=function(){_e&&Io(_e),_e=null,yr=!0},Bt.onerror=function(){Fn=!0,_e=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rl="01";var Co=as;function as(c,a,d,y){this.cx=3*c,this.bx=3*(d-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(y-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=d,this.p2y=y}as.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var d=c,y=0;y<8;y++){var C=this.sampleCurveX(d)-c;if(Math.abs(C)<a)return d;var N=this.sampleCurveDerivativeX(d);if(Math.abs(N)<1e-6)break;d-=C/N}var X=0,vt=1;for(d=c,y=0;y<20&&(C=this.sampleCurveX(d),!(Math.abs(C-c)<a));y++)c>C?X=d:vt=d,d=.5*(vt-X)+X;return d},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Js=lh;function lh(c,a){this.x=c,this.y=a}lh.prototype={clone:function(){return new lh(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,d=c.y-this.y;return a*a+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),d=Math.sin(c),y=d*this.x+a*this.y;return this.x=a*this.x-d*this.y,this.y=y,this},_rotateAround:function(c,a){var d=Math.cos(c),y=Math.sin(c),C=a.y+y*(this.x-a.x)+d*(this.y-a.y);return this.x=a.x+d*(this.x-a.x)-y*(this.y-a.y),this.y=C,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},lh.convert=function(c){return c instanceof lh?c:Array.isArray(c)?new lh(c[0],c[1]):c};const ch=Math.PI/180,Zu=180/Math.PI;function th(c){return c*ch}function sl(c){return c*Zu}const sh=[[0,0],[1,0],[1,1],[0,1]];function xh(c){if(c<=0)return 0;if(c>=1)return 1;const a=c*c,d=a*c;return 4*(c<.5?d:3*(c-a)+d-.75)}function Mh(c,a,d,y){const C=new Co(c,a,d,y);return function(N){return C.solve(N)}}const Dh=Mh(.25,.1,.25,1);function Uh(c,a,d){return Math.min(d,Math.max(a,c))}function cd(c,a,d){return(d=Uh((d-c)/(a-c),0,1))*d*(3-2*d)}function Tf(c,a,d){const y=d-a,C=((c-a)%y+y)%y+a;return C===a?d:C}function yf(c,a,d){if(!c.length)return d(null,[]);let y=c.length;const C=new Array(c.length);let N=null;c.forEach((X,vt)=>{a(X,(Ht,Ui)=>{Ht&&(N=Ht),C[vt]=Ui,--y==0&&d(N,C)})})}function Af(c){const a=[];for(const d in c)a.push(c[d]);return a}function md(c,...a){for(const d of a)for(const y in d)c[y]=d[y];return c}let vd=1;function qd(){return vd++}function Ed(){return function c(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Td(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Fd(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function Cd(c,a){c.forEach(d=>{a[d]&&(a[d]=a[d].bind(a))})}function Gd(c,a){return c.indexOf(a,c.length-a.length)!==-1}function bf(c,a,d){const y={};for(const C in c)y[C]=a.call(d||this,c[C],C,c);return y}function Id(c,a,d){const y={};for(const C in c)a.call(d||this,c[C],C,c)&&(y[C]=c[C]);return y}function td(c){return Array.isArray(c)?c.map(td):typeof c=="object"&&c?bf(c,td):c}const $d={};function np(c){$d[c]||(typeof console<"u"&&console.warn(c),$d[c]=!0)}function jf(c,a,d){return(d.y-c.y)*(a.x-c.x)>(a.y-c.y)*(d.x-c.x)}function yd(c){let a=0;for(let d,y,C=0,N=c.length,X=N-1;C<N;X=C++)d=c[C],y=c[X],a+=(y.x-d.x)*(d.y+y.y);return a}function Qd(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function op(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,y,C,N)=>{const X=C||N;return a[y]=!X||X.toLowerCase(),""}),a["max-age"]){const d=parseInt(a["max-age"],10);isNaN(d)?delete a["max-age"]:a["max-age"]=d}return a}let bp=null;function fp(c){if(bp==null){const a=c.navigator?c.navigator.userAgent:null;bp=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return bp}function Qh(c){try{const a=x[c];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}}function Yd(c,a){return[c[4*a],c[4*a+1],c[4*a+2],c[4*a+3]]}const ad="mapbox-tiles";let Zd,Xh,Ld=500,Kf=50;function If(){try{return x.caches}catch{}}function Df(){If()&&!Zd&&(Zd=x.caches.open(ad))}function Jf(c){const a=c.indexOf("?");if(a<0)return c;const d=function(C){const N=C.indexOf("?");return N>0?C.slice(N+1).split("&"):[]}(c),y=d.filter(C=>{const N=C.split("=");return N[0]==="language"||N[0]==="worldview"});return y.length?`${c.slice(0,a)}?${y.join("&")}`:c.slice(0,a)}let Nf=1/0;const Wf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Wf);class Cp extends Error{constructor(a,d,y){d===401&&Em(y)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=d,this.url=y}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Tp=Qd()?()=>self.worker&&self.worker.referrer:()=>(x.location.protocol==="blob:"?x.parent:x).location.href,Pp=function(c,a){if(!(/^file:/.test(d=c.url)||/^file:/.test(Tp())&&!/^\w+:/.test(d))){if(x.fetch&&x.Request&&x.AbortController&&x.Request.prototype.hasOwnProperty("signal"))return function(y,C){const N=new x.AbortController,X=new x.Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,referrer:Tp(),referrerPolicy:y.referrerPolicy,signal:N.signal});let vt=!1,Ht=!1;const Ui=(qr=X.url).indexOf("sku=")>0&&Em(qr);var qr;y.type==="json"&&X.headers.set("Accept","application/json");const Zs=(ju,Ku,ah)=>{if(Ht)return;if(ju&&ju.message!=="SecurityError"&&np(ju),Ku&&ah)return nl(Ku);const Eh=Date.now();x.fetch(X).then(zh=>{if(zh.ok){const Yh=Ui?zh.clone():null;return nl(zh,Yh,Eh)}return C(new Cp(zh.statusText,zh.status,y.url))}).catch(zh=>{zh.name!=="AbortError"&&C(new Error(`${zh.message} ${y.url}`))})},nl=(ju,Ku,ah)=>{(y.type==="arrayBuffer"?ju.arrayBuffer():y.type==="json"?ju.json():ju.text()).then(Eh=>{Ht||(Ku&&ah&&function(zh,Yh,kh){if(Df(),!Zd)return;const Gh={status:Yh.status,statusText:Yh.statusText,headers:new x.Headers};Yh.headers.forEach((Rd,kd)=>Gh.headers.set(kd,Rd));const nd=op(Yh.headers.get("Cache-Control")||"");if(nd["no-store"])return;nd["max-age"]&&Gh.headers.set("Expires",new Date(kh+1e3*nd["max-age"]).toUTCString());const ed=Gh.headers.get("Expires");ed&&(new Date(ed).getTime()-kh<42e4||function(Rd,kd){if(Xh===void 0)try{new Response(new ReadableStream),Xh=!0}catch{Xh=!1}Xh?kd(Rd.body):Rd.blob().then(kd)}(Yh,Rd=>{const kd=new x.Response(Rd,Gh);Df(),Zd&&Zd.then(Sf=>Sf.put(Jf(zh.url),kd)).catch(Sf=>np(Sf.message))}))}(X,Ku,ah),vt=!0,C(null,Eh,ju.headers.get("Cache-Control"),ju.headers.get("Expires")))}).catch(Eh=>{Ht||C(new Error(Eh.message))})};return Ui?function(ju,Ku){if(Df(),!Zd)return Ku(null);const ah=Jf(ju.url);Zd.then(Eh=>{Eh.match(ah).then(zh=>{const Yh=function(kh){if(!kh)return!1;const Gh=new Date(kh.headers.get("Expires")||0),nd=op(kh.headers.get("Cache-Control")||"");return Gh>Date.now()&&!nd["no-cache"]}(zh);Eh.delete(ah),Yh&&Eh.put(ah,zh.clone()),Ku(null,zh,Yh)}).catch(Ku)}).catch(Ku)}(X,Zs):Zs(null,null),{cancel:()=>{Ht=!0,vt||N.abort()}}}(c,a);if(Qd()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,a,void 0,!0)}var d;return function(y,C){const N=new x.XMLHttpRequest;N.open(y.method||"GET",y.url,!0),y.type==="arrayBuffer"&&(N.responseType="arraybuffer");for(const X in y.headers)N.setRequestHeader(X,y.headers[X]);return y.type==="json"&&(N.responseType="text",N.setRequestHeader("Accept","application/json")),N.withCredentials=y.credentials==="include",N.onerror=()=>{C(new Error(N.statusText))},N.onload=()=>{if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let X=N.response;if(y.type==="json")try{X=JSON.parse(N.response)}catch(vt){return C(vt)}C(null,X,N.getResponseHeader("Cache-Control"),N.getResponseHeader("Expires"))}else C(new Cp(N.statusText,N.status,y.url))},N.send(y.body),{cancel:()=>N.abort()}}(c,a)},Yf=function(c,a){return Pp(md(c,{type:"arrayBuffer"}),a)};function qp(c){const a=x.document.createElement("a");return a.href=c,a.protocol===x.document.location.protocol&&a.host===x.document.location.host}const am="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xd,Op;Xd=[],Op=0;const nm=function(c,a){if(nt.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Op>=he.MAX_PARALLEL_IMAGE_REQUESTS){const N={requestParameters:c,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return Xd.push(N),N}Op++;let d=!1;const y=()=>{if(!d)for(d=!0,Op--;Xd.length&&Op<he.MAX_PARALLEL_IMAGE_REQUESTS;){const N=Xd.shift(),{requestParameters:X,callback:vt,cancelled:Ht}=N;Ht||(N.cancel=nm(X,vt).cancel)}},C=Yf(c,(N,X,vt,Ht)=>{y(),N?a(N):X&&(x.createImageBitmap?function(Ui,qr){const Zs=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});x.createImageBitmap(Zs).then(nl=>{qr(null,nl)}).catch(nl=>{qr(new Error(`Could not load image because of ${nl.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(X,(Ui,qr)=>a(Ui,qr,vt,Ht)):function(Ui,qr){const Zs=new x.Image,nl=x.URL;Zs.onload=()=>{qr(null,Zs),nl.revokeObjectURL(Zs.src),Zs.onload=null,x.requestAnimationFrame(()=>{Zs.src=am})},Zs.onerror=()=>qr(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ju=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});Zs.src=Ui.byteLength?nl.createObjectURL(ju):am}(X,(Ui,qr)=>a(Ui,qr,vt,Ht)))});return{cancel:()=>{C.cancel(),y()}}},Tm="NO_ACCESS_TOKEN";function hp(c){return c.indexOf("mapbox:")===0}function Em(c){return he.API_URL_REGEX.test(c)}function Qp(c){return he.API_CDN_URL_REGEX.test(c)}function lm(c){return he.API_STYLE_REGEX.test(c)&&!Dd(c)}function Dd(c){return he.API_SPRITE_REGEX.test(c)}const Hf=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mh(c){const a=c.match(Hf);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Jh(c){const a=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${a}`}function Wu(c){if(!c)return null;const a=c.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(x.atob(a[1]).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class al{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const d=Wu(he.ACCESS_TOKEN);let y="";return y=d&&d.u?x.btoa(encodeURIComponent(d.u).replace(/%([0-9A-F]{2})/g,(C,N)=>String.fromCharCode(+("0x"+N)))):he.ACCESS_TOKEN||"",a?`mapbox.eventData.${a}:${y}`:`mapbox.eventData:${y}`}fetchEventData(){const a=Qh("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(a)try{const C=x.localStorage.getItem(d);C&&(this.eventData=JSON.parse(C));const N=x.localStorage.getItem(y);N&&(this.anonId=N)}catch{np("Unable to read from LocalStorage")}}saveEventData(){const a=Qh("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(a)try{x.localStorage.setItem(y,this.anonId),Object.keys(this.eventData).length>=1&&x.localStorage.setItem(d,JSON.stringify(this.eventData))}catch{np("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,d,y,C){if(!he.EVENTS_URL)return;const N=mh(he.EVENTS_URL);N.params.push(`access_token=${C||he.ACCESS_TOKEN||""}`);const X={event:this.type,created:new Date(a).toISOString()},vt=d?md(X,d):X,Ht={url:Jh(N),headers:{"Content-Type":"text/plain"},body:JSON.stringify([vt])};this.pendingRequest=function(Ui,qr){return Pp(md(Ui,{method:"POST"}),qr)}(Ht,Ui=>{this.pendingRequest=null,y(Ui),this.saveEventData(),this.processRequests(C)})}queueRequest(a,d){this.queue.push(a),this.processRequests(d)}}const Xr=new class extends al{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,a){he.EVENTS_URL&&he.ACCESS_TOKEN&&Array.isArray(c)&&c.some(d=>hp(d)||Em(d))&&this.queueRequest(Date.now(),a)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=Wu(he.ACCESS_TOKEN),d=a?a.u:he.ACCESS_TOKEN;let y=d!==this.eventData.tokenU;Fd(this.anonId)||(this.anonId=Ed(),y=!0);const C=this.queue.shift();if(this.eventData.lastSuccess){const N=new Date(this.eventData.lastSuccess),X=new Date(C),vt=(C-this.eventData.lastSuccess)/864e5;y=y||vt>=1||vt<-1||N.getDate()!==X.getDate()}else y=!0;y?this.postEvent(C,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:rl,"enabled.telemetry":!1,userId:this.anonId},N=>{N||(this.eventData.lastSuccess=C,this.eventData.tokenU=d)},c):this.processRequests()}},mr=Xr.postTurnstileEvent.bind(Xr),cs=new class extends al{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,a,d,y){this.skuToken=a,this.errorCb=y,he.EVENTS_URL&&(d||he.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(Tm)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:d}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),Fd(this.anonId)||(this.anonId=Ed()),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:rl,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):a&&(this.success[a]=!0)},c))}},$u=cs.postMapLoadEvent.bind(cs),eh=new class extends al{constructor(){super("gljs.performance")}postPerformanceEvent(c,a){he.EVENTS_URL&&(c||he.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:d}=this.queue.shift(),y=function(C){const N=x.performance.getEntriesByType("resource"),X=x.performance.getEntriesByType("mark"),vt=function(nl){const ju={};if(nl){for(const Ku in nl)if(Ku!=="other")for(const ah of nl[Ku]){const Eh=`${Ku}ResolveRangeMin`,zh=`${Ku}ResolveRangeMax`,Yh=`${Ku}RequestCount`,kh=`${Ku}RequestCachedCount`;ju[Eh]=Math.min(ju[Eh]||1/0,ah.startTime),ju[zh]=Math.max(ju[zh]||-1/0,ah.responseEnd);const Gh=nd=>{ju[nd]===void 0&&(ju[nd]=0),++ju[nd]};ah.transferSize!==void 0&&ah.transferSize===0&&Gh(kh),Gh(Yh)}}return ju}(function(nl,ju){const Ku={};if(nl)for(const ah of nl){const Eh=ju(ah);Ku[Eh]===void 0&&(Ku[Eh]=[]),Ku[Eh].push(ah)}return Ku}(N,Ad)),Ht=x.devicePixelRatio,Ui=x.navigator.connection||x.navigator.mozConnection||x.navigator.webkitConnection,qr={counters:[],metadata:[],attributes:[]},Zs=(nl,ju,Ku)=>{Ku!=null&&nl.push({name:ju,value:Ku.toString()})};for(const nl in vt)Zs(qr.counters,nl,vt[nl]);if(C.interactionRange[0]!==1/0&&C.interactionRange[1]!==-1/0&&(Zs(qr.counters,"interactionRangeMin",C.interactionRange[0]),Zs(qr.counters,"interactionRangeMax",C.interactionRange[1])),X)for(const nl of Object.keys(Ph)){const ju=Ph[nl],Ku=X.find(ah=>ah.name===ju);Ku&&Zs(qr.counters,ju,Ku.startTime)}return Zs(qr.counters,"visibilityHidden",C.visibilityHidden),Zs(qr.attributes,"style",function(nl){if(nl)for(const ju of nl){const Ku=ju.name.split("?")[0];if(lm(Ku)){const ah=Ku.split("/").slice(-2);if(ah.length===2)return`mapbox://styles/${ah[0]}/${ah[1]}`}}}(N)),Zs(qr.attributes,"terrainEnabled",C.terrainEnabled?"true":"false"),Zs(qr.attributes,"fogEnabled",C.fogEnabled?"true":"false"),Zs(qr.attributes,"projection",C.projection),Zs(qr.attributes,"zoom",C.zoom),Zs(qr.metadata,"devicePixelRatio",Ht),Zs(qr.metadata,"connectionEffectiveType",Ui?Ui.effectiveType:void 0),Zs(qr.metadata,"navigatorUserAgent",x.navigator.userAgent),Zs(qr.metadata,"screenWidth",x.screen.width),Zs(qr.metadata,"screenHeight",x.screen.height),Zs(qr.metadata,"windowWidth",x.innerWidth),Zs(qr.metadata,"windowHeight",x.innerHeight),Zs(qr.metadata,"mapWidth",C.width/Ht),Zs(qr.metadata,"mapHeight",C.height/Ht),Zs(qr.metadata,"webglRenderer",C.renderer),Zs(qr.metadata,"webglVendor",C.vendor),Zs(qr.metadata,"sdkVersion",M),Zs(qr.metadata,"sdkIdentifier","mapbox-gl-js"),qr}(d);for(const C of y.metadata);for(const C of y.counters);for(const C of y.attributes);this.postEvent(a,y,()=>{},c)}},rh=eh.postPerformanceEvent.bind(eh),uh=new class extends al{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,a,d,y){if(!he.API_URL||!he.SESSION_PATH)return;const C=mh(he.API_URL+he.SESSION_PATH);C.params.push(`sku=${a||""}`),C.params.push(`access_token=${y||he.ACCESS_TOKEN||""}`);const N={url:Jh(C),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(X,vt){return Pp(md(X,{method:"GET"}),vt)}(N,X=>{this.pendingRequest=null,d(X),this.saveEventData(),this.processRequests(y)})}getSessionAPI(c,a,d,y){this.skuToken=a,this.errorCb=y,he.SESSION_PATH&&he.API_URL&&(d||he.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(Tm)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:d}=this.queue.shift();a&&this.success[a]||this.getSession(d,this.skuToken,y=>{y?this.errorCb(y):a&&(this.success[a]=!0)},c)}},dh=uh.getSessionAPI.bind(uh),yh=new Set,Ph={create:"create",load:"load",fullLoad:"fullLoad"},Fh={mark(c){x.performance.mark(c)},measure(c,a,d){x.performance.measure(c,a,d)}};function Ad(c){const a=c.name.split("?")[0];return Qp(a)&&a.includes("mapbox-gl.js")?"javascript":Qp(a)&&a.includes("mapbox-gl.css")?"css":function(d){return he.API_FONTS_REGEX.test(d)}(a)?"fontRange":Dd(a)?"sprite":lm(a)?"style":function(d){return he.API_TILEJSON_REGEX.test(d)}(a)?"tilejson":"other"}const wd=x.performance;function Kd(c){const a=c?c.url.toString():void 0;return wd.getEntriesByName(a)}let xf,Ff,rp,Ah;const Jd={now:()=>rp!==void 0?rp:x.performance.now(),setNow(c){rp=c},restoreNow(){rp=void 0},frame(c){const a=x.requestAnimationFrame(c);return{cancel:()=>x.cancelAnimationFrame(a)}},getImageData(c,a=0){const{width:d,height:y}=c;Ah||(Ah=x.document.createElement("canvas"));const C=Ah.getContext("2d",{willReadFrequently:!0});if(!C)throw new Error("failed to create canvas 2d context");return(d>Ah.width||y>Ah.height)&&(Ah.width=d,Ah.height=y),C.clearRect(-a,-a,d+2*a,y+2*a),C.drawImage(c,0,0,d,y),C.getImageData(-a,-a,d+2*a,y+2*a)},resolveURL:c=>(xf||(xf=x.document.createElement("a")),xf.href=c,xf.href),get devicePixelRatio(){return x.devicePixelRatio},get prefersReducedMotion(){return!!x.matchMedia&&(Ff==null&&(Ff=x.matchMedia("(prefers-reduced-motion: reduce)")),Ff.matches)}};function Od(c,a,d){d[c]&&d[c].indexOf(a)!==-1||(d[c]=d[c]||[],d[c].push(a))}function qf(c,a,d){if(d&&d[c]){const y=d[c].indexOf(a);y!==-1&&d[c].splice(y,1)}}class mp{constructor(a,d={}){md(this,d),this.type=a}}class Vp extends mp{constructor(a,d={}){super("error",md({error:a},d))}}class om{on(a,d){return this._listeners=this._listeners||{},Od(a,d,this._listeners),this}off(a,d){return qf(a,d,this._listeners),qf(a,d,this._oneTimeListeners),this}once(a,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},Od(a,d,this._oneTimeListeners),this):new Promise(y=>this.once(a,y))}fire(a,d){typeof a=="string"&&(a=new mp(a,d||{}));const y=a.type;if(this.listens(y)){a.target=this;const C=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const vt of C)vt.call(this,a);const N=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const vt of N)qf(y,vt,this._oneTimeListeners),vt.call(this,a);const X=this._eventedParent;X&&(md(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),X.fire(a))}else a instanceof Vp&&console.error(a.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,d){return this._eventedParent=a,this._eventedParentData=d,this}}var Pd=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Hg(c,...a){for(const d of a)for(const y in d)c[y]=d[y];return c}function $m(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function I_(c){if(Array.isArray(c))return c.map(I_);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const d in c)a[d]=I_(c[d]);return a}return $m(c)}class Dy extends Error{constructor(a,d){super(d),this.message=d,this.key=a}}var Pg=Dy;class l_{constructor(a,d=[]){this.parent=a,this.bindings={};for(const[y,C]of d)this.bindings[y]=C}concat(a){return new l_(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}var ev=l_;const c_={kind:"null"},ep={kind:"number"},im={kind:"string"},Jp={kind:"boolean"},mm={kind:"color"},kn={kind:"object"},el={kind:"value"},_h={kind:"collator"},Vh={kind:"formatted"},rd={kind:"resolvedImage"};function od(c,a){return{kind:"array",itemType:c,N:a}}function sd(c){if(c.kind==="array"){const a=sd(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const Gf=[c_,ep,im,Jp,mm,Vh,kn,od(el),rd];function Ef(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Ef(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const d of Gf)if(!Ef(d,a))return null}}return`Expected ${sd(c)} but found ${sd(a)} instead.`}function _p(c,a){return a.some(d=>d.kind===c.kind)}function sp(c,a){return a.some(d=>d==="null"?c===null:d==="array"?Array.isArray(c):d==="object"?c&&!Array.isArray(c)&&typeof c=="object":d===typeof c)}var lp,Zp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rm(c){return(c=Math.round(c))<0?0:c>255?255:c}function Yp(c){return Rm(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function Pm(c){return(a=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:a>1?1:a;var a}function kf(c,a,d){return d<0?d+=1:d>1&&(d-=1),6*d<1?c+(a-c)*d*6:2*d<1?a:3*d<2?c+(a-c)*(2/3-d)*6:c}try{lp={}.parseCSSColor=function(c){var a,d=c.replace(/ /g,"").toLowerCase();if(d in Zp)return Zp[d].slice();if(d[0]==="#")return d.length===4?(a=parseInt(d.substr(1),16))>=0&&a<=4095?[(3840&a)>>4|(3840&a)>>8,240&a|(240&a)>>4,15&a|(15&a)<<4,1]:null:d.length===7&&(a=parseInt(d.substr(1),16))>=0&&a<=16777215?[(16711680&a)>>16,(65280&a)>>8,255&a,1]:null;var y=d.indexOf("("),C=d.indexOf(")");if(y!==-1&&C+1===d.length){var N=d.substr(0,y),X=d.substr(y+1,C-(y+1)).split(","),vt=1;switch(N){case"rgba":if(X.length!==4)return null;vt=Pm(X.pop());case"rgb":return X.length!==3?null:[Yp(X[0]),Yp(X[1]),Yp(X[2]),vt];case"hsla":if(X.length!==4)return null;vt=Pm(X.pop());case"hsl":if(X.length!==3)return null;var Ht=(parseFloat(X[0])%360+360)%360/360,Ui=Pm(X[1]),qr=Pm(X[2]),Zs=qr<=.5?qr*(Ui+1):qr+Ui-qr*Ui,nl=2*qr-Zs;return[Rm(255*kf(nl,Zs,Ht+1/3)),Rm(255*kf(nl,Zs,Ht)),Rm(255*kf(nl,Zs,Ht-1/3)),vt];default:return null}}return null}}catch{}class Sp{constructor(a,d,y,C=1){this.r=a,this.g=d,this.b=y,this.a=C}static parse(a){if(!a)return;if(a instanceof Sp)return a;if(typeof a!="string")return;const d=lp(a);return d?new Sp(d[0]/255*d[3],d[1]/255*d[3],d[2]/255*d[3],d[3]):void 0}toString(){const[a,d,y,C]=this.toArray();return`rgba(${Math.round(a)},${Math.round(d)},${Math.round(y)},${C})`}toArray(){const{r:a,g:d,b:y,a:C}=this;return C===0?[0,0,0,0]:[255*a/C,255*d/C,255*y/C,C]}toArray01(){const{r:a,g:d,b:y,a:C}=this;return C===0?[0,0,0,0]:[a/C,d/C,y/C,C]}toArray01PremultipliedAlpha(){const{r:a,g:d,b:y,a:C}=this;return[a,d,y,C]}}Sp.black=new Sp(0,0,0,1),Sp.white=new Sp(1,1,1,1),Sp.transparent=new Sp(0,0,0,0),Sp.red=new Sp(1,0,0,1),Sp.blue=new Sp(0,0,1,1);var Np=Sp;class Jm{constructor(a,d,y){this.sensitivity=a?d?"variant":"case":d?"accent":"base",this.locale=y,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,d){return this.collator.compare(a,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Um{constructor(a,d,y,C,N){this.text=a.normalize?a.normalize():a,this.image=d,this.scale=y,this.fontStack=C,this.textColor=N}}class bg{constructor(a){this.sections=a}static fromString(a){return new bg([new Um(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof bg?a:bg.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const d of this.sections){if(d.image){a.push(["image",d.image.name]);continue}a.push(d.text);const y={};d.fontStack&&(y["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(y["font-scale"]=d.scale),d.textColor&&(y["text-color"]=["rgba"].concat(d.textColor.toArray())),a.push(y)}return a}}class kg{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new kg({name:a,available:!1}):null}serialize(){return["image",this.name]}}function Bm(c,a,d,y){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof d=="number"&&d>=0&&d<=255?y===void 0||typeof y=="number"&&y>=0&&y<=1?null:`Invalid rgba value [${[c,a,d,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof y=="number"?[c,a,d,y]:[c,a,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fy(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Np||c instanceof Jm||c instanceof bg||c instanceof kg)return!0;if(Array.isArray(c)){for(const a of c)if(!fy(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!fy(c[a]))return!1;return!0}return!1}function Km(c){if(c===null)return c_;if(typeof c=="string")return im;if(typeof c=="boolean")return Jp;if(typeof c=="number")return ep;if(c instanceof Np)return mm;if(c instanceof Jm)return _h;if(c instanceof bg)return Vh;if(c instanceof kg)return rd;if(Array.isArray(c)){const a=c.length;let d;for(const y of c){const C=Km(y);if(d){if(d===C)continue;d=el;break}d=C}return od(d||el,a)}return kn}function Xg(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof Np||c instanceof bg||c instanceof kg?c.toString():JSON.stringify(c)}class Ly{constructor(a,d){this.type=a,this.value=d}static parse(a,d){if(a.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!fy(a[1]))return d.error("invalid value");const y=a[1];let C=Km(y);const N=d.expectedType;return C.kind!=="array"||C.N!==0||!N||N.kind!=="array"||typeof N.N=="number"&&N.N!==0||(C=N),new Ly(C,y)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Np?["rgba"].concat(this.value.toArray()):this.value instanceof bg?this.value.serialize():this.value}}var Ry=Ly,wg=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const u_={string:im,number:ep,boolean:Jp,object:kn};class Oy{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");let y,C=1;const N=a[0];if(N==="array"){let vt,Ht;if(a.length>2){const Ui=a[1];if(typeof Ui!="string"||!(Ui in u_)||Ui==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);vt=u_[Ui],C++}else vt=el;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return d.error('The length argument to "array" must be a positive integer literal',2);Ht=a[2],C++}y=od(vt,Ht)}else y=u_[N];const X=[];for(;C<a.length;C++){const vt=d.parse(a[C],C,el);if(!vt)return null;X.push(vt)}return new Oy(y,X)}evaluate(a){for(let d=0;d<this.args.length;d++){const y=this.args[d].evaluate(a);if(!Ef(this.type,Km(y)))return y;if(d===this.args.length-1)throw new wg(`Expected value to be of type ${sd(this.type)}, but found ${sd(Km(y))} instead.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,d=[a.kind];if(a.kind==="array"){const y=a.itemType;if(y.kind==="string"||y.kind==="number"||y.kind==="boolean"){d.push(y.kind);const C=a.N;(typeof C=="number"||this.args.length>1)&&d.push(C)}}return d.concat(this.args.map(y=>y.serialize()))}}var V_=Oy;class r0{constructor(a){this.type=Vh,this.sections=a}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const y=a[1];if(!Array.isArray(y)&&typeof y=="object")return d.error("First argument must be an image or text section.");const C=[];let N=!1;for(let X=1;X<=a.length-1;++X){const vt=a[X];if(N&&typeof vt=="object"&&!Array.isArray(vt)){N=!1;let Ht=null;if(vt["font-scale"]&&(Ht=d.parse(vt["font-scale"],1,ep),!Ht))return null;let Ui=null;if(vt["text-font"]&&(Ui=d.parse(vt["text-font"],1,od(im)),!Ui))return null;let qr=null;if(vt["text-color"]&&(qr=d.parse(vt["text-color"],1,mm),!qr))return null;const Zs=C[C.length-1];Zs.scale=Ht,Zs.font=Ui,Zs.textColor=qr}else{const Ht=d.parse(a[X],1,el);if(!Ht)return null;const Ui=Ht.type.kind;if(Ui!=="string"&&Ui!=="value"&&Ui!=="null"&&Ui!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");N=!0,C.push({content:Ht,scale:null,font:null,textColor:null})}}return new r0(C)}evaluate(a){return new bg(this.sections.map(d=>{const y=d.content.evaluate(a);return Km(y)===rd?new Um("",y,null,null,null):new Um(Xg(y),null,d.scale?d.scale.evaluate(a):null,d.font?d.font.evaluate(a).join(","):null,d.textColor?d.textColor.evaluate(a):null)}))}eachChild(a){for(const d of this.sections)a(d.content),d.scale&&a(d.scale),d.font&&a(d.font),d.textColor&&a(d.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const d of this.sections){a.push(d.content.serialize());const y={};d.scale&&(y["font-scale"]=d.scale.serialize()),d.font&&(y["text-font"]=d.font.serialize()),d.textColor&&(y["text-color"]=d.textColor.serialize()),a.push(y)}return a}}class O0{constructor(a){this.type=rd,this.input=a}static parse(a,d){if(a.length!==2)return d.error("Expected two arguments.");const y=d.parse(a[1],1,im);return y?new O0(y):d.error("No image name provided.")}evaluate(a){const d=this.input.evaluate(a),y=kg.fromString(d);return y&&a.availableImages&&(y.available=a.availableImages.indexOf(d)>-1),y}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const l1={"to-boolean":Jp,"to-color":mm,"to-number":ep,"to-string":im};class tv{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const y=a[0];if((y==="to-boolean"||y==="to-string")&&a.length!==2)return d.error("Expected one argument.");const C=l1[y],N=[];for(let X=1;X<a.length;X++){const vt=d.parse(a[X],X,el);if(!vt)return null;N.push(vt)}return new tv(C,N)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let d,y;for(const C of this.args){if(d=C.evaluate(a),y=null,d instanceof Np)return d;if(typeof d=="string"){const N=a.parseColor(d);if(N)return N}else if(Array.isArray(d)&&(y=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Bm(d[0],d[1],d[2],d[3]),!y))return new Np(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new wg(y||`Could not parse color from value '${typeof d=="string"?d:String(JSON.stringify(d))}'`)}if(this.type.kind==="number"){let d=null;for(const y of this.args){if(d=y.evaluate(a),d===null)return 0;const C=Number(d);if(!isNaN(C))return C}throw new wg(`Could not convert ${JSON.stringify(d)} to number.`)}return this.type.kind==="formatted"?bg.fromString(Xg(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?kg.fromString(Xg(this.args[0].evaluate(a))):Xg(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new r0([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new O0(this.args[0]).serialize();const a=[`to-${this.type.kind}`];return this.eachChild(d=>{a.push(d.serialize())}),a}}var oy=tv;const o0=["Unknown","Point","LineString","Polygon"];var By=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?o0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-c[0])+this.featureDistanceData.bearing[1]*(y*a-c[1])}return 0}parseColor(c){let a=this._parseColorCache[c];return a||(a=this._parseColorCache[c]=Np.parse(c)),a}};class py{constructor(a,d,y,C){this.name=a,this.type=d,this._evaluate=y,this.args=C}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,d){const y=a[0],C=py.definitions[y];if(!C)return d.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0);const N=Array.isArray(C)?C[0]:C.type,X=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,vt=X.filter(([Ui])=>!Array.isArray(Ui)||Ui.length===a.length-1);let Ht=null;for(const[Ui,qr]of vt){Ht=new h0(d.registry,d.path,null,d.scope);const Zs=[];let nl=!1;for(let ju=1;ju<a.length;ju++){const Ku=a[ju],ah=Array.isArray(Ui)?Ui[ju-1]:Ui.type,Eh=Ht.parse(Ku,1+Zs.length,ah);if(!Eh){nl=!0;break}Zs.push(Eh)}if(!nl)if(Array.isArray(Ui)&&Ui.length!==Zs.length)Ht.error(`Expected ${Ui.length} arguments, but found ${Zs.length} instead.`);else{for(let ju=0;ju<Zs.length;ju++){const Ku=Array.isArray(Ui)?Ui[ju]:Ui.type,ah=Zs[ju];Ht.concat(ju+1).checkSubtype(Ku,ah.type)}if(Ht.errors.length===0)return new py(y,N,qr,Zs)}}if(vt.length===1)d.errors.push(...Ht.errors);else{const Ui=(vt.length?vt:X).map(([Zs])=>{return nl=Zs,Array.isArray(nl)?`(${nl.map(sd).join(", ")})`:`(${sd(nl.type)}...)`;var nl}).join(" | "),qr=[];for(let Zs=1;Zs<a.length;Zs++){const nl=d.parse(a[Zs],1+qr.length);if(!nl)return null;qr.push(sd(nl.type))}d.error(`Expected arguments of type ${Ui}, but found (${qr.join(", ")}) instead.`)}return null}static register(a,d){py.definitions=d;for(const y in d)a[y]=py}}var Vg=py;class fm{constructor(a,d,y){this.type=_h,this.locale=y,this.caseSensitive=a,this.diacriticSensitive=d}static parse(a,d){if(a.length!==2)return d.error("Expected one argument.");const y=a[1];if(typeof y!="object"||Array.isArray(y))return d.error("Collator options argument must be an object.");const C=d.parse(y["case-sensitive"]!==void 0&&y["case-sensitive"],1,Jp);if(!C)return null;const N=d.parse(y["diacritic-sensitive"]!==void 0&&y["diacritic-sensitive"],1,Jp);if(!N)return null;let X=null;return y.locale&&(X=d.parse(y.locale,1,im),!X)?null:new fm(C,N,X)}evaluate(a){return new Jm(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}const G_=8192;function eg(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function h_(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function iv(c,a){const d=(180+c[0])/360,y=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,C=Math.pow(2,a.z);return[Math.round(d*C*G_),Math.round(y*C*G_)]}function zy(c,a,d){const y=c[0]-a[0],C=c[1]-a[1],N=c[0]-d[0],X=c[1]-d[1];return y*X-N*C==0&&y*N<=0&&C*X<=0}function j_(c,a){let d=!1;for(let X=0,vt=a.length;X<vt;X++){const Ht=a[X];for(let Ui=0,qr=Ht.length;Ui<qr-1;Ui++){if(zy(c,Ht[Ui],Ht[Ui+1]))return!1;(C=Ht[Ui])[1]>(y=c)[1]!=(N=Ht[Ui+1])[1]>y[1]&&y[0]<(N[0]-C[0])*(y[1]-C[1])/(N[1]-C[1])+C[0]&&(d=!d)}}var y,C,N;return d}function s0(c,a){for(let d=0;d<a.length;d++)if(j_(c,a[d]))return!0;return!1}function a0(c,a,d,y){const C=y[0]-d[0],N=y[1]-d[1],X=(c[0]-d[0])*N-C*(c[1]-d[1]),vt=(a[0]-d[0])*N-C*(a[1]-d[1]);return X>0&&vt<0||X<0&&vt>0}function wm(c,a,d){for(const Ui of d)for(let qr=0;qr<Ui.length-1;++qr)if((vt=[(X=Ui[qr+1])[0]-(N=Ui[qr])[0],X[1]-N[1]])[0]*(Ht=[(C=a)[0]-(y=c)[0],C[1]-y[1]])[1]-vt[1]*Ht[0]!=0&&a0(y,C,N,X)&&a0(N,X,y,C))return!0;var y,C,N,X,vt,Ht;return!1}function sy(c,a){for(let d=0;d<c.length;++d)if(!j_(c[d],a))return!1;for(let d=0;d<c.length-1;++d)if(wm(c[d],c[d+1],a))return!1;return!0}function my(c,a){for(let d=0;d<a.length;d++)if(sy(c,a[d]))return!0;return!1}function l0(c,a,d){const y=[];for(let C=0;C<c.length;C++){const N=[];for(let X=0;X<c[C].length;X++){const vt=iv(c[C][X],d);eg(a,vt),N.push(vt)}y.push(N)}return y}function gy(c,a,d){const y=[];for(let C=0;C<c.length;C++){const N=l0(c[C],a,d);y.push(N)}return y}function vv(c,a,d,y){if(c[0]<d[0]||c[0]>d[2]){const C=.5*y;let N=c[0]-d[0]>C?-y:d[0]-c[0]>C?y:0;N===0&&(N=c[0]-d[2]>C?-y:d[2]-c[0]>C?y:0),c[0]+=N}eg(a,c)}function ay(c,a,d,y){const C=Math.pow(2,y.z)*G_,N=[y.x*G_,y.y*G_],X=[];if(!c)return X;for(const vt of c)for(const Ht of vt){const Ui=[Ht.x+N[0],Ht.y+N[1]];vv(Ui,a,d,C),X.push(Ui)}return X}function cm(c,a,d,y){const C=Math.pow(2,y.z)*G_,N=[y.x*G_,y.y*G_],X=[];if(!c)return X;for(const Ht of c){const Ui=[];for(const qr of Ht){const Zs=[qr.x+N[0],qr.y+N[1]];eg(a,Zs),Ui.push(Zs)}X.push(Ui)}if(a[2]-a[0]<=C/2){(vt=a)[0]=vt[1]=1/0,vt[2]=vt[3]=-1/0;for(const Ht of X)for(const Ui of Ht)vv(Ui,a,d,C)}var vt;return X}class Ny{constructor(a,d){this.type=Jp,this.geojson=a,this.geometries=d}static parse(a,d){if(a.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(fy(a[1])){const y=a[1];if(y.type==="FeatureCollection")for(let C=0;C<y.features.length;++C){const N=y.features[C].geometry.type;if(N==="Polygon"||N==="MultiPolygon")return new Ny(y,y.features[C].geometry)}else if(y.type==="Feature"){const C=y.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new Ny(y,y.geometry)}else if(y.type==="Polygon"||y.type==="MultiPolygon")return new Ny(y,y)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(d,y){const C=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],X=d.canonicalID();if(!X)return!1;if(y.type==="Polygon"){const vt=l0(y.coordinates,N,X),Ht=ay(d.geometry(),C,N,X);if(!h_(C,N))return!1;for(const Ui of Ht)if(!j_(Ui,vt))return!1}if(y.type==="MultiPolygon"){const vt=gy(y.coordinates,N,X),Ht=ay(d.geometry(),C,N,X);if(!h_(C,N))return!1;for(const Ui of Ht)if(!s0(Ui,vt))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(d,y){const C=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],X=d.canonicalID();if(!X)return!1;if(y.type==="Polygon"){const vt=l0(y.coordinates,N,X),Ht=cm(d.geometry(),C,N,X);if(!h_(C,N))return!1;for(const Ui of Ht)if(!sy(Ui,vt))return!1}if(y.type==="MultiPolygon"){const vt=gy(y.coordinates,N,X),Ht=cm(d.geometry(),C,N,X);if(!h_(C,N))return!1;for(const Ui of Ht)if(!my(Ui,vt))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Fy=Ny;function q_(c){if(c instanceof Vg&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Fy)return!1;let a=!0;return c.eachChild(d=>{a&&!q_(d)&&(a=!1)}),a}function d_(c){if(c instanceof Vg&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(d=>{a&&!d_(d)&&(a=!1)}),a}function c0(c,a){if(c instanceof Vg&&a.indexOf(c.name)>=0)return!1;let d=!0;return c.eachChild(y=>{d&&!c0(y,a)&&(d=!1)}),d}class u0{constructor(a,d){this.type=d.type,this.name=a,this.boundExpression=d}static parse(a,d){if(a.length!==2||typeof a[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const y=a[1];return d.scope.has(y)?new u0(y,d.scope.get(y)):d.error(`Unknown variable "${y}". Make sure "${y}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nv=u0;class $y{constructor(a,d=[],y,C=new ev,N=[]){this.registry=a,this.path=d,this.key=d.map(X=>`[${X}]`).join(""),this.scope=C,this.errors=N,this.expectedType=y}parse(a,d,y,C,N={}){return d?this.concat(d,y,C)._parse(a,N):this._parse(a,N)}_parse(a,d){function y(C,N,X){return X==="assert"?new V_(N,[C]):X==="coerce"?new oy(N,[C]):C}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const C=a[0];if(typeof C!="string")return this.error(`Expression name must be a string, but found ${typeof C} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const N=this.registry[C];if(N){let X=N.parse(a,this);if(!X)return null;if(this.expectedType){const vt=this.expectedType,Ht=X.type;if(vt.kind!=="string"&&vt.kind!=="number"&&vt.kind!=="boolean"&&vt.kind!=="object"&&vt.kind!=="array"||Ht.kind!=="value")if(vt.kind!=="color"&&vt.kind!=="formatted"&&vt.kind!=="resolvedImage"||Ht.kind!=="value"&&Ht.kind!=="string"){if(this.checkSubtype(vt,Ht))return null}else X=y(X,vt,d.typeAnnotation||"coerce");else X=y(X,vt,d.typeAnnotation||"assert")}if(!(X instanceof Ry)&&X.type.kind!=="resolvedImage"&&Eg(X)){const vt=new By;try{X=new Ry(X.type,X.evaluate(vt))}catch(Ht){return this.error(Ht.message),null}}return X}return this.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,d,y){const C=typeof a=="number"?this.path.concat(a):this.path,N=y?this.scope.concat(y):this.scope;return new $y(this.registry,C,d||null,N,this.errors)}error(a,...d){const y=`${this.key}${d.map(C=>`[${C}]`).join("")}`;this.errors.push(new Pg(y,a))}checkSubtype(a,d){const y=Ef(a,d);return y&&this.error(y),y}}var h0=$y;function Eg(c){if(c instanceof nv)return Eg(c.boundExpression);if(c instanceof Vg&&c.name==="error"||c instanceof fm||c instanceof Fy)return!1;const a=c instanceof oy||c instanceof V_;let d=!0;return c.eachChild(y=>{d=a?d&&Eg(y):d&&y instanceof Ry}),!!d&&q_(c)&&c0(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Z_(c,a){const d=c.length-1;let y,C,N=0,X=d,vt=0;for(;N<=X;)if(vt=Math.floor((N+X)/2),y=c[vt],C=c[vt+1],y<=a){if(vt===d||a<C)return vt;N=vt+1}else{if(!(y>a))throw new wg("Input is not a number.");X=vt-1}return 0}class f_{constructor(a,d,y){this.type=a,this.input=d,this.labels=[],this.outputs=[];for(const[C,N]of y)this.labels.push(C),this.outputs.push(N)}static parse(a,d){if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return d.error("Expected an even number of arguments.");const y=d.parse(a[1],1,ep);if(!y)return null;const C=[];let N=null;d.expectedType&&d.expectedType.kind!=="value"&&(N=d.expectedType);for(let X=1;X<a.length;X+=2){const vt=X===1?-1/0:a[X],Ht=a[X+1],Ui=X,qr=X+1;if(typeof vt!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ui);if(C.length&&C[C.length-1][0]>=vt)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ui);const Zs=d.parse(Ht,qr,N);if(!Zs)return null;N=N||Zs.type,C.push([vt,Zs])}return new f_(N,y,C)}evaluate(a){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(a);const C=this.input.evaluate(a);if(C<=d[0])return y[0].evaluate(a);const N=d.length;return C>=d[N-1]?y[N-1].evaluate(a):y[Z_(d,C)].evaluate(a)}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let d=0;d<this.labels.length;d++)d>0&&a.push(this.labels[d]),a.push(this.outputs[d].serialize());return a}}var p_=f_;function Kp(c,a,d){return c*(1-d)+a*d}var M_=Object.freeze({__proto__:null,number:Kp,color:function(c,a,d){return new Np(Kp(c.r,a.r,d),Kp(c.g,a.g,d),Kp(c.b,a.b,d),Kp(c.a,a.a,d))},array:function(c,a,d){return c.map((y,C)=>Kp(y,a[C],d))}});const m_=.95047,Nv=1.08883,_y=4/29,Uy=6/29,Xm=3*Uy*Uy,d0=Math.PI/180,um=180/Math.PI;function Vy(c){return c>.008856451679035631?Math.pow(c,1/3):c/Xm+_y}function zm(c){return c>Uy?c*c*c:Xm*(c-_y)}function Im(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function g_(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function ly(c){const a=g_(c.r),d=g_(c.g),y=g_(c.b),C=Vy((.4124564*a+.3575761*d+.1804375*y)/m_),N=Vy((.2126729*a+.7151522*d+.072175*y)/1);return{l:116*N-16,a:500*(C-N),b:200*(N-Vy((.0193339*a+.119192*d+.9503041*y)/Nv)),alpha:c.a}}function xv(c){let a=(c.l+16)/116,d=isNaN(c.a)?a:a+c.a/500,y=isNaN(c.b)?a:a-c.b/200;return a=1*zm(a),d=m_*zm(d),y=Nv*zm(y),new Np(Im(3.2404542*d-1.5371385*a-.4985314*y),Im(-.969266*d+1.8760108*a+.041556*y),Im(.0556434*d-.2040259*a+1.0572252*y),c.alpha)}function cy(c,a,d){const y=a-c;return c+d*(y>180||y<-180?y-360*Math.round(y/360):y)}const f0={forward:ly,reverse:xv,interpolate:function(c,a,d){return{l:Kp(c.l,a.l,d),a:Kp(c.a,a.a,d),b:Kp(c.b,a.b,d),alpha:Kp(c.alpha,a.alpha,d)}}},__={forward:function(c){const{l:a,a:d,b:y}=ly(c),C=Math.atan2(y,d)*um;return{h:C<0?C+360:C,c:Math.sqrt(d*d+y*y),l:a,alpha:c.a}},reverse:function(c){const a=c.h*d0,d=c.c;return xv({l:c.l,a:Math.cos(a)*d,b:Math.sin(a)*d,alpha:c.alpha})},interpolate:function(c,a,d){return{h:cy(c.h,a.h,d),c:Kp(c.c,a.c,d),l:Kp(c.l,a.l,d),alpha:Kp(c.alpha,a.alpha,d)}}};var H_=Object.freeze({__proto__:null,lab:f0,hcl:__});class jy{constructor(a,d,y,C,N){this.type=a,this.operator=d,this.interpolation=y,this.input=C,this.labels=[],this.outputs=[];for(const[X,vt]of N)this.labels.push(X),this.outputs.push(vt)}static interpolationFactor(a,d,y,C){let N=0;if(a.name==="exponential")N=yy(d,a.base,y,C);else if(a.name==="linear")N=yy(d,1,y,C);else if(a.name==="cubic-bezier"){const X=a.controlPoints;N=new Co(X[0],X[1],X[2],X[3]).solve(yy(d,1,y,C))}return N}static parse(a,d){let[y,C,N,...X]=a;if(!Array.isArray(C)||C.length===0)return d.error("Expected an interpolation type expression.",1);if(C[0]==="linear")C={name:"linear"};else if(C[0]==="exponential"){const Ui=C[1];if(typeof Ui!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);C={name:"exponential",base:Ui}}else{if(C[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(C[0])}`,1,0);{const Ui=C.slice(1);if(Ui.length!==4||Ui.some(qr=>typeof qr!="number"||qr<0||qr>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);C={name:"cubic-bezier",controlPoints:Ui}}}if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(N=d.parse(N,2,ep),!N)return null;const vt=[];let Ht=null;y==="interpolate-hcl"||y==="interpolate-lab"?Ht=mm:d.expectedType&&d.expectedType.kind!=="value"&&(Ht=d.expectedType);for(let Ui=0;Ui<X.length;Ui+=2){const qr=X[Ui],Zs=X[Ui+1],nl=Ui+3,ju=Ui+4;if(typeof qr!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',nl);if(vt.length&&vt[vt.length-1][0]>=qr)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',nl);const Ku=d.parse(Zs,ju,Ht);if(!Ku)return null;Ht=Ht||Ku.type,vt.push([qr,Ku])}return Ht.kind==="number"||Ht.kind==="color"||Ht.kind==="array"&&Ht.itemType.kind==="number"&&typeof Ht.N=="number"?new jy(Ht,y,C,N,vt):d.error(`Type ${sd(Ht)} is not interpolatable.`)}evaluate(a){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(a);const C=this.input.evaluate(a);if(C<=d[0])return y[0].evaluate(a);const N=d.length;if(C>=d[N-1])return y[N-1].evaluate(a);const X=Z_(d,C),vt=jy.interpolationFactor(this.interpolation,C,d[X],d[X+1]),Ht=y[X].evaluate(a),Ui=y[X+1].evaluate(a);return this.operator==="interpolate"?M_[this.type.kind.toLowerCase()](Ht,Ui,vt):this.operator==="interpolate-hcl"?__.reverse(__.interpolate(__.forward(Ht),__.forward(Ui),vt)):f0.reverse(f0.interpolate(f0.forward(Ht),f0.forward(Ui),vt))}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const d=[this.operator,a,this.input.serialize()];for(let y=0;y<this.labels.length;y++)d.push(this.labels[y],this.outputs[y].serialize());return d}}function yy(c,a,d,y){const C=y-d,N=c-d;return C===0?0:a===1?N/C:(Math.pow(a,N)-1)/(Math.pow(a,C)-1)}var Qg=jy;class qy{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expectected at least one argument.");let y=null;const C=d.expectedType;C&&C.kind!=="value"&&(y=C);const N=[];for(const vt of a.slice(1)){const Ht=d.parse(vt,1+N.length,y,void 0,{typeAnnotation:"omit"});if(!Ht)return null;y=y||Ht.type,N.push(Ht)}const X=C&&N.some(vt=>Ef(C,vt.type));return new qy(X?el:y,N)}evaluate(a){let d,y=null,C=0;for(const N of this.args){if(C++,y=N.evaluate(a),y&&y instanceof kg&&!y.available&&(d||(d=y),y=null,C===this.args.length))return d;if(y!==null)break}return y}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(d=>{a.push(d.serialize())}),a}}var rv=qy;class p0{constructor(a,d){this.type=d.type,this.bindings=[].concat(a),this.result=d}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const d of this.bindings)a(d[1]);a(this.result)}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const y=[];for(let N=1;N<a.length-1;N+=2){const X=a[N];if(typeof X!="string")return d.error(`Expected string, but found ${typeof X} instead.`,N);if(/[^a-zA-Z0-9_]/.test(X))return d.error("Variable names must contain only alphanumeric characters or '_'.",N);const vt=d.parse(a[N+1],N+1);if(!vt)return null;y.push([X,vt])}const C=d.parse(a[a.length-1],a.length-1,d.expectedType,y);return C?new p0(y,C):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[d,y]of this.bindings)a.push(d,y.serialize());return a.push(this.result.serialize()),a}}var C_=p0;class m0{constructor(a,d,y){this.type=a,this.index=d,this.input=y}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=d.parse(a[1],1,ep),C=d.parse(a[2],2,od(d.expectedType||el));return y&&C?new m0(C.type.itemType,y,C):null}evaluate(a){const d=this.index.evaluate(a),y=this.input.evaluate(a);if(d<0)throw new wg(`Array index out of bounds: ${d} < 0.`);if(d>=y.length)throw new wg(`Array index out of bounds: ${d} > ${y.length-1}.`);if(d!==Math.floor(d))throw new wg(`Array index must be an integer, but found ${d} instead.`);return y[d]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var X_=m0;class hd{constructor(a,d){this.type=Jp,this.needle=a,this.haystack=d}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=d.parse(a[1],1,el),C=d.parse(a[2],2,el);return y&&C?_p(y.type,[Jp,im,ep,c_,el])?new hd(y,C):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${sd(y.type)} instead`):null}evaluate(a){const d=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(y==null)return!1;if(!sp(d,["boolean","string","number","null"]))throw new wg(`Expected first argument to be of type boolean, string, number or null, but found ${sd(Km(d))} instead.`);if(!sp(y,["string","array"]))throw new wg(`Expected second argument to be of type array or string, but found ${sd(Km(y))} instead.`);return y.indexOf(d)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wf=hd;class ip{constructor(a,d,y){this.type=ep,this.needle=a,this.haystack=d,this.fromIndex=y}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const y=d.parse(a[1],1,el),C=d.parse(a[2],2,el);if(!y||!C)return null;if(!_p(y.type,[Jp,im,ep,c_,el]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${sd(y.type)} instead`);if(a.length===4){const N=d.parse(a[3],3,ep);return N?new ip(y,C,N):null}return new ip(y,C)}evaluate(a){const d=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(!sp(d,["boolean","string","number","null"]))throw new wg(`Expected first argument to be of type boolean, string, number or null, but found ${sd(Km(d))} instead.`);if(!sp(y,["string","array"]))throw new wg(`Expected second argument to be of type array or string, but found ${sd(Km(y))} instead.`);if(this.fromIndex){const C=this.fromIndex.evaluate(a);return y.indexOf(d,C)}return y.indexOf(d)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Bp=ip;class Nm{constructor(a,d,y,C,N,X){this.inputType=a,this.type=d,this.input=y,this.cases=C,this.outputs=N,this.otherwise=X}static parse(a,d){if(a.length<5)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return d.error("Expected an even number of arguments.");let y,C;d.expectedType&&d.expectedType.kind!=="value"&&(C=d.expectedType);const N={},X=[];for(let Ui=2;Ui<a.length-1;Ui+=2){let qr=a[Ui];const Zs=a[Ui+1];Array.isArray(qr)||(qr=[qr]);const nl=d.concat(Ui);if(qr.length===0)return nl.error("Expected at least one branch label.");for(const Ku of qr){if(typeof Ku!="number"&&typeof Ku!="string")return nl.error("Branch labels must be numbers or strings.");if(typeof Ku=="number"&&Math.abs(Ku)>Number.MAX_SAFE_INTEGER)return nl.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ku=="number"&&Math.floor(Ku)!==Ku)return nl.error("Numeric branch labels must be integer values.");if(y){if(nl.checkSubtype(y,Km(Ku)))return null}else y=Km(Ku);if(N[String(Ku)]!==void 0)return nl.error("Branch labels must be unique.");N[String(Ku)]=X.length}const ju=d.parse(Zs,Ui,C);if(!ju)return null;C=C||ju.type,X.push(ju)}const vt=d.parse(a[1],1,el);if(!vt)return null;const Ht=d.parse(a[a.length-1],a.length-1,C);return Ht?vt.type.kind!=="value"&&d.concat(1).checkSubtype(y,vt.type)?null:new Nm(y,C,vt,N,X,Ht):null}evaluate(a){const d=this.input.evaluate(a);return(Km(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],d=Object.keys(this.cases).sort(),y=[],C={};for(const X of d){const vt=C[this.cases[X]];vt===void 0?(C[this.cases[X]]=y.length,y.push([this.cases[X],[X]])):y[vt][1].push(X)}const N=X=>this.inputType.kind==="number"?Number(X):X;for(const[X,vt]of y)a.push(vt.length===1?N(vt[0]):vt.map(N)),a.push(this.outputs[X].serialize());return a.push(this.otherwise.serialize()),a}}var hm=Nm;class Qm{constructor(a,d,y){this.type=a,this.branches=d,this.otherwise=y}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return d.error("Expected an odd number of arguments.");let y;d.expectedType&&d.expectedType.kind!=="value"&&(y=d.expectedType);const C=[];for(let X=1;X<a.length-1;X+=2){const vt=d.parse(a[X],X,Jp);if(!vt)return null;const Ht=d.parse(a[X+1],X+1,y);if(!Ht)return null;C.push([vt,Ht]),y=y||Ht.type}const N=d.parse(a[a.length-1],a.length-1,y);return N?new Qm(y,C,N):null}evaluate(a){for(const[d,y]of this.branches)if(d.evaluate(a))return y.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[d,y]of this.branches)a(d),a(y);a(this.otherwise)}outputDefined(){return this.branches.every(([a,d])=>d.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(d=>{a.push(d.serialize())}),a}}var og=Qm;class sg{constructor(a,d,y,C){this.type=a,this.input=d,this.beginIndex=y,this.endIndex=C}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const y=d.parse(a[1],1,el),C=d.parse(a[2],2,ep);if(!y||!C)return null;if(!_p(y.type,[od(el),im,el]))return d.error(`Expected first argument to be of type array or string, but found ${sd(y.type)} instead`);if(a.length===4){const N=d.parse(a[3],3,ep);return N?new sg(y.type,y,C,N):null}return new sg(y.type,y,C)}evaluate(a){const d=this.input.evaluate(a),y=this.beginIndex.evaluate(a);if(!sp(d,["string","array"]))throw new wg(`Expected first argument to be of type array or string, but found ${sd(Km(d))} instead.`);if(this.endIndex){const C=this.endIndex.evaluate(a);return d.slice(y,C)}return d.slice(y)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Vm=sg;function tp(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Wg(c,a,d,y){return y.compare(a,d)===0}function Sg(c,a,d){const y=c!=="=="&&c!=="!=";return class WE{constructor(N,X,vt){this.type=Jp,this.lhs=N,this.rhs=X,this.collator=vt,this.hasUntypedArgument=N.type.kind==="value"||X.type.kind==="value"}static parse(N,X){if(N.length!==3&&N.length!==4)return X.error("Expected two or three arguments.");const vt=N[0];let Ht=X.parse(N[1],1,el);if(!Ht)return null;if(!tp(vt,Ht.type))return X.concat(1).error(`"${vt}" comparisons are not supported for type '${sd(Ht.type)}'.`);let Ui=X.parse(N[2],2,el);if(!Ui)return null;if(!tp(vt,Ui.type))return X.concat(2).error(`"${vt}" comparisons are not supported for type '${sd(Ui.type)}'.`);if(Ht.type.kind!==Ui.type.kind&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return X.error(`Cannot compare types '${sd(Ht.type)}' and '${sd(Ui.type)}'.`);y&&(Ht.type.kind==="value"&&Ui.type.kind!=="value"?Ht=new V_(Ui.type,[Ht]):Ht.type.kind!=="value"&&Ui.type.kind==="value"&&(Ui=new V_(Ht.type,[Ui])));let qr=null;if(N.length===4){if(Ht.type.kind!=="string"&&Ui.type.kind!=="string"&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return X.error("Cannot use collator to compare non-string types.");if(qr=X.parse(N[3],3,_h),!qr)return null}return new WE(Ht,Ui,qr)}evaluate(N){const X=this.lhs.evaluate(N),vt=this.rhs.evaluate(N);if(y&&this.hasUntypedArgument){const Ht=Km(X),Ui=Km(vt);if(Ht.kind!==Ui.kind||Ht.kind!=="string"&&Ht.kind!=="number")throw new wg(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${Ht.kind}, ${Ui.kind}) instead.`)}if(this.collator&&!y&&this.hasUntypedArgument){const Ht=Km(X),Ui=Km(vt);if(Ht.kind!=="string"||Ui.kind!=="string")return a(N,X,vt)}return this.collator?d(N,X,vt,this.collator.evaluate(N)):a(N,X,vt)}eachChild(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)}outputDefined(){return!0}serialize(){const N=[c];return this.eachChild(X=>{N.push(X.serialize())}),N}}}const fg=Sg("==",function(c,a,d){return a===d},Wg),A_=Sg("!=",function(c,a,d){return a!==d},function(c,a,d,y){return!Wg(0,a,d,y)}),ap=Sg("<",function(c,a,d){return a<d},function(c,a,d,y){return y.compare(a,d)<0}),Zy=Sg(">",function(c,a,d){return a>d},function(c,a,d,y){return y.compare(a,d)>0}),vy=Sg("<=",function(c,a,d){return a<=d},function(c,a,d,y){return y.compare(a,d)<=0}),B0=Sg(">=",function(c,a,d){return a>=d},function(c,a,d,y){return y.compare(a,d)>=0});class g0{constructor(a,d,y,C,N,X){this.type=im,this.number=a,this.locale=d,this.currency=y,this.unit=C,this.minFractionDigits=N,this.maxFractionDigits=X}static parse(a,d){if(a.length!==3)return d.error("Expected two arguments.");const y=d.parse(a[1],1,ep);if(!y)return null;const C=a[2];if(typeof C!="object"||Array.isArray(C))return d.error("NumberFormat options argument must be an object.");let N=null;if(C.locale&&(N=d.parse(C.locale,1,im),!N))return null;let X=null;if(C.currency&&(X=d.parse(C.currency,1,im),!X))return null;let vt=null;if(C.unit&&(vt=d.parse(C.unit,1,im),!vt))return null;let Ht=null;if(C["min-fraction-digits"]&&(Ht=d.parse(C["min-fraction-digits"],1,ep),!Ht))return null;let Ui=null;return C["max-fraction-digits"]&&(Ui=d.parse(C["max-fraction-digits"],1,ep),!Ui)?null:new g0(y,N,X,vt,Ht,Ui)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class ov{constructor(a){this.type=ep,this.input=a}static parse(a,d){if(a.length!==2)return d.error(`Expected 1 argument, but found ${a.length-1} instead.`);const y=d.parse(a[1],1);return y?y.type.kind!=="array"&&y.type.kind!=="string"&&y.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${sd(y.type)} instead.`):new ov(y):null}evaluate(a){const d=this.input.evaluate(a);if(typeof d=="string"||Array.isArray(d))return d.length;throw new wg(`Expected value to be of type string or array, but found ${sd(Km(d))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(d=>{a.push(d.serialize())}),a}}const _0={"==":fg,"!=":A_,">":Zy,"<":ap,">=":B0,"<=":vy,array:V_,at:X_,boolean:V_,case:og,coalesce:rv,collator:fm,format:r0,image:O0,in:wf,"index-of":Bp,interpolate:Qg,"interpolate-hcl":Qg,"interpolate-lab":Qg,length:ov,let:C_,literal:Ry,match:hm,number:V_,"number-format":g0,object:V_,slice:Vm,step:p_,string:V_,"to-boolean":oy,"to-color":oy,"to-number":oy,"to-string":oy,var:nv,within:Fy};function Cm(c,[a,d,y,C]){a=a.evaluate(c),d=d.evaluate(c),y=y.evaluate(c);const N=C?C.evaluate(c):1,X=Bm(a,d,y,N);if(X)throw new wg(X);return new Np(a/255*N,d/255*N,y/255*N,N)}function sm(c,a){return c in a}function P_(c,a){const d=a[c];return d===void 0?null:d}function Ng(c){return{type:c}}Vg.register(_0,{error:[{kind:"error"},[im],(c,[a])=>{throw new wg(a.evaluate(c))}],typeof:[im,[el],(c,[a])=>sd(Km(a.evaluate(c)))],"to-rgba":[od(ep,4),[mm],(c,[a])=>a.evaluate(c).toArray()],rgb:[mm,[ep,ep,ep],Cm],rgba:[mm,[ep,ep,ep,ep],Cm],has:{type:Jp,overloads:[[[im],(c,[a])=>sm(a.evaluate(c),c.properties())],[[im,kn],(c,[a,d])=>sm(a.evaluate(c),d.evaluate(c))]]},get:{type:el,overloads:[[[im],(c,[a])=>P_(a.evaluate(c),c.properties())],[[im,kn],(c,[a,d])=>P_(a.evaluate(c),d.evaluate(c))]]},"feature-state":[el,[im],(c,[a])=>P_(a.evaluate(c),c.featureState||{})],properties:[kn,[],c=>c.properties()],"geometry-type":[im,[],c=>c.geometryType()],id:[el,[],c=>c.id()],zoom:[ep,[],c=>c.globals.zoom],pitch:[ep,[],c=>c.globals.pitch||0],"distance-from-center":[ep,[],c=>c.distanceFromCenter()],"heatmap-density":[ep,[],c=>c.globals.heatmapDensity||0],"line-progress":[ep,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[ep,[],c=>c.globals.skyRadialProgress||0],accumulated:[el,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ep,Ng(ep),(c,a)=>{let d=0;for(const y of a)d+=y.evaluate(c);return d}],"*":[ep,Ng(ep),(c,a)=>{let d=1;for(const y of a)d*=y.evaluate(c);return d}],"-":{type:ep,overloads:[[[ep,ep],(c,[a,d])=>a.evaluate(c)-d.evaluate(c)],[[ep],(c,[a])=>-a.evaluate(c)]]},"/":[ep,[ep,ep],(c,[a,d])=>a.evaluate(c)/d.evaluate(c)],"%":[ep,[ep,ep],(c,[a,d])=>a.evaluate(c)%d.evaluate(c)],ln2:[ep,[],()=>Math.LN2],pi:[ep,[],()=>Math.PI],e:[ep,[],()=>Math.E],"^":[ep,[ep,ep],(c,[a,d])=>Math.pow(a.evaluate(c),d.evaluate(c))],sqrt:[ep,[ep],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[ep,[ep],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[ep,[ep],(c,[a])=>Math.log(a.evaluate(c))],log2:[ep,[ep],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[ep,[ep],(c,[a])=>Math.sin(a.evaluate(c))],cos:[ep,[ep],(c,[a])=>Math.cos(a.evaluate(c))],tan:[ep,[ep],(c,[a])=>Math.tan(a.evaluate(c))],asin:[ep,[ep],(c,[a])=>Math.asin(a.evaluate(c))],acos:[ep,[ep],(c,[a])=>Math.acos(a.evaluate(c))],atan:[ep,[ep],(c,[a])=>Math.atan(a.evaluate(c))],min:[ep,Ng(ep),(c,a)=>Math.min(...a.map(d=>d.evaluate(c)))],max:[ep,Ng(ep),(c,a)=>Math.max(...a.map(d=>d.evaluate(c)))],abs:[ep,[ep],(c,[a])=>Math.abs(a.evaluate(c))],round:[ep,[ep],(c,[a])=>{const d=a.evaluate(c);return d<0?-Math.round(-d):Math.round(d)}],floor:[ep,[ep],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[ep,[ep],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[Jp,[im,el],(c,[a,d])=>c.properties()[a.value]===d.value],"filter-id-==":[Jp,[el],(c,[a])=>c.id()===a.value],"filter-type-==":[Jp,[im],(c,[a])=>c.geometryType()===a.value],"filter-<":[Jp,[im,el],(c,[a,d])=>{const y=c.properties()[a.value],C=d.value;return typeof y==typeof C&&y<C}],"filter-id-<":[Jp,[el],(c,[a])=>{const d=c.id(),y=a.value;return typeof d==typeof y&&d<y}],"filter->":[Jp,[im,el],(c,[a,d])=>{const y=c.properties()[a.value],C=d.value;return typeof y==typeof C&&y>C}],"filter-id->":[Jp,[el],(c,[a])=>{const d=c.id(),y=a.value;return typeof d==typeof y&&d>y}],"filter-<=":[Jp,[im,el],(c,[a,d])=>{const y=c.properties()[a.value],C=d.value;return typeof y==typeof C&&y<=C}],"filter-id-<=":[Jp,[el],(c,[a])=>{const d=c.id(),y=a.value;return typeof d==typeof y&&d<=y}],"filter->=":[Jp,[im,el],(c,[a,d])=>{const y=c.properties()[a.value],C=d.value;return typeof y==typeof C&&y>=C}],"filter-id->=":[Jp,[el],(c,[a])=>{const d=c.id(),y=a.value;return typeof d==typeof y&&d>=y}],"filter-has":[Jp,[el],(c,[a])=>a.value in c.properties()],"filter-has-id":[Jp,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Jp,[od(im)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[Jp,[od(el)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[Jp,[im,od(el)],(c,[a,d])=>d.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[Jp,[im,od(el)],(c,[a,d])=>function(y,C,N,X){for(;N<=X;){const vt=N+X>>1;if(C[vt]===y)return!0;C[vt]>y?X=vt-1:N=vt+1}return!1}(c.properties()[a.value],d.value,0,d.value.length-1)],all:{type:Jp,overloads:[[[Jp,Jp],(c,[a,d])=>a.evaluate(c)&&d.evaluate(c)],[Ng(Jp),(c,a)=>{for(const d of a)if(!d.evaluate(c))return!1;return!0}]]},any:{type:Jp,overloads:[[[Jp,Jp],(c,[a,d])=>a.evaluate(c)||d.evaluate(c)],[Ng(Jp),(c,a)=>{for(const d of a)if(d.evaluate(c))return!0;return!1}]]},"!":[Jp,[Jp],(c,[a])=>!a.evaluate(c)],"is-supported-script":[Jp,[im],(c,[a])=>{const d=c.globals&&c.globals.isSupportedScript;return!d||d(a.evaluate(c))}],upcase:[im,[im],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[im,[im],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[im,Ng(el),(c,a)=>a.map(d=>Xg(d.evaluate(c))).join("")],"resolved-locale":[im,[_h],(c,[a])=>a.evaluate(c).resolvedLocale()]});var W_=_0;function Dg(c){return{result:"success",value:c}}function Gm(c){return{result:"error",value:c}}function ag(c){return c["property-type"]==="data-driven"}function Jg(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function k_(c){return!!c.expression&&c.expression.interpolated}function em(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Gg(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function bv(c){return c}function Ig(c,a){const d=a.type==="color",y=c.stops&&typeof c.stops[0][0]=="object",C=y||!(y||c.property!==void 0),N=c.type||(k_(a)?"exponential":"interval");if(d&&((c=Hg({},c)).stops&&(c.stops=c.stops.map(Ui=>[Ui[0],Np.parse(Ui[1])])),c.default=Np.parse(c.default?c.default:a.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!H_[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let X,vt,Ht;if(N==="exponential")X=Hy;else if(N==="interval")X=xy;else if(N==="categorical"){X=D_,vt=Object.create(null);for(const Ui of c.stops)vt[Ui[0]]=Ui[1];Ht=typeof c.stops[0][0]}else{if(N!=="identity")throw new Error(`Unknown function type "${N}"`);X=y0}if(y){const Ui={},qr=[];for(let ju=0;ju<c.stops.length;ju++){const Ku=c.stops[ju],ah=Ku[0].zoom;Ui[ah]===void 0&&(Ui[ah]={zoom:ah,type:c.type,property:c.property,default:c.default,stops:[]},qr.push(ah)),Ui[ah].stops.push([Ku[0].value,Ku[1]])}const Zs=[];for(const ju of qr)Zs.push([Ui[ju].zoom,Ig(Ui[ju],a)]);const nl={name:"linear"};return{kind:"composite",interpolationType:nl,interpolationFactor:Qg.interpolationFactor.bind(void 0,nl),zoomStops:Zs.map(ju=>ju[0]),evaluate:({zoom:ju},Ku)=>Hy({stops:Zs,base:c.base},a,ju).evaluate(ju,Ku)}}if(C){const Ui=N==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Ui,interpolationFactor:Qg.interpolationFactor.bind(void 0,Ui),zoomStops:c.stops.map(qr=>qr[0]),evaluate:({zoom:qr})=>X(c,a,qr,vt,Ht)}}return{kind:"source",evaluate(Ui,qr){const Zs=qr&&qr.properties?qr.properties[c.property]:void 0;return Zs===void 0?Mm(c.default,a.default):X(c,a,Zs,vt,Ht)}}}function Mm(c,a,d){return c!==void 0?c:a!==void 0?a:d!==void 0?d:void 0}function D_(c,a,d,y,C){return Mm(typeof d===C?y[d]:void 0,c.default,a.default)}function xy(c,a,d){if(em(d)!=="number")return Mm(c.default,a.default);const y=c.stops.length;if(y===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[y-1][0])return c.stops[y-1][1];const C=Z_(c.stops.map(N=>N[0]),d);return c.stops[C][1]}function Hy(c,a,d){const y=c.base!==void 0?c.base:1;if(em(d)!=="number")return Mm(c.default,a.default);const C=c.stops.length;if(C===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[C-1][0])return c.stops[C-1][1];const N=Z_(c.stops.map(qr=>qr[0]),d),X=function(qr,Zs,nl,ju){const Ku=ju-nl,ah=qr-nl;return Ku===0?0:Zs===1?ah/Ku:(Math.pow(Zs,ah)-1)/(Math.pow(Zs,Ku)-1)}(d,y,c.stops[N][0],c.stops[N+1][0]),vt=c.stops[N][1],Ht=c.stops[N+1][1];let Ui=M_[a.type]||bv;if(c.colorSpace&&c.colorSpace!=="rgb"){const qr=H_[c.colorSpace];Ui=(Zs,nl)=>qr.reverse(qr.interpolate(qr.forward(Zs),qr.forward(nl),X))}return typeof vt.evaluate=="function"?{evaluate(...qr){const Zs=vt.evaluate.apply(void 0,qr),nl=Ht.evaluate.apply(void 0,qr);if(Zs!==void 0&&nl!==void 0)return Ui(Zs,nl,X)}}:Ui(vt,Ht,X)}function y0(c,a,d){return a.type==="color"?d=Np.parse(d):a.type==="formatted"?d=bg.fromString(d.toString()):a.type==="resolvedImage"?d=kg.fromString(d.toString()):em(d)===a.type||a.type==="enum"&&a.values[d]||(d=void 0),Mm(d,c.default,a.default)}class Y_{constructor(a,d){this.expression=a,this._warningHistory={},this._evaluator=new By,this._defaultValue=d?function(y){return y.type==="color"&&(Gg(y.default)||Array.isArray(y.default))?new Np(0,0,0,0):y.type==="color"?Np.parse(y.default)||null:y.default===void 0?null:y.default}(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(a,d,y,C,N,X,vt,Ht){return this._evaluator.globals=a,this._evaluator.feature=d,this._evaluator.featureState=y,this._evaluator.canonical=C||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=X,this._evaluator.featureTileCoord=vt||null,this._evaluator.featureDistanceData=Ht||null,this.expression.evaluate(this._evaluator)}evaluate(a,d,y,C,N,X,vt,Ht){this._evaluator.globals=a,this._evaluator.feature=d||null,this._evaluator.featureState=y||null,this._evaluator.canonical=C||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=X||null,this._evaluator.featureTileCoord=vt||null,this._evaluator.featureDistanceData=Ht||null;try{const Ui=this.expression.evaluate(this._evaluator);if(Ui==null||typeof Ui=="number"&&Ui!=Ui)return this._defaultValue;if(this._enumValues&&!(Ui in this._enumValues))throw new wg(`Expected value to be one of ${Object.keys(this._enumValues).map(qr=>JSON.stringify(qr)).join(", ")}, but found ${JSON.stringify(Ui)} instead.`);return Ui}catch(Ui){return this._warningHistory[Ui.message]||(this._warningHistory[Ui.message]=!0,typeof console<"u"&&console.warn(Ui.message)),this._defaultValue}}}function Xy(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in W_}function e_(c,a){const d=new h0(W_,[],a?function(C){const N={color:mm,string:im,number:ep,enum:im,boolean:Jp,formatted:Vh,resolvedImage:rd};return C.type==="array"?od(N[C.value]||el,C.length):N[C.type]}(a):void 0),y=d.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Dg(new Y_(y,a)):Gm(d.errors)}class z0{constructor(a,d){this.kind=a,this._styleExpression=d,this.isStateDependent=a!=="constant"&&!d_(d.expression)}evaluateWithoutErrorHandling(a,d,y,C,N,X){return this._styleExpression.evaluateWithoutErrorHandling(a,d,y,C,N,X)}evaluate(a,d,y,C,N,X){return this._styleExpression.evaluate(a,d,y,C,N,X)}}class kp{constructor(a,d,y,C){this.kind=a,this.zoomStops=y,this._styleExpression=d,this.isStateDependent=a!=="camera"&&!d_(d.expression),this.interpolationType=C}evaluateWithoutErrorHandling(a,d,y,C,N,X){return this._styleExpression.evaluateWithoutErrorHandling(a,d,y,C,N,X)}evaluate(a,d,y,C,N,X){return this._styleExpression.evaluate(a,d,y,C,N,X)}interpolationFactor(a,d,y){return this.interpolationType?Qg.interpolationFactor(this.interpolationType,a,d,y):0}}function Up(c,a){if((c=e_(c,a)).result==="error")return c;const d=c.value.expression,y=q_(d);if(!y&&!ag(a))return Gm([new Pg("","data expressions not supported")]);const C=c0(d,["zoom","pitch","distance-from-center"]);if(!C&&!Jg(a))return Gm([new Pg("","zoom expressions not supported")]);const N=N0(d);return N||C?N instanceof Pg?Gm([N]):N instanceof Qg&&!k_(a)?Gm([new Pg("",'"interpolate" expressions cannot be used with this property')]):Dg(N?new kp(y?"camera":"composite",c.value,N.labels,N instanceof Qg?N.interpolation:void 0):new z0(y?"constant":"source",c.value)):Gm([new Pg("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class by{constructor(a,d){this._parameters=a,this._specification=d,Hg(this,Ig(this._parameters,this._specification))}static deserialize(a){return new by(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function N0(c){let a=null;if(c instanceof C_)a=N0(c.result);else if(c instanceof rv){for(const d of c.args)if(a=N0(d),a)break}else(c instanceof p_||c instanceof Qg)&&c.input instanceof Vg&&c.input.name==="zoom"&&(a=c);return a instanceof Pg||c.eachChild(d=>{const y=N0(d);y instanceof Pg?a=y:!a&&y?a=new Pg("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&y&&a!==y&&(a=new Pg("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}class pp{constructor(a,d,y,C){this.message=(a?`${a}: `:"")+y,C&&(this.identifier=C),d!=null&&d.__line__&&(this.line=d.__line__)}}function tg(c){const a=c.key,d=c.value,y=c.valueSpec||{},C=c.objectElementValidators||{},N=c.style,X=c.styleSpec;let vt=[];const Ht=em(d);if(Ht!=="object")return[new pp(a,d,`object expected, ${Ht} found`)];for(const Ui in d){const qr=Ui.split(".")[0],Zs=y[qr]||y["*"];let nl;C[qr]?nl=C[qr]:y[qr]?nl=Fg:C["*"]?nl=C["*"]:y["*"]&&(nl=Fg),nl?vt=vt.concat(nl({key:(a&&`${a}.`)+Ui,value:d[Ui],valueSpec:Zs,style:N,styleSpec:X,object:d,objectKey:Ui},d)):vt.push(new pp(a,d[Ui],`unknown property "${Ui}"`))}for(const Ui in y)C[Ui]||y[Ui].required&&y[Ui].default===void 0&&d[Ui]===void 0&&vt.push(new pp(a,d,`missing required property "${Ui}"`));return vt}function wv(c){const a=c.value,d=c.valueSpec,y=c.style,C=c.styleSpec,N=c.key,X=c.arrayElementValidator||Fg;if(em(a)!=="array")return[new pp(N,a,`array expected, ${em(a)} found`)];if(d.length&&a.length!==d.length)return[new pp(N,a,`array length ${d.length} expected, length ${a.length} found`)];if(d["min-length"]&&a.length<d["min-length"])return[new pp(N,a,`array length at least ${d["min-length"]} expected, length ${a.length} found`)];let vt={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};C.$version<7&&(vt.function=d.function),em(d.value)==="object"&&(vt=d.value);let Ht=[];for(let Ui=0;Ui<a.length;Ui++)Ht=Ht.concat(X({array:a,arrayIndex:Ui,value:a[Ui],valueSpec:vt,style:y,styleSpec:C,key:`${N}[${Ui}]`}));return Ht}function L_(c){const a=c.key,d=c.value,y=c.valueSpec;let C=em(d);if(C==="number"&&d!=d&&(C="NaN"),C!=="number")return[new pp(a,d,`number expected, ${C} found`)];if("minimum"in y){let N=y.minimum;if(em(y.minimum)==="array"&&(N=y.minimum[c.arrayIndex]),d<N)return[new pp(a,d,`${d} is less than the minimum value ${N}`)]}if("maximum"in y){let N=y.maximum;if(em(y.maximum)==="array"&&(N=y.maximum[c.arrayIndex]),d>N)return[new pp(a,d,`${d} is greater than the maximum value ${N}`)]}return[]}function Ev(c){const a=c.valueSpec,d=$m(c.value.type);let y,C,N,X={};const vt=d!=="categorical"&&c.value.property===void 0,Ht=!vt,Ui=em(c.value.stops)==="array"&&em(c.value.stops[0])==="array"&&em(c.value.stops[0][0])==="object",qr=tg({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ju){if(d==="identity")return[new pp(ju.key,ju.value,'identity function may not have a "stops" property')];let Ku=[];const ah=ju.value;return Ku=Ku.concat(wv({key:ju.key,value:ah,valueSpec:ju.valueSpec,style:ju.style,styleSpec:ju.styleSpec,arrayElementValidator:Zs})),em(ah)==="array"&&ah.length===0&&Ku.push(new pp(ju.key,ah,"array must have at least one stop")),Ku},default:function(ju){return Fg({key:ju.key,value:ju.value,valueSpec:a,style:ju.style,styleSpec:ju.styleSpec})}}});return d==="identity"&&vt&&qr.push(new pp(c.key,c.value,'missing required property "property"')),d==="identity"||c.value.stops||qr.push(new pp(c.key,c.value,'missing required property "stops"')),d==="exponential"&&c.valueSpec.expression&&!k_(c.valueSpec)&&qr.push(new pp(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(Ht&&!ag(c.valueSpec)?qr.push(new pp(c.key,c.value,"property functions not supported")):vt&&!Jg(c.valueSpec)&&qr.push(new pp(c.key,c.value,"zoom functions not supported"))),d!=="categorical"&&!Ui||c.value.property!==void 0||qr.push(new pp(c.key,c.value,'"property" property is required')),qr;function Zs(ju){let Ku=[];const ah=ju.value,Eh=ju.key;if(em(ah)!=="array")return[new pp(Eh,ah,`array expected, ${em(ah)} found`)];if(ah.length!==2)return[new pp(Eh,ah,`array length 2 expected, length ${ah.length} found`)];if(Ui){if(em(ah[0])!=="object")return[new pp(Eh,ah,`object expected, ${em(ah[0])} found`)];if(ah[0].zoom===void 0)return[new pp(Eh,ah,"object stop key must have zoom")];if(ah[0].value===void 0)return[new pp(Eh,ah,"object stop key must have value")];const zh=$m(ah[0].zoom);if(typeof zh!="number")return[new pp(Eh,ah[0].zoom,"stop zoom values must be numbers")];if(N&&N>zh)return[new pp(Eh,ah[0].zoom,"stop zoom values must appear in ascending order")];zh!==N&&(N=zh,C=void 0,X={}),Ku=Ku.concat(tg({key:`${Eh}[0]`,value:ah[0],valueSpec:{zoom:{}},style:ju.style,styleSpec:ju.styleSpec,objectElementValidators:{zoom:L_,value:nl}}))}else Ku=Ku.concat(nl({key:`${Eh}[0]`,value:ah[0],valueSpec:{},style:ju.style,styleSpec:ju.styleSpec},ah));return Xy(I_(ah[1]))?Ku.concat([new pp(`${Eh}[1]`,ah[1],"expressions are not allowed in function stops.")]):Ku.concat(Fg({key:`${Eh}[1]`,value:ah[1],valueSpec:a,style:ju.style,styleSpec:ju.styleSpec}))}function nl(ju,Ku){const ah=em(ju.value),Eh=$m(ju.value),zh=ju.value!==null?ju.value:Ku;if(y){if(ah!==y)return[new pp(ju.key,zh,`${ah} stop domain type must match previous stop domain type ${y}`)]}else y=ah;if(ah!=="number"&&ah!=="string"&&ah!=="boolean"&&typeof Eh!="number"&&typeof Eh!="string"&&typeof Eh!="boolean")return[new pp(ju.key,zh,"stop domain value must be a number, string, or boolean")];if(ah!=="number"&&d!=="categorical"){let Yh=`number expected, ${ah} found`;return ag(a)&&d===void 0&&(Yh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pp(ju.key,zh,Yh)]}return d!=="categorical"||ah!=="number"||typeof Eh=="number"&&isFinite(Eh)&&Math.floor(Eh)===Eh?d!=="categorical"&&ah==="number"&&typeof Eh=="number"&&typeof C=="number"&&C!==void 0&&Eh<C?[new pp(ju.key,zh,"stop domain values must appear in ascending order")]:(C=Eh,d==="categorical"&&Eh in X?[new pp(ju.key,zh,"stop domain values must be unique")]:(X[Eh]=!0,[])):[new pp(ju.key,zh,`integer expected, found ${String(Eh)}`)]}}function Wy(c){const a=(c.expressionContext==="property"?Up:e_)(I_(c.value),c.valueSpec);if(a.result==="error")return a.value.map(y=>new pp(`${c.key}${y.key}`,c.value,y.message));const d=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!d.outputDefined())return[new pp(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!d_(d))return[new pp(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return pg(d,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!c0(d,["zoom","feature-state"]))return[new pp(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!q_(d))return[new pp(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pg(c,a){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const C of a.valueSpec.expression.parameters)d.delete(C);if(d.size===0)return[];const y=[];return c instanceof Vg&&d.has(c.name)?[new pp(a.key,a.value,`["${c.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(c.eachChild(C=>{y.push(...pg(C,a))}),y)}function mg(c){const a=c.key,d=c.value,y=c.valueSpec,C=[];return Array.isArray(y.values)?y.values.indexOf($m(d))===-1&&C.push(new pp(a,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf($m(d))===-1&&C.push(new pp(a,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),C}function Fv(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!Fv(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function v0(c,a="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fv(c)||(c=sv(c));const d=c;let y=!0;try{y=function(Ui){if(!Lg(Ui))return Ui;let qr=I_(Ui);return wy(qr),qr=x0(qr),qr}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}const C=Pd[`filter_${a}`],N=e_(y,C);let X=null;if(N.result==="error")throw new Error(N.value.map(Ui=>`${Ui.key}: ${Ui.message}`).join(", "));X=(Ui,qr,Zs)=>N.value.evaluate(Ui,qr,{},Zs);let vt=null,Ht=null;if(y!==d){const Ui=e_(d,C);if(Ui.result==="error")throw new Error(Ui.value.map(qr=>`${qr.key}: ${qr.message}`).join(", "));vt=(qr,Zs,nl,ju,Ku)=>Ui.value.evaluate(qr,Zs,{},nl,void 0,void 0,ju,Ku),Ht=!q_(Ui.value.expression)}return{filter:X,dynamicFilter:vt||void 0,needGeometry:$v(y),needFeature:!!Ht}}function x0(c){if(!Array.isArray(c))return c;const a=function(d){if(b0.has(d[0])){for(let y=1;y<d.length;y++)if(Lg(d[y]))return!0}return d}(c);return a===!0?a:a.map(d=>x0(d))}function wy(c){let a=!1;const d=[];if(c[0]==="case"){for(let y=1;y<c.length-1;y+=2)a=a||Lg(c[y]),d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="match"){a=a||Lg(c[1]);for(let y=2;y<c.length-1;y+=2)d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="step"){a=a||Lg(c[1]);for(let y=1;y<c.length-1;y+=2)d.push(c[y+1])}a&&(c.length=0,c.push("any",...d));for(let y=1;y<c.length;y++)wy(c[y])}function Lg(c){if(!Array.isArray(c))return!1;if((a=c[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let d=1;d<c.length;d++)if(Lg(c[d]))return!0;return!1}const b0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Sv(c,a){return c<a?-1:c>a?1:0}function $v(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if($v(c[a]))return!0;return!1}function sv(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?av(c[1],c[2],"=="):a==="!="?w0(av(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?av(c[1],c[2],a):a==="any"?(d=c.slice(1),["any"].concat(d.map(sv))):a==="all"?["all"].concat(c.slice(1).map(sv)):a==="none"?["all"].concat(c.slice(1).map(sv).map(w0)):a==="in"?F0(c[1],c.slice(2)):a==="!in"?w0(F0(c[1],c.slice(2))):a==="has"?Uv(c[1]):a==="!has"?w0(Uv(c[1])):a!=="within"||c;var d}function av(c,a,d){switch(c){case"$type":return[`filter-type-${d}`,a];case"$id":return[`filter-id-${d}`,a];default:return[`filter-${d}`,c,a]}}function F0(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(d=>typeof d!=typeof a[0])?["filter-in-large",c,["literal",a.sort(Sv)]]:["filter-in-small",c,["literal",a]]}}function Uv(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function w0(c){return["!",c]}function Tv(c){return Fv(I_(c.value))?Wy(Hg({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Vv(c)}function Vv(c){const a=c.value,d=c.key;if(em(a)!=="array")return[new pp(d,a,`array expected, ${em(a)} found`)];const y=c.styleSpec;let C,N=[];if(a.length<1)return[new pp(d,a,"filter array must have at least 1 element")];switch(N=N.concat(mg({key:`${d}[0]`,value:a[0],valueSpec:y.filter_operator,style:c.style,styleSpec:c.styleSpec})),$m(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&$m(a[1])==="$type"&&N.push(new pp(d,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&N.push(new pp(d,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(C=em(a[1]),C!=="string"&&N.push(new pp(`${d}[1]`,a[1],`string expected, ${C} found`)));for(let X=2;X<a.length;X++)C=em(a[X]),$m(a[1])==="$type"?N=N.concat(mg({key:`${d}[${X}]`,value:a[X],valueSpec:y.geometry_type,style:c.style,styleSpec:c.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&N.push(new pp(`${d}[${X}]`,a[X],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let X=1;X<a.length;X++)N=N.concat(Vv({key:`${d}[${X}]`,value:a[X],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":C=em(a[1]),a.length!==2?N.push(new pp(d,a,`filter array for "${a[0]}" operator must have 2 elements`)):C!=="string"&&N.push(new pp(`${d}[1]`,a[1],`string expected, ${C} found`));break;case"within":C=em(a[1]),a.length!==2?N.push(new pp(d,a,`filter array for "${a[0]}" operator must have 2 elements`)):C!=="object"&&N.push(new pp(`${d}[1]`,a[1],`object expected, ${C} found`))}return N}function $0(c,a){const d=c.key,y=c.style,C=c.styleSpec,N=c.value,X=c.objectKey,vt=C[`${a}_${c.layerType}`];if(!vt)return[];const Ht=X.match(/^(.*)-transition$/);if(a==="paint"&&Ht&&vt[Ht[1]]&&vt[Ht[1]].transition)return Fg({key:d,value:N,valueSpec:C.transition,style:y,styleSpec:C});const Ui=c.valueSpec||vt[X];if(!Ui)return[new pp(d,N,`unknown property "${X}"`)];let qr;if(em(N)==="string"&&ag(Ui)&&!Ui.tokens&&(qr=/^{([^}]+)}$/.exec(N))){const nl=`\`{ "type": "identity", "property": ${qr?JSON.stringify(qr[1]):'"_"'} }\``;return[new pp(d,N,`"${X}" does not support interpolation syntax
Use an identity property function instead: ${nl}.`)]}const Zs=[];return c.layerType==="symbol"&&(X==="text-field"&&y&&!y.glyphs&&Zs.push(new pp(d,N,'use of "text-field" requires a style "glyphs" property')),X==="text-font"&&Gg(I_(N))&&$m(N.type)==="identity"&&Zs.push(new pp(d,N,'"text-font" does not support identity functions'))),Zs.concat(Fg({key:c.key,value:N,valueSpec:Ui,style:y,styleSpec:C,expressionContext:"property",propertyType:a,propertyKey:X}))}function Gv(c){return $0(c,"paint")}function Ey(c){return $0(c,"layout")}function lv(c){let a=[];const d=c.value,y=c.key,C=c.style,N=c.styleSpec;d.type||d.ref||a.push(new pp(y,d,'either "type" or "ref" is required'));let X=$m(d.type);const vt=$m(d.ref);if(d.id){const Ht=$m(d.id);for(let Ui=0;Ui<c.arrayIndex;Ui++){const qr=C.layers[Ui];$m(qr.id)===Ht&&a.push(new pp(y,d.id,`duplicate layer id "${d.id}", previously used at line ${qr.id.__line__}`))}}if("ref"in d){let Ht;["type","source","source-layer","filter","layout"].forEach(Ui=>{Ui in d&&a.push(new pp(y,d[Ui],`"${Ui}" is prohibited for ref layers`))}),C.layers.forEach(Ui=>{$m(Ui.id)===vt&&(Ht=Ui)}),Ht?Ht.ref?a.push(new pp(y,d.ref,"ref cannot reference another ref layer")):X=$m(Ht.type):typeof vt=="string"&&a.push(new pp(y,d.ref,`ref layer "${vt}" not found`))}else if(X!=="background"&&X!=="sky")if(d.source){const Ht=C.sources&&C.sources[d.source],Ui=Ht&&$m(Ht.type);Ht?Ui==="vector"&&X==="raster"?a.push(new pp(y,d.source,`layer "${d.id}" requires a raster source`)):Ui==="raster"&&X!=="raster"?a.push(new pp(y,d.source,`layer "${d.id}" requires a vector source`)):Ui!=="vector"||d["source-layer"]?Ui==="raster-dem"&&X!=="hillshade"?a.push(new pp(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):X!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||Ui==="geojson"&&Ht.lineMetrics||a.push(new pp(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new pp(y,d,`layer "${d.id}" must specify a "source-layer"`)):a.push(new pp(y,d.source,`source "${d.source}" not found`))}else a.push(new pp(y,d,'missing required property "source"'));return a=a.concat(tg({key:y,value:d,valueSpec:N.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fg({key:`${y}.type`,value:d.type,valueSpec:N.layer.type,style:c.style,styleSpec:c.styleSpec,object:d,objectKey:"type"}),filter:Ht=>Tv(Hg({layerType:X},Ht)),layout:Ht=>tg({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>Ey(Hg({layerType:X},Ui))}}),paint:Ht=>tg({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>Gv(Hg({layerType:X},Ui))}})}})),a}function E0(c){const a=c.value,d=c.key,y=em(a);return y!=="string"?[new pp(d,a,`string expected, ${y} found`)]:[]}const cv={promoteId:function({key:c,value:a}){if(em(a)==="string")return E0({key:c,value:a});{const d=[];for(const y in a)d.push(...E0({key:`${c}.${y}`,value:a[y]}));return d}}};function S0(c){const a=c.value,d=c.key,y=c.styleSpec,C=c.style;if(!a.type)return[new pp(d,a,'"type" is required')];const N=$m(a.type);let X;switch(N){case"vector":case"raster":case"raster-dem":return X=tg({key:d,value:a,valueSpec:y[`source_${N.replace("-","_")}`],style:c.style,styleSpec:y,objectElementValidators:cv}),X;case"geojson":if(X=tg({key:d,value:a,valueSpec:y.source_geojson,style:C,styleSpec:y,objectElementValidators:cv}),a.cluster)for(const vt in a.clusterProperties){const[Ht,Ui]=a.clusterProperties[vt],qr=typeof Ht=="string"?[Ht,["accumulated"],["get",vt]]:Ht;X.push(...Wy({key:`${d}.${vt}.map`,value:Ui,expressionContext:"cluster-map"})),X.push(...Wy({key:`${d}.${vt}.reduce`,value:qr,expressionContext:"cluster-reduce"}))}return X;case"video":return tg({key:d,value:a,valueSpec:y.source_video,style:C,styleSpec:y});case"image":return tg({key:d,value:a,valueSpec:y.source_image,style:C,styleSpec:y});case"canvas":return[new pp(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mg({key:`${d}.type`,value:a.type,valueSpec:{values:jv(y)},style:C,styleSpec:y})}}function jv(c){return c.source.reduce((a,d)=>{const y=c[d];return y.type.type==="enum"&&(a=a.concat(Object.keys(y.type.values))),a},[])}function c1(c){const a=c.value,d=c.styleSpec,y=d.light,C=c.style;let N=[];const X=em(a);if(a===void 0)return N;if(X!=="object")return N=N.concat([new pp("light",a,`object expected, ${X} found`)]),N;for(const vt in a){const Ht=vt.match(/^(.*)-transition$/);N=N.concat(Ht&&y[Ht[1]]&&y[Ht[1]].transition?Fg({key:vt,value:a[vt],valueSpec:d.transition,style:C,styleSpec:d}):y[vt]?Fg({key:vt,value:a[vt],valueSpec:y[vt],style:C,styleSpec:d}):[new pp(vt,a[vt],`unknown property "${vt}"`)])}return N}function Iv(c){const a=c.value,d=c.key,y=c.style,C=c.styleSpec,N=C.terrain;let X=[];const vt=em(a);if(a===void 0)return X;if(vt!=="object")return X=X.concat([new pp("terrain",a,`object expected, ${vt} found`)]),X;for(const Ht in a){const Ui=Ht.match(/^(.*)-transition$/);X=X.concat(Ui&&N[Ui[1]]&&N[Ui[1]].transition?Fg({key:Ht,value:a[Ht],valueSpec:C.transition,style:y,styleSpec:C}):N[Ht]?Fg({key:Ht,value:a[Ht],valueSpec:N[Ht],style:y,styleSpec:C}):[new pp(Ht,a[Ht],`unknown property "${Ht}"`)])}if(a.source){const Ht=y.sources&&y.sources[a.source],Ui=Ht&&$m(Ht.type);Ht?Ui!=="raster-dem"&&X.push(new pp(d,a.source,`terrain cannot be used with a source of type ${String(Ui)}, it only be used with a "raster-dem" source type`)):X.push(new pp(d,a.source,`source "${a.source}" not found`))}else X.push(new pp(d,a,'terrain is missing required property "source"'));return X}function Mv(c){const a=c.value,d=c.style,y=c.styleSpec,C=y.fog;let N=[];const X=em(a);if(a===void 0)return N;if(X!=="object")return N=N.concat([new pp("fog",a,`object expected, ${X} found`)]),N;for(const vt in a){const Ht=vt.match(/^(.*)-transition$/);N=N.concat(Ht&&C[Ht[1]]&&C[Ht[1]].transition?Fg({key:vt,value:a[vt],valueSpec:y.transition,style:d,styleSpec:y}):C[vt]?Fg({key:vt,value:a[vt],valueSpec:C[vt],style:d,styleSpec:y}):[new pp(vt,a[vt],`unknown property "${vt}"`)])}return N}const uv={"*":()=>[],array:wv,boolean:function(c){const a=c.value,d=c.key,y=em(a);return y!=="boolean"?[new pp(d,a,`boolean expected, ${y} found`)]:[]},number:L_,color:function(c){const a=c.key,d=c.value,y=em(d);return y!=="string"?[new pp(a,d,`color expected, ${y} found`)]:lp(d)===null?[new pp(a,d,`color expected, "${d}" found`)]:[]},enum:mg,filter:Tv,function:Ev,layer:lv,object:tg,source:S0,light:c1,terrain:Iv,fog:Mv,string:E0,formatted:function(c){return E0(c).length===0?[]:Wy(c)},resolvedImage:function(c){return E0(c).length===0?[]:Wy(c)},projection:function(c){const a=c.value,d=c.styleSpec,y=d.projection,C=c.style;let N=[];const X=em(a);if(X==="object")for(const vt in a)N=N.concat(Fg({key:vt,value:a[vt],valueSpec:y[vt],style:C,styleSpec:d}));else X!=="string"&&(N=N.concat([new pp("projection",a,`object or string expected, ${X} found`)]));return N}};function Fg(c){const a=c.value,d=c.valueSpec,y=c.styleSpec;return d.expression&&Gg($m(a))?Ev(c):d.expression&&Xy(I_(a))?Wy(c):d.type&&uv[d.type]?uv[d.type](c):tg(Hg({},c,{valueSpec:d.type?y[d.type]:d}))}function R1(c){const a=c.value,d=c.key,y=E0(c);return y.length||(a.indexOf("{fontstack}")===-1&&y.push(new pp(d,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&y.push(new pp(d,a,'"glyphs" url must include a "{range}" token'))),y}function T0(c,a=Pd){return Sy(Fg({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,objectElementValidators:{glyphs:R1,"*":()=>[]}}))}const Cv=c=>Sy(Gv(c)),U0=c=>Sy(Ey(c));function Sy(c){return c.slice().sort((a,d)=>a.line&&d.line?a.line-d.line:0)}function qv(c,a){let d=!1;if(a&&a.length)for(const y of a)c.fire(new Vp(new Error(y.message))),d=!0;return d}var Ty=Iy;function Iy(c,a,d){var y=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var C=new Int32Array(this.arrayBuffer);c=C[0],this.d=(a=C[1])+2*(d=C[2]);for(var N=0;N<this.d*this.d;N++){var X=C[3+N],vt=C[3+N+1];y.push(X===vt?null:C.subarray(X,vt))}var Ht=C[3+y.length+1];this.keys=C.subarray(C[3+y.length],Ht),this.bboxes=C.subarray(Ht),this.insert=this._insertReadonly}else{this.d=a+2*d;for(var Ui=0;Ui<this.d*this.d;Ui++)y.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=c,this.padding=d,this.scale=a/c,this.uid=0;var qr=d/a*c;this.min=-qr,this.max=c+qr}Iy.prototype.insert=function(c,a,d,y,C){this._forEachCell(a,d,y,C,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(C)},Iy.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Iy.prototype._insertCell=function(c,a,d,y,C,N){this.cells[C].push(N)},Iy.prototype.query=function(c,a,d,y,C){var N=this.min,X=this.max;if(c<=N&&a<=N&&X<=d&&X<=y&&!C)return Array.prototype.slice.call(this.keys);var vt=[];return this._forEachCell(c,a,d,y,this._queryCell,vt,{},C),vt},Iy.prototype._queryCell=function(c,a,d,y,C,N,X,vt){var Ht=this.cells[C];if(Ht!==null)for(var Ui=this.keys,qr=this.bboxes,Zs=0;Zs<Ht.length;Zs++){var nl=Ht[Zs];if(X[nl]===void 0){var ju=4*nl;(vt?vt(qr[ju+0],qr[ju+1],qr[ju+2],qr[ju+3]):c<=qr[ju+2]&&a<=qr[ju+3]&&d>=qr[ju+0]&&y>=qr[ju+1])?(X[nl]=!0,N.push(Ui[nl])):X[nl]=!1}}},Iy.prototype._forEachCell=function(c,a,d,y,C,N,X,vt){for(var Ht=this._convertToCellCoord(c),Ui=this._convertToCellCoord(a),qr=this._convertToCellCoord(d),Zs=this._convertToCellCoord(y),nl=Ht;nl<=qr;nl++)for(var ju=Ui;ju<=Zs;ju++){var Ku=this.d*ju+nl;if((!vt||vt(this._convertFromCellCoord(nl),this._convertFromCellCoord(ju),this._convertFromCellCoord(nl+1),this._convertFromCellCoord(ju+1)))&&C.call(this,c,a,d,y,Ku,N,X,vt))return}},Iy.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},Iy.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},Iy.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,a=3+this.cells.length+1+1,d=0,y=0;y<this.cells.length;y++)d+=this.cells[y].length;var C=new Int32Array(a+d+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;for(var N=a,X=0;X<c.length;X++){var vt=c[X];C[3+X]=N,C.set(vt,N),N+=vt.length}return C[3+c.length]=N,C.set(this.keys,N),C[3+c.length+1]=N+=this.keys.length,C.set(this.bboxes,N),N+=this.bboxes.length,C.buffer};const Zv={};function Ip(c,a,d={}){Object.defineProperty(c,"_classRegistryKey",{value:a,writeable:!1}),Zv[a]={klass:c,omit:d.omit||[]}}Ip(Object,"Object"),Ty.serialize=function(c,a){const d=c.toArrayBuffer();return a&&a.push(d),{buffer:d}},Ty.deserialize=function(c){return new Ty(c.buffer)},Object.defineProperty(Ty,"name",{value:"Grid"}),Ip(Ty,"Grid"),Ip(Np,"Color"),Ip(Error,"Error"),Ip(Cp,"AJAXError"),Ip(kg,"ResolvedImage"),Ip(by,"StylePropertyFunction"),Ip(Y_,"StyleExpression",{omit:["_evaluator"]}),Ip(kp,"ZoomDependentExpression"),Ip(z0,"ZoomConstantExpression"),Ip(Vg,"CompoundExpression",{omit:["_evaluate"]});for(const c in W_)Zv[W_[c]._classRegistryKey]||Ip(W_[c],`Expression${c}`);function O1(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function K_(c){return x.ImageBitmap&&c instanceof x.ImageBitmap}function Y(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(O1(c)||K_(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const d=c;return a&&a.push(d.buffer),d}if(c instanceof x.ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const d=[];for(const y of c)d.push(Y(y,a));return d}if(typeof c=="object"){const d=c.constructor,y=d._classRegistryKey;if(!y)throw new Error(`can't serialize object of unregistered class ${y}`);const C=d.serialize?d.serialize(c,a):{};if(!d.serialize){for(const N in c)c.hasOwnProperty(N)&&(Zv[y].omit.indexOf(N)>=0||(C[N]=Y(c[N],a)));c instanceof Error&&(C.message=c.message)}if(C.$name)throw new Error("$name property is reserved for worker serialization logic.");return y!=="Object"&&(C.$name=y),C}throw new Error("can't serialize object of type "+typeof c)}function g(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||O1(c)||K_(c)||ArrayBuffer.isView(c)||c instanceof x.ImageData)return c;if(Array.isArray(c))return c.map(g);if(typeof c=="object"){const a=c.$name||"Object",{klass:d}=Zv[a];if(!d)throw new Error(`can't deserialize unregistered class ${a}`);if(d.deserialize)return d.deserialize(c);const y=Object.create(d.prototype);for(const C of Object.keys(c))C!=="$name"&&(y[C]=g(c[C]));return y}throw new Error("can't deserialize object of type "+typeof c)}const A=c=>c>=1536&&c<=1791,q=c=>c>=1872&&c<=1919,ze=c=>c>=2208&&c<=2303,Ft=c=>c>=11904&&c<=12031,Gn=c=>c>=12032&&c<=12255,ls=c=>c>=12272&&c<=12287,$s=c=>c>=12288&&c<=12351,ol=c=>c>=12352&&c<=12447,nh=c=>c>=12448&&c<=12543,ih=c=>c>=12544&&c<=12591,ph=c=>c>=12704&&c<=12735,Lh=c=>c>=12736&&c<=12783,Bh=c=>c>=12784&&c<=12799,Ch=c=>c>=12800&&c<=13055,Kh=c=>c>=13056&&c<=13311,fd=c=>c>=13312&&c<=19903,ud=c=>c>=19968&&c<=40959,jh=c=>c>=40960&&c<=42127,Sd=c=>c>=42128&&c<=42191,Vd=c=>c>=44032&&c<=55215,Wd=c=>c>=63744&&c<=64255,Cf=c=>c>=64336&&c<=65023,Of=c=>c>=65040&&c<=65055,L=c=>c>=65072&&c<=65103,u=c=>c>=65104&&c<=65135,E=c=>c>=65136&&c<=65279,B=c=>c>=65280&&c<=65519;function ge(c){for(const a of c)if(Bn(a.charCodeAt(0)))return!0;return!1}function St(c){for(const a of c)if(!_n(a.charCodeAt(0)))return!1;return!0}function _n(c){return!(A(c)||q(c)||ze(c)||Cf(c)||E(c))}function Bn(c){return!(c!==746&&c!==747&&(c<4352||!(ph(c)||ih(c)||L(c)&&!(c>=65097&&c<=65103)||Wd(c)||Kh(c)||Ft(c)||Lh(c)||!(!$s(c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||fd(c)||ud(c)||Ch(c)||(a=>a>=12592&&a<=12687)(c)||(a=>a>=43360&&a<=43391)(c)||(a=>a>=55216&&a<=55295)(c)||(a=>a>=4352&&a<=4607)(c)||Vd(c)||ol(c)||ls(c)||(a=>a>=12688&&a<=12703)(c)||Gn(c)||Bh(c)||nh(c)&&c!==12540||!(!B(c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!u(c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||(a=>a>=5120&&a<=5759)(c)||(a=>a>=6320&&a<=6399)(c)||Of(c)||(a=>a>=19904&&a<=19967)(c)||jh(c)||Sd(c))))}function ss(c){return!(Bn(c)||function(a){return!!((d=>d>=128&&d<=255)(a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||(d=>d>=8192&&d<=8303)(a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||(d=>d>=8448&&d<=8527)(a)||(d=>d>=8528&&d<=8591)(a)||(d=>d>=8960&&d<=9215)(a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||(d=>d>=9216&&d<=9279)(a)&&a!==9251||(d=>d>=9280&&d<=9311)(a)||(d=>d>=9312&&d<=9471)(a)||(d=>d>=9632&&d<=9727)(a)||(d=>d>=9728&&d<=9983)(a)&&!(a>=9754&&a<=9759)||(d=>d>=11008&&d<=11263)(a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||$s(a)||nh(a)||(d=>d>=57344&&d<=63743)(a)||L(a)||u(a)||B(a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function tl(c){return c>=1424&&c<=2303||Cf(c)||E(c)}function il(c,a){return!(!a&&tl(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||(d=>d>=6016&&d<=6143)(c))}function Qu(c){for(const a of c)if(tl(a.charCodeAt(0)))return!0;return!1}const fh="deferred",wh="loading",Th="loaded";let Sh=null,Ih="unavailable",hh=null;const Oh=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Ih="error"),Sh&&Sh(c)};function Rh(){Nh.fire(new mp("pluginStateChange",{pluginStatus:Ih,pluginURL:hh}))}const Nh=new om,qh=function(){return Ih},$h=function(){if(Ih!==fh||!hh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ih=wh,Rh(),hh&&Yf({url:hh},c=>{c?Oh(c):(Ih=Th,Rh())})},Hh={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ih===Th||Hh.applyArabicShaping!=null,isLoading:()=>Ih===wh,setState(c){Ih=c.pluginStatus,hh=c.pluginURL},isParsed:()=>Hh.applyArabicShaping!=null&&Hh.processBidirectionalText!=null&&Hh.processStyledBidirectionalText!=null,getPluginURL:()=>hh};class ld{constructor(a,d){this.zoom=a,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.transition=d.transition,this.pitch=d.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(a){return function(d,y){for(const C of d)if(!il(C.charCodeAt(0),y))return!1;return!0}(a,Hh.isLoaded())}}class xd{constructor(a,d){this.property=a,this.value=d,this.expression=function(y,C){if(Gg(y))return new by(y,C);if(Xy(y)){const N=Up(y,C);if(N.result==="error")throw new Error(N.value.map(X=>`${X.key}: ${X.message}`).join(", "));return N.value}{let N=y;return typeof y=="string"&&C.type==="color"&&(N=Np.parse(y)),{kind:"constant",evaluate:()=>N}}}(d===void 0?a.specification.default:d,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,d,y){return this.property.possiblyEvaluate(this,a,d,y)}}class gd{constructor(a){this.property=a,this.value=new xd(a,void 0)}transitioned(a,d){return new _d(this.property,this.value,d,md({},a.transition,this.transition),a.now)}untransitioned(){return new _d(this.property,this.value,null,{},0)}}class Vf{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return td(this._values[a].value.value)}setValue(a,d){this._values.hasOwnProperty(a)||(this._values[a]=new gd(this._values[a].property)),this._values[a].value=new xd(this._values[a].property,d===null?void 0:td(d))}getTransition(a){return td(this._values[a].transition)}setTransition(a,d){this._values.hasOwnProperty(a)||(this._values[a]=new gd(this._values[a].property)),this._values[a].transition=td(d)||void 0}serialize(){const a={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(a[d]=y);const C=this.getTransition(d);C!==void 0&&(a[`${d}-transition`]=C)}return a}transitioned(a,d){const y=new Mf(this._properties);for(const C of Object.keys(this._values))y._values[C]=this._values[C].transitioned(a,d._values[C]);return y}untransitioned(){const a=new Mf(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].untransitioned();return a}}class _d{constructor(a,d,y,C,N){const X=C.delay||0,vt=C.duration||0;N=N||0,this.property=a,this.value=d,this.begin=N+X,this.end=this.begin+vt,a.specification.transition&&(C.delay||C.duration)&&(this.prior=y)}possiblyEvaluate(a,d,y){const C=a.now||0,N=this.value.possiblyEvaluate(a,d,y),X=this.prior;if(X){if(C>this.end)return this.prior=null,N;if(this.value.isDataDriven())return this.prior=null,N;if(C<this.begin)return X.possiblyEvaluate(a,d,y);{const vt=(C-this.begin)/(this.end-this.begin);return this.property.interpolate(X.possiblyEvaluate(a,d,y),N,xh(vt))}}return N}}class Mf{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,d,y){const C=new Md(this._properties);for(const N of Object.keys(this._values))C._values[N]=this._values[N].possiblyEvaluate(a,d,y);return C}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Ud{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}getValue(a){return td(this._values[a].value)}setValue(a,d){this._values[a]=new xd(this._values[a].property,d===null?void 0:td(d))}serialize(){const a={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(a[d]=y)}return a}possiblyEvaluate(a,d,y){const C=new Md(this._properties);for(const N of Object.keys(this._values))C._values[N]=this._values[N].possiblyEvaluate(a,d,y);return C}}class Lf{constructor(a,d,y){this.property=a,this.value=d,this.parameters=y}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,d,y,C){return this.property.evaluate(this.value,this.parameters,a,d,y,C)}}class Md{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class pd{constructor(a){this.specification=a}possiblyEvaluate(a,d){return a.expression.evaluate(d)}interpolate(a,d,y){const C=M_[this.specification.type];return C?C(a,d,y):a}}class Bd{constructor(a,d){this.specification=a,this.overrides=d}possiblyEvaluate(a,d,y,C){return new Lf(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(d,null,{},y,C)}:a.expression,d)}interpolate(a,d,y){if(a.value.kind!=="constant"||d.value.kind!=="constant")return a;if(a.value.value===void 0||d.value.value===void 0)return new Lf(this,{kind:"constant",value:void 0},a.parameters);const C=M_[this.specification.type];return C?new Lf(this,{kind:"constant",value:C(a.value.value,d.value.value,y)},a.parameters):a}evaluate(a,d,y,C,N,X){return a.kind==="constant"?a.value:a.evaluate(d,y,C,N,X)}}class mf{constructor(a){this.specification=a}possiblyEvaluate(a,d,y,C){return!!a.expression.evaluate(d,null,{},y,C)}interpolate(){return!1}}class Bf{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const d=new ld(0,{});for(const y in a){const C=a[y];C.specification.overridable&&this.overridableProperties.push(y);const N=this.defaultPropertyValues[y]=new xd(C,void 0),X=this.defaultTransitionablePropertyValues[y]=new gd(C);this.defaultTransitioningPropertyValues[y]=X.untransitioned(),this.defaultPossiblyEvaluatedValues[y]=N.possiblyEvaluate(d)}}}function Dp(c,a){return 256*(c=Uh(Math.floor(c),0,255))+Uh(Math.floor(a),0,255)}Ip(Bd,"DataDrivenProperty"),Ip(pd,"DataConstantProperty"),Ip(mf,"ColorRampProperty");const rm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Mp{constructor(a,d){this._structArray=a,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xp{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,d){return a._trim(),d&&(a.isTransferred=!0,d.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const d=Object.create(this.prototype);return d.arrayBuffer=a.arrayBuffer,d.length=a.length,d.capacity=a.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lp(c,a=1){let d=0,y=0;return{members:c.map(C=>{const N=rm[C.type].BYTES_PER_ELEMENT,X=d=dm(d,Math.max(a,N)),vt=C.components||1;return y=Math.max(y,N),d+=N*vt,{name:C.name,type:C.type,components:vt,offset:X}}),size:dm(d,Math.max(y,a)),alignment:a}}function dm(c,a){return Math.ceil(c/a)*a}class Fp extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d){const y=this.length;return this.resize(y+1),this.emplace(y,a,d)}emplace(a,d,y){const C=2*a;return this.int16[C+0]=d,this.int16[C+1]=y,a}}Fp.prototype.bytesPerElement=4,Ip(Fp,"StructArrayLayout2i4");class km extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,y){const C=this.length;return this.resize(C+1),this.emplace(C,a,d,y)}emplace(a,d,y,C){const N=3*a;return this.int16[N+0]=d,this.int16[N+1]=y,this.int16[N+2]=C,a}}km.prototype.bytesPerElement=6,Ip(km,"StructArrayLayout3i6");class Am extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,y,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,d,y,C)}emplace(a,d,y,C,N){const X=4*a;return this.int16[X+0]=d,this.int16[X+1]=y,this.int16[X+2]=C,this.int16[X+3]=N,a}}Am.prototype.bytesPerElement=8,Ip(Am,"StructArrayLayout4i8");class jm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,a,d,y,C,N,X,vt)}emplace(a,d,y,C,N,X,vt,Ht){const Ui=6*a,qr=12*a,Zs=3*a;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.uint8[qr+4]=C,this.uint8[qr+5]=N,this.uint8[qr+6]=X,this.uint8[qr+7]=vt,this.float32[Zs+2]=Ht,a}}jm.prototype.bytesPerElement=12,Ip(jm,"StructArrayLayout2i4ub1f12");class Fm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,d,y,C)}emplace(a,d,y,C,N){const X=4*a;return this.float32[X+0]=d,this.float32[X+1]=y,this.float32[X+2]=C,this.float32[X+3]=N,a}}Fm.prototype.bytesPerElement=16,Ip(Fm,"StructArrayLayout4f16");class gg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N){const X=this.length;return this.resize(X+1),this.emplace(X,a,d,y,C,N)}emplace(a,d,y,C,N,X){const vt=6*a,Ht=3*a;return this.uint16[vt+0]=d,this.uint16[vt+1]=y,this.uint16[vt+2]=C,this.uint16[vt+3]=N,this.float32[Ht+2]=X,a}}gg.prototype.bytesPerElement=12,Ip(gg,"StructArrayLayout4ui1f12");class lg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,y,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,d,y,C)}emplace(a,d,y,C,N){const X=4*a;return this.uint16[X+0]=d,this.uint16[X+1]=y,this.uint16[X+2]=C,this.uint16[X+3]=N,a}}lg.prototype.bytesPerElement=8,Ip(lg,"StructArrayLayout4ui8");class My extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X){const vt=this.length;return this.resize(vt+1),this.emplace(vt,a,d,y,C,N,X)}emplace(a,d,y,C,N,X,vt){const Ht=6*a;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=C,this.int16[Ht+3]=N,this.int16[Ht+4]=X,this.int16[Ht+5]=vt,a}}My.prototype.bytesPerElement=12,Ip(My,"StructArrayLayout6i12");class V0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl){const ju=this.length;return this.resize(ju+1),this.emplace(ju,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl)}emplace(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju){const Ku=12*a;return this.int16[Ku+0]=d,this.int16[Ku+1]=y,this.int16[Ku+2]=C,this.int16[Ku+3]=N,this.uint16[Ku+4]=X,this.uint16[Ku+5]=vt,this.uint16[Ku+6]=Ht,this.uint16[Ku+7]=Ui,this.int16[Ku+8]=qr,this.int16[Ku+9]=Zs,this.int16[Ku+10]=nl,this.int16[Ku+11]=ju,a}}V0.prototype.bytesPerElement=24,Ip(V0,"StructArrayLayout4i4ui4i24");class ig extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X){const vt=this.length;return this.resize(vt+1),this.emplace(vt,a,d,y,C,N,X)}emplace(a,d,y,C,N,X,vt){const Ht=10*a,Ui=5*a;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=C,this.float32[Ui+2]=N,this.float32[Ui+3]=X,this.float32[Ui+4]=vt,a}}ig.prototype.bytesPerElement=20,Ip(ig,"StructArrayLayout3i3f20");class qm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.uint32[1*a+0]=d,a}}qm.prototype.bytesPerElement=4,Ip(qm,"StructArrayLayout1ul4");class _m extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju){const Ku=this.length;return this.resize(Ku+1),this.emplace(Ku,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju)}emplace(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku){const ah=20*a,Eh=10*a;return this.int16[ah+0]=d,this.int16[ah+1]=y,this.int16[ah+2]=C,this.int16[ah+3]=N,this.int16[ah+4]=X,this.float32[Eh+3]=vt,this.float32[Eh+4]=Ht,this.float32[Eh+5]=Ui,this.float32[Eh+6]=qr,this.int16[ah+14]=Zs,this.uint32[Eh+8]=nl,this.uint16[ah+18]=ju,this.uint16[ah+19]=Ku,a}}_m.prototype.bytesPerElement=40,Ip(_m,"StructArrayLayout5i4f1i1ul2ui40");class cg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,a,d,y,C,N,X,vt)}emplace(a,d,y,C,N,X,vt,Ht){const Ui=8*a;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.int16[Ui+2]=C,this.int16[Ui+4]=N,this.int16[Ui+5]=X,this.int16[Ui+6]=vt,this.int16[Ui+7]=Ht,a}}cg.prototype.bytesPerElement=16,Ip(cg,"StructArrayLayout3i2i2i16");class r_ extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N){const X=this.length;return this.resize(X+1),this.emplace(X,a,d,y,C,N)}emplace(a,d,y,C,N,X){const vt=4*a,Ht=8*a;return this.float32[vt+0]=d,this.float32[vt+1]=y,this.float32[vt+2]=C,this.int16[Ht+6]=N,this.int16[Ht+7]=X,a}}r_.prototype.bytesPerElement=16,Ip(r_,"StructArrayLayout2f1f2i16");class Dm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,d,y,C)}emplace(a,d,y,C,N){const X=12*a,vt=3*a;return this.uint8[X+0]=d,this.uint8[X+1]=y,this.float32[vt+1]=C,this.float32[vt+2]=N,a}}Dm.prototype.bytesPerElement=12,Ip(Dm,"StructArrayLayout2ub2f12");class jg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y){const C=this.length;return this.resize(C+1),this.emplace(C,a,d,y)}emplace(a,d,y,C){const N=3*a;return this.float32[N+0]=d,this.float32[N+1]=y,this.float32[N+2]=C,a}}jg.prototype.bytesPerElement=12,Ip(jg,"StructArrayLayout3f12");class y_ extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,y){const C=this.length;return this.resize(C+1),this.emplace(C,a,d,y)}emplace(a,d,y,C){const N=3*a;return this.uint16[N+0]=d,this.uint16[N+1]=y,this.uint16[N+2]=C,a}}y_.prototype.bytesPerElement=6,Ip(y_,"StructArrayLayout3ui6");class hv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd){const ed=this.length;return this.resize(ed+1),this.emplace(ed,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd)}emplace(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd,ed){const Rd=30*a,kd=15*a,Sf=60*a;return this.int16[Rd+0]=d,this.int16[Rd+1]=y,this.int16[Rd+2]=C,this.float32[kd+2]=N,this.float32[kd+3]=X,this.uint16[Rd+8]=vt,this.uint16[Rd+9]=Ht,this.uint32[kd+5]=Ui,this.uint32[kd+6]=qr,this.uint32[kd+7]=Zs,this.uint16[Rd+16]=nl,this.uint16[Rd+17]=ju,this.uint16[Rd+18]=Ku,this.float32[kd+10]=ah,this.float32[kd+11]=Eh,this.uint8[Sf+48]=zh,this.uint8[Sf+49]=Yh,this.uint8[Sf+50]=kh,this.uint32[kd+13]=Gh,this.int16[Rd+28]=nd,this.uint8[Sf+58]=ed,a}}hv.prototype.bytesPerElement=60,Ip(hv,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf){const Xf=this.length;return this.resize(Xf+1),this.emplace(Xf,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf)}emplace(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh,zh,Yh,kh,Gh,nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf,Xf){const Hd=38*a,up=19*a;return this.int16[Hd+0]=d,this.int16[Hd+1]=y,this.int16[Hd+2]=C,this.float32[up+2]=N,this.float32[up+3]=X,this.int16[Hd+8]=vt,this.int16[Hd+9]=Ht,this.int16[Hd+10]=Ui,this.int16[Hd+11]=qr,this.int16[Hd+12]=Zs,this.int16[Hd+13]=nl,this.uint16[Hd+14]=ju,this.uint16[Hd+15]=Ku,this.uint16[Hd+16]=ah,this.uint16[Hd+17]=Eh,this.uint16[Hd+18]=zh,this.uint16[Hd+19]=Yh,this.uint16[Hd+20]=kh,this.uint16[Hd+21]=Gh,this.uint16[Hd+22]=nd,this.uint16[Hd+23]=ed,this.uint16[Hd+24]=Rd,this.uint16[Hd+25]=kd,this.uint16[Hd+26]=Sf,this.uint16[Hd+27]=Zf,this.uint16[Hd+28]=jd,this.uint32[up+15]=Pf,this.float32[up+16]=Rf,this.float32[up+17]=Uf,this.float32[up+18]=Xf,a}}Hv.prototype.bytesPerElement=76,Ip(Hv,"StructArrayLayout3i2f6i15ui1ul3f76");class uy extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.float32[1*a+0]=d,a}}uy.prototype.bytesPerElement=4,Ip(uy,"StructArrayLayout1f4");class Cy extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,y,C,N){const X=this.length;return this.resize(X+1),this.emplace(X,a,d,y,C,N)}emplace(a,d,y,C,N,X){const vt=5*a;return this.float32[vt+0]=d,this.float32[vt+1]=y,this.float32[vt+2]=C,this.float32[vt+3]=N,this.float32[vt+4]=X,a}}Cy.prototype.bytesPerElement=20,Ip(Cy,"StructArrayLayout5f20");class G0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,y,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,d,y,C)}emplace(a,d,y,C,N){const X=6*a;return this.uint32[3*a+0]=d,this.uint16[X+2]=y,this.uint16[X+3]=C,this.uint16[X+4]=N,a}}G0.prototype.bytesPerElement=12,Ip(G0,"StructArrayLayout1ul3ui12");class dv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d){const y=this.length;return this.resize(y+1),this.emplace(y,a,d)}emplace(a,d,y){const C=2*a;return this.uint16[C+0]=d,this.uint16[C+1]=y,a}}dv.prototype.bytesPerElement=4,Ip(dv,"StructArrayLayout2ui4");class I0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.uint16[1*a+0]=d,a}}I0.prototype.bytesPerElement=2,Ip(I0,"StructArrayLayout1ui2");class Xv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d){const y=this.length;return this.resize(y+1),this.emplace(y,a,d)}emplace(a,d,y){const C=2*a;return this.float32[C+0]=d,this.float32[C+1]=y,a}}Xv.prototype.bytesPerElement=8,Ip(Xv,"StructArrayLayout2f8");class u1 extends Mp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}u1.prototype.size=40;class ub extends _m{get(a){return new u1(this,a)}}Ip(ub,"CollisionBoxArray");class Rg extends Mp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}Rg.prototype.size=60;class sx extends hv{get(a){return new Rg(this,a)}}Ip(sx,"PlacedSymbolArray");class hb extends Mp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(a){this._structArray.uint32[this._pos4+15]=a}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}hb.prototype.size=76;class ax extends Hv{get(a){return new hb(this,a)}}Ip(ax,"SymbolInstanceArray");class lx extends uy{getoffsetX(a){return this.float32[1*a+0]}}Ip(lx,"GlyphOffsetArray");class B1 extends Fp{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}Ip(B1,"SymbolLineVertexArray");class db extends Mp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}db.prototype.size=12;class fb extends G0{get(a){return new db(this,a)}}Ip(fb,"FeatureIndexArray");class z1 extends dv{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}Ip(z1,"FillExtrusionCentroidArray");const pb=Lp([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mb=Lp([{name:"a_dash",components:4,type:"Uint16"}]);var h1={},ew={get exports(){return h1},set exports(c){h1=c}},d1={};({get exports(){return d1},set exports(c){d1=c}}).exports=function(c,a){var d,y,C,N,X,vt,Ht,Ui;for(y=c.length-(d=3&c.length),C=a,X=3432918353,vt=461845907,Ui=0;Ui<y;)Ht=255&c.charCodeAt(Ui)|(255&c.charCodeAt(++Ui))<<8|(255&c.charCodeAt(++Ui))<<16|(255&c.charCodeAt(++Ui))<<24,++Ui,C=27492+(65535&(N=5*(65535&(C=(C^=Ht=(65535&(Ht=(Ht=(65535&Ht)*X+(((Ht>>>16)*X&65535)<<16)&4294967295)<<15|Ht>>>17))*vt+(((Ht>>>16)*vt&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(Ht=0,d){case 3:Ht^=(255&c.charCodeAt(Ui+2))<<16;case 2:Ht^=(255&c.charCodeAt(Ui+1))<<8;case 1:C^=Ht=(65535&(Ht=(Ht=(65535&(Ht^=255&c.charCodeAt(Ui)))*X+(((Ht>>>16)*X&65535)<<16)&4294967295)<<15|Ht>>>17))*vt+(((Ht>>>16)*vt&65535)<<16)&4294967295}return C^=c.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0};var gb={};({get exports(){return gb},set exports(c){gb=c}}).exports=function(c,a){for(var d,y=c.length,C=a^y,N=0;y>=4;)d=1540483477*(65535&(d=255&c.charCodeAt(N)|(255&c.charCodeAt(++N))<<8|(255&c.charCodeAt(++N))<<16|(255&c.charCodeAt(++N))<<24))+((1540483477*(d>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),y-=4,++N;switch(y){case 3:C^=(255&c.charCodeAt(N+2))<<16;case 2:C^=(255&c.charCodeAt(N+1))<<8;case 1:C=1540483477*(65535&(C^=255&c.charCodeAt(N)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0};var Ox=d1,Yw=gb;ew.exports=Ox,h1.murmur3=Ox,h1.murmur2=Yw;class N1{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,d,y,C){this.ids.push(Bx(a)),this.positions.push(d,y,C)}getPositions(a){const d=Bx(a);let y=0,C=this.ids.length-1;for(;y<C;){const X=y+C>>1;this.ids[X]>=d?C=X:y=X+1}const N=[];for(;this.ids[y]===d;)N.push({index:this.positions[3*y],start:this.positions[3*y+1],end:this.positions[3*y+2]}),y++;return N}static serialize(a,d){const y=new Float64Array(a.ids),C=new Uint32Array(a.positions);return cx(y,C,0,y.length-1),d&&d.push(y.buffer,C.buffer),{ids:y,positions:C}}static deserialize(a){const d=new N1;return d.ids=a.ids,d.positions=a.positions,d.indexed=!0,d}}function Bx(c){const a=+c;return!isNaN(a)&&Number.MIN_SAFE_INTEGER<=a&&a<=Number.MAX_SAFE_INTEGER?a:h1(String(c))}function cx(c,a,d,y){for(;d<y;){const C=c[d+y>>1];let N=d-1,X=y+1;for(;;){do N++;while(c[N]<C);do X--;while(c[X]>C);if(N>=X)break;zx(c,N,X),zx(a,3*N,3*X),zx(a,3*N+1,3*X+1),zx(a,3*N+2,3*X+2)}X-d<y-X?(cx(c,a,d,X),d=X+1):(cx(c,a,X+1,y),y=X)}}function zx(c,a,d){const y=c[a];c[a]=c[d],c[d]=y}Ip(N1,"FeaturePositionMap");class Av{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,d){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,d),this.initialized=!0),!!this.location}}class Nx extends Av{constructor(a){super(a),this.current=0}set(a,d,y){this.fetchUniformLocation(a,d)&&this.current!==y&&(this.current=y,this.gl.uniform1f(this.location,y))}}class tw extends Av{constructor(a){super(a),this.current=[0,0,0,0]}set(a,d,y){this.fetchUniformLocation(a,d)&&(y[0]===this.current[0]&&y[1]===this.current[1]&&y[2]===this.current[2]&&y[3]===this.current[3]||(this.current=y,this.gl.uniform4f(this.location,y[0],y[1],y[2],y[3])))}}class iw extends Av{constructor(a){super(a),this.current=Np.transparent}set(a,d,y){this.fetchUniformLocation(a,d)&&(y.r===this.current.r&&y.g===this.current.g&&y.b===this.current.b&&y.a===this.current.a||(this.current=y,this.gl.uniform4f(this.location,y.r,y.g,y.b,y.a)))}}const Wv=new Float32Array(16),Kw=new Float32Array(9),nw=new Float32Array(4);function Yv(c){return[Dp(255*c.r,255*c.g),Dp(255*c.b,255*c.a)]}class ux{constructor(a,d,y){this.value=a,this.uniformNames=d.map(C=>`u_${C}`),this.type=y}setUniform(a,d,y,C,N){d.set(a,N,C.constantOr(this.value))}getBinding(a,d){return this.type==="color"?new iw(a):new Nx(a)}}class F1{constructor(a,d){this.uniformNames=d.map(y=>`u_${y}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(a){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br)}setUniform(a,d,y,C,N){const X=N==="u_pattern"||N==="u_dash"?this.pattern:N==="u_pixel_ratio"?this.pixelRatio:null;X&&d.set(a,N,X)}getBinding(a,d){return d==="u_pattern"||d==="u_dash"?new tw(a):new Nx(a)}}class Pv{constructor(a,d,y,C){this.expression=a,this.type=y,this.maxValue=0,this.paintVertexAttributes=d.map(N=>({name:`a_${N}`,type:"Float32",components:y==="color"?2:1,offset:0})),this.paintVertexArray=new C}populatePaintArray(a,d,y,C,N,X){const vt=this.paintVertexArray.length,Ht=this.expression.evaluate(new ld(0),d,{},N,C,X);this.paintVertexArray.resize(a),this._setPaintValue(vt,a,Ht)}updatePaintArray(a,d,y,C,N){const X=this.expression.evaluate({zoom:0},y,C,void 0,N);this._setPaintValue(a,d,X)}_setPaintValue(a,d,y){if(this.type==="color"){const C=Yv(y);for(let N=a;N<d;N++)this.paintVertexArray.emplace(N,C[0],C[1])}else{for(let C=a;C<d;C++)this.paintVertexArray.emplace(C,y);this.maxValue=Math.max(this.maxValue,Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class M0{constructor(a,d,y,C,N,X){this.expression=a,this.uniformNames=d.map(vt=>`u_${vt}_t`),this.type=y,this.useIntegerZoom=C,this.zoom=N,this.maxValue=0,this.paintVertexAttributes=d.map(vt=>({name:`a_${vt}`,type:"Float32",components:y==="color"?4:2,offset:0})),this.paintVertexArray=new X}populatePaintArray(a,d,y,C,N,X){const vt=this.expression.evaluate(new ld(this.zoom),d,{},N,C,X),Ht=this.expression.evaluate(new ld(this.zoom+1),d,{},N,C,X),Ui=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(Ui,a,vt,Ht)}updatePaintArray(a,d,y,C,N){const X=this.expression.evaluate({zoom:this.zoom},y,C,void 0,N),vt=this.expression.evaluate({zoom:this.zoom+1},y,C,void 0,N);this._setPaintValue(a,d,X,vt)}_setPaintValue(a,d,y,C){if(this.type==="color"){const N=Yv(y),X=Yv(C);for(let vt=a;vt<d;vt++)this.paintVertexArray.emplace(vt,N[0],N[1],X[0],X[1])}else{for(let N=a;N<d;N++)this.paintVertexArray.emplace(N,y,C);this.maxValue=Math.max(this.maxValue,Math.abs(y),Math.abs(C))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,d,y,C,N){const X=this.useIntegerZoom?Math.floor(y.zoom):y.zoom,vt=Uh(this.expression.interpolationFactor(X,this.zoom,this.zoom+1),0,1);d.set(a,N,vt)}getBinding(a,d){return new Nx(a)}}class kv{constructor(a,d,y,C,N){this.expression=a,this.layerId=N,this.paintVertexAttributes=(y==="array"?mb:pb).members;for(let X=0;X<d.length;++X);this.paintVertexArray=new C}populatePaintArray(a,d,y){const C=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(C,a,d.patterns&&d.patterns[this.layerId],y)}updatePaintArray(a,d,y,C,N,X){this._setPaintValues(a,d,y.patterns&&y.patterns[this.layerId],X)}_setPaintValues(a,d,y,C){if(!C||!y)return;const N=C[y];if(!N)return;const{tl:X,br:vt,pixelRatio:Ht}=N;for(let Ui=a;Ui<d;Ui++)this.paintVertexArray.emplace(Ui,X[0],X[1],vt[0],vt[1],Ht)}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kv{constructor(a,d,y=()=>!0){this.binders={},this._buffers=[];const C=[];for(const N in a.paint._values){if(!y(N))continue;const X=a.paint.get(N);if(!(X instanceof Lf&&ag(X.property.specification)))continue;const vt=Jw(N,a.type),Ht=X.value,Ui=X.property.specification.type,qr=!!X.property.useIntegerZoom,Zs=N==="line-dasharray"||N.endsWith("pattern"),nl=N==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant";if(Ht.kind!=="constant"||nl)if(Ht.kind==="source"||nl||Zs){const ju=Fx(N,Ui,"source");this.binders[N]=Zs?new kv(Ht,vt,Ui,ju,a.id):new Pv(Ht,vt,Ui,ju),C.push(`/a_${N}`)}else{const ju=Fx(N,Ui,"composite");this.binders[N]=new M0(Ht,vt,Ui,qr,d,ju),C.push(`/z_${N}`)}else this.binders[N]=Zs?new F1(Ht.value,vt):new ux(Ht.value,vt,Ui),C.push(`/u_${N}`)}this.cacheKey=C.sort().join("")}getMaxValue(a){const d=this.binders[a];return d instanceof Pv||d instanceof M0?d.maxValue:0}populatePaintArrays(a,d,y,C,N,X){for(const vt in this.binders){const Ht=this.binders[vt];(Ht instanceof Pv||Ht instanceof M0||Ht instanceof kv)&&Ht.populatePaintArray(a,d,y,C,N,X)}}setConstantPatternPositions(a){for(const d in this.binders){const y=this.binders[d];y instanceof F1&&y.setConstantPatternPositions(a)}}updatePaintArrays(a,d,y,C,N,X){let vt=!1;for(const Ht in a){const Ui=d.getPositions(Ht);for(const qr of Ui){const Zs=y.feature(qr.index);for(const nl in this.binders){const ju=this.binders[nl];if((ju instanceof Pv||ju instanceof M0||ju instanceof kv)&&ju.expression.isStateDependent===!0){const Ku=C.paint.get(nl);ju.expression=Ku.value,ju.updatePaintArray(qr.start,qr.end,Zs,a[Ht],N,X),vt=!0}}}}return vt}defines(){const a=[];for(const d in this.binders){const y=this.binders[d];(y instanceof ux||y instanceof F1)&&a.push(...y.uniformNames.map(C=>`#define HAS_UNIFORM_${C}`))}return a}getBinderAttributes(){const a=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof Pv||y instanceof M0||y instanceof kv)for(let C=0;C<y.paintVertexAttributes.length;C++)a.push(y.paintVertexAttributes[C].name)}return a}getBinderUniforms(){const a=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof ux||y instanceof F1||y instanceof M0)for(const C of y.uniformNames)a.push(C)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const d=[];for(const y in this.binders){const C=this.binders[y];if(C instanceof ux||C instanceof F1||C instanceof M0)for(const N of C.uniformNames)d.push({name:N,property:y,binding:C.getBinding(a,N)})}return d}setUniforms(a,d,y,C,N){for(const{name:X,property:vt,binding:Ht}of y)this.binders[vt].setUniform(a,Ht,N,C.get(vt),X)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const d=this.binders[a];(d instanceof Pv||d instanceof M0||d instanceof kv)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(a){for(const d in this.binders){const y=this.binders[d];(y instanceof Pv||y instanceof M0||y instanceof kv)&&y.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const d=this.binders[a];(d instanceof Pv||d instanceof M0||d instanceof kv)&&d.destroy()}}}class f1{constructor(a,d,y=()=>!0){this.programConfigurations={};for(const C of a)this.programConfigurations[C.id]=new Kv(C,d,y);this.needsUpload=!1,this._featureMap=new N1,this._bufferOffset=0}populatePaintArrays(a,d,y,C,N,X,vt){for(const Ht in this.programConfigurations)this.programConfigurations[Ht].populatePaintArrays(a,d,C,N,X,vt);d.id!==void 0&&this._featureMap.add(d.id,y,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,d,y,C,N){for(const X of y)this.needsUpload=this.programConfigurations[X.id].updatePaintArrays(a,this._featureMap,d,X,C,N)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const Qw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jw(c,a){return Qw[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}const _b={"line-pattern":{source:gg,composite:gg},"fill-pattern":{source:gg,composite:gg},"fill-extrusion-pattern":{source:gg,composite:gg},"line-dasharray":{source:lg,composite:lg}},hx={color:{source:Xv,composite:Fm},number:{source:uy,composite:Xv}};function Fx(c,a,d){const y=_b[c];return y&&y[d]||hx[a][d]}Ip(ux,"ConstantBinder"),Ip(F1,"PatternConstantBinder"),Ip(Pv,"SourceExpressionBinder"),Ip(kv,"PatternCompositeBinder"),Ip(M0,"CompositeExpressionBinder"),Ip(Kv,"ProgramConfiguration",{omit:["_buffers"]}),Ip(f1,"ProgramConfigurationSet");const $x="-transition";class j0 extends om{constructor(a,d){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&a.type!=="sky"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),d.layout&&(this._unevaluatedLayout=new Ud(d.layout)),d.paint)){this._transitionablePaint=new Vf(d.paint);for(const y in a.paint)this.setPaintProperty(y,a.paint[y],{validate:!1});for(const y in a.layout)this.setLayoutProperty(y,a.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Md(d.paint)}}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,d,y={}){d!=null&&this._validate(U0,`layers.${this.id}.layout.${a}`,a,d,y)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,d):this.visibility=d)}getPaintProperty(a){return Gd(a,$x)?this._transitionablePaint.getTransition(a.slice(0,-$x.length)):this._transitionablePaint.getValue(a)}setPaintProperty(a,d,y={}){if(d!=null&&this._validate(Cv,`layers.${this.id}.paint.${a}`,a,d,y))return!1;if(Gd(a,$x))return this._transitionablePaint.setTransition(a.slice(0,-$x.length),d||void 0),!1;{const C=this._transitionablePaint._values[a],N=C.value.isDataDriven(),X=C.value;this._transitionablePaint.setValue(a,d),this._handleSpecialPaintPropertyUpdate(a);const vt=this._transitionablePaint._values[a].value,Ht=vt.isDataDriven(),Ui=Gd(a,"pattern")||a==="line-dasharray";return Ht||N||Ui||this._handleOverridablePaintPropertyUpdate(a,X,vt)}}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getProgramConfiguration(a){return null}_handleOverridablePaintPropertyUpdate(a,d,y){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,d){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,d)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Id(a,(d,y)=>!(d===void 0||y==="layout"&&!Object.keys(d).length||y==="paint"&&!Object.keys(d).length))}_validate(a,d,y,C,N={}){return(!N||N.validate!==!1)&&qv(this,a.call(T0,{key:d,layerType:this.type,objectKey:y,value:C,styleSpec:Pd,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const d=this.paint.get(a);if(d instanceof Lf&&ag(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=v0(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const e2=Lp([{name:"a_pos",components:2,type:"Int16"}],4),dx=Lp([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Og{constructor(a=[]){this.segments=a}prepareSegment(a,d,y,C){let N=this.segments[this.segments.length-1];return a>Og.MAX_VERTEX_ARRAY_LENGTH&&np(`Max vertices per segment is ${Og.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!N||N.vertexLength+a>Og.MAX_VERTEX_ARRAY_LENGTH||N.sortKey!==C)&&(N={vertexOffset:d.length,primitiveOffset:y.length,vertexLength:0,primitiveLength:0},C!==void 0&&(N.sortKey=C),this.segments.push(N)),N}get(){return this.segments}destroy(){for(const a of this.segments)for(const d in a.vaos)a.vaos[d].destroy()}static simpleSegment(a,d,y,C){return new Og([{vertexOffset:a,primitiveOffset:d,vertexLength:y,primitiveLength:C,vaos:{},sortKey:0}])}}Og.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ip(Og,"SegmentVector");var Hp=8192;class Qv{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof Sm?new Sm(a.lng,a.lat):Sm.convert(a),this}setSouthWest(a){return this._sw=a instanceof Sm?new Sm(a.lng,a.lat):Sm.convert(a),this}extend(a){const d=this._sw,y=this._ne;let C,N;if(a instanceof Sm)C=a,N=a;else{if(!(a instanceof Qv))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Qv.convert(a)):this.extend(Sm.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(Sm.convert(a)):this;if(C=a._sw,N=a._ne,!C||!N)return this}return d||y?(d.lng=Math.min(C.lng,d.lng),d.lat=Math.min(C.lat,d.lat),y.lng=Math.max(N.lng,y.lng),y.lat=Math.max(N.lat,y.lat)):(this._sw=new Sm(C.lng,C.lat),this._ne=new Sm(N.lng,N.lat)),this}getCenter(){return new Sm((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sm(this.getWest(),this.getNorth())}getSouthEast(){return new Sm(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:y}=Sm.convert(a);let C=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(C=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&C}static convert(a){return!a||a instanceof Qv?a:new Qv(a)}}var Ux=1e-6,Ay=typeof Float32Array<"u"?Float32Array:Array;function rw(){var c=new Ay(9);return Ay!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function ow(c,a,d){var y=a[0],C=a[1],N=a[2],X=a[3],vt=a[4],Ht=a[5],Ui=a[6],qr=a[7],Zs=a[8],nl=d[0],ju=d[1],Ku=d[2],ah=d[3],Eh=d[4],zh=d[5],Yh=d[6],kh=d[7],Gh=d[8];return c[0]=nl*y+ju*X+Ku*Ui,c[1]=nl*C+ju*vt+Ku*qr,c[2]=nl*N+ju*Ht+Ku*Zs,c[3]=ah*y+Eh*X+zh*Ui,c[4]=ah*C+Eh*vt+zh*qr,c[5]=ah*N+Eh*Ht+zh*Zs,c[6]=Yh*y+kh*X+Gh*Ui,c[7]=Yh*C+kh*vt+Gh*qr,c[8]=Yh*N+kh*Ht+Gh*Zs,c}function C0(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function fx(c,a){var d=a[0],y=a[1],C=a[2],N=a[3],X=a[4],vt=a[5],Ht=a[6],Ui=a[7],qr=a[8],Zs=a[9],nl=a[10],ju=a[11],Ku=a[12],ah=a[13],Eh=a[14],zh=a[15],Yh=d*vt-y*X,kh=d*Ht-C*X,Gh=d*Ui-N*X,nd=y*Ht-C*vt,ed=y*Ui-N*vt,Rd=C*Ui-N*Ht,kd=qr*ah-Zs*Ku,Sf=qr*Eh-nl*Ku,Zf=qr*zh-ju*Ku,jd=Zs*Eh-nl*ah,Pf=Zs*zh-ju*ah,Rf=nl*zh-ju*Eh,Uf=Yh*Rf-kh*Pf+Gh*jd+nd*Zf-ed*Sf+Rd*kd;return Uf?(c[0]=(vt*Rf-Ht*Pf+Ui*jd)*(Uf=1/Uf),c[1]=(C*Pf-y*Rf-N*jd)*Uf,c[2]=(ah*Rd-Eh*ed+zh*nd)*Uf,c[3]=(nl*ed-Zs*Rd-ju*nd)*Uf,c[4]=(Ht*Zf-X*Rf-Ui*Sf)*Uf,c[5]=(d*Rf-C*Zf+N*Sf)*Uf,c[6]=(Eh*Gh-Ku*Rd-zh*kh)*Uf,c[7]=(qr*Rd-nl*Gh+ju*kh)*Uf,c[8]=(X*Pf-vt*Zf+Ui*kd)*Uf,c[9]=(y*Zf-d*Pf-N*kd)*Uf,c[10]=(Ku*ed-ah*Gh+zh*Yh)*Uf,c[11]=(Zs*Gh-qr*ed-ju*Yh)*Uf,c[12]=(vt*Sf-X*jd-Ht*kd)*Uf,c[13]=(d*jd-y*Sf+C*kd)*Uf,c[14]=(ah*kh-Ku*nd-Eh*Yh)*Uf,c[15]=(qr*nd-Zs*kh+nl*Yh)*Uf,c):null}function p1(c,a,d){var y=a[0],C=a[1],N=a[2],X=a[3],vt=a[4],Ht=a[5],Ui=a[6],qr=a[7],Zs=a[8],nl=a[9],ju=a[10],Ku=a[11],ah=a[12],Eh=a[13],zh=a[14],Yh=a[15],kh=d[0],Gh=d[1],nd=d[2],ed=d[3];return c[0]=kh*y+Gh*vt+nd*Zs+ed*ah,c[1]=kh*C+Gh*Ht+nd*nl+ed*Eh,c[2]=kh*N+Gh*Ui+nd*ju+ed*zh,c[3]=kh*X+Gh*qr+nd*Ku+ed*Yh,c[4]=(kh=d[4])*y+(Gh=d[5])*vt+(nd=d[6])*Zs+(ed=d[7])*ah,c[5]=kh*C+Gh*Ht+nd*nl+ed*Eh,c[6]=kh*N+Gh*Ui+nd*ju+ed*zh,c[7]=kh*X+Gh*qr+nd*Ku+ed*Yh,c[8]=(kh=d[8])*y+(Gh=d[9])*vt+(nd=d[10])*Zs+(ed=d[11])*ah,c[9]=kh*C+Gh*Ht+nd*nl+ed*Eh,c[10]=kh*N+Gh*Ui+nd*ju+ed*zh,c[11]=kh*X+Gh*qr+nd*Ku+ed*Yh,c[12]=(kh=d[12])*y+(Gh=d[13])*vt+(nd=d[14])*Zs+(ed=d[15])*ah,c[13]=kh*C+Gh*Ht+nd*nl+ed*Eh,c[14]=kh*N+Gh*Ui+nd*ju+ed*zh,c[15]=kh*X+Gh*qr+nd*Ku+ed*Yh,c}function $1(c,a,d){var y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah=d[0],Eh=d[1],zh=d[2];return a===c?(c[12]=a[0]*ah+a[4]*Eh+a[8]*zh+a[12],c[13]=a[1]*ah+a[5]*Eh+a[9]*zh+a[13],c[14]=a[2]*ah+a[6]*Eh+a[10]*zh+a[14],c[15]=a[3]*ah+a[7]*Eh+a[11]*zh+a[15]):(C=a[1],N=a[2],X=a[3],vt=a[4],Ht=a[5],Ui=a[6],qr=a[7],Zs=a[8],nl=a[9],ju=a[10],Ku=a[11],c[0]=y=a[0],c[1]=C,c[2]=N,c[3]=X,c[4]=vt,c[5]=Ht,c[6]=Ui,c[7]=qr,c[8]=Zs,c[9]=nl,c[10]=ju,c[11]=Ku,c[12]=y*ah+vt*Eh+Zs*zh+a[12],c[13]=C*ah+Ht*Eh+nl*zh+a[13],c[14]=N*ah+Ui*Eh+ju*zh+a[14],c[15]=X*ah+qr*Eh+Ku*zh+a[15]),c}function Jv(c,a,d){var y=d[0],C=d[1],N=d[2];return c[0]=a[0]*y,c[1]=a[1]*y,c[2]=a[2]*y,c[3]=a[3]*y,c[4]=a[4]*C,c[5]=a[5]*C,c[6]=a[6]*C,c[7]=a[7]*C,c[8]=a[8]*N,c[9]=a[9]*N,c[10]=a[10]*N,c[11]=a[11]*N,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c}function Vx(c,a,d){var y=Math.sin(d),C=Math.cos(d),N=a[4],X=a[5],vt=a[6],Ht=a[7],Ui=a[8],qr=a[9],Zs=a[10],nl=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=N*C+Ui*y,c[5]=X*C+qr*y,c[6]=vt*C+Zs*y,c[7]=Ht*C+nl*y,c[8]=Ui*C-N*y,c[9]=qr*C-X*y,c[10]=Zs*C-vt*y,c[11]=nl*C-Ht*y,c}function jx(c,a,d){var y=Math.sin(d),C=Math.cos(d),N=a[0],X=a[1],vt=a[2],Ht=a[3],Ui=a[8],qr=a[9],Zs=a[10],nl=a[11];return a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=N*C-Ui*y,c[1]=X*C-qr*y,c[2]=vt*C-Zs*y,c[3]=Ht*C-nl*y,c[8]=N*y+Ui*C,c[9]=X*y+qr*C,c[10]=vt*y+Zs*C,c[11]=Ht*y+nl*C,c}function sw(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function aw(c,a,d){var y,C,N,X=d[0],vt=d[1],Ht=d[2],Ui=Math.hypot(X,vt,Ht);return Ui<Ux?null:(X*=Ui=1/Ui,vt*=Ui,Ht*=Ui,y=Math.sin(a),C=Math.cos(a),c[0]=X*X*(N=1-C)+C,c[1]=vt*X*N+Ht*y,c[2]=Ht*X*N-vt*y,c[3]=0,c[4]=X*vt*N-Ht*y,c[5]=vt*vt*N+C,c[6]=Ht*vt*N+X*y,c[7]=0,c[8]=X*Ht*N+vt*y,c[9]=vt*Ht*N-X*y,c[10]=Ht*Ht*N+C,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var lw=p1;function yb(){var c=new Ay(3);return Ay!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function uw(c){var a=new Ay(3);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a}function Dv(c){return Math.hypot(c[0],c[1],c[2])}function Bg(c,a,d){var y=new Ay(3);return y[0]=c,y[1]=a,y[2]=d,y}function q0(c,a,d){return c[0]=a[0]+d[0],c[1]=a[1]+d[1],c[2]=a[2]+d[2],c}function qx(c,a,d){return c[0]=a[0]-d[0],c[1]=a[1]-d[1],c[2]=a[2]-d[2],c}function vb(c,a,d){return c[0]=a[0]*d[0],c[1]=a[1]*d[1],c[2]=a[2]*d[2],c}function Om(c,a,d){return c[0]=Math.min(a[0],d[0]),c[1]=Math.min(a[1],d[1]),c[2]=Math.min(a[2],d[2]),c}function A0(c,a,d){return c[0]=Math.max(a[0],d[0]),c[1]=Math.max(a[1],d[1]),c[2]=Math.max(a[2],d[2]),c}function hy(c,a,d){return c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c}function U1(c,a,d,y){return c[0]=a[0]+d[0]*y,c[1]=a[1]+d[1]*y,c[2]=a[2]+d[2]*y,c}function R_(c,a){var d=a[0],y=a[1],C=a[2],N=d*d+y*y+C*C;return N>0&&(N=1/Math.sqrt(N)),c[0]=a[0]*N,c[1]=a[1]*N,c[2]=a[2]*N,c}function t_(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]}function e1(c,a,d){var y=a[0],C=a[1],N=a[2],X=d[0],vt=d[1],Ht=d[2];return c[0]=C*Ht-N*vt,c[1]=N*X-y*Ht,c[2]=y*vt-C*X,c}function Mg(c,a,d){var y=a[0],C=a[1],N=a[2],X=d[3]*y+d[7]*C+d[11]*N+d[15];return c[0]=(d[0]*y+d[4]*C+d[8]*N+d[12])/(X=X||1),c[1]=(d[1]*y+d[5]*C+d[9]*N+d[13])/X,c[2]=(d[2]*y+d[6]*C+d[10]*N+d[14])/X,c}function hw(c,a,d){var y=d[0],C=d[1],N=d[2],X=a[0],vt=a[1],Ht=a[2],Ui=C*Ht-N*vt,qr=N*X-y*Ht,Zs=y*vt-C*X,nl=C*Zs-N*qr,ju=N*Ui-y*Zs,Ku=y*qr-C*Ui,ah=2*d[3];return qr*=ah,Zs*=ah,ju*=2,Ku*=2,c[0]=X+(Ui*=ah)+(nl*=2),c[1]=vt+qr+ju,c[2]=Ht+Zs+Ku,c}var px,Z0=qx,t2=vb,i2=Dv;function dw(c,a,d){return c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c}function fw(c,a){var d=a[0],y=a[1],C=a[2],N=a[3],X=d*d+y*y+C*C+N*N;return X>0&&(X=1/Math.sqrt(X)),c[0]=d*X,c[1]=y*X,c[2]=C*X,c[3]=N*X,c}function m1(c,a,d){var y=a[0],C=a[1],N=a[2],X=a[3];return c[0]=d[0]*y+d[4]*C+d[8]*N+d[12]*X,c[1]=d[1]*y+d[5]*C+d[9]*N+d[13]*X,c[2]=d[2]*y+d[6]*C+d[10]*N+d[14]*X,c[3]=d[3]*y+d[7]*C+d[11]*N+d[15]*X,c}function pw(){var c=new Ay(4);return Ay!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function mx(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function g1(c,a,d){d*=.5;var y=a[0],C=a[1],N=a[2],X=a[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+X*vt,c[1]=C*Ht+N*vt,c[2]=N*Ht-C*vt,c[3]=X*Ht-y*vt,c}function xb(c,a,d){d*=.5;var y=a[0],C=a[1],N=a[2],X=a[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht-N*vt,c[1]=C*Ht+X*vt,c[2]=N*Ht+y*vt,c[3]=X*Ht-C*vt,c}yb(),px=new Ay(4),Ay!=Float32Array&&(px[0]=0,px[1]=0,px[2]=0,px[3]=0);var n2=fw;yb(),Bg(1,0,0),Bg(0,1,0),pw(),pw(),rw();const r2=Lp([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:mw}=r2,bb=Lp([{name:"a_pos_3",components:3,type:"Int16"}]);var _1=Lp([{name:"a_pos",type:"Int16",components:2}]);class Zx{constructor(a,d){this.pos=a,this.dir=d}intersectsPlane(a,d,y){const C=t_(d,this.dir);if(Math.abs(C)<1e-6)return!1;const N=((a[0]-this.pos[0])*d[0]+(a[1]-this.pos[1])*d[1]+(a[2]-this.pos[2])*d[2])/C;return y[0]=this.pos[0]+this.dir[0]*N,y[1]=this.pos[1]+this.dir[1]*N,y[2]=this.pos[2]+this.dir[2]*N,!0}closestPointOnSphere(a,d,y){if(function(ju,Ku){var ah=ju[0],Eh=ju[1],zh=ju[2],Yh=Ku[0],kh=Ku[1],Gh=Ku[2];return Math.abs(ah-Yh)<=Ux*Math.max(1,Math.abs(ah),Math.abs(Yh))&&Math.abs(Eh-kh)<=Ux*Math.max(1,Math.abs(Eh),Math.abs(kh))&&Math.abs(zh-Gh)<=Ux*Math.max(1,Math.abs(zh),Math.abs(Gh))}(this.pos,a)||d===0)return y[0]=y[1]=y[2]=0,!1;const[C,N,X]=this.dir,vt=this.pos[0]-a[0],Ht=this.pos[1]-a[1],Ui=this.pos[2]-a[2],qr=C*C+N*N+X*X,Zs=2*(vt*C+Ht*N+Ui*X),nl=Zs*Zs-4*qr*(vt*vt+Ht*Ht+Ui*Ui-d*d);if(nl<0){const ju=Math.max(-Zs/2,0),Ku=vt+C*ju,ah=Ht+N*ju,Eh=Ui+X*ju,zh=Math.hypot(Ku,ah,Eh);return y[0]=Ku*d/zh,y[1]=ah*d/zh,y[2]=Eh*d/zh,!1}{const ju=(-Zs-Math.sqrt(nl))/(2*qr);if(ju<0){const Ku=Math.hypot(vt,Ht,Ui);return y[0]=vt*d/Ku,y[1]=Ht*d/Ku,y[2]=Ui*d/Ku,!1}return y[0]=vt+C*ju,y[1]=Ht+N*ju,y[2]=Ui+X*ju,!0}}}class V1{constructor(a,d,y,C,N){this.TL=a,this.TR=d,this.BR=y,this.BL=C,this.horizon=N}static fromInvProjectionMatrix(a,d,y){const C=[-1,1,1],N=[1,1,1],X=[1,-1,1],vt=[-1,-1,1],Ht=Mg(C,C,a),Ui=Mg(N,N,a),qr=Mg(X,X,a),Zs=Mg(vt,vt,a);return new V1(Ht,Ui,qr,Zs,d/y)}}class y1{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,y,C){const N=Math.pow(2,y),X=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Ht=>{const Ui=m1([],Ht,a),qr=1/Ui[3]/d*N;return function(Zs,nl,ju){return Zs[0]=nl[0]*ju[0],Zs[1]=nl[1]*ju[1],Zs[2]=nl[2]*ju[2],Zs[3]=nl[3]*ju[3],Zs}(Ui,Ui,[qr,qr,C?1/Ui[3]:qr,qr])}),vt=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Ht=>{const Ui=R_([],e1([],Z0([],X[Ht[0]],X[Ht[1]]),Z0([],X[Ht[2]],X[Ht[1]]))),qr=-t_(Ui,X[Ht[1]]);return Ui.concat(qr)});return new y1(X,vt)}}class Yg{static fromPoints(a){const d=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];for(const C of a)Om(d,d,C),A0(y,y,C);return new Yg(d,y)}static applyTransform(a,d){const y=a.getCorners();for(let C=0;C<y.length;++C)Mg(y[C],y[C],d);return Yg.fromPoints(y)}constructor(a,d){this.min=a,this.max=d,this.center=hy([],q0([],this.min,this.max),.5)}quadrant(a){const d=[a%2==0,a<2],y=uw(this.min),C=uw(this.max);for(let N=0;N<d.length;N++)y[N]=d[N]?this.min[N]:this.center[N],C[N]=d[N]?this.center[N]:this.max[N];return C[2]=this.max[2],new Yg(y,C)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,d=this.max;return[[a[0],a[1],a[2]],[d[0],a[1],a[2]],[d[0],d[1],a[2]],[a[0],d[1],a[2]],[a[0],a[1],d[2]],[d[0],a[1],d[2]],[d[0],d[1],d[2]],[a[0],d[1],d[2]]]}intersects(a){const d=this.getCorners();let y=!0;for(let C=0;C<a.planes.length;C++){const N=a.planes[C];let X=0;for(let vt=0;vt<d.length;vt++)X+=t_(N,d[vt])+N[3]>=0;if(X===0)return 0;X!==d.length&&(y=!1)}if(y)return 2;for(let C=0;C<3;C++){let N=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let vt=0;vt<a.points.length;vt++){const Ht=a.points[vt][C]-this.min[C];N=Math.min(N,Ht),X=Math.max(X,Ht)}if(X<0||N>this.max[C]-this.min[C])return 0}return 1}}const Yy=Hp/Math.PI/2,fv=64,gx=[fv,32,16],Ky=-Yy,Qy=Yy,o2=[new Yg([Ky,Ky,Ky],[Qy,Qy,Qy]),new Yg([Ky,Ky,Ky],[0,0,Qy]),new Yg([0,Ky,Ky],[Qy,0,Qy]),new Yg([Ky,0,Ky],[0,Qy,Qy]),new Yg([0,0,Ky],[Qy,Qy,Qy])];function _x(c){return c*Yy/xx}function wb(c,a,d,y=!0){const C=hy([],c._camera.position,c.worldSize),N=[a,d,1,1];m1(N,N,c.pixelMatrixInverse),dw(N,N,1/N[3]);const X=R_([],Z0([],N,C)),vt=c.globeMatrix,Ht=[vt[12],vt[13],vt[14]],Ui=Z0([],Ht,C),qr=Dv(Ui),Zs=R_([],Ui),nl=c.worldSize/(2*Math.PI),ju=t_(Zs,X),Ku=Math.asin(nl/qr);if(Ku<Math.acos(ju)){if(!y)return null;const Zf=[],jd=[];hy(Zf,X,qr/ju),R_(jd,Z0(jd,Zf,Ui)),R_(X,q0(X,Ui,hy(X,jd,Math.tan(Ku)*qr)))}const ah=[];new Zx(C,X).closestPointOnSphere(Ht,nl,ah);const Eh=R_([],Yd(vt,0)),zh=R_([],Yd(vt,1)),Yh=R_([],Yd(vt,2)),kh=t_(Eh,ah),Gh=t_(zh,ah),nd=t_(Yh,ah),ed=sl(Math.asin(-Gh/nl));let Rd=sl(Math.atan2(kh,nd));Rd=c.center.lng+function(Zf,jd){const Pf=(jd-Zf+180)%360-180;return Pf<-180?Pf+360:Pf}(c.center.lng,Rd);const kd=P0(Rd),Sf=Uh(X0(ed),0,1);return new Z1(kd,Sf)}class Eb{constructor(a,d,y){this.a=Z0([],a,y),this.b=Z0([],d,y),this.center=y;const C=R_([],this.a),N=R_([],this.b);this.angle=Math.acos(t_(C,N))}}function yx(c,a){if(c.angle===0)return null;let d;return d=c.a[a]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[a]/c.a[a]/Math.sin(c.angle)-1/Math.tan(c.angle)),d<0||d>1?null:function(y,C,N,X){const vt=Math.sin(N);return y*(Math.sin((1-X)*N)/vt)+C*(Math.sin(X*N)/vt)}(c.a[a],c.b[a],c.angle,Uh(d,0,1))+c.center[a]}function pv(c){if(c.z<=1)return o2[c.z+2*c.y+c.x];const a=Hx(H0(c));return Yg.fromPoints(a)}function v1(c,a,d){return hy(c,c,1-d),U1(c,c,a,d)}function Sb(c,a){const d=Lv(a.zoom);if(d===0)return pv(c);const y=H0(c),C=Hx(y),N=P0(y.getWest())*a.worldSize,X=P0(y.getEast())*a.worldSize,vt=X0(y.getNorth())*a.worldSize,Ht=X0(y.getSouth())*a.worldSize,Ui=[N,vt,0],qr=[X,vt,0],Zs=[N,Ht,0],nl=[X,Ht,0],ju=fx([],a.globeMatrix);return Mg(Ui,Ui,ju),Mg(qr,qr,ju),Mg(Zs,Zs,ju),Mg(nl,nl,ju),C[0]=v1(C[0],Zs,d),C[1]=v1(C[1],nl,d),C[2]=v1(C[2],qr,d),C[3]=v1(C[3],Ui,d),Yg.fromPoints(C)}function mv(c,a,d){for(const y of c)Mg(y,y,a),hy(y,y,d)}function gw(c,a,d){const y=a/c.worldSize,C=c.globeMatrix;if(d.z<=1){const kd=pv(d).getCorners();return mv(kd,C,y),Yg.fromPoints(kd)}const N=H0(d),X=Hx(N);mv(X,C,y);const vt=Number.MAX_VALUE,Ht=[-vt,-vt,-vt],Ui=[vt,vt,vt];if(N.contains(c.center)){for(const Zf of X)Om(Ui,Ui,Zf),A0(Ht,Ht,Zf);Ht[2]=0;const kd=c.point,Sf=[kd.x*y,kd.y*y,0];return Om(Ui,Ui,Sf),A0(Ht,Ht,Sf),new Yg(Ui,Ht)}const qr=[C[12]*y,C[13]*y,C[14]*y],Zs=N.getCenter(),nl=Uh(c.center.lat,-o_,o_),ju=Uh(Zs.lat,-o_,o_),Ku=P0(c.center.lng),ah=X0(nl);let Eh=Ku-P0(Zs.lng);const zh=ah-X0(ju);Eh>.5?Eh-=1:Eh<-.5&&(Eh+=1);let Yh=0;Math.abs(Eh)>Math.abs(zh)?Yh=Eh>=0?1:3:(Yh=zh>=0?0:2,U1(qr,qr,[C[4]*y,C[5]*y,C[6]*y],-Math.sin(th(zh>=0?N.getSouth():N.getNorth()))*Yy));const kh=X[Yh],Gh=X[(Yh+1)%4],nd=new Eb(kh,Gh,qr),ed=[yx(nd,0)||kh[0],yx(nd,1)||kh[1],yx(nd,2)||kh[2]],Rd=Lv(c.zoom);if(Rd>0){const kd=function({x:Zf,y:jd,z:Pf},Rf,Uf,Xf,Hd){const up=1/(1<<Pf);let jp=Zf*up,vp=jp+up,Rp=jd*up,dp=Rp+up,Xp=0;const xm=(jp+vp)/2-Xf;return xm>.5?Xp=-1:xm<-.5&&(Xp=1),jp=((jp+Xp)*Rf-(Xf*=Rf))*Uf+Xf,vp=((vp+Xp)*Rf-Xf)*Uf+Xf,Rp=(Rp*Rf-(Hd*=Rf))*Uf+Hd,dp=(dp*Rf-Hd)*Uf+Hd,[[jp,dp,0],[vp,dp,0],[vp,Rp,0],[jp,Rp,0]]}(d,a,c._pixelsPerMercatorPixel,Ku,ah);for(let Zf=0;Zf<X.length;Zf++)v1(X[Zf],kd[Zf],Rd);const Sf=q0([],kd[Yh],kd[(Yh+1)%4]);hy(Sf,Sf,.5),v1(ed,Sf,Rd)}for(const kd of X)Om(Ui,Ui,kd),A0(Ht,Ht,kd);return Ui[2]=Math.min(kh[2],Gh[2]),Om(Ui,Ui,ed),A0(Ht,Ht,ed),new Yg(Ui,Ht)}function H0({x:c,y:a,z:d}){const y=1/(1<<d),C=new Sm(e0(c*y),Cg((a+1)*y)),N=new Sm(e0((c+1)*y),Cg(a*y));return new Qv(C,N)}function Hx(c){const a=th(c.getNorth()),d=th(c.getSouth()),y=Math.cos(a),C=Math.cos(d),N=Math.sin(a),X=Math.sin(d),vt=c.getWest(),Ht=c.getEast();return[x1(C,X,vt),x1(C,X,Ht),x1(y,N,Ht),x1(y,N,vt)]}function x1(c,a,d,y=Yy){return d=th(d),[c*Math.sin(d)*y,-a*y,c*Math.cos(d)*y]}function b1(c,a,d){return x1(Math.cos(th(c)),Math.sin(th(c)),a,d)}function G1(c,a,d,y){const C=1<<d.z,N=(c/Hp+d.x)/C;return b1(Cg((a/Hp+d.y)/C),e0(N),y)}function Xx({min:c,max:a}){return 16383/Math.max(a[0]-c[0],a[1]-c[1],a[2]-c[2])}const _w=new Float64Array(16);function j1(c){const a=Xx(c),d=sw(_w,[a,a,a]);return $1(d,d,((y=[])[0]=-(C=c.min)[0],y[1]=-C[1],y[2]=-C[2],y));var y,C}function Wx(c){const a=(y=c.min,(d=_w)[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=y[0],d[13]=y[1],d[14]=y[2],d[15]=1,d);var d,y;const C=1/Xx(c);return Jv(a,a,[C,C,C])}function Tb(c,a,d,y,C){const N=function(Ht){const Ui=Hp/(2*Math.PI);return Ht/(2*Math.PI)/Ui}(d),X=[c,a,-d/(2*Math.PI)],vt=C0(new Float64Array(16));return $1(vt,vt,X),Jv(vt,vt,[N,N,N]),Vx(vt,vt,th(-C)),jx(vt,vt,th(-y)),vt}function Lv(c){return cd(5,6,c)}function Ib(c,a){const d=b1(a.lat,a.lng),y=function(Ku){const ah=b1(Ku._center.lat,Ku._center.lng);let Eh=e1([],Bg(0,1,0),ah);const zh=aw([],-Ku.angle,ah);Eh=Mg(Eh,Eh,zh),aw(zh,-Ku._pitch,Eh);const Yh=R_([],ah);return hy(Yh,Yh,_x(Ku.cameraToCenterDistance/Ku.pixelsPerMeter)),Mg(Yh,Yh,zh),q0([],ah,Yh)}(c);return X=(C=qx([],y,d))[0],vt=C[1],Ht=C[2],Ui=(N=d)[0],qr=N[1],Zs=N[2],ju=(nl=Math.sqrt(X*X+vt*vt+Ht*Ht)*Math.sqrt(Ui*Ui+qr*qr+Zs*Zs))&&t_(C,N)/nl,Math.acos(Math.min(Math.max(ju,-1),1));var C,N,X,vt,Ht,Ui,qr,Zs,nl,ju}function q1(c,a){return Ib(c,a)>Math.PI/2*1.01}const vx=th(85),Yx=Math.cos(vx),s2=Math.sin(vx),xx=63710088e-1,yw=2*Math.PI*xx;class Sm{constructor(a,d){if(isNaN(a)||isNaN(d))throw new Error(`Invalid LngLat object: (${a}, ${d})`);if(this.lng=+a,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sm(Tf(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const d=Math.PI/180,y=this.lat*d,C=a.lat*d,N=Math.sin(y)*Math.sin(C)+Math.cos(y)*Math.cos(C)*Math.cos((a.lng-this.lng)*d);return xx*Math.acos(Math.min(N,1))}toBounds(a=0){const d=360*a/40075017,y=d/Math.cos(Math.PI/180*this.lat);return new Qv(new Sm(this.lng-y,this.lat-d),new Sm(this.lng+y,this.lat+d))}toEcef(a){const d=_x(a);return b1(this.lat,this.lng,Yy+d)}static convert(a){if(a instanceof Sm)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Sm(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Sm(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function t1(c){return yw*Math.cos(c*Math.PI/180)}function P0(c){return(180+c)/360}function X0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Jy(c,a){return c/t1(a)}function e0(c){return 360*c-180}function Cg(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Mb(c,a){return c*t1(Cg(a))}const o_=85.051129;function vw(c){return 1/Math.cos(c*Math.PI/180)}class Z1{constructor(a,d,y=0){this.x=+a,this.y=+d,this.z=+y}static fromLngLat(a,d=0){const y=Sm.convert(a);return new Z1(P0(y.lng),X0(y.lat),Jy(d,y.lat))}toLngLat(){return new Sm(e0(this.x),Cg(this.y))}toAltitude(){return Mb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/yw*vw(Cg(this.y))}}function Cb(c,a,d,y,C,N,X,vt,Ht){const Ui=(a+y)/2,qr=(d+C)/2,Zs=new Js(Ui,qr);vt(Zs),function(nl,ju,Ku,ah,Eh,zh){const Yh=Ku-Eh,kh=ah-zh;return Math.abs((ah-ju)*Yh-(Ku-nl)*kh)/Math.hypot(Yh,kh)}(Zs.x,Zs.y,N.x,N.y,X.x,X.y)>=Ht?(Cb(c,a,d,Ui,qr,N,Zs,vt,Ht),Cb(c,Ui,qr,y,C,Zs,X,vt,Ht)):c.push(X)}function bx(c,a,d){let y=c[0],C=y.x,N=y.y;a(y);const X=[y];for(let vt=1;vt<c.length;vt++){const Ht=c[vt],{x:Ui,y:qr}=Ht;a(Ht),Cb(X,C,N,Ui,qr,y,Ht,a,d),C=Ui,N=qr,y=Ht}return X}function wx(c,a,d,y){if(y(a,d)){const C=a.add(d)._mult(.5);wx(c,a,C,y),wx(c,C,d,y)}else c.push(d)}function a2(c,a){let d=c[0];const y=[d];for(let C=1;C<c.length;C++){const N=c[C];wx(y,d,N,a),d=N}return y}const Ex=Math.pow(2,14)-1,Kx=-Ex-1;function H1(c,a){const d=Math.round(c.x*a),y=Math.round(c.y*a);return c.x=Uh(d,Kx,Ex),c.y=Uh(y,Kx,Ex),(d<c.x||d>c.x+1||y<c.y||y>c.y+1)&&np("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function Rv(c,a,d){const y=c.loadGeometry(),C=c.extent,N=Hp/C;if(a&&d&&d.projection.isReprojectedInTileSpace){const X=1<<a.z,{scale:vt,x:Ht,y:Ui,projection:qr}=d,Zs=nl=>{const ju=e0((a.x+nl.x/C)/X),Ku=Cg((a.y+nl.y/C)/X),ah=qr.project(ju,Ku);nl.x=(ah.x*vt-Ht)*C,nl.y=(ah.y*vt-Ui)*C};for(let nl=0;nl<y.length;nl++)if(c.type!==1)y[nl]=bx(y[nl],Zs,1);else{const ju=[];for(const Ku of y[nl])Ku.x<0||Ku.x>=C||Ku.y<0||Ku.y>=C||(Zs(Ku),ju.push(Ku));y[nl]=ju}}for(const X of y)for(const vt of X)H1(vt,N);return y}function Ov(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Rv(c):[]}}function Sx(c,a,d,y,C){c.emplaceBack(2*a+(y+1)/2,2*d+(C+1)/2)}function w1(c,a,d){c.emplaceBack(a.x,a.y,a.z,d[0]*16384,d[1]*16384,d[2]*16384)}class Tx{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new Fp,this.indexArray=new y_,this.segments=new Og,this.programConfigurations=new f1(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,y,C){const N=this.layers[0],X=[];let vt=null;N.type==="circle"&&(vt=N.layout.get("circle-sort-key"));for(const{feature:Ui,id:qr,index:Zs,sourceLayerIndex:nl}of a){const ju=this.layers[0]._featureFilter.needGeometry,Ku=Ov(Ui,ju);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),Ku,y))continue;const ah=vt?vt.evaluate(Ku,{},y):void 0,Eh={id:qr,properties:Ui.properties,type:Ui.type,sourceLayerIndex:nl,index:Zs,geometry:ju?Ku.geometry:Rv(Ui,y,C),patterns:{},sortKey:ah};X.push(Eh)}vt&&X.sort((Ui,qr)=>Ui.sortKey-qr.sortKey);let Ht=null;C.projection.name==="globe"&&(this.globeExtVertexArray=new My,Ht=C.projection);for(const Ui of X){const{geometry:qr,index:Zs,sourceLayerIndex:nl}=Ui,ju=a[Zs].feature;this.addFeature(Ui,qr,Zs,d.availableImages,y,Ht),d.featureIndex.insert(ju,qr,Zs,nl,this.index)}}update(a,d,y,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,y,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,e2.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,dx.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(a,d,y,C,N,X){for(const vt of d)for(const Ht of vt){const Ui=Ht.x,qr=Ht.y;if(Ui<0||Ui>=Hp||qr<0||qr>=Hp)continue;if(X){const ju=X.projectTilePoint(Ui,qr,N),Ku=X.upVector(N,Ui,qr),ah=this.globeExtVertexArray;w1(ah,ju,Ku),w1(ah,ju,Ku),w1(ah,ju,Ku),w1(ah,ju,Ku)}const Zs=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),nl=Zs.vertexLength;Sx(this.layoutVertexArray,Ui,qr,-1,-1),Sx(this.layoutVertexArray,Ui,qr,1,-1),Sx(this.layoutVertexArray,Ui,qr,1,1),Sx(this.layoutVertexArray,Ui,qr,-1,1),this.indexArray.emplaceBack(nl,nl+1,nl+2),this.indexArray.emplaceBack(nl,nl+2,nl+3),Zs.vertexLength+=4,Zs.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{},C,N)}}function xw(c,a){for(let d=0;d<c.length;d++)if(i1(a,c[d]))return!0;for(let d=0;d<a.length;d++)if(i1(c,a[d]))return!0;return!!Ab(c,a)}function l2(c,a,d){return!!i1(c,a)||!!Tg(a,c,d)}function bw(c,a){if(c.length===1)return kb(a,c[0]);for(let d=0;d<a.length;d++){const y=a[d];for(let C=0;C<y.length;C++)if(i1(c,y[C]))return!0}for(let d=0;d<c.length;d++)if(kb(a,c[d]))return!0;for(let d=0;d<a.length;d++)if(Ab(c,a[d]))return!0;return!1}function c2(c,a,d){if(c.length>1){if(Ab(c,a))return!0;for(let y=0;y<a.length;y++)if(Tg(a[y],c,d))return!0}for(let y=0;y<c.length;y++)if(Tg(c[y],a,d))return!0;return!1}function Ab(c,a){if(c.length===0||a.length===0)return!1;for(let d=0;d<c.length-1;d++){const y=c[d],C=c[d+1];for(let N=0;N<a.length-1;N++)if(Pb(y,C,a[N],a[N+1]))return!0}return!1}function Pb(c,a,d,y){return jf(c,d,y)!==jf(a,d,y)&&jf(c,a,d)!==jf(c,a,y)}function Tg(c,a,d){const y=d*d;if(a.length===1)return c.distSqr(a[0])<y;for(let C=1;C<a.length;C++)if(E1(c,a[C-1],a[C])<y)return!0;return!1}function E1(c,a,d){const y=a.distSqr(d);if(y===0)return c.distSqr(a);const C=((c.x-a.x)*(d.x-a.x)+(c.y-a.y)*(d.y-a.y))/y;return c.distSqr(C<0?a:C>1?d:d.sub(a)._mult(C)._add(a))}function kb(c,a){let d,y,C,N=!1;for(let X=0;X<c.length;X++){d=c[X];for(let vt=0,Ht=d.length-1;vt<d.length;Ht=vt++)y=d[vt],C=d[Ht],y.y>a.y!=C.y>a.y&&a.x<(C.x-y.x)*(a.y-y.y)/(C.y-y.y)+y.x&&(N=!N)}return N}function i1(c,a){let d=!1;for(let y=0,C=c.length-1;y<c.length;C=y++){const N=c[y],X=c[C];N.y>a.y!=X.y>a.y&&a.x<(X.x-N.x)*(a.y-N.y)/(X.y-N.y)+N.x&&(d=!d)}return d}function Db(c,a,d,y,C){for(const X of c)if(a<=X.x&&d<=X.y&&y>=X.x&&C>=X.y)return!0;const N=[new Js(a,d),new Js(a,C),new Js(y,C),new Js(y,d)];if(c.length>2){for(const X of N)if(i1(c,X))return!0}for(let X=0;X<c.length-1;X++)if(ww(c[X],c[X+1],N))return!0;return!1}function ww(c,a,d){const y=d[0],C=d[2];if(c.x<y.x&&a.x<y.x||c.x>C.x&&a.x>C.x||c.y<y.y&&a.y<y.y||c.y>C.y&&a.y>C.y)return!1;const N=jf(c,a,d[0]);return N!==jf(c,a,d[1])||N!==jf(c,a,d[2])||N!==jf(c,a,d[3])}function S1(c,a,d){const y=a.paint.get(c).value;return y.kind==="constant"?y.value:d.programConfigurations.get(a.id).getMaxValue(c)}function Ix(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Qx(c,a,d,y,C){if(!a[0]&&!a[1])return c;const N=Js.convert(a)._mult(C);d==="viewport"&&N._rotate(-y);const X=[];for(let vt=0;vt<c.length;vt++)X.push(c[vt].sub(N));return X}function Mx(c,a,d,y){const C=Js.convert(c)._mult(y);return a==="viewport"&&C._rotate(-d),C}Ip(Tx,"CircleBucket",{omit:["layers"]});const Ew=new Bf({"circle-sort-key":new Bd(Pd.layout_circle["circle-sort-key"])});var Lb={paint:new Bf({"circle-radius":new Bd(Pd.paint_circle["circle-radius"]),"circle-color":new Bd(Pd.paint_circle["circle-color"]),"circle-blur":new Bd(Pd.paint_circle["circle-blur"]),"circle-opacity":new Bd(Pd.paint_circle["circle-opacity"]),"circle-translate":new pd(Pd.paint_circle["circle-translate"]),"circle-translate-anchor":new pd(Pd.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pd(Pd.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pd(Pd.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bd(Pd.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bd(Pd.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bd(Pd.paint_circle["circle-stroke-opacity"])}),layout:Ew};function Rb(c,a,d,y,C,N,X,vt,Ht){if(N&&c.queryGeometry.isAboveHorizon)return!1;N&&(Ht*=c.pixelToTileUnitsFactor);const Ui=c.tileID.canonical,qr=d.projection.upVectorScale(Ui,d.center.lat,d.worldSize).metersToTile;for(const Zs of a)for(const nl of Zs){const ju=nl.add(vt),Ku=C&&d.elevation?d.elevation.exaggeration()*C.getElevationAt(ju.x,ju.y,!0):0,ah=d.projection.projectTilePoint(ju.x,ju.y,Ui);if(Ku>0){const kh=d.projection.upVector(Ui,ju.x,ju.y);ah.x+=kh[0]*qr*Ku,ah.y+=kh[1]*qr*Ku,ah.z+=kh[2]*qr*Ku}const Eh=N?ju:t0(ah.x,ah.y,ah.z,y),zh=N?c.tilespaceRays.map(kh=>Tw(kh,Ku)):c.queryGeometry.screenGeometry,Yh=m1([],[ah.x,ah.y,ah.z,1],y);if(!X&&N?Ht*=Yh[3]/d.cameraToCenterDistance:X&&!N&&(Ht*=d.cameraToCenterDistance/Yh[3]),N){const kh=Cg((nl.y/Hp+Ui.y)/(1<<Ui.z));Ht/=d.projection.pixelsPerMeter(kh,1)/Jy(1,kh)}if(l2(zh,Eh,Ht))return!0}return!1}function t0(c,a,d,y){const C=m1([],[c,a,d,1],y);return new Js(C[0]/C[3],C[1]/C[3])}const X1=Bg(0,0,0),Sw=Bg(0,0,1);function Tw(c,a){const d=yb();return X1[2]=a,c.intersectsPlane(X1,Sw,d),new Js(d[0],d[1])}class Ob extends Tx{}function Bb(c,{width:a,height:d},y,C){if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==a*d*y)throw new RangeError("mismatched image size")}else C=new Uint8Array(a*d*y);return c.width=a,c.height=d,c.data=C,c}function zb(c,a,d){const{width:y,height:C}=a;y===c.width&&C===c.height||(Jx(c,a,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,y),height:Math.min(c.height,C)},d),c.width=y,c.height=C,c.data=a.data)}function Jx(c,a,d,y,C,N){if(C.width===0||C.height===0)return a;if(C.width>c.width||C.height>c.height||d.x>c.width-C.width||d.y>c.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>a.width||C.height>a.height||y.x>a.width-C.width||y.y>a.height-C.height)throw new RangeError("out of range destination coordinates for image copy");const X=c.data,vt=a.data;for(let Ht=0;Ht<C.height;Ht++){const Ui=((d.y+Ht)*c.width+d.x)*N,qr=((y.y+Ht)*a.width+y.x)*N;for(let Zs=0;Zs<C.width*N;Zs++)vt[qr+Zs]=X[Ui+Zs]}return a}Ip(Ob,"HeatmapBucket",{omit:["layers"]});class Bv{constructor(a,d){Bb(this,a,1,d)}resize(a){zb(this,new Bv(a),1)}clone(){return new Bv({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,d,y,C,N){Jx(a,d,y,C,N,1)}}class Q_{constructor(a,d){Bb(this,a,4,d)}resize(a){zb(this,new Q_(a),4)}replace(a,d){d?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Q_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,d,y,C,N){Jx(a,d,y,C,N,4)}}Ip(Bv,"AlphaImage"),Ip(Q_,"RGBAImage");var Iw={paint:new Bf({"heatmap-radius":new Bd(Pd.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bd(Pd.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pd(Pd.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mf(Pd.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pd(Pd.paint_heatmap["heatmap-opacity"])})};function T1(c){const a={},d=c.resolution||256,y=c.clips?c.clips.length:1,C=c.image||new Q_({width:d,height:y}),N=(X,vt,Ht)=>{a[c.evaluationKey]=Ht;const Ui=c.expression.evaluate(a);C.data[X+vt+0]=Math.floor(255*Ui.r/Ui.a),C.data[X+vt+1]=Math.floor(255*Ui.g/Ui.a),C.data[X+vt+2]=Math.floor(255*Ui.b/Ui.a),C.data[X+vt+3]=Math.floor(255*Ui.a)};if(c.clips)for(let X=0,vt=0;X<y;++X,vt+=4*d)for(let Ht=0,Ui=0;Ht<d;Ht++,Ui+=4){const qr=Ht/(d-1),{start:Zs,end:nl}=c.clips[X];N(vt,Ui,Zs*(1-qr)+nl*qr)}else for(let X=0,vt=0;X<d;X++,vt+=4)N(0,vt,X/(d-1));return C}var Nb={paint:new Bf({"hillshade-illumination-direction":new pd(Pd.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pd(Pd.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pd(Pd.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pd(Pd.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pd(Pd.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pd(Pd.paint_hillshade["hillshade-accent-color"])})};const Mw=Lp([{name:"a_pos",components:2,type:"Int16"}],4),{members:u2}=Mw;var W1={};function Y1(c,a,d){d=d||2;var y,C,N,X,vt,Ht,Ui,qr=a&&a.length,Zs=qr?a[0]*d:c.length,nl=Cx(c,0,Zs,d,!0),ju=[];if(!nl||nl.next===nl.prev)return ju;if(qr&&(nl=function(ah,Eh,zh,Yh){var kh,Gh,nd,ed=[];for(kh=0,Gh=Eh.length;kh<Gh;kh++)(nd=Cx(ah,Eh[kh]*Yh,kh<Gh-1?Eh[kh+1]*Yh:ah.length,Yh,!1))===nd.next&&(nd.steiner=!0),ed.push(Ur(nd));for(ed.sort(j),kh=0;kh<ed.length;kh++)zh=ut(ed[kh],zh);return zh}(c,a,nl,d)),c.length>80*d){y=N=c[0],C=X=c[1];for(var Ku=d;Ku<Zs;Ku+=d)(vt=c[Ku])<y&&(y=vt),(Ht=c[Ku+1])<C&&(C=Ht),vt>N&&(N=vt),Ht>X&&(X=Ht);Ui=(Ui=Math.max(N-y,X-C))!==0?32767/Ui:0}return I1(nl,ju,d,y,C,Ui,0),ju}function Cx(c,a,d,y,C){var N,X;if(C===Nd(c,a,d,y)>0)for(N=a;N<d;N+=y)X=bd(N,c[N],c[N+1],X);else for(N=d-y;N>=a;N-=y)X=bd(N,c[N],c[N+1],X);return X&&oh(X,X.next)&&(zd(X),X=X.next),X}function W0(c,a){if(!c)return c;a||(a=c);var d,y=c;do if(d=!1,y.steiner||!oh(y,y.next)&&Ju(y.prev,y,y.next)!==0)y=y.next;else{if(zd(y),(y=a=y.prev)===y.next)break;d=!0}while(d||y!==a);return a}function I1(c,a,d,y,C,N,X){if(c){!X&&N&&function(qr,Zs,nl,ju){var Ku=qr;do Ku.z===0&&(Ku.z=fi(Ku.x,Ku.y,Zs,nl,ju)),Ku.prevZ=Ku.prev,Ku.nextZ=Ku.next,Ku=Ku.next;while(Ku!==qr);Ku.prevZ.nextZ=null,Ku.prevZ=null,function(ah){var Eh,zh,Yh,kh,Gh,nd,ed,Rd,kd=1;do{for(zh=ah,ah=null,Gh=null,nd=0;zh;){for(nd++,Yh=zh,ed=0,Eh=0;Eh<kd&&(ed++,Yh=Yh.nextZ);Eh++);for(Rd=kd;ed>0||Rd>0&&Yh;)ed!==0&&(Rd===0||!Yh||zh.z<=Yh.z)?(kh=zh,zh=zh.nextZ,ed--):(kh=Yh,Yh=Yh.nextZ,Rd--),Gh?Gh.nextZ=kh:ah=kh,kh.prevZ=Gh,Gh=kh;zh=Yh}Gh.nextZ=null,kd*=2}while(nd>1)}(Ku)}(c,y,C,N);for(var vt,Ht,Ui=c;c.prev!==c.next;)if(vt=c.prev,Ht=c.next,N?_(c,y,C,N):h2(c))a.push(vt.i/d|0),a.push(c.i/d|0),a.push(Ht.i/d|0),zd(c),c=Ht.next,Ui=Ht.next;else if((c=Ht)===Ui){X?X===1?I1(c=f(W0(c),a,d),a,d,y,C,N,2):X===2&&S(c,a,d,y,C,N):I1(W0(c),a,d,y,C,N,1);break}}}function h2(c){var a=c.prev,d=c,y=c.next;if(Ju(a,d,y)>=0)return!1;for(var C=a.x,N=d.x,X=y.x,vt=a.y,Ht=d.y,Ui=y.y,qr=C<N?C<X?C:X:N<X?N:X,Zs=vt<Ht?vt<Ui?vt:Ui:Ht<Ui?Ht:Ui,nl=C>N?C>X?C:X:N>X?N:X,ju=vt>Ht?vt>Ui?vt:Ui:Ht>Ui?Ht:Ui,Ku=y.next;Ku!==a;){if(Ku.x>=qr&&Ku.x<=nl&&Ku.y>=Zs&&Ku.y<=ju&&us(C,vt,N,Ht,X,Ui,Ku.x,Ku.y)&&Ju(Ku.prev,Ku,Ku.next)>=0)return!1;Ku=Ku.next}return!0}function _(c,a,d,y){var C=c.prev,N=c,X=c.next;if(Ju(C,N,X)>=0)return!1;for(var vt=C.x,Ht=N.x,Ui=X.x,qr=C.y,Zs=N.y,nl=X.y,ju=vt<Ht?vt<Ui?vt:Ui:Ht<Ui?Ht:Ui,Ku=qr<Zs?qr<nl?qr:nl:Zs<nl?Zs:nl,ah=vt>Ht?vt>Ui?vt:Ui:Ht>Ui?Ht:Ui,Eh=qr>Zs?qr>nl?qr:nl:Zs>nl?Zs:nl,zh=fi(ju,Ku,a,d,y),Yh=fi(ah,Eh,a,d,y),kh=c.prevZ,Gh=c.nextZ;kh&&kh.z>=zh&&Gh&&Gh.z<=Yh;){if(kh.x>=ju&&kh.x<=ah&&kh.y>=Ku&&kh.y<=Eh&&kh!==C&&kh!==X&&us(vt,qr,Ht,Zs,Ui,nl,kh.x,kh.y)&&Ju(kh.prev,kh,kh.next)>=0||(kh=kh.prevZ,Gh.x>=ju&&Gh.x<=ah&&Gh.y>=Ku&&Gh.y<=Eh&&Gh!==C&&Gh!==X&&us(vt,qr,Ht,Zs,Ui,nl,Gh.x,Gh.y)&&Ju(Gh.prev,Gh,Gh.next)>=0))return!1;Gh=Gh.nextZ}for(;kh&&kh.z>=zh;){if(kh.x>=ju&&kh.x<=ah&&kh.y>=Ku&&kh.y<=Eh&&kh!==C&&kh!==X&&us(vt,qr,Ht,Zs,Ui,nl,kh.x,kh.y)&&Ju(kh.prev,kh,kh.next)>=0)return!1;kh=kh.prevZ}for(;Gh&&Gh.z<=Yh;){if(Gh.x>=ju&&Gh.x<=ah&&Gh.y>=Ku&&Gh.y<=Eh&&Gh!==C&&Gh!==X&&us(vt,qr,Ht,Zs,Ui,nl,Gh.x,Gh.y)&&Ju(Gh.prev,Gh,Gh.next)>=0)return!1;Gh=Gh.nextZ}return!0}function f(c,a,d){var y=c;do{var C=y.prev,N=y.next.next;!oh(C,N)&&gh(C,y,y.next,N)&&Wh(C,N)&&Wh(N,C)&&(a.push(C.i/d|0),a.push(y.i/d|0),a.push(N.i/d|0),zd(y),zd(y.next),y=c=N),y=y.next}while(y!==c);return W0(y)}function S(c,a,d,y,C,N){var X=c;do{for(var vt=X.next.next;vt!==X.prev;){if(X.i!==vt.i&&ul(X,vt)){var Ht=Zh(X,vt);return X=W0(X,X.next),Ht=W0(Ht,Ht.next),I1(X,a,d,y,C,N,0),void I1(Ht,a,d,y,C,N,0)}vt=vt.next}X=X.next}while(X!==c)}function j(c,a){return c.x-a.x}function ut(c,a){var d=function(C,N){var X,vt=N,Ht=C.x,Ui=C.y,qr=-1/0;do{if(Ui<=vt.y&&Ui>=vt.next.y&&vt.next.y!==vt.y){var Zs=vt.x+(Ui-vt.y)*(vt.next.x-vt.x)/(vt.next.y-vt.y);if(Zs<=Ht&&Zs>qr&&(qr=Zs,X=vt.x<vt.next.x?vt:vt.next,Zs===Ht))return X}vt=vt.next}while(vt!==N);if(!X)return null;var nl,ju=X,Ku=X.x,ah=X.y,Eh=1/0;vt=X;do Ht>=vt.x&&vt.x>=Ku&&Ht!==vt.x&&us(Ui<ah?Ht:qr,Ui,Ku,ah,Ui<ah?qr:Ht,Ui,vt.x,vt.y)&&(nl=Math.abs(Ui-vt.y)/(Ht-vt.x),Wh(vt,C)&&(nl<Eh||nl===Eh&&(vt.x>X.x||vt.x===X.x&&Ot(X,vt)))&&(X=vt,Eh=nl)),vt=vt.next;while(vt!==ju);return X}(c,a);if(!d)return a;var y=Zh(d,c);return W0(y,y.next),W0(d,d.next)}function Ot(c,a){return Ju(c.prev,c,a.prev)<0&&Ju(a.next,c,c.next)<0}function fi(c,a,d,y,C){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-d)*C|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-y)*C|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Ur(c){var a=c,d=c;do(a.x<d.x||a.x===d.x&&a.y<d.y)&&(d=a),a=a.next;while(a!==c);return d}function us(c,a,d,y,C,N,X,vt){return(C-X)*(a-vt)>=(c-X)*(N-vt)&&(c-X)*(y-vt)>=(d-X)*(a-vt)&&(d-X)*(N-vt)>=(C-X)*(y-vt)}function ul(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(d,y){var C=d;do{if(C.i!==d.i&&C.next.i!==d.i&&C.i!==y.i&&C.next.i!==y.i&&gh(C,C.next,d,y))return!0;C=C.next}while(C!==d);return!1}(c,a)&&(Wh(c,a)&&Wh(a,c)&&function(d,y){var C=d,N=!1,X=(d.x+y.x)/2,vt=(d.y+y.y)/2;do C.y>vt!=C.next.y>vt&&C.next.y!==C.y&&X<(C.next.x-C.x)*(vt-C.y)/(C.next.y-C.y)+C.x&&(N=!N),C=C.next;while(C!==d);return N}(c,a)&&(Ju(c.prev,c,a.prev)||Ju(c,a.prev,a))||oh(c,a)&&Ju(c.prev,c,c.next)>0&&Ju(a.prev,a,a.next)>0)}function Ju(c,a,d){return(a.y-c.y)*(d.x-a.x)-(a.x-c.x)*(d.y-a.y)}function oh(c,a){return c.x===a.x&&c.y===a.y}function gh(c,a,d,y){var C=bh(Ju(c,a,d)),N=bh(Ju(c,a,y)),X=bh(Ju(d,y,c)),vt=bh(Ju(d,y,a));return C!==N&&X!==vt||!(C!==0||!vh(c,d,a))||!(N!==0||!vh(c,y,a))||!(X!==0||!vh(d,c,y))||!(vt!==0||!vh(d,a,y))}function vh(c,a,d){return a.x<=Math.max(c.x,d.x)&&a.x>=Math.min(c.x,d.x)&&a.y<=Math.max(c.y,d.y)&&a.y>=Math.min(c.y,d.y)}function bh(c){return c>0?1:c<0?-1:0}function Wh(c,a){return Ju(c.prev,c,c.next)<0?Ju(c,a,c.next)>=0&&Ju(c,c.prev,a)>=0:Ju(c,a,c.prev)<0||Ju(c,c.next,a)<0}function Zh(c,a){var d=new dd(c.i,c.x,c.y),y=new dd(a.i,a.x,a.y),C=c.next,N=a.prev;return c.next=a,a.prev=c,d.next=C,C.prev=d,y.next=d,d.prev=y,N.next=y,y.prev=N,y}function bd(c,a,d,y){var C=new dd(c,a,d);return y?(C.next=y.next,C.prev=y,y.next.prev=C,y.next=C):(C.prev=C,C.next=C),C}function zd(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function dd(c,a,d){this.i=c,this.x=a,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nd(c,a,d,y){for(var C=0,N=a,X=d-y;N<d;N+=y)C+=(c[X]-c[N])*(c[N+1]+c[X+1]),X=N;return C}function $f(c,a,d,y,C){zf(c,a,d||0,y||c.length-1,C||zp)}function zf(c,a,d,y,C){for(;y>d;){if(y-d>600){var N=y-d+1,X=a-d+1,vt=Math.log(N),Ht=.5*Math.exp(2*vt/3),Ui=.5*Math.sqrt(vt*Ht*(N-Ht)/N)*(X-N/2<0?-1:1);zf(c,a,Math.max(d,Math.floor(a-X*Ht/N+Ui)),Math.min(y,Math.floor(a+(N-X)*Ht/N+Ui)),C)}var qr=c[a],Zs=d,nl=y;for(Ap(c,d,a),C(c[y],qr)>0&&Ap(c,d,y);Zs<nl;){for(Ap(c,Zs,nl),Zs++,nl--;C(c[Zs],qr)<0;)Zs++;for(;C(c[nl],qr)>0;)nl--}C(c[d],qr)===0?Ap(c,d,nl):Ap(c,++nl,y),nl<=a&&(d=nl+1),a<=nl&&(y=nl-1)}}function Ap(c,a,d){var y=c[a];c[a]=c[d],c[d]=y}function zp(c,a){return c<a?-1:c>a?1:0}function wp(c,a){const d=c.length;if(d<=1)return[c];const y=[];let C,N;for(let X=0;X<d;X++){const vt=yd(c[X]);vt!==0&&(c[X].area=Math.abs(vt),N===void 0&&(N=vt<0),N===vt<0?(C&&y.push(C),C=[c[X]]):C.push(c[X]))}if(C&&y.push(C),a>1)for(let X=0;X<y.length;X++)y[X].length<=a||($f(y[X],a,1,y[X].length-1,yp),y[X]=y[X].slice(0,a));return y}function yp(c,a){return a.area-c.area}function cp(c,a,d){const y=d.patternDependencies;let C=!1;for(const N of a){const X=N.paint.get(`${c}-pattern`);X.isConstant()||(C=!0);const vt=X.constantOr(null);vt&&(C=!0,y[vt]=!0)}return C}function Ep(c,a,d,y,C){const N=C.patternDependencies;for(const X of a){const vt=X.paint.get(`${c}-pattern`).value;if(vt.kind!=="constant"){let Ht=vt.evaluate({zoom:y},d,{},C.availableImages);Ht=Ht&&Ht.name?Ht.name:Ht,N[Ht]=!0,d.patterns[X.id]=Ht}}return d}({get exports(){return W1},set exports(c){W1=c}}).exports=Y1,W1.default=Y1,Y1.deviation=function(c,a,d,y){var C=a&&a.length,N=Math.abs(Nd(c,0,C?a[0]*d:c.length,d));if(C)for(var X=0,vt=a.length;X<vt;X++)N-=Math.abs(Nd(c,a[X]*d,X<vt-1?a[X+1]*d:c.length,d));var Ht=0;for(X=0;X<y.length;X+=3){var Ui=y[X]*d,qr=y[X+1]*d,Zs=y[X+2]*d;Ht+=Math.abs((c[Ui]-c[Zs])*(c[qr+1]-c[Ui+1])-(c[Ui]-c[qr])*(c[Zs+1]-c[Ui+1]))}return N===0&&Ht===0?0:Math.abs((Ht-N)/N)},Y1.flatten=function(c){for(var a=c[0][0].length,d={vertices:[],holes:[],dimensions:a},y=0,C=0;C<c.length;C++){for(var N=0;N<c[C].length;N++)for(var X=0;X<a;X++)d.vertices.push(c[C][N][X]);C>0&&d.holes.push(y+=c[C-1].length)}return d};class gp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fp,this.indexArray=new y_,this.indexArray2=new dv,this.programConfigurations=new f1(a.layers,a.zoom),this.segments=new Og,this.segments2=new Og,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.projection=a.projection}populate(a,d,y,C){this.hasPattern=cp("fill",this.layers,d);const N=this.layers[0].layout.get("fill-sort-key"),X=[];for(const{feature:vt,id:Ht,index:Ui,sourceLayerIndex:qr}of a){const Zs=this.layers[0]._featureFilter.needGeometry,nl=Ov(vt,Zs);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),nl,y))continue;const ju=N?N.evaluate(nl,{},y,d.availableImages):void 0,Ku={id:Ht,properties:vt.properties,type:vt.type,sourceLayerIndex:qr,index:Ui,geometry:Zs?nl.geometry:Rv(vt,y,C),patterns:{},sortKey:ju};X.push(Ku)}N&&X.sort((vt,Ht)=>vt.sortKey-Ht.sortKey);for(const vt of X){const{geometry:Ht,index:Ui,sourceLayerIndex:qr}=vt;if(this.hasPattern){const Zs=Ep("fill",this.layers,vt,this.zoom,d);this.patternFeatures.push(Zs)}else this.addFeature(vt,Ht,Ui,y,{},d.availableImages);d.featureIndex.insert(a[Ui].feature,Ht,Ui,qr,this.index)}}update(a,d,y,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,y,C)}addFeatures(a,d,y,C,N){for(const X of this.patternFeatures)this.addFeature(X,X.geometry,X.index,d,y,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,u2),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,d,y,C,N,X=[]){for(const vt of wp(d,500)){let Ht=0;for(const Ku of vt)Ht+=Ku.length;const Ui=this.segments.prepareSegment(Ht,this.layoutVertexArray,this.indexArray),qr=Ui.vertexLength,Zs=[],nl=[];for(const Ku of vt){if(Ku.length===0)continue;Ku!==vt[0]&&nl.push(Zs.length/2);const ah=this.segments2.prepareSegment(Ku.length,this.layoutVertexArray,this.indexArray2),Eh=ah.vertexLength;this.layoutVertexArray.emplaceBack(Ku[0].x,Ku[0].y),this.indexArray2.emplaceBack(Eh+Ku.length-1,Eh),Zs.push(Ku[0].x),Zs.push(Ku[0].y);for(let zh=1;zh<Ku.length;zh++)this.layoutVertexArray.emplaceBack(Ku[zh].x,Ku[zh].y),this.indexArray2.emplaceBack(Eh+zh-1,Eh+zh),Zs.push(Ku[zh].x),Zs.push(Ku[zh].y);ah.vertexLength+=Ku.length,ah.primitiveLength+=Ku.length}const ju=W1(Zs,nl);for(let Ku=0;Ku<ju.length;Ku+=3)this.indexArray.emplaceBack(qr+ju[Ku],qr+ju[Ku+1],qr+ju[Ku+2]);Ui.vertexLength+=Ht,Ui.primitiveLength+=ju.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,N,X,C)}}Ip(gp,"FillBucket",{omit:["layers","patternFeatures"]});const Qf=new Bf({"fill-sort-key":new Bd(Pd.layout_fill["fill-sort-key"])});var Gp={paint:new Bf({"fill-antialias":new pd(Pd.paint_fill["fill-antialias"]),"fill-opacity":new Bd(Pd.paint_fill["fill-opacity"]),"fill-color":new Bd(Pd.paint_fill["fill-color"]),"fill-outline-color":new Bd(Pd.paint_fill["fill-outline-color"]),"fill-translate":new pd(Pd.paint_fill["fill-translate"]),"fill-translate-anchor":new pd(Pd.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bd(Pd.paint_fill["fill-pattern"])}),layout:Qf};const $p=Lp([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ym=Lp([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ug=Lp([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_g}=$p;var zg={},i0=Js,s_=yg;function yg(c,a,d,y,C){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=C,c.readFields(i_,this,a)}function i_(c,a,d){c==1?a.id=d.readVarint():c==2?function(y,C){for(var N=y.readVarint()+y.pos;y.pos<N;){var X=C._keys[y.readVarint()],vt=C._values[y.readVarint()];C.properties[X]=vt}}(d,a):c==3?a.type=d.readVarint():c==4&&(a._geometry=d.pos)}function v_(c){for(var a,d,y=0,C=0,N=c.length,X=N-1;C<N;X=C++)y+=((d=c[X]).x-(a=c[C]).x)*(a.y+d.y);return y}yg.types=["Unknown","Point","LineString","Polygon"],yg.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,d=c.readVarint()+c.pos,y=1,C=0,N=0,X=0,vt=[];c.pos<d;){if(C<=0){var Ht=c.readVarint();y=7&Ht,C=Ht>>3}if(C--,y===1||y===2)N+=c.readSVarint(),X+=c.readSVarint(),y===1&&(a&&vt.push(a),a=[]),a.push(new i0(N,X));else{if(y!==7)throw new Error("unknown command "+y);a&&a.push(a[0].clone())}}return a&&vt.push(a),vt},yg.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,d=1,y=0,C=0,N=0,X=1/0,vt=-1/0,Ht=1/0,Ui=-1/0;c.pos<a;){if(y<=0){var qr=c.readVarint();d=7&qr,y=qr>>3}if(y--,d===1||d===2)(C+=c.readSVarint())<X&&(X=C),C>vt&&(vt=C),(N+=c.readSVarint())<Ht&&(Ht=N),N>Ui&&(Ui=N);else if(d!==7)throw new Error("unknown command "+d)}return[X,Ht,vt,Ui]},yg.prototype.toGeoJSON=function(c,a,d){var y,C,N=this.extent*Math.pow(2,d),X=this.extent*c,vt=this.extent*a,Ht=this.loadGeometry(),Ui=yg.types[this.type];function qr(ju){for(var Ku=0;Ku<ju.length;Ku++){var ah=ju[Ku];ju[Ku]=[360*(ah.x+X)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(ah.y+vt)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var Zs=[];for(y=0;y<Ht.length;y++)Zs[y]=Ht[y][0];qr(Ht=Zs);break;case 2:for(y=0;y<Ht.length;y++)qr(Ht[y]);break;case 3:for(Ht=function(ju){var Ku=ju.length;if(Ku<=1)return[ju];for(var ah,Eh,zh=[],Yh=0;Yh<Ku;Yh++){var kh=v_(ju[Yh]);kh!==0&&(Eh===void 0&&(Eh=kh<0),Eh===kh<0?(ah&&zh.push(ah),ah=[ju[Yh]]):ah.push(ju[Yh]))}return ah&&zh.push(ah),zh}(Ht),y=0;y<Ht.length;y++)for(C=0;C<Ht[y].length;C++)qr(Ht[y][C])}Ht.length===1?Ht=Ht[0]:Ui="Multi"+Ui;var nl={type:"Feature",geometry:{type:Ui,coordinates:Ht},properties:this.properties};return"id"in this&&(nl.id=this.id),nl};var O_=s_,J_=$g;function $g(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(x_,this,a),this.length=this._features.length}function x_(c,a,d){c===15?a.version=d.readVarint():c===1?a.name=d.readString():c===5?a.extent=d.readVarint():c===2?a._features.push(d.pos):c===3?a._keys.push(d.readString()):c===4&&a._values.push(function(y){for(var C=null,N=y.readVarint()+y.pos;y.pos<N;){var X=y.readVarint()>>3;C=X===1?y.readString():X===2?y.readFloat():X===3?y.readDouble():X===4?y.readVarint64():X===5?y.readVarint():X===6?y.readSVarint():X===7?y.readBoolean():null}return C}(d))}$g.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new O_(this._pbf,a,this.extent,this._keys,this._values)};var B_=J_;function ey(c,a,d){if(c===3){var y=new B_(d,d.readVarint()+d.pos);y.length&&(a[y.name]=y)}}var z_=zg.VectorTile=function(c,a){this.layers=c.readFields(ey,{},a)},b_=zg.VectorTileFeature=s_;function vg(c,a,d,y){const C=[],N=y===0?(X,vt,Ht,Ui,qr,Zs)=>{X.push(new Js(Zs,Ht+(Zs-vt)/(Ui-vt)*(qr-Ht)))}:(X,vt,Ht,Ui,qr,Zs)=>{X.push(new Js(vt+(Zs-Ht)/(qr-Ht)*(Ui-vt),Zs))};for(const X of c){const vt=[];for(const Ht of X){if(Ht.length<=2)continue;const Ui=[];for(let nl=0;nl<Ht.length-1;nl++){const ju=Ht[nl].x,Ku=Ht[nl].y,ah=Ht[nl+1].x,Eh=Ht[nl+1].y,zh=y===0?ju:Ku,Yh=y===0?ah:Eh;zh<a?Yh>a&&N(Ui,ju,Ku,ah,Eh,a):zh>d?Yh<d&&N(Ui,ju,Ku,ah,Eh,d):Ui.push(Ht[nl]),Yh<a&&zh>=a&&N(Ui,ju,Ku,ah,Eh,a),Yh>d&&zh<=d&&N(Ui,ju,Ku,ah,Eh,d)}let qr=Ht[Ht.length-1];const Zs=y===0?qr.x:qr.y;Zs>=a&&Zs<=d&&Ui.push(qr),Ui.length&&(qr=Ui[Ui.length-1],Ui[0].x===qr.x&&Ui[0].y===qr.y||Ui.push(Ui[0]),vt.push(Ui))}vt.length&&C.push(vt)}return C}zg.VectorTileLayer=J_;const w_=b_.types,vm=Math.pow(2,13);function E_(c,a,d,y,C,N,X,vt){c.emplaceBack((a<<1)+X,(d<<1)+N,(Math.floor(y*vm)<<1)+C,Math.round(vt))}function qg(c,a,d){c.emplaceBack(a.x,a.y,a.z,d[0]*16384,d[1]*16384,d[2]*16384)}class S_{constructor(){this.acc=new Js(0,0),this.polyCount=[]}startRing(a){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Js(a.x,a.y),this.max=new Js(a.x,a.y))}append(a,d){this.currentPolyCount.edges++,this.acc._add(a);const y=this.min,C=this.max;a.x<y.x?y.x=a.x:a.x>C.x&&(C.x=a.x),a.y<y.y?y.y=a.y:a.y>C.y&&(C.y=a.y),((a.x===0||a.x===Hp)&&a.x===d.x)!=((a.y===0||a.y===Hp)&&a.y===d.y)&&this.processBorderOverlap(a,d),d.x<0!=a.x<0&&this.addBorderIntersection(0,Kp(d.y,a.y,(0-d.x)/(a.x-d.x))),d.x>Hp!=a.x>Hp&&this.addBorderIntersection(1,Kp(d.y,a.y,(Hp-d.x)/(a.x-d.x))),d.y<0!=a.y<0&&this.addBorderIntersection(2,Kp(d.x,a.x,(0-d.y)/(a.y-d.y))),d.y>Hp!=a.y>Hp&&this.addBorderIntersection(3,Kp(d.x,a.x,(Hp-d.y)/(a.y-d.y)))}addBorderIntersection(a,d){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const y=this.borders[a];d<y[0]&&(y[0]=d),d>y[1]&&(y[1]=d)}processBorderOverlap(a,d){if(a.x===d.x){if(a.y===d.y)return;const y=a.x===0?0:1;this.addBorderIntersection(y,d.y),this.addBorderIntersection(y,a.y)}else{const y=a.y===0?2:3;this.addBorderIntersection(y,d.x),this.addBorderIntersection(y,a.x)}}centroid(){const a=this.polyCount.reduce((d,y)=>d+y.edges,0);return a!==0?this.acc.div(a)._round():new Js(0,0)}span(){return new Js(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((a,d)=>a+ +(d[0]!==Number.MAX_VALUE),0)}}class ty{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.layoutVertexArray=new Am,this.centroidVertexArray=new z1,this.indexArray=new y_,this.programConfigurations=new f1(a.layers,a.zoom),this.segments=new Og,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.enableTerrain=a.enableTerrain}populate(a,d,y,C){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,d),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(N){const X=Math.exp(Math.PI*(1-N.y/(1<<N.z)*2));return 80150034*X/(X*X+1)/Hp/(1<<N.z)}(y),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:N,id:X,index:vt,sourceLayerIndex:Ht}of a){const Ui=this.layers[0]._featureFilter.needGeometry,qr=Ov(N,Ui);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),qr,y))continue;const Zs={id:X,sourceLayerIndex:Ht,index:vt,geometry:Ui?qr.geometry:Rv(N,y,C),properties:N.properties,type:N.type,patterns:{}},nl=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,Zs,this.zoom,d)):this.addFeature(Zs,Zs.geometry,vt,y,{},d.availableImages,C),d.featureIndex.insert(N,Zs.geometry,vt,Ht,this.index,nl)}this.sortBorders()}addFeatures(a,d,y,C,N){for(const X of this.features){const{geometry:vt}=X;this.addFeature(X,vt,X.index,d,y,C,N)}this.sortBorders()}update(a,d,y,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,y,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,_g),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,ug.members,!0))),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,ym.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,d,y,C,N,X,vt){const Ht=[new Js(0,0),new Js(Hp,Hp)],Ui=vt.projection,qr=Ui.name==="globe",Zs=this.enableTerrain&&!qr?new S_:null,nl=w_[a.type]==="Polygon";qr&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new My);const ju=wp(d,500);for(let zh=ju.length-1;zh>=0;zh--){const Yh=ju[zh];(Yh.length===0||(Ku=Yh[0]).every(kh=>kh.x<=0)||Ku.every(kh=>kh.x>=Hp)||Ku.every(kh=>kh.y<=0)||Ku.every(kh=>kh.y>=Hp))&&ju.splice(zh,1)}var Ku;let ah;if(qr)ah=K1(ju,Ht,C);else{ah=[];for(const zh of ju)ah.push({polygon:zh,bounds:Ht})}const Eh=nl?this.edgeRadius:0;for(const{polygon:zh,bounds:Yh}of ah){let kh=0,Gh=0;for(const ed of zh)nl&&!ed[0].equals(ed[ed.length-1])&&ed.push(ed[0]),Gh+=nl?ed.length-1:ed.length;const nd=this.segments.prepareSegment((nl?5:4)*Gh,this.layoutVertexArray,this.indexArray);if(nl){const ed=[],Rd=[];kh=nd.vertexLength;for(const Sf of zh){let Zf,jd;Sf.length&&Sf!==zh[0]&&Rd.push(ed.length/2),Zf=Sf[1].sub(Sf[0])._perp()._unit();for(let Pf=1;Pf<Sf.length;Pf++){const Rf=Sf[Pf],Uf=Sf[Pf===Sf.length-1?1:Pf+1];let{x:Xf,y:Hd}=Rf;if(Eh){jd=Uf.sub(Rf)._perp()._unit();const up=Zf.add(jd)._unit(),jp=Eh*Math.min(4,1/(Zf.x*up.x+Zf.y*up.y));Xf+=jp*up.x,Hd+=jp*up.y,Zf=jd}E_(this.layoutVertexArray,Xf,Hd,0,0,1,1,0),nd.vertexLength++,ed.push(Rf.x,Rf.y),qr&&qg(this.layoutVertexExtArray,Ui.projectTilePoint(Xf,Hd,C),Ui.upVector(C,Xf,Hd))}}const kd=W1(ed,Rd);for(let Sf=0;Sf<kd.length;Sf+=3)this.indexArray.emplaceBack(kh+kd[Sf],kh+kd[Sf+2],kh+kd[Sf+1]),nd.primitiveLength++}for(const ed of zh){Zs&&ed.length&&Zs.startRing(ed[0]);let Rd,kd,Sf,Zf=ed.length>4&&Py(ed[ed.length-2],ed[0],ed[1]),jd=Eh?Y0(ed[ed.length-2],ed[0],ed[1],Eh):0;kd=ed[1].sub(ed[0])._perp()._unit();let Pf=!0;for(let Rf=1,Uf=0;Rf<ed.length;Rf++){let Xf=ed[Rf-1],Hd=ed[Rf];const up=ed[Rf===ed.length-1?1:Rf+1];if(Zs&&nl&&Zs.currentPolyCount.top++,n0(Hd,Xf,Yh)){Eh&&(kd=up.sub(Hd)._perp()._unit(),Pf=!Pf);continue}Zs&&Zs.append(Hd,Xf);const jp=Hd.sub(Xf)._perp(),vp=jp.x/(Math.abs(jp.x)+Math.abs(jp.y)),Rp=jp.y>0?1:0,dp=Xf.dist(Hd);if(Uf+dp>32768&&(Uf=0),Eh){Sf=up.sub(Hd)._perp()._unit();let pm=gv(Xf,Hd,up,k0(kd,Sf),Eh);isNaN(pm)&&(pm=0);const Wp=Hd.sub(Xf)._unit();Xf=Xf.add(Wp.mult(jd))._round(),Hd=Hd.add(Wp.mult(-pm))._round(),jd=pm,kd=Sf}const Xp=nd.vertexLength,xm=ed.length>4&&Py(Xf,Hd,up);let gm=iy(Uf,Zf,Pf);if(E_(this.layoutVertexArray,Xf.x,Xf.y,vp,Rp,0,0,gm),E_(this.layoutVertexArray,Xf.x,Xf.y,vp,Rp,0,1,gm),Uf+=dp,gm=iy(Uf,xm,!Pf),Zf=xm,E_(this.layoutVertexArray,Hd.x,Hd.y,vp,Rp,0,0,gm),E_(this.layoutVertexArray,Hd.x,Hd.y,vp,Rp,0,1,gm),nd.vertexLength+=4,this.indexArray.emplaceBack(Xp+0,Xp+1,Xp+2),this.indexArray.emplaceBack(Xp+1,Xp+3,Xp+2),nd.primitiveLength+=2,Eh){const pm=kh+(Rf===1?ed.length-2:Rf-2),Wp=Rf===1?kh:pm+1;if(this.indexArray.emplaceBack(Xp+1,pm,Xp+3),this.indexArray.emplaceBack(pm,Wp,Xp+3),nd.primitiveLength+=2,Rd===void 0&&(Rd=Xp),!n0(up,ed[Rf],Yh)){const Zm=Rf===ed.length-1?Rd:nd.vertexLength;this.indexArray.emplaceBack(Xp+2,Xp+3,Zm),this.indexArray.emplaceBack(Xp+3,Zm+1,Zm),this.indexArray.emplaceBack(Xp+3,Wp,Zm+1),nd.primitiveLength+=3}Pf=!Pf}if(qr){const pm=this.layoutVertexExtArray,Wp=Ui.projectTilePoint(Xf.x,Xf.y,C),Zm=Ui.projectTilePoint(Hd.x,Hd.y,C),tm=Ui.upVector(C,Xf.x,Xf.y),bm=Ui.upVector(C,Hd.x,Hd.y);qg(pm,Wp,tm),qg(pm,Wp,tm),qg(pm,Zm,bm),qg(pm,Zm,bm)}}nl&&(kh+=ed.length-1)}}if(Zs&&Zs.polyCount.length>0){if(Zs.borders){Zs.vertexArrayOffset=this.centroidVertexArray.length;const zh=Zs.borders,Yh=this.featuresOnBorder.push(Zs)-1;for(let kh=0;kh<4;kh++)zh[kh][0]!==Number.MAX_VALUE&&this.borders[kh].push(Yh)}this.encodeCentroid(Zs.borders?void 0:Zs.centroid(),Zs)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,N,X,C)}sortBorders(){for(let a=0;a<4;a++)this.borders[a].sort((d,y)=>this.featuresOnBorder[d].borders[a][0]-this.featuresOnBorder[y].borders[a][0])}encodeCentroid(a,d,y=!0){let C,N;if(a)if(a.y!==0){const vt=d.span()._mult(this.tileToMeter);C=(Math.max(a.x,1)<<3)+Math.min(7,Math.round(vt.x/10)),N=(Math.max(a.y,1)<<3)+Math.min(7,Math.round(vt.y/10))}else C=Math.ceil(7*(a.x+450)),N=0;else C=0,N=+y;let X=y?this.centroidVertexArray.length:d.vertexArrayOffset;for(const vt of d.polyCount){y&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*vt.edges+vt.top);for(let Ht=0;Ht<vt.top;Ht++)this.centroidVertexArray.emplace(X++,C,N);for(let Ht=0;Ht<2*vt.edges;Ht++)this.centroidVertexArray.emplace(X++,0,N),this.centroidVertexArray.emplace(X++,C,N)}}}function k0(c,a){const d=c.add(a)._unit();return c.x*d.x+c.y*d.y}function Y0(c,a,d,y){const C=a.sub(c)._perp()._unit(),N=d.sub(a)._perp()._unit();return gv(c,a,d,k0(C,N),y)}function gv(c,a,d,y,C){const N=Math.sqrt(1-y*y);return Math.min(c.dist(a)/3,a.dist(d)/3,C*N/y)}function n0(c,a,d){return c.x<d[0].x&&a.x<d[0].x||c.x>d[1].x&&a.x>d[1].x||c.y<d[0].y&&a.y<d[0].y||c.y>d[1].y&&a.y>d[1].y}function Py(c,a,d){if(c.x<0||c.x>=Hp||a.x<0||a.x>=Hp||d.x<0||d.x>=Hp)return!1;const y=d.sub(a),C=y.perp(),N=c.sub(a);return(y.x*N.x+y.y*N.y)/Math.sqrt((y.x*y.x+y.y*y.y)*(N.x*N.x+N.y*N.y))>-.866&&C.x*N.x+C.y*N.y<0}function iy(c,a,d){const y=a?2|c:-3&c;return d?1|y:-2&y}function _v(){const c=Math.PI/32,a=Math.tan(c),d=xx;return d*Math.sqrt(1+2*a*a)-d}function K1(c,a,d){const y=1<<d.z,C=e0(d.x/y),N=e0((d.x+1)/y),X=Cg(d.y/y),vt=Cg((d.y+1)/y);return function(Ht,Ui,qr,Zs,nl=0,ju){const Ku=[];if(!Ht.length||!qr||!Zs)return Ku;const ah=(ed,Rd)=>{for(const kd of ed)Ku.push({polygon:kd,bounds:Rd})},Eh=Math.ceil(Math.log2(qr)),zh=Math.ceil(Math.log2(Zs)),Yh=Eh-zh,kh=[];for(let ed=0;ed<Math.abs(Yh);ed++)kh.push(Yh>0?0:1);for(let ed=0;ed<Math.min(Eh,zh);ed++)kh.push(0),kh.push(1);let Gh=Ht;if(Gh=vg(Gh,Ui[0].y-nl,Ui[1].y+nl,1),Gh=vg(Gh,Ui[0].x-nl,Ui[1].x+nl,0),!Gh.length)return Ku;const nd=[];for(kh.length?nd.push({polygons:Gh,bounds:Ui,depth:0}):ah(Gh,Ui);nd.length;){const ed=nd.pop(),Rd=ed.depth,kd=kh[Rd],Sf=ed.bounds[0],Zf=ed.bounds[1],jd=kd===0?Sf.x:Sf.y,Pf=kd===0?Zf.x:Zf.y,Rf=ju?ju(kd,jd,Pf):.5*(jd+Pf),Uf=vg(ed.polygons,jd-nl,Rf+nl,kd),Xf=vg(ed.polygons,Rf-nl,Pf+nl,kd);if(Uf.length){const Hd=[Sf,new Js(kd===0?Rf:Zf.x,kd===1?Rf:Zf.y)];kh.length>Rd+1?nd.push({polygons:Uf,bounds:Hd,depth:Rd+1}):ah(Uf,Hd)}if(Xf.length){const Hd=[new Js(kd===0?Rf:Sf.x,kd===1?Rf:Sf.y),Zf];kh.length>Rd+1?nd.push({polygons:Xf,bounds:Hd,depth:Rd+1}):ah(Xf,Hd)}}return Ku}(c,a,Math.ceil((N-C)/11.25),Math.ceil((X-vt)/11.25),1,(Ht,Ui,qr)=>{if(Ht===0)return .5*(Ui+qr);{const Zs=Cg((d.y+Ui/Hp)/y);return(X0(.5*(Cg((d.y+qr/Hp)/y)+Zs))*y-d.y)*Hp}})}Ip(ty,"FillExtrusionBucket",{omit:["layers","features"]}),Ip(S_,"PartMetadata");const Cw=new Bf({"fill-extrusion-edge-radius":new pd(Pd["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Fb={paint:new Bf({"fill-extrusion-opacity":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bd(Pd["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bd(Pd["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bd(Pd["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bd(Pd["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Cw};function eb(c,a,d){var y=2*Math.PI*6378137/256/Math.pow(2,d);return[c*y-2*Math.PI*6378137/2,a*y-2*Math.PI*6378137/2]}class D0{constructor(a,d,y){this.z=a,this.x=d,this.y=y,this.key=M1(0,a,a,d,y)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,d){const y=function(N,X,vt){var Ht=eb(256*N,256*(X=Math.pow(2,vt)-X-1),vt),Ui=eb(256*(N+1),256*(X+1),vt);return Ht[0]+","+Ht[1]+","+Ui[0]+","+Ui[1]}(this.x,this.y,this.z),C=function(N,X,vt){let Ht,Ui="";for(let qr=N;qr>0;qr--)Ht=1<<qr-1,Ui+=(X&Ht?1:0)+(vt&Ht?2:0);return Ui}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",C).replace("{bbox-epsg-3857}",y)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $b{constructor(a,d){this.wrap=a,this.canonical=d,this.key=M1(a,d.z,d.z,d.x,d.y)}}class T_{constructor(a,d,y,C,N){this.overscaledZ=a,this.wrap=d,this.canonical=new D0(y,+C,+N),this.key=d===0&&a===y?this.canonical.key:M1(d,a,y,C,N)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const d=this.canonical.z-a;return a>this.canonical.z?new T_(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new T_(a,this.wrap,a,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(a,d=!0){if(this.overscaledZ===a&&d)return this.key;if(a>this.canonical.z)return M1(this.wrap*+d,a,this.canonical.z,this.canonical.x,this.canonical.y);{const y=this.canonical.z-a;return M1(this.wrap*+d,a,a,this.canonical.x>>y,this.canonical.y>>y)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const d=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>d&&a.canonical.y===this.canonical.y>>d}children(a){if(this.overscaledZ>=a)return[new T_(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,y=2*this.canonical.x,C=2*this.canonical.y;return[new T_(d,this.wrap,d,y,C),new T_(d,this.wrap,d,y+1,C),new T_(d,this.wrap,d,y,C+1),new T_(d,this.wrap,d,y+1,C+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new T_(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new T_(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $b(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function M1(c,a,d,y,C){const N=1<<Math.min(d,22);let X=N*(C%N)+y%N;return c&&d<22&&(X+=N*N*((c<0?-2*c-1:2*c)%(1<<2*(22-d)))),16*(32*X+d)+(a-d)}Ip(D0,"CanonicalTileID"),Ip(T_,"OverscaledTileID",{omit:["projMatrix"]});class C1 extends Js{constructor(a,d,y){super(a,d),this.z=y}}function Ax(c,a){return c.x*a.x+c.y*a.y}function Aw(c,a){if(c.length===1){let d=0;const y=a[d++];let C;for(;!C||y.equals(C);)if(C=a[d++],!C)return 1/0;for(;d<a.length;d++){const N=a[d],X=c[0],vt=C.sub(y),Ht=N.sub(y),Ui=X.sub(y),qr=Ax(vt,vt),Zs=Ax(vt,Ht),nl=Ax(Ht,Ht),ju=Ax(Ui,vt),Ku=Ax(Ui,Ht),ah=qr*nl-Zs*Zs,Eh=(nl*ju-Zs*Ku)/ah,zh=(qr*Ku-Zs*ju)/ah,Yh=y.z*(1-Eh-zh)+C.z*Eh+N.z*zh;if(isFinite(Yh))return Yh}return 1/0}{let d=1/0;for(const y of a)d=Math.min(d,y.z);return d}}function Pw(c,a,d,y,C,N,X,vt){const Ht=X*C.getElevationAt(c,a,!0,!0),Ui=N[0]!==0,qr=Ui?N[1]===0?X*(N[0]/7-450):X*function(Zs,nl,ju){const Ku=Math.floor(nl[0]/8),ah=Math.floor(nl[1]/8),Eh=10*(nl[0]-8*Ku),zh=10*(nl[1]-8*ah),Yh=Zs.getElevationAt(Ku,ah,!0,!0),kh=Zs.getMeterToDEM(ju),Gh=Math.floor(.5*(Eh*kh-1)),nd=Math.floor(.5*(zh*kh-1)),ed=Zs.tileCoordToPixel(Ku,ah),Rd=2*Gh+1,kd=2*nd+1,Sf=function(Xf,Hd,up,jp,vp){return[Xf.getElevationAtPixel(Hd,up,!0),Xf.getElevationAtPixel(Hd+vp,up,!0),Xf.getElevationAtPixel(Hd,up+vp,!0),Xf.getElevationAtPixel(Hd+jp,up+vp,!0)]}(Zs,ed.x-Gh,ed.y-nd,Rd,kd),Zf=Math.abs(Sf[0]-Sf[1]),jd=Math.abs(Sf[2]-Sf[3]),Pf=Math.abs(Sf[0]-Sf[2])+Math.abs(Sf[1]-Sf[3]),Rf=Math.min(.25,.5*kh*(Zf+jd)/Rd),Uf=Math.min(.25,.5*kh*Pf/kd);return Yh+Math.max(Rf*Eh,Uf*zh)}(C,N,vt):Ht;return{base:Ht+(d===0)?-1:d,top:Ui?Math.max(qr+y,Ht+d+2):Ht+y}}const d2=Lp([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:f2}=d2,p2=Lp([{name:"a_packed",components:4,type:"Float32"}]),{members:m2}=p2,g2=b_.types,K0=Math.cos(Math.PI/180*37.5);class A1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new jm,this.layoutVertexArray2=new Fm,this.indexArray=new y_,this.programConfigurations=new f1(a.layers,a.zoom),this.segments=new Og,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,y,C){this.hasPattern=cp("line",this.layers,d);const N=this.layers[0].layout.get("line-sort-key"),X=[];for(const{feature:qr,id:Zs,index:nl,sourceLayerIndex:ju}of a){const Ku=this.layers[0]._featureFilter.needGeometry,ah=Ov(qr,Ku);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),ah,y))continue;const Eh=N?N.evaluate(ah,{},y):void 0,zh={id:Zs,properties:qr.properties,type:qr.type,sourceLayerIndex:ju,index:nl,geometry:Ku?ah.geometry:Rv(qr,y,C),patterns:{},sortKey:Eh};X.push(zh)}N&&X.sort((qr,Zs)=>qr.sortKey-Zs.sortKey);const{lineAtlas:vt,featureIndex:Ht}=d,Ui=this.addConstantDashes(vt);for(const qr of X){const{geometry:Zs,index:nl,sourceLayerIndex:ju}=qr;if(Ui&&this.addFeatureDashes(qr,vt),this.hasPattern){const Ku=Ep("line",this.layers,qr,this.zoom,d);this.patternFeatures.push(Ku)}else this.addFeature(qr,Zs,nl,y,vt.positions,d.availableImages);Ht.insert(a[nl].feature,Zs,nl,ju,this.index)}}addConstantDashes(a){let d=!1;for(const y of this.layers){const C=y.paint.get("line-dasharray").value,N=y.layout.get("line-cap").value;if(C.kind!=="constant"||N.kind!=="constant")d=!0;else{const X=N.value,vt=C.value;if(!vt)continue;a.addDash(vt,X)}}return d}addFeatureDashes(a,d){const y=this.zoom;for(const C of this.layers){const N=C.paint.get("line-dasharray").value,X=C.layout.get("line-cap").value;if(N.kind==="constant"&&X.kind==="constant")continue;let vt,Ht;if(N.kind==="constant"){if(vt=N.value,!vt)continue}else vt=N.evaluate({zoom:y},a);Ht=X.kind==="constant"?X.value:X.evaluate({zoom:y},a),d.addDash(vt,Ht),a.patterns[C.id]=d.getKey(vt,Ht)}}update(a,d,y,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,y,C)}addFeatures(a,d,y,C,N){for(const X of this.patternFeatures)this.addFeature(X,X.geometry,X.index,d,y,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,m2)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,f2),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,d,y,C,N,X){const vt=this.layers[0].layout,Ht=vt.get("line-join").evaluate(a,{}),Ui=vt.get("line-cap").evaluate(a,{}),qr=vt.get("line-miter-limit"),Zs=vt.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const nl of d)this.addLine(nl,a,Ht,Ui,qr,Zs);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,N,X,C)}addLine(a,d,y,C,N,X){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let zh=0;zh<a.length-1;zh++)this.totalDistance+=a[zh].dist(a[zh+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const vt=g2[d.type]==="Polygon";let Ht=a.length;for(;Ht>=2&&a[Ht-1].equals(a[Ht-2]);)Ht--;let Ui=0;for(;Ui<Ht-1&&a[Ui].equals(a[Ui+1]);)Ui++;if(Ht<(vt?3:2))return;y==="bevel"&&(N=1.05);const qr=this.overscaling<=16?122880/(512*this.overscaling):0,Zs=this.segments.prepareSegment(10*Ht,this.layoutVertexArray,this.indexArray);let nl,ju,Ku,ah,Eh;this.e1=this.e2=-1,vt&&(nl=a[Ht-2],Eh=a[Ui].sub(nl)._unit()._perp());for(let zh=Ui;zh<Ht;zh++){if(Ku=zh===Ht-1?vt?a[Ui+1]:void 0:a[zh+1],Ku&&a[zh].equals(Ku))continue;Eh&&(ah=Eh),nl&&(ju=nl),nl=a[zh],Eh=Ku?Ku.sub(nl)._unit()._perp():ah,ah=ah||Eh;let Yh=ah.add(Eh);Yh.x===0&&Yh.y===0||Yh._unit();const kh=ah.x*Eh.x+ah.y*Eh.y,Gh=Yh.x*Eh.x+Yh.y*Eh.y,nd=Gh!==0?1/Gh:1/0,ed=2*Math.sqrt(2-2*Gh),Rd=Gh<K0&&ju&&Ku,kd=ah.x*Eh.y-ah.y*Eh.x>0;if(Rd&&zh>Ui){const jd=nl.dist(ju);if(jd>2*qr){const Pf=nl.sub(nl.sub(ju)._mult(qr/jd)._round());this.updateDistance(ju,Pf),this.addCurrentVertex(Pf,ah,0,0,Zs),ju=Pf}}const Sf=ju&&Ku;let Zf=Sf?y:vt?"butt":C;if(Sf&&Zf==="round"&&(nd<X?Zf="miter":nd<=2&&(Zf="fakeround")),Zf==="miter"&&nd>N&&(Zf="bevel"),Zf==="bevel"&&(nd>2&&(Zf="flipbevel"),nd<N&&(Zf="miter")),ju&&this.updateDistance(ju,nl),Zf==="miter")Yh._mult(nd),this.addCurrentVertex(nl,Yh,0,0,Zs);else if(Zf==="flipbevel"){if(nd>100)Yh=Eh.mult(-1);else{const jd=nd*ah.add(Eh).mag()/ah.sub(Eh).mag();Yh._perp()._mult(jd*(kd?-1:1))}this.addCurrentVertex(nl,Yh,0,0,Zs),this.addCurrentVertex(nl,Yh.mult(-1),0,0,Zs)}else if(Zf==="bevel"||Zf==="fakeround"){const jd=-Math.sqrt(nd*nd-1),Pf=kd?jd:0,Rf=kd?0:jd;if(ju&&this.addCurrentVertex(nl,ah,Pf,Rf,Zs),Zf==="fakeround"){const Uf=Math.round(180*ed/Math.PI/20);for(let Xf=1;Xf<Uf;Xf++){let Hd=Xf/Uf;if(Hd!==.5){const jp=Hd-.5;Hd+=Hd*jp*(Hd-1)*((1.0904+kh*(kh*(3.55645-1.43519*kh)-3.2452))*jp*jp+(.848013+kh*(.215638*kh-1.06021)))}const up=Eh.sub(ah)._mult(Hd)._add(ah)._unit()._mult(kd?-1:1);this.addHalfVertex(nl,up.x,up.y,!1,kd,0,Zs)}}Ku&&this.addCurrentVertex(nl,Eh,-Pf,-Rf,Zs)}else if(Zf==="butt")this.addCurrentVertex(nl,Yh,0,0,Zs);else if(Zf==="square"){const jd=ju?1:-1;ju||this.addCurrentVertex(nl,Yh,jd,jd,Zs),this.addCurrentVertex(nl,Yh,0,0,Zs),ju&&this.addCurrentVertex(nl,Yh,jd,jd,Zs)}else Zf==="round"&&(ju&&(this.addCurrentVertex(nl,ah,0,0,Zs),this.addCurrentVertex(nl,ah,1,1,Zs,!0)),Ku&&(this.addCurrentVertex(nl,Eh,-1,-1,Zs,!0),this.addCurrentVertex(nl,Eh,0,0,Zs)));if(Rd&&zh<Ht-1){const jd=nl.dist(Ku);if(jd>2*qr){const Pf=nl.add(Ku.sub(nl)._mult(qr/jd)._round());this.updateDistance(nl,Pf),this.addCurrentVertex(Pf,Eh,0,0,Zs),nl=Pf}}}}addCurrentVertex(a,d,y,C,N,X=!1){const vt=d.y*C-d.x,Ht=-d.y-d.x*C;this.addHalfVertex(a,d.x+d.y*y,d.y-d.x*y,X,!1,y,N),this.addHalfVertex(a,vt,Ht,X,!0,-C,N)}addHalfVertex({x:a,y:d},y,C,N,X,vt,Ht){this.layoutVertexArray.emplaceBack((a<<1)+(N?1:0),(d<<1)+(X?1:0),Math.round(63*y)+128,Math.round(63*C)+128,1+(vt===0?0:vt<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const Ui=Ht.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ui),Ht.primitiveLength++),X?this.e2=Ui:this.e1=Ui}updateScaledDistance(){if(this.lineClips){const a=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=a*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(a,d){this.distance+=a.dist(d),this.updateScaledDistance()}}Ip(A1,"LineBucket",{omit:["layers","patternFeatures"]});const kw=new Bf({"line-cap":new Bd(Pd.layout_line["line-cap"]),"line-join":new Bd(Pd.layout_line["line-join"]),"line-miter-limit":new pd(Pd.layout_line["line-miter-limit"]),"line-round-limit":new pd(Pd.layout_line["line-round-limit"]),"line-sort-key":new Bd(Pd.layout_line["line-sort-key"])});var ny={paint:new Bf({"line-opacity":new Bd(Pd.paint_line["line-opacity"]),"line-color":new Bd(Pd.paint_line["line-color"]),"line-translate":new pd(Pd.paint_line["line-translate"]),"line-translate-anchor":new pd(Pd.paint_line["line-translate-anchor"]),"line-width":new Bd(Pd.paint_line["line-width"]),"line-gap-width":new Bd(Pd.paint_line["line-gap-width"]),"line-offset":new Bd(Pd.paint_line["line-offset"]),"line-blur":new Bd(Pd.paint_line["line-blur"]),"line-dasharray":new Bd(Pd.paint_line["line-dasharray"]),"line-pattern":new Bd(Pd.paint_line["line-pattern"]),"line-gradient":new mf(Pd.paint_line["line-gradient"]),"line-trim-offset":new pd(Pd.paint_line["line-trim-offset"])}),layout:kw};const Q0=new class extends Bd{possiblyEvaluate(c,a){return a=new ld(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(c,a)}evaluate(c,a,d,y){return a=md({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(c,a,d,y)}}(ny.paint.properties["line-width"].specification);function Q1(c,a){return a>0?a+2*c:c}Q0.useIntegerZoom=!0;const Px=Lp([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dw=Lp([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),P1=Lp([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lp([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eS=Lp([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tS=Lp([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const G2=Lp([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iS=Lp([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lp([{name:"triangle",components:3,type:"Uint16"}]),Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lp([{type:"Float32",name:"offsetX"}]),Lp([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ry=24;const n1=128;function _2(c,a){const{expression:d}=a;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new ld(c+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:C}=d;let N=0;for(;N<y.length&&y[N]<=c;)N++;N=Math.max(0,N-1);let X=N;for(;X<y.length&&y[X]<c+1;)X++;X=Math.min(y.length-1,X);const vt=y[N],Ht=y[X];return d.kind==="composite"?{kind:"composite",minZoom:vt,maxZoom:Ht,interpolationType:C}:{kind:"camera",minZoom:vt,maxZoom:Ht,minSize:d.evaluate(new ld(vt)),maxSize:d.evaluate(new ld(Ht)),interpolationType:C}}}function Lw(c,{uSize:a,uSizeT:d},{lowerSize:y,upperSize:C}){return c.kind==="source"?y/n1:c.kind==="composite"?Kp(y/n1,C/n1,d):a}function tb(c,a){let d=0,y=0;if(c.kind==="constant")y=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:C,minZoom:N,maxZoom:X}=c,vt=C?Uh(Qg.interpolationFactor(C,a,N,X),0,1):0;c.kind==="camera"?y=Kp(c.minSize,c.maxSize,vt):d=vt}return{uSizeT:d,uSize:y}}var nS=Object.freeze({__proto__:null,getSizeData:_2,evaluateSizeForFeature:Lw,evaluateSizeForZoom:tb,SIZE_PACK_FACTOR:n1});function rS(c,a,d){return c.sections.forEach(y=>{y.text=function(C,N,X){const vt=N.layout.get("text-transform").evaluate(X,{});return vt==="uppercase"?C=C.toLocaleUpperCase():vt==="lowercase"&&(C=C.toLocaleLowerCase()),Hh.applyArabicShaping&&(C=Hh.applyArabicShaping(C)),C}(y.text,a,d)}),c}const Ub={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function oS(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function sS(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var Vb=ng,j2=function(c,a,d,y,C){var N,X,vt=8*C-y-1,Ht=(1<<vt)-1,Ui=Ht>>1,qr=-7,Zs=d?C-1:0,nl=d?-1:1,ju=c[a+Zs];for(Zs+=nl,N=ju&(1<<-qr)-1,ju>>=-qr,qr+=vt;qr>0;N=256*N+c[a+Zs],Zs+=nl,qr-=8);for(X=N&(1<<-qr)-1,N>>=-qr,qr+=y;qr>0;X=256*X+c[a+Zs],Zs+=nl,qr-=8);if(N===0)N=1-Ui;else{if(N===Ht)return X?NaN:1/0*(ju?-1:1);X+=Math.pow(2,y),N-=Ui}return(ju?-1:1)*X*Math.pow(2,N-y)},q2=function(c,a,d,y,C,N){var X,vt,Ht,Ui=8*N-C-1,qr=(1<<Ui)-1,Zs=qr>>1,nl=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,ju=y?0:N-1,Ku=y?1:-1,ah=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(vt=isNaN(a)?1:0,X=qr):(X=Math.floor(Math.log(a)/Math.LN2),a*(Ht=Math.pow(2,-X))<1&&(X--,Ht*=2),(a+=X+Zs>=1?nl/Ht:nl*Math.pow(2,1-Zs))*Ht>=2&&(X++,Ht/=2),X+Zs>=qr?(vt=0,X=qr):X+Zs>=1?(vt=(a*Ht-1)*Math.pow(2,C),X+=Zs):(vt=a*Math.pow(2,Zs-1)*Math.pow(2,C),X=0));C>=8;c[d+ju]=255&vt,ju+=Ku,vt/=256,C-=8);for(X=X<<C|vt,Ui+=C;Ui>0;c[d+ju]=255&X,ju+=Ku,X/=256,Ui-=8);c[d+ju-Ku]|=128*ah};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ng(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}ng.Varint=0,ng.Fixed64=1,ng.Bytes=2,ng.Fixed32=5;var y2=4294967296,Z2=1/y2,H2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function k1(c){return c.type===ng.Bytes?c.readVarint()+c.pos:c.pos+1}function ib(c,a,d){return d?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function X2(c,a,d){var y=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));d.realloc(y);for(var C=d.pos-1;C>=c;C--)d.buf[C+y]=d.buf[C]}function aS(c,a){for(var d=0;d<c.length;d++)a.writeVarint(c[d])}function lS(c,a){for(var d=0;d<c.length;d++)a.writeSVarint(c[d])}function cS(c,a){for(var d=0;d<c.length;d++)a.writeFloat(c[d])}function uS(c,a){for(var d=0;d<c.length;d++)a.writeDouble(c[d])}function hS(c,a){for(var d=0;d<c.length;d++)a.writeBoolean(c[d])}function dS(c,a){for(var d=0;d<c.length;d++)a.writeFixed32(c[d])}function fS(c,a){for(var d=0;d<c.length;d++)a.writeSFixed32(c[d])}function pS(c,a){for(var d=0;d<c.length;d++)a.writeFixed64(c[d])}function mS(c,a){for(var d=0;d<c.length;d++)a.writeSFixed64(c[d])}function Rw(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function nb(c,a,d){c[d]=a,c[d+1]=a>>>8,c[d+2]=a>>>16,c[d+3]=a>>>24}function W2(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}function gS(c,a,d){a.glyphs=[],c===1&&d.readMessage(_S,a)}function _S(c,a,d){if(c===3){const{id:y,bitmap:C,width:N,height:X,left:vt,top:Ht,advance:Ui}=d.readMessage(yS,{});a.glyphs.push({id:y,bitmap:new Bv({width:N+6,height:X+6},C),metrics:{width:N,height:X,left:vt,top:Ht,advance:Ui}})}else c===4?a.ascender=d.readSVarint():c===5&&(a.descender=d.readSVarint())}function yS(c,a,d){c===1?a.id=d.readVarint():c===2?a.bitmap=d.readBytes():c===3?a.width=d.readVarint():c===4?a.height=d.readVarint():c===5?a.left=d.readSVarint():c===6?a.top=d.readSVarint():c===7&&(a.advance=d.readVarint())}function v2(c){let a=0,d=0;for(const X of c)a+=X.w*X.h,d=Math.max(d,X.w);c.sort((X,vt)=>vt.h-X.h);const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),d),h:1/0}];let C=0,N=0;for(const X of c)for(let vt=y.length-1;vt>=0;vt--){const Ht=y[vt];if(!(X.w>Ht.w||X.h>Ht.h)){if(X.x=Ht.x,X.y=Ht.y,N=Math.max(N,X.y+X.h),C=Math.max(C,X.x+X.w),X.w===Ht.w&&X.h===Ht.h){const Ui=y.pop();vt<y.length&&(y[vt]=Ui)}else X.h===Ht.h?(Ht.x+=X.w,Ht.w-=X.w):X.w===Ht.w?(Ht.y+=X.h,Ht.h-=X.h):(y.push({x:Ht.x+X.w,y:Ht.y,w:Ht.w-X.w,h:X.h}),Ht.y+=X.h,Ht.h-=X.h);break}}return{w:C,h:N,fill:a/(C*N)||0}}ng.prototype={destroy:function(){this.buf=null},readFields:function(c,a,d){for(d=d||this.length;this.pos<d;){var y=this.readVarint(),C=y>>3,N=this.pos;this.type=7&y,c(C,a,this),this.pos===N&&this.skip(y)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=Rw(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=W2(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Rw(this.buf,this.pos)+Rw(this.buf,this.pos+4)*y2;return this.pos+=8,c},readSFixed64:function(){var c=Rw(this.buf,this.pos)+W2(this.buf,this.pos+4)*y2;return this.pos+=8,c},readFloat:function(){var c=j2(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=j2(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,d,y=this.buf;return a=127&(d=y[this.pos++]),d<128?a:(a|=(127&(d=y[this.pos++]))<<7,d<128?a:(a|=(127&(d=y[this.pos++]))<<14,d<128?a:(a|=(127&(d=y[this.pos++]))<<21,d<128?a:function(C,N,X){var vt,Ht,Ui=X.buf;if(vt=(112&(Ht=Ui[X.pos++]))>>4,Ht<128||(vt|=(127&(Ht=Ui[X.pos++]))<<3,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<10,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<17,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<24,Ht<128)||(vt|=(1&(Ht=Ui[X.pos++]))<<31,Ht<128))return ib(C,vt,N);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(d=y[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&H2?function(d,y,C){return H2.decode(d.subarray(y,C))}(this.buf,a,c):function(d,y,C){for(var N="",X=y;X<C;){var vt,Ht,Ui,qr=d[X],Zs=null,nl=qr>239?4:qr>223?3:qr>191?2:1;if(X+nl>C)break;nl===1?qr<128&&(Zs=qr):nl===2?(192&(vt=d[X+1]))==128&&(Zs=(31&qr)<<6|63&vt)<=127&&(Zs=null):nl===3?(Ht=d[X+2],(192&(vt=d[X+1]))==128&&(192&Ht)==128&&((Zs=(15&qr)<<12|(63&vt)<<6|63&Ht)<=2047||Zs>=55296&&Zs<=57343)&&(Zs=null)):nl===4&&(Ht=d[X+2],Ui=d[X+3],(192&(vt=d[X+1]))==128&&(192&Ht)==128&&(192&Ui)==128&&((Zs=(15&qr)<<18|(63&vt)<<12|(63&Ht)<<6|63&Ui)<=65535||Zs>=1114112)&&(Zs=null)),Zs===null?(Zs=65533,nl=1):Zs>65535&&(Zs-=65536,N+=String.fromCharCode(Zs>>>10&1023|55296),Zs=56320|1023&Zs),N+=String.fromCharCode(Zs),X+=nl}return N}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==ng.Bytes)return c.push(this.readVarint(a));var d=k1(this);for(c=c||[];this.pos<d;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==ng.Bytes)return c.push(this.readSVarint());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==ng.Bytes)return c.push(this.readBoolean());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==ng.Bytes)return c.push(this.readFloat());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==ng.Bytes)return c.push(this.readDouble());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==ng.Bytes)return c.push(this.readFixed32());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==ng.Bytes)return c.push(this.readSFixed32());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==ng.Bytes)return c.push(this.readFixed64());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==ng.Bytes)return c.push(this.readSFixed64());var a=k1(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===ng.Varint)for(;this.buf[this.pos++]>127;);else if(a===ng.Bytes)this.pos=this.readVarint()+this.pos;else if(a===ng.Fixed32)this.pos+=4;else{if(a!==ng.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var d=new Uint8Array(a);d.set(this.buf),this.buf=d,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),nb(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),nb(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),nb(this.buf,-1&c,this.pos),nb(this.buf,Math.floor(c*Z2),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),nb(this.buf,-1&c,this.pos),nb(this.buf,Math.floor(c*Z2),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,d){var y,C;if(a>=0?(y=a%4294967296|0,C=a/4294967296|0):(C=~(-a/4294967296),4294967295^(y=~(-a%4294967296))?y=y+1|0:(y=0,C=C+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(N,X,vt){vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,vt.buf[vt.pos]=127&(N>>>=7)}(y,0,d),function(N,X){var vt=(7&N)<<4;X.buf[X.pos++]|=vt|((N>>>=3)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N)))))}(C,d)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(y,C,N){for(var X,vt,Ht=0;Ht<C.length;Ht++){if((X=C.charCodeAt(Ht))>55295&&X<57344){if(!vt){X>56319||Ht+1===C.length?(y[N++]=239,y[N++]=191,y[N++]=189):vt=X;continue}if(X<56320){y[N++]=239,y[N++]=191,y[N++]=189,vt=X;continue}X=vt-55296<<10|X-56320|65536,vt=null}else vt&&(y[N++]=239,y[N++]=191,y[N++]=189,vt=null);X<128?y[N++]=X:(X<2048?y[N++]=X>>6|192:(X<65536?y[N++]=X>>12|224:(y[N++]=X>>18|240,y[N++]=X>>12&63|128),y[N++]=X>>6&63|128),y[N++]=63&X|128)}return N}(this.buf,c,this.pos);var d=this.pos-a;d>=128&&X2(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeFloat:function(c){this.realloc(4),q2(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),q2(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var d=0;d<a;d++)this.buf[this.pos++]=c[d]},writeRawMessage:function(c,a){this.pos++;var d=this.pos;c(a,this);var y=this.pos-d;y>=128&&X2(d,y,this),this.pos=d-1,this.writeVarint(y),this.pos+=y},writeMessage:function(c,a,d){this.writeTag(c,ng.Bytes),this.writeRawMessage(a,d)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,aS,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,lS,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,hS,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,cS,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,uS,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,dS,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,fS,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,pS,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,mS,a)},writeBytesField:function(c,a){this.writeTag(c,ng.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,ng.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,ng.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,ng.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,ng.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,ng.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,ng.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,ng.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,ng.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,ng.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};class x2{constructor(a,{pixelRatio:d,version:y,stretchX:C,stretchY:N,content:X}){this.paddedRect=a,this.pixelRatio=d,this.stretchX=C,this.stretchY=N,this.content=X,this.version=y}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Y2{constructor(a,d){const y={},C={};this.haveRenderCallbacks=[];const N=[];this.addImages(a,y,N),this.addImages(d,C,N);const{w:X,h:vt}=v2(N),Ht=new Q_({width:X||1,height:vt||1});for(const Ui in a){const qr=a[Ui],Zs=y[Ui].paddedRect;Q_.copy(qr.data,Ht,{x:0,y:0},{x:Zs.x+1,y:Zs.y+1},qr.data)}for(const Ui in d){const qr=d[Ui],Zs=C[Ui].paddedRect,nl=Zs.x+1,ju=Zs.y+1,Ku=qr.data.width,ah=qr.data.height;Q_.copy(qr.data,Ht,{x:0,y:0},{x:nl,y:ju},qr.data),Q_.copy(qr.data,Ht,{x:0,y:ah-1},{x:nl,y:ju-1},{width:Ku,height:1}),Q_.copy(qr.data,Ht,{x:0,y:0},{x:nl,y:ju+ah},{width:Ku,height:1}),Q_.copy(qr.data,Ht,{x:Ku-1,y:0},{x:nl-1,y:ju},{width:1,height:ah}),Q_.copy(qr.data,Ht,{x:0,y:0},{x:nl+Ku,y:ju},{width:1,height:ah})}this.image=Ht,this.iconPositions=y,this.patternPositions=C}addImages(a,d,y){for(const C in a){const N=a[C],X={x:0,y:0,w:N.data.width+2,h:N.data.height+2};y.push(X),d[C]=new x2(X,N),N.hasRenderCallback&&this.haveRenderCallbacks.push(C)}}patchUpdatedImages(a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>a.hasImage(y)),a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const y in a.updatedImages)this.patchUpdatedImage(this.iconPositions[y],a.getImage(y),d),this.patchUpdatedImage(this.patternPositions[y],a.getImage(y),d)}patchUpdatedImage(a,d,y){if(!a||!d||a.version===d.version)return;a.version=d.version;const[C,N]=a.tl;y.update(d.data,void 0,{x:C,y:N})}}Ip(x2,"ImagePosition"),Ip(Y2,"ImageAtlas");const J0={horizontal:1,vertical:2,horizontalOnly:3};class Gb{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,d){const y=new Gb;return y.scale=a||1,y.fontStack=d,y}static forImage(a){const d=new Gb;return d.imageName=a,d}}class rb{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,d){const y=new rb;for(let C=0;C<a.sections.length;C++){const N=a.sections[C];N.image?y.addImageSection(N):y.addTextSection(N,d)}return y}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(a){this.text=function(d,y){let C="";for(let N=0;N<d.length;N++){const X=d.charCodeAt(N+1)||null,vt=d.charCodeAt(N-1)||null;C+=!y&&(X&&ss(X)&&!Ub[d[N+1]]||vt&&ss(vt)&&!Ub[d[N-1]])||!Ub[d[N]]?d[N]:Ub[d[N]]}return C}(this.text,a)}trim(){let a=0;for(let y=0;y<this.text.length&&Ow[this.text.charCodeAt(y)];y++)a++;let d=this.text.length;for(let y=this.text.length-1;y>=0&&y>=a&&Ow[this.text.charCodeAt(y)];y--)d--;this.text=this.text.substring(a,d),this.sectionIndex=this.sectionIndex.slice(a,d)}substring(a,d){const y=new rb;return y.text=this.text.substring(a,d),y.sectionIndex=this.sectionIndex.slice(a,d),y.sections=this.sections,y}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,d)=>Math.max(a,this.sections[d].scale),0)}addTextSection(a,d){this.text+=a.text,this.sections.push(Gb.forText(a.scale,a.fontStack||d));const y=this.sections.length-1;for(let C=0;C<a.text.length;++C)this.sectionIndex.push(y)}addImageSection(a){const d=a.image?a.image.name:"";if(d.length===0)return void np("Can't add FormattedSection with an empty image.");const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCharCode(y),this.sections.push(Gb.forImage(d)),this.sectionIndex.push(this.sections.length-1)):np("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function b2(c,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku){const ah=rb.fromFeature(c,C);Zs===J0.vertical&&ah.verticalizePunctuation(nl);let Eh=[];const zh=function(ed,Rd,kd,Sf,Zf,jd){if(!ed)return[];const Pf=[],Rf=function(up,jp,vp,Rp,dp,Xp){let xm=0;for(let gm=0;gm<up.length();gm++){const pm=up.getSection(gm);xm+=K2(up.getCharCode(gm),pm,Rp,dp,jp,Xp)}return xm/Math.max(1,Math.ceil(xm/vp))}(ed,Rd,kd,Sf,Zf,jd),Uf=ed.text.indexOf("​")>=0;let Xf=0;for(let up=0;up<ed.length();up++){const jp=ed.getSection(up),vp=ed.getCharCode(up);if(Ow[vp]||(Xf+=K2(vp,jp,Sf,Zf,Rd,jd)),up<ed.length()-1){const Rp=!((Hd=vp)<11904||!(ph(Hd)||ih(Hd)||L(Hd)||Wd(Hd)||Kh(Hd)||Ft(Hd)||Lh(Hd)||$s(Hd)||fd(Hd)||ud(Hd)||Ch(Hd)||B(Hd)||ol(Hd)||ls(Hd)||Gn(Hd)||Bh(Hd)||nh(Hd)||Of(Hd)||Sd(Hd)||jh(Hd)));(vS[vp]||Rp||jp.imageName)&&Pf.push(J2(up+1,Xf,Rf,Pf,xS(vp,ed.getCharCode(up+1),Rp&&Uf),!1))}}var Hd;return eE(J2(ed.length(),Xf,Rf,Pf,0,!0))}(ah,Ui,N,a,y,ju),{processBidirectionalText:Yh,processStyledBidirectionalText:kh}=Hh;if(Yh&&ah.sections.length===1){const ed=Yh(ah.toString(),zh);for(const Rd of ed){const kd=new rb;kd.text=Rd,kd.sections=ah.sections;for(let Sf=0;Sf<Rd.length;Sf++)kd.sectionIndex.push(0);Eh.push(kd)}}else if(kh){const ed=kh(ah.text,ah.sectionIndex,zh);for(const Rd of ed){const kd=new rb;kd.text=Rd[0],kd.sectionIndex=Rd[1],kd.sections=ah.sections,Eh.push(kd)}}else Eh=function(ed,Rd){const kd=[],Sf=ed.text;let Zf=0;for(const jd of Rd)kd.push(ed.substring(Zf,jd)),Zf=jd;return Zf<Sf.length&&kd.push(ed.substring(Zf,Sf.length)),kd}(ah,zh);const Gh=[],nd={positionedLines:Gh,text:ah.toString(),top:qr[1],bottom:qr[1],left:qr[0],right:qr[0],writingMode:Zs,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf,Xf,Hd,up){let jp=0,vp=0,Rp=0;const dp=Rf==="right"?1:Rf==="left"?0:.5;let Xp=!1;for(const tm of Zf){const bm=tm.getSections();for(const Wm of bm){if(Wm.imageName)continue;const hg=Rd[Wm.fontStack];if(hg&&(Xp=hg.ascender!==void 0&&hg.descender!==void 0,!Xp))break}if(!Xp)break}let xm=0;for(const tm of Zf){tm.trim();const bm=tm.getMaxScale(),Wm=(bm-1)*ry,hg={positionedGlyphs:[],lineOffset:0};ed.positionedLines[xm]=hg;const rg=hg.positionedGlyphs;let dg=0;if(!tm.length()){vp+=jd,++xm;continue}let xg=0,Ug=0;for(let Hm=0;Hm<tm.length();Hm++){const n_=tm.getSection(Hm),Kg=tm.getSectionIndex(Hm),Lm=tm.getCharCode(Hm);let Ag=n_.scale,a_=null,Ym=null,Zg=null,dy=ry,F_=0;const $_=!(Uf===J0.horizontal||!Hd&&!Bn(Lm)||Hd&&(Ow[Lm]||(gm=Lm,A(gm)||q(gm)||ze(gm)||Cf(gm)||E(gm))));if(n_.imageName){const ky=Sf[n_.imageName];if(!ky)continue;Zg=n_.imageName,ed.iconsInText=ed.iconsInText||!0,Ym=ky.paddedRect;const U_=ky.displaySize;Ag=Ag*ry/up,a_={width:U_[0],height:U_[1],left:1,top:-3,advance:$_?U_[1]:U_[0],localGlyph:!1},F_=Xp?-a_.height*Ag:bm*ry-17-U_[1]*Ag,dy=a_.advance;const L1=($_?U_[0]:U_[1])*Ag-ry*bm;L1>0&&L1>dg&&(dg=L1)}else{const ky=kd[n_.fontStack];if(!ky)continue;ky[Lm]&&(Ym=ky[Lm]);const U_=Rd[n_.fontStack];if(!U_)continue;const L1=U_.glyphs[Lm];if(!L1)continue;if(a_=L1.metrics,dy=Lm!==8203?ry:0,Xp){const cb=U_.ascender!==void 0?Math.abs(U_.ascender):0,Kb=U_.descender!==void 0?Math.abs(U_.descender):0,Qb=(cb+Kb)*Ag;xg<Qb&&(xg=Qb,Ug=(cb-Kb)/2*Ag),F_=-cb*Ag}else F_=(bm-Ag)*ry-17}$_?(ed.verticalizable=!0,rg.push({glyph:Lm,imageName:Zg,x:jp,y:vp+F_,vertical:$_,scale:Ag,localGlyph:a_.localGlyph,fontStack:n_.fontStack,sectionIndex:Kg,metrics:a_,rect:Ym}),jp+=dy*Ag+Xf):(rg.push({glyph:Lm,imageName:Zg,x:jp,y:vp+F_,vertical:$_,scale:Ag,localGlyph:a_.localGlyph,fontStack:n_.fontStack,sectionIndex:Kg,metrics:a_,rect:Ym}),jp+=a_.advance*Ag+Xf)}rg.length!==0&&(Rp=Math.max(jp-Xf,Rp),Xp?tE(rg,dp,dg,Ug,jd*bm/2):tE(rg,dp,dg,0,jd/2)),jp=0;const N_=jd*bm+dg;hg.lineOffset=Math.max(dg,Wm),vp+=N_,++xm}var gm;const pm=vp,{horizontalAlign:Wp,verticalAlign:Zm}=w2(Pf);(function(tm,bm,Wm,hg,rg,dg){const xg=(bm-Wm)*rg,Ug=-dg*hg;for(const N_ of tm)for(const Hm of N_.positionedGlyphs)Hm.x+=xg,Hm.y+=Ug})(ed.positionedLines,dp,Wp,Zm,Rp,pm),ed.top+=-Zm*pm,ed.bottom=ed.top+pm,ed.left+=-Wp*Rp,ed.right=ed.left+Rp,ed.hasBaseline=Xp}(nd,a,d,y,Eh,X,vt,Ht,Zs,Ui,nl,Ku),!function(ed){for(const Rd of ed)if(Rd.positionedGlyphs.length!==0)return!1;return!0}(Gh)&&nd}const Ow={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function K2(c,a,d,y,C,N){if(a.imageName){const X=y[a.imageName];return X?X.displaySize[0]*a.scale*ry/N+C:0}{const X=d[a.fontStack],vt=X&&X.glyphs[c];return vt?vt.metrics.advance*a.scale+C:0}}function Q2(c,a,d,y){const C=Math.pow(c-a,2);return y?c<a?C/2:2*C:C+Math.abs(d)*d}function xS(c,a,d){let y=0;return c===10&&(y-=1e4),d&&(y+=150),c!==40&&c!==65288||(y+=50),a!==41&&a!==65289||(y+=50),y}function J2(c,a,d,y,C,N){let X=null,vt=Q2(a,d,C,N);for(const Ht of y){const Ui=Q2(a-Ht.x,d,C,N)+Ht.badness;Ui<=vt&&(X=Ht,vt=Ui)}return{index:c,x:a,priorBreak:X,badness:vt}}function eE(c){return c?eE(c.priorBreak).concat(c.index):[]}function w2(c){let a=.5,d=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:a,verticalAlign:d}}function tE(c,a,d,y,C){if(!(a||d||y||C))return;const N=c.length-1,X=c[N],vt=(X.x+X.metrics.advance*X.scale)*a;for(let Ht=0;Ht<=N;Ht++)c[Ht].x-=vt,c[Ht].y+=d+y+C}function bS(c,a,d){const{horizontalAlign:y,verticalAlign:C}=w2(d),N=a[0]-c.displaySize[0]*y,X=a[1]-c.displaySize[1]*C;return{image:c,top:X,bottom:X+c.displaySize[1],left:N,right:N+c.displaySize[0]}}function iE(c,a,d,y,C,N){const X=c.image;let vt;if(X.content){const Eh=X.content,zh=X.pixelRatio||1;vt=[Eh[0]/zh,Eh[1]/zh,X.displaySize[0]-Eh[2]/zh,X.displaySize[1]-Eh[3]/zh]}const Ht=a.left*N,Ui=a.right*N;let qr,Zs,nl,ju;d==="width"||d==="both"?(ju=C[0]+Ht-y[3],Zs=C[0]+Ui+y[1]):(ju=C[0]+(Ht+Ui-X.displaySize[0])/2,Zs=ju+X.displaySize[0]);const Ku=a.top*N,ah=a.bottom*N;return d==="height"||d==="both"?(qr=C[1]+Ku-y[0],nl=C[1]+ah+y[2]):(qr=C[1]+(Ku+ah-X.displaySize[1])/2,nl=qr+X.displaySize[1]),{image:X,top:qr,right:Zs,bottom:nl,left:ju,collisionPadding:vt}}class D1 extends Js{constructor(a,d,y,C,N){super(a,d),this.angle=C,this.z=y,N!==void 0&&(this.segment=N)}clone(){return new D1(this.x,this.y,this.z,this.angle,this.segment)}}function nE(c,a,d,y,C){if(a.segment===void 0)return!0;let N=a,X=a.segment+1,vt=0;for(;vt>-d/2;){if(X--,X<0)return!1;vt-=c[X].dist(N),N=c[X]}vt+=c[X].dist(c[X+1]),X++;const Ht=[];let Ui=0;for(;vt<d/2;){const qr=c[X],Zs=c[X+1];if(!Zs)return!1;let nl=c[X-1].angleTo(qr)-qr.angleTo(Zs);for(nl=Math.abs((nl+3*Math.PI)%(2*Math.PI)-Math.PI),Ht.push({distance:vt,angleDelta:nl}),Ui+=nl;vt-Ht[0].distance>y;)Ui-=Ht.shift().angleDelta;if(Ui>C)return!1;X++,vt+=qr.dist(Zs)}return!0}function rE(c){let a=0;for(let d=0;d<c.length-1;d++)a+=c[d].dist(c[d+1]);return a}function oE(c,a,d){return c?.6*a*d:0}function sE(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function wS(c,a,d,y,C,N){const X=oE(d,C,N),vt=sE(d,y)*N;let Ht=0;const Ui=rE(c)/2;for(let qr=0;qr<c.length-1;qr++){const Zs=c[qr],nl=c[qr+1],ju=Zs.dist(nl);if(Ht+ju>Ui){const Ku=(Ui-Ht)/ju,ah=Kp(Zs.x,nl.x,Ku),Eh=Kp(Zs.y,nl.y,Ku),zh=new D1(ah,Eh,0,nl.angleTo(Zs),qr);return!X||nE(c,zh,vt,X,a)?zh:void 0}Ht+=ju}}function ES(c,a,d,y,C,N,X,vt,Ht){const Ui=oE(y,N,X),qr=sE(y,C),Zs=qr*X,nl=c[0].x===0||c[0].x===Ht||c[0].y===0||c[0].y===Ht;return a-Zs<a/4&&(a=Zs+a/4),aE(c,nl?a/2*vt%a:(qr/2+2*N)*X*vt%a,a,Ui,d,Zs,nl,!1,Ht)}function aE(c,a,d,y,C,N,X,vt,Ht){const Ui=N/2,qr=rE(c);let Zs=0,nl=a-d,ju=[];for(let Ku=0;Ku<c.length-1;Ku++){const ah=c[Ku],Eh=c[Ku+1],zh=ah.dist(Eh),Yh=Eh.angleTo(ah);for(;nl+d<Zs+zh;){nl+=d;const kh=(nl-Zs)/zh,Gh=Kp(ah.x,Eh.x,kh),nd=Kp(ah.y,Eh.y,kh);if(Gh>=0&&Gh<Ht&&nd>=0&&nd<Ht&&nl-Ui>=0&&nl+Ui<=qr){const ed=new D1(Gh,nd,0,Yh,Ku);ed._round(),y&&!nE(c,ed,N,y,C)||ju.push(ed)}}Zs+=zh}return vt||ju.length||X||(ju=aE(c,Zs/2,d,y,C,N,X,!0,Ht)),ju}function lE(c,a,d,y,C){const N=[];for(let X=0;X<c.length;X++){const vt=c[X];let Ht;for(let Ui=0;Ui<vt.length-1;Ui++){let qr=vt[Ui],Zs=vt[Ui+1];qr.x<a&&Zs.x<a||(qr.x<a?qr=new Js(a,qr.y+(a-qr.x)/(Zs.x-qr.x)*(Zs.y-qr.y))._round():Zs.x<a&&(Zs=new Js(a,qr.y+(a-qr.x)/(Zs.x-qr.x)*(Zs.y-qr.y))._round()),qr.y<d&&Zs.y<d||(qr.y<d?qr=new Js(qr.x+(d-qr.y)/(Zs.y-qr.y)*(Zs.x-qr.x),d)._round():Zs.y<d&&(Zs=new Js(qr.x+(d-qr.y)/(Zs.y-qr.y)*(Zs.x-qr.x),d)._round()),qr.x>=y&&Zs.x>=y||(qr.x>=y?qr=new Js(y,qr.y+(y-qr.x)/(Zs.x-qr.x)*(Zs.y-qr.y))._round():Zs.x>=y&&(Zs=new Js(y,qr.y+(y-qr.x)/(Zs.x-qr.x)*(Zs.y-qr.y))._round()),qr.y>=C&&Zs.y>=C||(qr.y>=C?qr=new Js(qr.x+(C-qr.y)/(Zs.y-qr.y)*(Zs.x-qr.x),C)._round():Zs.y>=C&&(Zs=new Js(qr.x+(C-qr.y)/(Zs.y-qr.y)*(Zs.x-qr.x),C)._round()),Ht&&qr.equals(Ht[Ht.length-1])||(Ht=[qr],N.push(Ht)),Ht.push(Zs)))))}}return N}Ip(D1,"Anchor");const jb=1e20;function cE(c,a,d,y,C,N,X,vt,Ht){for(let Ui=a;Ui<a+y;Ui++)uE(c,d*N+Ui,N,C,X,vt,Ht);for(let Ui=d;Ui<d+C;Ui++)uE(c,Ui*N+a,1,y,X,vt,Ht)}function uE(c,a,d,y,C,N,X){N[0]=0,X[0]=-jb,X[1]=jb,C[0]=c[a];for(let vt=1,Ht=0,Ui=0;vt<y;vt++){C[vt]=c[a+vt*d];const qr=vt*vt;do{const Zs=N[Ht];Ui=(C[vt]-C[Zs]+qr-Zs*Zs)/(vt-Zs)/2}while(Ui<=X[Ht]&&--Ht>-1);Ht++,N[Ht]=vt,X[Ht]=Ui,X[Ht+1]=jb}for(let vt=0,Ht=0;vt<y;vt++){for(;X[Ht+1]<vt;)Ht++;const Ui=N[Ht],qr=vt-Ui;c[a+vt*d]=C[Ui]+qr*qr}}const E2={none:0,ideographs:1,all:2};class ob{constructor(a,d,y){this.requestManager=a,this.localGlyphMode=d,this.localFontFamily=y,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,d){const y=[];for(const C in a)for(const N of a[C])y.push({stack:C,id:N});yf(y,({stack:C,id:N},X)=>{let vt=this.entries[C];vt||(vt=this.entries[C]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let Ht=vt.glyphs[N];if(Ht!==void 0)return void X(null,{stack:C,id:N,glyph:Ht});if(Ht=this._tinySDF(vt,C,N),Ht)return vt.glyphs[N]=Ht,void X(null,{stack:C,id:N,glyph:Ht});const Ui=Math.floor(N/256);if(256*Ui>65535)return void X(new Error("glyphs > 65535 not supported"));if(vt.ranges[Ui])return void X(null,{stack:C,id:N,glyph:Ht});let qr=vt.requests[Ui];qr||(qr=vt.requests[Ui]=[],ob.loadGlyphRange(C,Ui,this.url,this.requestManager,(Zs,nl)=>{if(nl){vt.ascender=nl.ascender,vt.descender=nl.descender;for(const ju in nl.glyphs)this._doesCharSupportLocalGlyph(+ju)||(vt.glyphs[+ju]=nl.glyphs[+ju]);vt.ranges[Ui]=!0}for(const ju of qr)ju(Zs,nl);delete vt.requests[Ui]})),qr.push((Zs,nl)=>{Zs?X(Zs):nl&&X(null,{stack:C,id:N,glyph:nl.glyphs[N]||null})})},(C,N)=>{if(C)d(C);else if(N){const X={};for(const{stack:vt,id:Ht,glyph:Ui}of N)X[vt]===void 0&&(X[vt]={}),X[vt].glyphs===void 0&&(X[vt].glyphs={}),X[vt].glyphs[Ht]=Ui&&{id:Ui.id,bitmap:Ui.bitmap.clone(),metrics:Ui.metrics},X[vt].ascender=this.entries[vt].ascender,X[vt].descender=this.entries[vt].descender;d(null,X)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==E2.none&&(this.localGlyphMode===E2.all?!!this.localFontFamily:!!this.localFontFamily&&(ud(a)||Vd(a)||ol(a)||nh(a)||$s(a)))}_tinySDF(a,d,y){const C=this.localFontFamily;if(!C||!this._doesCharSupportLocalGlyph(y))return;let N=a.tinySDF;if(!N){let ah="400";/bold/i.test(d)?ah="900":/medium/i.test(d)?ah="500":/light/i.test(d)&&(ah="200"),N=a.tinySDF=new ob.TinySDF({fontFamily:C,fontWeight:ah,fontSize:48,buffer:6,radius:16}),N.fontWeight=ah}if(this.localGlyphs[N.fontWeight][y])return this.localGlyphs[N.fontWeight][y];const X=String.fromCharCode(y),{data:vt,width:Ht,height:Ui,glyphWidth:qr,glyphHeight:Zs,glyphLeft:nl,glyphTop:ju,glyphAdvance:Ku}=N.draw(X);return this.localGlyphs[N.fontWeight][y]={id:y,bitmap:new Bv({width:Ht,height:Ui},vt),metrics:{width:qr/2,height:Zs/2,left:nl/2,top:ju/2-27,advance:Ku/2,localGlyph:!0}}}}function hE(c,a,d,y){const C=[],N=c.image,X=N.pixelRatio,vt=N.paddedRect.w-2,Ht=N.paddedRect.h-2,Ui=c.right-c.left,qr=c.bottom-c.top,Zs=N.stretchX||[[0,vt]],nl=N.stretchY||[[0,Ht]],ju=(jd,Pf)=>jd+Pf[1]-Pf[0],Ku=Zs.reduce(ju,0),ah=nl.reduce(ju,0),Eh=vt-Ku,zh=Ht-ah;let Yh=0,kh=Ku,Gh=0,nd=ah,ed=0,Rd=Eh,kd=0,Sf=zh;if(N.content&&y){const jd=N.content;Yh=Bw(Zs,0,jd[0]),Gh=Bw(nl,0,jd[1]),kh=Bw(Zs,jd[0],jd[2]),nd=Bw(nl,jd[1],jd[3]),ed=jd[0]-Yh,kd=jd[1]-Gh,Rd=jd[2]-jd[0]-kh,Sf=jd[3]-jd[1]-nd}const Zf=(jd,Pf,Rf,Uf)=>{const Xf=zw(jd.stretch-Yh,kh,Ui,c.left),Hd=Nw(jd.fixed-ed,Rd,jd.stretch,Ku),up=zw(Pf.stretch-Gh,nd,qr,c.top),jp=Nw(Pf.fixed-kd,Sf,Pf.stretch,ah),vp=zw(Rf.stretch-Yh,kh,Ui,c.left),Rp=Nw(Rf.fixed-ed,Rd,Rf.stretch,Ku),dp=zw(Uf.stretch-Gh,nd,qr,c.top),Xp=Nw(Uf.fixed-kd,Sf,Uf.stretch,ah),xm=new Js(Xf,up),gm=new Js(vp,up),pm=new Js(vp,dp),Wp=new Js(Xf,dp),Zm=new Js(Hd/X,jp/X),tm=new Js(Rp/X,Xp/X),bm=a*Math.PI/180;if(bm){const rg=Math.sin(bm),dg=Math.cos(bm),xg=[dg,-rg,rg,dg];xm._matMult(xg),gm._matMult(xg),Wp._matMult(xg),pm._matMult(xg)}const Wm=jd.stretch+jd.fixed,hg=Pf.stretch+Pf.fixed;return{tl:xm,tr:gm,bl:Wp,br:pm,tex:{x:N.paddedRect.x+1+Wm,y:N.paddedRect.y+1+hg,w:Rf.stretch+Rf.fixed-Wm,h:Uf.stretch+Uf.fixed-hg},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zm,pixelOffsetBR:tm,minFontScaleX:Rd/X/Ui,minFontScaleY:Sf/X/qr,isSDF:d}};if(y&&(N.stretchX||N.stretchY)){const jd=dE(Zs,Eh,Ku),Pf=dE(nl,zh,ah);for(let Rf=0;Rf<jd.length-1;Rf++){const Uf=jd[Rf],Xf=jd[Rf+1];for(let Hd=0;Hd<Pf.length-1;Hd++)C.push(Zf(Uf,Pf[Hd],Xf,Pf[Hd+1]))}}else C.push(Zf({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:vt+1},{fixed:0,stretch:Ht+1}));return C}function Bw(c,a,d){let y=0;for(const C of c)y+=Math.max(a,Math.min(d,C[1]))-Math.max(a,Math.min(d,C[0]));return y}function dE(c,a,d){const y=[{fixed:-1,stretch:0}];for(const[C,N]of c){const X=y[y.length-1];y.push({fixed:C-X.stretch,stretch:X.stretch}),y.push({fixed:C-X.stretch,stretch:X.stretch+(N-C)})}return y.push({fixed:a+1,stretch:d}),y}function zw(c,a,d,y){return c/a*d+y}function Nw(c,a,d,y){return c-a*d/y}function SS(c,a,d,y){const C=a+c.positionedLines[y].lineOffset;return y===0?d+C/2:d+(C+(a+c.positionedLines[y-1].lineOffset))/2}ob.loadGlyphRange=function(c,a,d,y,C){const N=256*a,X=N+255,vt=y.transformRequest(y.normalizeGlyphsURL(d).replace("{fontstack}",c).replace("{range}",`${N}-${X}`),Wf.Glyphs);Yf(vt,(Ht,Ui)=>{if(Ht)C(Ht);else if(Ui){const qr={},Zs=function(nl){return new Vb(nl).readFields(gS,{})}(Ui);for(const nl of Zs.glyphs)qr[nl.id]=nl;C(null,{glyphs:qr,ascender:Zs.ascender,descender:Zs.descender})}})},ob.TinySDF=class{constructor({fontSize:c=24,buffer:a=3,radius:d=8,cutoff:y=.25,fontFamily:C="sans-serif",fontWeight:N="normal",fontStyle:X="normal"}={}){this.buffer=a,this.cutoff=y,this.radius=d;const vt=this.size=c+4*a,Ht=this._createCanvas(vt),Ui=this.ctx=Ht.getContext("2d",{willReadFrequently:!0});Ui.font=`${X} ${N} ${c}px ${C}`,Ui.textBaseline="alphabetic",Ui.textAlign="left",Ui.fillStyle="black",this.gridOuter=new Float64Array(vt*vt),this.gridInner=new Float64Array(vt*vt),this.f=new Float64Array(vt),this.z=new Float64Array(vt+1),this.v=new Uint16Array(vt)}_createCanvas(c){const a=document.createElement("canvas");return a.width=a.height=c,a}draw(c){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:C,actualBoundingBoxRight:N}=this.ctx.measureText(c),X=Math.ceil(d),vt=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(N-C))),Ht=Math.min(this.size-this.buffer,X+Math.ceil(y)),Ui=vt+2*this.buffer,qr=Ht+2*this.buffer,Zs=Math.max(Ui*qr,0),nl=new Uint8ClampedArray(Zs),ju={data:nl,width:Ui,height:qr,glyphWidth:vt,glyphHeight:Ht,glyphTop:X,glyphLeft:0,glyphAdvance:a};if(vt===0||Ht===0)return ju;const{ctx:Ku,buffer:ah,gridInner:Eh,gridOuter:zh}=this;Ku.clearRect(ah,ah,vt,Ht),Ku.fillText(c,ah,ah+X);const Yh=Ku.getImageData(ah,ah,vt,Ht);zh.fill(jb,0,Zs),Eh.fill(0,0,Zs);for(let kh=0;kh<Ht;kh++)for(let Gh=0;Gh<vt;Gh++){const nd=Yh.data[4*(kh*vt+Gh)+3]/255;if(nd===0)continue;const ed=(kh+ah)*Ui+Gh+ah;if(nd===1)zh[ed]=0,Eh[ed]=jb;else{const Rd=.5-nd;zh[ed]=Rd>0?Rd*Rd:0,Eh[ed]=Rd<0?Rd*Rd:0}}cE(zh,0,0,Ui,qr,Ui,this.f,this.v,this.z),cE(Eh,ah,ah,vt,Ht,Ui,this.f,this.v,this.z);for(let kh=0;kh<Zs;kh++){const Gh=Math.sqrt(zh[kh])-Math.sqrt(Eh[kh]);nl[kh]=Math.round(255-255*(Gh/this.radius+this.cutoff))}return ju}};class TS{constructor(a=[],d=IS){if(this.data=a,this.length=this.data.length,this.compare=d,this.length>0)for(let y=(this.length>>1)-1;y>=0;y--)this._down(y)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:d,compare:y}=this,C=d[a];for(;a>0;){const N=a-1>>1,X=d[N];if(y(C,X)>=0)break;d[a]=X,a=N}d[a]=C}_down(a){const{data:d,compare:y}=this,C=this.length>>1,N=d[a];for(;a<C;){let X=1+(a<<1),vt=d[X];const Ht=X+1;if(Ht<this.length&&y(d[Ht],vt)<0&&(X=Ht,vt=d[Ht]),y(vt,N)>=0)break;d[a]=vt,a=X}d[a]=N}}function IS(c,a){return c<a?-1:c>a?1:0}function MS(c,a=1,d=!1){let y=1/0,C=1/0,N=-1/0,X=-1/0;const vt=c[0];for(let ju=0;ju<vt.length;ju++){const Ku=vt[ju];(!ju||Ku.x<y)&&(y=Ku.x),(!ju||Ku.y<C)&&(C=Ku.y),(!ju||Ku.x>N)&&(N=Ku.x),(!ju||Ku.y>X)&&(X=Ku.y)}const Ht=Math.min(N-y,X-C);let Ui=Ht/2;const qr=new TS([],CS);if(Ht===0)return new Js(y,C);for(let ju=y;ju<N;ju+=Ht)for(let Ku=C;Ku<X;Ku+=Ht)qr.push(new sb(ju+Ui,Ku+Ui,Ui,c));let Zs=function(ju){let Ku=0,ah=0,Eh=0;const zh=ju[0];for(let Yh=0,kh=zh.length,Gh=kh-1;Yh<kh;Gh=Yh++){const nd=zh[Yh],ed=zh[Gh],Rd=nd.x*ed.y-ed.x*nd.y;ah+=(nd.x+ed.x)*Rd,Eh+=(nd.y+ed.y)*Rd,Ku+=3*Rd}return new sb(ah/Ku,Eh/Ku,0,ju)}(c),nl=qr.length;for(;qr.length;){const ju=qr.pop();(ju.d>Zs.d||!Zs.d)&&(Zs=ju,d&&console.log("found best %d after %d probes",Math.round(1e4*ju.d)/1e4,nl)),ju.max-Zs.d<=a||(Ui=ju.h/2,qr.push(new sb(ju.p.x-Ui,ju.p.y-Ui,Ui,c)),qr.push(new sb(ju.p.x+Ui,ju.p.y-Ui,Ui,c)),qr.push(new sb(ju.p.x-Ui,ju.p.y+Ui,Ui,c)),qr.push(new sb(ju.p.x+Ui,ju.p.y+Ui,Ui,c)),nl+=4)}return d&&(console.log(`num probes: ${nl}`),console.log(`best distance: ${Zs.d}`)),Zs.p}function CS(c,a){return a.max-c.max}class sb{constructor(a,d,y,C){this.p=new Js(a,d),this.h=y,this.d=function(N,X){let vt=!1,Ht=1/0;for(let Ui=0;Ui<X.length;Ui++){const qr=X[Ui];for(let Zs=0,nl=qr.length,ju=nl-1;Zs<nl;ju=Zs++){const Ku=qr[Zs],ah=qr[ju];Ku.y>N.y!=ah.y>N.y&&N.x<(ah.x-Ku.x)*(N.y-Ku.y)/(ah.y-Ku.y)+Ku.x&&(vt=!vt),Ht=Math.min(Ht,E1(N,Ku,ah))}}return(vt?1:-1)*Math.sqrt(Ht)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}}const S2=Number.POSITIVE_INFINITY,AS=Math.sqrt(2);function fE(c,[a,d]){let y=0,C=0;if(d===S2){a<0&&(a=0);const N=a/AS;switch(c){case"top-right":case"top-left":C=N-7;break;case"bottom-right":case"bottom-left":C=7-N;break;case"bottom":C=7-a;break;case"top":C=a-7}switch(c){case"top-right":case"bottom-right":y=-N;break;case"top-left":case"bottom-left":y=N;break;case"left":y=a;break;case"right":y=-a}}else{switch(a=Math.abs(a),d=Math.abs(d),c){case"top-right":case"top-left":case"top":C=d-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-d}switch(c){case"top-right":case"bottom-right":case"right":y=-a;break;case"top-left":case"bottom-left":case"left":y=a}}return[y,C]}function PS(c,a,d,y,C,N,X,vt,Ht,Ui){c.createArrays(),c.tilePixelRatio=Hp/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const qr=c.layers[0].layout,Zs=c.layers[0]._unevaluatedLayout._values,nl={};if(c.textSizeData.kind==="composite"){const{minZoom:ah,maxZoom:Eh}=c.textSizeData;nl.compositeTextSizes=[Zs["text-size"].possiblyEvaluate(new ld(ah),vt),Zs["text-size"].possiblyEvaluate(new ld(Eh),vt)]}if(c.iconSizeData.kind==="composite"){const{minZoom:ah,maxZoom:Eh}=c.iconSizeData;nl.compositeIconSizes=[Zs["icon-size"].possiblyEvaluate(new ld(ah),vt),Zs["icon-size"].possiblyEvaluate(new ld(Eh),vt)]}nl.layoutTextSize=Zs["text-size"].possiblyEvaluate(new ld(Ht+1),vt),nl.layoutIconSize=Zs["icon-size"].possiblyEvaluate(new ld(Ht+1),vt),nl.textMaxSize=Zs["text-size"].possiblyEvaluate(new ld(18),vt);const ju=qr.get("text-rotation-alignment")==="map"&&qr.get("symbol-placement")!=="point",Ku=qr.get("text-size");for(const ah of c.features){const Eh=qr.get("text-font").evaluate(ah,{},vt).join(","),zh=Ku.evaluate(ah,{},vt),Yh=nl.layoutTextSize.evaluate(ah,{},vt),kh=(nl.layoutIconSize.evaluate(ah,{},vt),{horizontal:{},vertical:void 0}),Gh=ah.text;let nd,ed=[0,0];if(Gh){const Sf=Gh.toString(),Zf=qr.get("text-letter-spacing").evaluate(ah,{},vt)*ry,jd=qr.get("text-line-height").evaluate(ah,{},vt)*ry,Pf=St(Sf)?Zf:0,Rf=qr.get("text-anchor").evaluate(ah,{},vt),Uf=qr.get("text-variable-anchor");if(!Uf){const vp=qr.get("text-radial-offset").evaluate(ah,{},vt);ed=vp?fE(Rf,[vp*ry,S2]):qr.get("text-offset").evaluate(ah,{},vt).map(Rp=>Rp*ry)}let Xf=ju?"center":qr.get("text-justify").evaluate(ah,{},vt);const Hd=qr.get("symbol-placement")==="point",up=Hd?qr.get("text-max-width").evaluate(ah,{},vt)*ry:1/0,jp=vp=>{c.allowVerticalPlacement&&ge(Sf)&&(kh.vertical=b2(Gh,a,d,C,Eh,up,jd,Rf,vp,Pf,ed,J0.vertical,!0,Yh,zh))};if(!ju&&Uf){const vp=Xf==="auto"?Uf.map(dp=>T2(dp)):[Xf];let Rp=!1;for(let dp=0;dp<vp.length;dp++){const Xp=vp[dp];if(!kh.horizontal[Xp])if(Rp)kh.horizontal[Xp]=kh.horizontal[0];else{const xm=b2(Gh,a,d,C,Eh,up,jd,"center",Xp,Pf,ed,J0.horizontal,!1,Yh,zh);xm&&(kh.horizontal[Xp]=xm,Rp=xm.positionedLines.length===1)}}jp("left")}else{if(Xf==="auto"&&(Xf=T2(Rf)),Hd||qr.get("text-writing-mode").indexOf("horizontal")>=0||!ge(Sf)){const vp=b2(Gh,a,d,C,Eh,up,jd,Rf,Xf,Pf,ed,J0.horizontal,!1,Yh,zh);vp&&(kh.horizontal[Xf]=vp)}jp(Hd?"left":Xf)}}let Rd=!1;if(ah.icon&&ah.icon.name){const Sf=y[ah.icon.name];Sf&&(nd=bS(C[ah.icon.name],qr.get("icon-offset").evaluate(ah,{},vt),qr.get("icon-anchor").evaluate(ah,{},vt)),Rd=Sf.sdf,c.sdfIcons===void 0?c.sdfIcons=Sf.sdf:c.sdfIcons!==Sf.sdf&&np("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sf.pixelRatio!==c.pixelRatio||qr.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const kd=mE(kh.horizontal)||kh.vertical;c.iconsInText||(c.iconsInText=!!kd&&kd.iconsInText),(kd||nd)&&kS(c,ah,kh,nd,y,nl,Yh,0,ed,Rd,X,vt,Ui)}N&&c.generateCollisionDebugBuffers(Ht,c.collisionBoxArray)}function T2(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kS(c,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl){let ju=N.textMaxSize.evaluate(a,{},Zs);ju===void 0&&(ju=X);const Ku=c.layers[0].layout,ah=Ku.get("icon-offset").evaluate(a,{},Zs),Eh=mE(d.horizontal)||d.vertical,zh=nl.name==="globe",Yh=X/24,kh=c.tilePixelRatio*ju/24,Gh=(Pf=c.overscaling,c.zoom>18&&Pf>2&&(Pf>>=1),Math.max(Hp/(512*Pf),1)*Ku.get("symbol-spacing")),nd=Ku.get("text-padding")*c.tilePixelRatio,ed=Ku.get("icon-padding")*c.tilePixelRatio,Rd=th(Ku.get("text-max-angle")),kd=Ku.get("text-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",Sf=Ku.get("icon-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",Zf=Ku.get("symbol-placement"),jd=Gh/2;var Pf;const Rf=Ku.get("icon-text-fit");let Uf;y&&Rf!=="none"&&(c.allowVerticalPlacement&&d.vertical&&(Uf=iE(y,d.vertical,Rf,Ku.get("icon-text-fit-padding"),ah,Yh)),Eh&&(y=iE(y,Eh,Rf,Ku.get("icon-text-fit-padding"),ah,Yh)));const Xf=(Hd,up,jp)=>{if(up.x<0||up.x>=Hp||up.y<0||up.y>=Hp)return;let vp=null;if(zh){const{x:Rp,y:dp,z:Xp}=nl.projectTilePoint(up.x,up.y,jp);vp={anchor:new D1(Rp,dp,Xp,0,void 0),up:nl.upVector(jp,up.x,up.y)}}(function(Rp,dp,Xp,xm,gm,pm,Wp,Zm,tm,bm,Wm,hg,rg,dg,xg,Ug,N_,Hm,n_,Kg,Lm,Ag,a_,Ym,Zg){const dy=Rp.addToLineVertexArray(dp,xm);let F_,$_,ky,U_,L1,cb,Kb,Qb=0,jE=0,qE=0,ZE=0,z2=-1,N2=-1;const a1={};let HE=h1("");const Lx=Xp?Xp.anchor:dp;let F2=0,$2=0;if(tm._unevaluatedLayout.getValue("text-radial-offset")===void 0?[F2,$2]=tm.layout.get("text-offset").evaluate(Lm,{},Zg).map(L0=>L0*ry):(F2=tm.layout.get("text-radial-offset").evaluate(Lm,{},Zg)*ry,$2=S2),Rp.allowVerticalPlacement&&gm.vertical){const L0=gm.vertical;if(xg)cb=I2(L0),Zm&&(Kb=I2(Zm));else{const R0=tm.layout.get("text-rotate").evaluate(Lm,{},Zg)+90;ky=Fw(bm,Lx,dp,Wm,hg,rg,L0,dg,R0,Ug),Zm&&(U_=Fw(bm,Lx,dp,Wm,hg,rg,Zm,Hm,R0))}}if(pm){const L0=tm.layout.get("icon-rotate").evaluate(Lm,{},Zg),R0=tm.layout.get("icon-text-fit")!=="none",Jb=hE(pm,L0,a_,R0),V2=Zm?hE(Zm,L0,a_,R0):void 0;$_=Fw(bm,Lx,dp,Wm,hg,rg,pm,Hm,L0),Qb=4*Jb.length;const XE=Rp.iconSizeData;let Rx=null;XE.kind==="source"?(Rx=[n1*tm.layout.get("icon-size").evaluate(Lm,{},Zg)],Rx[0]>J1&&np(`${Rp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):XE.kind==="composite"&&(Rx=[n1*Ag.compositeIconSizes[0].evaluate(Lm,{},Zg),n1*Ag.compositeIconSizes[1].evaluate(Lm,{},Zg)],(Rx[0]>J1||Rx[1]>J1)&&np(`${Rp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Rp.addSymbols(Rp.icon,Jb,Rx,Kg,n_,Lm,!1,Xp,dp,dy.lineStartIndex,dy.lineLength,-1,Ym,Zg),z2=Rp.icon.placedSymbolArray.length-1,V2&&(jE=4*V2.length,Rp.addSymbols(Rp.icon,V2,Rx,Kg,n_,Lm,J0.vertical,Xp,dp,dy.lineStartIndex,dy.lineLength,-1,Ym,Zg),N2=Rp.icon.placedSymbolArray.length-1)}for(const L0 in gm.horizontal){const R0=gm.horizontal[L0];F_||(HE=h1(R0.text),xg?L1=I2(R0):F_=Fw(bm,Lx,dp,Wm,hg,rg,R0,dg,tm.layout.get("text-rotate").evaluate(Lm,{},Zg),Ug));const Jb=R0.positionedLines.length===1;if(qE+=pE(Rp,Xp,dp,R0,Wp,tm,xg,Lm,Ug,dy,gm.vertical?J0.horizontal:J0.horizontalOnly,Jb?Object.keys(gm.horizontal):[L0],a1,z2,Ag,Ym,Zg),Jb)break}gm.vertical&&(ZE+=pE(Rp,Xp,dp,gm.vertical,Wp,tm,xg,Lm,Ug,dy,J0.vertical,["vertical"],a1,N2,Ag,Ym,Zg));let ox=-1;const U2=(L0,R0)=>L0?Math.max(L0,R0):R0;ox=U2(L1,ox),ox=U2(cb,ox),ox=U2(Kb,ox);const sT=ox>-1?1:0;Rp.glyphOffsetArray.length>=tx.MAX_GLYPHS&&np("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lm.sortKey!==void 0&&Rp.addToSortKeyRanges(Rp.symbolInstances.length,Lm.sortKey),Rp.symbolInstances.emplaceBack(Lx.x,Lx.y,Lx.z,dp.x,dp.y,a1.right>=0?a1.right:-1,a1.center>=0?a1.center:-1,a1.left>=0?a1.left:-1,a1.vertical>=0?a1.vertical:-1,z2,N2,HE,F_!==void 0?F_:Rp.collisionBoxArray.length,F_!==void 0?F_+1:Rp.collisionBoxArray.length,ky!==void 0?ky:Rp.collisionBoxArray.length,ky!==void 0?ky+1:Rp.collisionBoxArray.length,$_!==void 0?$_:Rp.collisionBoxArray.length,$_!==void 0?$_+1:Rp.collisionBoxArray.length,U_||Rp.collisionBoxArray.length,U_?U_+1:Rp.collisionBoxArray.length,Wm,qE,ZE,Qb,jE,sT,0,F2,$2,ox)})(c,up,vp,Hd,d,y,C,Uf,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,nd,kd,Ht,0,ed,Sf,ah,a,N,Ui,qr,Zs)};if(Zf==="line")for(const Hd of lE(a.geometry,0,0,Hp,Hp)){const up=ES(Hd,Gh,Rd,d.vertical||Eh,y,24,kh,c.overscaling,Hp);for(const jp of up){const vp=Eh;vp&&DS(c,vp.text,jd,jp)||Xf(Hd,jp,Zs)}}else if(Zf==="line-center"){for(const Hd of a.geometry)if(Hd.length>1){const up=wS(Hd,Rd,d.vertical||Eh,y,24,kh);up&&Xf(Hd,up,Zs)}}else if(a.type==="Polygon")for(const Hd of wp(a.geometry,0)){const up=MS(Hd,16);Xf(Hd[0],new D1(up.x,up.y,0,0,void 0),Zs)}else if(a.type==="LineString")for(const Hd of a.geometry)Xf(Hd,new D1(Hd[0].x,Hd[0].y,0,0,void 0),Zs);else if(a.type==="Point")for(const Hd of a.geometry)for(const up of Hd)Xf([up],new D1(up.x,up.y,0,0,void 0),Zs)}const J1=32640;function pE(c,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku,ah,Eh){const zh=function(Gh,nd,ed,Rd,kd,Sf,Zf,jd){const Pf=[];if(nd.positionedLines.length===0)return Pf;const Rf=Rd.layout.get("text-rotate").evaluate(Sf,{})*Math.PI/180,Uf=function(vp){const Rp=vp[0],dp=vp[1],Xp=Rp*dp;return Xp>0?[Rp,-dp]:Xp<0?[-Rp,dp]:Rp===0?[dp,Rp]:[dp,-Rp]}(ed);let Xf=Math.abs(nd.top-nd.bottom);for(const vp of nd.positionedLines)Xf-=vp.lineOffset;const Hd=nd.positionedLines.length,up=Xf/Hd;let jp=nd.top-ed[1];for(let vp=0;vp<Hd;++vp){const Rp=nd.positionedLines[vp];jp=SS(nd,up,jp,vp);for(const dp of Rp.positionedGlyphs){if(!dp.rect)continue;const Xp=dp.rect||{};let xm=4,gm=!0,pm=1,Wp=0;if(dp.imageName){const Ym=Zf[dp.imageName];if(!Ym)continue;if(Ym.sdf){np("SDF images are not supported in formatted text and will be ignored.");continue}gm=!1,pm=Ym.pixelRatio,xm=1/pm}const Zm=(kd||jd)&&dp.vertical,tm=dp.metrics.advance*dp.scale/2,bm=dp.metrics,Wm=dp.rect;if(Wm===null)continue;jd&&nd.verticalizable&&(Wp=dp.imageName?tm-dp.metrics.width*dp.scale/2:0);const hg=kd?[dp.x+tm,dp.y]:[0,0];let rg=[0,0],dg=[0,0],xg=!1;kd||(Zm?(dg=[dp.x+tm+Uf[0],dp.y+Uf[1]-Wp],xg=!0):rg=[dp.x+tm+ed[0],dp.y+ed[1]-Wp]);const Ug=Wm.w*dp.scale/(pm*(dp.localGlyph?2:1)),N_=Wm.h*dp.scale/(pm*(dp.localGlyph?2:1));let Hm,n_,Kg,Lm;if(Zm){const Ym=dp.y-jp,Zg=new Js(-tm,tm-Ym),dy=-Math.PI/2,F_=new Js(...dg);Hm=new Js(-tm+rg[0],rg[1]),Hm._rotateAround(dy,Zg)._add(F_),Hm.x+=-Ym+tm,Hm.y-=(bm.left-xm)*dp.scale;const $_=dp.imageName?bm.advance*dp.scale:ry*dp.scale,ky=String.fromCharCode(dp.glyph);oS(ky)?Hm.x+=(1-xm)*dp.scale:sS(ky)?Hm.x+=$_-bm.height*dp.scale+(-xm-1)*dp.scale:Hm.x+=dp.imageName||bm.width+2*xm===Wm.w&&bm.height+2*xm===Wm.h?($_-N_)/2:($_-(bm.height+2*xm)*dp.scale)/2,n_=new Js(Hm.x,Hm.y-Ug),Kg=new Js(Hm.x+N_,Hm.y),Lm=new Js(Hm.x+N_,Hm.y-Ug)}else{const Ym=(bm.left-xm)*dp.scale-tm+rg[0],Zg=(-bm.top-xm)*dp.scale+rg[1],dy=Ym+Ug,F_=Zg+N_;Hm=new Js(Ym,Zg),n_=new Js(dy,Zg),Kg=new Js(Ym,F_),Lm=new Js(dy,F_)}if(Rf){let Ym;Ym=kd?new Js(0,0):xg?new Js(Uf[0],Uf[1]):new Js(ed[0],ed[1]),Hm._rotateAround(Rf,Ym),n_._rotateAround(Rf,Ym),Kg._rotateAround(Rf,Ym),Lm._rotateAround(Rf,Ym)}const Ag=new Js(0,0),a_=new Js(0,0);Pf.push({tl:Hm,tr:n_,bl:Kg,br:Lm,tex:Xp,writingMode:nd.writingMode,glyphOffset:hg,sectionIndex:dp.sectionIndex,isSDF:gm,pixelOffsetTL:Ag,pixelOffsetBR:a_,minFontScaleX:0,minFontScaleY:0})}}return Pf}(0,y,Ht,N,X,vt,C,c.allowVerticalPlacement),Yh=c.textSizeData;let kh=null;Yh.kind==="source"?(kh=[n1*N.layout.get("text-size").evaluate(vt,{},Eh)],kh[0]>J1&&np(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Yh.kind==="composite"&&(kh=[n1*Ku.compositeTextSizes[0].evaluate(vt,{},Eh),n1*Ku.compositeTextSizes[1].evaluate(vt,{},Eh)],(kh[0]>J1||kh[1]>J1)&&np(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,zh,kh,Ht,X,vt,qr,a,d,Ui.lineStartIndex,Ui.lineLength,ju,ah,Eh);for(const Gh of Zs)nl[Gh]=c.text.placedSymbolArray.length-1;return 4*zh.length}function mE(c){for(const a in c)return c[a];return null}function Fw(c,a,d,y,C,N,X,vt,Ht,Ui){let qr=X.top,Zs=X.bottom,nl=X.left,ju=X.right;const Ku=X.collisionPadding;if(Ku&&(nl-=Ku[0],qr-=Ku[1],ju+=Ku[2],Zs+=Ku[3]),Ht){const ah=new Js(nl,qr),Eh=new Js(ju,qr),zh=new Js(nl,Zs),Yh=new Js(ju,Zs),kh=th(Ht);let Gh=new Js(0,0);Ui&&(Gh=new Js(Ui[0],Ui[1])),ah._rotateAround(kh,Gh),Eh._rotateAround(kh,Gh),zh._rotateAround(kh,Gh),Yh._rotateAround(kh,Gh),nl=Math.min(ah.x,Eh.x,zh.x,Yh.x),ju=Math.max(ah.x,Eh.x,zh.x,Yh.x),qr=Math.min(ah.y,Eh.y,zh.y,Yh.y),Zs=Math.max(ah.y,Eh.y,zh.y,Yh.y)}return c.emplaceBack(a.x,a.y,a.z,d.x,d.y,nl,qr,ju,Zs,vt,y,C,N),c.length-1}function I2(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const a=c.bottom-c.top;return a>0?Math.max(10,a):null}function DS(c,a,d,y){const C=c.compareText;if(a in C){const N=C[a];for(let X=N.length-1;X>=0;X--)if(y.dist(N[X])<d)return!0}else C[a]=[];return C[a].push(y),!1}function gE(c,a){const d=c.fovAboveCenter,y=c.elevation?c.elevation.getMinElevationBelowMSL()*a:0,C=(c._camera.position[2]*c.worldSize-y)/Math.cos(c._pitch),N=Math.sin(d)*C/Math.sin(Math.max(Math.PI/2-c._pitch-d,.01)),X=Math.sin(c._pitch)*N+C;return Math.min(1.01*X,C*(1/c._horizonShift))}function kx(c,a){if(!a.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:a};const d=Math.pow(2,-c.z),y=c.x*d,C=(c.x+1)*d,N=c.y*d,X=(c.y+1)*d,vt=e0(y),Ht=e0(C),Ui=Cg(N),qr=Cg(X),Zs=a.project(vt,Ui),nl=a.project(Ht,Ui),ju=a.project(Ht,qr),Ku=a.project(vt,qr);let ah=Math.min(Zs.x,nl.x,ju.x,Ku.x),Eh=Math.min(Zs.y,nl.y,ju.y,Ku.y),zh=Math.max(Zs.x,nl.x,ju.x,Ku.x),Yh=Math.max(Zs.y,nl.y,ju.y,Ku.y);const kh=d/16;function Gh(ed,Rd,kd,Sf,Zf,jd){const Pf=(kd+Zf)/2,Rf=(Sf+jd)/2,Uf=a.project(e0(Pf),Cg(Rf)),Xf=Math.max(0,ah-Uf.x,Eh-Uf.y,Uf.x-zh,Uf.y-Yh);ah=Math.min(ah,Uf.x),zh=Math.max(zh,Uf.x),Eh=Math.min(Eh,Uf.y),Yh=Math.max(Yh,Uf.y),Xf>kh&&(Gh(ed,Uf,kd,Sf,Pf,Rf),Gh(Uf,Rd,Pf,Rf,Zf,jd))}Gh(Zs,nl,y,N,C,N),Gh(nl,ju,C,N,C,X),Gh(ju,Ku,C,X,y,X),Gh(Ku,Zs,y,X,y,N),ah-=kh,Eh-=kh,zh+=kh,Yh+=kh;const nd=1/Math.max(zh-ah,Yh-Eh);return{scale:nd,x:ah*nd,y:Eh*nd,x2:zh*nd,y2:Yh*nd,projection:a}}const LS=C0(new Float32Array(16));class ex{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,d){return{x:0,y:0,z:0}}unproject(a,d){return new Sm(0,0)}projectTilePoint(a,d,y){return{x:a,y:d,z:0}}locationPoint(a,d,y=!0){return a._coordinatePoint(a.locationCoordinate(d),y)}pixelsPerMeter(a,d){return Jy(1,a)*d}pixelSpaceConversion(a,d,y){return 1}farthestPixelDistance(a){return gE(a,a.pixelsPerMeter)}pointCoordinate(a,d,y,C){const N=a.horizonLineFromTop(!1),X=new Js(d,Math.max(N,y));return a.rayIntersectionCoordinate(a.pointRayIntersection(X,C))}pointCoordinate3D(a,d,y){const C=new Js(d,y);if(a.elevation)return a.elevation.pointCoordinate(C);{const N=this.pointCoordinate(a,C.x,C.y,0);return[N.x,N.y,N.z]}}isPointAboveHorizon(a,d){if(a.elevation)return!this.pointCoordinate3D(a,d.x,d.y);const y=a.horizonLineFromTop();return d.y<y}createInversionMatrix(a,d){return LS}createTileMatrix(a,d,y){let C,N,X;const vt=y.canonical,Ht=C0(new Float64Array(16));if(this.isReprojectedInTileSpace){const Ui=kx(vt,this);C=1,N=Ui.x+y.wrap*Ui.scale,X=Ui.y,Jv(Ht,Ht,[C/Ui.scale,C/Ui.scale,a.pixelsPerMeter/d])}else C=d/a.zoomScale(vt.z),N=(vt.x+Math.pow(2,vt.z)*y.wrap)*C,X=vt.y*C;return $1(Ht,Ht,[N,X,0]),Jv(Ht,Ht,[C/Hp,C/Hp,1]),Ht}upVector(a,d,y){return[0,0,1]}upVectorScale(a,d,y){return{metersToTile:1}}}class RS extends ex{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[d,y]=this.parallels=a.parallels||[29.5,45.5],C=Math.sin(th(d));this.n=(C+Math.sin(th(y)))/2,this.c=1+C*(2*this.n-C),this.r0=Math.sqrt(this.c)/this.n}project(a,d){const{n:y,c:C,r0:N}=this,X=th(a-this.center[0]),vt=th(d),Ht=Math.sqrt(C-2*y*Math.sin(vt))/y;return{x:Ht*Math.sin(X*y),y:Ht*Math.cos(X*y)-N,z:0}}unproject(a,d){const{n:y,c:C,r0:N}=this,X=N+d;let vt=Math.atan2(a,Math.abs(X))*Math.sign(X);X*y<0&&(vt-=Math.PI*Math.sign(a)*Math.sign(X));const Ht=th(this.center[0])*y;vt=Tf(vt,-Math.PI-Ht,Math.PI-Ht);const Ui=Uh(sl(vt/y)+this.center[0],-180,180),qr=Math.asin(Uh((C-(a*a+X*X)*y*y)/(2*y),-1,1)),Zs=Uh(sl(qr),-o_,o_);return new Sm(Ui,Zs)}}const qb=1.340264,Zb=-.081106,Hb=893e-6,Xb=.003796,$w=Math.sqrt(3)/2;class BS extends ex{project(a,d){d=d/180*Math.PI,a=a/180*Math.PI;const y=Math.asin($w*Math.sin(d)),C=y*y,N=C*C*C;return{x:.5*(a*Math.cos(y)/($w*(qb+3*Zb*C+N*(7*Hb+9*Xb*C)))/Math.PI+.5),y:1-.5*(y*(qb+Zb*C+N*(Hb+Xb*C))/Math.PI+1),z:0}}unproject(a,d){a=(2*a-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,C=y*y,N=C*C*C;for(let qr,Zs,nl,ju=0;ju<12&&(Zs=y*(qb+Zb*C+N*(Hb+Xb*C))-d,nl=qb+3*Zb*C+N*(7*Hb+9*Xb*C),qr=Zs/nl,y=Uh(y-qr,-Math.PI/3,Math.PI/3),C=y*y,N=C*C*C,!(Math.abs(qr)<1e-12));++ju);const X=$w*a*(qb+3*Zb*C+N*(7*Hb+9*Xb*C))/Math.cos(y),vt=Math.asin(Math.sin(y)/$w),Ht=Uh(180*X/Math.PI,-180,180),Ui=Uh(180*vt/Math.PI,-o_,o_);return new Sm(Ht,Ui)}}class zS extends ex{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,d){return{x:.5+a/360,y:.5-d/360,z:0}}unproject(a,d){const y=360*(a-.5),C=Uh(360*(.5-d),-o_,o_);return new Sm(y,C)}}const ab=Math.PI/2;function Uw(c){return Math.tan((ab+c)/2)}class NS extends ex{constructor(a){super(a),this.center=a.center||[0,30];const[d,y]=this.parallels=a.parallels||[30,30];let C=th(d),N=th(y);this.southernCenter=C+N<0,this.southernCenter&&(C=-C,N=-N);const X=Math.cos(C),vt=Uw(C);this.n=C===N?Math.sin(C):Math.log(X/Math.cos(N))/Math.log(Uw(N)/vt),this.f=X*Math.pow(Uw(C),this.n)/this.n}project(a,d){d=th(d),this.southernCenter&&(d=-d),a=th(a-this.center[0]);const y=1e-6,{n:C,f:N}=this;N>0?d<-ab+y&&(d=-ab+y):d>ab-y&&(d=ab-y);const X=N/Math.pow(Uw(d),C);let vt=X*Math.sin(C*a),Ht=N-X*Math.cos(C*a);return vt=.5*(vt/Math.PI+.5),Ht=.5*(Ht/Math.PI+.5),{x:vt,y:this.southernCenter?Ht:1-Ht,z:0}}unproject(a,d){a=(2*a-.5)*Math.PI,this.southernCenter&&(d=1-d),d=(2*(1-d)-.5)*Math.PI;const{n:y,f:C}=this,N=C-d,X=Math.sign(N),vt=Math.sign(y)*Math.sqrt(a*a+N*N);let Ht=Math.atan2(a,Math.abs(N))*X;N*y<0&&(Ht-=Math.PI*Math.sign(a)*X);const Ui=Uh(sl(Ht/y)+this.center[0],-180,180),qr=Uh(sl(2*Math.atan(Math.pow(C/vt,1/y))-ab),-o_,o_);return new Sm(Ui,this.southernCenter?-qr:qr)}}class _E extends ex{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,d){return{x:P0(a),y:X0(d),z:0}}unproject(a,d){const y=e0(a),C=Cg(d);return new Sm(y,C)}}const yE=th(o_);class FS extends ex{project(a,d){const y=(d=th(d))*d,C=y*y;return{x:.5*((a=th(a))*(.8707-.131979*y+C*(C*(.003971*y-.001529*C)-.013791))/Math.PI+.5),y:1-.5*(d*(1.007226+y*(.015085+C*(.028874*y-.044475-.005916*C)))/Math.PI+1),z:0}}unproject(a,d){a=(2*a-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,C=25,N=0,X=y*y;do{X=y*y;const Ui=X*X;N=(y*(1.007226+X*(.015085+Ui*(.028874*X-.044475-.005916*Ui)))-d)/(1.007226+X*(.045255+Ui*(.259866*X-.311325-.005916*11*Ui))),y=Uh(y-N,-yE,yE)}while(Math.abs(N)>1e-6&&--C>0);X=y*y;const vt=Uh(sl(a/(.8707+X*(X*(X*X*X*(.003971-.001529*X)-.013791)-.131979))),-180,180),Ht=sl(y);return new Sm(vt,Ht)}}const vE=th(o_);class $S extends ex{project(a,d){d=th(d),a=th(a);const y=Math.cos(d),C=2/Math.PI,N=Math.acos(y*Math.cos(a/2)),X=Math.sin(N)/N,vt=.5*(a*C+2*y*Math.sin(a/2)/X)||0,Ht=.5*(d+Math.sin(d)/X)||0;return{x:.5*(vt/Math.PI+.5),y:1-.5*(Ht/Math.PI+1),z:0}}unproject(a,d){let y=a=(2*a-.5)*Math.PI,C=d=(2*(1-d)-1)*Math.PI,N=25;const X=1e-6;let vt=0,Ht=0;do{const Ui=Math.cos(C),qr=Math.sin(C),Zs=2*qr*Ui,nl=qr*qr,ju=Ui*Ui,Ku=Math.cos(y/2),ah=Math.sin(y/2),Eh=2*Ku*ah,zh=ah*ah,Yh=1-ju*Ku*Ku,kh=Yh?1/Yh:0,Gh=Yh?Math.acos(Ui*Ku)*Math.sqrt(1/Yh):0,nd=.5*(2*Gh*Ui*ah+2*y/Math.PI)-a,ed=.5*(Gh*qr+C)-d,Rd=.5*kh*(ju*zh+Gh*Ui*Ku*nl)+1/Math.PI,kd=kh*(Eh*Zs/4-Gh*qr*ah),Sf=.125*kh*(Zs*ah-Gh*qr*ju*Eh),Zf=.5*kh*(nl*Ku+Gh*zh*Ui)+.5,jd=kd*Sf-Zf*Rd;vt=(ed*kd-nd*Zf)/jd,Ht=(nd*Sf-ed*Rd)/jd,y=Uh(y-vt,-Math.PI,Math.PI),C=Uh(C-Ht,-vE,vE)}while((Math.abs(vt)>X||Math.abs(Ht)>X)&&--N>0);return new Sm(sl(y),sl(C))}}class xE extends ex{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(th(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,d){const{scale:y,cosPhi:C}=this;return{x:th(a)*C*y+.5,y:-Math.sin(th(d))/C*y+.5,z:0}}unproject(a,d){const{scale:y,cosPhi:C}=this,N=-(d-.5)/y,X=Uh(sl((a-.5)/y)/C,-180,180),vt=Math.asin(Uh(N*C,-1,1)),Ht=Uh(sl(vt),-o_,o_);return new Sm(X,Ht)}}class US extends _E{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,d,y){const C=G1(a,d,y);return Mg(C,C,j1(pv(y))),{x:C[0],y:C[1],z:C[2]}}locationPoint(a,d){const y=b1(d.lat,d.lng),C=R_([],y),N=a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(d),a._centerAltitude):a._centerAltitude;U1(y,y,C,Jy(1,0)*Hp*N);const X=C0(new Float64Array(16));return p1(X,a.pixelMatrix,a.globeMatrix),Mg(y,y,X),new Js(y[0],y[1])}pixelsPerMeter(a,d){return Jy(1,0)*d}pixelSpaceConversion(a,d,y){const C=Jy(1,a)*d,N=Kp(Jy(1,45)*d,C,y);return this.pixelsPerMeter(a,d)/N}createTileMatrix(a,d,y){const C=Wx(pv(y.canonical));return p1(new Float64Array(16),a.globeMatrix,C)}createInversionMatrix(a,d){const{center:y}=a,C=j1(pv(d));return jx(C,C,th(y.lng)),Vx(C,C,th(y.lat)),Jv(C,C,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(C)}pointCoordinate(a,d,y,C){return wb(a,d,y,!0)||new Z1(0,0)}pointCoordinate3D(a,d,y){const C=this.pointCoordinate(a,d,y,0);return[C.x,C.y,C.z]}isPointAboveHorizon(a,d){return!wb(a,d.x,d.y,!1)}farthestPixelDistance(a){const d=function(C,N){const X=C.cameraToCenterDistance,vt=C._centerAltitude*N,Ht=C._camera,Ui=C._camera.forward(),qr=q0([],hy([],Ui,-X),[0,0,vt]),Zs=C.worldSize/(2*Math.PI),nl=[0,0,-Zs],ju=C.width/C.height,Ku=Math.tan(C.fovAboveCenter),ah=hy([],Ht.up(),Ku),Eh=hy([],Ht.right(),Ku*ju),zh=R_([],q0([],q0([],Ui,ah),Eh)),Yh=[];let kh;if(new Zx(qr,zh).closestPointOnSphere(nl,Zs,Yh)){const Gh=q0([],Yh,nl),nd=Z0([],Gh,qr);kh=Math.cos(C.fovAboveCenter)*Dv(nd)}else{const Gh=Z0([],qr,nl),nd=Z0([],nl,qr);R_(nd,nd);const ed=Dv(Gh)-Zs;kh=Math.sqrt(ed*(ed+2*Zs));const Rd=Math.acos(kh/(Zs+ed))-Math.acos(t_(Ui,nd));kh*=Math.cos(Rd)}return 1.01*kh}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),y=Lv(a.zoom);if(y>0){const C=gE(a,Jy(1,a.center.lat)*a.worldSize),N=a.worldSize/(2*Math.PI),X=Math.max(a.width,a.height)/a.worldSize*Math.PI;return Kp(d,C+N*(1-Math.cos(X)),Math.pow(y,10))}return d}upVector(a,d,y){return G1(d,y,a,1)}upVectorScale(a){return{metersToTile:_x(Xx(pv(a)))}}}function bE(c){const a=c.parallels,d=!!a&&Math.abs(a[0]+a[1])<.01;switch(c.name){case"mercator":return new _E(c);case"equirectangular":return new zS(c);case"naturalEarth":return new FS(c);case"equalEarth":return new BS(c);case"winkelTripel":return new $S(c);case"albers":return d?new xE(c):new RS(c);case"lambertConformalConic":return d?new xE(c):new NS(c);case"globe":return new US(c)}throw new Error(`Invalid projection name: ${c.name}`)}const VS=b_.types,GS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vw(c,a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl){const ju=vt?Math.min(J1,Math.round(vt[0])):0,Ku=vt?Math.min(J1,Math.round(vt[1])):0;c.emplaceBack(a,d,Math.round(32*y),Math.round(32*C),N,X,(ju<<1)+(Ht?1:0),Ku,16*Ui,16*qr,256*Zs,256*nl)}function Gw(c,a,d,y,C,N,X){c.emplaceBack(a,d,y,C,N,X)}function jw(c,a,d,y,C){c.emplaceBack(a,d,y,C),c.emplaceBack(a,d,y,C),c.emplaceBack(a,d,y,C),c.emplaceBack(a,d,y,C)}function jS(c){for(const a of c.sections)if(Qu(a.text))return!0;return!1}class M2{constructor(a){this.layoutVertexArray=new V0,this.indexArray=new y_,this.programConfigurations=a,this.segments=new Og,this.dynamicLayoutVertexArray=new Fm,this.opacityVertexArray=new qm,this.placedSymbolArray=new sx,this.globeExtVertexArray=new ig}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,d,y,C){this.isEmpty()||(y&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Px.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,P1.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,GS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Dw.members,!0)),this.opacityVertexBuffer.itemSize=1),(y||C)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ip(M2,"SymbolBuffers");class C2{constructor(a,d,y){this.layoutVertexArray=new a,this.layoutAttributes=d,this.indexArray=new y,this.segments=new Og,this.collisionVertexArray=new Dm,this.collisionVertexArrayExt=new jg}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,eS.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,tS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ip(C2,"CollisionBuffers");class tx{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(X=>X.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=C0([]),this.placementViewportMatrix=C0([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_2(this.zoom,d["text-size"]),this.iconSizeData=_2(this.zoom,d["icon-size"]);const y=this.layers[0].layout,C=y.get("symbol-sort-key"),N=y.get("symbol-z-order");this.canOverlap=y.get("text-allow-overlap")||y.get("icon-allow-overlap")||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey=N!=="viewport-y"&&C.constantOr(1)!==void 0,this.sortFeaturesByY=(N==="viewport-y"||N==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=y.get("text-writing-mode").map(X=>J0[X]),this.stateDependentLayerIds=this.layers.filter(X=>X.isStateDependent()).map(X=>X.id),this.sourceID=a.sourceID,this.projection=a.projection}createArrays(){this.text=new M2(new f1(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new M2(new f1(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new lx,this.lineVertexArray=new B1,this.symbolInstances=new ax}calculateGlyphDependencies(a,d,y,C,N){for(let X=0;X<a.length;X++)if(d[a.charCodeAt(X)]=!0,C&&N){const vt=Ub[a.charAt(X)];vt&&(d[vt.charCodeAt(0)]=!0)}}populate(a,d,y,C){const N=this.layers[0],X=N.layout,vt=this.projection.name==="globe",Ht=X.get("text-font"),Ui=X.get("text-field"),qr=X.get("icon-image"),Zs=(Ui.value.kind!=="constant"||Ui.value.value instanceof bg&&!Ui.value.value.isEmpty()||Ui.value.value.toString().length>0)&&(Ht.value.kind!=="constant"||Ht.value.value.length>0),nl=qr.value.kind!=="constant"||!!qr.value.value||Object.keys(qr.parameters).length>0,ju=X.get("symbol-sort-key");if(this.features=[],!Zs&&!nl)return;const Ku=d.iconDependencies,ah=d.glyphDependencies,Eh=d.availableImages,zh=new ld(this.zoom);for(const{feature:Yh,id:kh,index:Gh,sourceLayerIndex:nd}of a){const ed=N._featureFilter.needGeometry,Rd=Ov(Yh,ed);if(!N._featureFilter.filter(zh,Rd,y))continue;if(ed||(Rd.geometry=Rv(Yh,y,C)),vt&&Yh.type!==1&&y.z<=5){const jd=Rd.geometry,Pf=.98078528056,Rf=(Uf,Xf)=>t_(G1(Uf.x,Uf.y,y,1),G1(Xf.x,Xf.y,y,1))<Pf;for(let Uf=0;Uf<jd.length;Uf++)jd[Uf]=a2(jd[Uf],Rf)}let kd,Sf;if(Zs){const jd=N.getValueAndResolveTokens("text-field",Rd,y,Eh),Pf=bg.factory(jd);jS(Pf)&&(this.hasRTLText=!0),(!this.hasRTLText||qh()==="unavailable"||this.hasRTLText&&Hh.isParsed())&&(kd=rS(Pf,N,Rd))}if(nl){const jd=N.getValueAndResolveTokens("icon-image",Rd,y,Eh);Sf=jd instanceof kg?jd:kg.fromString(jd)}if(!kd&&!Sf)continue;const Zf=this.sortFeaturesByKey?ju.evaluate(Rd,{},y):void 0;if(this.features.push({id:kh,text:kd,icon:Sf,index:Gh,sourceLayerIndex:nd,geometry:Rd.geometry,properties:Yh.properties,type:VS[Yh.type],sortKey:Zf}),Sf&&(Ku[Sf.name]=!0),kd){const jd=Ht.evaluate(Rd,{},y).join(","),Pf=X.get("text-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(J0.vertical)>=0;for(const Rf of kd.sections)if(Rf.image)Ku[Rf.image.name]=!0;else{const Uf=ge(kd.toString()),Xf=Rf.fontStack||jd,Hd=ah[Xf]=ah[Xf]||{};this.calculateGlyphDependencies(Rf.text,Hd,Pf,this.allowVerticalPlacement,Uf)}}}X.get("symbol-placement")==="line"&&(this.features=function(Yh){const kh={},Gh={},nd=[];let ed=0;function Rd(jd){nd.push(Yh[jd]),ed++}function kd(jd,Pf,Rf){const Uf=Gh[jd];return delete Gh[jd],Gh[Pf]=Uf,nd[Uf].geometry[0].pop(),nd[Uf].geometry[0]=nd[Uf].geometry[0].concat(Rf[0]),Uf}function Sf(jd,Pf,Rf){const Uf=kh[Pf];return delete kh[Pf],kh[jd]=Uf,nd[Uf].geometry[0].shift(),nd[Uf].geometry[0]=Rf[0].concat(nd[Uf].geometry[0]),Uf}function Zf(jd,Pf,Rf){const Uf=Rf?Pf[0][Pf[0].length-1]:Pf[0][0];return`${jd}:${Uf.x}:${Uf.y}`}for(let jd=0;jd<Yh.length;jd++){const Pf=Yh[jd],Rf=Pf.geometry,Uf=Pf.text?Pf.text.toString():null;if(!Uf){Rd(jd);continue}const Xf=Zf(Uf,Rf),Hd=Zf(Uf,Rf,!0);if(Xf in Gh&&Hd in kh&&Gh[Xf]!==kh[Hd]){const up=Sf(Xf,Hd,Rf),jp=kd(Xf,Hd,nd[up].geometry);delete kh[Xf],delete Gh[Hd],Gh[Zf(Uf,nd[jp].geometry,!0)]=jp,nd[up].geometry=null}else Xf in Gh?kd(Xf,Hd,Rf):Hd in kh?Sf(Xf,Hd,Rf):(Rd(jd),kh[Xf]=ed-1,Gh[Hd]=ed-1)}return nd.filter(jd=>jd.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Yh,kh)=>Yh.sortKey-kh.sortKey)}update(a,d,y,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,d,this.layers,y,C),this.icon.programConfigurations.updatePaintArrays(a,d,this.layers,y,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=bE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,d){const y=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:C,y:N}of d)this.lineVertexArray.emplaceBack(C,N);return{lineStartIndex:y,lineLength:this.lineVertexArray.length-y}}addSymbols(a,d,y,C,N,X,vt,Ht,Ui,qr,Zs,nl,ju,Ku){const ah=a.indexArray,Eh=a.layoutVertexArray,zh=a.globeExtVertexArray,Yh=a.segments.prepareSegment(4*d.length,Eh,ah,this.canOverlap?X.sortKey:void 0),kh=this.glyphOffsetArray.length,Gh=Yh.vertexLength,nd=this.allowVerticalPlacement&&vt===J0.vertical?Math.PI/2:0,ed=X.text&&X.text.sections;for(let kd=0;kd<d.length;kd++){const{tl:Sf,tr:Zf,bl:jd,br:Pf,tex:Rf,pixelOffsetTL:Uf,pixelOffsetBR:Xf,minFontScaleX:Hd,minFontScaleY:up,glyphOffset:jp,isSDF:vp,sectionIndex:Rp}=d[kd],dp=Yh.vertexLength,Xp=jp[1];if(Vw(Eh,Ui.x,Ui.y,Sf.x,Xp+Sf.y,Rf.x,Rf.y,y,vp,Uf.x,Uf.y,Hd,up),Vw(Eh,Ui.x,Ui.y,Zf.x,Xp+Zf.y,Rf.x+Rf.w,Rf.y,y,vp,Xf.x,Uf.y,Hd,up),Vw(Eh,Ui.x,Ui.y,jd.x,Xp+jd.y,Rf.x,Rf.y+Rf.h,y,vp,Uf.x,Xf.y,Hd,up),Vw(Eh,Ui.x,Ui.y,Pf.x,Xp+Pf.y,Rf.x+Rf.w,Rf.y+Rf.h,y,vp,Xf.x,Xf.y,Hd,up),Ht){const{x:xm,y:gm,z:pm}=Ht.anchor,[Wp,Zm,tm]=Ht.up;Gw(zh,xm,gm,pm,Wp,Zm,tm),Gw(zh,xm,gm,pm,Wp,Zm,tm),Gw(zh,xm,gm,pm,Wp,Zm,tm),Gw(zh,xm,gm,pm,Wp,Zm,tm),jw(a.dynamicLayoutVertexArray,xm,gm,pm,nd)}else jw(a.dynamicLayoutVertexArray,Ui.x,Ui.y,Ui.z,nd);ah.emplaceBack(dp,dp+1,dp+2),ah.emplaceBack(dp+1,dp+2,dp+3),Yh.vertexLength+=4,Yh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jp[0]),kd!==d.length-1&&Rp===d[kd+1].sectionIndex||a.programConfigurations.populatePaintArrays(Eh.length,X,X.index,{},ju,Ku,ed&&ed[Rp])}const Rd=Ht?Ht.anchor:Ui;a.placedSymbolArray.emplaceBack(Rd.x,Rd.y,Rd.z,Ui.x,Ui.y,kh,this.glyphOffsetArray.length-kh,Gh,qr,Zs,Ui.segment,y?y[0]:0,y?y[1]:0,C[0],C[1],vt,0,!1,0,nl,0)}_commitLayoutVertex(a,d,y,C,N,X,vt){a.emplaceBack(d,y,C,N,X,Math.round(vt.x),Math.round(vt.y))}_addCollisionDebugVertices(a,d,y,C,N,X,vt){const Ht=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),Ui=Ht.vertexLength,qr=vt.tileAnchorX,Zs=vt.tileAnchorY;for(let ju=0;ju<4;ju++)y.collisionVertexArray.emplaceBack(0,0,0,0);y.collisionVertexArrayExt.emplaceBack(d,-a.padding,-a.padding),y.collisionVertexArrayExt.emplaceBack(d,a.padding,-a.padding),y.collisionVertexArrayExt.emplaceBack(d,a.padding,a.padding),y.collisionVertexArrayExt.emplaceBack(d,-a.padding,a.padding),this._commitLayoutVertex(y.layoutVertexArray,C,N,X,qr,Zs,new Js(a.x1,a.y1)),this._commitLayoutVertex(y.layoutVertexArray,C,N,X,qr,Zs,new Js(a.x2,a.y1)),this._commitLayoutVertex(y.layoutVertexArray,C,N,X,qr,Zs,new Js(a.x2,a.y2)),this._commitLayoutVertex(y.layoutVertexArray,C,N,X,qr,Zs,new Js(a.x1,a.y2)),Ht.vertexLength+=4;const nl=y.indexArray;nl.emplaceBack(Ui,Ui+1),nl.emplaceBack(Ui+1,Ui+2),nl.emplaceBack(Ui+2,Ui+3),nl.emplaceBack(Ui+3,Ui),Ht.primitiveLength+=4}_addTextDebugCollisionBoxes(a,d,y,C,N,X){for(let vt=C;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceTextSize(a,X,d,vt);this._addCollisionDebugVertices(Ht,Ui,this.textCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,X)}}_addIconDebugCollisionBoxes(a,d,y,C,N,X){for(let vt=C;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceIconSize(a,d,X.placedIconSymbolIndex);this._addCollisionDebugVertices(Ht,Ui,this.iconCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,X)}}generateCollisionDebugBuffers(a,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new C2(cg,G2.members,dv),this.iconCollisionBox=new C2(cg,G2.members,dv);const y=tb(this.iconSizeData,a),C=tb(this.textSizeData,a);for(let N=0;N<this.symbolInstances.length;N++){const X=this.symbolInstances.get(N);this._addTextDebugCollisionBoxes(C,a,d,X.textBoxStartIndex,X.textBoxEndIndex,X),this._addTextDebugCollisionBoxes(C,a,d,X.verticalTextBoxStartIndex,X.verticalTextBoxEndIndex,X),this._addIconDebugCollisionBoxes(y,a,d,X.iconBoxStartIndex,X.iconBoxEndIndex,X),this._addIconDebugCollisionBoxes(y,a,d,X.verticalIconBoxStartIndex,X.verticalIconBoxEndIndex,X)}}getSymbolInstanceTextSize(a,d,y,C){const N=this.text.placedSymbolArray.get(d.rightJustifiedTextSymbolIndex>=0?d.rightJustifiedTextSymbolIndex:d.centerJustifiedTextSymbolIndex>=0?d.centerJustifiedTextSymbolIndex:d.leftJustifiedTextSymbolIndex>=0?d.leftJustifiedTextSymbolIndex:d.verticalPlacedTextSymbolIndex>=0?d.verticalPlacedTextSymbolIndex:C),X=Lw(this.textSizeData,a,N)/ry;return this.tilePixelRatio*X}getSymbolInstanceIconSize(a,d,y){const C=this.icon.placedSymbolArray.get(y),N=Lw(this.iconSizeData,a,C);return this.tilePixelRatio*N}_commitDebugCollisionVertexUpdate(a,d,y){a.emplaceBack(d,-y,-y),a.emplaceBack(d,y,-y),a.emplaceBack(d,y,y),a.emplaceBack(d,-y,y)}_updateTextDebugCollisionBoxes(a,d,y,C,N,X){for(let vt=C;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceTextSize(a,X,d,vt);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}_updateIconDebugCollisionBoxes(a,d,y,C,N,X){for(let vt=C;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceIconSize(a,d,X);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}updateCollisionDebugBuffers(a,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=tb(this.iconSizeData,a),C=tb(this.textSizeData,a);for(let N=0;N<this.symbolInstances.length;N++){const X=this.symbolInstances.get(N);this._updateTextDebugCollisionBoxes(C,a,d,X.textBoxStartIndex,X.textBoxEndIndex,X),this._updateTextDebugCollisionBoxes(C,a,d,X.verticalTextBoxStartIndex,X.verticalTextBoxEndIndex,X),this._updateIconDebugCollisionBoxes(y,a,d,X.iconBoxStartIndex,X.iconBoxEndIndex,X.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(y,a,d,X.verticalIconBoxStartIndex,X.verticalIconBoxEndIndex,X.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,d,y,C,N,X,vt,Ht,Ui){const qr={};if(d<y){const{x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh,featureIndex:nd}=a.get(d);qr.textBox={x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh},qr.textFeatureIndex=nd}if(C<N){const{x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh,featureIndex:nd}=a.get(C);qr.verticalTextBox={x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh},qr.verticalTextFeatureIndex=nd}if(X<vt){const{x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh,featureIndex:nd}=a.get(X);qr.iconBox={x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh},qr.iconFeatureIndex=nd}if(Ht<Ui){const{x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh,featureIndex:nd}=a.get(Ht);qr.verticalIconBox={x1:Zs,y1:nl,x2:ju,y2:Ku,padding:ah,projectedAnchorX:Eh,projectedAnchorY:zh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Gh},qr.verticalIconFeatureIndex=nd}return qr}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const y=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,y.textBoxStartIndex,y.textBoxEndIndex,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,d){const y=a.placedSymbolArray.get(d),C=y.vertexStartIndex+4*y.numGlyphs;for(let N=y.vertexStartIndex;N<C;N+=4)a.indexArray.emplaceBack(N,N+1,N+2),a.indexArray.emplaceBack(N+1,N+2,N+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(a),y=Math.cos(a),C=[],N=[],X=[];for(let vt=0;vt<this.symbolInstances.length;++vt){X.push(vt);const Ht=this.symbolInstances.get(vt);C.push(0|Math.round(d*Ht.tileAnchorX+y*Ht.tileAnchorY)),N.push(Ht.featureIndex)}return X.sort((vt,Ht)=>C[vt]-C[Ht]||N[Ht]-N[vt]),X}addToSortKeyRanges(a,d){const y=this.sortKeyRanges[this.sortKeyRanges.length-1];y&&y.sortKey===d?y.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const y=this.symbolInstances.get(d);this.featureSortOrder.push(y.featureIndex);const{rightJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:N,leftJustifiedTextSymbolIndex:X,verticalPlacedTextSymbolIndex:vt,placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Ui}=y;C>=0&&this.addIndicesForPlacedSymbol(this.text,C),N>=0&&N!==C&&this.addIndicesForPlacedSymbol(this.text,N),X>=0&&X!==N&&X!==C&&this.addIndicesForPlacedSymbol(this.text,X),vt>=0&&this.addIndicesForPlacedSymbol(this.text,vt),Ht>=0&&this.addIndicesForPlacedSymbol(this.icon,Ht),Ui>=0&&this.addIndicesForPlacedSymbol(this.icon,Ui)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ip(tx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tx.MAX_GLYPHS=65535,tx.addDynamicAttributes=jw;const qS=new Bf({"symbol-placement":new pd(Pd.layout_symbol["symbol-placement"]),"symbol-spacing":new pd(Pd.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pd(Pd.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bd(Pd.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pd(Pd.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pd(Pd.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pd(Pd.layout_symbol["icon-ignore-placement"]),"icon-optional":new pd(Pd.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pd(Pd.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bd(Pd.layout_symbol["icon-size"]),"icon-text-fit":new pd(Pd.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pd(Pd.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bd(Pd.layout_symbol["icon-image"]),"icon-rotate":new Bd(Pd.layout_symbol["icon-rotate"]),"icon-padding":new pd(Pd.layout_symbol["icon-padding"]),"icon-keep-upright":new pd(Pd.layout_symbol["icon-keep-upright"]),"icon-offset":new Bd(Pd.layout_symbol["icon-offset"]),"icon-anchor":new Bd(Pd.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pd(Pd.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pd(Pd.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pd(Pd.layout_symbol["text-rotation-alignment"]),"text-field":new Bd(Pd.layout_symbol["text-field"]),"text-font":new Bd(Pd.layout_symbol["text-font"]),"text-size":new Bd(Pd.layout_symbol["text-size"]),"text-max-width":new Bd(Pd.layout_symbol["text-max-width"]),"text-line-height":new Bd(Pd.layout_symbol["text-line-height"]),"text-letter-spacing":new Bd(Pd.layout_symbol["text-letter-spacing"]),"text-justify":new Bd(Pd.layout_symbol["text-justify"]),"text-radial-offset":new Bd(Pd.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pd(Pd.layout_symbol["text-variable-anchor"]),"text-anchor":new Bd(Pd.layout_symbol["text-anchor"]),"text-max-angle":new pd(Pd.layout_symbol["text-max-angle"]),"text-writing-mode":new pd(Pd.layout_symbol["text-writing-mode"]),"text-rotate":new Bd(Pd.layout_symbol["text-rotate"]),"text-padding":new pd(Pd.layout_symbol["text-padding"]),"text-keep-upright":new pd(Pd.layout_symbol["text-keep-upright"]),"text-transform":new Bd(Pd.layout_symbol["text-transform"]),"text-offset":new Bd(Pd.layout_symbol["text-offset"]),"text-allow-overlap":new pd(Pd.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pd(Pd.layout_symbol["text-ignore-placement"]),"text-optional":new pd(Pd.layout_symbol["text-optional"])});var A2={paint:new Bf({"icon-opacity":new Bd(Pd.paint_symbol["icon-opacity"]),"icon-color":new Bd(Pd.paint_symbol["icon-color"]),"icon-halo-color":new Bd(Pd.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bd(Pd.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bd(Pd.paint_symbol["icon-halo-blur"]),"icon-translate":new pd(Pd.paint_symbol["icon-translate"]),"icon-translate-anchor":new pd(Pd.paint_symbol["icon-translate-anchor"]),"text-opacity":new Bd(Pd.paint_symbol["text-opacity"]),"text-color":new Bd(Pd.paint_symbol["text-color"],{runtimeType:mm,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Bd(Pd.paint_symbol["text-halo-color"]),"text-halo-width":new Bd(Pd.paint_symbol["text-halo-width"]),"text-halo-blur":new Bd(Pd.paint_symbol["text-halo-blur"]),"text-translate":new pd(Pd.paint_symbol["text-translate"]),"text-translate-anchor":new pd(Pd.paint_symbol["text-translate-anchor"])}),layout:qS};class wE{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:c_,this.defaultValue=a}evaluate(a){if(a.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(a.formattedSection))return d.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ip(wE,"FormatSectionOverride",{omit:["defaultValue"]});class qw extends j0{constructor(a){super(a,A2)}recalculate(a,d){super.recalculate(a,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const y=this.layout.get("text-writing-mode");if(y){const C=[];for(const N of y)C.indexOf(N)<0&&C.push(N);this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(a,d,y,C){const N=this.layout.get(a).evaluate(d,{},y,C),X=this._unevaluatedLayout._values[a];return X.isDataDriven()||Xy(X.value)||!N?N:function(vt,Ht){return Ht.replace(/{([^{}]+)}/g,(Ui,qr)=>qr in vt?String(vt[qr]):"")}(d.properties,N)}createBucket(a){return new tx(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of A2.paint.overridableProperties){if(!qw.hasPaintOverride(this.layout,a))continue;const d=this.paint.get(a),y=new wE(d),C=new Y_(y,d.property.specification);let N=null;N=d.value.kind==="constant"||d.value.kind==="source"?new z0("source",C):new kp("composite",C,d.value.zoomStops,d.value._interpolationType),this.paint._values[a]=new Lf(d.property,N,d.parameters)}}_handleOverridablePaintPropertyUpdate(a,d,y){return!(!this.layout||d.isDataDriven()||y.isDataDriven())&&qw.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,d){const y=a.get("text-field"),C=A2.paint.properties[d];let N=!1;const X=vt=>{for(const Ht of vt)if(C.overrides&&C.overrides.hasOverride(Ht))return void(N=!0)};if(y.value.kind==="constant"&&y.value.value instanceof bg)X(y.value.value.sections);else if(y.value.kind==="source"){const vt=Ui=>{N||(Ui instanceof Ry&&Km(Ui.value)===Vh?X(Ui.value.sections):Ui instanceof r0?X(Ui.sections):Ui.eachChild(vt))},Ht=y.value;Ht._styleExpression&&vt(Ht._styleExpression.expression)}return N}getProgramConfiguration(a){return new Kv(this,a)}}var ZS={paint:new Bf({"background-color":new pd(Pd.paint_background["background-color"]),"background-pattern":new pd(Pd.paint_background["background-pattern"]),"background-opacity":new pd(Pd.paint_background["background-opacity"])})},HS={paint:new Bf({"raster-opacity":new pd(Pd.paint_raster["raster-opacity"]),"raster-hue-rotate":new pd(Pd.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pd(Pd.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pd(Pd.paint_raster["raster-brightness-max"]),"raster-saturation":new pd(Pd.paint_raster["raster-saturation"]),"raster-contrast":new pd(Pd.paint_raster["raster-contrast"]),"raster-resampling":new pd(Pd.paint_raster["raster-resampling"]),"raster-fade-duration":new pd(Pd.paint_raster["raster-fade-duration"])})};class XS extends j0{constructor(a){super(a,{}),this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}var WS={paint:new Bf({"sky-type":new pd(Pd.paint_sky["sky-type"]),"sky-atmosphere-sun":new pd(Pd.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pd(Pd.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pd(Pd.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pd(Pd.paint_sky["sky-gradient-radius"]),"sky-gradient":new mf(Pd.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pd(Pd.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pd(Pd.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pd(Pd.paint_sky["sky-opacity"])})};function P2(c,a,d){const y=[0,0,1],C=mx([]);return xb(C,C,d?-th(c)+Math.PI:th(c)),g1(C,C,-th(a)),hw(y,y,C),R_(y,y)}const YS={circle:class extends j0{constructor(c){super(c,Lb)}createBucket(c){return new Tx(c)}queryRadius(c){const a=c;return S1("circle-radius",this,a)+S1("circle-stroke-width",this,a)+Ix(this.paint.get("circle-translate"))}queryIntersectsFeature(c,a,d,y,C,N,X,vt){const Ht=Mx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Ui=this.paint.get("circle-radius").evaluate(a,d)+this.paint.get("circle-stroke-width").evaluate(a,d);return Rb(c,y,N,X,vt,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",Ht,Ui)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new Kv(this,c)}},heatmap:class extends j0{createBucket(c){return new Ob(c)}constructor(c){super(c,Iw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=T1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return S1("heatmap-radius",this,c)}queryIntersectsFeature(c,a,d,y,C,N,X,vt){const Ht=this.paint.get("heatmap-radius").evaluate(a,d);return Rb(c,y,N,X,vt,!0,!0,new Js(0,0),Ht)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new Kv(this,c)}},hillshade:class extends j0{constructor(c){super(c,Nb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends j0{constructor(c){super(c,Gp)}getProgramIds(){const c=this.paint.get("fill-pattern"),a=c&&c.constantOr(1),d=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&d.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),d}getProgramConfiguration(c){return new Kv(this,c)}recalculate(c,a){super.recalculate(c,a);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new gp(c)}queryRadius(){return Ix(this.paint.get("fill-translate"))}queryIntersectsFeature(c,a,d,y,C,N){return!c.queryGeometry.isAboveHorizon&&bw(Qx(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),y)}isTileClipped(){return!0}},"fill-extrusion":class extends j0{constructor(c){super(c,Fb)}createBucket(c){return new ty(c)}queryRadius(){return Ix(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new Kv(this,c)}queryIntersectsFeature(c,a,d,y,C,N,X,vt,Ht){const Ui=Mx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),qr=this.paint.get("fill-extrusion-height").evaluate(a,d),Zs=this.paint.get("fill-extrusion-base").evaluate(a,d),nl=[0,0],ju=vt&&N.elevation,Ku=N.elevation?N.elevation.exaggeration():1,ah=c.tile.getBucket(this);if(ju&&ah instanceof ty){const Gh=ah.centroidVertexArray,nd=Ht+1;nd<Gh.length&&(nl[0]=Gh.geta_centroid_pos0(nd),nl[1]=Gh.geta_centroid_pos1(nd))}if(nl[0]===0&&nl[1]===1)return!1;N.projection.name==="globe"&&(y=K1([y],[new Js(0,0),new Js(Hp,Hp)],c.tileID.canonical).map(Gh=>Gh.polygon).flat());const Eh=ju?vt:null,[zh,Yh]=function(Gh,nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf){return Gh.projection.name==="globe"?function(Xf,Hd,up,jp,vp,Rp,dp,Xp,xm,gm,pm){const Wp=[],Zm=[],tm=Xf.projection.upVectorScale(pm,Xf.center.lat,Xf.worldSize).metersToTile,bm=[0,0,0,1],Wm=[0,0,0,1],hg=(dg,xg,Ug,N_)=>{dg[0]=xg,dg[1]=Ug,dg[2]=N_,dg[3]=1},rg=_v();up>0&&(up+=rg),jp+=rg;for(const dg of Hd){const xg=[],Ug=[];for(const N_ of dg){const Hm=N_.x+vp.x,n_=N_.y+vp.y,Kg=Xf.projection.projectTilePoint(Hm,n_,pm),Lm=Xf.projection.upVector(pm,N_.x,N_.y);let Ag=up,a_=jp;if(dp){const Ym=Pw(Hm,n_,up,jp,dp,Xp,xm,gm);Ag+=Ym.base,a_+=Ym.top}up!==0?hg(bm,Kg.x+Lm[0]*tm*Ag,Kg.y+Lm[1]*tm*Ag,Kg.z+Lm[2]*tm*Ag):hg(bm,Kg.x,Kg.y,Kg.z),hg(Wm,Kg.x+Lm[0]*tm*a_,Kg.y+Lm[1]*tm*a_,Kg.z+Lm[2]*tm*a_),Mg(bm,bm,Rp),Mg(Wm,Wm,Rp),xg.push(new C1(bm[0],bm[1],bm[2])),Ug.push(new C1(Wm[0],Wm[1],Wm[2]))}Wp.push(xg),Zm.push(Ug)}return[Wp,Zm]}(Gh,nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf):Zf?function(Xf,Hd,up,jp,vp,Rp,dp,Xp,xm){const gm=[],pm=[],Wp=[0,0,0,1];for(const Zm of Xf){const tm=[],bm=[];for(const Wm of Zm){const hg=Wm.x+jp.x,rg=Wm.y+jp.y,dg=Pw(hg,rg,Hd,up,Rp,dp,Xp,xm);Wp[0]=hg,Wp[1]=rg,Wp[2]=dg.base,Wp[3]=1,m1(Wp,Wp,vp),Wp[3]=Math.max(Wp[3],1e-5);const xg=new C1(Wp[0]/Wp[3],Wp[1]/Wp[3],Wp[2]/Wp[3]);Wp[0]=hg,Wp[1]=rg,Wp[2]=dg.top,Wp[3]=1,m1(Wp,Wp,vp),Wp[3]=Math.max(Wp[3],1e-5);const Ug=new C1(Wp[0]/Wp[3],Wp[1]/Wp[3],Wp[2]/Wp[3]);tm.push(xg),bm.push(Ug)}gm.push(tm),pm.push(bm)}return[gm,pm]}(nd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf):function(Xf,Hd,up,jp,vp){const Rp=[],dp=[],Xp=vp[8]*Hd,xm=vp[9]*Hd,gm=vp[10]*Hd,pm=vp[11]*Hd,Wp=vp[8]*up,Zm=vp[9]*up,tm=vp[10]*up,bm=vp[11]*up;for(const Wm of Xf){const hg=[],rg=[];for(const dg of Wm){const xg=dg.x+jp.x,Ug=dg.y+jp.y,N_=vp[0]*xg+vp[4]*Ug+vp[12],Hm=vp[1]*xg+vp[5]*Ug+vp[13],n_=vp[2]*xg+vp[6]*Ug+vp[14],Kg=vp[3]*xg+vp[7]*Ug+vp[15],Lm=N_+Xp,Ag=Hm+xm,a_=n_+gm,Ym=Math.max(Kg+pm,1e-5),Zg=N_+Wp,dy=Hm+Zm,F_=n_+tm,$_=Math.max(Kg+bm,1e-5);hg.push(new C1(Lm/Ym,Ag/Ym,a_/Ym)),rg.push(new C1(Zg/$_,dy/$_,F_/$_))}Rp.push(hg),dp.push(rg)}return[Rp,dp]}(nd,ed,Rd,kd,Sf)}(N,y,Zs,qr,Ui,X,Eh,nl,Ku,N.center.lat,c.tileID.canonical),kh=c.queryGeometry;return function(Gh,nd,ed){let Rd=1/0;bw(ed,nd)&&(Rd=Aw(ed,nd[0]));for(let kd=0;kd<nd.length;kd++){const Sf=nd[kd],Zf=Gh[kd];for(let jd=0;jd<Sf.length-1;jd++){const Pf=Sf[jd],Rf=[Pf,Sf[jd+1],Zf[jd+1],Zf[jd],Pf];xw(ed,Rf)&&(Rd=Math.min(Rd,Aw(ed,Rf)))}}return Rd!==1/0&&Rd}(zh,Yh,kh.isPointQuery()?kh.screenBounds:kh.screenGeometry)}},line:class extends j0{constructor(c){super(c,ny),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof p_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,a){super.recalculate(c,a),this.paint._values["line-floorwidth"]=Q0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new A1(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new Kv(this,c)}queryRadius(c){const a=c,d=Q1(S1("line-width",this,a),S1("line-gap-width",this,a)),y=S1("line-offset",this,a);return d/2+Math.abs(y)+Ix(this.paint.get("line-translate"))}queryIntersectsFeature(c,a,d,y,C,N){if(c.queryGeometry.isAboveHorizon)return!1;const X=Qx(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),vt=c.pixelToTileUnitsFactor/2*Q1(this.paint.get("line-width").evaluate(a,d),this.paint.get("line-gap-width").evaluate(a,d)),Ht=this.paint.get("line-offset").evaluate(a,d);return Ht&&(y=function(Ui,qr){const Zs=[],nl=new Js(0,0);for(let ju=0;ju<Ui.length;ju++){const Ku=Ui[ju],ah=[];for(let Eh=0;Eh<Ku.length;Eh++){const zh=Ku[Eh-1],Yh=Ku[Eh],kh=Ku[Eh+1],Gh=Eh===0?nl:Yh.sub(zh)._unit()._perp(),nd=Eh===Ku.length-1?nl:kh.sub(Yh)._unit()._perp(),ed=Gh._add(nd)._unit();ed._mult(1/(ed.x*nd.x+ed.y*nd.y)),ah.push(ed._mult(qr)._add(Yh))}Zs.push(ah)}return Zs}(y,Ht*c.pixelToTileUnitsFactor)),function(Ui,qr,Zs){for(let nl=0;nl<qr.length;nl++){const ju=qr[nl];if(Ui.length>=3){for(let Ku=0;Ku<ju.length;Ku++)if(i1(Ui,ju[Ku]))return!0}if(c2(Ui,ju,Zs))return!0}return!1}(X,y,vt)}isTileClipped(){return!0}},symbol:qw,background:class extends j0{constructor(c){super(c,ZS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends j0{constructor(c){super(c,HS)}getProgramIds(){return["raster"]}},sky:class extends j0{constructor(c){super(c,WS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=T1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(c,a){if(this.paint.get("sky-type")==="atmosphere"){const y=this.paint.get("sky-atmosphere-sun"),C=!y,N=c.style.light,X=N.properties.get("position");return C&&N.properties.get("anchor")==="viewport"&&np("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),C?P2(X.azimuthal,90-X.polar,a):P2(y[0],90-y[1],a)}const d=this.paint.get("sky-gradient-center");return P2(d[0],90-d[1],a)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class Wb{constructor(a,d,y,C){this.context=a,this.format=y,this.texture=a.gl.createTexture(),this.update(d,C)}update(a,d,y){const{width:C,height:N}=a,{context:X}=this,{gl:vt}=X,{HTMLImageElement:Ht,HTMLCanvasElement:Ui,HTMLVideoElement:qr,ImageData:Zs,ImageBitmap:nl}=x;if(vt.bindTexture(vt.TEXTURE_2D,this.texture),X.pixelStoreUnpackFlipY.set(!1),X.pixelStoreUnpack.set(1),X.pixelStoreUnpackPremultiplyAlpha.set(this.format===vt.RGBA&&(!d||d.premultiply!==!1)),y||this.size&&this.size[0]===C&&this.size[1]===N){const{x:ju,y:Ku}=y||{x:0,y:0};a instanceof Ht||a instanceof Ui||a instanceof qr||a instanceof Zs||nl&&a instanceof nl?vt.texSubImage2D(vt.TEXTURE_2D,0,ju,Ku,vt.RGBA,vt.UNSIGNED_BYTE,a):vt.texSubImage2D(vt.TEXTURE_2D,0,ju,Ku,C,N,vt.RGBA,vt.UNSIGNED_BYTE,a.data)}else this.size=[C,N],a instanceof Ht||a instanceof Ui||a instanceof qr||a instanceof Zs||nl&&a instanceof nl?vt.texImage2D(vt.TEXTURE_2D,0,this.format,this.format,vt.UNSIGNED_BYTE,a):vt.texImage2D(vt.TEXTURE_2D,0,this.format,C,N,0,this.format,vt.UNSIGNED_BYTE,a.data);this.useMipmap=!!(d&&d.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&vt.generateMipmap(vt.TEXTURE_2D)}bind(a,d){const{context:y}=this,{gl:C}=y;C.bindTexture(C.TEXTURE_2D,this.texture),a!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,a),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,this.useMipmap?a===C.NEAREST?C.NEAREST_MIPMAP_NEAREST:C.LINEAR_MIPMAP_NEAREST:a),this.filter=a),d!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,d),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class KS{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QS{constructor(){this.tasks={},this.taskQueue=[],Cd(["process"],this),this.invoker=new KS(this.process),this.nextId=0}add(a,d){const y=this.nextId++,C=function({type:N,isSymbolTile:X,zoom:vt}){return vt=vt||0,N==="message"?0:N!=="maybePrepare"||X?N!=="parseTile"||X?N==="parseTile"&&X?300-vt:N==="maybePrepare"&&X?400-vt:500:200-vt:100-vt}(d);if(C===0){Qd();try{a()}finally{}return{cancel:()=>{}}}return this.tasks[y]={fn:a,metadata:d,priority:C,id:y},this.taskQueue.push(y),this.invoker.trigger(),{cancel:()=>{delete this.tasks[y]}}}process(){Qd();try{if(this.taskQueue=this.taskQueue.filter(y=>!!this.tasks[y]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const d=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!d)return;d.fn()}finally{}}pick(){let a=null,d=1/0;for(let C=0;C<this.taskQueue.length;C++){const N=this.tasks[this.taskQueue[C]];N.priority<d&&(d=N.priority,a=C)}if(a===null)return null;const y=this.taskQueue[a];return this.taskQueue.splice(a,1),y}remove(){this.invoker.remove()}}class EE{constructor(a){this._stringToNumber={},this._numberToString=[];for(let d=0;d<a.length;d++){const y=a[d];this._stringToNumber[y]=d,this._numberToString[d]=y}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}const JS=["tile","layer","source","sourceLayer","state"];class SE{constructor(a,d,y,C,N){this.type="Feature",this._vectorTileFeature=a,this._z=d,this._x=y,this._y=C,this.properties=a.properties,this.id=N}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(a.id=this.id);for(const d of JS)this[d]!==void 0&&(a[d]=this[d]);return a}}const yv=32,r1=33,ix=new Uint16Array(8184);for(let c=0;c<2046;c++){let a=c+2,d=0,y=0,C=0,N=0,X=0,vt=0;for(1&a?C=N=X=yv:d=y=vt=yv;(a>>=1)>1;){const Ui=d+C>>1,qr=y+N>>1;1&a?(C=d,N=y,d=X,y=vt):(d=C,y=N,C=X,N=vt),X=Ui,vt=qr}const Ht=4*c;ix[Ht+0]=d,ix[Ht+1]=y,ix[Ht+2]=C,ix[Ht+3]=N}const o1=new Uint16Array(2178),nx=new Uint8Array(1089),Zw=new Uint16Array(1089);function TE(c){return c===0?-.03125:c===32?.03125:0}var IE=Lp([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ME={type:2,extent:Hp,loadGeometry:()=>[[new Js(0,0),new Js(8193,0),new Js(8193,8193),new Js(0,8193),new Js(0,0)]]};class k2{constructor(a,d,y,C,N){this.tileID=a,this.uid=qd(),this.uses=0,this.tileSize=d,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=N,this.expiredRequestCount=0,this.state="loading",C&&C.transform&&(this.projection=C.transform.projection)}registerFadeDuration(a){const d=a+this.timeAdded;d<Jd.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=kx(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,d,y){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(C,N){const X={};if(!N)return X;for(const vt of C){const Ht=vt.layerIds.map(Ui=>N.getLayer(Ui)).filter(Boolean);if(Ht.length!==0){vt.layers=Ht,vt.stateDependentLayerIds&&(vt.stateDependentLayers=vt.stateDependentLayerIds.map(Ui=>Ht.filter(qr=>qr.id===Ui)[0]));for(const Ui of Ht)X[Ui.id]=vt}}return X}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const C in this.buckets){const N=this.buckets[C];if(N instanceof tx){if(this.hasSymbolBuckets=!0,!y)break;N.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const C in this.buckets){const N=this.buckets[C];if(N instanceof tx&&N.hasRTLText){this.hasRTLText=!0,Hh.isLoading()||Hh.isLoaded()||qh()!=="deferred"||$h();break}}this.queryPadding=0;for(const C in this.buckets){const N=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(C).queryRadius(N))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas)}else this.collisionBoxArray=new ub}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(a){return this.buckets[a.id]}upload(a){for(const y in this.buckets){const C=this.buckets[y];C.uploadPending()&&C.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Wb(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Wb(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Wb(a,this.lineAtlas.image,d.ALPHA),this.lineAtlas.uploaded=!0)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,y,C,N,X,vt,Ht){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:C,pixelPosMatrix:vt,transform:X,params:N,tileTransform:this.tileTransform},a,d,y):{}}querySourceFeatures(a,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const C=y.loadVTLayers(),N=d?d.sourceLayer:"",X=C._geojsonTileLayer||C[N];if(!X)return;const vt=v0(d&&d.filter),{z:Ht,x:Ui,y:qr}=this.tileID.canonical,Zs={z:Ht,x:Ui,y:qr};for(let nl=0;nl<X.length;nl++){const ju=X.feature(nl);if(vt.needGeometry){const Eh=Ov(ju,!0);if(!vt.filter(new ld(this.tileID.overscaledZ),Eh,this.tileID.canonical))continue}else if(!vt.filter(new ld(this.tileID.overscaledZ),ju))continue;const Ku=y.getId(ju,N),ah=new SE(ju,Ht,Ui,qr,Ku);ah.tile=Zs,a.push(ah)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const y=op(a.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const y=Date.now();let C=!1;if(this.expirationTime>y)C=!1;else if(d)if(this.expirationTime<d)C=!0;else{const N=this.expirationTime-d;N?this.expirationTime=y+Math.max(N,3e4):C=!0}else C=!0;C?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0||!d)return;const y=this.latestFeatureIndex.loadVTLayers(),C=d.style.listImages();for(const N in this.buckets){if(!d.style.hasLayer(N))continue;const X=this.buckets[N],vt=X.layers[0].sourceLayer||"_geojsonTileLayer",Ht=y[vt],Ui=a[vt];if(!Ht||!Ui||Object.keys(Ui).length===0)continue;if(X.update(Ui,Ht,C,this.imageAtlas&&this.imageAtlas.patternPositions||{}),X instanceof A1||X instanceof gp){const Zs=d.style._getSourceCache(X.layers[0].source);d._terrain&&d._terrain.enabled&&Zs&&X.programConfigurations.needsUpload&&d._terrain._clearRenderCacheForTile(Zs.id,this.tileID)}const qr=d&&d.style&&d.style.getLayer(N);qr&&(this.queryPadding=Math.max(this.queryPadding,qr.queryRadius(X)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Jd.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=Jd.now()+a}setTexture(a,d){const y=d.context,C=y.gl;this.texture=this.texture||d.getTileTexture(a.width),this.texture?this.texture.update(a,{useMipmap:!0}):(this.texture=new Wb(y,a,C.RGBA,{useMipmap:!0}),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE))}setDependencies(a,d){const y={};for(const C of d)y[C]=!0;this.dependencies[a]=y}hasDependency(a,d){for(const y of a){const C=this.dependencies[y];if(C){for(const N of d)if(C[N])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const y=Rv(ME,this.tileID.canonical,this.tileTransform)[0],C=new Fp,N=new I0;for(let X=0;X<y.length;X++){const{x:vt,y:Ht}=y[X];C.emplaceBack(vt,Ht),N.emplaceBack(X)}N.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(N),this._tileDebugBuffer=a.createVertexBuffer(C,_1.members),this._tileDebugSegments=Og.simpleSegment(0,0,C.length,N.length)}_makeTileBoundsBuffers(a,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const y=Rv(ME,this.tileID.canonical,this.tileTransform)[0];let C,N;if(this.isRaster){const X=function(vt,Ht){const Ui=kx(vt,Ht),qr=Math.pow(2,vt.z);for(let Eh=0;Eh<r1;Eh++)for(let zh=0;zh<r1;zh++){const Yh=e0((vt.x+(zh+TE(zh))/yv)/qr),kh=Cg((vt.y+(Eh+TE(Eh))/yv)/qr),Gh=Ht.project(Yh,kh),nd=Eh*r1+zh;o1[2*nd+0]=Math.round((Gh.x*Ui.scale-Ui.x)*Hp),o1[2*nd+1]=Math.round((Gh.y*Ui.scale-Ui.y)*Hp)}nx.fill(0),Zw.fill(0);for(let Eh=2045;Eh>=0;Eh--){const zh=4*Eh,Yh=ix[zh+0],kh=ix[zh+1],Gh=ix[zh+2],nd=ix[zh+3],ed=Yh+Gh>>1,Rd=kh+nd>>1,kd=ed+Rd-kh,Sf=Rd+Yh-ed,Zf=kh*r1+Yh,jd=nd*r1+Gh,Pf=Rd*r1+ed,Rf=Math.hypot((o1[2*Zf+0]+o1[2*jd+0])/2-o1[2*Pf+0],(o1[2*Zf+1]+o1[2*jd+1])/2-o1[2*Pf+1])>=16;if(nx[Pf]=nx[Pf]||(Rf?1:0),Eh<1022){const Uf=(kh+Sf>>1)*r1+(Yh+kd>>1),Xf=(nd+Sf>>1)*r1+(Gh+kd>>1);nx[Pf]=nx[Pf]||nx[Uf]||nx[Xf]}}const Zs=new Am,nl=new y_;let ju=0;function Ku(Eh,zh){const Yh=zh*r1+Eh;return Zw[Yh]===0&&(Zs.emplaceBack(o1[2*Yh+0],o1[2*Yh+1],Eh*Hp/yv,zh*Hp/yv),Zw[Yh]=++ju),Zw[Yh]-1}function ah(Eh,zh,Yh,kh,Gh,nd){const ed=Eh+Yh>>1,Rd=zh+kh>>1;if(Math.abs(Eh-Gh)+Math.abs(zh-nd)>1&&nx[Rd*r1+ed])ah(Gh,nd,Eh,zh,ed,Rd),ah(Yh,kh,Gh,nd,ed,Rd);else{const kd=Ku(Eh,zh),Sf=Ku(Yh,kh),Zf=Ku(Gh,nd);nl.emplaceBack(kd,Sf,Zf)}}return ah(0,0,yv,yv,yv,0),ah(yv,yv,0,0,0,yv),{vertices:Zs,indices:nl}}(this.tileID.canonical,d);C=X.vertices,N=X.indices}else{C=new Am,N=new y_;for(const{x:vt,y:Ht}of y)C.emplaceBack(vt,Ht,0,0);const X=W1(C.int16,void 0,4);for(let vt=0;vt<X.length;vt+=3)N.emplaceBack(X[vt],X[vt+1],X[vt+2])}this._tileBoundsBuffer=a.createVertexBuffer(C,IE.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(N),this._tileBoundsSegments=Og.simpleSegment(0,0,C.length,N.length)}_makeGlobeTileDebugBuffers(a,d){const y=d.projection;if(!y||y.name!=="globe"||d.freezeTileCoverage)return;const C=this.tileID.canonical,N=j1(Sb(C,d)),X=Lv(d.zoom);let vt;X>0&&(vt=fx(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,C,d,N,vt,X),this._makeGlobeTileDebugTextBuffer(a,C,d,N,vt,X)}_globePoint(a,d,y,C,N,X,vt){let Ht=G1(a,d,y);if(X){const Ui=1<<y.z,qr=P0(C.center.lng),Zs=X0(C.center.lat),nl=(y.x+.5)/Ui-qr;let ju=0;nl>.5?ju=-1:nl<-.5&&(ju=1);let Ku=(a/Hp+y.x)/Ui+ju,ah=(d/Hp+y.y)/Ui;Ku=(Ku-qr)*C._pixelsPerMercatorPixel+qr,ah=(ah-Zs)*C._pixelsPerMercatorPixel+Zs;const Eh=[Ku*C.worldSize,ah*C.worldSize,0];Mg(Eh,Eh,X),Ht=v1(Ht,Eh,vt)}return Mg(Ht,Ht,N)}_makeGlobeTileDebugBorderBuffer(a,d,y,C,N,X){const vt=new Fp,Ht=new I0,Ui=new km,qr=(nl,ju,Ku,ah,Eh)=>{const zh=(Ku-nl)/(Eh-1),Yh=(ah-ju)/(Eh-1),kh=vt.length;for(let Gh=0;Gh<Eh;Gh++){const nd=nl+Gh*zh,ed=ju+Gh*Yh;vt.emplaceBack(nd,ed);const Rd=this._globePoint(nd,ed,d,y,C,N,X);Ui.emplaceBack(Rd[0],Rd[1],Rd[2]),Ht.emplaceBack(kh+Gh)}},Zs=Hp;qr(0,0,Zs,0,16),qr(Zs,0,Zs,Zs,16),qr(Zs,Zs,0,Zs,16),qr(0,Zs,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(Ht),this._tileDebugBuffer=a.createVertexBuffer(vt,_1.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(Ui,bb.members),this._tileDebugSegments=Og.simpleSegment(0,0,vt.length,Ht.length)}_makeGlobeTileDebugTextBuffer(a,d,y,C,N,X){const vt=new Fp,Ht=new y_,Ui=new km,qr=25;Ht.reserve(32),vt.reserve(qr),Ui.reserve(qr);const Zs=(nl,ju)=>qr*nl+ju;for(let nl=0;nl<qr;nl++){const ju=2048*nl;for(let Ku=0;Ku<qr;Ku++){const ah=2048*Ku;vt.emplaceBack(ah,ju);const Eh=this._globePoint(ah,ju,d,y,C,N,X);Ui.emplaceBack(Eh[0],Eh[1],Eh[2])}}for(let nl=0;nl<4;nl++)for(let ju=0;ju<4;ju++){const Ku=Zs(nl,ju),ah=Zs(nl,ju+1),Eh=Zs(nl+1,ju),zh=Zs(nl+1,ju+1);Ht.emplaceBack(Ku,ah,Eh),Ht.emplaceBack(Eh,ah,zh)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(Ht),this._tileDebugTextBuffer=a.createVertexBuffer(vt,_1.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(Ui,bb.members),this._tileDebugTextSegments=Og.simpleSegment(0,0,qr,32)}}class eT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,y){const C=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][C]=this.stateChanges[a][C]||{},md(this.stateChanges[a][C],y),this.deletedStates[a]===null){this.deletedStates[a]={};for(const N in this.state[a])N!==C&&(this.deletedStates[a][N]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][C]===null){this.deletedStates[a][C]={};for(const N in this.state[a][C])y[N]||(this.deletedStates[a][C][N]=null)}else for(const N in y)this.deletedStates[a]&&this.deletedStates[a][C]&&this.deletedStates[a][C][N]===null&&delete this.deletedStates[a][C][N]}removeFeatureState(a,d,y){if(this.deletedStates[a]===null)return;const C=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},y&&d!==void 0)this.deletedStates[a][C]!==null&&(this.deletedStates[a][C]=this.deletedStates[a][C]||{},this.deletedStates[a][C][y]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][C])for(y in this.deletedStates[a][C]={},this.stateChanges[a][C])this.deletedStates[a][C][y]=null;else this.deletedStates[a][C]=null;else this.deletedStates[a]=null}getState(a,d){const y=String(d),C=md({},(this.state[a]||{})[y],(this.stateChanges[a]||{})[y]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const N=this.deletedStates[a][d];if(N===null)return{};for(const X in N)delete C[X]}return C}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const y={};for(const C in this.stateChanges){this.state[C]=this.state[C]||{};const N={};for(const X in this.stateChanges[C])this.state[C][X]||(this.state[C][X]={}),md(this.state[C][X],this.stateChanges[C][X]),N[X]=this.state[C][X];y[C]=N}for(const C in this.deletedStates){this.state[C]=this.state[C]||{};const N={};if(this.deletedStates[C]===null)for(const X in this.state[C])N[X]={},this.state[C][X]={};else for(const X in this.deletedStates[C]){if(this.deletedStates[C][X]===null)this.state[C][X]={};else if(this.state[C][X])for(const vt of Object.keys(this.deletedStates[C][X]))delete this.state[C][X][vt];N[X]=this.state[C][X]}y[C]=y[C]||{},md(y[C],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const C in a)a[C].setFeatureState(y,d)}}class CE{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,d){const y=this.toIdx(a,d);return{min:this.minimums[y],max:this.maximums[y]}}isLeaf(a,d){return this.leaves[this.toIdx(a,d)]}toIdx(a,d){return d*this.size+a}}function AE(c,a,d,y){let C=0,N=Number.MAX_VALUE;for(let X=0;X<3;X++)if(Math.abs(y[X])<1e-15){if(d[X]<c[X]||d[X]>a[X])return null}else{const vt=1/y[X];let Ht=(c[X]-d[X])*vt,Ui=(a[X]-d[X])*vt;if(Ht>Ui){const qr=Ht;Ht=Ui,Ui=qr}if(Ht>C&&(C=Ht),Ui<N&&(N=Ui),C>N)return null}return C}function PE(c,a,d,y,C,N,X,vt,Ht,Ui,qr){const Zs=y-c,nl=C-a,ju=N-d,Ku=X-c,ah=vt-a,Eh=Ht-d,zh=qr[1]*Eh-qr[2]*ah,Yh=qr[2]*Ku-qr[0]*Eh,kh=qr[0]*ah-qr[1]*Ku,Gh=Zs*zh+nl*Yh+ju*kh;if(Math.abs(Gh)<1e-15)return null;const nd=1/Gh,ed=Ui[0]-c,Rd=Ui[1]-a,kd=Ui[2]-d,Sf=(ed*zh+Rd*Yh+kd*kh)*nd;if(Sf<0||Sf>1)return null;const Zf=Rd*ju-kd*nl,jd=kd*Zs-ed*ju,Pf=ed*nl-Rd*Zs,Rf=(qr[0]*Zf+qr[1]*jd+qr[2]*Pf)*nd;return Rf<0||Sf+Rf>1?null:(Ku*Zf+ah*jd+Eh*Pf)*nd}function kE(c,a,d){return(c-a)/(d-a)}function DE(c,a,d,y,C,N,X,vt,Ht){const Ui=1<<d,qr=N-y,Zs=X-C,nl=(c+1)/Ui*qr+y,ju=(a+0)/Ui*Zs+C,Ku=(a+1)/Ui*Zs+C;vt[0]=(c+0)/Ui*qr+y,vt[1]=ju,Ht[0]=nl,Ht[1]=Ku}class LE{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const d=function(N){const X=Math.ceil(Math.log2(N.dim/8)),vt=[];let Ht=Math.ceil(Math.pow(2,X));const Ui=1/Ht,qr=(ju,Ku,ah,Eh,zh)=>{const Yh=Eh?1:0,kh=(ju+1)*ah-Yh,Gh=Ku*ah,nd=(Ku+1)*ah-Yh;zh[0]=ju*ah,zh[1]=Gh,zh[2]=kh,zh[3]=nd};let Zs=new CE(Ht);const nl=[];for(let ju=0;ju<Ht*Ht;ju++){qr(ju%Ht,Math.floor(ju/Ht),Ui,!1,nl);const Ku=rx(nl[0],nl[1],N),ah=rx(nl[2],nl[1],N),Eh=rx(nl[2],nl[3],N),zh=rx(nl[0],nl[3],N);Zs.minimums.push(Math.min(Ku,ah,Eh,zh)),Zs.maximums.push(Math.max(Ku,ah,Eh,zh)),Zs.leaves.push(1)}for(vt.push(Zs),Ht/=2;Ht>=1;Ht/=2){const ju=vt[vt.length-1];Zs=new CE(Ht);for(let Ku=0;Ku<Ht*Ht;Ku++){qr(Ku%Ht,Math.floor(Ku/Ht),2,!0,nl);const ah=ju.getElevation(nl[0],nl[1]),Eh=ju.getElevation(nl[2],nl[1]),zh=ju.getElevation(nl[2],nl[3]),Yh=ju.getElevation(nl[0],nl[3]),kh=ju.isLeaf(nl[0],nl[1]),Gh=ju.isLeaf(nl[2],nl[1]),nd=ju.isLeaf(nl[2],nl[3]),ed=ju.isLeaf(nl[0],nl[3]),Rd=Math.min(ah.min,Eh.min,zh.min,Yh.min),kd=Math.max(ah.max,Eh.max,zh.max,Yh.max),Sf=kh&&Gh&&nd&&ed;Zs.maximums.push(kd),Zs.minimums.push(Rd),Zs.leaves.push(kd-Rd<=5&&Sf?1:0)}vt.push(Zs)}return vt}(this.dem),y=d.length-1,C=d[y];this._addNode(C.minimums[0],C.maximums[0],C.leaves[0]),this._construct(d,0,0,y,0)}raycastRoot(a,d,y,C,N,X,vt=1){return AE([a,d,-100],[y,C,this.maximums[0]*vt],N,X)}raycast(a,d,y,C,N,X,vt=1){if(!this.nodeCount)return null;const Ht=this.raycastRoot(a,d,y,C,N,X,vt);if(Ht==null)return null;const Ui=[],qr=[],Zs=[],nl=[],ju=[{idx:0,t:Ht,nodex:0,nodey:0,depth:0}];for(;ju.length>0;){const{idx:Ku,t:ah,nodex:Eh,nodey:zh,depth:Yh}=ju.pop();if(this.leaves[Ku]){DE(Eh,zh,Yh,a,d,y,C,Zs,nl);const Gh=1<<Yh,nd=(Eh+0)/Gh,ed=(Eh+1)/Gh,Rd=(zh+0)/Gh,kd=(zh+1)/Gh,Sf=rx(nd,Rd,this.dem)*vt,Zf=rx(ed,Rd,this.dem)*vt,jd=rx(ed,kd,this.dem)*vt,Pf=rx(nd,kd,this.dem)*vt,Rf=PE(Zs[0],Zs[1],Sf,nl[0],Zs[1],Zf,nl[0],nl[1],jd,N,X),Uf=PE(nl[0],nl[1],jd,Zs[0],nl[1],Pf,Zs[0],Zs[1],Sf,N,X),Xf=Math.min(Rf!==null?Rf:Number.MAX_VALUE,Uf!==null?Uf:Number.MAX_VALUE);if(Xf!==Number.MAX_VALUE)return Xf;{const Hd=U1([],N,X,ah);if(RE(Sf,Zf,Pf,jd,kE(Hd[0],Zs[0],nl[0]),kE(Hd[1],Zs[1],nl[1]))>=Hd[2])return ah}continue}let kh=0;for(let Gh=0;Gh<this._siblingOffset.length;Gh++){DE((Eh<<1)+this._siblingOffset[Gh][0],(zh<<1)+this._siblingOffset[Gh][1],Yh+1,a,d,y,C,Zs,nl),Zs[2]=-100,nl[2]=this.maximums[this.childOffsets[Ku]+Gh]*vt;const nd=AE(Zs,nl,N,X);if(nd!=null){const ed=nd;Ui[Gh]=ed;let Rd=!1;for(let kd=0;kd<kh&&!Rd;kd++)ed>=Ui[qr[kd]]&&(qr.splice(kd,0,Gh),Rd=!0);Rd||(qr[kh]=Gh),kh++}}for(let Gh=0;Gh<kh;Gh++){const nd=qr[Gh];ju.push({idx:this.childOffsets[Ku]+nd,t:Ui[nd],nodex:(Eh<<1)+this._siblingOffset[nd][0],nodey:(zh<<1)+this._siblingOffset[nd][1],depth:Yh+1})}}return null}_addNode(a,d,y){return this.minimums.push(a),this.maximums.push(d),this.leaves.push(y),this.childOffsets.push(0),this.nodeCount++}_construct(a,d,y,C,N){if(a[C].isLeaf(d,y)===1)return;this.childOffsets[N]||(this.childOffsets[N]=this.nodeCount);const X=C-1,vt=a[X];let Ht=0,Ui=0;for(let qr=0;qr<this._siblingOffset.length;qr++){const Zs=2*d+this._siblingOffset[qr][0],nl=2*y+this._siblingOffset[qr][1],ju=vt.getElevation(Zs,nl),Ku=vt.isLeaf(Zs,nl),ah=this._addNode(ju.min,ju.max,Ku);Ku&&(Ht|=1<<qr),Ui||(Ui=ah)}for(let qr=0;qr<this._siblingOffset.length;qr++)Ht&1<<qr||this._construct(a,2*d+this._siblingOffset[qr][0],2*y+this._siblingOffset[qr][1],X,Ui+qr)}}function RE(c,a,d,y,C,N){return Kp(Kp(c,d,N),Kp(a,y,N),C)}function rx(c,a,d){const y=d.dim,C=Uh(c*y-.5,0,y-1),N=Uh(a*y-.5,0,y-1),X=Math.floor(C),vt=Math.floor(N),Ht=Math.min(X+1,y-1),Ui=Math.min(vt+1,y-1);return RE(d.get(X,vt),d.get(Ht,vt),d.get(X,Ui),d.get(Ht,Ui),C-X,N-vt)}const OE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function tT(c,a,d){return(256*c*256+256*a+d)/10-1e4}function iT(c,a,d){return 256*c+a+d/256-32768}class Hw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,d,y,C=!1,N=!1){if(this.uid=a,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(y&&y!=="mapbox"&&y!=="terrarium")return np(`"${y}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=d.height;const X=this.dim=d.height-2,vt=new Uint32Array(d.data.buffer);if(this.pixels=new Uint8Array(d.data.buffer),this.encoding=y||"mapbox",this.borderReady=C,!C){for(let Ht=0;Ht<X;Ht++)vt[this._idx(-1,Ht)]=vt[this._idx(0,Ht)],vt[this._idx(X,Ht)]=vt[this._idx(X-1,Ht)],vt[this._idx(Ht,-1)]=vt[this._idx(Ht,0)],vt[this._idx(Ht,X)]=vt[this._idx(Ht,X-1)];vt[this._idx(-1,-1)]=vt[this._idx(0,0)],vt[this._idx(X,-1)]=vt[this._idx(X-1,0)],vt[this._idx(-1,X)]=vt[this._idx(0,X-1)],vt[this._idx(X,X)]=vt[this._idx(X-1,X-1)],N&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new LE(this)}get(a,d,y=!1){y&&(a=Uh(a,-1,this.dim),d=Uh(d,-1,this.dim));const C=4*this._idx(a,d);return(this.encoding==="terrarium"?iT:tT)(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}static getUnpackVector(a){return OE[a]}get unpackVector(){return OE[this.encoding]}_idx(a,d){if(a<-1||a>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(a+1)}static pack(a,d){const y=[0,0,0,0],C=Hw.getUnpackVector(d);let N=Math.floor((a+C[3])/C[2]);return y[2]=N%256,N=Math.floor(N/256),y[1]=N%256,N=Math.floor(N/256),y[0]=N,y}getPixels(){return new Q_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,d,y){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let C=d*this.dim,N=d*this.dim+this.dim,X=y*this.dim,vt=y*this.dim+this.dim;switch(d){case-1:C=N-1;break;case 1:N=C+1}switch(y){case-1:X=vt-1;break;case 1:vt=X+1}const Ht=-d*this.dim,Ui=-y*this.dim;for(let qr=X;qr<vt;qr++)for(let Zs=C;Zs<N;Zs++){const nl=4*this._idx(Zs,qr),ju=4*this._idx(Zs+Ht,qr+Ui);this.pixels[nl+0]=a.pixels[ju+0],this.pixels[nl+1]=a.pixels[ju+1],this.pixels[nl+2]=a.pixels[ju+2],this.pixels[nl+3]=a.pixels[ju+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ip(Hw,"DEMData"),Ip(LE,"DemMinMaxQuadTree",{omit:["dem"]});class nT{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,y){const C=a.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);const N={value:d,timeout:void 0};if(y!==void 0&&(N.timeout=setTimeout(()=>{this.remove(a,N)},y)),this.data[C].push(N),this.order.push(C),this.order.length>this.max){const X=this._getAndRemoveByKey(this.order[0]);X&&this.onRemove(X)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const y=a.wrapped().key,C=d===void 0?0:this.data[y].indexOf(d),N=this.data[y][C];return this.data[y].splice(C,1),N.timeout&&clearTimeout(N.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(N.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const y in this.data)for(const C of this.data[y])a(C.value)||d.push(C);for(const y of d)this.remove(y.value.tileID,y)}}class lb{constructor(a,d,y){this.func=a,this.mask=d,this.range=y}}lb.ReadOnly=!1,lb.ReadWrite=!0,lb.disabled=new lb(519,lb.ReadOnly,[0,1]);const D2=7680;class L2{constructor(a,d,y,C,N,X){this.test=a,this.ref=d,this.mask=y,this.fail=C,this.depthFail=N,this.pass=X}}L2.disabled=new L2({func:519,mask:0},0,0,D2,D2,D2);class s1{constructor(a,d,y){this.blendFunction=a,this.blendColor=d,this.mask=y}}s1.Replace=[1,0],s1.disabled=new s1(s1.Replace,Np.transparent,[!1,!1,!1,!1]),s1.unblended=new s1(s1.Replace,Np.transparent,[!0,!0,!0,!0]),s1.alphaBlended=new s1([1,771],Np.transparent,[!0,!0,!0,!0]);const R2=1029,O2=2305;class zv{constructor(a,d,y){this.enable=a,this.mode=d,this.frontFace=y}}zv.disabled=new zv(!1,R2,O2),zv.backCCW=new zv(!0,R2,O2),zv.backCW=new zv(!0,R2,2304),zv.frontCW=new zv(!0,1028,2304),zv.frontCCW=new zv(!0,1028,O2);class Dx extends om{constructor(a,d,y){super(),this.id=a,this._onlySymbols=y,d.on("data",C=>{C.dataType==="source"&&C.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new nT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new eT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,d){return a.isSymbolTile=this._onlySymbols,this._source.loadTile(a,d)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a,()=>{})}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(a),y.prepare(this.map.style.imageManager)}}getIds(){return Af(this._tiles).map(a=>a.tileID).sort(BE).map(a=>a.key)}getRenderableIds(a){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,a)&&d.push(this._tiles[y]);return a?d.sort((y,C)=>{const N=y.tileID,X=C.tileID,vt=new Js(N.canonical.x,N.canonical.y)._rotate(this.transform.angle),Ht=new Js(X.canonical.x,X.canonical.y)._rotate(this.transform.angle);return N.overscaledZ-X.overscaledZ||Ht.y-vt.y||Ht.x-vt.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(BE).map(y=>y.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,d){const y=this._tiles[a];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,a,d)))}_tileLoaded(a,d,y,C){if(C)if(a.state="errored",C.status!==404)this._source.fire(new Vp(C,{tile:a}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const N=this.map.painter.terrain;this.update(this.transform,N.getScaledDemTileSize(),!0),N.resetTileLookupCache(this.id)}else this.update(this.transform);else a.timeAdded=Jd.now(),y==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new mp("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const d=this.getRenderableIds();for(let C=0;C<d.length;C++){const N=d[C];if(a.neighboringTiles&&a.neighboringTiles[N]){const X=this.getTileByID(N);y(a,X),y(X,a)}}function y(C,N){if(!C.dem||C.dem.borderReady)return;C.needsHillshadePrepare=!0,C.needsDEMTextureUpload=!0;let X=N.tileID.canonical.x-C.tileID.canonical.x;const vt=N.tileID.canonical.y-C.tileID.canonical.y,Ht=Math.pow(2,C.tileID.canonical.z),Ui=N.tileID.key;X===0&&vt===0||Math.abs(vt)>1||(Math.abs(X)>1&&(Math.abs(X+Ht)===1?X+=Ht:Math.abs(X-Ht)===1&&(X-=Ht)),N.dem&&C.dem&&(C.dem.backfillBorder(N.dem,X,vt),C.neighboringTiles&&C.neighboringTiles[Ui]&&(C.neighboringTiles[Ui].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,y,C){for(const N in this._tiles){let X=this._tiles[N];if(C[N]||!X.hasData()||X.tileID.overscaledZ<=d||X.tileID.overscaledZ>y)continue;let vt=X.tileID;for(;X&&X.tileID.overscaledZ>d+1;){const Ui=X.tileID.scaledTo(X.tileID.overscaledZ-1);X=this._tiles[Ui.key],X&&X.hasData()&&(vt=Ui)}let Ht=vt;for(;Ht.overscaledZ>d;)if(Ht=Ht.scaledTo(Ht.overscaledZ-1),a[Ht.key]){C[vt.key]=vt;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const y=this._loadedParentTiles[a.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=a.overscaledZ-1;y>=d;y--){const C=a.scaledTo(y),N=this._getLoadedTile(C);if(N)return N}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,d){d=d||this._source.tileSize;const y=Math.ceil(a.width/d)+1,C=Math.ceil(a.height/d)+1,N=Math.floor(y*C*5),X=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,N):N,vt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,X):X;this._cache.setMaxSize(vt)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const y={};for(const C in this._tiles){const N=this._tiles[C];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+d),y[N.tileID.key]=N}this._tiles=y;for(const C in this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(const C in this._tiles)this._setTileReloadTimer(+C,this._tiles[C])}}update(a,d,y){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;let C;this.updateCacheSize(a,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?C=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(vt=>new T_(vt.canonical.z,vt.wrap,vt.canonical.z,vt.canonical.x,vt.canonical.y)):(C=a.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(C=C.filter(vt=>this._source.hasTile(vt)))):C=[];const N=this._updateRetainedTiles(C);if(zE(this._source.type)&&C.length!==0){const vt={},Ht={},Ui=Object.keys(N);for(const Zs of Ui){const nl=N[Zs],ju=this._tiles[Zs];if(!ju||ju.fadeEndTime&&ju.fadeEndTime<=Jd.now())continue;const Ku=this.findLoadedParent(nl,Math.max(nl.overscaledZ-Dx.maxOverzooming,this._source.minzoom));Ku&&(this._addTile(Ku.tileID),vt[Ku.tileID.key]=Ku.tileID),Ht[Zs]=nl}const qr=C[C.length-1].overscaledZ;for(const Zs in this._tiles){const nl=this._tiles[Zs];if(N[Zs]||!nl.hasData())continue;let ju=nl.tileID;for(;ju.overscaledZ>qr;){ju=ju.scaledTo(ju.overscaledZ-1);const Ku=this._tiles[ju.key];if(Ku&&Ku.hasData()&&Ht[ju.key]){N[Zs]=nl.tileID;break}}}for(const Zs in vt)N[Zs]||(this._coveredTiles[Zs]=!0,N[Zs]=vt[Zs])}for(const vt in N)this._tiles[vt].clearFadeHold();const X=function(vt,Ht){const Ui=[];for(const qr in vt)qr in Ht||Ui.push(qr);return Ui}(this._tiles,N);for(const vt of X){const Ht=this._tiles[vt];Ht.hasSymbolBuckets&&!Ht.holdingForFade()?Ht.setHoldDuration(this.map._fadeDuration):Ht.hasSymbolBuckets&&!Ht.symbolFadeFinished()||this._removeTile(+vt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const d={};if(a.length===0)return d;const y={},C=a.reduce((Ui,qr)=>Math.min(Ui,qr.overscaledZ),1/0),N=a[0].overscaledZ,X=Math.max(N-Dx.maxOverzooming,this._source.minzoom),vt=Math.max(N+Dx.maxUnderzooming,this._source.minzoom),Ht={};for(const Ui of a){const qr=this._addTile(Ui);d[Ui.key]=Ui,qr.hasData()||C<this._source.maxzoom&&(Ht[Ui.key]=Ui)}this._retainLoadedChildren(Ht,C,vt,d);for(const Ui of a){let qr=this._tiles[Ui.key];if(qr.hasData())continue;if(Ui.canonical.z>=this._source.maxzoom){const nl=Ui.children(this._source.maxzoom)[0],ju=this.getTile(nl);if(ju&&ju.hasData()){d[nl.key]=nl;continue}}else{const nl=Ui.children(this._source.maxzoom);if(d[nl[0].key]&&d[nl[1].key]&&d[nl[2].key]&&d[nl[3].key])continue}let Zs=qr.wasRequested();for(let nl=Ui.overscaledZ-1;nl>=X;--nl){const ju=Ui.scaledTo(nl);if(y[ju.key]||(y[ju.key]=!0,qr=this.getTile(ju),!qr&&Zs&&(qr=this._addTile(ju)),qr&&(d[ju.key]=ju,Zs=qr.wasRequested(),qr.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let y,C=this._tiles[a].tileID;for(;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){y=this._loadedParentTiles[C.key];break}d.push(C.key);const N=C.scaledTo(C.overscaledZ-1);if(y=this._getLoadedTile(N),y)break;C=N}for(const N of d)this._loadedParentTiles[N]=y}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const y=!!d;if(!y){const C=this.map?this.map.painter:null;d=new k2(a,this._source.tileSize*a.overscaleFactor(),this.transform.tileZoom,C,this._isRaster),this._loadTile(d,this._tileLoaded.bind(this,d,a.key,d.state))}return d?(d.uses++,this._tiles[a.key]=d,y||this._source.fire(new mp("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const y=d.getExpiryTimeout();y&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},y))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,d,y){const C=[],N=this.transform;if(!N)return C;const X=N.projection.name==="globe",vt=P0(N.center.lng);for(const Ht in this._tiles){const Ui=this._tiles[Ht];if(y&&Ui.clearQueryDebugViz(),Ui.holdingForFade())continue;let qr;if(X){const Zs=Ui.tileID.canonical;if(Zs.z===0){const nl=[Math.abs(Uh(vt,...Yb(Zs,-1))-vt),Math.abs(Uh(vt,...Yb(Zs,1))-vt)];qr=[0,2*nl.indexOf(Math.min(...nl))-1]}else{const nl=[Math.abs(Uh(vt,...Yb(Zs,-1))-vt),Math.abs(Uh(vt,...Yb(Zs,0))-vt),Math.abs(Uh(vt,...Yb(Zs,1))-vt)];qr=[nl.indexOf(Math.min(...nl))-1]}}else qr=[0];for(const Zs of qr){const nl=a.containsTile(Ui,N,d,Zs);nl&&C.push(nl)}}return C}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(y=>this._tiles[y].tileID);for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(zE(this._source.type))for(const a in this._tiles){const d=this._tiles[a];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=Jd.now())return!0}return!1}setFeatureState(a,d,y){this._state.updateState(a=a||"_geojsonTileLayer",d,y)}removeFeatureState(a,d,y){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,y)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,y){const C=this._tiles[a];C&&C.setDependencies(d,y)}reloadTilesForDependencies(a,d){for(const y in this._tiles)this._tiles[y].hasDependency(a,d)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(a,d))}_preloadTiles(a,d){const y=new Map,C=Array.isArray(a)?a:[a],N=this.map.painter.terrain,X=this.usedForTerrain&&N?N.getScaledDemTileSize():this._source.tileSize;for(const vt of C){const Ht=vt.coveringTiles({tileSize:X,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Ui of Ht)y.set(Ui.key,Ui);this.usedForTerrain&&vt.updateElevation(!1)}yf(Array.from(y.values()),(vt,Ht)=>{const Ui=new k2(vt,this._source.tileSize*vt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Ui,qr=>{this._source.type==="raster-dem"&&Ui.dem&&this._backfillDEM(Ui),Ht(qr,Ui)})},d)}}function BE(c,a){const d=Math.abs(2*c.wrap)-+(c.wrap<0),y=Math.abs(2*a.wrap)-+(a.wrap<0);return c.overscaledZ-a.overscaledZ||y-d||a.canonical.y-c.canonical.y||a.canonical.x-c.canonical.x}function zE(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Yb(c,a){const d=1<<c.z;return[c.x/d+a,(c.x+1)/d+a]}Dx.maxOverzooming=10,Dx.maxUnderzooming=3;class Xw{constructor(a,d,y){this._demTile=a,this._dem=this._demTile.dem,this._scale=d,this._offset=y}static create(a,d,y){const C=y||a.findDEMTileFor(d);if(!C||!C.dem)return;const N=C.dem,X=C.tileID,vt=1<<d.canonical.z-X.canonical.z;return new Xw(C,C.tileSize/Hp/vt,[(d.canonical.x/vt-X.canonical.x)*N.dim,(d.canonical.y/vt-X.canonical.y)*N.dim])}tileCoordToPixel(a,d){const y=d*this._scale+this._offset[1],C=Math.floor(a*this._scale+this._offset[0]),N=Math.floor(y);return new Js(C,N)}getElevationAt(a,d,y,C){const N=a*this._scale+this._offset[0],X=d*this._scale+this._offset[1],vt=Math.floor(N),Ht=Math.floor(X),Ui=this._dem;return C=!!C,y?Kp(Kp(Ui.get(vt,Ht,C),Ui.get(vt,Ht+1,C),X-Ht),Kp(Ui.get(vt+1,Ht,C),Ui.get(vt+1,Ht+1,C),X-Ht),N-vt):Ui.get(vt,Ht,C)}getElevationAtPixel(a,d,y){return this._dem.get(a,d,!!y)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Jy(1,a)*this._dem.stride}}class NE{constructor(a,d){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Ty(Hp,16,0),this.featureIndexArray=new fb,this.promoteId=d}insert(a,d,y,C,N,X=0){const vt=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(y,C,N,X);const Ht=this.grid;for(let Ui=0;Ui<d.length;Ui++){const qr=d[Ui],Zs=[1/0,1/0,-1/0,-1/0];for(let nl=0;nl<qr.length;nl++){const ju=qr[nl];Zs[0]=Math.min(Zs[0],ju.x),Zs[1]=Math.min(Zs[1],ju.y),Zs[2]=Math.max(Zs[2],ju.x),Zs[3]=Math.max(Zs[3],ju.y)}Zs[0]<Hp&&Zs[1]<Hp&&Zs[2]>=0&&Zs[3]>=0&&Ht.insert(vt,Zs[0],Zs[1],Zs[2],Zs[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new z_(new Vb(this.rawTileData)).layers,this.sourceLayerCoder=new EE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,d,y,C){this.loadVTLayers();const N=a.params||{},X=v0(N.filter),vt=a.tileResult,Ht=a.transform,Ui=vt.bufferedTilespaceBounds,qr=this.grid.query(Ui.min.x,Ui.min.y,Ui.max.x,Ui.max.y,(Ku,ah,Eh,zh)=>Db(vt.bufferedTilespaceGeometry,Ku,ah,Eh,zh));qr.sort(rT);let Zs=null;Ht.elevation&&qr.length>0&&(Zs=Xw.create(Ht.elevation,this.tileID));const nl={};let ju;for(let Ku=0;Ku<qr.length;Ku++){const ah=qr[Ku];if(ah===ju)continue;ju=ah;const Eh=this.featureIndexArray.get(ah);let zh=null;this.loadMatchingFeature(nl,Eh,X,N.layers,N.availableImages,d,y,C,(Yh,kh,Gh,nd=0)=>(zh||(zh=Rv(Yh,this.tileID.canonical,a.tileTransform)),kh.queryIntersectsFeature(vt,Yh,Gh,zh,this.z,a.transform,a.pixelPosMatrix,Zs,nd)))}return nl}loadMatchingFeature(a,d,y,C,N,X,vt,Ht,Ui){const{featureIndex:qr,bucketIndex:Zs,sourceLayerIndex:nl,layoutVertexArrayOffset:ju}=d,Ku=this.bucketLayerIDs[Zs];if(C&&!function(Yh,kh){for(let Gh=0;Gh<Yh.length;Gh++)if(kh.indexOf(Yh[Gh])>=0)return!0;return!1}(C,Ku))return;const ah=this.sourceLayerCoder.decode(nl),Eh=this.vtLayers[ah].feature(qr);if(y.needGeometry){const Yh=Ov(Eh,!0);if(!y.filter(new ld(this.tileID.overscaledZ),Yh,this.tileID.canonical))return}else if(!y.filter(new ld(this.tileID.overscaledZ),Eh))return;const zh=this.getId(Eh,ah);for(let Yh=0;Yh<Ku.length;Yh++){const kh=Ku[Yh];if(C&&C.indexOf(kh)<0)continue;const Gh=X[kh];if(!Gh)continue;let nd={};zh!==void 0&&Ht&&(nd=Ht.getState(Gh.sourceLayer||"_geojsonTileLayer",zh));const ed=md({},vt[kh]);ed.paint=FE(ed.paint,Gh.paint,Eh,nd,N),ed.layout=FE(ed.layout,Gh.layout,Eh,nd,N);const Rd=!Ui||Ui(Eh,Gh,nd,ju);if(!Rd)continue;const kd=new SE(Eh,this.z,this.x,this.y,zh);kd.layer=ed;let Sf=a[kh];Sf===void 0&&(Sf=a[kh]=[]),Sf.push({featureIndex:qr,feature:kd,intersectionZ:Rd})}}lookupSymbolFeatures(a,d,y,C,N,X,vt,Ht){const Ui={};this.loadVTLayers();const qr=v0(N);for(const Zs of a)this.loadMatchingFeature(Ui,{bucketIndex:y,sourceLayerIndex:C,featureIndex:Zs,layoutVertexArrayOffset:0},qr,X,vt,Ht,d);return Ui}loadFeature(a){const{featureIndex:d,sourceLayerIndex:y}=a;this.loadVTLayers();const C=this.sourceLayerCoder.decode(y),N=this.vtFeatures[C];if(N[d])return N[d];const X=this.vtLayers[C].feature(d);return N[d]=X,X}hasLayer(a){for(const d of this.bucketLayerIDs)for(const y of d)if(a===y)return!0;return!1}getId(a,d){let y=a.id;if(this.promoteId){const C=typeof this.promoteId=="string"?this.promoteId:this.promoteId[d];C!=null&&(y=a.properties[C]),typeof y=="boolean"&&(y=Number(y))}return y}}function FE(c,a,d,y,C){return bf(c,(N,X)=>{const vt=a instanceof Md?a.get(X):null;return vt&&vt.evaluate?vt.evaluate(d,y,C):vt})}function rT(c,a){return a-c}Ip(NE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $E{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.image=new Bv({width:a,height:d}),this.positions={},this.uploaded=!1}getDash(a,d){const y=this.getKey(a,d);return this.positions[y]}trim(){const a=this.width,d=this.height=Td(this.nextRow);this.image.resize({width:a,height:d})}getKey(a,d){return a.join(",")+d}getDashRanges(a,d,y){const C=[];let N=a.length%2==1?-a[a.length-1]*y:0,X=a[0]*y,vt=!0;C.push({left:N,right:X,isDash:vt,zeroLength:a[0]===0});let Ht=a[0];for(let Ui=1;Ui<a.length;Ui++){vt=!vt;const qr=a[Ui];N=Ht*y,Ht+=qr,X=Ht*y,C.push({left:N,right:X,isDash:vt,zeroLength:qr===0})}return C}addRoundDash(a,d,y){const C=d/2;for(let N=-y;N<=y;N++){const X=this.width*(this.nextRow+y+N);let vt=0,Ht=a[vt];for(let Ui=0;Ui<this.width;Ui++){Ui/Ht.right>1&&(Ht=a[++vt]);const qr=Math.abs(Ui-Ht.left),Zs=Math.abs(Ui-Ht.right),nl=Math.min(qr,Zs);let ju;const Ku=N/y*(C+1);if(Ht.isDash){const ah=C-Math.abs(Ku);ju=Math.sqrt(nl*nl+ah*ah)}else ju=C-Math.sqrt(nl*nl+Ku*Ku);this.image.data[X+Ui]=Math.max(0,Math.min(255,ju+128))}}}addRegularDash(a,d){for(let Ht=a.length-1;Ht>=0;--Ht){const Ui=a[Ht],qr=a[Ht+1];Ui.zeroLength?a.splice(Ht,1):qr&&qr.isDash===Ui.isDash&&(qr.left=Ui.left,a.splice(Ht,1))}const y=a[0],C=a[a.length-1];y.isDash===C.isDash&&(y.left=C.left-this.width,C.right=y.right+this.width);const N=this.width*this.nextRow;let X=0,vt=a[X];for(let Ht=0;Ht<this.width;Ht++){Ht/vt.right>1&&(vt=a[++X]);const Ui=Math.abs(Ht-vt.left),qr=Math.abs(Ht-vt.right),Zs=Math.min(Ui,qr);this.image.data[N+Ht]=Math.max(0,Math.min(255,(vt.isDash?Zs:-Zs)+d+128))}}addDash(a,d){const y=this.getKey(a,d);if(this.positions[y])return this.positions[y];const C=d==="round",N=C?7:0,X=2*N+1;if(this.nextRow+X>this.height)return np("LineAtlas out of space"),null;a.length===0&&a.push(1);let vt=0;for(let qr=0;qr<a.length;qr++)a[qr]<0&&(np("Negative value is found in line dasharray, replacing values with 0"),a[qr]=0),vt+=a[qr];if(vt!==0){const qr=this.width/vt,Zs=this.getDashRanges(a,this.width,qr);C?this.addRoundDash(Zs,qr,N):this.addRegularDash(Zs,d==="square"?.5*qr:0)}const Ht=this.nextRow+N;this.nextRow+=X;const Ui={tl:[Ht,N],br:[vt,0]};return this.positions[y]=Ui,Ui}}Ip($E,"LineAtlas");class UE{constructor(a){const d={},y=[];for(const vt in a){const Ht=a[vt],Ui=d[vt]={};for(const qr in Ht.glyphs){const Zs=Ht.glyphs[+qr];if(!Zs||Zs.bitmap.width===0||Zs.bitmap.height===0)continue;const nl=Zs.metrics.localGlyph?2:1,ju={x:0,y:0,w:Zs.bitmap.width+2*nl,h:Zs.bitmap.height+2*nl};y.push(ju),Ui[qr]=ju}}const{w:C,h:N}=v2(y),X=new Bv({width:C||1,height:N||1});for(const vt in a){const Ht=a[vt];for(const Ui in Ht.glyphs){const qr=Ht.glyphs[+Ui];if(!qr||qr.bitmap.width===0||qr.bitmap.height===0)continue;const Zs=d[vt][Ui],nl=qr.metrics.localGlyph?2:1;Bv.copy(qr.bitmap,X,{x:0,y:0},{x:Zs.x+nl,y:Zs.y+nl},qr.bitmap)}}this.image=X,this.positions=d}}Ip(UE,"GlyphAtlas");class oT{constructor(a){this.tileID=new T_(a.tileID.overscaledZ,a.tileID.wrap,a.tileID.canonical.z,a.tileID.canonical.x,a.tileID.canonical.y),this.tileZoom=a.tileZoom,this.uid=a.uid,this.zoom=a.zoom,this.canonical=a.tileID.canonical,this.pixelRatio=a.pixelRatio,this.tileSize=a.tileSize,this.source=a.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=a.showCollisionBoxes,this.collectResourceTiming=!!a.collectResourceTiming,this.returnDependencies=!!a.returnDependencies,this.promoteId=a.promoteId,this.enableTerrain=!!a.enableTerrain,this.isSymbolTile=a.isSymbolTile,this.tileTransform=kx(a.tileID.canonical,a.projection),this.projection=a.projection}parse(a,d,y,C,N){this.status="parsing",this.data=a,this.collisionBoxArray=new ub;const X=new EE(Object.keys(a.layers).sort()),vt=new NE(this.tileID,this.promoteId);vt.bucketLayerIDs=[];const Ht={},Ui=new $E(256,256),qr={featureIndex:vt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ui,availableImages:y},Zs=d.familiesBySource[this.source];for(const nd in Zs){const ed=a.layers[nd];if(!ed)continue;let Rd=!1,kd=!1;for(const jd of Zs[nd])jd[0].type==="symbol"?Rd=!0:kd=!0;if(this.isSymbolTile===!0&&!Rd||this.isSymbolTile===!1&&!kd)continue;ed.version===1&&np(`Vector tile source "${this.source}" layer "${nd}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sf=X.encode(nd),Zf=[];for(let jd=0;jd<ed.length;jd++){const Pf=ed.feature(jd),Rf=vt.getId(Pf,nd);Zf.push({feature:Pf,id:Rf,index:jd,sourceLayerIndex:Sf})}for(const jd of Zs[nd]){const Pf=jd[0];this.isSymbolTile!==void 0&&Pf.type==="symbol"!==this.isSymbolTile||Pf.minzoom&&this.zoom<Math.floor(Pf.minzoom)||Pf.maxzoom&&this.zoom>=Pf.maxzoom||Pf.visibility!=="none"&&(B2(jd,this.zoom,y),(Ht[Pf.id]=Pf.createBucket({index:vt.bucketLayerIDs.length,layers:jd,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sf,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:y})).populate(Zf,qr,this.tileID.canonical,this.tileTransform),vt.bucketLayerIDs.push(jd.map(Rf=>Rf.id)))}}let nl,ju,Ku,ah;Ui.trim();const Eh={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},zh=bf(qr.glyphDependencies,nd=>Object.keys(nd).map(Number));Object.keys(zh).length?C.send("getGlyphs",{uid:this.uid,stacks:zh},(nd,ed)=>{nl||(nl=nd,ju=ed,Gh.call(this))},void 0,!1,Eh):ju={};const Yh=Object.keys(qr.iconDependencies);Yh.length?C.send("getImages",{icons:Yh,source:this.source,tileID:this.tileID,type:"icons"},(nd,ed)=>{nl||(nl=nd,Ku=ed,Gh.call(this))},void 0,!1,Eh):Ku={};const kh=Object.keys(qr.patternDependencies);function Gh(){if(nl)return N(nl);if(ju&&Ku&&ah){const nd=new UE(ju),ed=new Y2(Ku,ah);for(const Rd in Ht){const kd=Ht[Rd];kd instanceof tx?(B2(kd.layers,this.zoom,y),PS(kd,ju,nd.positions,Ku,ed.iconPositions,this.showCollisionBoxes,y,this.tileID.canonical,this.tileZoom,this.projection)):kd.hasPattern&&(kd instanceof A1||kd instanceof gp||kd instanceof ty)&&(B2(kd.layers,this.zoom,y),kd.addFeatures(qr,this.tileID.canonical,ed.patternPositions,y,this.tileTransform))}this.status="done",N(null,{buckets:Af(Ht).filter(Rd=>!Rd.isEmpty()),featureIndex:vt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nd.image,lineAtlas:Ui,imageAtlas:ed,glyphMap:this.returnDependencies?ju:null,iconMap:this.returnDependencies?Ku:null,glyphPositions:this.returnDependencies?nd.positions:null})}}kh.length?C.send("getImages",{icons:kh,source:this.source,tileID:this.tileID,type:"patterns"},(nd,ed)=>{nl||(nl=nd,ah=ed,Gh.call(this))},void 0,!1,Eh):ah={},Gh.call(this)}}function B2(c,a,d){const y=new ld(a);for(const C of c)C.recalculate(y,d)}class VE{constructor(a){this.entries={},this.scheduler=a}request(a,d,y,C){const N=this.entries[a]=this.entries[a]||{callbacks:[]};if(N.result){const[X,vt]=N.result;return this.scheduler?this.scheduler.add(()=>{C(X,vt)},d):C(X,vt),()=>{}}return N.callbacks.push(C),N.cancel||(N.cancel=y((X,vt)=>{N.result=[X,vt];for(const Ht of N.callbacks)this.scheduler?this.scheduler.add(()=>{Ht(X,vt)},d):Ht(X,vt);setTimeout(()=>delete this.entries[a],3e3)})),()=>{N.result||(N.callbacks=N.callbacks.filter(X=>X!==C),N.callbacks.length||(N.cancel(),delete this.entries[a]))}}}function GE(c,a,d){const y=JSON.stringify(c.request);return c.data&&(this.deduped.entries[y]={result:[null,c.data]}),this.deduped.request(y,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},C=>{const N=Yf(c.request,(X,vt,Ht,Ui)=>{X?C(X):vt&&C(null,{vectorTile:d?void 0:new z_(new Vb(vt)),rawData:vt,cacheControl:Ht,expires:Ui})});return()=>{N.cancel(),C()}},a)}o.ARRAY_TYPE=Ay,o.AUTH_ERR_MSG=Tm,o.Aabb=Yg,o.Actor=class{constructor(c,a,d){this.target=c,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},Cd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qd()?c:x,this.scheduler=new QS}send(c,a,d,y,C=!1,N){const X=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=N,this.callbacks[X]=d);const vt=fp(this.globalScope)?void 0:[];return this.target.postMessage({id:X,type:c,hasCallback:!!d,targetMapId:y,mustQueue:C,sourceMapId:this.mapId,data:Y(a,vt)},vt),{cancel:()=>{d&&delete this.callbacks[X],this.target.postMessage({id:X,type:"<cancel>",targetMapId:y,sourceMapId:this.mapId})}}}receive(c){const a=c.data,d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const y=this.cancelCallbacks[d];delete this.cancelCallbacks[d],y&&y.cancel()}else if(a.mustQueue||Qd()){const y=this.callbacks[d];this.cancelCallbacks[d]=this.scheduler.add(()=>this.processTask(d,a),y&&y.metadata||{type:"message"})}else this.processTask(d,a)}processTask(c,a){if(a.type==="<response>"){const d=this.callbacks[c];delete this.callbacks[c],d&&(a.error?d(g(a.error)):d(null,g(a.data)))}else{const d=fp(this.globalScope)?void 0:[],y=a.hasCallback?(N,X)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:N?Y(N):null,data:Y(X,d)},d)}:N=>{},C=g(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,C,y);else if(this.parent.getWorkerSource){const N=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,N[0],C.source)[N[1]](C,y)}else y(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=D0,o.Color=Np,o.ColorMode=s1,o.CullFaceMode=zv,o.DEMData=Hw,o.DataConstantProperty=pd,o.DedupedRequest=VE,o.DepthMode=lb,o.EXTENT=Hp,o.Elevation=class{isDataAvailableAtPoint(c){const a=this._source();if(this.isUsingMockSource()||!a||c.y<0||c.y>1)return!1;const d=a.getSource().maxzoom,y=1<<d,C=Math.floor(c.x),N=Math.floor((c.x-C)*y),X=Math.floor(c.y*y),vt=this.findDEMTileFor(new T_(d,C,d,N,X));return!(!vt||!vt.dem)}getAtPointOrZero(c,a=0){return this.getAtPoint(c,a)||0}getAtPoint(c,a,d=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const y=this._source();if(!y||c.y<0||c.y>1)return a;const C=y.getSource().maxzoom,N=1<<C,X=Math.floor(c.x),vt=c.x-X,Ht=new T_(C,X,C,Math.floor(vt*N),Math.floor(c.y*N)),Ui=this.findDEMTileFor(Ht);if(!Ui||!Ui.dem)return a;const qr=Ui.dem,Zs=1<<Ui.tileID.canonical.z,nl=(vt*Zs-Ui.tileID.canonical.x)*qr.dim,ju=(c.y*Zs-Ui.tileID.canonical.y)*qr.dim,Ku=Math.floor(nl),ah=Math.floor(ju);return(d?this.exaggeration():1)*Kp(Kp(qr.get(Ku,ah),qr.get(Ku,ah+1),ju-ah),Kp(qr.get(Ku+1,ah),qr.get(Ku+1,ah+1),ju-ah),nl-Ku)}getAtTileOffset(c,a,d){const y=1<<c.canonical.z;return this.getAtPointOrZero(new Z1(c.wrap+(c.canonical.x+a/Hp)/y,(c.canonical.y+d/Hp)/y))}getAtTileOffsetFunc(c,a,d,y){return C=>{const N=this.getAtTileOffset(c,C.x,C.y),X=y.upVector(c.canonical,C.x,C.y);return hy(X,X,N*y.upVectorScale(c.canonical,a,d).metersToTile),X}}getForTilePoints(c,a,d,y){if(this.isUsingMockSource())return!1;const C=Xw.create(this,c,y);return!!C&&(a.forEach(N=>{N[2]=this.exaggeration()*C.getElevationAt(N[0],N[1],d)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(c);if(!a||!a.dem)return null;const d=a.dem.tree,y=a.tileID,C=1<<c.canonical.z-y.canonical.z;let N=c.canonical.x/C-y.canonical.x,X=c.canonical.y/C-y.canonical.y,vt=0;for(let Ht=0;Ht<c.canonical.z-y.canonical.z&&!d.leaves[vt];Ht++){N*=2,X*=2;const Ui=2*Math.floor(X)+Math.floor(N);vt=d.childOffsets[vt]+Ui,N%=1,X%=1}return{min:this.exaggeration()*d.minimums[vt],max:this.exaggeration()*d.maximums[vt]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,a,d){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Vp,o.EvaluationParameters=ld,o.Event=mp,o.Evented=om,o.FillExtrusionBucket=ty,o.Frustum=y1,o.FrustumCorners=V1,o.GLOBE_RADIUS=Yy,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_fillGridMeshWithLods(c,a){const d=new Fp,y=new y_,C=[],N=c+1+2,X=a[0]+1,vt=a[0]+1+(1+a.length),Ht=(Ui,qr,Zs)=>{let nl=Ui===N-1?Ui-2:Ui===0?Ui:Ui-1;return nl+=Zs?24575:0,[nl,qr]};for(let Ui=0;Ui<N;++Ui)d.emplaceBack(...Ht(Ui,0,!0));for(let Ui=0;Ui<X;++Ui)for(let qr=0;qr<N;++qr)d.emplaceBack(...Ht(qr,Ui,(qr===0||qr===N-1)&&!0));for(let Ui=0;Ui<a.length;++Ui){const qr=a[Ui];for(let Zs=0;Zs<N;++Zs)d.emplaceBack(...Ht(Zs,qr,!0))}for(let Ui=0;Ui<a.length;++Ui){const qr=y.length,Zs=a[Ui]+1+2,nl=new y_;for(let ah=0;ah<Zs-1;ah++){const Eh=ah===Zs-2,zh=Eh?N*(vt-a.length+Ui-ah):N;for(let Yh=0;Yh<N-1;Yh++){const kh=ah*N+Yh;ah===0||Eh||Yh===0||Yh===N-2?(nl.emplaceBack(kh+1,kh,kh+zh),nl.emplaceBack(kh+zh,kh+zh+1,kh+1)):(y.emplaceBack(kh+1,kh,kh+zh),y.emplaceBack(kh+zh,kh+zh+1,kh+1))}}const ju=Og.simpleSegment(0,qr,d.length,y.length-qr);for(let ah=0;ah<nl.uint16.length;ah+=3)y.emplaceBack(nl.uint16[ah],nl.uint16[ah+1],nl.uint16[ah+2]);const Ku=Og.simpleSegment(0,qr,d.length,y.length-qr);C.push({withoutSkirts:ju,withSkirts:Ku})}return{vertices:d,indices:y,segments:C}}_createGrid(c){const a=this._fillGridMeshWithLods(fv,gx);this._gridSegments=a.segments,this._gridBuffer=c.createVertexBuffer(a.vertices,_1.members),this._gridIndexBuffer=c.createIndexBuffer(a.indices,!0)}_createPoles(c){const a=new y_;for(let C=0;C<=fv;C++)a.emplaceBack(0,C+1,C+2);this._poleIndexBuffer=c.createIndexBuffer(a,!0);const d=new Cy,y=new Cy;this._poleSegments=[];for(let C=0,N=0;C<5;C++){const X=360/(1<<C);d.emplaceBack(0,-Yy,0,.5,0),y.emplaceBack(0,-Yy,0,.5,1);for(let vt=0;vt<=fv;vt++){const Ht=vt/fv,Ui=Kp(0,X,Ht),[qr,Zs,nl]=x1(Yx,s2,Ui,Yy);d.emplaceBack(qr,Zs,nl,Ht,0),y.emplaceBack(qr,Zs,nl,Ht,1)}this._poleSegments.push(Og.simpleSegment(N,0,66,64)),N+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(d,mw,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(y,mw,!1)}getGridBuffers(c,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,a){if(!this._wireframeSegments){const d=new dv,y=fv,C=y+1+2,N=1;this._wireframeSegments=[];for(let X=0,vt=0;X<gx.length;X++){const Ht=gx[X];for(let qr=N;qr<Ht+N;qr++)for(let Zs=N;Zs<y+N;Zs++){const nl=qr*C+Zs;d.emplaceBack(nl,nl+1),d.emplaceBack(nl,nl+C),d.emplaceBack(nl,nl+C+1)}const Ui=Ht*y*3;this._wireframeSegments.push(Og.simpleSegment(0,vt,(Ht+1)*C,Ui)),vt+=Ui}this._wireframeIndexBuffer=c.createIndexBuffer(d)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[a]]}},o.GlyphManager=ob,o.ImagePosition=x2,o.LivePerformanceUtils=Fh,o.LngLat=Sm,o.LngLatBounds=Qv,o.LocalGlyphMode=E2,o.MAX_MERCATOR_LATITUDE=o_,o.MercatorCoordinate=Z1,o.ONE_EM=ry,o.OverscaledTileID=T_,o.PerformanceMarkers=Ph,o.Properties=Bf,o.RGBAImage=Q_,o.Ray=Zx,o.RequestManager=class{constructor(c,a,d){this._transformRequestFn=c,this._customAccessToken=a,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const c=function(){let a="";for(let d=0;d<10;d++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rl,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,a){return this._transformRequestFn&&this._transformRequestFn(c,a)||{url:c}}normalizeStyleURL(c,a){if(!hp(c))return c;const d=mh(c);return d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeGlyphsURL(c,a){if(!hp(c))return c;const d=mh(c);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeSourceURL(c,a,d,y){if(!hp(c))return c;const C=mh(c);return C.path=`/v4/${C.authority}.json`,C.params.push("secure"),d&&C.params.push(`language=${d}`),y&&C.params.push(`worldview=${y}`),this._makeAPIURL(C,this._customAccessToken||a)}normalizeSpriteURL(c,a,d,y){const C=mh(c);return hp(c)?(C.path=`/styles/v1${C.path}/sprite${a}${d}`,this._makeAPIURL(C,this._customAccessToken||y)):(C.path+=`${a}${d}`,Jh(C))}normalizeTileURL(c,a,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!hp(c))return c;const y=mh(c);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||d&&y.authority!=="raster"&&d===512?"@2x":""}${nt.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${he.RASTER_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${he.TILE_URL_VERSION}${y.path}`);const C=this._customAccessToken||function(N){for(const X of N){const vt=X.match(/^access_token=(.*)$/);if(vt)return vt[1]}return null}(y.params)||he.ACCESS_TOKEN;return he.REQUIRE_ACCESS_TOKEN&&C&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,C)}canonicalizeTileURL(c,a){const d=mh(c);if(!d.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!d.path.match(/\.[\w]+$/))return c;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${he.RASTER_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${he.TILE_URL_VERSION}/`,"")}`;let C=d.params;return a&&(C=C.filter(N=>!N.match(/^access_token=/))),C.length&&(y+=`?${C.join("&")}`),y}canonicalizeTileset(c,a){const d=!!a&&hp(a),y=[];for(const C of c.tiles||[])Em(C)?y.push(this.canonicalizeTileURL(C,d)):y.push(C);return y}_makeAPIURL(c,a){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=mh(he.API_URL);if(c.protocol=y.protocol,c.authority=y.authority,c.protocol==="http"){const C=c.params.indexOf("secure");C>=0&&c.params.splice(C,1)}if(y.path!=="/"&&(c.path=`${y.path}${c.path}`),!he.REQUIRE_ACCESS_TOKEN)return Jh(c);if(a=a||he.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return c.params=c.params.filter(C=>C.indexOf("access_token")===-1),c.params.push(`access_token=${a||""}`),Jh(c)}},o.ResourceType=Wf,o.SegmentVector=Og,o.SourceCache=Dx,o.StencilMode=L2,o.StructArrayLayout1ui2=I0,o.StructArrayLayout2f1f2i16=r_,o.StructArrayLayout2i4=Fp,o.StructArrayLayout2ui4=dv,o.StructArrayLayout3f12=jg,o.StructArrayLayout3ui6=y_,o.StructArrayLayout4i8=Am,o.StructArrayLayout5f20=Cy,o.Texture=Wb,o.Tile=k2,o.Transitionable=Vf,o.Uniform1f=Nx,o.Uniform1i=class extends Av{constructor(c){super(c),this.current=0}set(c,a,d){this.fetchUniformLocation(c,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}},o.Uniform2f=class extends Av{constructor(c){super(c),this.current=[0,0]}set(c,a,d){this.fetchUniformLocation(c,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}},o.Uniform3f=class extends Av{constructor(c){super(c),this.current=[0,0,0]}set(c,a,d){this.fetchUniformLocation(c,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}},o.Uniform4f=tw,o.UniformColor=iw,o.UniformMatrix2f=class extends Av{constructor(c){super(c),this.current=nw}set(c,a,d){if(this.fetchUniformLocation(c,a)){for(let y=0;y<4;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}},o.UniformMatrix3f=class extends Av{constructor(c){super(c),this.current=Kw}set(c,a,d){if(this.fetchUniformLocation(c,a)){for(let y=0;y<9;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix3fv(this.location,!1,d);break}}}},o.UniformMatrix4f=class extends Av{constructor(c){super(c),this.current=Wv}set(c,a,d){if(this.fetchUniformLocation(c,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let y=1;y<16;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}},o.UnwrappedTileID=$b,o.ValidationError=pp,o.VectorTileFeature=b_,o.VectorTileWorkerSource=class extends om{constructor(c,a,d,y,C){super(),this.actor=c,this.layerIndex=a,this.availableImages=d,this.loadVectorData=C||GE,this.loading={},this.loaded={},this.deduped=new VE(c.scheduler),this.isSpriteLoaded=y,this.scheduler=c.scheduler}loadTile(c,a){const d=c.uid,y=c&&c.request,C=y&&y.collectResourceTiming,N=this.loading[d]=new oT(c);N.abort=this.loadVectorData(c,(X,vt)=>{const Ht=!this.loading[d];if(delete this.loading[d],Ht||X||!vt)return N.status="done",Ht||(this.loaded[d]=N),a(X);const Ui=vt.rawData,qr={};vt.expires&&(qr.expires=vt.expires),vt.cacheControl&&(qr.cacheControl=vt.cacheControl),N.vectorTile=vt.vectorTile||new z_(new Vb(Ui));const Zs=()=>{N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,(nl,ju)=>{if(nl||!ju)return a(nl);const Ku={};if(C){const ah=Kd(y);ah.length>0&&(Ku.resourceTiming=JSON.parse(JSON.stringify(ah)))}a(null,md({rawTileData:Ui.slice(0)},ju,qr,Ku))})};this.isSpriteLoaded?Zs():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Zs,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):Zs()}),this.loaded=this.loaded||{},this.loaded[d]=N})}reloadTile(c,a){const d=this.loaded,y=c.uid,C=this;if(d&&d[y]){const N=d[y];N.showCollisionBoxes=c.showCollisionBoxes,N.enableTerrain=!!c.enableTerrain,N.projection=c.projection,N.tileTransform=kx(c.tileID.canonical,c.projection);const X=(vt,Ht)=>{const Ui=N.reloadCallback;Ui&&(delete N.reloadCallback,N.parse(N.vectorTile,C.layerIndex,this.availableImages,C.actor,Ui)),a(vt,Ht)};N.status==="parsing"?N.reloadCallback=X:N.status==="done"&&(N.vectorTile?N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,X):X())}}abortTile(c,a){const d=c.uid,y=this.loading[d];y&&(y.abort&&y.abort(),delete this.loading[d]),a()}removeTile(c,a){const d=this.loaded,y=c.uid;d&&d[y]&&delete d[y],a()}},o.WritingMode=J0,o.ZoomDependentExpression=kp,o.add=q0,o.addDynamicAttributes=jw,o.adjoint=function(c,a){var d=a[0],y=a[1],C=a[2],N=a[3],X=a[4],vt=a[5],Ht=a[6],Ui=a[7],qr=a[8];return c[0]=X*qr-vt*Ui,c[1]=C*Ui-y*qr,c[2]=y*vt-C*X,c[3]=vt*Ht-N*qr,c[4]=d*qr-C*Ht,c[5]=C*N-d*vt,c[6]=N*Ui-X*Ht,c[7]=y*Ht-d*Ui,c[8]=d*X-y*N,c},o.asyncAll=yf,o.bezier=Mh,o.bindAll=Cd,o.boundsAttributes=IE,o.bufferConvexPolygon=function(c,a){const d=[];for(let y=0;y<c.length;y++){const C=Tf(y-1,-1,c.length-1),N=Tf(y+1,-1,c.length-1),X=c[y],vt=c[N],Ht=c[C].sub(X).unit(),Ui=vt.sub(X).unit(),qr=Ui.angleWithSep(Ht.x,Ht.y),Zs=Ht.add(Ui).unit().mult(-1*a/Math.sin(qr/2));d.push(X.add(Zs))}return d},o.cacheEntryPossiblyAdded=function(c){Nf++,Nf>Kf&&(c.getActor().send("enforceCacheSizeLimit",Ld),Nf=0)},o.calculateGlobeLabelMatrix=function(c,a){const{x:d,y}=c.point,C=Tb(d,y,c.worldSize/c._pixelsPerMercatorPixel,0,0);return p1(C,C,Wx(pv(a)))},o.calculateGlobeMatrix=function(c){const{x:a,y:d}=c.point,{lng:y,lat:C}=c._center;return Tb(a,d,c.worldSize,y,C)},o.calculateGlobeMercatorMatrix=function(c){const a=c.pixelsPerMeter,d=a/Jy(1,c.center.lat),y=C0(new Float64Array(16));return $1(y,y,[c.point.x,c.point.y,0]),Jv(y,y,[d,d,a]),Float32Array.from(y)},o.circumferenceAtLatitude=t1,o.clamp=Uh,o.clearTileCache=function(c){if(!If())return;const a=x.caches.delete(ad);c&&a.catch(c).then(()=>c())},o.clipLine=lE,o.clone=function(c){var a=new Ay(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},o.clone$1=td,o.collisionCircleLayout=iS,o.config=he,o.conjugate=function(c,a){return c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c[3]=a[3],c},o.create=function(){var c=new Ay(16);return Ay!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},o.create$1=rw,o.createExpression=e_,o.createLayout=Lp,o.createStyleLayer=function(c){return c.type==="custom"?new XS(c):new YS[c.type](c)},o.cross=e1,o.degToRad=th,o.distance=function(c,a){return Math.hypot(a[0]-c[0],a[1]-c[1],a[2]-c[2])},o.div=function(c,a,d){return c[0]=a[0]/d[0],c[1]=a[1]/d[1],c[2]=a[2]/d[2],c},o.dot=t_,o.earthRadius=xx,o.ease=Dh,o.easeCubicInOut=xh,o.ecefToLatLng=function([c,a,d]){const y=Math.hypot(c,a,d),C=Math.atan2(c,d),N=.5*Math.PI-Math.acos(-a/y);return new Sm(sl(C),sl(N))},o.emitValidationErrors=qv,o.endsWith=Gd,o.enforceCacheSizeLimit=function(c){Df(),Zd&&Zd.then(a=>{a.keys().then(d=>{for(let y=0;y<d.length-c;y++)a.delete(d[y])})})},o.evaluateSizeForFeature=Lw,o.evaluateSizeForZoom=tb,o.evaluateVariableOffset=fE,o.evented=Nh,o.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]},o.exactEquals$1=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]},o.exported=Jd,o.exported$1=nt,o.extend=md,o.extend$1=Hg,o.fillExtrusionHeightLift=_v,o.filterObject=Id,o.fromMat4=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[4],c[4]=a[5],c[5]=a[6],c[6]=a[8],c[7]=a[9],c[8]=a[10],c},o.fromQuat=function(c,a){var d=a[0],y=a[1],C=a[2],N=a[3],X=d+d,vt=y+y,Ht=C+C,Ui=d*X,qr=y*X,Zs=y*vt,nl=C*X,ju=C*vt,Ku=C*Ht,ah=N*X,Eh=N*vt,zh=N*Ht;return c[0]=1-Zs-Ku,c[1]=qr+zh,c[2]=nl-Eh,c[3]=0,c[4]=qr-zh,c[5]=1-Ui-Ku,c[6]=ju+ah,c[7]=0,c[8]=nl+Eh,c[9]=ju-ah,c[10]=1-Ui-Zs,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},o.fromRotation=function(c,a){var d=Math.sin(a),y=Math.cos(a);return c[0]=y,c[1]=d,c[2]=0,c[3]=-d,c[4]=y,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},o.fromScaling=sw,o.furthestTileCorner=function(c){const a=Math.round((c+45+360)%360/90)%4;return sh[a]},o.getAABBPointSquareDist=function(c,a,d){let y=0;for(let C=0;C<2;++C){const N=d?d[C]:0;c[C]>N&&(y+=(c[C]-N)*(c[C]-N)),a[C]<N&&(y+=(N-a[C])*(N-a[C]))}return y},o.getAnchorAlignment=w2,o.getAnchorJustification=T2,o.getBounds=function(c){let a=1/0,d=1/0,y=-1/0,C=-1/0;for(const N of c)a=Math.min(a,N.x),d=Math.min(d,N.y),y=Math.max(y,N.x),C=Math.max(C,N.y);return{min:new Js(a,d),max:new Js(y,C)}},o.getColumn=Yd,o.getGridMatrix=function(c,a,d,y){const C=a.getNorth(),N=a.getSouth(),X=a.getWest(),vt=a.getEast(),Ht=1<<c.z,Ui=vt-X,qr=C-N,Zs=Ui/fv,nl=-qr/gx[d],ju=[0,Zs,0,nl,0,0,C,X,0];if(c.z>0){const Ku=180/y;ow(ju,ju,[Ku/Ui+1,0,0,0,Ku/qr+1,0,-.5*Ku/Zs,.5*Ku/nl,1])}return ju[2]=Ht,ju[5]=c.x,ju[8]=c.y,ju},o.getImage=nm,o.getJSON=function(c,a){return Pp(md(c,{type:"json"}),a)},o.getLatitudinalLod=function(c){const a=o_-5;c=Uh(c,-a,a)/a*90;const d=Math.pow(Math.abs(Math.sin(th(c))),3);return Math.round(d*(gx.length-1))},o.getMapSessionAPI=dh,o.getPerformanceMeasurement=Kd,o.getProjection=bE,o.getRTLTextPluginStatus=qh,o.getReferrer=Tp,o.getTilePoint=function(c,{x:a,y:d},y=0){return new Js(((a-y)*c.scale-c.x)*Hp,(d*c.scale-c.y)*Hp)},o.getTileVec3=function(c,a,d=0){return Bg(((a.x-d)*c.scale-c.x)*Hp,(a.y*c.scale-c.y)*Hp,Mb(a.z,a.y))},o.getVideo=function(c,a){const d=x.document.createElement("video");d.muted=!0,d.onloadstart=function(){a(null,d)};for(let y=0;y<c.length;y++){const C=x.document.createElement("source");qp(c[y])||(d.crossOrigin="Anonymous"),C.src=c[y],d.appendChild(C)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(c){const a=[0,0,0],d=C0(new Float64Array(16));return p1(d,c.pixelMatrix,c.globeMatrix),Mg(a,a,d),new Js(a[0],a[1])},o.globeDenormalizeECEF=Wx,o.globeECEFOrigin=function(c,a){const d=[0,0,0];return Mg(d,d,j1(pv(a.canonical))),Mg(d,d,c),d},o.globeMetersToEcef=_x,o.globeNormalizeECEF=j1,o.globePixelsToTileUnits=function(c,a){return Hp/(512*Math.pow(2,c))*Xx(pv(a))},o.globePoleMatrixForTile=function(c,a,d){const y=C0(new Float64Array(16)),C=(a/(1<<c)-.5)*Math.PI*2;return jx(y,d.globeMatrix,C),Float32Array.from(y)},o.globeTileBounds=pv,o.globeTiltAtLngLat=Ib,o.globeToMercatorTransition=Lv,o.globeUseCustomAntiAliasing=function(c,a,d){const y=Lv(d.zoom),C=c.style.map._antialias,N=!!a.extStandardDerivatives,X=a.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return y===0&&!C&&!X&&N},o.identity=C0,o.identity$1=mx,o.invert=fx,o.isFullscreen=function(){return!!x.document.fullscreenElement||!!x.document.webkitFullscreenElement},o.isLngLatBehindGlobe=q1,o.isMapAuthenticated=function(c){return yh.has(c)},o.isMapboxURL=hp,o.isSafariWithAntialiasingBug=function(c){const a=c.navigator?c.navigator.userAgent:null;return!!fp(c)&&a&&(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Cg,o.latLngToECEF=b1,o.len=i2,o.length=Dv,o.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},o.lngFromMercatorX=e0,o.loadVectorTile=GE,o.makeRequest=Pp,o.mapValue=function(c,a,d,y,C){return Uh((c-a)/(d-a)*(C-y)+y,y,C)},o.mercatorScale=vw,o.mercatorXfromLng=P0,o.mercatorYfromLat=X0,o.mercatorZfromAltitude=Jy,o.mul=lw,o.mul$1=t2,o.multiply=p1,o.multiply$1=ow,o.multiply$2=vb,o.nextPowerOfTwo=Td,o.normalize=R_,o.normalize$1=n2,o.normalize$2=fw,o.number=Kp,o.ortho=function(c,a,d,y,C,N,X){var vt=1/(a-d),Ht=1/(y-C),Ui=1/(N-X);return c[0]=-2*vt,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*Ht,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*Ui,c[11]=0,c[12]=(a+d)*vt,c[13]=(C+y)*Ht,c[14]=(X+N)*Ui,c[15]=1,c},o.pbf=Vb,o.perspective=function(c,a,d,y,C){var N,X=1/Math.tan(a/2);return c[0]=X/d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=X,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,C!=null&&C!==1/0?(c[10]=(C+y)*(N=1/(y-C)),c[14]=2*C*y*N):(c[10]=-1,c[14]=-2*y),c},o.pick=function(c,a){const d={};for(let y=0;y<a.length;y++){const C=a[y];C in c&&(d[C]=c[C])}return d},o.plugin=Hh,o.pointGeometry=Js,o.polesInViewport=function(c){const a=C0(new Float64Array(16));p1(a,c.pixelMatrix,c.globeMatrix);const d=[0,Ky,0],y=[0,Qy,0];return Mg(d,d,a),Mg(y,y,a),[d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!q1(c,new Sm(c.center.lat,90)),y[0]>0&&y[0]<=c.width&&y[1]>0&&y[1]<=c.height&&!q1(c,new Sm(c.center.lat,-90))]},o.polygonContainsPoint=i1,o.polygonIntersectsBox=Db,o.polygonIntersectsPolygon=xw,o.polygonizeBounds=function(c,a,d=0,y=!0){const C=new Js(d,d),N=c.sub(C),X=a.add(C),vt=[N,new Js(X.x,N.y),X,new Js(N.x,X.y)];return y&&vt.push(N.clone()),vt},o.posAttributes=_1,o.postMapLoadEvent=$u,o.postPerformanceEvent=rh,o.postTurnstileEvent=mr,o.potpack=v2,o.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.radToDeg=sl,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(c){return c({pluginStatus:Ih,pluginURL:hh}),Nh.on("pluginStateChange",c),c},o.removeAuthState=function(c){yh.delete(c)},o.renderColorRamp=T1,o.resample=bx,o.rotateX=Vx,o.rotateX$1=g1,o.rotateY=jx,o.rotateY$1=xb,o.rotateZ=function(c,a,d){var y=Math.sin(d),C=Math.cos(d),N=a[0],X=a[1],vt=a[2],Ht=a[3],Ui=a[4],qr=a[5],Zs=a[6],nl=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=N*C+Ui*y,c[1]=X*C+qr*y,c[2]=vt*C+Zs*y,c[3]=Ht*C+nl*y,c[4]=Ui*C-N*y,c[5]=qr*C-X*y,c[6]=Zs*C-vt*y,c[7]=nl*C-Ht*y,c},o.rotateZ$1=function(c,a,d){d*=.5;var y=a[0],C=a[1],N=a[2],X=a[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+C*vt,c[1]=C*Ht-y*vt,c[2]=N*Ht+X*vt,c[3]=X*Ht-N*vt,c},o.scale=Jv,o.scale$1=dw,o.scale$2=hy,o.scaleAndAdd=U1,o.set=function(c,a,d,y){return c[0]=a,c[1]=d,c[2]=y,c},o.setCacheLimits=function(c,a){Ld=c,Kf=a},o.setColumn=function(c,a,d){c[4*a+0]=d[0],c[4*a+1]=d[1],c[4*a+2]=d[2],c[4*a+3]=d[3]},o.setRTLTextPlugin=function(c,a,d=!1){if(Ih===fh||Ih===wh||Ih===Th)throw new Error("setRTLTextPlugin cannot be called multiple times.");hh=Jd.resolveURL(c),Ih=fh,Sh=a,Rh(),d||$h()},o.smoothstep=cd,o.spec=Pd,o.squaredLength=function(c){var a=c[0],d=c[1],y=c[2];return a*a+d*d+y*y},o.storeAuthState=function(c,a){a?yh.add(c):yh.delete(c)},o.sub=Z0,o.subtract=qx,o.symbolSize=nS,o.tileAABB=function(c,a,d,y,C,N,X,vt,Ht){if(Ht.name==="globe")return gw(c,a,new D0(d,y,C));const Ui=kx({z:d,x:y,y:C},Ht);return new Yg([(N+Ui.x/Ui.scale)*a,a*(Ui.y/Ui.scale),X],[(N+Ui.x2/Ui.scale)*a,a*(Ui.y2/Ui.scale),vt])},o.tileCornersToBounds=H0,o.tileTransform=kx,o.transformMat3=function(c,a,d){var y=a[0],C=a[1],N=a[2];return c[0]=y*d[0]+C*d[3]+N*d[6],c[1]=y*d[1]+C*d[4]+N*d[7],c[2]=y*d[2]+C*d[5]+N*d[8],c},o.transformMat4=Mg,o.transformMat4$1=m1,o.transformQuat=hw,o.transitionTileAABBinECEF=Sb,o.translate=$1,o.transpose=function(c,a){if(c===a){var d=a[1],y=a[2],C=a[5];c[1]=a[3],c[2]=a[6],c[3]=d,c[5]=a[7],c[6]=y,c[7]=C}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c},o.triggerPluginCompletionEvent=Oh,o.uniqueId=qd,o.updateGlobeVertexNormal=function(c,a,d,y,C){const N=5*a+2;c.float32[N+0]=d,c.float32[N+1]=y,c.float32[N+2]=C},o.validateCustomStyleLayer=function(c){const a=[],d=c.id;return d===void 0&&a.push({message:`layers.${d}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${d}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),a},o.validateFilter=c=>Sy(Tv(c)),o.validateFog=c=>Sy(Mv(c)),o.validateLayer=c=>Sy(lv(c)),o.validateLight=c=>Sy(c1(c)),o.validateSource=c=>Sy(S0(c)),o.validateStyle=T0,o.validateTerrain=c=>Sy(Iv(c)),o.values=Af,o.vectorTile=zg,o.version=M,o.warnOnce=np,o.window=x,o.wrap=Tf}),l(["./shared"],function(o){function x(Xr){if(typeof Xr=="number"||typeof Xr=="boolean"||typeof Xr=="string"||Xr==null)return JSON.stringify(Xr);if(Array.isArray(Xr)){let cs="[";for(const $u of Xr)cs+=`${x($u)},`;return`${cs}]`}let mr="{";for(const cs of Object.keys(Xr).sort())mr+=`${cs}:${x(Xr[cs])},`;return`${mr}}`}function M(Xr){let mr="";for(const cs of o.refProperties)mr+=`/${x(Xr[cs])}`;return mr}class P{constructor(mr){this.keyCache={},mr&&this.replace(mr)}replace(mr){this._layerConfigs={},this._layers={},this.update(mr,[])}update(mr,cs){for(const eh of mr)this._layerConfigs[eh.id]=eh,(this._layers[eh.id]=o.createStyleLayer(eh)).compileFilter(),this.keyCache[eh.id]&&delete this.keyCache[eh.id];for(const eh of cs)delete this.keyCache[eh],delete this._layerConfigs[eh],delete this._layers[eh];this.familiesBySource={};const $u=function(eh,rh){const uh={};for(let yh=0;yh<eh.length;yh++){const Ph=rh&&rh[eh[yh].id]||M(eh[yh]);rh&&(rh[eh[yh].id]=Ph);let Fh=uh[Ph];Fh||(Fh=uh[Ph]=[]),Fh.push(eh[yh])}const dh=[];for(const yh in uh)dh.push(uh[yh]);return dh}(o.values(this._layerConfigs),this.keyCache);for(const eh of $u){const rh=eh.map(Ad=>this._layers[Ad.id]),uh=rh[0];if(uh.visibility==="none")continue;const dh=uh.source||"";let yh=this.familiesBySource[dh];yh||(yh=this.familiesBySource[dh]={});const Ph=uh.sourceLayer||"_geojsonTileLayer";let Fh=yh[Ph];Fh||(Fh=yh[Ph]=[]),Fh.push(rh)}}}class he{loadTile(mr,cs){const{uid:$u,encoding:eh,rawImageData:rh,padding:uh,buildQuadTree:dh}=mr,yh=o.window.ImageBitmap&&rh instanceof o.window.ImageBitmap?this.getImageData(rh,uh):rh;cs(null,new o.DEMData($u,yh,eh,uh<1,dh))}getImageData(mr,cs){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(mr.width,mr.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=mr.width,this.offscreenCanvas.height=mr.height,this.offscreenCanvasContext.drawImage(mr,0,0,mr.width,mr.height);const $u=this.offscreenCanvasContext.getImageData(-cs,-cs,mr.width+2*cs,mr.height+2*cs);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),$u}}var nt=function Xr(mr,cs){var $u,eh=mr&&mr.type;if(eh==="FeatureCollection")for($u=0;$u<mr.features.length;$u++)Xr(mr.features[$u],cs);else if(eh==="GeometryCollection")for($u=0;$u<mr.geometries.length;$u++)Xr(mr.geometries[$u],cs);else if(eh==="Feature")Xr(mr.geometry,cs);else if(eh==="Polygon")_e(mr.coordinates,cs);else if(eh==="MultiPolygon")for($u=0;$u<mr.coordinates.length;$u++)_e(mr.coordinates[$u],cs);return mr};function _e(Xr,mr){if(Xr.length!==0){Bt(Xr[0],mr);for(var cs=1;cs<Xr.length;cs++)Bt(Xr[cs],!mr)}}function Bt(Xr,mr){for(var cs=0,$u=0,eh=0,rh=Xr.length,uh=rh-1;eh<rh;uh=eh++){var dh=(Xr[eh][0]-Xr[uh][0])*(Xr[uh][1]+Xr[eh][1]),yh=cs+dh;$u+=Math.abs(cs)>=Math.abs(dh)?cs-yh+dh:dh-yh+cs,cs=yh}cs+$u>=0!=!!mr&&Xr.reverse()}const Fn=o.VectorTileFeature.prototype.toGeoJSON;class yr{constructor(mr){this._feature=mr,this.extent=o.EXTENT,this.type=mr.type,this.properties=mr.tags,"id"in mr&&!isNaN(mr.id)&&(this.id=parseInt(mr.id,10))}loadGeometry(){if(this._feature.type===1){const mr=[];for(const cs of this._feature.geometry)mr.push([new o.pointGeometry(cs[0],cs[1])]);return mr}{const mr=[];for(const cs of this._feature.geometry){const $u=[];for(const eh of cs)$u.push(new o.pointGeometry(eh[0],eh[1]));mr.push($u)}return mr}}toGeoJSON(mr,cs,$u){return Fn.call(this,mr,cs,$u)}}class Io{constructor(mr){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=mr.length,this._features=mr}feature(mr){return new yr(this._features[mr])}}var rl={},Co={get exports(){return rl},set exports(Xr){rl=Xr}},as=o.pointGeometry,Js=o.vectorTile.VectorTileFeature,lh=ch;function ch(Xr,mr){this.options=mr||{},this.features=Xr,this.length=Xr.length}function Zu(Xr,mr){this.id=typeof Xr.id=="number"?Xr.id:void 0,this.type=Xr.type,this.rawGeometry=Xr.type===1?[Xr.geometry]:Xr.geometry,this.properties=Xr.tags,this.extent=mr||4096}ch.prototype.feature=function(Xr){return new Zu(this.features[Xr],this.options.extent)},Zu.prototype.loadGeometry=function(){var Xr=this.rawGeometry;this.geometry=[];for(var mr=0;mr<Xr.length;mr++){for(var cs=Xr[mr],$u=[],eh=0;eh<cs.length;eh++)$u.push(new as(cs[eh][0],cs[eh][1]));this.geometry.push($u)}return this.geometry},Zu.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Xr=this.geometry,mr=1/0,cs=-1/0,$u=1/0,eh=-1/0,rh=0;rh<Xr.length;rh++)for(var uh=Xr[rh],dh=0;dh<uh.length;dh++){var yh=uh[dh];mr=Math.min(mr,yh.x),cs=Math.max(cs,yh.x),$u=Math.min($u,yh.y),eh=Math.max(eh,yh.y)}return[mr,$u,cs,eh]},Zu.prototype.toGeoJSON=Js.prototype.toGeoJSON;var th=o.pbf,sl=lh;function sh(Xr){var mr=new th;return function(cs,$u){for(var eh in cs.layers)$u.writeMessage(3,xh,cs.layers[eh])}(Xr,mr),mr.finish()}function xh(Xr,mr){var cs;mr.writeVarintField(15,Xr.version||1),mr.writeStringField(1,Xr.name||""),mr.writeVarintField(5,Xr.extent||4096);var $u={keys:[],values:[],keycache:{},valuecache:{}};for(cs=0;cs<Xr.length;cs++)$u.feature=Xr.feature(cs),mr.writeMessage(2,Mh,$u);var eh=$u.keys;for(cs=0;cs<eh.length;cs++)mr.writeStringField(3,eh[cs]);var rh=$u.values;for(cs=0;cs<rh.length;cs++)mr.writeMessage(4,yf,rh[cs])}function Mh(Xr,mr){var cs=Xr.feature;cs.id!==void 0&&mr.writeVarintField(1,cs.id),mr.writeMessage(2,Dh,Xr),mr.writeVarintField(3,cs.type),mr.writeMessage(4,Tf,cs)}function Dh(Xr,mr){var cs=Xr.feature,$u=Xr.keys,eh=Xr.values,rh=Xr.keycache,uh=Xr.valuecache;for(var dh in cs.properties){var yh=cs.properties[dh],Ph=rh[dh];if(yh!==null){Ph===void 0&&($u.push(dh),rh[dh]=Ph=$u.length-1),mr.writeVarint(Ph);var Fh=typeof yh;Fh!=="string"&&Fh!=="boolean"&&Fh!=="number"&&(yh=JSON.stringify(yh));var Ad=Fh+":"+yh,wd=uh[Ad];wd===void 0&&(eh.push(yh),uh[Ad]=wd=eh.length-1),mr.writeVarint(wd)}}}function Uh(Xr,mr){return(mr<<3)+(7&Xr)}function cd(Xr){return Xr<<1^Xr>>31}function Tf(Xr,mr){for(var cs=Xr.loadGeometry(),$u=Xr.type,eh=0,rh=0,uh=cs.length,dh=0;dh<uh;dh++){var yh=cs[dh],Ph=1;$u===1&&(Ph=yh.length),mr.writeVarint(Uh(1,Ph));for(var Fh=$u===3?yh.length-1:yh.length,Ad=0;Ad<Fh;Ad++){Ad===1&&$u!==1&&mr.writeVarint(Uh(2,Fh-1));var wd=yh[Ad].x-eh,Kd=yh[Ad].y-rh;mr.writeVarint(cd(wd)),mr.writeVarint(cd(Kd)),eh+=wd,rh+=Kd}$u===3&&mr.writeVarint(Uh(7,1))}}function yf(Xr,mr){var cs=typeof Xr;cs==="string"?mr.writeStringField(1,Xr):cs==="boolean"?mr.writeBooleanField(7,Xr):cs==="number"&&(Xr%1!=0?mr.writeDoubleField(3,Xr):Xr<0?mr.writeSVarintField(6,Xr):mr.writeVarintField(5,Xr))}function Af(Xr,mr,cs,$u,eh,rh){if(eh-$u<=cs)return;const uh=$u+eh>>1;md(Xr,mr,uh,$u,eh,rh%2),Af(Xr,mr,cs,$u,uh-1,rh+1),Af(Xr,mr,cs,uh+1,eh,rh+1)}function md(Xr,mr,cs,$u,eh,rh){for(;eh>$u;){if(eh-$u>600){const Ph=eh-$u+1,Fh=cs-$u+1,Ad=Math.log(Ph),wd=.5*Math.exp(2*Ad/3),Kd=.5*Math.sqrt(Ad*wd*(Ph-wd)/Ph)*(Fh-Ph/2<0?-1:1);md(Xr,mr,cs,Math.max($u,Math.floor(cs-Fh*wd/Ph+Kd)),Math.min(eh,Math.floor(cs+(Ph-Fh)*wd/Ph+Kd)),rh)}const uh=mr[2*cs+rh];let dh=$u,yh=eh;for(vd(Xr,mr,$u,cs),mr[2*eh+rh]>uh&&vd(Xr,mr,$u,eh);dh<yh;){for(vd(Xr,mr,dh,yh),dh++,yh--;mr[2*dh+rh]<uh;)dh++;for(;mr[2*yh+rh]>uh;)yh--}mr[2*$u+rh]===uh?vd(Xr,mr,$u,yh):(yh++,vd(Xr,mr,yh,eh)),yh<=cs&&($u=yh+1),cs<=yh&&(eh=yh-1)}}function vd(Xr,mr,cs,$u){qd(Xr,cs,$u),qd(mr,2*cs,2*$u),qd(mr,2*cs+1,2*$u+1)}function qd(Xr,mr,cs){const $u=Xr[mr];Xr[mr]=Xr[cs],Xr[cs]=$u}function Ed(Xr,mr,cs,$u){const eh=Xr-cs,rh=mr-$u;return eh*eh+rh*rh}Co.exports=sh,rl.fromVectorTileJs=sh,rl.fromGeojsonVt=function(Xr,mr){mr=mr||{};var cs={};for(var $u in Xr)cs[$u]=new sl(Xr[$u].features,mr),cs[$u].name=$u,cs[$u].version=mr.version,cs[$u].extent=mr.extent;return sh({layers:cs})},rl.GeoJSONWrapper=sl;const Td=Xr=>Xr[0],Fd=Xr=>Xr[1];class Cd{constructor(mr,cs=Td,$u=Fd,eh=64,rh=Float64Array){this.nodeSize=eh,this.points=mr;const uh=mr.length<65536?Uint16Array:Uint32Array,dh=this.ids=new uh(mr.length),yh=this.coords=new rh(2*mr.length);for(let Ph=0;Ph<mr.length;Ph++)dh[Ph]=Ph,yh[2*Ph]=cs(mr[Ph]),yh[2*Ph+1]=$u(mr[Ph]);Af(dh,yh,eh,0,dh.length-1,0)}range(mr,cs,$u,eh){return function(rh,uh,dh,yh,Ph,Fh,Ad){const wd=[0,rh.length-1,0],Kd=[];let xf,Ff;for(;wd.length;){const rp=wd.pop(),Ah=wd.pop(),Jd=wd.pop();if(Ah-Jd<=Ad){for(let mp=Jd;mp<=Ah;mp++)xf=uh[2*mp],Ff=uh[2*mp+1],xf>=dh&&xf<=Ph&&Ff>=yh&&Ff<=Fh&&Kd.push(rh[mp]);continue}const Od=Math.floor((Jd+Ah)/2);xf=uh[2*Od],Ff=uh[2*Od+1],xf>=dh&&xf<=Ph&&Ff>=yh&&Ff<=Fh&&Kd.push(rh[Od]);const qf=(rp+1)%2;(rp===0?dh<=xf:yh<=Ff)&&(wd.push(Jd),wd.push(Od-1),wd.push(qf)),(rp===0?Ph>=xf:Fh>=Ff)&&(wd.push(Od+1),wd.push(Ah),wd.push(qf))}return Kd}(this.ids,this.coords,mr,cs,$u,eh,this.nodeSize)}within(mr,cs,$u){return function(eh,rh,uh,dh,yh,Ph){const Fh=[0,eh.length-1,0],Ad=[],wd=yh*yh;for(;Fh.length;){const Kd=Fh.pop(),xf=Fh.pop(),Ff=Fh.pop();if(xf-Ff<=Ph){for(let qf=Ff;qf<=xf;qf++)Ed(rh[2*qf],rh[2*qf+1],uh,dh)<=wd&&Ad.push(eh[qf]);continue}const rp=Math.floor((Ff+xf)/2),Ah=rh[2*rp],Jd=rh[2*rp+1];Ed(Ah,Jd,uh,dh)<=wd&&Ad.push(eh[rp]);const Od=(Kd+1)%2;(Kd===0?uh-yh<=Ah:dh-yh<=Jd)&&(Fh.push(Ff),Fh.push(rp-1),Fh.push(Od)),(Kd===0?uh+yh>=Ah:dh+yh>=Jd)&&(Fh.push(rp+1),Fh.push(xf),Fh.push(Od))}return Ad}(this.ids,this.coords,mr,cs,$u,this.nodeSize)}}const Gd={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xr=>Xr},bf=Math.fround||(Id=new Float32Array(1),Xr=>(Id[0]=+Xr,Id[0]));var Id;class td{constructor(mr){this.options=fp(Object.create(Gd),mr),this.trees=new Array(this.options.maxZoom+1)}load(mr){const{log:cs,minZoom:$u,maxZoom:eh,nodeSize:rh}=this.options;cs&&console.time("total time");const uh=`prepare ${mr.length} points`;cs&&console.time(uh),this.points=mr;let dh=[];for(let yh=0;yh<mr.length;yh++)mr[yh].geometry&&dh.push(np(mr[yh],yh));this.trees[eh+1]=new Cd(dh,Qh,Yd,rh,Float32Array),cs&&console.timeEnd(uh);for(let yh=eh;yh>=$u;yh--){const Ph=+Date.now();dh=this._cluster(dh,yh),this.trees[yh]=new Cd(dh,Qh,Yd,rh,Float32Array),cs&&console.log("z%d: %d clusters in %dms",yh,dh.length,+Date.now()-Ph)}return cs&&console.timeEnd("total time"),this}getClusters(mr,cs){let $u=((mr[0]+180)%360+360)%360-180;const eh=Math.max(-90,Math.min(90,mr[1]));let rh=mr[2]===180?180:((mr[2]+180)%360+360)%360-180;const uh=Math.max(-90,Math.min(90,mr[3]));if(mr[2]-mr[0]>=360)$u=-180,rh=180;else if($u>rh){const Fh=this.getClusters([$u,eh,180,uh],cs),Ad=this.getClusters([-180,eh,rh,uh],cs);return Fh.concat(Ad)}const dh=this.trees[this._limitZoom(cs)],yh=dh.range(Qd($u),op(uh),Qd(rh),op(eh)),Ph=[];for(const Fh of yh){const Ad=dh.points[Fh];Ph.push(Ad.numPoints?jf(Ad):this.points[Ad.index])}return Ph}getChildren(mr){const cs=this._getOriginId(mr),$u=this._getOriginZoom(mr),eh="No cluster with the specified id.",rh=this.trees[$u];if(!rh)throw new Error(eh);const uh=rh.points[cs];if(!uh)throw new Error(eh);const dh=this.options.radius/(this.options.extent*Math.pow(2,$u-1)),yh=rh.within(uh.x,uh.y,dh),Ph=[];for(const Fh of yh){const Ad=rh.points[Fh];Ad.parentId===mr&&Ph.push(Ad.numPoints?jf(Ad):this.points[Ad.index])}if(Ph.length===0)throw new Error(eh);return Ph}getLeaves(mr,cs,$u){const eh=[];return this._appendLeaves(eh,mr,cs=cs||10,$u=$u||0,0),eh}getTile(mr,cs,$u){const eh=this.trees[this._limitZoom(mr)],rh=Math.pow(2,mr),{extent:uh,radius:dh}=this.options,yh=dh/uh,Ph=($u-yh)/rh,Fh=($u+1+yh)/rh,Ad={features:[]};return this._addTileFeatures(eh.range((cs-yh)/rh,Ph,(cs+1+yh)/rh,Fh),eh.points,cs,$u,rh,Ad),cs===0&&this._addTileFeatures(eh.range(1-yh/rh,Ph,1,Fh),eh.points,rh,$u,rh,Ad),cs===rh-1&&this._addTileFeatures(eh.range(0,Ph,yh/rh,Fh),eh.points,-1,$u,rh,Ad),Ad.features.length?Ad:null}getClusterExpansionZoom(mr){let cs=this._getOriginZoom(mr)-1;for(;cs<=this.options.maxZoom;){const $u=this.getChildren(mr);if(cs++,$u.length!==1)break;mr=$u[0].properties.cluster_id}return cs}_appendLeaves(mr,cs,$u,eh,rh){const uh=this.getChildren(cs);for(const dh of uh){const yh=dh.properties;if(yh&&yh.cluster?rh+yh.point_count<=eh?rh+=yh.point_count:rh=this._appendLeaves(mr,yh.cluster_id,$u,eh,rh):rh<eh?rh++:mr.push(dh),mr.length===$u)break}return rh}_addTileFeatures(mr,cs,$u,eh,rh,uh){for(const dh of mr){const yh=cs[dh],Ph=yh.numPoints;let Fh,Ad,wd;if(Ph)Fh=yd(yh),Ad=yh.x,wd=yh.y;else{const Ff=this.points[yh.index];Fh=Ff.properties,Ad=Qd(Ff.geometry.coordinates[0]),wd=op(Ff.geometry.coordinates[1])}const Kd={type:1,geometry:[[Math.round(this.options.extent*(Ad*rh-$u)),Math.round(this.options.extent*(wd*rh-eh))]],tags:Fh};let xf;Ph?xf=yh.id:this.options.generateId?xf=yh.index:this.points[yh.index].id&&(xf=this.points[yh.index].id),xf!==void 0&&(Kd.id=xf),uh.features.push(Kd)}}_limitZoom(mr){return Math.max(this.options.minZoom,Math.min(Math.floor(+mr),this.options.maxZoom+1))}_cluster(mr,cs){const $u=[],{radius:eh,extent:rh,reduce:uh,minPoints:dh}=this.options,yh=eh/(rh*Math.pow(2,cs));for(let Ph=0;Ph<mr.length;Ph++){const Fh=mr[Ph];if(Fh.zoom<=cs)continue;Fh.zoom=cs;const Ad=this.trees[cs+1],wd=Ad.within(Fh.x,Fh.y,yh),Kd=Fh.numPoints||1;let xf=Kd;for(const Ff of wd){const rp=Ad.points[Ff];rp.zoom>cs&&(xf+=rp.numPoints||1)}if(xf>Kd&&xf>=dh){let Ff=Fh.x*Kd,rp=Fh.y*Kd,Ah=uh&&Kd>1?this._map(Fh,!0):null;const Jd=(Ph<<5)+(cs+1)+this.points.length;for(const Od of wd){const qf=Ad.points[Od];if(qf.zoom<=cs)continue;qf.zoom=cs;const mp=qf.numPoints||1;Ff+=qf.x*mp,rp+=qf.y*mp,qf.parentId=Jd,uh&&(Ah||(Ah=this._map(Fh,!0)),uh(Ah,this._map(qf)))}Fh.parentId=Jd,$u.push($d(Ff/xf,rp/xf,Jd,xf,Ah))}else if($u.push(Fh),xf>1)for(const Ff of wd){const rp=Ad.points[Ff];rp.zoom<=cs||(rp.zoom=cs,$u.push(rp))}}return $u}_getOriginId(mr){return mr-this.points.length>>5}_getOriginZoom(mr){return(mr-this.points.length)%32}_map(mr,cs){if(mr.numPoints)return cs?fp({},mr.properties):mr.properties;const $u=this.points[mr.index].properties,eh=this.options.map($u);return cs&&eh===$u?fp({},eh):eh}}function $d(Xr,mr,cs,$u,eh){return{x:bf(Xr),y:bf(mr),zoom:1/0,id:cs,parentId:-1,numPoints:$u,properties:eh}}function np(Xr,mr){const[cs,$u]=Xr.geometry.coordinates;return{x:bf(Qd(cs)),y:bf(op($u)),zoom:1/0,index:mr,parentId:-1}}function jf(Xr){return{type:"Feature",id:Xr.id,properties:yd(Xr),geometry:{type:"Point",coordinates:[(mr=Xr.x,360*(mr-.5)),bp(Xr.y)]}};var mr}function yd(Xr){const mr=Xr.numPoints,cs=mr>=1e4?`${Math.round(mr/1e3)}k`:mr>=1e3?Math.round(mr/100)/10+"k":mr;return fp(fp({},Xr.properties),{cluster:!0,cluster_id:Xr.id,point_count:mr,point_count_abbreviated:cs})}function Qd(Xr){return Xr/360+.5}function op(Xr){const mr=Math.sin(Xr*Math.PI/180),cs=.5-.25*Math.log((1+mr)/(1-mr))/Math.PI;return cs<0?0:cs>1?1:cs}function bp(Xr){const mr=(180-360*Xr)*Math.PI/180;return 360*Math.atan(Math.exp(mr))/Math.PI-90}function fp(Xr,mr){for(const cs in mr)Xr[cs]=mr[cs];return Xr}function Qh(Xr){return Xr.x}function Yd(Xr){return Xr.y}function ad(Xr,mr,cs,$u){for(var eh,rh=$u,uh=cs-mr>>1,dh=cs-mr,yh=Xr[mr],Ph=Xr[mr+1],Fh=Xr[cs],Ad=Xr[cs+1],wd=mr+3;wd<cs;wd+=3){var Kd=Zd(Xr[wd],Xr[wd+1],yh,Ph,Fh,Ad);if(Kd>rh)eh=wd,rh=Kd;else if(Kd===rh){var xf=Math.abs(wd-uh);xf<dh&&(eh=wd,dh=xf)}}rh>$u&&(eh-mr>3&&ad(Xr,mr,eh,$u),Xr[eh+2]=rh,cs-eh>3&&ad(Xr,eh,cs,$u))}function Zd(Xr,mr,cs,$u,eh,rh){var uh=eh-cs,dh=rh-$u;if(uh!==0||dh!==0){var yh=((Xr-cs)*uh+(mr-$u)*dh)/(uh*uh+dh*dh);yh>1?(cs=eh,$u=rh):yh>0&&(cs+=uh*yh,$u+=dh*yh)}return(uh=Xr-cs)*uh+(dh=mr-$u)*dh}function Xh(Xr,mr,cs,$u){var eh={id:Xr===void 0?null:Xr,type:mr,geometry:cs,tags:$u,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(rh){var uh=rh.geometry,dh=rh.type;if(dh==="Point"||dh==="MultiPoint"||dh==="LineString")Ld(rh,uh);else if(dh==="Polygon"||dh==="MultiLineString")for(var yh=0;yh<uh.length;yh++)Ld(rh,uh[yh]);else if(dh==="MultiPolygon")for(yh=0;yh<uh.length;yh++)for(var Ph=0;Ph<uh[yh].length;Ph++)Ld(rh,uh[yh][Ph])}(eh),eh}function Ld(Xr,mr){for(var cs=0;cs<mr.length;cs+=3)Xr.minX=Math.min(Xr.minX,mr[cs]),Xr.minY=Math.min(Xr.minY,mr[cs+1]),Xr.maxX=Math.max(Xr.maxX,mr[cs]),Xr.maxY=Math.max(Xr.maxY,mr[cs+1])}function Kf(Xr,mr,cs,$u){if(mr.geometry){var eh=mr.geometry.coordinates,rh=mr.geometry.type,uh=Math.pow(cs.tolerance/((1<<cs.maxZoom)*cs.extent),2),dh=[],yh=mr.id;if(cs.promoteId?yh=mr.properties[cs.promoteId]:cs.generateId&&(yh=$u||0),rh==="Point")If(eh,dh);else if(rh==="MultiPoint")for(var Ph=0;Ph<eh.length;Ph++)If(eh[Ph],dh);else if(rh==="LineString")Df(eh,dh,uh,!1);else if(rh==="MultiLineString"){if(cs.lineMetrics){for(Ph=0;Ph<eh.length;Ph++)Df(eh[Ph],dh=[],uh,!1),Xr.push(Xh(yh,"LineString",dh,mr.properties));return}Jf(eh,dh,uh,!1)}else if(rh==="Polygon")Jf(eh,dh,uh,!0);else{if(rh!=="MultiPolygon"){if(rh==="GeometryCollection"){for(Ph=0;Ph<mr.geometry.geometries.length;Ph++)Kf(Xr,{id:yh,geometry:mr.geometry.geometries[Ph],properties:mr.properties},cs,$u);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ph=0;Ph<eh.length;Ph++){var Fh=[];Jf(eh[Ph],Fh,uh,!0),dh.push(Fh)}}Xr.push(Xh(yh,rh,dh,mr.properties))}}function If(Xr,mr){mr.push(Nf(Xr[0])),mr.push(Wf(Xr[1])),mr.push(0)}function Df(Xr,mr,cs,$u){for(var eh,rh,uh=0,dh=0;dh<Xr.length;dh++){var yh=Nf(Xr[dh][0]),Ph=Wf(Xr[dh][1]);mr.push(yh),mr.push(Ph),mr.push(0),dh>0&&(uh+=$u?(eh*Ph-yh*rh)/2:Math.sqrt(Math.pow(yh-eh,2)+Math.pow(Ph-rh,2))),eh=yh,rh=Ph}var Fh=mr.length-3;mr[2]=1,ad(mr,0,Fh,cs),mr[Fh+2]=1,mr.size=Math.abs(uh),mr.start=0,mr.end=mr.size}function Jf(Xr,mr,cs,$u){for(var eh=0;eh<Xr.length;eh++){var rh=[];Df(Xr[eh],rh,cs,$u),mr.push(rh)}}function Nf(Xr){return Xr/360+.5}function Wf(Xr){var mr=Math.sin(Xr*Math.PI/180),cs=.5-.25*Math.log((1+mr)/(1-mr))/Math.PI;return cs<0?0:cs>1?1:cs}function Cp(Xr,mr,cs,$u,eh,rh,uh,dh){if($u/=mr,rh>=(cs/=mr)&&uh<$u)return Xr;if(uh<cs||rh>=$u)return null;for(var yh=[],Ph=0;Ph<Xr.length;Ph++){var Fh=Xr[Ph],Ad=Fh.geometry,wd=Fh.type,Kd=eh===0?Fh.minX:Fh.minY,xf=eh===0?Fh.maxX:Fh.maxY;if(Kd>=cs&&xf<$u)yh.push(Fh);else if(!(xf<cs||Kd>=$u)){var Ff=[];if(wd==="Point"||wd==="MultiPoint")Tp(Ad,Ff,cs,$u,eh);else if(wd==="LineString")Pp(Ad,Ff,cs,$u,eh,!1,dh.lineMetrics);else if(wd==="MultiLineString")qp(Ad,Ff,cs,$u,eh,!1);else if(wd==="Polygon")qp(Ad,Ff,cs,$u,eh,!0);else if(wd==="MultiPolygon")for(var rp=0;rp<Ad.length;rp++){var Ah=[];qp(Ad[rp],Ah,cs,$u,eh,!0),Ah.length&&Ff.push(Ah)}if(Ff.length){if(dh.lineMetrics&&wd==="LineString"){for(rp=0;rp<Ff.length;rp++)yh.push(Xh(Fh.id,wd,Ff[rp],Fh.tags));continue}wd!=="LineString"&&wd!=="MultiLineString"||(Ff.length===1?(wd="LineString",Ff=Ff[0]):wd="MultiLineString"),wd!=="Point"&&wd!=="MultiPoint"||(wd=Ff.length===3?"Point":"MultiPoint"),yh.push(Xh(Fh.id,wd,Ff,Fh.tags))}}}return yh.length?yh:null}function Tp(Xr,mr,cs,$u,eh){for(var rh=0;rh<Xr.length;rh+=3){var uh=Xr[rh+eh];uh>=cs&&uh<=$u&&(mr.push(Xr[rh]),mr.push(Xr[rh+1]),mr.push(Xr[rh+2]))}}function Pp(Xr,mr,cs,$u,eh,rh,uh){for(var dh,yh,Ph=Yf(Xr),Fh=eh===0?Xd:Op,Ad=Xr.start,wd=0;wd<Xr.length-3;wd+=3){var Kd=Xr[wd],xf=Xr[wd+1],Ff=Xr[wd+2],rp=Xr[wd+3],Ah=Xr[wd+4],Jd=eh===0?Kd:xf,Od=eh===0?rp:Ah,qf=!1;uh&&(dh=Math.sqrt(Math.pow(Kd-rp,2)+Math.pow(xf-Ah,2))),Jd<cs?Od>cs&&(yh=Fh(Ph,Kd,xf,rp,Ah,cs),uh&&(Ph.start=Ad+dh*yh)):Jd>$u?Od<$u&&(yh=Fh(Ph,Kd,xf,rp,Ah,$u),uh&&(Ph.start=Ad+dh*yh)):am(Ph,Kd,xf,Ff),Od<cs&&Jd>=cs&&(yh=Fh(Ph,Kd,xf,rp,Ah,cs),qf=!0),Od>$u&&Jd<=$u&&(yh=Fh(Ph,Kd,xf,rp,Ah,$u),qf=!0),!rh&&qf&&(uh&&(Ph.end=Ad+dh*yh),mr.push(Ph),Ph=Yf(Xr)),uh&&(Ad+=dh)}var mp=Xr.length-3;Kd=Xr[mp],xf=Xr[mp+1],Ff=Xr[mp+2],(Jd=eh===0?Kd:xf)>=cs&&Jd<=$u&&am(Ph,Kd,xf,Ff),mp=Ph.length-3,rh&&mp>=3&&(Ph[mp]!==Ph[0]||Ph[mp+1]!==Ph[1])&&am(Ph,Ph[0],Ph[1],Ph[2]),Ph.length&&mr.push(Ph)}function Yf(Xr){var mr=[];return mr.size=Xr.size,mr.start=Xr.start,mr.end=Xr.end,mr}function qp(Xr,mr,cs,$u,eh,rh){for(var uh=0;uh<Xr.length;uh++)Pp(Xr[uh],mr,cs,$u,eh,rh,!1)}function am(Xr,mr,cs,$u){Xr.push(mr),Xr.push(cs),Xr.push($u)}function Xd(Xr,mr,cs,$u,eh,rh){var uh=(rh-mr)/($u-mr);return Xr.push(rh),Xr.push(cs+(eh-cs)*uh),Xr.push(1),uh}function Op(Xr,mr,cs,$u,eh,rh){var uh=(rh-cs)/(eh-cs);return Xr.push(mr+($u-mr)*uh),Xr.push(rh),Xr.push(1),uh}function nm(Xr,mr){for(var cs=[],$u=0;$u<Xr.length;$u++){var eh,rh=Xr[$u],uh=rh.type;if(uh==="Point"||uh==="MultiPoint"||uh==="LineString")eh=Tm(rh.geometry,mr);else if(uh==="MultiLineString"||uh==="Polygon"){eh=[];for(var dh=0;dh<rh.geometry.length;dh++)eh.push(Tm(rh.geometry[dh],mr))}else if(uh==="MultiPolygon")for(eh=[],dh=0;dh<rh.geometry.length;dh++){for(var yh=[],Ph=0;Ph<rh.geometry[dh].length;Ph++)yh.push(Tm(rh.geometry[dh][Ph],mr));eh.push(yh)}cs.push(Xh(rh.id,uh,eh,rh.tags))}return cs}function Tm(Xr,mr){var cs=[];cs.size=Xr.size,Xr.start!==void 0&&(cs.start=Xr.start,cs.end=Xr.end);for(var $u=0;$u<Xr.length;$u+=3)cs.push(Xr[$u]+mr,Xr[$u+1],Xr[$u+2]);return cs}function hp(Xr,mr){if(Xr.transformed)return Xr;var cs,$u,eh,rh=1<<Xr.z,uh=Xr.x,dh=Xr.y;for(cs=0;cs<Xr.features.length;cs++){var yh=Xr.features[cs],Ph=yh.geometry,Fh=yh.type;if(yh.geometry=[],Fh===1)for($u=0;$u<Ph.length;$u+=2)yh.geometry.push(Em(Ph[$u],Ph[$u+1],mr,rh,uh,dh));else for($u=0;$u<Ph.length;$u++){var Ad=[];for(eh=0;eh<Ph[$u].length;eh+=2)Ad.push(Em(Ph[$u][eh],Ph[$u][eh+1],mr,rh,uh,dh));yh.geometry.push(Ad)}}return Xr.transformed=!0,Xr}function Em(Xr,mr,cs,$u,eh,rh){return[Math.round(cs*(Xr*$u-eh)),Math.round(cs*(mr*$u-rh))]}function Qp(Xr,mr,cs,$u,eh){for(var rh=mr===eh.maxZoom?0:eh.tolerance/((1<<mr)*eh.extent),uh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:cs,y:$u,z:mr,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},dh=0;dh<Xr.length;dh++){uh.numFeatures++,lm(uh,Xr[dh],rh,eh);var yh=Xr[dh].minX,Ph=Xr[dh].minY,Fh=Xr[dh].maxX,Ad=Xr[dh].maxY;yh<uh.minX&&(uh.minX=yh),Ph<uh.minY&&(uh.minY=Ph),Fh>uh.maxX&&(uh.maxX=Fh),Ad>uh.maxY&&(uh.maxY=Ad)}return uh}function lm(Xr,mr,cs,$u){var eh=mr.geometry,rh=mr.type,uh=[];if(rh==="Point"||rh==="MultiPoint")for(var dh=0;dh<eh.length;dh+=3)uh.push(eh[dh]),uh.push(eh[dh+1]),Xr.numPoints++,Xr.numSimplified++;else if(rh==="LineString")Dd(uh,eh,Xr,cs,!1,!1);else if(rh==="MultiLineString"||rh==="Polygon")for(dh=0;dh<eh.length;dh++)Dd(uh,eh[dh],Xr,cs,rh==="Polygon",dh===0);else if(rh==="MultiPolygon")for(var yh=0;yh<eh.length;yh++){var Ph=eh[yh];for(dh=0;dh<Ph.length;dh++)Dd(uh,Ph[dh],Xr,cs,!0,dh===0)}if(uh.length){var Fh=mr.tags||null;if(rh==="LineString"&&$u.lineMetrics){for(var Ad in Fh={},mr.tags)Fh[Ad]=mr.tags[Ad];Fh.mapbox_clip_start=eh.start/eh.size,Fh.mapbox_clip_end=eh.end/eh.size}var wd={geometry:uh,type:rh==="Polygon"||rh==="MultiPolygon"?3:rh==="LineString"||rh==="MultiLineString"?2:1,tags:Fh};mr.id!==null&&(wd.id=mr.id),Xr.features.push(wd)}}function Dd(Xr,mr,cs,$u,eh,rh){var uh=$u*$u;if($u>0&&mr.size<(eh?uh:$u))cs.numPoints+=mr.length/3;else{for(var dh=[],yh=0;yh<mr.length;yh+=3)($u===0||mr[yh+2]>uh)&&(cs.numSimplified++,dh.push(mr[yh]),dh.push(mr[yh+1])),cs.numPoints++;eh&&function(Ph,Fh){for(var Ad=0,wd=0,Kd=Ph.length,xf=Kd-2;wd<Kd;xf=wd,wd+=2)Ad+=(Ph[wd]-Ph[xf])*(Ph[wd+1]+Ph[xf+1]);if(Ad>0===Fh)for(wd=0,Kd=Ph.length;wd<Kd/2;wd+=2){var Ff=Ph[wd],rp=Ph[wd+1];Ph[wd]=Ph[Kd-2-wd],Ph[wd+1]=Ph[Kd-1-wd],Ph[Kd-2-wd]=Ff,Ph[Kd-1-wd]=rp}}(dh,rh),Xr.push(dh)}}function Hf(Xr,mr){var cs=(mr=this.options=function(eh,rh){for(var uh in rh)eh[uh]=rh[uh];return eh}(Object.create(this.options),mr)).debug;if(cs&&console.time("preprocess data"),mr.maxZoom<0||mr.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(mr.promoteId&&mr.generateId)throw new Error("promoteId and generateId cannot be used together.");var $u=function(eh,rh){var uh=[];if(eh.type==="FeatureCollection")for(var dh=0;dh<eh.features.length;dh++)Kf(uh,eh.features[dh],rh,dh);else Kf(uh,eh.type==="Feature"?eh:{geometry:eh},rh);return uh}(Xr,mr);this.tiles={},this.tileCoords=[],cs&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",mr.indexMaxZoom,mr.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$u=function(eh,rh){var uh=rh.buffer/rh.extent,dh=eh,yh=Cp(eh,1,-1-uh,uh,0,-1,2,rh),Ph=Cp(eh,1,1-uh,2+uh,0,-1,2,rh);return(yh||Ph)&&(dh=Cp(eh,1,-uh,1+uh,0,-1,2,rh)||[],yh&&(dh=nm(yh,1).concat(dh)),Ph&&(dh=dh.concat(nm(Ph,-1)))),dh}($u,mr),$u.length&&this.splitTile($u,0,0,0),cs&&($u.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mh(Xr,mr,cs){return 32*((1<<Xr)*cs+mr)+Xr}function Jh(Xr,mr){const cs=Xr.tileID.canonical;if(!this._geoJSONIndex)return mr(null,null);const $u=this._geoJSONIndex.getTile(cs.z,cs.x,cs.y);if(!$u)return mr(null,null);const eh=new Io($u.features);let rh=rl(eh);rh.byteOffset===0&&rh.byteLength===rh.buffer.byteLength||(rh=new Uint8Array(rh)),mr(null,{vectorTile:eh,rawData:rh.buffer})}Hf.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hf.prototype.splitTile=function(Xr,mr,cs,$u,eh,rh,uh){for(var dh=[Xr,mr,cs,$u],yh=this.options,Ph=yh.debug;dh.length;){$u=dh.pop(),cs=dh.pop(),mr=dh.pop(),Xr=dh.pop();var Fh=1<<mr,Ad=mh(mr,cs,$u),wd=this.tiles[Ad];if(!wd&&(Ph>1&&console.time("creation"),wd=this.tiles[Ad]=Qp(Xr,mr,cs,$u,yh),this.tileCoords.push({z:mr,x:cs,y:$u}),Ph)){Ph>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",mr,cs,$u,wd.numFeatures,wd.numPoints,wd.numSimplified),console.timeEnd("creation"));var Kd="z"+mr;this.stats[Kd]=(this.stats[Kd]||0)+1,this.total++}if(wd.source=Xr,eh){if(mr===yh.maxZoom||mr===eh)continue;var xf=1<<eh-mr;if(cs!==Math.floor(rh/xf)||$u!==Math.floor(uh/xf))continue}else if(mr===yh.indexMaxZoom||wd.numPoints<=yh.indexMaxPoints)continue;if(wd.source=null,Xr.length!==0){Ph>1&&console.time("clipping");var Ff,rp,Ah,Jd,Od,qf,mp=.5*yh.buffer/yh.extent,Vp=.5-mp,om=.5+mp,Pd=1+mp;Ff=rp=Ah=Jd=null,Od=Cp(Xr,Fh,cs-mp,cs+om,0,wd.minX,wd.maxX,yh),qf=Cp(Xr,Fh,cs+Vp,cs+Pd,0,wd.minX,wd.maxX,yh),Xr=null,Od&&(Ff=Cp(Od,Fh,$u-mp,$u+om,1,wd.minY,wd.maxY,yh),rp=Cp(Od,Fh,$u+Vp,$u+Pd,1,wd.minY,wd.maxY,yh),Od=null),qf&&(Ah=Cp(qf,Fh,$u-mp,$u+om,1,wd.minY,wd.maxY,yh),Jd=Cp(qf,Fh,$u+Vp,$u+Pd,1,wd.minY,wd.maxY,yh),qf=null),Ph>1&&console.timeEnd("clipping"),dh.push(Ff||[],mr+1,2*cs,2*$u),dh.push(rp||[],mr+1,2*cs,2*$u+1),dh.push(Ah||[],mr+1,2*cs+1,2*$u),dh.push(Jd||[],mr+1,2*cs+1,2*$u+1)}}},Hf.prototype.getTile=function(Xr,mr,cs){var $u=this.options,eh=$u.extent,rh=$u.debug;if(Xr<0||Xr>24)return null;var uh=1<<Xr,dh=mh(Xr,mr=(mr%uh+uh)%uh,cs);if(this.tiles[dh])return hp(this.tiles[dh],eh);rh>1&&console.log("drilling down to z%d-%d-%d",Xr,mr,cs);for(var yh,Ph=Xr,Fh=mr,Ad=cs;!yh&&Ph>0;)Ph--,Fh=Math.floor(Fh/2),Ad=Math.floor(Ad/2),yh=this.tiles[mh(Ph,Fh,Ad)];return yh&&yh.source?(rh>1&&console.log("found parent tile z%d-%d-%d",Ph,Fh,Ad),rh>1&&console.time("drilling down"),this.splitTile(yh.source,Ph,Fh,Ad,Xr,mr,cs),rh>1&&console.timeEnd("drilling down"),this.tiles[dh]?hp(this.tiles[dh],eh):null):null};class Wu extends o.VectorTileWorkerSource{constructor(mr,cs,$u,eh,rh){super(mr,cs,$u,eh,Jh),rh&&(this.loadGeoJSON=rh)}loadData(mr,cs){const $u=mr&&mr.request,eh=$u&&$u.collectResourceTiming;this.loadGeoJSON(mr,(rh,uh)=>{if(rh||!uh)return cs(rh);if(typeof uh!="object")return cs(new Error(`Input data given to '${mr.source}' is not a valid GeoJSON object.`));{nt(uh,!0);try{if(mr.filter){const yh=o.createExpression(mr.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(yh.result==="error")throw new Error(yh.value.map(Fh=>`${Fh.key}: ${Fh.message}`).join(", "));uh={type:"FeatureCollection",features:uh.features.filter(Fh=>yh.value.evaluate({zoom:0},Fh))}}this._geoJSONIndex=mr.cluster?new td(function({superclusterOptions:yh,clusterProperties:Ph}){if(!Ph||!yh)return yh;const Fh={},Ad={},wd={accumulated:null,zoom:0},Kd={properties:null},xf=Object.keys(Ph);for(const Ff of xf){const[rp,Ah]=Ph[Ff],Jd=o.createExpression(Ah),Od=o.createExpression(typeof rp=="string"?[rp,["accumulated"],["get",Ff]]:rp);Fh[Ff]=Jd.value,Ad[Ff]=Od.value}return yh.map=Ff=>{Kd.properties=Ff;const rp={};for(const Ah of xf)rp[Ah]=Fh[Ah].evaluate(wd,Kd);return rp},yh.reduce=(Ff,rp)=>{Kd.properties=rp;for(const Ah of xf)wd.accumulated=Ff[Ah],Ff[Ah]=Ad[Ah].evaluate(wd,Kd)},yh}(mr)).load(uh.features):function(yh,Ph){return new Hf(yh,Ph)}(uh,mr.geojsonVtOptions)}catch(yh){return cs(yh)}this.loaded={};const dh={};if(eh){const yh=o.getPerformanceMeasurement($u);yh&&(dh.resourceTiming={},dh.resourceTiming[mr.source]=JSON.parse(JSON.stringify(yh)))}cs(null,dh)}})}reloadTile(mr,cs){const $u=this.loaded;return $u&&$u[mr.uid]?super.reloadTile(mr,cs):this.loadTile(mr,cs)}loadGeoJSON(mr,cs){if(mr.request)o.getJSON(mr.request,cs);else{if(typeof mr.data!="string")return cs(new Error(`Input data given to '${mr.source}' is not a valid GeoJSON object.`));try{return cs(null,JSON.parse(mr.data))}catch{return cs(new Error(`Input data given to '${mr.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(mr,cs){try{cs(null,this._geoJSONIndex.getClusterExpansionZoom(mr.clusterId))}catch($u){cs($u)}}getClusterChildren(mr,cs){try{cs(null,this._geoJSONIndex.getChildren(mr.clusterId))}catch($u){cs($u)}}getClusterLeaves(mr,cs){try{cs(null,this._geoJSONIndex.getLeaves(mr.clusterId,mr.limit,mr.offset))}catch($u){cs($u)}}}class al{constructor(mr){this.self=mr,this.actor=new o.Actor(mr,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Wu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(cs,$u)=>{if(this.workerSourceTypes[cs])throw new Error(`Worker source with name "${cs}" already registered.`);this.workerSourceTypes[cs]=$u},this.self.registerRTLTextPlugin=cs=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=cs.applyArabicShaping,o.plugin.processBidirectionalText=cs.processBidirectionalText,o.plugin.processStyledBidirectionalText=cs.processStyledBidirectionalText}}clearCaches(mr,cs,$u){delete this.layerIndexes[mr],delete this.availableImages[mr],delete this.workerSources[mr],delete this.demWorkerSources[mr],$u()}checkIfReady(mr,cs,$u){$u()}setReferrer(mr,cs){this.referrer=cs}spriteLoaded(mr,cs){this.isSpriteLoaded[mr]=cs;for(const $u in this.workerSources[mr]){const eh=this.workerSources[mr][$u];for(const rh in eh)eh[rh]instanceof o.VectorTileWorkerSource&&(eh[rh].isSpriteLoaded=cs,eh[rh].fire(new o.Event("isSpriteLoaded")))}}setImages(mr,cs,$u){this.availableImages[mr]=cs;for(const eh in this.workerSources[mr]){const rh=this.workerSources[mr][eh];for(const uh in rh)rh[uh].availableImages=cs}$u()}enableTerrain(mr,cs,$u){this.terrain=cs,$u()}setProjection(mr,cs){this.projections[mr]=o.getProjection(cs)}setLayers(mr,cs,$u){this.getLayerIndex(mr).replace(cs),$u()}updateLayers(mr,cs,$u){this.getLayerIndex(mr).update(cs.layers,cs.removedIds),$u()}loadTile(mr,cs,$u){const eh=this.enableTerrain?o.extend({enableTerrain:this.terrain},cs):cs;eh.projection=this.projections[mr]||this.defaultProjection,this.getWorkerSource(mr,cs.type,cs.source).loadTile(eh,$u)}loadDEMTile(mr,cs,$u){const eh=this.enableTerrain?o.extend({buildQuadTree:this.terrain},cs):cs;this.getDEMWorkerSource(mr,cs.source).loadTile(eh,$u)}reloadTile(mr,cs,$u){const eh=this.enableTerrain?o.extend({enableTerrain:this.terrain},cs):cs;eh.projection=this.projections[mr]||this.defaultProjection,this.getWorkerSource(mr,cs.type,cs.source).reloadTile(eh,$u)}abortTile(mr,cs,$u){this.getWorkerSource(mr,cs.type,cs.source).abortTile(cs,$u)}removeTile(mr,cs,$u){this.getWorkerSource(mr,cs.type,cs.source).removeTile(cs,$u)}removeSource(mr,cs,$u){if(!this.workerSources[mr]||!this.workerSources[mr][cs.type]||!this.workerSources[mr][cs.type][cs.source])return;const eh=this.workerSources[mr][cs.type][cs.source];delete this.workerSources[mr][cs.type][cs.source],eh.removeSource!==void 0?eh.removeSource(cs,$u):$u()}loadWorkerSource(mr,cs,$u){try{this.self.importScripts(cs.url),$u()}catch(eh){$u(eh.toString())}}syncRTLPluginState(mr,cs,$u){try{o.plugin.setState(cs);const eh=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&eh!=null){this.self.importScripts(eh);const rh=o.plugin.isParsed();$u(rh?void 0:new Error(`RTL Text Plugin failed to import scripts from ${eh}`),rh)}}catch(eh){$u(eh.toString())}}getAvailableImages(mr){let cs=this.availableImages[mr];return cs||(cs=[]),cs}getLayerIndex(mr){let cs=this.layerIndexes[mr];return cs||(cs=this.layerIndexes[mr]=new P),cs}getWorkerSource(mr,cs,$u){if(this.workerSources[mr]||(this.workerSources[mr]={}),this.workerSources[mr][cs]||(this.workerSources[mr][cs]={}),!this.workerSources[mr][cs][$u]){const eh={send:(rh,uh,dh,yh,Ph,Fh)=>{this.actor.send(rh,uh,dh,mr,Ph,Fh)},scheduler:this.actor.scheduler};this.workerSources[mr][cs][$u]=new this.workerSourceTypes[cs](eh,this.getLayerIndex(mr),this.getAvailableImages(mr),this.isSpriteLoaded[mr])}return this.workerSources[mr][cs][$u]}getDEMWorkerSource(mr,cs){return this.demWorkerSources[mr]||(this.demWorkerSources[mr]={}),this.demWorkerSources[mr][cs]||(this.demWorkerSources[mr][cs]=new he),this.demWorkerSources[mr][cs]}enforceCacheSizeLimit(mr,cs){o.enforceCacheSizeLimit(cs)}getWorkerPerformanceMetrics(mr,cs,$u){$u(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new al(self)),al}),l(["./shared"],function(o){function x(L,u){if(Array.isArray(L)){if(!Array.isArray(u)||L.length!==u.length)return!1;for(let E=0;E<L.length;E++)if(!x(L[E],u[E]))return!1;return!0}if(typeof L=="object"&&L!==null&&u!==null){if(typeof u!="object"||Object.keys(L).length!==Object.keys(u).length)return!1;for(const E in L)if(!x(L[E],u[E]))return!1;return!0}return L===u}var M=P;function P(L){return!function(u){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var B,ge,St=new Blob([""],{type:"text/javascript"}),_n=URL.createObjectURL(St);try{ge=new Worker(_n),B=!0}catch{B=!1}return ge&&ge.terminate(),URL.revokeObjectURL(_n),B}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var B=document.createElement("canvas");B.width=B.height=1;var ge=B.getContext("2d");if(!ge)return!1;var St=ge.getImageData(0,0,1,1);return St&&St.width===B.width}()?(he[E=u&&u.failIfMajorPerformanceCaveat]===void 0&&(he[E]=function(B){var ge,St=function(_n){var Bn=document.createElement("canvas"),ss=Object.create(P.webGLContextAttributes);return ss.failIfMajorPerformanceCaveat=_n,Bn.getContext("webgl",ss)||Bn.getContext("experimental-webgl",ss)}(B);if(!St)return!1;try{ge=St.createShader(St.VERTEX_SHADER)}catch{return!1}return!(!ge||St.isContextLost())&&(St.shaderSource(ge,"void main() {}"),St.compileShader(ge),St.getShaderParameter(ge,St.COMPILE_STATUS)===!0)}(E)),he[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}(L)}var he={};function nt(L,u,E){const B=o.window.document.createElement(L);return u!==void 0&&(B.className=u),E&&E.appendChild(B),B}function _e(L,u,E){const B=o.window.document.createElementNS("http://www.w3.org/2000/svg",L);for(const ge of Object.keys(u))B.setAttributeNS(null,ge,u[ge]);return E&&E.appendChild(B),B}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bt=o.window.document&&o.window.document.documentElement.style,Fn=Bt&&Bt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let yr;function Io(){Bt&&Fn&&(yr=Bt[Fn],Bt[Fn]="none")}function rl(){Bt&&Fn&&(Bt[Fn]=yr)}function Co(L){L.preventDefault(),L.stopPropagation(),o.window.removeEventListener("click",Co,!0)}function as(){o.window.addEventListener("click",Co,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Co,!0)},0)}function Js(L,u){const E=L.getBoundingClientRect();return Zu(L,E,u)}function lh(L,u){const E=L.getBoundingClientRect(),B=[];for(let ge=0;ge<u.length;ge++)B.push(Zu(L,E,u[ge]));return B}function ch(L){return o.window.InstallTrigger!==void 0&&L.button===2&&L.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:L.button}function Zu(L,u,E){const B=L.offsetWidth===u.width?1:L.offsetWidth/u.width;return new o.pointGeometry((E.clientX-u.left)*B,(E.clientY-u.top)*B)}function th(L,u){var E=u[0],B=u[1],ge=u[2],St=u[3],_n=E*St-ge*B;return _n?(L[0]=St*(_n=1/_n),L[1]=-B*_n,L[2]=-ge*_n,L[3]=E*_n,L):null}function sl(L){const{userImage:u}=L;return!!(u&&u.render&&u.render())&&(L.data.replace(new Uint8Array(u.data.buffer)),!0)}class sh extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:E,callback:B}of this.requestors)this._notify(E,B);this.requestors=[]}}hasImage(u){return!!this.getImage(u)}getImage(u){return this.images[u]}addImage(u,E){this._validate(u,E)&&(this.images[u]=E)}_validate(u,E){let B=!0;return this._validateStretch(E.stretchX,E.data&&E.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchX" value`))),B=!1),this._validateStretch(E.stretchY,E.data&&E.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchY" value`))),B=!1),this._validateContent(E.content,E)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "content" value`))),B=!1),B}_validateStretch(u,E){if(!u)return!0;let B=0;for(const ge of u){if(ge[0]<B||ge[1]<ge[0]||E<ge[1])return!1;B=ge[1]}return!0}_validateContent(u,E){return!(u&&(u.length!==4||u[0]<0||E.data.width<u[0]||u[1]<0||E.data.height<u[1]||u[2]<0||E.data.width<u[2]||u[3]<0||E.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))}updateImage(u,E){E.version=this.images[u].version+1,this.images[u]=E,this.updatedImages[u]=!0}removeImage(u){const E=this.images[u];delete this.images[u],delete this.patterns[u],E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u,E){let B=!0;if(!this.isLoaded())for(const ge of u)this.images[ge]||(B=!1);this.isLoaded()||B?this._notify(u,E):this.requestors.push({ids:u,callback:E})}_notify(u,E){const B={};for(const ge of u){this.images[ge]||this.fire(new o.Event("styleimagemissing",{id:ge}));const St=this.images[ge];St?B[ge]={data:St.data.clone(),pixelRatio:St.pixelRatio,sdf:St.sdf,version:St.version,stretchX:St.stretchX,stretchY:St.stretchY,content:St.content,hasRenderCallback:!!(St.userImage&&St.userImage.render)}:o.warnOnce(`Image "${ge}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}E(null,B)}getPixelSize(){const{width:u,height:E}=this.atlasImage;return{width:u,height:E}}getPattern(u){const E=this.patterns[u],B=this.getImage(u);if(!B)return null;if(E&&E.position.version===B.version)return E.position;if(E)E.position.version=B.version;else{const ge={w:B.data.width+2,h:B.data.height+2,x:0,y:0},St=new o.ImagePosition(ge,B);this.patterns[u]={bin:ge,position:St}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const E=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(u,this.atlasImage,E.RGBA),this.atlasTexture&&this.atlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const St in this.patterns)u.push(this.patterns[St].bin);const{w:E,h:B}=o.potpack(u),ge=this.atlasImage;ge.resize({width:E||1,height:B||1});for(const St in this.patterns){const{bin:_n}=this.patterns[St],Bn=_n.x+1,ss=_n.y+1,tl=this.images[St].data,il=tl.width,Qu=tl.height;o.RGBAImage.copy(tl,ge,{x:0,y:0},{x:Bn,y:ss},{width:il,height:Qu}),o.RGBAImage.copy(tl,ge,{x:0,y:Qu-1},{x:Bn,y:ss-1},{width:il,height:1}),o.RGBAImage.copy(tl,ge,{x:0,y:0},{x:Bn,y:ss+Qu},{width:il,height:1}),o.RGBAImage.copy(tl,ge,{x:il-1,y:0},{x:Bn-1,y:ss},{width:1,height:Qu}),o.RGBAImage.copy(tl,ge,{x:0,y:0},{x:Bn+il,y:ss},{width:1,height:Qu})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const E of u){if(this.callbackDispatchedThisFrame[E])continue;this.callbackDispatchedThisFrame[E]=!0;const B=this.images[E];sl(B)&&this.updateImage(E,B)}}}const xh=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(L,u){return function([E,B,ge]){const St=o.degToRad(B+90),_n=o.degToRad(ge);return{x:E*Math.cos(St)*Math.sin(_n),y:E*Math.sin(St)*Math.sin(_n),z:E*Math.cos(_n),azimuthal:B,polar:ge}}(L.expression.evaluate(u))}interpolate(L,u,E){return{x:o.number(L.x,u.x,E),y:o.number(L.y,u.y,E),z:o.number(L.z,u.z,E),azimuthal:o.number(L.azimuthal,u.azimuthal,E),polar:o.number(L.polar,u.polar,E)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Mh="-transition";class Dh extends o.Evented{constructor(u){super(),this._transitionable=new o.Transitionable(xh),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,E={}){if(!this._validate(o.validateLight,u,E))for(const B in u){const ge=u[B];o.endsWith(B,Mh)?this._transitionable.setTransition(B.slice(0,-Mh.length),ge):this._transitionable.setValue(B,ge)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Uh=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),cd="-transition";class Tf extends o.Evented{constructor(u,E){super(),this._transitionable=new o.Transitionable(Uh),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=E}get(){return this._transitionable.serialize()}set(u){for(const E in u){const B=u[E];o.endsWith(E,cd)?this._transitionable.setTransition(E.slice(0,-cd.length),B):this._transitionable.setValue(E,B)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}}function yf(L,u,E,B){const ge=o.smoothstep(45,65,E),[St,_n]=Af(L,B),Bn=o.length(u);let ss=1-Math.min(1,Math.exp((Bn-St)/(_n-St)*-6));return ss*=ss*ss,ss=Math.min(1,1.00747*ss),ss*ge*L.alpha}function Af(L,u){const E=.5/Math.tan(.5*u);return[L.range[0]+E,L.range[1]+E]}const md=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),vd="-transition";class qd extends o.Evented{constructor(u,E){super(),this._transitionable=new o.Transitionable(md),this.set(u),this._transitioning=this._transitionable.untransitioned(),this._transform=E}get state(){const u=this._transform,E=u.projection.name==="globe",B=o.globeToMercatorTransition(u.zoom),ge=this.properties.get("range"),St=[.5,3];return{range:E?[o.number(St[0],ge[0],B),o.number(St[1],ge[1],B)]:ge,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,E={}){if(!this._validate(o.validateFog,u,E)){for(const B of Object.keys(o.spec.fog))u&&u[B]===void 0&&(u[B]=o.spec.fog[B].default);for(const B in u){const ge=u[B];o.endsWith(B,vd)?this._transitionable.setTransition(B.slice(0,-vd.length),ge):this._transitionable.setValue(B,ge)}}}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const E=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,u))*E.a}getOpacityAtLatLng(u,E){return this._transform.projection.supportsFog?function(B,ge,St){const _n=o.MercatorCoordinate.fromLngLat(ge),Bn=St.elevation?St.elevation.getAtPointOrZero(_n):0,ss=[_n.x,_n.y,Bn];return o.transformMat4(ss,ss,St.mercatorFogMatrix),yf(B,ss,St.pitch,St._fov)}(this.state,u,E):0}getFovAdjustedRange(u){return this._transform.projection.supportsFog?Af(this.state,u):[0,1]}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ed{constructor(u,E){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const B=this.workerPool.acquire(this.id);for(let ge=0;ge<B.length;ge++){const St=new Ed.Actor(B[ge],E,this.id);St.name=`Worker ${ge}`,this.actors.push(St)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(u,E,B){o.asyncAll(this.actors,(ge,St)=>{ge.send(u,E,St)},B=B||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(u=>{u.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Td(L,u,E){return u*(o.EXTENT/(L.tileSize*Math.pow(2,E-L.tileID.overscaledZ)))}Ed.Actor=o.Actor;class Fd{constructor(u,E,B,ge){this.screenBounds=u,this.cameraPoint=E,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=B,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,ge)}static createFromScreenPoints(u,E){let B,ge;if(u instanceof o.pointGeometry||typeof u[0]=="number"){const St=o.pointGeometry.convert(u);B=[St],ge=E.isPointAboveHorizon(St)}else{const St=o.pointGeometry.convert(u[0]),_n=o.pointGeometry.convert(u[1]);B=[St,_n],ge=o.polygonizeBounds(St,_n).every(Bn=>E.isPointAboveHorizon(Bn))}return new Fd(B,E.getCameraPoint(),ge,E)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(u){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],ge=o.polygonizeBounds(E,B,0,!1);return this.cameraPoint.y>B.y&&(this.cameraPoint.x>E.x&&this.cameraPoint.x<B.x?ge.splice(3,0,this.cameraPoint):this.cameraPoint.x>=B.x?ge[2]=this.cameraPoint:this.cameraPoint.x<=E.x&&(ge[3]=this.cameraPoint)),o.bufferConvexPolygon(ge,u)}bufferedCameraGeometryGlobe(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],ge=o.polygonizeBounds(E,B,u),St=this.cameraPoint.clone();switch(3*((St.y>E.y)+(St.y>B.y))+((St.x>E.x)+(St.x>B.x))){case 0:ge[0]=St,ge[4]=St.clone();break;case 1:ge.splice(1,0,St);break;case 2:ge[1]=St;break;case 3:ge.splice(4,0,St);break;case 5:ge.splice(2,0,St);break;case 6:ge[3]=St;break;case 7:ge.splice(3,0,St);break;case 8:ge[2]=St}return ge}containsTile(u,E,B,ge=0){const St=u.queryPadding/E._pixelsPerMercatorPixel+1,_n=B?this._bufferedCameraMercator(St,E):this._bufferedScreenMercator(St,E);let Bn=u.tileID.wrap+(_n.unwrapped?ge:0);const ss=_n.polygon.map(Ih=>o.getTilePoint(u.tileTransform,Ih,Bn));if(!o.polygonIntersectsBox(ss,0,0,o.EXTENT,o.EXTENT))return;Bn=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?ge:0);const tl=this.screenGeometryMercator.polygon.map(Ih=>o.getTileVec3(u.tileTransform,Ih,Bn)),il=tl.map(Ih=>new o.pointGeometry(Ih[0],Ih[1])),Qu=E.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),fh=o.getTileVec3(u.tileTransform,Qu,Bn),wh=tl.map(Ih=>{const hh=o.sub(Ih,Ih,fh);return o.normalize(hh,hh),new o.Ray(fh,hh)}),Th=Td(u,1,E.zoom)*E._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:il,tilespaceRays:wh,bufferedTilespaceGeometry:ss,bufferedTilespaceBounds:(Sh=o.getBounds(ss),Sh.min.x=o.clamp(Sh.min.x,0,o.EXTENT),Sh.min.y=o.clamp(Sh.min.y,0,o.EXTENT),Sh.max.x=o.clamp(Sh.max.x,0,o.EXTENT),Sh.max.y=o.clamp(Sh.max.y,0,o.EXTENT),Sh),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:Th};var Sh}_bufferedScreenMercator(u,E){const B=bf(u);if(this._screenRaycastCache[B])return this._screenRaycastCache[B];{let ge;return ge=E.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(u),E):{polygon:this.bufferedScreenGeometry(u).map(St=>E.pointCoordinate3D(St)),unwrapped:!0},this._screenRaycastCache[B]=ge,ge}}_bufferedCameraMercator(u,E){const B=bf(u);if(this._cameraRaycastCache[B])return this._cameraRaycastCache[B];{let ge;return ge=E.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),E):{polygon:this.bufferedCameraGeometry(u).map(St=>E.pointCoordinate3D(St)),unwrapped:!0},this._cameraRaycastCache[B]=ge,ge}}_projectAndResample(u,E){const B=function(St,_n){const Bn=o.multiply([],_n.pixelMatrix,_n.globeMatrix),ss=[0,-o.GLOBE_RADIUS,0,1],tl=[0,o.GLOBE_RADIUS,0,1],il=[0,0,0,1];o.transformMat4$1(ss,ss,Bn),o.transformMat4$1(tl,tl,Bn),o.transformMat4$1(il,il,Bn);const Qu=new o.pointGeometry(ss[0]/ss[3],ss[1]/ss[3]),fh=new o.pointGeometry(tl[0]/tl[3],tl[1]/tl[3]),wh=o.polygonContainsPoint(St,Qu)&&ss[3]<il[3],Th=o.polygonContainsPoint(St,fh)&&tl[3]<il[3];if(!wh&&!Th)return null;const Sh=function(Hh,ld,xd){for(let gd=1;gd<Hh.length;gd++){const Vf=Gd(ld.pointCoordinate3D(Hh[gd-1]).x),_d=Gd(ld.pointCoordinate3D(Hh[gd]).x);if(xd<0){if(Vf<_d)return{idx:gd,t:-Vf/(_d-1-Vf)}}else if(_d<Vf)return{idx:gd,t:(1-Vf)/(_d+1-Vf)}}return null}(St,_n,wh?-1:1);if(!Sh)return null;const{idx:Ih,t:hh}=Sh;let Oh=Ih>1?Cd(St.slice(0,Ih),_n):[],Rh=Ih<St.length?Cd(St.slice(Ih),_n):[];Oh=Oh.map(Hh=>new o.pointGeometry(Gd(Hh.x),Hh.y)),Rh=Rh.map(Hh=>new o.pointGeometry(Gd(Hh.x),Hh.y));const Nh=[...Oh];Nh.length===0&&Nh.push(Rh[Rh.length-1]);const qh=o.number(Nh[Nh.length-1].y,(Rh.length===0?Oh[0]:Rh[0]).y,hh);let $h;return $h=wh?[new o.pointGeometry(0,qh),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,qh)]:[new o.pointGeometry(1,qh),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,qh)],Nh.push(...$h),Rh.length===0?Nh.push(Oh[0]):Nh.push(...Rh),{polygon:Nh.map(Hh=>new o.MercatorCoordinate(Hh.x,Hh.y)),unwrapped:!1}}(u,E);if(B)return B;const ge=function(St,_n){let Bn=!1,ss=-1/0,tl=0;for(let Qu=0;Qu<St.length-1;Qu++)St[Qu].x>ss&&(ss=St[Qu].x,tl=Qu);for(let Qu=0;Qu<St.length-1;Qu++){const fh=(tl+Qu)%(St.length-1),wh=St[fh],Th=St[fh+1];Math.abs(wh.x-Th.x)>.5&&(wh.x<Th.x?(wh.x+=1,fh===0&&(St[St.length-1].x+=1)):(Th.x+=1,fh+1===St.length-1&&(St[0].x+=1)),Bn=!0)}const il=o.mercatorXfromLng(_n.center.lng);return Bn&&il<Math.abs(il-1)&&St.forEach(Qu=>{Qu.x-=1}),{polygon:St,unwrapped:Bn}}(Cd(u,E).map(St=>new o.pointGeometry(Gd(St.x),St.y)),E);return{polygon:ge.polygon.map(St=>new o.MercatorCoordinate(St.x,St.y)),unwrapped:ge.unwrapped}}}function Cd(L,u){return o.resample(L,E=>{const B=u.pointCoordinate3D(E);E.x=B.x,E.y=B.y},1/256)}function Gd(L){return L<0?1+L%1:L%1}function bf(L){return 100*L|0}function Id(L,u,E,B,ge){const St=function(_n,Bn){if(_n)return ge(_n);if(Bn){L.url&&Bn.tiles&&L.tiles&&delete L.tiles;const ss=o.pick(o.extend(Bn,L),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);Bn.vector_layers&&(ss.vectorLayers=Bn.vector_layers,ss.vectorLayerIds=ss.vectorLayers.map(tl=>tl.id)),ss.tiles=u.canonicalizeTileset(ss,L.url),ge(null,ss)}};return L.url?o.getJSON(u.transformRequest(u.normalizeSourceURL(L.url,null,E,B),o.ResourceType.Source),St):o.exported.frame(()=>St(null,L))}class td{constructor(u,E,B){this.bounds=o.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=E||0,this.maxzoom=B||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const E=Math.pow(2,u.z),B=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*E),ge=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*E),St=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*E),_n=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*E);return u.x>=B&&u.x<St&&u.y>=ge&&u.y<_n}}class $d{constructor(u,E,B){this.context=u;const ge=u.gl;this.buffer=ge.createBuffer(),this.dynamicDraw=!!B,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),ge.bufferData(ge.ELEMENT_ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?ge.DYNAMIC_DRAW:ge.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.context.unbindVAO(),this.bind(),E.bufferSubData(E.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const np={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jf{constructor(u,E,B,ge){this.length=E.length,this.attributes=B,this.itemSize=E.bytesPerElement,this.dynamicDraw=ge,this.context=u;const St=u.gl;this.buffer=St.createBuffer(),u.bindVertexBuffer.set(this.buffer),St.bufferData(St.ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?St.DYNAMIC_DRAW:St.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.bind(),E.bufferSubData(E.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,E){for(let B=0;B<this.attributes.length;B++){const ge=E.attributes[this.attributes[B].name];ge!==void 0&&u.enableVertexAttribArray(ge)}}setVertexAttribPointers(u,E,B){for(let ge=0;ge<this.attributes.length;ge++){const St=this.attributes[ge],_n=E.attributes[St.name];_n!==void 0&&u.vertexAttribPointer(_n,St.components,u[np[St.type]],!1,this.itemSize,St.offset+this.itemSize*(B||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yd{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qd extends yd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class op extends yd{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class bp extends yd{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class fp extends yd{getDefault(){return[!0,!0,!0,!0]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Qh extends yd{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class Yd extends yd{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class ad extends yd{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const E=this.current;(u.func!==E.func||u.ref!==E.ref||u.mask!==E.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class Zd extends yd{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Xh extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.STENCIL_TEST):E.disable(E.STENCIL_TEST),this.current=u,this.dirty=!1}}class Ld extends yd{getDefault(){return[0,1]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class Kf extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.DEPTH_TEST):E.disable(E.DEPTH_TEST),this.current=u,this.dirty=!1}}class If extends yd{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class Df extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.BLEND):E.disable(E.BLEND),this.current=u,this.dirty=!1}}class Jf extends yd{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class Nf extends yd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Wf extends yd{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class Cp extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE),this.current=u,this.dirty=!1}}class Tp extends yd{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class Pp extends yd{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class Yf extends yd{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class qp extends yd{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class am extends yd{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Xd extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindFramebuffer(E.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class Op extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindRenderbuffer(E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class nm extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindTexture(E.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Tm extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindBuffer(E.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class hp extends yd{getDefault(){return null}set(u){const E=this.gl;E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Em extends yd{constructor(u){super(u),this.vao=u.extVertexArrayObject}getDefault(){return null}set(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)}}class Qp extends yd{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class lm extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Dd extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Hf extends yd{constructor(u,E){super(u),this.context=u,this.parent=E}getDefault(){return null}}class mh extends Hf{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Jh extends Hf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferRenderbuffer(E.FRAMEBUFFER,this.attachment(),E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Wu extends Jh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class al{constructor(u,E,B,ge){this.context=u,this.width=E,this.height=B;const St=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new mh(u,St),ge&&(this.depthAttachment=new Jh(u,St))}destroy(){const u=this.context.gl,E=this.colorAttachment.get();if(E&&u.deleteTexture(E),this.depthAttachment){const B=this.depthAttachment.get();B&&u.deleteRenderbuffer(B)}u.deleteFramebuffer(this.framebuffer)}}class Xr{constructor(u,E=!1){if(this.gl=u,this.isWebGL2=E,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),E){const B=u;this.extVertexArrayObject={createVertexArrayOES:B.createVertexArray.bind(u),deleteVertexArrayOES:B.deleteVertexArray.bind(u),bindVertexArrayOES:B.bindVertexArray.bind(u)}}this.clearColor=new Qd(this),this.clearDepth=new op(this),this.clearStencil=new bp(this),this.colorMask=new fp(this),this.depthMask=new Qh(this),this.stencilMask=new Yd(this),this.stencilFunc=new ad(this),this.stencilOp=new Zd(this),this.stencilTest=new Xh(this),this.depthRange=new Ld(this),this.depthTest=new Kf(this),this.depthFunc=new If(this),this.blend=new Df(this),this.blendFunc=new Jf(this),this.blendColor=new Nf(this),this.blendEquation=new Wf(this),this.cullFace=new Cp(this),this.cullFaceSide=new Tp(this),this.frontFace=new Pp(this),this.program=new Yf(this),this.activeTexture=new qp(this),this.viewport=new am(this),this.bindFramebuffer=new Xd(this),this.bindRenderbuffer=new Op(this),this.bindTexture=new nm(this),this.bindVertexBuffer=new Tm(this),this.bindElementBuffer=new hp(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Em(this),this.pixelStoreUnpack=new Qp(this),this.pixelStoreUnpackPremultiplyAlpha=new lm(this),this.pixelStoreUnpackFlipY=new Dd(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),E||(this.extTextureHalfFloat=u.getExtension("OES_texture_half_float")),(E||this.extTextureHalfFloat&&u.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=E||u.getExtension("OES_standard_derivatives"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,E){return new $d(this,u,E)}createVertexBuffer(u,E,B){return new jf(this,u,E,B)}createRenderbuffer(u,E,B){const ge=this.gl,St=ge.createRenderbuffer();return this.bindRenderbuffer.set(St),ge.renderbufferStorage(ge.RENDERBUFFER,u,E,B),this.bindRenderbuffer.set(null),St}createFramebuffer(u,E,B){return new al(this,u,E,B)}clear({color:u,depth:E,stencil:B}){const ge=this.gl;let St=0;u&&(St|=ge.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),E!==void 0&&(St|=ge.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(E),this.depthMask.set(!0)),B!==void 0&&(St|=ge.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),ge.clear(St)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){x(u.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class mr extends o.Evented{constructor(u,E,B,ge){if(super(),this.id=u,this.dispatcher=B,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(E,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},E),this._collectResourceTiming=E.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ge),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const E=Array.isArray(this.map._language)?this.map._language.join():this.map._language,B=this.map._worldview;this._tileJSONRequest=Id(this._options,this.map._requestManager,E,B,(ge,St)=>{this._tileJSONRequest=null,this._loaded=!0,ge?(E&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${E}`),B&&B.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${B}`),this.fire(new o.ErrorEvent(ge))):St&&(o.extend(this,St),St.bounds&&(this.tileBounds=new td(St.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(St.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(ge)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(u,E){const B=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),ge={request:this.map._requestManager.transformRequest(B,o.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(ge.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=E:u.request=u.actor.send("reloadTile",ge,St.bind(this));else if(u.actor=this._tileWorkers[B]=this._tileWorkers[B]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",ge,St.bind(this),void 0,!0);else{const _n=o.loadVectorTile.call({deduped:this._deduped},ge,(Bn,ss)=>{Bn||!ss?St.call(this,Bn):(ge.data={cacheControl:ss.cacheControl,expires:ss.expires,rawData:ss.rawData.slice(0)},u.actor&&u.actor.send("loadTile",ge,St.bind(this),void 0,!0))},!0);u.request={cancel:_n}}function St(_n,Bn){return delete u.request,u.aborted?E(null):_n&&_n.status!==404?E(_n):(Bn&&Bn.resourceTiming&&(u.resourceTiming=Bn.resourceTiming),this.map._refreshExpiredTiles&&Bn&&u.setExpiryData(Bn),u.loadVectorData(Bn,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),E(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class cs extends o.Evented{constructor(u,E,B,ge){super(),this.id=u,this.dispatcher=B,this.setEventedParent(ge),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},E),o.extend(this,o.pick(E,["url","scheme","tileSize"]))}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Id(this._options,this.map._requestManager,null,null,(E,B)=>{this._tileJSONRequest=null,this._loaded=!0,E?this.fire(new o.ErrorEvent(E)):B&&(o.extend(this,B),B.bounds&&(this.tileBounds=new td(B.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(B.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(E)})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,E){const B=o.exported.devicePixelRatio>=2,ge=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),B,this.tileSize);u.request=o.getImage(this.map._requestManager.transformRequest(ge,o.ResourceType.Tile),(St,_n,Bn,ss)=>(delete u.request,u.aborted?(u.state="unloaded",E(null)):St?(u.state="errored",E(St)):_n?(this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:Bn,expires:ss}),u.setTexture(_n,this.map.painter),u.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void E(null)):E(null)))}static loadTileData(u,E,B){u.setTexture(E,B)}static unloadTileData(u,E){u.texture&&E.saveTileTexture(u.texture)}abortTile(u,E){u.request&&(u.request.cancel(),delete u.request),E()}unloadTile(u,E){u.texture&&this.map.painter.saveTileTexture(u.texture),E()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let $u;function eh(L,u,E,B,ge,St,_n,Bn){const ss=[L,E,ge,u,B,St,1,1,1],tl=[_n,Bn,1],il=o.adjoint([],ss),[Qu,fh,wh]=o.transformMat3(tl,tl,o.transpose(il,il));return o.multiply$1(ss,[Qu,0,0,0,fh,0,0,0,wh],ss)}class rh extends o.Evented{constructor(u,E,B,ge){super(),this.id=u,this.dispatcher=B,this.coordinates=E.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ge),this.options=E,this._dirty=!1}load(u,E){this._loaded=E||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(B,ge)=>{if(this._imageRequest=null,this._loaded=!0,B)this.fire(new o.ErrorEvent(B));else if(ge){const{HTMLImageElement:St}=o.window;this.image=ge instanceof St?o.exported.getImageData(ge):ge,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,u&&(this.coordinates=u),this._finishLoading()}})}loaded(){return this._loaded}updateImage(u){return this.image&&u.url?(this._imageRequest&&u.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=u.url,this.load(u.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(u){this.coordinates=u,this._boundsArray=void 0;const E=u.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(B){let ge=1/0,St=1/0,_n=-1/0,Bn=-1/0;for(const Qu of B)ge=Math.min(ge,Qu.x),St=Math.min(St,Qu.y),_n=Math.max(_n,Qu.x),Bn=Math.max(Bn,Qu.y);const ss=Math.max(_n-ge,Bn-St),tl=Math.max(0,Math.floor(-Math.log(ss)/Math.LN2)),il=Math.pow(2,tl);return new o.CanonicalTileID(tl,Math.floor((ge+_n)/2*il),Math.floor((St+Bn)/2*il))}(E),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(u){for(const ss in this.tiles){const tl=this.tiles[ss];tl.state!=="loaded"&&(tl.state="loaded",tl.texture=this.texture)}if(this._boundsArray)return;const E=o.tileTransform(this.tileID,this.map.transform.projection),[B,ge,St,_n]=this.coordinates.map(ss=>{const tl=E.projection.project(ss[0],ss[1]);return o.getTilePoint(E,tl)._round()});this.perspectiveTransform=function(ss,tl,il,Qu,fh,wh,Th,Sh,Ih,hh){const Oh=eh(0,0,ss,0,0,tl,ss,tl),Rh=eh(il,Qu,fh,wh,Th,Sh,Ih,hh);return o.multiply$1(Rh,o.adjoint(Oh,Oh),Rh),[Rh[6]/Rh[8]*ss/o.EXTENT,Rh[7]/Rh[8]*tl/o.EXTENT]}(this.width,this.height,B.x,B.y,ge.x,ge.y,_n.x,_n.y,St.x,St.y);const Bn=this._boundsArray=new o.StructArrayLayout4i8;Bn.emplaceBack(B.x,B.y,0,0),Bn.emplaceBack(ge.x,ge.y,o.EXTENT,0),Bn.emplaceBack(_n.x,_n.y,0,o.EXTENT),Bn.emplaceBack(St.x,St.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=u.createVertexBuffer(Bn,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const u=this.map.painter.context,E=u.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(u,this.image,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(u)}loadTile(u,E){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},E(null)):(u.state="errored",E(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const uh={vector:mr,raster:cs,"raster-dem":class extends cs{constructor(L,u,E,B){super(L,u,E,B),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(L,u){const E=this.map._requestManager.normalizeTileURL(L.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function B(ge,St){ge&&(L.state="errored",u(ge)),St&&(L.dem=St,L.dem.onDeserialize(),L.needsHillshadePrepare=!0,L.needsDEMTextureUpload=!0,L.state="loaded",u(null))}L.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),function(ge,St,_n,Bn){if(delete L.request,L.aborted)L.state="unloaded",u(null);else if(ge)L.state="errored",u(ge);else if(St){this.map._refreshExpiredTiles&&L.setExpiryData({cacheControl:_n,expires:Bn});const ss=o.window.ImageBitmap&&St instanceof o.window.ImageBitmap&&($u==null&&($u=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),$u),tl=1-(St.width-o.prevPowerOfTwo(St.width))/2;tl<1||L.neighboringTiles||(L.neighboringTiles=this._getNeighboringTiles(L.tileID));const il=ss?St:o.exported.getImageData(St,tl),Qu={uid:L.uid,coord:L.tileID,source:this.id,rawImageData:il,encoding:this.encoding,padding:tl};L.actor&&L.state!=="expired"||(L.actor=this.dispatcher.getActor(),L.actor.send("loadDEMTile",Qu,B.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(L){const u=L.canonical,E=Math.pow(2,u.z),B=(u.x-1+E)%E,ge=u.x===0?L.wrap-1:L.wrap,St=(u.x+1+E)%E,_n=u.x+1===E?L.wrap+1:L.wrap,Bn={};return Bn[new o.OverscaledTileID(L.overscaledZ,ge,u.z,B,u.y).key]={backfilled:!1},Bn[new o.OverscaledTileID(L.overscaledZ,_n,u.z,St,u.y).key]={backfilled:!1},u.y>0&&(Bn[new o.OverscaledTileID(L.overscaledZ,ge,u.z,B,u.y-1).key]={backfilled:!1},Bn[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},Bn[new o.OverscaledTileID(L.overscaledZ,_n,u.z,St,u.y-1).key]={backfilled:!1}),u.y+1<E&&(Bn[new o.OverscaledTileID(L.overscaledZ,ge,u.z,B,u.y+1).key]={backfilled:!1},Bn[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},Bn[new o.OverscaledTileID(L.overscaledZ,_n,u.z,St,u.y+1).key]={backfilled:!1}),Bn}unloadTile(L){L.demTexture&&this.map.painter.saveTileTexture(L.demTexture),L.fbo&&(L.fbo.destroy(),delete L.fbo),L.dem&&delete L.dem,delete L.neighboringTiles,L.state="unloaded"}},geojson:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(B),this._data=u.data,this._options=o.extend({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const ge=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*ge,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*ge,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.EXTENT,radius:(u.clusterRadius!==void 0?u.clusterRadius:50)*ge,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}onAdd(L){this.map=L,this.setData(this._data)}setData(L){return this._data=L,this._updateWorkerData(),this}getClusterExpansionZoom(L,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:L,source:this.id},u),this}getClusterChildren(L,u){return this.actor.send("geojson.getClusterChildren",{clusterId:L,source:this.id},u),this}getClusterLeaves(L,u,E,B){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:L,limit:u,offset:E},B),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const L=o.extend({},this.workerOptions),u=this._data;typeof u=="string"?(L.request=this.map._requestManager.transformRequest(o.exported.resolveURL(u),o.ResourceType.Source),L.request.collectResourceTiming=this._collectResourceTiming):L.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,L,(E,B)=>{if(this._loaded=!0,this._pendingLoad=null,E)this.fire(new o.ErrorEvent(E));else{const ge={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&B&&B.resourceTiming&&B.resourceTiming[this.id]&&(ge.resourceTiming=B.resourceTiming[this.id]),this.fire(new o.Event("data",ge)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(L,u){const E=L.actor?"reloadTile":"loadTile";L.actor=this.actor,L.request=this.actor.send(E,{type:this.type,uid:L.uid,tileID:L.tileID,tileZoom:L.tileZoom,zoom:L.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(B,ge)=>(delete L.request,L.unloadVectorData(),L.aborted?u(null):B?u(B):(L.loadVectorData(ge,this.map.painter,E==="reloadTile"),u(null))),void 0,E==="loadTile")}abortTile(L){L.request&&(L.request.cancel(),delete L.request),L.aborted=!0}unloadTile(L){L.unloadVectorData(),this.actor.send("removeTile",{uid:L.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends rh{constructor(L,u,E,B){super(L,u,E,B),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const L=this.options;this.urls=[];for(const u of L.urls)this.urls.push(this.map._requestManager.transformRequest(u,o.ResourceType.Source).url);o.getVideo(this.urls,(u,E)=>{this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):E&&(this.video=E,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(L){if(this.video){const u=this.video.seekable;L<u.start(0)||L>u.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=L}}getVideo(){return this.video}onAdd(L){this.map||(this.map=L,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const L=this.map.painter.context,u=L.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(L,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(L)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:rh,canvas:class extends rh{constructor(L,u,E,B){super(L,u,E,B),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(ge=>!Array.isArray(ge)||ge.length!==2||ge.some(St=>typeof St!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(L){this.map=L,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let L=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,L=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,L=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context;this.texture?(L||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(u,this.canvas,u.gl.RGBA,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const L of[this.canvas.width,this.canvas.height])if(isNaN(L)||L<=0)return!0;return!1}},custom:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="custom",this._dataType="raster",this._dispatcher=E,this._implementation=u,this.setEventedParent(B),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new td(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(L){this._map=L,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(L),this.load()}onRemove(L){this._implementation.onRemove&&this._implementation.onRemove(L)}hasTile(L){if(this._implementation.hasTile){const{x:u,y:E,z:B}=L.canonical;return this._implementation.hasTile({x:u,y:E,z:B})}return!this.tileBounds||this.tileBounds.contains(L.canonical)}loadTile(L,u){const{x:E,y:B,z:ge}=L.tileID.canonical,St=new o.window.AbortController;L.request=Promise.resolve(this._implementation.loadTile({x:E,y:B,z:ge},{signal:St.signal})).then(function(_n){return delete L.request,L.aborted?(L.state="unloaded",u(null)):_n===void 0?(L.state="errored",u(null)):_n===null?(this.loadTileData(L,{width:this.tileSize,height:this.tileSize,data:null}),L.state="loaded",u(null)):function(Bn){return Bn instanceof o.window.ImageData||Bn instanceof o.window.HTMLCanvasElement||Bn instanceof o.window.ImageBitmap||Bn instanceof o.window.HTMLImageElement}(_n)?(this.loadTileData(L,_n),L.state="loaded",void u(null)):(L.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(_n=>{_n.code!==20&&(L.state="errored",u(_n))}),L.request.cancel=()=>St.abort()}loadTileData(L,u){cs.loadTileData(L,u,this._map.painter)}unloadTileData(L){cs.unloadTileData(L,this._map.painter)}unloadTile(L,u){if(this.unloadTileData(L),this._implementation.unloadTile){const{x:E,y:B,z:ge}=L.tileID.canonical;this._implementation.unloadTile({x:E,y:B,z:ge})}u()}abortTile(L,u){L.request&&L.request.cancel&&(L.request.cancel(),delete L.request),u()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(L=>({x:L.canonical.x,y:L.canonical.y,z:L.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},dh=function(L,u,E,B){const ge=new uh[u.type](L,u,E,B);if(ge.id!==L)throw new Error(`Expected Source id to be ${L} instead of ${ge.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],ge),ge};function yh(L,u){const E=o.identity([]);return o.scale(E,E,[.5*L.width,.5*-L.height,1]),o.translate(E,E,[1,-1,0]),o.multiply(E,E,L.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(E)}function Ph(L,u,E,B,ge,St,_n,Bn=!1){const ss=L.tilesIn(B,_n,Bn);ss.sort(Ad);const tl=[];for(const Qu of ss)tl.push({wrappedTileID:Qu.tile.tileID.wrapped().key,queryResults:Qu.tile.queryRenderedFeatures(u,E,L._state,Qu,ge,St,yh(L.transform,Qu.tile.tileID),Bn)});const il=function(Qu){const fh={},wh={};for(const Th of Qu){const Sh=Th.queryResults,Ih=Th.wrappedTileID,hh=wh[Ih]=wh[Ih]||{};for(const Oh in Sh){const Rh=Sh[Oh],Nh=hh[Oh]=hh[Oh]||{},qh=fh[Oh]=fh[Oh]||[];for(const $h of Rh)Nh[$h.featureIndex]||(Nh[$h.featureIndex]=!0,qh.push($h))}}return fh}(tl);for(const Qu in il)il[Qu].forEach(fh=>{const wh=fh.feature,Th=wh.layer;Th&&Th.type!=="background"&&Th.type!=="sky"&&(wh.source=Th.source,Th["source-layer"]&&(wh.sourceLayer=Th["source-layer"]),wh.state=wh.id!==void 0?L.getFeatureState(Th["source-layer"],wh.id):{})});return il}function Fh(L,u){const E=L.getRenderableIds().map(St=>L.getTileByID(St)),B=[],ge={};for(let St=0;St<E.length;St++){const _n=E[St],Bn=_n.tileID.canonical.key;ge[Bn]||(ge[Bn]=!0,_n.querySourceFeatures(B,u))}return B}function Ad(L,u){const E=L.tileID,B=u.tileID;return E.overscaledZ-B.overscaledZ||E.canonical.y-B.canonical.y||E.wrap-B.wrap||E.canonical.x-B.canonical.x}function wd(){return Of.workerClass!=null?new Of.workerClass:new o.window.Worker(Of.workerUrl)}const Kd="mapboxgl_preloaded_worker_pool";class xf{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<xf.workerCount;)this.workers.push(new wd);return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach(E=>{E.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kd]}numActive(){return Object.keys(this.active).length}}let Ff;function rp(){return Ff||(Ff=new xf),Ff}function Ah(L,u){const E={};for(const B in L)B!=="ref"&&(E[B]=L[B]);return o.refProperties.forEach(B=>{B in u&&(E[B]=u[B])}),E}function Jd(L){L=L.slice();const u=Object.create(null);for(let E=0;E<L.length;E++)u[L[E].id]=L[E];for(let E=0;E<L.length;E++)"ref"in L[E]&&(L[E]=Ah(L[E],u[L[E].ref]));return L}xf.workerCount=2;const Od={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qf(L,u,E){E.push({command:Od.addSource,args:[L,u[L]]})}function mp(L,u,E){u.push({command:Od.removeSource,args:[L]}),E[L]=!0}function Vp(L,u,E,B){mp(L,E,B),qf(L,u,E)}function om(L,u,E){let B;for(B in L[E])if(L[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;for(B in u[E])if(u[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;return!0}function Pd(L,u,E,B,ge,St){let _n;for(_n in u=u||{},L=L||{})L.hasOwnProperty(_n)&&(x(L[_n],u[_n])||E.push({command:St,args:[B,_n,u[_n],ge]}));for(_n in u)u.hasOwnProperty(_n)&&!L.hasOwnProperty(_n)&&(x(L[_n],u[_n])||E.push({command:St,args:[B,_n,u[_n],ge]}))}function Hg(L){return L.id}function $m(L,u){return L[u.id]=u,L}class I_{constructor(u,E){this.reset(u,E)}reset(u,E){this.points=u||[],this._distances=[0];for(let B=1;B<this.points.length;B++)this._distances[B]=this._distances[B-1]+this.points[B].dist(this.points[B-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(E||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=o.clamp(u,0,1);let E=1,B=this._distances[E];const ge=u*this.paddedLength+this.padding;for(;B<ge&&E<this._distances.length;)B=this._distances[++E];const St=E-1,_n=this._distances[St],Bn=B-_n,ss=Bn>0?(ge-_n)/Bn:0;return this.points[St].mult(1-ss).add(this.points[E].mult(ss))}}class Dy{constructor(u,E,B){const ge=this.boxCells=[],St=this.circleCells=[];this.xCellCount=Math.ceil(u/B),this.yCellCount=Math.ceil(E/B);for(let _n=0;_n<this.xCellCount*this.yCellCount;_n++)ge.push([]),St.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=E,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/E,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,E,B,ge,St){this._forEachCell(E,B,ge,St,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(E),this.bboxes.push(B),this.bboxes.push(ge),this.bboxes.push(St)}insertCircle(u,E,B,ge){this._forEachCell(E-ge,B-ge,E+ge,B+ge,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(E),this.circles.push(B),this.circles.push(ge)}_insertBoxCell(u,E,B,ge,St,_n){this.boxCells[St].push(_n)}_insertCircleCell(u,E,B,ge,St,_n){this.circleCells[St].push(_n)}_query(u,E,B,ge,St,_n){if(B<0||u>this.width||ge<0||E>this.height)return!St&&[];const Bn=[];if(u<=0&&E<=0&&this.width<=B&&this.height<=ge){if(St)return!0;for(let ss=0;ss<this.boxKeys.length;ss++)Bn.push({key:this.boxKeys[ss],x1:this.bboxes[4*ss],y1:this.bboxes[4*ss+1],x2:this.bboxes[4*ss+2],y2:this.bboxes[4*ss+3]});for(let ss=0;ss<this.circleKeys.length;ss++){const tl=this.circles[3*ss],il=this.circles[3*ss+1],Qu=this.circles[3*ss+2];Bn.push({key:this.circleKeys[ss],x1:tl-Qu,y1:il-Qu,x2:tl+Qu,y2:il+Qu})}return _n?Bn.filter(_n):Bn}return this._forEachCell(u,E,B,ge,this._queryCell,Bn,{hitTest:St,seenUids:{box:{},circle:{}}},_n),St?Bn.length>0:Bn}_queryCircle(u,E,B,ge,St){const _n=u-B,Bn=u+B,ss=E-B,tl=E+B;if(Bn<0||_n>this.width||tl<0||ss>this.height)return!ge&&[];const il=[];return this._forEachCell(_n,ss,Bn,tl,this._queryCellCircle,il,{hitTest:ge,circle:{x:u,y:E,radius:B},seenUids:{box:{},circle:{}}},St),ge?il.length>0:il}query(u,E,B,ge,St){return this._query(u,E,B,ge,!1,St)}hitTest(u,E,B,ge,St){return this._query(u,E,B,ge,!0,St)}hitTestCircle(u,E,B,ge){return this._queryCircle(u,E,B,!0,ge)}_queryCell(u,E,B,ge,St,_n,Bn,ss){const tl=Bn.seenUids,il=this.boxCells[St];if(il!==null){const fh=this.bboxes;for(const wh of il)if(!tl.box[wh]){tl.box[wh]=!0;const Th=4*wh;if(u<=fh[Th+2]&&E<=fh[Th+3]&&B>=fh[Th+0]&&ge>=fh[Th+1]&&(!ss||ss(this.boxKeys[wh]))){if(Bn.hitTest)return _n.push(!0),!0;_n.push({key:this.boxKeys[wh],x1:fh[Th],y1:fh[Th+1],x2:fh[Th+2],y2:fh[Th+3]})}}}const Qu=this.circleCells[St];if(Qu!==null){const fh=this.circles;for(const wh of Qu)if(!tl.circle[wh]){tl.circle[wh]=!0;const Th=3*wh;if(this._circleAndRectCollide(fh[Th],fh[Th+1],fh[Th+2],u,E,B,ge)&&(!ss||ss(this.circleKeys[wh]))){if(Bn.hitTest)return _n.push(!0),!0;{const Sh=fh[Th],Ih=fh[Th+1],hh=fh[Th+2];_n.push({key:this.circleKeys[wh],x1:Sh-hh,y1:Ih-hh,x2:Sh+hh,y2:Ih+hh})}}}}}_queryCellCircle(u,E,B,ge,St,_n,Bn,ss){const tl=Bn.circle,il=Bn.seenUids,Qu=this.boxCells[St];if(Qu!==null){const wh=this.bboxes;for(const Th of Qu)if(!il.box[Th]){il.box[Th]=!0;const Sh=4*Th;if(this._circleAndRectCollide(tl.x,tl.y,tl.radius,wh[Sh+0],wh[Sh+1],wh[Sh+2],wh[Sh+3])&&(!ss||ss(this.boxKeys[Th])))return _n.push(!0),!0}}const fh=this.circleCells[St];if(fh!==null){const wh=this.circles;for(const Th of fh)if(!il.circle[Th]){il.circle[Th]=!0;const Sh=3*Th;if(this._circlesCollide(wh[Sh],wh[Sh+1],wh[Sh+2],tl.x,tl.y,tl.radius)&&(!ss||ss(this.circleKeys[Th])))return _n.push(!0),!0}}}_forEachCell(u,E,B,ge,St,_n,Bn,ss){const tl=this._convertToXCellCoord(u),il=this._convertToYCellCoord(E),Qu=this._convertToXCellCoord(B),fh=this._convertToYCellCoord(ge);for(let wh=tl;wh<=Qu;wh++)for(let Th=il;Th<=fh;Th++)if(St.call(this,u,E,B,ge,this.xCellCount*Th+wh,_n,Bn,ss))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,E,B,ge,St,_n){const Bn=ge-u,ss=St-E,tl=B+_n;return tl*tl>Bn*Bn+ss*ss}_circleAndRectCollide(u,E,B,ge,St,_n,Bn){const ss=(_n-ge)/2,tl=Math.abs(u-(ge+ss));if(tl>ss+B)return!1;const il=(Bn-St)/2,Qu=Math.abs(E-(St+il));if(Qu>il+B)return!1;if(tl<=ss||Qu<=il)return!0;const fh=tl-ss,wh=Qu-il;return fh*fh+wh*wh<=B*B}}const Pg=Math.tan(85*Math.PI/180);function l_(L,u,E,B,ge,St,_n){const Bn=o.create();if(E)if(St.name==="globe"){const ss=o.calculateGlobeLabelMatrix(ge,u);o.multiply(Bn,Bn,ss)}else{const ss=th([],_n);Bn[0]=ss[0],Bn[1]=ss[1],Bn[4]=ss[2],Bn[5]=ss[3],B||o.rotateZ(Bn,Bn,ge.angle)}else o.multiply(Bn,ge.labelPlaneMatrix,L);return Bn}function ev(L,u,E,B,ge,St,_n){const Bn=l_(L,u,E,B,ge,St,_n);return St.name==="globe"&&E||(Bn[2]=Bn[6]=Bn[10]=Bn[14]=0),Bn}function c_(L,u,E,B,ge,St,_n){if(E){if(St.name==="globe"){const Bn=l_(L,u,E,B,ge,St,_n);return o.invert(Bn,Bn),o.multiply(Bn,L,Bn),Bn}{const Bn=o.clone(L),ss=o.identity([]);return ss[0]=_n[0],ss[1]=_n[1],ss[4]=_n[2],ss[5]=_n[3],o.multiply(Bn,Bn,ss),B||o.rotateZ(Bn,Bn,-ge.angle),Bn}}return ge.glCoordMatrix}function ep(L,u,E,B){const ge=[L,u,E,1];E?o.transformMat4$1(ge,ge,B):Gf(ge,ge,B);const St=ge[3];return ge[0]/=St,ge[1]/=St,ge[2]/=St,ge}function im(L,u){return Math.min(.5+L/u*.5,1.5)}function Jp(L,u){const E=L[0]/L[3],B=L[1]/L[3];return E>=-u[0]&&E<=u[0]&&B>=-u[1]&&B<=u[1]}function mm(L,u,E,B,ge,St,_n,Bn,ss,tl){const il=E.transform,Qu=B?L.textSizeData:L.iconSizeData,fh=o.evaluateSizeForZoom(Qu,E.transform.zoom),wh=il.projection.name==="globe",Th=[256/E.width*2+1,256/E.height*2+1],Sh=B?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;Sh.clear();let Ih=null;wh&&(Ih=B?L.text.globeExtVertexArray:L.icon.globeExtVertexArray);const hh=L.lineVertexArray,Oh=B?L.text.placedSymbolArray:L.icon.placedSymbolArray,Rh=E.transform.width/E.transform.height;let Nh,qh=!1;for(let $h=0;$h<Oh.length;$h++){const Hh=Oh.get($h),{numGlyphs:ld,writingMode:xd}=Hh;if(xd!==o.WritingMode.vertical||qh||Nh===o.WritingMode.horizontal||(qh=!0),Nh=xd,(Hh.hidden||xd===o.WritingMode.vertical)&&!qh){sd(ld,Sh);continue}qh=!1;const gd=new o.pointGeometry(Hh.tileAnchorX,Hh.tileAnchorY);let{x:Vf,y:_d,z:Mf}=il.projection.projectTilePoint(gd.x,gd.y,tl.canonical);if(ss){const[rm,Mp,xp]=ss(gd);Vf+=rm,_d+=Mp,Mf+=xp}const Ud=[Vf,_d,Mf,1];if(o.transformMat4$1(Ud,Ud,u),!Jp(Ud,Th)){sd(ld,Sh);continue}const Lf=im(E.transform.cameraToCenterDistance,Ud[3]),Md=o.evaluateSizeForFeature(Qu,fh,Hh),pd=_n?Md/Lf:Md*Lf,Bd=ep(Vf,_d,Mf,ge);if(Bd[3]<=0){sd(ld,Sh);continue}let mf={};const Bf=_n?null:ss,Dp=_h(Hh,pd,!1,Bn,u,ge,St,L.glyphOffsetArray,hh,Sh,Ih,Bd,gd,mf,Rh,Bf,il.projection,tl,_n);qh=Dp.useVertical,Bf&&Dp.needsFlipping&&(mf={}),(Dp.notEnoughRoom||qh||Dp.needsFlipping&&_h(Hh,pd,!0,Bn,u,ge,St,L.glyphOffsetArray,hh,Sh,Ih,Bd,gd,mf,Rh,Bf,il.projection,tl,_n).notEnoughRoom)&&sd(ld,Sh)}B?(L.text.dynamicLayoutVertexBuffer.updateData(Sh),Ih&&L.text.globeExtVertexBuffer.updateData(Ih)):(L.icon.dynamicLayoutVertexBuffer.updateData(Sh),Ih&&L.icon.globeExtVertexBuffer.updateData(Ih))}function kn(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh){const{lineStartIndex:Ih,glyphStartIndex:hh,segment:Oh}=Bn,Rh=hh+Bn.numGlyphs,Nh=Ih+Bn.lineLength,qh=u.getoffsetX(hh),$h=u.getoffsetX(Rh-1),Hh=od(L*qh,E,B,ge,St,_n,Oh,Ih,Nh,ss,tl,il,Qu,fh,!0,wh,Th,Sh);if(!Hh)return null;const ld=od(L*$h,E,B,ge,St,_n,Oh,Ih,Nh,ss,tl,il,Qu,fh,!0,wh,Th,Sh);return ld?{first:Hh,last:ld}:null}function el(L,u,E,B){return L===o.WritingMode.horizontal&&Math.abs(B)>Math.abs(E)?{useVertical:!0}:L===o.WritingMode.vertical?B>0?{needsFlipping:!0}:null:u!==0&&function(ge,St){return ge===0||Math.abs(St/ge)>Pg}(E,B)?u===1?{needsFlipping:!0}:null:E<0?{needsFlipping:!0}:null}function _h(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh,Ih,hh,Oh){const Rh=u/24,Nh=L.lineOffsetX*Rh,qh=L.lineOffsetY*Rh,{lineStartIndex:$h,glyphStartIndex:Hh,numGlyphs:ld,segment:xd,writingMode:gd,flipState:Vf}=L,_d=$h+L.lineLength,Mf=Ud=>{if(il){const[Bd,mf,Bf]=Ud.up,Dp=tl.length;o.updateGlobeVertexNormal(il,Dp+0,Bd,mf,Bf),o.updateGlobeVertexNormal(il,Dp+1,Bd,mf,Bf),o.updateGlobeVertexNormal(il,Dp+2,Bd,mf,Bf),o.updateGlobeVertexNormal(il,Dp+3,Bd,mf,Bf)}const[Lf,Md,pd]=Ud.point;o.addDynamicAttributes(tl,Lf,Md,pd,Ud.angle)};if(ld>1){const Ud=kn(Rh,Bn,Nh,qh,E,Qu,fh,L,ss,St,wh,Sh,!1,Ih,hh,Oh);if(!Ud)return{notEnoughRoom:!0};if(B&&!E){let[Lf,Md,pd]=Ud.first.point,[Bd,mf,Bf]=Ud.last.point;[Lf,Md]=ep(Lf,Md,pd,_n),[Bd,mf]=ep(Bd,mf,Bf,_n);const Dp=el(gd,Vf,(Bd-Lf)*Th,mf-Md);if(L.flipState=Dp&&Dp.needsFlipping?1:2,Dp)return Dp}Mf(Ud.first);for(let Lf=Hh+1;Lf<Hh+ld-1;Lf++){const Md=od(Rh*Bn.getoffsetX(Lf),Nh,qh,E,Qu,fh,xd,$h,_d,ss,St,wh,Sh,!1,!1,Ih,hh,Oh);if(!Md)return tl.length-=4*(Lf-Hh),{notEnoughRoom:!0};Mf(Md)}Mf(Ud.last)}else{if(B&&!E){const Lf=ep(fh.x,fh.y,0,ge),Md=$h+xd+1,pd=new o.pointGeometry(ss.getx(Md),ss.gety(Md)),Bd=ep(pd.x,pd.y,0,ge),mf=Bd[3]>0?Bd:rd(fh,pd,Lf,1,ge,void 0,Ih,hh.canonical),Bf=el(gd,Vf,(mf[0]-Lf[0])*Th,mf[1]-Lf[1]);if(L.flipState=Bf&&Bf.needsFlipping?1:2,Bf)return Bf}const Ud=od(Rh*Bn.getoffsetX(Hh),Nh,qh,E,Qu,fh,xd,$h,_d,ss,St,wh,Sh,!1,!1,Ih,hh,Oh);if(!Ud)return{notEnoughRoom:!0};Mf(Ud)}return{}}function Vh(L,u,E,B,ge){const{x:St,y:_n,z:Bn}=B.projectTilePoint(L.x,L.y,u);if(!ge)return ep(St,_n,Bn,E);const[ss,tl,il]=ge(L);return ep(St+ss,_n+tl,Bn+il,E)}function rd(L,u,E,B,ge,St,_n,Bn){const ss=Vh(L.sub(u)._unit()._add(L),Bn,ge,_n,St);return o.sub(ss,E,ss),o.normalize(ss,ss),o.scaleAndAdd(ss,E,ss,B)}function od(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh,Ih,hh){const Oh=B?L-u:L+u;let Rh=Oh>0?1:-1,Nh=0;B&&(Rh*=-1,Nh=Math.PI),Rh<0&&(Nh+=Math.PI);let qh=Bn+_n+(Rh>0?0:1)|0,$h=ge,Hh=ge,ld=0,xd=0;const gd=Math.abs(Oh),Vf=[],_d=[];let Mf=St,Ud=Mf;const Lf=()=>rd(Ud,Mf,Hh,gd-ld+1,il,fh,Sh,Ih.canonical);for(;ld+xd<=gd;){if(qh+=Rh,qh<Bn||qh>=ss)return null;if(Hh=$h,Ud=Mf,Vf.push(Hh),wh&&_d.push(Ud),Mf=new o.pointGeometry(tl.getx(qh),tl.gety(qh)),$h=Qu[qh],!$h){const xp=Vh(Mf,Ih.canonical,il,Sh,fh);$h=xp[3]>0?Qu[qh]=xp:Lf()}ld+=xd,xd=o.distance(Hh,$h)}Th&&fh&&(Qu[qh]&&($h=Lf(),xd=o.distance(Hh,$h)),Qu[qh]=$h);const Md=(gd-ld)/xd,pd=Mf.sub(Ud)._mult(Md)._add(Ud),Bd=o.sub([],$h,Hh),mf=o.scaleAndAdd([],Hh,Bd,Md);let Bf=[0,0,1],Dp=Bd[0],rm=Bd[1];if(hh&&(Bf=Sh.upVector(Ih.canonical,pd.x,pd.y),Bf[0]!==0||Bf[1]!==0||Bf[2]!==1)){const xp=[Bf[2],0,-Bf[0]],Lp=o.cross([],Bf,xp);o.normalize(xp,xp),o.normalize(Lp,Lp),Dp=o.dot(Bd,xp),rm=o.dot(Bd,Lp)}if(E){const xp=o.cross([],Bf,Bd);o.normalize(xp,xp),o.scaleAndAdd(mf,mf,xp,E*Rh)}const Mp=Nh+Math.atan2(rm,Dp);return Vf.push(mf),wh&&_d.push(pd),{point:mf,angle:Mp,path:Vf,tilePath:_d,up:Bf}}function sd(L,u){const E=u.length,B=E+4*L;u.resize(B),u.float32.fill(-1/0,4*E,4*B)}function Gf(L,u,E){const B=u[0],ge=u[1];return L[0]=E[0]*B+E[4]*ge+E[12],L[1]=E[1]*B+E[5]*ge+E[13],L[3]=E[3]*B+E[7]*ge+E[15],L}const Ef=100;class _p{constructor(u,E,B=new Dy(u.width+200,u.height+200,25),ge=new Dy(u.width+200,u.height+200,25)){this.transform=u,this.grid=B,this.ignoredGrid=ge,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Ef,this.screenBottomBoundary=u.height+Ef,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=E}placeCollisionBox(u,E,B,ge,St,_n,Bn,ss){let tl=B.projectedAnchorX,il=B.projectedAnchorY,Qu=B.projectedAnchorZ;const fh=B.elevation,wh=B.tileID,Th=u.getProjection();if(fh&&wh){const[$h,Hh,ld]=Th.upVector(wh.canonical,B.tileAnchorX,B.tileAnchorY),xd=Th.upVectorScale(wh.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;tl+=$h*fh*xd,il+=Hh*fh*xd,Qu+=ld*fh*xd}const Sh=this.projectAndGetPerspectiveRatio(Bn,tl,il,Qu,B.tileID,Th.name==="globe"||!!fh||this.transform.pitch>0,Th),Ih=_n*Sh.perspectiveRatio,hh=(B.x1*E+ge.x-B.padding)*Ih+Sh.point.x,Oh=(B.y1*E+ge.y-B.padding)*Ih+Sh.point.y,Rh=(B.x2*E+ge.x+B.padding)*Ih+Sh.point.x,Nh=(B.y2*E+ge.y+B.padding)*Ih+Sh.point.y,qh=Sh.perspectiveRatio<=.55||Sh.occluded;return!this.isInsideGrid(hh,Oh,Rh,Nh)||!St&&this.grid.hitTest(hh,Oh,Rh,Nh,ss)||qh?{box:[],offscreen:!1,occluded:Sh.occluded}:{box:[hh,Oh,Rh,Nh],offscreen:this.isOffscreen(hh,Oh,Rh,Nh),occluded:!1}}placeCollisionCircles(u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh){const Ih=[],hh=this.transform.elevation,Oh=u.getProjection(),Rh=hh?hh.getAtTileOffsetFunc(Sh,this.transform.center.lat,this.transform.worldSize,Oh):null,Nh=new o.pointGeometry(B.tileAnchorX,B.tileAnchorY);let{x:qh,y:$h,z:Hh}=Oh.projectTilePoint(Nh.x,Nh.y,Sh.canonical);if(Rh){const[pd,Bd,mf]=Rh(Nh);qh+=pd,$h+=Bd,Hh+=mf}const ld=Oh.name==="globe",xd=this.projectAndGetPerspectiveRatio(Bn,qh,$h,Hh,Sh,ld||!!hh||this.transform.pitch>0,Oh),{perspectiveRatio:gd}=xd,Vf=(Qu?_n/gd:_n*gd)/o.ONE_EM,_d=ep(qh,$h,Hh,ss),Mf=xd.signedDistanceFromCamera>0?kn(Vf,St,B.lineOffsetX*Vf,B.lineOffsetY*Vf,!1,_d,Nh,B,ge,ss,{},hh&&!Qu?Rh:null,Qu&&!!hh,Oh,Sh,Qu):null;let Ud=!1,Lf=!1,Md=!0;if(Mf&&!xd.occluded){const pd=.5*wh*gd+Th,Bd=new o.pointGeometry(-100,-100),mf=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Bf=new I_,{first:Dp,last:rm}=Mf,Mp=Dp.path.length;let xp=[];for(let Fp=Mp-1;Fp>=1;Fp--)xp.push(Dp.path[Fp]);for(let Fp=1;Fp<rm.path.length;Fp++)xp.push(rm.path[Fp]);const Lp=2.5*pd;tl&&(xp=xp.map(([Fp,km,Am],jm)=>(Rh&&!ld&&(Am=Rh(jm<Mp-1?Dp.tilePath[Mp-1-jm]:rm.tilePath[jm-Mp+2])[2]),ep(Fp,km,Am,tl))),xp.some(Fp=>Fp[3]<=0)&&(xp=[]));let dm=[];if(xp.length>0){let Fp=1/0,km=-1/0,Am=1/0,jm=-1/0;for(const Fm of xp)Fp=Math.min(Fp,Fm[0]),Am=Math.min(Am,Fm[1]),km=Math.max(km,Fm[0]),jm=Math.max(jm,Fm[1]);km>=Bd.x&&Fp<=mf.x&&jm>=Bd.y&&Am<=mf.y&&(dm=[xp.map(Fm=>new o.pointGeometry(Fm[0],Fm[1]))],(Fp<Bd.x||km>mf.x||Am<Bd.y||jm>mf.y)&&(dm=o.clipLine(dm,Bd.x,Bd.y,mf.x,mf.y)))}for(const Fp of dm){Bf.reset(Fp,.25*pd);let km=0;km=Bf.length<=.5*pd?1:Math.ceil(Bf.paddedLength/Lp)+1;for(let Am=0;Am<km;Am++){const jm=Am/Math.max(km-1,1),Fm=Bf.lerp(jm),gg=Fm.x+Ef,lg=Fm.y+Ef;Ih.push(gg,lg,pd,0);const My=gg-pd,V0=lg-pd,ig=gg+pd,qm=lg+pd;if(Md=Md&&this.isOffscreen(My,V0,ig,qm),Lf=Lf||this.isInsideGrid(My,V0,ig,qm),!E&&this.grid.hitTestCircle(gg,lg,pd,fh)&&(Ud=!0,!il))return{circles:[],offscreen:!1,collisionDetected:Ud,occluded:!1}}}}return{circles:!il&&Ud||!Lf?[]:Ih,offscreen:Md,collisionDetected:Ud,occluded:xd.occluded}}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const E=[];let B=1/0,ge=1/0,St=-1/0,_n=-1/0;for(const il of u){const Qu=new o.pointGeometry(il.x+Ef,il.y+Ef);B=Math.min(B,Qu.x),ge=Math.min(ge,Qu.y),St=Math.max(St,Qu.x),_n=Math.max(_n,Qu.y),E.push(Qu)}const Bn=this.grid.query(B,ge,St,_n).concat(this.ignoredGrid.query(B,ge,St,_n)),ss={},tl={};for(const il of Bn){const Qu=il.key;if(ss[Qu.bucketInstanceId]===void 0&&(ss[Qu.bucketInstanceId]={}),ss[Qu.bucketInstanceId][Qu.featureIndex])continue;const fh=[new o.pointGeometry(il.x1,il.y1),new o.pointGeometry(il.x2,il.y1),new o.pointGeometry(il.x2,il.y2),new o.pointGeometry(il.x1,il.y2)];o.polygonIntersectsPolygon(E,fh)&&(ss[Qu.bucketInstanceId][Qu.featureIndex]=!0,tl[Qu.bucketInstanceId]===void 0&&(tl[Qu.bucketInstanceId]=[]),tl[Qu.bucketInstanceId].push(Qu.featureIndex))}return tl}insertCollisionBox(u,E,B,ge,St){(E?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:ge,collisionGroupID:St},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,E,B,ge,St){const _n=E?this.ignoredGrid:this.grid,Bn={bucketInstanceId:B,featureIndex:ge,collisionGroupID:St};for(let ss=0;ss<u.length;ss+=4)_n.insertCircle(Bn,u[ss],u[ss+1],u[ss+2])}projectAndGetPerspectiveRatio(u,E,B,ge,St,_n,Bn){const ss=[E,B,ge,1];let tl=!1;if(ge||this.transform.pitch>0){o.transformMat4$1(ss,ss,u);const Qu=Bn.name==="globe";this.fogState&&St&&!Qu&&(tl=function(wh,Th,Sh,Ih,hh,Oh){const Rh=Oh.calculateFogTileMatrix(hh),Nh=[Th,Sh,Ih];return o.transformMat4(Nh,Nh,Rh),yf(wh,Nh,Oh.pitch,Oh._fov)}(this.fogState,E,B,ge,St.toUnwrapped(),this.transform)>.9)}else Gf(ss,ss,u);const il=ss[3];return{point:new o.pointGeometry((ss[0]/il+1)/2*this.transform.width+Ef,(-ss[1]/il+1)/2*this.transform.height+Ef),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(Bn)/il*.5,1.5),signedDistanceFromCamera:il,occluded:_n&&ss[2]>il||tl}}isOffscreen(u,E,B,ge){return B<Ef||u>=this.screenRightBoundary||ge<Ef||E>this.screenBottomBoundary}isInsideGrid(u,E,B,ge){return B>=0&&u<this.gridRightBoundary&&ge>=0&&E<this.gridBottomBoundary}getViewportMatrix(){const u=o.identity([]);return o.translate(u,u,[-100,-100,0]),u}}function sp(L,u,E){const B=u.createTileMatrix(L,L.worldSize,E.toUnwrapped());return o.multiply(new Float32Array(16),L.projMatrix,B)}function lp(L,u,E){if(u.projection.name===E.projection.name)return L.projMatrix;const B=E.clone();return B.setProjection(u.projection),sp(B,u.getProjection(),L)}function Zp(L,u,E){return u.name===E.projection.name?L.projMatrix:sp(E,u,L)}class Rm{constructor(u,E,B,ge){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?E:-E))):ge&&B?1:0,this.placed=B}isHidden(){return this.opacity===0&&!this.placed}}class Yp{constructor(u,E,B,ge,St,_n=!1){this.text=new Rm(u?u.text:null,E,B,St),this.icon=new Rm(u?u.icon:null,E,ge,St),this.clipped=_n}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pm{constructor(u,E,B,ge=!1){this.text=u,this.icon=E,this.skipFade=B,this.clipped=ge}}class kf{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Sp{constructor(u,E,B,ge,St){this.bucketInstanceId=u,this.featureIndex=E,this.sourceLayerIndex=B,this.bucketIndex=ge,this.tileID=St}}class Np{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const E=++this.maxGroupID;this.collisionGroups[u]={ID:E,predicate:B=>B.collisionGroupID===E}}return this.collisionGroups[u]}}function Jm(L,u,E,B,ge){const{horizontalAlign:St,verticalAlign:_n}=o.getAnchorAlignment(L),Bn=-(St-.5)*u,ss=-(_n-.5)*E,tl=o.evaluateVariableOffset(L,B);return new o.pointGeometry(Bn+tl[0]*ge,ss+tl[1]*ge)}function Um(L,u,E,B,ge){const St=new o.pointGeometry(L,u);return E&&St._rotate(B?ge:-ge),St}class bg{constructor(u,E,B,ge,St){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new _p(this.transform,St),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=E,this.retainedQueryData={},this.collisionGroups=new Np(B),this.collisionCircleArrays={},this.prevPlacement=ge,ge&&(ge.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,E,B,ge){const St=B.getBucket(E),_n=B.latestFeatureIndex;if(!St||!_n||E.id!==St.layerIds[0])return;const Bn=St.layers[0].layout,ss=B.collisionBoxArray,tl=Math.pow(2,this.transform.zoom-B.tileID.overscaledZ),il=B.tileSize/o.EXTENT,Qu=B.tileID.toUnwrapped();this.transform.setProjection(St.projection);const fh=(wh=B.tileID,Th=St.getProjection(),Sh=this.transform,Th.name===this.projection?Sh.calculateProjMatrix(wh.toUnwrapped()):sp(Sh,Th,wh));var wh,Th,Sh;const Ih=Bn.get("text-pitch-alignment")==="map",hh=Bn.get("text-rotation-alignment")==="map";E.compileFilter();const Oh=E.dynamicFilter(),Rh=E.dynamicFilterNeedsFeature(),Nh=this.transform.calculatePixelsToTileUnitsMatrix(B),qh=ev(fh,B.tileID.canonical,Ih,hh,this.transform,St.getProjection(),Nh);let $h=null;if(Ih){const xd=c_(fh,B.tileID.canonical,Ih,hh,this.transform,St.getProjection(),Nh);$h=o.multiply([],this.transform.labelPlaneMatrix,xd)}let Hh=null;Oh&&B.latestFeatureIndex&&(Hh={unwrappedTileID:Qu,dynamicFilter:Oh,dynamicFilterNeedsFeature:Rh,featureIndex:B.latestFeatureIndex}),this.retainedQueryData[St.bucketInstanceId]=new Sp(St.bucketInstanceId,_n,St.sourceLayerIndex,St.index,B.tileID);const ld={bucket:St,layout:Bn,posMatrix:fh,textLabelPlaneMatrix:qh,labelToScreenMatrix:$h,clippingData:Hh,scale:tl,textPixelRatio:il,holdingForFade:B.holdingForFade(),collisionBoxArray:ss,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(St.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(St.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(St.sourceID)};if(ge)for(const xd of St.sortKeyRanges){const{sortKey:gd,symbolInstanceStart:Vf,symbolInstanceEnd:_d}=xd;u.push({sortKey:gd,symbolInstanceStart:Vf,symbolInstanceEnd:_d,parameters:ld})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:St.symbolInstances.length,parameters:ld})}attemptAnchorPlacement(u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh,Ih,hh,Oh){const{textOffset0:Rh,textOffset1:Nh,crossTileID:qh}=fh,$h=[Rh,Nh],Hh=Jm(u,B,ge,$h,St),ld=this.collisionIndex.placeCollisionBox(Th,St,E,Um(Hh.x,Hh.y,_n,Bn,this.transform.angle),Qu,ss,tl,il.predicate);if(Ih){const xd=Th.getSymbolInstanceIconSize(Oh,this.transform.zoom,fh.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Th,xd,Ih,Um(Hh.x,Hh.y,_n,Bn,this.transform.angle),Qu,ss,tl,il.predicate).box.length===0)return}if(ld.box.length>0){let xd;return this.prevPlacement&&this.prevPlacement.variableOffsets[qh]&&this.prevPlacement.placements[qh]&&this.prevPlacement.placements[qh].text&&(xd=this.prevPlacement.variableOffsets[qh].anchor),this.variableOffsets[qh]={textOffset:$h,width:B,height:ge,anchor:u,textScale:St,prevAnchor:xd},this.markUsedJustification(Th,u,fh,Sh),Th.allowVerticalPlacement&&(this.markUsedOrientation(Th,Sh,fh),this.placedOrientations[qh]=Sh),{shift:Hh,placedGlyphBoxes:ld}}}placeLayerBucketPart(u,E,B,ge){const{bucket:St,layout:_n,posMatrix:Bn,textLabelPlaneMatrix:ss,labelToScreenMatrix:tl,clippingData:il,textPixelRatio:Qu,holdingForFade:fh,collisionBoxArray:wh,partiallyEvaluatedTextSize:Th,partiallyEvaluatedIconSize:Sh,collisionGroup:Ih}=u.parameters,hh=_n.get("text-optional"),Oh=_n.get("icon-optional"),Rh=_n.get("text-allow-overlap"),Nh=_n.get("icon-allow-overlap"),qh=_n.get("text-rotation-alignment")==="map",$h=_n.get("text-pitch-alignment")==="map",Hh=_n.get("icon-text-fit")!=="none",ld=_n.get("symbol-z-order")==="viewport-y";this.transform.setProjection(St.projection);let xd=Rh&&(Nh||!St.hasIconData()||Oh),gd=Nh&&(Rh||!St.hasTextData()||hh);!St.collisionArrays&&wh&&St.deserializeCollisionBoxes(wh),B&&ge&&St.updateCollisionDebugBuffers(this.transform.zoom,wh);const Vf=(_d,Mf,Ud)=>{const{crossTileID:Lf,numVerticalGlyphVertices:Md}=_d;if(il){const ig={zoom:this.transform.zoom,pitch:this.transform.pitch};let qm=null;if(il.dynamicFilterNeedsFeature){const _m=this.retainedQueryData[St.bucketInstanceId];qm=il.featureIndex.loadFeature({featureIndex:_d.featureIndex,bucketIndex:_m.bucketIndex,sourceLayerIndex:_m.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,il.dynamicFilter)(ig,qm,this.retainedQueryData[St.bucketInstanceId].tileID.canonical,new o.pointGeometry(_d.tileAnchorX,_d.tileAnchorY),this.transform.calculateDistanceTileData(il.unwrappedTileID)))return this.placements[Lf]=new Pm(!1,!1,!1,!0),void(E[Lf]=!0)}if(E[Lf])return;if(fh)return void(this.placements[Lf]=new Pm(!1,!1,!1));let pd=!1,Bd=!1,mf=!0,Bf=!1,Dp=!1,rm=null,Mp={box:null,offscreen:null,occluded:null},xp={box:null,offscreen:null,occluded:null},Lp=null,dm=null,Fp=null,km=0,Am=0,jm=0;Ud.textFeatureIndex?km=Ud.textFeatureIndex:_d.useRuntimeCollisionCircles&&(km=_d.featureIndex),Ud.verticalTextFeatureIndex&&(Am=Ud.verticalTextFeatureIndex);const Fm=ig=>{ig.tileID=this.retainedQueryData[St.bucketInstanceId].tileID;const qm=this.transform.elevation;(qm||ig.elevation)&&(ig.elevation=qm?qm.getAtTileOffset(ig.tileID,ig.tileAnchorX,ig.tileAnchorY):0)},gg=Ud.textBox;if(gg){Fm(gg);const ig=_m=>{let cg=o.WritingMode.horizontal;if(St.allowVerticalPlacement&&!_m&&this.prevPlacement){const r_=this.prevPlacement.placedOrientations[Lf];r_&&(this.placedOrientations[Lf]=r_,cg=r_,this.markUsedOrientation(St,cg,_d))}return cg},qm=(_m,cg)=>{if(St.allowVerticalPlacement&&Md>0&&Ud.verticalTextBox){for(const r_ of St.writingModes)if(r_===o.WritingMode.vertical?(Mp=cg(),xp=Mp):Mp=_m(),Mp&&Mp.box&&Mp.box.length)break}else Mp=_m()};if(_n.get("text-variable-anchor")){let _m=_n.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lf]){const Dm=this.prevPlacement.variableOffsets[Lf];_m.indexOf(Dm.anchor)>0&&(_m=_m.filter(jg=>jg!==Dm.anchor),_m.unshift(Dm.anchor))}const cg=(Dm,jg,y_)=>{const hv=St.getSymbolInstanceTextSize(Th,_d,this.transform.zoom,Mf),Hv=(Dm.x2-Dm.x1)*hv+2*Dm.padding,uy=(Dm.y2-Dm.y1)*hv+2*Dm.padding,Cy=Hh&&!Nh?jg:null;Cy&&Fm(Cy);let G0={box:[],offscreen:!1,occluded:!1};const dv=Rh?2*_m.length:_m.length;for(let I0=0;I0<dv;++I0){const Xv=this.attemptAnchorPlacement(_m[I0%_m.length],Dm,Hv,uy,hv,qh,$h,Qu,Bn,Ih,I0>=_m.length,_d,Mf,St,y_,Cy,Th,Sh);if(Xv&&(G0=Xv.placedGlyphBoxes,G0&&G0.box&&G0.box.length)){pd=!0,rm=Xv.shift;break}}return G0};qm(()=>cg(gg,Ud.iconBox,o.WritingMode.horizontal),()=>{const Dm=Ud.verticalTextBox;return Dm&&Fm(Dm),St.allowVerticalPlacement&&!(Mp&&Mp.box&&Mp.box.length)&&Md>0&&Dm?cg(Dm,Ud.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Mp&&(pd=Mp.box,mf=Mp.offscreen,Bf=Mp.occluded);const r_=ig(Mp&&Mp.box);if(!pd&&this.prevPlacement){const Dm=this.prevPlacement.variableOffsets[Lf];Dm&&(this.variableOffsets[Lf]=Dm,this.markUsedJustification(St,Dm.anchor,_d,r_))}}else{const _m=(cg,r_)=>{const Dm=St.getSymbolInstanceTextSize(Th,_d,this.transform.zoom,Mf),jg=this.collisionIndex.placeCollisionBox(St,Dm,cg,new o.pointGeometry(0,0),Rh,Qu,Bn,Ih.predicate);return jg&&jg.box&&jg.box.length&&(this.markUsedOrientation(St,r_,_d),this.placedOrientations[Lf]=r_),jg};qm(()=>_m(gg,o.WritingMode.horizontal),()=>{const cg=Ud.verticalTextBox;return St.allowVerticalPlacement&&Md>0&&cg?(Fm(cg),_m(cg,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ig(Mp&&Mp.box&&Mp.box.length)}}if(Lp=Mp,pd=Lp&&Lp.box&&Lp.box.length>0,mf=Lp&&Lp.offscreen,Bf=Lp&&Lp.occluded,_d.useRuntimeCollisionCircles){const ig=St.text.placedSymbolArray.get(_d.centerJustifiedTextSymbolIndex>=0?_d.centerJustifiedTextSymbolIndex:_d.verticalPlacedTextSymbolIndex),qm=o.evaluateSizeForFeature(St.textSizeData,Th,ig),_m=_n.get("text-padding");dm=this.collisionIndex.placeCollisionCircles(St,Rh,ig,St.lineVertexArray,St.glyphOffsetArray,qm,Bn,ss,tl,B,$h,Ih.predicate,_d.collisionCircleDiameter*qm/o.ONE_EM,_m,this.retainedQueryData[St.bucketInstanceId].tileID),pd=Rh||dm.circles.length>0&&!dm.collisionDetected,mf=mf&&dm.offscreen,Bf=dm.occluded}if(Ud.iconFeatureIndex&&(jm=Ud.iconFeatureIndex),Ud.iconBox){const ig=qm=>{Fm(qm);const _m=Hh&&rm?Um(rm.x,rm.y,qh,$h,this.transform.angle):new o.pointGeometry(0,0),cg=St.getSymbolInstanceIconSize(Sh,this.transform.zoom,_d.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(St,cg,qm,_m,Nh,Qu,Bn,Ih.predicate)};xp&&xp.box&&xp.box.length&&Ud.verticalIconBox?(Fp=ig(Ud.verticalIconBox),Bd=Fp.box.length>0):(Fp=ig(Ud.iconBox),Bd=Fp.box.length>0),mf=mf&&Fp.offscreen,Dp=Fp.occluded}const lg=hh||_d.numHorizontalGlyphVertices===0&&Md===0,My=Oh||_d.numIconVertices===0;if(lg||My?My?lg||(Bd=Bd&&pd):pd=Bd&&pd:Bd=pd=Bd&&pd,pd&&Lp&&Lp.box&&this.collisionIndex.insertCollisionBox(Lp.box,_n.get("text-ignore-placement"),St.bucketInstanceId,xp&&xp.box&&Am?Am:km,Ih.ID),Bd&&Fp&&this.collisionIndex.insertCollisionBox(Fp.box,_n.get("icon-ignore-placement"),St.bucketInstanceId,jm,Ih.ID),dm&&(pd&&this.collisionIndex.insertCollisionCircles(dm.circles,_n.get("text-ignore-placement"),St.bucketInstanceId,km,Ih.ID),B)){const ig=St.bucketInstanceId;let qm=this.collisionCircleArrays[ig];qm===void 0&&(qm=this.collisionCircleArrays[ig]=new kf);for(let _m=0;_m<dm.circles.length;_m+=4)qm.circles.push(dm.circles[_m+0]),qm.circles.push(dm.circles[_m+1]),qm.circles.push(dm.circles[_m+2]),qm.circles.push(dm.collisionDetected?1:0)}const V0=St.projection.name!=="globe";xd=xd&&(V0||!Bf),gd=gd&&(V0||!Dp),this.placements[Lf]=new Pm(pd||xd,Bd||gd,mf||St.justReloaded),E[Lf]=!0};if(ld){const _d=St.getSortedSymbolIndexes(this.transform.angle);for(let Mf=_d.length-1;Mf>=0;--Mf){const Ud=_d[Mf];Vf(St.symbolInstances.get(Ud),Ud,St.collisionArrays[Ud])}}else for(let _d=u.symbolInstanceStart;_d<u.symbolInstanceEnd;_d++)Vf(St.symbolInstances.get(_d),_d,St.collisionArrays[_d]);if(B&&St.bucketInstanceId in this.collisionCircleArrays){const _d=this.collisionCircleArrays[St.bucketInstanceId];o.invert(_d.invProjMatrix,Bn),_d.viewportMatrix=this.collisionIndex.getViewportMatrix()}St.justReloaded=!1}markUsedJustification(u,E,B,ge){const{leftJustifiedTextSymbolIndex:St,centerJustifiedTextSymbolIndex:_n,rightJustifiedTextSymbolIndex:Bn,verticalPlacedTextSymbolIndex:ss,crossTileID:tl}=B,il=o.getAnchorJustification(E),Qu=ge===o.WritingMode.vertical?ss:il==="left"?St:il==="center"?_n:il==="right"?Bn:-1;St>=0&&(u.text.placedSymbolArray.get(St).crossTileID=Qu>=0&&St!==Qu?0:tl),_n>=0&&(u.text.placedSymbolArray.get(_n).crossTileID=Qu>=0&&_n!==Qu?0:tl),Bn>=0&&(u.text.placedSymbolArray.get(Bn).crossTileID=Qu>=0&&Bn!==Qu?0:tl),ss>=0&&(u.text.placedSymbolArray.get(ss).crossTileID=Qu>=0&&ss!==Qu?0:tl)}markUsedOrientation(u,E,B){const ge=E===o.WritingMode.horizontal||E===o.WritingMode.horizontalOnly?E:0,St=E===o.WritingMode.vertical?E:0,{leftJustifiedTextSymbolIndex:_n,centerJustifiedTextSymbolIndex:Bn,rightJustifiedTextSymbolIndex:ss,verticalPlacedTextSymbolIndex:tl}=B,il=u.text.placedSymbolArray;_n>=0&&(il.get(_n).placedOrientation=ge),Bn>=0&&(il.get(Bn).placedOrientation=ge),ss>=0&&(il.get(ss).placedOrientation=ge),tl>=0&&(il.get(tl).placedOrientation=St)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const E=this.prevPlacement;let B=!1;this.prevZoomAdjustment=E?E.zoomAdjustment(this.transform.zoom):0;const ge=E?E.symbolFadeChange(u):1,St=E?E.opacities:{},_n=E?E.variableOffsets:{},Bn=E?E.placedOrientations:{};for(const ss in this.placements){const tl=this.placements[ss],il=St[ss];il?(this.opacities[ss]=new Yp(il,ge,tl.text,tl.icon,null,tl.clipped),B=B||tl.text!==il.text.placed||tl.icon!==il.icon.placed):(this.opacities[ss]=new Yp(null,ge,tl.text,tl.icon,tl.skipFade,tl.clipped),B=B||tl.text||tl.icon)}for(const ss in St){const tl=St[ss];if(!this.opacities[ss]){const il=new Yp(tl,ge,!1,!1);il.isHidden()||(this.opacities[ss]=il,B=B||tl.text.placed||tl.icon.placed)}}for(const ss in _n)this.variableOffsets[ss]||!this.opacities[ss]||this.opacities[ss].isHidden()||(this.variableOffsets[ss]=_n[ss]);for(const ss in Bn)this.placedOrientations[ss]||!this.opacities[ss]||this.opacities[ss].isHidden()||(this.placedOrientations[ss]=Bn[ss]);B?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=E?E.lastPlacementChangeTime:u)}updateLayerOpacities(u,E){const B={};for(const ge of E){const St=ge.getBucket(u);St&&ge.latestFeatureIndex&&u.id===St.layerIds[0]&&this.updateBucketOpacities(St,B,ge.collisionBoxArray)}}updateBucketOpacities(u,E,B){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const ge=u.layers[0].layout,St=!!u.layers[0].dynamicFilter(),_n=new Yp(null,0,!1,!1,!0),Bn=ge.get("text-allow-overlap"),ss=ge.get("icon-allow-overlap"),tl=ge.get("text-variable-anchor"),il=ge.get("text-rotation-alignment")==="map",Qu=ge.get("text-pitch-alignment")==="map",fh=ge.get("icon-text-fit")!=="none",wh=new Yp(null,0,Bn&&(ss||!u.hasIconData()||ge.get("icon-optional")),ss&&(Bn||!u.hasTextData()||ge.get("text-optional")),!0);!u.collisionArrays&&B&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(B);const Th=(Ih,hh,Oh)=>{for(let Rh=0;Rh<hh/4;Rh++)Ih.opacityVertexArray.emplaceBack(Oh)};let Sh=0;for(let Ih=0;Ih<u.symbolInstances.length;Ih++){const hh=u.symbolInstances.get(Ih),{numHorizontalGlyphVertices:Oh,numVerticalGlyphVertices:Rh,crossTileID:Nh,numIconVertices:qh}=hh;let $h=this.opacities[Nh];E[Nh]?$h=_n:$h||($h=wh,this.opacities[Nh]=$h),E[Nh]=!0;const Hh=Oh>0||Rh>0,ld=qh>0,xd=this.placedOrientations[Nh],gd=xd===o.WritingMode.vertical,Vf=xd===o.WritingMode.horizontal||xd===o.WritingMode.horizontalOnly;if(!Hh&&!ld||$h.isHidden()||Sh++,Hh){const _d=u_($h.text);Th(u.text,Oh,gd?Oy:_d),Th(u.text,Rh,Vf?Oy:_d);const Mf=$h.text.isHidden(),{leftJustifiedTextSymbolIndex:Ud,centerJustifiedTextSymbolIndex:Lf,rightJustifiedTextSymbolIndex:Md,verticalPlacedTextSymbolIndex:pd}=hh,Bd=u.text.placedSymbolArray,mf=Mf||gd?1:0;Ud>=0&&(Bd.get(Ud).hidden=mf),Lf>=0&&(Bd.get(Lf).hidden=mf),Md>=0&&(Bd.get(Md).hidden=mf),pd>=0&&(Bd.get(pd).hidden=Mf||Vf?1:0);const Bf=this.variableOffsets[Nh];Bf&&this.markUsedJustification(u,Bf.anchor,hh,xd);const Dp=this.placedOrientations[Nh];Dp&&(this.markUsedJustification(u,"left",hh,Dp),this.markUsedOrientation(u,Dp,hh))}if(ld){const _d=u_($h.icon),{placedIconSymbolIndex:Mf,verticalPlacedIconSymbolIndex:Ud}=hh,Lf=u.icon.placedSymbolArray,Md=$h.icon.isHidden()?1:0;Mf>=0&&(Th(u.icon,qh,gd?Oy:_d),Lf.get(Mf).hidden=Md),Ud>=0&&(Th(u.icon,hh.numVerticalIconVertices,Vf?Oy:_d),Lf.get(Ud).hidden=Md)}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const _d=u.collisionArrays[Ih];if(_d){let Mf=new o.pointGeometry(0,0),Ud=!0;if(_d.textBox||_d.verticalTextBox){if(tl){const Md=this.variableOffsets[Nh];Md?(Mf=Jm(Md.anchor,Md.width,Md.height,Md.textOffset,Md.textScale),il&&Mf._rotate(Qu?this.transform.angle:-this.transform.angle)):Ud=!1}St&&(Ud=!$h.clipped),_d.textBox&&kg(u.textCollisionBox.collisionVertexArray,$h.text.placed,!Ud||gd,Mf.x,Mf.y),_d.verticalTextBox&&kg(u.textCollisionBox.collisionVertexArray,$h.text.placed,!Ud||Vf,Mf.x,Mf.y)}const Lf=Ud&&!!(!Vf&&_d.verticalIconBox);_d.iconBox&&kg(u.iconCollisionBox.collisionVertexArray,$h.icon.placed,Lf,fh?Mf.x:0,fh?Mf.y:0),_d.verticalIconBox&&kg(u.iconCollisionBox.collisionVertexArray,$h.icon.placed,!Lf,fh?Mf.x:0,fh?Mf.y:0)}}}if(u.fullyClipped=Sh===0,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const Ih=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=Ih.invProjMatrix,u.placementViewportMatrix=Ih.viewportMatrix,u.collisionCircleArray=Ih.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,E){const B=this.zoomAtLastRecencyCheck===E?1-this.zoomAdjustment(E):1;return this.zoomAtLastRecencyCheck=E,this.commitTime+this.fadeDuration*B>u}setStale(){this.stale=!0}}function kg(L,u,E,B,ge){L.emplaceBack(u?1:0,E?1:0,B||0,ge||0),L.emplaceBack(u?1:0,E?1:0,B||0,ge||0),L.emplaceBack(u?1:0,E?1:0,B||0,ge||0),L.emplaceBack(u?1:0,E?1:0,B||0,ge||0)}const Bm=Math.pow(2,25),fy=Math.pow(2,24),Km=Math.pow(2,17),Xg=Math.pow(2,16),Ly=Math.pow(2,9),Ry=Math.pow(2,8),wg=Math.pow(2,1);function u_(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const u=L.placed?1:0,E=Math.floor(127*L.opacity);return E*Bm+u*fy+E*Km+u*Xg+E*Ly+u*Ry+E*wg+u}const Oy=0;class V_{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,E,B,ge,St){const _n=this._bucketParts;for(;this._currentTileIndex<u.length;)if(E.getBucketParts(_n,ge,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,St())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_n.sort((Bn,ss)=>Bn.sortKey-ss.sortKey));this._currentPartIndex<_n.length;){const Bn=_n[this._currentPartIndex];if(E.placeLayerBucketPart(Bn,this._seenCrossTileIDs,B,Bn.symbolInstanceStart===0),this._currentPartIndex++,St())return!0}return!1}}class r0{constructor(u,E,B,ge,St,_n,Bn,ss){this.placement=new bg(u,St,_n,Bn,ss),this._currentPlacementIndex=E.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=ge,this._done=!1}isDone(){return this._done}continuePlacement(u,E,B){const ge=o.exported.now(),St=()=>{const _n=o.exported.now()-ge;return!this._forceFullPlacement&&_n>2};for(;this._currentPlacementIndex>=0;){const _n=E[u[this._currentPlacementIndex]],Bn=this.placement.collisionIndex.transform.zoom;if(_n.type==="symbol"&&(!_n.minzoom||_n.minzoom<=Bn)&&(!_n.maxzoom||_n.maxzoom>Bn)){if(this._inProgressLayer||(this._inProgressLayer=new V_(_n)),this._inProgressLayer.continuePlacement(B[_n.source],this.placement,this._showCollisionBoxes,_n,St))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const O0=512/o.EXTENT/2;class l1{constructor(u,E,B){this.tileID=u,this.indexedSymbolInstances={},this.bucketInstanceId=B;for(let ge=0;ge<E.length;ge++){const St=E.get(ge),_n=St.key;this.indexedSymbolInstances[_n]||(this.indexedSymbolInstances[_n]=[]),this.indexedSymbolInstances[_n].push({crossTileID:St.crossTileID,coord:this.getScaledCoordinates(St,u)})}}getScaledCoordinates(u,E){const B=O0/Math.pow(2,E.canonical.z-this.tileID.canonical.z);return{x:Math.floor((E.canonical.x*o.EXTENT+u.tileAnchorX)*B),y:Math.floor((E.canonical.y*o.EXTENT+u.tileAnchorY)*B)}}findMatches(u,E,B){const ge=this.tileID.canonical.z<E.canonical.z?1:Math.pow(2,this.tileID.canonical.z-E.canonical.z);for(let St=0;St<u.length;St++){const _n=u.get(St);if(_n.crossTileID)continue;const Bn=this.indexedSymbolInstances[_n.key];if(!Bn)continue;const ss=this.getScaledCoordinates(_n,E);for(const tl of Bn)if(Math.abs(tl.coord.x-ss.x)<=ge&&Math.abs(tl.coord.y-ss.y)<=ge&&!B[tl.crossTileID]){B[tl.crossTileID]=!0,_n.crossTileID=tl.crossTileID;break}}}}class tv{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const E=Math.round((u-this.lng)/360);if(E!==0)for(const B in this.indexes){const ge=this.indexes[B],St={};for(const _n in ge){const Bn=ge[_n];Bn.tileID=Bn.tileID.unwrapTo(Bn.tileID.wrap+E),St[Bn.tileID.key]=Bn}this.indexes[B]=St}this.lng=u}addBucket(u,E,B){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===E.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let St=0;St<E.symbolInstances.length;St++)E.symbolInstances.get(St).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const ge=this.usedCrossTileIDs[u.overscaledZ];for(const St in this.indexes){const _n=this.indexes[St];if(Number(St)>u.overscaledZ)for(const Bn in _n){const ss=_n[Bn];ss.tileID.isChildOf(u)&&ss.findMatches(E.symbolInstances,u,ge)}else{const Bn=_n[u.scaledTo(Number(St)).key];Bn&&Bn.findMatches(E.symbolInstances,u,ge)}}for(let St=0;St<E.symbolInstances.length;St++){const _n=E.symbolInstances.get(St);_n.crossTileID||(_n.crossTileID=B.generate(),ge[_n.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new l1(u,E.symbolInstances,E.bucketInstanceId),!0}removeBucketCrossTileIDs(u,E){for(const B in E.indexedSymbolInstances)for(const ge of E.indexedSymbolInstances[B])delete this.usedCrossTileIDs[u][ge.crossTileID]}removeStaleBuckets(u){let E=!1;for(const B in this.indexes){const ge=this.indexes[B];for(const St in ge)u[ge[St].bucketInstanceId]||(this.removeBucketCrossTileIDs(B,ge[St]),delete ge[St],E=!0)}return E}}class o0{constructor(){this.layerIndexes={},this.crossTileIDs=new tv,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,E,B,ge){let St=this.layerIndexes[u.id];St===void 0&&(St=this.layerIndexes[u.id]=new oy);let _n=!1;const Bn={};ge.name!=="globe"&&St.handleWrapJump(B);for(const ss of E){const tl=ss.getBucket(u);tl&&u.id===tl.layerIds[0]&&(tl.bucketInstanceId||(tl.bucketInstanceId=++this.maxBucketInstanceId),St.addBucket(ss.tileID,tl,this.crossTileIDs)&&(_n=!0),Bn[tl.bucketInstanceId]=!0)}return St.removeStaleBuckets(Bn)&&(_n=!0),_n}pruneUnusedLayers(u){const E={};u.forEach(B=>{E[B]=!0});for(const B in this.layerIndexes)E[B]||delete this.layerIndexes[B]}}const By=(L,u)=>o.emitValidationErrors(L,u&&u.filter(E=>E.identifier!=="source.canvas")),py=o.pick(Od,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Vg=o.pick(Od,["setCenter","setZoom","setBearing","setPitch"]),fm={version:8,layers:[],sources:{}},G_={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class eg extends o.Evented{constructor(u,E={}){super(),this.map=u,this.dispatcher=new Ed(rp(),this),this.imageManager=new sh,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(u._requestManager,E.localFontFamily?o.LocalGlyphMode.all:E.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,E.localFontFamily||E.localIdeographFontFamily),this.crossTileSymbolIndex=new o0,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const B=this;this._rtlTextPluginCallback=eg.registerForPluginStateChange(ge=>{B.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ge.pluginStatus,pluginURL:ge.pluginURL},(St,_n)=>{if(o.triggerPluginCompletionEvent(St),_n&&_n.every(Bn=>Bn))for(const Bn in B._sourceCaches){const ss=B._sourceCaches[Bn],tl=ss.getSource().type;tl!=="vector"&&tl!=="geojson"||ss.reload()}})}),this.on("data",ge=>{if(ge.dataType!=="source"||ge.sourceDataType!=="metadata")return;const St=this.getSource(ge.sourceId);if(St&&St.vectorLayerIds)for(const _n in this._layers){const Bn=this._layers[_n];Bn.source===St.id&&this._validateLayer(Bn)}})}loadURL(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const B=typeof E.validate=="boolean"?E.validate:!o.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,E.accessToken);const ge=this.map._requestManager.transformRequest(u,o.ResourceType.Style);this._request=o.getJSON(ge,(St,_n)=>{this._request=null,St?this.fire(new o.ErrorEvent(St)):_n&&this._load(_n,B)})}loadJSON(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(u,E.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(fm,!1)}_updateLayerCount(u,E){const B=E?1:-1;u.is3D()&&(this._num3DLayers+=B),u.type==="circle"&&(this._numCircleLayers+=B),u.type==="symbol"&&(this._numSymbolLayers+=B)}_load(u,E){if(E&&By(this,o.validateStyle(u)))return;this._loaded=!0,this.stylesheet=o.clone$1(u),this._updateMapProjection();for(const ge in u.sources)this.addSource(ge,u.sources[ge],{validate:!1});this._changed=!1,u.sprite?this._loadSprite(u.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(u.glyphs);const B=Jd(this.stylesheet.layers);this._order=B.map(ge=>ge.id),this._layers={},this._serializedLayers={};for(const ge of B){const St=o.createStyleLayer(ge);St.setEventedParent(this,{layer:{id:St.id}}),this._layers[St.id]=St,this._serializedLayers[St.id]=St.serialize(),this._updateLayerCount(St,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Dh(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(u){this._spriteRequest=function(E,B,ge){let St,_n,Bn;const ss=o.exported.devicePixelRatio>1?"@2x":"";let tl=o.getJSON(B.transformRequest(B.normalizeSpriteURL(E,ss,".json"),o.ResourceType.SpriteJSON),(fh,wh)=>{tl=null,Bn||(Bn=fh,St=wh,Qu())}),il=o.getImage(B.transformRequest(B.normalizeSpriteURL(E,ss,".png"),o.ResourceType.SpriteImage),(fh,wh)=>{il=null,Bn||(Bn=fh,_n=wh,Qu())});function Qu(){if(Bn)ge(Bn);else if(St&&_n){const fh=o.exported.getImageData(_n),wh={};for(const Th in St){const{width:Sh,height:Ih,x:hh,y:Oh,sdf:Rh,pixelRatio:Nh,stretchX:qh,stretchY:$h,content:Hh}=St[Th],ld=new o.RGBAImage({width:Sh,height:Ih});o.RGBAImage.copy(fh,ld,{x:hh,y:Oh},{x:0,y:0},{width:Sh,height:Ih}),wh[Th]={data:ld,pixelRatio:Nh,sdf:Rh,stretchX:qh,stretchY:$h,content:Hh}}ge(null,wh)}}return{cancel(){tl&&(tl.cancel(),tl=null),il&&(il.cancel(),il=null)}}}(u,this.map._requestManager,(E,B)=>{if(this._spriteRequest=null,E)this.fire(new o.ErrorEvent(E));else if(B)for(const ge in B)this.imageManager.addImage(ge,B[ge]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(u){const E=this.getSource(u.source);if(!E)return;const B=u.sourceLayer;B&&(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(B)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${B}" does not exist on source "${E.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(u){const E=[];for(const B of u){const ge=this._layers[B];ge.type!=="custom"&&E.push(ge.serialize())}return E}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(u){return!!this.terrain&&(typeof u.isLayerDraped=="function"?u.isLayerDraped():G_[u.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(u){if(!this._loaded)return;const E=this._changed;if(this._changed){const ge=Object.keys(this._updatedLayers),St=Object.keys(this._removedLayers);(ge.length||St.length)&&this._updateWorkerLayers(ge,St);for(const _n in this._updatedSources){const Bn=this._updatedSources[_n];Bn==="reload"?this._reloadSource(_n):Bn==="clear"&&this._clearSource(_n)}this._updateTilesForChangedImages();for(const _n in this._updatedPaintProps)this._layers[_n].updateTransitions(u);this.light.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this._resetUpdates()}const B={};for(const ge in this._sourceCaches){const St=this._sourceCaches[ge];B[ge]=St.used,St.used=!1}for(const ge of this._order){const St=this._layers[ge];if(St.recalculate(u,this._availableImages),!St.isHidden(u.zoom)){const Bn=this._getLayerSourceCache(St);Bn&&(Bn.used=!0)}const _n=this.map.painter;if(_n){const Bn=St.getProgramIds();if(!Bn)continue;const ss=St.getProgramConfiguration(u.zoom);for(const tl of Bn)_n.useProgram(tl,ss)}}for(const ge in B){const St=this._sourceCaches[ge];B[ge]!==St.used&&St.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:St.getSource().id}))}this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),E&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const E in this._sourceCaches)this._sourceCaches[E].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateWorkerLayers(u,E){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:E})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(u){if(this._checkLoaded(),By(this,o.validateStyle(u)))return!1;(u=o.clone$1(u)).layers=Jd(u.layers);const E=function(ge,St){if(!ge)return[{command:Od.setStyle,args:[St]}];let _n=[];try{if(!x(ge.version,St.version))return[{command:Od.setStyle,args:[St]}];x(ge.center,St.center)||_n.push({command:Od.setCenter,args:[St.center]}),x(ge.zoom,St.zoom)||_n.push({command:Od.setZoom,args:[St.zoom]}),x(ge.bearing,St.bearing)||_n.push({command:Od.setBearing,args:[St.bearing]}),x(ge.pitch,St.pitch)||_n.push({command:Od.setPitch,args:[St.pitch]}),x(ge.sprite,St.sprite)||_n.push({command:Od.setSprite,args:[St.sprite]}),x(ge.glyphs,St.glyphs)||_n.push({command:Od.setGlyphs,args:[St.glyphs]}),x(ge.transition,St.transition)||_n.push({command:Od.setTransition,args:[St.transition]}),x(ge.light,St.light)||_n.push({command:Od.setLight,args:[St.light]}),x(ge.fog,St.fog)||_n.push({command:Od.setFog,args:[St.fog]}),x(ge.projection,St.projection)||_n.push({command:Od.setProjection,args:[St.projection]});const Bn={},ss=[];(function(Qu,fh,wh,Th){let Sh;for(Sh in fh=fh||{},Qu=Qu||{})Qu.hasOwnProperty(Sh)&&(fh.hasOwnProperty(Sh)||mp(Sh,wh,Th));for(Sh in fh){if(!fh.hasOwnProperty(Sh))continue;const Ih=fh[Sh];Qu.hasOwnProperty(Sh)?x(Qu[Sh],Ih)||(Qu[Sh].type==="geojson"&&Ih.type==="geojson"&&om(Qu,fh,Sh)?wh.push({command:Od.setGeoJSONSourceData,args:[Sh,Ih.data]}):Vp(Sh,fh,wh,Th)):qf(Sh,fh,wh)}})(ge.sources,St.sources,ss,Bn);const tl=[];ge.layers&&ge.layers.forEach(Qu=>{Qu.source&&Bn[Qu.source]?_n.push({command:Od.removeLayer,args:[Qu.id]}):tl.push(Qu)});let il=ge.terrain;il&&Bn[il.source]&&(_n.push({command:Od.setTerrain,args:[void 0]}),il=void 0),_n=_n.concat(ss),x(il,St.terrain)||_n.push({command:Od.setTerrain,args:[St.terrain]}),function(Qu,fh,wh){fh=fh||[];const Th=(Qu=Qu||[]).map(Hg),Sh=fh.map(Hg),Ih=Qu.reduce($m,{}),hh=fh.reduce($m,{}),Oh=Th.slice(),Rh=Object.create(null);let Nh,qh,$h,Hh,ld,xd,gd;for(Nh=0,qh=0;Nh<Th.length;Nh++)$h=Th[Nh],hh.hasOwnProperty($h)?qh++:(wh.push({command:Od.removeLayer,args:[$h]}),Oh.splice(Oh.indexOf($h,qh),1));for(Nh=0,qh=0;Nh<Sh.length;Nh++)$h=Sh[Sh.length-1-Nh],Oh[Oh.length-1-Nh]!==$h&&(Ih.hasOwnProperty($h)?(wh.push({command:Od.removeLayer,args:[$h]}),Oh.splice(Oh.lastIndexOf($h,Oh.length-qh),1)):qh++,xd=Oh[Oh.length-Nh],wh.push({command:Od.addLayer,args:[hh[$h],xd]}),Oh.splice(Oh.length-Nh,0,$h),Rh[$h]=!0);for(Nh=0;Nh<Sh.length;Nh++)if($h=Sh[Nh],Hh=Ih[$h],ld=hh[$h],!Rh[$h]&&!x(Hh,ld))if(x(Hh.source,ld.source)&&x(Hh["source-layer"],ld["source-layer"])&&x(Hh.type,ld.type)){for(gd in Pd(Hh.layout,ld.layout,wh,$h,null,Od.setLayoutProperty),Pd(Hh.paint,ld.paint,wh,$h,null,Od.setPaintProperty),x(Hh.filter,ld.filter)||wh.push({command:Od.setFilter,args:[$h,ld.filter]}),x(Hh.minzoom,ld.minzoom)&&x(Hh.maxzoom,ld.maxzoom)||wh.push({command:Od.setLayerZoomRange,args:[$h,ld.minzoom,ld.maxzoom]}),Hh)Hh.hasOwnProperty(gd)&&gd!=="layout"&&gd!=="paint"&&gd!=="filter"&&gd!=="metadata"&&gd!=="minzoom"&&gd!=="maxzoom"&&(gd.indexOf("paint.")===0?Pd(Hh[gd],ld[gd],wh,$h,gd.slice(6),Od.setPaintProperty):x(Hh[gd],ld[gd])||wh.push({command:Od.setLayerProperty,args:[$h,gd,ld[gd]]}));for(gd in ld)ld.hasOwnProperty(gd)&&!Hh.hasOwnProperty(gd)&&gd!=="layout"&&gd!=="paint"&&gd!=="filter"&&gd!=="metadata"&&gd!=="minzoom"&&gd!=="maxzoom"&&(gd.indexOf("paint.")===0?Pd(Hh[gd],ld[gd],wh,$h,gd.slice(6),Od.setPaintProperty):x(Hh[gd],ld[gd])||wh.push({command:Od.setLayerProperty,args:[$h,gd,ld[gd]]}))}else wh.push({command:Od.removeLayer,args:[$h]}),xd=Oh[Oh.lastIndexOf($h)+1],wh.push({command:Od.addLayer,args:[ld,xd]})}(tl,St.layers,_n)}catch(Bn){console.warn("Unable to compute style diff:",Bn),_n=[{command:Od.setStyle,args:[St]}]}return _n}(this.serialize(),u).filter(ge=>!(ge.command in Vg));if(E.length===0)return!1;const B=E.filter(ge=>!(ge.command in py));if(B.length>0)throw new Error(`Unimplemented: ${B.map(ge=>ge.command).join(", ")}.`);return E.forEach(ge=>{ge.command!=="setTransition"&&ge.command!=="setProjection"&&this[ge.command].apply(this,ge.args)}),this.stylesheet=u,this._updateMapProjection(),!0}addImage(u,E){return this.getImage(u)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(u,E),this._afterImageUpdated(u),this)}updateImage(u,E){this.imageManager.updateImage(u,E)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u),this._afterImageUpdated(u),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(u,E,B={}){if(this._checkLoaded(),this.getSource(u)!==void 0)throw new Error("There is already a source with this ID");if(!E.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(E).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(E.type)>=0&&this._validate(o.validateSource,`sources.${u}`,E,null,B))return;this.map&&this.map._collectResourceTiming&&(E.collectResourceTiming=!0);const ge=dh(u,E,this.dispatcher,this);ge.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(u),source:ge.serialize(),sourceId:u}));const St=_n=>{const Bn=(_n?"symbol:":"other:")+u,ss=this._sourceCaches[Bn]=new o.SourceCache(Bn,ge,_n);(_n?this._symbolSourceCaches:this._otherSourceCaches)[u]=ss,ss.style=this,ss.onAdd(this.map)};St(!1),E.type!=="vector"&&E.type!=="geojson"||St(!0),ge.onAdd&&ge.onAdd(this.map),this._changed=!0}removeSource(u){this._checkLoaded();const E=this.getSource(u);if(!E)throw new Error("There is no source with this ID");for(const ge in this._layers)if(this._layers[ge].source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while layer "${ge}" is using it.`)));if(this.terrain&&this.terrain.get().source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));const B=this._getSourceCaches(u);for(const ge of B)delete this._sourceCaches[ge.id],delete this._updatedSources[ge.id],ge.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ge.getSource().id})),ge.setEventedParent(null),ge.clearTiles();return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],E.setEventedParent(null),E.onRemove&&E.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(u,E){this._checkLoaded(),this.getSource(u).setData(E),this._changed=!0}getSource(u){const E=this._getSourceCache(u);return E&&E.getSource()}_getSources(){const u=[];for(const E in this._otherSourceCaches){const B=this._getSourceCache(E);B&&u.push(B.getSource())}return u}addLayer(u,E,B={}){this._checkLoaded();const ge=u.id;if(this.getLayer(ge))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${ge}" already exists on this map`)));let St;if(u.type==="custom"){if(By(this,o.validateCustomStyleLayer(u)))return;St=o.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(ge,u.source),u=o.clone$1(u),u=o.extend(u,{source:ge})),this._validate(o.validateLayer,`layers.${ge}`,u,{arrayIndex:-1},B))return;St=o.createStyleLayer(u),this._validateLayer(St),St.setEventedParent(this,{layer:{id:ge}}),this._serializedLayers[St.id]=St.serialize(),this._updateLayerCount(St,!0)}const _n=E?this._order.indexOf(E):this._order.length;if(E&&_n===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`)));this._order.splice(_n,0,ge),this._layerOrderChanged=!0,this._layers[ge]=St;const Bn=this._getLayerSourceCache(St);if(this._removedLayers[ge]&&St.source&&Bn&&St.type!=="custom"){const ss=this._removedLayers[ge];delete this._removedLayers[ge],ss.type!==St.type?this._updatedSources[St.source]="clear":(this._updatedSources[St.source]="reload",Bn.pause())}this._updateLayer(St),St.onAdd&&St.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(u,E){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===E)return;const B=this._order.indexOf(u);this._order.splice(B,1);const ge=E?this._order.indexOf(E):this._order.length;E&&ge===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`))):(this._order.splice(ge,0,u),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(u){this._checkLoaded();const E=this._layers[u];if(!E)return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be removed.`)));E.setEventedParent(null),this._updateLayerCount(E,!1);const B=this._order.indexOf(u);this._order.splice(B,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=E,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],E.onRemove&&E.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(u){return this._layers[u]}hasLayer(u){return u in this._layers}hasLayerType(u){for(const E in this._layers)if(this._layers[E].type===u)return!0;return!1}setLayerZoomRange(u,E,B){this._checkLoaded();const ge=this.getLayer(u);ge?ge.minzoom===E&&ge.maxzoom===B||(E!=null&&(ge.minzoom=E),B!=null&&(ge.maxzoom=B),this._updateLayer(ge)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(u,E,B={}){this._checkLoaded();const ge=this.getLayer(u);if(ge){if(!x(ge.filter,E))return E==null?(ge.filter=void 0,void this._updateLayer(ge)):void(this._validate(o.validateFilter,`layers.${ge.id}.filter`,E,{layerType:ge.type},B)||(ge.filter=o.clone$1(E),this._updateLayer(ge)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be filtered.`)))}getFilter(u){const E=this.getLayer(u);return E&&o.clone$1(E.filter)}setLayoutProperty(u,E,B,ge={}){this._checkLoaded();const St=this.getLayer(u);St?x(St.getLayoutProperty(E),B)||(St.setLayoutProperty(E,B,ge),this._updateLayer(St)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(u,E){const B=this.getLayer(u);if(B)return B.getLayoutProperty(E);this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style.`)))}setPaintProperty(u,E,B,ge={}){this._checkLoaded();const St=this.getLayer(u);St?x(St.getPaintProperty(E),B)||(St.setPaintProperty(E,B,ge)&&this._updateLayer(St),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(u,E){const B=this.getLayer(u);return B&&B.getPaintProperty(E)}setFeatureState(u,E){this._checkLoaded();const B=u.source,ge=u.sourceLayer,St=this.getSource(B);if(!St)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const _n=St.type;if(_n==="geojson"&&ge)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_n==="vector"&&!ge)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const Bn=this._getSourceCaches(B);for(const ss of Bn)ss.setFeatureState(ge,u.id,E)}removeFeatureState(u,E){this._checkLoaded();const B=u.source,ge=this.getSource(B);if(!ge)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const St=ge.type,_n=St==="vector"?u.sourceLayer:void 0;if(St==="vector"&&!_n)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(E&&typeof u.id!="string"&&typeof u.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const Bn=this._getSourceCaches(B);for(const ss of Bn)ss.removeFeatureState(_n,u.id,E)}getFeatureState(u){this._checkLoaded();const E=u.source,B=u.sourceLayer,ge=this.getSource(E);if(ge){if(ge.type!=="vector"||B)return u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(E)[0].getFeatureState(B,u.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${E}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const u={};for(const E in this._sourceCaches){const B=this._sourceCaches[E].getSource();u[B.id]||(u[B.id]=B.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:u,layers:this._serializeLayers(this._order)},E=>E!==void 0)}_updateLayer(u){this._updatedLayers[u.id]=!0;const E=this._getLayerSourceCache(u);u.source&&!this._updatedSources[u.source]&&E&&E.getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",E.pause()),this._changed=!0,u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const E=_n=>this._layers[_n].type==="fill-extrusion",B={},ge=[];for(let _n=this._order.length-1;_n>=0;_n--){const Bn=this._order[_n];if(E(Bn)){B[Bn]=_n;for(const ss of u){const tl=ss[Bn];if(tl)for(const il of tl)ge.push(il)}}}ge.sort((_n,Bn)=>Bn.intersectionZ-_n.intersectionZ);const St=[];for(let _n=this._order.length-1;_n>=0;_n--){const Bn=this._order[_n];if(E(Bn))for(let ss=ge.length-1;ss>=0;ss--){const tl=ge[ss].feature;if(B[tl.layer.id]<_n)break;St.push(tl),ge.pop()}else for(const ss of u){const tl=ss[Bn];if(tl)for(const il of tl)St.push(il.feature)}}return St}queryRenderedFeatures(u,E,B){E&&E.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",E.filter,null,E);const ge={};if(E&&E.layers){if(!Array.isArray(E.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const ss of E.layers){const tl=this._layers[ss];if(!tl)return this.fire(new o.ErrorEvent(new Error(`The layer '${ss}' does not exist in the map's style and cannot be queried for features.`))),[];ge[tl.source]=!0}}const St=[];E.availableImages=this._availableImages;const _n=E&&E.layers?E.layers.some(ss=>{const tl=this.getLayer(ss);return tl&&tl.is3D()}):this.has3DLayers(),Bn=Fd.createFromScreenPoints(u,B);for(const ss in this._sourceCaches){const tl=this._sourceCaches[ss].getSource().id;E.layers&&!ge[tl]||St.push(Ph(this._sourceCaches[ss],this._layers,this._serializedLayers,Bn,E,B,_n,!!this.map._showQueryGeometry))}return this.placement&&St.push(function(ss,tl,il,Qu,fh,wh,Th){const Sh={},Ih=wh.queryRenderedSymbols(Qu),hh=[];for(const Oh of Object.keys(Ih).map(Number))hh.push(Th[Oh]);hh.sort(Ad);for(const Oh of hh){const Rh=Oh.featureIndex.lookupSymbolFeatures(Ih[Oh.bucketInstanceId],tl,Oh.bucketIndex,Oh.sourceLayerIndex,fh.filter,fh.layers,fh.availableImages,ss);for(const Nh in Rh){const qh=Sh[Nh]=Sh[Nh]||[],$h=Rh[Nh];$h.sort((Hh,ld)=>{const xd=Oh.featureSortOrder;if(xd){const gd=xd.indexOf(Hh.featureIndex);return xd.indexOf(ld.featureIndex)-gd}return ld.featureIndex-Hh.featureIndex});for(const Hh of $h)qh.push(Hh)}}for(const Oh in Sh)Sh[Oh].forEach(Rh=>{const Nh=Rh.feature,qh=il(ss[Oh]);if(!qh)return;const $h=qh.getFeatureState(Nh.layer["source-layer"],Nh.id);Nh.source=Nh.layer.source,Nh.layer["source-layer"]&&(Nh.sourceLayer=Nh.layer["source-layer"]),Nh.state=$h});return Sh}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),Bn.screenGeometry,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(St)}querySourceFeatures(u,E){E&&E.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",E.filter,null,E);const B=this._getSourceCaches(u);let ge=[];for(const St of B)ge=ge.concat(Fh(St,E));return ge}addSourceType(u,E,B){return eg.getSourceType(u)?B(new Error(`A source type called "${u}" already exists.`)):(eg.setSourceType(u,E),E.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:E.workerSourceURL},B):B(null,null))}getLight(){return this.light.getLight()}setLight(u,E={}){this._checkLoaded();const B=this.light.getLight();let ge=!1;for(const _n in u)if(!x(u[_n],B[_n])){ge=!0;break}if(!ge)return;const St=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(u,E),this.light.updateTransitions(St)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(u,E=1){if(this._checkLoaded(),!u)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let B=u;if(E===1){if(typeof B.source=="object"){const ge="terrain-dem-src";this.addSource(ge,B.source),B=o.clone$1(B),B=o.extend(B,{source:ge})}if(this._validate(o.validateTerrain,"terrain",B))return}if(!this.terrain||this.terrain&&E!==this.terrain.drapeRenderMode){if(!B)return;this._createTerrain(B,E)}else{const ge=this.terrain,St=ge.get();for(const _n of Object.keys(o.spec.terrain))!B.hasOwnProperty(_n)&&o.spec.terrain[_n].default&&(B[_n]=o.spec.terrain[_n].default);for(const _n in B)if(!x(B[_n],St[_n])){ge.set(B),this.stylesheet.terrain=B;const Bn=this._setTransitionParameters({duration:0});ge.updateTransitions(Bn);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const E=this.fog=new qd(u,this.map.transform);this.stylesheet.fog=u;const B=this._setTransitionParameters({duration:0});E.updateTransitions(B)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const E=this.fog,B=E.get();Object.keys(u).length===0&&E.set(u);for(const ge in u)if(!x(u[ge],B[ge])){E.set(u),this.stylesheet.fog=u;const St=this._setTransitionParameters({duration:0});E.updateTransitions(St);break}}else this._createFog(u);this._markersNeedUpdate=!0}_setTransitionParameters(u){return{now:o.exported.now(),transition:o.extend(u,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const u=this._order.filter(B=>this.isLayerDraped(this._layers[B])),E=this._order.filter(B=>!this.isLayerDraped(this._layers[B]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...E)}_createTerrain(u,E){const B=this.terrain=new Tf(u,E);this.stylesheet.terrain=u,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const ge=this._setTransitionParameters({duration:0});B.updateTransitions(ge)}_force3DLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="fill-extrusion"&&this._updateLayer(E)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="symbol"&&this._updateLayer(E)}}_validate(u,E,B,ge,St={}){return(!St||St.validate!==!1)&&By(this,u.call(o.validateStyle,o.extend({key:E,style:this.serialize(),value:B,styleSpec:o.spec},ge)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this._sourceCaches)this._sourceCaches[u].clearTiles(),this._sourceCaches[u].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(u){const E=this._getSourceCaches(u);for(const B of E)B.clearTiles()}_reloadSource(u){const E=this._getSourceCaches(u);for(const B of E)B.resume(),B.reload()}_reloadSources(){for(const u of this._getSources())u.reload&&u.reload()}_updateSources(u){for(const E in this._sourceCaches)this._sourceCaches[E].update(u)}_generateCollisionBoxes(){for(const u in this._sourceCaches){const E=this._sourceCaches[u];E.resume(),E.reload()}}_updatePlacement(u,E,B,ge,St=!1){let _n=!1,Bn=!1;const ss={};for(const tl of this._order){const il=this._layers[tl];if(il.type!=="symbol")continue;if(!ss[il.source]){const fh=this._getLayerSourceCache(il);if(!fh)continue;ss[il.source]=fh.getRenderableIds(!0).map(wh=>fh.getTileByID(wh)).sort((wh,Th)=>Th.tileID.overscaledZ-wh.tileID.overscaledZ||(wh.tileID.isLessThan(Th.tileID)?-1:1))}const Qu=this.crossTileSymbolIndex.addLayer(il,ss[il.source],u.center.lng,u.projection);_n=_n||Qu}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),St=St||this._layerOrderChanged||B===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(St||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),u.zoom))&&(this.pauseablePlacement=new r0(u,this._order,St,E,B,ge,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ss),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),Bn=!0),_n&&this.pauseablePlacement.placement.setStale()),Bn||_n)for(const tl of this._order){const il=this._layers[tl];il.type==="symbol"&&this.placement.updateLayerOpacities(il,ss[il.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,E,B){this.imageManager.getImages(E.icons,B),this._updateTilesForChangedImages();const ge=St=>{St&&St.setDependencies(E.tileID.key,E.type,E.icons)};ge(this._otherSourceCaches[E.source]),ge(this._symbolSourceCaches[E.source])}getGlyphs(u,E,B){this.glyphManager.getGlyphs(E.stacks,B)}getResource(u,E,B){return o.makeRequest(E,B)}_getSourceCache(u){return this._otherSourceCaches[u]}_getLayerSourceCache(u){return u.type==="symbol"?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}_getSourceCaches(u){const E=[];return this._otherSourceCaches[u]&&E.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&E.push(this._symbolSourceCaches[u]),E}_isSourceCacheLoaded(u){const E=this._getSourceCaches(u);return E.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${u}'`))),!1):E.every(B=>B.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}eg.getSourceType=function(L){return uh[L]},eg.setSourceType=function(L,u){uh[L]=u},eg.registerForPluginStateChange=o.registerForPluginStateChange;var h_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,iv="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zy=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,j_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,s0=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let a0={},wm={};const sy=[];ay(h_,sy),ay(zy,sy),ay(j_,sy),ay(s0,sy),a0=cm("",zy),wm=cm(s0,j_);const my=cm(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),l0=h_,gy=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var vv={background:cm(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cm(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cm(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cm("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cm(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cm(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cm("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cm("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cm("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:cm(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:cm(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cm(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:cm(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cm(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cm(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:cm(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:cm(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:cm(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:cm(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:cm(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:cm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:cm(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:cm(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,iv),skyboxGradient:cm(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,iv),skyboxCapture:cm(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cm(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ay(L,u){const E=L.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let B of E)if(B=B.trim(),B[0]==="#"&&B.includes("if")&&!B.includes("endif")){B=B.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const ge=B.split(" ");for(const St of ge)u.includes(St)||u.push(St)}}function cm(L,u){const E=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,B=u.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),ge={},St=[...sy];return ay(L,St),ay(u,St),{fragmentSource:L=L.replace(E,(_n,Bn,ss,tl,il)=>(ge[il]=!0,Bn==="define"?`
#ifndef HAS_UNIFORM_u_${il}
varying ${ss} ${tl} ${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:`
#ifdef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = u_${il};
#endif
`)),vertexSource:u=u.replace(E,(_n,Bn,ss,tl,il)=>{const Qu=tl==="float"?"vec2":"vec4",fh=il.match(/color/)?"color":Qu;return ge[il]?Bn==="define"?`
#ifndef HAS_UNIFORM_u_${il}
uniform lowp float u_${il}_t;
attribute ${ss} ${Qu} a_${il};
varying ${ss} ${tl} ${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:fh==="vec4"?`
#ifndef HAS_UNIFORM_u_${il}
    ${il} = a_${il};
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:`
#ifndef HAS_UNIFORM_u_${il}
    ${il} = unpack_mix_${fh}(a_${il}, u_${il}_t);
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:Bn==="define"?`
#ifndef HAS_UNIFORM_u_${il}
uniform lowp float u_${il}_t;
attribute ${ss} ${Qu} a_${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:fh==="vec4"?`
#ifndef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = a_${il};
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:`
#ifndef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = unpack_mix_${fh}(a_${il}, u_${il}_t);
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`}),staticAttributes:B,usedDefines:St}}class Ny{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,E,B,ge,St,_n,Bn){this.context=u;let ss=this.boundPaintVertexBuffers.length!==ge.length;for(let il=0;!ss&&il<ge.length;il++)this.boundPaintVertexBuffers[il]!==ge[il]&&(ss=!0);let tl=this.boundDynamicVertexBuffers.length!==Bn.length;for(let il=0;!tl&&il<Bn.length;il++)this.boundDynamicVertexBuffers[il]!==Bn[il]&&(tl=!0);if(!u.extVertexArrayObject||!this.vao||this.boundProgram!==E||this.boundLayoutVertexBuffer!==B||ss||tl||this.boundIndexBuffer!==St||this.boundVertexOffset!==_n)this.freshBind(E,B,ge,St,_n,Bn);else{u.bindVertexArrayOES.set(this.vao);for(const il of Bn)il&&il.bind();St&&St.dynamicDraw&&St.bind()}}freshBind(u,E,B,ge,St,_n){let Bn;const ss=u.numAttributes,tl=this.context,il=tl.gl;if(tl.extVertexArrayObject)this.vao&&this.destroy(),this.vao=tl.extVertexArrayObject.createVertexArrayOES(),tl.bindVertexArrayOES.set(this.vao),Bn=0,this.boundProgram=u,this.boundLayoutVertexBuffer=E,this.boundPaintVertexBuffers=B,this.boundIndexBuffer=ge,this.boundVertexOffset=St,this.boundDynamicVertexBuffers=_n;else{Bn=tl.currentNumAttributes||0;for(let Qu=ss;Qu<Bn;Qu++)il.disableVertexAttribArray(Qu)}E.enableAttributes(il,u),E.bind(),E.setVertexAttribPointers(il,u,St);for(const Qu of B)Qu.enableAttributes(il,u),Qu.bind(),Qu.setVertexAttribPointers(il,u,St);for(const Qu of _n)Qu&&(Qu.enableAttributes(il,u),Qu.bind(),Qu.setVertexAttribPointers(il,u,St));ge&&ge.bind(),tl.currentNumAttributes=ss}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fy(L,u){const E=Math.pow(2,u.canonical.z),B=u.canonical.y;return[new o.MercatorCoordinate(0,B/E).toLngLat().lat,new o.MercatorCoordinate(0,(B+1)/E).toLngLat().lat]}function q_(L,u,E,B,ge,St,_n){const Bn=L.context,ss=Bn.gl,tl=E.fbo;if(!tl)return;L.prepareDrawTile();const il=L.useProgram("hillshade");Bn.activeTexture.set(ss.TEXTURE0),ss.bindTexture(ss.TEXTURE_2D,tl.colorAttachment.get());const Qu=((Sh,Ih,hh,Oh)=>{const Rh=hh.paint.get("hillshade-shadow-color"),Nh=hh.paint.get("hillshade-highlight-color"),qh=hh.paint.get("hillshade-accent-color");let $h=hh.paint.get("hillshade-illumination-direction")*(Math.PI/180);hh.paint.get("hillshade-illumination-anchor")==="viewport"&&($h-=Sh.transform.angle);const Hh=!Sh.options.moving;return{u_matrix:Oh||Sh.transform.calculateProjMatrix(Ih.tileID.toUnwrapped(),Hh),u_image:0,u_latrange:Fy(0,Ih.tileID),u_light:[hh.paint.get("hillshade-exaggeration"),$h],u_shadow:Rh,u_highlight:Nh,u_accent:qh}})(L,E,B,L.terrain?u.projMatrix:null);L.prepareDrawProgram(Bn,il,u.toUnwrapped());const{tileBoundsBuffer:fh,tileBoundsIndexBuffer:wh,tileBoundsSegments:Th}=L.getTileBoundsBuffers(E);il.draw(Bn,ss.TRIANGLES,ge,St,_n,o.CullFaceMode.disabled,Qu,B.id,fh,wh,Th)}function d_(L,u,E){if(!u.needsDEMTextureUpload)return;const B=L.context,ge=B.gl;B.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||L.getTileTexture(E.stride);const St=E.getPixels();u.demTexture?u.demTexture.update(St,{premultiply:!1}):u.demTexture=new o.Texture(B,St,ge.RGBA,{premultiply:!1}),u.needsDEMTextureUpload=!1}function c0(L,u,E,B,ge,St){const _n=L.context,Bn=_n.gl;if(!u.dem)return;const ss=u.dem;if(_n.activeTexture.set(Bn.TEXTURE1),d_(L,u,ss),!u.demTexture)return;u.demTexture.bind(Bn.NEAREST,Bn.CLAMP_TO_EDGE);const tl=ss.dim;_n.activeTexture.set(Bn.TEXTURE0);let il=u.fbo;if(!il){const Th=new o.Texture(_n,{width:tl,height:tl,data:null},Bn.RGBA);Th.bind(Bn.LINEAR,Bn.CLAMP_TO_EDGE),il=u.fbo=_n.createFramebuffer(tl,tl,!0),il.colorAttachment.set(Th.texture)}_n.bindFramebuffer.set(il.framebuffer),_n.viewport.set([0,0,tl,tl]);const{tileBoundsBuffer:Qu,tileBoundsIndexBuffer:fh,tileBoundsSegments:wh}=L.getMercatorTileBoundsBuffers();L.useProgram("hillshadePrepare").draw(_n,Bn.TRIANGLES,B,ge,St,o.CullFaceMode.disabled,((Th,Sh)=>{const Ih=Sh.stride,hh=o.create();return o.ortho(hh,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(hh,hh,[0,-o.EXTENT,0]),{u_matrix:hh,u_image:1,u_dimension:[Ih,Ih],u_zoom:Th.overscaledZ,u_unpack:Sh.unpackVector}})(u.tileID,ss),E.id,Qu,fh,wh),u.needsHillshadePrepare=!1}const u0=L=>({u_matrix:new o.UniformMatrix4f(L),u_image0:new o.Uniform1i(L),u_skirt_height:new o.Uniform1f(L)}),nv=(L,u)=>({u_matrix:L,u_image0:0,u_skirt_height:u}),$y=(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th)=>({u_proj_matrix:Float32Array.from(L),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(B),u_merc_matrix:E,u_zoom_transition:ge,u_merc_center:St,u_image0:0,u_frustum_tl:_n,u_frustum_tr:Bn,u_frustum_br:ss,u_frustum_bl:tl,u_globe_pos:il,u_globe_radius:Qu,u_viewport:fh,u_grid_matrix:Th?Float32Array.from(Th):new Float32Array(9),u_skirt_height:wh});function h0(L,u){return L!=null&&u!=null&&!(!L.hasData()||!u.hasData())&&L.demTexture!=null&&u.demTexture!=null&&L.tileID.key!==u.tileID.key}const Eg=new class{constructor(){this.operations={}}newMorphing(L,u,E,B,ge){if(L in this.operations){const St=this.operations[L];St.to.tileID.key!==E.tileID.key&&(St.queued=E)}else this.operations[L]={startTime:B,phase:0,duration:ge,from:u,to:E,queued:null}}getMorphValuesForProxy(L){if(!(L in this.operations))return null;const u=this.operations[L];return{from:u.from,to:u.to,phase:u.phase}}update(L){for(const u in this.operations){const E=this.operations[u];for(E.phase=(L-E.startTime)/E.duration;E.phase>=1||!this._validOp(E);)if(!this._nextOp(E,L)){delete this.operations[u];break}}}_nextOp(L,u){return!!L.queued&&(L.from=L.to,L.to=L.queued,L.queued=null,L.phase=0,L.startTime=u,!0)}_validOp(L){return L.from.hasData()&&L.to.hasData()}},Z_={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function f_(L){return 6*Math.pow(1.5,22-L)}function p_(L,u){const E=1<<L.z;return!u&&(L.x===0||L.x===E-1)||L.y===0||L.y===E-1}const Kp=L=>({u_matrix:L});function M_(L,u,E,B,ge){if(ge>0){const St=o.exported.now(),_n=(St-L.timeAdded)/ge,Bn=u?(St-u.timeAdded)/ge:-1,ss=E.getSource(),tl=B.coveringZoomLevel({tileSize:ss.tileSize,roundZoom:ss.roundZoom}),il=!u||Math.abs(u.tileID.overscaledZ-tl)>Math.abs(L.tileID.overscaledZ-tl),Qu=il&&L.refreshedUponExpiration?1:o.clamp(il?_n:1-Bn,0,1);return L.refreshedUponExpiration&&_n>=1&&(L.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Qu}:{opacity:Qu,mix:0}}return{opacity:1,mix:0}}class m_ extends o.SourceCache{constructor(u){const E={type:"raster-dem",maxzoom:u.transform.maxZoom},B=new Ed(rp(),null),ge=dh("mock-dem",E,B,u.style);super("mock-dem",ge,!1),ge.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,E){u.state="loaded",E(null)}}class Nv extends o.SourceCache{constructor(u){const E=dh("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},new Ed(rp(),null),u.style);super("proxy",E,!1),E.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,E,B){if(u.freezeTileCoverage)return;this.transform=u;const ge=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((St,_n)=>{if(St[_n.key]="",!this._tiles[_n.key]){const Bn=new o.Tile(_n,this._source.tileSize*_n.overscaleFactor(),u.tileZoom);Bn.state="loaded",this._tiles[_n.key]=Bn}return St},{});for(const St in this._tiles)St in ge||(this.freeFBO(St),this._tiles[St].unloadVectorData(),delete this._tiles[St])}freeFBO(u){const E=this.proxyCachedFBO[u];if(E!==void 0){const B=Object.values(E);this.renderCachePool.push(...B),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _y extends o.OverscaledTileID{constructor(u,E,B){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=E,this.projMatrix=B}}class Uy extends o.Elevation{constructor(u,E){super(),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[B,ge,St]=function(ss){const tl=new o.StructArrayLayout2i4,il=new o.StructArrayLayout3ui6,Qu=131;tl.reserve(17161),il.reserve(33800);const fh=o.EXTENT/128,wh=o.EXTENT+fh/2,Th=wh+fh;for(let Ih=-fh;Ih<Th;Ih+=fh)for(let hh=-fh;hh<Th;hh+=fh){const Oh=hh<0||hh>wh||Ih<0||Ih>wh?24575:0,Rh=o.clamp(Math.round(hh),0,o.EXTENT),Nh=o.clamp(Math.round(Ih),0,o.EXTENT);tl.emplaceBack(Rh+Oh,Nh)}const Sh=(Ih,hh)=>{const Oh=hh*Qu+Ih;il.emplaceBack(Oh+1,Oh,Oh+Qu),il.emplaceBack(Oh+Qu,Oh+Qu+1,Oh+1)};for(let Ih=1;Ih<129;Ih++)for(let hh=1;hh<129;hh++)Sh(hh,Ih);return[0,129].forEach(Ih=>{for(let hh=0;hh<130;hh++)Sh(hh,Ih),Sh(Ih,hh)}),[tl,il,32768]}(),_n=u.context;this.gridBuffer=_n.createVertexBuffer(B,o.posAttributes.members),this.gridIndexBuffer=_n.createIndexBuffer(ge),this.gridSegments=o.SegmentVector.simpleSegment(0,0,B.length,ge.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,B.length,St),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nv(E.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const Bn=_n.gl;this._overlapStencilMode=new o.StencilMode({func:Bn.GEQUAL,mask:255},0,255,Bn.KEEP,Bn.KEEP,Bn.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=E,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new m_(E.map)}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),u.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=u,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(u,E,B){if(u&&u.terrain){this._style!==u&&(this.style=u),this.enabled=!0;const ge=u.terrain.properties;this.sourceCache=u.terrain.drapeRenderMode===0?this._mockSourceCache:u._getSourceCache(ge.get("source")),this._exaggeration=ge.get("exaggeration");const St=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _n=this.getScaledDemTileSize();this.sourceCache.update(E,_n,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,St(),this._initializing=!0),St(),E.updateElevation(!0,B),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(E),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const u=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||u.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${u.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${u.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(u){u.coord&&u.dataType==="source"?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):u.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._sourceCaches)this._style._sourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const E=this.proxySourceCache,B=this.painter.transform;this._initializing&&(this._initializing=B._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(B.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ge=this.proxyCoords=E.getIds().map(ss=>{const tl=E.getTileByID(ss).tileID;return tl.projMatrix=B.calculateProjMatrix(tl.toUnwrapped()),tl});(function(ss,tl){const il=tl.transform.pointCoordinate(tl.transform.getCameraPoint()),Qu=new o.pointGeometry(il.x,il.y);ss.sort((fh,wh)=>{if(wh.overscaledZ-fh.overscaledZ)return wh.overscaledZ-fh.overscaledZ;const Th=new o.pointGeometry(fh.canonical.x+(1<<fh.canonical.z)*fh.wrap,fh.canonical.y),Sh=new o.pointGeometry(wh.canonical.x+(1<<wh.canonical.z)*wh.wrap,wh.canonical.y),Ih=Qu.mult(1<<fh.canonical.z);return Ih.x-=.5,Ih.y-=.5,Ih.distSqr(Th)-Ih.distSqr(Sh)})})(ge,this.painter),this._previousZoom=B.zoom;const St=this.proxyToSource||{};this.proxyToSource={},ge.forEach(ss=>{this.proxyToSource[ss.key]={}}),this.terrainTileForTile={};const _n=this._style._sourceCaches;for(const ss in _n){const tl=_n[ss];if(!tl.used||(tl!==this.sourceCache&&this.resetTileLookupCache(tl.id),this._setupProxiedCoordsForOrtho(tl,u[ss],St),tl.usedForTerrain))continue;const il=u[ss];tl.getSource().reparseOverscaled&&this._assignTerrainTiles(il)}this.proxiedCoords[E.id]=ge.map(ss=>new _y(ss,ss.key,this.orthoMatrix)),this._assignTerrainTiles(ge),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(St),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const Bn={};this._visibleDemTiles=[];for(const ss of this.proxyCoords){const tl=this.terrainTileForTile[ss.key];if(!tl)continue;const il=tl.tileID.key;il in Bn||(this._visibleDemTiles.push(tl),Bn[il]=il)}}_assignTerrainTiles(u){this._initializing||u.forEach(E=>{if(this.terrainTileForTile[E.key])return;const B=this._findTileCoveringTileID(E,this.sourceCache);B&&(this.terrainTileForTile[E.key]=B)})}_prepareDEMTextures(){const u=this.painter.context,E=u.gl;for(const B in this.terrainTileForTile){const ge=this.terrainTileForTile[B],St=ge.dem;!St||ge.demTexture&&!ge.needsDEMTextureUpload||(u.activeTexture.set(E.TEXTURE1),d_(this.painter,ge,St))}}_prepareDemTileUniforms(u,E,B,ge){if(!E||E.demTexture==null)return!1;const St=u.tileID.canonical,_n=Math.pow(2,E.tileID.canonical.z-St.z),Bn=ge||"";return B[`u_dem_tl${Bn}`]=[St.x*_n%1,St.y*_n%1],B[`u_dem_scale${Bn}`]=_n,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const u=this.painter.context,E=u.gl;if(!this._emptyDepthBufferTexture){const B=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(u,B,E.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let u=0;const E=this._visibleDemTiles.reduce((B,ge)=>{if(!ge.dem)return B;const St=ge.dem.tree.minimums[0];return St>0&&u++,B+St},0);return u?E/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,E=u.gl;u.activeTexture.set(E.TEXTURE2);const B=this._getLoadedAreaMinimum(),ge=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(B,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let St=this._emptyDEMTexture;return St?St.update(ge,{premultiply:!1}):St=this._emptyDEMTexture=new o.Texture(u,ge,E.RGBA,{premultiply:!1}),St}setupElevationDraw(u,E,B){const ge=this.painter.context,St=ge.gl,_n=(Bn=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(Bn),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var Bn;_n.u_dem_size=this.sourceCache.getSource().tileSize,_n.u_exaggeration=this.exaggeration();let ss=null,tl=null,il=1;if(B&&B.morphing&&this._useVertexMorphing){const Qu=B.morphing.srcDemTile,fh=B.morphing.dstDemTile;il=B.morphing.phase,Qu&&fh&&(this._prepareDemTileUniforms(u,Qu,_n,"_prev")&&(tl=Qu),this._prepareDemTileUniforms(u,fh,_n)&&(ss=fh))}if(tl&&ss?(ge.activeTexture.set(St.TEXTURE2),ss.demTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE,St.NEAREST),ge.activeTexture.set(St.TEXTURE4),tl.demTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE,St.NEAREST),_n.u_dem_lerp=il):(ss=this.terrainTileForTile[u.tileID.key],ge.activeTexture.set(St.TEXTURE2),(this._prepareDemTileUniforms(u,ss,_n)?ss.demTexture:this.emptyDEMTexture).bind(St.NEAREST,St.CLAMP_TO_EDGE)),ge.activeTexture.set(St.TEXTURE3),B&&B.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE),this._depthFBO&&(_n.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE),_n.u_depth_size_inv=[1,1]),B&&B.useMeterToDem&&ss){const Qu=(1<<ss.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_n.u_meter_to_dem=Qu}if(B&&B.labelPlaneMatrixInv&&(_n.u_label_plane_matrix_inv=B.labelPlaneMatrixInv),E.setTerrainUniformValues(ge,_n),this.painter.transform.projection.name==="globe"){const Qu=this.globeUniformValues(this.painter.transform,u.tileID.canonical,B&&B.useDenormalizedUpVectorScale);E.setGlobeUniformValues(ge,Qu)}}globeUniformValues(u,E,B){const ge=u.projection;return{u_tile_tl_up:ge.upVector(E,0,0),u_tile_tr_up:ge.upVector(E,o.EXTENT,0),u_tile_br_up:ge.upVector(E,o.EXTENT,o.EXTENT),u_tile_bl_up:ge.upVector(E,0,o.EXTENT),u_tile_up_scale:B?o.globeMetersToEcef(1):ge.upVectorScale(E,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const E=this.painter,B=this.painter.context;u.length!==0&&(B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),E.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ge,St,_n,Bn,ss){if(ge.transform.projection.name==="globe")(function(tl,il,Qu,fh,wh){const Th=tl.context,Sh=Th.gl;let Ih,hh;const Oh=tl.options.showTerrainWireframe?2:0,Rh=tl.transform,Nh=o.globeUseCustomAntiAliasing(tl,Th,Rh),qh=(Lf,Md)=>{if(hh===Lf)return;const pd=[Z_[Lf],"PROJECTION_GLOBE_VIEW"];Nh&&pd.push("CUSTOM_ANTIALIASING"),Md&&pd.push(Z_[Oh]),Ih=tl.useProgram("globeRaster",null,pd),hh=Lf},$h=tl.colorModeForRenderPass(),Hh=new o.DepthMode(Sh.LEQUAL,o.DepthMode.ReadWrite,tl.depthRangeFor3D);Eg.update(wh);const ld=o.calculateGlobeMercatorMatrix(Rh),xd=[o.mercatorXfromLng(Rh.center.lng),o.mercatorYfromLat(Rh.center.lat)],gd=Oh?[!1,!0]:[!1],Vf=tl.globeSharedBuffers,_d=[Rh.width*o.exported.devicePixelRatio,Rh.height*o.exported.devicePixelRatio],Mf=Float32Array.from(Rh.globeMatrix),Ud={useDenormalizedUpVectorScale:!0};if(gd.forEach(Lf=>{const Md=tl.transform,pd=f_(Md.zoom)*il.exaggeration();hh=-1;const Bd=Lf?Sh.LINES:Sh.TRIANGLES;for(const mf of fh){const Bf=Qu.getTile(mf),Dp=o.StencilMode.disabled,rm=il.prevTerrainTileForTile[mf.key],Mp=il.terrainTileForTile[mf.key];h0(rm,Mp)&&Eg.newMorphing(mf.key,rm,Mp,wh,250),Th.activeTexture.set(Sh.TEXTURE0),Bf.texture.bind(Sh.LINEAR,Sh.CLAMP_TO_EDGE);const xp=Eg.getMorphValuesForProxy(mf.key),Lp=xp?1:0;xp&&o.extend$1(Ud,{morphing:{srcDemTile:xp.from,dstDemTile:xp.to,phase:o.easeCubicInOut(xp.phase)}});const dm=o.tileCornersToBounds(mf.canonical),Fp=o.getLatitudinalLod(dm.getCenter().lat),km=o.getGridMatrix(mf.canonical,dm,Fp,Md.worldSize/Md._pixelsPerMercatorPixel),Am=o.globeNormalizeECEF(o.globeTileBounds(mf.canonical)),jm=$y(Md.projMatrix,Mf,ld,Am,o.globeToMercatorTransition(Md.zoom),xd,Md.frustumCorners.TL,Md.frustumCorners.TR,Md.frustumCorners.BR,Md.frustumCorners.BL,Md.globeCenterInViewSpace,Md.globeRadius,_d,pd,km);if(qh(Lp,Lf),il.setupElevationDraw(Bf,Ih,Ud),tl.prepareDrawProgram(Th,Ih,mf.toUnwrapped()),Vf){const[Fm,gg,lg]=Lf?Vf.getWirefameBuffers(tl.context,Fp):Vf.getGridBuffers(Fp,pd!==0);Ih.draw(Th,Bd,Hh,Dp,$h,o.CullFaceMode.backCCW,jm,"globe_raster",Fm,gg,lg)}}}),Vf){const Lf=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Nh&&Lf.push("CUSTOM_ANTIALIASING"),Ih=tl.useProgram("globeRaster",null,Lf);for(const Md of fh){const{x:pd,y:Bd,z:mf}=Md.canonical,Bf=Bd===0,Dp=Bd===(1<<mf)-1,[rm,Mp,xp,Lp]=Vf.getPoleBuffers(mf);if(Lp&&(Bf||Dp)){const dm=Qu.getTile(Md);Th.activeTexture.set(Sh.TEXTURE0),dm.texture.bind(Sh.LINEAR,Sh.CLAMP_TO_EDGE);let Fp=o.globePoleMatrixForTile(mf,pd,Rh);const km=o.globeNormalizeECEF(o.globeTileBounds(Md.canonical)),Am=(jm,Fm)=>jm.draw(Th,Sh.TRIANGLES,Hh,o.StencilMode.disabled,$h,o.CullFaceMode.disabled,$y(Rh.projMatrix,Fp,Fp,km,0,xd,Rh.frustumCorners.TL,Rh.frustumCorners.TR,Rh.frustumCorners.BR,Rh.frustumCorners.BL,Rh.globeCenterInViewSpace,Rh.globeRadius,_d,0),"globe_pole_raster",Fm,xp,Lp);il.setupElevationDraw(dm,Ih,Ud),tl.prepareDrawProgram(Th,Ih,Md.toUnwrapped()),Bf&&Am(Ih,rm),Dp&&(Fp=o.scale(o.create(),Fp,[1,-1,1]),Am(Ih,Mp))}}}})(ge,St,_n,Bn,ss);else{const tl=ge.context,il=tl.gl;let Qu,fh;const wh=ge.options.showTerrainWireframe?2:0,Th=(Rh,Nh)=>{if(fh===Rh)return;const qh=[Z_[Rh]];Nh&&qh.push(Z_[wh]),Qu=ge.useProgram("terrainRaster",null,qh),fh=Rh},Sh=ge.colorModeForRenderPass(),Ih=new o.DepthMode(il.LEQUAL,o.DepthMode.ReadWrite,ge.depthRangeFor3D);Eg.update(ss);const hh=ge.transform,Oh=f_(hh.zoom)*St.exaggeration();(wh?[!1,!0]:[!1]).forEach(Rh=>{fh=-1;const Nh=Rh?il.LINES:il.TRIANGLES,[qh,$h]=Rh?St.getWirefameBuffer():[St.gridIndexBuffer,St.gridSegments];for(const Hh of Bn){const ld=_n.getTile(Hh),xd=o.StencilMode.disabled,gd=St.prevTerrainTileForTile[Hh.key],Vf=St.terrainTileForTile[Hh.key];h0(gd,Vf)&&Eg.newMorphing(Hh.key,gd,Vf,ss,250),tl.activeTexture.set(il.TEXTURE0),ld.texture.bind(il.LINEAR,il.CLAMP_TO_EDGE,il.LINEAR_MIPMAP_NEAREST);const _d=Eg.getMorphValuesForProxy(Hh.key),Mf=_d?1:0;let Ud;_d&&(Ud={morphing:{srcDemTile:_d.from,dstDemTile:_d.to,phase:o.easeCubicInOut(_d.phase)}});const Lf=nv(Hh.projMatrix,p_(Hh.canonical,hh.renderWorldCopies)?Oh/10:Oh);Th(Mf,Rh),St.setupElevationDraw(ld,Qu,Ud),ge.prepareDrawProgram(tl,Qu,Hh.toUnwrapped()),Qu.draw(tl,Nh,Ih,xd,Sh,o.CullFaceMode.backCCW,Lf,"terrain_raster",St.gridBuffer,qh,$h)}})}}(E,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,E.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(this._drapedRenderBatches.length===0)return u+1;this.renderingToTexture=!0;const E=this.painter,B=this.painter.context,ge=this.proxySourceCache,St=this.proxiedCoords[ge.id],_n=this._drapedRenderBatches.shift(),Bn=[],ss=E.style.order;let tl=0;for(const il of St){const Qu=ge.getTileByID(il.proxyTileKey),fh=ge.proxyCachedFBO[il.key]?ge.proxyCachedFBO[il.key][u]:void 0,wh=fh!==void 0?ge.renderCache[fh]:this.pool[tl++],Th=fh!==void 0;if(Qu.texture=wh.tex,Th&&!wh.dirty){Bn.push(Qu.tileID);continue}let Sh;B.bindFramebuffer.set(wh.fb.framebuffer),this.renderedToTile=!1,wh.dirty&&(B.clear({color:o.Color.transparent,stencil:0}),wh.dirty=!1);for(let Ih=_n.start;Ih<=_n.end;++Ih){const hh=E.style._layers[ss[Ih]];if(hh.isHidden(E.transform.zoom))continue;const Oh=E.style._getLayerSourceCache(hh),Rh=Oh?this.proxyToSource[il.key][Oh.id]:[il];if(!Rh)continue;const Nh=Rh;B.viewport.set([0,0,wh.fb.width,wh.fb.height]),Sh!==(Oh?Oh.id:null)&&(this._setupStencil(wh,Rh,hh,Oh),Sh=Oh?Oh.id:null),E.renderLayer(E,Oh,hh,Nh)}this.renderedToTile?(wh.dirty=!0,Bn.push(Qu.tileID)):Th||--tl,tl===5&&(tl=0,this.renderToBackBuffer(Bn))}return this.renderToBackBuffer(Bn),this.renderingToTexture=!1,B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),_n.end+1}postRender(){}renderCacheEfficiency(u){const E=u.order.length;if(E===0)return{efficiency:100};let B,ge=0,St=0,_n=!1;for(let Bn=0;Bn<E;++Bn){const ss=u._layers[u.order[Bn]];this._style.isLayerDraped(ss)?(_n&&++ge,++St):_n||(_n=!0,B=ss.id)}return St===0?{efficiency:100}:{efficiency:100*(1-ge/St),firstUndrapedLayer:B}}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(E=>E.dem).forEach(E=>{u=Math.min(u,E.dem.tree.minimums[0])}),u===0?u:(u-30)*this._exaggeration}raycast(u,E,B){if(!this._visibleDemTiles)return null;const ge=this._visibleDemTiles.filter(St=>St.dem).map(St=>{const _n=St.tileID,Bn=1<<_n.overscaledZ,{x:ss,y:tl}=_n.canonical,il=ss/Bn,Qu=(ss+1)/Bn,fh=tl/Bn,wh=(tl+1)/Bn;return{minx:il,miny:fh,maxx:Qu,maxy:wh,t:St.dem.tree.raycastRoot(il,fh,Qu,wh,u,E,B),tile:St}});ge.sort((St,_n)=>(St.t!==null?St.t:Number.MAX_VALUE)-(_n.t!==null?_n.t:Number.MAX_VALUE));for(const St of ge){if(St.t==null)return null;const _n=St.tile.dem.tree.raycast(St.minx,St.miny,St.maxx,St.maxy,u,E,B);if(_n!=null)return _n}return null}_createFBO(){const u=this.painter.context,E=u.gl,B=this.drapeBufferSize;u.activeTexture.set(E.TEXTURE0);const ge=new o.Texture(u,{width:B[0],height:B[1],data:null},E.RGBA);ge.bind(E.LINEAR,E.CLAMP_TO_EDGE);const St=u.createFramebuffer(B[0],B[1],!1);return St.colorAttachment.set(ge.texture),St.depthAttachment=new Wu(u,St.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,B[0],B[1]),this._stencilRef=0,St.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):St.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&!u.extTextureFilterAnisotropicForceOff&&E.texParameterf(E.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:St,tex:ge,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const E=this._style._layers[u],B=E.isHidden(this.painter.transform.zoom);return E.type==="custom"?!B&&E.shouldRedrape():!B&&E.hasTransition()})}_clearLineLayersFromRenderCache(){let u=!1;for(const B of this._style._getSources())if(B instanceof mr){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const ge=this._style._layers[this._style.order[B]],St=this._style._getLayerSourceCache(ge);if(St&&!E[St.id]&&!ge.isHidden(this.painter.transform.zoom)&&ge.type==="line"&&ge.widthExpression()instanceof o.ZoomDependentExpression){E[St.id]=!0;for(const _n of this.proxyCoords){const Bn=this.proxyToSource[_n.key][St.id];if(Bn)for(const ss of Bn)this._clearRenderCacheForTile(St.id,ss)}}}}_clearRasterLayersFromRenderCache(){let u=!1;for(const B in this._style._sourceCaches)if(this._style._sourceCaches[B]._source instanceof cs){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const ge=this._style._layers[this._style.order[B]],St=this._style._getLayerSourceCache(ge);if(!St||E[St.id]||ge.isHidden(this.painter.transform.zoom)||ge.type!=="raster")continue;const _n=ge.paint.get("raster-fade-duration");for(const Bn of this.proxyCoords){const ss=this.proxyToSource[Bn.key][St.id];if(ss)for(const tl of ss){const il=M_(St.getTile(tl),St.findLoadedParent(tl,0),St,this.painter.transform,_n);(il.opacity!==1||il.mix!==0)&&this._clearRenderCacheForTile(St.id,tl)}}}}_setupDrapedRenderBatches(){const u=this._style.order,E=u.length;if(E===0)return;const B=[];let ge,St=0,_n=this._style._layers[u[St]];for(;!this._style.isLayerDraped(_n)&&_n.isHidden(this.painter.transform.zoom)&&++St<E;)_n=this._style._layers[u[St]];for(;St<E;++St){const Bn=this._style._layers[u[St]];Bn.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Bn)?ge===void 0&&(ge=St):ge!==void 0&&(B.push({start:ge,end:St-1}),ge=void 0))}ge!==void 0&&B.push({start:ge,end:St-1}),this._drapedRenderBatches=B}_setupRenderCache(u){const E=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,E.renderCache.length>E.renderCachePool.length){const _n=Object.values(E.proxyCachedFBO);E.proxyCachedFBO={};for(let Bn=0;Bn<_n.length;++Bn){const ss=Object.values(_n[Bn]);E.renderCachePool.push(...ss)}}return}this._clearRasterLayersFromRenderCache();const B=this.proxyCoords,ge=this._tilesDirty;for(let _n=B.length-1;_n>=0;_n--){const Bn=B[_n];if(E.getTileByID(Bn.key),E.proxyCachedFBO[Bn.key]!==void 0){const ss=u[Bn.key],tl=this.proxyToSource[Bn.key];let il=0;for(const Qu in tl){const fh=tl[Qu],wh=ss[Qu];if(!wh||wh.length!==fh.length||fh.some((Th,Sh)=>Th!==wh[Sh]||ge[Qu]&&ge[Qu].hasOwnProperty(Th.key))){il=-1;break}++il}for(const Qu in E.proxyCachedFBO[Bn.key])E.renderCache[E.proxyCachedFBO[Bn.key][Qu]].dirty=il<0||il!==Object.values(ss).length}}const St=[...this._drapedRenderBatches];St.sort((_n,Bn)=>Bn.end-Bn.start-(_n.end-_n.start));for(const _n of St)for(const Bn of B){if(E.proxyCachedFBO[Bn.key])continue;let ss=E.renderCachePool.pop();ss===void 0&&E.renderCache.length<50&&(ss=E.renderCache.length,E.renderCache.push(this._createFBO())),ss!==void 0&&(E.proxyCachedFBO[Bn.key]={},E.proxyCachedFBO[Bn.key][_n.start]=ss,E.renderCache[ss].dirty=!0)}this._tilesDirty={}}_setupStencil(u,E,B,ge){if(!ge||!this._sourceTilesOverlap[ge.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const St=this.painter.context,_n=St.gl;if(E.length<=1)return void(this._overlapStencilType=!1);let Bn;if(B.isTileClipped())Bn=E.length,this._overlapStencilMode.test={func:_n.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(E[0].overscaledZ>E[E.length-1].overscaledZ))return void(this._overlapStencilType=!1);Bn=1,this._overlapStencilMode.test={func:_n.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Bn>255&&(St.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Bn,this._overlapStencilMode.ref=this._stencilRef,B.isTileClipped()&&this._renderTileClippingMasks(E,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(u,E){const B=this.painter,ge=this.painter.context,St=ge.gl;B._tileClippingMaskIDs={},ge.setColorMode(o.ColorMode.disabled),ge.setDepthMode(o.DepthMode.disabled);const _n=B.useProgram("clippingMask");for(const Bn of u){const ss=B._tileClippingMaskIDs[Bn.key]=--E;_n.draw(ge,St.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:St.ALWAYS,mask:0},ss,255,St.KEEP,St.KEEP,St.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(Bn.projMatrix),"$clipping",B.tileExtentBuffer,B.quadTriangleIndexBuffer,B.tileExtentSegments)}}pointCoordinate(u){const E=this.painter.transform;if(u.x<0||u.x>E.width||u.y<0||u.y>E.height)return null;const B=[u.x,u.y,1,1];o.transformMat4$1(B,B,E.pixelMatrixInverse),o.scale$1(B,B,1/B[3]),B[0]/=E.worldSize,B[1]/=E.worldSize;const ge=E._camera.position,St=o.mercatorZfromAltitude(1,E.center.lat),_n=[ge[0],ge[1],ge[2]/St,0],Bn=o.subtract([],B.slice(0,3),_n);o.normalize(Bn,Bn);const ss=this.raycast(_n,Bn,this._exaggeration);return ss!==null&&ss?(o.scaleAndAdd(_n,_n,Bn,ss),_n[3]=_n[2],_n[2]*=St,_n):null}drawDepth(){const u=this.painter,E=u.context,B=this.proxySourceCache,ge=Math.ceil(u.width),St=Math.ceil(u.height);if(!this._depthFBO||this._depthFBO.width===ge&&this._depthFBO.height===St||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const _n=E.gl,Bn=E.createFramebuffer(ge,St,!0);E.activeTexture.set(_n.TEXTURE0);const ss=new o.Texture(E,{width:ge,height:St,data:null},_n.RGBA);ss.bind(_n.NEAREST,_n.CLAMP_TO_EDGE),Bn.colorAttachment.set(ss.texture);const tl=E.createRenderbuffer(E.gl.DEPTH_COMPONENT16,ge,St);Bn.depthAttachment.set(tl),this._depthFBO=Bn,this._depthTexture=ss}E.bindFramebuffer.set(this._depthFBO.framebuffer),E.viewport.set([0,0,ge,St]),function(_n,Bn,ss,tl){if(_n.transform.projection.name==="globe")return;const il=_n.context,Qu=il.gl;il.clear({depth:1});const fh=_n.useProgram("terrainDepth"),wh=new o.DepthMode(Qu.LESS,o.DepthMode.ReadWrite,_n.depthRangeFor3D);for(const Th of tl){const Sh=ss.getTile(Th),Ih=nv(Th.projMatrix,0);Bn.setupElevationDraw(Sh,fh),fh.draw(il,Qu.TRIANGLES,wh,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ih,"terrain_depth",Bn.gridBuffer,Bn.gridIndexBuffer,Bn.gridNoSkirtSegments)}}(u,this,B,this.proxyCoords)}_setupProxiedCoordsForOrtho(u,E,B){if(u.getSource()instanceof rh)return this._setupProxiedCoordsForImageSource(u,E,B);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const ge=this.proxiedCoords[u.id]=[],St=this.proxyCoords;for(let Bn=0;Bn<St.length;Bn++){const ss=St[Bn],tl=this._findTileCoveringTileID(ss,u);if(tl){const il=this._createProxiedId(ss,tl,B[ss.key]&&B[ss.key][u.id]);ge.push(il),this.proxyToSource[ss.key][u.id]=[il]}}let _n=!1;for(let Bn=0;Bn<E.length;Bn++){const ss=u.getTile(E[Bn]);if(!ss||!ss.hasData())continue;const tl=this._findTileCoveringTileID(ss.tileID,this.proxySourceCache);if(tl&&tl.tileID.canonical.z!==ss.tileID.canonical.z){const il=this.proxyToSource[tl.tileID.key][u.id],Qu=this._createProxiedId(tl.tileID,ss,B[tl.tileID.key]&&B[tl.tileID.key][u.id]);il?il.splice(il.length-1,0,Qu):this.proxyToSource[tl.tileID.key][u.id]=[Qu],ge.push(Qu),_n=!0}}this._sourceTilesOverlap[u.id]=_n}_setupProxiedCoordsForImageSource(u,E,B){if(!u.getSource().loaded())return;const ge=this.proxiedCoords[u.id]=[],St=this.proxyCoords,_n=u.getSource(),Bn=new o.pointGeometry(_n.tileID.x,_n.tileID.y)._div(1<<_n.tileID.z),ss=_n.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((il,Qu)=>(il.min.x=Math.min(il.min.x,Qu.x-Bn.x),il.min.y=Math.min(il.min.y,Qu.y-Bn.y),il.max.x=Math.max(il.max.x,Qu.x-Bn.x),il.max.y=Math.max(il.max.y,Qu.y-Bn.y),il),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),tl=(il,Qu)=>{const fh=il.wrap+il.canonical.x/(1<<il.canonical.z),wh=il.canonical.y/(1<<il.canonical.z),Th=o.EXTENT/(1<<il.canonical.z),Sh=Qu.wrap+Qu.canonical.x/(1<<Qu.canonical.z),Ih=Qu.canonical.y/(1<<Qu.canonical.z);return fh+Th<Sh+ss.min.x||fh>Sh+ss.max.x||wh+Th<Ih+ss.min.y||wh>Ih+ss.max.y};for(let il=0;il<St.length;il++){const Qu=St[il];for(let fh=0;fh<E.length;fh++){const wh=u.getTile(E[fh]);if(!wh||!wh.hasData()||tl(Qu,wh.tileID))continue;const Th=this._createProxiedId(Qu,wh,B[Qu.key]&&B[Qu.key][u.id]),Sh=this.proxyToSource[Qu.key][u.id];Sh?Sh.push(Th):this.proxyToSource[Qu.key][u.id]=[Th],ge.push(Th)}}}_createProxiedId(u,E,B){let ge=this.orthoMatrix;if(B){const St=B.find(_n=>_n.key===E.tileID.key);if(St)return St}if(E.tileID.key!==u.key){const St=u.canonical.z-E.tileID.canonical.z;let _n,Bn,ss;ge=o.create();const tl=E.tileID.wrap-u.wrap<<u.overscaledZ;St>0?(_n=o.EXTENT>>St,Bn=_n*((E.tileID.canonical.x<<St)-u.canonical.x+tl),ss=_n*((E.tileID.canonical.y<<St)-u.canonical.y)):(_n=o.EXTENT<<-St,Bn=o.EXTENT*(E.tileID.canonical.x-(u.canonical.x+tl<<-St)),ss=o.EXTENT*(E.tileID.canonical.y-(u.canonical.y<<-St))),o.ortho(ge,0,_n,0,_n,0,1),o.translate(ge,ge,[Bn,ss,0])}return new _y(E.tileID,u.key,ge)}_findTileCoveringTileID(u,E){let B=E.getTile(u);if(B&&B.hasData())return B;const ge=this._findCoveringTileCache[E.id],St=ge[u.key];if(B=St?E.getTileByID(St):null,B&&B.hasData()||St===null)return B;let _n=B?B.tileID:u,Bn=_n.overscaledZ;const ss=E.getSource().minzoom,tl=[];if(!St){const Qu=E.getSource().maxzoom;if(u.canonical.z>=Qu){const fh=u.canonical.z-Qu;E.getSource().reparseOverscaled?(Bn=Math.max(u.canonical.z+2,E.transform.tileZoom),_n=new o.OverscaledTileID(Bn,u.wrap,Qu,u.canonical.x>>fh,u.canonical.y>>fh)):fh!==0&&(Bn=Qu,_n=new o.OverscaledTileID(Bn,u.wrap,Qu,u.canonical.x>>fh,u.canonical.y>>fh))}_n.key!==u.key&&(tl.push(_n.key),B=E.getTile(_n))}const il=Qu=>{tl.forEach(fh=>{ge[fh]=Qu}),tl.length=0};for(Bn-=1;Bn>=ss&&(!B||!B.hasData());Bn--){B&&il(B.tileID.key);const Qu=_n.calculateScaledKey(Bn);if(B=E.getTileByID(Qu),B&&B.hasData())break;const fh=ge[Qu];if(fh===null)break;fh===void 0?tl.push(Qu):B=E.getTileByID(fh)}return il(B?B.tileID.key:null),B&&B.hasData()?B:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,E){let B=this._tilesDirty[u];B||(B=this._tilesDirty[u]={}),B[E.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const u=function(E){let B=0;const ge=new o.StructArrayLayout2ui4,St=131;for(let _n=1;_n<129;_n++){for(let Bn=1;Bn<129;Bn++)B=_n*St+Bn,ge.emplaceBack(B,B+1),ge.emplaceBack(B,B+St),ge.emplaceBack(B+1,B+St),_n===128&&ge.emplaceBack(B+St,B+St+1);ge.emplaceBack(B+1,B+1+St)}return ge}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(u),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,u.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xm{static cacheKey(u,E,B,ge){let St=`${E}${ge?ge.cacheKey:""}`;for(const _n of B)u.usedDefines.includes(_n)&&(St+=`/${_n}`);return St}constructor(u,E,B,ge,St,_n){const Bn=u.gl;this.program=Bn.createProgram();const ss=function(hh){const Oh=[];for(let Rh=0;Rh<hh.length;Rh++){if(hh[Rh]===null)continue;const Nh=hh[Rh].split(" ");Oh.push(Nh.pop())}return Oh}(B.staticAttributes),tl=ge?ge.getBinderAttributes():[],il=ss.concat(tl);let Qu=ge?ge.defines():[];Qu=Qu.concat(_n.map(hh=>`#define ${hh}`));const fh=u.isWebGL2?`#version 300 es
`:"",wh=fh+Qu.concat(u.extStandardDerivatives&&fh.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(gy):gy,gy,l0,my.fragmentSource,wm.fragmentSource,B.fragmentSource).join(`
`),Th=fh+Qu.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,l0,my.vertexSource,wm.vertexSource,a0.vertexSource,B.vertexSource).join(`
`),Sh=Bn.createShader(Bn.FRAGMENT_SHADER);if(Bn.isContextLost())return void(this.failedToCreate=!0);Bn.shaderSource(Sh,wh),Bn.compileShader(Sh),Bn.attachShader(this.program,Sh);const Ih=Bn.createShader(Bn.VERTEX_SHADER);if(Bn.isContextLost())this.failedToCreate=!0;else{Bn.shaderSource(Ih,Th),Bn.compileShader(Ih),Bn.attachShader(this.program,Ih),this.attributes={},this.numAttributes=il.length;for(let hh=0;hh<this.numAttributes;hh++)il[hh]&&(Bn.bindAttribLocation(this.program,hh,il[hh]),this.attributes[il[hh]]=hh);Bn.linkProgram(this.program),Bn.deleteShader(Ih),Bn.deleteShader(Sh),this.fixedUniforms=St(u),this.binderUniforms=ge?ge.getUniforms(u):[],_n.includes("TERRAIN")&&(this.terrainUniforms=(hh=>({u_dem:new o.Uniform1i(hh),u_dem_prev:new o.Uniform1i(hh),u_dem_unpack:new o.Uniform4f(hh),u_dem_tl:new o.Uniform2f(hh),u_dem_scale:new o.Uniform1f(hh),u_dem_tl_prev:new o.Uniform2f(hh),u_dem_scale_prev:new o.Uniform1f(hh),u_dem_size:new o.Uniform1f(hh),u_dem_lerp:new o.Uniform1f(hh),u_exaggeration:new o.Uniform1f(hh),u_depth:new o.Uniform1i(hh),u_depth_size_inv:new o.Uniform2f(hh),u_meter_to_dem:new o.Uniform1f(hh),u_label_plane_matrix_inv:new o.UniformMatrix4f(hh)}))(u)),_n.includes("GLOBE")&&(this.globeUniforms=(hh=>({u_tile_tl_up:new o.Uniform3f(hh),u_tile_tr_up:new o.Uniform3f(hh),u_tile_br_up:new o.Uniform3f(hh),u_tile_bl_up:new o.Uniform3f(hh),u_tile_up_scale:new o.Uniform1f(hh)}))(u)),_n.includes("FOG")&&(this.fogUniforms=(hh=>({u_fog_matrix:new o.UniformMatrix4f(hh),u_fog_range:new o.Uniform2f(hh),u_fog_color:new o.Uniform4f(hh),u_fog_horizon_blend:new o.Uniform1f(hh),u_fog_temporal_offset:new o.Uniform1f(hh),u_frustum_tl:new o.Uniform3f(hh),u_frustum_tr:new o.Uniform3f(hh),u_frustum_br:new o.Uniform3f(hh),u_frustum_bl:new o.Uniform3f(hh),u_globe_pos:new o.Uniform3f(hh),u_globe_radius:new o.Uniform1f(hh),u_globe_transition:new o.Uniform1f(hh),u_is_globe:new o.Uniform1i(hh),u_viewport:new o.Uniform2f(hh)}))(u))}}setTerrainUniformValues(u,E){if(!this.terrainUniforms)return;const B=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const ge in E)B[ge]&&B[ge].set(this.program,ge,E[ge])}}setGlobeUniformValues(u,E){if(!this.globeUniforms)return;const B=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const ge in E)B[ge]&&B[ge].set(this.program,ge,E[ge])}}setFogUniformValues(u,E){if(!this.fogUniforms)return;const B=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const ge in E)B[ge].set(this.program,ge,E[ge])}}draw(u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh){const Ih=u.gl;if(this.failedToCreate)return;u.program.set(this.program),u.setDepthMode(B),u.setStencilMode(ge),u.setColorMode(St),u.setCullFace(_n);for(const Oh of Object.keys(this.fixedUniforms))this.fixedUniforms[Oh].set(this.program,Oh,Bn[Oh]);Th&&Th.setUniforms(this.program,u,this.binderUniforms,fh,{zoom:wh});const hh={[Ih.LINES]:2,[Ih.TRIANGLES]:3,[Ih.LINE_STRIP]:1}[E];for(const Oh of Qu.get()){const Rh=Oh.vaos||(Oh.vaos={});(Rh[ss]||(Rh[ss]=new Ny)).bind(u,this,tl,Th?Th.getPaintVertexBuffers():[],il,Oh.vertexOffset,Sh||[]),Ih.drawElements(E,Oh.primitiveLength*hh,Ih.UNSIGNED_SHORT,Oh.primitiveOffset*hh*2)}}}function d0(L,u){const E=Math.pow(2,u.tileID.overscaledZ),B=u.tileSize*Math.pow(2,L.transform.tileZoom)/E,ge=B*(u.tileID.canonical.x+u.tileID.wrap*E),St=B*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_tile_units_to_pixels:1/Td(u,1,L.transform.tileZoom),u_pixel_coord_upper:[ge>>16,St>>16],u_pixel_coord_lower:[65535&ge,65535&St]}}const um=o.create(),Vy=(L,u,E,B,ge,St,_n,Bn,ss,tl,il)=>{const Qu=u.style.light,fh=Qu.properties.get("position"),wh=[fh.x,fh.y,fh.z],Th=o.create$1();Qu.properties.get("anchor")==="viewport"&&(o.fromRotation(Th,-u.transform.angle),o.transformMat3(wh,wh,Th));const Sh=Qu.properties.get("color"),Ih=u.transform,hh={u_matrix:L,u_lightpos:wh,u_lightintensity:Qu.properties.get("intensity"),u_lightcolor:[Sh.r,Sh.g,Sh.b],u_vertical_gradient:+E,u_opacity:B,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:um,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:ge,u_edge_radius:St};return Ih.projection.name==="globe"&&(hh.u_tile_id=[_n.canonical.x,_n.canonical.y,1<<_n.canonical.z],hh.u_zoom_transition=ss,hh.u_inv_rot_matrix=il,hh.u_merc_center=tl,hh.u_up_dir=Ih.projection.upVector(new o.CanonicalTileID(0,0,0),tl[0]*o.EXTENT,tl[1]*o.EXTENT),hh.u_height_lift=Bn),hh},zm=(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu)=>{const fh=Vy(L,u,E,B,ge,St,_n,ss,tl,il,Qu),wh={u_height_factor:-Math.pow(2,_n.overscaledZ)/Bn.tileSize/8};return o.extend(fh,d0(u,Bn),wh)},Im=L=>({u_matrix:L}),g_=(L,u,E)=>o.extend(Im(L),d0(u,E)),ly=(L,u)=>({u_matrix:L,u_world:u}),xv=(L,u,E,B)=>o.extend(g_(L,u,E),{u_world:B}),cy=o.create(),f0=(L,u,E,B,ge,St)=>{const _n=L.transform,Bn=_n.projection.name==="globe";let ss;if(St.paint.get("circle-pitch-alignment")==="map")if(Bn){const il=o.globePixelsToTileUnits(_n.zoom,u.canonical)*_n._pixelsPerMercatorPixel;ss=Float32Array.from([il,0,0,il])}else ss=_n.calculatePixelsToTileUnitsMatrix(E);else ss=new Float32Array([_n.pixelsToGLUnits[0],0,0,_n.pixelsToGLUnits[1]]);const tl={u_camera_to_center_distance:_n.cameraToCenterDistance,u_matrix:L.translatePosMatrix(u.projMatrix,E,St.paint.get("circle-translate"),St.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:ss,u_inv_rot_matrix:cy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Bn){tl.u_inv_rot_matrix=B,tl.u_merc_center=ge,tl.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],tl.u_zoom_transition=o.globeToMercatorTransition(_n.zoom);const il=ge[0]*o.EXTENT,Qu=ge[1]*o.EXTENT;tl.u_up_dir=_n.projection.upVector(new o.CanonicalTileID(0,0,0),il,Qu)}return tl},__=L=>{const u=[];return L.paint.get("circle-pitch-alignment")==="map"&&u.push("PITCH_WITH_MAP"),L.paint.get("circle-pitch-scale")==="map"&&u.push("SCALE_WITH_MAP"),u},H_=(L,u,E,B)=>{const ge=o.EXTENT/E.tileSize;return{u_matrix:L,u_camera_to_center_distance:u.getCameraToCenterDistance(B),u_extrude_scale:[u.pixelsToGLUnits[0]/ge,u.pixelsToGLUnits[1]/ge]}},jy=(L,u,E=1)=>({u_matrix:L,u_color:u,u_overlay:0,u_overlay_scale:E}),yy=o.create(),Qg=(L,u,E,B,ge,St,_n)=>{const Bn=L.transform,ss=Bn.projection.name==="globe",tl=ss?o.globePixelsToTileUnits(Bn.zoom,u.canonical)*Bn._pixelsPerMercatorPixel:Td(E,1,St),il={u_matrix:u.projMatrix,u_extrude_scale:tl,u_intensity:_n,u_inv_rot_matrix:yy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(ss){il.u_inv_rot_matrix=B,il.u_merc_center=ge,il.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],il.u_zoom_transition=o.globeToMercatorTransition(Bn.zoom);const Qu=ge[0]*o.EXTENT,fh=ge[1]*o.EXTENT;il.u_up_dir=Bn.projection.upVector(new o.CanonicalTileID(0,0,0),Qu,fh)}return il},qy=(L,u,E,B,ge,St,_n)=>{const Bn=L.transform,ss=Bn.calculatePixelsToTileUnitsMatrix(u);return{u_matrix:C_(L,u,E,B),u_pixels_to_tile_units:ss,u_device_pixel_ratio:St,u_units_to_pixels:[1/Bn.pixelsToGLUnits[0],1/Bn.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:ge,u_texsize:m0(E)?u.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:p0(u,L.transform),u_alpha_discard_threshold:0,u_trim_offset:_n}},rv=(L,u,E,B,ge)=>{const St=L.transform;return{u_matrix:C_(L,u,E,B),u_texsize:u.imageAtlasTexture.size,u_pixels_to_tile_units:St.calculatePixelsToTileUnitsMatrix(u),u_device_pixel_ratio:ge,u_image:0,u_tile_units_to_pixels:p0(u,St),u_units_to_pixels:[1/St.pixelsToGLUnits[0],1/St.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function p0(L,u){return 1/Td(L,1,u.tileZoom)}function C_(L,u,E,B){return L.translatePosMatrix(B||u.tileID.projMatrix,u,E.paint.get("line-translate"),E.paint.get("line-translate-anchor"))}function m0(L){const u=L.paint.get("line-dasharray").value;return u.value||u.kind!=="constant"}const X_=(L,u,E,B,ge,St)=>{return{u_matrix:L,u_tl_parent:u,u_scale_parent:E,u_fade_t:B.mix,u_opacity:B.opacity*ge.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ge.paint.get("raster-brightness-min"),u_brightness_high:ge.paint.get("raster-brightness-max"),u_saturation_factor:(Bn=ge.paint.get("raster-saturation"),Bn>0?1-1/(1.001-Bn):-Bn),u_contrast_factor:(_n=ge.paint.get("raster-contrast"),_n>0?1/(1-_n):1+_n),u_spin_weights:hd(ge.paint.get("raster-hue-rotate")),u_perspective_transform:St};var _n,Bn};function hd(L){L*=Math.PI/180;const u=Math.sin(L),E=Math.cos(L);return[(2*E+1)/3,(-Math.sqrt(3)*u-E+1)/3,(Math.sqrt(3)*u-E+1)/3]}const wf=o.create(),ip=(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh)=>{const Ih=ge.transform,hh={u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ih.cameraToCenterDistance,u_rotate_symbol:+E,u_aspect_ratio:Ih.width/Ih.height,u_fade_change:ge.options.fadeDuration?ge.symbolFadeChange:1,u_matrix:St,u_label_plane_matrix:_n,u_coord_matrix:Bn,u_is_text:+ss,u_pitch_with_map:+B,u_texsize:tl,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wf,u_up_vector:[0,-1,0]};return Sh.name==="globe"&&(hh.u_tile_id=[il.canonical.x,il.canonical.y,1<<il.canonical.z],hh.u_zoom_transition=Qu,hh.u_inv_rot_matrix=wh,hh.u_merc_center=fh,hh.u_camera_forward=Ih._camera.forward(),hh.u_ecef_origin=o.globeECEFOrigin(Ih.globeMatrix,il.toUnwrapped()),hh.u_tile_matrix=Float32Array.from(Ih.globeMatrix),hh.u_up_vector=Th),hh},Bp=(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh,Ih)=>o.extend(ip(L,u,E,B,ge,St,_n,Bn,ss,tl,Qu,fh,wh,Th,Sh,Ih),{u_gamma_scale:B?ge.transform.cameraToCenterDistance*Math.cos(ge.terrain?0:ge.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+il}),Nm=(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu,fh,wh,Th,Sh)=>o.extend(Bp(L,u,E,B,ge,St,_n,Bn,!0,ss,!0,il,Qu,fh,wh,Th,Sh),{u_texsize_icon:tl,u_texture_icon:1}),hm=(L,u,E)=>({u_matrix:L,u_opacity:u,u_color:E}),Qm=(L,u,E,B,ge)=>o.extend(function(St,_n,Bn){const ss=_n.imageManager.getPattern(St.toString()),{width:tl,height:il}=_n.imageManager.getPixelSize(),Qu=Math.pow(2,Bn.tileID.overscaledZ),fh=Bn.tileSize*Math.pow(2,_n.transform.tileZoom)/Qu,wh=fh*(Bn.tileID.canonical.x+Bn.tileID.wrap*Qu),Th=fh*Bn.tileID.canonical.y;return{u_image:0,u_pattern_tl:ss.tl,u_pattern_br:ss.br,u_texsize:[tl,il],u_pattern_size:ss.displaySize,u_tile_units_to_pixels:1/Td(Bn,1,_n.transform.tileZoom),u_pixel_coord_upper:[wh>>16,Th>>16],u_pixel_coord_lower:[65535&wh,65535&Th]}}(B,E,ge),{u_matrix:L,u_opacity:u}),og={fillExtrusion:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L)}),fillExtrusionPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_height_factor:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L)}),fill:L=>({u_matrix:new o.UniformMatrix4f(L)}),fillPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),fillOutline:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L)}),fillOutlinePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),circle:L=>({u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),collisionBox:L=>({u_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.Uniform2f(L)}),collisionCircle:L=>({u_matrix:new o.UniformMatrix4f(L),u_inv_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_viewport_size:new o.Uniform2f(L)}),debug:L=>({u_color:new o.UniformColor(L),u_matrix:new o.UniformMatrix4f(L),u_overlay:new o.Uniform1i(L),u_overlay_scale:new o.Uniform1f(L)}),clippingMask:L=>({u_matrix:new o.UniformMatrix4f(L)}),heatmap:L=>({u_extrude_scale:new o.Uniform1f(L),u_intensity:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),heatmapTexture:L=>({u_image:new o.Uniform1i(L),u_color_ramp:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L)}),hillshade:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_latrange:new o.Uniform2f(L),u_light:new o.Uniform2f(L),u_shadow:new o.UniformColor(L),u_highlight:new o.UniformColor(L),u_accent:new o.UniformColor(L)}),hillshadePrepare:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_dimension:new o.Uniform2f(L),u_zoom:new o.Uniform1f(L),u_unpack:new o.Uniform4f(L)}),line:L=>({u_matrix:new o.UniformMatrix4f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_units_to_pixels:new o.Uniform2f(L),u_dash_image:new o.Uniform1i(L),u_gradient_image:new o.Uniform1i(L),u_image_height:new o.Uniform1f(L),u_texsize:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L),u_trim_offset:new o.Uniform2f(L)}),linePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_texsize:new o.Uniform2f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_units_to_pixels:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L)}),raster:L=>({u_matrix:new o.UniformMatrix4f(L),u_tl_parent:new o.Uniform2f(L),u_scale_parent:new o.Uniform1f(L),u_fade_t:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_image0:new o.Uniform1i(L),u_image1:new o.Uniform1i(L),u_brightness_low:new o.Uniform1f(L),u_brightness_high:new o.Uniform1f(L),u_saturation_factor:new o.Uniform1f(L),u_contrast_factor:new o.Uniform1f(L),u_spin_weights:new o.Uniform3f(L),u_perspective_transform:new o.Uniform2f(L)}),symbolIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_texture:new o.Uniform1i(L)}),symbolSDF:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_is_halo:new o.Uniform1i(L)}),symbolTextAndIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texsize_icon:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_texture_icon:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_is_halo:new o.Uniform1i(L)}),background:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_color:new o.UniformColor(L)}),backgroundPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_pattern_tl:new o.Uniform2f(L),u_pattern_br:new o.Uniform2f(L),u_texsize:new o.Uniform2f(L),u_pattern_size:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),terrainRaster:u0,terrainDepth:u0,skybox:L=>({u_matrix:new o.UniformMatrix4f(L),u_sun_direction:new o.Uniform3f(L),u_cubemap:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxGradient:L=>({u_matrix:new o.UniformMatrix4f(L),u_color_ramp:new o.Uniform1i(L),u_center_direction:new o.Uniform3f(L),u_radius:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxCapture:L=>({u_matrix_3f:new o.UniformMatrix3f(L),u_sun_direction:new o.Uniform3f(L),u_sun_intensity:new o.Uniform1f(L),u_color_tint_r:new o.Uniform4f(L),u_color_tint_m:new o.Uniform4f(L),u_luminance:new o.Uniform1f(L)}),globeRaster:L=>({u_proj_matrix:new o.UniformMatrix4f(L),u_globe_matrix:new o.UniformMatrix4f(L),u_normalize_matrix:new o.UniformMatrix4f(L),u_merc_matrix:new o.UniformMatrix4f(L),u_zoom_transition:new o.Uniform1f(L),u_merc_center:new o.Uniform2f(L),u_image0:new o.Uniform1i(L),u_grid_matrix:new o.UniformMatrix3f(L),u_skirt_height:new o.Uniform1f(L),u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_globe_pos:new o.Uniform3f(L),u_globe_radius:new o.Uniform1f(L),u_viewport:new o.Uniform2f(L)}),globeAtmosphere:L=>({u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_horizon:new o.Uniform1f(L),u_transition:new o.Uniform1f(L),u_fadeout_range:new o.Uniform1f(L),u_color:new o.Uniform4f(L),u_high_color:new o.Uniform4f(L),u_space_color:new o.Uniform4f(L),u_star_intensity:new o.Uniform1f(L),u_star_density:new o.Uniform1f(L),u_star_size:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L),u_horizon_angle:new o.Uniform1f(L),u_rotation_matrix:new o.UniformMatrix4f(L)})};let sg;function Vm(L,u,E,B,ge,St,_n){const Bn=L.context,ss=Bn.gl,tl=L.transform,il=L.useProgram("collisionBox"),Qu=[];let fh=0,wh=0;for(let Nh=0;Nh<B.length;Nh++){const qh=B[Nh],$h=u.getTile(qh),Hh=$h.getBucket(E);if(!Hh)continue;const ld=lp(qh,Hh,tl);let xd=ld;ge[0]===0&&ge[1]===0||(xd=L.translatePosMatrix(ld,$h,ge,St));const gd=_n?Hh.textCollisionBox:Hh.iconCollisionBox,Vf=Hh.collisionCircleArray;if(Vf.length>0){const _d=o.create(),Mf=xd;o.mul(_d,Hh.placementInvProjMatrix,tl.glCoordMatrix),o.mul(_d,_d,Hh.placementViewportMatrix),Qu.push({circleArray:Vf,circleOffset:wh,transform:Mf,invTransform:_d,projection:Hh.getProjection()}),fh+=Vf.length/4,wh=fh}gd&&(L.terrain&&L.terrain.setupElevationDraw($h,il),il.draw(Bn,ss.LINES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,H_(xd,tl,$h,Hh.getProjection()),E.id,gd.layoutVertexBuffer,gd.indexBuffer,gd.segments,null,tl.zoom,null,[gd.collisionVertexBuffer,gd.collisionVertexBufferExt]))}if(!_n||!Qu.length)return;const Th=L.useProgram("collisionCircle"),Sh=new o.StructArrayLayout2f1f2i16;Sh.resize(4*fh),Sh._trim();let Ih=0;for(const Nh of Qu)for(let qh=0;qh<Nh.circleArray.length/4;qh++){const $h=4*qh,Hh=Nh.circleArray[$h+0],ld=Nh.circleArray[$h+1],xd=Nh.circleArray[$h+2],gd=Nh.circleArray[$h+3];Sh.emplace(Ih++,Hh,ld,xd,gd,0),Sh.emplace(Ih++,Hh,ld,xd,gd,1),Sh.emplace(Ih++,Hh,ld,xd,gd,2),Sh.emplace(Ih++,Hh,ld,xd,gd,3)}(!sg||sg.length<2*fh)&&(sg=function(Nh){const qh=2*Nh,$h=new o.StructArrayLayout3ui6;$h.resize(qh),$h._trim();for(let Hh=0;Hh<qh;Hh++){const ld=6*Hh;$h.uint16[ld+0]=4*Hh+0,$h.uint16[ld+1]=4*Hh+1,$h.uint16[ld+2]=4*Hh+2,$h.uint16[ld+3]=4*Hh+2,$h.uint16[ld+4]=4*Hh+3,$h.uint16[ld+5]=4*Hh+0}return $h}(fh));const hh=Bn.createIndexBuffer(sg,!0),Oh=Bn.createVertexBuffer(Sh,o.collisionCircleLayout.members,!0);for(const Nh of Qu){const qh={u_matrix:Nh.transform,u_inv_matrix:Nh.invTransform,u_camera_to_center_distance:(Rh=tl).getCameraToCenterDistance(Nh.projection),u_viewport_size:[Rh.width,Rh.height]};Th.draw(Bn,ss.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,qh,E.id,Oh,hh,o.SegmentVector.simpleSegment(0,2*Nh.circleOffset,Nh.circleArray.length,Nh.circleArray.length/2),null,tl.zoom)}var Rh;Oh.destroy(),hh.destroy()}const tp=o.create();function Wg({width:L,height:u,anchor:E,textOffset:B,textScale:ge},St){const{horizontalAlign:_n,verticalAlign:Bn}=o.getAnchorAlignment(E),ss=-(_n-.5)*L,tl=-(Bn-.5)*u,il=o.evaluateVariableOffset(E,B);return new o.pointGeometry((ss/ge+il[0])*St,(tl/ge+il[1])*St)}function Sg(L,u,E,B,ge,St,_n,Bn,ss,tl,il){const Qu=L.text.placedSymbolArray,fh=L.text.dynamicLayoutVertexArray,wh=L.icon.dynamicLayoutVertexArray,Th={},Sh=L.getProjection(),Ih=Zp(Bn,Sh,St),hh=St.elevation,Oh=Sh.upVectorScale(Bn.canonical,St.center.lat,St.worldSize).metersToTile;fh.clear();for(let Rh=0;Rh<Qu.length;Rh++){const Nh=Qu.get(Rh),{tileAnchorX:qh,tileAnchorY:$h,numGlyphs:Hh}=Nh,ld=L.allowVerticalPlacement&&!Nh.placedOrientation,xd=Nh.hidden||!Nh.crossTileID||ld?null:B[Nh.crossTileID];if(xd){let gd=0,Vf=0,_d=0;if(hh){const Dp=hh?hh.getAtTileOffset(Bn,qh,$h):0,[rm,Mp,xp]=Sh.upVector(Bn.canonical,qh,$h);gd=Dp*rm*Oh,Vf=Dp*Mp*Oh,_d=Dp*xp*Oh}let[Mf,Ud,Lf,Md]=ep(Nh.projectedAnchorX+gd,Nh.projectedAnchorY+Vf,Nh.projectedAnchorZ+_d,E?Ih:_n);const pd=im(St.getCameraToCenterDistance(Sh),Md);let Bd=ge.evaluateSizeForFeature(L.textSizeData,tl,Nh)*pd/o.ONE_EM;E&&(Bd*=L.tilePixelRatio/ss);const mf=Wg(xd,Bd);E?({x:Mf,y:Ud,z:Lf}=Sh.projectTilePoint(qh+mf.x,$h+mf.y,Bn.canonical),[Mf,Ud,Lf]=ep(Mf+gd,Ud+Vf,Lf+_d,_n)):(u&&mf._rotate(-St.angle),Mf+=mf.x,Ud+=mf.y,Lf=0);const Bf=L.allowVerticalPlacement&&Nh.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Dp=0;Dp<Hh;Dp++)o.addDynamicAttributes(fh,Mf,Ud,Lf,Bf);il&&Nh.associatedIconIndex>=0&&(Th[Nh.associatedIconIndex]={x:Mf,y:Ud,z:Lf,angle:Bf})}else sd(Hh,fh)}if(il){wh.clear();const Rh=L.icon.placedSymbolArray;for(let Nh=0;Nh<Rh.length;Nh++){const qh=Rh.get(Nh),{numGlyphs:$h}=qh,Hh=Th[Nh];if(qh.hidden||!Hh)sd($h,wh);else{const{x:ld,y:xd,z:gd,angle:Vf}=Hh;for(let _d=0;_d<$h;_d++)o.addDynamicAttributes(wh,ld,xd,gd,Vf)}}L.icon.dynamicLayoutVertexBuffer.updateData(wh)}L.text.dynamicLayoutVertexBuffer.updateData(fh)}function fg(L,u,E){return E.iconsInText&&u?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function A_(L,u,E,B,ge,St,_n,Bn,ss,tl,il,Qu){const fh=L.context,wh=fh.gl,Th=L.transform,Sh=Bn==="map",Ih=ss==="map",hh=Sh&&E.layout.get("symbol-placement")!=="point",Oh=Sh&&!Ih&&!hh,Rh=E.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Nh=!1;const qh=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),$h=[o.mercatorXfromLng(Th.center.lng),o.mercatorYfromLat(Th.center.lat)],Hh=E.layout.get("text-variable-anchor"),ld=Th.projection.name==="globe",xd=[],gd=[0,-1,0];let Vf=gd;!ld&&!Th.mercatorFromTransition||Sh||(Vf=function(_d){const Mf=_d._camera.getWorldToCamera(_d.worldSize,1),Ud=o.multiply([],Mf,_d.globeMatrix);o.invert(Ud,Ud);const Lf=[0,0,0],Md=[0,1,0,0];return o.transformMat4$1(Md,Md,Ud),Lf[0]=Md[0],Lf[1]=Md[1],Lf[2]=Md[2],o.normalize(Lf,Lf),Lf}(Th));for(const _d of B){const Mf=u.getTile(_d),Ud=Mf.getBucket(E);if(!Ud||Ud.projection.name==="mercator"&&ld)continue;const Lf=ge?Ud.text:Ud.icon;if(!Lf||Ud.fullyClipped||!Lf.segments.get().length)continue;const Md=Lf.programConfigurations.get(E.id),pd=ge||Ud.sdfIcons,Bd=ge?Ud.textSizeData:Ud.iconSizeData,mf=Ih||Th.pitch!==0,Bf=o.evaluateSizeForZoom(Bd,Th.zoom);let Dp,rm,Mp,xp,Lp=[0,0],dm=null;if(ge){if(rm=Mf.glyphAtlasTexture,Mp=wh.LINEAR,Dp=Mf.glyphAtlasTexture.size,Ud.iconsInText){Lp=Mf.imageAtlasTexture.size,dm=Mf.imageAtlasTexture;const uy=Bd.kind==="composite"||Bd.kind==="camera";xp=mf||L.options.rotating||L.options.zooming||uy?wh.LINEAR:wh.NEAREST}}else{const uy=E.layout.get("icon-size").constantOr(0)!==1||Ud.iconsNeedLinear;rm=Mf.imageAtlasTexture,Mp=pd||L.options.rotating||L.options.zooming||uy||mf?wh.LINEAR:wh.NEAREST,Dp=Mf.imageAtlasTexture.size}const Fp=Ud.projection.name==="globe",km=Fp?Vf:gd,Am=Fp?o.globeToMercatorTransition(Th.zoom):0,jm=Zp(_d,Ud.getProjection(),Th),Fm=Th.calculatePixelsToTileUnitsMatrix(Mf),gg=l_(jm,Mf.tileID.canonical,Ih,Sh,Th,Ud.getProjection(),Fm),lg=L.terrain&&Ih&&hh?o.invert(o.create(),gg):tp,My=c_(jm,Mf.tileID.canonical,Ih,Sh,Th,Ud.getProjection(),Fm),V0=Hh&&Ud.hasTextData(),ig=E.layout.get("icon-text-fit")!=="none"&&V0&&Ud.hasIconData();if(hh){const uy=Th.elevation,Cy=uy?uy.getAtTileOffsetFunc(_d,Th.center.lat,Th.worldSize,Ud.getProjection()):null,G0=ev(jm,Mf.tileID.canonical,Ih,Sh,Th,Ud.getProjection(),Fm);mm(Ud,jm,L,ge,G0,My,Ih,tl,Cy,_d)}const qm=hh||ge&&Hh||ig,_m=L.translatePosMatrix(jm,Mf,St,_n),cg=qm?tp:gg,r_=L.translatePosMatrix(My,Mf,St,_n,!0),Dm=Ud.getProjection().createInversionMatrix(Th,_d.canonical),jg=[];L.terrainRenderModeElevated()&&Ih&&jg.push("PITCH_WITH_MAP_TERRAIN"),Fp&&jg.push("PROJECTION_GLOBE_VIEW"),qm&&jg.push("PROJECTED_POS_ON_VIEWPORT");const y_=pd&&E.paint.get(ge?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let hv;hv=pd?Ud.iconsInText?Nm(Bd.kind,Bf,Oh,Ih,L,_m,cg,r_,Dp,Lp,_d,Am,$h,Dm,km,Ud.getProjection()):Bp(Bd.kind,Bf,Oh,Ih,L,_m,cg,r_,ge,Dp,!0,_d,Am,$h,Dm,km,Ud.getProjection()):ip(Bd.kind,Bf,Oh,Ih,L,_m,cg,r_,ge,Dp,_d,Am,$h,Dm,km,Ud.getProjection());const Hv={program:L.useProgram(fg(pd,ge,Ud),Md,jg),buffers:Lf,uniformValues:hv,atlasTexture:rm,atlasTextureIcon:dm,atlasInterpolation:Mp,atlasInterpolationIcon:xp,isSDF:pd,hasHalo:y_,tile:Mf,labelPlaneMatrixInv:lg};if(Rh&&Ud.canOverlap){Nh=!0;const uy=Lf.segments.get();for(const Cy of uy)xd.push({segments:new o.SegmentVector([Cy]),sortKey:Cy.sortKey,state:Hv})}else xd.push({segments:Lf.segments,sortKey:0,state:Hv})}Nh&&xd.sort((_d,Mf)=>_d.sortKey-Mf.sortKey);for(const _d of xd){const Mf=_d.state;if(L.terrain&&L.terrain.setupElevationDraw(Mf.tile,Mf.program,{useDepthForOcclusion:!ld,labelPlaneMatrixInv:Mf.labelPlaneMatrixInv}),fh.activeTexture.set(wh.TEXTURE0),Mf.atlasTexture.bind(Mf.atlasInterpolation,wh.CLAMP_TO_EDGE),Mf.atlasTextureIcon&&(fh.activeTexture.set(wh.TEXTURE1),Mf.atlasTextureIcon&&Mf.atlasTextureIcon.bind(Mf.atlasInterpolationIcon,wh.CLAMP_TO_EDGE)),Mf.isSDF){const Ud=Mf.uniformValues;Mf.hasHalo&&(Ud.u_is_halo=1,ap(Mf.buffers,_d.segments,E,L,Mf.program,qh,il,Qu,Ud)),Ud.u_is_halo=0}ap(Mf.buffers,_d.segments,E,L,Mf.program,qh,il,Qu,Mf.uniformValues)}}function ap(L,u,E,B,ge,St,_n,Bn,ss){const tl=B.context,il=[L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer,L.globeExtVertexBuffer];ge.draw(tl,tl.gl.TRIANGLES,St,_n,Bn,o.CullFaceMode.disabled,ss,E.id,L.layoutVertexBuffer,L.indexBuffer,u,E.paint,B.transform.zoom,L.programConfigurations.get(E.id),il)}function Zy(L,u,E,B,ge,St,_n){const Bn=L.context.gl,ss=E.paint.get("fill-pattern"),tl=ss&&ss.constantOr(1);let il,Qu,fh,wh,Th;_n?(Qu=tl&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",il=Bn.LINES):(Qu=tl?"fillPattern":"fill",il=Bn.TRIANGLES);for(const Sh of B){const Ih=u.getTile(Sh);if(tl&&!Ih.patternsLoaded())continue;const hh=Ih.getBucket(E);if(!hh)continue;L.prepareDrawTile();const Oh=hh.programConfigurations.get(E.id),Rh=L.useProgram(Qu,Oh);tl&&(L.context.activeTexture.set(Bn.TEXTURE0),Ih.imageAtlasTexture.bind(Bn.LINEAR,Bn.CLAMP_TO_EDGE),Oh.updatePaintBuffers());const Nh=ss.constantOr(null);if(Nh&&Ih.imageAtlas){const $h=Ih.imageAtlas.patternPositions[Nh.toString()];$h&&Oh.setConstantPatternPositions($h)}const qh=L.translatePosMatrix(Sh.projMatrix,Ih,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));if(_n){wh=hh.indexBuffer2,Th=hh.segments2;const $h=L.terrain&&L.terrain.renderingToTexture?L.terrain.drapeBufferSize:[Bn.drawingBufferWidth,Bn.drawingBufferHeight];fh=Qu==="fillOutlinePattern"&&tl?xv(qh,L,Ih,$h):ly(qh,$h)}else wh=hh.indexBuffer,Th=hh.segments,fh=tl?g_(qh,L,Ih):Im(qh);L.prepareDrawProgram(L.context,Rh,Sh.toUnwrapped()),Rh.draw(L.context,il,ge,L.stencilModeForClipping(Sh),St,o.CullFaceMode.disabled,fh,E.id,hh.layoutVertexBuffer,wh,Th,E.paint,L.transform.zoom,Oh)}}function vy(L,u,E,B,ge,St,_n){const Bn=L.context,ss=Bn.gl,tl=L.transform,il=E.paint.get("fill-extrusion-pattern"),Qu=il.constantOr(1),fh=E.paint.get("fill-extrusion-opacity"),wh=[E.paint.get("fill-extrusion-ambient-occlusion-intensity"),E.paint.get("fill-extrusion-ambient-occlusion-radius")],Th=E.layout.get("fill-extrusion-edge-radius"),Sh=tl.projection.name==="globe"?o.fillExtrusionHeightLift():0,Ih=tl.projection.name==="globe",hh=Ih?o.globeToMercatorTransition(tl.zoom):0,Oh=[o.mercatorXfromLng(tl.center.lng),o.mercatorYfromLat(tl.center.lat)],Rh=[];Ih&&Rh.push("PROJECTION_GLOBE_VIEW"),wh[0]>0&&Rh.push("FAUX_AO");for(const Nh of B){const qh=u.getTile(Nh),$h=qh.getBucket(E);if(!$h||$h.projection.name!==tl.projection.name)continue;const Hh=$h.programConfigurations.get(E.id),ld=L.useProgram(Qu?"fillExtrusionPattern":"fillExtrusion",Hh,Rh);if(L.terrain){const Lf=L.terrain;if(L.style.terrainSetForDrapingOnly())Lf.setupElevationDraw(qh,ld,{useMeterToDem:!0});else{if(!$h.enableTerrain)continue;if(Lf.setupElevationDraw(qh,ld,{useMeterToDem:!0}),B0(Bn,u,Nh,$h,E,Lf),!$h.centroidVertexBuffer){const Md=ld.attributes.a_centroid_pos;Md!==void 0&&ss.vertexAttrib2f(Md,0,0)}}}Qu&&(L.context.activeTexture.set(ss.TEXTURE0),qh.imageAtlasTexture.bind(ss.LINEAR,ss.CLAMP_TO_EDGE),Hh.updatePaintBuffers());const xd=il.constantOr(null);if(xd&&qh.imageAtlas){const Lf=qh.imageAtlas.patternPositions[xd.toString()];Lf&&Hh.setConstantPatternPositions(Lf)}const gd=L.translatePosMatrix(Nh.projMatrix,qh,E.paint.get("fill-extrusion-translate"),E.paint.get("fill-extrusion-translate-anchor")),Vf=tl.projection.createInversionMatrix(tl,Nh.canonical),_d=E.paint.get("fill-extrusion-vertical-gradient"),Mf=Qu?zm(gd,L,_d,fh,wh,Th,Nh,qh,Sh,hh,Oh,Vf):Vy(gd,L,_d,fh,wh,Th,Nh,Sh,hh,Oh,Vf);L.prepareDrawProgram(Bn,ld,Nh.toUnwrapped());const Ud=[];L.terrain&&Ud.push($h.centroidVertexBuffer),Ih&&Ud.push($h.layoutVertexExtBuffer),ld.draw(Bn,Bn.gl.TRIANGLES,ge,St,_n,o.CullFaceMode.backCCW,Mf,E.id,$h.layoutVertexBuffer,$h.indexBuffer,$h.segments,E.paint,L.transform.zoom,Hh,Ud)}}function B0(L,u,E,B,ge,St){const _n=[hh=>{let Oh=hh.canonical.x-1,Rh=hh.wrap;return Oh<0&&(Oh=(1<<hh.canonical.z)-1,Rh--),new o.OverscaledTileID(hh.overscaledZ,Rh,hh.canonical.z,Oh,hh.canonical.y)},hh=>{let Oh=hh.canonical.x+1,Rh=hh.wrap;return Oh===1<<hh.canonical.z&&(Oh=0,Rh++),new o.OverscaledTileID(hh.overscaledZ,Rh,hh.canonical.z,Oh,hh.canonical.y)},hh=>new o.OverscaledTileID(hh.overscaledZ,hh.wrap,hh.canonical.z,hh.canonical.x,(hh.canonical.y===0?1<<hh.canonical.z:hh.canonical.y)-1),hh=>new o.OverscaledTileID(hh.overscaledZ,hh.wrap,hh.canonical.z,hh.canonical.x,hh.canonical.y===(1<<hh.canonical.z)-1?0:hh.canonical.y+1)],Bn=hh=>{const Oh=u.getSource().minzoom,Rh=qh=>{const $h=u.getTileByID(qh);if($h&&$h.hasData())return $h.getBucket(ge)},Nh=[0,-1,1];for(const qh of Nh){if(hh.overscaledZ+qh<Oh)continue;const $h=Rh(hh.calculateScaledKey(hh.overscaledZ+qh));if($h)return $h}},ss=[0,0,0],tl=(hh,Oh)=>(ss[0]=Math.min(hh.min.y,Oh.min.y),ss[1]=Math.max(hh.max.y,Oh.max.y),ss[2]=o.EXTENT-Oh.min.x>hh.max.x?Oh.min.x-o.EXTENT:hh.max.x,ss),il=(hh,Oh)=>(ss[0]=Math.min(hh.min.x,Oh.min.x),ss[1]=Math.max(hh.max.x,Oh.max.x),ss[2]=o.EXTENT-Oh.min.y>hh.max.y?Oh.min.y-o.EXTENT:hh.max.y,ss),Qu=[(hh,Oh)=>tl(hh,Oh),(hh,Oh)=>tl(Oh,hh),(hh,Oh)=>il(hh,Oh),(hh,Oh)=>il(Oh,hh)],fh=new o.pointGeometry(0,0);let wh,Th,Sh;const Ih=(hh,Oh,Rh,Nh,qh)=>{const $h=[[Nh?Rh:hh,Nh?hh:Rh,0],[Nh?Rh:Oh,Nh?Oh:Rh,0]],Hh=qh<0?o.EXTENT+qh:qh,ld=[Nh?Hh:(hh+Oh)/2,Nh?(hh+Oh)/2:Hh,0];return Rh===0&&qh<0||Rh!==0&&qh>0?St.getForTilePoints(Sh,[ld],!0,Th):$h.push(ld),St.getForTilePoints(E,$h,!0,wh),Math.max($h[0][2],$h[1][2],ld[2])/St.exaggeration()};for(let hh=0;hh<4;hh++){const Oh=(hh<2?1:5)-hh,Rh=B.borders[hh];if(Rh.length===0)continue;const Nh=Sh=_n[hh](E),qh=Bn(Nh);if(!(qh&&qh instanceof o.FillExtrusionBucket&&qh.enableTerrain)||B.borderDoneWithNeighborZ[hh]===qh.canonical.z&&qh.borderDoneWithNeighborZ[Oh]===B.canonical.z||(Th=St.findDEMTileFor(Nh),!Th||!Th.dem))continue;if(!wh){const xd=St.findDEMTileFor(E);if(!xd||!xd.dem)return;wh=xd}const $h=qh.borders[Oh];let Hh=0;const ld=qh.borderDoneWithNeighborZ[Oh]!==B.canonical.z;if(B.canonical.z===qh.canonical.z){for(let xd=0;xd<Rh.length;xd++){const gd=B.featuresOnBorder[Rh[xd]],Vf=gd.borders[hh];let _d;for(;Hh<$h.length&&(_d=qh.featuresOnBorder[$h[Hh]],!(_d.borders[Oh][1]>Vf[0]+3));)ld&&qh.encodeCentroid(void 0,_d,!1),Hh++;if(_d&&Hh<$h.length){const Mf=Hh;let Ud=0;for(;!(_d.borders[Oh][0]>Vf[1]-3)&&(Ud++,++Hh!==$h.length);)_d=qh.featuresOnBorder[$h[Hh]];if(_d=qh.featuresOnBorder[$h[Mf]],gd.intersectsCount()>1||_d.intersectsCount()>1||Ud!==1){Ud!==1&&(Hh=Mf),B.encodeCentroid(void 0,gd,!1),ld&&qh.encodeCentroid(void 0,_d,!1);continue}const Lf=Qu[hh](gd,_d),Md=hh%2?o.EXTENT-1:0;fh.x=Ih(Lf[0],Math.min(o.EXTENT-1,Lf[1]),Md,hh<2,Lf[2]),fh.y=0,B.encodeCentroid(fh,gd,!1),ld&&qh.encodeCentroid(fh,_d,!1)}else B.encodeCentroid(void 0,gd,!1)}B.borderDoneWithNeighborZ[hh]=qh.canonical.z,B.needsCentroidUpdate=!0,ld&&(qh.borderDoneWithNeighborZ[Oh]=B.canonical.z,qh.needsCentroidUpdate=!0)}else{for(const xd of Rh)B.encodeCentroid(void 0,B.featuresOnBorder[xd],!1);if(ld){for(const xd of $h)qh.encodeCentroid(void 0,qh.featuresOnBorder[xd],!1);qh.borderDoneWithNeighborZ[Oh]=B.canonical.z,qh.needsCentroidUpdate=!0}B.borderDoneWithNeighborZ[hh]=qh.canonical.z,B.needsCentroidUpdate=!0}}(B.needsCentroidUpdate||!B.centroidVertexBuffer&&B.centroidVertexArray.length!==0)&&B.uploadCentroid(L)}const g0=new o.Color(1,0,0,1),ov=new o.Color(0,1,0,1),_0=new o.Color(0,0,1,1),Cm=new o.Color(1,0,1,1),sm=new o.Color(0,1,1,1);function P_(L,u,E){const B=L.context,ge=L.transform,St=B.gl,_n=ge.projection.name==="globe",Bn=_n?["PROJECTION_GLOBE_VIEW"]:null;let ss=E.projMatrix;if(_n&&o.globeToMercatorTransition(ge.zoom)>0){const gd=o.transitionTileAABBinECEF(E.canonical,ge),Vf=o.globeDenormalizeECEF(gd);ss=o.multiply(new Float32Array(16),ge.globeMatrix,Vf),o.multiply(ss,ge.projMatrix,ss)}const tl=L.useProgram("debug",null,Bn),il=u.getTileByID(E.key);L.terrain&&L.terrain.setupElevationDraw(il,tl);const Qu=o.DepthMode.disabled,fh=o.StencilMode.disabled,wh=L.colorModeForRenderPass(),Th="$debug";B.activeTexture.set(St.TEXTURE0),L.emptyTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE),_n?il._makeGlobeTileDebugBuffers(L.context,ge):il._makeDebugTileBoundsBuffers(L.context,ge.projection);const Sh=il._tileDebugBuffer||L.debugBuffer,Ih=il._tileDebugIndexBuffer||L.debugIndexBuffer,hh=il._tileDebugSegments||L.debugSegments;tl.draw(B,St.LINE_STRIP,Qu,fh,wh,o.CullFaceMode.disabled,jy(ss,o.Color.red),Th,Sh,Ih,hh,null,null,null,[il._globeTileDebugBorderBuffer]);const Oh=il.latestRawTileData,Rh=Math.floor((Oh&&Oh.byteLength||0)/1024),Nh=u.getTile(E).tileSize,qh=512/Math.min(Nh,512)*(E.overscaledZ/ge.zoom)*.5;let $h=E.canonical.toString();E.overscaledZ!==E.canonical.z&&($h+=` => ${E.overscaledZ}`),$h+=` ${Rh}kb`,function(gd,Vf){gd.initDebugOverlayCanvas();const _d=gd.debugOverlayCanvas,Mf=gd.context.gl,Ud=gd.debugOverlayCanvas.getContext("2d");Ud.clearRect(0,0,_d.width,_d.height),Ud.shadowColor="white",Ud.shadowBlur=2,Ud.lineWidth=1.5,Ud.strokeStyle="white",Ud.textBaseline="top",Ud.font="bold 36px Open Sans, sans-serif",Ud.fillText(Vf,5,5),Ud.strokeText(Vf,5,5),gd.debugOverlayTexture.update(_d),gd.debugOverlayTexture.bind(Mf.LINEAR,Mf.CLAMP_TO_EDGE)}(L,$h);const Hh=il._tileDebugTextBuffer||L.debugBuffer,ld=il._tileDebugTextIndexBuffer||L.quadTriangleIndexBuffer,xd=il._tileDebugTextSegments||L.debugSegments;tl.draw(B,St.TRIANGLES,Qu,fh,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,jy(ss,o.Color.transparent,qh),Th,Hh,ld,xd,null,null,null,[il._globeTileDebugTextBuffer])}function Ng(L,u,E,B){Dg(L,0,u+E/2,L.transform.width,E,B)}function W_(L,u,E,B){Dg(L,u-E/2,0,E,L.transform.height,B)}function Dg(L,u,E,B,ge,St){const _n=L.context,Bn=_n.gl;Bn.enable(Bn.SCISSOR_TEST),Bn.scissor(u*o.exported.devicePixelRatio,E*o.exported.devicePixelRatio,B*o.exported.devicePixelRatio,ge*o.exported.devicePixelRatio),_n.clear({color:St}),Bn.disable(Bn.SCISSOR_TEST)}const Gm=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ag}=Gm;function Jg(L,u,E,B){L.emplaceBack(u,E,B)}class k_{constructor(u){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Jg(this.vertexArray,-1,-1,1),Jg(this.vertexArray,1,-1,1),Jg(this.vertexArray,-1,1,1),Jg(this.vertexArray,1,1,1),Jg(this.vertexArray,-1,-1,-1),Jg(this.vertexArray,1,-1,-1),Jg(this.vertexArray,-1,1,-1),Jg(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,ag),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function em(L,u,E,B,ge,St){const _n=L.gl,Bn=u.paint.get("sky-atmosphere-color"),ss=u.paint.get("sky-atmosphere-halo-color"),tl=u.paint.get("sky-atmosphere-sun-intensity"),il=((Qu,fh,wh,Th,Sh)=>({u_matrix_3f:Qu,u_sun_direction:fh,u_sun_intensity:wh,u_color_tint_r:[Th.r,Th.g,Th.b,Th.a],u_color_tint_m:[Sh.r,Sh.g,Sh.b,Sh.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),B),ge,tl,Bn,ss);_n.framebufferTexture2D(_n.FRAMEBUFFER,_n.COLOR_ATTACHMENT0,_n.TEXTURE_CUBE_MAP_POSITIVE_X+St,u.skyboxTexture,0),E.draw(L,_n.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,il,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const Gg=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bv{constructor(u){const E=new o.StructArrayLayout5f20;E.emplaceBack(-1,1,1,0,0),E.emplaceBack(1,1,1,1,0),E.emplaceBack(1,-1,1,1,1),E.emplaceBack(-1,-1,1,0,1);const B=new o.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(E,Gg.members),this.indexBuffer=u.createIndexBuffer(B),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ig={symbol:function(L,u,E,B,ge){if(L.renderPass!=="translucent")return;const St=o.StencilMode.disabled,_n=L.colorModeForRenderPass();E.layout.get("text-variable-anchor")&&function(Bn,ss,tl,il,Qu,fh,wh){const Th=ss.transform,Sh=Qu==="map",Ih=fh==="map";for(const hh of Bn){const Oh=il.getTile(hh),Rh=Oh.getBucket(tl);if(!Rh||!Rh.text||!Rh.text.segments.get().length)continue;const Nh=o.evaluateSizeForZoom(Rh.textSizeData,Th.zoom),qh=Zp(hh,Rh.getProjection(),Th),$h=Th.calculatePixelsToTileUnitsMatrix(Oh),Hh=l_(qh,Oh.tileID.canonical,Ih,Sh,Th,Rh.getProjection(),$h),ld=tl.layout.get("icon-text-fit")!=="none"&&Rh.hasIconData();if(Nh){const xd=Math.pow(2,Th.zoom-Oh.tileID.overscaledZ);Sg(Rh,Sh,Ih,wh,o.symbolSize,Th,Hh,hh,xd,Nh,ld)}}}(B,L,E,u,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),ge),E.paint.get("icon-opacity").constantOr(1)!==0&&A_(L,u,E,B,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),St,_n),E.paint.get("text-opacity").constantOr(1)!==0&&A_(L,u,E,B,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),St,_n),u.map.showCollisionBoxes&&(Vm(L,u,E,B,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),Vm(L,u,E,B,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))},circle:function(L,u,E,B){if(L.renderPass!=="translucent")return;const ge=E.paint.get("circle-opacity"),St=E.paint.get("circle-stroke-width"),_n=E.paint.get("circle-stroke-opacity"),Bn=E.layout.get("circle-sort-key").constantOr(1)!==void 0;if(ge.constantOr(1)===0&&(St.constantOr(1)===0||_n.constantOr(1)===0))return;const ss=L.context,tl=ss.gl,il=L.transform,Qu=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),fh=o.StencilMode.disabled,wh=L.colorModeForRenderPass(),Th=il.projection.name==="globe",Sh=[o.mercatorXfromLng(il.center.lng),o.mercatorYfromLat(il.center.lat)],Ih=[];for(let Oh=0;Oh<B.length;Oh++){const Rh=B[Oh],Nh=u.getTile(Rh),qh=Nh.getBucket(E);if(!qh||qh.projection.name!==il.projection.name)continue;const $h=qh.programConfigurations.get(E.id),Hh=__(E);Th&&Hh.push("PROJECTION_GLOBE_VIEW");const ld=L.useProgram("circle",$h,Hh),xd=qh.layoutVertexBuffer,gd=qh.globeExtVertexBuffer,Vf=qh.indexBuffer,_d=il.projection.createInversionMatrix(il,Rh.canonical),Mf={programConfiguration:$h,program:ld,layoutVertexBuffer:xd,globeExtVertexBuffer:gd,indexBuffer:Vf,uniformValues:f0(L,Rh,Nh,_d,Sh,E),tile:Nh};if(Bn){const Ud=qh.segments.get();for(const Lf of Ud)Ih.push({segments:new o.SegmentVector([Lf]),sortKey:Lf.sortKey,state:Mf})}else Ih.push({segments:qh.segments,sortKey:0,state:Mf})}Bn&&Ih.sort((Oh,Rh)=>Oh.sortKey-Rh.sortKey);const hh={useDepthForOcclusion:!Th};for(const Oh of Ih){const{programConfiguration:Rh,program:Nh,layoutVertexBuffer:qh,globeExtVertexBuffer:$h,indexBuffer:Hh,uniformValues:ld,tile:xd}=Oh.state,gd=Oh.segments;L.terrain&&L.terrain.setupElevationDraw(xd,Nh,hh),L.prepareDrawProgram(ss,Nh,xd.tileID.toUnwrapped()),Nh.draw(ss,tl.TRIANGLES,Qu,fh,wh,o.CullFaceMode.disabled,ld,E.id,qh,Hh,gd,E.paint,il.zoom,Rh,[$h])}},heatmap:function(L,u,E,B){if(E.paint.get("heatmap-opacity")!==0)if(L.renderPass==="offscreen"){const ge=L.context,St=ge.gl,_n=o.StencilMode.disabled,Bn=new o.ColorMode([St.ONE,St.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(wh,Th,Sh,Ih){const hh=wh.gl,Oh=Th.width*Ih,Rh=Th.height*Ih;wh.activeTexture.set(hh.TEXTURE1),wh.viewport.set([0,0,Oh,Rh]);let Nh=Sh.heatmapFbo;if(!Nh||Nh&&(Nh.width!==Oh||Nh.height!==Rh)){Nh&&Nh.destroy();const qh=hh.createTexture();hh.bindTexture(hh.TEXTURE_2D,qh),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_WRAP_S,hh.CLAMP_TO_EDGE),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_WRAP_T,hh.CLAMP_TO_EDGE),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_MIN_FILTER,hh.LINEAR),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_MAG_FILTER,hh.LINEAR),Nh=Sh.heatmapFbo=wh.createFramebuffer(Oh,Rh,!1),function($h,Hh,ld,xd,gd,Vf){const _d=$h.gl;_d.texImage2D(_d.TEXTURE_2D,0,$h.isWebGL2&&$h.extRenderToTextureHalfFloat?_d.RGBA16F:_d.RGBA,gd,Vf,0,_d.RGBA,$h.extRenderToTextureHalfFloat?$h.isWebGL2?_d.HALF_FLOAT:$h.extTextureHalfFloat.HALF_FLOAT_OES:_d.UNSIGNED_BYTE,null),xd.colorAttachment.set(ld)}(wh,0,qh,Nh,Oh,Rh)}else hh.bindTexture(hh.TEXTURE_2D,Nh.colorAttachment.get()),wh.bindFramebuffer.set(Nh.framebuffer)})(ge,L,E,L.transform.projection.name==="globe"?.5:.25),ge.clear({color:o.Color.transparent});const ss=L.transform,tl=ss.projection.name==="globe",il=tl?["PROJECTION_GLOBE_VIEW"]:null,Qu=tl?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,fh=[o.mercatorXfromLng(ss.center.lng),o.mercatorYfromLat(ss.center.lat)];for(let wh=0;wh<B.length;wh++){const Th=B[wh];if(u.hasRenderableParent(Th))continue;const Sh=u.getTile(Th),Ih=Sh.getBucket(E);if(!Ih||Ih.projection.name!==ss.projection.name)continue;const hh=Ih.programConfigurations.get(E.id),Oh=L.useProgram("heatmap",hh,il),{zoom:Rh}=L.transform;L.terrain&&L.terrain.setupElevationDraw(Sh,Oh),L.prepareDrawProgram(ge,Oh,Th.toUnwrapped());const Nh=ss.projection.createInversionMatrix(ss,Th.canonical);Oh.draw(ge,St.TRIANGLES,o.DepthMode.disabled,_n,Bn,Qu,Qg(L,Th,Sh,Nh,fh,Rh,E.paint.get("heatmap-intensity")),E.id,Ih.layoutVertexBuffer,Ih.indexBuffer,Ih.segments,E.paint,L.transform.zoom,hh,tl?[Ih.globeExtVertexBuffer]:null)}ge.viewport.set([0,0,L.width,L.height])}else L.renderPass==="translucent"&&(L.context.setColorMode(L.colorModeForRenderPass()),function(ge,St){const _n=ge.context,Bn=_n.gl,ss=St.heatmapFbo;if(!ss)return;_n.activeTexture.set(Bn.TEXTURE0),Bn.bindTexture(Bn.TEXTURE_2D,ss.colorAttachment.get()),_n.activeTexture.set(Bn.TEXTURE1);let tl=St.colorRampTexture;tl||(tl=St.colorRampTexture=new o.Texture(_n,St.colorRamp,Bn.RGBA)),tl.bind(Bn.LINEAR,Bn.CLAMP_TO_EDGE),ge.useProgram("heatmapTexture").draw(_n,Bn.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,ge.colorModeForRenderPass(),o.CullFaceMode.disabled,((il,Qu,fh,wh)=>({u_image:0,u_color_ramp:1,u_opacity:Qu.paint.get("heatmap-opacity")}))(0,St),St.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments,St.paint,ge.transform.zoom)}(L,E))},line:function(L,u,E,B){if(L.renderPass!=="translucent")return;const ge=E.paint.get("line-opacity"),St=E.paint.get("line-width");if(ge.constantOr(1)===0||St.constantOr(1)===0)return;const _n=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),Bn=L.colorModeForRenderPass(),ss=L.terrain&&L.terrain.renderingToTexture?1:o.exported.devicePixelRatio,tl=E.paint.get("line-dasharray"),il=tl.constantOr(1),Qu=E.layout.get("line-cap"),fh=E.paint.get("line-pattern"),wh=fh.constantOr(1),Th=E.paint.get("line-gradient"),Sh=wh?"linePattern":"line",Ih=L.context,hh=Ih.gl,Oh=(Nh=>{const qh=[];m0(Nh)&&qh.push("RENDER_LINE_DASH"),Nh.paint.get("line-gradient")&&qh.push("RENDER_LINE_GRADIENT");const $h=Nh.paint.get("line-trim-offset");$h[0]===0&&$h[1]===0||qh.push("RENDER_LINE_TRIM_OFFSET");const Hh=Nh.paint.get("line-pattern").constantOr(1),ld=Nh.paint.get("line-opacity").constantOr(1)!==1;return!Hh&&ld&&qh.push("RENDER_LINE_ALPHA_DISCARD"),qh})(E);let Rh=Oh.includes("RENDER_LINE_ALPHA_DISCARD");L.terrain&&L.terrain.clipOrMaskOverlapStencilType()&&(Rh=!1);for(const Nh of B){const qh=u.getTile(Nh);if(wh&&!qh.patternsLoaded())continue;const $h=qh.getBucket(E);if(!$h)continue;L.prepareDrawTile();const Hh=$h.programConfigurations.get(E.id),ld=L.useProgram(Sh,Hh,Oh),xd=fh.constantOr(null);if(xd&&qh.imageAtlas){const pd=qh.imageAtlas.patternPositions[xd.toString()];pd&&Hh.setConstantPatternPositions(pd)}const gd=tl.constantOr(null),Vf=Qu.constantOr(null);if(!wh&&gd&&Vf&&qh.lineAtlas){const pd=qh.lineAtlas.getDash(gd,Vf);pd&&Hh.setConstantPatternPositions(pd)}let[_d,Mf]=E.paint.get("line-trim-offset");(Vf==="round"||Vf==="square")&&_d!==Mf&&(_d===0&&(_d-=1),Mf===1&&(Mf+=1));const Ud=L.terrain?Nh.projMatrix:null,Lf=wh?rv(L,qh,E,Ud,ss):qy(L,qh,E,Ud,$h.lineClipsArray.length,ss,[_d,Mf]);if(Th){const pd=$h.gradients[E.id];let Bd=pd.texture;if(E.gradientVersion!==pd.version){let mf=256;if(E.stepInterpolant){const Bf=u.getSource().maxzoom,Dp=Nh.canonical.z===Bf?Math.ceil(1<<L.transform.maxZoom-Nh.canonical.z):1;mf=o.clamp(o.nextPowerOfTwo($h.maxLineLength/o.EXTENT*1024*Dp),256,Ih.maxTextureSize)}pd.gradient=o.renderColorRamp({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:mf,image:pd.gradient||void 0,clips:$h.lineClipsArray}),pd.texture?pd.texture.update(pd.gradient):pd.texture=new o.Texture(Ih,pd.gradient,hh.RGBA),pd.version=E.gradientVersion,Bd=pd.texture}Ih.activeTexture.set(hh.TEXTURE1),Bd.bind(E.stepInterpolant?hh.NEAREST:hh.LINEAR,hh.CLAMP_TO_EDGE)}il&&(Ih.activeTexture.set(hh.TEXTURE0),qh.lineAtlasTexture.bind(hh.LINEAR,hh.REPEAT),Hh.updatePaintBuffers()),wh&&(Ih.activeTexture.set(hh.TEXTURE0),qh.imageAtlasTexture.bind(hh.LINEAR,hh.CLAMP_TO_EDGE),Hh.updatePaintBuffers()),L.prepareDrawProgram(Ih,ld,Nh.toUnwrapped());const Md=pd=>{ld.draw(Ih,hh.TRIANGLES,_n,pd,Bn,o.CullFaceMode.disabled,Lf,E.id,$h.layoutVertexBuffer,$h.indexBuffer,$h.segments,E.paint,L.transform.zoom,Hh,[$h.layoutVertexBuffer2])};if(Rh){const pd=L.stencilModeForClipping(Nh).ref;pd===0&&L.terrain&&Ih.clear({stencil:0});const Bd={func:hh.EQUAL,mask:255};Lf.u_alpha_discard_threshold=.8,Md(new o.StencilMode(Bd,pd,255,hh.KEEP,hh.KEEP,hh.INVERT)),Lf.u_alpha_discard_threshold=0,Md(new o.StencilMode(Bd,pd,255,hh.KEEP,hh.KEEP,hh.KEEP))}else Md(L.stencilModeForClipping(Nh))}Rh&&(L.resetStencilClippingMasks(),L.terrain&&Ih.clear({stencil:0}))},fill:function(L,u,E,B){const ge=E.paint.get("fill-color"),St=E.paint.get("fill-opacity");if(St.constantOr(1)===0)return;const _n=L.colorModeForRenderPass(),Bn=E.paint.get("fill-pattern"),ss=L.opaquePassEnabledForLayer()&&!Bn.constantOr(1)&&ge.constantOr(o.Color.transparent).a===1&&St.constantOr(0)===1?"opaque":"translucent";if(L.renderPass===ss){const tl=L.depthModeForSublayer(1,L.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Zy(L,u,E,B,tl,_n,!1)}if(L.renderPass==="translucent"&&E.paint.get("fill-antialias")){const tl=L.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Zy(L,u,E,B,tl,_n,!0)}},"fill-extrusion":function(L,u,E,B){const ge=E.paint.get("fill-extrusion-opacity");if(ge!==0&&L.renderPass==="translucent"){const St=new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D);if(ge!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))vy(L,u,E,B,St,o.StencilMode.disabled,o.ColorMode.disabled),vy(L,u,E,B,St,L.stencilModeFor3D(),L.colorModeForRenderPass()),L.resetStencilClippingMasks();else{const _n=L.colorModeForRenderPass();vy(L,u,E,B,St,o.StencilMode.disabled,_n)}}},hillshade:function(L,u,E,B){if(L.renderPass!=="offscreen"&&L.renderPass!=="translucent")return;const ge=L.context,St=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),_n=L.colorModeForRenderPass(),Bn=L.terrain&&L.terrain.renderingToTexture,[ss,tl]=L.renderPass!=="translucent"||Bn?[{},B]:L.stencilConfigForOverlap(B);for(const il of tl){const Qu=u.getTile(il);if(Qu.needsHillshadePrepare&&L.renderPass==="offscreen")c0(L,Qu,E,St,o.StencilMode.disabled,_n);else if(L.renderPass==="translucent"){const fh=Bn&&L.terrain?L.terrain.stencilModeForRTTOverlap(il):ss[il.overscaledZ];q_(L,il,Qu,E,St,fh,_n)}}ge.viewport.set([0,0,L.width,L.height]),L.resetStencilClippingMasks()},raster:function(L,u,E,B,ge,St){if(L.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!B.length)return;const _n=L.context,Bn=_n.gl,ss=u.getSource(),tl=L.useProgram("raster"),il=L.colorModeForRenderPass(),Qu=L.terrain&&L.terrain.renderingToTexture,[fh,wh]=ss instanceof rh||Qu?[{},B]:L.stencilConfigForOverlap(B),Th=wh[wh.length-1].overscaledZ,Sh=!L.options.moving;for(const Ih of wh){const hh=Qu?o.DepthMode.disabled:L.depthModeForSublayer(Ih.overscaledZ-Th,E.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,Bn.LESS),Oh=Ih.toUnwrapped(),Rh=u.getTile(Ih);if(Qu&&(!Rh||!Rh.hasData()))continue;const Nh=Qu?Ih.projMatrix:L.transform.calculateProjMatrix(Oh,Sh),qh=L.terrain&&Qu?L.terrain.stencilModeForRTTOverlap(Ih):fh[Ih.overscaledZ],$h=St?0:E.paint.get("raster-fade-duration");Rh.registerFadeDuration($h);const Hh=u.findLoadedParent(Ih,0),ld=M_(Rh,Hh,u,L.transform,$h);let xd,gd;L.terrain&&L.terrain.prepareDrawTile();const Vf=E.paint.get("raster-resampling")==="nearest"?Bn.NEAREST:Bn.LINEAR;_n.activeTexture.set(Bn.TEXTURE0),Rh.texture.bind(Vf,Bn.CLAMP_TO_EDGE),_n.activeTexture.set(Bn.TEXTURE1),Hh?(Hh.texture.bind(Vf,Bn.CLAMP_TO_EDGE),xd=Math.pow(2,Hh.tileID.overscaledZ-Rh.tileID.overscaledZ),gd=[Rh.tileID.canonical.x*xd%1,Rh.tileID.canonical.y*xd%1]):Rh.texture.bind(Vf,Bn.CLAMP_TO_EDGE),Rh.texture.useMipmap&&_n.extTextureFilterAnisotropic&&L.transform.pitch>20&&Bn.texParameterf(Bn.TEXTURE_2D,_n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_n.extTextureFilterAnisotropicMax);const _d=X_(Nh,gd||[0,0],xd||1,ld,E,ss instanceof rh?ss.perspectiveTransform:[0,0]);if(L.prepareDrawProgram(_n,tl,Oh),ss instanceof rh)ss.boundsBuffer&&ss.boundsSegments&&tl.draw(_n,Bn.TRIANGLES,hh,o.StencilMode.disabled,il,o.CullFaceMode.disabled,_d,E.id,ss.boundsBuffer,L.quadTriangleIndexBuffer,ss.boundsSegments);else{const{tileBoundsBuffer:Mf,tileBoundsIndexBuffer:Ud,tileBoundsSegments:Lf}=L.getTileBoundsBuffers(Rh);tl.draw(_n,Bn.TRIANGLES,hh,qh,il,o.CullFaceMode.disabled,_d,E.id,Mf,Ud,Lf)}}L.resetStencilClippingMasks()},background:function(L,u,E,B){const ge=E.paint.get("background-color"),St=E.paint.get("background-opacity");if(St===0)return;const _n=L.context,Bn=_n.gl,ss=L.transform,tl=ss.tileSize,il=E.paint.get("background-pattern");if(L.isPatternMissing(il))return;const Qu=!il&&ge.a===1&&St===1&&L.opaquePassEnabledForLayer()?"opaque":"translucent";if(L.renderPass!==Qu)return;const fh=o.StencilMode.disabled,wh=L.depthModeForSublayer(0,Qu==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Th=L.colorModeForRenderPass(),Sh=L.useProgram(il?"backgroundPattern":"background");let Ih,hh=B;hh||(Ih=L.getBackgroundTiles(),hh=Object.values(Ih).map(Oh=>Oh.tileID)),il&&(_n.activeTexture.set(Bn.TEXTURE0),L.imageManager.bind(L.context));for(const Oh of hh){const Rh=Oh.toUnwrapped(),Nh=B?Oh.projMatrix:L.transform.calculateProjMatrix(Rh);L.prepareDrawTile();const qh=u?u.getTile(Oh):Ih?Ih[Oh.key]:new o.Tile(Oh,tl,ss.zoom,L),$h=il?Qm(Nh,St,L,il,{tileID:Oh,tileSize:tl}):hm(Nh,St,ge);L.prepareDrawProgram(_n,Sh,Rh);const{tileBoundsBuffer:Hh,tileBoundsIndexBuffer:ld,tileBoundsSegments:xd}=L.getTileBoundsBuffers(qh);Sh.draw(_n,Bn.TRIANGLES,wh,fh,Th,o.CullFaceMode.disabled,$h,E.id,Hh,ld,xd)}},sky:function(L,u,E){const B=L.transform,ge=B.projection.name==="mercator"||B.projection.name==="globe"?1:o.smoothstep(7,8,B.zoom),St=E.paint.get("sky-opacity")*ge;if(St===0)return;const _n=L.context,Bn=E.paint.get("sky-type"),ss=new o.DepthMode(_n.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),tl=L.frameCounter/1e3%1;Bn==="atmosphere"?L.renderPass==="offscreen"?E.needsSkyboxCapture(L)&&(function(il,Qu,fh,wh){const Th=il.context,Sh=Th.gl;let Ih=Qu.skyboxFbo;if(!Ih){Ih=Qu.skyboxFbo=Th.createFramebuffer(32,32,!1),Qu.skyboxGeometry=new k_(Th),Qu.skyboxTexture=Th.gl.createTexture(),Sh.bindTexture(Sh.TEXTURE_CUBE_MAP,Qu.skyboxTexture),Sh.texParameteri(Sh.TEXTURE_CUBE_MAP,Sh.TEXTURE_WRAP_S,Sh.CLAMP_TO_EDGE),Sh.texParameteri(Sh.TEXTURE_CUBE_MAP,Sh.TEXTURE_WRAP_T,Sh.CLAMP_TO_EDGE),Sh.texParameteri(Sh.TEXTURE_CUBE_MAP,Sh.TEXTURE_MIN_FILTER,Sh.LINEAR),Sh.texParameteri(Sh.TEXTURE_CUBE_MAP,Sh.TEXTURE_MAG_FILTER,Sh.LINEAR);for(let Nh=0;Nh<6;++Nh)Sh.texImage2D(Sh.TEXTURE_CUBE_MAP_POSITIVE_X+Nh,0,Sh.RGBA,32,32,0,Sh.RGBA,Sh.UNSIGNED_BYTE,null)}Th.bindFramebuffer.set(Ih.framebuffer),Th.viewport.set([0,0,32,32]);const hh=Qu.getCenter(il,!0),Oh=il.useProgram("skyboxCapture"),Rh=new Float64Array(16);o.identity(Rh),o.rotateY(Rh,Rh,.5*-Math.PI),em(Th,Qu,Oh,Rh,hh,0),o.identity(Rh),o.rotateY(Rh,Rh,.5*Math.PI),em(Th,Qu,Oh,Rh,hh,1),o.identity(Rh),o.rotateX(Rh,Rh,.5*-Math.PI),em(Th,Qu,Oh,Rh,hh,2),o.identity(Rh),o.rotateX(Rh,Rh,.5*Math.PI),em(Th,Qu,Oh,Rh,hh,3),o.identity(Rh),em(Th,Qu,Oh,Rh,hh,4),o.identity(Rh),o.rotateY(Rh,Rh,Math.PI),em(Th,Qu,Oh,Rh,hh,5),Th.viewport.set([0,0,il.width,il.height])}(L,E),E.markSkyboxValid(L)):L.renderPass==="sky"&&function(il,Qu,fh,wh,Th){const Sh=il.context,Ih=Sh.gl,hh=il.transform,Oh=il.useProgram("skybox");Sh.activeTexture.set(Ih.TEXTURE0),Ih.bindTexture(Ih.TEXTURE_CUBE_MAP,Qu.skyboxTexture);const Rh=((Nh,qh,$h,Hh,ld)=>({u_matrix:Nh,u_sun_direction:qh,u_cubemap:0,u_opacity:Hh,u_temporal_offset:ld}))(hh.skyboxMatrix,Qu.getCenter(il,!1),0,wh,Th);il.prepareDrawProgram(Sh,Oh),Oh.draw(Sh,Ih.TRIANGLES,fh,o.StencilMode.disabled,il.colorModeForRenderPass(),o.CullFaceMode.backCW,Rh,"skybox",Qu.skyboxGeometry.vertexBuffer,Qu.skyboxGeometry.indexBuffer,Qu.skyboxGeometry.segment)}(L,E,ss,St,tl):Bn==="gradient"&&L.renderPass==="sky"&&function(il,Qu,fh,wh,Th){const Sh=il.context,Ih=Sh.gl,hh=il.transform,Oh=il.useProgram("skyboxGradient");Qu.skyboxGeometry||(Qu.skyboxGeometry=new k_(Sh)),Sh.activeTexture.set(Ih.TEXTURE0);let Rh=Qu.colorRampTexture;Rh||(Rh=Qu.colorRampTexture=new o.Texture(Sh,Qu.colorRamp,Ih.RGBA)),Rh.bind(Ih.LINEAR,Ih.CLAMP_TO_EDGE);const Nh=((qh,$h,Hh,ld,xd)=>({u_matrix:qh,u_color_ramp:0,u_center_direction:$h,u_radius:o.degToRad(Hh),u_opacity:ld,u_temporal_offset:xd}))(hh.skyboxMatrix,Qu.getCenter(il,!1),Qu.paint.get("sky-gradient-radius"),wh,Th);il.prepareDrawProgram(Sh,Oh),Oh.draw(Sh,Ih.TRIANGLES,fh,o.StencilMode.disabled,il.colorModeForRenderPass(),o.CullFaceMode.backCW,Nh,"skyboxGradient",Qu.skyboxGeometry.vertexBuffer,Qu.skyboxGeometry.indexBuffer,Qu.skyboxGeometry.segment)}(L,E,ss,St,tl)},debug:function(L,u,E){for(let B=0;B<E.length;B++)P_(L,u,E[B])},custom:function(L,u,E,B){const ge=L.context,St=E.implementation;if(!L.transform.projection.unsupportedLayers||!L.transform.projection.unsupportedLayers.includes("custom")||L.terrain&&(L.terrain.renderingToTexture||L.renderPass==="offscreen")&&E.isLayerDraped()){if(L.renderPass==="offscreen"){const _n=St.prerender;if(_n){if(L.setCustomLayerDefaults(),ge.setColorMode(L.colorModeForRenderPass()),L.transform.projection.name==="globe"){const Bn=L.transform.pointMerc;_n.call(St,ge.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[Bn.x,Bn.y],L.transform.pixelsPerMeterRatio)}else _n.call(St,ge.gl,L.transform.customLayerMatrix());ge.setDirty(),L.setBaseState()}}else if(L.renderPass==="translucent"){if(L.terrain&&L.terrain.renderingToTexture){const Bn=St.renderToTile;if(Bn){const ss=B[0].canonical,tl=new o.MercatorCoordinate(ss.x+B[0].wrap*(1<<ss.z),ss.y,ss.z);ge.setDepthMode(o.DepthMode.disabled),ge.setStencilMode(o.StencilMode.disabled),ge.setColorMode(L.colorModeForRenderPass()),L.setCustomLayerDefaults(),Bn.call(St,ge.gl,tl),ge.setDirty(),L.setBaseState()}return}L.setCustomLayerDefaults(),ge.setColorMode(L.colorModeForRenderPass()),ge.setStencilMode(o.StencilMode.disabled);const _n=St.renderingMode==="3d"?new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D):L.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(ge.setDepthMode(_n),L.transform.projection.name==="globe"){const Bn=L.transform.pointMerc;St.render(ge.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[Bn.x,Bn.y],L.transform.pixelsPerMeterRatio)}else St.render(ge.gl,L.transform.customLayerMatrix());ge.setDirty(),L.setBaseState(),ge.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Mm{constructor(u,E,B=!1){this.context=new Xr(u,B),this.transform=E,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new o0,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(u,E){const B=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(B||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Uy(this,u));const ge=this._terrain;this.transform.elevation=B?ge:null,ge.update(u,this.transform,E)}_updateFog(u){const E=u.fog;if(!E||this.transform.projection.name==="globe"||E.getOpacity(this.transform.pitch)<1||E.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[B,ge]=E.getFovAdjustedRange(this.transform._fov);if(B>ge)return void(this.transform.fogCullDistSq=null);const St=B+.78*(ge-B);this.transform.fogCullDistSq=St*St}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(u,E){if(this.width=u*o.exported.devicePixelRatio,this.height=E*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style.order)this.style._layers[B].resize()}setup(){const u=this.context,E=new o.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(o.EXTENT,0),E.emplaceBack(0,o.EXTENT),E.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(E,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const B=new o.StructArrayLayout2i4;B.emplaceBack(0,0),B.emplaceBack(o.EXTENT,0),B.emplaceBack(0,o.EXTENT),B.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=u.createVertexBuffer(B,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const ge=new o.StructArrayLayout2i4;ge.emplaceBack(-1,-1),ge.emplaceBack(1,-1),ge.emplaceBack(-1,1),ge.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(ge,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const St=new o.StructArrayLayout4i8;St.emplaceBack(0,0,0,0),St.emplaceBack(o.EXTENT,0,o.EXTENT,0),St.emplaceBack(0,o.EXTENT,0,o.EXTENT),St.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=u.createVertexBuffer(St,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _n=new o.StructArrayLayout3ui6;_n.emplaceBack(0,1,2),_n.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(_n);const Bn=new o.StructArrayLayout1ui2;for(const tl of[0,1,3,2,0])Bn.emplaceBack(tl);this.debugIndexBuffer=u.createIndexBuffer(Bn),this.emptyTexture=new o.Texture(u,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA),this.identityMat=o.create();const ss=this.context.gl;this.stencilClearMode=new o.StencilMode({func:ss.ALWAYS,mask:0},0,255,ss.ZERO,ss.ZERO,ss.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new bv(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context,E=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(u,E.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,E,B){if(!E||this.currentStencilSource===E.id||!u.isTileClipped()||!B||B.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Bn=!1;for(const ss of B)if(this._tileClippingMaskIDs[ss.key]===void 0){Bn=!0;break}if(!Bn)return}this.currentStencilSource=E.id;const ge=this.context,St=ge.gl;this.nextStencilID+B.length>256&&this.clearStencil(),ge.setColorMode(o.ColorMode.disabled),ge.setDepthMode(o.DepthMode.disabled);const _n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Bn of B){const ss=E.getTile(Bn),tl=this._tileClippingMaskIDs[Bn.key]=this.nextStencilID++,{tileBoundsBuffer:il,tileBoundsIndexBuffer:Qu,tileBoundsSegments:fh}=this.getTileBoundsBuffers(ss);_n.draw(ge,St.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:St.ALWAYS,mask:0},tl,255,St.KEEP,St.KEEP,St.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(Bn.projMatrix),"$clipping",il,Qu,fh)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,E=this.context.gl;return new o.StencilMode({func:E.NOTEQUAL,mask:255},u,255,E.KEEP,E.KEEP,E.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const E=this.context.gl;return new o.StencilMode({func:E.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,E.KEEP,E.KEEP,E.REPLACE)}stencilConfigForOverlap(u){const E=this.context.gl,B=u.sort((_n,Bn)=>Bn.overscaledZ-_n.overscaledZ),ge=B[B.length-1].overscaledZ,St=B[0].overscaledZ-ge+1;if(St>1){this.currentStencilSource=void 0,this.nextStencilID+St>256&&this.clearStencil();const _n={};for(let Bn=0;Bn<St;Bn++)_n[Bn+ge]=new o.StencilMode({func:E.GEQUAL,mask:255},Bn+this.nextStencilID,255,E.KEEP,E.KEEP,E.REPLACE);return this.nextStencilID+=St,[_n,B]}return[{[ge]:o.StencilMode.disabled},B]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([u.CONSTANT_COLOR,u.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(u,E,B){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const ge=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new o.DepthMode(B||this.context.gl.LEQUAL,E,[ge,ge])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,E){this.style=u,this.options=E,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const B=this.style.order,ge=this.style._sourceCaches;for(const tl in ge){const il=ge[tl];il.used&&il.prepare(this.context)}const St={},_n={},Bn={};for(const tl in ge){const il=ge[tl];St[tl]=il.getVisibleCoordinates(),_n[tl]=St[tl].slice().reverse(),Bn[tl]=il.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let tl=0;tl<B.length;tl++)if(this.style._layers[B[tl]].is3D()){this.opaquePassCutoff=tl;break}if(this.terrain&&(this.terrain.updateTileBinding(Bn),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const tl of B){const il=this.style._layers[tl],Qu=u._getLayerSourceCache(il);if(!il.hasOffscreenPass()||il.isHidden(this.transform.zoom))continue;const fh=Qu?_n[Qu.id]:void 0;(il.type==="custom"||il.isSky()||fh&&fh.length)&&this.renderLayer(this,Qu,il,fh)}this.depthRangeFor3D=[0,1-(u.order.length+2)*this.numSublayers*this.depthEpsilon];const ss=this.terrain;if(ss&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&ss.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:E.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=E.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);if(tl.isSky())continue;const Qu=il?_n[il.id]:void 0;this._renderTileClippingMasks(tl,il,Qu),this.renderLayer(this,il,tl,Qu)}if(this.style.fog&&this.transform.projection.supportsFog&&function(tl,il){const Qu=tl.context,fh=Qu.gl,wh=tl.transform,Th=new o.DepthMode(fh.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Sh=tl.useProgram("globeAtmosphere",null,wh.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ih=o.globeToMercatorTransition(wh.zoom),hh=il.properties.get("color").toArray01(),Oh=il.properties.get("high-color").toArray01(),Rh=il.properties.get("space-color").toArray01PremultipliedAlpha(),Nh=o.identity$1([]);o.rotateY$1(Nh,Nh,-o.degToRad(wh._center.lng)),o.rotateX$1(Nh,Nh,o.degToRad(wh._center.lat)),o.rotateZ$1(Nh,Nh,wh.angle),o.rotateX$1(Nh,Nh,-wh._pitch);const qh=o.fromQuat(new Float32Array(16),Nh),$h=o.mapValue(il.properties.get("star-intensity"),0,1,0,.25),Hh=5e-4,ld=o.mapValue(il.properties.get("horizon-blend"),0,1,Hh,.25),xd=o.globeUseCustomAntiAliasing(tl,Qu,wh)&&ld===Hh?wh.worldSize/(2*Math.PI*1.025)-1:wh.globeRadius,gd=tl.frameCounter/1e3%1,Vf=o.length(wh.globeCenterInViewSpace),_d=Math.sqrt(Math.pow(Vf,2)-Math.pow(xd,2)),Mf=Math.acos(_d/Vf),Ud=((Md,pd,Bd,mf,Bf,Dp,rm,Mp,xp,Lp,dm,Fp,km,Am)=>({u_frustum_tl:Md,u_frustum_tr:pd,u_frustum_br:Bd,u_frustum_bl:mf,u_horizon:Bf,u_transition:Dp,u_fadeout_range:rm,u_color:Mp,u_high_color:xp,u_space_color:Lp,u_star_intensity:dm,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Fp,u_horizon_angle:km,u_rotation_matrix:Am}))(wh.frustumCorners.TL,wh.frustumCorners.TR,wh.frustumCorners.BR,wh.frustumCorners.BL,wh.frustumCorners.horizon,Ih,ld,hh,Oh,Rh,$h,gd,Mf,qh);tl.prepareDrawProgram(Qu,Sh);const Lf=tl.atmosphereBuffer;Lf&&Sh.draw(Qu,fh.TRIANGLES,Th,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ud,"skybox",Lf.vertexBuffer,Lf.indexBuffer,Lf.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);tl.isSky()&&this.renderLayer(this,il,tl,il?_n[il.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<B.length;){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);if(tl.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(tl)){if(tl.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Qu=il?(tl.type==="symbol"?Bn:_n)[il.id]:void 0;this._renderTileClippingMasks(tl,il,il?St[il.id]:void 0),this.renderLayer(this,il,tl,Qu),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let tl=null;o.values(this.style._layers).forEach(il=>{const Qu=u._getLayerSourceCache(il);Qu&&!il.isHidden(this.transform.zoom)&&(!tl||tl.getSource().maxzoom<Qu.getSource().maxzoom)&&(tl=Qu)}),tl&&this.options.showTileBoundaries&&Ig.debug(this,tl,tl.getVisibleCoordinates())}this.options.showPadding&&function(tl){const il=tl.transform.padding;Ng(tl,tl.transform.height-(il.top||0),3,g0),Ng(tl,il.bottom||0,3,ov),W_(tl,il.left||0,3,_0),W_(tl,tl.transform.width-(il.right||0),3,Cm);const Qu=tl.transform.centerPoint;(function(fh,wh,Th,Sh){Dg(fh,wh-1,Th-10,2,20,Sh),Dg(fh,wh-10,Th-1,20,2,Sh)})(tl,Qu.x,tl.transform.height-Qu.y,sm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(u,E,B,ge){B.isHidden(this.transform.zoom)||(B.type==="background"||B.type==="sky"||B.type==="custom"||ge&&ge.length)&&(this.id=B.id,this.gpuTimingStart(B),(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes(B.type)||u.terrain&&B.type==="custom")&&Ig[B.type](u,E,B,ge,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const E=this.context.extTimerQuery;let B=this.gpuTimers[u.id];B||(B=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:E.createQueryEXT()}),B.calls++,E.beginQueryEXT(E.TIME_ELAPSED_EXT,B.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,E=u.createQueryEXT();this.deferredRenderGpuTimeQueries.push(E),u.beginQueryEXT(u.TIME_ELAPSED_EXT,E)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const E={};for(const B in u){const ge=u[B],St=this.context.extTimerQuery,_n=St.getQueryObjectEXT(ge.query,St.QUERY_RESULT_EXT)/1e6;St.deleteQueryEXT(ge.query),E[B]=_n}return E}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const E=this.context.extTimerQuery;let B=0;for(const ge of u)B+=E.getQueryObjectEXT(ge,E.QUERY_RESULT_EXT)/1e6,E.deleteQueryEXT(ge);return B}translatePosMatrix(u,E,B,ge,St){if(!B[0]&&!B[1])return u;const _n=St?ge==="map"?this.transform.angle:0:ge==="viewport"?-this.transform.angle:0;if(_n){const tl=Math.sin(_n),il=Math.cos(_n);B=[B[0]*il-B[1]*tl,B[0]*tl+B[1]*il]}const Bn=[St?B[0]:Td(E,B[0],this.transform.zoom),St?B[1]:Td(E,B[1],this.transform.zoom),0],ss=new Float32Array(16);return o.translate(ss,u,Bn),ss}saveTileTexture(u){const E=this._tileTextures[u.size[0]];E?E.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const E=this._tileTextures[u];return E&&E.length>0?E.pop():null}isPatternMissing(u){return u===null||u!==void 0&&!this.imageManager.getPattern(u.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const u=this.terrain&&this.terrain.renderingToTexture,E=this.terrain&&this.terrain.exaggeration()===0,B=this.style&&this.style.fog,ge=[];return this.terrainRenderModeElevated()&&ge.push("TERRAIN"),this.transform.projection.name==="globe"&&ge.push("GLOBE"),E&&ge.push("ZERO_EXAGGERATION"),B&&!u&&B.getOpacity(this.transform.pitch)!==0&&ge.push("FOG"),u&&ge.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&ge.push("OVERDRAW_INSPECTOR"),ge}useProgram(u,E,B){this.cache=this.cache||{};const ge=B||[],St=this.currentGlobalDefines().concat(ge),_n=Xm.cacheKey(vv[u],u,St,E);return this.cache[_n]||(this.cache[_n]=new Xm(this.context,u,vv[u],E,og[u],St)),this.cache[_n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(u,E,B){if(this.terrain&&this.terrain.renderingToTexture)return;const ge=this.style.fog;if(ge){const St=ge.getOpacity(this.transform.pitch),_n=((Bn,ss,tl,il,Qu,fh,wh,Th,Sh,Ih,hh)=>{const Oh=Bn.transform,Rh=ss.properties.get("color").toArray01();Rh[3]=il;const Nh=Bn.frameCounter/1e3%1;return{u_fog_matrix:tl?Oh.calculateFogTileMatrix(tl):Bn.identityMat,u_fog_range:ss.getFovAdjustedRange(Oh._fov),u_fog_color:Rh,u_fog_horizon_blend:ss.properties.get("horizon-blend"),u_fog_temporal_offset:Nh,u_frustum_tl:Qu,u_frustum_tr:fh,u_frustum_br:wh,u_frustum_bl:Th,u_globe_pos:Sh,u_globe_radius:Ih,u_viewport:hh,u_globe_transition:o.globeToMercatorTransition(Oh.zoom),u_is_globe:+(Oh.projection.name==="globe")}})(this,ge,B,St,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);E.setFogUniformValues(u,_n)}}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){const u=this.canvasCopy();u&&(this.frameCopies.push(u),this.tileLoaded=!1)}canvasCopy(){const u=this.context.gl,E=u.createTexture();return u.bindTexture(u.TEXTURE_2D,E),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),E}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&u.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const u=this._backgroundTiles,E=this._backgroundTiles={},B=this.transform.coveringTiles({tileSize:512});for(const ge of B)E[ge.key]=u[ge.key]||new o.Tile(ge,512,this.transform.tileZoom,this);return E}clearBackgroundTiles(){this._backgroundTiles={}}}class D_{constructor(u=0,E=0,B=0,ge=0){if(isNaN(u)||u<0||isNaN(E)||E<0||isNaN(B)||B<0||isNaN(ge)||ge<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=E,this.left=B,this.right=ge}interpolate(u,E,B){return E.top!=null&&u.top!=null&&(this.top=o.number(u.top,E.top,B)),E.bottom!=null&&u.bottom!=null&&(this.bottom=o.number(u.bottom,E.bottom,B)),E.left!=null&&u.left!=null&&(this.left=o.number(u.left,E.left,B)),E.right!=null&&u.right!=null&&(this.right=o.number(u.right,E.right,B)),this}getCenter(u,E){const B=o.clamp((this.left+u-this.right)/2,0,u),ge=o.clamp((this.top+E-this.bottom)/2,0,E);return new o.pointGeometry(B,ge)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new D_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xy(L,u){const E=o.getColumn(L,3);o.fromQuat(L,u),o.setColumn(L,3,E)}function Hy(L,u){const E=o.identity$1([]);return o.rotateZ$1(E,E,-u),o.rotateX$1(E,E,-L),E}function y0(L,u){const E=[L[0],L[1],0],B=[u[0],u[1],0];if(o.length(E)>=1e-15){const _n=o.normalize([],E);o.scale$2(B,_n,o.dot(B,_n)),u[0]=B[0],u[1]=B[1]}const ge=o.cross([],u,L);if(o.len(ge)<1e-15)return null;const St=Math.atan2(-ge[1],ge[0]);return Hy(Math.atan2(Math.sqrt(L[0]*L[0]+L[1]*L[1]),-L[2]),St)}class Y_{constructor(u,E){this.position=u,this.orientation=E}get position(){return this._position}set position(u){if(u){const E=u instanceof o.MercatorCoordinate?u:new o.MercatorCoordinate(u[0],u[1],u[2]);this._renderWorldCopies&&(E.x=o.wrap(E.x,0,1)),this._position=E}else this._position=null}lookAtPoint(u,E){if(this.orientation=null,!this.position)return;const B=this.position,ge=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u)):0,St=o.MercatorCoordinate.fromLngLat(u,ge),_n=[St.x-B.x,St.y-B.y,St.z-B.z];E||(E=[0,0,1]),E[2]=Math.abs(E[2]),this.orientation=y0(_n,E)}setPitchBearing(u,E){this.orientation=Hy(o.degToRad(u),o.degToRad(-E))}}class Xy{constructor(u,E){this._transform=o.identity([]),this.orientation=E,this.position=u}get mercatorPosition(){const u=this.position;return new o.MercatorCoordinate(u[0],u[1],u[2])}get position(){const u=o.getColumn(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var E;u&&o.setColumn(this._transform,3,[(E=u)[0],E[1],E[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||o.identity$1([]),u&&xy(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),E=this.right();return{bearing:Math.atan2(-E[1],E[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,E){this._orientation=Hy(u,E),xy(this._transform,this._orientation)}forward(){const u=o.getColumn(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=o.getColumn(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=o.getColumn(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,E){const B=new Float64Array(16);return o.invert(B,this.getWorldToCamera(u,E)),B}getWorldToCameraPosition(u,E,B){const ge=this.position;o.scale$2(ge,ge,-u);const St=new Float64Array(16);return o.fromScaling(St,[B,B,B]),o.translate(St,St,ge),St[10]*=E,St}getWorldToCamera(u,E){const B=new Float64Array(16),ge=new Float64Array(4),St=this.position;return o.conjugate(ge,this._orientation),o.scale$2(St,St,-u),o.fromQuat(B,ge),o.translate(B,B,St),B[1]*=-1,B[5]*=-1,B[9]*=-1,B[13]*=-1,B[8]*=E,B[9]*=E,B[10]*=E,B[11]*=E,B}getCameraToClipPerspective(u,E,B,ge){const St=new Float64Array(16);return o.perspective(St,u,E,B,ge),St}getDistanceToElevation(u,E=!1){const B=u===0?0:o.mercatorZfromAltitude(u,E?o.latFromMercatorY(this.position[1]):this.position[1]),ge=this.forward();return(B-this.position[2])/ge[2]}clone(){return new Xy([...this.position],[...this.orientation])}}function e_(L,u){const E=kp(L.projection,L.zoom,L.width,L.height),B=function(St,_n,Bn,ss,tl){const il=new o.LngLat(Bn.lng-180*Up,Bn.lat),Qu=new o.LngLat(Bn.lng+180*Up,Bn.lat),fh=St.project(il.lng,il.lat),wh=St.project(Qu.lng,Qu.lat),Th=-Math.atan2(wh.y-fh.y,wh.x-fh.x),Sh=o.MercatorCoordinate.fromLngLat(Bn);Sh.y=o.clamp(Sh.y,-.999975,.999975);const Ih=Sh.toLngLat(),hh=St.project(Ih.lng,Ih.lat),Oh=o.MercatorCoordinate.fromLngLat(Ih);Oh.x+=Up;const Rh=Oh.toLngLat(),Nh=St.project(Rh.lng,Rh.lat),qh=N0(Nh.x-hh.x,Nh.y-hh.y,Th),$h=o.MercatorCoordinate.fromLngLat(Ih);$h.y+=Up;const Hh=$h.toLngLat(),ld=St.project(Hh.lng,Hh.lat),xd=N0(ld.x-hh.x,ld.y-hh.y,Th),gd=Math.abs(qh.x)/Math.abs(xd.y),Vf=o.identity([]);o.rotateZ(Vf,Vf,-Th*(1-(tl?0:ss)));const _d=o.identity([]);return o.scale(_d,_d,[1,1-(1-gd)*ss,1]),_d[4]=-xd.x/xd.y*ss,o.rotateZ(_d,_d,Th),o.multiply(_d,Vf,_d),_d}(L.projection,0,L.center,E,u),ge=z0(L);return o.scale(B,B,[ge,ge,1]),B}function z0(L){const u=L.projection,E=kp(L.projection,L.zoom,L.width,L.height),B=by(u,L.center),ge=by(u,o.LngLat.convert(u.center));return Math.pow(2,B*E+(1-E)*ge)}function kp(L,u,E,B,ge=1/0){const St=L.range;if(!St)return 0;const _n=Math.min(ge,Math.max(E,B)),Bn=Math.log(_n/1024)/Math.LN2;return o.smoothstep(St[0]+Bn,St[1]+Bn,u)}const Up=1/4e4;function by(L,u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=new o.LngLat(u.lng-180*Up,E),ge=new o.LngLat(u.lng+180*Up,E),St=L.project(B.lng,E),_n=L.project(ge.lng,E),Bn=o.MercatorCoordinate.fromLngLat(B),ss=o.MercatorCoordinate.fromLngLat(ge),tl=_n.x-St.x,il=_n.y-St.y,Qu=ss.x-Bn.x,fh=ss.y-Bn.y,wh=Math.sqrt((Qu*Qu+fh*fh)/(tl*tl+il*il));return Math.log(wh)/Math.LN2}function N0(L,u,E){const B=Math.cos(E),ge=Math.sin(E);return{x:L*B-u*ge,y:L*ge+u*B}}class pp{constructor(u,E,B,ge,St,_n,Bn){this.tileSize=512,this._renderWorldCopies=St===void 0||St,this._minZoom=u||0,this._maxZoom=E||22,this._minPitch=B??0,this._maxPitch=ge??60,this.setProjection(_n),this.setMaxBounds(Bn),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new D_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xy,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const u=new pp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(u,E=!1){const B=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||B)&&this._updateCameraOnTerrain(),(u||B)&&this._constrainCamera(E),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const E=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const B=!x(E,this.getProjection());return B&&this._calcMatrices(),this.mercatorFromTransition=!1,B}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const E=u!==this.projection.name;return E&&this._calcMatrices(),E}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const E=-u*Math.PI/180;var B;this.angle!==E&&(this._unmodified=!1,this.angle=E,this._calcMatrices(),this.rotationMatrix=(B=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(B[1]=0,B[2]=0),B[0]=1,B[3]=1,B),function(ge,St,_n){var Bn=St[0],ss=St[1],tl=St[2],il=St[3],Qu=Math.sin(_n),fh=Math.cos(_n);ge[0]=Bn*fh+tl*Qu,ge[1]=ss*fh+il*Qu,ge[2]=Bn*-Qu+tl*fh,ge[3]=ss*-Qu+il*fh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const E=o.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==E&&(this._unmodified=!1,this._pitch=E,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=o.degToRad(u),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const E=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==E&&(this._unmodified=!1,this._setZoom(E),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;this._centerAltitude=u.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=u.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,E=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],B=this.horizonLineFromTop();let ge=0,St=0;for(let _n=0;_n<E.length;_n++){const Bn=new o.pointGeometry(E[_n][0]*this.width,B+E[_n][1]*(this.height-B)),ss=u.pointCoordinate(Bn);if(!ss)continue;const tl=1/Math.hypot(ss[0]-this._camera.position[0],ss[1]-this._camera.position[1]);ge+=ss[3]*tl,St+=tl}return St===0?NaN:ge/St}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const u=this._seaLevelZoom,E=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),B=this.pixelsPerMeter/this.worldSize*E,ge=this._mercatorZfromZoom(u),St=this._mercatorZfromZoom(this._maxZoom),_n=Math.max(ge-B,St);this._setZoom(this._zoomFromMercatorZ(_n))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const E=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let B;B=u.z<this._camera.position[2]?[E.x,E.y,E.z]:[u.x,u.y,u.z];const ge=o.length(o.sub([],this._camera.position,B));return o.clamp(this._zoomFromMercatorZ(ge),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let E=!1;if(u.orientation&&!o.exactEquals(u.orientation,this._camera.orientation)&&(E=this._setCameraOrientation(u.orientation)),u.position){const B=[u.position.x,u.position.y,u.position.z];o.exactEquals$1(B,this._camera.position)||(this._setCameraPosition(B),E=!0)}E&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,E=new Y_;return E.position=new o.MercatorCoordinate(u[0],u[1],u[2]),E.orientation=this._camera.orientation,E._elevation=this.elevation,E._renderWorldCopies=this.renderWorldCopies,E}_setCameraOrientation(u){if(!o.length$1(u))return!1;o.normalize$1(u,u);const E=o.transformQuat([],[0,0,-1],u),B=o.transformQuat([],[0,-1,0],u);if(B[2]<0)return!1;const ge=y0(E,B);return!!ge&&(this._camera.orientation=ge,!0)}_setCameraPosition(u){const E=this.zoomScale(this.minZoom)*this.tileSize,B=this.zoomScale(this.maxZoom)*this.tileSize,ge=this.cameraToCenterDistance;u[2]=o.clamp(u[2],ge/B,ge/E),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,E,B){this._unmodified=!1,this._edgeInsets.interpolate(u,E,B),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const E=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,E)}getVisibleUnwrappedCoordinates(u){const E=[new o.UnwrappedTileID(0,u)];if(this.renderWorldCopies){const B=this.pointCoordinate(new o.pointGeometry(0,0)),ge=this.pointCoordinate(new o.pointGeometry(this.width,0)),St=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),_n=this.pointCoordinate(new o.pointGeometry(0,this.height)),Bn=Math.floor(Math.min(B.x,ge.x,St.x,_n.x)),ss=Math.floor(Math.max(B.x,ge.x,St.x,_n.x)),tl=1;for(let il=Bn-tl;il<=ss+tl;il++)il!==0&&E.push(new o.UnwrappedTileID(il,u))}return E}coveringTiles(u){let E=this.coveringZoomLevel(u);const B=E,ge=this.elevation&&!u.isTerrainDEM,St=this.projection.name==="mercator";if(u.minzoom!==void 0&&E<u.minzoom)return[];u.maxzoom!==void 0&&E>u.maxzoom&&(E=u.maxzoom);const _n=this.locationCoordinate(this.center),Bn=this.center.lat,ss=1<<E,tl=[ss*_n.x,ss*_n.y,0],il=this.projection.name==="globe",Qu=!il,fh=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,E,Qu),wh=il?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Th=ss*o.mercatorZfromAltitude(1,this.center.lat),Sh=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ih=[ss*wh.x,ss*wh.y,Sh*(Qu?1:Th)],hh=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),Oh=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?E:0,Rh=u.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Nh=u.isTerrainDEM?-Rh:this._elevation?this._elevation.getMinElevationBelowMSL():0,qh=this.projection.isReprojectedInTileSpace?z0(this):1,$h=Md=>{const Bd=new o.MercatorCoordinate(Md.x+25e-6,Md.y,Md.z),mf=new o.MercatorCoordinate(Md.x,Md.y+25e-6,Md.z),Bf=Md.toLngLat(),Dp=Bd.toLngLat(),rm=mf.toLngLat(),Mp=this.locationCoordinate(Bf),xp=this.locationCoordinate(Dp),Lp=this.locationCoordinate(rm),dm=Math.hypot(xp.x-Mp.x,xp.y-Mp.y),Fp=Math.hypot(Lp.x-Mp.x,Lp.y-Mp.y);return Math.sqrt(dm*Fp)*qh/25e-6},Hh=Md=>{const pd=Rh,Bd=Nh;return{aabb:o.tileAABB(this,ss,0,0,0,Md,Bd,pd,this.projection),zoom:0,x:0,y:0,minZ:Bd,maxZ:pd,wrap:Md,fullyVisible:!1}},ld=[];let xd=[];const gd=E,Vf=u.reparseOverscaled?B:E,_d=Md=>Md*Md,Mf=_d((Sh-this._centerAltitude)*Th),Ud=Md=>{if(!this._elevation||!Md.tileID||!St)return;const pd=this._elevation.getMinMaxForTile(Md.tileID),Bd=Md.aabb;pd?(Bd.min[2]=pd.min,Bd.max[2]=pd.max,Bd.center[2]=(Bd.min[2]+Bd.max[2])/2):(Md.shouldSplit=Lf(Md),Md.shouldSplit||(Bd.min[2]=Bd.max[2]=Bd.center[2]=this._centerAltitude))},Lf=Md=>{if(Md.zoom<Oh)return!0;if(Md.zoom===gd)return!1;if(Md.shouldSplit!=null)return Md.shouldSplit;const pd=Md.aabb.distanceX(Ih),Bd=Md.aabb.distanceY(Ih);let mf=Mf,Bf=1;if(il){mf=_d(Md.aabb.distanceZ(Ih));const Mp=Math.pow(2,Md.zoom),xp=o.latFromMercatorY((Md.y+1)/Mp),Lp=o.latFromMercatorY(Md.y/Mp),dm=Math.min(Math.max(Bn,xp),Lp),Fp=o.circumferenceAtLatitude(dm)/o.circumferenceAtLatitude(Bn);if(Bf=dm===Bn?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Fp/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Md.zoom===gd-1&&Fp>=.9)return!0}else if(ge&&(mf=_d(Md.aabb.distanceZ(Ih)*Th)),this.projection.isReprojectedInTileSpace&&B<=5){const Mp=Math.pow(2,Md.zoom),xp=$h(new o.MercatorCoordinate((Md.x+.5)/Mp,(Md.y+.5)/Mp));Bf=xp>.85?1:xp}const Dp=pd*pd+Bd*Bd+mf,rm=_d((1<<gd-Md.zoom)*hh*Bf*((Mp,xp)=>{if(xp*_d(.707)<Mp)return 1;const Lp=Math.sqrt(xp/Mp);return Lp/(1.4144271570014144+(Math.pow(1.1,Lp-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(mf,Mf),Dp));return Dp<rm};if(this.renderWorldCopies)for(let Md=1;Md<=3;Md++)ld.push(Hh(-Md)),ld.push(Hh(Md));for(ld.push(Hh(0));ld.length>0;){const Md=ld.pop(),pd=Md.x,Bd=Md.y;let mf=Md.fullyVisible;if(!mf){const Bf=Md.aabb.intersects(fh);if(Bf===0)continue;mf=Bf===2}if(Md.zoom!==gd&&Lf(Md))for(let Bf=0;Bf<4;Bf++){const Dp=(pd<<1)+Bf%2,rm=(Bd<<1)+(Bf>>1),Mp={aabb:St?Md.aabb.quadrant(Bf):o.tileAABB(this,ss,Md.zoom+1,Dp,rm,Md.wrap,Md.minZ,Md.maxZ,this.projection),zoom:Md.zoom+1,x:Dp,y:rm,wrap:Md.wrap,fullyVisible:mf,tileID:void 0,shouldSplit:void 0,minZ:Md.minZ,maxZ:Md.maxZ};ge&&!il&&(Mp.tileID=new o.OverscaledTileID(Md.zoom+1===gd?Vf:Md.zoom+1,Md.wrap,Md.zoom+1,Dp,rm),Ud(Mp)),ld.push(Mp)}else{const Bf=Md.zoom===gd?Vf:Md.zoom;if(u.minzoom&&u.minzoom>Bf)continue;const Dp=tl[0]-(.5+pd+(Md.wrap<<Md.zoom))*(1<<E-Md.zoom),rm=tl[1]-.5-Bd,Mp=Md.tileID?Md.tileID:new o.OverscaledTileID(Bf,Md.wrap,Md.zoom,pd,Bd);xd.push({tileID:Mp,distanceSq:Dp*Dp+rm*rm})}}if(this.fogCullDistSq){const Md=this.fogCullDistSq,pd=this.horizonLineFromTop();xd=xd.filter(Bd=>{const mf=[0,0,0,1],Bf=[o.EXTENT,o.EXTENT,0,1],Dp=this.calculateFogTileMatrix(Bd.tileID.toUnwrapped());o.transformMat4$1(mf,mf,Dp),o.transformMat4$1(Bf,Bf,Dp);const rm=o.getAABBPointSquareDist(mf,Bf);if(rm===0)return!0;let Mp=!1;const xp=this._elevation;if(xp&&rm>Md&&pd!==0){const Lp=this.calculateProjMatrix(Bd.tileID.toUnwrapped());let dm;u.isTerrainDEM||(dm=xp.getMinMaxForTile(Bd.tileID)),dm||(dm={min:Nh,max:Rh});const Fp=o.furthestTileCorner(this.rotation),km=[Fp[0]*o.EXTENT,Fp[1]*o.EXTENT,dm.max];o.transformMat4(km,km,Lp),Mp=(1-km[1])*this.height*.5<pd}return rm<Md||Mp})}return xd.sort((Md,pd)=>Md.distanceSq-pd.distanceSq).map(Md=>Md.tileID)}resize(u,E){this.width=u,this.height=E,this.pixelsToGLUnits=[2/u,-2/E],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=this.projection.project(u.lng,E);return new o.pointGeometry(B.x*this.worldSize,B.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(u,E){let B,ge;const St=this.centerPoint;if(this.projection.name==="globe"){const Bn=this.worldSize;B=(E.x-St.x)/Bn,ge=(E.y-St.y)/Bn}else{const Bn=this.pointCoordinate(E),ss=this.pointCoordinate(St);B=Bn.x-ss.x,ge=Bn.y-ss.y}const _n=this.locationCoordinate(u);this.setLocation(new o.MercatorCoordinate(_n.x-B,_n.y-ge))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u){return this.projection.locationPoint(this,u)}locationPoint3D(u){return this.projection.locationPoint(this,u,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u){return this.coordinateLocation(this.pointCoordinate3D(u))}locationCoordinate(u,E){const B=E?o.mercatorZfromAltitude(E,u.lat):void 0,ge=this.projection.project(u.lng,u.lat);return new o.MercatorCoordinate(ge.x,ge.y,B)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,E){const B=E??this._centerAltitude,ge=[u.x,u.y,0,1],St=[u.x,u.y,1,1];o.transformMat4$1(ge,ge,this.pixelMatrixInverse),o.transformMat4$1(St,St,this.pixelMatrixInverse);const _n=St[3];o.scale$1(ge,ge,1/ge[3]),o.scale$1(St,St,1/_n);const Bn=ge[2],ss=St[2];return{p0:ge,p1:St,t:Bn===ss?0:(B-Bn)/(ss-Bn)}}screenPointToMercatorRay(u){const E=[u.x,u.y,0,1],B=[u.x,u.y,1,1];return o.transformMat4$1(E,E,this.pixelMatrixInverse),o.transformMat4$1(B,B,this.pixelMatrixInverse),o.scale$1(E,E,1/E[3]),o.scale$1(B,B,1/B[3]),E[2]=o.mercatorZfromAltitude(E[2],this._center.lat)*this.worldSize,B[2]=o.mercatorZfromAltitude(B[2],this._center.lat)*this.worldSize,o.scale$1(E,E,1/this.worldSize),o.scale$1(B,B,1/this.worldSize),new o.Ray([E[0],E[1],E[2]],o.normalize([],o.sub([],B,E)))}rayIntersectionCoordinate(u){const{p0:E,p1:B,t:ge}=u,St=o.mercatorZfromAltitude(E[2],this._center.lat),_n=o.mercatorZfromAltitude(B[2],this._center.lat);return new o.MercatorCoordinate(o.number(E[0],B[0],ge)/this.worldSize,o.number(E[1],B[1],ge)/this.worldSize,o.number(St,_n,ge))}pointCoordinate(u,E=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,E)}pointCoordinate3D(u){if(!this.elevation)return this.pointCoordinate(u);let E=this.projection.pointCoordinate3D(this,u.x,u.y);if(E)return new o.MercatorCoordinate(E[0],E[1],E[2]);let B=0,ge=this.horizonLineFromTop();if(u.y>ge)return this.pointCoordinate(u);const St=.02*ge,_n=u.clone();for(let Bn=0;Bn<10&&ge-B>St;Bn++){_n.y=o.number(B,ge,.66);const ss=this.projection.pointCoordinate3D(this,_n.x,_n.y);ss?(ge=_n.y,E=ss):B=_n.y}return E?new o.MercatorCoordinate(E[0],E[1],E[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}_coordinatePoint(u,E){const B=E&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,ge=[u.x*this.worldSize,u.y*this.worldSize,B+u.toAltitude(),1];return o.transformMat4$1(ge,ge,this.pixelMatrix),ge[3]>0?new o.pointGeometry(ge[0]/ge[3],ge[1]/ge[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:u,left:E}=this._edgeInsets,B=this.height-this._edgeInsets.bottom,ge=this.width-this._edgeInsets.right,St=this.pointLocation3D(new o.pointGeometry(E,u)),_n=this.pointLocation3D(new o.pointGeometry(ge,u)),Bn=this.pointLocation3D(new o.pointGeometry(ge,B)),ss=this.pointLocation3D(new o.pointGeometry(E,B));let tl=Math.min(St.lng,_n.lng,Bn.lng,ss.lng),il=Math.max(St.lng,_n.lng,Bn.lng,ss.lng),Qu=Math.min(St.lat,_n.lat,Bn.lat,ss.lat),fh=Math.max(St.lat,_n.lat,Bn.lat,ss.lat);const wh=Math.pow(2,-this.zoom)/16*270,Th=this.projection.name==="globe"?1:4,Sh=(Ih,hh,Oh,Rh,Nh)=>{const qh=(Ih+Oh)/2,$h=(hh+Rh)/2,Hh=new o.pointGeometry(qh,$h),{lng:ld,lat:xd}=this.pointLocation3D(Hh),gd=Math.max(0,tl-ld,Qu-xd,ld-il,xd-fh);tl=Math.min(tl,ld),il=Math.max(il,ld),Qu=Math.min(Qu,xd),fh=Math.max(fh,xd),(Nh<Th||gd>wh)&&(Sh(Ih,hh,qh,$h,Nh+1),Sh(qh,$h,Oh,Rh,Nh+1))};if(Sh(E,u,ge,u,1),Sh(ge,u,ge,B,1),Sh(ge,B,E,B,1),Sh(E,B,E,u,1),this.projection.name==="globe"){const[Ih,hh]=o.polesInViewport(this);Ih?(fh=90,il=180,tl=-180):hh&&(Qu=-90,il=180,tl=-180)}return new o.LngLatBounds(new o.LngLat(tl,Qu),new o.LngLat(il,fh))}_getBoundsRectangular(u,E){const{top:B,left:ge}=this._edgeInsets,St=this.height-this._edgeInsets.bottom,_n=this.width-this._edgeInsets.right,Bn=new o.pointGeometry(ge,B),ss=new o.pointGeometry(_n,B),tl=new o.pointGeometry(_n,St),il=new o.pointGeometry(ge,St);let Qu=this.pointCoordinate(Bn,u),fh=this.pointCoordinate(ss,u);const wh=this.pointCoordinate(tl,E),Th=this.pointCoordinate(il,E),Sh=(Ih,hh)=>(hh.y-Ih.y)/(hh.x-Ih.x);return Qu.y>1&&fh.y>=0?Qu=new o.MercatorCoordinate((1-Th.y)/Sh(Th,Qu)+Th.x,1):Qu.y<0&&fh.y<=1&&(Qu=new o.MercatorCoordinate(-Th.y/Sh(Th,Qu)+Th.x,0)),fh.y>1&&Qu.y>=0?fh=new o.MercatorCoordinate((1-wh.y)/Sh(wh,fh)+wh.x,1):fh.y<0&&Qu.y<=1&&(fh=new o.MercatorCoordinate(-wh.y/Sh(wh,fh)+wh.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(Qu)).extend(this.coordinateLocation(fh)).extend(this.coordinateLocation(Th)).extend(this.coordinateLocation(wh))}_getBoundsRectangularTerrain(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBoundsRectangular(0,0);const E=u.visibleDemTiles.reduce((B,ge)=>{if(ge.dem){const St=ge.dem.tree;B.min=Math.min(B.min,St.minimums[0]),B.max=Math.max(B.max,St.maximums[0])}return B},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(E.min*u.exaggeration(),E.max*u.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(u=!0){const E=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,B=this.height/2-E*(1-this._horizonShift);return u?Math.max(0,B):B}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,E){return this.projection.createTileMatrix(this,E,u)}calculateDistanceTileData(u){const E=u.key,B=this._distanceTileDataCache;if(B[E])return B[E];const ge=u.canonical,St=1/this.height,_n=this.cameraWorldSize,Bn=_n/this.zoomScale(ge.z),ss=(ge.x+Math.pow(2,ge.z)*u.wrap)*Bn,tl=ge.y*Bn,il=this.point;il.x*=_n/this.worldSize,il.y*=_n/this.worldSize;const Qu=this.angle,fh=Math.sin(-Qu),wh=-Math.cos(-Qu);return B[E]={bearing:[fh,wh],center:[(il.x-ss)*St,(il.y-tl)*St],scale:Bn/o.EXTENT*St},B[E]}calculateFogTileMatrix(u){const E=u.key,B=this._fogTileMatrixCache;if(B[E])return B[E];const ge=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,u);return o.multiply(ge,this.worldToFogMatrix,ge),B[E]=new Float32Array(ge),B[E]}calculateProjMatrix(u,E=!1){const B=u.key,ge=E?this._alignedProjMatrixCache:this._projMatrixCache;if(ge[B])return ge[B];const St=this.calculatePosMatrix(u,this.worldSize);return o.multiply(St,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:E?this.alignedProjMatrix:this.projMatrix,St),ge[B]=new Float32Array(St),ge[B]}calculatePixelsToTileUnitsMatrix(u){const E=u.tileID.key,B=this._pixelsToTileUnitsCache;if(B[E])return B[E];const ge=function(St,_n){const{scale:Bn}=St.tileTransform,ss=Bn*o.EXTENT/(St.tileSize*Math.pow(2,_n.zoom-St.tileID.overscaledZ+St.tileID.canonical.z));return tl=new Float32Array(4),fh=(il=_n.inverseAdjustmentMatrix)[1],wh=il[2],Th=il[3],Ih=(Qu=[ss,ss])[1],tl[0]=il[0]*(Sh=Qu[0]),tl[1]=fh*Sh,tl[2]=wh*Ih,tl[3]=Th*Ih,tl;var tl,il,Qu,fh,wh,Th,Sh,Ih}(u,this);return B[E]=ge,B[E]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const u=1/this.worldSize,E=o.fromScaling([],[u,u,u]);return o.multiply(E,E,this.globeMatrix),E}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const u=this._elevation;this._updateCameraState();const E=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,B=this._computeCameraPosition(E),ge=this._camera.forward(),St=o.mercatorZfromAltitude(1,this._center.lat);B[2]/=St,ge[2]/=St,o.normalize(ge,ge);const _n=u.raycast(B,ge,u.exaggeration());if(_n){const Bn=o.scaleAndAdd([],B,ge,_n),ss=new o.MercatorCoordinate(Bn[0],Bn[1],o.mercatorZfromAltitude(Bn[2],o.latFromMercatorY(Bn[1]))),tl=(ss.z+o.length([ss.x-B[0],ss.y-B[1],ss.z-B[2]*St]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(tl),this._centerAltitude=ss.toAltitude(),this._center=this.coordinateLocation(ss),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(u=!1){if(!this._elevation)return;const E=this._elevation,B=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,ge=this._computeCameraPosition(B),St=E.getAtPointOrZero(new o.MercatorCoordinate(...ge)),_n=this.pixelsPerMeter/this.worldSize*St,Bn=this._minimumHeightOverTerrain(),ss=ge[2]-_n;if(ss<=Bn)if(ss<0||u){const tl=this.locationCoordinate(this._center,this._centerAltitude),il=[ge[0],ge[1],tl.z-ge[2]],Qu=o.length(il);il[2]-=(Bn-ss)/this._pixelsPerMercatorPixel;const fh=o.length(il);if(fh===0)return;o.scale$2(il,il,Qu/fh*this._pixelsPerMercatorPixel),this._camera.position=[ge[0],ge[1],tl.z*this._pixelsPerMercatorPixel-il[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const fh=this.center;return fh.lat=o.clamp(fh.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(fh.lng=o.clamp(fh.lng,this.minLng,this.maxLng)),this.center=fh,void(this._constraining=!1)}const E=this._unmodified,{x:B,y:ge}=this.point;let St=0,_n=B,Bn=ge;const ss=this.width/2,tl=this.height/2,il=this.worldMinY*this.scale,Qu=this.worldMaxY*this.scale;if(ge-tl<il&&(Bn=il+tl),ge+tl>Qu&&(Bn=Qu-tl),Qu-il<this.height&&(St=Math.max(St,this.height/(Qu-il)),Bn=(Qu+il)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const fh=this.worldMinX*this.scale,wh=this.worldMaxX*this.scale,Th=this.worldSize/2-(fh+wh)/2;_n=(B+Th+this.worldSize)%this.worldSize-Th,_n-ss<fh&&(_n=fh+ss),_n+ss>wh&&(_n=wh-ss),wh-fh<this.width&&(St=Math.max(St,this.width/(wh-fh)),_n=(wh+fh)/2)}_n===B&&Bn===ge||(this.center=this.unproject(new o.pointGeometry(_n,Bn))),St&&(this.zoom+=this.scaleZoom(St)),this._constrainCamera(),this._unmodified=E,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,E=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const B=kp(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,B),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ge=this.projection.zAxisUnit==="meters"?E:1,St=this._camera.getWorldToCamera(this.worldSize,ge),_n=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);_n[8]=2*-u.x/this.width,_n[9]=2*u.y/this.height;let Bn=o.mul([],_n,St);if(this.projection.isReprojectedInTileSpace){const $h=this.locationCoordinate(this.center),Hh=o.identity([]);o.translate(Hh,Hh,[$h.x*this.worldSize,$h.y*this.worldSize,0]),o.multiply(Hh,Hh,e_(this)),o.translate(Hh,Hh,[-$h.x*this.worldSize,-$h.y*this.worldSize,0]),o.multiply(Bn,Bn,Hh),this.inverseAdjustmentMatrix=function(ld){const xd=e_(ld,!0);return th([],[xd[0],xd[1],xd[4],xd[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],Bn,[this.worldSize,this.worldSize,this.worldSize/ge,1]),this.projMatrix=Bn,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const ss=o.invert([],_n);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(ss,this.horizonLineFromTop(),this.height);const tl=new Float32Array(16);o.identity(tl),o.scale(tl,tl,[1,-1,1]),o.rotateX(tl,tl,this._pitch),o.rotateZ(tl,tl,this.angle);const il=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Qu=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;il[8]=2*-u.x/this.width,il[9]=2*(u.y+Qu)/this.height,this.skyboxMatrix=o.multiply(tl,il,tl);const fh=this.point,wh=fh.x,Th=fh.y,Sh=this.width%2/2,Ih=this.height%2/2,hh=Math.cos(this.angle),Oh=Math.sin(this.angle),Rh=wh-Math.round(wh)+hh*Sh+Oh*Ih,Nh=Th-Math.round(Th)+hh*Ih+Oh*Sh,qh=new Float64Array(Bn);if(o.translate(qh,qh,[Rh>.5?Rh-1:Rh,Nh>.5?Nh-1:Nh,0]),this.alignedProjMatrix=qh,Bn=o.create(),o.scale(Bn,Bn,[this.width/2,-this.height/2,1]),o.translate(Bn,Bn,[1,-1,0]),this.labelPlaneMatrix=Bn,Bn=o.create(),o.scale(Bn,Bn,[1,-1,1]),o.translate(Bn,Bn,[-1,-1,0]),o.scale(Bn,Bn,[2/this.width,2/this.height,1]),this.glCoordMatrix=Bn,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},Bn=o.invert(new Float64Array(16),this.pixelMatrix),!Bn)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Bn,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const $h=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4($h,$h,St),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Bn;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSizeForFog,E=this.cameraPixelsPerMeter,B=this._camera.position,ge=1/this.height/this._pixelsPerMercatorPixel,St=[u,u,E];o.scale$2(St,St,ge),o.scale$2(B,B,-1),o.multiply$2(B,B,St);const _n=o.create();o.translate(_n,_n,B),o.scale(_n,_n,St),this.mercatorFogMatrix=_n,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,E,ge)}_computeCameraPosition(u){const E=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,B=this._camera.forward(),ge=this.point,St=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*E-u/this.worldSize*this._centerAltitude;return[ge.x/this.worldSize-B[0]*St,ge.y/this.worldSize-B[1]*St,u/this.worldSize*this._centerAltitude-B[2]*St]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const E=this._maxCameraBoundsDistance()*Math.cos(this._pitch),B=this._camera.position[2],ge=u[2];let St=1;this.projection.wrap&&(this.center=this.center.wrap()),ge>0&&(St=Math.min((E-B)/ge,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,u,St),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,E=this._camera.forward(),{pitch:B,bearing:ge}=this._camera.getPitchBearing(),St=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_n=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),Bn=Math.max((u[2]-St)/Math.cos(B),_n),ss=this._zoomFromMercatorZ(Bn);o.scaleAndAdd(u,u,E,Bn),this._pitch=o.clamp(B,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(ge,-Math.PI,Math.PI),this._setZoom(o.clamp(ss,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(u*this.tileSize))}zoomFromMercatorZAdjusted(u){let E=0,B=o.GLOBE_ZOOM_THRESHOLD_MAX,ge=0,St=1/0;for(;B-E>1e-6&&B>E;){const _n=E+.5*(B-E),Bn=this.tileSize*Math.pow(2,_n),ss=this.getCameraToCenterDistance(this.projection,_n,Bn),tl=this.scaleZoom(ss/(u*this.tileSize)),il=Math.abs(_n-tl);il<St&&(St=il,ge=_n),_n<tl?E=_n:B=_n}return ge}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,E){const B=Math.min(u.x,E.x),ge=Math.max(u.x,E.x),St=Math.min(u.y,E.y),_n=Math.max(u.y,E.y);if(St<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Bn=[new o.pointGeometry(B,St),new o.pointGeometry(ge,_n),new o.pointGeometry(B,_n),new o.pointGeometry(ge,St)],ss=this.renderWorldCopies?-3:0,tl=this.renderWorldCopies?4:1;for(const il of Bn){const Qu=this.pointRayIntersection(il);if(Qu.t<0)return!0;const fh=this.rayIntersectionCoordinate(Qu);if(fh.x<ss||fh.y<0||fh.x>tl||fh.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(u,E){const B=o.length(o.sub([],this._camera.position,u)),ge=this._zoomFromMercatorZ(B)+E;return B-this._mercatorZfromZoom(ge)}getCameraPoint(){if(this.projection.name==="globe"){const u=function([E,B,ge],St){const _n=[E,B,ge,1];o.transformMat4$1(_n,_n,St);const Bn=_n[3]=Math.max(_n[3],1e-6);return _n[0]/=Bn,_n[1]/=Bn,_n[2]/=Bn,_n}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,u))}}getCameraToCenterDistance(u,E=this.zoom,B=this.worldSize){const ge=kp(u,E,this.width,this.height,1024),St=u.pixelSpaceConversion(this.center.lat,B,ge);return .5/Math.tan(.5*this._fov)*this.height*St}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(u,u,this.globeMatrix),u}}function tg(L,u){let E=!1,B=null;const ge=()=>{B=null,E&&(L(),B=setTimeout(ge,u),E=!1)};return()=>(E=!0,B||ge(),B)}class wv{constructor(u){this._hashName=u&&encodeURIComponent(u),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=tg(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,o.window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const E=L_(u);if(this._hashName){const B=this._hashName;let ge=!1;const St=o.window.location.hash.slice(1).split("&").map(_n=>{const Bn=_n.split("=")[0];return Bn===B?(ge=!0,`${Bn}=${E}`):_n}).filter(_n=>_n);return ge||St.push(`${B}=${E}`),`#${St.join("&")}`}return`#${E}`}_getCurrentHash(){const u=o.window.location.hash.replace("#","");if(this._hashName){let E;return u.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(E=B)}),(E&&E[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const E=this._getCurrentHash();if(E.length>=3&&!E.some(B=>isNaN(B))){const B=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(E[3]||0):u.getBearing();return u.jumpTo({center:[+E[2],+E[1]],zoom:+E[0],bearing:B,pitch:+(E[4]||0)}),!0}return!1}_updateHashUnthrottled(){const u=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,u)}}function L_(L,u){const E=L.getCenter(),B=Math.round(100*L.getZoom())/100,ge=Math.ceil((B*Math.LN2+Math.log(512/360/.5))/Math.LN10),St=Math.pow(10,ge),_n=Math.round(E.lng*St)/St,Bn=Math.round(E.lat*St)/St,ss=L.getBearing(),tl=L.getPitch();let il=u?`/${_n}/${Bn}/${B}`:`${B}/${Bn}/${_n}`;return(ss||tl)&&(il+="/"+Math.round(10*ss)/10),tl&&(il+=`/${Math.round(tl)}`),il}const Ev={linearity:.3,easing:o.bezier(0,0,.3,1)},Wy=o.extend({deceleration:2500,maxSpeed:1400},Ev),pg=o.extend({deceleration:20,maxSpeed:1400},Ev),mg=o.extend({deceleration:1e3,maxSpeed:360},Ev),Fv=o.extend({deceleration:1e3,maxSpeed:90},Ev);class v0{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,E=o.exported.now();for(;u.length>0&&E-u[0].time>160;)u.shift()}_onMoveEnd(u){if(o.exported.prefersReducedMotion||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const E={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:St}of this._inertiaBuffer)E.zoom+=St.zoomDelta||0,E.bearing+=St.bearingDelta||0,E.pitch+=St.pitchDelta||0,St.panDelta&&E.pan._add(St.panDelta),St.around&&(E.around=St.around),St.pinchAround&&(E.pinchAround=St.pinchAround);const B=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ge={};if(E.pan.mag()){const St=wy(E.pan.mag(),B,o.extend({},Wy,u||{}));ge.offset=E.pan.mult(St.amount/E.pan.mag()),ge.center=this._map.transform.center,x0(ge,St)}if(E.zoom){const St=wy(E.zoom,B,pg);ge.zoom=this._map.transform.zoom+St.amount,x0(ge,St)}if(E.bearing){const St=wy(E.bearing,B,mg);ge.bearing=this._map.transform.bearing+o.clamp(St.amount,-179,179),x0(ge,St)}if(E.pitch){const St=wy(E.pitch,B,Fv);ge.pitch=this._map.transform.pitch+St.amount,x0(ge,St)}if(ge.zoom||ge.bearing){const St=E.pinchAround===void 0?E.around:E.pinchAround;ge.around=St?this._map.unproject(St):this._map.getCenter()}return this.clear(),ge.noMoveStart=!0,ge}}function x0(L,u){(!L.duration||L.duration<u.duration)&&(L.duration=u.duration,L.easing=u.easing)}function wy(L,u,E){const{maxSpeed:B,linearity:ge,deceleration:St}=E,_n=o.clamp(L*ge/(u/1e3),-B,B),Bn=Math.abs(_n)/(St*ge);return{easing:E.easing,duration:1e3*Bn,amount:_n*(Bn/2)}}class Lg extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B,ge={}){const St=Js(E.getCanvasContainer(),B),_n=E.unproject(St);super(u,o.extend({point:St,lngLat:_n,originalEvent:B},ge)),this._defaultPrevented=!1,this.target=E}}class b0 extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){const ge=u==="touchend"?B.changedTouches:B.touches,St=lh(E.getCanvasContainer(),ge),_n=St.map(ss=>E.unproject(ss)),Bn=St.reduce((ss,tl,il,Qu)=>ss.add(tl.div(Qu.length)),new o.pointGeometry(0,0));super(u,{points:St,point:Bn,lngLats:_n,lngLat:E.unproject(Bn),originalEvent:B}),this._defaultPrevented=!1}}class Sv extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){super(u,{originalEvent:B}),this._defaultPrevented=!1}}class $v{constructor(u,E){this._map=u,this._clickTolerance=E.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new Sv(u.type,this._map,u))}mousedown(u,E){return this._mousedownPos=E,this._firePreventable(new Lg(u.type,this._map,u))}mouseup(u){this._map.fire(new Lg(u.type,this._map,u))}preclick(u){const E=o.extend({},u);E.type="preclick",this._map.fire(new Lg(E.type,this._map,E))}click(u,E){this._mousedownPos&&this._mousedownPos.dist(E)>=this._clickTolerance||(this.preclick(u),this._map.fire(new Lg(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new Lg(u.type,this._map,u))}mouseover(u){this._map.fire(new Lg(u.type,this._map,u))}mouseout(u){this._map.fire(new Lg(u.type,this._map,u))}touchstart(u){return this._firePreventable(new b0(u.type,this._map,u))}touchmove(u){this._map.fire(new b0(u.type,this._map,u))}touchend(u){this._map.fire(new b0(u.type,this._map,u))}touchcancel(u){this._map.fire(new b0(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sv{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new Lg(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new Lg(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class av{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=E.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,E){this.isEnabled()&&u.shiftKey&&u.button===0&&(Io(),this._startPos=this._lastPos=E,this._active=!0)}mousemoveWindow(u,E){if(!this._active)return;const B=E,ge=this._startPos,St=this._lastPos;if(!ge||!St||St.equals(B)||!this._box&&B.dist(ge)<this._clickTolerance)return;this._lastPos=B,this._box||(this._box=nt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const _n=Math.min(ge.x,B.x),Bn=Math.max(ge.x,B.x),ss=Math.min(ge.y,B.y),tl=Math.max(ge.y,B.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_n}px,${ss}px)`,this._box.style.width=Bn-_n+"px",this._box.style.height=tl-ss+"px")})}mouseupWindow(u,E){if(!this._active)return;const B=this._startPos,ge=E;if(B&&u.button===0){if(this.reset(),as(),B.x!==ge.x||B.y!==ge.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:St=>St.fitScreenCoordinates(B,ge,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),rl(),delete this._startPos,delete this._lastPos}_fireEvent(u,E){return this._map.fire(new o.Event(u,{originalEvent:E}))}}function F0(L,u){const E={};for(let B=0;B<L.length;B++)E[L[B].identifier]=u[B];return E}class Uv{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,E,B){(this.centroid||B.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=u.timeStamp),B.length===this.numTouches&&(this.centroid=function(ge){const St=new o.pointGeometry(0,0);for(const _n of ge)St._add(_n);return St.div(ge.length)}(E),this.touches=F0(B,E)))}touchmove(u,E,B){if(this.aborted||!this.centroid)return;const ge=F0(B,E);for(const St in this.touches){const _n=this.touches[St],Bn=ge[St];(!Bn||Bn.dist(_n)>30)&&(this.aborted=!0)}}touchend(u,E,B){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),B.length===0){const ge=!this.aborted&&this.centroid;if(this.reset(),ge)return ge}}}class w0{constructor(u){this.singleTap=new Uv(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,E,B){this.singleTap.touchstart(u,E,B)}touchmove(u,E,B){this.singleTap.touchmove(u,E,B)}touchend(u,E,B){const ge=this.singleTap.touchend(u,E,B);if(ge){const St=u.timeStamp-this.lastTime<500,_n=!this.lastTap||this.lastTap.dist(ge)<30;if(St&&_n||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=ge,this.count===this.numTaps)return this.reset(),ge}}}class Tv{constructor(){this._zoomIn=new w0({numTouches:1,numTaps:2}),this._zoomOut=new w0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,E,B){this._zoomIn.touchstart(u,E,B),this._zoomOut.touchstart(u,E,B)}touchmove(u,E,B){this._zoomIn.touchmove(u,E,B),this._zoomOut.touchmove(u,E,B)}touchend(u,E,B){const ge=this._zoomIn.touchend(u,E,B),St=this._zoomOut.touchend(u,E,B);return ge?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_n=>_n.easeTo({duration:300,zoom:_n.getZoom()+1,around:_n.unproject(ge)},{originalEvent:u})}):St?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_n=>_n.easeTo({duration:300,zoom:_n.getZoom()-1,around:_n.unproject(St)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vv={0:1,2:2};class $0{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,E){return!1}_move(u,E){return{}}mousedown(u,E){if(this._lastPoint)return;const B=ch(u);this._correctButton(u,B)&&(this._lastPoint=E,this._eventButton=B)}mousemoveWindow(u,E){const B=this._lastPoint;if(B){if(u.preventDefault(),this._eventButton!=null&&function(ge,St){const _n=Vv[St];return ge.buttons===void 0||(ge.buttons&_n)!==_n}(u,this._eventButton))this.reset();else if(this._moved||!(E.dist(B)<this._clickTolerance))return this._moved=!0,this._lastPoint=E,this._move(B,E)}}mouseupWindow(u){this._lastPoint&&ch(u)===this._eventButton&&(this._moved&&as(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gv extends $0{mousedown(u,E){super.mousedown(u,E),this._lastPoint&&(this._active=!0)}_correctButton(u,E){return E===0&&!u.ctrlKey}_move(u,E){return{around:E,panDelta:E.sub(u)}}}class Ey extends $0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=.8*(E.x-u.x);if(B)return this._active=!0,{bearingDelta:B}}contextmenu(u){u.preventDefault()}}class lv extends $0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=-.5*(E.y-u.y);if(B)return this._active=!0,{pitchDelta:B}}contextmenu(u){u.preventDefault()}}class E0{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=E.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(u,E,B){return this._calculateTransform(u,E,B)}touchmove(u,E,B){if(this._active&&!(B.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(B.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,E,B)}}touchend(u,E,B){this._calculateTransform(u,E,B),this._active&&B.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,E,B){B.length>0&&(this._active=!0);const ge=F0(B,E),St=new o.pointGeometry(0,0),_n=new o.pointGeometry(0,0);let Bn=0;for(const tl in ge){const il=ge[tl],Qu=this._touches[tl];Qu&&(St._add(il),_n._add(il.sub(Qu)),Bn++,ge[tl]=il)}if(this._touches=ge,Bn<this._minTouches||!_n.mag())return;const ss=_n.div(Bn);return this._sum._add(ss),this._sum.mag()<this._clickTolerance?void 0:{around:St.div(Bn),panDelta:ss}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class cv{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,E,B){return{}}touchstart(u,E,B){this._firstTwoTouches||B.length<2||(this._firstTwoTouches=[B[0].identifier,B[1].identifier],this._start([E[0],E[1]]))}touchmove(u,E,B){const ge=this._firstTwoTouches;if(!ge)return;u.preventDefault();const[St,_n]=ge,Bn=S0(B,E,St),ss=S0(B,E,_n);if(!Bn||!ss)return;const tl=this._aroundCenter?null:Bn.add(ss).div(2);return this._move([Bn,ss],tl,u)}touchend(u,E,B){if(!this._firstTwoTouches)return;const[ge,St]=this._firstTwoTouches,_n=S0(B,E,ge),Bn=S0(B,E,St);_n&&Bn||(this._active&&as(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function S0(L,u,E){for(let B=0;B<L.length;B++)if(L[B].identifier===E)return u[B]}function jv(L,u){return Math.log(L/u)/Math.LN2}class c1 extends cv{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,E){const B=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(jv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jv(this._distance,B),pinchAround:E}}}function Iv(L,u){return 180*L.angleWith(u)/Math.PI}class Mv extends cv{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,E){const B=this._vector;if(this._vector=u[0].sub(u[1]),B&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Iv(this._vector,B),pinchAround:E}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const E=25/(Math.PI*this._minDiameter)*360,B=this._startVector;if(!B)return!1;const ge=Iv(u,B);return Math.abs(ge)<E}}function uv(L){return Math.abs(L.y)>Math.abs(L.x)}class Fg extends cv{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,uv(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,E,B){const ge=this._lastPoints;if(!ge)return;const St=u[0].sub(ge[0]),_n=u[1].sub(ge[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&B.touches.length<3||(this._valid=this.gestureBeginsVertically(St,_n,B.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(St.y+_n.y)/2*-.5})}gestureBeginsVertically(u,E,B){if(this._valid!==void 0)return this._valid;const ge=u.mag()>=2,St=E.mag()>=2;if(!ge&&!St)return;if(!ge||!St)return this._firstMove==null&&(this._firstMove=B),B-this._firstMove<100&&void 0;const _n=u.y>0==E.y>0;return uv(u)&&uv(E)&&_n}}const R1={panStep:100,bearingStep:15,pitchStep:10};class T0{constructor(){const u=R1;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let E=0,B=0,ge=0,St=0,_n=0;switch(u.keyCode){case 61:case 107:case 171:case 187:E=1;break;case 189:case 109:case 173:E=-1;break;case 37:u.shiftKey?B=-1:(u.preventDefault(),St=-1);break;case 39:u.shiftKey?B=1:(u.preventDefault(),St=1);break;case 38:u.shiftKey?ge=1:(u.preventDefault(),_n=-1);break;case 40:u.shiftKey?ge=-1:(u.preventDefault(),_n=1);break;default:return}return this._rotationDisabled&&(B=0,ge=0),{cameraAnimation:Bn=>{const ss=Bn.getZoom();Bn.easeTo({duration:300,easeId:"keyboardHandler",easing:Cv,zoom:E?Math.round(ss)+E*(u.shiftKey?2:1):ss,bearing:Bn.getBearing()+B*this._bearingStep,pitch:Bn.getPitch()+ge*this._pitchStep,offset:[-St*this._panStep,-_n*this._panStep],center:Bn.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cv(L){return L*(2-L)}const U0=4.000244140625;class Sy{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._handler=E,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let E=u.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const B=o.exported.now(),ge=B-(this._lastWheelEventTime||0);this._lastWheelEventTime=B,E!==0&&E%U0==0?this._type="wheel":E!==0&&Math.abs(E)<4?this._type="trackpad":ge>400?(this._type=null,this._lastValue=E,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(ge*E)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,E+=this._lastValue)),u.shiftKey&&E&&(E/=4),this._type&&(this._lastWheelEvent=u,this._delta-=E,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const E=Js(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:E,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;this._type==="wheel"&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const E=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(this._delta!==0){const ss=this._type==="wheel"&&Math.abs(this._delta)>U0?this._wheelZoomRate:this._defaultZoomRate;let tl=2/(1+Math.exp(-Math.abs(this._delta*ss)));this._delta<0&&tl!==0&&(tl=1/tl);const il=E(),Qu=Math.pow(2,il),fh=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):Qu;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(fh*tl))),this._type==="wheel"&&(this._startZoom=il,this._easing=this._smoothOutEasing(200)),this._delta=0}const B=typeof this._targetZoom=="number"?this._targetZoom:E(),ge=this._startZoom,St=this._easing;let _n,Bn=!1;if(this._type==="wheel"&&ge&&St){const ss=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),tl=St(ss);_n=o.number(ge,B,tl),ss<1?this._frameId||(this._frameId=!0):Bn=!0}else _n=B,Bn=!0;return this._active=!0,Bn&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Bn,zoomDelta:_n-E(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let E=o.ease;if(this._prevEase){const B=this._prevEase,ge=(o.exported.now()-B.start)/B.duration,St=B.easing(ge+.01)-B.easing(ge),_n=.27/Math.sqrt(St*St+1e-4)*.01,Bn=Math.sqrt(.0729-_n*_n);E=o.bezier(_n,Bn,.25,1)}return this._prevEase={start:o.exported.now(),duration:u,easing:E},E}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class qv{constructor(u,E){this._clickZoom=u,this._tapZoom=E}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ty{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,E){return u.preventDefault(),{cameraAnimation:B=>{B.easeTo({duration:300,zoom:B.getZoom()+(u.shiftKey?-1:1),around:B.unproject(E)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Iy{constructor(){this._tap=new w0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,E,B){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?B.length>0&&(this._swipePoint=E[0],this._swipeTouch=B[0].identifier):this._tap.touchstart(u,E,B))}touchmove(u,E,B){if(this._tapTime){if(this._swipePoint){if(B[0].identifier!==this._swipeTouch)return;const ge=E[0],St=ge.y-this._swipePoint.y;return this._swipePoint=ge,u.preventDefault(),this._active=!0,{zoomDelta:St/128}}}else this._tap.touchmove(u,E,B)}touchend(u,E,B){this._tapTime?this._swipePoint&&B.length===0&&this.reset():this._tap.touchend(u,E,B)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zv{constructor(u,E,B){this._el=u,this._mousePan=E,this._touchPan=B}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ip{constructor(u,E,B){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=E,this._mousePitch=B}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class O1{constructor(u,E,B,ge){this._el=u,this._touchZoom=E,this._touchRotate=B,this._tapDragZoom=ge,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const K_=L=>L.zoom||L.drag||L.pitch||L.rotate;class Y extends o.Event{}class g{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,E){const B=o.sub([],E,u);this.radius=o.length(B[2]<0?o.div([],B,this.constants):[B[0],B[1],0])}projectRay(u){o.div(u,u,this.constants),o.normalize(u,u),o.mul$1(u,u,this.constants);const E=o.scale$2([],u,this.radius);if(E[2]>0){const B=o.scale$2([],[0,0,1],o.dot(E,[0,0,1])),ge=o.scale$2([],o.normalize([],[E[0],E[1],0]),this.radius),St=o.add([],E,o.scale$2([],o.sub([],o.add([],ge,B),E),2));E[0]=St[0],E[1]=St[1]}return E}}function A(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class q{constructor(u,E){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new v0(u),this._bearingSnap=E.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new g,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(E),o.bindAll(["handleEvent","handleWindowEvent"],this);const B=this._el;this._listeners=[[B,"touchstart",{passive:!0}],[B,"touchmove",{passive:!1}],[B,"touchend",void 0],[B,"touchcancel",void 0],[B,"mousedown",void 0],[B,"mousemove",void 0],[B,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[B,"mouseover",void 0],[B,"mouseout",void 0],[B,"dblclick",void 0],[B,"click",void 0],[B,"keydown",{capture:!1}],[B,"keyup",void 0],[B,"wheel",{passive:!1}],[B,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[ge,St,_n]of this._listeners)ge.addEventListener(St,ge===o.window.document?this.handleWindowEvent:this.handleEvent,_n)}destroy(){for(const[u,E,B]of this._listeners)u.removeEventListener(E,u===o.window.document?this.handleWindowEvent:this.handleEvent,B)}_addDefaultHandlers(u){const E=this._map,B=E.getCanvasContainer();this._add("mapEvent",new $v(E,u));const ge=E.boxZoom=new av(E,u);this._add("boxZoom",ge);const St=new Tv,_n=new Ty;E.doubleClickZoom=new qv(_n,St),this._add("tapZoom",St),this._add("clickZoom",_n);const Bn=new Iy;this._add("tapDragZoom",Bn);const ss=E.touchPitch=new Fg(E);this._add("touchPitch",ss);const tl=new Ey(u),il=new lv(u);E.dragRotate=new Ip(u,tl,il),this._add("mouseRotate",tl,["mousePitch"]),this._add("mousePitch",il,["mouseRotate"]);const Qu=new Gv(u),fh=new E0(E,u);E.dragPan=new Zv(B,Qu,fh),this._add("mousePan",Qu),this._add("touchPan",fh,["touchZoom","touchRotate"]);const wh=new Mv,Th=new c1;E.touchZoomRotate=new O1(B,Th,wh,Bn),this._add("touchRotate",wh,["touchPan","touchZoom"]),this._add("touchZoom",Th,["touchPan","touchRotate"]),this._add("blockableMapEvent",new sv(E));const Sh=E.scrollZoom=new Sy(E,this);this._add("scrollZoom",Sh,["mousePan"]);const Ih=E.keyboard=new T0;this._add("keyboard",Ih);for(const hh of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[hh]&&E[hh].enable(u[hh])}_add(u,E,B){this._handlers.push({handlerName:u,handler:E,allowed:B}),this._handlersById[u]=E}stop(u){if(!this._updatingCamera){for(const{handler:E}of this._handlers)E.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!K_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(u,E,B){for(const ge in u)if(ge!==B&&(!E||E.indexOf(ge)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const E=[];for(const B of u)this._el.contains(B.target)&&E.push(B);return E}handleEvent(u,E){this._updatingCamera=!0;const B=u.type==="renderFrame",ge=B?void 0:u,St={needsRenderFrame:!1},_n={},Bn={},ss=u.touches?this._getMapTouches(u.touches):void 0,tl=ss?lh(this._el,ss):B?void 0:Js(this._el,u);for(const{handlerName:fh,handler:wh,allowed:Th}of this._handlers){if(!wh.isEnabled())continue;let Sh;this._blockedByActive(Bn,Th,fh)?wh.reset():wh[E||u.type]&&(Sh=wh[E||u.type](u,tl,ss),this.mergeHandlerResult(St,_n,Sh,fh,ge),Sh&&Sh.needsRenderFrame&&this._triggerRenderFrame()),(Sh||wh.isActive())&&(Bn[fh]=wh)}const il={};for(const fh in this._previousActiveHandlers)Bn[fh]||(il[fh]=ge);this._previousActiveHandlers=Bn,(Object.keys(il).length||A(St))&&(this._changes.push([St,_n,il]),this._triggerRenderFrame()),(Object.keys(Bn).length||A(St))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Qu}=St;Qu&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Qu(this._map))}mergeHandlerResult(u,E,B,ge,St){if(!B)return;o.extend(u,B);const _n={handlerName:ge,originalEvent:B.originalEvent||St};B.zoomDelta!==void 0&&(E.zoom=_n),B.panDelta!==void 0&&(E.drag=_n),B.pitchDelta!==void 0&&(E.pitch=_n),B.bearingDelta!==void 0&&(E.rotate=_n)}_applyChanges(){const u={},E={},B={};for(const[ge,St,_n]of this._changes)ge.panDelta&&(u.panDelta=(u.panDelta||new o.pointGeometry(0,0))._add(ge.panDelta)),ge.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+ge.zoomDelta),ge.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+ge.bearingDelta),ge.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+ge.pitchDelta),ge.around!==void 0&&(u.around=ge.around),ge.aroundCoord!==void 0&&(u.aroundCoord=ge.aroundCoord),ge.pinchAround!==void 0&&(u.pinchAround=ge.pinchAround),ge.noInertia&&(u.noInertia=ge.noInertia),o.extend(E,St),o.extend(B,_n);this._updateMapTransform(u,E,B),this._changes=[]}_updateMapTransform(u,E,B){const ge=this._map,St=ge.transform,_n=Oh=>[Oh.x,Oh.y,Oh.z];if((Oh=>{const Rh=this._eventsInProgress.drag;return Rh&&!this._handlersById[Rh.handlerName].isActive()})()&&!A(u)){const Oh=St.zoom;St.cameraElevationReference="sea",St.recenterOnTerrain(),St.cameraElevationReference="ground",Oh!==St.zoom&&this._map._update(!0)}if(St._isCameraConstrained&&ge._stop(!0),!A(u))return void this._fireEvents(E,B,!0);let{panDelta:Bn,zoomDelta:ss,bearingDelta:tl,pitchDelta:il,around:Qu,aroundCoord:fh,pinchAround:wh}=u;St._isCameraConstrained&&(ss>0&&(ss=0),St._isCameraConstrained=!1),wh!==void 0&&(Qu=wh),(ss||(Oh=>E.drag&&!this._eventsInProgress.drag)())&&Qu&&(this._dragOrigin=_n(St.pointCoordinate3D(Qu)),this._trackingEllipsoid.setup(St._camera.position,this._dragOrigin)),St.cameraElevationReference="sea",ge._stop(!0),Qu=Qu||ge.transform.centerPoint,tl&&(St.bearing+=tl),il&&(St.pitch+=il),St._updateCameraState();const Th=[0,0,0];if(Bn)if(St.projection.name==="mercator"){const Oh=this._trackingEllipsoid.projectRay(St.screenPointToMercatorRay(Qu).dir),Rh=this._trackingEllipsoid.projectRay(St.screenPointToMercatorRay(Qu.sub(Bn)).dir);Th[0]=Rh[0]-Oh[0],Th[1]=Rh[1]-Oh[1]}else{const Oh=St.pointCoordinate(Qu);if(St.projection.name==="globe"){Bn=Bn.rotate(-St.angle);const Rh=St._pixelsPerMercatorPixel/St.worldSize;Th[0]=-Bn.x*o.mercatorScale(o.latFromMercatorY(Oh.y))*Rh,Th[1]=-Bn.y*o.mercatorScale(St.center.lat)*Rh}else{const Rh=St.pointCoordinate(Qu.sub(Bn));Oh&&Rh&&(Th[0]=Rh.x-Oh.x,Th[1]=Rh.y-Oh.y)}}const Sh=St.zoom,Ih=[0,0,0];if(ss){const Oh=_n(fh||St.pointCoordinate3D(Qu)),Rh={dir:o.normalize([],o.sub([],Oh,St._camera.position))};if(Rh.dir[2]<0){const Nh=St.zoomDeltaToMovement(Oh,ss);o.scale$2(Ih,Rh.dir,Nh)}}const hh=o.add(Th,Th,Ih);St._translateCameraConstrained(hh),ss&&Math.abs(St.zoom-Sh)>1e-4&&St.recenterOnTerrain(),St.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(E,B,!0)}_fireEvents(u,E,B){const ge=K_(this._eventsInProgress),St=K_(u),_n={};for(const il in u){const{originalEvent:Qu}=u[il];this._eventsInProgress[il]||(_n[`${il}start`]=Qu),this._eventsInProgress[il]=u[il]}!ge&&St&&this._fireEvent("movestart",St.originalEvent);for(const il in _n)this._fireEvent(il,_n[il]);St&&this._fireEvent("move",St.originalEvent);for(const il in u){const{originalEvent:Qu}=u[il];this._fireEvent(il,Qu)}const Bn={};let ss;for(const il in this._eventsInProgress){const{handlerName:Qu,originalEvent:fh}=this._eventsInProgress[il];this._handlersById[Qu].isActive()||(delete this._eventsInProgress[il],ss=E[Qu]||fh,Bn[`${il}end`]=ss)}for(const il in Bn)this._fireEvent(il,Bn[il]);const tl=K_(this._eventsInProgress);if(B&&(ge||St)&&!tl){this._updatingCamera=!0;const il=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Qu=fh=>fh!==0&&-this._bearingSnap<fh&&fh<this._bearingSnap;il?(Qu(il.bearing||this._map.getBearing())&&(il.bearing=0),this._map.easeTo(il,{originalEvent:ss})):(this._map.fire(new o.Event("moveend",{originalEvent:ss})),Qu(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,E){this._map.fire(new o.Event(u,E?{originalEvent:E}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new Y("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ze="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ft extends o.Evented{constructor(u,E){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=E.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(u,E){return this.jumpTo({center:u},E)}panBy(u,E,B){return u=o.pointGeometry.convert(u).mult(-1),this.panTo(this.transform.center,o.extend({offset:u},E),B)}panTo(u,E,B){return this.easeTo(o.extend({center:u},E),B)}getZoom(){return this.transform.zoom}setZoom(u,E){return this.jumpTo({zoom:u},E),this}zoomTo(u,E,B){return this.easeTo(o.extend({zoom:u},E),B)}zoomIn(u,E){return this.zoomTo(this.getZoom()+1,u,E),this}zoomOut(u,E){return this.zoomTo(this.getZoom()-1,u,E),this}getBearing(){return this.transform.bearing}setBearing(u,E){return this.jumpTo({bearing:u},E),this}getPadding(){return this.transform.padding}setPadding(u,E){return this.jumpTo({padding:u},E),this}rotateTo(u,E,B){return this.easeTo(o.extend({bearing:u},E),B)}resetNorth(u,E){return this.rotateTo(0,o.extend({duration:1e3},u),E),this}resetNorthPitch(u,E){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},u),E),this}snapToNorth(u,E){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,E):this}getPitch(){return this.transform.pitch}setPitch(u,E){return this.jumpTo({pitch:u},E),this}cameraForBounds(u,E){u=o.LngLatBounds.convert(u);const B=E&&E.bearing||0,ge=E&&E.pitch||0,St=u.getNorthWest(),_n=u.getSouthEast();return this._cameraForBounds(this.transform,St,_n,B,ge,E)}_extendCameraOptions(u){const E={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const B=u.padding;u.padding={top:B,bottom:B,right:B,left:B}}return u.padding=o.extend(E,u.padding),u}_minimumAABBFrustumDistance(u,E){const B=E.max[0]-E.min[0],ge=E.max[1]-E.min[1];return B/ge>u.aspect?B/(2*Math.tan(.5*u.fovX)*u.aspect):ge/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,E,B,ge,St,_n){const Bn=u.clone(),ss=this._extendCameraOptions(_n);Bn.bearing=ge,Bn.pitch=St;const tl=o.LngLat.convert(E),il=o.LngLat.convert(B),Qu=.5*(tl.lat+il.lat),fh=.5*(tl.lng+il.lng),wh=o.latLngToECEF(Qu,fh),Th=o.normalize([],wh),Sh=o.normalize([],o.cross([],Th,[0,1,0])),Ih=o.cross([],Sh,Th),hh=[Sh[0],Sh[1],Sh[2],0,Ih[0],Ih[1],Ih[2],0,Th[0],Th[1],Th[2],0,0,0,0,1],Oh=[wh,o.latLngToECEF(tl.lat,tl.lng),o.latLngToECEF(il.lat,tl.lng),o.latLngToECEF(il.lat,il.lng),o.latLngToECEF(tl.lat,il.lng),o.latLngToECEF(Qu,tl.lng),o.latLngToECEF(Qu,il.lng),o.latLngToECEF(tl.lat,fh),o.latLngToECEF(il.lat,fh)];let Rh=o.Aabb.fromPoints(Oh.map(mf=>[o.dot(Sh,mf),o.dot(Ih,mf),o.dot(Th,mf)]));const Nh=o.transformMat4([],Rh.center,hh);o.squaredLength(Nh)===0&&o.set(Nh,0,0,1),o.normalize(Nh,Nh),o.scale$2(Nh,Nh,o.GLOBE_RADIUS),Bn.center=o.ecefToLatLng(Nh);const qh=Bn.getWorldToCameraMatrix(),$h=o.invert(new Float64Array(16),qh);Rh=o.Aabb.applyTransform(Rh,o.multiply([],qh,hh)),o.transformMat4(Nh,Nh,qh);const Hh=.5*(Rh.max[2]-Rh.min[2]),ld=this._minimumAABBFrustumDistance(Bn,Rh),xd=o.scale$2([],[0,0,1],Hh),gd=o.add(xd,Nh,xd),Vf=ld+(Bn.pitch===0?0:o.distance(Nh,gd)),_d=Bn.globeCenterInViewSpace,Mf=o.sub([],Nh,[_d[0],_d[1],_d[2]]);o.normalize(Mf,Mf),o.scale$2(Mf,Mf,Vf);const Ud=o.add([],Nh,Mf);o.transformMat4(Ud,Ud,$h);const Lf=o.earthRadius/o.GLOBE_RADIUS,Md=o.length(Ud),pd=o.mercatorZfromAltitude(Math.max(Md*Lf-o.earthRadius,Number.EPSILON),0),Bd=Math.min(Bn.zoomFromMercatorZAdjusted(pd),ss.maxZoom);return Bd>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(Bn.setProjection({name:"mercator"}),Bn.zoom=Bd,this._cameraForBounds(Bn,E,B,ge,St,_n)):{center:Bn.center,zoom:Bd,bearing:ge,pitch:St}}queryTerrainElevation(u,E){const B=this.transform.elevation;return B?(E=o.extend({},{exaggerated:!0},E),B.getAtPoint(o.MercatorCoordinate.fromLngLat(u),null,E.exaggerated)):null}_cameraForBounds(u,E,B,ge,St,_n){if(u.projection.name==="globe")return this._cameraForBoundsOnGlobe(u,E,B,ge,St,_n);const Bn=u.clone(),ss=this._extendCameraOptions(_n),tl=Bn.padding;Bn.bearing=ge,Bn.pitch=St;const il=o.LngLat.convert(E),Qu=o.LngLat.convert(B),fh=new o.LngLat(il.lng,Qu.lat),wh=new o.LngLat(Qu.lng,il.lat),Th=Bn.project(il),Sh=Bn.project(Qu),Ih=this.queryTerrainElevation(il),hh=this.queryTerrainElevation(Qu),Oh=this.queryTerrainElevation(fh),Rh=this.queryTerrainElevation(wh),Nh=[[Th.x,Th.y,Math.min(Ih||0,hh||0,Oh||0,Rh||0)],[Sh.x,Sh.y,Math.max(Ih||0,hh||0,Oh||0,Rh||0)]];let qh=o.Aabb.fromPoints(Nh);const $h=Bn.getWorldToCameraMatrix(),Hh=o.invert(new Float64Array(16),$h);qh=o.Aabb.applyTransform(qh,$h);const ld=o.sub([],qh.max,qh.min),xd=tl.left||0,gd=tl.right||0,Vf=tl.bottom||0,_d=tl.top||0,{left:Mf,right:Ud,top:Lf,bottom:Md}=ss.padding,pd=.5*(xd+gd),Bd=.5*(_d+Vf),mf=Math.min(Bn.scaleZoom(Bn.scale*Math.min((Bn.width-(xd+gd+Mf+Ud))/ld[0],(Bn.height-(Vf+_d+Md+Lf))/ld[1])),ss.maxZoom),Bf=Bn.scale/Bn.zoomScale(mf);qh=new o.Aabb([qh.min[0]-(Mf+pd)*Bf,qh.min[1]-(Md+Bd)*Bf,qh.min[2]],[qh.max[0]+(Ud+pd)*Bf,qh.max[1]+(Lf+Bd)*Bf,qh.max[2]]);const Dp=.5*ld[2],rm=this._minimumAABBFrustumDistance(Bn,qh),Mp=[0,0,1,0];o.transformMat4$1(Mp,Mp,$h),o.normalize$2(Mp,Mp);const xp=o.scale$2([],Mp,rm+Dp),Lp=o.add([],qh.center,xp),dm=(typeof ss.offset.x=="number"&&typeof ss.offset.y=="number"?new o.pointGeometry(ss.offset.x,ss.offset.y):o.pointGeometry.convert(ss.offset)).rotate(-o.degToRad(ge));qh.center[0]-=dm.x*Bf,qh.center[1]+=dm.y*Bf,o.transformMat4(qh.center,qh.center,Hh),o.transformMat4(Lp,Lp,Hh);const Fp=[qh.center[0],qh.center[1],Lp[2]*Bn.pixelsPerMeter];o.scale$2(Fp,Fp,1/Bn.worldSize);const km=o.lngFromMercatorX(Fp[0]),Am=o.latFromMercatorY(Fp[1]),jm=Math.min(Bn._zoomFromMercatorZ(Fp[2]),ss.maxZoom),Fm=new o.LngLat(km,Am);return Bn.mercatorFromTransition&&jm<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(Bn.setProjection({name:"globe"}),Bn.zoom=jm,this._cameraForBounds(Bn,E,B,ge,St,_n)):{center:Fm,zoom:jm,bearing:ge,pitch:St}}fitBounds(u,E,B){const ge=this.cameraForBounds(u,E);return this._fitInternal(ge,E,B)}fitScreenCoordinates(u,E,B,ge,St){const _n=o.pointGeometry.convert(u),Bn=o.pointGeometry.convert(E),ss=new o.pointGeometry(Math.min(_n.x,Bn.x),Math.min(_n.y,Bn.y)),tl=new o.pointGeometry(Math.max(_n.x,Bn.x),Math.max(_n.y,Bn.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_n,Bn))return this;const il=this.transform.pointLocation3D(ss),Qu=this.transform.pointLocation3D(tl),fh=this.transform.pointLocation3D(new o.pointGeometry(ss.x,tl.y)),wh=this.transform.pointLocation3D(new o.pointGeometry(tl.x,ss.y)),Th=[Math.min(il.lng,Qu.lng,fh.lng,wh.lng),Math.min(il.lat,Qu.lat,fh.lat,wh.lat)],Sh=[Math.max(il.lng,Qu.lng,fh.lng,wh.lng),Math.max(il.lat,Qu.lat,fh.lat,wh.lat)],Ih=ge&&ge.pitch?ge.pitch:this.getPitch(),hh=this._cameraForBounds(this.transform,Th,Sh,B,Ih,ge);return this._fitInternal(hh,ge,St)}_fitInternal(u,E,B){return u?(delete(E=o.extend(u,E)).padding,E.linear?this.easeTo(E,B):this.flyTo(E,B)):this}jumpTo(u,E){this.stop();const B=u.preloadOnly?this.transform.clone():this.transform;let ge=!1,St=!1,_n=!1;return"zoom"in u&&B.zoom!==+u.zoom&&(ge=!0,B.zoom=+u.zoom),u.center!==void 0&&(B.center=o.LngLat.convert(u.center)),"bearing"in u&&B.bearing!==+u.bearing&&(St=!0,B.bearing=+u.bearing),"pitch"in u&&B.pitch!==+u.pitch&&(_n=!0,B.pitch=+u.pitch),u.padding==null||B.isPaddingEqual(u.padding)||(B.padding=u.padding),u.preloadOnly?(this._preloadTiles(B),this):(this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),ge&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),St&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),_n&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(ze),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,E){const B=this.transform;if(!B.projection.supportsFreeCamera)return o.warnOnce(ze),this;this.stop();const ge=B.zoom,St=B.pitch,_n=B.bearing;B.setFreeCameraOptions(u);const Bn=ge!==B.zoom,ss=St!==B.pitch,tl=_n!==B.bearing;return this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),Bn&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),tl&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),ss&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)),this}easeTo(u,E){this._stop(!1,u.easeId),((u=o.extend({offset:[0,0],duration:500,easing:o.ease},u)).animate===!1||!u.essential&&o.exported.prefersReducedMotion)&&(u.duration=0);const B=this.transform,ge=this.getZoom(),St=this.getBearing(),_n=this.getPitch(),Bn=this.getPadding(),ss="zoom"in u?+u.zoom:ge,tl="bearing"in u?this._normalizeBearing(u.bearing,St):St,il="pitch"in u?+u.pitch:_n,Qu="padding"in u?u.padding:B.padding,fh=o.pointGeometry.convert(u.offset);let wh,Th,Sh;if(B.projection.name==="globe"){const xd=o.MercatorCoordinate.fromLngLat(B.center),gd=fh.rotate(-B.angle);xd.x+=gd.x/B.worldSize,xd.y+=gd.y/B.worldSize;const Vf=xd.toLngLat(),_d=o.LngLat.convert(u.center||Vf);this._normalizeCenter(_d),wh=B.centerPoint.add(gd),Th=new o.pointGeometry(xd.x,xd.y).mult(B.worldSize),Sh=new o.pointGeometry(o.mercatorXfromLng(_d.lng),o.mercatorYfromLat(_d.lat)).mult(B.worldSize).sub(Th)}else{wh=B.centerPoint.add(fh);const xd=B.pointLocation(wh),gd=o.LngLat.convert(u.center||xd);this._normalizeCenter(gd),Th=B.project(xd),Sh=B.project(gd).sub(Th)}const Ih=B.zoomScale(ss-ge);let hh,Oh;u.around&&(hh=o.LngLat.convert(u.around),Oh=B.locationPoint(hh));const Rh=this._zooming||ss!==ge,Nh=this._rotating||St!==tl,qh=this._pitching||il!==_n,$h=!B.isPaddingEqual(Qu),Hh=xd=>gd=>{if(Rh&&(xd.zoom=o.number(ge,ss,gd)),Nh&&(xd.bearing=o.number(St,tl,gd)),qh&&(xd.pitch=o.number(_n,il,gd)),$h&&(xd.interpolatePadding(Bn,Qu,gd),wh=xd.centerPoint.add(fh)),hh)xd.setLocationAtPoint(hh,Oh);else{const Vf=xd.zoomScale(xd.zoom-ge),_d=ss>ge?Math.min(2,Ih):Math.max(.5,Ih),Mf=Math.pow(_d,1-gd),Ud=xd.unproject(Th.add(Sh.mult(gd*Mf)).mult(Vf));xd.setLocationAtPoint(xd.renderWorldCopies?Ud.wrap():Ud,wh)}return u.preloadOnly||this._fireMoveEvents(E),xd};if(u.preloadOnly){const xd=this._emulate(Hh,u.duration,B);return this._preloadTiles(xd),this}const ld={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Rh,this._rotating=Nh,this._pitching=qh,this._padding=$h,this._easeId=u.easeId,this._prepareEase(E,u.noMoveStart,ld),this._ease(Hh(B),xd=>{B.recenterOnTerrain(),this._afterEase(E,xd)},u),this}_prepareEase(u,E,B={}){this._moving=!0,this.transform.cameraElevationReference="sea",E||B.moving||this.fire(new o.Event("movestart",u)),this._zooming&&!B.zooming&&this.fire(new o.Event("zoomstart",u)),this._rotating&&!B.rotating&&this.fire(new o.Event("rotatestart",u)),this._pitching&&!B.pitching&&this.fire(new o.Event("pitchstart",u))}_fireMoveEvents(u){this.fire(new o.Event("move",u)),this._zooming&&this.fire(new o.Event("zoom",u)),this._rotating&&this.fire(new o.Event("rotate",u)),this._pitching&&this.fire(new o.Event("pitch",u))}_afterEase(u,E){if(this._easeId&&E&&this._easeId===E)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const B=this._zooming,ge=this._rotating,St=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,B&&this.fire(new o.Event("zoomend",u)),ge&&this.fire(new o.Event("rotateend",u)),St&&this.fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u))}flyTo(u,E){if(!u.essential&&o.exported.prefersReducedMotion){const mf=o.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(mf,E)}this.stop(),u=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},u);const B=this.transform,ge=this.getZoom(),St=this.getBearing(),_n=this.getPitch(),Bn=this.getPadding(),ss="zoom"in u?o.clamp(+u.zoom,B.minZoom,B.maxZoom):ge,tl="bearing"in u?this._normalizeBearing(u.bearing,St):St,il="pitch"in u?+u.pitch:_n,Qu="padding"in u?u.padding:B.padding,fh=B.zoomScale(ss-ge),wh=o.pointGeometry.convert(u.offset);let Th=B.centerPoint.add(wh);const Sh=B.pointLocation(Th),Ih=o.LngLat.convert(u.center||Sh);this._normalizeCenter(Ih);const hh=B.project(Sh),Oh=B.project(Ih).sub(hh);let Rh=u.curve;const Nh=Math.max(B.width,B.height),qh=Nh/fh,$h=Oh.mag();if("minZoom"in u){const mf=o.clamp(Math.min(u.minZoom,ge,ss),B.minZoom,B.maxZoom),Bf=Nh/B.zoomScale(mf-ge);Rh=Math.sqrt(Bf/$h*2)}const Hh=Rh*Rh;function ld(mf){const Bf=(qh*qh-Nh*Nh+(mf?-1:1)*Hh*Hh*$h*$h)/(2*(mf?qh:Nh)*Hh*$h);return Math.log(Math.sqrt(Bf*Bf+1)-Bf)}function xd(mf){return(Math.exp(mf)-Math.exp(-mf))/2}function gd(mf){return(Math.exp(mf)+Math.exp(-mf))/2}const Vf=ld(0);let _d=function(mf){return gd(Vf)/gd(Vf+Rh*mf)},Mf=function(mf){return Nh*((gd(Vf)*(xd(Bf=Vf+Rh*mf)/gd(Bf))-xd(Vf))/Hh)/$h;var Bf},Ud=(ld(1)-Vf)/Rh;if(Math.abs($h)<1e-6||!isFinite(Ud)){if(Math.abs(Nh-qh)<1e-6)return this.easeTo(u,E);const mf=qh<Nh?-1:1;Ud=Math.abs(Math.log(qh/Nh))/Rh,Mf=function(){return 0},_d=function(Bf){return Math.exp(mf*Rh*Bf)}}u.duration="duration"in u?+u.duration:1e3*Ud/("screenSpeed"in u?+u.screenSpeed/Rh:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const Lf=St!==tl,Md=il!==_n,pd=!B.isPaddingEqual(Qu),Bd=mf=>Bf=>{const Dp=Bf*Ud,rm=1/_d(Dp);mf.zoom=Bf===1?ss:ge+mf.scaleZoom(rm),Lf&&(mf.bearing=o.number(St,tl,Bf)),Md&&(mf.pitch=o.number(_n,il,Bf)),pd&&(mf.interpolatePadding(Bn,Qu,Bf),Th=mf.centerPoint.add(wh));const Mp=Bf===1?Ih:mf.unproject(hh.add(Oh.mult(Mf(Dp))).mult(rm));return mf.setLocationAtPoint(mf.renderWorldCopies?Mp.wrap():Mp,Th),mf._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(E),mf};if(u.preloadOnly){const mf=this._emulate(Bd,u.duration,B);return this._preloadTiles(mf),this}return this._zooming=!0,this._rotating=Lf,this._pitching=Md,this._padding=pd,this._prepareEase(E,!1),this._ease(Bd(B),()=>this._afterEase(E),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,E){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const B=this._onEaseEnd;this._onEaseEnd=void 0,B.call(this,E)}if(!u){const B=this.handlers;B&&B.stop(!1)}return this}_ease(u,E,B){B.animate===!1||B.duration===0?(u(1),E()):(this._easeStart=o.exported.now(),this._easeOptions=B,this._onEaseFrame=u,this._onEaseEnd=E,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),E=this._onEaseFrame;E&&E(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,E){u=o.wrap(u,-180,180);const B=Math.abs(u-E);return Math.abs(u-360-E)<B&&(u-=360),Math.abs(u+360-E)<B&&(u+=360),u}_normalizeCenter(u){const E=this.transform;if(!E.renderWorldCopies||E.maxBounds)return;const B=u.lng-E.center.lng;u.lng+=B>180?-360:B<-180?360:0}_emulate(u,E,B){const ge=Math.ceil(15*E/1e3),St=[],_n=u(B.clone());for(let Bn=0;Bn<=ge;Bn++){const ss=_n(Bn/ge);St.push(ss.clone())}return St}}class Gn{constructor(u={}){this.options=u,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const E=this.options&&this.options.compact;return this._map=u,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=nt("button","mapboxgl-ctrl-attrib-button",this._container),nt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=nt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),E&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),E===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(u,E){const B=this._map._getUIString(`AttributionControl.${E}`);u.setAttribute("aria-label",B),u.removeAttribute("title"),u.firstElementChild&&u.firstElementChild.setAttribute("title",B)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const E=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(u){const B=E.reduce((ge,St,_n)=>(St.value&&(ge+=`${St.key}=${St.value}${_n<E.length-1?"&":""}`),ge),"?");u.href=`${o.config.FEEDBACK_URL}/${B}#${L_(this._map,!0)}`,u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}}_updateData(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const ge=this._map.style.stylesheet;this.styleOwner=ge.owner,this.styleId=ge.id}const E=this._map.style._sourceCaches;for(const ge in E){const St=E[ge];if(St.used){const _n=St.getSource();_n.attribution&&u.indexOf(_n.attribution)<0&&u.push(_n.attribution)}}u.sort((ge,St)=>ge.length-St.length),u=u.filter((ge,St)=>{for(let _n=St+1;_n<u.length;_n++)if(u[_n].indexOf(ge)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const B=u.join(" | ");B!==this._attribHTML&&(this._attribHTML=B,u.length?(this._innerContainer.innerHTML=B,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ls{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=nt("div","mapboxgl-ctrl");const E=nt("a","mapboxgl-ctrl-logo");return E.target="_blank",E.rel="noopener nofollow",E.href="https://www.mapbox.com/",E.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),E.setAttribute("rel","noopener nofollow"),this._container.appendChild(E),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(Object.entries(u).length===0)return!0;for(const E in u){const B=u[E].getSource();if(B.hasOwnProperty("mapbox_logo")&&!B.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const E=u[0];this._map.getCanvasContainer().offsetWidth<250?E.classList.add("mapboxgl-compact"):E.classList.remove("mapboxgl-compact")}}}class $s{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const E=++this._id;return this._queue.push({callback:u,id:E,cancelled:!1}),E}remove(u){const E=this._currentlyRunning,B=E?this._queue.concat(E):this._queue;for(const ge of B)if(ge.id===u)return void(ge.cancelled=!0)}run(u=0){const E=this._currentlyRunning=this._queue;this._queue=[];for(const B of E)if(!B.cancelled&&(B.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ol(L,u,E){if(L=new o.LngLat(L.lng,L.lat),u){const B=new o.LngLat(L.lng-360,L.lat),ge=new o.LngLat(L.lng+360,L.lat),St=360*Math.ceil(Math.abs(L.lng-E.center.lng)/360),_n=E.locationPoint(L).distSqr(u),Bn=u.x<0||u.y<0||u.x>E.width||u.y>E.height;E.locationPoint(B).distSqr(u)<_n&&(Bn||Math.abs(B.lng-E.center.lng)<St)?L=B:E.locationPoint(ge).distSqr(u)<_n&&(Bn||Math.abs(ge.lng-E.center.lng)<St)&&(L=ge)}for(;Math.abs(L.lng-E.center.lng)>180;){const B=E.locationPoint(L);if(B.x>=0&&B.y>=0&&B.x<=E.width&&B.y<=E.height)break;L.lng>E.center.lng?L.lng-=360:L.lng+=360}return L}const nh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ih extends o.Evented{constructor(u,E){if(super(),(u instanceof o.window.HTMLElement||E)&&(u=o.extend({element:u},E)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=u&&u.occludedOpacity||.2,u&&u.element)this._element=u.element,this._offset=o.pointGeometry.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=nt("div");const ge=41,St=27,_n=_e("svg",{display:"block",height:ge*this._scale+"px",width:St*this._scale+"px",viewBox:`0 0 ${St} ${ge}`},this._element),Bn=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},_n));_e("stop",{offset:"10%","stop-opacity":.4},Bn),_e("stop",{offset:"100%","stop-opacity":.05},Bn),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},_n),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},_n),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},_n),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},_n),this._offset=o.pointGeometry.convert(u&&u.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ge=>{ge.preventDefault()}),this._element.addEventListener("mousedown",ge=>{ge.preventDefault()});const B=this._element.classList;for(const ge in nh)B.remove(`mapboxgl-marker-anchor-${ge}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const ge=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ge,-1*(38.1-13.5+ge)],"bottom-right":[-ge,-1*(38.1-13.5+ge)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,u._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const E=u.code,B=u.charCode||u.keyCode;E!=="Space"&&E!=="Enter"&&B!==32&&B!==13||this.togglePopup()}_onMapClick(u){const E=u.originalEvent.target,B=this._element;this._popup&&(E===B||B.contains(E))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,E=this._pos;if(!u||!E)return!1;const B=u.unproject(E),ge=u.getFreeCameraOptions();if(!ge.position)return!1;const St=ge.position.toLngLat();return St.distanceTo(B)<.9*St.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const E=this._pos;if(!E||E.x<0||E.x>u.transform.width||E.y<0||E.y>u.transform.height)return void this._clearFadeTimer();const B=u.unproject(E);let ge;u._showingGlobe()&&o.isLngLatBehindGlobe(u.transform,this._lngLat)?ge=0:(ge=1-u._queryFogOpacity(B),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(ge*=this._occludedOpacity)),this._element.style.opacity=`${ge}`,this._element.style.pointerEvents=ge>0?"auto":"none",this._popup&&this._popup._setOpacity(ge),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const E=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${u.x}px,${u.y}px)
            ${nh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${E.x}px,${E.y}px)
        `}_calculateXYTransform(){const u=this._pos,E=this._map,B=this.getPitchAlignment();if(!E||!u||B!=="map")return"";if(!E._showingGlobe()){const ss=E.getPitch();return ss?`rotateX(${ss}deg)`:""}const ge=o.radToDeg(o.globeTiltAtLngLat(E.transform,this._lngLat)),St=u.sub(o.globeCenterToScreenPoint(E.transform)),_n=Math.abs(St.x)+Math.abs(St.y);if(_n===0)return"";const Bn=ge/_n;return`rotateX(${-St.y*Bn}deg) rotateY(${St.x*Bn}deg)`}_calculateZTransform(){const u=this._pos,E=this._map;if(!E||!u)return"";let B=0;const ge=this.getRotationAlignment();if(ge==="map")if(E._showingGlobe()){const St=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),_n=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(St);B=o.radToDeg(Math.atan2(_n.y,_n.x))-90}else B=-E.getBearing();else if(ge==="horizon"){const St=o.smoothstep(4,6,E.getZoom()),_n=o.globeCenterToScreenPoint(E.transform);_n.y+=St*E.transform.height;const Bn=u.sub(_n),ss=o.radToDeg(Math.atan2(Bn.y,Bn.x));B=(ss>90?ss-270:ss+90)*(1-St)}return B+=this._rotation,B?`rotateZ(${B}deg)`:""}_update(u){o.window.cancelAnimationFrame(this._updateFrameId);const E=this._map;E&&(E.transform.renderWorldCopies&&(this._lngLat=ol(this._lngLat,this._pos,E.transform)),this._pos=E.project(this._lngLat),u===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),E._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(E._showingGlobe()||E.getTerrain()||E.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=o.pointGeometry.convert(u),this._update(),this}_onMove(u){const E=this._map;if(!E)return;const B=this._pointerdownPos,ge=this._positionDelta;if(B&&ge){if(!this._isDragging){const St=this._clickTolerance||E._clickTolerance;if(u.point.dist(B)<St)return;this._isDragging=!0}this._pos=u.point.sub(ge),this._lngLat=E.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(u){const E=this._map,B=this._pos;E&&B&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(B),this._pointerdownPos=u.point,this._state="pending",E.on("mousemove",this._onMove),E.on("touchmove",this._onMove),E.once("mouseup",this._onUp),E.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const E=this._map;return E&&(u?(E.on("mousedown",this._addDragHandler),E.on("touchstart",this._addDragHandler)):(E.off("mousedown",this._addDragHandler),E.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bh(L=new o.pointGeometry(0,0),u="bottom"){if(typeof L=="number"){const E=Math.round(Math.sqrt(.5*Math.pow(L,2)));switch(u){case"top":return new o.pointGeometry(0,L);case"top-left":return new o.pointGeometry(E,E);case"top-right":return new o.pointGeometry(-E,E);case"bottom":return new o.pointGeometry(0,-L);case"bottom-left":return new o.pointGeometry(E,-E);case"bottom-right":return new o.pointGeometry(-E,-E);case"left":return new o.pointGeometry(L,0);case"right":return new o.pointGeometry(-L,0)}return new o.pointGeometry(0,0)}return L instanceof o.pointGeometry||Array.isArray(L)?o.pointGeometry.convert(L):o.pointGeometry.convert(L[u]||[0,0])}class Ch{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const E=o.easeCubicInOut((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-E)+this._end*E}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,E,B){this._start=this.getValue(E),this._end=u,this._startTime=E,this._endTime=E+B}}const Kh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ud={showCompass:!0,showZoom:!0,visualizePitch:!1};class jh{constructor(u,E,B=!1){this._clickTolerance=10,this.element=E,this.mouseRotate=new Ey({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,B&&(this.mousePitch=new lv({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),E.addEventListener("mousedown",this.mousedown),E.addEventListener("touchstart",this.touchstart,{passive:!1}),E.addEventListener("touchmove",this.touchmove),E.addEventListener("touchend",this.touchend),E.addEventListener("touchcancel",this.reset)}down(u,E){this.mouseRotate.mousedown(u,E),this.mousePitch&&this.mousePitch.mousedown(u,E),Io()}move(u,E){const B=this.map,ge=this.mouseRotate.mousemoveWindow(u,E),St=ge&&ge.bearingDelta;if(St&&B.setBearing(B.getBearing()+St),this.mousePitch){const _n=this.mousePitch.mousemoveWindow(u,E),Bn=_n&&_n.pitchDelta;Bn&&B.setPitch(B.getPitch()+Bn)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart,{passive:!1}),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){rl(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(o.extend({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),Js(this.element,u)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,Js(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lh(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){u.targetTouches.length!==1?this.reset():(this._lastPos=lh(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Sd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vd={maxWidth:100,unit:"metric"};function Wd(L,u,E){const B=Cf(u),ge=B/u,St={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[E];this._map._requestDomTask(()=>{this._container.style.width=L*ge+"px",this._container.innerHTML=`${B}&nbsp;${St}`})}function Cf(L){const u=Math.pow(10,`${Math.floor(L)}`.length-1);let E=L/u;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(B){const ge=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*ge)/ge}(E),u*E}const Of={version:o.version,supported:M,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Ft{constructor(L){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(L=o.extend({},fd,L)).minZoom!=null&&L.maxZoom!=null&&L.minZoom>L.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(L.minPitch!=null&&L.maxPitch!=null&&L.minPitch>L.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(L.minPitch!=null&&L.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(L.maxPitch!=null&&L.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(L.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(L.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pp(L.minZoom,L.maxZoom,L.minPitch,L.maxPitch,L.renderWorldCopies),L),this._interactive=L.interactive,this._minTileCacheSize=L.minTileCacheSize,this._maxTileCacheSize=L.maxTileCacheSize,this._failIfMajorPerformanceCaveat=L.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=L.preserveDrawingBuffer,this._antialias=L.antialias,this._useWebGL2=L.useWebGL2,this._trackResize=L.trackResize,this._bearingSnap=L.bearingSnap,this._refreshExpiredTiles=L.refreshExpiredTiles,this._fadeDuration=L.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=L.crossSourceCollisions,this._collectResourceTiming=L.collectResourceTiming,this._optimizeForTerrain=L.optimizeForTerrain,this._language=this._parseLanguage(L.language),this._worldview=L.worldview,this._renderTaskQueue=new $s,this._domRenderTaskQueue=new $s,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Kh,L.locale),this._clickTolerance=L.clickTolerance,this._cooperativeGestures=L.cooperativeGestures,this._performanceMetricsCollection=L.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ch(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(L.transformRequest,L.accessToken,L.testMode),this._silenceAuthErrors=!!L.testMode,typeof L.container=="string"){if(this._container=o.window.document.getElementById(L.container),!this._container)throw new Error(`Container '${L.container}' not found.`)}else{if(!(L.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=L.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),L.maxBounds&&this.setMaxBounds(L.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new q(this,L),this._localFontFamily=L.localFontFamily,this._localIdeographFontFamily=L.localIdeographFontFamily,L.style&&this.setStyle(L.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),L.projection&&this.setProjection(L.projection),this._hash=L.hash&&new wv(typeof L.hash=="string"&&L.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:L.center,zoom:L.zoom,bearing:L.bearing,pitch:L.pitch}),L.bounds&&(this.resize(),this.fitBounds(L.bounds,o.extend({},L.fitBoundsOptions,{duration:0})))),this.resize(),L.attributionControl&&this.addControl(new Gn({customAttribution:L.customAttribution})),this._logoControl=new ls,this.addControl(this._logoControl,L.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.Event(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(L,u){if(u===void 0&&(u=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const E=L.onAdd(this);this._controls.push(L);const B=this._controlPositions[u];return u.indexOf("bottom")!==-1?B.insertBefore(E,B.firstChild):B.appendChild(E),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(L);return u>-1&&this._controls.splice(u,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(L){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new o.Event("movestart",L)).fire(new o.Event("move",L)),this.fire(new o.Event("resize",L)),u&&this.fire(new o.Event("moveend",L)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(L){return this.transform.setMaxBounds(o.LngLatBounds.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(L){return L==="auto"?o.window.navigator.language:Array.isArray(L)?L.length===0?void 0:L.map(u=>u==="auto"?o.window.navigator.language:u):L}setLanguage(L){const u=this._parseLanguage(L);if(!this.style||u===this._language)return this;this._language=u,this.style._reloadSources();for(const E of this._controls)E._setLanguage&&E._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(L){return this.style&&L!==this._worldview?(this._worldview=L,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(L){return this._lazyInitEmptyStyle(),L?typeof L=="string"&&(L={name:L}):L=null,this._useExplicitProjection=!!L,this._prioritizeAndUpdateProjection(L,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const L=this.transform,u=L.projection.name;let E;u==="globe"&&L.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(L.setMercatorFromTransition(),E=!0):u==="mercator"&&L.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(L.setProjection({name:"globe"}),E=!0),E&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(L,u){return this._updateProjection(L||u||{name:"mercator"})}_updateProjection(L){let u;if(u=L.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(L),this.style.applyProjectionUpdate(),u){this.painter.clearBackgroundTiles();for(const E in this.style._sourceCaches)this.style._sourceCaches[E].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(L){return this.transform.locationPoint3D(o.LngLat.convert(L))}unproject(L){return this.transform.pointLocation3D(o.pointGeometry.convert(L))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(L,u,E){if(L==="mouseenter"||L==="mouseover"){let B=!1;const ge=_n=>{const Bn=u.filter(tl=>this.getLayer(tl)),ss=Bn.length?this.queryRenderedFeatures(_n.point,{layers:Bn}):[];ss.length?B||(B=!0,E.call(this,new Lg(L,this,_n.originalEvent,{features:ss}))):B=!1},St=()=>{B=!1};return{layers:new Set(u),listener:E,delegates:{mousemove:ge,mouseout:St}}}if(L==="mouseleave"||L==="mouseout"){let B=!1;const ge=_n=>{const Bn=u.filter(ss=>this.getLayer(ss));(Bn.length?this.queryRenderedFeatures(_n.point,{layers:Bn}):[]).length?B=!0:B&&(B=!1,E.call(this,new Lg(L,this,_n.originalEvent)))},St=_n=>{B&&(B=!1,E.call(this,new Lg(L,this,_n.originalEvent)))};return{layers:new Set(u),listener:E,delegates:{mousemove:ge,mouseout:St}}}{const B=ge=>{const St=u.filter(Bn=>this.getLayer(Bn)),_n=St.length?this.queryRenderedFeatures(ge.point,{layers:St}):[];_n.length&&(ge.features=_n,E.call(this,ge),delete ge.features)};return{layers:new Set(u),listener:E,delegates:{[L]:B}}}}on(L,u,E){if(E===void 0)return super.on(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(B);for(const ge in B.delegates)this.on(ge,B.delegates[ge]);return this}once(L,u,E){if(E===void 0)return super.once(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);for(const ge in B.delegates)this.once(ge,B.delegates[ge]);return this}off(L,u,E){if(E===void 0)return super.off(L,u);u=new Set(Array.isArray(u)?u:[u]);const B=(St,_n)=>{if(St.size!==_n.size)return!1;for(const Bn of St)if(!_n.has(Bn))return!1;return!0},ge=this._delegatedListeners?this._delegatedListeners[L]:void 0;return ge&&(St=>{for(let _n=0;_n<St.length;_n++){const Bn=St[_n];if(Bn.listener===E&&B(Bn.layers,u)){for(const ss in Bn.delegates)this.off(ss,Bn.delegates[ss]);return St.splice(_n,1),this}}})(ge),this}queryRenderedFeatures(L,u){return this.style?(u!==void 0||L===void 0||L instanceof o.pointGeometry||Array.isArray(L)||(u=L,L=void 0),this.style.queryRenderedFeatures(L=L||[[0,0],[this.transform.width,this.transform.height]],u=u||{},this.transform)):[]}querySourceFeatures(L,u){return this.style.querySourceFeatures(L,u)}setStyle(L,u){return(u=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u)).diff!==!1&&u.localIdeographFontFamily===this._localIdeographFontFamily&&u.localFontFamily===this._localFontFamily&&this.style&&L?(this._diffStyle(L,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(L,u))}_getUIString(L){const u=this._locale[L];if(u==null)throw new Error(`Missing UI string '${L}'`);return u}_updateStyle(L,u){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),L&&(this.style=new eg(this,u||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L):this.style.loadJSON(L)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new eg(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,u){if(typeof L=="string"){const E=this._requestManager.normalizeStyleURL(L),B=this._requestManager.transformRequest(E,o.ResourceType.Style);o.getJSON(B,(ge,St)=>{ge?this.fire(new o.ErrorEvent(ge)):St&&this._updateDiff(St,u)})}else typeof L=="object"&&this._updateDiff(L,u)}_updateDiff(L,u){try{this.style.setState(L)&&this._update(!0)}catch(E){o.warnOnce(`Unable to perform style diff: ${E.message||E.error||E}.  Rebuilding the style from scratch.`),this._updateStyle(L,u)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(L,u){return this._lazyInitEmptyStyle(),this.style.addSource(L,u),this._update(!0)}isSourceLoaded(L){return!!this.style&&this.style._isSourceCacheLoaded(L)}areTilesLoaded(){const L=this.style&&this.style._sourceCaches;for(const u in L){const E=L[u]._tiles;for(const B in E){const ge=E[B];if(ge.state!=="loaded"&&ge.state!=="errored")return!1}}return!0}addSourceType(L,u,E){this._lazyInitEmptyStyle(),this.style.addSourceType(L,u,E)}removeSource(L){return this.style.removeSource(L),this._updateTerrain(),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,u,{pixelRatio:E=1,sdf:B=!1,stretchX:ge,stretchY:St,content:_n}={}){if(this._lazyInitEmptyStyle(),u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap){const{width:Bn,height:ss,data:tl}=o.exported.getImageData(u);this.style.addImage(L,{data:new o.RGBAImage({width:Bn,height:ss},tl),pixelRatio:E,stretchX:ge,stretchY:St,content:_n,sdf:B,version:0})}else if(u.width===void 0||u.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:Bn,height:ss}=u,tl=u;this.style.addImage(L,{data:new o.RGBAImage({width:Bn,height:ss},new Uint8Array(tl.data)),pixelRatio:E,stretchX:ge,stretchY:St,content:_n,sdf:B,version:0,userImage:tl}),tl.onAdd&&tl.onAdd(this,L)}}updateImage(L,u){const E=this.style.getImage(L);if(!E)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const B=u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap?o.exported.getImageData(u):u,{width:ge,height:St}=B;ge!==void 0&&St!==void 0?ge===E.data.width&&St===E.data.height?(E.data.replace(B.data,!(u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap)),this.style.updateImage(L,E)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${ge}, ${St})
                must be that same as the previous version of the image
                (${E.data.width}, ${E.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L,u){o.getImage(this._requestManager.transformRequest(L,o.ResourceType.Image),(E,B)=>{u(E,B instanceof o.window.HTMLImageElement?o.exported.getImageData(B):B)})}listImages(){return this.style.listImages()}addLayer(L,u){return this._lazyInitEmptyStyle(),this.style.addLayer(L,u),this._update(!0)}moveLayer(L,u){return this.style.moveLayer(L,u),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}setLayerZoomRange(L,u,E){return this.style.setLayerZoomRange(L,u,E),this._update(!0)}setFilter(L,u,E={}){return this.style.setFilter(L,u,E),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,u,E,B={}){return this.style.setPaintProperty(L,u,E,B),this._update(!0)}getPaintProperty(L,u){return this.style.getPaintProperty(L,u)}setLayoutProperty(L,u,E,B={}){return this.style.setLayoutProperty(L,u,E,B),this._update(!0)}getLayoutProperty(L,u){return this.style.getLayoutProperty(L,u)}setLight(L,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,u),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(L){return this._lazyInitEmptyStyle(),!L&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(L),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(L){return this._lazyInitEmptyStyle(),this.style.setFog(L),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(L){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(L),this.transform):0}setFeatureState(L,u){return this.style.setFeatureState(L,u),this._update()}removeFeatureState(L,u){return this.style.removeFeatureState(L,u),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}_updateContainerDimensions(){if(!this._container)return;const L=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let E,B,ge,St=this._container;for(;St&&(!B||!ge);){const _n=o.window.getComputedStyle(St).transform;_n&&_n!=="none"&&(E=_n.match(/matrix.*\((.+)\)/)[1].split(", "),E[0]&&E[0]!=="0"&&E[0]!=="1"&&(B=E[0]),E[3]&&E[3]!=="0"&&E[3]!=="1"&&(ge=E[3])),St=St.parentElement}this._containerWidth=B?Math.abs(L/B):L,this._containerHeight=ge?Math.abs(u/ge):u}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const L=this._container;L.classList.add("mapboxgl-map"),(this._missingCSSCanary=nt("div","mapboxgl-canary",L)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=nt("div","mapboxgl-canvas-container",L);this._interactive&&u.classList.add("mapboxgl-interactive"),this._canvas=nt("canvas","mapboxgl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const E=this._controlContainer=nt("div","mapboxgl-control-container",L),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(ge=>{B[ge]=nt("div",`mapboxgl-ctrl-${ge}`,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,u){const E=o.exported.devicePixelRatio||1;this._canvas.width=E*Math.ceil(L),this._canvas.height=E*Math.ceil(u),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${u}px`}_addMarker(L){this._markers.push(L)}_removeMarker(L){const u=this._markers.indexOf(L);u!==-1&&this._markers.splice(u,1)}_addPopup(L){this._popups.push(L)}_removePopup(L){const u=this._popups.indexOf(L);u!==-1&&this._popups.splice(u,1)}_setupPainter(){const L=o.extend({},M.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._useWebGL2&&this._canvas.getContext("webgl2",L),E=u||this._canvas.getContext("webgl",L)||this._canvas.getContext("experimental-webgl",L);E?(this._useWebGL2&&!u&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(E,!0),this.painter=new Mm(E,this.transform,!!u),this.on("data",B=>{B.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(E)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(L){L.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:L}))}_contextRestored(L){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:L}))}_onMapScroll(L){if(L.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_requestDomTask(L){!this.loaded()||this.loaded()&&!this.isMoving()?L():this._domRenderTaskQueue.add(L)}_render(L){let u;const E=this.painter.context.extTimerQuery,B=o.exported.now();if(this.listens("gpu-timing-frame")&&(u=E.createQueryEXT(),E.beginQueryEXT(E.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(L),this._domRenderTaskQueue.run(L),this._removed)return;this._updateProjectionTransition();const ge=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Bn=this.transform.zoom,ss=this.transform.pitch,tl=o.exported.now(),il=new o.EvaluationParameters(Bn,{now:tl,fadeDuration:ge,pitch:ss,transition:this.style.getTransition()});this.style.update(il)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let St=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),St=this._updateAverageElevation(B),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):St=this._updateAverageElevation(B),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,ge,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ge,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const Bn=o.exported.now()-B;E.endQueryEXT(E.TIME_ELAPSED_EXT,u),setTimeout(()=>{const ss=E.getQueryObjectEXT(u,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(u),this.fire(new o.Event("gpu-timing-frame",{cpuTime:Bn,gpuTime:ss})),o.window.performance.mark("frame-gpu",{startTime:B,detail:{gpuTime:ss}})},50)}if(this.listens("gpu-timing-layer")){const Bn=this.painter.collectGpuTimers();setTimeout(()=>{const ss=this.painter.queryGpuTimers(Bn);this.fire(new o.Event("gpu-timing-layer",{layerTimes:ss}))},50)}if(this.listens("gpu-timing-deferred-render")){const Bn=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ss=this.painter.queryGpuTimeDeferredRender(Bn);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:ss}))},50)}const _n=this._sourcesDirty||this._styleDirty||this._placementDirty||St;if(_n||this._repaint)this.triggerRepaint();else{const Bn=!this.isMoving()&&this.loaded();if(Bn&&(St=this._updateAverageElevation(B,!0)),St)this.triggerRepaint();else if(this._triggerFrame(!1),Bn&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ss=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:ss})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||_n||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(L){for(const u of this._markers)L&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!L||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(L,u=!1){const E=B=>(this.transform.averageElevation=B,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&E(0);if((u||L-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(L)){const B=this.transform.averageElevation;let ge=this.transform.sampleAverageElevation(),St=!1;this.transform.elevation&&(St=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ge)?ge=0:this._averageElevationLastSampledAt=L;const _n=Math.abs(B-ge);if(_n>1){if(this._isInitialLoad||St)return this._averageElevation.jumpTo(ge),E(ge);this._averageElevation.easeTo(ge,L,300)}else if(_n>1e-4)return this._averageElevation.jumpTo(ge),E(ge)}return!!this._averageElevation.isEasing(L)&&E(this._averageElevation.getValue(L))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,L=>{if(L&&(L.message===o.AUTH_ERR_MSG||L.status===401)){const u=this.painter.context.gl;o.storeAuthState(u,!1),this._logoControl instanceof ls&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const L=this._isDragging();this.painter.updateTerrain(this.style,L)}_calculateSpeedIndex(){const L=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const E=this.painter.context.gl,B=E.createFramebuffer();function ge(St){E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,St,0);const _n=new Uint8Array(E.drawingBufferWidth*E.drawingBufferHeight*4);return E.readPixels(0,0,E.drawingBufferWidth,E.drawingBufferHeight,E.RGBA,E.UNSIGNED_BYTE,_n),_n}return E.bindFramebuffer(E.FRAMEBUFFER,B),this._canvasPixelComparison(ge(L),u.canvasCopies.map(ge),u.timeStamps)}_canvasPixelComparison(L,u,E){let B=E[1]-E[0];const ge=L.length/4;for(let St=0;St<u.length;St++){const _n=u[St];let Bn=0;for(let ss=0;ss<_n.length;ss+=4)_n[ss]===L[ss]&&_n[ss+1]===L[ss+1]&&_n[ss+2]===L[ss+2]&&_n[ss+3]===L[ss+3]&&(Bn+=1);B+=(E[St+2]-E[St+1])*(1-Bn/ge)}return B}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(L){this._renderNextFrame=this._renderNextFrame||L,this.style&&!this._frame&&(this._frame=o.exported.frame(u=>{const E=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,E&&this._render(u)}))}_preloadTiles(L){const u=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(u,(E,B)=>E._preloadTiles(L,B),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(L){this._trackResize&&this.resize({originalEvent:L})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(L){this._showTerrainWireframe!==L&&(this._showTerrainWireframe=L,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(L){this._speedIndexTiming!==L&&(this._speedIndexTiming=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(L){this._showTileAABBs!==L&&(this._showTileAABBs=L,L&&this._update())}_setCacheLimits(L,u){o.setCacheLimits(L,u)}get version(){return o.version}},NavigationControl:class{constructor(L){this.options=o.extend({},ud,L),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),nt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),nt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const E=this._map;E&&(this.options.visualizePitch?E.resetNorthPitch({},{originalEvent:u}):E.resetNorth({},{originalEvent:u}))}),this._compassIcon=nt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const L=this._map;if(!L)return;const u=L.getZoom(),E=u===L.getMaxZoom(),B=u===L.getMinZoom();this._zoomInButton.disabled=E,this._zoomOutButton.disabled=B,this._zoomInButton.setAttribute("aria-disabled",E.toString()),this._zoomOutButton.setAttribute("aria-disabled",B.toString())}_rotateCompassArrow(){const L=this._map;if(!L)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(L.transform.pitch*(Math.PI/180)),.5)}) rotateX(${L.transform.pitch}deg) rotateZ(${L.transform.angle*(180/Math.PI)}deg)`:`rotate(${L.transform.angle*(180/Math.PI)}deg)`;L._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),L.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&L.on("pitch",this._rotateCompassArrow),L.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jh(L,this._compass,this.options.visualizePitch)),this._container}onRemove(){const L=this._map;L&&(this._container.remove(),this.options.showZoom&&L.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&L.off("pitch",this._rotateCompassArrow),L.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(L,u){const E=nt("button",L,this._container);return E.type="button",E.addEventListener("click",u),E}_setButtonTitle(L,u){if(!this._map)return;const E=this._map._getUIString(`NavigationControl.${u}`);L.setAttribute("aria-label",E),L.firstElementChild&&L.firstElementChild.setAttribute("title",E)}},GeolocateControl:class extends o.Evented{constructor(L){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Sd,L),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=tg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(L){return this._map=L,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(L){const u=(E=!!this.options.geolocation)=>{this._supportsGeolocation=E,L(E)};this._supportsGeolocation!==void 0?L(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(E=>u(E.state!=="denied")).catch(()=>u()):u()}_isOutOfMapMaxBounds(L){const u=this._map.getMaxBounds(),E=L.coords;return!!u&&(E.longitude<u.getWest()||E.longitude>u.getEast()||E.latitude<u.getSouth()||E.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(L){if(this._map){if(this._isOutOfMapMaxBounds(L))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",L)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=L,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(L),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(L),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",L)),this._finish()}}_updateCamera(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude),E=L.coords.accuracy,B=this._map.getBearing(),ge=o.extend({bearing:B},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(E),ge,{geolocateSource:!0})}_updateMarker(L){if(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=L.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const L=this._map.transform,u=o.mercatorZfromAltitude(1,L._center.lat)*L.worldSize,E=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(L){if(this._map){if(this.options.trackUserLocation)if(L.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(L.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",L)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(L){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=nt("button","mapboxgl-ctrl-geolocate",this._container),nt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",L===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=nt("div","mapboxgl-user-location"),this._dotElement.appendChild(nt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(nt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ih({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=nt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ih({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(L){this._userLocationDotMarker&&(L.webkitCompassHeading?this._heading=L.webkitCompassHeading:L.absolute===!0&&(this._heading=-1*L.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(L={maximumAge:6e5,timeout:0},this._noTimeout=!0):(L=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,L),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const L=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(u=>{u==="granted"&&L()}).catch(console.error):L()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Gn,ScaleControl:class{constructor(L){this.options=o.extend({},Vd,L),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Wd.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const L=this.options.maxWidth||100,u=this._map,E=u._containerHeight/2,B=u._containerWidth/2-L/2,ge=u.unproject([B,E]),St=u.unproject([B+L,E]),_n=ge.distanceTo(St);if(this.options.unit==="imperial"){const Bn=3.2808*_n;Bn>5280?this._setScale(L,Bn/5280,"mile"):this._setScale(L,Bn,"foot")}else this.options.unit==="nautical"?this._setScale(L,_n/1852,"nautical-mile"):_n>=1e3?this._setScale(L,_n/1e3,"kilometer"):this._setScale(L,_n,"meter")}_setScale(L,u,E){const B=Cf(u),ge=B/u;this._map._requestDomTask(()=>{this._container.style.width=L*ge+"px",this._container.innerHTML=E!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:E}).format(B):`${B}&nbsp;nm`})}onAdd(L){return this._map=L,this._language=L.getLanguage(),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",L.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(L){this._language=L,this._update()}setUnit(L){this.options.unit=L,this._update()}},FullscreenControl:class{constructor(L){this._fullscreen=!1,L&&L.container&&(L.container instanceof o.window.HTMLElement?this._container=L.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const L=this._fullscreenButton=nt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);nt("span","mapboxgl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",L)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(L){super(),this.options=o.extend(Object.create(ph),L),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(L&&L.className?L.className.trim().split(/\s+/):[])}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&L.on("preclick",this._onClose),this.options.closeOnMove&&L.on("move",this._onClose),L.on("remove",this.remove),this._update(),L._addPopup(this),this._focusFirstElement(),this._trackPointer?(L.on("mousemove",this._onMouseEvent),L.on("mouseup",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")):L.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const L=this._map;return L&&(L.off("move",this._update),L.off("move",this._onClose),L.off("preclick",this._onClose),L.off("click",this._onClose),L.off("remove",this.remove),L.off("mousemove",this._onMouseEvent),L.off("mouseup",this._onMouseEvent),L.off("drag",this._onMouseEvent),L._canvasContainer&&L._canvasContainer.classList.remove("mapboxgl-track-pointer"),L._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(L){this._lngLat=o.LngLat.convert(L),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const L=this._map;return L&&(L.off("move",this._update),L.on("mousemove",this._onMouseEvent),L.on("drag",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(o.window.document.createTextNode(L))}setHTML(L){const u=o.window.document.createDocumentFragment(),E=o.window.document.createElement("body");let B;for(E.innerHTML=L;B=E.firstChild,B;)u.appendChild(B);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=nt("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(L),this.options.closeButton){const E=this._closeButton=nt("button","mapboxgl-popup-close-button",u);E.type="button",E.setAttribute("aria-label","Close popup"),E.setAttribute("aria-hidden","true"),E.innerHTML="&#215;",E.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(L){return this._classList.add(L),this._updateClassList(),this}removeClassName(L){return this._classList.delete(L),this._updateClassList(),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){let u;return this._classList.delete(L)?u=!1:(this._classList.add(L),u=!0),this._updateClassList(),u}_onMouseEvent(L){this._update(L.point)}_getAnchor(L){if(this.options.anchor)return this.options.anchor;const u=this._map,E=this._container,B=this._pos;if(!u||!E||!B)return"bottom";const ge=E.offsetWidth,St=E.offsetHeight,_n=B.x<ge/2,Bn=B.x>u.transform.width-ge/2;if(B.y+L<St)return _n?"top-left":Bn?"top-right":"top";if(B.y>u.transform.height-St){if(_n)return"bottom-left";if(Bn)return"bottom-right"}return _n?"left":Bn?"right":"bottom"}_updateClassList(){const L=this._container;if(!L)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),L.className=u.join(" ")}_update(L){const u=this._map,E=this._content;if(!u||!this._lngLat&&!this._trackPointer||!E)return;let B=this._container;if(B||(B=this._container=nt("div","mapboxgl-popup",u.getContainer()),this._tip=nt("div","mapboxgl-popup-tip",B),B.appendChild(E)),this.options.maxWidth&&B.style.maxWidth!==this.options.maxWidth&&(B.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ol(this._lngLat,this._pos,u.transform)),!this._trackPointer||L){const ge=this._pos=this._trackPointer&&L?L:u.project(this._lngLat),St=Bh(this.options.offset),_n=this._anchor=this._getAnchor(St.y),Bn=Bh(this.options.offset,_n),ss=ge.add(Bn).round();u._requestDomTask(()=>{this._container&&_n&&(this._container.style.transform=`${nh[_n]} translate(${ss.x}px,${ss.y}px)`)})}if(!this._marker&&u._showingGlobe()){const ge=o.isLngLatBehindGlobe(u.transform,this._lngLat)?0:1;this._setOpacity(ge)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(Lh);L&&L.focus()}_onClose(){this.remove()}_setOpacity(L){this._container&&(this._container.style.opacity=`${L}`),this._content&&(this._content.style.pointerEvents=L?"auto":"none")}},Marker:ih,Style:eg,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Y_,Evented:o.Evented,config:o.config,prewarm:function(){rp().acquire(Kd)},clearPrewarmedResources:function(){const L=Ff;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(Kd),Ff=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(L){o.config.ACCESS_TOKEN=L},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(L){o.config.API_URL=L},get workerCount(){return xf.workerCount},set workerCount(L){xf.workerCount=L},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(L){o.config.MAX_PARALLEL_IMAGE_REQUESTS=L},clearStorage(L){o.clearTileCache(L)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Of});var p=s;return p})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);var d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(e){var t=tile2lon(e[0]+1,e[2]),n=tile2lon(e[0],e[2]),r=tile2lat(e[1]+1,e[2]),s=tile2lat(e[1],e[2]);return[n,r,t,s]}function tileToGeoJSON(e){var t=tileToBBOX(e),n={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return n}function tile2lon(e,t){return e/Math.pow(2,t)*360-180}function tile2lat(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return r2d*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function pointToTile(e,t,n){var r=pointToTileFraction(e,t,n);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function getChildren(e){return[[e[0]*2,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2+1,e[2]+1],[e[0]*2,e[1]*2+1,e[2]+1]]}function getParent(e){return[e[0]>>1,e[1]>>1,e[2]-1]}function getSiblings(e){return getChildren(getParent(e))}function hasSiblings(e,t){for(var n=getSiblings(e),r=0;r<n.length;r++)if(!hasTile(t,n[r]))return!1;return!0}function hasTile(e,t){for(var n=0;n<e.length;n++)if(tilesEqual(e[n],t))return!0;return!1}function tilesEqual(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function tileToQuadkey(e){for(var t="",n=e[2];n>0;n--){var r=0,s=1<<n-1;e[0]&s&&r++,e[1]&s&&(r+=2),t+=r.toString()}return t}function quadkeyToTile(e){for(var t=0,n=0,r=e.length,s=r;s>0;s--){var l=1<<s-1,p=+e[r-s];p===1&&(t|=l),p===2&&(n|=l),p===3&&(t|=l,n|=l)}return[t,n,r]}function bboxToTile(e){var t=pointToTile(e[0],e[1],32),n=pointToTile(e[2],e[3],32),r=[t[0],t[1],n[0],n[1]],s=getBboxZoom(r);if(s===0)return[0,0,0];var l=r[0]>>>32-s,p=r[1]>>>32-s;return[l,p,s]}function getBboxZoom(e){for(var t=28,n=0;n<t;n++){var r=1<<32-(n+1);if((e[0]&r)!==(e[2]&r)||(e[1]&r)!==(e[3]&r))return n}return t}function pointToTileFraction(e,t,n){var r=Math.sin(t*d2r),s=Math.pow(2,n),l=s*(e/360+.5),p=s*(.5-.25*Math.log((1+r)/(1-r))/Math.PI);return l=l%s,l<0&&(l=l+s),[l,p,n]}var tilebelt={tileToGeoJSON,tileToBBOX,getChildren,getParent,getSiblings,hasTile,hasSiblings,tilesEqual,tileToQuadkey,quadkeyToTile,pointToTile,bboxToTile,pointToTileFraction};const tilebelt$1=getDefaultExportFromCjs(tilebelt);var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function point(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(e[0])||!isNumber(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return feature(r,t,n)}function polygon(e,t,n){n===void 0&&(n={});for(var r=0,s=e;r<s.length;r++){var l=s[r];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<l[l.length-1].length;p++)if(l[l.length-1][p]!==l[0][p])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return feature(o,t,n)}function radiansToLength(e,t){t===void 0&&(t="kilometers");var n=factors[t];if(!n)throw new Error(t+" units is invalid");return e*n}function lengthToRadians(e,t){t===void 0&&(t="kilometers");var n=factors[t];if(!n)throw new Error(t+" units is invalid");return e/n}function radiansToDegrees(e){var t=e%(2*Math.PI);return t*180/Math.PI}function degreesToRadians(e){var t=e%360;return t*Math.PI/180}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function geomEach(e,t){var n,r,s,l,p,o,x,M,P,he,nt=0,_e=e.type==="FeatureCollection",Bt=e.type==="Feature",Fn=_e?e.features.length:1;for(n=0;n<Fn;n++){for(o=_e?e.features[n].geometry:Bt?e.geometry:e,M=_e?e.features[n].properties:Bt?e.properties:{},P=_e?e.features[n].bbox:Bt?e.bbox:void 0,he=_e?e.features[n].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,p=x?o.geometries.length:1,s=0;s<p;s++){if(l=x?o.geometries[s]:o,l===null){if(t(null,nt,M,P,he)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,nt,M,P,he)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<l.geometries.length;r++)if(t(l.geometries[r],nt,M,P,he)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}nt++}}function geomReduce(e,t,n){var r=n;return geomEach(e,function(s,l,p,o,x){l===0&&n===void 0?r=s:r=t(r,s,l,p,o,x)}),r}function getCoord(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function distance(e,t,n){n===void 0&&(n={});var r=getCoord(e),s=getCoord(t),l=degreesToRadians(s[1]-r[1]),p=degreesToRadians(s[0]-r[0]),o=degreesToRadians(r[1]),x=degreesToRadians(s[1]),M=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(o)*Math.cos(x);return radiansToLength(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)),n.units)}function bboxPolygon(e,t){t===void 0&&(t={});var n=Number(e[0]),r=Number(e[1]),s=Number(e[2]),l=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var p=[n,r],o=[n,l],x=[s,l],M=[s,r];return polygon([[p,M,x,o,p]],t.properties,{bbox:e,id:t.id})}function destination(e,t,n,r){r===void 0&&(r={});var s=getCoord(e),l=degreesToRadians(s[0]),p=degreesToRadians(s[1]),o=degreesToRadians(n),x=lengthToRadians(t,r.units),M=Math.asin(Math.sin(p)*Math.cos(x)+Math.cos(p)*Math.sin(x)*Math.cos(o)),P=l+Math.atan2(Math.sin(o)*Math.sin(x)*Math.cos(p),Math.cos(x)-Math.sin(p)*Math.sin(M)),he=radiansToDegrees(P),nt=radiansToDegrees(M);return point([he,nt],r.properties)}function bearing(e,t,n){if(n===void 0&&(n={}),n.final===!0)return calculateFinalBearing(e,t);var r=getCoord(e),s=getCoord(t),l=degreesToRadians(r[0]),p=degreesToRadians(s[0]),o=degreesToRadians(r[1]),x=degreesToRadians(s[1]),M=Math.sin(p-l)*Math.cos(x),P=Math.cos(o)*Math.sin(x)-Math.sin(o)*Math.cos(x)*Math.cos(p-l);return radiansToDegrees(Math.atan2(M,P))}function calculateFinalBearing(e,t){var n=bearing(t,e);return n=(n+180)%360,n}function midpoint(e,t){var n=distance(e,t),r=bearing(e,t),s=destination(e,n/2,r);return s}var RADIUS=6378137;function area(e){return geomReduce(e,function(t,n){return t+calculateArea(n)},0)}function calculateArea(e){var t=0,n;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=polygonArea(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(e){var t=0;if(e&&e.length>0){t+=Math.abs(ringArea(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(ringArea(e[n]))}return t}function ringArea(e){var t,n,r,s,l,p,o,x=0,M=e.length;if(M>2){for(o=0;o<M;o++)o===M-2?(s=M-2,l=M-1,p=0):o===M-1?(s=M-1,l=0,p=1):(s=o,l=o+1,p=o+2),t=e[s],n=e[l],r=e[p],x+=(rad(r[0])-rad(t[0]))*Math.sin(rad(n[1]));x=x*RADIUS*RADIUS/2}return x}function rad(e){return e*Math.PI/180}const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,t){return e>=this.width||t>=this.height?0:this.getBit(t*this.width+e)},setBitXY(e,t){this.setBit(t*this.width+e)},clearBitXY(e,t){this.clearBit(t*this.width+e)},toggleBitXY(e,t){this.toggleBit(t*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const t in bitMethods)e.prototype[t]=bitMethods[t]}function checkProcessable(e,t={}){let{bitDepth:n,alpha:r,colorModel:s,components:l,channels:p}=t;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${n}`);if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${r}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${s}`);if(l&&(Array.isArray(l)||(l=[l]),!l.includes(this.components))){let o=`The process: ${e} can only be applied if the number of components is in: ${l}`;throw l.length===1&&l[0]===1?new TypeError(`${o}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(o)}if(p&&(Array.isArray(p)||(p=[p]),!p.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${p}`)}function createBlob(e,t){e=e||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(e,t)}catch(l){if(l.name!=="TypeError")throw l;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,s=0;s<e.length;s+=1)r.append(e[s]);return r.getBlob(t.type)}}function dataURLToBlob(e){var t=e.match(/data:([^;]+)/)[1],n=e.replace(/^[^,]+,/,""),r=binaryStringToArrayBuffer(atob(n));return createBlob([r],{type:t})}function canvasToBlob(e,t,n){return typeof e.toBlob=="function"?new Promise(function(r){e.toBlob(r,t,n)}):Promise.resolve(dataURLToBlob(e.toDataURL(t,n)))}function binaryStringToArrayBuffer(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=-1;++s<t;)r[s]=e.charCodeAt(s);return n}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(r="utf-8"){if(r!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${r}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(r,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let l=0;const p=r.length;let o=0,x=Math.max(32,p+(p>>1)+7),M=new Uint8Array(x>>3<<3);for(;l<p;){let P=r.charCodeAt(l++);if(P>=55296&&P<=56319){if(l<p){const he=r.charCodeAt(l);(he&64512)===56320&&(++l,P=((P&1023)<<10)+(he&1023)+65536)}if(P>=55296&&P<=56319)continue}if(o+4>M.length){x+=8,x*=1+l/r.length*2,x=x>>3<<3;const he=new Uint8Array(x);he.set(M),M=he}if(P&4294967168)if(!(P&4294965248))M[o++]=P>>6&31|192;else if(!(P&4294901760))M[o++]=P>>12&15|224,M[o++]=P>>6&63|128;else if(!(P&4292870144))M[o++]=P>>18&7|240,M[o++]=P>>12&63|128,M[o++]=P>>6&63|128;else continue;else{M[o++]=P;continue}M[o++]=P&63|128}return M.slice(0,o)};function n(r="utf-8",s={fatal:!1}){if(r!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${r}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1}),n.prototype.decode=function(r,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const l=new Uint8Array(r);let p=0;const o=l.length,x=[];for(;p<o;){const M=l[p++];if(M===0)break;if(!(M&128))x.push(M);else if((M&224)===192){const P=l[p++]&63;x.push((M&31)<<6|P)}else if((M&240)===224){const P=l[p++]&63,he=l[p++]&63;x.push((M&31)<<12|P<<6|he)}else if((M&248)===240){const P=l[p++]&63,he=l[p++]&63,nt=l[p++]&63;let _e=(M&7)<<18|P<<12|he<<6|nt;_e>65535&&(_e-=65536,x.push(_e>>>10&1023|55296),_e=56320|_e&1023),x.push(_e)}}return String.fromCharCode.apply(null,x)},e.TextEncoder=t,e.TextDecoder=n})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$6(e,t="utf8"){return new TextDecoder(t).decode(e)}const encoder$1=new TextEncoder;function encode$4(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class YE{constructor(t=defaultByteLength$1,n={}){let r=!1;typeof t=="number"?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const s=n.offset?n.offset>>>0:0,l=t.byteLength-s;let p=s;(ArrayBuffer.isView(t)||t instanceof YE)&&(t.byteLength!==t.buffer.byteLength&&(p=t.byteOffset+s),t=t.buffer),r?this.lastWrittenByte=l:this.lastWrittenByte=0,this.buffer=t,this.length=l,this.byteLength=l,this.byteOffset=p,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,p,l),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const r=(this.offset+t)*2,s=new Uint8Array(r);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,n){const r=typedArrays[n].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,l=this.buffer.slice(s,s+r);if(this.littleEndian===hostBigEndian&&n!=="uint8"&&n!=="int8"){const o=new Uint8Array(this.buffer.slice(s,s+r));o.reverse();const x=new typedArrays[n](o.buffer);return this.offset+=r,x.reverse(),x}const p=new typedArrays[n](l);return this.offset+=r,p}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let n="";for(let r=0;r<t;r++)n+=this.readChar();return n}readUtf8(t=1){return decode$6(this.readBytes(t))}decodeText(t=1,n="utf-8"){return decode$6(this.readBytes(t),n)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let n=0;n<t.length;n++)this._data.setUint8(this.offset++,t[n]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));return this}writeUtf8(t){return this.writeBytes(encode$4(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(IOBuffer$5);var constants$d={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$4,constants$c=constants$d,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const n=Math.floor((this.bitDepth*this.width+31)/32)*4,r=Math.ceil(this.bitDepth*this.width/8),s=n-r,l=this.bitDepth*this.width%8,p=l===0?0:8-l,o=n*this.height;let x,M,P=0,he=0,nt=8;t.mark(),M=this.readUint8();for(let _e=this.height-1;_e>=0;_e--){const Bt=_e===0;t.reset(),t.skip(_e*n);for(let Fn=0;Fn<r;Fn++){const yr=Fn===r-1;he<=p&&yr?(t.writeByte(M<<he),(p===0||p===he)&&!Bt&&(x=M,M=this.readByte())):he===0?(x=M,M=this.readUint8(),t.writeByte(x)):(x=M,M=this.readUint8(),t.writeByte(x<<he&tableLeft[he]|M>>nt)),yr&&(P+=l||0,t.skip(s),he=P%8,nt=8-he)}}n>r&&(t.reset(),t.skip(o-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const n=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$c.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(n).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$c.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$c.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$3=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1$1=4,Z_BINARY$1=0,Z_TEXT$1=1,Z_UNKNOWN$1$1=2;function zero$1$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK$1=0,STATIC_TREES$1=1,DYN_TREES$1=2,MIN_MATCH$1$1=3,MAX_MATCH$1$1=258,LENGTH_CODES$1$1=29,LITERALS$1$1=256,L_CODES$1$1=LITERALS$1$1+1+LENGTH_CODES$1$1,D_CODES$1$1=30,BL_CODES$1$1=19,HEAP_SIZE$1$1=2*L_CODES$1$1+1,MAX_BITS$1$1=15,Buf_size$1=16,MAX_BL_BITS$1=7,END_BLOCK$1=256,REP_3_6$1=16,REPZ_3_10$1=17,REPZ_11_138$1=18,extra_lbits$1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits$1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits$1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order$1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN$1=512,static_ltree$1=new Array((L_CODES$1$1+2)*2);zero$1$1(static_ltree$1);const static_dtree$1=new Array(D_CODES$1$1*2);zero$1$1(static_dtree$1);const _dist_code$1=new Array(DIST_CODE_LEN$1);zero$1$1(_dist_code$1);const _length_code$1=new Array(MAX_MATCH$1$1-MIN_MATCH$1$1+1);zero$1$1(_length_code$1);const base_length$1=new Array(LENGTH_CODES$1$1);zero$1$1(base_length$1);const base_dist$1=new Array(D_CODES$1$1);zero$1$1(base_dist$1);function StaticTreeDesc$1(e,t,n,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let static_l_desc$1,static_d_desc$1,static_bl_desc$1;function TreeDesc$1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code$1=e=>e<256?_dist_code$1[e]:_dist_code$1[256+(e>>>7)],put_short$1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits$1=(e,t,n)=>{e.bi_valid>Buf_size$1-n?(e.bi_buf|=t<<e.bi_valid&65535,put_short$1(e,e.bi_buf),e.bi_buf=t>>Buf_size$1-e.bi_valid,e.bi_valid+=n-Buf_size$1):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},send_code$1=(e,t,n)=>{send_bits$1(e,n[t*2],n[t*2+1])},bi_reverse$1=(e,t)=>{let n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1},bi_flush$1=e=>{e.bi_valid===16?(put_short$1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen$1=(e,t)=>{const n=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let M,P,he,nt,_e,Bt,Fn=0;for(nt=0;nt<=MAX_BITS$1$1;nt++)e.bl_count[nt]=0;for(n[e.heap[e.heap_max]*2+1]=0,M=e.heap_max+1;M<HEAP_SIZE$1$1;M++)P=e.heap[M],nt=n[n[P*2+1]*2+1]+1,nt>x&&(nt=x,Fn++),n[P*2+1]=nt,!(P>r)&&(e.bl_count[nt]++,_e=0,P>=o&&(_e=p[P-o]),Bt=n[P*2],e.opt_len+=Bt*(nt+_e),l&&(e.static_len+=Bt*(s[P*2+1]+_e)));if(Fn!==0){do{for(nt=x-1;e.bl_count[nt]===0;)nt--;e.bl_count[nt]--,e.bl_count[nt+1]+=2,e.bl_count[x]--,Fn-=2}while(Fn>0);for(nt=x;nt!==0;nt--)for(P=e.bl_count[nt];P!==0;)he=e.heap[--M],!(he>r)&&(n[he*2+1]!==nt&&(e.opt_len+=(nt-n[he*2+1])*n[he*2],n[he*2+1]=nt),P--)}},gen_codes$1=(e,t,n)=>{const r=new Array(MAX_BITS$1$1+1);let s=0,l,p;for(l=1;l<=MAX_BITS$1$1;l++)s=s+n[l-1]<<1,r[l]=s;for(p=0;p<=t;p++){let o=e[p*2+1];o!==0&&(e[p*2]=bi_reverse$1(r[o]++,o))}},tr_static_init$1=()=>{let e,t,n,r,s;const l=new Array(MAX_BITS$1$1+1);for(n=0,r=0;r<LENGTH_CODES$1$1-1;r++)for(base_length$1[r]=n,e=0;e<1<<extra_lbits$1[r];e++)_length_code$1[n++]=r;for(_length_code$1[n-1]=r,s=0,r=0;r<16;r++)for(base_dist$1[r]=s,e=0;e<1<<extra_dbits$1[r];e++)_dist_code$1[s++]=r;for(s>>=7;r<D_CODES$1$1;r++)for(base_dist$1[r]=s<<7,e=0;e<1<<extra_dbits$1[r]-7;e++)_dist_code$1[256+s++]=r;for(t=0;t<=MAX_BITS$1$1;t++)l[t]=0;for(e=0;e<=143;)static_ltree$1[e*2+1]=8,e++,l[8]++;for(;e<=255;)static_ltree$1[e*2+1]=9,e++,l[9]++;for(;e<=279;)static_ltree$1[e*2+1]=7,e++,l[7]++;for(;e<=287;)static_ltree$1[e*2+1]=8,e++,l[8]++;for(gen_codes$1(static_ltree$1,L_CODES$1$1+1,l),e=0;e<D_CODES$1$1;e++)static_dtree$1[e*2+1]=5,static_dtree$1[e*2]=bi_reverse$1(e,5);static_l_desc$1=new StaticTreeDesc$1(static_ltree$1,extra_lbits$1,LITERALS$1$1+1,L_CODES$1$1,MAX_BITS$1$1),static_d_desc$1=new StaticTreeDesc$1(static_dtree$1,extra_dbits$1,0,D_CODES$1$1,MAX_BITS$1$1),static_bl_desc$1=new StaticTreeDesc$1(new Array(0),extra_blbits$1,0,BL_CODES$1$1,MAX_BL_BITS$1)},init_block$1=e=>{let t;for(t=0;t<L_CODES$1$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK$1*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup$1=e=>{e.bi_valid>8?put_short$1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller$1=(e,t,n,r)=>{const s=t*2,l=n*2;return e[s]<e[l]||e[s]===e[l]&&r[t]<=r[n]},pqdownheap$1=(e,t,n)=>{const r=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&smaller$1(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!smaller$1(t,r,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=r},compress_block$1=(e,t,n)=>{let r,s,l=0,p,o;if(e.sym_next!==0)do r=e.pending_buf[e.sym_buf+l++]&255,r+=(e.pending_buf[e.sym_buf+l++]&255)<<8,s=e.pending_buf[e.sym_buf+l++],r===0?send_code$1(e,s,t):(p=_length_code$1[s],send_code$1(e,p+LITERALS$1$1+1,t),o=extra_lbits$1[p],o!==0&&(s-=base_length$1[p],send_bits$1(e,s,o)),r--,p=d_code$1(r),send_code$1(e,p,n),o=extra_dbits$1[p],o!==0&&(r-=base_dist$1[p],send_bits$1(e,r,o)));while(l<e.sym_next);send_code$1(e,END_BLOCK$1,t)},build_tree$1=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems;let p,o,x=-1,M;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1$1,p=0;p<l;p++)n[p*2]!==0?(e.heap[++e.heap_len]=x=p,e.depth[p]=0):n[p*2+1]=0;for(;e.heap_len<2;)M=e.heap[++e.heap_len]=x<2?++x:0,n[M*2]=1,e.depth[M]=0,e.opt_len--,s&&(e.static_len-=r[M*2+1]);for(t.max_code=x,p=e.heap_len>>1;p>=1;p--)pqdownheap$1(e,n,p);M=l;do p=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap$1(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=p,e.heap[--e.heap_max]=o,n[M*2]=n[p*2]+n[o*2],e.depth[M]=(e.depth[p]>=e.depth[o]?e.depth[p]:e.depth[o])+1,n[p*2+1]=n[o*2+1]=M,e.heap[1]=M++,pqdownheap$1(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen$1(e,t),gen_codes$1(n,x,e.bl_count)},scan_tree$1=(e,t,n)=>{let r,s=-1,l,p=t[0*2+1],o=0,x=7,M=4;for(p===0&&(x=138,M=3),t[(n+1)*2+1]=65535,r=0;r<=n;r++)l=p,p=t[(r+1)*2+1],!(++o<x&&l===p)&&(o<M?e.bl_tree[l*2]+=o:l!==0?(l!==s&&e.bl_tree[l*2]++,e.bl_tree[REP_3_6$1*2]++):o<=10?e.bl_tree[REPZ_3_10$1*2]++:e.bl_tree[REPZ_11_138$1*2]++,o=0,s=l,p===0?(x=138,M=3):l===p?(x=6,M=3):(x=7,M=4))},send_tree$1=(e,t,n)=>{let r,s=-1,l,p=t[0*2+1],o=0,x=7,M=4;for(p===0&&(x=138,M=3),r=0;r<=n;r++)if(l=p,p=t[(r+1)*2+1],!(++o<x&&l===p)){if(o<M)do send_code$1(e,l,e.bl_tree);while(--o!==0);else l!==0?(l!==s&&(send_code$1(e,l,e.bl_tree),o--),send_code$1(e,REP_3_6$1,e.bl_tree),send_bits$1(e,o-3,2)):o<=10?(send_code$1(e,REPZ_3_10$1,e.bl_tree),send_bits$1(e,o-3,3)):(send_code$1(e,REPZ_11_138$1,e.bl_tree),send_bits$1(e,o-11,7));o=0,s=l,p===0?(x=138,M=3):l===p?(x=6,M=3):(x=7,M=4)}},build_bl_tree$1=e=>{let t;for(scan_tree$1(e,e.dyn_ltree,e.l_desc.max_code),scan_tree$1(e,e.dyn_dtree,e.d_desc.max_code),build_tree$1(e,e.bl_desc),t=BL_CODES$1$1-1;t>=3&&e.bl_tree[bl_order$1[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees$1=(e,t,n,r)=>{let s;for(send_bits$1(e,t-257,5),send_bits$1(e,n-1,5),send_bits$1(e,r-4,4),s=0;s<r;s++)send_bits$1(e,e.bl_tree[bl_order$1[s]*2+1],3);send_tree$1(e,e.dyn_ltree,t-1),send_tree$1(e,e.dyn_dtree,n-1)},detect_data_type$1=e=>{let t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return Z_BINARY$1;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT$1;for(n=32;n<LITERALS$1$1;n++)if(e.dyn_ltree[n*2]!==0)return Z_TEXT$1;return Z_BINARY$1};let static_init_done$1=!1;const _tr_init$1$1=e=>{static_init_done$1||(tr_static_init$1(),static_init_done$1=!0),e.l_desc=new TreeDesc$1(e.dyn_ltree,static_l_desc$1),e.d_desc=new TreeDesc$1(e.dyn_dtree,static_d_desc$1),e.bl_desc=new TreeDesc$1(e.bl_tree,static_bl_desc$1),e.bi_buf=0,e.bi_valid=0,init_block$1(e)},_tr_stored_block$1$1=(e,t,n,r)=>{send_bits$1(e,(STORED_BLOCK$1<<1)+(r?1:0),3),bi_windup$1(e),put_short$1(e,n),put_short$1(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},_tr_align$1$1=e=>{send_bits$1(e,STATIC_TREES$1<<1,3),send_code$1(e,END_BLOCK$1,static_ltree$1),bi_flush$1(e)},_tr_flush_block$1$1=(e,t,n,r)=>{let s,l,p=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1$1&&(e.strm.data_type=detect_data_type$1(e)),build_tree$1(e,e.l_desc),build_tree$1(e,e.d_desc),p=build_bl_tree$1(e),s=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=s&&(s=l)):s=l=n+5,n+4<=s&&t!==-1?_tr_stored_block$1$1(e,t,n,r):e.strategy===Z_FIXED$1$1||l===s?(send_bits$1(e,(STATIC_TREES$1<<1)+(r?1:0),3),compress_block$1(e,static_ltree$1,static_dtree$1)):(send_bits$1(e,(DYN_TREES$1<<1)+(r?1:0),3),send_all_trees$1(e,e.l_desc.max_code+1,e.d_desc.max_code+1,p+1),compress_block$1(e,e.dyn_ltree,e.dyn_dtree)),init_block$1(e),r&&bi_windup$1(e)},_tr_tally$1$1=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code$1[n]+LITERALS$1$1+1)*2]++,e.dyn_dtree[d_code$1(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1$1=_tr_init$1$1,_tr_stored_block_1$1=_tr_stored_block$1$1,_tr_flush_block_1$1=_tr_flush_block$1$1,_tr_tally_1$1=_tr_tally$1$1,_tr_align_1$1=_tr_align$1$1,trees$1={_tr_init:_tr_init_1$1,_tr_stored_block:_tr_stored_block_1$1,_tr_flush_block:_tr_flush_block_1$1,_tr_tally:_tr_tally_1$1,_tr_align:_tr_align_1$1};const adler32$1=(e,t,n,r)=>{let s=e&65535|0,l=e>>>16&65535|0,p=0;for(;n!==0;){p=n>2e3?2e3:n,n-=p;do s=s+t[r++]|0,l=l+s|0;while(--p);s%=65521,l%=65521}return s|l<<16|0};var adler32_1$1=adler32$1;const makeTable$1=()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t},crcTable$2=new Uint32Array(makeTable$1()),crc32$1=(e,t,n,r)=>{const s=crcTable$2,l=r+n;e^=-1;for(let p=r;p<l;p++)e=e>>>8^s[(e^t[p])&255];return e^-1};var crc32_1$1=crc32$1,messages$1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_tr_init$2,_tr_stored_block:_tr_stored_block$2,_tr_flush_block:_tr_flush_block$2,_tr_tally:_tr_tally$2,_tr_align:_tr_align$2}=trees$1,{Z_NO_FLUSH:Z_NO_FLUSH$2$1,Z_PARTIAL_FLUSH:Z_PARTIAL_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$1$1,Z_FINISH:Z_FINISH$3$1,Z_BLOCK:Z_BLOCK$1$1,Z_OK:Z_OK$3$1,Z_STREAM_END:Z_STREAM_END$3$1,Z_STREAM_ERROR:Z_STREAM_ERROR$2$1,Z_DATA_ERROR:Z_DATA_ERROR$2$1,Z_BUF_ERROR:Z_BUF_ERROR$1$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1$1,Z_FILTERED:Z_FILTERED$1,Z_HUFFMAN_ONLY:Z_HUFFMAN_ONLY$1,Z_RLE:Z_RLE$1,Z_FIXED:Z_FIXED$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1$1,Z_UNKNOWN:Z_UNKNOWN$2,Z_DEFLATED:Z_DEFLATED$2$1}=constants$2$2,MAX_MEM_LEVEL$1=9,MAX_WBITS$1$1=15,DEF_MEM_LEVEL$1=8,LENGTH_CODES$2=29,LITERALS$2=256,L_CODES$2=LITERALS$2+1+LENGTH_CODES$2,D_CODES$2=30,BL_CODES$2=19,HEAP_SIZE$2=2*L_CODES$2+1,MAX_BITS$2=15,MIN_MATCH$2=3,MAX_MATCH$2=258,MIN_LOOKAHEAD$1=MAX_MATCH$2+MIN_MATCH$2+1,PRESET_DICT$1=32,INIT_STATE$1=42,GZIP_STATE$1=57,EXTRA_STATE$1=69,NAME_STATE$1=73,COMMENT_STATE$1=91,HCRC_STATE$1=103,BUSY_STATE$1=113,FINISH_STATE$1=666,BS_NEED_MORE$1=1,BS_BLOCK_DONE$1=2,BS_FINISH_STARTED$1=3,BS_FINISH_DONE$1=4,OS_CODE$1=3,err$1=(e,t)=>(e.msg=messages$1[t],t),rank$1=e=>e*2-(e>4?9:0),zero$2=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash$1=e=>{let t,n,r,s=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=s?n-s:0;while(--t);t=s,r=t;do n=e.prev[--r],e.prev[r]=n>=s?n-s:0;while(--t)};let HASH_ZLIB$1=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,HASH$1=HASH_ZLIB$1;const flush_pending$1=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},flush_block_only$1=(e,t)=>{_tr_flush_block$2(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending$1(e.strm)},put_byte$1=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB$1=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf$1=(e,t,n,r)=>{let s=e.avail_in;return s>r&&(s=r),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=adler32_1$1(e.adler,t,s,n):e.state.wrap===2&&(e.adler=crc32_1$1(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},longest_match$1=(e,t)=>{let n=e.max_chain_length,r=e.strstart,s,l,p=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD$1?e.strstart-(e.w_size-MIN_LOOKAHEAD$1):0,M=e.window,P=e.w_mask,he=e.prev,nt=e.strstart+MAX_MATCH$2;let _e=M[r+p-1],Bt=M[r+p];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do if(s=t,!(M[s+p]!==Bt||M[s+p-1]!==_e||M[s]!==M[r]||M[++s]!==M[r+1])){r+=2,s++;do;while(M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&r<nt);if(l=MAX_MATCH$2-(nt-r),r=nt-MAX_MATCH$2,l>p){if(e.match_start=t,p=l,l>=o)break;_e=M[r+p-1],Bt=M[r+p]}}while((t=he[t&P])>x&&--n!==0);return p<=e.lookahead?p:e.lookahead},fill_window$1=e=>{const t=e.w_size;let n,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD$1)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash$1(e),r+=t),e.strm.avail_in===0)break;if(n=read_buf$1(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=MIN_MATCH$2)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=HASH$1(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=HASH$1(e,e.ins_h,e.window[s+MIN_MATCH$2-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$2)););}while(e.lookahead<MIN_LOOKAHEAD$1&&e.strm.avail_in!==0)},deflate_stored$1=(e,t)=>{let n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r,s,l,p=0,o=e.strm.avail_in;do{if(r=65535,l=e.bi_valid+42>>3,e.strm.avail_out<l||(l=e.strm.avail_out-l,s=e.strstart-e.block_start,r>s+e.strm.avail_in&&(r=s+e.strm.avail_in),r>l&&(r=l),r<n&&(r===0&&t!==Z_FINISH$3$1||t===Z_NO_FLUSH$2$1||r!==s+e.strm.avail_in)))break;p=t===Z_FINISH$3$1&&r===s+e.strm.avail_in?1:0,_tr_stored_block$2(e,0,0,p),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,flush_pending$1(e.strm),s&&(s>r&&(s=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,r-=s),r&&(read_buf$1(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(p===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),p?BS_FINISH_DONE$1:t!==Z_NO_FLUSH$2$1&&t!==Z_FINISH$3$1&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE$1:(l=e.window_size-e.strstart,e.strm.avail_in>l&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,l+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),l>e.strm.avail_in&&(l=e.strm.avail_in),l&&(read_buf$1(e.strm,e.window,e.strstart,l),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.high_water<e.strstart&&(e.high_water=e.strstart),l=e.bi_valid+42>>3,l=e.pending_buf_size-l>65535?65535:e.pending_buf_size-l,n=l>e.w_size?e.w_size:l,s=e.strstart-e.block_start,(s>=n||(s||t===Z_FINISH$3$1)&&t!==Z_NO_FLUSH$2$1&&e.strm.avail_in===0&&s<=l)&&(r=s>l?l:s,p=t===Z_FINISH$3$1&&e.strm.avail_in===0&&r===s?1:0,_tr_stored_block$2(e,e.block_start,r,p),e.block_start+=r,flush_pending$1(e.strm)),p?BS_FINISH_STARTED$1:BS_NEED_MORE$1)},deflate_fast$1=(e,t)=>{let n,r;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,n)),e.match_length>=MIN_MATCH$2)if(r=_tr_tally$2(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$2){e.match_length--;do e.strstart++,e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+1]);else r=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_slow$1=(e,t)=>{let n,r,s;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$2-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,n),e.match_length<=5&&(e.strategy===Z_FILTERED$1||e.match_length===MIN_MATCH$2&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$2-1)),e.prev_length>=MIN_MATCH$2&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-MIN_MATCH$2,r=_tr_tally$2(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$2),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH$2-1,e.strstart++,r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}else if(e.match_available){if(r=_tr_tally$2(e,0,e.window[e.strstart-1]),r&&flush_block_only$1(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE$1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=_tr_tally$2(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_rle$1=(e,t)=>{let n,r,s,l;const p=e.window;for(;;){if(e.lookahead<=MAX_MATCH$2){if(fill_window$1(e),e.lookahead<=MAX_MATCH$2&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$2&&e.strstart>0&&(s=e.strstart-1,r=p[s],r===p[++s]&&r===p[++s]&&r===p[++s])){l=e.strstart+MAX_MATCH$2;do;while(r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&s<l);e.match_length=MAX_MATCH$2-(l-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$2?(n=_tr_tally$2(e,1,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_huff$1=(e,t)=>{let n;for(;;){if(e.lookahead===0&&(fill_window$1(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;break}if(e.match_length=0,n=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1};function Config$1(e,t,n,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=s}const configuration_table$1=[new Config$1(0,0,0,0,deflate_stored$1),new Config$1(4,4,8,4,deflate_fast$1),new Config$1(4,5,16,8,deflate_fast$1),new Config$1(4,6,32,32,deflate_fast$1),new Config$1(4,4,16,16,deflate_slow$1),new Config$1(8,16,32,32,deflate_slow$1),new Config$1(8,16,128,128,deflate_slow$1),new Config$1(8,32,128,256,deflate_slow$1),new Config$1(32,128,258,1024,deflate_slow$1),new Config$1(32,258,258,4096,deflate_slow$1)],lm_init$1=e=>{e.window_size=2*e.w_size,zero$2(e.head),e.max_lazy_match=configuration_table$1[e.level].max_lazy,e.good_match=configuration_table$1[e.level].good_length,e.nice_match=configuration_table$1[e.level].nice_length,e.max_chain_length=configuration_table$1[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$2-1,e.match_available=0,e.ins_h=0};function DeflateState$1(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2$1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE$2*2),this.dyn_dtree=new Uint16Array((2*D_CODES$2+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES$2+1)*2),zero$2(this.dyn_ltree),zero$2(this.dyn_dtree),zero$2(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS$2+1),this.heap=new Uint16Array(2*L_CODES$2+1),zero$2(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES$2+1),zero$2(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE$1&&t.status!==GZIP_STATE$1&&t.status!==EXTRA_STATE$1&&t.status!==NAME_STATE$1&&t.status!==COMMENT_STATE$1&&t.status!==HCRC_STATE$1&&t.status!==BUSY_STATE$1&&t.status!==FINISH_STATE$1?1:0},deflateResetKeep$1=e=>{if(deflateStateCheck$1(e))return err$1(e,Z_STREAM_ERROR$2$1);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$2;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE$1:t.wrap?INIT_STATE$1:BUSY_STATE$1,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init$2(t),Z_OK$3$1},deflateReset$1=e=>{const t=deflateResetKeep$1(e);return t===Z_OK$3$1&&lm_init$1(e.state),t},deflateSetHeader$1=(e,t)=>deflateStateCheck$1(e)||e.state.wrap!==2?Z_STREAM_ERROR$2$1:(e.state.gzhead=t,Z_OK$3$1),deflateInit2$1=(e,t,n,r,s,l)=>{if(!e)return Z_STREAM_ERROR$2$1;let p=1;if(t===Z_DEFAULT_COMPRESSION$1$1&&(t=6),r<0?(p=0,r=-r):r>15&&(p=2,r-=16),s<1||s>MAX_MEM_LEVEL$1||n!==Z_DEFLATED$2$1||r<8||r>15||t<0||t>9||l<0||l>Z_FIXED$2||r===8&&p!==1)return err$1(e,Z_STREAM_ERROR$2$1);r===8&&(r=9);const o=new DeflateState$1;return e.state=o,o.strm=e,o.status=INIT_STATE$1,o.wrap=p,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$2-1)/MIN_MATCH$2),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=l,o.method=n,deflateReset$1(e)},deflateInit$1=(e,t)=>deflateInit2$1(e,t,Z_DEFLATED$2$1,MAX_WBITS$1$1,DEF_MEM_LEVEL$1,Z_DEFAULT_STRATEGY$1$1),deflate$2$1=(e,t)=>{if(deflateStateCheck$1(e)||t>Z_BLOCK$1$1||t<0)return e?err$1(e,Z_STREAM_ERROR$2$1):Z_STREAM_ERROR$2$1;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===FINISH_STATE$1&&t!==Z_FINISH$3$1)return err$1(e,e.avail_out===0?Z_BUF_ERROR$1$1:Z_STREAM_ERROR$2$1);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(flush_pending$1(e),e.avail_out===0)return n.last_flush=-1,Z_OK$3$1}else if(e.avail_in===0&&rank$1(t)<=rank$1(r)&&t!==Z_FINISH$3$1)return err$1(e,Z_BUF_ERROR$1$1);if(n.status===FINISH_STATE$1&&e.avail_in!==0)return err$1(e,Z_BUF_ERROR$1$1);if(n.status===INIT_STATE$1&&n.wrap===0&&(n.status=BUSY_STATE$1),n.status===INIT_STATE$1){let s=Z_DEFLATED$2$1+(n.w_bits-8<<4)<<8,l=-1;if(n.strategy>=Z_HUFFMAN_ONLY$1||n.level<2?l=0:n.level<6?l=1:n.level===6?l=2:l=3,s|=l<<6,n.strstart!==0&&(s|=PRESET_DICT$1),s+=31-s%31,putShortMSB$1(n,s),n.strstart!==0&&(putShortMSB$1(n,e.adler>>>16),putShortMSB$1(n,e.adler&65535)),e.adler=1,n.status=BUSY_STATE$1,flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1}if(n.status===GZIP_STATE$1){if(e.adler=0,put_byte$1(n,31),put_byte$1(n,139),put_byte$1(n,8),n.gzhead)put_byte$1(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),put_byte$1(n,n.gzhead.time&255),put_byte$1(n,n.gzhead.time>>8&255),put_byte$1(n,n.gzhead.time>>16&255),put_byte$1(n,n.gzhead.time>>24&255),put_byte$1(n,n.level===9?2:n.strategy>=Z_HUFFMAN_ONLY$1||n.level<2?4:0),put_byte$1(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(put_byte$1(n,n.gzhead.extra.length&255),put_byte$1(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=EXTRA_STATE$1;else if(put_byte$1(n,0),put_byte$1(n,0),put_byte$1(n,0),put_byte$1(n,0),put_byte$1(n,0),put_byte$1(n,n.level===9?2:n.strategy>=Z_HUFFMAN_ONLY$1||n.level<2?4:0),put_byte$1(n,OS_CODE$1),n.status=BUSY_STATE$1,flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1}if(n.status===EXTRA_STATE$1){if(n.gzhead.extra){let s=n.pending,l=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let o=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=o,flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1;s=0,l-=o}let p=new Uint8Array(n.gzhead.extra);n.pending_buf.set(p.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=NAME_STATE$1}if(n.status===NAME_STATE$1){if(n.gzhead.name){let s=n.pending,l;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s)),flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1;s=0}n.gzindex<n.gzhead.name.length?l=n.gzhead.name.charCodeAt(n.gzindex++)&255:l=0,put_byte$1(n,l)}while(l!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=COMMENT_STATE$1}if(n.status===COMMENT_STATE$1){if(n.gzhead.comment){let s=n.pending,l;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s)),flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1;s=0}n.gzindex<n.gzhead.comment.length?l=n.gzhead.comment.charCodeAt(n.gzindex++)&255:l=0,put_byte$1(n,l)}while(l!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1$1(e.adler,n.pending_buf,n.pending-s,s))}n.status=HCRC_STATE$1}if(n.status===HCRC_STATE$1){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(flush_pending$1(e),n.pending!==0))return n.last_flush=-1,Z_OK$3$1;put_byte$1(n,e.adler&255),put_byte$1(n,e.adler>>8&255),e.adler=0}if(n.status=BUSY_STATE$1,flush_pending$1(e),n.pending!==0)return n.last_flush=-1,Z_OK$3$1}if(e.avail_in!==0||n.lookahead!==0||t!==Z_NO_FLUSH$2$1&&n.status!==FINISH_STATE$1){let s=n.level===0?deflate_stored$1(n,t):n.strategy===Z_HUFFMAN_ONLY$1?deflate_huff$1(n,t):n.strategy===Z_RLE$1?deflate_rle$1(n,t):configuration_table$1[n.level].func(n,t);if((s===BS_FINISH_STARTED$1||s===BS_FINISH_DONE$1)&&(n.status=FINISH_STATE$1),s===BS_NEED_MORE$1||s===BS_FINISH_STARTED$1)return e.avail_out===0&&(n.last_flush=-1),Z_OK$3$1;if(s===BS_BLOCK_DONE$1&&(t===Z_PARTIAL_FLUSH$1?_tr_align$2(n):t!==Z_BLOCK$1$1&&(_tr_stored_block$2(n,0,0,!1),t===Z_FULL_FLUSH$1$1&&(zero$2(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),flush_pending$1(e),e.avail_out===0))return n.last_flush=-1,Z_OK$3$1}return t!==Z_FINISH$3$1?Z_OK$3$1:n.wrap<=0?Z_STREAM_END$3$1:(n.wrap===2?(put_byte$1(n,e.adler&255),put_byte$1(n,e.adler>>8&255),put_byte$1(n,e.adler>>16&255),put_byte$1(n,e.adler>>24&255),put_byte$1(n,e.total_in&255),put_byte$1(n,e.total_in>>8&255),put_byte$1(n,e.total_in>>16&255),put_byte$1(n,e.total_in>>24&255)):(putShortMSB$1(n,e.adler>>>16),putShortMSB$1(n,e.adler&65535)),flush_pending$1(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Z_OK$3$1:Z_STREAM_END$3$1)},deflateEnd$1=e=>{if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const t=e.state.status;return e.state=null,t===BUSY_STATE$1?err$1(e,Z_DATA_ERROR$2$1):Z_OK$3$1},deflateSetDictionary$1=(e,t)=>{let n=t.length;if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const r=e.state,s=r.wrap;if(s===2||s===1&&r.status!==INIT_STATE$1||r.lookahead)return Z_STREAM_ERROR$2$1;if(s===1&&(e.adler=adler32_1$1(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){s===0&&(zero$2(r.head),r.strstart=0,r.block_start=0,r.insert=0);let x=new Uint8Array(r.w_size);x.set(t.subarray(n-r.w_size,n),0),t=x,n=r.w_size}const l=e.avail_in,p=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,fill_window$1(r);r.lookahead>=MIN_MATCH$2;){let x=r.strstart,M=r.lookahead-(MIN_MATCH$2-1);do r.ins_h=HASH$1(r,r.ins_h,r.window[x+MIN_MATCH$2-1]),r.prev[x&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=x,x++;while(--M);r.strstart=x,r.lookahead=MIN_MATCH$2-1,fill_window$1(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH$2-1,r.match_available=0,e.next_in=p,e.input=o,e.avail_in=l,r.wrap=s,Z_OK$3$1};var deflateInit_1$1=deflateInit$1,deflateInit2_1$1=deflateInit2$1,deflateReset_1$1=deflateReset$1,deflateResetKeep_1$1=deflateResetKeep$1,deflateSetHeader_1$1=deflateSetHeader$1,deflate_2$1$1=deflate$2$1,deflateEnd_1$1=deflateEnd$1,deflateSetDictionary_1$1=deflateSetDictionary$1,deflateInfo$1="pako deflate (from Nodeca project)",deflate_1$2$1={deflateInit:deflateInit_1$1,deflateInit2:deflateInit2_1$1,deflateReset:deflateReset_1$1,deflateResetKeep:deflateResetKeep_1$1,deflateSetHeader:deflateSetHeader_1$1,deflate:deflate_2$1$1,deflateEnd:deflateEnd_1$1,deflateSetDictionary:deflateSetDictionary_1$1,deflateInfo:deflateInfo$1};const _has$1=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign$1=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)_has$1(n,r)&&(e[r]=n[r])}}return e},flattenChunks$1=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,s=0,l=e.length;r<l;r++){let p=e[r];n.set(p,s),s+=p.length}return n},common$1={assign:assign$1,flattenChunks:flattenChunks$1};let STR_APPLY_UIA_OK$1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK$1=!1}const _utf8len$1=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len$1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len$1[254]=_utf8len$1[254]=1;var string2buf$1=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,s,l,p=e.length,o=0;for(s=0;s<p;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<p&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),l=0,s=0;l<o;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<p&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|n&63):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|n&63):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|n&63);return t};const buf2binstring$1=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK$1)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n};var buf2string$1=(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,s;const l=new Array(n*2);for(s=0,r=0;r<n;){let p=e[r++];if(p<128){l[s++]=p;continue}let o=_utf8len$1[p];if(o>4){l[s++]=65533,r+=o-1;continue}for(p&=o===2?31:o===3?15:7;o>1&&r<n;)p=p<<6|e[r++]&63,o--;if(o>1){l[s++]=65533;continue}p<65536?l[s++]=p:(p-=65536,l[s++]=55296|p>>10&1023,l[s++]=56320|p&1023)}return buf2binstring$1(l,s)},utf8border$1=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(e[n]&192)===128;)n--;return n<0||n===0?t:n+_utf8len$1[e[n]]>t?n:t},strings$1={string2buf:string2buf$1,buf2string:buf2string$1,utf8border:utf8border$1};function ZStream$1(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream$1=ZStream$1;const toString$1$2=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1$1,Z_SYNC_FLUSH:Z_SYNC_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$2,Z_FINISH:Z_FINISH$2$1,Z_OK:Z_OK$2$1,Z_STREAM_END:Z_STREAM_END$2$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$2,Z_DEFLATED:Z_DEFLATED$1$1}=constants$2$2;function Deflate$1$1(e){this.options=common$1.assign({level:Z_DEFAULT_COMPRESSION$2,method:Z_DEFLATED$1$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$2},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let n=deflate_1$2$1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Z_OK$2$1)throw new Error(messages$1[n]);if(t.header&&deflate_1$2$1.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(typeof t.dictionary=="string"?r=strings$1.string2buf(t.dictionary):toString$1$2.call(t.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(t.dictionary):r=t.dictionary,n=deflate_1$2$1.deflateSetDictionary(this.strm,r),n!==Z_OK$2$1)throw new Error(messages$1[n]);this._dict_set=!0}}Deflate$1$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let s,l;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?Z_FINISH$2$1:Z_NO_FLUSH$1$1,typeof e=="string"?n.input=strings$1.string2buf(e):toString$1$2.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(l===Z_SYNC_FLUSH$1||l===Z_FULL_FLUSH$2)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(s=deflate_1$2$1.deflate(n,l),s===Z_STREAM_END$2$1)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=deflate_1$2$1.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Z_OK$2$1;if(n.avail_out===0){this.onData(n.output);continue}if(l>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};Deflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1$1.prototype.onEnd=function(e){e===Z_OK$2$1&&(this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,t){const n=new Deflate$1$1(t);if(n.push(e,!0),n.err)throw n.msg||messages$1[n.err];return n.result}function deflateRaw$1(e,t){return t=t||{},t.raw=!0,deflate$1(e,t)}function gzip$1(e,t){return t=t||{},t.gzip=!0,deflate$1(e,t)}var Deflate_1$1=Deflate$1$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1$1=16209,TYPE$1$1=16191;var inffast$1=function(t,n){let r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr,Io,rl,Co,as,Js,lh,ch,Zu,th,sl;const sh=t.state;r=t.next_in,th=t.input,s=r+(t.avail_in-5),l=t.next_out,sl=t.output,p=l-(n-t.avail_out),o=l+(t.avail_out-257),x=sh.dmax,M=sh.wsize,P=sh.whave,he=sh.wnext,nt=sh.window,_e=sh.hold,Bt=sh.bits,Fn=sh.lencode,yr=sh.distcode,Io=(1<<sh.lenbits)-1,rl=(1<<sh.distbits)-1;e:do{Bt<15&&(_e+=th[r++]<<Bt,Bt+=8,_e+=th[r++]<<Bt,Bt+=8),Co=Fn[_e&Io];t:for(;;){if(as=Co>>>24,_e>>>=as,Bt-=as,as=Co>>>16&255,as===0)sl[l++]=Co&65535;else if(as&16){Js=Co&65535,as&=15,as&&(Bt<as&&(_e+=th[r++]<<Bt,Bt+=8),Js+=_e&(1<<as)-1,_e>>>=as,Bt-=as),Bt<15&&(_e+=th[r++]<<Bt,Bt+=8,_e+=th[r++]<<Bt,Bt+=8),Co=yr[_e&rl];i:for(;;){if(as=Co>>>24,_e>>>=as,Bt-=as,as=Co>>>16&255,as&16){if(lh=Co&65535,as&=15,Bt<as&&(_e+=th[r++]<<Bt,Bt+=8,Bt<as&&(_e+=th[r++]<<Bt,Bt+=8)),lh+=_e&(1<<as)-1,lh>x){t.msg="invalid distance too far back",sh.mode=BAD$1$1;break e}if(_e>>>=as,Bt-=as,as=l-p,lh>as){if(as=lh-as,as>P&&sh.sane){t.msg="invalid distance too far back",sh.mode=BAD$1$1;break e}if(ch=0,Zu=nt,he===0){if(ch+=M-as,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}}else if(he<as){if(ch+=M+he-as,as-=he,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);if(ch=0,he<Js){as=he,Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}}}else if(ch+=he-as,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}for(;Js>2;)sl[l++]=Zu[ch++],sl[l++]=Zu[ch++],sl[l++]=Zu[ch++],Js-=3;Js&&(sl[l++]=Zu[ch++],Js>1&&(sl[l++]=Zu[ch++]))}else{ch=l-lh;do sl[l++]=sl[ch++],sl[l++]=sl[ch++],sl[l++]=sl[ch++],Js-=3;while(Js>2);Js&&(sl[l++]=sl[ch++],Js>1&&(sl[l++]=sl[ch++]))}}else if(as&64){t.msg="invalid distance code",sh.mode=BAD$1$1;break e}else{Co=yr[(Co&65535)+(_e&(1<<as)-1)];continue i}break}}else if(as&64)if(as&32){sh.mode=TYPE$1$1;break e}else{t.msg="invalid literal/length code",sh.mode=BAD$1$1;break e}else{Co=Fn[(Co&65535)+(_e&(1<<as)-1)];continue t}break}}while(r<s&&l<o);Js=Bt>>3,r-=Js,Bt-=Js<<3,_e&=(1<<Bt)-1,t.next_in=r,t.next_out=l,t.avail_in=r<s?5+(s-r):5-(r-s),t.avail_out=l<o?257+(o-l):257-(l-o),sh.hold=_e,sh.bits=Bt};const MAXBITS$1=15,ENOUGH_LENS$1$1=852,ENOUGH_DISTS$1$1=592,CODES$1$1=0,LENS$1$1=1,DISTS$1$1=2,lbase$1=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext$1=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase$1=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext$1=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(e,t,n,r,s,l,p,o)=>{const x=o.bits;let M=0,P=0,he=0,nt=0,_e=0,Bt=0,Fn=0,yr=0,Io=0,rl=0,Co,as,Js,lh,ch,Zu=null,th;const sl=new Uint16Array(MAXBITS$1+1),sh=new Uint16Array(MAXBITS$1+1);let xh=null,Mh,Dh,Uh;for(M=0;M<=MAXBITS$1;M++)sl[M]=0;for(P=0;P<r;P++)sl[t[n+P]]++;for(_e=x,nt=MAXBITS$1;nt>=1&&sl[nt]===0;nt--);if(_e>nt&&(_e=nt),nt===0)return s[l++]=1<<24|64<<16|0,s[l++]=1<<24|64<<16|0,o.bits=1,0;for(he=1;he<nt&&sl[he]===0;he++);for(_e<he&&(_e=he),yr=1,M=1;M<=MAXBITS$1;M++)if(yr<<=1,yr-=sl[M],yr<0)return-1;if(yr>0&&(e===CODES$1$1||nt!==1))return-1;for(sh[1]=0,M=1;M<MAXBITS$1;M++)sh[M+1]=sh[M]+sl[M];for(P=0;P<r;P++)t[n+P]!==0&&(p[sh[t[n+P]]++]=P);if(e===CODES$1$1?(Zu=xh=p,th=20):e===LENS$1$1?(Zu=lbase$1,xh=lext$1,th=257):(Zu=dbase$1,xh=dext$1,th=0),rl=0,P=0,M=he,ch=l,Bt=_e,Fn=0,Js=-1,Io=1<<_e,lh=Io-1,e===LENS$1$1&&Io>ENOUGH_LENS$1$1||e===DISTS$1$1&&Io>ENOUGH_DISTS$1$1)return 1;for(;;){Mh=M-Fn,p[P]+1<th?(Dh=0,Uh=p[P]):p[P]>=th?(Dh=xh[p[P]-th],Uh=Zu[p[P]-th]):(Dh=32+64,Uh=0),Co=1<<M-Fn,as=1<<Bt,he=as;do as-=Co,s[ch+(rl>>Fn)+as]=Mh<<24|Dh<<16|Uh|0;while(as!==0);for(Co=1<<M-1;rl&Co;)Co>>=1;if(Co!==0?(rl&=Co-1,rl+=Co):rl=0,P++,--sl[M]===0){if(M===nt)break;M=t[n+p[P]]}if(M>_e&&(rl&lh)!==Js){for(Fn===0&&(Fn=_e),ch+=he,Bt=M-Fn,yr=1<<Bt;Bt+Fn<nt&&(yr-=sl[Bt+Fn],!(yr<=0));)Bt++,yr<<=1;if(Io+=1<<Bt,e===LENS$1$1&&Io>ENOUGH_LENS$1$1||e===DISTS$1$1&&Io>ENOUGH_DISTS$1$1)return 1;Js=rl&lh,s[Js]=_e<<24|Bt<<16|ch-l|0}}return rl!==0&&(s[ch+rl]=M-Fn<<24|64<<16|0),o.bits=_e,0};var inftrees$1=inflate_table$1;const CODES$2=0,LENS$2=1,DISTS$2=2,{Z_FINISH:Z_FINISH$1$1,Z_BLOCK:Z_BLOCK$2,Z_TREES:Z_TREES$1,Z_OK:Z_OK$1$1,Z_STREAM_END:Z_STREAM_END$1$1,Z_NEED_DICT:Z_NEED_DICT$1$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1$1,Z_DATA_ERROR:Z_DATA_ERROR$1$1,Z_MEM_ERROR:Z_MEM_ERROR$1$1,Z_BUF_ERROR:Z_BUF_ERROR$2,Z_DEFLATED:Z_DEFLATED$3}=constants$2$2,HEAD$1=16180,FLAGS$1=16181,TIME$1=16182,OS$1=16183,EXLEN$1=16184,EXTRA$1=16185,NAME$1=16186,COMMENT$1=16187,HCRC$1=16188,DICTID$1=16189,DICT$1=16190,TYPE$2=16191,TYPEDO$1=16192,STORED$1=16193,COPY_$1=16194,COPY$1=16195,TABLE$1=16196,LENLENS$1=16197,CODELENS$1=16198,LEN_$1=16199,LEN$1=16200,LENEXT$1=16201,DIST$1=16202,DISTEXT$1=16203,MATCH$1=16204,LIT$1=16205,CHECK$1=16206,LENGTH$1=16207,DONE$1=16208,BAD$2=16209,MEM$1=16210,SYNC$1=16211,ENOUGH_LENS$2=852,ENOUGH_DISTS$2=592,MAX_WBITS$2=15,DEF_WBITS$1=MAX_WBITS$2,zswap32$1=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState$1(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD$1||t.mode>SYNC$1?1:0},inflateResetKeep$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD$1,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS$2),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS$2),t.sane=1,t.back=-1,Z_OK$1$1},inflateReset$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep$1(e)},inflateReset2$1=(e,t)=>{let n;if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const r=e.state;return t<0?(n=0,t=-t):(n=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1$1:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,inflateReset$1(e))},inflateInit2$1=(e,t)=>{if(!e)return Z_STREAM_ERROR$1$1;const n=new InflateState$1;e.state=n,n.strm=e,n.window=null,n.mode=HEAD$1;const r=inflateReset2$1(e,t);return r!==Z_OK$1$1&&(e.state=null),r},inflateInit$1=e=>inflateInit2$1(e,DEF_WBITS$1);let virgin$1=!0,lenfix$1,distfix$1;const fixedtables$1=e=>{if(virgin$1){lenfix$1=new Int32Array(512),distfix$1=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees$1(LENS$2,e.lens,0,288,lenfix$1,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees$1(DISTS$2,e.lens,0,32,distfix$1,0,e.work,{bits:5}),virgin$1=!1}e.lencode=lenfix$1,e.lenbits=9,e.distcode=distfix$1,e.distbits=5},updatewindow$1=(e,t,n,r)=>{let s;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(s=l.wsize-l.wnext,s>r&&(s=r),l.window.set(t.subarray(n-r,n-r+s),l.wnext),r-=s,r?(l.window.set(t.subarray(n-r,n),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=s,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=s))),0},inflate$2$1=(e,t)=>{let n,r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr=0,Io,rl,Co,as,Js,lh,ch,Zu;const th=new Uint8Array(4);let sl,sh;const xh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck$1(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1$1;n=e.state,n.mode===TYPE$2&&(n.mode=TYPEDO$1),p=e.next_out,s=e.output,x=e.avail_out,l=e.next_in,r=e.input,o=e.avail_in,M=n.hold,P=n.bits,he=o,nt=x,Zu=Z_OK$1$1;e:for(;;)switch(n.mode){case HEAD$1:if(n.wrap===0){n.mode=TYPEDO$1;break}for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&2&&M===35615){n.wbits===0&&(n.wbits=15),n.check=0,th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1$1(n.check,th,2,0),M=0,P=0,n.mode=FLAGS$1;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((M&255)<<8)+(M>>8))%31){e.msg="incorrect header check",n.mode=BAD$2;break}if((M&15)!==Z_DEFLATED$3){e.msg="unknown compression method",n.mode=BAD$2;break}if(M>>>=4,P-=4,ch=(M&15)+8,n.wbits===0&&(n.wbits=ch),ch>15||ch>n.wbits){e.msg="invalid window size",n.mode=BAD$2;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=M&512?DICTID$1:TYPE$2,M=0,P=0;break;case FLAGS$1:for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.flags=M,(n.flags&255)!==Z_DEFLATED$3){e.msg="unknown compression method",n.mode=BAD$2;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=BAD$2;break}n.head&&(n.head.text=M>>8&1),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1$1(n.check,th,2,0)),M=0,P=0,n.mode=TIME$1;case TIME$1:for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.head&&(n.head.time=M),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,th[2]=M>>>16&255,th[3]=M>>>24&255,n.check=crc32_1$1(n.check,th,4,0)),M=0,P=0,n.mode=OS$1;case OS$1:for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.head&&(n.head.xflags=M&255,n.head.os=M>>8),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1$1(n.check,th,2,0)),M=0,P=0,n.mode=EXLEN$1;case EXLEN$1:if(n.flags&1024){for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.length=M,n.head&&(n.head.extra_len=M),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1$1(n.check,th,2,0)),M=0,P=0}else n.head&&(n.head.extra=null);n.mode=EXTRA$1;case EXTRA$1:if(n.flags&1024&&(_e=n.length,_e>o&&(_e=o),_e&&(n.head&&(ch=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(l,l+_e),ch)),n.flags&512&&n.wrap&4&&(n.check=crc32_1$1(n.check,r,_e,l)),o-=_e,l+=_e,n.length-=_e),n.length))break e;n.length=0,n.mode=NAME$1;case NAME$1:if(n.flags&2048){if(o===0)break e;_e=0;do ch=r[l+_e++],n.head&&ch&&n.length<65536&&(n.head.name+=String.fromCharCode(ch));while(ch&&_e<o);if(n.flags&512&&n.wrap&4&&(n.check=crc32_1$1(n.check,r,_e,l)),o-=_e,l+=_e,ch)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=COMMENT$1;case COMMENT$1:if(n.flags&4096){if(o===0)break e;_e=0;do ch=r[l+_e++],n.head&&ch&&n.length<65536&&(n.head.comment+=String.fromCharCode(ch));while(ch&&_e<o);if(n.flags&512&&n.wrap&4&&(n.check=crc32_1$1(n.check,r,_e,l)),o-=_e,l+=_e,ch)break e}else n.head&&(n.head.comment=null);n.mode=HCRC$1;case HCRC$1:if(n.flags&512){for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&4&&M!==(n.check&65535)){e.msg="header crc mismatch",n.mode=BAD$2;break}M=0,P=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=TYPE$2;break;case DICTID$1:for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}e.adler=n.check=zswap32$1(M),M=0,P=0,n.mode=DICT$1;case DICT$1:if(n.havedict===0)return e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,Z_NEED_DICT$1$1;e.adler=n.check=1,n.mode=TYPE$2;case TYPE$2:if(t===Z_BLOCK$2||t===Z_TREES$1)break e;case TYPEDO$1:if(n.last){M>>>=P&7,P-=P&7,n.mode=CHECK$1;break}for(;P<3;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}switch(n.last=M&1,M>>>=1,P-=1,M&3){case 0:n.mode=STORED$1;break;case 1:if(fixedtables$1(n),n.mode=LEN_$1,t===Z_TREES$1){M>>>=2,P-=2;break e}break;case 2:n.mode=TABLE$1;break;case 3:e.msg="invalid block type",n.mode=BAD$2}M>>>=2,P-=2;break;case STORED$1:for(M>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if((M&65535)!==(M>>>16^65535)){e.msg="invalid stored block lengths",n.mode=BAD$2;break}if(n.length=M&65535,M=0,P=0,n.mode=COPY_$1,t===Z_TREES$1)break e;case COPY_$1:n.mode=COPY$1;case COPY$1:if(_e=n.length,_e){if(_e>o&&(_e=o),_e>x&&(_e=x),_e===0)break e;s.set(r.subarray(l,l+_e),p),o-=_e,l+=_e,x-=_e,p+=_e,n.length-=_e;break}n.mode=TYPE$2;break;case TABLE$1:for(;P<14;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.nlen=(M&31)+257,M>>>=5,P-=5,n.ndist=(M&31)+1,M>>>=5,P-=5,n.ncode=(M&15)+4,M>>>=4,P-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=BAD$2;break}n.have=0,n.mode=LENLENS$1;case LENLENS$1:for(;n.have<n.ncode;){for(;P<3;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.lens[xh[n.have++]]=M&7,M>>>=3,P-=3}for(;n.have<19;)n.lens[xh[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,sl={bits:n.lenbits},Zu=inftrees$1(CODES$2,n.lens,0,19,n.lencode,0,n.work,sl),n.lenbits=sl.bits,Zu){e.msg="invalid code lengths set",n.mode=BAD$2;break}n.have=0,n.mode=CODELENS$1;case CODELENS$1:for(;n.have<n.nlen+n.ndist;){for(;yr=n.lencode[M&(1<<n.lenbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(Co<16)M>>>=Io,P-=Io,n.lens[n.have++]=Co;else{if(Co===16){for(sh=Io+2;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(M>>>=Io,P-=Io,n.have===0){e.msg="invalid bit length repeat",n.mode=BAD$2;break}ch=n.lens[n.have-1],_e=3+(M&3),M>>>=2,P-=2}else if(Co===17){for(sh=Io+3;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=Io,P-=Io,ch=0,_e=3+(M&7),M>>>=3,P-=3}else{for(sh=Io+7;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=Io,P-=Io,ch=0,_e=11+(M&127),M>>>=7,P-=7}if(n.have+_e>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=BAD$2;break}for(;_e--;)n.lens[n.have++]=ch}}if(n.mode===BAD$2)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=BAD$2;break}if(n.lenbits=9,sl={bits:n.lenbits},Zu=inftrees$1(LENS$2,n.lens,0,n.nlen,n.lencode,0,n.work,sl),n.lenbits=sl.bits,Zu){e.msg="invalid literal/lengths set",n.mode=BAD$2;break}if(n.distbits=6,n.distcode=n.distdyn,sl={bits:n.distbits},Zu=inftrees$1(DISTS$2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,sl),n.distbits=sl.bits,Zu){e.msg="invalid distances set",n.mode=BAD$2;break}if(n.mode=LEN_$1,t===Z_TREES$1)break e;case LEN_$1:n.mode=LEN$1;case LEN$1:if(o>=6&&x>=258){e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,inffast$1(e,nt),p=e.next_out,s=e.output,x=e.avail_out,l=e.next_in,r=e.input,o=e.avail_in,M=n.hold,P=n.bits,n.mode===TYPE$2&&(n.back=-1);break}for(n.back=0;yr=n.lencode[M&(1<<n.lenbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(rl&&!(rl&240)){for(as=Io,Js=rl,lh=Co;yr=n.lencode[lh+((M&(1<<as+Js)-1)>>as)],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(as+Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=as,P-=as,n.back+=as}if(M>>>=Io,P-=Io,n.back+=Io,n.length=Co,rl===0){n.mode=LIT$1;break}if(rl&32){n.back=-1,n.mode=TYPE$2;break}if(rl&64){e.msg="invalid literal/length code",n.mode=BAD$2;break}n.extra=rl&15,n.mode=LENEXT$1;case LENEXT$1:if(n.extra){for(sh=n.extra;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.length+=M&(1<<n.extra)-1,M>>>=n.extra,P-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=DIST$1;case DIST$1:for(;yr=n.distcode[M&(1<<n.distbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(!(rl&240)){for(as=Io,Js=rl,lh=Co;yr=n.distcode[lh+((M&(1<<as+Js)-1)>>as)],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(as+Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=as,P-=as,n.back+=as}if(M>>>=Io,P-=Io,n.back+=Io,rl&64){e.msg="invalid distance code",n.mode=BAD$2;break}n.offset=Co,n.extra=rl&15,n.mode=DISTEXT$1;case DISTEXT$1:if(n.extra){for(sh=n.extra;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.offset+=M&(1<<n.extra)-1,M>>>=n.extra,P-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=BAD$2;break}n.mode=MATCH$1;case MATCH$1:if(x===0)break e;if(_e=nt-x,n.offset>_e){if(_e=n.offset-_e,_e>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=BAD$2;break}_e>n.wnext?(_e-=n.wnext,Bt=n.wsize-_e):Bt=n.wnext-_e,_e>n.length&&(_e=n.length),Fn=n.window}else Fn=s,Bt=p-n.offset,_e=n.length;_e>x&&(_e=x),x-=_e,n.length-=_e;do s[p++]=Fn[Bt++];while(--_e);n.length===0&&(n.mode=LEN$1);break;case LIT$1:if(x===0)break e;s[p++]=n.length,x--,n.mode=LEN$1;break;case CHECK$1:if(n.wrap){for(;P<32;){if(o===0)break e;o--,M|=r[l++]<<P,P+=8}if(nt-=x,e.total_out+=nt,n.total+=nt,n.wrap&4&&nt&&(e.adler=n.check=n.flags?crc32_1$1(n.check,s,nt,p-nt):adler32_1$1(n.check,s,nt,p-nt)),nt=x,n.wrap&4&&(n.flags?M:zswap32$1(M))!==n.check){e.msg="incorrect data check",n.mode=BAD$2;break}M=0,P=0}n.mode=LENGTH$1;case LENGTH$1:if(n.wrap&&n.flags){for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&4&&M!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=BAD$2;break}M=0,P=0}n.mode=DONE$1;case DONE$1:Zu=Z_STREAM_END$1$1;break e;case BAD$2:Zu=Z_DATA_ERROR$1$1;break e;case MEM$1:return Z_MEM_ERROR$1$1;case SYNC$1:default:return Z_STREAM_ERROR$1$1}return e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,(n.wsize||nt!==e.avail_out&&n.mode<BAD$2&&(n.mode<CHECK$1||t!==Z_FINISH$1$1))&&updatewindow$1(e,e.output,e.next_out,nt-e.avail_out),he-=e.avail_in,nt-=e.avail_out,e.total_in+=he,e.total_out+=nt,n.total+=nt,n.wrap&4&&nt&&(e.adler=n.check=n.flags?crc32_1$1(n.check,s,nt,e.next_out-nt):adler32_1$1(n.check,s,nt,e.next_out-nt)),e.data_type=n.bits+(n.last?64:0)+(n.mode===TYPE$2?128:0)+(n.mode===LEN_$1||n.mode===COPY_$1?256:0),(he===0&&nt===0||t===Z_FINISH$1$1)&&Zu===Z_OK$1$1&&(Zu=Z_BUF_ERROR$2),Zu},inflateEnd$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1$1},inflateGetHeader$1=(e,t)=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const n=e.state;return n.wrap&2?(n.head=t,t.done=!1,Z_OK$1$1):Z_STREAM_ERROR$1$1},inflateSetDictionary$1=(e,t)=>{const n=t.length;let r,s,l;return inflateStateCheck$1(e)||(r=e.state,r.wrap!==0&&r.mode!==DICT$1)?Z_STREAM_ERROR$1$1:r.mode===DICT$1&&(s=1,s=adler32_1$1(s,t,n,0),s!==r.check)?Z_DATA_ERROR$1$1:(l=updatewindow$1(e,t,n,n),l?(r.mode=MEM$1,Z_MEM_ERROR$1$1):(r.havedict=1,Z_OK$1$1))};var inflateReset_1$1=inflateReset$1,inflateReset2_1$1=inflateReset2$1,inflateResetKeep_1$1=inflateResetKeep$1,inflateInit_1$1=inflateInit$1,inflateInit2_1$1=inflateInit2$1,inflate_2$1$1=inflate$2$1,inflateEnd_1$1=inflateEnd$1,inflateGetHeader_1$1=inflateGetHeader$1,inflateSetDictionary_1$1=inflateSetDictionary$1,inflateInfo$1="pako inflate (from Nodeca project)",inflate_1$2$1={inflateReset:inflateReset_1$1,inflateReset2:inflateReset2_1$1,inflateResetKeep:inflateResetKeep_1$1,inflateInit:inflateInit_1$1,inflateInit2:inflateInit2_1$1,inflate:inflate_2$1$1,inflateEnd:inflateEnd_1$1,inflateGetHeader:inflateGetHeader_1$1,inflateSetDictionary:inflateSetDictionary_1$1,inflateInfo:inflateInfo$1};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader$1=GZheader$1;const toString$4=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$3,Z_FINISH:Z_FINISH$4,Z_OK:Z_OK$4,Z_STREAM_END:Z_STREAM_END$4,Z_NEED_DICT:Z_NEED_DICT$2,Z_STREAM_ERROR:Z_STREAM_ERROR$3,Z_DATA_ERROR:Z_DATA_ERROR$3,Z_MEM_ERROR:Z_MEM_ERROR$2}=constants$2$2;function Inflate$1$1(e){this.options=common$1.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let n=inflate_1$2$1.inflateInit2(this.strm,t.windowBits);if(n!==Z_OK$4)throw new Error(messages$1[n]);if(this.header=new gzheader$1,inflate_1$2$1.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings$1.string2buf(t.dictionary):toString$4.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=inflate_1$2$1.inflateSetDictionary(this.strm,t.dictionary),n!==Z_OK$4)))throw new Error(messages$1[n])}Inflate$1$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let l,p,o;if(this.ended)return!1;for(t===~~t?p=t:p=t===!0?Z_FINISH$4:Z_NO_FLUSH$3,toString$4.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),l=inflate_1$2$1.inflate(n,p),l===Z_NEED_DICT$2&&s&&(l=inflate_1$2$1.inflateSetDictionary(n,s),l===Z_OK$4?l=inflate_1$2$1.inflate(n,p):l===Z_DATA_ERROR$3&&(l=Z_NEED_DICT$2));n.avail_in>0&&l===Z_STREAM_END$4&&n.state.wrap>0&&e[n.next_in]!==0;)inflate_1$2$1.inflateReset(n),l=inflate_1$2$1.inflate(n,p);switch(l){case Z_STREAM_ERROR$3:case Z_DATA_ERROR$3:case Z_NEED_DICT$2:case Z_MEM_ERROR$2:return this.onEnd(l),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(n.avail_out===0||l===Z_STREAM_END$4))if(this.options.to==="string"){let x=strings$1.utf8border(n.output,n.next_out),M=n.next_out-x,P=strings$1.buf2string(n.output,x);n.next_out=M,n.avail_out=r-M,M&&n.output.set(n.output.subarray(x,x+M),0),this.onData(P)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(l===Z_OK$4&&o===0)){if(l===Z_STREAM_END$4)return l=inflate_1$2$1.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Inflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1$1.prototype.onEnd=function(e){e===Z_OK$4&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1$1(e,t){const n=new Inflate$1$1(t);if(n.push(e),n.err)throw n.msg||messages$1[n.err];return n.result}function inflateRaw$1$1(e,t){return t=t||{},t.raw=!0,inflate$1$1(e,t)}var Inflate_1$1$1=Inflate$1$1,inflate_2$2=inflate$1$1,inflateRaw_1$1$1=inflateRaw$1$1,ungzip$1$1=inflate$1$1,constants$b=constants$2$2,inflate_1$1$1={Inflate:Inflate_1$1$1,inflate:inflate_2$2,inflateRaw:inflateRaw_1$1$1,ungzip:ungzip$1$1,constants:constants$b};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate:Inflate$2,inflate:inflate$3,inflateRaw:inflateRaw$2,ungzip:ungzip$2}=inflate_1$1$1;var deflate_1=deflate,Inflate_1=Inflate$2,inflate_1$3=inflate$3;const pngSignature=[137,80,78,71,13,10,26,10],crcTable$1=[];for(let e=0;e<256;e++){let t=e;for(let n=0;n<8;n++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable$1[e]=t}const initialCrc=4294967295;function updateCrc(e,t,n){let r=e;for(let s=0;s<n;s++)r=crcTable$1[(r^t[s])&255]^r>>>8;return r}function crc(e,t){return(updateCrc(initialCrc,e,t)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,n={}){super(t);const{checkCrc:r=!1}=n;this._checkCrc=r,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),n=this.readChars(4),r=this.offset;switch(n){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-r!==t)throw new Error(`Length mismatch while decoding chunk ${n}`);if(this._checkCrc){const s=this.readUint32(),l=t+4,p=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-l-4,l),l);if(p!==s)throw new Error(`CRC mismatch for chunk ${n}. Expected ${s}, found ${p}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const n=this.readUint8();this._colorType=n;let r;switch(n){case ColorType.GREYSCALE:r=1;break;case ColorType.TRUECOLOUR:r=3;break;case ColorType.INDEXED_COLOUR:r=1;break;case ColorType.GREYSCALE_ALPHA:r=2;break;case ColorType.TRUECOLOUR_ALPHA:r=4;break;default:throw new Error(`Unknown color type: ${n}`)}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const n=t/3;this._hasPalette=!0;const r=[];this._palette=r;for(let s=0;s<n;s++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let n=0;for(;n<t;n++){const r=this.readByte();this._palette[n].push(r)}for(;n<this._palette.length;n++)this._palette[n].push(255)}}decodeiCCP(t){let n="",r;for(;(r=this.readChar())!==NULL;)n+=r;const s=this.readUint8();if(s!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const l=this.readBytes(t-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:inflate_1$3(l)}}decodetEXt(t){let n="",r;for(;(r=this.readChar())!==NULL;)n+=r;this._png.text[n]=this.readChars(t-n.length-1)}decodepHYs(){const t=this.readUint32(),n=this.readUint32(),r=this.readByte();this._png.resolution={x:t,y:n,unit:r}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const n=this._png.height,r=this._png.channels*this._png.depth/8,s=this._png.width*r,l=new Uint8Array(this._png.height*s);let p=empty,o=0,x,M;for(let P=0;P<n;P++){switch(x=t.subarray(o+1,o+1+s),M=l.subarray(P*s,(P+1)*s),t[o]){case 0:unfilterNone(x,M,s);break;case 1:unfilterSub(x,M,s,r);break;case 2:unfilterUp(x,M,p,s);break;case 3:unfilterAverage(x,M,p,s,r);break;case 4:unfilterPaeth(x,M,p,s,r);break;default:throw new Error(`Unsupported filter: ${t[o]}`)}p=M,o+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const P=new Uint16Array(l.buffer);if(osIsLittleEndian)for(let he=0;he<P.length;he++)P[he]=swap16(P[he]);this._png.data=P}else this._png.data=l}}function unfilterNone(e,t,n){for(let r=0;r<n;r++)t[r]=e[r]}function unfilterSub(e,t,n,r){let s=0;for(;s<r;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-r]&255}function unfilterUp(e,t,n,r){let s=0;if(n.length===0)for(;s<r;s++)t[s]=e[s];else for(;s<r;s++)t[s]=e[s]+n[s]&255}function unfilterAverage(e,t,n,r,s){let l=0;if(n.length===0){for(;l<s;l++)t[l]=e[l];for(;l<r;l++)t[l]=e[l]+(t[l-s]>>1)&255}else{for(;l<s;l++)t[l]=e[l]+(n[l]>>1)&255;for(;l<r;l++)t[l]=e[l]+(t[l-s]+n[l]>>1)&255}}function unfilterPaeth(e,t,n,r,s){let l=0;if(n.length===0){for(;l<s;l++)t[l]=e[l];for(;l<r;l++)t[l]=e[l]+t[l-s]&255}else{for(;l<s;l++)t[l]=e[l]+n[l]&255;for(;l<r;l++)t[l]=e[l]+paethPredictor(t[l-s],n[l],n[l-s])&255}}function paethPredictor(e,t,n){const r=e+t-n,s=Math.abs(r-e),l=Math.abs(r-t),p=Math.abs(r-n);return s<=l&&s<=p?e:l<=p?t:n}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,n={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,n.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:n,channels:r,depth:s,data:l}=this._png,p=r*t,o=new IOBuffer$4().setBigEndian();let x=0;for(let he=0;he<n;he++)if(o.writeByte(0),s===8)x=writeDataBytes(l,o,p,x);else if(s===16)x=writeDataUint16(l,o,p,x);else throw new Error("unreachable");const M=o.toArray(),P=deflate_1(M,this._zlibOptions);this.encodeIDAT(P)}_checkData(t){const{colorType:n,channels:r,depth:s}=getColorType(t),l={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:r,data:t.data,depth:s,text:{}};this._colorType=n;const p=l.width*l.height*r;if(l.data.length!==p)throw new RangeError(`wrong data size. Found ${l.data.length}, expected ${p}`);return l}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function getColorType(e){const{channels:t=4,depth:n=8}=e;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(n!==8&&n!==16)throw new RangeError(`unsupported bit depth: ${n}`);const r={channels:t,depth:n,colorType:ColorType.UNKNOWN};switch(t){case 4:r.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:r.colorType=ColorType.TRUECOLOUR;break;case 1:r.colorType=ColorType.GREYSCALE;break;case 2:r.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return r}function writeDataBytes(e,t,n,r){for(let s=0;s<n;s++)t.writeByte(e[r++]);return r}function writeDataUint16(e,t,n,r){for(let s=0;s<n;s++)t.writeUint16(e[r++]);return r}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,t){return new PngDecoder(e,t).decode()}function encodePng$1(e,t){return new PngEncoder(e,t).encode()}var encoder={exports:{}};(function(e){function t(r){var s=Math.floor,l=new Array(64),p=new Array(64),o=new Array(64),x=new Array(64),M,P,he,nt,_e=new Array(65535),Bt=new Array(65535),Fn=new Array(64),yr=new Array(64),Io=[],rl=0,Co=7,as=new Array(64),Js=new Array(64),lh=new Array(64),ch=new Array(256),Zu=new Array(2048),th,sl=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],sh=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],xh=[0,1,2,3,4,5,6,7,8,9,10,11],Mh=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Dh=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Uh=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],cd=[0,1,2,3,4,5,6,7,8,9,10,11],Tf=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],yf=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Af(Qh){for(var Yd=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ad=0;ad<64;ad++){var Zd=s((Yd[ad]*Qh+50)/100);Zd<1?Zd=1:Zd>255&&(Zd=255),l[sl[ad]]=Zd}for(var Xh=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ld=0;Ld<64;Ld++){var Kf=s((Xh[Ld]*Qh+50)/100);Kf<1?Kf=1:Kf>255&&(Kf=255),p[sl[Ld]]=Kf}for(var If=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Df=0,Jf=0;Jf<8;Jf++)for(var Nf=0;Nf<8;Nf++)o[Df]=1/(l[sl[Df]]*If[Jf]*If[Nf]*8),x[Df]=1/(p[sl[Df]]*If[Jf]*If[Nf]*8),Df++}function md(Qh,Yd){for(var ad=0,Zd=0,Xh=new Array,Ld=1;Ld<=16;Ld++){for(var Kf=1;Kf<=Qh[Ld];Kf++)Xh[Yd[Zd]]=[],Xh[Yd[Zd]][0]=ad,Xh[Yd[Zd]][1]=Ld,Zd++,ad++;ad*=2}return Xh}function vd(){M=md(sh,xh),P=md(Uh,cd),he=md(Mh,Dh),nt=md(Tf,yf)}function qd(){for(var Qh=1,Yd=2,ad=1;ad<=15;ad++){for(var Zd=Qh;Zd<Yd;Zd++)Bt[32767+Zd]=ad,_e[32767+Zd]=[],_e[32767+Zd][1]=ad,_e[32767+Zd][0]=Zd;for(var Xh=-(Yd-1);Xh<=-Qh;Xh++)Bt[32767+Xh]=ad,_e[32767+Xh]=[],_e[32767+Xh][1]=ad,_e[32767+Xh][0]=Yd-1+Xh;Qh<<=1,Yd<<=1}}function Ed(){for(var Qh=0;Qh<256;Qh++)Zu[Qh]=19595*Qh,Zu[Qh+256>>0]=38470*Qh,Zu[Qh+512>>0]=7471*Qh+32768,Zu[Qh+768>>0]=-11059*Qh,Zu[Qh+1024>>0]=-21709*Qh,Zu[Qh+1280>>0]=32768*Qh+8421375,Zu[Qh+1536>>0]=-27439*Qh,Zu[Qh+1792>>0]=-5329*Qh}function Td(Qh){for(var Yd=Qh[0],ad=Qh[1]-1;ad>=0;)Yd&1<<ad&&(rl|=1<<Co),ad--,Co--,Co<0&&(rl==255?(Fd(255),Fd(0)):Fd(rl),Co=7,rl=0)}function Fd(Qh){Io.push(Qh)}function Cd(Qh){Fd(Qh>>8&255),Fd(Qh&255)}function Gd(Qh,Yd){var ad,Zd,Xh,Ld,Kf,If,Df,Jf,Nf=0,Wf,Cp=8,Tp=64;for(Wf=0;Wf<Cp;++Wf){ad=Qh[Nf],Zd=Qh[Nf+1],Xh=Qh[Nf+2],Ld=Qh[Nf+3],Kf=Qh[Nf+4],If=Qh[Nf+5],Df=Qh[Nf+6],Jf=Qh[Nf+7];var Pp=ad+Jf,Yf=ad-Jf,qp=Zd+Df,am=Zd-Df,Xd=Xh+If,Op=Xh-If,nm=Ld+Kf,Tm=Ld-Kf,hp=Pp+nm,Em=Pp-nm,Qp=qp+Xd,lm=qp-Xd;Qh[Nf]=hp+Qp,Qh[Nf+4]=hp-Qp;var Dd=(lm+Em)*.707106781;Qh[Nf+2]=Em+Dd,Qh[Nf+6]=Em-Dd,hp=Tm+Op,Qp=Op+am,lm=am+Yf;var Hf=(hp-lm)*.382683433,mh=.5411961*hp+Hf,Jh=1.306562965*lm+Hf,Wu=Qp*.707106781,al=Yf+Wu,Xr=Yf-Wu;Qh[Nf+5]=Xr+mh,Qh[Nf+3]=Xr-mh,Qh[Nf+1]=al+Jh,Qh[Nf+7]=al-Jh,Nf+=8}for(Nf=0,Wf=0;Wf<Cp;++Wf){ad=Qh[Nf],Zd=Qh[Nf+8],Xh=Qh[Nf+16],Ld=Qh[Nf+24],Kf=Qh[Nf+32],If=Qh[Nf+40],Df=Qh[Nf+48],Jf=Qh[Nf+56];var mr=ad+Jf,cs=ad-Jf,$u=Zd+Df,eh=Zd-Df,rh=Xh+If,uh=Xh-If,dh=Ld+Kf,yh=Ld-Kf,Ph=mr+dh,Fh=mr-dh,Ad=$u+rh,wd=$u-rh;Qh[Nf]=Ph+Ad,Qh[Nf+32]=Ph-Ad;var Kd=(wd+Fh)*.707106781;Qh[Nf+16]=Fh+Kd,Qh[Nf+48]=Fh-Kd,Ph=yh+uh,Ad=uh+eh,wd=eh+cs;var xf=(Ph-wd)*.382683433,Ff=.5411961*Ph+xf,rp=1.306562965*wd+xf,Ah=Ad*.707106781,Jd=cs+Ah,Od=cs-Ah;Qh[Nf+40]=Od+Ff,Qh[Nf+24]=Od-Ff,Qh[Nf+8]=Jd+rp,Qh[Nf+56]=Jd-rp,Nf++}var qf;for(Wf=0;Wf<Tp;++Wf)qf=Qh[Wf]*Yd[Wf],Fn[Wf]=qf>0?qf+.5|0:qf-.5|0;return Fn}function bf(){Cd(65504),Cd(16),Fd(74),Fd(70),Fd(73),Fd(70),Fd(0),Fd(1),Fd(1),Fd(0),Cd(1),Cd(1),Fd(0),Fd(0)}function Id(Qh){if(Qh){Cd(65505),Qh[0]===69&&Qh[1]===120&&Qh[2]===105&&Qh[3]===102?Cd(Qh.length+2):(Cd(Qh.length+5+2),Fd(69),Fd(120),Fd(105),Fd(102),Fd(0));for(var Yd=0;Yd<Qh.length;Yd++)Fd(Qh[Yd])}}function td(Qh,Yd){Cd(65472),Cd(17),Fd(8),Cd(Yd),Cd(Qh),Fd(3),Fd(1),Fd(17),Fd(0),Fd(2),Fd(17),Fd(1),Fd(3),Fd(17),Fd(1)}function $d(){Cd(65499),Cd(132),Fd(0);for(var Qh=0;Qh<64;Qh++)Fd(l[Qh]);Fd(1);for(var Yd=0;Yd<64;Yd++)Fd(p[Yd])}function np(){Cd(65476),Cd(418),Fd(0);for(var Qh=0;Qh<16;Qh++)Fd(sh[Qh+1]);for(var Yd=0;Yd<=11;Yd++)Fd(xh[Yd]);Fd(16);for(var ad=0;ad<16;ad++)Fd(Mh[ad+1]);for(var Zd=0;Zd<=161;Zd++)Fd(Dh[Zd]);Fd(1);for(var Xh=0;Xh<16;Xh++)Fd(Uh[Xh+1]);for(var Ld=0;Ld<=11;Ld++)Fd(cd[Ld]);Fd(17);for(var Kf=0;Kf<16;Kf++)Fd(Tf[Kf+1]);for(var If=0;If<=161;If++)Fd(yf[If])}function jf(Qh){typeof Qh>"u"||Qh.constructor!==Array||Qh.forEach(Yd=>{if(typeof Yd=="string"){Cd(65534);var ad=Yd.length;Cd(ad+2);var Zd;for(Zd=0;Zd<ad;Zd++)Fd(Yd.charCodeAt(Zd))}})}function yd(){Cd(65498),Cd(12),Fd(3),Fd(1),Fd(0),Fd(2),Fd(17),Fd(3),Fd(17),Fd(0),Fd(63),Fd(0)}function Qd(Qh,Yd,ad,Zd,Xh){for(var Ld=Xh[0],Kf=Xh[240],If,Df=16,Jf=63,Nf=64,Wf=Gd(Qh,Yd),Cp=0;Cp<Nf;++Cp)yr[sl[Cp]]=Wf[Cp];var Tp=yr[0]-ad;ad=yr[0],Tp==0?Td(Zd[0]):(If=32767+Tp,Td(Zd[Bt[If]]),Td(_e[If]));for(var Pp=63;Pp>0&&yr[Pp]==0;Pp--);if(Pp==0)return Td(Ld),ad;for(var Yf=1,qp;Yf<=Pp;){for(var am=Yf;yr[Yf]==0&&Yf<=Pp;++Yf);var Xd=Yf-am;if(Xd>=Df){qp=Xd>>4;for(var Op=1;Op<=qp;++Op)Td(Kf);Xd=Xd&15}If=32767+yr[Yf],Td(Xh[(Xd<<4)+Bt[If]]),Td(_e[If]),Yf++}return Pp!=Jf&&Td(Ld),ad}function op(){for(var Qh=String.fromCharCode,Yd=0;Yd<256;Yd++)ch[Yd]=Qh(Yd)}this.encode=function(Qh,Yd){new Date().getTime(),Yd&&bp(Yd),Io=new Array,rl=0,Co=7,Cd(65496),bf(),jf(Qh.comments),Id(Qh.exifBuffer),$d(),td(Qh.width,Qh.height),np(),yd();var ad=0,Zd=0,Xh=0;rl=0,Co=7,this.encode.displayName="_encode_";for(var Ld=Qh.data,Kf=Qh.width,If=Qh.height,Df=Kf*4,Jf,Nf=0,Wf,Cp,Tp,Pp,Yf,qp,am,Xd;Nf<If;){for(Jf=0;Jf<Df;){for(Pp=Df*Nf+Jf,Yf=Pp,qp=-1,am=0,Xd=0;Xd<64;Xd++)am=Xd>>3,qp=(Xd&7)*4,Yf=Pp+am*Df+qp,Nf+am>=If&&(Yf-=Df*(Nf+1+am-If)),Jf+qp>=Df&&(Yf-=Jf+qp-Df+4),Wf=Ld[Yf++],Cp=Ld[Yf++],Tp=Ld[Yf++],as[Xd]=(Zu[Wf]+Zu[Cp+256>>0]+Zu[Tp+512>>0]>>16)-128,Js[Xd]=(Zu[Wf+768>>0]+Zu[Cp+1024>>0]+Zu[Tp+1280>>0]>>16)-128,lh[Xd]=(Zu[Wf+1280>>0]+Zu[Cp+1536>>0]+Zu[Tp+1792>>0]>>16)-128;ad=Qd(as,o,ad,M,he),Zd=Qd(Js,x,Zd,P,nt),Xh=Qd(lh,x,Xh,P,nt),Jf+=32}Nf+=8}if(Co>=0){var Op=[];Op[1]=Co+1,Op[0]=(1<<Co+1)-1,Td(Op)}return Cd(65497),Buffer.from(Io)};function bp(Qh){if(Qh<=0&&(Qh=1),Qh>100&&(Qh=100),th!=Qh){var Yd=0;Qh<50?Yd=Math.floor(5e3/Qh):Yd=Math.floor(200-Qh*2),Af(Yd),th=Qh}}function fp(){var Qh=new Date().getTime();r||(r=50),op(),vd(),qd(),Ed(),bp(r),new Date().getTime()-Qh}fp()}e.exports=n;function n(r,s){typeof s>"u"&&(s=50);var l=new t(s),p=l.encode(r,s);return{data:p,width:r.width,height:r.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(e){var t=function(){var s=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),l=4017,p=799,o=3406,x=2276,M=1567,P=3784,he=5793,nt=2896;function _e(){}function Bt(Js,lh){for(var ch=0,Zu=[],th,sl,sh=16;sh>0&&!Js[sh-1];)sh--;Zu.push({children:[],index:0});var xh=Zu[0],Mh;for(th=0;th<sh;th++){for(sl=0;sl<Js[th];sl++){for(xh=Zu.pop(),xh.children[xh.index]=lh[ch];xh.index>0;){if(Zu.length===0)throw new Error("Could not recreate Huffman Table");xh=Zu.pop()}for(xh.index++,Zu.push(xh);Zu.length<=th;)Zu.push(Mh={children:[],index:0}),xh.children[xh.index]=Mh.children,xh=Mh;ch++}th+1<sh&&(Zu.push(Mh={children:[],index:0}),xh.children[xh.index]=Mh.children,xh=Mh)}return Zu[0].children}function Fn(Js,lh,ch,Zu,th,sl,sh,xh,Mh,Dh){ch.precision,ch.samplesPerLine,ch.scanLines;var Uh=ch.mcusPerLine,cd=ch.progressive;ch.maxH,ch.maxV;var Tf=lh,yf=0,Af=0;function md(){if(Af>0)return Af--,yf>>Af&1;if(yf=Js[lh++],yf==255){var If=Js[lh++];if(If)throw new Error("unexpected marker: "+(yf<<8|If).toString(16))}return Af=7,yf>>>7}function vd(If){for(var Df=If,Jf;(Jf=md())!==null;){if(Df=Df[Jf],typeof Df=="number")return Df;if(typeof Df!="object")throw new Error("invalid huffman sequence")}return null}function qd(If){for(var Df=0;If>0;){var Jf=md();if(Jf===null)return;Df=Df<<1|Jf,If--}return Df}function Ed(If){var Df=qd(If);return Df>=1<<If-1?Df:Df+(-1<<If)+1}function Td(If,Df){var Jf=vd(If.huffmanTableDC),Nf=Jf===0?0:Ed(Jf);Df[0]=If.pred+=Nf;for(var Wf=1;Wf<64;){var Cp=vd(If.huffmanTableAC),Tp=Cp&15,Pp=Cp>>4;if(Tp===0){if(Pp<15)break;Wf+=16;continue}Wf+=Pp;var Yf=s[Wf];Df[Yf]=Ed(Tp),Wf++}}function Fd(If,Df){var Jf=vd(If.huffmanTableDC),Nf=Jf===0?0:Ed(Jf)<<Mh;Df[0]=If.pred+=Nf}function Cd(If,Df){Df[0]|=md()<<Mh}var Gd=0;function bf(If,Df){if(Gd>0){Gd--;return}for(var Jf=sl,Nf=sh;Jf<=Nf;){var Wf=vd(If.huffmanTableAC),Cp=Wf&15,Tp=Wf>>4;if(Cp===0){if(Tp<15){Gd=qd(Tp)+(1<<Tp)-1;break}Jf+=16;continue}Jf+=Tp;var Pp=s[Jf];Df[Pp]=Ed(Cp)*(1<<Mh),Jf++}}var Id=0,td;function $d(If,Df){for(var Jf=sl,Nf=sh,Wf=0;Jf<=Nf;){var Cp=s[Jf],Tp=Df[Cp]<0?-1:1;switch(Id){case 0:var Pp=vd(If.huffmanTableAC),Yf=Pp&15,Wf=Pp>>4;if(Yf===0)Wf<15?(Gd=qd(Wf)+(1<<Wf),Id=4):(Wf=16,Id=1);else{if(Yf!==1)throw new Error("invalid ACn encoding");td=Ed(Yf),Id=Wf?2:3}continue;case 1:case 2:Df[Cp]?Df[Cp]+=(md()<<Mh)*Tp:(Wf--,Wf===0&&(Id=Id==2?3:0));break;case 3:Df[Cp]?Df[Cp]+=(md()<<Mh)*Tp:(Df[Cp]=td<<Mh,Id=0);break;case 4:Df[Cp]&&(Df[Cp]+=(md()<<Mh)*Tp);break}Jf++}Id===4&&(Gd--,Gd===0&&(Id=0))}function np(If,Df,Jf,Nf,Wf){var Cp=Jf/Uh|0,Tp=Jf%Uh,Pp=Cp*If.v+Nf,Yf=Tp*If.h+Wf;If.blocks[Pp]===void 0&&Dh.tolerantDecoding||Df(If,If.blocks[Pp][Yf])}function jf(If,Df,Jf){var Nf=Jf/If.blocksPerLine|0,Wf=Jf%If.blocksPerLine;If.blocks[Nf]===void 0&&Dh.tolerantDecoding||Df(If,If.blocks[Nf][Wf])}var yd=Zu.length,Qd,op,bp,fp,Qh,Yd;cd?sl===0?Yd=xh===0?Fd:Cd:Yd=xh===0?bf:$d:Yd=Td;var ad=0,Zd,Xh;yd==1?Xh=Zu[0].blocksPerLine*Zu[0].blocksPerColumn:Xh=Uh*ch.mcusPerColumn,th||(th=Xh);for(var Ld,Kf;ad<Xh;){for(op=0;op<yd;op++)Zu[op].pred=0;if(Gd=0,yd==1)for(Qd=Zu[0],Qh=0;Qh<th;Qh++)jf(Qd,Yd,ad),ad++;else for(Qh=0;Qh<th;Qh++){for(op=0;op<yd;op++)for(Qd=Zu[op],Ld=Qd.h,Kf=Qd.v,bp=0;bp<Kf;bp++)for(fp=0;fp<Ld;fp++)np(Qd,Yd,ad,bp,fp);if(ad++,ad===Xh)break}if(ad===Xh)do{if(Js[lh]===255&&Js[lh+1]!==0)break;lh+=1}while(lh<Js.length-2);if(Af=0,Zd=Js[lh]<<8|Js[lh+1],Zd<65280)throw new Error("marker was not found");if(Zd>=65488&&Zd<=65495)lh+=2;else break}return lh-Tf}function yr(Js,lh){var ch=[],Zu=lh.blocksPerLine,th=lh.blocksPerColumn,sl=Zu<<3,sh=new Int32Array(64),xh=new Uint8Array(64);function Mh(qd,Ed,Td){var Fd=lh.quantizationTable,Cd,Gd,bf,Id,td,$d,np,jf,yd,Qd=Td,op;for(op=0;op<64;op++)Qd[op]=qd[op]*Fd[op];for(op=0;op<8;++op){var bp=8*op;if(Qd[1+bp]==0&&Qd[2+bp]==0&&Qd[3+bp]==0&&Qd[4+bp]==0&&Qd[5+bp]==0&&Qd[6+bp]==0&&Qd[7+bp]==0){yd=he*Qd[0+bp]+512>>10,Qd[0+bp]=yd,Qd[1+bp]=yd,Qd[2+bp]=yd,Qd[3+bp]=yd,Qd[4+bp]=yd,Qd[5+bp]=yd,Qd[6+bp]=yd,Qd[7+bp]=yd;continue}Cd=he*Qd[0+bp]+128>>8,Gd=he*Qd[4+bp]+128>>8,bf=Qd[2+bp],Id=Qd[6+bp],td=nt*(Qd[1+bp]-Qd[7+bp])+128>>8,jf=nt*(Qd[1+bp]+Qd[7+bp])+128>>8,$d=Qd[3+bp]<<4,np=Qd[5+bp]<<4,yd=Cd-Gd+1>>1,Cd=Cd+Gd+1>>1,Gd=yd,yd=bf*P+Id*M+128>>8,bf=bf*M-Id*P+128>>8,Id=yd,yd=td-np+1>>1,td=td+np+1>>1,np=yd,yd=jf+$d+1>>1,$d=jf-$d+1>>1,jf=yd,yd=Cd-Id+1>>1,Cd=Cd+Id+1>>1,Id=yd,yd=Gd-bf+1>>1,Gd=Gd+bf+1>>1,bf=yd,yd=td*x+jf*o+2048>>12,td=td*o-jf*x+2048>>12,jf=yd,yd=$d*p+np*l+2048>>12,$d=$d*l-np*p+2048>>12,np=yd,Qd[0+bp]=Cd+jf,Qd[7+bp]=Cd-jf,Qd[1+bp]=Gd+np,Qd[6+bp]=Gd-np,Qd[2+bp]=bf+$d,Qd[5+bp]=bf-$d,Qd[3+bp]=Id+td,Qd[4+bp]=Id-td}for(op=0;op<8;++op){var fp=op;if(Qd[8+fp]==0&&Qd[16+fp]==0&&Qd[24+fp]==0&&Qd[32+fp]==0&&Qd[40+fp]==0&&Qd[48+fp]==0&&Qd[56+fp]==0){yd=he*Td[op+0]+8192>>14,Qd[0+fp]=yd,Qd[8+fp]=yd,Qd[16+fp]=yd,Qd[24+fp]=yd,Qd[32+fp]=yd,Qd[40+fp]=yd,Qd[48+fp]=yd,Qd[56+fp]=yd;continue}Cd=he*Qd[0+fp]+2048>>12,Gd=he*Qd[32+fp]+2048>>12,bf=Qd[16+fp],Id=Qd[48+fp],td=nt*(Qd[8+fp]-Qd[56+fp])+2048>>12,jf=nt*(Qd[8+fp]+Qd[56+fp])+2048>>12,$d=Qd[24+fp],np=Qd[40+fp],yd=Cd-Gd+1>>1,Cd=Cd+Gd+1>>1,Gd=yd,yd=bf*P+Id*M+2048>>12,bf=bf*M-Id*P+2048>>12,Id=yd,yd=td-np+1>>1,td=td+np+1>>1,np=yd,yd=jf+$d+1>>1,$d=jf-$d+1>>1,jf=yd,yd=Cd-Id+1>>1,Cd=Cd+Id+1>>1,Id=yd,yd=Gd-bf+1>>1,Gd=Gd+bf+1>>1,bf=yd,yd=td*x+jf*o+2048>>12,td=td*o-jf*x+2048>>12,jf=yd,yd=$d*p+np*l+2048>>12,$d=$d*l-np*p+2048>>12,np=yd,Qd[0+fp]=Cd+jf,Qd[56+fp]=Cd-jf,Qd[8+fp]=Gd+np,Qd[48+fp]=Gd-np,Qd[16+fp]=bf+$d,Qd[40+fp]=bf-$d,Qd[24+fp]=Id+td,Qd[32+fp]=Id-td}for(op=0;op<64;++op){var Qh=128+(Qd[op]+8>>4);Ed[op]=Qh<0?0:Qh>255?255:Qh}}as(sl*th*8);for(var Dh,Uh,cd=0;cd<th;cd++){var Tf=cd<<3;for(Dh=0;Dh<8;Dh++)ch.push(new Uint8Array(sl));for(var yf=0;yf<Zu;yf++){Mh(lh.blocks[cd][yf],xh,sh);var Af=0,md=yf<<3;for(Uh=0;Uh<8;Uh++){var vd=ch[Tf+Uh];for(Dh=0;Dh<8;Dh++)vd[md+Dh]=xh[Af++]}}}return ch}function Io(Js){return Js<0?0:Js>255?255:Js}_e.prototype={load:function(lh){var ch=new XMLHttpRequest;ch.open("GET",lh,!0),ch.responseType="arraybuffer",ch.onload=function(){var Zu=new Uint8Array(ch.response||ch.mozResponseArrayBuffer);this.parse(Zu),this.onload&&this.onload()}.bind(this),ch.send(null)},parse:function(lh){var ch=this.opts.maxResolutionInMP*1e3*1e3,Zu=0;lh.length;function th(){var Tp=lh[Zu]<<8|lh[Zu+1];return Zu+=2,Tp}function sl(){var Tp=th(),Pp=lh.subarray(Zu,Zu+Tp-2);return Zu+=Pp.length,Pp}function sh(Tp){var Pp=1,Yf=1,qp,am;for(am in Tp.components)Tp.components.hasOwnProperty(am)&&(qp=Tp.components[am],Pp<qp.h&&(Pp=qp.h),Yf<qp.v&&(Yf=qp.v));var Xd=Math.ceil(Tp.samplesPerLine/8/Pp),Op=Math.ceil(Tp.scanLines/8/Yf);for(am in Tp.components)if(Tp.components.hasOwnProperty(am)){qp=Tp.components[am];var nm=Math.ceil(Math.ceil(Tp.samplesPerLine/8)*qp.h/Pp),Tm=Math.ceil(Math.ceil(Tp.scanLines/8)*qp.v/Yf),hp=Xd*qp.h,Em=Op*qp.v,Qp=Em*hp,lm=[];as(Qp*256);for(var Dd=0;Dd<Em;Dd++){for(var Hf=[],mh=0;mh<hp;mh++)Hf.push(new Int32Array(64));lm.push(Hf)}qp.blocksPerLine=nm,qp.blocksPerColumn=Tm,qp.blocks=lm}Tp.maxH=Pp,Tp.maxV=Yf,Tp.mcusPerLine=Xd,Tp.mcusPerColumn=Op}var xh=null,Mh=null,Dh,Uh,cd=[],Tf=[],yf=[],Af=[],md=th(),vd=-1;if(this.comments=[],md!=65496)throw new Error("SOI not found");for(md=th();md!=65497;){var qd,Ed;switch(md){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Td=sl();if(md===65534){var Fd=String.fromCharCode.apply(null,Td);this.comments.push(Fd)}md===65504&&Td[0]===74&&Td[1]===70&&Td[2]===73&&Td[3]===70&&Td[4]===0&&(xh={version:{major:Td[5],minor:Td[6]},densityUnits:Td[7],xDensity:Td[8]<<8|Td[9],yDensity:Td[10]<<8|Td[11],thumbWidth:Td[12],thumbHeight:Td[13],thumbData:Td.subarray(14,14+3*Td[12]*Td[13])}),md===65505&&Td[0]===69&&Td[1]===120&&Td[2]===105&&Td[3]===102&&Td[4]===0&&(this.exifBuffer=Td.subarray(5,Td.length)),md===65518&&Td[0]===65&&Td[1]===100&&Td[2]===111&&Td[3]===98&&Td[4]===101&&Td[5]===0&&(Mh={version:Td[6],flags0:Td[7]<<8|Td[8],flags1:Td[9]<<8|Td[10],transformCode:Td[11]});break;case 65499:for(var Cd=th(),Gd=Cd+Zu-2;Zu<Gd;){var bf=lh[Zu++];as(256);var Id=new Int32Array(64);if(bf>>4)if(bf>>4===1)for(Ed=0;Ed<64;Ed++){var td=s[Ed];Id[td]=th()}else throw new Error("DQT: invalid table spec");else for(Ed=0;Ed<64;Ed++){var td=s[Ed];Id[td]=lh[Zu++]}cd[bf&15]=Id}break;case 65472:case 65473:case 65474:th(),Dh={},Dh.extended=md===65473,Dh.progressive=md===65474,Dh.precision=lh[Zu++],Dh.scanLines=th(),Dh.samplesPerLine=th(),Dh.components={},Dh.componentsOrder=[];var $d=Dh.scanLines*Dh.samplesPerLine;if($d>ch){var np=Math.ceil(($d-ch)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${np}MP`)}var jf=lh[Zu++],yd;for(qd=0;qd<jf;qd++){yd=lh[Zu];var Qd=lh[Zu+1]>>4,op=lh[Zu+1]&15,bp=lh[Zu+2];if(Qd<=0||op<=0)throw new Error("Invalid sampling factor, expected values above 0");Dh.componentsOrder.push(yd),Dh.components[yd]={h:Qd,v:op,quantizationIdx:bp},Zu+=3}sh(Dh),Tf.push(Dh);break;case 65476:var fp=th();for(qd=2;qd<fp;){var Qh=lh[Zu++],Yd=new Uint8Array(16),ad=0;for(Ed=0;Ed<16;Ed++,Zu++)ad+=Yd[Ed]=lh[Zu];as(16+ad);var Zd=new Uint8Array(ad);for(Ed=0;Ed<ad;Ed++,Zu++)Zd[Ed]=lh[Zu];qd+=17+ad,(Qh>>4?yf:Af)[Qh&15]=Bt(Yd,Zd)}break;case 65501:th(),Uh=th();break;case 65500:th(),th();break;case 65498:th();var Xh=lh[Zu++],Ld=[],Kf;for(qd=0;qd<Xh;qd++){Kf=Dh.components[lh[Zu++]];var If=lh[Zu++];Kf.huffmanTableDC=Af[If>>4],Kf.huffmanTableAC=yf[If&15],Ld.push(Kf)}var Df=lh[Zu++],Jf=lh[Zu++],Nf=lh[Zu++],Wf=Fn(lh,Zu,Dh,Ld,Uh,Df,Jf,Nf>>4,Nf&15,this.opts);Zu+=Wf;break;case 65535:lh[Zu]!==255&&Zu--;break;default:if(lh[Zu-3]==255&&lh[Zu-2]>=192&&lh[Zu-2]<=254){Zu-=3;break}else if(md===224||md==225){if(vd!==-1)throw new Error(`first unknown JPEG marker at offset ${vd.toString(16)}, second unknown JPEG marker ${md.toString(16)} at offset ${(Zu-1).toString(16)}`);vd=Zu-1;const Tp=th();if(lh[Zu+Tp-2]===255){Zu+=Tp-2;break}}throw new Error("unknown JPEG marker "+md.toString(16))}md=th()}if(Tf.length!=1)throw new Error("only single frame JPEGs supported");for(var qd=0;qd<Tf.length;qd++){var Cp=Tf[qd].components;for(var Ed in Cp)Cp[Ed].quantizationTable=cd[Cp[Ed].quantizationIdx],delete Cp[Ed].quantizationIdx}this.width=Dh.samplesPerLine,this.height=Dh.scanLines,this.jfif=xh,this.adobe=Mh,this.components=[];for(var qd=0;qd<Dh.componentsOrder.length;qd++){var Kf=Dh.components[Dh.componentsOrder[qd]];this.components.push({lines:yr(Dh,Kf),scaleX:Kf.h/Dh.maxH,scaleY:Kf.v/Dh.maxV})}},getData:function(lh,ch){var Zu=this.width/lh,th=this.height/ch,sl,sh,xh,Mh,Dh,Uh,cd,Tf,yf,Af,md=0,vd,qd,Ed,Td,Fd,Cd,Gd,bf,Id,td,$d,np=lh*ch*this.components.length;as(np);var jf=new Uint8Array(np);switch(this.components.length){case 1:for(sl=this.components[0],Af=0;Af<ch;Af++)for(Dh=sl.lines[0|Af*sl.scaleY*th],yf=0;yf<lh;yf++)vd=Dh[0|yf*sl.scaleX*Zu],jf[md++]=vd;break;case 2:for(sl=this.components[0],sh=this.components[1],Af=0;Af<ch;Af++)for(Dh=sl.lines[0|Af*sl.scaleY*th],Uh=sh.lines[0|Af*sh.scaleY*th],yf=0;yf<lh;yf++)vd=Dh[0|yf*sl.scaleX*Zu],jf[md++]=vd,vd=Uh[0|yf*sh.scaleX*Zu],jf[md++]=vd;break;case 3:for($d=!0,this.adobe&&this.adobe.transformCode?$d=!0:typeof this.opts.colorTransform<"u"&&($d=!!this.opts.colorTransform),sl=this.components[0],sh=this.components[1],xh=this.components[2],Af=0;Af<ch;Af++)for(Dh=sl.lines[0|Af*sl.scaleY*th],Uh=sh.lines[0|Af*sh.scaleY*th],cd=xh.lines[0|Af*xh.scaleY*th],yf=0;yf<lh;yf++)$d?(vd=Dh[0|yf*sl.scaleX*Zu],qd=Uh[0|yf*sh.scaleX*Zu],Ed=cd[0|yf*xh.scaleX*Zu],bf=Io(vd+1.402*(Ed-128)),Id=Io(vd-.3441363*(qd-128)-.71413636*(Ed-128)),td=Io(vd+1.772*(qd-128))):(bf=Dh[0|yf*sl.scaleX*Zu],Id=Uh[0|yf*sh.scaleX*Zu],td=cd[0|yf*xh.scaleX*Zu]),jf[md++]=bf,jf[md++]=Id,jf[md++]=td;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for($d=!1,this.adobe&&this.adobe.transformCode?$d=!0:typeof this.opts.colorTransform<"u"&&($d=!!this.opts.colorTransform),sl=this.components[0],sh=this.components[1],xh=this.components[2],Mh=this.components[3],Af=0;Af<ch;Af++)for(Dh=sl.lines[0|Af*sl.scaleY*th],Uh=sh.lines[0|Af*sh.scaleY*th],cd=xh.lines[0|Af*xh.scaleY*th],Tf=Mh.lines[0|Af*Mh.scaleY*th],yf=0;yf<lh;yf++)$d?(vd=Dh[0|yf*sl.scaleX*Zu],qd=Uh[0|yf*sh.scaleX*Zu],Ed=cd[0|yf*xh.scaleX*Zu],Td=Tf[0|yf*Mh.scaleX*Zu],Fd=255-Io(vd+1.402*(Ed-128)),Cd=255-Io(vd-.3441363*(qd-128)-.71413636*(Ed-128)),Gd=255-Io(vd+1.772*(qd-128))):(Fd=Dh[0|yf*sl.scaleX*Zu],Cd=Uh[0|yf*sh.scaleX*Zu],Gd=cd[0|yf*xh.scaleX*Zu],Td=Tf[0|yf*Mh.scaleX*Zu]),jf[md++]=255-Fd,jf[md++]=255-Cd,jf[md++]=255-Gd,jf[md++]=255-Td;break;default:throw new Error("Unsupported color mode")}return jf},copyToImageData:function(lh,ch){var Zu=lh.width,th=lh.height,sl=lh.data,sh=this.getData(Zu,th),xh=0,Mh=0,Dh,Uh,cd,Tf,yf,Af,md,vd,qd;switch(this.components.length){case 1:for(Uh=0;Uh<th;Uh++)for(Dh=0;Dh<Zu;Dh++)cd=sh[xh++],sl[Mh++]=cd,sl[Mh++]=cd,sl[Mh++]=cd,ch&&(sl[Mh++]=255);break;case 3:for(Uh=0;Uh<th;Uh++)for(Dh=0;Dh<Zu;Dh++)md=sh[xh++],vd=sh[xh++],qd=sh[xh++],sl[Mh++]=md,sl[Mh++]=vd,sl[Mh++]=qd,ch&&(sl[Mh++]=255);break;case 4:for(Uh=0;Uh<th;Uh++)for(Dh=0;Dh<Zu;Dh++)yf=sh[xh++],Af=sh[xh++],cd=sh[xh++],Tf=sh[xh++],md=255-Io(yf*(1-Tf/255)+Tf),vd=255-Io(Af*(1-Tf/255)+Tf),qd=255-Io(cd*(1-Tf/255)+Tf),sl[Mh++]=md,sl[Mh++]=vd,sl[Mh++]=qd,ch&&(sl[Mh++]=255);break;default:throw new Error("Unsupported color mode")}}};var rl=0,Co=0;function as(Js=0){var lh=rl+Js;if(lh>Co){var ch=Math.ceil((lh-Co)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ch}MB`)}rl=lh}return _e.resetMaxMemoryUsage=function(Js){rl=0,Co=Js},_e.getBytesAllocated=function(){return rl},_e.requestMemoryAllocation=as,_e}();e.exports=n;function n(r,s={}){var l={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},p={...l,...s},o=new Uint8Array(r),x=new t;x.opts=p,t.resetMaxMemoryUsage(p.maxMemoryUsageInMB*1024*1024),x.parse(o);var M=p.formatAsRGBA?4:3,P=x.width*x.height*M;try{t.requestMemoryAllocation(P);var he={width:x.width,height:x.height,exifBuffer:x.exifBuffer,data:p.useTArray?new Uint8Array(P):Buffer.alloc(P)};x.comments.length>0&&(he.comments=x.comments)}catch(nt){throw nt instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+P):nt instanceof ReferenceError&&nt.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):nt}return x.copyToImageData(he,p.formatAsRGBA),he}})(decoder);var decoderExports=decoder.exports,encode$2=encoderExports,decode$5=decoderExports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode$1(e){let t,n=e.length,r="";for(t=0;t<n;t+=3)r+=chars[e[t]>>2],r+=chars[(e[t]&3)<<4|e[t+1]>>4],r+=chars[(e[t+1]&15)<<2|e[t+2]>>6],r+=chars[e[t+2]&63];return n%3===2?r=`${r.substring(0,r.length-1)}=`:n%3===1&&(r=`${r.substring(0,r.length-2)}==`),r}function decode$4(e){let t=e.length*.75,n=e.length,r=0,s,l,p,o;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const x=new Uint8Array(t);for(let M=0;M<n;M+=4)s=lookup[e.charCodeAt(M)],l=lookup[e.charCodeAt(M+1)],p=lookup[e.charCodeAt(M+2)],o=lookup[e.charCodeAt(M+3)],x[r++]=s<<2|l>>4,x[r++]=(l&15)<<4|p>>2,x[r++]=(p&3)<<6|o&63;return x}function toBase64URL(e,t){const n=encode$1(e);return`data:${t};base64,${n}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(e,t){let n=self.document.createElement("canvas");return n.width=e,n.height=t,n}function fetchBinary(e,{withCredentials:t=!1}={}){return new Promise(function(n,r){let s=new self.XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.withCredentials=t,s.onload=function(l){this.status!==200?r(l):n(this.response)},s.onerror=r,s.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,t={}){const n={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(n,t.quality).data}function encodePng(e,t){const n={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(n.depth===1||n.depth===32)&&(n.depth=8,n.channels=4,n.data=e.getRGBAData()),encodePng$1(n,t)}const exportMethods={save(e,t={}){const{useCanvas:n=!1,encoder:r=void 0}=t;let{format:s}=t;if(!s){const l=/\.(?<format>[a-zA-Z]+)$/.exec(e);l&&(s=l.groups.format.toLowerCase())}if(!s)throw new Error("file format not provided");return new Promise((l,p)=>{let o,x;switch(s.toLowerCase()){case"png":{n?o=this.getCanvas().pngStream():x=encodePng(this,r);break}case"jpg":case"jpeg":n?o=this.getCanvas().jpegStream():x=encodeJpeg(this,r);break;case"bmp":x=encode$3(this,r);break;default:throw new RangeError(`invalid output format: ${s}`)}if(o){let M=createWriteStream();M.on("finish",l),M.on("error",p),o.pipe(M)}else x&&writeFile()})},toDataURL(e="image/png",t={}){typeof e=="object"&&(t=e,e="image/png");const{useCanvas:n=!1,encoder:r=void 0}=t;e=getType(e);function s(l,p){const o=l(p,r);return toBase64URL(o,e)}return e==="image/bmp"?s(encode$3,this):e==="image/png"&&!n?s(encodePng,this):e==="image/jpeg"&&!n?s(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:t="png",encoder:n=void 0}=e;switch(t.toLowerCase()){case"png":return encodePng(this,n);case"jpeg":case"jpg":return encodeJpeg(this,n);case"bmp":return encode$3(this,n);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(e="image/png",t={}){if(t.async)return this.toDataURL(e,t).then(function(n){return n.substring(n.indexOf(",")+1)});{const n=this.toDataURL(e,t);return n.substring(n.indexOf(",")+1)}},toBlob(e="image/png",t=.8){return canvasToBlob(this.getCanvas(),e,t)},getCanvas(){const e=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(e,0,0),t}};function setExportMethods(e){for(const t in exportMethods)e.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version$3="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$3={name,version:version$3,description,main,scripts,author,license,repository,homepage,devDependencies};(function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=t=function(s,l){return n.call(l,s)},t.version=require$$0$3.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,t,n={}){let{inPlace:r=!1,returnThis:s=!0,partialArgs:l=[]}=n;return r?Image$1.prototype[e]=function(...p){this.computed=null;let o=t.apply(this,[...l,...p]);return s?this:o}:Image$1.prototype[e]=function(...p){return t.apply(this,[...l,...p])},Image$1}function extendProperty(e,t,n={}){let{partialArgs:r=[]}=n;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let s=t.apply(this,r);return this.computed[e]=s,s},Object.defineProperty(Image$1.prototype,e,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:t}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const n=this.width*this.height*4;let r=t?new Uint8ClampedArray(n):new Uint8Array(n);return this.bitDepth===1?fillDataFromBinary(this,r):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,r):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,r))):this.components===1?fillDataFromGrey(this,r):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,r)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,r)):fillAlpha(this,r),r}function fillDataFromBinary(e,t){for(let n=0;n<e.size;n++){const r=e.getBit(n);t[n*4]=r*255,t[n*4+1]=r*255,t[n*4+2]=r*255}}function fillDataFromGrey32(e,t){const n=e.min[0],s=e.max[0]-n;for(let l=0;l<e.size;l++){const p=Math.floor(255*(e.data[l]-n)/s);t[l*4]=p,t[l*4+1]=p,t[l*4+2]=p}}function fillDataFromRGB32(e,t){const n=Math.min(...e.min),s=Math.max(...e.max)-n;for(let l=0;l<e.size;l++){const p=Math.floor(255*(e.data[l*3]-n)/s),o=Math.floor(255*(e.data[l*3+1]-n)/s),x=Math.floor(255*(e.data[l*3+2]-n)/s);t[l*4]=p,t[l*4+1]=o,t[l*4+2]=x}}function fillDataFromGrey(e,t){for(let n=0;n<e.size;n++)t[n*4]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+1]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+2]=e.data[n*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,t){for(let n=0;n<e.size;n++)t[n*4]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+1]=e.data[n*e.channels+1]>>>e.bitDepth-8,t[n*4+2]=e.data[n*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,t){for(let n=0;n<e.size;n++)t[n*4+3]=e.data[n*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,t){for(let n=0;n<e.size;n++)t[n*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const t=kinds[e];if(!t)throw new RangeError(`invalid image kind: ${e}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:t,alpha:n,bitDepth:r,colorModel:s}=e;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(n!==0&&n!==1&&typeof n!="boolean")throw new TypeError(`invalid alpha: ${n}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(r))throw new RangeError(`invalid bitDepth: ${r}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[s])throw new RangeError(`invalid colorModel: ${s}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,t,n){let r=t*e;return n===1&&(r=Math.ceil(r/8)),r}function createPixelArray(e,t,n,r,s,l){const p=r*e;let o;switch(s){case 1:o=new Uint8Array(Math.ceil(p/8));break;case 8:o=new Uint8Array(p);break;case 16:o=new Uint16Array(p);break;case 32:o=new Float32Array(p);break;default:throw new Error(`Cannot create pixel array for bit depth ${s}`)}if(n)for(let x=t;x<o.length;x+=r)o[x]=l;return o}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,n){n=n||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let r=t.byteLength;const s=n.offset?n.offset>>>0:0;t.buffer&&(r=t.byteLength-s,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+s,t.byteOffset+t.byteLength):s?t=t.buffer.slice(s):t=t.buffer),this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=r||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const n=this._increment+this._increment;this._increment=n;const r=this.length+n,s=new Uint8Array(r);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=r,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var n=new Uint8Array(t),r=0;r<t;r++)n[r]=this.readByte();return n}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var n=0;n<t;n++)charArray[n]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var n=0;n<t.length;n++)this._data.setUint8(this.offset++,t[n])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const n=tags$1[this.kind].tagsById;for(var t of this.fields.keys())n[t]&&(this._map[n[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,n=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(n[1],n[2]-1,n[3]),t.setHours(n[4],n[5],n[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,t){return types$1.get(e)[0]*t};ifdValue.readData=function(e,t,n){return types$1.get(t)[1](e,n)};function readByte$1(e,t){if(t===1)return e.readUint8();for(var n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.readUint8();return n}function readASCII$1(e,t){for(var n=[],r="",s=0;s<t;s++){var l=String.fromCharCode(e.readUint8());l==="\0"?(n.push(r),r=""):r+=l}return n.length===1?n[0]:n}function readShort$1(e,t){if(t===1)return e.readUint16();for(var n=new Uint16Array(t),r=0;r<t;r++)n[r]=e.readUint16();return n}function readLong$1(e,t){if(t===1)return e.readUint32();for(var n=new Uint32Array(t),r=0;r<t;r++)n[r]=e.readUint32();return n}function readRational$1(e,t){if(t===1)return e.readUint32()/e.readUint32();for(var n=new Array(t),r=0;r<t;r++)n[r]=e.readUint32()/e.readUint32();return n}function readSByte$1(e,t){if(t===1)return e.readInt8();for(var n=new Int8Array(t),r=0;r<t;r++)n[r]=e.readInt8();return n}function readSShort$1(e,t){if(t===1)return e.readInt16();for(var n=new Int16Array(t),r=0;r<t;r++)n[r]=e.readInt16();return n}function readSLong$1(e,t){if(t===1)return e.readInt32();for(var n=new Int32Array(t),r=0;r<t;r++)n[r]=e.readInt32();return n}function readSRational$1(e,t){if(t===1)return e.readInt32()/e.readInt32();for(var n=new Array(t),r=0;r<t;r++)n[r]=e.readInt32()/e.readInt32();return n}function readFloat$1(e,t){if(t===1)return e.readFloat32();for(var n=new Float32Array(t),r=0;r<t;r++)n[r]=e.readFloat32();return n}function readDouble$1(e,t){if(t===1)return e.readFloat64();for(var n=new Float64Array(t),r=0;r<t;r++)n[r]=e.readFloat64();return n}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,n){super(t,n),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const n=[];for(this.decodeHeader();this._nextIFD;)if(n.push(this.decodeIFD(t)),t.onlyFirst)return n[0];return n}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var n;t.kind?n=new IFD$1(t.kind):n=new TiffIFD;const r=this.readUint16();for(var s=0;s<r;s++)this.decodeIFDEntry(n);return t.ignoreImageData||this.decodeImageData(n),this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const n=this.offset,r=this.readUint16(),s=this.readUint16(),l=this.readUint32();if(s<1||s>12){this.skip(4);return}IFDValue.getByteLength(s,l)>4&&this.seek(this.readUint32());const o=IFDValue.readData(this,s,l);if(t.fields.set(r,o),r===34665||r===34853){let x=this.offset,M;r===34665?M="exif":r===34853&&(M="gps"),this._nextIFD=o,t[M]=this.decodeIFD({kind:M,ignoreImageData:!0}),this.offset=x}this.seek(n),this.skip(12)}decodeImageData(t){const n=t.orientation;switch(n&&n!==1&&unsupported$1("orientation",n),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const n=t.width,r=t.height,s=validateBitDepth(t.bitsPerSample),l=t.sampleFormat;let p=n*r;const o=getDataArray$1(p,1,s,l),x=t.compression,P=t.rowsPerStrip*n,he=t.stripOffsets,nt=t.stripByteCounts;for(var _e=0,Bt=0;Bt<he.length;Bt++){var Fn=this.getStripData(x,he[Bt],nt[Bt]),yr=p>P?P:p;p-=yr,s===8?_e=fill8bit$1(o,Fn,_e,yr):s===16?_e=fill16bit$1(o,Fn,_e,yr,this.isLittleEndian()):s===32&&l===3?_e=fillFloat32$1(o,Fn,_e,yr,this.isLittleEndian()):unsupported$1("bitDepth",s)}t.data=o}getStripData(t,n,r){switch(t){case 1:return new DataView(this.buffer,n,r);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,t,n,r){return n===8?new Uint8Array(e*t):n===16?new Uint16Array(e*t):n===32&&r===3?new Float32Array(e*t):unsupported$1("bit depth / sample format",n+" / "+r)}function fill8bit$1(e,t,n,r){for(var s=0;s<r;s++)e[n++]=t.getUint8(s);return n}function fill16bit$1(e,t,n,r,s){for(var l=0;l<r*2;l+=2)e[n++]=t.getUint16(l,s);return n}function fillFloat32$1(e,t,n,r,s){for(var l=0;l<r*4;l+=4)e[n++]=t.getFloat32(l,s);return n}function unsupported$1(e,t){throw new Error("Unsupported "+e+": "+t)}function validateBitDepth(e){if(e.length){const n=e;e=n[0];for(var t=0;t<n.length;t++)n[t]!==e&&unsupported$1("bit depth",n)}return e}const TIFFDecoder$1=tiffDecoder;var decode$3=function(t,n){return new TIFFDecoder$1(t,n).decode(n)};src$4.decode=decode$3;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$2(e){const t=new IOBuffer(e),n={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const l=t.readBytes(6);if(l[0]===69&&l[1]===120&&l[2]===105&&l[3]===102&&l[4]===0&&l[5]===0){const p=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});n.exif=p}}return n}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,t=0){let n=e[t],r=1,s=0;for(;++s<8;)r*=256,n+=e[t+s]*r;return n}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t&&t.length>1))return null;const n=(s,l)=>{l=Object.assign({offset:0},l);for(let p=0;p<s.length;p++)if(l.mask){if(s[p]!==(l.mask[p]&t[p+l.offset]))return!1}else if(s[p]!==t[p+l.offset])return!1;return!0},r=(s,l)=>n(toBytes(s),l);if(n([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(n([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(n([71,73,70]))return{ext:"gif",mime:"image/gif"};if(n([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(n([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((n([73,73,42,0])||n([77,77,0,42]))&&n([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(n([73,73,42,0])||n([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(n([66,77]))return{ext:"bmp",mime:"image/bmp"};if(n([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(n([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(n([80,75,3,4])){if(n([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(n(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(r("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(r("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(r("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const s=(x,M=0)=>x.findIndex((P,he,nt)=>he>=M&&nt[he]===80&&nt[he+1]===75&&nt[he+2]===3&&nt[he+3]===4);let l=0,p=!1,o=null;do{const x=l+30;if(p||(p=n(oxmlContentTypes,{offset:x})||n(oxmlRels,{offset:x})),o||(r("word/",{offset:x})?o={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:r("ppt/",{offset:x})?o={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:r("xl/",{offset:x})&&(o={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),p&&o)return o;l=s(t,x)}while(l>=0);if(o)return o}if(n([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(n([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(n([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(n([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(n([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(n([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(n([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(n([51,103,112,53])||n([0,0,0])&&n([102,116,121,112],{offset:4})&&(n([109,112,52,49],{offset:8})||n([109,112,52,50],{offset:8})||n([105,115,111,109],{offset:8})||n([105,115,111,50],{offset:8})||n([109,109,112,52],{offset:8})||n([77,52,86],{offset:8})||n([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(n([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(n([26,69,223,163])){const s=t.subarray(4,4100),l=s.findIndex((p,o,x)=>x[o]===66&&x[o+1]===130);if(l!==-1){const p=l+3,o=x=>[...x].every((M,P)=>s[p+P]===M.charCodeAt(0));if(o("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(o("webm"))return{ext:"webm",mime:"video/webm"}}}if(n([0,0,0,20,102,116,121,112,113,116,32,32])||n([102,114,101,101],{offset:4})||n([102,116,121,112,113,116,32,32],{offset:4})||n([109,100,97,116],{offset:4})||n([109,111,111,118],{offset:4})||n([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(n([82,73,70,70])){if(n([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(n([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(n([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(n([48,38,178,117,142,102,207,17,166,217])){let s=30;do{const l=readUInt64LE(t,s+16);if(n([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:s})){if(n([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(n([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}s+=l}while(s+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(n([0,0,1,186])||n([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(n([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let s=0;s<2&&s<t.length-16;s++){if(n([73,68,51],{offset:s})||n([255,226],{offset:s,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(n([255,228],{offset:s,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(n([255,248],{offset:s,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(n([255,240],{offset:s,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(n([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(n([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(n([79,103,103,83]))return n([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:n([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:n([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:n([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:n([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(n([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(n([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(n([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(n([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(n([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(n([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&n([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(n([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(n([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(n([119,79,70,70])&&(n([0,1,0,0],{offset:4})||n([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(n([119,79,70,50])&&(n([0,1,0,0],{offset:4})||n([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(n([76,80],{offset:34})&&(n([0,0,1],{offset:8})||n([1,0,2],{offset:8})||n([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(n([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(n([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(n([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(n([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(n([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(n([37,33]))return{ext:"ps",mime:"application/postscript"};if(n([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(n([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(n([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(n([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(n([77,83,67,70])||n([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(n([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(n([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(n([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(n([31,160])||n([31,157]))return{ext:"Z",mime:"application/x-compress"};if(n([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(n([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(n([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(n([71],{offset:4})&&(n([71],{offset:192})||n([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(n([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(n([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(n([0,0,0,12,106,80,32,32,13,10,135,10])){if(n([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(n([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(n([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(n([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(n([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(r("<?xml "))return{ext:"xml",mime:"application/xml"};if(n([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(n([102,116,121,112],{offset:4})){if(n([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(n([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(n([104,101,105,99],{offset:8})||n([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(n([104,101,118,99],{offset:8})||n([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return n([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:n([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:n([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:n([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:n([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:n([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:n([212,195,178,161])||n([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(t)}catch(n){reject(n)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const t=fileType(e);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(e,t,n){let r=0;for(;r<e.length;){for(let s=n;s<t*n;s+=n)for(let l=0;l<n;l++)e[r+s+l]=e[r+s+l]+e[r+s-(n-l)]&255;r+=t*n}}function applyHorizontalDifferencing16Bit(e,t,n){let r=0;for(;r<e.length;){for(let s=n;s<t*n;s+=n)for(let l=0;l<n;l++)e[r+s+l]=e[r+s+l]+e[r+s-(n-l)]&65535;r+=t*n}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let n of this.fields.keys())t[n]&&(this._map[t[n]]=this.fields.get(n));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,t){const n=types.get(e);if(!n)throw new Error(`type not found: ${e}`);return n[0]*t}function readData(e,t,n){const r=types.get(t);if(!r)throw new Error(`type not found: ${t}`);return r[1](e,n)}function readByte(e,t){if(t===1)return e.readUint8();let n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.readUint8();return n}function readASCII(e,t){let n=[],r="";for(let s=0;s<t;s++){let l=String.fromCharCode(e.readUint8());l==="\0"?(n.push(r),r=""):r+=l}return n.length===1?n[0]:n}function readShort(e,t){if(t===1)return e.readUint16();let n=new Uint16Array(t);for(let r=0;r<t;r++)n[r]=e.readUint16();return n}function readLong(e,t){if(t===1)return e.readUint32();let n=new Uint32Array(t);for(let r=0;r<t;r++)n[r]=e.readUint32();return n}function readRational(e,t){if(t===1)return e.readUint32()/e.readUint32();let n=new Array(t);for(let r=0;r<t;r++)n[r]=e.readUint32()/e.readUint32();return n}function readSByte(e,t){if(t===1)return e.readInt8();let n=new Int8Array(t);for(let r=0;r<t;r++)n[r]=e.readInt8();return n}function readSShort(e,t){if(t===1)return e.readInt16();let n=new Int16Array(t);for(let r=0;r<t;r++)n[r]=e.readInt16();return n}function readSLong(e,t){if(t===1)return e.readInt32();let n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=e.readInt32();return n}function readSRational(e,t){if(t===1)return e.readInt32()/e.readInt32();let n=new Array(t);for(let r=0;r<t;r++)n[r]=e.readInt32()/e.readInt32();return n}function readFloat(e,t){if(t===1)return e.readFloat32();let n=new Float32Array(t);for(let r=0;r<t;r++)n[r]=e.readFloat32();return n}function readDouble(e,t){if(t===1)return e.readFloat64();let n=new Float64Array(t);for(let r=0;r<t;r++)n[r]=e.readFloat64();return n}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const e=[];for(let t=256;t<4096;t++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,n=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),n=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(n).concat(this.stringFromCode(t)[0])),n=t;else{const s=this.stringFromCode(n).concat(this.stringFromCode(n)[0]);this.writeString(s),this.addStringToTable(s),n=t}const r=this.outData.toArray();return new DataView(r.buffer,r.byteOffset,r.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,n=dateTimeRegex.exec(this.dateTime);if(n===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(n[1]),Number(n[2])-1,Number(n[3])),t.setHours(Number(n[4]),Number(n[5]),Number(n[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,n=this.get("ColorMap");if(!n)return;if(n.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const r=[];for(let s=0;s<t;s++)r.push([n[s],n[s+t],n[s+2*t]]);return r}}function alwaysArray(e){return typeof e=="number"?[e]:e}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,t,n,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,n)=>{e.bi_valid>Buf_size-n?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=n-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},send_code=(e,t,n)=>{send_bits(e,n[t*2],n[t*2+1])},bi_reverse=(e,t)=>{let n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const n=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let M,P,he,nt,_e,Bt,Fn=0;for(nt=0;nt<=MAX_BITS$1;nt++)e.bl_count[nt]=0;for(n[e.heap[e.heap_max]*2+1]=0,M=e.heap_max+1;M<HEAP_SIZE$1;M++)P=e.heap[M],nt=n[n[P*2+1]*2+1]+1,nt>x&&(nt=x,Fn++),n[P*2+1]=nt,!(P>r)&&(e.bl_count[nt]++,_e=0,P>=o&&(_e=p[P-o]),Bt=n[P*2],e.opt_len+=Bt*(nt+_e),l&&(e.static_len+=Bt*(s[P*2+1]+_e)));if(Fn!==0){do{for(nt=x-1;e.bl_count[nt]===0;)nt--;e.bl_count[nt]--,e.bl_count[nt+1]+=2,e.bl_count[x]--,Fn-=2}while(Fn>0);for(nt=x;nt!==0;nt--)for(P=e.bl_count[nt];P!==0;)he=e.heap[--M],!(he>r)&&(n[he*2+1]!==nt&&(e.opt_len+=(nt-n[he*2+1])*n[he*2],n[he*2+1]=nt),P--)}},gen_codes=(e,t,n)=>{const r=new Array(MAX_BITS$1+1);let s=0,l,p;for(l=1;l<=MAX_BITS$1;l++)s=s+n[l-1]<<1,r[l]=s;for(p=0;p<=t;p++){let o=e[p*2+1];o!==0&&(e[p*2]=bi_reverse(r[o]++,o))}},tr_static_init=()=>{let e,t,n,r,s;const l=new Array(MAX_BITS$1+1);for(n=0,r=0;r<LENGTH_CODES$1-1;r++)for(base_length[r]=n,e=0;e<1<<extra_lbits[r];e++)_length_code[n++]=r;for(_length_code[n-1]=r,s=0,r=0;r<16;r++)for(base_dist[r]=s,e=0;e<1<<extra_dbits[r];e++)_dist_code[s++]=r;for(s>>=7;r<D_CODES$1;r++)for(base_dist[r]=s<<7,e=0;e<1<<extra_dbits[r]-7;e++)_dist_code[256+s++]=r;for(t=0;t<=MAX_BITS$1;t++)l[t]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,l[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,l[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,l[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,l[8]++;for(gen_codes(static_ltree,L_CODES$1+1,l),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,t,n,r)=>{const s=t*2,l=n*2;return e[s]<e[l]||e[s]===e[l]&&r[t]<=r[n]},pqdownheap=(e,t,n)=>{const r=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&smaller(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!smaller(t,r,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=r},compress_block=(e,t,n)=>{let r,s,l=0,p,o;if(e.sym_next!==0)do r=e.pending_buf[e.sym_buf+l++]&255,r+=(e.pending_buf[e.sym_buf+l++]&255)<<8,s=e.pending_buf[e.sym_buf+l++],r===0?send_code(e,s,t):(p=_length_code[s],send_code(e,p+LITERALS$1+1,t),o=extra_lbits[p],o!==0&&(s-=base_length[p],send_bits(e,s,o)),r--,p=d_code(r),send_code(e,p,n),o=extra_dbits[p],o!==0&&(r-=base_dist[p],send_bits(e,r,o)));while(l<e.sym_next);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems;let p,o,x=-1,M;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,p=0;p<l;p++)n[p*2]!==0?(e.heap[++e.heap_len]=x=p,e.depth[p]=0):n[p*2+1]=0;for(;e.heap_len<2;)M=e.heap[++e.heap_len]=x<2?++x:0,n[M*2]=1,e.depth[M]=0,e.opt_len--,s&&(e.static_len-=r[M*2+1]);for(t.max_code=x,p=e.heap_len>>1;p>=1;p--)pqdownheap(e,n,p);M=l;do p=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=p,e.heap[--e.heap_max]=o,n[M*2]=n[p*2]+n[o*2],e.depth[M]=(e.depth[p]>=e.depth[o]?e.depth[p]:e.depth[o])+1,n[p*2+1]=n[o*2+1]=M,e.heap[1]=M++,pqdownheap(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(n,x,e.bl_count)},scan_tree=(e,t,n)=>{let r,s=-1,l,p=t[0*2+1],o=0,x=7,M=4;for(p===0&&(x=138,M=3),t[(n+1)*2+1]=65535,r=0;r<=n;r++)l=p,p=t[(r+1)*2+1],!(++o<x&&l===p)&&(o<M?e.bl_tree[l*2]+=o:l!==0?(l!==s&&e.bl_tree[l*2]++,e.bl_tree[REP_3_6*2]++):o<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,o=0,s=l,p===0?(x=138,M=3):l===p?(x=6,M=3):(x=7,M=4))},send_tree=(e,t,n)=>{let r,s=-1,l,p=t[0*2+1],o=0,x=7,M=4;for(p===0&&(x=138,M=3),r=0;r<=n;r++)if(l=p,p=t[(r+1)*2+1],!(++o<x&&l===p)){if(o<M)do send_code(e,l,e.bl_tree);while(--o!==0);else l!==0?(l!==s&&(send_code(e,l,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));o=0,s=l,p===0?(x=138,M=3):l===p?(x=6,M=3):(x=7,M=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&e.bl_tree[bl_order[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,n,r)=>{let s;for(send_bits(e,t-257,5),send_bits(e,n-1,5),send_bits(e,r-4,4),s=0;s<r;s++)send_bits(e,e.bl_tree[bl_order[s]*2+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,n-1)},detect_data_type=e=>{let t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(n=32;n<LITERALS$1;n++)if(e.dyn_ltree[n*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,n,r)=>{send_bits(e,(STORED_BLOCK<<1)+(r?1:0),3),bi_windup(e),put_short(e,n),put_short(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,n,r)=>{let s,l,p=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),p=build_bl_tree(e),s=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=s&&(s=l)):s=l=n+5,n+4<=s&&t!==-1?_tr_stored_block$1(e,t,n,r):e.strategy===Z_FIXED$1||l===s?(send_bits(e,(STATIC_TREES<<1)+(r?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(r?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,p+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),r&&bi_windup(e)},_tr_tally$1=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code[n]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,n,r)=>{let s=e&65535|0,l=e>>>16&65535|0,p=0;for(;n!==0;){p=n>2e3?2e3:n,n-=p;do s=s+t[r++]|0,l=l+s|0;while(--p);s%=65521,l%=65521}return s|l<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t},crcTable=new Uint32Array(makeTable()),crc32=(e,t,n,r)=>{const s=crcTable,l=r+n;e^=-1;for(let p=r;p<l;p++)e=e>>>8^s[(e^t[p])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>e*2-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash=e=>{let t,n,r,s=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=s?n-s:0;while(--t);t=s,r=t;do n=e.prev[--r],e.prev[r]=n>=s?n-s:0;while(--t)};let HASH_ZLIB=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf=(e,t,n,r)=>{let s=e.avail_in;return s>r&&(s=r),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=adler32_1(e.adler,t,s,n):e.state.wrap===2&&(e.adler=crc32_1(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},longest_match=(e,t)=>{let n=e.max_chain_length,r=e.strstart,s,l,p=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,M=e.window,P=e.w_mask,he=e.prev,nt=e.strstart+MAX_MATCH;let _e=M[r+p-1],Bt=M[r+p];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do if(s=t,!(M[s+p]!==Bt||M[s+p-1]!==_e||M[s]!==M[r]||M[++s]!==M[r+1])){r+=2,s++;do;while(M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&M[++r]===M[++s]&&r<nt);if(l=MAX_MATCH-(nt-r),r=nt-MAX_MATCH,l>p){if(e.match_start=t,p=l,l>=o)break;_e=M[r+p-1],Bt=M[r+p]}}while((t=he[t&P])>x&&--n!==0);return p<=e.lookahead?p:e.lookahead},fill_window=e=>{const t=e.w_size;let n,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),r+=t),e.strm.avail_in===0)break;if(n=read_buf(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=MIN_MATCH)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=HASH(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[s+MIN_MATCH-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,t)=>{let n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r,s,l,p=0,o=e.strm.avail_in;do{if(r=65535,l=e.bi_valid+42>>3,e.strm.avail_out<l||(l=e.strm.avail_out-l,s=e.strstart-e.block_start,r>s+e.strm.avail_in&&(r=s+e.strm.avail_in),r>l&&(r=l),r<n&&(r===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||r!==s+e.strm.avail_in)))break;p=t===Z_FINISH$3&&r===s+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,p),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,flush_pending(e.strm),s&&(s>r&&(s=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,r-=s),r&&(read_buf(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(p===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),p?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(l=e.window_size-e.strstart,e.strm.avail_in>l&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,l+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),l>e.strm.avail_in&&(l=e.strm.avail_in),l&&(read_buf(e.strm,e.window,e.strstart,l),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.high_water<e.strstart&&(e.high_water=e.strstart),l=e.bi_valid+42>>3,l=e.pending_buf_size-l>65535?65535:e.pending_buf_size-l,n=l>e.w_size?e.w_size:l,s=e.strstart-e.block_start,(s>=n||(s||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&s<=l)&&(r=s>l?l:s,p=t===Z_FINISH$3&&e.strm.avail_in===0&&r===s?1:0,_tr_stored_block(e,e.block_start,r,p),e.block_start+=r,flush_pending(e.strm)),p?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,t)=>{let n,r;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,n)),e.match_length>=MIN_MATCH)if(r=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let n,r,s;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,n),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-MIN_MATCH,r=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(r=_tr_tally(e,0,e.window[e.strstart-1]),r&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let n,r,s,l;const p=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(s=e.strstart-1,r=p[s],r===p[++s]&&r===p[++s]&&r===p[++s])){l=e.strstart+MAX_MATCH;do;while(r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&r===p[++s]&&s<l);e.match_length=MAX_MATCH-(l-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(n=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let n;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,n,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=s}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,n,r,s,l)=>{if(!e)return Z_STREAM_ERROR$2;let p=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),r<0?(p=0,r=-r):r>15&&(p=2,r-=16),s<1||s>MAX_MEM_LEVEL||n!==Z_DEFLATED$2||r<8||r>15||t<0||t>9||l<0||l>Z_FIXED||r===8&&p!==1)return err(e,Z_STREAM_ERROR$2);r===8&&(r=9);const o=new DeflateState;return e.state=o,o.strm=e,o.status=INIT_STATE,o.wrap=p,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH-1)/MIN_MATCH),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=l,o.method=n,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{if(deflateStateCheck(e)||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(flush_pending(e),e.avail_out===0)return n.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(t)<=rank(r)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(n.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(n.status===INIT_STATE&&n.wrap===0&&(n.status=BUSY_STATE),n.status===INIT_STATE){let s=Z_DEFLATED$2+(n.w_bits-8<<4)<<8,l=-1;if(n.strategy>=Z_HUFFMAN_ONLY||n.level<2?l=0:n.level<6?l=1:n.level===6?l=2:l=3,s|=l<<6,n.strstart!==0&&(s|=PRESET_DICT),s+=31-s%31,putShortMSB(n,s),n.strstart!==0&&(putShortMSB(n,e.adler>>>16),putShortMSB(n,e.adler&65535)),e.adler=1,n.status=BUSY_STATE,flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3}if(n.status===GZIP_STATE){if(e.adler=0,put_byte(n,31),put_byte(n,139),put_byte(n,8),n.gzhead)put_byte(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),put_byte(n,n.gzhead.time&255),put_byte(n,n.gzhead.time>>8&255),put_byte(n,n.gzhead.time>>16&255),put_byte(n,n.gzhead.time>>24&255),put_byte(n,n.level===9?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(put_byte(n,n.gzhead.extra.length&255),put_byte(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=EXTRA_STATE;else if(put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,n.level===9?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,OS_CODE),n.status=BUSY_STATE,flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3}if(n.status===EXTRA_STATE){if(n.gzhead.extra){let s=n.pending,l=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let o=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=o,flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3;s=0,l-=o}let p=new Uint8Array(n.gzhead.extra);n.pending_buf.set(p.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=NAME_STATE}if(n.status===NAME_STATE){if(n.gzhead.name){let s=n.pending,l;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s)),flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3;s=0}n.gzindex<n.gzhead.name.length?l=n.gzhead.name.charCodeAt(n.gzindex++)&255:l=0,put_byte(n,l)}while(l!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=COMMENT_STATE}if(n.status===COMMENT_STATE){if(n.gzhead.comment){let s=n.pending,l;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s)),flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3;s=0}n.gzindex<n.gzhead.comment.length?l=n.gzhead.comment.charCodeAt(n.gzindex++)&255:l=0,put_byte(n,l)}while(l!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-s,s))}n.status=HCRC_STATE}if(n.status===HCRC_STATE){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(flush_pending(e),n.pending!==0))return n.last_flush=-1,Z_OK$3;put_byte(n,e.adler&255),put_byte(n,e.adler>>8&255),e.adler=0}if(n.status=BUSY_STATE,flush_pending(e),n.pending!==0)return n.last_flush=-1,Z_OK$3}if(e.avail_in!==0||n.lookahead!==0||t!==Z_NO_FLUSH$2&&n.status!==FINISH_STATE){let s=n.level===0?deflate_stored(n,t):n.strategy===Z_HUFFMAN_ONLY?deflate_huff(n,t):n.strategy===Z_RLE?deflate_rle(n,t):configuration_table[n.level].func(n,t);if((s===BS_FINISH_STARTED||s===BS_FINISH_DONE)&&(n.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return e.avail_out===0&&(n.last_flush=-1),Z_OK$3;if(s===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(n):t!==Z_BLOCK$1&&(_tr_stored_block(n,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),flush_pending(e),e.avail_out===0))return n.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:n.wrap<=0?Z_STREAM_END$3:(n.wrap===2?(put_byte(n,e.adler&255),put_byte(n,e.adler>>8&255),put_byte(n,e.adler>>16&255),put_byte(n,e.adler>>24&255),put_byte(n,e.total_in&255),put_byte(n,e.total_in>>8&255),put_byte(n,e.total_in>>16&255),put_byte(n,e.total_in>>24&255)):(putShortMSB(n,e.adler>>>16),putShortMSB(n,e.adler&65535)),flush_pending(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const t=e.state.status;return e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,t)=>{let n=t.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const r=e.state,s=r.wrap;if(s===2||s===1&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR$2;if(s===1&&(e.adler=adler32_1(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){s===0&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0);let x=new Uint8Array(r.w_size);x.set(t.subarray(n-r.w_size,n),0),t=x,n=r.w_size}const l=e.avail_in,p=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=MIN_MATCH;){let x=r.strstart,M=r.lookahead-(MIN_MATCH-1);do r.ins_h=HASH(r,r.ins_h,r.window[x+MIN_MATCH-1]),r.prev[x&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=x,x++;while(--M);r.strstart=x,r.lookahead=MIN_MATCH-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,e.next_in=p,e.input=o,e.avail_in=l,r.wrap=s,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)_has(n,r)&&(e[r]=n[r])}}return e},flattenChunks=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,s=0,l=e.length;r<l;r++){let p=e[r];n.set(p,s),s+=p.length}return n},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,s,l,p=e.length,o=0;for(s=0;s<p;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<p&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),l=0,s=0;l<o;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<p&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|n&63):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|n&63):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|n&63);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n};var buf2string=(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,s;const l=new Array(n*2);for(s=0,r=0;r<n;){let p=e[r++];if(p<128){l[s++]=p;continue}let o=_utf8len[p];if(o>4){l[s++]=65533,r+=o-1;continue}for(p&=o===2?31:o===3?15:7;o>1&&r<n;)p=p<<6|e[r++]&63,o--;if(o>1){l[s++]=65533;continue}p<65536?l[s++]=p:(p-=65536,l[s++]=55296|p>>10&1023,l[s++]=56320|p&1023)}return buf2binstring(l,s)},utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(e[n]&192)===128;)n--;return n<0||n===0?t:n+_utf8len[e[n]]>t?n:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let n=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Z_OK$2)throw new Error(messages[n]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(typeof t.dictionary=="string"?r=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(t.dictionary):r=t.dictionary,n=deflate_1$2.deflateSetDictionary(this.strm,r),n!==Z_OK$2)throw new Error(messages[n]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let s,l;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?n.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(l===Z_SYNC_FLUSH||l===Z_FULL_FLUSH)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(s=deflate_1$2.deflate(n,l),s===Z_STREAM_END$2)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=deflate_1$2.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Z_OK$2;if(n.avail_out===0){this.onData(n.output);continue}if(l>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const BAD$1=16209,TYPE$1=16191;var inffast=function e(t,n){let r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr,Io,rl,Co,as,Js,lh,ch,Zu,th,sl;const sh=t.state;r=t.next_in,th=t.input,s=r+(t.avail_in-5),l=t.next_out,sl=t.output,p=l-(n-t.avail_out),o=l+(t.avail_out-257),x=sh.dmax,M=sh.wsize,P=sh.whave,he=sh.wnext,nt=sh.window,_e=sh.hold,Bt=sh.bits,Fn=sh.lencode,yr=sh.distcode,Io=(1<<sh.lenbits)-1,rl=(1<<sh.distbits)-1;e:do{Bt<15&&(_e+=th[r++]<<Bt,Bt+=8,_e+=th[r++]<<Bt,Bt+=8),Co=Fn[_e&Io];t:for(;;){if(as=Co>>>24,_e>>>=as,Bt-=as,as=Co>>>16&255,as===0)sl[l++]=Co&65535;else if(as&16){Js=Co&65535,as&=15,as&&(Bt<as&&(_e+=th[r++]<<Bt,Bt+=8),Js+=_e&(1<<as)-1,_e>>>=as,Bt-=as),Bt<15&&(_e+=th[r++]<<Bt,Bt+=8,_e+=th[r++]<<Bt,Bt+=8),Co=yr[_e&rl];i:for(;;){if(as=Co>>>24,_e>>>=as,Bt-=as,as=Co>>>16&255,as&16){if(lh=Co&65535,as&=15,Bt<as&&(_e+=th[r++]<<Bt,Bt+=8,Bt<as&&(_e+=th[r++]<<Bt,Bt+=8)),lh+=_e&(1<<as)-1,lh>x){t.msg="invalid distance too far back",sh.mode=BAD$1;break e}if(_e>>>=as,Bt-=as,as=l-p,lh>as){if(as=lh-as,as>P&&sh.sane){t.msg="invalid distance too far back",sh.mode=BAD$1;break e}if(ch=0,Zu=nt,he===0){if(ch+=M-as,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}}else if(he<as){if(ch+=M+he-as,as-=he,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);if(ch=0,he<Js){as=he,Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}}}else if(ch+=he-as,as<Js){Js-=as;do sl[l++]=nt[ch++];while(--as);ch=l-lh,Zu=sl}for(;Js>2;)sl[l++]=Zu[ch++],sl[l++]=Zu[ch++],sl[l++]=Zu[ch++],Js-=3;Js&&(sl[l++]=Zu[ch++],Js>1&&(sl[l++]=Zu[ch++]))}else{ch=l-lh;do sl[l++]=sl[ch++],sl[l++]=sl[ch++],sl[l++]=sl[ch++],Js-=3;while(Js>2);Js&&(sl[l++]=sl[ch++],Js>1&&(sl[l++]=sl[ch++]))}}else if(as&64){t.msg="invalid distance code",sh.mode=BAD$1;break e}else{Co=yr[(Co&65535)+(_e&(1<<as)-1)];continue i}break}}else if(as&64)if(as&32){sh.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",sh.mode=BAD$1;break e}else{Co=Fn[(Co&65535)+(_e&(1<<as)-1)];continue t}break}}while(r<s&&l<o);Js=Bt>>3,r-=Js,Bt-=Js<<3,_e&=(1<<Bt)-1,t.next_in=r,t.next_out=l,t.avail_in=r<s?5+(s-r):5-(r-s),t.avail_out=l<o?257+(o-l):257-(l-o),sh.hold=_e,sh.bits=Bt};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,n,r,s,l,p,o)=>{const x=o.bits;let M=0,P=0,he=0,nt=0,_e=0,Bt=0,Fn=0,yr=0,Io=0,rl=0,Co,as,Js,lh,ch,Zu=null,th;const sl=new Uint16Array(MAXBITS+1),sh=new Uint16Array(MAXBITS+1);let xh=null,Mh,Dh,Uh;for(M=0;M<=MAXBITS;M++)sl[M]=0;for(P=0;P<r;P++)sl[t[n+P]]++;for(_e=x,nt=MAXBITS;nt>=1&&sl[nt]===0;nt--);if(_e>nt&&(_e=nt),nt===0)return s[l++]=1<<24|64<<16|0,s[l++]=1<<24|64<<16|0,o.bits=1,0;for(he=1;he<nt&&sl[he]===0;he++);for(_e<he&&(_e=he),yr=1,M=1;M<=MAXBITS;M++)if(yr<<=1,yr-=sl[M],yr<0)return-1;if(yr>0&&(e===CODES$1||nt!==1))return-1;for(sh[1]=0,M=1;M<MAXBITS;M++)sh[M+1]=sh[M]+sl[M];for(P=0;P<r;P++)t[n+P]!==0&&(p[sh[t[n+P]]++]=P);if(e===CODES$1?(Zu=xh=p,th=20):e===LENS$1?(Zu=lbase,xh=lext,th=257):(Zu=dbase,xh=dext,th=0),rl=0,P=0,M=he,ch=l,Bt=_e,Fn=0,Js=-1,Io=1<<_e,lh=Io-1,e===LENS$1&&Io>ENOUGH_LENS$1||e===DISTS$1&&Io>ENOUGH_DISTS$1)return 1;for(;;){Mh=M-Fn,p[P]+1<th?(Dh=0,Uh=p[P]):p[P]>=th?(Dh=xh[p[P]-th],Uh=Zu[p[P]-th]):(Dh=32+64,Uh=0),Co=1<<M-Fn,as=1<<Bt,he=as;do as-=Co,s[ch+(rl>>Fn)+as]=Mh<<24|Dh<<16|Uh|0;while(as!==0);for(Co=1<<M-1;rl&Co;)Co>>=1;if(Co!==0?(rl&=Co-1,rl+=Co):rl=0,P++,--sl[M]===0){if(M===nt)break;M=t[n+p[P]]}if(M>_e&&(rl&lh)!==Js){for(Fn===0&&(Fn=_e),ch+=he,Bt=M-Fn,yr=1<<Bt;Bt+Fn<nt&&(yr-=sl[Bt+Fn],!(yr<=0));)Bt++,yr<<=1;if(Io+=1<<Bt,e===LENS$1&&Io>ENOUGH_LENS$1||e===DISTS$1&&Io>ENOUGH_DISTS$1)return 1;Js=rl&lh,s[Js]=_e<<24|Bt<<16|ch-l|0}}return rl!==0&&(s[ch+rl]=M-Fn<<24|64<<16|0),o.bits=_e,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let n;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return t<0?(n=0,t=-t):(n=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const n=new InflateState;e.state=n,n.strm=e,n.window=null,n.mode=HEAD;const r=inflateReset2(e,t);return r!==Z_OK$1&&(e.state=null),r},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,n,r)=>{let s;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(s=l.wsize-l.wnext,s>r&&(s=r),l.window.set(t.subarray(n-r,n-r+s),l.wnext),r-=s,r?(l.window.set(t.subarray(n-r,n),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=s,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=s))),0},inflate$2=(e,t)=>{let n,r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr=0,Io,rl,Co,as,Js,lh,ch,Zu;const th=new Uint8Array(4);let sl,sh;const xh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;n=e.state,n.mode===TYPE&&(n.mode=TYPEDO),p=e.next_out,s=e.output,x=e.avail_out,l=e.next_in,r=e.input,o=e.avail_in,M=n.hold,P=n.bits,he=o,nt=x,Zu=Z_OK$1;e:for(;;)switch(n.mode){case HEAD:if(n.wrap===0){n.mode=TYPEDO;break}for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&2&&M===35615){n.wbits===0&&(n.wbits=15),n.check=0,th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1(n.check,th,2,0),M=0,P=0,n.mode=FLAGS;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((M&255)<<8)+(M>>8))%31){e.msg="incorrect header check",n.mode=BAD;break}if((M&15)!==Z_DEFLATED){e.msg="unknown compression method",n.mode=BAD;break}if(M>>>=4,P-=4,ch=(M&15)+8,n.wbits===0&&(n.wbits=ch),ch>15||ch>n.wbits){e.msg="invalid window size",n.mode=BAD;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=M&512?DICTID:TYPE,M=0,P=0;break;case FLAGS:for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.flags=M,(n.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",n.mode=BAD;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=BAD;break}n.head&&(n.head.text=M>>8&1),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1(n.check,th,2,0)),M=0,P=0,n.mode=TIME;case TIME:for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.head&&(n.head.time=M),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,th[2]=M>>>16&255,th[3]=M>>>24&255,n.check=crc32_1(n.check,th,4,0)),M=0,P=0,n.mode=OS;case OS:for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.head&&(n.head.xflags=M&255,n.head.os=M>>8),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1(n.check,th,2,0)),M=0,P=0,n.mode=EXLEN;case EXLEN:if(n.flags&1024){for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.length=M,n.head&&(n.head.extra_len=M),n.flags&512&&n.wrap&4&&(th[0]=M&255,th[1]=M>>>8&255,n.check=crc32_1(n.check,th,2,0)),M=0,P=0}else n.head&&(n.head.extra=null);n.mode=EXTRA;case EXTRA:if(n.flags&1024&&(_e=n.length,_e>o&&(_e=o),_e&&(n.head&&(ch=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(l,l+_e),ch)),n.flags&512&&n.wrap&4&&(n.check=crc32_1(n.check,r,_e,l)),o-=_e,l+=_e,n.length-=_e),n.length))break e;n.length=0,n.mode=NAME;case NAME:if(n.flags&2048){if(o===0)break e;_e=0;do ch=r[l+_e++],n.head&&ch&&n.length<65536&&(n.head.name+=String.fromCharCode(ch));while(ch&&_e<o);if(n.flags&512&&n.wrap&4&&(n.check=crc32_1(n.check,r,_e,l)),o-=_e,l+=_e,ch)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=COMMENT;case COMMENT:if(n.flags&4096){if(o===0)break e;_e=0;do ch=r[l+_e++],n.head&&ch&&n.length<65536&&(n.head.comment+=String.fromCharCode(ch));while(ch&&_e<o);if(n.flags&512&&n.wrap&4&&(n.check=crc32_1(n.check,r,_e,l)),o-=_e,l+=_e,ch)break e}else n.head&&(n.head.comment=null);n.mode=HCRC;case HCRC:if(n.flags&512){for(;P<16;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&4&&M!==(n.check&65535)){e.msg="header crc mismatch",n.mode=BAD;break}M=0,P=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=TYPE;break;case DICTID:for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}e.adler=n.check=zswap32(M),M=0,P=0,n.mode=DICT;case DICT:if(n.havedict===0)return e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,Z_NEED_DICT$1;e.adler=n.check=1,n.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(n.last){M>>>=P&7,P-=P&7,n.mode=CHECK;break}for(;P<3;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}switch(n.last=M&1,M>>>=1,P-=1,M&3){case 0:n.mode=STORED;break;case 1:if(fixedtables(n),n.mode=LEN_,t===Z_TREES){M>>>=2,P-=2;break e}break;case 2:n.mode=TABLE;break;case 3:e.msg="invalid block type",n.mode=BAD}M>>>=2,P-=2;break;case STORED:for(M>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if((M&65535)!==(M>>>16^65535)){e.msg="invalid stored block lengths",n.mode=BAD;break}if(n.length=M&65535,M=0,P=0,n.mode=COPY_,t===Z_TREES)break e;case COPY_:n.mode=COPY;case COPY:if(_e=n.length,_e){if(_e>o&&(_e=o),_e>x&&(_e=x),_e===0)break e;s.set(r.subarray(l,l+_e),p),o-=_e,l+=_e,x-=_e,p+=_e,n.length-=_e;break}n.mode=TYPE;break;case TABLE:for(;P<14;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.nlen=(M&31)+257,M>>>=5,P-=5,n.ndist=(M&31)+1,M>>>=5,P-=5,n.ncode=(M&15)+4,M>>>=4,P-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=BAD;break}n.have=0,n.mode=LENLENS;case LENLENS:for(;n.have<n.ncode;){for(;P<3;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.lens[xh[n.have++]]=M&7,M>>>=3,P-=3}for(;n.have<19;)n.lens[xh[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,sl={bits:n.lenbits},Zu=inftrees(CODES,n.lens,0,19,n.lencode,0,n.work,sl),n.lenbits=sl.bits,Zu){e.msg="invalid code lengths set",n.mode=BAD;break}n.have=0,n.mode=CODELENS;case CODELENS:for(;n.have<n.nlen+n.ndist;){for(;yr=n.lencode[M&(1<<n.lenbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(Co<16)M>>>=Io,P-=Io,n.lens[n.have++]=Co;else{if(Co===16){for(sh=Io+2;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(M>>>=Io,P-=Io,n.have===0){e.msg="invalid bit length repeat",n.mode=BAD;break}ch=n.lens[n.have-1],_e=3+(M&3),M>>>=2,P-=2}else if(Co===17){for(sh=Io+3;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=Io,P-=Io,ch=0,_e=3+(M&7),M>>>=3,P-=3}else{for(sh=Io+7;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=Io,P-=Io,ch=0,_e=11+(M&127),M>>>=7,P-=7}if(n.have+_e>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=BAD;break}for(;_e--;)n.lens[n.have++]=ch}}if(n.mode===BAD)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=BAD;break}if(n.lenbits=9,sl={bits:n.lenbits},Zu=inftrees(LENS,n.lens,0,n.nlen,n.lencode,0,n.work,sl),n.lenbits=sl.bits,Zu){e.msg="invalid literal/lengths set",n.mode=BAD;break}if(n.distbits=6,n.distcode=n.distdyn,sl={bits:n.distbits},Zu=inftrees(DISTS,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,sl),n.distbits=sl.bits,Zu){e.msg="invalid distances set",n.mode=BAD;break}if(n.mode=LEN_,t===Z_TREES)break e;case LEN_:n.mode=LEN;case LEN:if(o>=6&&x>=258){e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,inffast(e,nt),p=e.next_out,s=e.output,x=e.avail_out,l=e.next_in,r=e.input,o=e.avail_in,M=n.hold,P=n.bits,n.mode===TYPE&&(n.back=-1);break}for(n.back=0;yr=n.lencode[M&(1<<n.lenbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(rl&&!(rl&240)){for(as=Io,Js=rl,lh=Co;yr=n.lencode[lh+((M&(1<<as+Js)-1)>>as)],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(as+Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=as,P-=as,n.back+=as}if(M>>>=Io,P-=Io,n.back+=Io,n.length=Co,rl===0){n.mode=LIT;break}if(rl&32){n.back=-1,n.mode=TYPE;break}if(rl&64){e.msg="invalid literal/length code",n.mode=BAD;break}n.extra=rl&15,n.mode=LENEXT;case LENEXT:if(n.extra){for(sh=n.extra;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.length+=M&(1<<n.extra)-1,M>>>=n.extra,P-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=DIST;case DIST:for(;yr=n.distcode[M&(1<<n.distbits)-1],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(!(rl&240)){for(as=Io,Js=rl,lh=Co;yr=n.distcode[lh+((M&(1<<as+Js)-1)>>as)],Io=yr>>>24,rl=yr>>>16&255,Co=yr&65535,!(as+Io<=P);){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}M>>>=as,P-=as,n.back+=as}if(M>>>=Io,P-=Io,n.back+=Io,rl&64){e.msg="invalid distance code",n.mode=BAD;break}n.offset=Co,n.extra=rl&15,n.mode=DISTEXT;case DISTEXT:if(n.extra){for(sh=n.extra;P<sh;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}n.offset+=M&(1<<n.extra)-1,M>>>=n.extra,P-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=BAD;break}n.mode=MATCH;case MATCH:if(x===0)break e;if(_e=nt-x,n.offset>_e){if(_e=n.offset-_e,_e>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=BAD;break}_e>n.wnext?(_e-=n.wnext,Bt=n.wsize-_e):Bt=n.wnext-_e,_e>n.length&&(_e=n.length),Fn=n.window}else Fn=s,Bt=p-n.offset,_e=n.length;_e>x&&(_e=x),x-=_e,n.length-=_e;do s[p++]=Fn[Bt++];while(--_e);n.length===0&&(n.mode=LEN);break;case LIT:if(x===0)break e;s[p++]=n.length,x--,n.mode=LEN;break;case CHECK:if(n.wrap){for(;P<32;){if(o===0)break e;o--,M|=r[l++]<<P,P+=8}if(nt-=x,e.total_out+=nt,n.total+=nt,n.wrap&4&&nt&&(e.adler=n.check=n.flags?crc32_1(n.check,s,nt,p-nt):adler32_1(n.check,s,nt,p-nt)),nt=x,n.wrap&4&&(n.flags?M:zswap32(M))!==n.check){e.msg="incorrect data check",n.mode=BAD;break}M=0,P=0}n.mode=LENGTH;case LENGTH:if(n.wrap&&n.flags){for(;P<32;){if(o===0)break e;o--,M+=r[l++]<<P,P+=8}if(n.wrap&4&&M!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=BAD;break}M=0,P=0}n.mode=DONE;case DONE:Zu=Z_STREAM_END$1;break e;case BAD:Zu=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=p,e.avail_out=x,e.next_in=l,e.avail_in=o,n.hold=M,n.bits=P,(n.wsize||nt!==e.avail_out&&n.mode<BAD&&(n.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,nt-e.avail_out),he-=e.avail_in,nt-=e.avail_out,e.total_in+=he,e.total_out+=nt,n.total+=nt,n.wrap&4&&nt&&(e.adler=n.check=n.flags?crc32_1(n.check,s,nt,e.next_out-nt):adler32_1(n.check,s,nt,e.next_out-nt)),e.data_type=n.bits+(n.last?64:0)+(n.mode===TYPE?128:0)+(n.mode===LEN_||n.mode===COPY_?256:0),(he===0&&nt===0||t===Z_FINISH$1)&&Zu===Z_OK$1&&(Zu=Z_BUF_ERROR),Zu},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return n.wrap&2?(n.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(e,t)=>{const n=t.length;let r,s,l;return inflateStateCheck(e)||(r=e.state,r.wrap!==0&&r.mode!==DICT)?Z_STREAM_ERROR$1:r.mode===DICT&&(s=1,s=adler32_1(s,t,n,0),s!==r.check)?Z_DATA_ERROR$1:(l=updatewindow(e,t,n,n),l?(r.mode=MEM,Z_MEM_ERROR$1):(r.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$3=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let n=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(n!==Z_OK)throw new Error(messages[n]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),n!==Z_OK)))throw new Error(messages[n])}Inflate$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let l,p,o;if(this.ended)return!1;for(t===~~t?p=t:p=t===!0?Z_FINISH:Z_NO_FLUSH,toString$3.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),l=inflate_1$2.inflate(n,p),l===Z_NEED_DICT&&s&&(l=inflate_1$2.inflateSetDictionary(n,s),l===Z_OK?l=inflate_1$2.inflate(n,p):l===Z_DATA_ERROR&&(l=Z_NEED_DICT));n.avail_in>0&&l===Z_STREAM_END&&n.state.wrap>0&&e[n.next_in]!==0;)inflate_1$2.inflateReset(n),l=inflate_1$2.inflate(n,p);switch(l){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(l),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(n.avail_out===0||l===Z_STREAM_END))if(this.options.to==="string"){let x=strings.utf8border(n.output,n.next_out),M=n.next_out-x,P=strings.buf2string(n.output,x);n.next_out=M,n.avail_out=r-M,M&&n.output.set(n.output.subarray(x,x+M),0),this.onData(P)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(l===Z_OK&&o===0)){if(l===Z_STREAM_END)return l=inflate_1$2.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,t){const n=new Inflate$1(t);if(n.push(e),n.err)throw n.msg||messages[n.err];return n.result}function inflateRaw$1(e,t){return t=t||{},t.raw=!0,inflate$1(e,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$a=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$a};const{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var inflate_1=inflate;function decompressZlib(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=inflate_1(t);return new DataView(n.buffer,n.byteOffset,n.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const n=[];for(this.decodeHeader();this._nextIFD;)if(n.push(this.decodeIFD(t,!0)),t.onlyFirst)return[n[0]];return n}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,n){this.seek(this._nextIFD);let r;if(n)r=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");r=new IFD(t.kind)}const s=this.readUint16();for(let l=0;l<s;l++)this.decodeIFDEntry(r);if(!t.ignoreImageData){if(!(r instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(r)}return this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const n=this.offset,r=this.readUint16(),s=this.readUint16(),l=this.readUint32();if(s<1||s>12){this.skip(4);return}getByteLength(s,l)>4&&this.seek(this.readUint32());const o=readData(this,s,l);if(t.fields.set(r,o),r===34665||r===34853){let x=this.offset,M="exif";r===34665?M="exif":r===34853&&(M="gps"),this._nextIFD=o,t[M]=this.decodeIFD({kind:M,ignoreImageData:!0},!1),this.offset=x}this.seek(n),this.skip(12)}decodeImageData(t){const n=t.orientation;if(n&&n!==1)throw unsupported("orientation",n);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const r=t.bitsPerSample,s=Math.pow(2,r)-1;for(let l=0;l<t.data.length;l++)t.data[l]=s-t.data[l]}}readStripData(t){const n=t.width,r=t.height,s=t.bitsPerSample,l=t.sampleFormat,p=n*r*t.samplesPerPixel,o=getDataArray(p,s,l),M=t.rowsPerStrip*n*t.samplesPerPixel,P=t.stripOffsets,he=t.stripByteCounts||guessStripByteCounts(t);let nt=p,_e=0;for(let Bt=0;Bt<P.length;Bt++){let Fn=new DataView(this.buffer,this.byteOffset+P[Bt],he[Bt]),yr=nt>M?M:nt;nt-=yr;let Io=Fn;switch(t.compression){case 1:break;case 5:{Io=decompressLzw(Fn);break}case 8:{Io=decompressZlib(Fn);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}_e=this.fillUncompressed(s,l,o,Io,_e,yr)}t.data=o}fillUncompressed(t,n,r,s,l,p){if(t===8)return fill8bit(r,s,l,p);if(t===16)return fill16bit(r,s,l,p,this.isLittleEndian());if(t===32&&n===3)return fillFloat32(r,s,l,p,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const n=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(n===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(n===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${n}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:n,components:r,maxSampleValue:s}=t;for(let l=0;l<n.length;l+=r){const p=n[l+r-1];for(let o=0;o<r-1;o++)n[l+o]=Math.round(n[l+o]*s/p)}}}}function getDataArray(e,t,n){if(t===8)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&n===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${t} / ${n}`)}function fill8bit(e,t,n,r){for(let s=0;s<r;s++)e[n++]=t.getUint8(s);return n}function fill16bit(e,t,n,r,s){for(let l=0;l<r*2;l+=2)e[n++]=t.getUint16(l,s);return n}function fillFloat32(e,t,n,r,s){for(let l=0;l<r*4;l+=4)e[n++]=t.getFloat32(l,s);return n}function unsupported(e,t){return new Error(`Unsupported ${e}: ${t}`)}function decodeTIFF(e,t){return new TIFFDecoder(e).decode(t)}function matchAndCrop(e={}){let{algorithm:t="matchToPrevious",ignoreBorder:n=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let r=t==="matchToPrevious",s=this[0],l=[];l[0]={position:[0,0],image:this[0]};let p=[0,0];for(let nt=1;nt<this.length;nt++){let _e=s.getBestMatch(this[nt],{border:n});l[nt]={position:[_e[0]+p[0],_e[1]+p[1]],image:this[nt]},r&&(p[0]+=_e[0],p[1]+=_e[1],s=this[nt])}let o=0,x=0,M=0,P=0;for(let nt=0;nt<l.length;nt++){let _e=l[nt];_e.position[0]>o&&(o=_e.position[0]),_e.position[0]<x&&(x=_e.position[0]),_e.position[1]>M&&(M=_e.position[1]),_e.position[1]<P&&(P=_e.position[1])}x=0-x,P=0-P;for(let nt=0;nt<l.length;nt++){let _e=l[nt];_e.crop=_e.image.crop({x:o-_e.position[0],y:M-_e.position[1],width:s.width-x-o,height:s.height-P-M})}let he=[];for(let nt=0;nt<l.length;nt++)he[nt]=l[nt].crop;return new Stack(he)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let t=1;t<this.length;t++)for(let n=0;n<e.length;n++)e[n]=Math.min(e[n],this[t].min[n]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let t=1;t<this.length;t++)for(let n=0;n<e.length;n++)e[n]=Math.max(e[n],this[t].max[n]);return e}function median$2(e){let t=e.reduce((p,o)=>p+o);if(t===0)throw new Error("unreachable");let n=0,r=0,s=t/2,l;for(;;){if(e[n]>0){if(l!==void 0)return(l+n)/2;if(r+=e[n],r>s)return n;r===s&&(l=n)}n++}}function mean$2(e){let t=0,n=0;for(let r=0;r<e.length;r++)t+=e[r],n+=e[r]*r;return t===0?0:n/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let r=e[n];t[n]=median$2(r)}return t}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(e);for(let n=1;n<this.length;n++){let r=this[n].getHistogram(e);for(let s=0;s<t.length;s++)t[s]+=r[s]}return t}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(e),n=t[0].length;for(let r=1;r<this.length;r++){let s=this[r].getHistograms(e);for(let l=0;l<t.length;l++)for(let p=0;p<n;p++)t[l][p]+=s[l][p]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let r=0;r<this.length;r++){let s=this[r];for(let l=0;l<this[0].data.length;l++)e[l]+=s.data[l]}let t=Image$1.createFrom(this[0]),n=t.data;for(let r=0;r<this[0].data.length;r++)n[r]=e[r]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(0);for(const t of this)for(let n=0;n<e.data.length;n++)e.data[n]=Math.max(t.data[n],e.data[n]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(e.maxValue);for(const t of this)for(let n=0;n<e.data.length;n++)e.data[n]=Math.min(t.data[n],e.data[n]);return e}function extend$5(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let n=0;n<t.length;n++)this[n]=t[n]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image$1.load)).then(n=>new Stack(n))}static extendMethod(t,n,r={}){let{inPlace:s=!1,returnThis:l=!0,partialArgs:p=[]}=r;return s?Stack.prototype[t]=function(...o){this.computed=null;let x=n.apply(this,[...p,...o]);return l?this:x}:Stack.prototype[t]=function(...o){return n.apply(this,[...p,...o])},Stack}static extendProperty(t,n,r={}){let{partialArgs:s=[]}=r;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let l=n.apply(this,s);return this.computed[t]=l,l},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor),Stack}checkProcessable(t,n={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,n);for(let r=1;r<this.length;r++){if((n.sameSize===void 0||n.sameSize)&&this[0].width!==this[r].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((n.sameSize===void 0||n.sameSize)&&this[0].height!==this[r].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((n.sameAlpha===void 0||n.sameAlpha)&&this[0].alpha!==this[r].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((n.sameBitDepth===void 0||n.sameBitDepth)&&this[0].bitDepth!==this[r].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((n.sameColorModel===void 0||n.sameColorModel)&&this[0].colorModel!==this[r].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((n.sameNumberChannels===void 0||n.sameNumberChannels)&&this[0].channels!==this[r].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(e,t){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let n=new Stack(this.length);for(let r=0;r<this.length;r++)n[r]=e.call(t,this[r],r,this);return n});extend$5(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,t){if(typeof e=="string")return loadURL(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,t&&t.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,t,n){const r=imageType$1(e);if(r)switch(r.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,n);default:return loadGeneric(s(r.mime))}return loadGeneric(s("application/octet-stream"));function s(l){return t||toBase64URL(e,l)}}function loadURL(e,t){const n=e.slice(0,64).match(isDataURL);let r;return n!==null?r=Promise.resolve(decode$4(e.slice(n[0].length))):r=fetchBinary(e,t),r.then(s=>{const l=new Uint8Array(s);return loadBinary(l,n?e:void 0,t&&t.ignorePalette)})}function loadPNG(e){const t=decodePng(e);let n=t.channels,r,s=0;return n===2||n===4?(r=n-1,s=1):r=n,t.palette?loadPNGFromPalette(t):new Image$1(t.width,t.height,t.data,{components:r,alpha:s,bitDepth:t.depth})}function loadPNGFromPalette(e){const t=e.width*e.height,n=e.palette[0].length,r=new Uint8Array(t*n),s=8/e.depth,l=e.depth<8?s:1,p=parseInt("1".repeat(e.depth),2),o=n===4;let x=0;for(let M=0;M<t;M++){const P=Math.floor(M/l);let he=e.data[P];e.depth<8&&(he=he>>>e.depth*(s-1-M%s)&p);const nt=e.palette[he];r[x++]=nt[0],r[x++]=nt[1],r[x++]=nt[2],o&&(r[x++]=nt[3])}return new Image$1(e.width,e.height,r,{components:3,alpha:o,bitDepth:8})}function loadJPEG(e){const t=decode$1(e);let n;t.exif&&(n=getMetadata(t.exif));const r=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let s=new Image$1(r.width,r.height,r.data,{meta:n});if(n&&n.tiff.tags.Orientation){const l=n.tiff.tags.Orientation;l>2&&(s=s.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[l])),[2,4,5,7].includes(l)&&(s=s.flipX())}return s}function loadTIFF(e,t){let n=decodeTIFF(e);return n.length===1?getImageFromIFD(n[0],t):new Stack(n.map(function(r){return getImageFromIFD(r,t)}))}function getMetadata(e){const t={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function getImageFromIFD(e,t){if(!t&&e.type===3){const n=new Uint16Array(3*e.width*e.height),r=e.palette;let s=0;for(let l=0;l<e.data.length;l++){const p=e.data[l],o=r[p];n[s++]=o[0],n[s++]=o[1],n[s++]=o[2]}return new Image$1(e.width,e.height,n,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image$1(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,t){return t=t||{},new Promise(function(n,r){let s=new DOMImage;s.onload=function(){let l=s.width,p=s.height,x=createCanvas(l,p).getContext("2d");x.drawImage(s,0,0,l,p);let M=x.getImageData(0,0,l,p).data;n(new Image$1(l,p,M,t))},s.onerror=function(){r(new Error(`Could not load ${e}`))},s.src=e})}const valueMethods={getValueXY(e,t,n){return this.data[(t*this.width+e)*this.channels+n]},setValueXY(e,t,n,r){return this.data[(t*this.width+e)*this.channels+n]=r,this.computed=null,this},getValue(e,t){return this.data[e*this.channels+t]},setValue(e,t,n){return this.data[e*this.channels+t]=n,this.computed=null,this},getPixelXY(e,t){return this.getPixel(t*this.width+e)},setPixelXY(e,t,n){return this.setPixel(t*this.width+e,n)},getPixel(e){const t=new Array(this.channels),n=e*this.channels;for(let r=0;r<this.channels;r++)t[r]=this.data[n+r];return t},setPixel(e,t){const n=e*this.channels;for(let r=0;r<t.length;r++)this.data[n+r]=t[r];return this.computed=null,this}};function setValueMethods(e){for(const t in valueMethods)e.prototype[t]=valueMethods[t]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,t,n,r={}){const{out:s}=t;if(s===void 0)return r.copy?e.clone():Image$1.createFrom(e,n);{if(!Image$1.isImage(s))throw new TypeError("out must be an Image object");const l=Object.assign(getImageParameters(e),n);for(const p in l)if(s[p]!==l[p])throw new RangeError(`cannot use out. Its ${p} must be "${l[p]}" (found "${s[p]}")`);return s}}function getOutputImageOrInPlace(e,t,n){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,t,null,n)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,e);return absolute(this,t),t}function absolute(e,t){for(let n=0;n<e.data.length;n++)t.data[n]=Math.abs(e.data[n])}function copyAlphaChannel(e,t){if(e.alpha===1&&t.alpha===1)for(let n=0;n<e.size;n++)t.data[n*t.channels+t.components]=e.data[n*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(e,t){for(let n=0;n<e.data.length;n++)t.data[n]=~e.data[n]}function invertColor(e,t){for(let n=0;n<e.data.length;n+=e.channels)for(let r=0;r<e.components;r++)t.data[n+r]=e.maxValue-e.data[n+r]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let t=e*this.width*this.channels;for(let n=0;n<Math.floor(this.width/2);n++){let r=n*this.channels+t,s=(this.width-n-1)*this.channels+t;for(let l=0;l<this.channels;l++){let p=this.data[r+l];this.data[r+l]=this.data[s+l],this.data[s+l]=p}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let t=0;t<this.width;t++){let n=t*this.channels+e*this.width*this.channels,r=t*this.channels+(this.height-1-e)*this.channels*this.width;for(let s=0;s<this.channels;s++){let l=this.data[n+s];this.data[n+s]=this.data[r+s],this.data[r+s]=l}}return this}function blurFilter(e={}){const{radius:t=1}=e;if(t<1)throw new Error("radius must be greater than 1");const n=2*t+1,r=new Array(n);for(let s=0;s<n;s++){r[s]=new Array(n);for(let l=0;l<n;l++)r[s][l]=1/(n*n)}return this.convolution(r)}var medianQuickselect_min={exports:{}};(function(e){(function(){function t(s){for(var l=0,p=s.length-1,o=void 0,x=void 0,M=void 0,P=r(l,p);;){if(p<=l)return s[P];if(p==l+1)return s[l]>s[p]&&n(s,l,p),s[P];for(o=r(l,p),s[o]>s[p]&&n(s,o,p),s[l]>s[p]&&n(s,l,p),s[o]>s[l]&&n(s,o,l),n(s,o,l+1),x=l+1,M=p;;){do x++;while(s[l]>s[x]);do M--;while(s[M]>s[l]);if(M<x)break;n(s,x,M)}n(s,l,M),M<=P&&(l=x),M>=P&&(p=M-1)}}var n=function(l,p,o){var x;return x=[l[o],l[p]],l[p]=x[0],l[o]=x[1],x},r=function(l,p){return~~((l+p)/2)};e.exports?e.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(e,t={}){let{channels:n,allowAlpha:r,defaultAlpha:s}=t;return typeof r!="boolean"&&(r=!0),typeof n>"u"?allChannels(e,s):validateChannels(e,n,r)}function allChannels(e,t){let n=t?e.channels:e.components,r=new Array(n);for(let s=0;s<n;s++)r[s]=s;return r}function validateChannels(e,t,n){Array.isArray(t)||(t=[t]);for(let r=0;r<t.length;r++)t[r]=validateChannel(e,t[r],n);return t}function validateChannel(e,t,n=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof t=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(t==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=e.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!n&&t>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(e={}){let{radius:t=1,border:n="copy",channels:r}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");r=validateArrayOfChannels(this,r);let s=t,l=t,p=Image$1.createFrom(this),o=(s*2+1)*(l*2+1),x=new Array(o);for(let M=0;M<r.length;M++){let P=r[M];for(let he=l;he<this.height-l;he++)for(let nt=s;nt<this.width-s;nt++){let _e=0;for(let Fn=-l;Fn<=l;Fn++)for(let yr=-s;yr<=s;yr++){let Io=((he+Fn)*this.width+nt+yr)*this.channels+P;x[_e++]=this.data[Io]}let Bt=(he*this.width+nt)*this.channels+P;p.data[Bt]=quickSelectMedian(x)}}if(this.alpha&&!r.includes(this.channels))for(let M=this.components;M<this.data.length;M=M+this.channels)p.data[M]=this.data[M];return p.setBorder({size:[s,l],algorithm:n}),p}function gaussianFilter(e={}){let{radius:t=1,sigma:n,channels:r,border:s="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const l=getKernel(t,n);return this.convolution([l,l],{border:s,channels:r,algorithm:"separable"})}function getKernel(e,t){const n=e*2+1,r=new Array(n),s=t||((n-1)*.5-1)*.3+.8,l=-.5/(s*s);let p=0;for(let o=0;o<n;o++){const x=o-e,M=Math.exp(l*x*x);r[o]=M,p+=M}for(let o=0;o<n;o++)r[o]/=p;return r}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var t;t=e;var n={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+n.release+", released "+n.date};for(var r=0,s=null,l=null,p={init:function(M){if(M!==0&&!(M&M-1))r=M,p._initArray(),p._makeBitReversalTable(),p._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(M,P){p.fft(M,P,1)},ifft1d:function(M,P){var he=1/r;p.fft(M,P,-1);for(var nt=0;nt<r;nt++)M[nt]*=he,P[nt]*=he},bt1d:function(M,P){p.fft(M,P,-1)},fft2d:function(M,P){for(var he=[],nt=[],_e=0,Bt=0;Bt<r;Bt++){_e=Bt*r;for(var Fn=0;Fn<r;Fn++)he[Fn]=M[Fn+_e],nt[Fn]=P[Fn+_e];p.fft1d(he,nt);for(var yr=0;yr<r;yr++)M[yr+_e]=he[yr],P[yr+_e]=nt[yr]}for(var Io=0;Io<r;Io++){for(var rl=0;rl<r;rl++)_e=Io+rl*r,he[rl]=M[_e],nt[rl]=P[_e];p.fft1d(he,nt);for(var Co=0;Co<r;Co++)_e=Io+Co*r,M[_e]=he[Co],P[_e]=nt[Co]}},ifft2d:function(M,P){for(var he=[],nt=[],_e=0,Bt=0;Bt<r;Bt++){_e=Bt*r;for(var Fn=0;Fn<r;Fn++)he[Fn]=M[Fn+_e],nt[Fn]=P[Fn+_e];p.ifft1d(he,nt);for(var yr=0;yr<r;yr++)M[yr+_e]=he[yr],P[yr+_e]=nt[yr]}for(var Io=0;Io<r;Io++){for(var rl=0;rl<r;rl++)_e=Io+rl*r,he[rl]=M[_e],nt[rl]=P[_e];p.ifft1d(he,nt);for(var Co=0;Co<r;Co++)_e=Io+Co*r,M[_e]=he[Co],P[_e]=nt[Co]}},fft:function(M,P,he){for(var nt,_e,Bt,Fn,yr,Io,rl,Co,as,Js=r>>2,lh=0;lh<r;lh++)Fn=s[lh],lh<Fn&&(yr=M[lh],M[lh]=M[Fn],M[Fn]=yr,yr=P[lh],P[lh]=P[Fn],P[Fn]=yr);for(var ch=1;ch<r;ch<<=1){_e=0,nt=r/(ch<<1);for(var Zu=0;Zu<ch;Zu++){Io=l[_e+Js],rl=he*l[_e];for(var th=Zu;th<r;th+=ch<<1)Bt=th+ch,Co=Io*M[Bt]+rl*P[Bt],as=Io*P[Bt]-rl*M[Bt],M[Bt]=M[th]-Co,M[th]+=Co,P[Bt]=P[th]-as,P[th]+=as;_e+=nt}}},_initArray:function(){typeof Uint32Array<"u"?s=new Uint32Array(r):s=[],typeof Float64Array<"u"?l=new Float64Array(r*1.25):l=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var M=0,P=0,he=0;for(s[0]=0;++M<r;){for(he=r>>1;he<=P;)P-=he,he>>=1;P+=he,s[M]=P}},_makeCosSinTable:function(){var M=r>>1,P=r>>2,he=r>>3,nt=M+P,_e=Math.sin(Math.PI/r),Bt=2*_e*_e,Fn=Math.sqrt(Bt*(2-Bt)),yr=l[P]=1,Io=l[0]=0;_e=2*Bt;for(var rl=1;rl<he;rl++)yr-=Bt,Bt+=_e*yr,Io+=Fn,Fn-=_e*Io,l[rl]=Io,l[P-rl]=yr;he!==0&&(l[he]=Math.sqrt(.5));for(var Co=0;Co<P;Co++)l[M-Co]=l[Co];for(var as=0;as<nt;as++)l[as+M]=-l[as]}},o=["init","fft1d","ifft1d","fft2d","ifft2d"],x=0;x<o.length;x++)t[o[x]]=p[o[x]];return t.bt=p.bt1d,t.fft=p.fft1d,t.ifft=p.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,t,n){var r=new Array(t*n),s=t/2,l=(n-1)*2;FFT$1.init(s);for(var p={re:new Array(s),im:new Array(s)},o=0;o<n;o++){for(var x=s-1;x>=0;x--)p.re[x]=e[x*2*n+o],p.im[x]=e[(x*2+1)*n+o];FFT$1.bt(p.re,p.im);for(var x=s-1;x>=0;x--)r[x*2*n+o]=p.re[x],r[(x*2+1)*n+o]=p.im[x]}var M=new Array(s*l);FFT$1.init(l);for(var P={re:new Array(l),im:new Array(l)},he=l*s,x=0;x<t;x+=2){P.re[0]=r[x*n],P.im[0]=r[(x+1)*n];for(var o=1;o<n;o++)P.re[o]=r[x*n+o],P.im[o]=r[(x+1)*n+o],P.re[l-o]=r[x*n+o],P.im[l-o]=-r[(x+1)*n+o];FFT$1.bt(P.re,P.im);for(var nt=x/2*l,o=l-1;o>=0;o--)M[nt+o]=P.re[o]/he}return M},fft2DArray:function(e,t,n,r){Object.assign({},{inplace:!0});var s=n/2+1,l=t*2,p=new Array(l*s);FFT$1.init(n);for(var o={re:new Array(n),im:new Array(n)},x={re:new Array(n),im:new Array(n)},M={re:new Array(n),im:new Array(n)},P,he,nt,_e,Bt,Fn=0;Fn<t/2;Fn++){P=Fn*2*n,o.re=e.slice(P,P+n),P=(Fn*2+1)*n,o.im=e.slice(P,P+n),FFT$1.fft1d(o.re,o.im),this.reconstructTwoRealFFT(o,x,M),he=Fn*4*s,nt=(Fn*4+1)*s,_e=(Fn*4+2)*s,Bt=(Fn*4+3)*s;for(var yr=s-1;yr>=0;yr--)p[he+yr]=x.re[yr],p[nt+yr]=x.im[yr],p[_e+yr]=M.re[yr],p[Bt+yr]=M.im[yr]}x=null,M=null;var Io=new Array(l*s);FFT$1.init(t);for(var rl={re:new Array(t),im:new Array(t)},Co=s-1;Co>=0;Co--){for(var Fn=t-1;Fn>=0;Fn--)rl.re[Fn]=p[Fn*2*s+Co],rl.im[Fn]=p[(Fn*2+1)*s+Co],isNaN(rl.re[Fn])&&(rl.re[Fn]=0),isNaN(rl.im[Fn])&&(rl.im[Fn]=0);FFT$1.fft1d(rl.re,rl.im);for(var Fn=t-1;Fn>=0;Fn--)Io[Fn*2*s+Co]=rl.re[Fn],Io[(Fn*2+1)*s+Co]=rl.im[Fn]}return Io},reconstructTwoRealFFT:function(e,t,n){var r=e.re.length;t.re[0]=e.re[0],t.im[0]=0,n.re[0]=e.im[0],n.im[0]=0;for(var s,l,p,o,x,M=r/2;M>0;M--)x=r-M,s=.5*(e.re[M]-e.re[x]),l=.5*(e.re[M]+e.re[x]),p=.5*(e.im[M]-e.im[x]),o=.5*(e.im[M]+e.im[x]),t.re[M]=l,t.im[M]=p,t.re[x]=l,t.im[x]=-p,n.re[M]=o,n.im[M]=-s,n.re[x]=o,n.im[x]=s},convolute2DI:function(e,t,n,r){for(var s,l,p=0;p<n/2;p++)for(var o=0;o<r;o++)s=e[p*2*r+o]*t[p*2*r+o]-e[(p*2+1)*r+o]*t[(p*2+1)*r+o],l=e[p*2*r+o]*t[(p*2+1)*r+o]+e[(p*2+1)*r+o]*t[p*2*r+o],e[p*2*r+o]=s,e[(p*2+1)*r+o]=l},convolute:function(e,t,n,r,s){for(var l=new Array(r*n),p=0;p<n*r;p++)l[p]=e[p];l=this.fft2DArray(l,n,r);for(var o=t.length,x=t[0].length,M=new Array(r*n),p=0;p<r*n;p++)M[p]=0;for(var P,he,nt=Math.floor((o-1)/2),_e=Math.floor((x-1)/2),Bt=0;Bt<o;Bt++){P=(Bt-nt+n)%n;for(var Fn=0;Fn<x;Fn++)he=(Fn-_e+r)%r,M[P*r+he]=t[Bt][Fn]}M=this.fft2DArray(M,n,r);var yr=n*2,Io=r/2+1;return this.convolute2DI(l,M,yr,Io),this.ifft2DArray(l,yr,Io)},toRadix2:function(e,t,n){var r,s,l,p,o=n,x=t;if(!(n!==0&&!(n&n-1))){for(o=0;n>>++o;);o=1<<o}if(!(t!==0&&!(t&t-1))){for(x=0;t>>++x;);x=1<<x}if(x==t&&o==n)return{data:e,rows:t,cols:n};var M=new Array(x*o),P=Math.floor((x-t)/2)-t,he=Math.floor((o-n)/2)-n;for(r=0;r<x;r++)for(l=r*o,p=(r-P)%t*n,s=0;s<o;s++)M[l+s]=e[p+(s-he)%n];return{data:M,rows:x,cols:o}},crop:function(e,t,n,r,s,l){if(t==r&&n==s)return e;Object.assign({},l);var p=new Array(s*r),o=Math.floor((t-r)/2),x=Math.floor((n-s)/2),M,P,he,nt;for(he=0;he<r;he++)for(M=he*s,P=(he+o)*n,nt=0;nt<s;nt++)p[M+nt]=e[P+(nt+x)];return p}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,t,n){var r=matrix2Array(e),s=r.data,l=Object.assign({normalize:!1,divisor:1,rows:r.rows,cols:r.cols},n),p,o;if(l.rows&&l.cols)p=l.rows,o=l.cols;else throw new Error("Invalid number of rows or columns "+p+" "+o);var x=l.divisor,M,P,he=t.length,nt=t[0].length;if(l.normalize)for(x=0,M=0;M<he;M++)for(P=0;P<nt;P++)x+=t[M][P];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var _e=FFTUtils.toRadix2(s,p,o),Bt=FFTUtils.convolute(_e.data,t,_e.rows,_e.cols);if(Bt=FFTUtils.crop(Bt,_e.rows,_e.cols,p,o),x!=0&&x!=1)for(M=0;M<Bt.length;M++)Bt[M]/=x;return Bt}function convolutionDirect(e,t,n){var r=matrix2Array(e),s=r.data,l=Object.assign({normalize:!1,divisor:1,rows:r.rows,cols:r.cols},n),p,o;if(l.rows&&l.cols)p=l.rows,o=l.cols;else throw new Error("Invalid number of rows or columns "+p+" "+o);var x=l.divisor,M=t.length,P=t[0].length,he,nt,_e,Bt,Fn,yr,Io,rl,Co;if(l.normalize)for(x=0,he=0;he<M;he++)for(nt=0;nt<P;nt++)x+=t[he][nt];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var as=new Array(p*o),Js=Math.floor(M/2),lh=Math.floor(P/2);for(Bt=0;Bt<p;Bt++)for(_e=0;_e<o;_e++){for(yr=0,nt=0;nt<M;nt++)for(he=0;he<P;he++)Io=t[M-nt-1][P-he-1],rl=(Bt+nt-Js+p)%p,Co=(_e+he-lh+o)%o,Fn=rl*o+Co,yr+=s[Fn]*Io;Fn=Bt*o+_e,as[Fn]=yr/x}return as}function LoG(e,t,n){var r=1e3;n&&n.factor&&(r=n.factor);var s=new Array(t),l,p,o,x;r*=-1;var M=(t-1)/2,P=2*e*e;for(l=0;l<t;l++)for(s[l]=new Array(t),x=(l-M)*(l-M),p=0;p<t;p++)o=-((p-M)*(p-M)+x)/P,s[l][p]=Math.round(r*(1+o)*Math.exp(o));return s}function matrix2Array(e){var t=e,n,r;if(typeof e[0]!="number"){n=e.length,r=e[0].length,t=new Array(n*r);for(var s=0;s<n;s++)for(var l=0;l<r;l++)t[s*r+l]=e[s][l]}else{var p=Math.sqrt(e.length);Number.isInteger(p)&&(n=p,r=p)}return{data:t,rows:n,cols:r}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(e){let t,n;if(Array.isArray(e))if(Array.isArray(e[0])){if(!(e.length&1)||!(e[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(e.length/2),n=Math.floor(e[0].length/2)}else{let r=Math.sqrt(e.length);if(isInteger$1(r))n=t=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let s=new Array(r);for(let l=0;l<r;l++){s[l]=new Array(r);for(let p=0;p<r;p++)s[l][p]=e[l*r+p]}e=s}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:n,kHeight:t}}function clamp(e,t){return Math.round(Math.min(Math.max(e,0),t.maxValue))}function directConvolution(e,t,n){if(n===void 0){const l=e.length+t.length-1;n=new Array(l)}fill(n);for(var r=0;r<e.length;r++)for(var s=0;s<t.length;s++)n[r+s]+=e[r]*t[s];return n}function fill(e){for(var t=0;t<e.length;t++)e[t]=0}function FFT(e){if(this.size=e|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),n=0;n<t.length;n+=2){const x=Math.PI*n/this.size;t[n]=Math.cos(x),t[n+1]=-Math.sin(x)}this.table=t;for(var r=0,s=1;this.size>s;s<<=1)r++;this._width=r%2===0?r-1:r,this._bitrev=new Array(1<<this._width);for(var l=0;l<this._bitrev.length;l++){this._bitrev[l]=0;for(var p=0;p<this._width;p+=2){var o=this._width-p-2;this._bitrev[l]|=(l>>>p&3)<<o}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function e(t,n){for(var r=n||new Array(t.length>>>1),s=0;s<t.length;s+=2)r[s>>>1]=t[s];return r};FFT.prototype.createComplexArray=function e(){const t=new Array(this._csize);for(var n=0;n<t.length;n++)t[n]=0;return t};FFT.prototype.toComplexArray=function e(t,n){for(var r=n||this.createComplexArray(),s=0;s<r.length;s+=2)r[s]=t[s>>>1],r[s+1]=0;return r};FFT.prototype.completeSpectrum=function e(t){for(var n=this._csize,r=n>>>1,s=2;s<r;s+=2)t[n-s]=t[s],t[n-s+1]=-t[s+1]};FFT.prototype.transform=function e(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function e(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function e(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=1,this._transform4();for(var r=0;r<t.length;r++)t[r]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function e(){var t=this._out,n=this._csize,r=this._width,s=1<<r,l=n/s<<1,p,o,x=this._bitrev;if(l===4)for(p=0,o=0;p<n;p+=l,o++){const Fn=x[o];this._singleTransform2(p,Fn,s)}else for(p=0,o=0;p<n;p+=l,o++){const Fn=x[o];this._singleTransform4(p,Fn,s)}var M=this._inv?-1:1,P=this.table;for(s>>=2;s>=2;s>>=2){l=n/s<<1;var he=l>>>2;for(p=0;p<n;p+=l)for(var nt=p+he,_e=p,Bt=0;_e<nt;_e+=2,Bt+=s){const Fn=_e,yr=Fn+he,Io=yr+he,rl=Io+he,Co=t[Fn],as=t[Fn+1],Js=t[yr],lh=t[yr+1],ch=t[Io],Zu=t[Io+1],th=t[rl],sl=t[rl+1],sh=Co,xh=as,Mh=P[Bt],Dh=M*P[Bt+1],Uh=Js*Mh-lh*Dh,cd=Js*Dh+lh*Mh,Tf=P[2*Bt],yf=M*P[2*Bt+1],Af=ch*Tf-Zu*yf,md=ch*yf+Zu*Tf,vd=P[3*Bt],qd=M*P[3*Bt+1],Ed=th*vd-sl*qd,Td=th*qd+sl*vd,Fd=sh+Af,Cd=xh+md,Gd=sh-Af,bf=xh-md,Id=Uh+Ed,td=cd+Td,$d=M*(Uh-Ed),np=M*(cd-Td),jf=Fd+Id,yd=Cd+td,Qd=Fd-Id,op=Cd-td,bp=Gd+np,fp=bf-$d,Qh=Gd-np,Yd=bf+$d;t[Fn]=jf,t[Fn+1]=yd,t[yr]=bp,t[yr+1]=fp,t[Io]=Qd,t[Io+1]=op,t[rl]=Qh,t[rl+1]=Yd}}};FFT.prototype._singleTransform2=function e(t,n,r){const s=this._out,l=this._data,p=l[n],o=l[n+1],x=l[n+r],M=l[n+r+1],P=p+x,he=o+M,nt=p-x,_e=o-M;s[t]=P,s[t+1]=he,s[t+2]=nt,s[t+3]=_e};FFT.prototype._singleTransform4=function e(t,n,r){const s=this._out,l=this._data,p=this._inv?-1:1,o=r*2,x=r*3,M=l[n],P=l[n+1],he=l[n+r],nt=l[n+r+1],_e=l[n+o],Bt=l[n+o+1],Fn=l[n+x],yr=l[n+x+1],Io=M+_e,rl=P+Bt,Co=M-_e,as=P-Bt,Js=he+Fn,lh=nt+yr,ch=p*(he-Fn),Zu=p*(nt-yr),th=Io+Js,sl=rl+lh,sh=Co+Zu,xh=as-ch,Mh=Io-Js,Dh=rl-lh,Uh=Co-Zu,cd=as+ch;s[t]=th,s[t+1]=sl,s[t+2]=sh,s[t+3]=xh,s[t+4]=Mh,s[t+5]=Dh,s[t+6]=Uh,s[t+7]=cd};FFT.prototype._realTransform4=function e(){var t=this._out,n=this._csize,r=this._width,s=1<<r,l=n/s<<1,p,o,x=this._bitrev;if(l===4)for(p=0,o=0;p<n;p+=l,o++){const Yf=x[o];this._singleRealTransform2(p,Yf>>>1,s>>>1)}else for(p=0,o=0;p<n;p+=l,o++){const Yf=x[o];this._singleRealTransform4(p,Yf>>>1,s>>>1)}var M=this._inv?-1:1,P=this.table;for(s>>=2;s>=2;s>>=2){l=n/s<<1;var he=l>>>1,nt=he>>>1,_e=nt>>>1;for(p=0;p<n;p+=l)for(var Bt=0,Fn=0;Bt<=_e;Bt+=2,Fn+=s){var yr=p+Bt,Io=yr+nt,rl=Io+nt,Co=rl+nt,as=t[yr],Js=t[yr+1],lh=t[Io],ch=t[Io+1],Zu=t[rl],th=t[rl+1],sl=t[Co],sh=t[Co+1],xh=as,Mh=Js,Dh=P[Fn],Uh=M*P[Fn+1],cd=lh*Dh-ch*Uh,Tf=lh*Uh+ch*Dh,yf=P[2*Fn],Af=M*P[2*Fn+1],md=Zu*yf-th*Af,vd=Zu*Af+th*yf,qd=P[3*Fn],Ed=M*P[3*Fn+1],Td=sl*qd-sh*Ed,Fd=sl*Ed+sh*qd,Cd=xh+md,Gd=Mh+vd,bf=xh-md,Id=Mh-vd,td=cd+Td,$d=Tf+Fd,np=M*(cd-Td),jf=M*(Tf-Fd),yd=Cd+td,Qd=Gd+$d,op=bf+jf,bp=Id-np;if(t[yr]=yd,t[yr+1]=Qd,t[Io]=op,t[Io+1]=bp,Bt===0){var fp=Cd-td,Qh=Gd-$d;t[rl]=fp,t[rl+1]=Qh;continue}if(Bt!==_e){var Yd=bf,ad=-Id,Zd=Cd,Xh=-Gd,Ld=-M*jf,Kf=-M*np,If=-M*$d,Df=-M*td,Jf=Yd+Ld,Nf=ad+Kf,Wf=Zd+Df,Cp=Xh-If,Tp=p+nt-Bt,Pp=p+he-Bt;t[Tp]=Jf,t[Tp+1]=Nf,t[Pp]=Wf,t[Pp+1]=Cp}}}};FFT.prototype._singleRealTransform2=function e(t,n,r){const s=this._out,l=this._data,p=l[n],o=l[n+r],x=p+o,M=p-o;s[t]=x,s[t+1]=0,s[t+2]=M,s[t+3]=0};FFT.prototype._singleRealTransform4=function e(t,n,r){const s=this._out,l=this._data,p=this._inv?-1:1,o=r*2,x=r*3,M=l[n],P=l[n+r],he=l[n+o],nt=l[n+x],_e=M+he,Bt=M-he,Fn=P+nt,yr=p*(P-nt),Io=_e+Fn,rl=Bt,Co=-yr,as=_e-Fn,Js=Bt,lh=yr;s[t]=Io,s[t+1]=0,s[t+2]=rl,s[t+3]=Co,s[t+4]=as,s[t+5]=0,s[t+6]=Js,s[t+7]=lh};function convolutionSeparable(e,t,n,r){const s=new Array(e.length);let l,p,o,x;x=t[1],o=(x.length-1)/2,p=new Array(n+x.length-1),l=new Array(n);for(let M=0;M<r;M++){for(let P=0;P<n;P++)l[P]=e[M*n+P];directConvolution(l,x,p);for(let P=0;P<n;P++)s[M*n+P]=p[o+P]}x=t[0],o=(x.length-1)/2,p=new Array(r+x.length-1),l=new Array(r);for(let M=0;M<n;M++){for(let P=0;P<r;P++)l[P]=s[P*n+M];directConvolution(l,x,p);for(let P=0;P<r;P++)s[P*n+M]=p[o+P]}return s}const toString$2=Object.prototype.toString;function isAnyArray(e){return toString$2.call(e).endsWith("Array]")}function max$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var n=t.fromIndex,r=n===void 0?0:n,s=t.toIndex,l=s===void 0?e.length:s;if(r<0||r>=e.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=r||l>e.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var p=e[r],o=r+1;o<l;o++)e[o]>p&&(p=e[o]);return p}function min$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var n=t.fromIndex,r=n===void 0?0:n,s=t.toIndex,l=s===void 0?e.length:s;if(r<0||r>=e.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=r||l>e.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var p=e[r],o=r+1;o<l;o++)e[o]<p&&(p=e[o]);return p}function rescale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var n;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");n=t.output}else n=new Array(e.length);var r=min$1(e),s=max$1(e);if(r===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=t.min,p=l===void 0?t.autoMinMax?r:0:l,o=t.max,x=o===void 0?t.autoMinMax?s:1:o;if(p>=x)throw new RangeError("min option must be smaller than max option");for(var M=(x-p)/(s-r),P=0;P<e.length;P++)n[P]=(e[P]-r)*M+p;return n}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,t={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:s=8,padMinus:l="auto"}=t;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,n,r,s,l)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,t,n,r,s){const{rows:l,columns:p}=e,o=Math.min(l,t),x=Math.min(p,n),M=[];if(s==="auto"){s=!1;e:for(let P=0;P<o;P++)for(let he=0;he<x;he++)if(e.get(P,he)<0){s=!0;break e}}for(let P=0;P<o;P++){let he=[];for(let nt=0;nt<x;nt++)he.push(formatNumber(e.get(P,nt),r,s));M.push(`${he.join(" ")}`)}return x!==p&&(M[M.length-1]+=` ... ${p-n} more columns`),o!==l&&M.push(`... ${l-t} more rows`),M.join(`
${indentData}`)}function formatNumber(e,t,n){return(e>=0&&n?` ${formatNumber2(e,t-1)}`:formatNumber2(e,t)).padEnd(t)}function formatNumber2(e,t){let n=e.toString();if(n.length<=t)return n;let r=e.toFixed(t);if(r.length>t&&(r=e.toFixed(Math.max(0,t-(r.length-t)))),r.length<=t&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let s=e.toExponential(t);return s.length>t&&(s=e.toExponential(Math.max(0,t-(s.length-t)))),s.slice(0)}function installMathOperations(e,t){e.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},e.prototype.addS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)+r);return this},e.prototype.addM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)+r.get(s,l));return this},e.add=function(r,s){return new t(r).add(s)},e.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},e.prototype.subS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)-r);return this},e.prototype.subM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)-r.get(s,l));return this},e.sub=function(r,s){return new t(r).sub(s)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},e.prototype.mulS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)*r);return this},e.prototype.mulM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)*r.get(s,l));return this},e.mul=function(r,s){return new t(r).mul(s)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},e.prototype.divS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)/r);return this},e.prototype.divM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)/r.get(s,l));return this},e.div=function(r,s){return new t(r).div(s)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},e.prototype.modS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)%r);return this},e.prototype.modM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)%r.get(s,l));return this},e.mod=function(r,s){return new t(r).mod(s)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},e.prototype.andS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)&r);return this},e.prototype.andM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)&r.get(s,l));return this},e.and=function(r,s){return new t(r).and(s)},e.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},e.prototype.orS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)|r);return this},e.prototype.orM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)|r.get(s,l));return this},e.or=function(r,s){return new t(r).or(s)},e.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},e.prototype.xorS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)^r);return this},e.prototype.xorM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)^r.get(s,l));return this},e.xor=function(r,s){return new t(r).xor(s)},e.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},e.prototype.leftShiftS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)<<r);return this},e.prototype.leftShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)<<r.get(s,l));return this},e.leftShift=function(r,s){return new t(r).leftShift(s)},e.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},e.prototype.signPropagatingRightShiftS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)>>r);return this},e.prototype.signPropagatingRightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)>>r.get(s,l));return this},e.signPropagatingRightShift=function(r,s){return new t(r).signPropagatingRightShift(s)},e.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},e.prototype.rightShiftS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)>>>r);return this},e.prototype.rightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,this.get(s,l)>>>r.get(s,l));return this},e.rightShift=function(r,s){return new t(r).rightShift(s)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,~this.get(r,s));return this},e.not=function(r){return new t(r).not()},e.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.abs(this.get(r,s)));return this},e.abs=function(r){return new t(r).abs()},e.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.acos(this.get(r,s)));return this},e.acos=function(r){return new t(r).acos()},e.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.acosh(this.get(r,s)));return this},e.acosh=function(r){return new t(r).acosh()},e.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.asin(this.get(r,s)));return this},e.asin=function(r){return new t(r).asin()},e.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.asinh(this.get(r,s)));return this},e.asinh=function(r){return new t(r).asinh()},e.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.atan(this.get(r,s)));return this},e.atan=function(r){return new t(r).atan()},e.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.atanh(this.get(r,s)));return this},e.atanh=function(r){return new t(r).atanh()},e.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cbrt(this.get(r,s)));return this},e.cbrt=function(r){return new t(r).cbrt()},e.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.ceil(this.get(r,s)));return this},e.ceil=function(r){return new t(r).ceil()},e.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.clz32(this.get(r,s)));return this},e.clz32=function(r){return new t(r).clz32()},e.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cos(this.get(r,s)));return this},e.cos=function(r){return new t(r).cos()},e.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cosh(this.get(r,s)));return this},e.cosh=function(r){return new t(r).cosh()},e.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.exp(this.get(r,s)));return this},e.exp=function(r){return new t(r).exp()},e.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.expm1(this.get(r,s)));return this},e.expm1=function(r){return new t(r).expm1()},e.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.floor(this.get(r,s)));return this},e.floor=function(r){return new t(r).floor()},e.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.fround(this.get(r,s)));return this},e.fround=function(r){return new t(r).fround()},e.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log(this.get(r,s)));return this},e.log=function(r){return new t(r).log()},e.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log1p(this.get(r,s)));return this},e.log1p=function(r){return new t(r).log1p()},e.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log10(this.get(r,s)));return this},e.log10=function(r){return new t(r).log10()},e.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log2(this.get(r,s)));return this},e.log2=function(r){return new t(r).log2()},e.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.round(this.get(r,s)));return this},e.round=function(r){return new t(r).round()},e.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sign(this.get(r,s)));return this},e.sign=function(r){return new t(r).sign()},e.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sin(this.get(r,s)));return this},e.sin=function(r){return new t(r).sin()},e.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sinh(this.get(r,s)));return this},e.sinh=function(r){return new t(r).sinh()},e.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sqrt(this.get(r,s)));return this},e.sqrt=function(r){return new t(r).sqrt()},e.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.tan(this.get(r,s)));return this},e.tan=function(r){return new t(r).tan()},e.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.tanh(this.get(r,s)));return this},e.tanh=function(r){return new t(r).tanh()},e.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.trunc(this.get(r,s)));return this},e.trunc=function(r){return new t(r).trunc()},e.pow=function(r,s){return new t(r).pow(s)},e.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},e.prototype.powS=function(r){for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,Math.pow(this.get(s,l),r));return this},e.prototype.powM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let l=0;l<this.columns;l++)this.set(s,l,Math.pow(this.get(s,l),r.get(s,l)));return this}}function checkRowIndex(e,t,n){let r=n?e.rows:e.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function checkColumnIndex(e,t,n){let r=n?e.columns:e.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function checkRowVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(e,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,t,n,r,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",n),checkNumber("startColumn",r),checkNumber("endColumn",s),t>n||r>s||t<0||t>=e.rows||n<0||n>=e.rows||r<0||r>=e.columns||s<0||s>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(e,t=0){let n=[];for(let r=0;r<e;r++)n.push(t);return n}function checkNumber(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let t=newArray$2(e.rows);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[n]+=e.get(n,r);return t}function sumByColumn(e){let t=newArray$2(e.columns);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[r]+=e.get(n,r);return t}function sumAll(e){let t=0;for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)t+=e.get(n,r);return t}function productByRow(e){let t=newArray$2(e.rows,1);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[n]*=e.get(n,r);return t}function productByColumn(e){let t=newArray$2(e.columns,1);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[r]*=e.get(n,r);return t}function productAll(e){let t=1;for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)t*=e.get(n,r);return t}function varianceByRow(e,t,n){const r=e.rows,s=e.columns,l=[];for(let p=0;p<r;p++){let o=0,x=0,M=0;for(let P=0;P<s;P++)M=e.get(p,P)-n[p],o+=M,x+=M*M;t?l.push((x-o*o/s)/(s-1)):l.push((x-o*o/s)/s)}return l}function varianceByColumn(e,t,n){const r=e.rows,s=e.columns,l=[];for(let p=0;p<s;p++){let o=0,x=0,M=0;for(let P=0;P<r;P++)M=e.get(P,p)-n[p],o+=M,x+=M*M;t?l.push((x-o*o/r)/(r-1)):l.push((x-o*o/r)/r)}return l}function varianceAll(e,t,n){const r=e.rows,s=e.columns,l=r*s;let p=0,o=0,x=0;for(let M=0;M<r;M++)for(let P=0;P<s;P++)x=e.get(M,P)-n,p+=x,o+=x*x;return t?(o-p*p/l)/(l-1):(o-p*p/l)/l}function centerByRow(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t[n])}function centerByColumn(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t[r])}function centerAll(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t)}function getScaleByRow(e){const t=[];for(let n=0;n<e.rows;n++){let r=0;for(let s=0;s<e.columns;s++)r+=Math.pow(e.get(n,s),2)/(e.columns-1);t.push(Math.sqrt(r))}return t}function scaleByRow(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t[n])}function getScaleByColumn(e){const t=[];for(let n=0;n<e.columns;n++){let r=0;for(let s=0;s<e.rows;s++)r+=Math.pow(e.get(s,n),2)/(e.rows-1);t.push(Math.sqrt(r))}return t}function scaleByColumn(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t[r])}function getScaleAll(e){const t=e.size-1;let n=0;for(let r=0;r<e.columns;r++)for(let s=0;s<e.rows;s++)n+=Math.pow(e.get(s,r),2)/t;return Math.sqrt(n)}function scaleAll(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t)}class AbstractMatrix{static from1DArray(t,n,r){if(t*n!==r.length)throw new RangeError("data length does not match given dimensions");let l=new Matrix$2(t,n);for(let p=0;p<t;p++)for(let o=0;o<n;o++)l.set(p,o,r[p*n+o]);return l}static rowVector(t){let n=new Matrix$2(1,t.length);for(let r=0;r<t.length;r++)n.set(0,r,t[r]);return n}static columnVector(t){let n=new Matrix$2(t.length,1);for(let r=0;r<t.length;r++)n.set(r,0,t[r]);return n}static zeros(t,n){return new Matrix$2(t,n)}static ones(t,n){return new Matrix$2(t,n).fill(1)}static rand(t,n,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=r;let l=new Matrix$2(t,n);for(let p=0;p<t;p++)for(let o=0;o<n;o++)l.set(p,o,s());return l}static randInt(t,n,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:s=0,max:l=1e3,random:p=Math.random}=r;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(l))throw new TypeError("max must be an integer");if(s>=l)throw new RangeError("min must be smaller than max");let o=l-s,x=new Matrix$2(t,n);for(let M=0;M<t;M++)for(let P=0;P<n;P++){let he=s+Math.round(p()*o);x.set(M,P,he)}return x}static eye(t,n,r){n===void 0&&(n=t),r===void 0&&(r=1);let s=Math.min(t,n),l=this.zeros(t,n);for(let p=0;p<s;p++)l.set(p,p,r);return l}static diag(t,n,r){let s=t.length;n===void 0&&(n=s),r===void 0&&(r=n);let l=Math.min(s,n,r),p=this.zeros(n,r);for(let o=0;o<l;o++)p.set(o,o,t[o]);return p}static min(t,n){t=this.checkMatrix(t),n=this.checkMatrix(n);let r=t.rows,s=t.columns,l=new Matrix$2(r,s);for(let p=0;p<r;p++)for(let o=0;o<s;o++)l.set(p,o,Math.min(t.get(p,o),n.get(p,o)));return l}static max(t,n){t=this.checkMatrix(t),n=this.checkMatrix(n);let r=t.rows,s=t.columns,l=new this(r,s);for(let p=0;p<r;p++)for(let o=0;o<s;o++)l.set(p,o,Math.max(t.get(p,o),n.get(p,o)));return l}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)t.call(this,n,r);return this}to1DArray(){let t=[];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)t.push(this.get(n,r));return t}to2DArray(){let t=[];for(let n=0;n<this.rows;n++){t.push([]);for(let r=0;r<this.columns;r++)t[n].push(this.get(n,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let n=0;n<=t;n++)if(this.get(t,n)!==this.get(n,t))return!1;return!0}return!1}isEchelonForm(){let t=0,n=0,r=-1,s=!0,l=!1;for(;t<this.rows&&s;){for(n=0,l=!1;n<this.columns&&l===!1;)this.get(t,n)===0?n++:this.get(t,n)===1&&n>r?(l=!0,r=n):(s=!1,l=!0);t++}return s}isReducedEchelonForm(){let t=0,n=0,r=-1,s=!0,l=!1;for(;t<this.rows&&s;){for(n=0,l=!1;n<this.columns&&l===!1;)this.get(t,n)===0?n++:this.get(t,n)===1&&n>r?(l=!0,r=n):(s=!1,l=!0);for(let p=n+1;p<this.rows;p++)this.get(t,p)!==0&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),n=0,r=0;for(;n<t.rows&&r<t.columns;){let s=n;for(let l=n;l<t.rows;l++)t.get(l,r)>t.get(s,r)&&(s=l);if(t.get(s,r)===0)r++;else{t.swapRows(n,s);let l=t.get(n,r);for(let p=r;p<t.columns;p++)t.set(n,p,t.get(n,p)/l);for(let p=n+1;p<t.rows;p++){let o=t.get(p,r)/t.get(n,r);t.set(p,r,0);for(let x=r+1;x<t.columns;x++)t.set(p,x,t.get(p,x)-t.get(n,x)*o)}n++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),n=t.columns,r=t.rows,s=r-1;for(;s>=0;)if(t.maxRow(s)===0)s--;else{let l=0,p=!1;for(;l<r&&p===!1;)t.get(s,l)===1?p=!0:l++;for(let o=0;o<s;o++){let x=t.get(o,l);for(let M=l;M<n;M++){let P=t.get(o,M)-x*t.get(s,M);t.set(o,M,P)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:n=1,columns:r=1}=t;if(!Number.isInteger(n)||n<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let s=new Matrix$2(this.rows*n,this.columns*r);for(let l=0;l<n;l++)for(let p=0;p<r;p++)s.setSubMatrix(this,this.rows*l,this.columns*p);return s}fill(t){for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let n=[];for(let r=0;r<this.columns;r++)n.push(this.get(t,r));return n}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,n){checkRowIndex(this,t),n=checkRowVector(this,n);for(let r=0;r<this.columns;r++)this.set(t,r,n[r]);return this}swapRows(t,n){checkRowIndex(this,t),checkRowIndex(this,n);for(let r=0;r<this.columns;r++){let s=this.get(t,r);this.set(t,r,this.get(n,r)),this.set(n,r,s)}return this}getColumn(t){checkColumnIndex(this,t);let n=[];for(let r=0;r<this.rows;r++)n.push(this.get(r,t));return n}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,n){checkColumnIndex(this,t),n=checkColumnVector(this,n);for(let r=0;r<this.rows;r++)this.set(r,t,n[r]);return this}swapColumns(t,n){checkColumnIndex(this,t),checkColumnIndex(this,n);for(let r=0;r<this.rows;r++){let s=this.get(r,t);this.set(r,t,this.get(r,n)),this.set(r,n,s)}return this}addRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)+t[r]);return this}subRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)-t[r]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)*t[r]);return this}divRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)/t[r]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)+t[n]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)-t[n]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)*t[n]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.set(n,r,this.get(n,r)/t[n]);return this}mulRow(t,n){checkRowIndex(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*n);return this}mulColumn(t,n){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*n);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const n=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>n[r]&&(n[r]=this.get(r,s));return n}case"column":{const n=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>n[s]&&(n[s]=this.get(r,s));return n}case void 0:{let n=this.get(0,0);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>n&&(n=this.get(r,s));return n}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),n=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s),n[0]=r,n[1]=s);return n}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const n=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<n[r]&&(n[r]=this.get(r,s));return n}case"column":{const n=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<n[s]&&(n[s]=this.get(r,s));return n}case void 0:{let n=this.get(0,0);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<n&&(n=this.get(r,s));return n}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),n=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s),n[0]=r,n[1]=s);return n}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let n=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>n&&(n=this.get(t,r));return n}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let n=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>n&&(n=this.get(t,s),r[1]=s);return r}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let n=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<n&&(n=this.get(t,r));return n}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let n=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<n&&(n=this.get(t,s),r[1]=s);return r}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let n=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>n&&(n=this.get(r,t));return n}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let n=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>n&&(n=this.get(s,t),r[0]=s);return r}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let n=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<n&&(n=this.get(r,t));return n}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let n=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<n&&(n=this.get(s,t),r[0]=s);return r}diag(){let t=Math.min(this.rows,this.columns),n=[];for(let r=0;r<t;r++)n.push(this.get(r,r));return n}norm(t="frobenius"){let n=0;if(t==="max")return this.max();if(t==="frobenius"){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)n=n+this.get(r,s)*this.get(r,s);return Math.sqrt(n)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)t+=this.get(n,r),this.set(n,r,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let n=this.to1DArray();if(n.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let s=0;s<n.length;s++)r+=n[s]*t[s];return r}mmul(t){t=Matrix$2.checkMatrix(t);let n=this.rows,r=this.columns,s=t.columns,l=new Matrix$2(n,s),p=new Float64Array(r);for(let o=0;o<s;o++){for(let x=0;x<r;x++)p[x]=t.get(x,o);for(let x=0;x<n;x++){let M=0;for(let P=0;P<r;P++)M+=this.get(x,P)*p[P];l.set(x,o,M)}}return l}strassen2x2(t){t=Matrix$2.checkMatrix(t);let n=new Matrix$2(2,2);const r=this.get(0,0),s=t.get(0,0),l=this.get(0,1),p=t.get(0,1),o=this.get(1,0),x=t.get(1,0),M=this.get(1,1),P=t.get(1,1),he=(r+M)*(s+P),nt=(o+M)*s,_e=r*(p-P),Bt=M*(x-s),Fn=(r+l)*P,yr=(o-r)*(s+p),Io=(l-M)*(x+P),rl=he+Bt-Fn+Io,Co=_e+Fn,as=nt+Bt,Js=he-nt+_e+yr;return n.set(0,0,rl),n.set(0,1,Co),n.set(1,0,as),n.set(1,1,Js),n}strassen3x3(t){t=Matrix$2.checkMatrix(t);let n=new Matrix$2(3,3);const r=this.get(0,0),s=this.get(0,1),l=this.get(0,2),p=this.get(1,0),o=this.get(1,1),x=this.get(1,2),M=this.get(2,0),P=this.get(2,1),he=this.get(2,2),nt=t.get(0,0),_e=t.get(0,1),Bt=t.get(0,2),Fn=t.get(1,0),yr=t.get(1,1),Io=t.get(1,2),rl=t.get(2,0),Co=t.get(2,1),as=t.get(2,2),Js=(r+s+l-p-o-P-he)*yr,lh=(r-p)*(-_e+yr),ch=o*(-nt+_e+Fn-yr-Io-rl+as),Zu=(-r+p+o)*(nt-_e+yr),th=(p+o)*(-nt+_e),sl=r*nt,sh=(-r+M+P)*(nt-Bt+Io),xh=(-r+M)*(Bt-Io),Mh=(M+P)*(-nt+Bt),Dh=(r+s+l-o-x-M-P)*Io,Uh=P*(-nt+Bt+Fn-yr-Io-rl+Co),cd=(-l+P+he)*(yr+rl-Co),Tf=(l-he)*(yr-Co),yf=l*rl,Af=(P+he)*(-rl+Co),md=(-l+o+x)*(Io+rl-as),vd=(l-x)*(Io-as),qd=(o+x)*(-rl+as),Ed=s*Fn,Td=x*Co,Fd=p*Bt,Cd=M*_e,Gd=he*as,bf=sl+yf+Ed,Id=Js+Zu+th+sl+cd+yf+Af,td=sl+sh+Mh+Dh+yf+md+qd,$d=lh+ch+Zu+sl+yf+md+vd,np=lh+Zu+th+sl+Td,jf=yf+md+vd+qd+Fd,yd=sl+sh+xh+Uh+cd+Tf+yf,Qd=cd+Tf+yf+Af+Cd,op=sl+sh+xh+Mh+Gd;return n.set(0,0,bf),n.set(0,1,Id),n.set(0,2,td),n.set(1,0,$d),n.set(1,1,np),n.set(1,2,jf),n.set(2,0,yd),n.set(2,1,Qd),n.set(2,2,op),n}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let n=this.clone(),r=n.rows,s=n.columns,l=t.rows,p=t.columns;s!==l&&console.warn(`Multiplying ${r} x ${s} and ${l} x ${p} matrix: dimensions do not match.`);function o(he,nt,_e){let Bt=he.rows,Fn=he.columns;if(Bt===nt&&Fn===_e)return he;{let yr=AbstractMatrix.zeros(nt,_e);return yr=yr.setSubMatrix(he,0,0),yr}}let x=Math.max(r,l),M=Math.max(s,p);n=o(n,x,M),t=o(t,x,M);function P(he,nt,_e,Bt){if(_e<=512||Bt<=512)return he.mmul(nt);_e%2===1&&Bt%2===1?(he=o(he,_e+1,Bt+1),nt=o(nt,_e+1,Bt+1)):_e%2===1?(he=o(he,_e+1,Bt),nt=o(nt,_e+1,Bt)):Bt%2===1&&(he=o(he,_e,Bt+1),nt=o(nt,_e,Bt+1));let Fn=parseInt(he.rows/2,10),yr=parseInt(he.columns/2,10),Io=he.subMatrix(0,Fn-1,0,yr-1),rl=nt.subMatrix(0,Fn-1,0,yr-1),Co=he.subMatrix(0,Fn-1,yr,he.columns-1),as=nt.subMatrix(0,Fn-1,yr,nt.columns-1),Js=he.subMatrix(Fn,he.rows-1,0,yr-1),lh=nt.subMatrix(Fn,nt.rows-1,0,yr-1),ch=he.subMatrix(Fn,he.rows-1,yr,he.columns-1),Zu=nt.subMatrix(Fn,nt.rows-1,yr,nt.columns-1),th=P(AbstractMatrix.add(Io,ch),AbstractMatrix.add(rl,Zu),Fn,yr),sl=P(AbstractMatrix.add(Js,ch),rl,Fn,yr),sh=P(Io,AbstractMatrix.sub(as,Zu),Fn,yr),xh=P(ch,AbstractMatrix.sub(lh,rl),Fn,yr),Mh=P(AbstractMatrix.add(Io,Co),Zu,Fn,yr),Dh=P(AbstractMatrix.sub(Js,Io),AbstractMatrix.add(rl,as),Fn,yr),Uh=P(AbstractMatrix.sub(Co,ch),AbstractMatrix.add(lh,Zu),Fn,yr),cd=AbstractMatrix.add(th,xh);cd.sub(Mh),cd.add(Uh);let Tf=AbstractMatrix.add(sh,Mh),yf=AbstractMatrix.add(sl,xh),Af=AbstractMatrix.sub(th,sl);Af.add(sh),Af.add(Dh);let md=AbstractMatrix.zeros(2*cd.rows,2*cd.columns);return md=md.setSubMatrix(cd,0,0),md=md.setSubMatrix(Tf,cd.rows,0),md=md.setSubMatrix(yf,0,cd.columns),md=md.setSubMatrix(Af,cd.rows,cd.columns),md.subMatrix(0,_e-1,0,Bt-1)}return P(n,t,x,M)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:r=1}=t;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(n>=r)throw new RangeError("min must be smaller than max");let s=new Matrix$2(this.rows,this.columns);for(let l=0;l<this.rows;l++){const p=this.getRow(l);p.length>0&&rescale(p,{min:n,max:r,output:p}),s.setRow(l,p)}return s}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:r=1}=t;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(n>=r)throw new RangeError("min must be smaller than max");let s=new Matrix$2(this.rows,this.columns);for(let l=0;l<this.columns;l++){const p=this.getColumn(l);p.length&&rescale(p,{min:n,max:r,output:p}),s.setColumn(l,p)}return s}flipRows(){const t=Math.ceil(this.columns/2);for(let n=0;n<this.rows;n++)for(let r=0;r<t;r++){let s=this.get(n,r),l=this.get(n,this.columns-1-r);this.set(n,r,l),this.set(n,this.columns-1-r,s)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let n=0;n<this.columns;n++)for(let r=0;r<t;r++){let s=this.get(r,n),l=this.get(this.rows-1-r,n);this.set(r,n,l),this.set(this.rows-1-r,n,s)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let n=this.rows,r=this.columns,s=t.rows,l=t.columns,p=new Matrix$2(n*s,r*l);for(let o=0;o<n;o++)for(let x=0;x<r;x++)for(let M=0;M<s;M++)for(let P=0;P<l;P++)p.set(s*o+M,l*x+P,this.get(o,x)*t.get(M,P));return p}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let n=this.rows,r=t.rows,s=this.kroneckerProduct(Matrix$2.eye(r,r)),l=Matrix$2.eye(n,n).kroneckerProduct(t);return s.add(l)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)t.set(r,n,this.get(n,r));return t}sortRows(t=compareNumbers){for(let n=0;n<this.rows;n++)this.setRow(n,this.getRow(n).sort(t));return this}sortColumns(t=compareNumbers){for(let n=0;n<this.columns;n++)this.setColumn(n,this.getColumn(n).sort(t));return this}subMatrix(t,n,r,s){checkRange(this,t,n,r,s);let l=new Matrix$2(n-t+1,s-r+1);for(let p=t;p<=n;p++)for(let o=r;o<=s;o++)l.set(p-t,o-r,this.get(p,o));return l}subMatrixRow(t,n,r){if(n===void 0&&(n=0),r===void 0&&(r=this.columns-1),n>r||n<0||n>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let s=new Matrix$2(t.length,r-n+1);for(let l=0;l<t.length;l++)for(let p=n;p<=r;p++){if(t[l]<0||t[l]>=this.rows)throw new RangeError(`Row index out of range: ${t[l]}`);s.set(l,p-n,this.get(t[l],p))}return s}subMatrixColumn(t,n,r){if(n===void 0&&(n=0),r===void 0&&(r=this.rows-1),n>r||n<0||n>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let s=new Matrix$2(r-n+1,t.length);for(let l=0;l<t.length;l++)for(let p=n;p<=r;p++){if(t[l]<0||t[l]>=this.columns)throw new RangeError(`Column index out of range: ${t[l]}`);s.set(p-n,l,this.get(p,t[l]))}return s}setSubMatrix(t,n,r){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let s=n+t.rows-1,l=r+t.columns-1;checkRange(this,n,s,r,l);for(let p=0;p<t.rows;p++)for(let o=0;o<t.columns;o++)this.set(n+p,r+o,t.get(p,o));return this}selection(t,n){checkRowIndices(this,t),checkColumnIndices(this,n);let r=new Matrix$2(t.length,n.length);for(let s=0;s<t.length;s++){let l=t[s];for(let p=0;p<n.length;p++){let o=n[p];r.set(s,p,this.get(l,o))}}return r}trace(){let t=Math.min(this.rows,this.columns),n=0;for(let r=0;r<t;r++)n+=this.get(r,r);return n}clone(){let t=new Matrix$2(this.rows,this.columns);for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)t.set(n,r,this.get(n,r));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const n=this.sum(t);switch(t){case"row":{for(let r=0;r<this.rows;r++)n[r]/=this.columns;return n}case"column":{for(let r=0;r<this.columns;r++)n[r]/=this.rows;return n}case void 0:return n/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:s=this.mean(t)}=n;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(s))throw new TypeError("mean must be an array");return varianceByRow(this,r,s)}case"column":{if(!isAnyArray(s))throw new TypeError("mean must be an array");return varianceByColumn(this,r,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return varianceAll(this,r,s)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,n){typeof t=="object"&&(n=t,t=void 0);const r=this.variance(t,n);if(t===void 0)return Math.sqrt(r);for(let s=0;s<r.length;s++)r[s]=Math.sqrt(r[s]);return r}center(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");const{center:r=this.mean(t)}=n;switch(t){case"row":{if(!isAnyArray(r))throw new TypeError("center must be an array");return centerByRow(this,r),this}case"column":{if(!isAnyArray(r))throw new TypeError("center must be an array");return centerByColumn(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return centerAll(this,r),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");let r=n.scale;switch(t){case"row":{if(r===void 0)r=getScaleByRow(this);else if(!isAnyArray(r))throw new TypeError("scale must be an array");return scaleByRow(this,r),this}case"column":{if(r===void 0)r=getScaleByColumn(this);else if(!isAnyArray(r))throw new TypeError("scale must be an array");return scaleByColumn(this,r),this}case void 0:{if(r===void 0)r=getScaleAll(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return scaleAll(this,r),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,t){return e-t}function isArrayOfNumbers(e){return e.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class KE extends AbstractMatrix{constructor(t,n){if(super(),KE.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(n)&&n>=0)for(let r=0;r<t;r++)this.data.push(new Float64Array(n));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const r=t;if(t=r.length,n=t?r[0].length:0,typeof n!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<t;s++){if(r[s].length!==n)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(r[s]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[s]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=n}set(t,n,r){return this.data[t][n]=r,this}get(t,n){return this.data[t][n]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,n){return n===void 0&&(n=t,t=this.rows),checkRowIndex(this,t,!0),n=Float64Array.from(checkRowVector(this,n)),this.data.splice(t,0,n),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns-1);for(let s=0;s<t;s++)r[s]=this.data[n][s];for(let s=t+1;s<this.columns;s++)r[s-1]=this.data[n][s];this.data[n]=r}return this.columns-=1,this}addColumn(t,n){typeof n>"u"&&(n=t,t=this.columns),checkColumnIndex(this,t,!0),n=checkColumnVector(this,n);for(let r=0;r<this.rows;r++){const s=new Float64Array(this.columns+1);let l=0;for(;l<t;l++)s[l]=this.data[r][l];for(s[l++]=n[r];l<this.columns+1;l++)s[l]=this.data[r][l-1];this.data[r]=s}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,n,r){super(),this.matrix=t,this.rows=n,this.columns=r}}class MatrixColumnView extends BaseView{constructor(t,n){checkColumnIndex(t,n),super(t,t.rows,1),this.column=n}set(t,n,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,n){checkColumnIndices(t,n),super(t,t.rows,n.length),this.columnIndices=n}set(t,n,r){return this.matrix.set(t,this.columnIndices[n],r),this}get(t,n){return this.matrix.get(t,this.columnIndices[n])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,n,r){return this.matrix.set(t,this.columns-n-1,r),this}get(t,n){return this.matrix.get(t,this.columns-n-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,n,r){return this.matrix.set(this.rows-t-1,n,r),this}get(t,n){return this.matrix.get(this.rows-t-1,n)}}class MatrixRowView extends BaseView{constructor(t,n){checkRowIndex(t,n),super(t,1,t.columns),this.row=n}set(t,n,r){return this.matrix.set(this.row,n,r),this}get(t,n){return this.matrix.get(this.row,n)}}class MatrixRowSelectionView extends BaseView{constructor(t,n){checkRowIndices(t,n),super(t,n.length,t.columns),this.rowIndices=n}set(t,n,r){return this.matrix.set(this.rowIndices[t],n,r),this}get(t,n){return this.matrix.get(this.rowIndices[t],n)}}class MatrixSelectionView extends BaseView{constructor(t,n,r){checkRowIndices(t,n),checkColumnIndices(t,r),super(t,n.length,r.length),this.rowIndices=n,this.columnIndices=r}set(t,n,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[n],r),this}get(t,n){return this.matrix.get(this.rowIndices[t],this.columnIndices[n])}}class MatrixSubView extends BaseView{constructor(t,n,r,s,l){checkRange(t,n,r,s,l),super(t,r-n+1,l-s+1),this.startRow=n,this.startColumn=s}set(t,n,r){return this.matrix.set(this.startRow+t,this.startColumn+n,r),this}get(t,n){return this.matrix.get(this.startRow+t,this.startColumn+n)}}let MatrixTransposeView$1=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,n,r){return this.matrix.set(n,t,r),this}get(t,n){return this.matrix.get(n,t)}};class WrapperMatrix1D extends AbstractMatrix{constructor(t,n={}){const{rows:r=1}=n;if(t.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,n,r){let s=this._calculateIndex(t,n);return this.data[s]=r,this}get(t,n){let r=this._calculateIndex(t,n);return this.data[r]}_calculateIndex(t,n){return t*this.columns+n}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,n,r){return this.data[t][n]=r,this}get(t,n){return this.data[t][n]}}function wrap(e,t){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let n=t.clone(),r=n.rows,s=n.columns,l=new Float64Array(r),p=1,o,x,M,P,he,nt,_e,Bt,Fn;for(o=0;o<r;o++)l[o]=o;for(Bt=new Float64Array(r),x=0;x<s;x++){for(o=0;o<r;o++)Bt[o]=n.get(o,x);for(o=0;o<r;o++){for(Fn=Math.min(o,x),he=0,M=0;M<Fn;M++)he+=n.get(o,M)*Bt[M];Bt[o]-=he,n.set(o,x,Bt[o])}for(P=x,o=x+1;o<r;o++)Math.abs(Bt[o])>Math.abs(Bt[P])&&(P=o);if(P!==x){for(M=0;M<s;M++)nt=n.get(P,M),n.set(P,M,n.get(x,M)),n.set(x,M,nt);_e=l[P],l[P]=l[x],l[x]=_e,p=-p}if(x<r&&n.get(x,x)!==0)for(o=x+1;o<r;o++)n.set(o,x,n.get(o,x)/n.get(x,x))}this.LU=n,this.pivotVector=l,this.pivotSign=p}isSingular(){let t=this.LU,n=t.columns;for(let r=0;r<n;r++)if(t.get(r,r)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let n=this.LU;if(n.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=t.columns,l=t.subMatrixRow(this.pivotVector,0,s-1),p=n.columns,o,x,M;for(M=0;M<p;M++)for(o=M+1;o<p;o++)for(x=0;x<s;x++)l.set(o,x,l.get(o,x)-l.get(M,x)*n.get(o,M));for(M=p-1;M>=0;M--){for(x=0;x<s;x++)l.set(M,x,l.get(M,x)/n.get(M,M));for(o=0;o<M;o++)for(x=0;x<s;x++)l.set(o,x,l.get(o,x)-l.get(M,x)*n.get(o,M))}return l}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let n=this.pivotSign,r=t.columns;for(let s=0;s<r;s++)n*=t.get(s,s);return n}get lowerTriangularMatrix(){let t=this.LU,n=t.rows,r=t.columns,s=new Matrix$2(n,r);for(let l=0;l<n;l++)for(let p=0;p<r;p++)l>p?s.set(l,p,t.get(l,p)):l===p?s.set(l,p,1):s.set(l,p,0);return s}get upperTriangularMatrix(){let t=this.LU,n=t.rows,r=t.columns,s=new Matrix$2(n,r);for(let l=0;l<n;l++)for(let p=0;p<r;p++)l<=p?s.set(l,p,t.get(l,p)):s.set(l,p,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,t){let n=0;return Math.abs(e)>Math.abs(t)?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):t!==0?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let n=t.clone(),r=t.rows,s=t.columns,l=new Float64Array(s),p,o,x,M;for(x=0;x<s;x++){let P=0;for(p=x;p<r;p++)P=hypotenuse$1(P,n.get(p,x));if(P!==0){for(n.get(x,x)<0&&(P=-P),p=x;p<r;p++)n.set(p,x,n.get(p,x)/P);for(n.set(x,x,n.get(x,x)+1),o=x+1;o<s;o++){for(M=0,p=x;p<r;p++)M+=n.get(p,x)*n.get(p,o);for(M=-M/n.get(x,x),p=x;p<r;p++)n.set(p,o,n.get(p,o)+M*n.get(p,x))}}l[x]=-P}this.QR=n,this.Rdiag=l}solve(t){t=Matrix$2.checkMatrix(t);let n=this.QR,r=n.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=t.columns,l=t.clone(),p=n.columns,o,x,M,P;for(M=0;M<p;M++)for(x=0;x<s;x++){for(P=0,o=M;o<r;o++)P+=n.get(o,M)*l.get(o,x);for(P=-P/n.get(M,M),o=M;o<r;o++)l.set(o,x,l.get(o,x)+P*n.get(o,M))}for(M=p-1;M>=0;M--){for(x=0;x<s;x++)l.set(M,x,l.get(M,x)/this.Rdiag[M]);for(o=0;o<M;o++)for(x=0;x<s;x++)l.set(o,x,l.get(o,x)-l.get(M,x)*n.get(o,M))}return l.subMatrix(0,p-1,0,s-1)}isFullRank(){let t=this.QR.columns;for(let n=0;n<t;n++)if(this.Rdiag[n]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,n=t.columns,r=new Matrix$2(n,n),s,l;for(s=0;s<n;s++)for(l=0;l<n;l++)s<l?r.set(s,l,t.get(s,l)):s===l?r.set(s,l,this.Rdiag[s]):r.set(s,l,0);return r}get orthogonalMatrix(){let t=this.QR,n=t.rows,r=t.columns,s=new Matrix$2(n,r),l,p,o,x;for(o=r-1;o>=0;o--){for(l=0;l<n;l++)s.set(l,o,0);for(s.set(o,o,1),p=o;p<r;p++)if(t.get(o,o)!==0){for(x=0,l=o;l<n;l++)x+=t.get(l,o)*s.get(l,p);for(x=-x/t.get(o,o),l=o;l<n;l++)s.set(l,p,s.get(l,p)+x*t.get(l,o))}}return s}}class SingularValueDecomposition{constructor(t,n={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,s=t.columns;const{computeLeftSingularVectors:l=!0,computeRightSingularVectors:p=!0,autoTranspose:o=!1}=n;let x=!!l,M=!!p,P=!1,he;if(r<s)if(!o)he=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{he=t.transpose(),r=he.rows,s=he.columns,P=!0;let sl=x;x=M,M=sl}else he=t.clone();let nt=Math.min(r,s),_e=Math.min(r+1,s),Bt=new Float64Array(_e),Fn=new Matrix$2(r,nt),yr=new Matrix$2(s,s),Io=new Float64Array(s),rl=new Float64Array(r),Co=new Float64Array(_e);for(let sl=0;sl<_e;sl++)Co[sl]=sl;let as=Math.min(r-1,s),Js=Math.max(0,Math.min(s-2,r)),lh=Math.max(as,Js);for(let sl=0;sl<lh;sl++){if(sl<as){Bt[sl]=0;for(let sh=sl;sh<r;sh++)Bt[sl]=hypotenuse$1(Bt[sl],he.get(sh,sl));if(Bt[sl]!==0){he.get(sl,sl)<0&&(Bt[sl]=-Bt[sl]);for(let sh=sl;sh<r;sh++)he.set(sh,sl,he.get(sh,sl)/Bt[sl]);he.set(sl,sl,he.get(sl,sl)+1)}Bt[sl]=-Bt[sl]}for(let sh=sl+1;sh<s;sh++){if(sl<as&&Bt[sl]!==0){let xh=0;for(let Mh=sl;Mh<r;Mh++)xh+=he.get(Mh,sl)*he.get(Mh,sh);xh=-xh/he.get(sl,sl);for(let Mh=sl;Mh<r;Mh++)he.set(Mh,sh,he.get(Mh,sh)+xh*he.get(Mh,sl))}Io[sh]=he.get(sl,sh)}if(x&&sl<as)for(let sh=sl;sh<r;sh++)Fn.set(sh,sl,he.get(sh,sl));if(sl<Js){Io[sl]=0;for(let sh=sl+1;sh<s;sh++)Io[sl]=hypotenuse$1(Io[sl],Io[sh]);if(Io[sl]!==0){Io[sl+1]<0&&(Io[sl]=0-Io[sl]);for(let sh=sl+1;sh<s;sh++)Io[sh]/=Io[sl];Io[sl+1]+=1}if(Io[sl]=-Io[sl],sl+1<r&&Io[sl]!==0){for(let sh=sl+1;sh<r;sh++)rl[sh]=0;for(let sh=sl+1;sh<r;sh++)for(let xh=sl+1;xh<s;xh++)rl[sh]+=Io[xh]*he.get(sh,xh);for(let sh=sl+1;sh<s;sh++){let xh=-Io[sh]/Io[sl+1];for(let Mh=sl+1;Mh<r;Mh++)he.set(Mh,sh,he.get(Mh,sh)+xh*rl[Mh])}}if(M)for(let sh=sl+1;sh<s;sh++)yr.set(sh,sl,Io[sh])}}let ch=Math.min(s,r+1);if(as<s&&(Bt[as]=he.get(as,as)),r<ch&&(Bt[ch-1]=0),Js+1<ch&&(Io[Js]=he.get(Js,ch-1)),Io[ch-1]=0,x){for(let sl=as;sl<nt;sl++){for(let sh=0;sh<r;sh++)Fn.set(sh,sl,0);Fn.set(sl,sl,1)}for(let sl=as-1;sl>=0;sl--)if(Bt[sl]!==0){for(let sh=sl+1;sh<nt;sh++){let xh=0;for(let Mh=sl;Mh<r;Mh++)xh+=Fn.get(Mh,sl)*Fn.get(Mh,sh);xh=-xh/Fn.get(sl,sl);for(let Mh=sl;Mh<r;Mh++)Fn.set(Mh,sh,Fn.get(Mh,sh)+xh*Fn.get(Mh,sl))}for(let sh=sl;sh<r;sh++)Fn.set(sh,sl,-Fn.get(sh,sl));Fn.set(sl,sl,1+Fn.get(sl,sl));for(let sh=0;sh<sl-1;sh++)Fn.set(sh,sl,0)}else{for(let sh=0;sh<r;sh++)Fn.set(sh,sl,0);Fn.set(sl,sl,1)}}if(M)for(let sl=s-1;sl>=0;sl--){if(sl<Js&&Io[sl]!==0)for(let sh=sl+1;sh<s;sh++){let xh=0;for(let Mh=sl+1;Mh<s;Mh++)xh+=yr.get(Mh,sl)*yr.get(Mh,sh);xh=-xh/yr.get(sl+1,sl);for(let Mh=sl+1;Mh<s;Mh++)yr.set(Mh,sh,yr.get(Mh,sh)+xh*yr.get(Mh,sl))}for(let sh=0;sh<s;sh++)yr.set(sh,sl,0);yr.set(sl,sl,1)}let Zu=ch-1,th=Number.EPSILON;for(;ch>0;){let sl,sh;for(sl=ch-2;sl>=-1&&sl!==-1;sl--){const xh=Number.MIN_VALUE+th*Math.abs(Bt[sl]+Math.abs(Bt[sl+1]));if(Math.abs(Io[sl])<=xh||Number.isNaN(Io[sl])){Io[sl]=0;break}}if(sl===ch-2)sh=4;else{let xh;for(xh=ch-1;xh>=sl&&xh!==sl;xh--){let Mh=(xh!==ch?Math.abs(Io[xh]):0)+(xh!==sl+1?Math.abs(Io[xh-1]):0);if(Math.abs(Bt[xh])<=th*Mh){Bt[xh]=0;break}}xh===sl?sh=3:xh===ch-1?sh=1:(sh=2,sl=xh)}switch(sl++,sh){case 1:{let xh=Io[ch-2];Io[ch-2]=0;for(let Mh=ch-2;Mh>=sl;Mh--){let Dh=hypotenuse$1(Bt[Mh],xh),Uh=Bt[Mh]/Dh,cd=xh/Dh;if(Bt[Mh]=Dh,Mh!==sl&&(xh=-cd*Io[Mh-1],Io[Mh-1]=Uh*Io[Mh-1]),M)for(let Tf=0;Tf<s;Tf++)Dh=Uh*yr.get(Tf,Mh)+cd*yr.get(Tf,ch-1),yr.set(Tf,ch-1,-cd*yr.get(Tf,Mh)+Uh*yr.get(Tf,ch-1)),yr.set(Tf,Mh,Dh)}break}case 2:{let xh=Io[sl-1];Io[sl-1]=0;for(let Mh=sl;Mh<ch;Mh++){let Dh=hypotenuse$1(Bt[Mh],xh),Uh=Bt[Mh]/Dh,cd=xh/Dh;if(Bt[Mh]=Dh,xh=-cd*Io[Mh],Io[Mh]=Uh*Io[Mh],x)for(let Tf=0;Tf<r;Tf++)Dh=Uh*Fn.get(Tf,Mh)+cd*Fn.get(Tf,sl-1),Fn.set(Tf,sl-1,-cd*Fn.get(Tf,Mh)+Uh*Fn.get(Tf,sl-1)),Fn.set(Tf,Mh,Dh)}break}case 3:{const xh=Math.max(Math.abs(Bt[ch-1]),Math.abs(Bt[ch-2]),Math.abs(Io[ch-2]),Math.abs(Bt[sl]),Math.abs(Io[sl])),Mh=Bt[ch-1]/xh,Dh=Bt[ch-2]/xh,Uh=Io[ch-2]/xh,cd=Bt[sl]/xh,Tf=Io[sl]/xh,yf=((Dh+Mh)*(Dh-Mh)+Uh*Uh)/2,Af=Mh*Uh*(Mh*Uh);let md=0;(yf!==0||Af!==0)&&(yf<0?md=0-Math.sqrt(yf*yf+Af):md=Math.sqrt(yf*yf+Af),md=Af/(yf+md));let vd=(cd+Mh)*(cd-Mh)+md,qd=cd*Tf;for(let Ed=sl;Ed<ch-1;Ed++){let Td=hypotenuse$1(vd,qd);Td===0&&(Td=Number.MIN_VALUE);let Fd=vd/Td,Cd=qd/Td;if(Ed!==sl&&(Io[Ed-1]=Td),vd=Fd*Bt[Ed]+Cd*Io[Ed],Io[Ed]=Fd*Io[Ed]-Cd*Bt[Ed],qd=Cd*Bt[Ed+1],Bt[Ed+1]=Fd*Bt[Ed+1],M)for(let Gd=0;Gd<s;Gd++)Td=Fd*yr.get(Gd,Ed)+Cd*yr.get(Gd,Ed+1),yr.set(Gd,Ed+1,-Cd*yr.get(Gd,Ed)+Fd*yr.get(Gd,Ed+1)),yr.set(Gd,Ed,Td);if(Td=hypotenuse$1(vd,qd),Td===0&&(Td=Number.MIN_VALUE),Fd=vd/Td,Cd=qd/Td,Bt[Ed]=Td,vd=Fd*Io[Ed]+Cd*Bt[Ed+1],Bt[Ed+1]=-Cd*Io[Ed]+Fd*Bt[Ed+1],qd=Cd*Io[Ed+1],Io[Ed+1]=Fd*Io[Ed+1],x&&Ed<r-1)for(let Gd=0;Gd<r;Gd++)Td=Fd*Fn.get(Gd,Ed)+Cd*Fn.get(Gd,Ed+1),Fn.set(Gd,Ed+1,-Cd*Fn.get(Gd,Ed)+Fd*Fn.get(Gd,Ed+1)),Fn.set(Gd,Ed,Td)}Io[ch-2]=vd;break}case 4:{if(Bt[sl]<=0&&(Bt[sl]=Bt[sl]<0?-Bt[sl]:0,M))for(let xh=0;xh<=Zu;xh++)yr.set(xh,sl,-yr.get(xh,sl));for(;sl<Zu&&!(Bt[sl]>=Bt[sl+1]);){let xh=Bt[sl];if(Bt[sl]=Bt[sl+1],Bt[sl+1]=xh,M&&sl<s-1)for(let Mh=0;Mh<s;Mh++)xh=yr.get(Mh,sl+1),yr.set(Mh,sl+1,yr.get(Mh,sl)),yr.set(Mh,sl,xh);if(x&&sl<r-1)for(let Mh=0;Mh<r;Mh++)xh=Fn.get(Mh,sl+1),Fn.set(Mh,sl+1,Fn.get(Mh,sl)),Fn.set(Mh,sl,xh);sl++}ch--;break}}}if(P){let sl=yr;yr=Fn,Fn=sl}this.m=r,this.n=s,this.s=Bt,this.U=Fn,this.V=yr}solve(t){let n=t,r=this.threshold,s=this.s.length,l=Matrix$2.zeros(s,s);for(let nt=0;nt<s;nt++)Math.abs(this.s[nt])<=r?l.set(nt,nt,0):l.set(nt,nt,1/this.s[nt]);let p=this.U,o=this.rightSingularVectors,x=o.mmul(l),M=o.rows,P=p.rows,he=Matrix$2.zeros(M,P);for(let nt=0;nt<M;nt++)for(let _e=0;_e<P;_e++){let Bt=0;for(let Fn=0;Fn<s;Fn++)Bt+=x.get(nt,Fn)*p.get(_e,Fn);he.set(nt,_e,Bt)}return he.mmul(n)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,n=this.threshold,r=t.rows,s=t.columns,l=new Matrix$2(r,this.s.length);for(let P=0;P<r;P++)for(let he=0;he<s;he++)Math.abs(this.s[he])>n&&l.set(P,he,t.get(P,he)/this.s[he]);let p=this.U,o=p.rows,x=p.columns,M=new Matrix$2(r,o);for(let P=0;P<r;P++)for(let he=0;he<o;he++){let nt=0;for(let _e=0;_e<x;_e++)nt+=l.get(P,_e)*p.get(he,_e);M.set(P,he,nt)}return M}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,n=0,r=this.s;for(let s=0,l=r.length;s<l;s++)r[s]>t&&n++;return n}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,t=!1){return e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,t,n=!1){return e=WrapperMatrix2D.checkMatrix(e),t=WrapperMatrix2D.checkMatrix(t),n?new SingularValueDecomposition(e).solve(t):e.isSquare()?new LuDecomposition(e).solve(t):new QrDecomposition(e).solve(t)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,n,r,s;if(e.columns===2)return t=e.get(0,0),n=e.get(0,1),r=e.get(1,0),s=e.get(1,1),t*s-n*r;if(e.columns===3){let l,p,o;return l=new MatrixSelectionView(e,[1,2],[1,2]),p=new MatrixSelectionView(e,[1,2],[0,2]),o=new MatrixSelectionView(e,[1,2],[0,1]),t=e.get(0,0),n=e.get(0,1),r=e.get(0,2),t*determinant(l)-n*determinant(p)+r*determinant(o)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,t){let n=[];for(let r=0;r<e;r++)r!==t&&n.push(r);return n}function dependenciesOneRow(e,t,n,r=1e-9,s=1e-9){if(e>s)return new Array(t.rows+1).fill(0);{let l=t.addRow(n,[0]);for(let p=0;p<l.rows;p++)Math.abs(l.get(p,0))<r&&l.set(p,0,0);return l.to1DArray()}}function linearDependencies(e,t={}){const{thresholdValue:n=1e-9,thresholdError:r=1e-9}=t;e=Matrix$2.checkMatrix(e);let s=e.rows,l=new Matrix$2(s,s);for(let p=0;p<s;p++){let o=Matrix$2.columnVector(e.getRow(p)),x=e.subMatrixRow(xrange(s,p)).transpose(),P=new SingularValueDecomposition(x).solve(o),he=Matrix$2.sub(o,x.mmul(P)).abs().max();l.setRow(p,dependenciesOneRow(he,P,p,n,r))}return l}function pseudoInverse(e,t=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let n=new SingularValueDecomposition(e,{autoTranspose:!0}),r=n.leftSingularVectors,s=n.rightSingularVectors,l=n.diagonal;for(let p=0;p<l.length;p++)Math.abs(l[p])>t?l[p]=1/l[p]:l[p]=0;return s.mmul(Matrix$2.diag(l).mmul(r.transpose()))}function covariance(e,t=e,n={}){e=new Matrix$2(e);let r=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(n=t,t=e,r=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=n;s&&(e=e.center("column"),r||(t=t.center("column")));const l=e.transpose().mmul(t);for(let p=0;p<l.rows;p++)for(let o=0;o<l.columns;o++)l.set(p,o,l.get(p,o)*(1/(e.rows-1)));return l}function correlation(e,t=e,n={}){e=new Matrix$2(e);let r=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(n=t,t=e,r=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:l=!0}=n;s&&(e.center("column"),r||t.center("column")),l&&(e.scale("column"),r||t.scale("column"));const p=e.standardDeviation("column",{unbiased:!0}),o=r?p:t.standardDeviation("column",{unbiased:!0}),x=e.transpose().mmul(t);for(let M=0;M<x.rows;M++)for(let P=0;P<x.columns;P++)x.set(M,P,x.get(M,P)*(1/(p[M]*o[P]))*(1/(e.rows-1)));return x}class EigenvalueDecomposition{constructor(t,n={}){const{assumeSymmetric:r=!1}=n;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let s=t.columns,l=new Matrix$2(s,s),p=new Float64Array(s),o=new Float64Array(s),x=t,M,P,he=!1;if(r?he=!0:he=t.isSymmetric(),he){for(M=0;M<s;M++)for(P=0;P<s;P++)l.set(M,P,x.get(M,P));tred2(s,o,p,l),tql2(s,o,p,l)}else{let nt=new Matrix$2(s,s),_e=new Float64Array(s);for(P=0;P<s;P++)for(M=0;M<s;M++)nt.set(M,P,x.get(M,P));orthes(s,nt,_e,l),hqr2(s,o,p,l,nt)}this.n=s,this.e=o,this.d=p,this.V=l}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,n=this.e,r=this.d,s=new Matrix$2(t,t),l,p;for(l=0;l<t;l++){for(p=0;p<t;p++)s.set(l,p,0);s.set(l,l,r[l]),n[l]>0?s.set(l,l+1,n[l]):n[l]<0&&s.set(l,l-1,n[l])}return s}}function tred2(e,t,n,r){let s,l,p,o,x,M,P,he;for(x=0;x<e;x++)n[x]=r.get(e-1,x);for(o=e-1;o>0;o--){for(he=0,p=0,M=0;M<o;M++)he=he+Math.abs(n[M]);if(he===0)for(t[o]=n[o-1],x=0;x<o;x++)n[x]=r.get(o-1,x),r.set(o,x,0),r.set(x,o,0);else{for(M=0;M<o;M++)n[M]/=he,p+=n[M]*n[M];for(s=n[o-1],l=Math.sqrt(p),s>0&&(l=-l),t[o]=he*l,p=p-s*l,n[o-1]=s-l,x=0;x<o;x++)t[x]=0;for(x=0;x<o;x++){for(s=n[x],r.set(x,o,s),l=t[x]+r.get(x,x)*s,M=x+1;M<=o-1;M++)l+=r.get(M,x)*n[M],t[M]+=r.get(M,x)*s;t[x]=l}for(s=0,x=0;x<o;x++)t[x]/=p,s+=t[x]*n[x];for(P=s/(p+p),x=0;x<o;x++)t[x]-=P*n[x];for(x=0;x<o;x++){for(s=n[x],l=t[x],M=x;M<=o-1;M++)r.set(M,x,r.get(M,x)-(s*t[M]+l*n[M]));n[x]=r.get(o-1,x),r.set(o,x,0)}}n[o]=p}for(o=0;o<e-1;o++){if(r.set(e-1,o,r.get(o,o)),r.set(o,o,1),p=n[o+1],p!==0){for(M=0;M<=o;M++)n[M]=r.get(M,o+1)/p;for(x=0;x<=o;x++){for(l=0,M=0;M<=o;M++)l+=r.get(M,o+1)*r.get(M,x);for(M=0;M<=o;M++)r.set(M,x,r.get(M,x)-l*n[M])}}for(M=0;M<=o;M++)r.set(M,o+1,0)}for(x=0;x<e;x++)n[x]=r.get(e-1,x),r.set(e-1,x,0);r.set(e-1,e-1,1),t[0]=0}function tql2(e,t,n,r){let s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr,Io,rl,Co;for(p=1;p<e;p++)t[p-1]=t[p];t[e-1]=0;let as=0,Js=0,lh=Number.EPSILON;for(M=0;M<e;M++){for(Js=Math.max(Js,Math.abs(n[M])+Math.abs(t[M])),P=M;P<e&&!(Math.abs(t[P])<=lh*Js);)P++;if(P>M)do{for(s=n[M],he=(n[M+1]-s)/(2*t[M]),nt=hypotenuse$1(he,1),he<0&&(nt=-nt),n[M]=t[M]/(he+nt),n[M+1]=t[M]*(he+nt),_e=n[M+1],l=s-n[M],p=M+2;p<e;p++)n[p]-=l;for(as=as+l,he=n[P],Bt=1,Fn=Bt,yr=Bt,Io=t[M+1],rl=0,Co=0,p=P-1;p>=M;p--)for(yr=Fn,Fn=Bt,Co=rl,s=Bt*t[p],l=Bt*he,nt=hypotenuse$1(he,t[p]),t[p+1]=rl*nt,rl=t[p]/nt,Bt=he/nt,he=Bt*n[p]-rl*s,n[p+1]=l+rl*(Bt*s+rl*n[p]),x=0;x<e;x++)l=r.get(x,p+1),r.set(x,p+1,rl*r.get(x,p)+Bt*l),r.set(x,p,Bt*r.get(x,p)-rl*l);he=-rl*Co*yr*Io*t[M]/_e,t[M]=rl*he,n[M]=Bt*he}while(Math.abs(t[M])>lh*Js);n[M]=n[M]+as,t[M]=0}for(p=0;p<e-1;p++){for(x=p,he=n[p],o=p+1;o<e;o++)n[o]<he&&(x=o,he=n[o]);if(x!==p)for(n[x]=n[p],n[p]=he,o=0;o<e;o++)he=r.get(o,p),r.set(o,p,r.get(o,x)),r.set(o,x,he)}}function orthes(e,t,n,r){let s=0,l=e-1,p,o,x,M,P,he,nt;for(he=s+1;he<=l-1;he++){for(nt=0,M=he;M<=l;M++)nt=nt+Math.abs(t.get(M,he-1));if(nt!==0){for(x=0,M=l;M>=he;M--)n[M]=t.get(M,he-1)/nt,x+=n[M]*n[M];for(o=Math.sqrt(x),n[he]>0&&(o=-o),x=x-n[he]*o,n[he]=n[he]-o,P=he;P<e;P++){for(p=0,M=l;M>=he;M--)p+=n[M]*t.get(M,P);for(p=p/x,M=he;M<=l;M++)t.set(M,P,t.get(M,P)-p*n[M])}for(M=0;M<=l;M++){for(p=0,P=l;P>=he;P--)p+=n[P]*t.get(M,P);for(p=p/x,P=he;P<=l;P++)t.set(M,P,t.get(M,P)-p*n[P])}n[he]=nt*n[he],t.set(he,he-1,nt*o)}}for(M=0;M<e;M++)for(P=0;P<e;P++)r.set(M,P,M===P?1:0);for(he=l-1;he>=s+1;he--)if(t.get(he,he-1)!==0){for(M=he+1;M<=l;M++)n[M]=t.get(M,he-1);for(P=he;P<=l;P++){for(o=0,M=he;M<=l;M++)o+=n[M]*r.get(M,P);for(o=o/n[he]/t.get(he,he-1),M=he;M<=l;M++)r.set(M,P,r.get(M,P)+o*n[M])}}}function hqr2(e,t,n,r,s){let l=e-1,p=0,o=e-1,x=Number.EPSILON,M=0,P=0,he=0,nt=0,_e=0,Bt=0,Fn=0,yr=0,Io,rl,Co,as,Js,lh,ch,Zu,th,sl,sh,xh,Mh,Dh,Uh;for(Io=0;Io<e;Io++)for((Io<p||Io>o)&&(n[Io]=s.get(Io,Io),t[Io]=0),rl=Math.max(Io-1,0);rl<e;rl++)P=P+Math.abs(s.get(Io,rl));for(;l>=p;){for(as=l;as>p&&(Bt=Math.abs(s.get(as-1,as-1))+Math.abs(s.get(as,as)),Bt===0&&(Bt=P),!(Math.abs(s.get(as,as-1))<x*Bt));)as--;if(as===l)s.set(l,l,s.get(l,l)+M),n[l]=s.get(l,l),t[l]=0,l--,yr=0;else if(as===l-1){if(ch=s.get(l,l-1)*s.get(l-1,l),he=(s.get(l-1,l-1)-s.get(l,l))/2,nt=he*he+ch,Fn=Math.sqrt(Math.abs(nt)),s.set(l,l,s.get(l,l)+M),s.set(l-1,l-1,s.get(l-1,l-1)+M),Zu=s.get(l,l),nt>=0){for(Fn=he>=0?he+Fn:he-Fn,n[l-1]=Zu+Fn,n[l]=n[l-1],Fn!==0&&(n[l]=Zu-ch/Fn),t[l-1]=0,t[l]=0,Zu=s.get(l,l-1),Bt=Math.abs(Zu)+Math.abs(Fn),he=Zu/Bt,nt=Fn/Bt,_e=Math.sqrt(he*he+nt*nt),he=he/_e,nt=nt/_e,rl=l-1;rl<e;rl++)Fn=s.get(l-1,rl),s.set(l-1,rl,nt*Fn+he*s.get(l,rl)),s.set(l,rl,nt*s.get(l,rl)-he*Fn);for(Io=0;Io<=l;Io++)Fn=s.get(Io,l-1),s.set(Io,l-1,nt*Fn+he*s.get(Io,l)),s.set(Io,l,nt*s.get(Io,l)-he*Fn);for(Io=p;Io<=o;Io++)Fn=r.get(Io,l-1),r.set(Io,l-1,nt*Fn+he*r.get(Io,l)),r.set(Io,l,nt*r.get(Io,l)-he*Fn)}else n[l-1]=Zu+he,n[l]=Zu+he,t[l-1]=Fn,t[l]=-Fn;l=l-2,yr=0}else{if(Zu=s.get(l,l),th=0,ch=0,as<l&&(th=s.get(l-1,l-1),ch=s.get(l,l-1)*s.get(l-1,l)),yr===10){for(M+=Zu,Io=p;Io<=l;Io++)s.set(Io,Io,s.get(Io,Io)-Zu);Bt=Math.abs(s.get(l,l-1))+Math.abs(s.get(l-1,l-2)),Zu=th=.75*Bt,ch=-.4375*Bt*Bt}if(yr===30&&(Bt=(th-Zu)/2,Bt=Bt*Bt+ch,Bt>0)){for(Bt=Math.sqrt(Bt),th<Zu&&(Bt=-Bt),Bt=Zu-ch/((th-Zu)/2+Bt),Io=p;Io<=l;Io++)s.set(Io,Io,s.get(Io,Io)-Bt);M+=Bt,Zu=th=ch=.964}for(yr=yr+1,Js=l-2;Js>=as&&(Fn=s.get(Js,Js),_e=Zu-Fn,Bt=th-Fn,he=(_e*Bt-ch)/s.get(Js+1,Js)+s.get(Js,Js+1),nt=s.get(Js+1,Js+1)-Fn-_e-Bt,_e=s.get(Js+2,Js+1),Bt=Math.abs(he)+Math.abs(nt)+Math.abs(_e),he=he/Bt,nt=nt/Bt,_e=_e/Bt,!(Js===as||Math.abs(s.get(Js,Js-1))*(Math.abs(nt)+Math.abs(_e))<x*(Math.abs(he)*(Math.abs(s.get(Js-1,Js-1))+Math.abs(Fn)+Math.abs(s.get(Js+1,Js+1))))));)Js--;for(Io=Js+2;Io<=l;Io++)s.set(Io,Io-2,0),Io>Js+2&&s.set(Io,Io-3,0);for(Co=Js;Co<=l-1&&(Dh=Co!==l-1,Co!==Js&&(he=s.get(Co,Co-1),nt=s.get(Co+1,Co-1),_e=Dh?s.get(Co+2,Co-1):0,Zu=Math.abs(he)+Math.abs(nt)+Math.abs(_e),Zu!==0&&(he=he/Zu,nt=nt/Zu,_e=_e/Zu)),Zu!==0);Co++)if(Bt=Math.sqrt(he*he+nt*nt+_e*_e),he<0&&(Bt=-Bt),Bt!==0){for(Co!==Js?s.set(Co,Co-1,-Bt*Zu):as!==Js&&s.set(Co,Co-1,-s.get(Co,Co-1)),he=he+Bt,Zu=he/Bt,th=nt/Bt,Fn=_e/Bt,nt=nt/he,_e=_e/he,rl=Co;rl<e;rl++)he=s.get(Co,rl)+nt*s.get(Co+1,rl),Dh&&(he=he+_e*s.get(Co+2,rl),s.set(Co+2,rl,s.get(Co+2,rl)-he*Fn)),s.set(Co,rl,s.get(Co,rl)-he*Zu),s.set(Co+1,rl,s.get(Co+1,rl)-he*th);for(Io=0;Io<=Math.min(l,Co+3);Io++)he=Zu*s.get(Io,Co)+th*s.get(Io,Co+1),Dh&&(he=he+Fn*s.get(Io,Co+2),s.set(Io,Co+2,s.get(Io,Co+2)-he*_e)),s.set(Io,Co,s.get(Io,Co)-he),s.set(Io,Co+1,s.get(Io,Co+1)-he*nt);for(Io=p;Io<=o;Io++)he=Zu*r.get(Io,Co)+th*r.get(Io,Co+1),Dh&&(he=he+Fn*r.get(Io,Co+2),r.set(Io,Co+2,r.get(Io,Co+2)-he*_e)),r.set(Io,Co,r.get(Io,Co)-he),r.set(Io,Co+1,r.get(Io,Co+1)-he*nt)}}}if(P!==0){for(l=e-1;l>=0;l--)if(he=n[l],nt=t[l],nt===0)for(as=l,s.set(l,l,1),Io=l-1;Io>=0;Io--){for(ch=s.get(Io,Io)-he,_e=0,rl=as;rl<=l;rl++)_e=_e+s.get(Io,rl)*s.get(rl,l);if(t[Io]<0)Fn=ch,Bt=_e;else if(as=Io,t[Io]===0?s.set(Io,l,ch!==0?-_e/ch:-_e/(x*P)):(Zu=s.get(Io,Io+1),th=s.get(Io+1,Io),nt=(n[Io]-he)*(n[Io]-he)+t[Io]*t[Io],lh=(Zu*Bt-Fn*_e)/nt,s.set(Io,l,lh),s.set(Io+1,l,Math.abs(Zu)>Math.abs(Fn)?(-_e-ch*lh)/Zu:(-Bt-th*lh)/Fn)),lh=Math.abs(s.get(Io,l)),x*lh*lh>1)for(rl=Io;rl<=l;rl++)s.set(rl,l,s.get(rl,l)/lh)}else if(nt<0)for(as=l-1,Math.abs(s.get(l,l-1))>Math.abs(s.get(l-1,l))?(s.set(l-1,l-1,nt/s.get(l,l-1)),s.set(l-1,l,-(s.get(l,l)-he)/s.get(l,l-1))):(Uh=cdiv(0,-s.get(l-1,l),s.get(l-1,l-1)-he,nt),s.set(l-1,l-1,Uh[0]),s.set(l-1,l,Uh[1])),s.set(l,l-1,0),s.set(l,l,1),Io=l-2;Io>=0;Io--){for(sl=0,sh=0,rl=as;rl<=l;rl++)sl=sl+s.get(Io,rl)*s.get(rl,l-1),sh=sh+s.get(Io,rl)*s.get(rl,l);if(ch=s.get(Io,Io)-he,t[Io]<0)Fn=ch,_e=sl,Bt=sh;else if(as=Io,t[Io]===0?(Uh=cdiv(-sl,-sh,ch,nt),s.set(Io,l-1,Uh[0]),s.set(Io,l,Uh[1])):(Zu=s.get(Io,Io+1),th=s.get(Io+1,Io),xh=(n[Io]-he)*(n[Io]-he)+t[Io]*t[Io]-nt*nt,Mh=(n[Io]-he)*2*nt,xh===0&&Mh===0&&(xh=x*P*(Math.abs(ch)+Math.abs(nt)+Math.abs(Zu)+Math.abs(th)+Math.abs(Fn))),Uh=cdiv(Zu*_e-Fn*sl+nt*sh,Zu*Bt-Fn*sh-nt*sl,xh,Mh),s.set(Io,l-1,Uh[0]),s.set(Io,l,Uh[1]),Math.abs(Zu)>Math.abs(Fn)+Math.abs(nt)?(s.set(Io+1,l-1,(-sl-ch*s.get(Io,l-1)+nt*s.get(Io,l))/Zu),s.set(Io+1,l,(-sh-ch*s.get(Io,l)-nt*s.get(Io,l-1))/Zu)):(Uh=cdiv(-_e-th*s.get(Io,l-1),-Bt-th*s.get(Io,l),Fn,nt),s.set(Io+1,l-1,Uh[0]),s.set(Io+1,l,Uh[1]))),lh=Math.max(Math.abs(s.get(Io,l-1)),Math.abs(s.get(Io,l))),x*lh*lh>1)for(rl=Io;rl<=l;rl++)s.set(rl,l-1,s.get(rl,l-1)/lh),s.set(rl,l,s.get(rl,l)/lh)}for(Io=0;Io<e;Io++)if(Io<p||Io>o)for(rl=Io;rl<e;rl++)r.set(Io,rl,s.get(Io,rl));for(rl=e-1;rl>=p;rl--)for(Io=p;Io<=o;Io++){for(Fn=0,Co=p;Co<=Math.min(rl,o);Co++)Fn=Fn+r.get(Io,Co)*s.get(Co,rl);r.set(Io,rl,Fn)}}}function cdiv(e,t,n,r){let s,l;return Math.abs(n)>Math.abs(r)?(s=r/n,l=n+s*r,[(e+s*t)/l,(t-s*e)/l]):(s=n/r,l=r+s*n,[(s*e+t)/l,(s*t-e)/l])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let n=t,r=n.rows,s=new Matrix$2(r,r),l=!0,p,o,x;for(o=0;o<r;o++){let M=0;for(x=0;x<o;x++){let P=0;for(p=0;p<x;p++)P+=s.get(x,p)*s.get(o,p);P=(n.get(o,x)-P)/s.get(x,x),s.set(o,x,P),M=M+P*P}for(M=n.get(o,o)-M,l&=M>0,s.set(o,o,Math.sqrt(Math.max(M,0))),x=o+1;x<r;x++)s.set(o,x,0)}this.L=s,this.positiveDefinite=!!l}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let n=this.L,r=n.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=t.columns,l=t.clone(),p,o,x;for(x=0;x<r;x++)for(o=0;o<s;o++){for(p=0;p<x;p++)l.set(x,o,l.get(x,o)-l.get(p,o)*n.get(x,p));l.set(x,o,l.get(x,o)/n.get(x,x))}for(x=r-1;x>=0;x--)for(o=0;o<s;o++){for(p=x+1;p<r;p++)l.set(x,o,l.get(x,o)-l.get(p,o)*n.get(p,x));l.set(x,o,l.get(x,o)/n.get(x,x))}return l}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,n={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:r}=n;const{scaleScores:s=!1,maxIterations:l=1e3,terminationCriteria:p=1e-10}=n;let o;if(r){if(isAnyArray(r)&&typeof r[0]=="number"?r=Matrix$2.columnVector(r):r=WrapperMatrix2D.checkMatrix(r),r.rows!==t.rows)throw new Error("Y should have the same number of rows as X");o=r.getColumnVector(0)}else o=t.getColumnVector(0);let x=1,M,P,he,nt;for(let _e=0;_e<l&&x>p;_e++)he=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),he=he.div(he.norm()),M=t.mmul(he).div(he.transpose().mmul(he).get(0,0)),_e>0&&(x=M.clone().sub(nt).pow(2).sum()),nt=M.clone(),r?(P=r.transpose().mmul(M).div(M.transpose().mmul(M).get(0,0)),P=P.div(P.norm()),o=r.mmul(P).div(P.transpose().mmul(P).get(0,0))):o=M;if(r){let _e=t.transpose().mmul(M).div(M.transpose().mmul(M).get(0,0));_e=_e.div(_e.norm());let Bt=t.clone().sub(M.clone().mmul(_e.transpose())),Fn=o.transpose().mmul(M).div(M.transpose().mmul(M).get(0,0)),yr=r.clone().sub(M.clone().mulS(Fn.get(0,0)).mmul(P.transpose()));this.t=M,this.p=_e.transpose(),this.w=he.transpose(),this.q=P,this.u=o,this.s=M.transpose().mmul(M),this.xResidual=Bt,this.yResidual=yr,this.betas=Fn}else this.w=he.transpose(),this.s=M.transpose().mmul(M).sqrt(),s?this.t=M.clone().div(this.s.get(0,0)):this.t=M,this.xResidual=t.sub(M.mmul(he.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(e){const t=new SingularValueDecomposition(e,{autoTranspose:!0});if(t.rank!==1)return null;const n=Math.sqrt(t.s[0]),r=t.U.to2DArray().map(l=>l[0]*n),s=t.V.to2DArray().map(l=>l[0]*n);return[r,s]}function convolution(e,t={}){let{channels:n,bitDepth:r,normalize:s=!1,divisor:l=1,border:p="copy",algorithm:o="auto"}=t,x={};r&&(x.bitDepth=r);let M=Image$1.createFrom(this,x);if(n=validateArrayOfChannels(this,n),o!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(o==="auto"){let as=getSeparatedKernel(e);as!==null?(o="separable",e=as):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?o="fft":o="direct"}let P,he;o==="separable"?(P=Math.floor(e[0].length/2),he=Math.floor(e[1].length/2)):(P=Math.floor(e.length/2),he=Math.floor(e[0].length/2));let nt=M.isClamped,_e=new Array(this.height*this.width),Bt,Fn,yr,Io,rl,Co;for(Io=0;Io<n.length;Io++){for(rl=n[Io],yr=0;yr<this.height;yr++)for(Fn=0;Fn<this.width;Fn++)Bt=yr*this.width+Fn,_e[Bt]=this.data[Bt*this.channels+rl];if(o==="direct")Co=src$2.direct(_e,e,{rows:this.height,cols:this.width,normalize:s,divisor:l});else if(o==="separable"){if(Co=convolutionSeparable(_e,e,this.width,this.height),s){l=0;for(let as=0;as<e[0].length;as++)for(let Js=0;Js<e[1].length;Js++)l+=e[0][as]*e[1][Js]}if(l!==1)for(let as=0;as<Co.length;as++)Co[as]/=l}else Co=src$2.fft(_e,e,{rows:this.height,cols:this.width,normalize:s,divisor:l});for(yr=0;yr<this.height;yr++)for(Fn=0;Fn<this.width;Fn++)Bt=yr*this.width+Fn,nt?M.data[Bt*this.channels+rl]=clamp(Co[Bt],M):M.data[Bt*this.channels+rl]=Co[Bt]}if(this.alpha&&!n.includes(this.channels))for(Fn=this.components;Fn<this.data.length;Fn=Fn+this.channels)M.data[Fn]=this.data[Fn];return p!=="periodic"&&M.setBorder({size:[he,P],algorithm:p}),M}function gradientFilter(e={}){let{direction:t="xy",border:n="copy",kernelX:r,kernelY:s,channels:l,bitDepth:p=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!r)throw new Error("kernelX option is missing");return convolution.call(this,r,{channels:l,border:n,bitDepth:p});case"y":if(!s)throw new Error("kernelY option is missing");return convolution.call(this,s,{channels:l,border:n,bitDepth:p});case"xy":{if(!r)throw new Error("kernelX option is missing");if(!s)throw new Error("kernelY option is missing");const o=convolution.call(this,r,{channels:l,border:n,bitDepth:32}),x=convolution.call(this,s,{channels:l,border:n,bitDepth:32});return o.hypotenuse(x,{bitDepth:p,channels:l})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,t){e=e||0;for(var n=new Array(e),r=0;r<e;r++)n[r]=t;return n}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(e={}){let{algorithm:t="range",channels:n,min:r=this.min,max:s=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),n=validateArrayOfChannels(this,{channels:n}),n.length!==this.channel&&(Array.isArray(r)&&r.length===this.channels&&(r=r.filter((l,p)=>n.includes(p))),Array.isArray(s)&&s.length===this.channels&&(s=s.filter((l,p)=>n.includes(p)))),t){case"range":r<0&&(r=0),s>this.maxValue&&(s=this.maxValue),Array.isArray(r)||(r=newArray$1(n.length,r)),Array.isArray(s)||(s=newArray$1(n.length,s)),processImage(this,r,s,n);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(e,t,n,r){let s=1e-5,l=new Array(r.length);for(let p=0;p<r.length;p++)t[p]===0&&n[p]===e.maxValue||n[p]===t[p]?l[p]=0:l[p]=(e.maxValue+1-s)/(n[p]-t[p]),t[p]+=(.5-s/2)/l[p];for(let p=0;p<r.length;p++){let o=r[p];if(l[p]!==0)for(let x=0;x<e.data.length;x+=e.channels)e.data[x+o]=Math.min(Math.max(0,(e.data[x+o]-t[p])*l[p]+.5|0),e.maxValue)}}var toString$1=Object.prototype.toString,isArrayType=function e(t){return toString$1.call(t).substr(-6,5)==="Array"};const isArray=getDefaultExportFromCjs(isArrayType);function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image$1)return e.data;if(!isArray(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,t={}){let{channels:n}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.max(0,Math.min(this.maxValue,this.data[l+s]+e[l+s]>>0))}}else for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.min(this.maxValue,this.data[l+s]+e>>0)}return this}function subtract(e,t={}){let{channels:n}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.max(0,Math.min(this.maxValue,this.data[l+s]-e[l+s]>>0))}}else for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.max(0,this.data[l+s]-e>>0)}return this}function subtractImage(e,t={}){let{channels:n,absolute:r=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let s=this.clone();n=validateArrayOfChannels(this,{channels:n});for(let l=0;l<n.length;l++){let p=n[l];for(let o=p;o<this.data.length;o+=this.channels){let x=this.data[o]-e.data[o];r?s.data[o]=Math.abs(x):s.data[o]=Math.max(x,0)}}return s}function hypotenuse(e,t={}){let{bitDepth:n=this.bitDepth,channels:r}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let s=Image$1.createFrom(this,{bitDepth:n});r=validateArrayOfChannels(this,{channels:r});let l=s.isClamped;for(let p=0;p<r.length;p++){let o=r[p];for(let x=o;x<this.data.length;x+=this.channels){let M=Math.hypot(this.data[x],e.data[x]);l?s.data[x]=Math.min(Math.max(Math.round(M),0),s.maxValue):s.data[x]=M}}return s}function multiply(e,t={}){let{channels:n}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.max(0,Math.min(this.maxValue,this.data[l+s]*e[l+s]>>0))}}else for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.min(this.maxValue,this.data[l+s]*e>>0)}return this}function divide(e,t={}){let{channels:n}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.max(0,Math.min(this.maxValue,this.data[l+s]/e[l+s]>>0))}}else for(let r=0;r<n.length;r++){let s=n[r];for(let l=0;l<this.data.length;l+=this.channels)this.data[l+s]=Math.min(this.maxValue,this.data[l+s]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const n=[];for(let r=0;r<t.length;r++)n.push(this._predict(t[r]));return n}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,n){if(!isAnyArray(t)||!isAnyArray(n)||t.length!==n.length)throw new Error("x and y must be arrays of the same length");const r=t.length,s=new Array(r);for(let _e=0;_e<r;_e++)s[_e]=this._predict(t[_e]);let l=0,p=0,o=0,x=0,M=0,P=0,he=0;for(let _e=0;_e<r;_e++)l+=s[_e],p+=n[_e],M+=s[_e]*s[_e],P+=n[_e]*n[_e],he+=s[_e]*n[_e],n[_e]!==0&&(o+=(n[_e]-s[_e])*(n[_e]-s[_e])/n[_e]),x+=(n[_e]-s[_e])*(n[_e]-s[_e]);const nt=(r*he-l*p)/Math.sqrt((r*M-l*l)*(r*P-p*p));return{r:nt,r2:nt*nt,chi2:o,rmsd:Math.sqrt(x/r)}}}const require$$0$2=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r]);return n}function euclidean$2(e,t){return Math.sqrt(squaredEuclidean$4(e,t))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,n){const r=squaredEuclidean$3(t,n);return Math.exp(-r/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,n){for(var r=0,s=0;s<t.length;s++)r+=t[s]*n[s];return Math.pow(this.scale*r+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,n){for(var r=0,s=0;s<t.length;s++)r+=t[s]*n[s];return Math.tanh(this.alpha*r+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,n){for(var r=0,s=Math.min(t.length,n.length),l=1;l<=s;++l)r+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[l-1],l)-Math.pow(n[l-1],l),2)),this.degree);return r}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,n){return 1/(1+squaredEuclidean$2(t,n)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,n){const r=euclidean$1(t,n);return Math.exp(-r/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,n){for(var r=Math.min(t.length,n.length),s=0,l=0;l<r;++l)s+=Math.min(t[l],n[l]);return s}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,n){const r=euclidean(t,n);return Math.exp(-r/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,n){return Math.sqrt(squaredEuclidean$1(t,n)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,n){const r=squaredEuclidean(t,n);return 1-r/(r+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,n){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var r=kernelType[t];if(r)this.kernelFunction=new r(n);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,n){if(t=Matrix$1.checkMatrix(t),n===void 0?n=t:n=Matrix$1.checkMatrix(n),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(n));const r=new Matrix$1(t.rows,n.rows);if(t===n)for(let s=0;s<t.rows;s++)for(let l=s;l<t.rows;l++){const p=this.kernelFunction.compute(t.getRow(s),t.getRow(l));r.set(s,l,p),r.set(l,s,p)}else for(let s=0;s<t.rows;s++)for(let l=0;l<n.rows;l++)r.set(s,l,this.kernelFunction.compute(t.getRow(s),n.getRow(l)));return r}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,n,r){if(super(),t===!0)this.alpha=n.alpha,this.inputs=n.inputs,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=new Kernel$1(n.kernelType,n.kernelOptions);else{t=Matrix$2.checkMatrix(t),r=Object.assign({},defaultOptions$2,r);const s=new Kernel$1(r.kernelType,r.kernelOptions),l=s.compute(t),p=t.rows;l.add(Matrix$2.eye(p,p).mul(r.lambda)),this.alpha=solve(l,n),this.inputs=t,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=s}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(e,t,n){const r=new KernelRidgeRegression(e,t,n),s=new Array(this.size);for(let o=0;o<this.width;o++)for(let x=0;x<this.height;x++)s[x*this.width+o]=[o,x];const l=r.predict(s),p=Image$1.createFrom(this);for(let o=0;o<this.size;o++)p.data[o]=Math.min(this.maxValue,Math.max(0,l[o][0]));return p}function dilate(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let r=!0;e:for(const l of t)for(const p of l)if(p!==1){r=!1;break e}let s=this;for(let l=0;l<n;l++)if(this.bitDepth===1)if(r){const p=s.clone();s=dilateOnceBinaryOnlyOnes(s,p,t.length,t[0].length)}else{const p=Image$1.createFrom(s);s=dilateOnceBinary(s,p,t)}else if(r){const p=Image$1.createFrom(s);s=dilateOnceGreyOnlyOnes(s,p,t.length,t[0].length)}else{const p=Image$1.createFrom(s);s=dilateOnceGrey(s,p,t)}return s}function dilateOnceGrey(e,t,n){const r=n.length,s=n[0].length;let l=(r-1)/2,p=(s-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let M=0;for(let P=0;P<s;P++)for(let he=0;he<r;he++){if(n[he][P]!==1)continue;let nt=he-l+x,_e=P-p+o;if(nt<0||_e<0||nt>=e.width||_e>=e.height)continue;const Bt=e.getValueXY(nt,_e,0);Bt>M&&(M=Bt)}t.setValueXY(x,o,0,M)}return t}function dilateOnceGreyOnlyOnes(e,t,n,r){const s=(n-1)/2,l=(r-1)/2,p=[];for(let o=0;o<e.width;o++)p.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let M=0;for(let P=Math.max(0,o-l);P<Math.min(e.height,o+l+1);P++){const he=e.getValueXY(x,P,0);he>M&&(M=he)}p[x]=M}for(let x=0;x<e.width;x++){let M=0;for(let P=Math.max(0,x-s);P<Math.min(e.width,x+s+1);P++)p[P]>M&&(M=p[P]);t.setValueXY(x,o,0,M)}}return t}function dilateOnceBinary(e,t,n){const r=n.length,s=n[0].length;let l=(r-1)/2,p=(s-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let M=0;e:for(let P=0;P<s;P++)for(let he=0;he<r;he++){if(n[he][P]!==1)continue;let nt=he-l+x,_e=P-p+o;if(_e<0||nt<0||nt>=e.width||_e>=e.height)continue;if(e.getBitXY(nt,_e)===1){M=1;break e}}M===1&&t.setBitXY(x,o)}return t}function dilateOnceBinaryOnlyOnes(e,t,n,r){const s=(n-1)/2,l=(r-1)/2,p=[];for(let o=0;o<e.width;o++)p.push(1);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){p[x]=0;for(let M=Math.max(0,o-l);M<Math.min(e.height,o+l+1);M++)if(e.getBitXY(x,M)===1){p[x]=1;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==1){for(let M=Math.max(0,x-s);M<Math.min(e.width,x+s+1);M++)if(p[M]===1){t.setBitXY(x,o);break}}}return t}function erode(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let r=!0;e:for(const l of t)for(const p of l)if(p!==1){r=!1;break e}let s=this;for(let l=0;l<n;l++)if(this.bitDepth===1)if(r){const p=s.clone();s=erodeOnceBinaryOnlyOnes(s,p,t.length,t[0].length)}else{const p=Image$1.createFrom(s);s=erodeOnceBinary(s,p,t)}else if(r){const p=Image$1.createFrom(s);s=erodeOnceGreyOnlyOnes(s,p,t.length,t[0].length)}else{const p=Image$1.createFrom(s);s=erodeOnceGrey(s,p,t)}return s}function erodeOnceGrey(e,t,n){const r=n.length,s=n[0].length;let l=(r-1)/2,p=(s-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let M=e.maxValue;for(let P=0;P<s;P++)for(let he=0;he<r;he++){if(n[he][P]!==1)continue;let nt=he-l+x,_e=P-p+o;if(nt<0||_e<0||nt>=e.width||_e>=e.height)continue;const Bt=e.getValueXY(nt,_e,0);Bt<M&&(M=Bt)}t.setValueXY(x,o,0,M)}return t}function erodeOnceGreyOnlyOnes(e,t,n,r){const s=(n-1)/2,l=(r-1)/2,p=[];for(let o=0;o<e.width;o++)p.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let M=e.maxValue;for(let P=Math.max(0,o-l);P<Math.min(e.height,o+l+1);P++){const he=e.getValueXY(x,P,0);he<M&&(M=he)}p[x]=M}for(let x=0;x<e.width;x++){let M=e.maxValue;for(let P=Math.max(0,x-s);P<Math.min(e.width,x+s+1);P++)p[P]<M&&(M=p[P]);t.setValueXY(x,o,0,M)}}return t}function erodeOnceBinary(e,t,n){const r=n.length,s=n[0].length;let l=(r-1)/2,p=(s-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let M=1;e:for(let P=0;P<s;P++)for(let he=0;he<r;he++){if(n[he][P]!==1)continue;let nt=he-l+x,_e=P-p+o;if(_e<0||nt<0||nt>=e.width||_e>=e.height)continue;if(e.getBitXY(nt,_e)===0){M=0;break e}}M===1&&t.setBitXY(x,o)}return t}function erodeOnceBinaryOnlyOnes(e,t,n,r){const s=(n-1)/2,l=(r-1)/2,p=[];for(let o=0;o<e.width;o++)p.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){p[x]=1;for(let M=Math.max(0,o-l);M<Math.min(e.height,o+l+1);M++)if(e.getBitXY(x,M)===0){p[x]=0;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==0){for(let M=Math.max(0,x-s);M<Math.min(e.width,x+s+1);M++)if(p[M]===0){t.clearBitXY(x,o);break}}}return t}function open(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let r=this;for(let s=0;s<n;s++)r=r.erode({kernel:t}),r=r.dilate({kernel:t});return r}function close(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let r=this;for(let s=0;s<n;s++)r=r.dilate({kernel:t}).erode({kernel:t});return r}function topHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let r=this;for(let s=0;s<n;s++)r=r.open({kernel:t}).subtractImage(r,{absolute:!0});return r}function blackHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let r=this;for(let s=0;s<n;s++)r=r.close({kernel:t}).subtractImage(r,{absolute:!0});return r}function morphologicalGradient(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let r=this;for(let s=0;s<n;s++){let l=r.dilate({kernel:t}),p=r.erode({kernel:t});r=l.subtractImage(p,{absolute:!0})}return r}function order4Points(e){let t=0,n=0,r=0,s=0,l=e[0][0],p=0;for(let M=1;M<e.length;M++)e[M][0]<l&&(l=e[M][0],p=M);let o=e[(p+1)%e.length][0],x=(p+1)%e.length;for(let M=1;M<e.length;M++)e[M][0]<o&&M!==p&&(o=e[M][0],x=M);return e[x][1]<e[p][1]?(t=e[x],s=e[p],p!==(x+1)%4?(n=e[(x+1)%4],r=e[(x+2)%4]):(n=e[(x+2)%4],r=e[(x+3)%4])):(s=e[x],t=e[p],x!==(p+1)%4?(n=e[(p+1)%4],r=e[(p+2)%4]):(n=e[(p+2)%4],r=e[(p+3)%4])),[t,n,r,s]}function distance2Points(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function crossVect(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dotVect(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function computeWidthAndHeigth(e,t,n,r,s,l){let p=Math.max(distance2Points(e,t),distance2Points(r,n)),o=Math.max(distance2Points(e,r),distance2Points(t,n)),x=0,M=0,P=Math.ceil(s/2),he=Math.ceil(l/2),nt=p/o,_e=[e[0],e[1],1],Bt=[t[0],t[1],1],Fn=[r[0],r[1],1],yr=[n[0],n[1],1],Io=dotVect(crossVect(_e,yr),Fn)/dotVect(crossVect(Bt,yr),Fn),rl=dotVect(crossVect(_e,yr),Bt)/dotVect(crossVect(Fn,yr),Bt),Co=[Io*Bt[0]-_e[0],Io*Bt[1]-_e[1],Io*Bt[2]-_e[2]],as=[rl*Fn[0]-_e[0],rl*Fn[1]-_e[1],rl*Fn[2]-_e[2]],Js=Co[0],lh=Co[1],ch=Co[2],Zu=as[0],th=as[1],sl=as[2],sh=1/(ch*sl)*(Js*Zu-(Js*sl+ch*Zu)*P+ch*sl*P*P+(lh*th-(lh*sl+ch*th)*he+ch*sl*he*he));sh>=0?sh=Math.sqrt(sh):sh=Math.sqrt(-sh);let xh=new Matrix$2([[sh,0,P],[0,sh,he],[0,0,1]]),Mh=xh.transpose(),Dh=inverse(Mh),Uh=inverse(xh),cd=Matrix$2.rowVector(Co),Tf=Matrix$2.rowVector(as),yf=Math.sqrt(dotVect(cd.mmul(Dh).mmul(Uh).to1DArray(),Co)/dotVect(Tf.mmul(Dh).mmul(Uh).to1DArray(),as));return yf===0||nt===0?(x=Math.ceil(p),M=Math.ceil(o)):yf<nt?(x=Math.ceil(p),M=Math.ceil(x/yf)):(M=Math.ceil(o),x=Math.ceil(yf*M)),[x,M]}function projectionPoint(e,t,n,r,s,l,p,o,x,M,P,he){let[nt,_e]=[(n*e+r*t+s)/(x*e+M*t+1),(l*e+p*t+o)/(x*e+M*t+1)];return P.getValueXY(Math.floor(nt),Math.floor(_e),he)}function warpingFourPoints(e,t={}){let{calculateRatio:n=!0}=t;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[r,s,l,p]=e,o=[r,s,l,p],[x,M,P,he]=order4Points(o),nt,_e;n?[nt,_e]=computeWidthAndHeigth(x,M,P,he,this.width,this.height):(nt=Math.ceil(Math.max(distance2Points(x,M),distance2Points(he,P))),_e=Math.ceil(Math.max(distance2Points(x,he),distance2Points(M,P))));let Bt=Image$1.createFrom(this,{width:nt,height:_e}),[Fn,yr]=x,[Io,rl]=M,[Co,as]=P,[Js,lh]=he,[ch,Zu]=[0,0],[th,sl]=[0,nt-1],[sh,xh]=[_e-1,nt-1],[Mh,Dh]=[_e-1,0],Uh=new Matrix$2([[ch,Zu,1,0,0,0,-ch*Fn,-Zu*Fn],[th,sl,1,0,0,0,-th*Io,-sl*Io],[sh,xh,1,0,0,0,-sh*Co,-Zu*Co],[Mh,Dh,1,0,0,0,-Mh*Js,-Dh*Js],[0,0,0,ch,Zu,1,-ch*yr,-Zu*yr],[0,0,0,th,sl,1,-th*rl,-sl*rl],[0,0,0,sh,xh,1,-sh*as,-xh*as],[0,0,0,Mh,Dh,1,-Mh*lh,-Dh*lh]]),cd=Matrix$2.columnVector([Fn,Io,Co,Js,yr,rl,as,lh]),yf=new SingularValueDecomposition(Uh).solve(cd),[Af,md,vd,qd,Ed,Td,Fd,Cd]=yf.to1DArray(),Gd=new Matrix$2(_e,nt);for(let bf=0;bf<this.channels;bf++){for(let Id=0;Id<_e;Id++)for(let td=0;td<nt;td++)Gd.set(Id,td,projectionPoint(Id,td,Af,md,vd,qd,Ed,Td,Fd,Cd,this,bf));Bt.setMatrix(Gd,{channel:bf})}return Bt}function crop(e={}){let{x:t=0,y:n=0,width:r=this.width-t,height:s=this.height-n}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),n=Math.round(n),r=Math.round(r),s=Math.round(s),t>this.width-1||n>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${n}) out of range (${this.width-1}; ${this.height-1})`);if(r<=0||s<=0)throw new RangeError(`crop: width and height (width:${r}; height:${s}) must be positive numbers`);if(t<0||n<0)throw new RangeError(`crop: x and y (x:${t}, y:${n}) must be positive numbers`);if(r>this.width-t||s>this.height-n)throw new RangeError(`crop: (x: ${t}, y:${n}, width:${r}, height:${s}) size is out of range`);let l=this;if(this.bitDepth===1){const p=new Image$1(r,s,{kind:"BINARY",parent:this});l=cropBinary(this,p,t,n,r,s)}else{const p=Image$1.createFrom(this,{width:r,height:s,position:[t,n]});l=cropDefault(this,p,t,n,r,s)}return l}function cropDefault(e,t,n,r,s,l){let p=s*e.channels,o=r+l,x=0,M=n*e.channels;for(let P=r;P<o;P++){let he=P*e.width*e.channels+M,nt=he+p;for(;he<nt;he++)t.data[x++]=e.data[he]}return t}function cropBinary(e,t,n,r,s,l){let p=s*e.channels,o=r+l,x=0,M=n*e.channels;for(let P=r;P<o;P++){let he=P*e.width*e.channels+M,nt=he+p;for(;he<nt;he++)e.getBit(he)&&t.setBit(x),++x}return t}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=e;let n=findLeft(this,t,this.components);if(n===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let r=findTop(this,t,this.components,n),s=findBottom(this,t,this.components,n),l=findRight(this,t,this.components,n,r,s);return this.crop({x:n,y:r,width:l-n+1,height:s-r+1})}function findLeft(e,t,n){for(let r=0;r<e.width;r++)for(let s=0;s<e.height;s++)if(e.getValueXY(r,s,n)>=t)return r;return-1}function findTop(e,t,n,r){for(let s=0;s<e.height;s++)for(let l=r;l<e.width;l++)if(e.getValueXY(l,s,n)>=t)return s;return-1}function findBottom(e,t,n,r){for(let s=e.height-1;s>=0;s--)for(let l=r;l<e.width;l++)if(e.getValueXY(l,s,n)>=t)return s;return-1}function findRight(e,t,n,r,s,l){for(let p=e.width-1;p>=r;p--)for(let o=s;o<=l;o++)if(e.getValueXY(p,o,n)>=t)return p;return-1}function getFactor(e){if(typeof e=="string"){const t=e[e.length-1];e=parseFloat(e),t==="%"&&(e/=100)}return e}function getThreshold$1(e,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*t}else{if(typeof e=="number")return e<1?e*t:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,t,n){e=getFactor(e);let r=Math.round(e*t),s=Math.round(e*n);return r<=0&&(r=1),s<=0&&(s=1),{width:r,height:s}}function checkRow(e,t){if(t<0||t>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${t}`)}function checkColumn(e,t){if(t<0||t>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${t}`)}function checkChannel(e,t){if(t<0||t>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,t,n){const r=this.width/t,s=this.height/n;if(this.bitDepth>1)for(let l=0;l<t;l++){const p=Math.floor((l+.5)*r);for(let o=0;o<n;o++){const x=Math.floor((o+.5)*s);for(let M=0;M<this.channels;M++)e.setValueXY(l,o,M,this.getValueXY(p,x,M))}}else for(let l=0;l<t;l++){const p=Math.floor((l+.5)*r);for(let o=0;o<n;o++){const x=Math.floor((o+.5)*s);this.getBitXY(p,x)&&e.setBitXY(l,o)}}}function resize(e={}){const{factor:t=1,interpolation:n=validInterpolations.nearestneighbor,preserveAspectRatio:r=!0}=e,s=checkInterpolation(n);let l=e.width,p=e.height;if(l||(p&&r?l=Math.round(p*(this.width/this.height)):l=this.width),p||(r?p=Math.round(l*(this.height/this.width)):p=this.height),{width:l,height:p}=factorDimensions(t,l,p),l===this.width&&p===this.height){const P=this.clone();return P.position=[0,0],P}let o=Math.round((this.width-l)/2),x=Math.round((this.height-p)/2);const M=Image$1.createFrom(this,{width:l,height:p,position:[o,x]});switch(s){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,M,l,p);break;default:throw new Error(`unsupported resize interpolation: ${s}`)}return M}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSV}),t=0,n=this.data;for(let r=0;r<n.length;r+=this.channels){let s=n[r],l=n[r+1],p=n[r+2],o=Math.min(s,l,p),x=Math.max(s,l,p),M=x-o,P=0,he=x===0?0:M/x,nt=x;if(x!==o){switch(x){case s:P=(l-p)/M+(l<p?6:0);break;case l:P=(p-s)/M+2;break;case p:P=(s-l)/M+4;break;default:throw new Error("unreachable")}P/=6}e.data[t++]=P*this.maxValue,e.data[t++]=he*this.maxValue,e.data[t++]=nt,this.alpha&&(e.data[t++]=n[r+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),n=0,r=this.data;for(let s=0;s<r.length;s+=this.channels){let l=r[s],p=r[s+1],o=r[s+2],x=Math.max(l,p,o),M=Math.min(l,p,o),P=0,he=0,nt=(x+M)/2;if(x!==M){let _e=x-M;switch(he=nt>t?_e/(2-x-M):_e/(x+M),x){case l:P=(p-o)/_e+(p<o?6:0);break;case p:P=(o-l)/_e+2;break;case o:P=(l-p)/_e+4;break;default:throw new Error("unreachable")}P/=6}e.data[n++]=P*this.maxValue,e.data[n++]=he*this.maxValue,e.data[n++]=nt,this.alpha&&(e.data[n++]=r[s+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,n=this.data;for(let r=0;r<n.length;r+=this.channels){let s=n[r],l=n[r+1],p=n[r+2],o=Math.min(this.maxValue-s,this.maxValue-l,this.maxValue-p),x=(this.maxValue-s-o)/(1-o/this.maxValue),M=(this.maxValue-l-o)/(1-o/this.maxValue),P=(this.maxValue-p-o)/(1-o/this.maxValue);e.data[t++]=Math.round(x),e.data[t++]=Math.round(M),e.data[t++]=Math.round(P),e.data[t++]=Math.round(o),this.alpha&&(e.data[t++]=n[r+3])}return e}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,t,n){return e*6966+t*23436+n*2366>>15},luma601(e,t,n){return e*9798+t*19235+n*3735>>15},maximum(e,t,n){return Math.max(e,t,n)},minimum(e,t,n){return Math.min(e,t,n)},average(e,t,n){return(e+t+n)/3>>0},minmax(e,t,n){return(Math.max(e,t,n)+Math.min(e,t,n))/2},red(e){return e},green(e,t){return t},blue(e,t,n){return n},cyan(e,t,n,r){let s=methods$1.black(e,t,n,r);return(r.maxValue-e-s)/(1-s/r.maxValue)>>0},magenta(e,t,n,r){let s=methods$1.black(e,t,n,r);return(r.maxValue-t-s)/(1-s/r.maxValue)>>0},yellow(e,t,n,r){let s=methods$1.black(e,t,n,r);return(r.maxValue-n-s)/(1-s/r.maxValue)>>0},black(e,t,n,r){return Math.min(r.maxValue-e,r.maxValue-t,r.maxValue-n)},hue(e,t,n,r){let s=methods$1.min(e,t,n),l=methods$1.max(e,t,n);if(l===s)return 0;let p=0,o=l-s;switch(l){case e:p=(t-n)/o+(t<n?6:0);break;case t:p=(n-e)/o+2;break;case n:p=(e-t)/o+4;break;default:throw new Error("unreachable")}return p/6*r.maxValue>>0},saturation(e,t,n,r){let s=methods$1.min(e,t,n),l=methods$1.max(e,t,n),p=l-s;return l===0?0:p/l*r.maxValue},lightness(e,t,n){let r=methods$1.min(e,t,n);return(methods$1.max(e,t,n)+r)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:t="luma709",keepAlpha:n=!1,mergeAlpha:r=!0}=e;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),n&=this.alpha,r&=this.alpha,n&&(r=!1);let s=getOutputImage(this,e,{components:1,alpha:n,colorModel:GREY$1}),l;if(typeof t=="function")l=t;else if(l=methods$1[t.toLowerCase()],!l)throw new Error(`unsupported grey algorithm: ${t}`);let p=0;for(let o=0;o<this.data.length;o+=this.channels)r?s.data[p++]=clamp(l(this.data[o],this.data[o+1],this.data[o+2],this)*this.data[o+this.components]/this.maxValue,this):(s.data[p++]=clamp(l(this.data[o],this.data[o+1],this.data[o+2],this),this),s.alpha&&(s.data[p++]=this.data[o+this.components]));return s}function huang(e){let t=0;for(let P=0;P<e.length;P++)if(e[P]!==0){t=P;break}let n=e.length-1;for(let P=e.length-1;P>=t;P--)if(e[P]!==0){n=P;break}let r=1/(n-t),s=new Array(e.length),l=0,p=0;for(let P=t;P<e.length;P++)l+=P*e[P],p+=e[P],s[P]=l/p;let o=new Array(e.length);l=p=0;for(let P=n;P>0;P--)l+=P*e[P],p+=e[P],o[P-1]=l/p;let x=-1,M=Number.MAX_VALUE;for(let P=0;P<e.length;P++){let he=0,nt;for(let _e=0;_e<=P;_e++)nt=1/(1+r*Math.abs(_e-s[P])),nt<1e-6||nt>.999999||(he+=e[_e]*(-nt*Math.log(nt)-(1-nt)*Math.log(1-nt)));for(let _e=P+1;_e<e.length;_e++)nt=1/(1+r*Math.abs(_e-o[P])),nt<1e-6||nt>.999999||(he+=e[_e]*(-nt*Math.log(nt)-(1-nt)*Math.log(1-nt)));he<M&&(M=he,x=P)}return x}function intermodes(e){let t=e.slice(),n=0;for(;!bimodalTest$1(t);){let s=0,l=0,p=t[0];for(let o=0;o<e.length-1;o++)s=l,l=p,p=t[o+1],t[o]=(s+l+p)/3;if(t[e.length-1]=(l+p)/3,n++,n>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let r=0;for(let s=1;s<e.length-1;s++)t[s-1]<t[s]&&t[s+1]<t[s]&&(r+=s);return Math.floor(r/2)}function bimodalTest$1(e){let t=!1,n=0;for(let r=1;r<e.length-1;r++)if(e[r-1]<e[r]&&e[r+1]<e[r]&&(n++,n>2))return!1;return n===2&&(t=!0),t}function isodata(e){let t,n,r,s,l=0;for(let p=1;p<e.length;p++)if(e[p]>0){l=p+1;break}for(;;){t=0,r=0;for(let p=0;p<l;p++)r=r+e[p],t=t+e[p]*p;s=0,n=0;for(let p=l+1;p<e.length;p++)n+=e[p],s+=e[p]*p;if(r>0&&n>0&&(t/=r,s/=n,l===Math.round((t+s)/2)))break;if(l++,l>e.length-2)throw new Error("Threshold not found")}return l}function li$1(e,t){let n,r,s,l,p,o,x,M,P,he,nt,_e;nt=.5,he=0;for(let Bt=0;Bt<e.length;Bt++)he+=Bt*e[Bt];he/=t,x=he;do{o=x,n=o+.5|0,r=0,l=0;for(let Bt=0;Bt<=n;Bt++)r+=Bt*e[Bt],l+=e[Bt];M=l===0?0:r/l,s=0,p=0;for(let Bt=n+1;Bt<e.length;Bt++)s+=Bt*e[Bt],p+=e[Bt];P=p===0?0:s/p,_e=(M-P)/(Math.log(M)-Math.log(P)),_e<-Number.EPSILON?x=_e-.5|0:x=_e+.5|0}while(Math.abs(x-o)>nt);return n}function maxEntropy(e,t){let n=new Array(e.length);for(let nt=0;nt<e.length;nt++)n[nt]=e[nt]/t;let r=new Array(e.length),s=new Array(e.length);r[0]=n[0],s[0]=1-r[0];for(let nt=1;nt<e.length;nt++)r[nt]=r[nt-1]+n[nt],s[nt]=1-r[nt];let l=0;for(let nt=0;nt<e.length;nt++)if(Math.abs(r[nt])>=Number.EPSILON){l=nt;break}let p=e.length-1;for(let nt=e.length-1;nt>=l;nt--)if(Math.abs(s[nt])>=Number.EPSILON){p=nt;break}let o=-1,x,M=Number.MIN_VALUE,P,he;for(let nt=l;nt<=p;nt++){P=0;for(let _e=0;_e<=nt;_e++)e[_e]!==0&&(P-=n[_e]/r[nt]*Math.log(n[_e]/r[nt]));he=0;for(let _e=nt+1;_e<e.length;_e++)e[_e]!==0&&(he-=n[_e]/s[nt]*Math.log(n[_e]/s[nt]));x=P+he,M<x&&(M=x,o=nt)}return o}function mean$1(e,t){let n=0;for(let r=0;r<e.length;r++)n+=r*e[r];return Math.floor(n/t)}function minError(e,t){let n,r=-2,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn=0;for(let yr=0;yr<e.length;yr++)Fn+=yr*e[yr];for(Fn/=t,n=Fn;n!==r;){let yr=sumA(e,n),Io=sumA(e,e.length-1),rl=sumB(e,n),Co=sumB(e,e.length-1),as=sumC(e,n),Js=sumC(e,e.length-1);if(s=rl/yr,l=(Co-rl)/(Io-yr),p=yr/Io,o=(Io-yr)/Io,x=as/yr-s*s,M=(Js-as)/(Io-yr)-l*l,P=1/x-1/M,he=s/x-l/M,nt=s*s/x-l*l/M+Math.log10(x*(o*o)/(M*(p*p))),_e=he*he-P*nt,_e<0)return n;r=n,Bt=(he+Math.sqrt(_e))/P,isNaN(Bt)?n=r:n=Math.floor(Bt)}return n}function sumA(e,t){let n=0;for(let r=0;r<=t;r++)n+=e[r];return n}function sumB(e,t){let n=0;for(let r=0;r<=t;r++)n+=r*e[r];return n}function sumC(e,t){let n=0;for(let r=0;r<=t;r++)n+=r*r*e[r];return n}function minimum(e){if(e.length<2)return 0;let t=0,n=-1,r=-1,s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=e[l],e[l]>0&&(r=l);for(;!bimodalTest(s);)if(s=smoothed(s),t++,t>1e4)return n;return n=minimumBetweenPeeks(s,r),n}function smoothed(e){let t=new Array(e.length);for(let n=1;n<e.length-1;n++)t[n]=(e[n-1]+e[n]+e[n+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function minimumBetweenPeeks(e,t){let n;for(let r=1;r<t;r++)if(e[r-1]>e[r]&&e[r+1]>=e[r]){n=r;break}return n}function bimodalTest(e){let t=e.length,n=!1,r=0;for(let s=1;s<t-1;s++)if(e[s-1]<e[s]&&e[s+1]<e[s]&&(r++,r>2))return!1;return r===2&&(n=!0),n}function moments(e,t){let n=1,r=0,s=0,l=0,p=0,o,x,M,P,he,nt,_e=-1,Bt=e.length,Fn=new Array(Bt);for(let yr=0;yr<Bt;yr++)Fn[yr]=e[yr]/t;for(let yr=0;yr<Bt;yr++)r+=yr*Fn[yr],s+=yr*yr*Fn[yr],l+=yr*yr*yr*Fn[yr];x=n*s-r*r,M=(-s*s+r*l)/x,P=(n*-l+s*r)/x,he=.5*(-P-Math.sqrt(P*P-4*M)),nt=.5*(-P+Math.sqrt(P*P-4*M)),o=(nt-r)/(nt-he);for(let yr=0;yr<Bt;yr++)if(p+=Fn[yr],p>o){_e=yr;break}return _e}function otsu(e,t){let n=0,r=0,s=0,l=0,p=0;for(let o=0;o<e.length;o++)p+=o*e[o];for(let o=0;o<e.length;o++){r=r+e[o];const x=t-r;if(r===0||x===0)continue;n=n+o*e[o];const M=(p-n)/x,P=r*x*(n/r-M)*(n/r-M);P>=s&&(l=o,s=P)}return l}function percentile(e){let t=-1,n=.5,r=new Array(e.length),s=partialSum(e,e.length-1),l=1;for(let p=0;p<e.length;p++)r[p]=Math.abs(partialSum(e,p)/s-n),r[p]<l&&(l=r[p],t=p);return t}function partialSum(e,t){let n=0;for(let r=0;r<=t;r++)n+=e[r];return n}function renyiEntropy(e,t){let n,r,s,l=new Array(e.length),p=new Array(e.length),o=new Array(e.length),x=0,M=0,P=0,he=0,nt=0,_e=0,Fn=1/(1-.5),Io=1/(1-2);for(let Js=0;Js<e.length;Js++)l[Js]=e[Js]/t;p[0]=l[0],o[0]=1-p[0];for(let Js=1;Js<e.length;Js++)p[Js]=p[Js-1]+l[Js],o[Js]=1-p[Js];r=0;for(let Js=0;Js<e.length;Js++)if(Math.abs(p[Js])>=Number.EPSILON){r=Js;break}s=e.length-1;for(let Js=e.length-1;Js>=r;Js--)if(Math.abs(o[Js])>=Number.EPSILON){s=Js;break}for(let Js=r;Js<=s;Js++){let lh=0,ch=0,Zu=0;for(let Uh=0;Uh<=Js;Uh++)e[Uh]!==0&&(lh-=l[Uh]/p[Js]*Math.log(l[Uh]/p[Js])),ch+=Math.sqrt(l[Uh]/p[Js]),Zu+=l[Uh]*l[Uh]/(p[Js]*p[Js]);let th=0,sl=0,sh=0;for(let Uh=Js+1;Uh<e.length;Uh++)e[Uh]!==0&&(th-=l[Uh]/o[Js]*Math.log(l[Uh]/o[Js])),sl+=Math.sqrt(l[Uh]/o[Js]),sh+=l[Uh]*l[Uh]/(o[Js]*o[Js]);let xh=lh+th,Mh=Fn*(ch*sl>0?Math.log(ch*sl):0),Dh=Io*(Zu*sh>0?Math.log(Zu*sh):0);xh>he&&(he=xh,x=Js),Mh>nt&&(nt=Mh,M=Js),Dh>_e&&(_e=Dh,P=Js)}let rl=[x,M,P];rl.sort((Js,lh)=>Js-lh);let Co;Math.abs(rl[0]-rl[1])<=5?Math.abs(rl[1]-rl[2])<=5?Co=[1,2,1]:Co=[0,1,3]:Math.abs(rl[1]-rl[2])<=5?Co=[3,1,0]:Co=[1,2,1];let as=p[rl[2]]-p[rl[0]];return n=Math.round(rl[0]*(p[rl[0]]+.25*as*Co[0])+.25*rl[1]*as*Co[1]+rl[2]*(o[rl[2]]+.25*as*Co[2])),n}function shanbhag(e,t){let n=new Array(e.length);for(let _e=0;_e<e.length;_e++)n[_e]=e[_e]/t;let r=new Array(e.length),s=new Array(e.length);r[0]=n[0],s[0]=1-r[0];for(let _e=1;_e<e.length;_e++)r[_e]=r[_e-1]+n[_e],s[_e]=1-r[_e];let l=0;for(let _e=0;_e<e.length;_e++)if(Math.abs(r[_e])>=Number.EPSILON){l=_e;break}let p=e.length-1;for(let _e=e.length-1;_e>=l;_e--)if(Math.abs(s[_e])>=Number.EPSILON){p=_e;break}let o=-1,x=Number.MAX_VALUE,M,P,he,nt;for(let _e=l;_e<=p;_e++){he=0,M=.5/r[_e];for(let Bt=1;Bt<=_e;Bt++)he-=n[Bt]*Math.log(1-M*r[Bt-1]);he*=M,nt=0,M=.5/s[_e];for(let Bt=_e+1;Bt<e.length;Bt++)nt-=n[Bt]*Math.log(1-M*s[Bt]);nt*=M,P=Math.abs(he-nt),P<x&&(x=P,o=_e)}return o}function triangle$1(e){let t=0,n=0,r=0,s=0;for(let he=0;he<e.length;he++)if(e[he]>0){t=he;break}t>0&&t--;for(let he=e.length-1;he>0;he--)if(e[he]>0){s=he;break}s<e.length-1&&s++;for(let he=0;he<e.length;he++)e[he]>n&&(r=he,n=e[he]);let l=!1;if(r-t<s-r){l=!0;let he=0,nt=e.length-1;for(;he<nt;){let _e=e[he];e[he]=e[nt],e[nt]=_e,he++,nt--}t=e.length-1-s,r=e.length-1-r}if(t===r)return t;let p,o,x;p=e[r],o=t-r,x=Math.sqrt(p*p+o*o),p/=x,o/=x,x=p*t+o*e[t];let M=t,P=0;for(let he=t+1;he<=r;he++){let nt=p*he+o*e[he]-x;nt>P&&(M=he,P=nt)}if(M--,l){let he=0,nt=e.length-1;for(;he<nt;){let _e=e[he];e[he]=e[nt],e[nt]=_e,he++,nt--}return e.length-1-M}else return M}function yen(e,t){let n=new Array(e.length);for(let M=0;M<e.length;M++)n[M]=e[M]/t;let r=new Array(e.length);r[0]=n[0];for(let M=1;M<e.length;M++)r[M]=r[M-1]+n[M];let s=new Array(e.length);s[0]=n[0]*n[0];for(let M=1;M<e.length;M++)s[M]=s[M-1]+n[M]*n[M];let l=new Array(e.length);l[e.length-1]=0;for(let M=e.length-2;M>=0;M--)l[M]=l[M+1]+n[M+1]*n[M+1];let p=-1,o=Number.MIN_VALUE,x;for(let M=0;M<e.length;M++)x=-1*(s[M]*l[M]>0?Math.log(s[M]*l[M]):0)+2*(r[M]*(1-r[M])>0?Math.log(r[M]*(1-r[M])):0),x>o&&(o=x,p=M);return p}const methods={huang,intermodes,isodata,li:li$1,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:t=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let n=methods[t.toLowerCase()];if(n){let r=this.getHistogram();return n(r,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:t=THRESHOLD,threshold:n=.5,useAlpha:r=!0,invert:s=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?n=getThreshold$1(n,this.maxValue):n=getThreshold.call(this,e);let l=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),p=0;if(this.alpha&&r)for(let o=0;o<this.data.length;o+=this.channels){let x=this.data[o]+(this.maxValue-this.data[o])*(this.maxValue-this.data[o+1])/this.maxValue;(s&&x<=n||!s&&x>=n)&&l.setBit(p),p++}else for(let o=0;o<this.data.length;o+=this.channels)(s&&this.data[o]<=n||!s&&this.data[o]>=n)&&l.setBit(p),p++;return l}function copyImage(e,t,n,r){let s=e.width,l=e.height,p=t.width,o=e.channels;for(let x=0;x<s;x++)for(let M=0;M<l;M++)for(let P=0;P<o;P++){let he=(M*s+x)*o+P,nt=((r+M)*p+n+x)*o+P;t.data[nt]=e.data[he]}}function pad(e={}){let{size:t=0,algorithm:n="copy",color:r}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),n==="set"){if(r.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let x=0;x<r.length;x++)r[x]===0&&(r[x]=.001)}else r=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let s=this.width+t[0]*2,l=this.height+t[1]*2,p=this.channels,o=Image$1.createFrom(this,{width:s,height:l});copyImage(this,o,t[0],t[1]);for(let x=t[0];x<s-t[0];x++)for(let M=0;M<p;M++){let P=r[M]||o.data[(t[1]*s+x)*p+M];for(let he=0;he<t[1];he++)o.data[(he*s+x)*p+M]=P;P=r[M]||o.data[((l-t[1]-1)*s+x)*p+M];for(let he=l-t[1];he<l;he++)o.data[(he*s+x)*p+M]=P}for(let x=0;x<l;x++)for(let M=0;M<p;M++){let P=r[M]||o.data[(x*s+t[0])*p+M];for(let he=0;he<t[0];he++)o.data[(x*s+he)*p+M]=P;P=r[M]||o.data[(x*s+s-t[0]-1)*p+M];for(let he=s-t[0];he<s;he++)o.data[(x*s+he)*p+M]=P}return o}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let t=Image$1.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let n=0;n<this.size;n++)this.getBit(n)&&(t.data[n]=255);else for(let n=0;n<this.data.length;n++)t.data[n]=this.data[n]>>8;break;case 16:if(this.bitDepth===1)for(let n=0;n<this.size;n++)this.getBit(n)&&(t.data[n]=65535);else for(let n=0;n<this.data.length;n++)t.data[n]=this.data[n]<<8|this.data[n];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(e,t={}){const{interpolation:n=validInterpolations.nearestneighbor,width:r=this.width,height:s=this.height}=t;if(typeof e!="number")throw new TypeError("degrees must be a number");const l=checkInterpolation(n),p=e*Math.PI/180,o=Math.floor(Math.abs(r*Math.cos(p))+Math.abs(s*Math.sin(p))),x=Math.floor(Math.abs(s*Math.cos(p))+Math.abs(r*Math.sin(p))),M=Math.cos(-p),P=Math.sin(-p);let he=o/2,nt=x/2;o%2===0?(he=he-.5,x%2===0?nt=nt-.5:nt=Math.floor(nt)):(he=Math.floor(he),x%2===0?nt=nt-.5:nt=Math.floor(nt));const _e=Math.floor(r/2-he),Bt=Math.floor(s/2-nt);if(this.bitDepth===1){const Fn=new Image$1(o,x,{kind:"BINARY",parent:this});switch(l){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,Fn,_e,Bt,he,nt,M,P);case validInterpolations.bilinear:return rotateBinaryBilinear(this,Fn,_e,Bt,he,nt,M,P);default:throw new Error(`unsupported rotate interpolation: ${l}`)}}else{const Fn=Image$1.createFrom(this,{width:o,height:x});switch(l){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,Fn,_e,Bt,he,nt,M,P);case validInterpolations.bilinear:return rotateBilinear(this,Fn,_e,Bt,he,nt,M,P);default:throw new Error(`unsupported rotate interpolation: ${l}`)}}}function rotateNearestNeighbor(e,t,n,r,s,l,p,o){for(let x=0;x<t.width;x+=1)for(let M=0;M<t.height;M+=1)for(let P=0;P<e.channels;P++){let he=Math.round((x-s)*p-(M-l)*o+s)+n,nt=Math.round((M-l)*p+(x-s)*o+l)+r;he<0||he>=e.width||nt<0||nt>=e.height?e.alpha===1&&P===e.channels-1?t.setValueXY(x,M,P,0):t.setValueXY(x,M,P,e.maxValue):t.setValueXY(x,M,P,e.getValueXY(he,nt,P))}return t}function rotateBinaryNearestNeighbor(e,t,n,r,s,l,p,o){for(let x=0;x<t.width;x+=1)for(let M=0;M<t.height;M+=1){let P=Math.round((x-s)*p-(M-l)*o+s)+n,he=Math.round((M-l)*p+(x-s)*o+l)+r;(P<0||P>=e.width||he<0||he>=e.height||e.getBitXY(P,he))&&t.setBitXY(x,M)}return t}function rotateBilinear(e,t,n,r,s,l,p,o){let x=e.width*e.channels;for(let M=0;M<t.height;M++)for(let P=0;P<t.width;P++){let he=(P-s)*p-(M-l)*o+s+n,nt=(M-l)*p+(P-s)*o+l+r,_e=he|0,Bt=nt|0,Fn=he-_e,yr=nt-Bt;for(let Io=0;Io<e.channels;Io++)if(he<0||he>=e.width||nt<0||nt>=e.height)e.alpha===1&&Io===e.channels-1?t.setValueXY(P,M,Io,0):t.setValueXY(P,M,Io,e.maxValue);else{let rl=(Bt*e.width+_e)*e.channels+Io,Co=e.data[rl],as=e.data[rl+e.channels],Js=e.data[rl+x],lh=e.data[rl+x+e.channels],ch=Co+Fn*(as-Co)+yr*(Js-Co)+Fn*yr*(Co-as-Js+lh)|0;t.setValueXY(P,M,Io,ch)}}return t}function rotateBinaryBilinear(e,t,n,r,s,l,p,o){let x=e.width;for(let M=0;M<t.height;M++)for(let P=0;P<t.width;P++){let he=(P-s)*p-(M-l)*o+s+n,nt=(M-l)*p+(P-s)*o+l+r,_e=he|0,Bt=nt|0,Fn=he-_e,yr=nt-Bt;if(he<0||he>=e.width||nt<0||nt>=e.height)t.setBitXY(P,M);else{let Io=Bt*e.width+_e,rl=e.getBit(Io),Co=e.getBit(Io+1),as=e.getBit(Io+x),Js=e.getBit(Io+1+x);(rl|Fn&Co-rl|yr&as-rl|Fn&yr&rl-Co-as+Js)>0&&t.setBitXY(P,M)}}return t}function rotate$1(e,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,t)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.height-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)this.getBitXY(r,n)&&e.setBitXY(n,t-r);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.height-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)for(let s=0;s<this.channels;s++)e.setValueXY(n,t-r,s,this.getValueXY(r,n,s));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.width-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)this.getBitXY(r,n)&&e.setBitXY(t-n,r);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.width-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)for(let s=0;s<this.channels;s++)e.setValueXY(t-n,r,s,this.getValueXY(r,n,s));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),t=e.width-1,n=e.height-1;for(let r=0;r<this.height;r++)for(let s=0;s<this.width;s++)this.getBitXY(s,r)&&e.setBitXY(t-s,n-r);return e}else{const e=Image$1.createFrom(this),t=e.width-1,n=e.height-1;for(let r=0;r<this.height;r++)for(let s=0;s<this.width;s++)for(let l=0;l<this.channels;l++)e.setValueXY(t-s,n-r,l,this.getValueXY(s,r,l));return e}}function insert(e,t={}){const n=getImageParameters(e);this.checkProcessable("insert",n);let{x:r=0,y:s=0}=t;const l=getOutputImageOrInPlace(this,t,{copy:!0}),p=Math.min(l.height,s+e.height),o=Math.min(l.width,r+e.width);if(l.bitDepth===1)for(let x=s;x<p;x++)for(let M=r;M<o;M++)e.getBitXY(M-r,x-s)?l.setBitXY(M,x):l.clearBitXY(M,x);else for(let x=s;x<p;x++)for(let M=r;M<o;M++)l.setPixelXY(M,x,e.getPixelXY(M-r,x-s));return l}function setBorder(e={}){let{size:t=0,algorithm:n="copy",color:r}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),n==="set"){if(r.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let o=0;o<r.length;o++)r[o]===0&&(r[o]=.001)}else r=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let s=t[0],l=t[1],p=this.channels;for(let o=s;o<this.width-s;o++)for(let x=0;x<p;x++){let M=r[x]||this.data[(o+this.width*l)*p+x];for(let P=0;P<l;P++)this.data[(P*this.width+o)*p+x]=M;M=r[x]||this.data[(o+this.width*(this.height-l-1))*p+x];for(let P=this.height-l;P<this.height;P++)this.data[(P*this.width+o)*p+x]=M}for(let o=0;o<this.height;o++)for(let x=0;x<p;x++){let M=r[x]||this.data[(o*this.width+s)*p+x];for(let P=0;P<s;P++)this.data[(o*this.width+P)*p+x]=M;M=r[x]||this.data[(o*this.width+this.width-s-1)*p+x];for(let P=this.width-s;P<this.width;P++)this.data[(o*this.width+P)*p+x]=M}return this}function split(e={}){let{preserveAlpha:t=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let n=new Stack,r=this.data;if(this.alpha&&t)for(let s=0;s<this.components;s++){let l=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),p=0;for(let o=0;o<r.length;o+=this.channels)l.data[p++]=r[o+s],l.data[p++]=r[o+this.components];n.push(l)}else for(let s=0;s<this.channels;s++){let l=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),p=0;for(let o=0;o<r.length;o+=this.channels)l.data[p++]=r[o+s];n.push(l)}return n}function getChannel(e,t={}){let{keepAlpha:n=!1,mergeAlpha:r=!1}=t;n&=this.alpha,r&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let s=Image$1.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),l=0;for(let p=0;p<this.data.length;p+=this.channels)r?s.data[l++]=this.data[p+e]*this.data[p+this.components]/this.maxValue:(s.data[l++]=this.data[p+e],n&&(s.data[l++]=this.data[p+this.components]));return s}function combineChannels(e=defaultCombineMethod,t={}){let{mergeAlpha:n=!1,keepAlpha:r=!1}=t;n&=this.alpha,r&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let s=Image$1.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),l=0;for(let p=0;p<this.size;p++){let o=e(this.getPixel(p));n?s.data[l++]=o*this.data[p*this.channels+this.components]/this.maxValue:(s.data[l++]=o,r&&(s.data[l++]=this.data[p*this.channels+this.components]))}return s}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let n=e;for(let r=0;r<t.data.length;r++)this.data[n]=t.data[r],n+=this.channels;return this}function getSimilarity(e,t={}){let{shift:n=[0,0],average:r,channels:s,defaultAlpha:l,normalize:p,border:o=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(o)||(o=[o,o]),s=validateArrayOfChannels(this,{channels:s,defaultAlpha:l}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof r>"u"&&(r=!0);let x=Math.max(o[0],-n[0]),M=Math.min(this.width-o[0],this.width-n[0]),P=Math.max(o[1],-n[1]),he=Math.min(this.height-o[1],this.height-n[1]),nt=newArray$1(s.length,0);for(let _e=0;_e<s.length;_e++){let Bt=s[_e],Fn=p?this.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]),yr=p?e.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]);if(Fn!==0&&yr!==0)for(let Io=x;Io<M;Io++)for(let rl=P;rl<he;rl++){let Co=Io*this.multiplierX+rl*this.multiplierY+Bt,as=Co+n[0]*this.multiplierX+n[1]*this.multiplierY;nt[_e]+=Math.min(this.data[Co]/Fn,e.data[as]/yr)}}return r?nt.reduce((_e,Bt)=>_e+Bt)/nt.length:nt}function getPixelsGrid(e={}){let{sampling:t=[10,10],painted:n=!1,mask:r}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const s=t[0],l=t[1],p=[],o=[],x=this.width/s,M=this.height/l;let P=Math.floor(x/2);for(let nt=0;nt<s;nt++){let _e=Math.floor(M/2);for(let Bt=0;Bt<l;Bt++){let Fn=Math.round(P),yr=Math.round(_e);(!r||r.getBitXY(Fn,yr))&&(p.push([Fn,yr]),o.push(this.getPixelXY(Fn,yr))),_e+=M}P+=x}const he={xyS:p,zS:o};return n&&(he.painted=this.rgba8().paintPoints(p)),he}function Matrix(e,t,n){const r=new Array(e);for(let s=0;s<e;s++)r[s]=new Array(t);if(n)for(let s=0;s<e;s++)for(let l=0;l<t;l++)r[s][l]=n;return r.width=e,r.height=t,Object.setPrototypeOf(r,Matrix.prototype),r}Matrix.prototype.localMin=function(e,t){let n=this[e][t],r=[e,t];for(let s=Math.max(0,e-1);s<Math.min(this.length,e+2);s++)for(let l=Math.max(0,t-1);l<Math.min(this[0].length,t+2);l++)this[s][l]<n&&(n=this[s][l],r=[s,l]);return{position:r,value:n}};Matrix.prototype.localMax=function(e,t){let n=this[e][t],r=[e,t];for(let s=Math.max(0,e-1);s<Math.min(this.length,e+2);s++)for(let l=Math.max(0,t-1);l<Math.min(this[0].length,t+2);l++)this[s][l]>n&&(n=this[s][l],r=[s,l]);return{position:r,value:n}};Matrix.prototype.localSearch=function(e,t,n){let r=[];for(let s=Math.max(0,e-1);s<Math.min(this.length,e+2);s++)for(let l=Math.max(0,t-1);l<Math.min(this[0].length,t+2);l++)this[s][l]===n&&r.push([s,l]);return r};function getBestMatch(e,t={}){let{border:n}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let r=new Matrix(e.width,e.height,-1/0),s=Math.floor(e.width/2),l=Math.floor(e.height/2),p=s,o=l,x=!1;for(;!x;){let M=r.localSearch(s,l,-1/0);for(let he=0;he<M.length;he++){let nt=M[he],_e=this.getSimilarity(e,{border:n,shift:[p-nt[0],o-nt[1]]});r[nt[0]][nt[1]]=_e}let P=r.localMax(s,l);P.position[0]!==s||P.position[1]!==l?(s=P.position[0],l=P.position[1]):x=!0}return[s-p,l-o]}function getRow(e,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,t);let n=new Array(this.width),r=0,s=e*this.width*this.channels+t,l=s+this.width*this.channels;for(let p=s;p<l;p+=this.channels)n[r++]=this.data[p];return n}function getColumn(e,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,t);let n=new Array(this.height),r=0,s=this.width*this.channels;for(let l=t+e*this.channels;l<this.data.length;l+=s)n[r++]=this.data[l];return n}function getMatrix(e={}){let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let n=new Matrix$2(this.height,this.width);for(let r=0;r<this.height;r++)for(let s=0;s<this.width;s++)n.set(r,s,this.getValueXY(s,r,t));return n}function setMatrix(e,t={}){e=new Matrix$2(e);let{channel:n}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),n===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");n=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let r=0;r<this.height;r++)for(let s=0;s<this.width;s++)this.setValueXY(s,r,n,e.get(r,s))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),t=0;for(let n=0;n<this.data.length;n+=this.channels){let r=new Array(this.components);for(let s=0;s<this.components;s++)r[s]=this.data[n+s];e[t++]=r}return e}function getIntersection(e){let t=this,n=t.getClosestCommonParent(e),r=t.getRelativePosition(n,{defaultFurther:!0}),s=getRelativePositionForAllPixels(t,r),l=e.getRelativePosition(n,{defaultFurther:!0}),p=getRelativePositionForAllPixels(e,l),o=getCommonSurface(s,p),x={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let M=0;M<o.length;M++){let P=o[M],he=[P[0]-r[0],P[1]-r[1]],nt=[P[0]-l[0],P[1]-l[1]],_e=t.getBitXY(he[0],he[1]),Bt=e.getBitXY(nt[0],nt[1]);_e===1&&Bt===1&&x.commonWhitePixels.push(P)}for(let M=0;M<s.length;M++){let P,he;M!==0&&(P=Math.floor(M/t.width),he=M%t.width),t.getBitXY(P,he)===1&&x.whitePixelsMask1.push(s[M])}for(let M=0;M<p.length;M++){let P=0,he=0;M!==0&&(P=Math.floor(M/e.width),he=M%e.width),e.getBitXY(P,he)===1&&x.whitePixelsMask2.push(p[M])}return x}function getRelativePositionForAllPixels(e,t){let n=[];for(let r=0;r<e.height;r++)for(let s=0;s<e.width;s++){let l=[r,s];n.push([l[0]+t[0],l[1]+t[1]])}return n}function getCommonSurface(e,t){let n=0,r=0,s=[];for(;n<e.length&&r<t.length;)e[n][0]===t[r][0]&&e[n][1]===t[r][1]?(s.push(e[n]),n++,r++):e[n][0]<t[r][0]||e[n][0]===t[r][0]&&e[n][1]<t[r][1]?n++:r++;return s}function getClosestCommonParent(e){let t=getDepth(this),n=getDepth(e),r;if(t>=n?r=getFurthestParent(this,t):r=getFurthestParent(e,n),t===0||n===0)return r;let s=this,l=e;for(;t!==n;)if(t>n){if(s=s.parent,s===null)return r;t=t-1}else{if(l=l.parent,l===null)return r;n=n-1}for(;s!==l&&s!==null&&l!==null;)if(s=s.parent,l=l.parent,s===null||l===null)return r;return s!==l?r:s}function getDepth(e){let t=0,n=e;for(;n.parent!=null;)n=n.parent,t++;return t}function getFurthestParent(e,t){let n=e;for(;t>0;)n=n.parent,t=t-1;return n}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,t){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const n=e.width,r=e.height,s=e.maxValue,l={sigma:t.gaussianBlur,radius:3},p=e.gaussianFilter(l),o=p.convolution(Gy,convOptions),x=p.convolution(Gx,convOptions),M=x.hypotenuse(o),P=e.constructor,he=new P(n,r,{kind:"GREY",bitDepth:32}),nt=new P(n,r,{kind:"GREY",bitDepth:32}),_e=new P(n,r,{kind:"GREY"});for(var Bt=1;Bt<n-1;Bt++)for(var Fn=1;Fn<r-1;Fn++){var yr=(Math.round(Math.atan2(x.getValueXY(Bt,Fn,0),o.getValueXY(Bt,Fn,0))*(5/Math.PI))+5)%5;yr===0&&(M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt,Fn-1,0)||M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt,Fn+1,0))||yr===1&&(M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt-1,Fn+1,0)||M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt+1,Fn-1,0))||yr===2&&(M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt-1,Fn,0)||M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt+1,Fn,0))||yr===3&&(M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt-1,Fn-1,0)||M.getValueXY(Bt,Fn,0)<=M.getValueXY(Bt+1,Fn+1,0))||he.setValueXY(Bt,Fn,0,M.getValueXY(Bt,Fn,0))}for(Bt=0;Bt<n*r;++Bt){var Io=he.data[Bt],rl=0;Io>t.highThreshold&&(rl++,_e.data[Bt]=s),Io>t.lowThreshold&&rl++,nt.data[Bt]=rl}var Co=[];for(Bt=1;Bt<n-1;++Bt)for(Fn=1;Fn<r-1;++Fn)if(nt.getValueXY(Bt,Fn,0)===1){e:for(var as=Bt-1;as<Bt+2;++as)for(var Js=Fn-1;Js<Fn+2;++Js)if(nt.getValueXY(as,Js,0)===2){Co.push([Bt,Fn]),_e.setValueXY(Bt,Fn,0,s);break e}}for(;Co.length>0;){var lh=[];for(Bt=0;Bt<Co.length;++Bt)for(Fn=-1;Fn<2;++Fn)for(as=-1;as<2;++as)if(!(Fn===0&&as===0)){var ch=Co[Bt][0]+Fn,Zu=Co[Bt][1]+as;nt.getValueXY(ch,Zu,0)===1&&_e.getValueXY(ch,Zu,0)===0&&(lh.push([ch,Zu]),_e.setValueXY(ch,Zu,0,s))}Co=lh}return _e}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,t={}){let{position:n}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!n&&(n=e.getRelativePosition(this),!n))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let r=Image$1.createFrom(this,{width:e.width,height:e.height,alpha:1,position:n,parent:this});for(let s=0;s<e.width;s++)for(let l=0;l<e.height;l++){for(let p=0;p<this.channels;p++){let o=this.getValueXY(s+n[0],l+n[1],p);r.setValueXY(s,l,p,o)}e.getBitXY(s,l)||r.setValueXY(s,l,this.components,0)}return r}else{let r=Image$1.createFrom(this,{width:e.width,height:e.height,position:n,parent:this});for(let s=0;s<e.height;s++)for(let l=0;l<e.width;l++)e.getBitXY(l,s)&&this.getBitXY(l+n[0],s+n[1])&&r.setBitXY(l,s);return r}}var fastList={exports:{}};(function(e,t){(function(){function n(s,l,p){this.next=p,p&&(p.prev=this),this.prev=l,l&&(l.next=this),this.data=s}function r(){if(!(this instanceof r))return new r;this._head=null,this._tail=null,this.length=0}r.prototype={push:function(s){this._tail=new n(s,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var s=this._tail;return this._tail=s.prev,s.prev&&(s.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),s.data}},unshift:function(s){this._head=new n(s,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var s=this._head;return this._head=s.next,s.next&&(s.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),s.data}},item:function(s){s<0&&(s=this.length+s);for(var l=this._head;s-- >0&&l;)l=l.next;return l?l.data:void 0},slice:function(s,l){if(s||(s=0),l||(l=this.length),l<0&&(l=this.length+l),s<0&&(s=this.length+s),l===s)return[];if(l<s)throw new Error("invalid offset: "+s+","+l+" (length="+this.length+")");for(var p=l-s,o=new Array(p),x=0,M=this._head;s-- >0&&M;)M=M.next;for(;x<p&&M;)o[x++]=M.data,M=M.next;return o},drop:function(){r.call(this)},forEach:function(s,l){for(var p=this._head,o=0,x=this.length;o<x&&p;)s.call(l||this,p.data,o,this),p=p.next,o++},map:function(s,l){var p=new r;return this.forEach(function(o,x,M){p.push(s.call(l||M,o,x,M))}),p},filter:function(s,l){var p=new r;return this.forEach(function(o,x,M){s.call(l||M,o,x,M)&&p.push(o)}),p},reduce:function(s,l,p){var o=0,x=this._head,M=this.length;for(l||(o=1,l=x&&x.data,x=x&&x.next);o<M&&x;)l=s.call(p||this,l,x.data,this),o++,x=x.next;return l}},e.exports=r})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(e={}){const{x:t=0,y:n=0,inPlace:r=!0}=e,s=r?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,n))return s;const p=new LinkedList;for(p.push(new Node(t,n));p.length>0;){const o=p.shift();s.setBitXY(o.x,o.y);for(let x=o.x+1;x<this.width&&(!s.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)s.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&p.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&p.push(new Node(x,o.y-1));for(let x=o.x-1;x>=0&&(!s.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)s.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&p.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&p.push(new Node(x,o.y-1))}return s}function Node(e,t){this.x=e,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,t,n){t=t/100,n=n/100;var r=[],s=n*t,l=e/60,p=s*(1-Math.abs(l%2-1)),o=n-s;return l>=0&&l<1?r=[s,p,0]:l>=1&&l<2?r=[p,s,0]:l>=2&&l<3?r=[0,s,p]:e>=3&&l<4?r=[0,p,s]:e>=4&&l<5?r=[p,0,s]:e>=5&&l<=6?r=[s,0,p]:r=[0,0,0],{r:Math.round(255*(r[0]+o)),g:Math.round(255*(r[1]+o)),b:Math.round(255*(r[2]+o))}}function hsl2hsv(e,t,n){return t*=(n<50?n:100-n)/100,{h:e,s:2*t/(n+t)*100,v:n+t}}function hsl2rgb$1(e,t,n){var r=hsl2hsv(e,t,n);return hsv2rgb(r.h,r.s,r.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var t=colors[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(e){var t=e.match(/rgb\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */).map(Number);return{r:n[0],g:n[1],b:n[2],a:100}}}function rgba$1(e){var t=e.match(/rgba\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */).map(Number);return{r:n[0],g:n[1],b:n[2],a:n[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var t=e.match(/hsl\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */),r=parseInt(n[0],10),s=parseInt(n[1],10),l=parseInt(n[2],10),p=hsl2rgb$1(r,s,l);return _extends({},p,{a:100})}}function hsla(e){var t=e.match(/hsla\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */),r=parseInt(n[0],10),s=parseInt(n[1],10),l=parseInt(n[2],10),p=parseInt(parseFloat(n[3])*100,10),o=hsl2rgb$1(r,s,l);return _extends({},o,{a:p})}}function css2array(e){let t=parse(e);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function hsl2rgb(e,t,n){let r,s,l,p,o,x;return t/=100,n/=100,t===0?p=o=x=n*255:(n<=.5?s=n*(t+1):s=n+t-n*t,r=n*2-s,l=e/360,p=hue2rgb(r,s,l+1/3),o=hue2rgb(r,s,l),x=hue2rgb(r,s,l-1/3)),{r:p,g:o,b:x}}function getDistinctColors(e){let t=new Array(e),n=0;for(let r=0;r<360;r+=360/e){n++;let s=hsl2rgb(r,100,30+n%4*15);t[n-1]=[Math.round(s.r*255),Math.round(s.g*255),Math.round(s.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:t,colors:n,randomColors:r,numberColors:s=50}=e;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(n)return n=n.map(function(l){return Array.isArray(l)?l:css2array(l)}),n;if(r){n=new Array(s);for(let l=0;l<s;l++)n[l]=getRandomColor()}return getDistinctColors(s)}function paintLabels(e,t,n={}){let{color:r="blue",colors:s,font:l="12px Helvetica",rotate:p=0}=n;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(r&&!Array.isArray(r)&&(r=css2array(r)),s?s=s.map(function(M){return Array.isArray(M)?M:css2array(M)}):s=[r],e.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(l)||(l=[l]),Array.isArray(p)||(p=[p]);let x=this.getCanvas().getContext("2d");for(let M=0;M<e.length;M++){x.save();let P=s[M%s.length];x.fillStyle=`rgba(${P[0]},${P[1]},${P[2]},${P[3]/this.maxValue})`,x.font=l[M%l.length];let he=t[M];x.translate(he[0],he[1]),x.rotate(p[M%p.length]/180*Math.PI),x.fillText(e[M],0,0),x.restore()}return this.data=Uint8Array.from(x.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,t={}){let{alpha:n=255,labels:r=[],labelsPosition:s=[],labelColor:l="blue",labelFont:p="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let o=getColors(Object.assign({},t,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let x=0;x<e.length;x++){let M=e[x],P=o[x%o.length];for(let he=0;he<M.width;he++)for(let nt=0;nt<M.height;nt++)if(M.getBitXY(he,nt))for(let _e=0;_e<Math.min(this.components,P.length);_e++)if(n===255)this.setValueXY(he+M.position[0],nt+M.position[1],_e,P[_e]);else{let Bt=this.getValueXY(he+M.position[0],nt+M.position[1],_e);Bt=Math.round((Bt*(255-n)+P[_e]*n)/255),this.setValueXY(he+M.position[0],nt+M.position[1],_e,Bt)}}if(Array.isArray(r)&&r.length>0){let M=this.getCanvas().getContext("2d");M.fillStyle=l,M.font=p;for(let P=0;P<Math.min(e.length,r.length);P++){let he=s[P]?s[P]:e[P].position;M.fillText(r[P],he[0],he[1])}this.data=Uint8Array.from(M.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,t){let n=new Array(e);for(let r=0;r<e;r++)n[r]=new Array(t).fill(0);return n}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:n="cross",shape:r,size:s,width:l,height:p,filled:o=!0}=t;if(s&&(l=s,p=s),r)switch(r.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(l,p,{filled:o});break;case"circle":case"ellipse":this.matrix=ellipse(l,p,{filled:o});break;case"triangle":this.matrix=triangle(l,p,{filled:o});break;default:throw new Error(`Shape: unexpected shape: ${r}`)}else if(n)switch(n.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${n}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,n=[];for(let r=0;r<t.length;r++)for(let s=0;s<t[0].length;s++)t[r][s]&&n.push([s-this.halfWidth,r-this.halfHeight]);return n}getMask(){let t=new Image$1(this.width,this.height,{kind:BINARY});for(let n=0;n<this.matrix.length;n++)for(let r=0;r<this.matrix[0].length;r++)this.matrix[n][r]&&t.setBitXY(r,n);return t}}function rectangle(e,t,n){const r=zerosMatrix(t,e);if(n.filled)for(let s=0;s<t;s++)for(let l=0;l<e;l++)r[s][l]=1;else{for(let s of[0,t-1])for(let l=0;l<e;l++)r[s][l]=1;for(let s=0;s<t;s++)for(let l of[0,e-1])r[s][l]=1}return r}function ellipse(e,t,n){const r=zerosMatrix(t,e);let s=1-t%2,l=1-e%2,p=Math.floor((e-1)/2),o=Math.floor((t-1)/2),x=p*p,M=o*o;if(n.filled)for(let P=0;P<=o;P++){let he=Math.floor(Math.sqrt(x-x*P*P/M));for(let nt=p-he;nt<=p;nt++)r[o-P][nt]=1,r[o+P+s][nt]=1,r[o-P][e-nt-1]=1,r[o+P+s][e-nt-1]=1}else{for(let P=0;P<=o;P++){let he=Math.floor(Math.sqrt(x-x*P*P/M)),nt=p-he;r[o-P][nt]=1,r[o+P+s][nt]=1,r[o-P][e-nt-1]=1,r[o+P+s][e-nt-1]=1}for(let P=0;P<=p;P++){let he=Math.floor(Math.sqrt(M-M*P*P/x)),nt=o-he;r[nt][p-P]=1,r[nt][p+P+l]=1,r[t-nt-1][p-P]=1,r[t-nt-1][p+P+l]=1}}return r}function triangle(e,t,n){if(!n.filled)throw new Error("Non filled triangle is not implemented");const r=zerosMatrix(t,e);for(let s=0;s<t;s++){let l=Math.floor((1-s/t)*e/2);for(let p=l;p<e-l;p++)r[s][p]=1}return r}function paintPoints(e,t={}){let{shape:n}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:e.length})),s=new Shape(n).getPoints(),l=Math.min(this.channels,r[0].length);for(let p=0;p<e.length;p++){let o=r[p%r.length],x=e[p][0],M=e[p][1];for(let P=0;P<s.length;P++){let he=s[P][0],nt=s[P][1];if(x+he>=0&&M+nt>=0&&x+he<this.width&&M+nt<this.height){let _e=(x+he+(M+nt)*this.width)*this.channels;for(let Bt=0;Bt<l;Bt++)this.data[_e+Bt]=o[Bt]}}}return this}function paintPolyline(e,t={}){let{color:n=[this.maxValue,0,0],closed:r=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let s=Math.min(this.channels,n.length);for(let l=0;l<e.length-1+r;l++){let p=e[l],o=e[(l+1)%e.length],x=o[0]-p[0],M=o[1]-p[1],P=Math.max(Math.abs(x),Math.abs(M)),he=x/P,nt=M/P,_e=p[0],Bt=p[1];for(let Fn=0;Fn<=P;Fn++){let yr=Math.round(_e),Io=Math.round(Bt);if(yr>=0&&Io>=0&&yr<this.width&&Io<this.height)if(this.bitDepth===1)this.setBitXY(yr,Io);else{let rl=(yr+Io*this.width)*this.channels;for(let Co=0;Co<s;Co++)this.data[rl+Co]=n[Co]}_e=_e+he,Bt=Bt+nt}}return this}function paintPolylines(e,t={}){let n=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:e.length}));for(let s=0;s<e.length;s++)n.color=r[s%r.length],this.paintPolyline(e[s],n);return this}function paintPolygon(e,t={}){let{color:n=[this.maxValue,0,0],filled:r=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let s=deleteDouble(e);if(r===!1)return this.paintPolyline(e,t);{let l=Array(this.height);for(let p=0;p<this.height;p++){l[p]=[];for(let o=0;o<this.width;o++)l[p].push(0)}for(let p=0;p<s.length;p++){const o=lineBetweenTwoPoints(s[p],s[(p+1)%s.length]);for(let x=0;x<this.height;x++)for(let M=0;M<this.width;M++)isAtTheRightOfTheLine(M,x,o,this.height)&&(l[x][M]=l[x][M]===0?1:0)}for(let p=0;p<this.height;p++)for(let o=0;o<this.width;o++)if(l[p][o]===1)if(this.bitDepth===1)this.setBitXY(o,p);else{let x=Math.min(this.channels,n.length),M=(o+p*this.width)*this.channels;for(let P=0;P<x;P++)this.data[M+P]=n[P]}return this.paintPolyline(e,t)}}function deleteDouble(e){let t=[];for(let n=0;n<e.length;n++)if(!(e[n][0]===e[(n+1)%e.length][0]&&e[n][1]===e[(n+1)%e.length][1])){if(e[n][0]===e[(n-1+e.length)%e.length][0]&&e[n][1]===e[(n-1+e.length)%e.length][1])continue;if(e[(n+1)%e.length][0]===e[(n-1+e.length)%e.length][0]&&e[(n-1+e.length)%e.length][1]===e[(n+1)%e.length][1])continue;t.push(e[n])}return t}function lineBetweenTwoPoints(e,t){if(e[0]===t[0])return{a:0,b:e[0],vertical:!0};{const n=(t[1]-e[1])/(t[0]-e[0]),r=e[1]-n*e[0];return{a:n,b:r,vertical:!1}}}function isAtTheRightOfTheLine(e,t,n,r){if(n.vertical===!0)return n.b<=e;if(n.a===0)return!1;{const s=(t-n.b)/n.a;return s<e&&s>=0&&s<=r}}function paintPolygons(e,t={}){let n=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:e.length}));for(let s=0;s<e.length;s++)n.color=r[s%r.length],this.paintPolygon(e[s],n);return this}function getHistogram(e={}){let{maxSlots:t=256,channel:n,useAlpha:r=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),n===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");n=0}return getChannelHistogram.call(this,n,{useAlpha:r,maxSlots:t})}function getHistograms(e={}){const{maxSlots:t=256,useAlpha:n=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let r=new Array(n?this.components:this.channels);for(let s=0;s<r.length;s++)r[s]=getChannelHistogram.call(this,s,{useAlpha:n,maxSlots:t});return r}function getChannelHistogram(e,t){let{useAlpha:n,maxSlots:r}=t;if(this.bitDepth===1){let x=[0,0];for(let M=0;M<this.height;M++)for(let P=0;P<this.width;P++){let he=this.getBitXY(M,P);he===0?x[0]+=1:he===1&&(x[1]+=1)}return x}let s=Math.log2(r);if(!isInteger$1(s))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let l=0;this.bitDepth>s&&(l=this.bitDepth-s);let p=this.data,o=newArray$1(Math.pow(2,Math.min(this.bitDepth,s)),0);if(n&&this.alpha){let x=this.channels-e-1;for(let M=e;M<p.length;M+=this.channels)o[p[M]>>l]+=p[M+x]/this.maxValue}else for(let x=e;x<p.length;x+=this.channels)o[p[x]>>l]++;return o}function getColorHistogram(e={}){let{useAlpha:t=!0,nbSlots:n=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let r=Math.log(n)/Math.log(8);if(r!==Math.floor(r))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let s=this.bitDepth-r,l=this.data,p=newArray$1(Math.pow(8,r),0),o=Math.pow(2,r*2),x=Math.pow(2,r);for(let M=0;M<l.length;M+=this.channels){let P=(l[M]>>s)*o+(l[M+1]>>s)*x+(l[M+2]>>s);t&&this.alpha?p[P]+=l[M+this.channels-1]/this.maxValue:p[P]++}return p}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)this.data[t+n]<e[n]&&(e[n]=this.data[t+n]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)this.data[t+n]>e[n]&&(e[n]=this.data[t+n]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)e[n]+=this.data[t+n];return e}function getMoment(e=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let n=0;for(let r=0;r<this.width;r++)for(let s=0;s<this.height;s++)this.getBitXY(r,s)===1&&(n+=r**e*s**t);return n}function localMaxima(e={}){let{mask:t,region:n=3,removeClosePoints:r=0,invert:s=!1,maxEquals:l=2}=e,p=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),n*=4;let o=s?0:1,x=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],M=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],P=n<=8?1:2,he=[];for(let nt=P;nt<p.height-P;nt++)for(let _e=P;_e<p.width-P;_e++){if(t&&t.getBitXY(_e,nt)!==o)continue;let Bt=0,Fn=0,yr=p.data[_e+nt*p.width];for(let Io=0;Io<n;Io++)s?p.data[_e+x[Io]+(nt+M[Io])*p.width]>yr&&Bt++:p.data[_e+x[Io]+(nt+M[Io])*p.width]<yr&&Bt++,p.data[_e+x[Io]+(nt+M[Io])*p.width]===yr&&Fn++;Bt+Fn===n&&Fn<=l&&he.push([_e,nt])}if(r>0)for(let nt=0;nt<he.length;nt++)for(let _e=nt+1;_e<he.length;_e++)Math.sqrt(Math.pow(he[nt][0]-he[_e][0],2)+Math.pow(he[nt][1]-he[_e][1],2))<r&&(he[nt][0]=he[nt][0]+he[_e][0]>>1,he[nt][1]=he[nt][1]+he[_e][1]>>1,he.splice(_e,1),_e--);return he}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let r=e[n];t[n]=mean$2(r)}return t}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let r=e[n];t[n]=median$2(r)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.getBitXY(t,n)===1&&e.push([t,n]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)if(this.getBitXY(n,t)===1)for(e.push([n,t]),this.getBitXY(n+1,t)!==1?(e.push([n+1,t]),e.push([n+1,t+1]),this.getBitXY(n,t+1)!==1&&e.push([n,t+1])):this.getBitXY(n,t+1)!==1&&(e.push([n,t+1]),e.push([n+1,t+1]));n<this.width-2&&this.getBitXY(n+1,t)===1&&this.getBitXY(n+2,t)===1;)n++;return e}function getRelativePosition(e,t={}){if(this===e)return[0,0];let n=[0,0],r=this;for(;r;){if(r===e)return n;r.position&&(n[0]+=r.position[0],n[1]+=r.position[1]),r=r.parent}return t.defaultFurther?n:!1}function countAlphaPixels(e={}){let{alpha:t=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let n=0;if(t!==void 0){for(let r=this.components;r<this.data.length;r+=this.channels)this.data[r]===t&&n++;return n}else return this.size}function monotoneChainConvexHull$1(e,t={}){const{sorted:n}=t;n||(e=e.slice().sort(byXThenY));const r=e.length,s=new Array(r*2);let l=0;for(let o=0;o<r;o++){const x=e[o];for(;l>=2&&cw(s[l-2],s[l-1],x)<=0;)l--;s[l++]=x}const p=l+1;for(let o=r-2;o>=0;o--){const x=e[o];for(;l>=p&&cw(s[l-2],s[l-1],x)<=0;)l--;s[l++]=x}return s.slice(0,l-1)}function cw(e,t,n){return(t[1]-e[1])*(n[0]-e[0])-(t[0]-e[0])*(n[1]-e[1])}function byXThenY(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let t=0;t<e.length;t++)e[t][0]=Math.round(e[t][0]),e[t][1]=Math.round(e[t][1]);return e}function difference(e,t){return[e[0]-t[0],e[1]-t[1]]}function normalize(e){let t=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function rotate(e,t,n){n===void 0&&(n=new Array(t.length));let r=Math.cos(e),s=Math.sin(e);for(let l=0;l<n.length;++l)n[l]=[r*t[l][0]-s*t[l][1],s*t[l][0]+r*t[l][1]];return n}function perimeter(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n][0],s=e[n][1],l=e[n===e.length-1?0:n+1][0],p=e[n===e.length-1?0:n+1][1];t+=Math.sqrt((l-r)**2+(p-s)**2)}return t}function surface(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n][0],s=e[n===e.length-1?0:n+1][1],l=e[n===e.length-1?0:n+1][0],p=e[n][1];t+=r*s*.5,t-=l*p*.5}return Math.abs(t)}function minMax(e){let t=1/0,n=1/0,r=-1/0,s=-1/0;for(let l=0;l<e.length;l++)e[l][0]<t&&(t=e[l][0]),e[l][0]>r&&(r=e[l][0]),e[l][1]<n&&(n=e[l][1]),e[l][1]>s&&(s=e[l][1]);return[[t,n],[r,s]]}function moveToZeroZero(e,t){t===void 0&&(t=new Array(e.length).fill(0).map(()=>[]));let n=minMax(e),r=n[0][0],s=n[0][1];for(let l=0;l<e.length;l++)t[l][0]=e[l][0]-r,t[l][1]=e[l][1]-s;return t}function minimalBoundingRectangle(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const n=new Array(t.length);let r=1/0,s=0,l;for(let p=0;p<n.length;p++){let o=getAngle$1(t[p],t[(p+1)%n.length]);rotate(-o,t,n);let x=n[p][0],M=n[p][1],P=n[(p+1)%n.length][0],he=n[(p+1)%n.length][1],nt=!0,_e=0,Bt=0,Fn=0;for(let Co=0;Co<n.length;Co++){let as=n[Co][0],Js=n[Co][1],lh=(as-x)/(P-x);nt===!0?(nt=!1,_e=lh,Bt=lh):(lh<_e&&(_e=lh),lh>Bt&&(Bt=lh));let ch=(-(P-x)*Js+P*M-he*x)/(P-x);Math.abs(ch)>Math.abs(Fn)&&(Fn=ch)}let yr=[x+_e*(P-x),M],Io=[x+Bt*(P-x),M],rl=Math.abs(Fn*(_e-Bt)*(P-x));rl<r&&(s=o,r=rl,l=[yr,Io,[Io[0],Io[1]-Fn],[yr[0],yr[1]-Fn]])}return rotate(s,l,l),l}function getAngle$1(e,t){let n=difference(t,e),r=normalize(n),s=Math.acos(r[0]);return r[1]<0?-s:s}function extend$4(e){let t={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,t),e.extendMethod("add",add,t),e.extendMethod("subtract",subtract,t),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,t),e.extendMethod("divide",divide,t),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,t),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,t),e.extendMethod("paintMasks",paintMasks,t),e.extendMethod("paintPoints",paintPoints,t),e.extendMethod("paintPolyline",paintPolyline,t),e.extendMethod("paintPolylines",paintPolylines,t),e.extendMethod("paintPolygon",paintPolygon,t),e.extendMethod("paintPolygons",paintPolygons,t),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(commonjsGlobal,function(){function n(mh){return typeof mh=="string"||mh instanceof String}var r=Number.isFinite||window.isFinite;function s(mh){return r(mh)}function l(mh){return mh}function p(mh){var Jh={};return mh.filter(function(Wu){return Jh.hasOwnProperty(Wu)?!1:Jh[Wu]=!0})}function o(mh,Jh){if(Jh.length!==mh.length)return!1;for(var Wu=0;Wu<mh.length;Wu++)if(Jh[Wu].compareArray&&!Jh[Wu].compareArray(mh[Wu])||Jh[Wu]!==mh[Wu])return!1;return!0}function x(mh,Jh){Object.keys(Jh).forEach(function(Wu){mh[Wu]=Jh[Wu]})}function M(){for(var mh=1,Jh=0,Wu=0;Wu<arguments.length;Wu++){var al=arguments[Wu];Jh=Jh+nt(al),mh*=al}return Jh!==0?he(mh,Jh):mh}function P(mh,Jh){if(Jh===0)throw new Error("Divide by zero");var Wu=Math.pow(10,nt(Jh)),al=Wu/(Wu*Jh);return M(mh,al)}function he(mh,Jh){return Math.round(mh*Math.pow(10,Jh))/Math.pow(10,Jh)}function nt(mh){if(!isFinite(mh))return 0;for(var Jh=0;mh%1!==0;)mh*=10,Jh++;return Jh}function _e(){var mh;if(!this)return mh=Object.create(_e.prototype),_e.apply(mh,arguments),mh;mh=Error.apply(this,arguments),this.name="QtyError",this.message=mh.message,this.stack=mh.stack}_e.prototype=Object.create(Error.prototype,{constructor:{value:_e}});function Bt(mh,Jh){throw new _e("Incompatible units: "+mh+" and "+Jh)}var Fn={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},yr=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],Io="<1>",rl=[Io];function Co(mh,Jh){var Wu=Jh[1],al=Jh[3]||[],Xr=Jh[4]||[];if(!s(Wu))throw new _e(mh+": Invalid unit definition. 'scalar' must be a number");al.forEach(function(mr){if(Fn[mr]===void 0)throw new _e(mh+": Invalid unit definition. Unit "+mr+" in 'numerator' is not recognized")}),Xr.forEach(function(mr){if(Fn[mr]===void 0)throw new _e(mh+": Invalid unit definition. Unit "+mr+" in 'denominator' is not recognized")})}var as={},Js={},lh={},ch={},Zu={};for(var th in Fn)if(Fn.hasOwnProperty(th)){var sl=Fn[th];if(sl[2]==="prefix"){as[th]=sl[1];for(var sh=0;sh<sl[0].length;sh++)Js[sl[0][sh]]=th}else{Co(th,sl),lh[th]={scalar:sl[1],numerator:sl[3],denominator:sl[4]};for(var xh=0;xh<sl[0].length;xh++)ch[sl[0][xh]]=th}Zu[th]=sl[0][0]}function Mh(mh){var Jh,Wu=[],al=Object.keys(Fn);if(typeof mh>"u")for(Jh=0;Jh<al.length;Jh++)["","prefix"].indexOf(Fn[al[Jh]][2])===-1&&Wu.push(al[Jh].substr(1,al[Jh].length-2));else{if(this.getKinds().indexOf(mh)===-1)throw new _e("Kind not recognized");for(Jh=0;Jh<al.length;Jh++)Fn[al[Jh]][2]===mh&&Wu.push(al[Jh].substr(1,al[Jh].length-2))}return Wu.sort(function(Xr,mr){return Xr.toLowerCase()<mr.toLowerCase()?-1:Xr.toLowerCase()>mr.toLowerCase()?1:0})}function Dh(mh){if(!ch[mh])throw new _e("Unit not recognized");return Fn[ch[mh]][0]}var Uh=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function cd(){if(this.signature)return this.signature;for(var mh=Tf.call(this),Jh=0;Jh<mh.length;Jh++)mh[Jh]*=Math.pow(20,Jh);return mh.reduce(function(Wu,al){return Wu+al},0)}function Tf(){if(!this.isBase())return Tf.call(this.toBase());for(var mh=new Array(Uh.length),Jh=0;Jh<mh.length;Jh++)mh[Jh]=0;for(var Wu,al,Xr=0;Xr<this.numerator.length;Xr++)(Wu=Fn[this.numerator[Xr]])&&(al=Uh.indexOf(Wu[2]),al>=0&&(mh[al]=mh[al]+1));for(var mr=0;mr<this.denominator.length;mr++)(Wu=Fn[this.denominator[mr]])&&(al=Uh.indexOf(Wu[2]),al>=0&&(mh[al]=mh[al]-1));return mh}var yf="[+-]",Af="\\d+",md=yf+"?"+Af,vd="\\."+Af,qd="(?:"+Af+"(?:"+vd+")?)|(?:"+vd+")",Ed="[Ee]"+md,Td="(?:"+qd+")(?:"+Ed+")?",Fd=yf+"?\\s*"+Td,Cd="("+Fd+")?\\s*([^/]*)(?:/(.+))?",Gd=new RegExp("^"+Cd+"$"),bf="\\^|\\*{2}",Id="[01234]",td=new RegExp("([^ \\*\\d]+?)(?:"+bf+")?(-?"+Id+"(?![a-zA-Z]))"),$d=new RegExp("([^ \\*\\d]+?)(?:"+bf+")?("+Id+"(?![a-zA-Z]))");function np(mh){n(mh)||(mh=mh.toString()),mh=mh.trim();var Jh=Gd.exec(mh);if(!Jh)throw new _e(mh+": Quantity not recognized");var Wu=Jh[1];Wu?(Wu=Wu.replace(/\s/g,""),this.scalar=parseFloat(Wu)):this.scalar=1;for(var al=Jh[2],Xr=Jh[3],mr,cs,$u;Jh=td.exec(al);){if(mr=parseFloat(Jh[2]),isNaN(mr))throw new _e("Unit exponent is not a number");if(mr===0&&!bp.test(Jh[1]))throw new _e("Unit not recognized");cs=Jh[1]+" ",$u="";for(var eh=0;eh<Math.abs(mr);eh++)$u+=cs;mr>=0?al=al.replace(Jh[0],$u):(Xr=Xr?Xr+$u:$u,al=al.replace(Jh[0],""))}for(;Jh=$d.exec(Xr);){if(mr=parseFloat(Jh[2]),isNaN(mr))throw new _e("Unit exponent is not a number");if(mr===0&&!bp.test(Jh[1]))throw new _e("Unit not recognized");cs=Jh[1]+" ",$u="";for(var rh=0;rh<mr;rh++)$u+=cs;Xr=Xr.replace(Jh[0],$u)}al&&(this.numerator=Yd(al.trim())),Xr&&(this.denominator=Yd(Xr.trim()))}var jf=Object.keys(Js).sort(function(mh,Jh){return Jh.length-mh.length}).join("|"),yd=Object.keys(ch).sort(function(mh,Jh){return Jh.length-mh.length}).join("|"),Qd="\\b|$",op="("+jf+")??("+yd+")(?:"+Qd+")",bp=new RegExp("^\\s*("+op+"[\\s\\*]*)+$"),fp=new RegExp(op,"g"),Qh={};function Yd(mh){var Jh=Qh[mh];if(Jh)return Jh;var Wu,al=[];if(!bp.test(mh))throw new _e("Unit not recognized");for(;Wu=fp.exec(mh);)al.push(Wu.slice(1));return al=al.map(function(Xr){return Js[Xr[0]]?[Js[Xr[0]],ch[Xr[1]]]:[ch[Xr[1]]]}),al=al.reduce(function(Xr,mr){return Xr.concat(mr)},[]),al=al.filter(function(Xr){return Xr}),Qh[mh]=al,al}function ad(mh){if(!n(mh))throw new _e("Argument should be a string");try{return this(mh)}catch{return null}}function Zd(mh){return mh instanceof Xh}function Xh(mh,Jh){if(Ld.apply(null,arguments),!Zd(this))return new Xh(mh,Jh);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=rl,this.denominator=rl,Kf(mh)?(this.scalar=mh.scalar,this.numerator=mh.numerator&&mh.numerator.length!==0?mh.numerator:rl,this.denominator=mh.denominator&&mh.denominator.length!==0?mh.denominator:rl):Jh?(np.call(this,Jh),this.scalar=mh):np.call(this,mh),this.denominator.join("*").indexOf("temp")>=0)throw new _e("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new _e("Cannot multiply by temperatures");if(!o(this.denominator,rl))throw new _e("Cannot divide with temperatures")}if(this.initValue=mh,If.call(this),this.isTemperature()&&this.baseScalar<0)throw new _e("Temperatures must not be less than absolute zero")}Xh.prototype={constructor:Xh};function Ld(mh,Jh){if(Jh){if(!(s(mh)&&n(Jh)))throw new _e("Only number accepted as initialization value when units are explicitly provided")}else if(!(n(mh)||s(mh)||Zd(mh)||Kf(mh)))throw new _e("Only string, number or quantity accepted as single initialization value")}function Kf(mh){return mh&&typeof mh=="object"&&mh.hasOwnProperty("scalar")}function If(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=cd.call(this);else{var mh=this.toBase();this.baseScalar=mh.scalar,this.signature=mh.signature}}var Df={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Jf(){return p(Object.keys(Df).map(function(mh){return Df[mh]}))}Xh.prototype.kind=function(){return Df[this.signature.toString()]},x(Xh.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&o(this.denominator,rl)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Nf(mh,Jh){var Wu=mh.units(),al=Jh.to(Wu),Xr=Xh(Tp(Wu));return Xh({scalar:mh.scalar-al.scalar,numerator:Xr.numerator,denominator:Xr.denominator})}function Wf(mh,Jh){var Wu=Jh.to(Tp(mh.units()));return Xh({scalar:mh.scalar-Wu.scalar,numerator:mh.numerator,denominator:mh.denominator})}function Cp(mh,Jh){var Wu=Jh.to(Tp(mh.units()));return Xh({scalar:mh.scalar+Wu.scalar,numerator:mh.numerator,denominator:mh.denominator})}function Tp(mh){if(mh==="tempK")return"degK";if(mh==="tempC")return"degC";if(mh==="tempF")return"degF";if(mh==="tempR")return"degR";throw new _e("Unknown type for temp conversion from: "+mh)}function Pp(mh,Jh){var Wu=Yf(mh),al=Jh.units(),Xr;if(al==="degK")Xr=Wu.scalar;else if(al==="degC")Xr=Wu.scalar;else if(al==="degF")Xr=Wu.scalar*9/5;else if(al==="degR")Xr=Wu.scalar*9/5;else throw new _e("Unknown type for degree conversion to: "+al);return Xh({scalar:Xr,numerator:Jh.numerator,denominator:Jh.denominator})}function Yf(mh){var Jh=mh.units(),Wu;if(Jh.match(/(deg)[CFRK]/))Wu=mh.baseScalar;else if(Jh==="tempK")Wu=mh.scalar;else if(Jh==="tempC")Wu=mh.scalar;else if(Jh==="tempF")Wu=mh.scalar*5/9;else if(Jh==="tempR")Wu=mh.scalar*5/9;else throw new _e("Unknown type for temp conversion from: "+Jh);return Xh({scalar:Wu,numerator:["<kelvin>"],denominator:rl})}function qp(mh,Jh){var Wu=Jh.units(),al;if(Wu==="tempK")al=mh.baseScalar;else if(Wu==="tempC")al=mh.baseScalar-273.15;else if(Wu==="tempF")al=mh.baseScalar*9/5-459.67;else if(Wu==="tempR")al=mh.baseScalar*9/5;else throw new _e("Unknown type for temp conversion to: "+Wu);return Xh({scalar:al,numerator:Jh.numerator,denominator:Jh.denominator})}function am(mh){var Jh=mh.units(),Wu;if(Jh.match(/(deg)[CFRK]/))Wu=mh.baseScalar;else if(Jh==="tempK")Wu=mh.scalar;else if(Jh==="tempC")Wu=mh.scalar+273.15;else if(Jh==="tempF")Wu=(mh.scalar+459.67)*5/9;else if(Jh==="tempR")Wu=mh.scalar*5/9;else throw new _e("Unknown type for temp conversion from: "+Jh);return Xh({scalar:Wu,numerator:["<temp-K>"],denominator:rl})}x(Xh.prototype,{to:function(mh){var Jh,Wu;if(mh==null)return this;if(!n(mh))return this.to(mh.units());if(Jh=this._conversionCache[mh],Jh)return Jh;if(Wu=Xh(mh),Wu.units()===this.units())return this;if(!this.isCompatible(Wu))this.isInverse(Wu)?Wu=this.inverse().to(mh):Bt(this.units(),Wu.units());else if(Wu.isTemperature())Wu=qp(this,Wu);else if(Wu.isDegrees())Wu=Pp(this,Wu);else{var al=P(this.baseScalar,Wu.baseScalar);Wu=Xh({scalar:al,numerator:Wu.numerator,denominator:Wu.denominator})}return this._conversionCache[mh]=Wu,Wu},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return am(this);var mh=Op[this.units()];return mh||(mh=nm(this.numerator,this.denominator),Op[this.units()]=mh),mh.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new _e("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(mh){if(n(mh)&&(mh=Xh(mh)),s(mh)&&(mh=Xh(mh+" "+this.units())),this.isUnitless()?mh.isUnitless()||Bt(this.units(),mh.units()):mh=mh.to(this.units()),mh.scalar===0)throw new _e("Divide by zero");var Jh=M(Math.round(this.scalar/mh.scalar),mh.scalar);return Xh(Jh+this.units())}});function Xd(mh,Jh){var Wu=Xh(mh),al=Xh(Jh);if(Wu.eq(al))return l;var Xr;return Wu.isTemperature()?Xr=function(mr){return Wu.mul(mr).to(al).scalar}:Xr=function(mr){return mr*Wu.baseScalar/al.baseScalar},function(cs){var $u,eh,rh;if(Array.isArray(cs)){for(eh=cs.length,rh=[],$u=0;$u<eh;$u++)rh.push(Xr(cs[$u]));return rh}else return Xr(cs)}}var Op={};function nm(mh,Jh){for(var Wu=[],al=[],Xr=1,mr,cs=0;cs<mh.length;cs++)mr=mh[cs],as[mr]?Xr=M(Xr,as[mr]):lh[mr]&&(Xr*=lh[mr].scalar,lh[mr].numerator&&Wu.push(lh[mr].numerator),lh[mr].denominator&&al.push(lh[mr].denominator));for(var $u=0;$u<Jh.length;$u++)mr=Jh[$u],as[mr]?Xr/=as[mr]:lh[mr]&&(Xr/=lh[mr].scalar,lh[mr].numerator&&al.push(lh[mr].numerator),lh[mr].denominator&&Wu.push(lh[mr].denominator));return Wu=Wu.reduce(function(eh,rh){return eh.concat(rh)},[]),al=al.reduce(function(eh,rh){return eh.concat(rh)},[]),Xh({scalar:Xr,numerator:Wu,denominator:al})}Xh.parse=ad,Xh.getUnits=Mh,Xh.getAliases=Dh,Xh.mulSafe=M,Xh.divSafe=P,Xh.getKinds=Jf,Xh.swiftConverter=Xd,Xh.Error=_e,x(Xh.prototype,{add:function(mh){if(n(mh)&&(mh=Xh(mh)),this.isCompatible(mh)||Bt(this.units(),mh.units()),this.isTemperature()&&mh.isTemperature())throw new _e("Cannot add two temperatures");return this.isTemperature()?Cp(this,mh):mh.isTemperature()?Cp(mh,this):Xh({scalar:this.scalar+mh.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(mh){if(n(mh)&&(mh=Xh(mh)),this.isCompatible(mh)||Bt(this.units(),mh.units()),this.isTemperature()&&mh.isTemperature())return Nf(this,mh);if(this.isTemperature())return Wf(this,mh);if(mh.isTemperature())throw new _e("Cannot subtract a temperature from a differential degree unit");return Xh({scalar:this.scalar-mh.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(mh){if(s(mh))return Xh({scalar:M(this.scalar,mh),numerator:this.numerator,denominator:this.denominator});if(n(mh)&&(mh=Xh(mh)),(this.isTemperature()||mh.isTemperature())&&!(this.isUnitless()||mh.isUnitless()))throw new _e("Cannot multiply by temperatures");var Jh=this,Wu=mh;Jh.isCompatible(Wu)&&Jh.signature!==400&&(Wu=Wu.to(Jh));var al=Tm(Jh.numerator,Jh.denominator,Wu.numerator,Wu.denominator);return Xh({scalar:M(Jh.scalar,Wu.scalar,al[2]),numerator:al[0],denominator:al[1]})},div:function(mh){if(s(mh)){if(mh===0)throw new _e("Divide by zero");return Xh({scalar:this.scalar/mh,numerator:this.numerator,denominator:this.denominator})}else n(mh)&&(mh=Xh(mh));if(mh.scalar===0)throw new _e("Divide by zero");if(mh.isTemperature())throw new _e("Cannot divide with temperatures");if(this.isTemperature()&&!mh.isUnitless())throw new _e("Cannot divide with temperatures");var Jh=this,Wu=mh;Jh.isCompatible(Wu)&&Jh.signature!==400&&(Wu=Wu.to(Jh));var al=Tm(Jh.numerator,Jh.denominator,Wu.denominator,Wu.numerator);return Xh({scalar:M(Jh.scalar,al[2])/Wu.scalar,numerator:al[0],denominator:al[1]})},inverse:function(){if(this.isTemperature())throw new _e("Cannot divide with temperatures");if(this.scalar===0)throw new _e("Divide by zero");return Xh({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Tm(mh,Jh,Wu,al){function Xr(Ph){return Ph!==Io}mh=mh.filter(Xr),Wu=Wu.filter(Xr),Jh=Jh.filter(Xr),al=al.filter(Xr);var mr={};function cs(Ph,Fh){for(var Ad,wd,Kd,xf=0;xf<Ph.length;xf++)if(as[Ph[xf]]?(Ad=Ph[xf+1],wd=Ph[xf],Kd=as[wd],xf++):(Ad=Ph[xf],wd=null,Kd=1),Ad&&Ad!==Io)if(mr[Ad]){mr[Ad][0]+=Fh;var Ff=mr[Ad][2]?as[mr[Ad][2]]:1;mr[Ad][Fh===1?3:4]*=P(Kd,Ff)}else mr[Ad]=[Fh,Ad,wd,1,1]}cs(mh,1),cs(Jh,-1),cs(Wu,1),cs(al,-1);var $u=[],eh=[],rh=1;for(var uh in mr)if(mr.hasOwnProperty(uh)){var dh=mr[uh],yh;if(dh[0]>0)for(yh=0;yh<dh[0];yh++)$u.push(dh[2]===null?dh[1]:[dh[2],dh[1]]);else if(dh[0]<0)for(yh=0;yh<-dh[0];yh++)eh.push(dh[2]===null?dh[1]:[dh[2],dh[1]]);rh*=P(dh[3],dh[4])}return $u.length===0&&($u=rl),eh.length===0&&(eh=rl),$u=$u.reduce(function(Ph,Fh){return Ph.concat(Fh)},[]),eh=eh.reduce(function(Ph,Fh){return Ph.concat(Fh)},[]),[$u,eh,rh]}x(Xh.prototype,{eq:function(mh){return this.compareTo(mh)===0},lt:function(mh){return this.compareTo(mh)===-1},lte:function(mh){return this.eq(mh)||this.lt(mh)},gt:function(mh){return this.compareTo(mh)===1},gte:function(mh){return this.eq(mh)||this.gt(mh)},compareTo:function(mh){if(n(mh))return this.compareTo(Xh(mh));if(this.isCompatible(mh)||Bt(this.units(),mh.units()),this.baseScalar<mh.baseScalar)return-1;if(this.baseScalar===mh.baseScalar)return 0;if(this.baseScalar>mh.baseScalar)return 1},same:function(mh){return this.scalar===mh.scalar&&this.units()===mh.units()}}),x(Xh.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(mh){return o(mh,rl)})},isCompatible:function(mh){return n(mh)?this.isCompatible(Xh(mh)):Zd(mh)&&mh.signature!==void 0?this.signature===mh.signature:!1},isInverse:function(mh){return this.inverse().isCompatible(mh)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(mh){mh!==Io&&yr.indexOf(mh)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function hp(){}hp.prototype.get=function(mh){return arguments.length>1&&(mh=Array.apply(null,arguments)),mh.reduce(function(Jh,Wu,al){if(Jh){var Xr=Jh[Wu];return al===mh.length-1?Xr?Xr.data:void 0:Xr}},this)},hp.prototype.set=function(mh,Jh){return arguments.length>2&&(mh=Array.prototype.slice.call(arguments,0,-1),Jh=arguments[arguments.length-1]),mh.reduce(function(Wu,al,Xr){var mr=Wu[al];return mr===void 0&&(mr=Wu[al]={}),Xr===mh.length-1?(mr.data=Jh,Jh):mr},this)};function Em(mh,Jh){return(mh+" "+Jh).trim()}Xh.formatter=Em,x(Xh.prototype,{units:function(){if(this._units!==void 0)return this._units;var mh=o(this.numerator,rl),Jh=o(this.denominator,rl);if(mh&&Jh)return this._units="",this._units;var Wu=lm(this.numerator),al=lm(this.denominator);return this._units=Wu+(Jh?"":"/"+al),this._units},toString:function(mh,Jh){var Wu;if(s(mh))Wu=this.units(),Jh=mh;else if(n(mh))Wu=mh;else if(Zd(mh))return this.toPrec(mh).toString(Jh);var al=this.to(Wu),Xr=Jh!==void 0?he(al.scalar,Jh):al.scalar;return al=(Xr+" "+al.units()).trim(),al},format:function(mh,Jh){arguments.length===1&&typeof mh=="function"&&(Jh=mh,mh=void 0),Jh=Jh||Xh.formatter;var Wu=this.to(mh);return Jh.call(this,Wu.scalar,Wu.units())}});var Qp=new hp;function lm(mh){var Jh=Qp.get(mh);if(Jh)return Jh;var Wu=o(mh,rl);return Wu?Jh="1":Jh=Hf(Dd(mh)).join("*"),Qp.set(mh,Jh),Jh}function Dd(mh){for(var Jh=[],Wu,al,Xr=0;Xr<mh.length;Xr++)Wu=mh[Xr],al=mh[Xr+1],as[Wu]?(Jh.push(Zu[Wu]+Zu[al]),Xr++):Jh.push(Zu[Wu]);return Jh}function Hf(mh){var Jh=mh.reduce(function(Wu,al){var Xr=Wu[al];return Xr||Wu.push(Xr=Wu[al]=[al,0]),Xr[1]++,Wu},[]);return Jh.map(function(Wu){return Wu[0]+(Wu[1]>1?Wu[1]:"")})}return Xh.version="1.7.6",Xh})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(e,t=""){let n=t.split(".");for(let r of n){if(e[r]===void 0)return;e=e[r]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,t,n){var r=e*t,s=SPLITTER*e,l=s-e,p=s-l,o=e-p,x=SPLITTER*t,M=x-t,P=x-M,he=t-P,nt=r-p*P,_e=nt-o*P,Bt=_e-p*he,Fn=o*he-Bt;return n?(n[0]=Fn,n[1]=r,n):[Fn,r]}var robustSum=linearExpansionSum;function scalarScalar$1(e,t){var n=e+t,r=n-e,s=n-r,l=t-r,p=e-s,o=p+l;return o?[o,n]:[n]}function linearExpansionSum(e,t){var n=e.length|0,r=t.length|0;if(n===1&&r===1)return scalarScalar$1(e[0],t[0]);var s=n+r,l=new Array(s),p=0,o=0,x=0,M=Math.abs,P=e[o],he=M(P),nt=t[x],_e=M(nt),Bt,Fn;he<_e?(Fn=P,o+=1,o<n&&(P=e[o],he=M(P))):(Fn=nt,x+=1,x<r&&(nt=t[x],_e=M(nt))),o<n&&he<_e||x>=r?(Bt=P,o+=1,o<n&&(P=e[o],he=M(P))):(Bt=nt,x+=1,x<r&&(nt=t[x],_e=M(nt)));for(var yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,Co=rl,as=yr,Js,lh,ch,Zu,th;o<n&&x<r;)he<_e?(Bt=P,o+=1,o<n&&(P=e[o],he=M(P))):(Bt=nt,x+=1,x<r&&(nt=t[x],_e=M(nt))),Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js;for(;o<n;)Bt=P,Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js,o+=1,o<n&&(P=e[o]);for(;x<r;)Bt=nt,Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js,x+=1,x<r&&(nt=t[x]);return Co&&(l[p++]=Co),as&&(l[p++]=as),p||(l[p++]=0),l.length=p,l}var twoSum$1=fastTwoSum;function fastTwoSum(e,t,n){var r=e+t,s=r-e,l=r-s,p=t-s,o=e-l;return n?(n[0]=o+p,n[1]=r,n):[o+p,r]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,t){var n=e.length;if(n===1){var r=twoProduct(e[0],t);return r[0]?r:[r[1]]}var s=new Array(2*n),l=[.1,.1],p=[.1,.1],o=0;twoProduct(e[0],t,l),l[0]&&(s[o++]=l[0]);for(var x=1;x<n;++x){twoProduct(e[x],t,p);var M=l[1];twoSum(M,p[0],l),l[0]&&(s[o++]=l[0]);var P=p[1],he=l[1],nt=P+he,_e=nt-P,Bt=he-_e;l[1]=nt,Bt&&(s[o++]=Bt)}return l[1]&&(s[o++]=l[1]),o===0&&(s[o++]=0),s.length=o,s}var robustDiff=robustSubtract;function scalarScalar(e,t){var n=e+t,r=n-e,s=n-r,l=t-r,p=e-s,o=p+l;return o?[o,n]:[n]}function robustSubtract(e,t){var n=e.length|0,r=t.length|0;if(n===1&&r===1)return scalarScalar(e[0],-t[0]);var s=n+r,l=new Array(s),p=0,o=0,x=0,M=Math.abs,P=e[o],he=M(P),nt=-t[x],_e=M(nt),Bt,Fn;he<_e?(Fn=P,o+=1,o<n&&(P=e[o],he=M(P))):(Fn=nt,x+=1,x<r&&(nt=-t[x],_e=M(nt))),o<n&&he<_e||x>=r?(Bt=P,o+=1,o<n&&(P=e[o],he=M(P))):(Bt=nt,x+=1,x<r&&(nt=-t[x],_e=M(nt)));for(var yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,Co=rl,as=yr,Js,lh,ch,Zu,th;o<n&&x<r;)he<_e?(Bt=P,o+=1,o<n&&(P=e[o],he=M(P))):(Bt=nt,x+=1,x<r&&(nt=-t[x],_e=M(nt))),Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js;for(;o<n;)Bt=P,Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js,o+=1,o<n&&(P=e[o]);for(;x<r;)Bt=nt,Fn=Co,yr=Bt+Fn,Io=yr-Bt,rl=Fn-Io,rl&&(l[p++]=rl),Js=as+yr,lh=Js-as,ch=Js-lh,Zu=yr-lh,th=as-ch,Co=th+Zu,as=Js,x+=1,x<r&&(nt=-t[x]);return Co&&(l[p++]=Co),as&&(l[p++]=as),p||(l[p++]=0),l.length=p,l}(function(e){var t=twoProduct_1,n=robustSum,r=robustScale,s=robustDiff,l=5,p=11102230246251565e-32,o=(3+16*p)*p,x=(7+56*p)*p;function M(Co,as,Js,lh){return function(Zu,th,sl){var sh=Co(Co(as(th[1],sl[0]),as(-sl[1],th[0])),Co(as(Zu[1],th[0]),as(-th[1],Zu[0]))),xh=Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),Mh=lh(sh,xh);return Mh[Mh.length-1]}}function P(Co,as,Js,lh){return function(Zu,th,sl,sh){var xh=Co(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),th[2]),Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),-sl[2]),Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),sh[2]))),Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sh[2])))),Mh=Co(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-sl[2]),Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),sh[2]))),Co(Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sl[2])))),Dh=lh(xh,Mh);return Dh[Dh.length-1]}}function he(Co,as,Js,lh){return function(Zu,th,sl,sh,xh){var Mh=Co(Co(Co(Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),sl[2]),Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),-sh[2]),Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),xh[2]))),th[3]),Co(Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),th[2]),Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),-sh[2]),Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),xh[2]))),-sl[3]),Js(Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),th[2]),Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),-sl[2]),Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),xh[2]))),sh[3]))),Co(Js(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),th[2]),Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),-sl[2]),Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),sh[2]))),-xh[3]),Co(Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),th[2]),Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),-sh[2]),Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),xh[2]))),Zu[3]),Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-sh[2]),Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),xh[2]))),-th[3])))),Co(Co(Js(Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),xh[2]))),sh[3]),Co(Js(Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sh[2]))),-xh[3]),Js(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),th[2]),Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),-sl[2]),Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),sh[2]))),Zu[3]))),Co(Js(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-sl[2]),Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),sh[2]))),-th[3]),Co(Js(Co(Js(Co(as(th[1],sh[0]),as(-sh[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sh[2]))),sl[3]),Js(Co(Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sl[2]))),-sh[3]))))),Dh=Co(Co(Co(Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),sl[2]),Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),-sh[2]),Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),xh[2]))),Zu[3]),Js(Co(Js(Co(as(sh[1],xh[0]),as(-xh[1],sh[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-sh[2]),Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),xh[2]))),-sl[3])),Co(Js(Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-sl[2]),Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),xh[2]))),sh[3]),Js(Co(Js(Co(as(sl[1],sh[0]),as(-sh[1],sl[0])),Zu[2]),Co(Js(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-sl[2]),Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),sh[2]))),-xh[3]))),Co(Co(Js(Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),th[2]),Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),-sl[2]),Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),xh[2]))),Zu[3]),Js(Co(Js(Co(as(sl[1],xh[0]),as(-xh[1],sl[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-sl[2]),Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),xh[2]))),-th[3])),Co(Js(Co(Js(Co(as(th[1],xh[0]),as(-xh[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],xh[0]),as(-xh[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),xh[2]))),sl[3]),Js(Co(Js(Co(as(th[1],sl[0]),as(-sl[1],th[0])),Zu[2]),Co(Js(Co(as(Zu[1],sl[0]),as(-sl[1],Zu[0])),-th[2]),Js(Co(as(Zu[1],th[0]),as(-th[1],Zu[0])),sl[2]))),-xh[3])))),Uh=lh(Mh,Dh);return Uh[Uh.length-1]}}function nt(Co){var as=Co===3?M:Co===4?P:he;return as(n,t,r,s)}var _e=nt(3),Bt=nt(4),Fn=[function(){return 0},function(){return 0},function(as,Js){return Js[0]-as[0]},function(as,Js,lh){var ch=(as[1]-lh[1])*(Js[0]-lh[0]),Zu=(as[0]-lh[0])*(Js[1]-lh[1]),th=ch-Zu,sl;if(ch>0){if(Zu<=0)return th;sl=ch+Zu}else if(ch<0){if(Zu>=0)return th;sl=-(ch+Zu)}else return th;var sh=o*sl;return th>=sh||th<=-sh?th:_e(as,Js,lh)},function(as,Js,lh,ch){var Zu=as[0]-ch[0],th=Js[0]-ch[0],sl=lh[0]-ch[0],sh=as[1]-ch[1],xh=Js[1]-ch[1],Mh=lh[1]-ch[1],Dh=as[2]-ch[2],Uh=Js[2]-ch[2],cd=lh[2]-ch[2],Tf=th*Mh,yf=sl*xh,Af=sl*sh,md=Zu*Mh,vd=Zu*xh,qd=th*sh,Ed=Dh*(Tf-yf)+Uh*(Af-md)+cd*(vd-qd),Td=(Math.abs(Tf)+Math.abs(yf))*Math.abs(Dh)+(Math.abs(Af)+Math.abs(md))*Math.abs(Uh)+(Math.abs(vd)+Math.abs(qd))*Math.abs(cd),Fd=x*Td;return Ed>Fd||-Ed>Fd?Ed:Bt(as,Js,lh,ch)}];function yr(Co){var as=Fn[Co.length];return as||(as=Fn[Co.length]=nt(Co.length)),as.apply(void 0,Co)}function Io(Co,as,Js,lh,ch,Zu,th){return function(sh,xh,Mh,Dh,Uh){switch(arguments.length){case 0:case 1:return 0;case 2:return lh(sh,xh);case 3:return ch(sh,xh,Mh);case 4:return Zu(sh,xh,Mh,Dh);case 5:return th(sh,xh,Mh,Dh,Uh)}for(var cd=new Array(arguments.length),Tf=0;Tf<arguments.length;++Tf)cd[Tf]=arguments[Tf];return Co(cd)}}function rl(){for(;Fn.length<=l;)Fn.push(nt(Fn.length));e.exports=Io.apply(void 0,[yr].concat(Fn));for(var Co=0;Co<=l;++Co)e.exports[Co]=Fn[Co]}rl()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(e,t){for(var n=t[0],r=t[1],s=e.length,l=1,p=s,o=0,x=s-1;o<p;x=o++){var M=e[o],P=e[x],he=M[1],nt=P[1];if(nt<he){if(nt<r&&r<he){var _e=orient(M,P,t);if(_e===0)return 0;l^=0<_e|0}else if(r===he){var Bt=e[(o+1)%s],Fn=Bt[1];if(he<Fn){var _e=orient(M,P,t);if(_e===0)return 0;l^=0<_e|0}}}else if(he<nt){if(he<r&&r<nt){var _e=orient(M,P,t);if(_e===0)return 0;l^=_e<0|0}else if(r===he){var Bt=e[(o+1)%s],Fn=Bt[1];if(Fn<he){var _e=orient(M,P,t);if(_e===0)return 0;l^=_e<0|0}}}else if(r===he){var yr=Math.min(M[0],P[0]),Io=Math.max(M[0],P[0]);if(o===0){for(;x>0;){var rl=(x+s-1)%s,Co=e[rl];if(Co[1]!==r)break;var as=Co[0];yr=Math.min(yr,as),Io=Math.max(Io,as),x=rl}if(x===0)return yr<=n&&n<=Io?0:1;p=x+1}for(var Js=e[(x+s-1)%s][1];o+1<p;){var Co=e[o+1];if(Co[1]!==r)break;var as=Co[0];yr=Math.min(yr,as),Io=Math.max(Io,as),o+=1}if(yr<=n&&n<=Io)return 0;var lh=e[(o+1)%s][1];n<yr&&Js<r!=lh<r&&(l^=1)}}return 2*l-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const n=new Array(t.length);let r=1/0,s=0,l=[];for(let M=0;M<t.length;M++){let P=getAngle(t[M],t[(M+1)%t.length]);rotate(-P,t,n);let he=0,nt=[];for(let _e=0;_e<t.length;_e++){let Bt=Math.abs(n[M][1]-n[_e][1]);Bt>he&&(he=Bt,nt=[],nt.push([n[_e][0],n[M][1]],[n[_e][0],n[_e][1]]))}he<r&&(r=he,s=P,l=nt)}rotate(s,l,l);let p=0,o=[],x=0;for(let M=0;M<t.length-1;M++)for(let P=M+1;P<t.length;P++){let he=(t[M][0]-t[P][0])**2+(t[M][1]-t[P][1])**2;he>x&&(x=he,p=Math.sqrt(he),o=[t[M],t[P]])}return{min:r,minLine:l,max:p,maxLine:o,aspectRatio:r/p}}function getAngle(e,t){let n=difference(t,e),r=normalize(n),s=Math.acos(r[0]);return r[1]<0?-s:s}class Roi{constructor(t,n){this.map=t,this.id=n,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:n=1,kind:r=""}=t;let s;switch(r){case"contour":s=this.contourMask;break;case"box":s=this.boxMask;break;case"filled":s=this.filledMask;break;case"center":s=this.centerMask;break;case"mbr":s=this.mbrFilledMask;break;case"hull":s=this.convexHullFilledMask;break;case"hullContour":s=this.convexHullMask;break;case"mbrContour":s=this.mbrMask;break;case"feret":s=this.feretMask;break;default:s=this.mask}return n<1&&(s=s.resize({factor:n}),s.parent=this.mask.parent,s.position[0]+=this.minX,s.position[1]+=this.minY),s}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,n=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let r=this.internalIDs;for(let s=0;s<t.length;s++)r.includes(t[s])||(this.computed.externalIDs.push(t[s]),this.computed.externalLengths.push(n[s]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++)this.map.data[n+this.minX+(r+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&r>0&&r<this.height-1?(this.map.data[n-1+this.minX+(r+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(r+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(r-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(r+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(n,r):t.setBitXY(n,r));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)t.setBitXY(n,0),t.setBitXY(n,this.height-1);for(let n=0;n<this.height;n++)t.setBitXY(0,n),t.setBitXY(this.width-1,n);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++)this.map.data[n+this.minX+(r+this.minY)*this.map.width]===this.id&&t.setBitXY(n,r);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++){let s=n+this.minX+(r+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[s])&&t.setBitXY(n,r)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let r=0;r<this.width;r++)for(let s=0;s<this.height;s++)this.map.data[r+this.minX+(s+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&s>0&&s<this.height-1?(this.map.data[r-1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(s-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(s+1+this.minY)*this.map.width]!==this.id)&&(t.push([r,s]),t.push([r+1,s]),t.push([r,s+1]),t.push([r+1,s+1])):(t.push([r,s]),t.push([r+1,s]),t.push([r,s+1]),t.push([r+1,s+1])));const n=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:n,surface:surface(n),perimeter:perimeter(n)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,n=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});n.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=n}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,n=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(t.polyline,[r,s])!==1&&n.setBitXY(r,s);this.computed.convexHullFilledMask=n}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let n=t[0],r=t[1],s=t[2],l=Math.sqrt((n[0]-r[0])**2+(n[1]-r[1])**2),p=Math.sqrt((s[0]-r[0])**2+(s[1]-r[1])**2);this.computed.mbr={width:l,height:p,elongation:1-l/p,aspectRatio:l/p,surface:l*p,perimeter:(l+p)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,n=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-n*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const n=minMax(t),r=new Image$1(n[1][0]-n[0][0]+1,n[1][1]-n[0][1]+1,{kind:BINARY,position:[this.minX+n[0][0],this.minY+n[0][1]],parent:this.map.parent});t=moveToZeroZero(t),r.paintPolyline(t,{closed:!0}),this.computed.mbrMask=r}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),n=this.mask.minimalBoundingRectangle();for(let r=0;r<this.width;r++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(n,[r,s])!==1&&t.setBitXY(r,s);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++){let s=(n+this.minY)*this.map.width+r+this.minX;this.map.data[s]===this.id&&t.push([r,n])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,n;const r=this.points;for(let s=0;s<r.length;s++)for(let l=s+1;l<r.length;l++){let p=Math.pow(r[s][0]-r[l][0],2)+Math.pow(r[s][1]-r[l][1],2);p>=t&&(t=p,n=[r[s],r[l]])}this.computed.maxLengthPoints=n}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,n=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=n}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let t=e.map,n=t.data,r=new Set,s=new Map,l=new Set,p=[1,0,-1,0],o=[0,1,0,-1];for(let P=e.minX;P<=e.maxX;P++)for(let he=e.minY;he<=e.maxY;he++){let nt=P+he*t.width;if(n[nt]===e.id)for(let _e=0;_e<4;_e++){let Bt=P+p[_e],Fn=he+o[_e];if(Bt>=0&&Fn>=0&&Bt<t.width&&Fn<t.height){let yr=Bt+Fn*t.width;if(n[yr]!==e.id&&!l.has(yr)){l.add(yr),r.add(n[yr]);let Io=s.get(n[yr]);Io?s.set(n[yr],++Io):s.set(n[yr],1)}}}}let x=Array.from(r),M=x.map(function(P){return s.get(P)});return{ids:x,lengths:M}}function getBoxIDs(e){let t=new Set,n=e.map,r=n.data;for(let s of[0,e.height-1])for(let l=0;l<e.width;l++){let p=(s+e.minY)*n.width+l+e.minX;if(l-e.minX>0&&r[p]===e.id&&r[p-1]!==e.id){let o=r[p-1];t.add(o)}if(n.width-l-e.minX>1&&r[p]===e.id&&r[p+1]!==e.id){let o=r[p+1];t.add(o)}}for(let s of[0,e.width-1])for(let l=0;l<e.height;l++){let p=(l+e.minY)*n.width+s+e.minX;if(l-e.minY>0&&r[p]===e.id&&r[p-n.width]!==e.id){let o=r[p-n.width];t.add(o)}if(n.height-l-e.minY>1&&r[p]===e.id&&r[p+n.width]!==e.id){let o=r[p+n.width];t.add(o)}}return Array.from(t)}function getBox(e){let t=0,n=e.map,r=n.data,s=[0];e.height>1&&(s[1]=e.height-1);for(let p of s)for(let o=1;o<e.width-1;o++){let x=(p+e.minY)*n.width+o+e.minX;r[x]===e.id&&t++}let l=[0];e.width>1&&(l[1]=e.width-1);for(let p of l)for(let o=0;o<e.height;o++){let x=(o+e.minY)*n.width+p+e.minX;r[x]===e.id&&t++}return t}function getBorder(e){let t=0,n=e.map,r=n.data;for(let s=1;s<e.width-1;s++)for(let l=1;l<e.height-1;l++){let p=(l+e.minY)*n.width+s+e.minX;r[p]===e.id&&(r[p-1]!==e.id||r[p+1]!==e.id||r[p-n.width]!==e.id||r[p+n.width]!==e.id)&&t++}return t+e.box}function getPerimeterInfo(e){let t=e.map,n=t.data,r=0,s=0,l=0,p=0;for(let o=0;o<e.width;o++)for(let x=0;x<e.height;x++){let M=(x+e.minY)*t.width+o+e.minX;if(n[M]===e.id){let P=0;switch((o===0||e.externalIDs.includes(n[M-1]))&&P++,(o===e.width-1||e.externalIDs.includes(n[M+1]))&&P++,(x===0||e.externalIDs.includes(n[M-t.width]))&&P++,(x===e.height-1||e.externalIDs.includes(n[M+t.width]))&&P++,P){case 1:r++;break;case 2:s++;break;case 3:l++;break;case 4:p++;break}}}return{one:r,two:s,three:l,four:p}}function getExternal(e){let t=0,n=e.map,r=n.data;for(let s=1;s<e.width-1;s++)for(let l=1;l<e.height-1;l++){let p=(l+e.minY)*n.width+s+e.minX;r[p]===e.id&&(e.externalIDs.includes(r[p-1])||e.externalIDs.includes(r[p+1])||e.externalIDs.includes(r[p-n.width])||e.externalIDs.includes(r[p+n.width]))&&t++}return t+e.box}function getHolesInfo(e){let t=0,n=e.map.width,r=e.map.data;for(let s=1;s<e.width-1;s++)for(let l=1;l<e.height-1;l++){let p=(l+e.minY)*n+s+e.minX;e.internalIDs.includes(r[p])&&r[p]!==e.id&&t++}return{number:e.internalIDs.length-1,surface:t}}function getInternalIDs(e){let t=[e.id],n=e.map,r=n.data;if(e.height>2)for(let l=0;l<e.width;l++){let p=e.minY*n.width+l+e.minX;if(t.includes(r[p])){let o=r[p+n.width];!t.includes(o)&&!e.boxIDs.includes(o)&&t.push(o)}}let s=new Array(4);for(let l=1;l<e.width-1;l++)for(let p=1;p<e.height-1;p++){let o=(p+e.minY)*n.width+l+e.minX;if(t.includes(r[o])){s[0]=r[o-1],s[1]=r[o+1],s[2]=r[o-n.width],s[3]=r[o+n.width];for(let x=0;x<4;x++){let M=s[x];!t.includes(M)&&!e.boxIDs.includes(M)&&t.push(M)}}}return t}class RoiLayer{constructor(t,n){this.roiMap=t,this.options=n,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,n={};this.roiMap.positive=0,this.roiMap.negative=0;for(let o=0;o<t.length;o++)t[o]&&!n[t[o]]&&(n[t[o]]=!0,t[o]>0?this.roiMap.positive++:this.roiMap.negative++);let r={};for(let o in n)r[o]=new Roi(this.roiMap,o*1);let s=this.roiMap.width,l=this.roiMap.height;for(let o=0;o<l;o++)for(let x=0;x<s;x++){let M=o*s+x;if(t[M]!==0){const P=t[M],he=r[P];x<he.minX&&(he.minX=x),x>he.maxX&&(he.maxX=x),o<he.minY&&(he.minY=o),o>he.maxY&&(he.maxY=o),he.meanX+=x,he.meanY+=o,he.surface++}}let p=[];for(let o in n)r[o].meanX/=r[o].surface,r[o].meanY/=r[o].surface,p.push(r[o]);return p}}function commonBorderLength(e){let t=e.data,n=[1,0,-1,0],r=[0,1,0,-1],s=e.minMax,l=-s.min,p=s.max+l,o=[];for(let M=0;M<=p;M++)o.push(Object.create(null));for(let M=0;M<e.width;M++)for(let P=0;P<e.height;P++){let he=M+P*e.width,nt=t[he];if(nt!==0){let _e=Object.create(null),Bt=!1;for(let Fn=0;Fn<4;Fn++){let yr=M+n[Fn],Io=P+r[Fn];if(yr>=0&&Io>=0&&yr<e.width&&Io<e.height){let rl=t[yr+Io*e.width];nt!==rl&&(Bt=!0,rl!==0&&_e[rl]===void 0&&(_e[rl]=!0,o[rl+l][nt]?o[rl+l][nt]++:o[rl+l][nt]=1))}else Bt=!0}Bt&&(o[nt+l][nt]?o[nt+l][nt]++:o[nt+l][nt]=1)}}let x={};for(let M=0;M<o.length;M++)Object.keys(o[M]).length>0&&(x[M-l]=o[M]);return x}function mergeRoi(e={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:n=5,maxCommonBorderLength:r=100,minCommonBorderRatio:s=.3,maxCommonBorderRatio:l=1}=e;let p=function(yr,Io,rl){return yr[rl]>=n&&yr[rl]<=r};typeof t=="function"&&(p=t),t.toLowerCase()==="commonborderratio"&&(p=function(yr,Io,rl){let Co=Math.min(yr[rl]/yr[Io],1);return Co>=s&&Co<=l});const o=this,x=o.commonBorderLength;let M={},P={};for(let yr of Object.keys(x)){let Io=x[yr],rl=Object.keys(Io);for(let Co of rl)if(Co!==yr&&p(Io,yr,Co)){let as=Co;P[Co]&&(as=P[Co]);let Js=yr;if(P[yr]&&(Js=P[yr]),Number(as)!==Js){let lh=Math.min(as,Js),ch=Math.max(as,Js);if(M[lh]||(M[lh]={}),M[lh][ch]=!0,P[ch]=lh,M[ch]){for(let Zu of Object.keys(M[ch]))M[lh][Zu]=!0,P[Zu]=lh;delete M[ch]}}}}let he=o.minMax,nt=-he.min,_e=he.max+nt,Bt=new Array(_e+1).fill(0);for(let yr of Object.keys(P))Bt[Number(yr)+nt]=P[yr];let Fn=o.data;for(let yr=0;yr<Fn.length;yr++){let Io=Fn[yr];if(Io!==0){let rl=Bt[Io+nt];rl!==0&&(Fn[yr]=rl)}}return o.computed={},o}class RoiMap{constructor(t,n){this.parent=t,this.width=t.width,this.height=t.height,this.data=n,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let r=0;r<this.data.length;r++)this.data[r]<t&&(t=this.data[r]),this.data[r]>n&&(n=this.data[r]);return{min:t,max:n}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const n=t[0],r=t.slice(1);for(let s=0;s<this.data.length;s++)r.includes(this.data[s])&&(this.data[s]=n)}rowsInfo(){let t=new Array(this.height),n=0;for(let r=0;r<this.data.length;r+=this.width){let s={row:n,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[n++]=s;let l={},p={},o=[],x=this.data[r],M=0;for(let P=r;P<r+this.width;P++){let he=this.data[P];x!==he&&(x=he,o.push(M),M=0),M++,he>0?(s.positivePixel++,l[he]||(l[he]=!0)):he<0?(s.negativePixel++,p[he]||(p[he]=!0)):s.zeroPixel++}o.push(M),s.medianChange=o.sort((P,he)=>P-he)[Math.floor(o.length/2)],s.positiveRoiIDs=Object.keys(l),s.negativeRoiIDs=Object.keys(p),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),n=0;for(let r=0;r<this.width;r++){let s={col:n,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[n++]=s;let l={},p={},o=[],x=this.data[r],M=0;for(let P=r;P<r+this.data.length;P+=this.width){let he=this.data[P];x!==he&&(x=he,o.push(M),M=0),M++,he>0?(s.positivePixel++,l[he]||(l[he]=!0)):he<0?(s.negativePixel++,p[he]||(p[he]=!0)):s.zeroPixel++}o.push(M),s.medianChange=o.sort((P,he)=>P-he)[Math.floor(o.length/2)],s.positiveRoiIDs=Object.keys(l),s.negativeRoiIDs=Object.keys(p),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return t}}function fromMask(e,t={}){const{allowCorners:n=!1}=t,r=65535;let s=new Int16Array(e.size),l=0,p=0,o=new Uint16Array(r+1),x=new Uint16Array(r+1);for(let P=0;P<e.width;P++)for(let he=0;he<e.height;he++)s[he*e.width+P]===0&&M(P,he);function M(P,he){let nt=0,_e=0,Bt=e.getBitXY(P,he),Fn=Bt?++l:--p;if(l>32767||p<-32768)throw new Error("Too many regions of interest");for(o[0]=P,x[0]=he;nt<=_e;){let yr=o[nt&r],Io=x[nt&r];if(s[Io*e.width+yr]=Fn,yr>0&&s[Io*e.width+yr-1]===0&&e.getBitXY(yr-1,Io)===Bt&&(_e++,o[_e&r]=yr-1,x[_e&r]=Io,s[Io*e.width+yr-1]=-32768),Io>0&&s[(Io-1)*e.width+yr]===0&&e.getBitXY(yr,Io-1)===Bt&&(_e++,o[_e&r]=yr,x[_e&r]=Io-1,s[(Io-1)*e.width+yr]=-32768),yr<e.width-1&&s[Io*e.width+yr+1]===0&&e.getBitXY(yr+1,Io)===Bt&&(_e++,o[_e&r]=yr+1,x[_e&r]=Io,s[Io*e.width+yr+1]=-32768),Io<e.height-1&&s[(Io+1)*e.width+yr]===0&&e.getBitXY(yr,Io+1)===Bt&&(_e++,o[_e&r]=yr,x[_e&r]=Io+1,s[(Io+1)*e.width+yr]=-32768),n&&(yr>0&&Io>0&&s[(Io-1)*e.width+yr-1]===0&&e.getBitXY(yr-1,Io-1)===Bt&&(_e++,o[_e&r]=yr-1,x[_e&r]=Io-1,s[(Io-1)*e.width+yr-1]=-32768),yr<e.width-1&&Io>0&&s[(Io-1)*e.width+yr+1]===0&&e.getBitXY(yr+1,Io-1)===Bt&&(_e++,o[_e&r]=yr+1,x[_e&r]=Io-1,s[(Io-1)*e.width+yr+1]=-32768),yr>0&&Io<e.height-1&&s[(Io+1)*e.width+yr-1]===0&&e.getBitXY(yr-1,Io+1)===Bt&&(_e++,o[_e&r]=yr-1,x[_e&r]=Io+1,s[(Io+1)*e.width+yr-1]=-32768),yr<e.width-1&&Io<e.height-1&&s[(Io+1)*e.width+yr+1]===0&&e.getBitXY(yr+1,Io+1)===Bt&&(_e++,o[_e&r]=yr+1,x[_e&r]=Io+1,s[(Io+1)*e.width+yr+1]=-32768)),nt++,_e-nt>r)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,s)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var n=this.nodes.get(t);return n||(n=new DisjointSetNode(t),this.nodes.set(t,n)),n}union(t,n){const r=this.find(t),s=this.find(n);r!==s&&(r.rank<s.rank?r.parent=s:r.rank>s.rank?s.parent=r:(s.parent=r,r.rank++))}find(t){for(var n=t;n.parent!==null;)n=n.parent;for(var r=t;r.parent!==null;){var s=r;r=r.parent,s.parent=n}return n}connected(t,n){return this.find(t)===this.find(n)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,t={}){const{allowCorners:n=!1}=t;let r=4;n&&(r=8);let s,l,p;if(r===8)s=direction8X,l=direction8Y,p=neighbours8;else if(r===4)s=direction4X,l=direction4Y,p=neighbours4;else throw new RangeError(`unsupported neighbours count: ${r}`);const o=e.size,x=e.width,M=e.height,P=new Array(o),he=new Uint32Array(o),nt=new DisjointSet$1;let _e=1;for(let Bt=0;Bt<M;Bt++)for(let Fn=0;Fn<x;Fn++){const yr=Fn+Bt*x;if(e.getBit(yr)){let Io=null;for(let rl=0;rl<p.length;rl++){const Co=Fn+s[rl],as=Bt+l[rl];if(Co>=0&&as>=0&&Co<x&&as<M){const Js=Co+as*x;let lh=P[Js];lh?(p[rl]=lh,(!Io||p[rl].value<Io.value)&&(Io=p[rl])):p[rl]=null}}if(!Io)P[yr]=nt.add(_e++);else{P[yr]=Io;for(let rl=0;rl<p.length;rl++)p[rl]&&p[rl]!==Io&&nt.union(Io,p[rl])}}}for(let Bt=0;Bt<M;Bt++)for(let Fn=0;Fn<x;Fn++){const yr=Fn+Bt*x;e.getBit(yr)&&(he[yr]=nt.find(P[yr]).value)}return new RoiMap(e,he)}function fromMaxima(e={}){let{allowCorner:t=!0,onlyTop:n=!1,invert:r=!1}=e,s=this;s.checkProcessable("fromMaxima",{components:[1]});const l=1,p=2;let o=0,x=0,M=new Int16Array(s.size),P=new Int8Array(s.size),he=new Float32Array(s.size),nt=1048575,_e=new Uint16Array(nt+1),Bt=new Uint16Array(nt+1),Fn=0,yr=0,Io=new Uint16Array(nt+1),rl=new Uint16Array(nt+1),Co=0,as=0;for(Js(s);Fn<yr;){let Zu=_e[Fn&nt],th=Bt[Fn&nt];ch(Zu,th,p),Fn++}return new RoiMap(s,M);function Js({maxima:Zu=!0}){for(let th=1;th<s.height-1;th++)for(let sl=1;sl<s.width-1;sl++){let sh=sl+th*s.width;if(P[sh]===0){let xh=Zu?s.data[sh]:-s.data[sl+th*s.width];if(s.data[th*s.width+sl-1]>xh||s.data[th*s.width+sl+1]>xh||s.data[(th-1)*s.width+sl]>xh||s.data[(th+1)*s.width+sl]>xh||t&&(s.data[(th-1)*s.width+sl-1]>xh||s.data[(th-1)*s.width+sl+1]>xh||s.data[(th+1)*s.width+sl-1]>xh||s.data[(th+1)*s.width+sl+1]>xh))continue;M[sh]=Zu?++o:--x,lh(sl,th)||(Zu?--o:++x)}}}function lh(Zu,th){let sl=yr;Co=0,as=1,Io[0]=Zu,rl[0]=th;let sh=!0;for(;Co<as;){let xh=Io[Co&nt],Mh=rl[Co&nt];sh&=ch(xh,Mh,l),Co++}if(!sh){for(let xh=0;xh<as;xh++){let Mh=Io[xh&nt],Uh=rl[xh&nt]*s.width+Mh;M[Uh]=0}yr=sl}return sh}function ch(Zu,th,sl){let sh=M[th*s.width+Zu],xh=s.data[th*s.width+Zu];for(let Mh=th-1;Mh<=th+1;Mh++)for(let Dh=Zu-1;Dh<=Zu+1;Dh++){let Uh=Mh*s.width+Dh;if(P[Uh]===0)switch(P[Uh]=1,he[Uh]=s.data[Uh]-xh,sl){case l:if(he[Uh]===0){if(Dh===0||Mh===0||Dh===s.width-1||Mh===s.height-1)return!1;M[Uh]=sh,Io[as&nt]=Dh,rl[as&nt]=Mh,as++}else{if(he[Uh]>0)return!1;n||(M[Uh]=sh,_e[yr&nt]=Dh,Bt[yr&nt]=Mh,yr++)}break;case p:he[Uh]<=0&&(M[Uh]=sh,_e[yr&nt]=Dh,Bt[yr&nt]=Mh,yr++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,t={}){let n=new Shape(t),r=new Int16Array(this.size),s=0,l=n.getPoints();for(let p=0;p<e.length;p++){s++;let o=e[p][0],x=e[p][1];for(let M=0;M<l.length;M++){let P=l[M][0],he=l[M][1];o+P>=0&&x+he>=0&&o+P<this.width&&x+he<this.height&&(r[o+P+(x+he)*this.width]=s)}}return new RoiMap(this,r)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,s,l){function p(M,P){if(!s[M]){if(!r[M]){var he=typeof commonjsRequire=="function"&&commonjsRequire;if(!P&&he)return he(M,!0);if(o)return o(M,!0);var nt=new Error("Cannot find module '"+M+"'");throw nt.code="MODULE_NOT_FOUND",nt}var _e=s[M]={exports:{}};r[M][0].call(_e.exports,function(Bt){var Fn=r[M][1][Bt];return p(Fn||Bt)},_e,_e.exports,n,r,s,l)}return s[M].exports}for(var o=typeof commonjsRequire=="function"&&commonjsRequire,x=0;x<l.length;x++)p(l[x]);return p}({1:[function(n,r,s){var l,p,o,x,M,P=function(nt,_e){for(var Bt in _e)he.call(_e,Bt)&&(nt[Bt]=_e[Bt]);function Fn(){this.constructor=nt}return Fn.prototype=_e.prototype,nt.prototype=new Fn,nt.__super__=_e.prototype,nt},he={}.hasOwnProperty;l=n("./PriorityQueue/AbstractPriorityQueue"),p=n("./PriorityQueue/ArrayStrategy"),x=n("./PriorityQueue/BinaryHeapStrategy"),o=n("./PriorityQueue/BHeapStrategy"),M=function(nt){P(_e,nt);function _e(Bt){Bt||(Bt={}),Bt.strategy||(Bt.strategy=x),Bt.comparator||(Bt.comparator=function(Fn,yr){return(Fn||0)-(yr||0)}),_e.__super__.constructor.call(this,Bt)}return _e}(l),M.ArrayStrategy=p,M.BinaryHeapStrategy=x,M.BHeapStrategy=o,r.exports=M},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(n,r,s){r.exports=function(){function l(p){var o;if(p?.strategy==null)throw"Must pass options.strategy, a strategy";if(p?.comparator==null)throw"Must pass options.comparator, a comparator";this.priv=new p.strategy(p),this.length=(p!=null&&(o=p.initialValues)!=null?o.length:void 0)||0}return l.prototype.queue=function(p){this.length++,this.priv.queue(p)},l.prototype.dequeue=function(p){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},l.prototype.peek=function(p){if(!this.length)throw"Empty queue";return this.priv.peek()},l.prototype.clear=function(){return this.length=0,this.priv.clear()},l}()},{}],3:[function(n,r,s){var l;l=function(p,o,x){var M,P,he;for(P=0,M=p.length;P<M;)he=P+M>>>1,x(p[he],o)>=0?P=he+1:M=he;return P},r.exports=function(){function p(o){var x;this.options=o,this.comparator=this.options.comparator,this.data=((x=this.options.initialValues)!=null?x.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return p.prototype.queue=function(o){var x;x=l(this.data,o,this.comparator),this.data.splice(x,0,o)},p.prototype.dequeue=function(){return this.data.pop()},p.prototype.peek=function(){return this.data[this.data.length-1]},p.prototype.clear=function(){this.data.length=0},p}()},{}],4:[function(n,r,s){r.exports=function(){function l(p){var o,x,M,P,he,nt,_e,Bt;for(this.comparator=p?.comparator||function(Fn,yr){return Fn-yr},this.pageSize=p?.pageSize||512,this.length=0,_e=0;1<<_e<this.pageSize;)_e+=1;if(1<<_e!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=_e,this._emptyMemoryPageTemplate=o=[],x=0,he=this.pageSize;0<=he?x<he:x>he;0<=he?++x:--x)o.push(null);if(this._memory=[],this._mask=this.pageSize-1,p.initialValues)for(nt=p.initialValues,M=0,P=nt.length;M<P;M++)Bt=nt[M],this.queue(Bt)}return l.prototype.queue=function(p){this.length+=1,this._write(this.length,p),this._bubbleUp(this.length,p)},l.prototype.dequeue=function(){var p,o;return p=this._read(1),o=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,o),this._bubbleDown(1,o)),p},l.prototype.peek=function(){return this._read(1)},l.prototype.clear=function(){this.length=0,this._memory.length=0},l.prototype._write=function(p,o){var x;for(x=p>>this._shift;x>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[x][p&this._mask]=o},l.prototype._read=function(p){return this._memory[p>>this._shift][p&this._mask]},l.prototype._bubbleUp=function(p,o){var x,M,P,he;for(x=this.comparator;p>1&&(M=p&this._mask,p<this.pageSize||M>3?P=p&~this._mask|M>>1:M<2?(P=p-this.pageSize>>this._shift,P+=P&~(this._mask>>1),P|=this.pageSize>>1):P=p-2,he=this._read(P),!(x(he,o)<0));)this._write(P,o),this._write(p,he),p=P},l.prototype._bubbleDown=function(p,o){var x,M,P,he,nt;for(nt=this.comparator;p<this.length;)if(p>this._mask&&!(p&this._mask-1)?x=M=p+2:p&this.pageSize>>1?(x=(p&~this._mask)>>1,x|=p&this._mask>>1,x=x+1<<this._shift,M=x+1):(x=p+(p&this._mask),M=x+1),x!==M&&M<=this.length)if(P=this._read(x),he=this._read(M),nt(P,o)<0&&nt(P,he)<=0)this._write(x,o),this._write(p,P),p=x;else if(nt(he,o)<0)this._write(M,o),this._write(p,he),p=M;else break;else if(x<=this.length)if(P=this._read(x),nt(P,o)<0)this._write(x,o),this._write(p,P),p=x;else break;else break},l}()},{}],5:[function(n,r,s){r.exports=function(){function l(p){var o;this.comparator=p?.comparator||function(x,M){return x-M},this.length=0,this.data=((o=p.initialValues)!=null?o.slice(0):void 0)||[],this._heapify()}return l.prototype._heapify=function(){var p,o,x;if(this.data.length>0)for(p=o=1,x=this.data.length;1<=x?o<x:o>x;p=1<=x?++o:--o)this._bubbleUp(p)},l.prototype.queue=function(p){this.data.push(p),this._bubbleUp(this.data.length-1)},l.prototype.dequeue=function(){var p,o;return o=this.data[0],p=this.data.pop(),this.data.length>0&&(this.data[0]=p,this._bubbleDown(0)),o},l.prototype.peek=function(){return this.data[0]},l.prototype.clear=function(){this.length=0,this.data.length=0},l.prototype._bubbleUp=function(p){for(var o,x;p>0&&(o=p-1>>>1,this.comparator(this.data[p],this.data[o])<0);)x=this.data[o],this.data[o]=this.data[p],this.data[p]=x,p=o},l.prototype._bubbleDown=function(p){var o,x,M,P,he;for(o=this.data.length-1;x=(p<<1)+1,P=x+1,M=p,x<=o&&this.comparator(this.data[x],this.data[M])<0&&(M=x),P<=o&&this.comparator(this.data[P],this.data[M])<0&&(M=P),M!==p;)he=this.data[M],this.data[M]=this.data[p],this.data[p]=he,p=M},l}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:t,mask:n,image:r,fillMaxValue:s=this.maxValue,invert:l=!1}=e,p=r||this;p.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),l=!l,t||(t=p.getLocalMaxima({invert:l,mask:n}));let o=l?0:1,x=new Int16Array(p.size),M=p.width,P=p.height,he=new PriorityQueue({comparator:(nt,_e)=>nt[2]-_e[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let nt=0;nt<t.length;nt++){let _e=t[nt][0]+t[nt][1]*M;x[_e]=nt+1;let Bt=p.data[_e];(l&&Bt<=s||!l&&Bt>=s)&&he.queue([t[nt][0],t[nt][1],Bt])}for(;he.length>0;){let nt=he.dequeue(),_e=nt[0]+nt[1]*M;for(let Bt=0;Bt<4;Bt++){let Fn=nt[0]+dxs[Bt],yr=nt[1]+dys[Bt];if(Fn>=0&&yr>=0&&Fn<M&&yr<P){let Io=Fn+yr*M;if(!n||n.getBit(Io)===o){let rl=p.data[Io];(l&&rl<=s||!l&&rl>=s)&&x[Io]===0&&(x[Io]=x[_e],he.queue([nt[0]+dxs[Bt],nt[1]+dys[Bt],rl]))}}}}return new RoiMap(p,x)}class RoiManager{constructor(t,n={}){this._image=t,this._options=n,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let n=Object.assign({},this._options,t),r=fromMaxima.call(this._image,t);this._layers[n.label]=new RoiLayer(r,n)}fromPoints(t,n={}){let r=Object.assign({},this._options,n),s=fromPoints.call(this._image,t,n);return this._layers[r.label]=new RoiLayer(s,r),this}putMap(t,n={}){let r=new RoiMap(this._image,t),s=Object.assign({},this._options,n);return this._layers[s.label]=new RoiLayer(r,s),this}fromWaterShed(t={}){let n=Object.assign({},this._options,t),r=fromWaterShed.call(this._image,t);this._layers[n.label]=new RoiLayer(r,n)}fromMask(t,n={}){let r=Object.assign({},this._options,n),s=fromMask.call(this._image,t,n);return this._layers[r.label]=new RoiLayer(s,r),this}fromMaskConnectedComponentLabelingAlgorithm(t,n={}){let r=Object.assign({},this._options,n),s=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,n);return this._layers[r.label]=new RoiLayer(s,r),this}getMap(t={}){let n=Object.assign({},this._options,t);return this._assertLayerWithLabel(n.label),this._layers[n.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let n=this.getRois(t);if(n){let r=new Array(n.length);for(let s=0;s<n.length;s++)r[s]=n[s].id;return r}throw new Error("ROIs not found")}getRois(t={}){let{label:n=this._options.label,positive:r=!0,negative:s=!0,minSurface:l=0,maxSurface:p=Number.POSITIVE_INFINITY,minWidth:o=0,maxWidth:x=Number.POSITIVE_INFINITY,minHeight:M=0,maxHeight:P=Number.POSITIVE_INFINITY,minRatio:he=0,maxRatio:nt=Number.POSITIVE_INFINITY}=t;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const _e=this._layers[n].roi,Bt=[];for(const Fn of _e)(Fn.id<0&&s||Fn.id>0&&r)&&Fn.surface>=l&&Fn.surface<=p&&Fn.width>=o&&Fn.width<=x&&Fn.height>=M&&Fn.height<=P&&Fn.ratio>=he&&Fn.ratio<=nt&&Bt.push(Fn);return Bt}getRoi(t,n={}){const{label:r=this._options.label}=n;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const s=this._layers[r].roi.find(l=>l.id===t);if(!s)throw new Error(`found no Roi with id ${t}`);return s}getMasks(t={}){let n=this.getRois(t),r=new Array(n.length);for(let s=0;s<n.length;s++)r[s]=n[s].getMask(t);return r}getAnalysisMasks(t={}){const{analysisProperty:n}=t;let r=`${n}Mask`,s=this.getRois(t);return s.length===0||!s[0][r]?[]:s.map(l=>l[r])}getData(t={}){let n=Object.assign({},this._options,t);return this._assertLayerWithLabel(n.label),this._layers[n.label].roiMap.data}paint(t={}){let{labelProperty:n,analysisProperty:r}=t;this._painted||(this._painted=this._image.rgba8());let s=this.getMasks(t);if(n){const l=this.getRois(t);t.labels=l.map(M=>deepValue(M,n));const p=Math.max(...t.labels);let o=!1,x=!1;if(n.includes("surface")?o=!0:/(?:perimeter|min|max|external|width|height|length)/.test(n)&&(x=!0),isFinite(p)){let M="";if(t.unit!=="pixel"&&t.pixelSize&&(x||o)){M=o?`${t.unit}^2`:t.unit;let P=o?"m^2":"m",he=o?t.pixelSize**2:t.pixelSize;const nt=Qty.swiftConverter(P,M);t.labels=t.labels.map(_e=>nt(he*_e))}p>50?t.labels=t.labels.map(P=>Math.round(P)+M):p>10?t.labels=t.labels.map(P=>P.toFixed(1)+M):t.labels=t.labels.map(P=>P.toFixed(2)+M)}t.labelsPosition=l.map(M=>[M.meanX,M.meanY])}if(this._painted.paintMasks(s,t),r){let l=this.getAnalysisMasks(t);this._painted.paintMasks(l,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let n=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),r=this.getMasks(t);for(let s=0;s<r.length;s++){let l=r[s];for(let p=0;p<l.width;p++)for(let o=0;o<l.height;o++)l.getBitXY(p,o)&&n.setBitXY(p+l.position[0],o+l.position[1])}return n}resetPainted(t={}){const{image:n}=t;n?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const n=this.getMap(t);return n.mergeRoi(t),this.putMap(n.data,t),this}mergeRois(t,n={}){if(!Array.isArray(t)||t.some(s=>!Number.isInteger(s)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(s=>this.getRoi(s));const r=this.getMap(n);return r.mergeRois(t),this.putMap(r.data,n),this}findCorrespondingRoi(t,n={}){let r=this.getRois(n),s=[];for(let l=0;l<r.length;l++){let p=r[l],o=p.minX,x=p.minY,M=p.points,P=Math.sign(p.id),he=correspondingRoisInformation(o,x,M,t,P);s.push(he)}return s}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(e,t,n,r,s){let l={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let p=0;p<n.length;p++){let o=n[p],x=o[0],M=o[1],P=x+e+(M+t)*r.width,he=r.data[P];(he>0||he<0)&&(l.id.includes(he)?l.surface[l.id.indexOf(he)]+=1:(l.id.push(he),l.surface.push(1)))}for(let p=0;p<l.id.length;p++)Math.sign(l.id[p])===s?l.same+=l.surface[p]:l.opposite+=l.surface[p],l.roiSurfaceCovered[p]=l.surface[p]/n.length;return l.total=l.opposite+l.same,l}const objectToString$1=Object.prototype.toString;let Image$1=class Ww{constructor(t,n,r,s){if(arguments.length===1?(s=t,{width:t,height:n,data:r}=s):r&&!r.length&&(s=r,{data:r}=s),t===void 0&&(t=1),n===void 0&&(n=1),s===void 0&&(s={}),typeof s!="object"||s===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new RangeError("height must be a positive integer");const{kind:l=RGBA}=s;if(typeof l!="string")throw new TypeError("kind must be a string");const p=getKind(l),o=Object.assign({},s);for(const Fn in p)o[Fn]===void 0&&(o[Fn]=p[Fn]);verifyKindDefinition(o);const{components:x,bitDepth:M,colorModel:P}=o,he=o.alpha+0,nt=t*n,_e=x+he,Bt=M===32?Number.MAX_VALUE:2**M-1;if(r===void 0)r=createPixelArray(nt,x,he,_e,M,Bt);else{const Fn=getTheoreticalPixelArraySize(nt,_e,M);if(r.length!==Fn)throw new RangeError(`incorrect data size: ${r.length}. Should be ${Fn}`)}this.width=t,this.height=n,this.data=r,this.size=nt,this.components=x,this.alpha=he,this.bitDepth=M,this.maxValue=Bt,this.colorModel=P,this.channels=_e,this.meta=s.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:s.parent||null}),this.position=s.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString$1.call(t)==="[object IJSImage]"}static fromCanvas(t){const r=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Ww(r.width,r.height,r.data)}static createFrom(t,n){const r=getImageParameters(t);return Object.assign(r,{parent:t,position:[0,0]},n),new Ww(r)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Ww(this.width,this.height,t,this)}apply(t){for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++){let s=(n*this.width+r)*this.channels;t.call(this,s)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$4(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(n,r){if(this._listeners[n])throw new RangeError("there is already a listener for "+n);if(typeof r!="function")throw new TypeError("callback argument must be a function");this._listeners[n]=r},e.prototype._send=function(n,r,s){s===void 0?s=[]:Array.isArray(s)||(s=[s]),self.postMessage({id:n,data:r},s)},e.prototype._trigger=function(n,r){if(!this._listeners[n])throw new Error("event "+n+" is not defined");this._listeners[n].apply(null,r)};var t=new e;self.onmessage=function(n){switch(n.data.action){case"exec":n.data.args.unshift(function(r,s){t._send(n.data.id,r,s)}),t._trigger(n.data.event,n.data.args);break;case"ping":t._send(n.data.id,"pong");break;default:throw new Error("unexpected action: "+n.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(t,n){var r=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(n)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(r)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,t){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var n=t.deps;typeof n=="string"&&(n=[n]),Array.isArray(n)||(n=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(n)}WorkerManager.prototype._init=function(e){for(var t=workerTemplate.newWorkerURL(this._workerCode,e),n=0;n<this._numWorkers;n++){var r=new Worker(t);r.onmessage=this._onmessage.bind(this,r),r.onerror=this._onerror.bind(this,r),r.running=!1,r.id=n,this._workers.set(r,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var n=this._workers.get(e);n&&n[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var n=this._workers.get(e);n&&n[0](t.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var t=0;t<this._waiting.length;t++){var n=this._waiting[t];if(!(typeof n[4]=="number"&&n[4]!==e.id)){this._waiting.splice(t,1),e.postMessage({action:"exec",event:n[0],args:n[1]},n[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,n[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,t){if(this._terminated)throw new Error("Cannot post (terminated)");var n=[];for(var r of this._workers.keys())n.push(this.post(e,t,[],r.id));return Promise.all(n)};WorkerManager.prototype.post=function(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);var s=this;return new Promise(function(l,p){if(s._terminated)throw new Error("Cannot post (terminated)");s._waiting.push([e,t,n,[l,p],r]),s._exec()})};var src=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,t,n){t=Object.assign({},defaultOptions,t);const r=this.manager;return Array.isArray(e)?Promise.all(e.map(function(s){const l=runOnce(r,s,t);return typeof n=="function"&&l.then(n),l})):runOnce(r,e,t)}function runOnce(e,t,n){return e.post("data",[t,n]).then(function(r){for(let s in r)r[s]=new Image$1(r[s]);return r})}function work(){worker.on("data",function(e,t,n){t=new IJS(t);const r={},s=[],l=t.grey(),p=l.sobelFilter();_e("sobel",p);const o=p.level().mask({threshold:n.threshold});_e("mask",o);const x=p.getRoiManager();x.fromMask(o);const M=x.getMask(n.roi);_e("realMask",M);const P=l.getPixelsGrid({sampling:n.sampling,mask:M}),he=t.getBackground(P.xyS,P.zS,n.regression);_e("background",he);const nt=t.subtract(he);r.result=nt,s.push(nt.data.buffer),e(r,s);function _e(Bt,Fn){n.include.includes(Bt)&&(r[Bt]=Fn,s.push(Fn.data.buffer))}})}const background={run,work};function extend$3(e){e.extendMethod("background",background)}let Worker$1=class QE{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,n){let r,s,l={};function p(...o){return r||(this.checkUrl(),s=this.url,r=new WorkerManager$1(n.work,{deps:s}),l.manager=r),n.run.call(l,...o)}p.reset=function(){r&&(r.terminate(),r=new WorkerManager$1(n.work,{deps:s}),l.manager=r)},QE.prototype[t]=p}};extend$3(Worker$1);function getTileInfo(e,t,n,r,s,l,p){let o={},x;n===!1&&(x=tilebelt$1.pointToTile(e,t,l),r=x[0],s=x[1]);let M=40075016686e-3*Math.abs(Math.cos(t))/Math.pow(2,l),P=M/512;o.z=l,o.x=r,o.y=s,o.pointLng=e,o.pointLat=t,o.tileWidthInMeters=M,o.metersPerPixel=P,o.mapboxTileName=o.z+"-"+o.x+"-"+o.y,o.tile=[o.x,o.y,o.z],n===!1?o.bbox=tilebelt$1.tileToBBOX(o.tile):o.bbox=p,o.polygon_bb=getTileGeoJsonBB(o.bbox),o.area_bb=getAreaBB(o.bbox);const he=new mapboxgl.LngLatBounds(o.bbox);o.bboxCT=he.getCenter(),o.bboxSW=he.getSouthWest(),o.bboxNE=he.getNorthEast(),o.bboxNW=he.getNorthWest(),o.bboxSE=he.getSouthEast(),o.bboxW=he.getWest().toFixed(5),o.bboxS=he.getSouth().toFixed(5),o.bboxE=he.getEast().toFixed(5),o.bboxN=he.getNorth().toFixed(5),o.topLeft=o.bboxNW,o.bottomLeft=o.bboxSW,o.topRight=o.bboxNE,o.bottomRight=o.bboxSE,o.center=o.bboxCT;const nt=point([o.bboxNE.lng,o.bboxNE.lat]),_e=point([o.bboxSW.lng,o.bboxNE.lat]),Bt=point([o.bboxNE.lng,o.bboxSW.lat]),Fn=point([o.bboxSW.lng,o.bboxSW.lat]),yr=midpoint(nt,Bt),Io=midpoint(_e,Fn);return o.distance=distance(yr,Io,"kilometers").toFixed(2),o.maxPngValue=65535,o.rgbFileName="terrain-rgb-"+o.mapboxTileName+".png",o.thirtyTwoFileName="thirtytwo-"+o.mapboxTileName+".png",o.tileInfoFileName="tile-info-"+o.mapboxTileName+".json",o.geoJsonFileName="geojson-"+o.mapboxTileName+".json",o}function getAreaBB(e){let t=bboxPolygon(e);return area(t)}function getTileGeoJsonBB(e){let t=bboxPolygon(e);return{type:"Feature",geometry:{type:t.geometry.type,coordinates:t.geometry.coordinates}}}function getFeaturesFromBB(e,t,n){t.swPt=e.project(t.bboxSW),t.nePt=e.project(t.bboxNE),t.nwPt=e.project(t.bboxNW),t.sePt=e.project(t.bboxSE);let r=e.queryRenderedFeatures([t.swPt,t.nePt]);return n===!0&&(r=getUniqueFeatures(r)),r}function getUniqueFeatures(e){const t=new Set,n=[];for(const r of e){const s=r.properties.name,l=r.geometry.type;let p=s+"-"+l;t.has(p)||(t.add(p),n.push(r))}return n}async function loadImageFromArray(e){try{return await Image$1.load(e)}catch(t){console.log(t)}}function getHeightFromRgb(e,t,n){return-1e4+(e*256*256+t*256+n)*.1}function getHeightArray(e){let t=[],n=e.getPixelsArray();for(const r of n){let s=r[0],l=r[1],p=r[2],o=getHeightFromRgb(s,l,p);o=parseFloat(o),t.push(o)}return t}async function downloadTerrainRgb(e){return await(await fetch(e)).arrayBuffer()}async function unrealRemoteControl(e,t){let n,r={},s="";const l={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{n=await fetch(t,l)}catch(p){s=p}return r.response=n,r.error=s,r}async function getMapboxTerrainRgb(e){let t,n;return t=await downloadTerrainRgb(e),n=await loadImageFromArray(t),idbKeyval.set("rgbImageArrayBuffer",t),n}function convertImage(e,t,n,r,s){return new Image$1(e,t,n,{kind:s,bitDepth:r})}function createHeightMapImage(e,t,n){let r={},s=getHeightArray(e);idbKeyval.set("decodedHeightArray",s);let l=convertImage(e.width,e.height,s,t,n);return r.minElevation=l.min[0],r.maxElevation=l.max[0],r.image=l,r.decodedHeightArray=s,r}const mapUtils={getTileInfo,getFeaturesFromBB,getMapboxTerrainRgb,createHeightMapImage,loadImageFromArray,unrealRemoteControl,downloadTerrainRgb,convertImage,getTileGeoJsonBB};function mitt(e){return{all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map(function(s){s(n)}),(r=e.get("*"))&&r.slice().map(function(s){s(t,n)})}}}const emitter=mitt();var immutable=extend$2,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$2(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}var fuzzy$1={exports:{}};(function(e,t){(function(){var n={};e.exports=n,n.simpleFilter=function(r,s){return s.filter(function(l){return n.test(r,l)})},n.test=function(r,s){return n.match(r,s)!==null},n.match=function(r,s,l){l=l||{};var p=0,o=[],x=s.length,M=0,P=0,he=l.pre||"",nt=l.post||"",_e=l.caseSensitive&&s||s.toLowerCase(),Bt;r=l.caseSensitive&&r||r.toLowerCase();for(var Fn=0;Fn<x;Fn++)Bt=s[Fn],_e[Fn]===r[p]?(Bt=he+Bt+nt,p+=1,P+=1+P):P=0,M+=P,o[o.length]=Bt;return p===r.length?(M=_e===r?1/0:M,{rendered:o.join(""),score:M}):null},n.filter=function(r,s,l){return!s||s.length===0?[]:typeof r!="string"?s:(l=l||{},s.reduce(function(p,o,x,M){var P=o;l.extract&&(P=l.extract(o));var he=n.match(r,P,l);return he!=null&&(p[p.length]={string:he.rendered,score:he.score,index:x,original:o}),p},[]).sort(function(p,o){var x=o.score-p.score;return x||p.index-o.index}))}})()})(fuzzy$1);var fuzzyExports=fuzzy$1.exports,List$1=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(e){this.items.push(e)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};List$1.prototype.drawItem=function(e,t){var n=document.createElement("li"),r=document.createElement("a");t&&(n.className+=" active"),r.innerHTML=e.string,n.appendChild(r),this.element.appendChild(n),n.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),n.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};List$1.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};List$1.prototype.move=function(e){this.active=e,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzyExports,List=list,Suggestions$1=function(e,t,n){return n=n||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=e,this.data=t||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(r){this.handleKeyUp(r.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(r){this.handleKeyDown(r)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(r){this.handlePaste(r)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(t){for(var n=0;n<t.length&&(this.list.add(t[n]),n!==this.options.limit-1);n++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(e){this.data=e,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(e){return e=e.toLowerCase(),e};Suggestions$1.prototype.match=function(e,t){return e.indexOf(t)>-1};Suggestions$1.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(r){return this.getItemValue(r)}.bind(this)},n;this.options.filter?(n=fuzzy.filter(this.query,this.data,t),n=n.map(function(r){return{original:r.original,string:this.render(r.original,r.string)}}.bind(this))):n=this.data.map(function(r){var s=this.render(r);return{original:r,string:s}}.bind(this)),e(n)};Suggestions$1.prototype.getItemValue=function(e){return e};Suggestions$1.prototype.render=function(e,t){if(t)return t;for(var n=e.original?this.getItemValue(e.original):this.getItemValue(e),r=this.normalize(n),s=r.lastIndexOf(this.query);s>-1;){var l=s+this.query.length;n=n.slice(0,s)+"<strong>"+n.slice(s,l)+"</strong>"+n.slice(l),s=r.slice(0,s).lastIndexOf(this.query)}return n};Suggestions$1.prototype.renderError=function(e){this.list.drawError(e)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$1(e,t,n){var r,s,l,p,o,x,M=0,P=!1,he=!1,nt=!0;if(typeof e!="function")throw new TypeError(FUNC_ERROR_TEXT);t=toNumber(t)||0,isObject(n)&&(P=!!n.leading,he="maxWait"in n,l=he?nativeMax(toNumber(n.maxWait)||0,t):l,nt="trailing"in n?!!n.trailing:nt);function _e(lh){var ch=r,Zu=s;return r=s=void 0,M=lh,p=e.apply(Zu,ch),p}function Bt(lh){return M=lh,o=setTimeout(Io,t),P?_e(lh):p}function Fn(lh){var ch=lh-x,Zu=lh-M,th=t-ch;return he?nativeMin(th,l-Zu):th}function yr(lh){var ch=lh-x,Zu=lh-M;return x===void 0||ch>=t||ch<0||he&&Zu>=l}function Io(){var lh=now();if(yr(lh))return rl(lh);o=setTimeout(Io,Fn(lh))}function rl(lh){return o=void 0,nt&&r?_e(lh):(r=s=void 0,p)}function Co(){o!==void 0&&clearTimeout(o),M=0,r=x=s=o=void 0}function as(){return o===void 0?p:rl(now())}function Js(){var lh=now(),ch=yr(lh);if(r=arguments,s=this,x=lh,ch){if(o===void 0)return Bt(x);if(he)return o=setTimeout(Io,t),_e(x)}return o===void 0&&(o=setTimeout(Io,t)),p}return Js.cancel=Co,Js.flush=as,Js}function isObject(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function isObjectLike(e){return!!e&&typeof e=="object"}function isSymbol(e){return typeof e=="symbol"||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if(typeof e=="number")return e;if(isSymbol(e))return NAN;if(isObject(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(reTrim,"");var n=reIsBinary.test(e);return n||reIsOctal.test(e)?freeParseInt(e.slice(2),n?2:8):reIsBadHex.test(e)?NAN:+e}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(t,n,r){return Function.prototype.apply.call(t,n,r)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(t){return t!==t};function EventEmitter$3(){EventEmitter$3.init.call(this)}events$1.exports=EventEmitter$3;events$1.exports.once=once;EventEmitter$3.EventEmitter=EventEmitter$3;EventEmitter$3.prototype._events=void 0;EventEmitter$3.prototype._eventsCount=0;EventEmitter$3.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter$3,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter$3.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$3.prototype.setMaxListeners=function e(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter$3.defaultMaxListeners:e._maxListeners}EventEmitter$3.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter$3.prototype.emit=function e(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var s=t==="error",l=this._events;if(l!==void 0)s=s&&l.error===void 0;else if(!s)return!1;if(s){var p;if(n.length>0&&(p=n[0]),p instanceof Error)throw p;var o=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw o.context=p,o}var x=l[t];if(x===void 0)return!1;if(typeof x=="function")ReflectApply(x,this,n);else for(var M=x.length,P=arrayClone(x,M),r=0;r<M;++r)ReflectApply(P[r],this,n);return!0};function _addListener(e,t,n,r){var s,l,p;if(checkListener(n),l=e._events,l===void 0?(l=e._events=Object.create(null),e._eventsCount=0):(l.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),l=e._events),p=l[t]),p===void 0)p=l[t]=n,++e._eventsCount;else if(typeof p=="function"?p=l[t]=r?[n,p]:[p,n]:r?p.unshift(n):p.push(n),s=_getMaxListeners(e),s>0&&p.length>s&&!p.warned){p.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=p.length,ProcessEmitWarning(o)}return e}EventEmitter$3.prototype.addListener=function e(t,n){return _addListener(this,t,n,!1)};EventEmitter$3.prototype.on=EventEmitter$3.prototype.addListener;EventEmitter$3.prototype.prependListener=function e(t,n){return _addListener(this,t,n,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},s=onceWrapper.bind(r);return s.listener=n,r.wrapFn=s,s}EventEmitter$3.prototype.once=function e(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this};EventEmitter$3.prototype.prependOnceListener=function e(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this};EventEmitter$3.prototype.removeListener=function e(t,n){var r,s,l,p,o;if(checkListener(n),s=this._events,s===void 0)return this;if(r=s[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(l=-1,p=r.length-1;p>=0;p--)if(r[p]===n||r[p].listener===n){o=r[p].listener,l=p;break}if(l<0)return this;l===0?r.shift():spliceOne(r,l),r.length===1&&(s[t]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",t,o||n)}return this};EventEmitter$3.prototype.off=EventEmitter$3.prototype.removeListener;EventEmitter$3.prototype.removeAllListeners=function e(t){var n,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var l=Object.keys(r),p;for(s=0;s<l.length;++s)p=l[s],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(t,n[s]);return this};function _listeners(e,t,n){var r=e._events;if(r===void 0)return[];var s=r[t];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?unwrapListeners(s):arrayClone(s,s.length)}EventEmitter$3.prototype.listeners=function e(t){return _listeners(this,t,!0)};EventEmitter$3.prototype.rawListeners=function e(t){return _listeners(this,t,!1)};EventEmitter$3.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):listenerCount.call(e,t)};EventEmitter$3.prototype.listenerCount=listenerCount;function listenerCount(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}EventEmitter$3.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function once(e,t){return new Promise(function(n,r){function s(p){e.removeListener(t,l),r(p)}function l(){typeof e.removeListener=="function"&&e.removeListener("error",s),n([].slice.call(arguments))}eventTargetAgnosticAddListener(e,t,l,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(e,s,{once:!0})})}function addErrorHandlerIfEventEmitter(e,t,n){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",t,n)}function eventTargetAgnosticAddListener(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function s(l){r.once&&e.removeEventListener(t,s),n(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var eventsExports=events$1.exports;const EventEmitter$4=getDefaultExportFromCjs(eventsExports);var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam$1(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink$1(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],r=t[2].split(";"),s=null,l=r.reduce(function(p,o){var x=parseParam$1(o);return x?x.key==="rel"?(s||(s=x.value),p):(p[x.key]=x.value,p):p},{});return s?{url:n,rel:s,params:l}:null}function parseLinkHeader$3(e){return e?e.split(/,\s*</).reduce(function(t,n){var r=parseLink$1(n);if(!r)return t;var s=r.rel.split(/\s+/);return s.forEach(function(l){t[l]||(t[l]={url:r.url,params:r.params})}),t},{}):{}}var parseLinkHeader_1$1=parseLinkHeader$3,parseLinkHeader$2=parseLinkHeader_1$1;function MapiResponse$3(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader$2(this.headers.link)}MapiResponse$3.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$3.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse$1=MapiResponse$3,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$3(e){var t=e.type||constants$8.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var r=e.message||null;r||(typeof n=="string"?r=n:n&&typeof n.message=="string"?r=n.message:t===constants$8.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}var mapiError$1=MapiError$3;function parseSingleHeader$1(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),r=e.substring(t+1).trim();return{name:n,value:r}}function parseHeaders$3(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var r=parseSingleHeader$1(n);t[r.name]=r.value}),t}var parseHeaders_1$1=parseHeaders$3,MapiResponse$2=mapiResponse$1,MapiError$2=mapiError$1,constants$7=constants$9,parseHeaders$2=parseHeaders_1$1,requestsUnderway$1={};function browserAbort$1(e){var t=requestsUnderway$1[e.id];t&&(t.abort(),delete requestsUnderway$1[e.id])}function createResponse$1(e,t){return new MapiResponse$2(e,{body:t.response,headers:parseHeaders$2(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent$1(e){var t=e.total,n=e.loaded,r=100*n/t;return{total:t,transferred:n,percent:r}}function sendRequestXhr$1(e,t){return new Promise(function(n,r){t.onprogress=function(p){e.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent$1(p))};var s=e.file;s&&(t.upload.onprogress=function(p){e.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent$1(p))}),t.onerror=function(p){r(p)},t.onabort=function(){var p=new MapiError$2({request:e,type:constants$7.ERROR_REQUEST_ABORTED});r(p)},t.onload=function(){if(delete requestsUnderway$1[e.id],t.status<200||t.status>=400){var p=new MapiError$2({request:e,body:t.response,statusCode:t.status});r(p);return}n(t)};var l=e.body;typeof l=="string"?t.send(l):l?t.send(JSON.stringify(l)):s?t.send(s):t.send(),requestsUnderway$1[e.id]=t}).then(function(n){return createResponse$1(e,n)})}function createRequestXhr$1(e,t){var n=e.url(t),r=new window.XMLHttpRequest;return r.open(e.method,n),Object.keys(e.headers).forEach(function(s){r.setRequestHeader(s,e.headers[s])}),r}function browserSend$1(e){return Promise.resolve().then(function(){var t=createRequestXhr$1(e,e.client.accessToken);return sendRequestXhr$1(e,t)})}var browserLayer$1={browserAbort:browserAbort$1,sendRequestXhr:sendRequestXhr$1,browserSend:browserSend$1,createRequestXhr:createRequestXhr$1},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */base64$1.exports;(function(e,t){(function(n){var r=t,s=e&&e.exports==r&&e,l=typeof commonjsGlobal=="object"&&commonjsGlobal;(l.global===l||l.window===l)&&(n=l);var p=function(Bt){this.message=Bt};p.prototype=new Error,p.prototype.name="InvalidCharacterError";var o=function(Bt){throw new p(Bt)},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=/[\t\n\f\r ]/g,P=function(Bt){Bt=String(Bt).replace(M,"");var Fn=Bt.length;Fn%4==0&&(Bt=Bt.replace(/==?$/,""),Fn=Bt.length),(Fn%4==1||/[^+a-zA-Z0-9/]/.test(Bt))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var yr=0,Io,rl,Co="",as=-1;++as<Fn;)rl=x.indexOf(Bt.charAt(as)),Io=yr%4?Io*64+rl:rl,yr++%4&&(Co+=String.fromCharCode(255&Io>>(-2*yr&6)));return Co},he=function(Bt){Bt=String(Bt),/[^\0-\xFF]/.test(Bt)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var Fn=Bt.length%3,yr="",Io=-1,rl,Co,as,Js,lh=Bt.length-Fn;++Io<lh;)rl=Bt.charCodeAt(Io)<<16,Co=Bt.charCodeAt(++Io)<<8,as=Bt.charCodeAt(++Io),Js=rl+Co+as,yr+=x.charAt(Js>>18&63)+x.charAt(Js>>12&63)+x.charAt(Js>>6&63)+x.charAt(Js&63);return Fn==2?(rl=Bt.charCodeAt(Io)<<8,Co=Bt.charCodeAt(++Io),Js=rl+Co,yr+=x.charAt(Js>>10)+x.charAt(Js>>4&63)+x.charAt(Js<<2&63)+"="):Fn==1&&(Js=Bt.charCodeAt(Io),yr+=x.charAt(Js>>2)+x.charAt(Js<<4&63)+"=="),yr},nt={encode:he,decode:P,version:"0.1.0"};if(r&&!r.nodeType)if(s)s.exports=nt;else for(var _e in nt)nt.hasOwnProperty(_e)&&(r[_e]=nt[_e]);else n.base64=nt})(commonjsGlobal)})(base64$1,base64$1.exports);var base64Exports=base64$1.exports,base64=base64Exports,tokenCache={};function parseToken$4(e){if(tokenCache[e])return tokenCache[e];var t=e.split("."),n=t[0],r=t[1];if(!r)throw new Error("Invalid token");var s=parsePaylod(r),l={usage:n,user:s.u};return has(s,"a")&&(l.authorization=s.a),has(s,"exp")&&(l.expires=s.exp*1e3),has(s,"iat")&&(l.created=s.iat*1e3),has(s,"scopes")&&(l.scopes=s.scopes),has(s,"client")&&(l.client=s.client),has(s,"ll")&&(l.lastLogin=s.ll),has(s,"iu")&&(l.impersonator=s.iu),tokenCache[e]=l,l}function parsePaylod(e){try{return JSON.parse(base64.decode(e))}catch{throw new Error("Invalid token")}}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var parseMapboxToken=parseToken$4,eventemitter3={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(x,M,P){this.fn=x,this.context=M,this.once=P||!1}function l(x,M,P,he,nt){if(typeof P!="function")throw new TypeError("The listener must be a function");var _e=new s(P,he||x,nt),Bt=n?n+M:M;return x._events[Bt]?x._events[Bt].fn?x._events[Bt]=[x._events[Bt],_e]:x._events[Bt].push(_e):(x._events[Bt]=_e,x._eventsCount++),x}function p(x,M){--x._eventsCount===0?x._events=new r:delete x._events[M]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var M=[],P,he;if(this._eventsCount===0)return M;for(he in P=this._events)t.call(P,he)&&M.push(n?he.slice(1):he);return Object.getOwnPropertySymbols?M.concat(Object.getOwnPropertySymbols(P)):M},o.prototype.listeners=function(M){var P=n?n+M:M,he=this._events[P];if(!he)return[];if(he.fn)return[he.fn];for(var nt=0,_e=he.length,Bt=new Array(_e);nt<_e;nt++)Bt[nt]=he[nt].fn;return Bt},o.prototype.listenerCount=function(M){var P=n?n+M:M,he=this._events[P];return he?he.fn?1:he.length:0},o.prototype.emit=function(M,P,he,nt,_e,Bt){var Fn=n?n+M:M;if(!this._events[Fn])return!1;var yr=this._events[Fn],Io=arguments.length,rl,Co;if(yr.fn){switch(yr.once&&this.removeListener(M,yr.fn,void 0,!0),Io){case 1:return yr.fn.call(yr.context),!0;case 2:return yr.fn.call(yr.context,P),!0;case 3:return yr.fn.call(yr.context,P,he),!0;case 4:return yr.fn.call(yr.context,P,he,nt),!0;case 5:return yr.fn.call(yr.context,P,he,nt,_e),!0;case 6:return yr.fn.call(yr.context,P,he,nt,_e,Bt),!0}for(Co=1,rl=new Array(Io-1);Co<Io;Co++)rl[Co-1]=arguments[Co];yr.fn.apply(yr.context,rl)}else{var as=yr.length,Js;for(Co=0;Co<as;Co++)switch(yr[Co].once&&this.removeListener(M,yr[Co].fn,void 0,!0),Io){case 1:yr[Co].fn.call(yr[Co].context);break;case 2:yr[Co].fn.call(yr[Co].context,P);break;case 3:yr[Co].fn.call(yr[Co].context,P,he);break;case 4:yr[Co].fn.call(yr[Co].context,P,he,nt);break;default:if(!rl)for(Js=1,rl=new Array(Io-1);Js<Io;Js++)rl[Js-1]=arguments[Js];yr[Co].fn.apply(yr[Co].context,rl)}}return!0},o.prototype.on=function(M,P,he){return l(this,M,P,he,!1)},o.prototype.once=function(M,P,he){return l(this,M,P,he,!0)},o.prototype.removeListener=function(M,P,he,nt){var _e=n?n+M:M;if(!this._events[_e])return this;if(!P)return p(this,_e),this;var Bt=this._events[_e];if(Bt.fn)Bt.fn===P&&(!nt||Bt.once)&&(!he||Bt.context===he)&&p(this,_e);else{for(var Fn=0,yr=[],Io=Bt.length;Fn<Io;Fn++)(Bt[Fn].fn!==P||nt&&!Bt[Fn].once||he&&Bt[Fn].context!==he)&&yr.push(Bt[Fn]);yr.length?this._events[_e]=yr.length===1?yr[0]:yr:p(this,_e)}return this},o.prototype.removeAllListeners=function(M){var P;return M?(P=n?n+M:M,this._events[P]&&p(this,P)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function encodeArray$1(e){return e.map(encodeURIComponent).join(",")}function encodeValue$1(e){return Array.isArray(e)?encodeArray$1(e):encodeURIComponent(String(e))}function appendQueryParam$1(e,t,n){if(n===!1||n===null)return e;var r=/\?/.test(e)?"&":"?",s=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(s+="="+encodeValue$1(n)),""+e+r+s}function appendQueryObject$1(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(r){var s=t[r];s!==void 0&&(Array.isArray(s)&&(s=s.filter(function(l){return l!=null}).join(",")),n=appendQueryParam$1(n,r,s))}),n}function prependOrigin$1(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function interpolateRouteParams$1(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,r){var s=t[r];if(s===void 0)throw new Error("Unspecified route parameter "+r);var l=encodeValue$1(s);return"/"+l}):e}var urlUtils$3={appendQueryObject:appendQueryObject$1,appendQueryParam:appendQueryParam$1,prependOrigin:prependOrigin$1,interpolateRouteParams:interpolateRouteParams$1},parseToken$3=parseMapboxToken,xtend$6=immutable,EventEmitter$2=eventemitter3Exports,urlUtils$2=urlUtils$3,constants$6=constants$9,requestId$1=1;function MapiRequest$3(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var r=xtend$6(n,t.headers),s=Object.keys(r).reduce(function(l,p){return l[p.toLowerCase()]=r[p],l},{});this.id=requestId$1++,this._options=t,this.emitter=new EventEmitter$2,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=s}MapiRequest$3.prototype.url=function e(t){var n=urlUtils$2.prependOrigin(this.path,this.origin);n=urlUtils$2.appendQueryObject(n,this.query);var r=this.params,s=t??this.client.accessToken;if(s){n=urlUtils$2.appendQueryParam(n,"access_token",s);var l=parseToken$3(s).user;r=xtend$6({ownerId:l},r)}return n=urlUtils$2.interpolateRouteParams(n,r),n};MapiRequest$3.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(constants$6.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(constants$6.EVENT_ERROR,n),n})};MapiRequest$3.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$3.prototype.eachPage=function e(t){var n=this;function r(p){function o(){delete n._nextPageRequest;var x=p.nextPage();x&&(n._nextPageRequest=x,l(x))}t(null,p,o)}function s(p){t(p,null,function(){})}function l(p){p.send().then(r,s)}l(this)};MapiRequest$3.prototype.clone=function e(){return this._extend()};MapiRequest$3.prototype._extend=function e(t){var n=xtend$6(this._options,t);return new MapiRequest$3(this.client,n)};var mapiRequest$1=MapiRequest$3,parseToken$2=parseMapboxToken,MapiRequest$2=mapiRequest$1,constants$5=constants$9;function MapiClient$5(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken$2(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$5.API_ORIGIN}MapiClient$5.prototype.createRequest=function e(t){return new MapiRequest$2(this,t)};var mapiClient$1=MapiClient$5,browser$1=browserLayer$1,MapiClient$4=mapiClient$1;function BrowserClient$1(e){MapiClient$4.call(this,e)}BrowserClient$1.prototype=Object.create(MapiClient$4.prototype);BrowserClient$1.prototype.constructor=BrowserClient$1;BrowserClient$1.prototype.sendRequest=browser$1.browserSend;BrowserClient$1.prototype.abortRequest=browser$1.browserAbort;function createBrowserClient$1(e){return new BrowserClient$1(e)}var browserClient$1=createBrowserClient$1,client=browserClient$1,mapboxSdk=client,toString=Object.prototype.toString,isPlainObj=function(e){var t;return toString.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$5=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$5={};v$5.assert=function(e,t){return t=t||{},function(n){var r=validate(e,n);if(r){var s=processMessage(r,t);throw t.apiName&&(s=t.apiName+": "+s),new Error(s)}}};v$5.shape=function e(t){var n=objectEntries(t);return function(s){var l=validate(v$5.plainObject,s);if(l)return l;for(var p,o,x=[],M=0;M<n.length;M++)p=n[M].key,o=n[M].value,l=validate(o,s[p]),l&&x.push([p].concat(l));return x.length<2?x[0]:function(P){x=x.map(function(_e){var Bt=_e[0],Fn=processMessage(_e,P).split(`
`).join(NEWLINE_INDENT);return"- "+Bt+": "+Fn});var he=P.path.join("."),nt=he===DEFAULT_ERROR_PATH?"":" of "+he;return"The following properties"+nt+" have invalid values:"+NEWLINE_INDENT+x.join(NEWLINE_INDENT)}}};v$5.strictShape=function e(t){var n=v$5.shape(t);return function(s){var l=n(s);if(l)return l;var p=Object.keys(s).reduce(function(o,x){return t[x]===void 0&&o.push(x),o},[]);if(p.length!==0)return function(){return"The following keys are invalid: "+p.join(", ")}}};v$5.arrayOf=function e(t){return createArrayValidator(t)};v$5.tuple=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(t)};function createArrayValidator(e){var t=Array.isArray(e),n=function(r){return t?e[r]:e};return function(s){var l=validate(v$5.plainArray,s);if(l)return l;if(t&&s.length!==e.length)return"an array with "+e.length+" items";for(var p=0;p<s.length;p++)if(l=validate(n(p),s[p]),l)return[p].concat(l)}}v$5.required=function e(t){function n(r){return r==null?function(s){return formatErrorMessage(s,isArrayCulprit(s.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return n.__required=!0,n};v$5.oneOfType=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(r){var s=t.map(function(l){return validate(l,r)}).filter(Boolean);if(s.length===t.length)return s.every(function(l){return l.length===1&&typeof l[0]=="string"})?orList(s.map(function(l){return l[0]})):s.reduce(function(l,p){return p.length>l.length?p:l})}};v$5.equal=function e(t){return function(r){if(r!==t)return JSON.stringify(t)}};v$5.oneOf=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=t.map(function(r){return v$5.equal(r)});return v$5.oneOfType.apply(this,n)};v$5.range=function e(t){var n=t[0],r=t[1];return function(l){var p=validate(v$5.number,l);if(p||l<n||l>r)return"number between "+n+" & "+r+" (inclusive)"}};v$5.any=function e(){};v$5.boolean=function e(t){if(typeof t!="boolean")return"boolean"};v$5.number=function e(t){if(typeof t!="number")return"number"};v$5.plainArray=function e(t){if(!Array.isArray(t))return"array"};v$5.plainObject=function e(t){if(!isPlainObject(t))return"object"};v$5.string=function e(t){if(typeof t!="string")return"string"};v$5.func=function e(t){if(typeof t!="function")return"function"};function validate(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var n=e(t);if(n)return Array.isArray(n)?n:[n]}}function processMessage(e,t){var n=e.length,r=e[n-1],s=e.slice(0,n-1);return s.length===0&&(s=[DEFAULT_ERROR_PATH]),t=xtend$5(t,{path:s}),typeof r=="function"?r(t):formatErrorMessage(t,prettifyResult(r))}function orList(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function prettifyResult(e){return"must be "+addArticle(e)+"."}function addArticle(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function formatErrorMessage(e,t){var n=isArrayCulprit(e.path),r=e.path.join(".")+" "+t,s=n?"Item at position ":"";return s+r}function isArrayCulprit(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function objectEntries(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}v$5.validate=validate;v$5.processMessage=processMessage;var lib$1=v$5,xtend$4=immutable,v$4=lib$1;function file$1(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape$1(e,t){return v$4.assert(v$4.strictShape(e),t)}function date$1(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function coordinates$2(e){return v$4.tuple(v$4.number,v$4.number)(e)}var validator$1=xtend$4(v$4,{file:file$1,date:date$1,coordinates:coordinates$2,assertShape:assertShape$1});function pick$3(e,t){var n=function(r,s){return t.indexOf(r)!==-1&&s!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(r){return n(r,e[r])}).reduce(function(r,s){return r[s]=e[s],r},{})}var pick_1$1=pick$3;function objectMap$3(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=t(r,e[r]),n},{})}var objectMap_1$1=objectMap$3,objectMap$2=objectMap_1$1;function stringifyBoolean$1(e){return objectMap$2(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}var stringifyBooleans$3=stringifyBoolean$1,MapiClient$3=mapiClient$1,createClient$1=browserClient$1;function createServiceFactory$3(e){return function(t){var n;MapiClient$3.prototype.isPrototypeOf(t)?n=t:n=createClient$1(t);var r=Object.create(e);return r.client=n,r}}var createServiceFactory_1$1=createServiceFactory$3,xtend$3=immutable,v$3=validator$1,pick$2=pick_1$1,stringifyBooleans$2=stringifyBooleans$3,createServiceFactory$2=createServiceFactory_1$1,Geocoding$1={},featureTypes$1=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding$1.forwardGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.string),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),proximity:v$3.oneOf(v$3.coordinates,"ip"),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),autocomplete:v$3.boolean,bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),routing:v$3.boolean,fuzzyMatch:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};Geocoding$1.reverseGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.coordinates),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),reverseMode:v$3.oneOf("distance","score"),routing:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};var geocoding$2=createServiceFactory$2(Geocoding$1);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=e=>crypto.getRandomValues(new Uint8Array(e)),customRandom=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return(l=t)=>{let p="";for(;;){let o=n(s),x=s;for(;x--;)if(p+=e[o[x]&r]||"",p.length===l)return p}}},customAlphabet=(e,t=21)=>customRandom(e,t,random),nanoid$1=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");const index_browser=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet,customRandom,nanoid:nanoid$1,random,urlAlphabet},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(index_browser);var nanoid=require$$0.nanoid;function MapboxEventManager$1(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(e,t){var n=this.getSelectedIndex(e,t),r=this.getEventPayload("search.select",t);if(r.resultIndex=n,r.resultPlaceName=e.place_name,r.resultId=e.id,!(n===this.lastSentIndex&&r.queryString===this.lastSentInput||n==-1)&&(this.lastSentIndex=n,this.lastSentInput=r.queryString,!!r.queryString))return this.push(r)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",t);if(n.lastAction=e.key,!!n.queryString)return this.push(n)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var n=this.getRequestOptions(e);this.request(n,function(r){if(r)return this.handleError(r,t);if(t)return t()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t){var n;t.options.proximity?typeof t.options.proximity=="object"?n=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?n=[999,999]:n=t.options.proximity:n=null;var r=t._map?t._map.getZoom():void 0,s={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:n,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:r,keyboardLocale:this.locale};return e==="search.select"?s.queryString=t.inputString:e!="search.select"&&t._inputEl?s.queryString=t._inputEl.value:s.queryString=t.inputString,s},request:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},n.open(e.method,e.host+"/"+e.path,!0);for(var r in e.headers){var s=e.headers[r];n.setRequestHeader(r,s)}n.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var n=t._typeahead.data,r=e.id,s=n.map(function(p){return p.id}),l=s.indexOf(r);return l}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},localization$1={placeholder},subtag$1={exports:{}};(function(e){(function(t,n,r){e.exports?e.exports=r():t[n]=r()})(commonjsGlobal,"subtag",function(){var t="",n=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(x){return x.match(n)||[]}function s(x){return r(x).filter(function(M,P){return M&&P})}function l(x){return x=r(x),{language:x[1]||t,extlang:x[2]||t,script:x[3]||t,region:x[4]||t}}function p(x,M,P){Object.defineProperty(x,M,{value:P,enumerable:!0})}function o(x,M,P){function he(nt){return r(nt)[x]||t}p(he,"pattern",M),p(l,P,he)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(l,"split",s),l})})(subtag$1);var subtagExports=subtag$1.exports;function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,n){window.navigator.geolocation.getCurrentPosition(t,n,e)})}};var geolocation$1=Geolocation$1;function transformFeatureToGeolocationText(e,t){const n=getAddressInfo(e),r=["address","street","place","country"];var s;if(typeof t=="function")return t(n);const l=r.indexOf(t);return l===-1?s=r:s=r.slice(l),s.reduce(function(p,o){return n[o]?(p!==""&&(p=p+", "),p+n[o]):p},"")}function getAddressInfo(e){const t=e.address||"",n=e.text||"",r=e.place_name||"",l={address:r.split(",")[0],houseNumber:t,street:n,placeName:r};return e.context.forEach(function(p){const o=p.id.split(".")[0];l[o]=p.text}),l}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$1={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter$1=eventsExports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$2,MapboxEventManager=events,localization=localization$1,subtag=subtagExports,Geolocation=geolocation$1,utils=utils$1;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function MapboxGeocoder(e){this._eventEmitter=new EventEmitter$1,this.options=extend({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(n,r){if(!document.body.contains(r))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=n.onAdd();r.appendChild(s)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element ",e,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(M){this.eventManager.keyevent(M,this)}.bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),t.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var l=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(l),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var p=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),p.getItemValue=this.options.getItemValue;var o=p.list.draw,x=this._footerNode=getFooterNode();return p.list.draw=function(){o.call(this),x.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),x.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(x)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const n={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const r=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(r),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(n).send().then(function(r){const s=r.body.features[0];if(s){const l=utils.transformFeatureToGeolocationText(s,this.options.addressAccuracy);this._setInputValue(l),s.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:s})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=t,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,n=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var r=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,s=r?r.value:"";if(!s)return this.fresh=!0,e.keyCode!==n&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[n,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&r.value.length>=this.options.minLength&&this._geocode(r.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&exceptions[e.properties.short_code])t=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[e.properties.short_code].bbox,t);else if(e.bbox){var n=e.bbox;t=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{var r={zoom:this.options.zoom};t=extend({},r,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var n;return e.localGeocoderOnly?n=GEOCODE_REQUEST_TYPE.LOCAL:e.reverseGeocode&&utils.REVERSE_GEOCODE_COORD_RGX.test(t)?n=GEOCODE_REQUEST_TYPE.REVERSE:n=GEOCODE_REQUEST_TYPE.FORWARD,n},_setupConfig:function(e,t){const n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],r=/[\s,]+/;var s=this,l=n.reduce(function(o,x){if(s.options[x]===void 0||s.options[x]===null)return o;["countries","types","language"].indexOf(x)>-1?o[x]=s.options[x].split(r):o[x]=s.options[x];const M=typeof s.options[x].longitude=="number"&&typeof s.options[x].latitude=="number";if(x==="proximity"&&M){const P=s.options[x].longitude,he=s.options[x].latitude;o[x]=[P,he]}return o},{});switch(e){case GEOCODE_REQUEST_TYPE.REVERSE:{var p=t.split(r).map(function(o){return parseFloat(o,10)});s.options.flipCoordinates||p.reverse(),l.types&&l.types[0],l=extend(l,{query:p,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in l&&delete l[o]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const o=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(t=t.replace(/,/g," ")),l=extend(l,{query:t})}break}return l},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),n=this._setupConfig(t,e);var r;switch(t){case GEOCODE_REQUEST_TYPE.LOCAL:r=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:r=this.geocoderService.forwardGeocode(n).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:r=this.geocoderService.reverseGeocode(n).send();break}var s=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],l=[],p=null;return r.catch(function(o){p=o}.bind(this)).then(function(o){this._hideLoadingIcon();var x={};return o?o.statusCode=="200"&&(x=o.body,x.request=o.request,x.headers=o.headers):x={type:"FeatureCollection",features:[]},x.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),x.features=x.features?s.concat(x.features):s,this.options.externalGeocoder?(l=this.options.externalGeocoder(e,x.features)||Promise.resolve([]),l.then(function(M){return x.features=x.features?M.concat(x.features):M,x},function(){return x})):x}.bind(this)).then(function(o){if(p)throw p;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),s.length&&this.options.localGeocoder||l.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(s)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:o})}.bind(this)),r},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var n=t.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=subtag.language(e),n=localization.placeholder[t];if(n)return n}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},n=extend({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var lib=MapboxGeocoder;const MapboxGeocoder$1=getDefaultExportFromCjs(lib);var xtend$2=immutable,v$2=lib$1;function file(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape(e,t){return v$2.assert(v$2.strictShape(e),t)}function date(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function coordinates$1(e){return v$2.tuple(v$2.number,v$2.number)(e)}var validator=xtend$2(v$2,{file,date,coordinates:coordinates$1,assertShape});function pick$1(e,t){var n=function(r,s){return t.indexOf(r)!==-1&&s!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(r){return n(r,e[r])}).reduce(function(r,s){return r[s]=e[s],r},{})}var pick_1=pick$1;function objectMap$1(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=t(r,e[r]),n},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(e){return objectMap(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}var stringifyBooleans$1=stringifyBoolean;function encodeArray(e){return e.map(encodeURIComponent).join(",")}function encodeValue(e){return Array.isArray(e)?encodeArray(e):encodeURIComponent(String(e))}function appendQueryParam(e,t,n){if(n===!1||n===null)return e;var r=/\?/.test(e)?"&":"?",s=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(s+="="+encodeValue(n)),""+e+r+s}function appendQueryObject(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(r){var s=t[r];s!==void 0&&(Array.isArray(s)&&(s=s.filter(function(l){return l!=null}).join(",")),n=appendQueryParam(n,r,s))}),n}function prependOrigin(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function interpolateRouteParams(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,r){var s=t[r];if(s===void 0)throw new Error("Unspecified route parameter "+r);var l=encodeValue(s);return"/"+l}):e}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},parseToken$1=parseMapboxToken,xtend$1=immutable,EventEmitter=eventemitter3Exports,urlUtils=urlUtils$1,constants$3=constants$4,requestId=1;function MapiRequest$1(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var r=xtend$1(n,t.headers),s=Object.keys(r).reduce(function(l,p){return l[p.toLowerCase()]=r[p],l},{});this.id=requestId++,this._options=t,this.emitter=new EventEmitter,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=s}MapiRequest$1.prototype.url=function e(t){var n=urlUtils.prependOrigin(this.path,this.origin);n=urlUtils.appendQueryObject(n,this.query);var r=this.params,s=t??this.client.accessToken;if(s){n=urlUtils.appendQueryParam(n,"access_token",s);var l=parseToken$1(s).user;r=xtend$1({ownerId:l},r)}return n=urlUtils.interpolateRouteParams(n,r),n};MapiRequest$1.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(constants$3.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(constants$3.EVENT_ERROR,n),n})};MapiRequest$1.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function e(t){var n=this;function r(p){function o(){delete n._nextPageRequest;var x=p.nextPage();x&&(n._nextPageRequest=x,l(x))}t(null,p,o)}function s(p){t(p,null,function(){})}function l(p){p.send().then(r,s)}l(this)};MapiRequest$1.prototype.clone=function e(){return this._extend()};MapiRequest$1.prototype._extend=function e(t){var n=xtend$1(this._options,t);return new MapiRequest$1(this.client,n)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$2=constants$4;function MapiClient$2(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$2.API_ORIGIN}MapiClient$2.prototype.createRequest=function e(t){return new MapiRequest(this,t)};var mapiClient=MapiClient$2;function parseParam(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],r=t[2].split(";"),s=null,l=r.reduce(function(p,o){var x=parseParam(o);return x?x.key==="rel"?(s||(s=x.value),p):(p[x.key]=x.value,p):p},{});return s?{url:n,rel:s,params:l}:null}function parseLinkHeader$1(e){return e?e.split(/,\s*</).reduce(function(t,n){var r=parseLink(n);if(!r)return t;var s=r.rel.split(/\s+/);return s.forEach(function(l){t[l]||(t[l]={url:r.url,params:r.params})}),t},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$1=constants$4;function MapiError$1(e){var t=e.type||constants$1.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var r=e.message||null;r||(typeof n=="string"?r=n:n&&typeof n.message=="string"?r=n.message:t===constants$1.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}var mapiError=MapiError$1;function parseSingleHeader(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),r=e.substring(t+1).trim();return{name:n,value:r}}function parseHeaders$1(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var r=parseSingleHeader(n);t[r.name]=r.value}),t}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(e){var t=requestsUnderway[e.id];t&&(t.abort(),delete requestsUnderway[e.id])}function createResponse(e,t){return new MapiResponse(e,{body:t.response,headers:parseHeaders(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent(e){var t=e.total,n=e.loaded,r=100*n/t;return{total:t,transferred:n,percent:r}}function sendRequestXhr(e,t){return new Promise(function(n,r){t.onprogress=function(p){e.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(p))};var s=e.file;s&&(t.upload.onprogress=function(p){e.emitter.emit(constants.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(p))}),t.onerror=function(p){r(p)},t.onabort=function(){var p=new MapiError({request:e,type:constants.ERROR_REQUEST_ABORTED});r(p)},t.onload=function(){if(delete requestsUnderway[e.id],t.status<200||t.status>=400){var p=new MapiError({request:e,body:t.response,statusCode:t.status});r(p);return}n(t)};var l=e.body;typeof l=="string"?t.send(l):l?t.send(JSON.stringify(l)):s?t.send(s):t.send(),requestsUnderway[e.id]=t}).then(function(n){return createResponse(e,n)})}function createRequestXhr(e,t){var n=e.url(t),r=new window.XMLHttpRequest;return r.open(e.method,n),Object.keys(e.headers).forEach(function(s){r.setRequestHeader(s,e.headers[s])}),r}function browserSend(e){return Promise.resolve().then(function(){var t=createRequestXhr(e,e.client.accessToken);return sendRequestXhr(e,t)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(e){MapiClient$1.call(this,e)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(e){return new BrowserClient(e)}var browserClient=createBrowserClient,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(e){return function(t){var n;MapiClient.prototype.isPrototypeOf(t)?n=t:n=createClient(t);var r=Object.create(e);return r.client=n,r}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v$1=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.string),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),proximity:v$1.oneOf(v$1.coordinates,"ip"),types:v$1.arrayOf(v$1.oneOf(featureTypes)),autocomplete:v$1.boolean,bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),routing:v$1.boolean,fuzzyMatch:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};Geocoding.reverseGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.coordinates),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),types:v$1.arrayOf(v$1.oneOf(featureTypes)),bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),reverseMode:v$1.oneOf("distance","score"),routing:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};var geocoding$1=createServiceFactory(Geocoding);const mbxGeocoding=getDefaultExportFromCjs(geocoding$1);var mapboxGlDraw$1={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(commonjsGlobal,function(){var n=function(kn,el){var _h={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Vh={on:function(od,sd,Gf){if(_h[od]===void 0)throw new Error("Invalid event type: "+od);_h[od].push({selector:sd,fn:Gf})},render:function(od){el.store.featureChanged(od)}},rd=function(od,sd){for(var Gf=_h[od],Ef=Gf.length;Ef--;){var _p=Gf[Ef];if(_p.selector(sd)){_p.fn.call(Vh,sd)||el.store.render(),el.ui.updateMapClasses();break}}};return kn.start.call(Vh),{render:kn.render,stop:function(){kn.stop&&kn.stop()},trash:function(){kn.trash&&(kn.trash(),el.store.render())},combineFeatures:function(){kn.combineFeatures&&kn.combineFeatures()},uncombineFeatures:function(){kn.uncombineFeatures&&kn.uncombineFeatures()},drag:function(od){rd("drag",od)},click:function(od){rd("click",od)},mousemove:function(od){rd("mousemove",od)},mousedown:function(od){rd("mousedown",od)},mouseup:function(od){rd("mouseup",od)},mouseout:function(od){rd("mouseout",od)},keydown:function(od){rd("keydown",od)},keyup:function(od){rd("keyup",od)},touchstart:function(od){rd("touchstart",od)},touchmove:function(od){rd("touchmove",od)},touchend:function(od){rd("touchend",od)},tap:function(od){rd("tap",od)}}};function r(kn){if(kn.__esModule)return kn;var el=kn.default;if(typeof el=="function"){var _h=function Vh(){if(this instanceof Vh){var rd=[null];rd.push.apply(rd,arguments);var od=Function.bind.apply(el,rd);return new od}return el.apply(this,arguments)};_h.prototype=el.prototype}else _h={};return Object.defineProperty(_h,"__esModule",{value:!0}),Object.keys(kn).forEach(function(Vh){var rd=Object.getOwnPropertyDescriptor(kn,Vh);Object.defineProperty(_h,Vh,rd.get?rd:{enumerable:!0,get:function(){return kn[Vh]}})}),_h}var s={},l={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},p=l;function o(kn){var el=0;if(kn&&kn.length>0){el+=Math.abs(x(kn[0]));for(var _h=1;_h<kn.length;_h++)el-=Math.abs(x(kn[_h]))}return el}function x(kn){var el,_h,Vh,rd,od,sd,Gf=0,Ef=kn.length;if(Ef>2){for(sd=0;sd<Ef;sd++)sd===Ef-2?(Vh=Ef-2,rd=Ef-1,od=0):sd===Ef-1?(Vh=Ef-1,rd=0,od=1):(Vh=sd,rd=sd+1,od=sd+2),el=kn[Vh],_h=kn[rd],Gf+=(M(kn[od][0])-M(el[0]))*Math.sin(M(_h[1]));Gf=Gf*p.RADIUS*p.RADIUS/2}return Gf}function M(kn){return kn*Math.PI/180}s.geometry=function kn(el){var _h,Vh=0;switch(el.type){case"Polygon":return o(el.coordinates);case"MultiPolygon":for(_h=0;_h<el.coordinates.length;_h++)Vh+=o(el.coordinates[_h]);return Vh;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(_h=0;_h<el.geometries.length;_h++)Vh+=kn(el.geometries[_h]);return Vh}},s.ring=x;var P={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},he={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},nt={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},_e={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Bt={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Fn={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},yr={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Io={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},rl={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Co={ACTIVE:"true",INACTIVE:"false"},as=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Js=-85,lh=Object.freeze({__proto__:null,classes:P,sources:he,cursors:nt,types:_e,geojsonTypes:Bt,modes:Fn,events:yr,updateActions:Io,meta:rl,activeStates:Co,interactions:as,LAT_MIN:-90,LAT_RENDERED_MIN:Js,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ch={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Zu(kn,el){var _h=ch[kn.geometry.type]-ch[el.geometry.type];return _h===0&&kn.geometry.type===Bt.POLYGON?kn.area-el.area:_h}function th(kn){return kn.map(function(el){return el.geometry.type===Bt.POLYGON&&(el.area=s.geometry({type:Bt.FEATURE,property:{},geometry:el.geometry})),el}).sort(Zu).map(function(el){return delete el.area,el})}function sl(kn,el){return el===void 0&&(el=0),[[kn.point.x-el,kn.point.y-el],[kn.point.x+el,kn.point.y+el]]}function sh(kn){if(this._items={},this._nums={},this._length=kn?kn.length:0,kn)for(var el=0,_h=kn.length;el<_h;el++)this.add(kn[el]),kn[el]!==void 0&&(typeof kn[el]=="string"?this._items[kn[el]]=el:this._nums[kn[el]]=el)}sh.prototype.add=function(kn){return this.has(kn)||(this._length++,typeof kn=="string"?this._items[kn]=this._length:this._nums[kn]=this._length),this},sh.prototype.delete=function(kn){return this.has(kn)===!1||(this._length--,delete this._items[kn],delete this._nums[kn]),this},sh.prototype.has=function(kn){return(typeof kn=="string"||typeof kn=="number")&&(this._items[kn]!==void 0||this._nums[kn]!==void 0)},sh.prototype.values=function(){var kn=this,el=[];return Object.keys(this._items).forEach(function(_h){el.push({k:_h,v:kn._items[_h]})}),Object.keys(this._nums).forEach(function(_h){el.push({k:JSON.parse(_h),v:kn._nums[_h]})}),el.sort(function(_h,Vh){return _h.v-Vh.v}).map(function(_h){return _h.k})},sh.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var xh=[rl.FEATURE,rl.MIDPOINT,rl.VERTEX],Mh={click:function(kn,el,_h){return Dh(kn,el,_h,_h.options.clickBuffer)},touch:function(kn,el,_h){return Dh(kn,el,_h,_h.options.touchBuffer)}};function Dh(kn,el,_h,Vh){if(_h.map===null)return[];var rd=kn?sl(kn,Vh):el,od={};_h.options.styles&&(od.layers=_h.options.styles.map(function(_p){return _p.id}));var sd=_h.map.queryRenderedFeatures(rd,od).filter(function(_p){return xh.indexOf(_p.properties.meta)!==-1}),Gf=new sh,Ef=[];return sd.forEach(function(_p){var sp=_p.properties.id;Gf.has(sp)||(Gf.add(sp),Ef.push(_p))}),th(Ef)}function Uh(kn,el){var _h=Mh.click(kn,null,el),Vh={mouse:nt.NONE};return _h[0]&&(Vh.mouse=_h[0].properties.active===Co.ACTIVE?nt.MOVE:nt.POINTER,Vh.feature=_h[0].properties.meta),el.events.currentModeName().indexOf("draw")!==-1&&(Vh.mouse=nt.ADD),el.ui.queueMapClasses(Vh),el.ui.updateMapClasses(),_h[0]}function cd(kn,el){var _h=kn.x-el.x,Vh=kn.y-el.y;return Math.sqrt(_h*_h+Vh*Vh)}function Tf(kn,el,_h){_h===void 0&&(_h={});var Vh=_h.fineTolerance!=null?_h.fineTolerance:4,rd=_h.grossTolerance!=null?_h.grossTolerance:12,od=_h.interval!=null?_h.interval:500;kn.point=kn.point||el.point,kn.time=kn.time||el.time;var sd=cd(kn.point,el.point);return sd<Vh||sd<rd&&el.time-kn.time<od}function yf(kn,el,_h){_h===void 0&&(_h={});var Vh=_h.tolerance!=null?_h.tolerance:25,rd=_h.interval!=null?_h.interval:250;return kn.point=kn.point||el.point,kn.time=kn.time||el.time,cd(kn.point,el.point)<Vh&&el.time-kn.time<rd}var Af={},md={get exports(){return Af},set exports(kn){Af=kn}}.exports=function(kn,el){if(el||(el=16),kn===void 0&&(kn=128),kn<=0)return"0";for(var _h=Math.log(Math.pow(2,kn))/Math.log(el),Vh=2;_h===1/0;Vh*=2)_h=Math.log(Math.pow(2,kn/Vh))/Math.log(el)*Vh;var rd=_h-Math.floor(_h),od="";for(Vh=0;Vh<Math.floor(_h);Vh++)od=Math.floor(Math.random()*el).toString(el)+od;if(rd){var sd=Math.pow(el,rd);od=Math.floor(Math.random()*sd).toString(el)+od}var Gf=parseInt(od,el);return Gf!==1/0&&Gf>=Math.pow(2,kn)?md(kn,el):od};md.rack=function(kn,el,_h){var Vh=function(od){var sd=0;do{if(sd++>10){if(!_h)throw new Error("too many ID collisions, use more bits");kn+=_h}var Gf=md(kn,el)}while(Object.hasOwnProperty.call(rd,Gf));return rd[Gf]=od,Gf},rd=Vh.hats={};return Vh.get=function(od){return Vh.hats[od]},Vh.set=function(od,sd){return Vh.hats[od]=sd,Vh},Vh.bits=kn||128,Vh.base=el||16,Vh};var vd=function(kn,el){this.ctx=kn,this.properties=el.properties||{},this.coordinates=el.geometry.coordinates,this.id=el.id||Af(),this.type=el.geometry.type};vd.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},vd.prototype.incomingCoords=function(kn){this.setCoordinates(kn)},vd.prototype.setCoordinates=function(kn){this.coordinates=kn,this.changed()},vd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},vd.prototype.setProperty=function(kn,el){this.properties[kn]=el},vd.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Bt.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},vd.prototype.internal=function(kn){var el={id:this.id,meta:rl.FEATURE,"meta:type":this.type,active:Co.INACTIVE,mode:kn};if(this.ctx.options.userProperties)for(var _h in this.properties)el["user_"+_h]=this.properties[_h];return{type:Bt.FEATURE,properties:el,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var qd=function(kn,el){vd.call(this,kn,el)};(qd.prototype=Object.create(vd.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},qd.prototype.updateCoordinate=function(kn,el,_h){this.coordinates=arguments.length===3?[el,_h]:[kn,el],this.changed()},qd.prototype.getCoordinate=function(){return this.getCoordinates()};var Ed=function(kn,el){vd.call(this,kn,el)};(Ed.prototype=Object.create(vd.prototype)).isValid=function(){return this.coordinates.length>1},Ed.prototype.addCoordinate=function(kn,el,_h){this.changed();var Vh=parseInt(kn,10);this.coordinates.splice(Vh,0,[el,_h])},Ed.prototype.getCoordinate=function(kn){var el=parseInt(kn,10);return JSON.parse(JSON.stringify(this.coordinates[el]))},Ed.prototype.removeCoordinate=function(kn){this.changed(),this.coordinates.splice(parseInt(kn,10),1)},Ed.prototype.updateCoordinate=function(kn,el,_h){var Vh=parseInt(kn,10);this.coordinates[Vh]=[el,_h],this.changed()};var Td=function(kn,el){vd.call(this,kn,el),this.coordinates=this.coordinates.map(function(_h){return _h.slice(0,-1)})};(Td.prototype=Object.create(vd.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(kn){return kn.length>2})},Td.prototype.incomingCoords=function(kn){this.coordinates=kn.map(function(el){return el.slice(0,-1)}),this.changed()},Td.prototype.setCoordinates=function(kn){this.coordinates=kn,this.changed()},Td.prototype.addCoordinate=function(kn,el,_h){this.changed();var Vh=kn.split(".").map(function(rd){return parseInt(rd,10)});this.coordinates[Vh[0]].splice(Vh[1],0,[el,_h])},Td.prototype.removeCoordinate=function(kn){this.changed();var el=kn.split(".").map(function(Vh){return parseInt(Vh,10)}),_h=this.coordinates[el[0]];_h&&(_h.splice(el[1],1),_h.length<3&&this.coordinates.splice(el[0],1))},Td.prototype.getCoordinate=function(kn){var el=kn.split(".").map(function(Vh){return parseInt(Vh,10)}),_h=this.coordinates[el[0]];return JSON.parse(JSON.stringify(_h[el[1]]))},Td.prototype.getCoordinates=function(){return this.coordinates.map(function(kn){return kn.concat([kn[0]])})},Td.prototype.updateCoordinate=function(kn,el,_h){this.changed();var Vh=kn.split("."),rd=parseInt(Vh[0],10),od=parseInt(Vh[1],10);this.coordinates[rd]===void 0&&(this.coordinates[rd]=[]),this.coordinates[rd][od]=[el,_h]};var Fd={MultiPoint:qd,MultiLineString:Ed,MultiPolygon:Td},Cd=function(kn,el,_h,Vh,rd){var od=_h.split("."),sd=parseInt(od[0],10),Gf=od[1]?od.slice(1).join("."):null;return kn[sd][el](Gf,Vh,rd)},Gd=function(kn,el){if(vd.call(this,kn,el),delete this.coordinates,this.model=Fd[el.geometry.type],this.model===void 0)throw new TypeError(el.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(el.geometry.coordinates)};function bf(kn){this.map=kn.map,this.drawConfig=JSON.parse(JSON.stringify(kn.options||{})),this._ctx=kn}(Gd.prototype=Object.create(vd.prototype))._coordinatesToFeatures=function(kn){var el=this,_h=this.model.bind(this);return kn.map(function(Vh){return new _h(el.ctx,{id:Af(),type:Bt.FEATURE,properties:{},geometry:{coordinates:Vh,type:el.type.replace("Multi","")}})})},Gd.prototype.isValid=function(){return this.features.every(function(kn){return kn.isValid()})},Gd.prototype.setCoordinates=function(kn){this.features=this._coordinatesToFeatures(kn),this.changed()},Gd.prototype.getCoordinate=function(kn){return Cd(this.features,"getCoordinate",kn)},Gd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(kn){return kn.type===Bt.POLYGON?kn.getCoordinates():kn.coordinates})))},Gd.prototype.updateCoordinate=function(kn,el,_h){Cd(this.features,"updateCoordinate",kn,el,_h),this.changed()},Gd.prototype.addCoordinate=function(kn,el,_h){Cd(this.features,"addCoordinate",kn,el,_h),this.changed()},Gd.prototype.removeCoordinate=function(kn){Cd(this.features,"removeCoordinate",kn),this.changed()},Gd.prototype.getFeatures=function(){return this.features},bf.prototype.setSelected=function(kn){return this._ctx.store.setSelected(kn)},bf.prototype.setSelectedCoordinates=function(kn){var el=this;this._ctx.store.setSelectedCoordinates(kn),kn.reduce(function(_h,Vh){return _h[Vh.feature_id]===void 0&&(_h[Vh.feature_id]=!0,el._ctx.store.get(Vh.feature_id).changed()),_h},{})},bf.prototype.getSelected=function(){return this._ctx.store.getSelected()},bf.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},bf.prototype.isSelected=function(kn){return this._ctx.store.isSelected(kn)},bf.prototype.getFeature=function(kn){return this._ctx.store.get(kn)},bf.prototype.select=function(kn){return this._ctx.store.select(kn)},bf.prototype.deselect=function(kn){return this._ctx.store.deselect(kn)},bf.prototype.deleteFeature=function(kn,el){return el===void 0&&(el={}),this._ctx.store.delete(kn,el)},bf.prototype.addFeature=function(kn){return this._ctx.store.add(kn)},bf.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},bf.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},bf.prototype.setActionableState=function(kn){kn===void 0&&(kn={});var el={trash:kn.trash||!1,combineFeatures:kn.combineFeatures||!1,uncombineFeatures:kn.uncombineFeatures||!1};return this._ctx.events.actionable(el)},bf.prototype.changeMode=function(kn,el,_h){return el===void 0&&(el={}),_h===void 0&&(_h={}),this._ctx.events.changeMode(kn,el,_h)},bf.prototype.updateUIClasses=function(kn){return this._ctx.ui.queueMapClasses(kn)},bf.prototype.activateUIButton=function(kn){return this._ctx.ui.setActiveButton(kn)},bf.prototype.featuresAt=function(kn,el,_h){if(_h===void 0&&(_h="click"),_h!=="click"&&_h!=="touch")throw new Error("invalid buffer type");return Mh[_h](kn,el,this._ctx)},bf.prototype.newFeature=function(kn){var el=kn.geometry.type;return el===Bt.POINT?new qd(this._ctx,kn):el===Bt.LINE_STRING?new Ed(this._ctx,kn):el===Bt.POLYGON?new Td(this._ctx,kn):new Gd(this._ctx,kn)},bf.prototype.isInstanceOf=function(kn,el){if(kn===Bt.POINT)return el instanceof qd;if(kn===Bt.LINE_STRING)return el instanceof Ed;if(kn===Bt.POLYGON)return el instanceof Td;if(kn==="MultiFeature")return el instanceof Gd;throw new Error("Unknown feature class: "+kn)},bf.prototype.doRender=function(kn){return this._ctx.store.featureChanged(kn)},bf.prototype.onSetup=function(){},bf.prototype.onDrag=function(){},bf.prototype.onClick=function(){},bf.prototype.onMouseMove=function(){},bf.prototype.onMouseDown=function(){},bf.prototype.onMouseUp=function(){},bf.prototype.onMouseOut=function(){},bf.prototype.onKeyUp=function(){},bf.prototype.onKeyDown=function(){},bf.prototype.onTouchStart=function(){},bf.prototype.onTouchMove=function(){},bf.prototype.onTouchEnd=function(){},bf.prototype.onTap=function(){},bf.prototype.onStop=function(){},bf.prototype.onTrash=function(){},bf.prototype.onCombineFeature=function(){},bf.prototype.onUncombineFeature=function(){},bf.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Id={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},td=Object.keys(Id);function $d(kn){var el=Object.keys(kn);return function(_h,Vh){Vh===void 0&&(Vh={});var rd={},od=el.reduce(function(sd,Gf){return sd[Gf]=kn[Gf],sd},new bf(_h));return{start:function(){var sd=this;rd=od.onSetup(Vh),td.forEach(function(Gf){var Ef,_p=Id[Gf],sp=function(){return!1};kn[_p]&&(sp=function(){return!0}),sd.on(Gf,sp,(Ef=_p,function(lp){return od[Ef](rd,lp)}))})},stop:function(){od.onStop(rd)},trash:function(){od.onTrash(rd)},combineFeatures:function(){od.onCombineFeatures(rd)},uncombineFeatures:function(){od.onUncombineFeatures(rd)},render:function(sd,Gf){od.toDisplayFeatures(rd,sd,Gf)}}}}function np(kn){return[].concat(kn).filter(function(el){return el!==void 0})}function jf(){var kn=this;if(!(kn.ctx.map&&kn.ctx.map.getSource(he.HOT)!==void 0))return Ef();var el=kn.ctx.events.currentModeName();kn.ctx.ui.queueMapClasses({mode:el});var _h=[],Vh=[];kn.isDirty?Vh=kn.getAllIds():(_h=kn.getChangedIds().filter(function(_p){return kn.get(_p)!==void 0}),Vh=kn.sources.hot.filter(function(_p){return _p.properties.id&&_h.indexOf(_p.properties.id)===-1&&kn.get(_p.properties.id)!==void 0}).map(function(_p){return _p.properties.id})),kn.sources.hot=[];var rd=kn.sources.cold.length;kn.sources.cold=kn.isDirty?[]:kn.sources.cold.filter(function(_p){var sp=_p.properties.id||_p.properties.parent;return _h.indexOf(sp)===-1});var od=rd!==kn.sources.cold.length||Vh.length>0;function sd(_p,sp){var lp=kn.get(_p).internal(el);kn.ctx.events.currentModeRender(lp,function(Zp){kn.sources[sp].push(Zp)})}if(_h.forEach(function(_p){return sd(_p,"hot")}),Vh.forEach(function(_p){return sd(_p,"cold")}),od&&kn.ctx.map.getSource(he.COLD).setData({type:Bt.FEATURE_COLLECTION,features:kn.sources.cold}),kn.ctx.map.getSource(he.HOT).setData({type:Bt.FEATURE_COLLECTION,features:kn.sources.hot}),kn._emitSelectionChange&&(kn.ctx.map.fire(yr.SELECTION_CHANGE,{features:kn.getSelected().map(function(_p){return _p.toGeoJSON()}),points:kn.getSelectedCoordinates().map(function(_p){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:_p.coordinates}}})}),kn._emitSelectionChange=!1),kn._deletedFeaturesToEmit.length){var Gf=kn._deletedFeaturesToEmit.map(function(_p){return _p.toGeoJSON()});kn._deletedFeaturesToEmit=[],kn.ctx.map.fire(yr.DELETE,{features:Gf})}function Ef(){kn.isDirty=!1,kn.clearChangedIds()}Ef(),kn.ctx.map.fire(yr.RENDER,{})}function yd(kn){var el,_h=this;this._features={},this._featureIds=new sh,this._selectedFeatureIds=new sh,this._selectedCoordinates=[],this._changedFeatureIds=new sh,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=kn,this.sources={hot:[],cold:[]},this.render=function(){el||(el=requestAnimationFrame(function(){el=null,jf.call(_h)}))},this.isDirty=!1}function Qd(kn,el){var _h=kn._selectedCoordinates.filter(function(Vh){return kn._selectedFeatureIds.has(Vh.feature_id)});kn._selectedCoordinates.length===_h.length||el.silent||(kn._emitSelectionChange=!0),kn._selectedCoordinates=_h}yd.prototype.createRenderBatch=function(){var kn=this,el=this.render,_h=0;return this.render=function(){_h++},function(){kn.render=el,_h>0&&kn.render()}},yd.prototype.setDirty=function(){return this.isDirty=!0,this},yd.prototype.featureChanged=function(kn){return this._changedFeatureIds.add(kn),this},yd.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},yd.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},yd.prototype.getAllIds=function(){return this._featureIds.values()},yd.prototype.add=function(kn){return this.featureChanged(kn.id),this._features[kn.id]=kn,this._featureIds.add(kn.id),this},yd.prototype.delete=function(kn,el){var _h=this;return el===void 0&&(el={}),np(kn).forEach(function(Vh){_h._featureIds.has(Vh)&&(_h._featureIds.delete(Vh),_h._selectedFeatureIds.delete(Vh),el.silent||_h._deletedFeaturesToEmit.indexOf(_h._features[Vh])===-1&&_h._deletedFeaturesToEmit.push(_h._features[Vh]),delete _h._features[Vh],_h.isDirty=!0)}),Qd(this,el),this},yd.prototype.get=function(kn){return this._features[kn]},yd.prototype.getAll=function(){var kn=this;return Object.keys(this._features).map(function(el){return kn._features[el]})},yd.prototype.select=function(kn,el){var _h=this;return el===void 0&&(el={}),np(kn).forEach(function(Vh){_h._selectedFeatureIds.has(Vh)||(_h._selectedFeatureIds.add(Vh),_h._changedFeatureIds.add(Vh),el.silent||(_h._emitSelectionChange=!0))}),this},yd.prototype.deselect=function(kn,el){var _h=this;return el===void 0&&(el={}),np(kn).forEach(function(Vh){_h._selectedFeatureIds.has(Vh)&&(_h._selectedFeatureIds.delete(Vh),_h._changedFeatureIds.add(Vh),el.silent||(_h._emitSelectionChange=!0))}),Qd(this,el),this},yd.prototype.clearSelected=function(kn){return kn===void 0&&(kn={}),this.deselect(this._selectedFeatureIds.values(),{silent:kn.silent}),this},yd.prototype.setSelected=function(kn,el){var _h=this;return el===void 0&&(el={}),kn=np(kn),this.deselect(this._selectedFeatureIds.values().filter(function(Vh){return kn.indexOf(Vh)===-1}),{silent:el.silent}),this.select(kn.filter(function(Vh){return!_h._selectedFeatureIds.has(Vh)}),{silent:el.silent}),this},yd.prototype.setSelectedCoordinates=function(kn){return this._selectedCoordinates=kn,this._emitSelectionChange=!0,this},yd.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},yd.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},yd.prototype.getSelected=function(){var kn=this;return this._selectedFeatureIds.values().map(function(el){return kn.get(el)})},yd.prototype.getSelectedCoordinates=function(){var kn=this;return this._selectedCoordinates.map(function(el){return{coordinates:kn.get(el.feature_id).getCoordinate(el.coord_path)}})},yd.prototype.isSelected=function(kn){return this._selectedFeatureIds.has(kn)},yd.prototype.setFeatureProperty=function(kn,el,_h){this.get(kn).setProperty(el,_h),this.featureChanged(kn)},yd.prototype.storeMapConfig=function(){var kn=this;as.forEach(function(el){kn.ctx.map[el]&&(kn._mapInitialConfig[el]=kn.ctx.map[el].isEnabled())})},yd.prototype.restoreMapConfig=function(){var kn=this;Object.keys(this._mapInitialConfig).forEach(function(el){kn._mapInitialConfig[el]?kn.ctx.map[el].enable():kn.ctx.map[el].disable()})},yd.prototype.getInitialConfigValue=function(kn){return this._mapInitialConfig[kn]===void 0||this._mapInitialConfig[kn]};var op=function(){for(var kn=arguments,el={},_h=0;_h<arguments.length;_h++){var Vh=kn[_h];for(var rd in Vh)bp.call(Vh,rd)&&(el[rd]=Vh[rd])}return el},bp=Object.prototype.hasOwnProperty,fp=["mode","feature","mouse"];function Qh(kn){var el=null,_h=null,Vh={onRemove:function(){return kn.map.off("load",Vh.connect),clearInterval(_h),Vh.removeLayers(),kn.store.restoreMapConfig(),kn.ui.removeButtons(),kn.events.removeEventListeners(),kn.ui.clearMapClasses(),kn.map=null,kn.container=null,kn.store=null,el&&el.parentNode&&el.parentNode.removeChild(el),el=null,this},connect:function(){kn.map.off("load",Vh.connect),clearInterval(_h),Vh.addLayers(),kn.store.storeMapConfig(),kn.events.addEventListeners()},onAdd:function(rd){var od=rd.fire;return rd.fire=function(sd,Gf){var Ef=arguments;return od.length===1&&arguments.length!==1&&(Ef=[op({},{type:sd},Gf)]),od.apply(rd,Ef)},kn.map=rd,kn.events=function(sd){var Gf=Object.keys(sd.options.modes).reduce(function(kf,Sp){return kf[Sp]=$d(sd.options.modes[Sp]),kf},{}),Ef={},_p={},sp={},lp=null,Zp=null;sp.drag=function(kf,Sp){Sp({point:kf.point,time:new Date().getTime()})?(sd.ui.queueMapClasses({mouse:nt.DRAG}),Zp.drag(kf)):kf.originalEvent.stopPropagation()},sp.mousedrag=function(kf){sp.drag(kf,function(Sp){return!Tf(Ef,Sp)})},sp.touchdrag=function(kf){sp.drag(kf,function(Sp){return!yf(_p,Sp)})},sp.mousemove=function(kf){if((kf.originalEvent.buttons!==void 0?kf.originalEvent.buttons:kf.originalEvent.which)===1)return sp.mousedrag(kf);var Sp=Uh(kf,sd);kf.featureTarget=Sp,Zp.mousemove(kf)},sp.mousedown=function(kf){Ef={time:new Date().getTime(),point:kf.point};var Sp=Uh(kf,sd);kf.featureTarget=Sp,Zp.mousedown(kf)},sp.mouseup=function(kf){var Sp=Uh(kf,sd);kf.featureTarget=Sp,Tf(Ef,{point:kf.point,time:new Date().getTime()})?Zp.click(kf):Zp.mouseup(kf)},sp.mouseout=function(kf){Zp.mouseout(kf)},sp.touchstart=function(kf){if(kf.originalEvent.preventDefault(),sd.options.touchEnabled){_p={time:new Date().getTime(),point:kf.point};var Sp=Mh.touch(kf,null,sd)[0];kf.featureTarget=Sp,Zp.touchstart(kf)}},sp.touchmove=function(kf){if(kf.originalEvent.preventDefault(),sd.options.touchEnabled)return Zp.touchmove(kf),sp.touchdrag(kf)},sp.touchend=function(kf){if(kf.originalEvent.preventDefault(),sd.options.touchEnabled){var Sp=Mh.touch(kf,null,sd)[0];kf.featureTarget=Sp,yf(_p,{time:new Date().getTime(),point:kf.point})?Zp.tap(kf):Zp.touchend(kf)}};var Rm=function(kf){return!(kf===8||kf===46||kf>=48&&kf<=57)};function Yp(kf,Sp,Np){Np===void 0&&(Np={}),Zp.stop();var Jm=Gf[kf];if(Jm===void 0)throw new Error(kf+" is not valid");lp=kf;var Um=Jm(sd,Sp);Zp=n(Um,sd),Np.silent||sd.map.fire(yr.MODE_CHANGE,{mode:kf}),sd.store.setDirty(),sd.store.render()}sp.keydown=function(kf){(kf.srcElement||kf.target).classList[0]==="mapboxgl-canvas"&&(kf.keyCode!==8&&kf.keyCode!==46||!sd.options.controls.trash?Rm(kf.keyCode)?Zp.keydown(kf):kf.keyCode===49&&sd.options.controls.point?Yp(Fn.DRAW_POINT):kf.keyCode===50&&sd.options.controls.line_string?Yp(Fn.DRAW_LINE_STRING):kf.keyCode===51&&sd.options.controls.polygon&&Yp(Fn.DRAW_POLYGON):(kf.preventDefault(),Zp.trash()))},sp.keyup=function(kf){Rm(kf.keyCode)&&Zp.keyup(kf)},sp.zoomend=function(){sd.store.changeZoom()},sp.data=function(kf){if(kf.dataType==="style"){var Sp=sd.setup,Np=sd.map,Jm=sd.options,Um=sd.store;Jm.styles.some(function(bg){return Np.getLayer(bg.id)})||(Sp.addLayers(),Um.setDirty(),Um.render())}};var Pm={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){lp=sd.options.defaultMode,Zp=n(Gf[lp](sd),sd)},changeMode:Yp,actionable:function(kf){var Sp=!1;Object.keys(kf).forEach(function(Np){if(Pm[Np]===void 0)throw new Error("Invalid action type");Pm[Np]!==kf[Np]&&(Sp=!0),Pm[Np]=kf[Np]}),Sp&&sd.map.fire(yr.ACTIONABLE,{actions:Pm})},currentModeName:function(){return lp},currentModeRender:function(kf,Sp){return Zp.render(kf,Sp)},fire:function(kf,Sp){sp[kf]&&sp[kf](Sp)},addEventListeners:function(){sd.map.on("mousemove",sp.mousemove),sd.map.on("mousedown",sp.mousedown),sd.map.on("mouseup",sp.mouseup),sd.map.on("data",sp.data),sd.map.on("touchmove",sp.touchmove),sd.map.on("touchstart",sp.touchstart),sd.map.on("touchend",sp.touchend),sd.container.addEventListener("mouseout",sp.mouseout),sd.options.keybindings&&(sd.container.addEventListener("keydown",sp.keydown),sd.container.addEventListener("keyup",sp.keyup))},removeEventListeners:function(){sd.map.off("mousemove",sp.mousemove),sd.map.off("mousedown",sp.mousedown),sd.map.off("mouseup",sp.mouseup),sd.map.off("data",sp.data),sd.map.off("touchmove",sp.touchmove),sd.map.off("touchstart",sp.touchstart),sd.map.off("touchend",sp.touchend),sd.container.removeEventListener("mouseout",sp.mouseout),sd.options.keybindings&&(sd.container.removeEventListener("keydown",sp.keydown),sd.container.removeEventListener("keyup",sp.keyup))},trash:function(kf){Zp.trash(kf)},combineFeatures:function(){Zp.combineFeatures()},uncombineFeatures:function(){Zp.uncombineFeatures()},getMode:function(){return lp}}}(kn),kn.ui=function(sd){var Gf={},Ef=null,_p={mode:null,feature:null,mouse:null},sp={mode:null,feature:null,mouse:null};function lp(kf){sp=op(sp,kf)}function Zp(){var kf,Sp;if(sd.container){var Np=[],Jm=[];fp.forEach(function(Um){sp[Um]!==_p[Um]&&(Np.push(Um+"-"+_p[Um]),sp[Um]!==null&&Jm.push(Um+"-"+sp[Um]))}),Np.length>0&&(kf=sd.container.classList).remove.apply(kf,Np),Jm.length>0&&(Sp=sd.container.classList).add.apply(Sp,Jm),_p=op(_p,sp)}}function Rm(kf,Sp){Sp===void 0&&(Sp={});var Np=document.createElement("button");return Np.className=P.CONTROL_BUTTON+" "+Sp.className,Np.setAttribute("title",Sp.title),Sp.container.appendChild(Np),Np.addEventListener("click",function(Jm){if(Jm.preventDefault(),Jm.stopPropagation(),Jm.target===Ef)return Yp(),void Sp.onDeactivate();Pm(kf),Sp.onActivate()},!0),Np}function Yp(){Ef&&(Ef.classList.remove(P.ACTIVE_BUTTON),Ef=null)}function Pm(kf){Yp();var Sp=Gf[kf];Sp&&Sp&&kf!=="trash"&&(Sp.classList.add(P.ACTIVE_BUTTON),Ef=Sp)}return{setActiveButton:Pm,queueMapClasses:lp,updateMapClasses:Zp,clearMapClasses:function(){lp({mode:null,feature:null,mouse:null}),Zp()},addButtons:function(){var kf=sd.options.controls,Sp=document.createElement("div");return Sp.className=P.CONTROL_GROUP+" "+P.CONTROL_BASE,kf&&(kf[_e.LINE]&&(Gf[_e.LINE]=Rm(_e.LINE,{container:Sp,className:P.CONTROL_BUTTON_LINE,title:"LineString tool "+(sd.options.keybindings?"(l)":""),onActivate:function(){return sd.events.changeMode(Fn.DRAW_LINE_STRING)},onDeactivate:function(){return sd.events.trash()}})),kf[_e.POLYGON]&&(Gf[_e.POLYGON]=Rm(_e.POLYGON,{container:Sp,className:P.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(sd.options.keybindings?"(p)":""),onActivate:function(){return sd.events.changeMode(Fn.DRAW_POLYGON)},onDeactivate:function(){return sd.events.trash()}})),kf[_e.POINT]&&(Gf[_e.POINT]=Rm(_e.POINT,{container:Sp,className:P.CONTROL_BUTTON_POINT,title:"Marker tool "+(sd.options.keybindings?"(m)":""),onActivate:function(){return sd.events.changeMode(Fn.DRAW_POINT)},onDeactivate:function(){return sd.events.trash()}})),kf.trash&&(Gf.trash=Rm("trash",{container:Sp,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){sd.events.trash()}})),kf.combine_features&&(Gf.combine_features=Rm("combineFeatures",{container:Sp,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){sd.events.combineFeatures()}})),kf.uncombine_features&&(Gf.uncombine_features=Rm("uncombineFeatures",{container:Sp,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){sd.events.uncombineFeatures()}}))),Sp},removeButtons:function(){Object.keys(Gf).forEach(function(kf){var Sp=Gf[kf];Sp.parentNode&&Sp.parentNode.removeChild(Sp),delete Gf[kf]})}}}(kn),kn.container=rd.getContainer(),kn.store=new yd(kn),el=kn.ui.addButtons(),kn.options.boxSelect&&(rd.boxZoom.disable(),rd.dragPan.disable(),rd.dragPan.enable()),rd.loaded()?Vh.connect():(rd.on("load",Vh.connect),_h=setInterval(function(){rd.loaded()&&Vh.connect()},16)),kn.events.start(),el},addLayers:function(){kn.map.addSource(he.COLD,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),kn.map.addSource(he.HOT,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),kn.options.styles.forEach(function(rd){kn.map.addLayer(rd)}),kn.store.setDirty(!0),kn.store.render()},removeLayers:function(){kn.options.styles.forEach(function(rd){kn.map.getLayer(rd.id)&&kn.map.removeLayer(rd.id)}),kn.map.getSource(he.COLD)&&kn.map.removeSource(he.COLD),kn.map.getSource(he.HOT)&&kn.map.removeSource(he.HOT)}};return kn.setup=Vh,Vh}var Yd=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ad(kn){return function(el){var _h=el.featureTarget;return!!_h&&!!_h.properties&&_h.properties.meta===kn}}function Zd(kn){return!!kn.originalEvent&&!!kn.originalEvent.shiftKey&&kn.originalEvent.button===0}function Xh(kn){return!!kn.featureTarget&&!!kn.featureTarget.properties&&kn.featureTarget.properties.active===Co.ACTIVE&&kn.featureTarget.properties.meta===rl.FEATURE}function Ld(kn){return!!kn.featureTarget&&!!kn.featureTarget.properties&&kn.featureTarget.properties.active===Co.INACTIVE&&kn.featureTarget.properties.meta===rl.FEATURE}function Kf(kn){return kn.featureTarget===void 0}function If(kn){return!!kn.featureTarget&&!!kn.featureTarget.properties&&kn.featureTarget.properties.meta===rl.FEATURE}function Df(kn){var el=kn.featureTarget;return!!el&&!!el.properties&&el.properties.meta===rl.VERTEX}function Jf(kn){return!!kn.originalEvent&&kn.originalEvent.shiftKey===!0}function Nf(kn){return kn.keyCode===27}function Wf(kn){return kn.keyCode===13}var Cp=Object.freeze({__proto__:null,isOfMetaType:ad,isShiftMousedown:Zd,isActiveFeature:Xh,isInactiveFeature:Ld,noTarget:Kf,isFeature:If,isVertex:Df,isShiftDown:Jf,isEscapeKey:Nf,isEnterKey:Wf,isTrue:function(){return!0}}),Tp=Pp;function Pp(kn,el){this.x=kn,this.y=el}function Yf(kn,el){var _h=el.getBoundingClientRect();return new Tp(kn.clientX-_h.left-(el.clientLeft||0),kn.clientY-_h.top-(el.clientTop||0))}function qp(kn,el,_h,Vh){return{type:Bt.FEATURE,properties:{meta:rl.VERTEX,parent:kn,coord_path:_h,active:Vh?Co.ACTIVE:Co.INACTIVE},geometry:{type:Bt.POINT,coordinates:el}}}function am(kn,el,_h){var Vh=el.geometry.coordinates,rd=_h.geometry.coordinates;if(Vh[1]>85||Vh[1]<Js||rd[1]>85||rd[1]<Js)return null;var od={lng:(Vh[0]+rd[0])/2,lat:(Vh[1]+rd[1])/2};return{type:Bt.FEATURE,properties:{meta:rl.MIDPOINT,parent:kn,lng:od.lng,lat:od.lat,coord_path:_h.properties.coord_path},geometry:{type:Bt.POINT,coordinates:[od.lng,od.lat]}}}function Xd(kn,el,_h){el===void 0&&(el={}),_h===void 0&&(_h=null);var Vh,rd=kn.geometry,od=rd.type,sd=rd.coordinates,Gf=kn.properties&&kn.properties.id,Ef=[];function _p(lp,Zp){var Rm="",Yp=null;lp.forEach(function(Pm,kf){var Sp=Zp!=null?Zp+"."+kf:String(kf),Np=qp(Gf,Pm,Sp,sp(Sp));if(el.midpoints&&Yp){var Jm=am(Gf,Yp,Np);Jm&&Ef.push(Jm)}Yp=Np;var Um=JSON.stringify(Pm);Rm!==Um&&Ef.push(Np),kf===0&&(Rm=Um)})}function sp(lp){return!!el.selectedPaths&&el.selectedPaths.indexOf(lp)!==-1}return od===Bt.POINT?Ef.push(qp(Gf,sd,_h,sp(_h))):od===Bt.POLYGON?sd.forEach(function(lp,Zp){_p(lp,_h!==null?_h+"."+Zp:String(Zp))}):od===Bt.LINE_STRING?_p(sd,_h):od.indexOf(Bt.MULTI_PREFIX)===0&&(Vh=od.replace(Bt.MULTI_PREFIX,""),sd.forEach(function(lp,Zp){var Rm={type:Bt.FEATURE,properties:kn.properties,geometry:{type:Vh,coordinates:lp}};Ef=Ef.concat(Xd(Rm,el,Zp))})),Ef}Pp.prototype={clone:function(){return new Pp(this.x,this.y)},add:function(kn){return this.clone()._add(kn)},sub:function(kn){return this.clone()._sub(kn)},multByPoint:function(kn){return this.clone()._multByPoint(kn)},divByPoint:function(kn){return this.clone()._divByPoint(kn)},mult:function(kn){return this.clone()._mult(kn)},div:function(kn){return this.clone()._div(kn)},rotate:function(kn){return this.clone()._rotate(kn)},rotateAround:function(kn,el){return this.clone()._rotateAround(kn,el)},matMult:function(kn){return this.clone()._matMult(kn)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(kn){return this.x===kn.x&&this.y===kn.y},dist:function(kn){return Math.sqrt(this.distSqr(kn))},distSqr:function(kn){var el=kn.x-this.x,_h=kn.y-this.y;return el*el+_h*_h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(kn){return Math.atan2(this.y-kn.y,this.x-kn.x)},angleWith:function(kn){return this.angleWithSep(kn.x,kn.y)},angleWithSep:function(kn,el){return Math.atan2(this.x*el-this.y*kn,this.x*kn+this.y*el)},_matMult:function(kn){var el=kn[0]*this.x+kn[1]*this.y,_h=kn[2]*this.x+kn[3]*this.y;return this.x=el,this.y=_h,this},_add:function(kn){return this.x+=kn.x,this.y+=kn.y,this},_sub:function(kn){return this.x-=kn.x,this.y-=kn.y,this},_mult:function(kn){return this.x*=kn,this.y*=kn,this},_div:function(kn){return this.x/=kn,this.y/=kn,this},_multByPoint:function(kn){return this.x*=kn.x,this.y*=kn.y,this},_divByPoint:function(kn){return this.x/=kn.x,this.y/=kn.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var kn=this.y;return this.y=this.x,this.x=-kn,this},_rotate:function(kn){var el=Math.cos(kn),_h=Math.sin(kn),Vh=el*this.x-_h*this.y,rd=_h*this.x+el*this.y;return this.x=Vh,this.y=rd,this},_rotateAround:function(kn,el){var _h=Math.cos(kn),Vh=Math.sin(kn),rd=el.x+_h*(this.x-el.x)-Vh*(this.y-el.y),od=el.y+Vh*(this.x-el.x)+_h*(this.y-el.y);return this.x=rd,this.y=od,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pp.convert=function(kn){return kn instanceof Pp?kn:Array.isArray(kn)?new Pp(kn[0],kn[1]):kn};var Op={enable:function(kn){setTimeout(function(){kn.map&&kn.map.doubleClickZoom&&kn._ctx&&kn._ctx.store&&kn._ctx.store.getInitialConfigValue&&kn._ctx.store.getInitialConfigValue("doubleClickZoom")&&kn.map.doubleClickZoom.enable()},0)},disable:function(kn){setTimeout(function(){kn.map&&kn.map.doubleClickZoom&&kn.map.doubleClickZoom.disable()},0)}},nm={},Tm={get exports(){return nm},set exports(kn){nm=kn}},hp=function(kn){if(!kn||!kn.type)return null;var el=Em[kn.type];if(!el)return null;if(el==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:kn}]};if(el==="feature")return{type:"FeatureCollection",features:[kn]};if(el==="featurecollection")return kn},Em={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Qp=Object.freeze({__proto__:null,default:function kn(el){switch(el&&el.type||null){case"FeatureCollection":return el.features=el.features.reduce(function(_h,Vh){return _h.concat(kn(Vh))},[]),el;case"Feature":return el.geometry?kn(el.geometry).map(function(_h){var Vh={type:"Feature",properties:JSON.parse(JSON.stringify(el.properties)),geometry:_h};return el.id!==void 0&&(Vh.id=el.id),Vh}):[el];case"MultiPoint":return el.coordinates.map(function(_h){return{type:"Point",coordinates:_h}});case"MultiPolygon":return el.coordinates.map(function(_h){return{type:"Polygon",coordinates:_h}});case"MultiLineString":return el.coordinates.map(function(_h){return{type:"LineString",coordinates:_h}});case"GeometryCollection":return el.geometries.map(kn).reduce(function(_h,Vh){return _h.concat(Vh)},[]);case"Point":case"Polygon":case"LineString":return[el]}}}),lm=hp,Dd=r(Qp),Hf=function(kn){return function el(_h){return Array.isArray(_h)&&_h.length&&typeof _h[0]=="number"?[_h]:_h.reduce(function(Vh,rd){return Array.isArray(rd)&&Array.isArray(rd[0])?Vh.concat(el(rd)):(Vh.push(rd),Vh)},[])}(kn)};Dd instanceof Function||(Dd=Dd.default);var mh={},Jh={get exports(){return mh},set exports(kn){mh=kn}}.exports=function(kn){return new Wu(kn)};function Wu(kn){this.value=kn}function al(kn,el,_h){var Vh=[],rd=[],od=!0;return function sd(Gf){var Ef=_h?Xr(Gf):Gf,_p={},sp=!0,lp={node:Ef,node_:Gf,path:[].concat(Vh),parent:rd[rd.length-1],parents:rd,key:Vh.slice(-1)[0],isRoot:Vh.length===0,level:Vh.length,circular:null,update:function(Yp,Pm){lp.isRoot||(lp.parent.node[lp.key]=Yp),lp.node=Yp,Pm&&(sp=!1)},delete:function(Yp){delete lp.parent.node[lp.key],Yp&&(sp=!1)},remove:function(Yp){$u(lp.parent.node)?lp.parent.node.splice(lp.key,1):delete lp.parent.node[lp.key],Yp&&(sp=!1)},keys:null,before:function(Yp){_p.before=Yp},after:function(Yp){_p.after=Yp},pre:function(Yp){_p.pre=Yp},post:function(Yp){_p.post=Yp},stop:function(){od=!1},block:function(){sp=!1}};if(!od)return lp;function Zp(){if(typeof lp.node=="object"&&lp.node!==null){lp.keys&&lp.node_===lp.node||(lp.keys=mr(lp.node)),lp.isLeaf=lp.keys.length==0;for(var Yp=0;Yp<rd.length;Yp++)if(rd[Yp].node_===Gf){lp.circular=rd[Yp];break}}else lp.isLeaf=!0,lp.keys=null;lp.notLeaf=!lp.isLeaf,lp.notRoot=!lp.isRoot}Zp();var Rm=el.call(lp,lp.node);return Rm!==void 0&&lp.update&&lp.update(Rm),_p.before&&_p.before.call(lp,lp.node),sp&&(typeof lp.node!="object"||lp.node===null||lp.circular||(rd.push(lp),Zp(),eh(lp.keys,function(Yp,Pm){Vh.push(Yp),_p.pre&&_p.pre.call(lp,lp.node[Yp],Yp);var kf=sd(lp.node[Yp]);_h&&rh.call(lp.node,Yp)&&(lp.node[Yp]=kf.node),kf.isLast=Pm==lp.keys.length-1,kf.isFirst=Pm==0,_p.post&&_p.post.call(lp,kf),Vh.pop()}),rd.pop()),_p.after&&_p.after.call(lp,lp.node)),lp}(kn).node}function Xr(kn){if(typeof kn=="object"&&kn!==null){var el;if($u(kn))el=[];else if(cs(kn)==="[object Date]")el=new Date(kn.getTime?kn.getTime():kn);else if(function(rd){return cs(rd)==="[object RegExp]"}(kn))el=new RegExp(kn);else if(function(rd){return cs(rd)==="[object Error]"}(kn))el={message:kn.message};else if(function(rd){return cs(rd)==="[object Boolean]"}(kn))el=new Boolean(kn);else if(function(rd){return cs(rd)==="[object Number]"}(kn))el=new Number(kn);else if(function(rd){return cs(rd)==="[object String]"}(kn))el=new String(kn);else if(Object.create&&Object.getPrototypeOf)el=Object.create(Object.getPrototypeOf(kn));else if(kn.constructor===Object)el={};else{var _h=kn.constructor&&kn.constructor.prototype||kn.__proto__||{},Vh=function(){};Vh.prototype=_h,el=new Vh}return eh(mr(kn),function(rd){el[rd]=kn[rd]}),el}return kn}Wu.prototype.get=function(kn){for(var el=this.value,_h=0;_h<kn.length;_h++){var Vh=kn[_h];if(!el||!rh.call(el,Vh)){el=void 0;break}el=el[Vh]}return el},Wu.prototype.has=function(kn){for(var el=this.value,_h=0;_h<kn.length;_h++){var Vh=kn[_h];if(!el||!rh.call(el,Vh))return!1;el=el[Vh]}return!0},Wu.prototype.set=function(kn,el){for(var _h=this.value,Vh=0;Vh<kn.length-1;Vh++){var rd=kn[Vh];rh.call(_h,rd)||(_h[rd]={}),_h=_h[rd]}return _h[kn[Vh]]=el,el},Wu.prototype.map=function(kn){return al(this.value,kn,!0)},Wu.prototype.forEach=function(kn){return this.value=al(this.value,kn,!1),this.value},Wu.prototype.reduce=function(kn,el){var _h=arguments.length===1,Vh=_h?this.value:el;return this.forEach(function(rd){this.isRoot&&_h||(Vh=kn.call(this,Vh,rd))}),Vh},Wu.prototype.paths=function(){var kn=[];return this.forEach(function(el){kn.push(this.path)}),kn},Wu.prototype.nodes=function(){var kn=[];return this.forEach(function(el){kn.push(this.node)}),kn},Wu.prototype.clone=function(){var kn=[],el=[];return function _h(Vh){for(var rd=0;rd<kn.length;rd++)if(kn[rd]===Vh)return el[rd];if(typeof Vh=="object"&&Vh!==null){var od=Xr(Vh);return kn.push(Vh),el.push(od),eh(mr(Vh),function(sd){od[sd]=_h(Vh[sd])}),kn.pop(),el.pop(),od}return Vh}(this.value)};var mr=Object.keys||function(kn){var el=[];for(var _h in kn)el.push(_h);return el};function cs(kn){return Object.prototype.toString.call(kn)}var $u=Array.isArray||function(kn){return Object.prototype.toString.call(kn)==="[object Array]"},eh=function(kn,el){if(kn.forEach)return kn.forEach(el);for(var _h=0;_h<kn.length;_h++)el(kn[_h],_h,kn)};eh(mr(Wu.prototype),function(kn){Jh[kn]=function(el){var _h=[].slice.call(arguments,1),Vh=new Wu(el);return Vh[kn].apply(Vh,_h)}});var rh=Object.hasOwnProperty||function(kn,el){return el in kn},uh=dh;function dh(kn){if(!(this instanceof dh))return new dh(kn);this._bbox=kn||[1/0,1/0,-1/0,-1/0],this._valid=!!kn}dh.prototype.include=function(kn){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],kn[0]),this._bbox[1]=Math.min(this._bbox[1],kn[1]),this._bbox[2]=Math.max(this._bbox[2],kn[0]),this._bbox[3]=Math.max(this._bbox[3],kn[1]),this},dh.prototype.equals=function(kn){var el;return el=kn instanceof dh?kn.bbox():kn,this._bbox[0]==el[0]&&this._bbox[1]==el[1]&&this._bbox[2]==el[2]&&this._bbox[3]==el[3]},dh.prototype.center=function(kn){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},dh.prototype.union=function(kn){var el;return this._valid=!0,el=kn instanceof dh?kn.bbox():kn,this._bbox[0]=Math.min(this._bbox[0],el[0]),this._bbox[1]=Math.min(this._bbox[1],el[1]),this._bbox[2]=Math.max(this._bbox[2],el[2]),this._bbox[3]=Math.max(this._bbox[3],el[3]),this},dh.prototype.bbox=function(){return this._valid?this._bbox:null},dh.prototype.contains=function(kn){if(!kn)return this._fastContains();if(!this._valid)return null;var el=kn[0],_h=kn[1];return this._bbox[0]<=el&&this._bbox[1]<=_h&&this._bbox[2]>=el&&this._bbox[3]>=_h},dh.prototype.intersect=function(kn){return this._valid?(el=kn instanceof dh?kn.bbox():kn,!(this._bbox[0]>el[2]||this._bbox[2]<el[0]||this._bbox[3]<el[1]||this._bbox[1]>el[3])):null;var el},dh.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var kn="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",kn)},dh.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var yh=function(kn){if(!kn)return[];var el=Dd(lm(kn)),_h=[];return el.features.forEach(function(Vh){Vh.geometry&&(_h=_h.concat(Hf(Vh.geometry.coordinates)))}),_h},Ph=mh,Fh=uh,Ad={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},wd=Object.keys(Ad);function Kd(kn){for(var el=Fh(),_h=yh(kn),Vh=0;Vh<_h.length;Vh++)el.include(_h[Vh]);return el}Tm.exports=function(kn){return Kd(kn).bbox()},nm.polygon=function(kn){return Kd(kn).polygon()},nm.bboxify=function(kn){return Ph(kn).map(function(el){el&&wd.some(function(_h){return!!el[_h]&&Ad[_h].indexOf(el.type)!==-1})&&(el.bbox=Kd(el).bbox(),this.update(el))})};var xf=-90;function Ff(kn,el){var _h=xf,Vh=90,rd=xf,od=90,sd=270,Gf=-270;kn.forEach(function(_p){var sp=nm(_p),lp=sp[1],Zp=sp[3],Rm=sp[0],Yp=sp[2];lp>_h&&(_h=lp),Zp<Vh&&(Vh=Zp),Zp>rd&&(rd=Zp),lp<od&&(od=lp),Rm<sd&&(sd=Rm),Yp>Gf&&(Gf=Yp)});var Ef=el;return _h+Ef.lat>85&&(Ef.lat=85-_h),rd+Ef.lat>90&&(Ef.lat=90-rd),Vh+Ef.lat<-85&&(Ef.lat=-85-Vh),od+Ef.lat<xf&&(Ef.lat=xf-od),sd+Ef.lng<=-270&&(Ef.lng+=360*Math.ceil(Math.abs(Ef.lng)/360)),Gf+Ef.lng>=270&&(Ef.lng-=360*Math.ceil(Math.abs(Ef.lng)/360)),Ef}function rp(kn,el){var _h=Ff(kn.map(function(Vh){return Vh.toGeoJSON()}),el);kn.forEach(function(Vh){var rd,od=Vh.getCoordinates(),sd=function(Ef){var _p={lng:Ef[0]+_h.lng,lat:Ef[1]+_h.lat};return[_p.lng,_p.lat]},Gf=function(Ef){return Ef.map(function(_p){return sd(_p)})};Vh.type===Bt.POINT?rd=sd(od):Vh.type===Bt.LINE_STRING||Vh.type===Bt.MULTI_POINT?rd=od.map(sd):Vh.type===Bt.POLYGON||Vh.type===Bt.MULTI_LINE_STRING?rd=od.map(Gf):Vh.type===Bt.MULTI_POLYGON&&(rd=od.map(function(Ef){return Ef.map(function(_p){return Gf(_p)})})),Vh.incomingCoords(rd)})}var Ah={onSetup:function(kn){var el=this,_h={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:kn.featureIds||[]};return this.setSelected(_h.initiallySelectedFeatureIds.filter(function(Vh){return el.getFeature(Vh)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),_h},fireUpdate:function(){this.map.fire(yr.UPDATE,{action:Io.MOVE,features:this.getSelected().map(function(kn){return kn.toGeoJSON()})})},fireActionable:function(){var kn=this,el=this.getSelected(),_h=el.filter(function(Gf){return kn.isInstanceOf("MultiFeature",Gf)}),Vh=!1;if(el.length>1){Vh=!0;var rd=el[0].type.replace("Multi","");el.forEach(function(Gf){Gf.type.replace("Multi","")!==rd&&(Vh=!1)})}var od=_h.length>0,sd=el.length>0;this.setActionableState({combineFeatures:Vh,uncombineFeatures:od,trash:sd})},getUniqueIds:function(kn){return kn.length?kn.map(function(el){return el.properties.id}).filter(function(el){return el!==void 0}).reduce(function(el,_h){return el.add(_h),el},new sh).values():[]},stopExtendedInteractions:function(kn){kn.boxSelectElement&&(kn.boxSelectElement.parentNode&&kn.boxSelectElement.parentNode.removeChild(kn.boxSelectElement),kn.boxSelectElement=null),this.map.dragPan.enable(),kn.boxSelecting=!1,kn.canBoxSelect=!1,kn.dragMoving=!1,kn.canDragMove=!1},onStop:function(){Op.enable(this)},onMouseMove:function(kn){return this.stopExtendedInteractions(kn),!0},onMouseOut:function(kn){return!kn.dragMoving||this.fireUpdate()}};Ah.onTap=Ah.onClick=function(kn,el){return Kf(el)?this.clickAnywhere(kn,el):ad(rl.VERTEX)(el)?this.clickOnVertex(kn,el):If(el)?this.clickOnFeature(kn,el):void 0},Ah.clickAnywhere=function(kn){var el=this,_h=this.getSelectedIds();_h.length&&(this.clearSelectedFeatures(),_h.forEach(function(Vh){return el.doRender(Vh)})),Op.enable(this),this.stopExtendedInteractions(kn)},Ah.clickOnVertex=function(kn,el){this.changeMode(Fn.DIRECT_SELECT,{featureId:el.featureTarget.properties.parent,coordPath:el.featureTarget.properties.coord_path,startPos:el.lngLat}),this.updateUIClasses({mouse:nt.MOVE})},Ah.startOnActiveFeature=function(kn,el){this.stopExtendedInteractions(kn),this.map.dragPan.disable(),this.doRender(el.featureTarget.properties.id),kn.canDragMove=!0,kn.dragMoveLocation=el.lngLat},Ah.clickOnFeature=function(kn,el){var _h=this;Op.disable(this),this.stopExtendedInteractions(kn);var Vh=Jf(el),rd=this.getSelectedIds(),od=el.featureTarget.properties.id,sd=this.isSelected(od);if(!Vh&&sd&&this.getFeature(od).type!==Bt.POINT)return this.changeMode(Fn.DIRECT_SELECT,{featureId:od});sd&&Vh?(this.deselect(od),this.updateUIClasses({mouse:nt.POINTER}),rd.length===1&&Op.enable(this)):!sd&&Vh?(this.select(od),this.updateUIClasses({mouse:nt.MOVE})):sd||Vh||(rd.forEach(function(Gf){return _h.doRender(Gf)}),this.setSelected(od),this.updateUIClasses({mouse:nt.MOVE})),this.doRender(od)},Ah.onMouseDown=function(kn,el){return Xh(el)?this.startOnActiveFeature(kn,el):this.drawConfig.boxSelect&&Zd(el)?this.startBoxSelect(kn,el):void 0},Ah.startBoxSelect=function(kn,el){this.stopExtendedInteractions(kn),this.map.dragPan.disable(),kn.boxSelectStartLocation=Yf(el.originalEvent,this.map.getContainer()),kn.canBoxSelect=!0},Ah.onTouchStart=function(kn,el){if(Xh(el))return this.startOnActiveFeature(kn,el)},Ah.onDrag=function(kn,el){return kn.canDragMove?this.dragMove(kn,el):this.drawConfig.boxSelect&&kn.canBoxSelect?this.whileBoxSelect(kn,el):void 0},Ah.whileBoxSelect=function(kn,el){kn.boxSelecting=!0,this.updateUIClasses({mouse:nt.ADD}),kn.boxSelectElement||(kn.boxSelectElement=document.createElement("div"),kn.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(kn.boxSelectElement));var _h=Yf(el.originalEvent,this.map.getContainer()),Vh=Math.min(kn.boxSelectStartLocation.x,_h.x),rd=Math.max(kn.boxSelectStartLocation.x,_h.x),od=Math.min(kn.boxSelectStartLocation.y,_h.y),sd=Math.max(kn.boxSelectStartLocation.y,_h.y),Gf="translate("+Vh+"px, "+od+"px)";kn.boxSelectElement.style.transform=Gf,kn.boxSelectElement.style.WebkitTransform=Gf,kn.boxSelectElement.style.width=rd-Vh+"px",kn.boxSelectElement.style.height=sd-od+"px"},Ah.dragMove=function(kn,el){kn.dragMoving=!0,el.originalEvent.stopPropagation();var _h={lng:el.lngLat.lng-kn.dragMoveLocation.lng,lat:el.lngLat.lat-kn.dragMoveLocation.lat};rp(this.getSelected(),_h),kn.dragMoveLocation=el.lngLat},Ah.onTouchEnd=Ah.onMouseUp=function(kn,el){var _h=this;if(kn.dragMoving)this.fireUpdate();else if(kn.boxSelecting){var Vh=[kn.boxSelectStartLocation,Yf(el.originalEvent,this.map.getContainer())],rd=this.featuresAt(null,Vh,"click"),od=this.getUniqueIds(rd).filter(function(sd){return!_h.isSelected(sd)});od.length&&(this.select(od),od.forEach(function(sd){return _h.doRender(sd)}),this.updateUIClasses({mouse:nt.MOVE}))}this.stopExtendedInteractions(kn)},Ah.toDisplayFeatures=function(kn,el,_h){el.properties.active=this.isSelected(el.properties.id)?Co.ACTIVE:Co.INACTIVE,_h(el),this.fireActionable(),el.properties.active===Co.ACTIVE&&el.geometry.type!==Bt.POINT&&Xd(el).forEach(_h)},Ah.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ah.onCombineFeatures=function(){var kn=this.getSelected();if(!(kn.length===0||kn.length<2)){for(var el=[],_h=[],Vh=kn[0].type.replace("Multi",""),rd=0;rd<kn.length;rd++){var od=kn[rd];if(od.type.replace("Multi","")!==Vh)return;od.type.includes("Multi")?od.getCoordinates().forEach(function(Gf){el.push(Gf)}):el.push(od.getCoordinates()),_h.push(od.toGeoJSON())}if(_h.length>1){var sd=this.newFeature({type:Bt.FEATURE,properties:_h[0].properties,geometry:{type:"Multi"+Vh,coordinates:el}});this.addFeature(sd),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([sd.id]),this.map.fire(yr.COMBINE_FEATURES,{createdFeatures:[sd.toGeoJSON()],deletedFeatures:_h})}this.fireActionable()}},Ah.onUncombineFeatures=function(){var kn=this,el=this.getSelected();if(el.length!==0){for(var _h=[],Vh=[],rd=function(sd){var Gf=el[sd];kn.isInstanceOf("MultiFeature",Gf)&&(Gf.getFeatures().forEach(function(Ef){kn.addFeature(Ef),Ef.properties=Gf.properties,_h.push(Ef.toGeoJSON()),kn.select([Ef.id])}),kn.deleteFeature(Gf.id,{silent:!0}),Vh.push(Gf.toGeoJSON()))},od=0;od<el.length;od++)rd(od);_h.length>1&&this.map.fire(yr.UNCOMBINE_FEATURES,{createdFeatures:_h,deletedFeatures:Vh}),this.fireActionable()}};var Jd=ad(rl.VERTEX),Od=ad(rl.MIDPOINT),qf={fireUpdate:function(){this.map.fire(yr.UPDATE,{action:Io.CHANGE_COORDINATES,features:this.getSelected().map(function(kn){return kn.toGeoJSON()})})},fireActionable:function(kn){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:kn.selectedCoordPaths.length>0})},startDragging:function(kn,el){this.map.dragPan.disable(),kn.canDragMove=!0,kn.dragMoveLocation=el.lngLat},stopDragging:function(kn){this.map.dragPan.enable(),kn.dragMoving=!1,kn.canDragMove=!1,kn.dragMoveLocation=null},onVertex:function(kn,el){this.startDragging(kn,el);var _h=el.featureTarget.properties,Vh=kn.selectedCoordPaths.indexOf(_h.coord_path);Jf(el)||Vh!==-1?Jf(el)&&Vh===-1&&kn.selectedCoordPaths.push(_h.coord_path):kn.selectedCoordPaths=[_h.coord_path];var rd=this.pathsToCoordinates(kn.featureId,kn.selectedCoordPaths);this.setSelectedCoordinates(rd)},onMidpoint:function(kn,el){this.startDragging(kn,el);var _h=el.featureTarget.properties;kn.feature.addCoordinate(_h.coord_path,_h.lng,_h.lat),this.fireUpdate(),kn.selectedCoordPaths=[_h.coord_path]},pathsToCoordinates:function(kn,el){return el.map(function(_h){return{feature_id:kn,coord_path:_h}})},onFeature:function(kn,el){kn.selectedCoordPaths.length===0?this.startDragging(kn,el):this.stopDragging(kn)},dragFeature:function(kn,el,_h){rp(this.getSelected(),_h),kn.dragMoveLocation=el.lngLat},dragVertex:function(kn,el,_h){for(var Vh=kn.selectedCoordPaths.map(function(Gf){return kn.feature.getCoordinate(Gf)}),rd=Ff(Vh.map(function(Gf){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:Gf}}}),_h),od=0;od<Vh.length;od++){var sd=Vh[od];kn.feature.updateCoordinate(kn.selectedCoordPaths[od],sd[0]+rd.lng,sd[1]+rd.lat)}},clickNoTarget:function(){this.changeMode(Fn.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Fn.SIMPLE_SELECT)},clickActiveFeature:function(kn){kn.selectedCoordPaths=[],this.clearSelectedCoordinates(),kn.feature.changed()},onSetup:function(kn){var el=kn.featureId,_h=this.getFeature(el);if(!_h)throw new Error("You must provide a featureId to enter direct_select mode");if(_h.type===Bt.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Vh={featureId:el,feature:_h,dragMoveLocation:kn.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:kn.coordPath?[kn.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(el,Vh.selectedCoordPaths)),this.setSelected(el),Op.disable(this),this.setActionableState({trash:!0}),Vh},onStop:function(){Op.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(kn,el,_h){kn.featureId===el.properties.id?(el.properties.active=Co.ACTIVE,_h(el),Xd(el,{map:this.map,midpoints:!0,selectedPaths:kn.selectedCoordPaths}).forEach(_h)):(el.properties.active=Co.INACTIVE,_h(el)),this.fireActionable(kn)},onTrash:function(kn){kn.selectedCoordPaths.sort(function(el,_h){return _h.localeCompare(el,"en",{numeric:!0})}).forEach(function(el){return kn.feature.removeCoordinate(el)}),this.fireUpdate(),kn.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(kn),kn.feature.isValid()===!1&&(this.deleteFeature([kn.featureId]),this.changeMode(Fn.SIMPLE_SELECT,{}))},onMouseMove:function(kn,el){var _h=Xh(el),Vh=Jd(el),rd=kn.selectedCoordPaths.length===0;return _h&&rd||Vh&&!rd?this.updateUIClasses({mouse:nt.MOVE}):this.updateUIClasses({mouse:nt.NONE}),this.stopDragging(kn),!0},onMouseOut:function(kn){return kn.dragMoving&&this.fireUpdate(),!0}};qf.onTouchStart=qf.onMouseDown=function(kn,el){return Jd(el)?this.onVertex(kn,el):Xh(el)?this.onFeature(kn,el):Od(el)?this.onMidpoint(kn,el):void 0},qf.onDrag=function(kn,el){if(kn.canDragMove===!0){kn.dragMoving=!0,el.originalEvent.stopPropagation();var _h={lng:el.lngLat.lng-kn.dragMoveLocation.lng,lat:el.lngLat.lat-kn.dragMoveLocation.lat};kn.selectedCoordPaths.length>0?this.dragVertex(kn,el,_h):this.dragFeature(kn,el,_h),kn.dragMoveLocation=el.lngLat}},qf.onClick=function(kn,el){return Kf(el)?this.clickNoTarget(kn,el):Xh(el)?this.clickActiveFeature(kn,el):Ld(el)?this.clickInactive(kn,el):void this.stopDragging(kn)},qf.onTap=function(kn,el){return Kf(el)?this.clickNoTarget(kn,el):Xh(el)?this.clickActiveFeature(kn,el):Ld(el)?this.clickInactive(kn,el):void 0},qf.onTouchEnd=qf.onMouseUp=function(kn){kn.dragMoving&&this.fireUpdate(),this.stopDragging(kn)};var mp={};function Vp(kn,el){return!!kn.lngLat&&kn.lngLat.lng===el[0]&&kn.lngLat.lat===el[1]}mp.onSetup=function(){var kn=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:[]}});return this.addFeature(kn),this.clearSelectedFeatures(),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(_e.POINT),this.setActionableState({trash:!0}),{point:kn}},mp.stopDrawingAndRemove=function(kn){this.deleteFeature([kn.point.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT)},mp.onTap=mp.onClick=function(kn,el){this.updateUIClasses({mouse:nt.MOVE}),kn.point.updateCoordinate("",el.lngLat.lng,el.lngLat.lat),this.map.fire(yr.CREATE,{features:[kn.point.toGeoJSON()]}),this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.point.id]})},mp.onStop=function(kn){this.activateUIButton(),kn.point.getCoordinate().length||this.deleteFeature([kn.point.id],{silent:!0})},mp.toDisplayFeatures=function(kn,el,_h){var Vh=el.properties.id===kn.point.id;if(el.properties.active=Vh?Co.ACTIVE:Co.INACTIVE,!Vh)return _h(el)},mp.onTrash=mp.stopDrawingAndRemove,mp.onKeyUp=function(kn,el){if(Nf(el)||Wf(el))return this.stopDrawingAndRemove(kn,el)};var om={onSetup:function(){var kn=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POLYGON,coordinates:[[]]}});return this.addFeature(kn),this.clearSelectedFeatures(),Op.disable(this),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(_e.POLYGON),this.setActionableState({trash:!0}),{polygon:kn,currentVertexPosition:0}},clickAnywhere:function(kn,el){if(kn.currentVertexPosition>0&&Vp(el,kn.polygon.coordinates[0][kn.currentVertexPosition-1]))return this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.polygon.id]});this.updateUIClasses({mouse:nt.ADD}),kn.polygon.updateCoordinate("0."+kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),kn.currentVertexPosition++,kn.polygon.updateCoordinate("0."+kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat)},clickOnVertex:function(kn){return this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.polygon.id]})},onMouseMove:function(kn,el){kn.polygon.updateCoordinate("0."+kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),Df(el)&&this.updateUIClasses({mouse:nt.POINTER})}};om.onTap=om.onClick=function(kn,el){return Df(el)?this.clickOnVertex(kn,el):this.clickAnywhere(kn,el)},om.onKeyUp=function(kn,el){Nf(el)?(this.deleteFeature([kn.polygon.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT)):Wf(el)&&this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.polygon.id]})},om.onStop=function(kn){this.updateUIClasses({mouse:nt.NONE}),Op.enable(this),this.activateUIButton(),this.getFeature(kn.polygon.id)!==void 0&&(kn.polygon.removeCoordinate("0."+kn.currentVertexPosition),kn.polygon.isValid()?this.map.fire(yr.CREATE,{features:[kn.polygon.toGeoJSON()]}):(this.deleteFeature([kn.polygon.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT,{},{silent:!0})))},om.toDisplayFeatures=function(kn,el,_h){var Vh=el.properties.id===kn.polygon.id;if(el.properties.active=Vh?Co.ACTIVE:Co.INACTIVE,!Vh)return _h(el);if(el.geometry.coordinates.length!==0){var rd=el.geometry.coordinates[0].length;if(!(rd<3)){if(el.properties.meta=rl.FEATURE,_h(qp(kn.polygon.id,el.geometry.coordinates[0][0],"0.0",!1)),rd>3){var od=el.geometry.coordinates[0].length-3;_h(qp(kn.polygon.id,el.geometry.coordinates[0][od],"0."+od,!1))}if(rd<=4){var sd=[[el.geometry.coordinates[0][0][0],el.geometry.coordinates[0][0][1]],[el.geometry.coordinates[0][1][0],el.geometry.coordinates[0][1][1]]];if(_h({type:Bt.FEATURE,properties:el.properties,geometry:{coordinates:sd,type:Bt.LINE_STRING}}),rd===3)return}return _h(el)}}},om.onTrash=function(kn){this.deleteFeature([kn.polygon.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT)};var Pd={onSetup:function(kn){var el,_h,Vh=(kn=kn||{}).featureId,rd="forward";if(Vh){if(!(el=this.getFeature(Vh)))throw new Error("Could not find a feature with the provided featureId");var od=kn.from;if(od&&od.type==="Feature"&&od.geometry&&od.geometry.type==="Point"&&(od=od.geometry),od&&od.type==="Point"&&od.coordinates&&od.coordinates.length===2&&(od=od.coordinates),!od||!Array.isArray(od))throw new Error("Please use the `from` property to indicate which point to continue the line from");var sd=el.coordinates.length-1;if(el.coordinates[sd][0]===od[0]&&el.coordinates[sd][1]===od[1])_h=sd+1,el.addCoordinate.apply(el,[_h].concat(el.coordinates[sd]));else{if(el.coordinates[0][0]!==od[0]||el.coordinates[0][1]!==od[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");rd="backwards",_h=0,el.addCoordinate.apply(el,[_h].concat(el.coordinates[0]))}}else el=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.LINE_STRING,coordinates:[]}}),_h=0,this.addFeature(el);return this.clearSelectedFeatures(),Op.disable(this),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(_e.LINE),this.setActionableState({trash:!0}),{line:el,currentVertexPosition:_h,direction:rd}},clickAnywhere:function(kn,el){if(kn.currentVertexPosition>0&&Vp(el,kn.line.coordinates[kn.currentVertexPosition-1])||kn.direction==="backwards"&&Vp(el,kn.line.coordinates[kn.currentVertexPosition+1]))return this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.line.id]});this.updateUIClasses({mouse:nt.ADD}),kn.line.updateCoordinate(kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),kn.direction==="forward"?(kn.currentVertexPosition++,kn.line.updateCoordinate(kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat)):kn.line.addCoordinate(0,el.lngLat.lng,el.lngLat.lat)},clickOnVertex:function(kn){return this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.line.id]})},onMouseMove:function(kn,el){kn.line.updateCoordinate(kn.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),Df(el)&&this.updateUIClasses({mouse:nt.POINTER})}};Pd.onTap=Pd.onClick=function(kn,el){if(Df(el))return this.clickOnVertex(kn,el);this.clickAnywhere(kn,el)},Pd.onKeyUp=function(kn,el){Wf(el)?this.changeMode(Fn.SIMPLE_SELECT,{featureIds:[kn.line.id]}):Nf(el)&&(this.deleteFeature([kn.line.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT))},Pd.onStop=function(kn){Op.enable(this),this.activateUIButton(),this.getFeature(kn.line.id)!==void 0&&(kn.line.removeCoordinate(""+kn.currentVertexPosition),kn.line.isValid()?this.map.fire(yr.CREATE,{features:[kn.line.toGeoJSON()]}):(this.deleteFeature([kn.line.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT,{},{silent:!0})))},Pd.onTrash=function(kn){this.deleteFeature([kn.line.id],{silent:!0}),this.changeMode(Fn.SIMPLE_SELECT)},Pd.toDisplayFeatures=function(kn,el,_h){var Vh=el.properties.id===kn.line.id;if(el.properties.active=Vh?Co.ACTIVE:Co.INACTIVE,!Vh)return _h(el);el.geometry.coordinates.length<2||(el.properties.meta=rl.FEATURE,_h(qp(kn.line.id,el.geometry.coordinates[kn.direction==="forward"?el.geometry.coordinates.length-2:1],""+(kn.direction==="forward"?el.geometry.coordinates.length-2:1),!1)),_h(el))};var Hg={simple_select:Ah,direct_select:qf,draw_point:mp,draw_polygon:om,draw_line_string:Pd},$m={defaultMode:Fn.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Yd,modes:Hg,controls:{},userProperties:!1},I_={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Dy={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Pg(kn,el){return kn.map(function(_h){return _h.source?_h:op(_h,{id:_h.id+"."+el,source:el==="hot"?he.HOT:he.COLD})})}var l_={};(function(kn,el){var _h="__lodash_hash_undefined__",Vh=9007199254740991,rd="[object Arguments]",od="[object Array]",sd="[object Boolean]",Gf="[object Date]",Ef="[object Error]",_p="[object Function]",sp="[object Map]",lp="[object Number]",Zp="[object Object]",Rm="[object Promise]",Yp="[object RegExp]",Pm="[object Set]",kf="[object String]",Sp="[object Symbol]",Np="[object WeakMap]",Jm="[object ArrayBuffer]",Um="[object DataView]",bg=/^\[object .+?Constructor\]$/,kg=/^(?:0|[1-9]\d*)$/,Bm={};Bm["[object Float32Array]"]=Bm["[object Float64Array]"]=Bm["[object Int8Array]"]=Bm["[object Int16Array]"]=Bm["[object Int32Array]"]=Bm["[object Uint8Array]"]=Bm["[object Uint8ClampedArray]"]=Bm["[object Uint16Array]"]=Bm["[object Uint32Array]"]=!0,Bm[rd]=Bm[od]=Bm[Jm]=Bm[sd]=Bm[Um]=Bm[Gf]=Bm[Ef]=Bm[_p]=Bm[sp]=Bm[lp]=Bm[Zp]=Bm[Yp]=Bm[Pm]=Bm[kf]=Bm[Np]=!1;var fy=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Km=typeof self=="object"&&self&&self.Object===Object&&self,Xg=fy||Km||Function("return this")(),Ly=el&&!el.nodeType&&el,Ry=Ly&&kn&&!kn.nodeType&&kn,wg=Ry&&Ry.exports===Ly,u_=wg&&fy.process,Oy=function(){try{return u_&&u_.binding&&u_.binding("util")}catch{}}(),V_=Oy&&Oy.isTypedArray;function r0(hd,wf){for(var ip=-1,Bp=hd==null?0:hd.length;++ip<Bp;)if(wf(hd[ip],ip,hd))return!0;return!1}function O0(hd){var wf=-1,ip=Array(hd.size);return hd.forEach(function(Bp,Nm){ip[++wf]=[Nm,Bp]}),ip}function l1(hd){var wf=-1,ip=Array(hd.size);return hd.forEach(function(Bp){ip[++wf]=Bp}),ip}var tv,oy,o0,By=Array.prototype,py=Function.prototype,Vg=Object.prototype,fm=Xg["__core-js_shared__"],G_=py.toString,eg=Vg.hasOwnProperty,h_=(tv=/[^.]+$/.exec(fm&&fm.keys&&fm.keys.IE_PROTO||""))?"Symbol(src)_1."+tv:"",iv=Vg.toString,zy=RegExp("^"+G_.call(eg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j_=wg?Xg.Buffer:void 0,s0=Xg.Symbol,a0=Xg.Uint8Array,wm=Vg.propertyIsEnumerable,sy=By.splice,my=s0?s0.toStringTag:void 0,l0=Object.getOwnPropertySymbols,gy=j_?j_.isBuffer:void 0,vv=(oy=Object.keys,o0=Object,function(hd){return oy(o0(hd))}),ay=ly(Xg,"DataView"),cm=ly(Xg,"Map"),Ny=ly(Xg,"Promise"),Fy=ly(Xg,"Set"),q_=ly(Xg,"WeakMap"),d_=ly(Object,"create"),c0=__(ay),u0=__(cm),nv=__(Ny),$y=__(Fy),h0=__(q_),Eg=s0?s0.prototype:void 0,Z_=Eg?Eg.valueOf:void 0;function f_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var Bp=hd[wf];this.set(Bp[0],Bp[1])}}function p_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var Bp=hd[wf];this.set(Bp[0],Bp[1])}}function Kp(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var Bp=hd[wf];this.set(Bp[0],Bp[1])}}function M_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.__data__=new Kp;++wf<ip;)this.add(hd[wf])}function m_(hd){var wf=this.__data__=new p_(hd);this.size=wf.size}function Nv(hd,wf){var ip=yy(hd),Bp=!ip&&jy(hd),Nm=!ip&&!Bp&&Qg(hd),hm=!ip&&!Bp&&!Nm&&m0(hd),Qm=ip||Bp||Nm||hm,og=Qm?function(tp,Wg){for(var Sg=-1,fg=Array(tp);++Sg<tp;)fg[Sg]=Wg(Sg);return fg}(hd.length,String):[],sg=og.length;for(var Vm in hd)!wf&&!eg.call(hd,Vm)||Qm&&(Vm=="length"||Nm&&(Vm=="offset"||Vm=="parent")||hm&&(Vm=="buffer"||Vm=="byteLength"||Vm=="byteOffset")||f0(Vm,sg))||og.push(Vm);return og}function _y(hd,wf){for(var ip=hd.length;ip--;)if(H_(hd[ip][0],wf))return ip;return-1}function Uy(hd){return hd==null?hd===void 0?"[object Undefined]":"[object Null]":my&&my in Object(hd)?function(wf){var ip=eg.call(wf,my),Bp=wf[my];try{wf[my]=void 0;var Nm=!0}catch{}var hm=iv.call(wf);return Nm&&(ip?wf[my]=Bp:delete wf[my]),hm}(hd):function(wf){return iv.call(wf)}(hd)}function Xm(hd){return C_(hd)&&Uy(hd)==rd}function d0(hd,wf,ip,Bp,Nm){return hd===wf||(hd==null||wf==null||!C_(hd)&&!C_(wf)?hd!=hd&&wf!=wf:function(hm,Qm,og,sg,Vm,tp){var Wg=yy(hm),Sg=yy(Qm),fg=Wg?od:cy(hm),A_=Sg?od:cy(Qm),ap=(fg=fg==rd?Zp:fg)==Zp,Zy=(A_=A_==rd?Zp:A_)==Zp,vy=fg==A_;if(vy&&Qg(hm)){if(!Qg(Qm))return!1;Wg=!0,ap=!1}if(vy&&!ap)return tp||(tp=new m_),Wg||m0(hm)?zm(hm,Qm,og,sg,Vm,tp):function(Cm,sm,P_,Ng,W_,Dg,Gm){switch(P_){case Um:if(Cm.byteLength!=sm.byteLength||Cm.byteOffset!=sm.byteOffset)return!1;Cm=Cm.buffer,sm=sm.buffer;case Jm:return!(Cm.byteLength!=sm.byteLength||!Dg(new a0(Cm),new a0(sm)));case sd:case Gf:case lp:return H_(+Cm,+sm);case Ef:return Cm.name==sm.name&&Cm.message==sm.message;case Yp:case kf:return Cm==sm+"";case sp:var ag=O0;case Pm:var Jg=1&Ng;if(ag||(ag=l1),Cm.size!=sm.size&&!Jg)return!1;var k_=Gm.get(Cm);if(k_)return k_==sm;Ng|=2,Gm.set(Cm,sm);var em=zm(ag(Cm),ag(sm),Ng,W_,Dg,Gm);return Gm.delete(Cm),em;case Sp:if(Z_)return Z_.call(Cm)==Z_.call(sm)}return!1}(hm,Qm,fg,og,sg,Vm,tp);if(!(1&og)){var B0=ap&&eg.call(hm,"__wrapped__"),g0=Zy&&eg.call(Qm,"__wrapped__");if(B0||g0){var ov=B0?hm.value():hm,_0=g0?Qm.value():Qm;return tp||(tp=new m_),Vm(ov,_0,og,sg,tp)}}return vy?(tp||(tp=new m_),function(Cm,sm,P_,Ng,W_,Dg){var Gm=1&P_,ag=Im(Cm),Jg=ag.length,k_=Im(sm).length;if(Jg!=k_&&!Gm)return!1;for(var em=Jg;em--;){var Gg=ag[em];if(!(Gm?Gg in sm:eg.call(sm,Gg)))return!1}var bv=Dg.get(Cm);if(bv&&Dg.get(sm))return bv==sm;var Ig=!0;Dg.set(Cm,sm),Dg.set(sm,Cm);for(var Mm=Gm;++em<Jg;){var D_=Cm[Gg=ag[em]],xy=sm[Gg];if(Ng)var Hy=Gm?Ng(xy,D_,Gg,sm,Cm,Dg):Ng(D_,xy,Gg,Cm,sm,Dg);if(!(Hy===void 0?D_===xy||W_(D_,xy,P_,Ng,Dg):Hy)){Ig=!1;break}Mm||(Mm=Gg=="constructor")}if(Ig&&!Mm){var y0=Cm.constructor,Y_=sm.constructor;y0==Y_||!("constructor"in Cm)||!("constructor"in sm)||typeof y0=="function"&&y0 instanceof y0&&typeof Y_=="function"&&Y_ instanceof Y_||(Ig=!1)}return Dg.delete(Cm),Dg.delete(sm),Ig}(hm,Qm,og,sg,Vm,tp)):!1}(hd,wf,ip,Bp,d0,Nm))}function um(hd){return!(!p0(hd)||function(wf){return!!h_&&h_ in wf}(hd))&&(qy(hd)?zy:bg).test(__(hd))}function Vy(hd){if(ip=(wf=hd)&&wf.constructor,Bp=typeof ip=="function"&&ip.prototype||Vg,wf!==Bp)return vv(hd);var wf,ip,Bp,Nm=[];for(var hm in Object(hd))eg.call(hd,hm)&&hm!="constructor"&&Nm.push(hm);return Nm}function zm(hd,wf,ip,Bp,Nm,hm){var Qm=1&ip,og=hd.length,sg=wf.length;if(og!=sg&&!(Qm&&sg>og))return!1;var Vm=hm.get(hd);if(Vm&&hm.get(wf))return Vm==wf;var tp=-1,Wg=!0,Sg=2&ip?new M_:void 0;for(hm.set(hd,wf),hm.set(wf,hd);++tp<og;){var fg=hd[tp],A_=wf[tp];if(Bp)var ap=Qm?Bp(A_,fg,tp,wf,hd,hm):Bp(fg,A_,tp,hd,wf,hm);if(ap!==void 0){if(ap)continue;Wg=!1;break}if(Sg){if(!r0(wf,function(Zy,vy){if(B0=vy,!Sg.has(B0)&&(fg===Zy||Nm(fg,Zy,ip,Bp,hm)))return Sg.push(vy);var B0})){Wg=!1;break}}else if(fg!==A_&&!Nm(fg,A_,ip,Bp,hm)){Wg=!1;break}}return hm.delete(hd),hm.delete(wf),Wg}function Im(hd){return function(wf,ip,Bp){var Nm=ip(wf);return yy(wf)?Nm:function(hm,Qm){for(var og=-1,sg=Qm.length,Vm=hm.length;++og<sg;)hm[Vm+og]=Qm[og];return hm}(Nm,Bp(wf))}(hd,X_,xv)}function g_(hd,wf){var ip,Bp,Nm=hd.__data__;return((Bp=typeof(ip=wf))=="string"||Bp=="number"||Bp=="symbol"||Bp=="boolean"?ip!=="__proto__":ip===null)?Nm[typeof wf=="string"?"string":"hash"]:Nm.map}function ly(hd,wf){var ip=function(Bp,Nm){return Bp?.[Nm]}(hd,wf);return um(ip)?ip:void 0}f_.prototype.clear=function(){this.__data__=d_?d_(null):{},this.size=0},f_.prototype.delete=function(hd){var wf=this.has(hd)&&delete this.__data__[hd];return this.size-=wf?1:0,wf},f_.prototype.get=function(hd){var wf=this.__data__;if(d_){var ip=wf[hd];return ip===_h?void 0:ip}return eg.call(wf,hd)?wf[hd]:void 0},f_.prototype.has=function(hd){var wf=this.__data__;return d_?wf[hd]!==void 0:eg.call(wf,hd)},f_.prototype.set=function(hd,wf){var ip=this.__data__;return this.size+=this.has(hd)?0:1,ip[hd]=d_&&wf===void 0?_h:wf,this},p_.prototype.clear=function(){this.__data__=[],this.size=0},p_.prototype.delete=function(hd){var wf=this.__data__,ip=_y(wf,hd);return!(ip<0)&&(ip==wf.length-1?wf.pop():sy.call(wf,ip,1),--this.size,!0)},p_.prototype.get=function(hd){var wf=this.__data__,ip=_y(wf,hd);return ip<0?void 0:wf[ip][1]},p_.prototype.has=function(hd){return _y(this.__data__,hd)>-1},p_.prototype.set=function(hd,wf){var ip=this.__data__,Bp=_y(ip,hd);return Bp<0?(++this.size,ip.push([hd,wf])):ip[Bp][1]=wf,this},Kp.prototype.clear=function(){this.size=0,this.__data__={hash:new f_,map:new(cm||p_),string:new f_}},Kp.prototype.delete=function(hd){var wf=g_(this,hd).delete(hd);return this.size-=wf?1:0,wf},Kp.prototype.get=function(hd){return g_(this,hd).get(hd)},Kp.prototype.has=function(hd){return g_(this,hd).has(hd)},Kp.prototype.set=function(hd,wf){var ip=g_(this,hd),Bp=ip.size;return ip.set(hd,wf),this.size+=ip.size==Bp?0:1,this},M_.prototype.add=M_.prototype.push=function(hd){return this.__data__.set(hd,_h),this},M_.prototype.has=function(hd){return this.__data__.has(hd)},m_.prototype.clear=function(){this.__data__=new p_,this.size=0},m_.prototype.delete=function(hd){var wf=this.__data__,ip=wf.delete(hd);return this.size=wf.size,ip},m_.prototype.get=function(hd){return this.__data__.get(hd)},m_.prototype.has=function(hd){return this.__data__.has(hd)},m_.prototype.set=function(hd,wf){var ip=this.__data__;if(ip instanceof p_){var Bp=ip.__data__;if(!cm||Bp.length<199)return Bp.push([hd,wf]),this.size=++ip.size,this;ip=this.__data__=new Kp(Bp)}return ip.set(hd,wf),this.size=ip.size,this};var xv=l0?function(hd){return hd==null?[]:(hd=Object(hd),function(wf,ip){for(var Bp=-1,Nm=wf==null?0:wf.length,hm=0,Qm=[];++Bp<Nm;){var og=wf[Bp];ip(og,Bp,wf)&&(Qm[hm++]=og)}return Qm}(l0(hd),function(wf){return wm.call(hd,wf)}))}:function(){return[]},cy=Uy;function f0(hd,wf){return!!(wf=wf??Vh)&&(typeof hd=="number"||kg.test(hd))&&hd>-1&&hd%1==0&&hd<wf}function __(hd){if(hd!=null){try{return G_.call(hd)}catch{}try{return hd+""}catch{}}return""}function H_(hd,wf){return hd===wf||hd!=hd&&wf!=wf}(ay&&cy(new ay(new ArrayBuffer(1)))!=Um||cm&&cy(new cm)!=sp||Ny&&cy(Ny.resolve())!=Rm||Fy&&cy(new Fy)!=Pm||q_&&cy(new q_)!=Np)&&(cy=function(hd){var wf=Uy(hd),ip=wf==Zp?hd.constructor:void 0,Bp=ip?__(ip):"";if(Bp)switch(Bp){case c0:return Um;case u0:return sp;case nv:return Rm;case $y:return Pm;case h0:return Np}return wf});var jy=Xm(function(){return arguments}())?Xm:function(hd){return C_(hd)&&eg.call(hd,"callee")&&!wm.call(hd,"callee")},yy=Array.isArray,Qg=gy||function(){return!1};function qy(hd){if(!p0(hd))return!1;var wf=Uy(hd);return wf==_p||wf=="[object GeneratorFunction]"||wf=="[object AsyncFunction]"||wf=="[object Proxy]"}function rv(hd){return typeof hd=="number"&&hd>-1&&hd%1==0&&hd<=Vh}function p0(hd){var wf=typeof hd;return hd!=null&&(wf=="object"||wf=="function")}function C_(hd){return hd!=null&&typeof hd=="object"}var m0=V_?function(hd){return function(wf){return hd(wf)}}(V_):function(hd){return C_(hd)&&rv(hd.length)&&!!Bm[Uy(hd)]};function X_(hd){return(wf=hd)!=null&&rv(wf.length)&&!qy(wf)?Nv(hd):Vy(hd);var wf}kn.exports=function(hd,wf){return d0(hd,wf)}})({get exports(){return l_},set exports(kn){l_=kn}},l_);var ev=l_;function c_(kn,el){return kn.length===el.length&&JSON.stringify(kn.map(function(_h){return _h}).sort())===JSON.stringify(el.map(function(_h){return _h}).sort())}var ep={Polygon:Td,LineString:Ed,Point:qd,MultiPolygon:Gd,MultiLineString:Gd,MultiPoint:Gd},im=Object.freeze({__proto__:null,CommonSelectors:Cp,constrainFeatureMovement:Ff,createMidPoint:am,createSupplementaryPoints:Xd,createVertex:qp,doubleClickZoom:Op,euclideanDistance:cd,featuresAt:Mh,getFeatureAtAndSetCursors:Uh,isClick:Tf,isEventAtCoordinates:Vp,isTap:yf,mapEventToBoundingBox:sl,ModeHandler:n,moveFeatures:rp,sortFeatures:th,stringSetsAreEqual:c_,StringSet:sh,theme:Yd,toDenseArray:np}),Jp=function(kn,el){var _h={options:kn=function(rd){rd===void 0&&(rd={});var od=op(rd);return rd.controls||(od.controls={}),rd.displayControlsDefault===!1?od.controls=op(Dy,rd.controls):od.controls=op(I_,rd.controls),(od=op($m,od)).styles=Pg(od.styles,"cold").concat(Pg(od.styles,"hot")),od}(kn)};el=function(rd,od){return od.modes=Fn,od.getFeatureIdsAt=function(sd){return Mh.click({point:sd},null,rd).map(function(Gf){return Gf.properties.id})},od.getSelectedIds=function(){return rd.store.getSelectedIds()},od.getSelected=function(){return{type:Bt.FEATURE_COLLECTION,features:rd.store.getSelectedIds().map(function(sd){return rd.store.get(sd)}).map(function(sd){return sd.toGeoJSON()})}},od.getSelectedPoints=function(){return{type:Bt.FEATURE_COLLECTION,features:rd.store.getSelectedCoordinates().map(function(sd){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:sd.coordinates}}})}},od.set=function(sd){if(sd.type===void 0||sd.type!==Bt.FEATURE_COLLECTION||!Array.isArray(sd.features))throw new Error("Invalid FeatureCollection");var Gf=rd.store.createRenderBatch(),Ef=rd.store.getAllIds().slice(),_p=od.add(sd),sp=new sh(_p);return(Ef=Ef.filter(function(lp){return!sp.has(lp)})).length&&od.delete(Ef),Gf(),_p},od.add=function(sd){var Gf=JSON.parse(JSON.stringify(hp(sd))).features.map(function(Ef){if(Ef.id=Ef.id||Af(),Ef.geometry===null)throw new Error("Invalid geometry: null");if(rd.store.get(Ef.id)===void 0||rd.store.get(Ef.id).type!==Ef.geometry.type){var _p=ep[Ef.geometry.type];if(_p===void 0)throw new Error("Invalid geometry type: "+Ef.geometry.type+".");var sp=new _p(rd,Ef);rd.store.add(sp)}else{var lp=rd.store.get(Ef.id);lp.properties=Ef.properties,ev(lp.getCoordinates(),Ef.geometry.coordinates)||lp.incomingCoords(Ef.geometry.coordinates)}return Ef.id});return rd.store.render(),Gf},od.get=function(sd){var Gf=rd.store.get(sd);if(Gf)return Gf.toGeoJSON()},od.getAll=function(){return{type:Bt.FEATURE_COLLECTION,features:rd.store.getAll().map(function(sd){return sd.toGeoJSON()})}},od.delete=function(sd){return rd.store.delete(sd,{silent:!0}),od.getMode()!==Fn.DIRECT_SELECT||rd.store.getSelectedIds().length?rd.store.render():rd.events.changeMode(Fn.SIMPLE_SELECT,void 0,{silent:!0}),od},od.deleteAll=function(){return rd.store.delete(rd.store.getAllIds(),{silent:!0}),od.getMode()===Fn.DIRECT_SELECT?rd.events.changeMode(Fn.SIMPLE_SELECT,void 0,{silent:!0}):rd.store.render(),od},od.changeMode=function(sd,Gf){return Gf===void 0&&(Gf={}),sd===Fn.SIMPLE_SELECT&&od.getMode()===Fn.SIMPLE_SELECT?(c_(Gf.featureIds||[],rd.store.getSelectedIds())||(rd.store.setSelected(Gf.featureIds,{silent:!0}),rd.store.render()),od):(sd===Fn.DIRECT_SELECT&&od.getMode()===Fn.DIRECT_SELECT&&Gf.featureId===rd.store.getSelectedIds()[0]||rd.events.changeMode(sd,Gf,{silent:!0}),od)},od.getMode=function(){return rd.events.getMode()},od.trash=function(){return rd.events.trash({silent:!0}),od},od.combineFeatures=function(){return rd.events.combineFeatures({silent:!0}),od},od.uncombineFeatures=function(){return rd.events.uncombineFeatures({silent:!0}),od},od.setFeatureProperty=function(sd,Gf,Ef){return rd.store.setFeatureProperty(sd,Gf,Ef),od},od}(_h,el),_h.api=el;var Vh=Qh(_h);return el.onAdd=Vh.onAdd,el.onRemove=Vh.onRemove,el.types=_e,el.options=kn,el};function mm(kn){Jp(kn,this)}return mm.modes=Hg,mm.constants=lh,mm.lib=im,mm})})(mapboxGlDraw$1);var mapboxGlDrawExports=mapboxGlDraw$1.exports;const MapboxDraw=getDefaultExportFromCjs(mapboxGlDrawExports),mapboxGlDraw="";var DrawAssistedRectangle$1={};Object.defineProperty(DrawAssistedRectangle$1,"__esModule",{value:!0});var doubleClickZoom={enable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},DrawAssistedRectangle={onSetup:function e(t){var n=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(n),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:n,currentVertexPosition:0}},onTap:function e(t,n){this.onClick(t,n)},onClick:function e(t,n){if(t.currentVertexPosition===2){var r=this.calculatepXY3(t,n,!1);return r&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),r[0],r[1]),this.updateUIClasses({mouse:"pointer"}),this.changeMode("simple_select",{featuresId:t.rectangle.id})}else t.rectangle.updateCoordinate("0."+t.currentVertexPosition,n.lngLat.lng,n.lngLat.lat),t.currentVertexPosition++,t.rectangle.updateCoordinate("0."+t.currentVertexPosition,n.lngLat.lng,n.lngLat.lat)},onMouseMove:function e(t,n){if(t.rectangle.updateCoordinate("0."+t.currentVertexPosition,n.lngLat.lng,n.lngLat.lat),t.currentVertexPosition&&t.currentVertexPosition>0&&this.calculateOrientedAnglePolygon(t),t.currentVertexPosition===2){var r=this.calculatepXY3(t,n,!0);r&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),r[0],r[1])}},deegrees2meters:function e(t){var n=t[0]*2003750834e-2/180,r=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return r=r*2003750834e-2/180,[n,r]},meters2degress:function e(t){var n=t[0]*180/2003750834e-2,r=Math.atan(Math.exp(t[1]*Math.PI/2003750834e-2))*360/Math.PI-90;return[n,r]},calculateOrientedAnglePolygon:function e(t){var n=t.rectangle.getCoordinate("0.0"),r=this.deegrees2meters(n),s=t.rectangle.getCoordinate("0.1"),l=this.deegrees2meters(s),p=Math.atan2(l[1]-r[1],l[0]-r[0])*180/Math.PI,o=-1*(p+90),x=o<0?o+360:o;t.angle=parseFloat(x.toFixed(2))},calculatepXY3:function e(t,n,r){var s=t.rectangle.getCoordinate("0.0"),l=this.deegrees2meters(s),p=t.rectangle.getCoordinate("0.1"),o=this.deegrees2meters(p),x=this.deegrees2meters([n.lngLat.lng,n.lngLat.lat]),M=this.deegrees2meters([n.lngLat.lng,n.lngLat.lat]);if(l[0]===o[0])x=[M[0],o[1]];else if(l[1]===o[1])x=[o[0],M[1]];else{var P=(o[1]-l[1])/(o[0]-l[0]),he=-1/P;Math.abs(he)<1?x[1]=he*(M[0]-o[0])+o[1]:x[0]=o[0]+(x[1]-o[1])/he}var nt=[o[0]-l[0],o[1]-l[1]],_e=[x[0]-nt[0],x[1]-nt[1]],Bt=this.meters2degress(x),Fn=this.meters2degress(_e);return t.rectangle.updateCoordinate("0.2",Bt[0],Bt[1]),t.rectangle.updateCoordinate("0.3",Fn[0],Fn[1]),Fn},onKeyUp:function e(t,n){if(n.keyCode===27)return this.changeMode("simple_select")},onStop:function e(t){doubleClickZoom.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(t.rectangle.id)!==void 0&&(t.rectangle.removeCoordinate("0.4"),t.rectangle.isValid()?this.map.fire("draw.create",{features:[t.rectangle.toGeoJSON()]}):(this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function e(t,n,r){var s=n.properties.id===t.rectangle.id;if(n.properties.active=s?"true":"false",n.properties.angle=t.angle,n.angle=t.angle,!s)return r(n);var l=n.geometry.coordinates[0].length;if(l<3){var p=n.geometry.coordinates[0][0],o={type:"Feature",properties:n.properties,angle:t.angle,geometry:{coordinates:n.geometry.coordinates[0][0],type:"Point"}};p&&r(o);return}if(l>=3&&l<=4){var x=[[n.geometry.coordinates[0][0][0],n.geometry.coordinates[0][0][1]],[n.geometry.coordinates[0][1][0],n.geometry.coordinates[0][1][1]]];if(r({type:"Feature",properties:n.properties,angle:t.angle,geometry:{coordinates:x,type:"LineString"}}),l===3)return}return r(n)},onTrash:function e(t){this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select")}},_default=DrawAssistedRectangle$1.default=DrawAssistedRectangle;class MapboxGLButtonControl{constructor({className:t="",title:n="",eventHandler:r=evtHndlr}){this._className=t,this._title=n,this._eventHandler=r}onAdd(t){return this._btn=document.createElement("button"),this._btn.className="mapboxgl-ctrl-icon "+this._className,this._btn.type="button",this._btn.title=this._title,this._btn.onclick=this._eventHandler,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const styles="";var tilesInBbox={};function lonToX(e,t){var n=Math.pow(2,t),r=Math.floor((e+180)/360*n);return r}function latToY(e,t){var n=e*Math.PI/180,r=Math.pow(2,t),s=Math.floor((1-Math.log(Math.tan(n)+1/Math.cos(n))/Math.PI)/2*r);return s}tilesInBbox.tilesInBbox=function(e,t){for(var n=[],r=lonToX(e.left,t),s=lonToX(e.right,t),l=latToY(e.top,t),p=latToY(e.bottom,t),o=r;o<=s;){for(var x=l;x<=p;)n.push({x:o,y:x,z:t}),x++;o++}return n};function useQuasar(){return inject(quasarKey)}const mapboxMapViewer_vue_vue_type_style_index_0_lang="";let draw,geocoder;const STYLES_DRAW=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#FF0000","fill-outline-color":"#D20C0C","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#ee0508","fill-opacity":.8}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c40b0b","line-width":2}}],_sfc_main$5={name:"mapbox-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,style_url:ref(""),zoom:ref(""),access_token:ref(""),rasterFromStyle:ref(!1),mapbox_raster_png_dem:ref(""),mapbox_api_url:ref(""),drawmode:ref("simple_select"),mapbox_rgb_image_url:ref(""),map:ref(""),features:ref([]),threedview:ref(!1),layers:ref(["hillshading","bounding_box","undersea-features-lines","undersea-features-points","undersea-features-points-label","10m-bathymetry-81bsvj"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Undersea Lines",value:"undersea-features-lines"},{label:"Undersea Points",value:"undersea-features-points"},{label:"Undersea Labels",value:"undersea-features-points-label"},{label:"Depth",value:"10m-bathymetry-81bsvj"},{label:"Satellite",value:"satellite"},{label:"3D",value:"3d"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setTerrain({source:"mapbox-3d",exaggeration:1.5}):t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","none"):this.map.setTerrain(null)},changeDrawMode(e){let t=document.getElementsByClassName("mapbox-gl-draw_polygon")[0],n=document.getElementsByClassName("mapbox-gl-draw_line")[0],r=e.target;r.title==="Select single tile"?(n.style.backgroundColor="white",t.style.backgroundColor="green",draw.deleteAll(),draw.changeMode("simple_select"),this.drawmode="simple_select"):r.title==="Draw Rectangle to select multiple tiles"&&(n.style.backgroundColor="green",t.style.backgroundColor="white",draw.deleteAll(),draw.changeMode("draw_assisted_rectangle"),this.drawmode="draw_assisted_rectangle",this.map.setPaintProperty("bounding_box","fill-opacity",0)),console.log(this.drawmode)},loadMapSourcesLayers(e){this.rasterFromStyle===!1&&(e.addSource("mapbox_terrain_dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),e.addSource("satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}}),e.addLayer({id:"hillshading",source:"mapbox_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),e.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),e.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),e.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),e.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),e.addSource("mapbox-3d",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:15}),e.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon"))},coordinateFeature(e,t){return{center:[e,t],geometry:{type:"Point",coordinates:[e,t]},place_name:"Lat: "+t+" Lng: "+e,place_type:["coordinate"],properties:{},type:"Feature"}},resizeMap(){this.map.resize()},async geoCodeReverse(e){mbxGeocoding({accessToken:mapboxgl.accessToken}).reverseGeocode({query:[e.pointLng,e.pointLat]}).send().then(function(n){if(n&&n.body&&n.body.features){e.address=n.body.features[0].place_name;let r=n.body.features[0].context;for(let s of r){let l=s.id;switch(l.substring(0,l.indexOf("."))){case"neighborhood":e.neighborhood=s.text;break;case"postcode":e.postcode=s.text;break;case"locality":e.locality=s.text;break;case"place":e.place=s.text;break;case"district":e.district=s.text;break;case"region":e.region=s.text;break;case"country":e.country=s.text;break}}}})},updateBBox(e){let t=e.features[0].geometry.coordinates[0],n,r,s,l;n=t[3][0],r=t[3][1],s=t[1][0],l=t[1][1];let p=[n,r,s,l],o=mapUtils.getTileInfo(0,0,!0,0,0,0,p);idbKeyval.set("tile_info",o)},async loadMapboxMap(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.mapbox_api_url=await idbKeyval.get("mapbox_api_url"),this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("mapbox_style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem");let e=this;if(!mapboxgl.supported())this.alertMsg="Your browser does not support Mapbox GL",this.alert=!0;else{let o=function(x){return x*(2-x)},t=new mapboxgl.Map({container:"map",trackResize:!0,style:e.style_url,center:[-121.7598,46.876],zoom:9,maxZoom:14,doubleClickZoom:!1,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=t,this.map.doubleClickZoom.disable();const n=function(x){const M=x.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!M)return null;const P=Number(M[1]),he=Number(M[2]),nt=[];return(P<-90||P>90)&&nt.push(e.coordinateFeature(P,he)),(he<-90||he>90)&&nt.push(e.coordinateFeature(he,P)),nt.length===0&&(nt.push(e.coordinateFeature(P,he)),nt.push(e.coordinateFeature(he,P))),nt};geocoder=new MapboxGeocoder$1({accessToken:this.access_token,mapboxgl,localGeocoder:n,zoom:10,placeholder:"Try: Lng , Lat or Name",reverseGeocode:!0}),t.addControl(geocoder),t.addControl(new mapboxgl.FullscreenControl({})),t.addControl(new mapboxgl.NavigationControl),draw=new MapboxDraw({modes:{...MapboxDraw.modes,draw_assisted_rectangle:_default},displayControlsDefault:!1,controls:{},userProperties:!0,styles:STYLES_DRAW}),t.addControl(draw);const r=new MapboxGLButtonControl({className:"mapbox-gl-draw_polygon",title:"Select single tile",eventHandler:e.changeDrawMode});t.addControl(r);const s=new MapboxGLButtonControl({className:"mapbox-gl-draw_line",title:"Draw Rectangle to select multiple tiles",eventHandler:e.changeDrawMode});t.addControl(s);const l=100,p=25;t.on("wheel",()=>{e.zoom=Math.floor(t.getZoom())}),t.on("load",function(){let x=document.getElementsByClassName("mapbox-gl-draw_polygon")[0];x.style.backgroundColor="green",draw.changeMode("simple_select"),this.drawmode="simple_select",e.loadMapSourcesLayers(t),t.getCanvas().focus(),t.getCanvas().addEventListener("keydown",M=>{M.preventDefault(),M.which===87?t.panBy([0,-l],{easing:o}):M.which===83?t.panBy([0,l],{easing:o}):M.which===65?t.easeTo({bearing:t.getBearing()-p,easing:o}):M.which===68&&t.easeTo({bearing:t.getBearing()+p,easing:o})},!0)}),t.on("error",x=>{console.error(x)}),t.on("draw.create",function(x){console.log("draw mode create "+x.type),e.updateBBox(x)}),t.on("draw.update",function(x){console.log("draw mode update "+x.type),e.updateBBox(x)}),t.on("draw.selectionchange",function(x){console.log("draw mode selectionchange "+x.type)}),t.on("draw.delete",function(x){console.log("draw mode delete "+x.type)}),t.on("draw.modechange",x=>{console.log("draw mode CHANGE "+x.mode)}),t.on("click",async function(x){if(e.drawmode==="simple_select"){let M=x.lngLat.lng,P=x.lngLat.lat,he=Math.floor(t.getZoom());e.zoom=he;let nt=mapUtils.getTileInfo(M,P,!1,0,0,he);idbKeyval.set("tile_info",nt),e.tileInfoString="Slippy Tile Info String: "+nt.x+","+nt.y+","+nt.z+" Bounding Box sides in KM: "+nt.distance,t.getSource("bounding_box_source").setData(nt.polygon_bb),t.setPaintProperty("bounding_box","fill-opacity",.45)}}),t.on("dblclick",async function(x){let M=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(M,!0)===!1){console.error(`User did not grant permission to '${M.name}'`);return}let P=await idbKeyval.get("tile_info");if(e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.drawmode==="simple_select"){e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let he=await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url),nt=await he.toBuffer();await idbKeyval.set("rgb_image_buffer",nt),await fileUtils.writeFileToDisk(M,P.rgbFileName,nt);let _e=mapUtils.createHeightMapImage(he,32,"GREY");if(await fileUtils.fileExists(M,P.thirtyTwoFileName)===!1){let Fn=await _e.image.toBuffer();await fileUtils.writeFileToDisk(M,P.thirtyTwoFileName,Fn)}emitter.emit("updatePreviewImage",{dir_handle:M,tile_info:P,preview_image_info:_e,map:t})}else if(e.drawmode==="draw_assisted_rectangle"){let he=await idbKeyval.get("exportOptionsModel"),nt=await idbKeyval.get("backendServer"),_e=await idbKeyval.get("saveStitchingFiles"),Bt=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",Fn=await idbKeyval.get("mapbox_raster_style_url")||"",yr=Math.floor(t.getZoom()),Io=!0;e.qt.loading.show();try{const rl=await fetch(nt,{method:"GET"})}catch(rl){console.log(rl),Io=!1,e.qt.loading.hide()}if(Io===!0){let rl={left:P.bbox[0],bottom:P.bbox[1],right:P.bbox[2],top:P.bbox[3]},Co=tilesInBbox.tilesInBbox(rl,yr),as=[],Js=[],lh=[];for(let Zu of Co){let th={};P=mapUtils.getTileInfo(0,0,!0,Zu.x,Zu.y,Zu.z,P.bbox),e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let sh=await(await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url)).toBuffer();_e===!0&&await fileUtils.writeFileToDisk(M,P.rgbFileName,sh);let xh=sh.toString();if(th.x=P.x,th.y=P.y,th.buffer=xh,as.push(th),he.includes("raster_style")){let Mh=Bt+"/"+Fn+`/tiles/512/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,Uh=await(await mapUtils.getMapboxTerrainRgb(Mh)).toBuffer();th={};let cd=Uh.toString();th.x=P.x,th.y=P.y,th.buffer=cd,Js.push(th)}if(he.includes("satellite")){let Dh=await idbKeyval.get("mapbox_satellite_endpoint")+`/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,cd=await(await mapUtils.getMapboxTerrainRgb(Dh)).toBuffer();th={};let Tf=cd.toString();th.x=P.x,th.y=P.y,th.buffer=Tf,lh.push(th)}}idbKeyval.set("tile_info",P);let ch=JSON.stringify(as);try{let th=await(await fetch(nt,{method:"POST",body:ch,headers:{"Content-Type":"application/json"}})).arrayBuffer();if(await idbKeyval.set("rgb_image_buffer",th),await fileUtils.writeFileToDisk(M,P.rgbFileName,th),he.includes("raster_style")){let Mh=JSON.stringify(Js),Uh=await(await fetch(nt,{method:"POST",body:Mh,headers:{"Content-Type":"application/json"}})).arrayBuffer();await idbKeyval.set("splat_image_buffer",Uh),await fileUtils.writeFileToDisk(M,"splat_"+P.rgbFileName,Uh)}if(he.includes("satellite")){let Mh=JSON.stringify(lh),Uh=await(await fetch(nt,{method:"POST",body:Mh,headers:{"Content-Type":"application/json"}})).arrayBuffer();await idbKeyval.set("sat_image_buffer",Uh),await fileUtils.writeFileToDisk(M,"sat_"+P.rgbFileName,Uh)}let sl=await mapUtils.loadImageFromArray(th),sh=mapUtils.createHeightMapImage(sl,32,"GREY");if(await fileUtils.fileExists(M,P.thirtyTwoFileName)===!1){let Mh=await sh.image.toBuffer();await fileUtils.writeFileToDisk(M,P.thirtyTwoFileName,Mh)}emitter.emit("updatePreviewImage",{dir_handle:M,tile_info:P,preview_image_info:sh,map:t})}catch(Zu){console.log(Zu),e.alertMsg=Zu,e.alert=!0,e.qt.loading.hide()}e.qt.loading.hide()}else e.alertMsg="Cannot connect to backend server for stitching tiles.",e.alert=!0,e.qt.loading.hide()}})}}}},_hoisted_1$5={id:"map"},_hoisted_2$4=createBaseVNode("pre",{id:"features"},null,-1),_hoisted_3$4={class:"row no-wrap q-pa-md"},_hoisted_4$4={class:"column"},_hoisted_5$3=createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1),_hoisted_6$3=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$5(e,t,n,r,s,l){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$5,[_hoisted_2$4,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("div",_hoisted_4$4,[_hoisted_5$3,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:r.layer_type,type:"toggle",modelValue:r.layers,"onUpdate:modelValue":[t[0]||(t[0]=p=>r.layers=p),l.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode("       "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:r.alert,"onUpdate:modelValue":t[1]||(t[1]=p=>r.alert=p)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_6$3]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MapboxMapViewer=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),maptilerSdk="";var maplibreGl={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(commonjsGlobal,function(){var n,r,s;function l(o,x){if(!n)n=x;else if(!r)r=x;else{var M="var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk);",P={};n(P),s=x(P),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}l(["exports"],function(o){var x=M;function M(_,f,S,j){this.cx=3*_,this.bx=3*(S-_)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(j-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=_,this.p1y=f,this.p2x=S,this.p2y=j}function P(_,f,S,j){const ut=new x(_,f,S,j);return function(Ot){return ut.solve(Ot)}}M.prototype={sampleCurveX:function(_){return((this.ax*_+this.bx)*_+this.cx)*_},sampleCurveY:function(_){return((this.ay*_+this.by)*_+this.cy)*_},sampleCurveDerivativeX:function(_){return(3*this.ax*_+2*this.bx)*_+this.cx},solveCurveX:function(_,f){if(f===void 0&&(f=1e-6),_<0)return 0;if(_>1)return 1;for(var S=_,j=0;j<8;j++){var ut=this.sampleCurveX(S)-_;if(Math.abs(ut)<f)return S;var Ot=this.sampleCurveDerivativeX(S);if(Math.abs(Ot)<1e-6)break;S-=ut/Ot}var fi=0,Ur=1;for(S=_,j=0;j<20&&(ut=this.sampleCurveX(S),!(Math.abs(ut-_)<f));j++)_>ut?fi=S:Ur=S,S=.5*(Ur-fi)+fi;return S},solve:function(_,f){return this.sampleCurveY(this.solveCurveX(_,f))}};const he=P(.25,.1,.25,1);function nt(_,f,S){return Math.min(S,Math.max(f,_))}function _e(_,f,S){const j=S-f,ut=((_-f)%j+j)%j+f;return ut===f?S:ut}function Bt(_,...f){for(const S of f)for(const j in S)_[j]=S[j];return _}let Fn=1;function yr(_,f){_.forEach(S=>{f[S]&&(f[S]=f[S].bind(f))})}function Io(_,f,S){const j={};for(const ut in _)j[ut]=f.call(S||this,_[ut],ut,_);return j}function rl(_,f,S){const j={};for(const ut in _)f.call(S||this,_[ut],ut,_)&&(j[ut]=_[ut]);return j}function Co(_){return Array.isArray(_)?_.map(Co):typeof _=="object"&&_?Io(_,Co):_}const as={};function Js(_){as[_]||(typeof console<"u"&&console.warn(_),as[_]=!0)}function lh(_,f,S){return(S.y-_.y)*(f.x-_.x)>(f.y-_.y)*(S.x-_.x)}function ch(_){let f=0;for(let S,j,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)S=_[ut],j=_[fi],f+=(j.x-S.x)*(S.y+j.y);return f}function Zu(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let th=null;function sl(_){if(th==null){const f=_.navigator?_.navigator.userAgent:null;th=!!_.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return th}function sh(_){return typeof ImageBitmap<"u"&&_ instanceof ImageBitmap}const xh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mh,Dh;const Uh={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_){const f=requestAnimationFrame(_);return{cancel:()=>cancelAnimationFrame(f)}},getImageData(_,f=0){return this.getImageCanvasContext(_).getImageData(-f,-f,_.width+2*f,_.height+2*f)},getImageCanvasContext(_){const f=window.document.createElement("canvas"),S=f.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return f.width=_.width,f.height=_.height,S.drawImage(_,0,0,_.width,_.height),S},resolveURL:_=>(Mh||(Mh=document.createElement("a")),Mh.href=_,Mh.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Dh==null&&(Dh=matchMedia("(prefers-reduced-motion: reduce)")),Dh.matches)}};var cd=Tf;function Tf(_,f){this.x=_,this.y=f}Tf.prototype={clone:function(){return new Tf(this.x,this.y)},add:function(_){return this.clone()._add(_)},sub:function(_){return this.clone()._sub(_)},multByPoint:function(_){return this.clone()._multByPoint(_)},divByPoint:function(_){return this.clone()._divByPoint(_)},mult:function(_){return this.clone()._mult(_)},div:function(_){return this.clone()._div(_)},rotate:function(_){return this.clone()._rotate(_)},rotateAround:function(_,f){return this.clone()._rotateAround(_,f)},matMult:function(_){return this.clone()._matMult(_)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(_){return this.x===_.x&&this.y===_.y},dist:function(_){return Math.sqrt(this.distSqr(_))},distSqr:function(_){var f=_.x-this.x,S=_.y-this.y;return f*f+S*S},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(_){return Math.atan2(this.y-_.y,this.x-_.x)},angleWith:function(_){return this.angleWithSep(_.x,_.y)},angleWithSep:function(_,f){return Math.atan2(this.x*f-this.y*_,this.x*_+this.y*f)},_matMult:function(_){var f=_[2]*this.x+_[3]*this.y;return this.x=_[0]*this.x+_[1]*this.y,this.y=f,this},_add:function(_){return this.x+=_.x,this.y+=_.y,this},_sub:function(_){return this.x-=_.x,this.y-=_.y,this},_mult:function(_){return this.x*=_,this.y*=_,this},_div:function(_){return this.x/=_,this.y/=_,this},_multByPoint:function(_){return this.x*=_.x,this.y*=_.y,this},_divByPoint:function(_){return this.x/=_.x,this.y/=_.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var _=this.y;return this.y=this.x,this.x=-_,this},_rotate:function(_){var f=Math.cos(_),S=Math.sin(_),j=S*this.x+f*this.y;return this.x=f*this.x-S*this.y,this.y=j,this},_rotateAround:function(_,f){var S=Math.cos(_),j=Math.sin(_),ut=f.y+j*(this.x-f.x)+S*(this.y-f.y);return this.x=f.x+S*(this.x-f.x)-j*(this.y-f.y),this.y=ut,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tf.convert=function(_){return _ instanceof Tf?_:Array.isArray(_)?new Tf(_[0],_[1]):_};const yf={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{}};class Af extends Error{constructor(f,S,j,ut){super(`AJAXError: ${S} (${f}): ${j}`),this.status=f,this.statusText=S,this.url=j,this.body=ut}}const md=Zu()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function vd(_,f){const S=new AbortController,j=new Request(_.url,{method:_.method||"GET",body:_.body,credentials:_.credentials,headers:_.headers,referrer:md(),signal:S.signal});let ut=!1,Ot=!1;return _.type==="json"&&j.headers.set("Accept","application/json"),Ot||fetch(j).then(fi=>fi.ok?(Ur=>{(_.type==="arrayBuffer"?Ur.arrayBuffer():_.type==="json"?Ur.json():Ur.text()).then(us=>{Ot||(ut=!0,f(null,us,Ur.headers.get("Cache-Control"),Ur.headers.get("Expires")))}).catch(us=>{Ot||f(new Error(us.message))})})(fi):fi.blob().then(Ur=>f(new Af(fi.status,fi.statusText,_.url,Ur)))).catch(fi=>{fi.code!==20&&f(new Error(fi.message))}),{cancel:()=>{Ot=!0,ut||S.abort()}}}const qd=function(_,f){if(/:\/\//.test(_.url)&&!/^https?:|^file:/.test(_.url)){if(Zu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,f);if(!Zu()){const j=_.url.substring(0,_.url.indexOf("://"));return(yf.REGISTERED_PROTOCOLS[j]||vd)(_,f)}}if(!(/^file:/.test(S=_.url)||/^file:/.test(md())&&!/^\w+:/.test(S))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vd(_,f);if(Zu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,f,void 0,!0)}var S;return function(j,ut){const Ot=new XMLHttpRequest;Ot.open(j.method||"GET",j.url,!0),j.type==="arrayBuffer"&&(Ot.responseType="arraybuffer");for(const fi in j.headers)Ot.setRequestHeader(fi,j.headers[fi]);return j.type==="json"&&(Ot.responseType="text",Ot.setRequestHeader("Accept","application/json")),Ot.withCredentials=j.credentials==="include",Ot.onerror=()=>{ut(new Error(Ot.statusText))},Ot.onload=()=>{if((Ot.status>=200&&Ot.status<300||Ot.status===0)&&Ot.response!==null){let fi=Ot.response;if(j.type==="json")try{fi=JSON.parse(Ot.response)}catch(Ur){return ut(Ur)}ut(null,fi,Ot.getResponseHeader("Cache-Control"),Ot.getResponseHeader("Expires"))}else{const fi=new Blob([Ot.response],{type:Ot.getResponseHeader("Content-Type")});ut(new Af(Ot.status,Ot.statusText,j.url,fi))}},Ot.send(j.body),{cancel:()=>Ot.abort()}}(_,f)},Ed=function(_,f){return qd(Bt(_,{type:"arrayBuffer"}),f)};function Td(_){const f=window.document.createElement("a");return f.href=_,f.protocol===window.document.location.protocol&&f.host===window.document.location.host}function Fd(_,f,S){S[_]&&S[_].indexOf(f)!==-1||(S[_]=S[_]||[],S[_].push(f))}function Cd(_,f,S){if(S&&S[_]){const j=S[_].indexOf(f);j!==-1&&S[_].splice(j,1)}}class Gd{constructor(f,S={}){Bt(this,S),this.type=f}}class bf extends Gd{constructor(f,S={}){super("error",Bt({error:f},S))}}class Id{on(f,S){return this._listeners=this._listeners||{},Fd(f,S,this._listeners),this}off(f,S){return Cd(f,S,this._listeners),Cd(f,S,this._oneTimeListeners),this}once(f,S){return S?(this._oneTimeListeners=this._oneTimeListeners||{},Fd(f,S,this._oneTimeListeners),this):new Promise(j=>this.once(f,j))}fire(f,S){typeof f=="string"&&(f=new Gd(f,S||{}));const j=f.type;if(this.listens(j)){f.target=this;const ut=this._listeners&&this._listeners[j]?this._listeners[j].slice():[];for(const Ur of ut)Ur.call(this,f);const Ot=this._oneTimeListeners&&this._oneTimeListeners[j]?this._oneTimeListeners[j].slice():[];for(const Ur of Ot)Cd(j,Ur,this._oneTimeListeners),Ur.call(this,f);const fi=this._eventedParent;fi&&(Bt(f,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),fi.fire(f))}else f instanceof bf&&console.error(f.error);return this}listens(f){return this._listeners&&this._listeners[f]&&this._listeners[f].length>0||this._oneTimeListeners&&this._oneTimeListeners[f]&&this._oneTimeListeners[f].length>0||this._eventedParent&&this._eventedParent.listens(f)}setEventedParent(f,S){return this._eventedParent=f,this._eventedParentData=S,this}}var td={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class $d{constructor(f,S,j,ut){this.message=(f?`${f}: `:"")+j,ut&&(this.identifier=ut),S!=null&&S.__line__&&(this.line=S.__line__)}}function np(_){const f=_.value;return f?[new $d(_.key,f,"constants have been deprecated as of v8")]:[]}function jf(_,...f){for(const S of f)for(const j in S)_[j]=S[j];return _}function yd(_){return _ instanceof Number||_ instanceof String||_ instanceof Boolean?_.valueOf():_}function Qd(_){if(Array.isArray(_))return _.map(Qd);if(_ instanceof Object&&!(_ instanceof Number||_ instanceof String||_ instanceof Boolean)){const f={};for(const S in _)f[S]=Qd(_[S]);return f}return yd(_)}class op extends Error{constructor(f,S){super(S),this.message=S,this.key=f}}class bp{constructor(f,S=[]){this.parent=f,this.bindings={};for(const[j,ut]of S)this.bindings[j]=ut}concat(f){return new bp(this,f)}get(f){if(this.bindings[f])return this.bindings[f];if(this.parent)return this.parent.get(f);throw new Error(`${f} not found in scope.`)}has(f){return!!this.bindings[f]||!!this.parent&&this.parent.has(f)}}const fp={kind:"null"},Qh={kind:"number"},Yd={kind:"string"},ad={kind:"boolean"},Zd={kind:"color"},Xh={kind:"object"},Ld={kind:"value"},Kf={kind:"collator"},If={kind:"formatted"},Df={kind:"padding"},Jf={kind:"resolvedImage"};function Nf(_,f){return{kind:"array",itemType:_,N:f}}function Wf(_){if(_.kind==="array"){const f=Wf(_.itemType);return typeof _.N=="number"?`array<${f}, ${_.N}>`:_.itemType.kind==="value"?"array":`array<${f}>`}return _.kind}const Cp=[fp,Qh,Yd,ad,Zd,If,Xh,Nf(Ld),Df,Jf];function Tp(_,f){if(f.kind==="error")return null;if(_.kind==="array"){if(f.kind==="array"&&(f.N===0&&f.itemType.kind==="value"||!Tp(_.itemType,f.itemType))&&(typeof _.N!="number"||_.N===f.N))return null}else{if(_.kind===f.kind)return null;if(_.kind==="value"){for(const S of Cp)if(!Tp(S,f))return null}}return`Expected ${Wf(_)} but found ${Wf(f)} instead.`}function Pp(_,f){return f.some(S=>S.kind===_.kind)}function Yf(_,f){return f.some(S=>S==="null"?_===null:S==="array"?Array.isArray(_):S==="object"?_&&!Array.isArray(_)&&typeof _=="object":S===typeof _)}var qp,am={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xd(_){return(_=Math.round(_))<0?0:_>255?255:_}function Op(_){return Xd(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function nm(_){return(f=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:f>1?1:f;var f}function Tm(_,f,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?_+(f-_)*S*6:2*S<1?f:3*S<2?_+(f-_)*(2/3-S)*6:_}try{qp={}.parseCSSColor=function(_){var f,S=_.replace(/ /g,"").toLowerCase();if(S in am)return am[S].slice();if(S[0]==="#")return S.length===4?(f=parseInt(S.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:S.length===7&&(f=parseInt(S.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var j=S.indexOf("("),ut=S.indexOf(")");if(j!==-1&&ut+1===S.length){var Ot=S.substr(0,j),fi=S.substr(j+1,ut-(j+1)).split(","),Ur=1;switch(Ot){case"rgba":if(fi.length!==4)return null;Ur=nm(fi.pop());case"rgb":return fi.length!==3?null:[Op(fi[0]),Op(fi[1]),Op(fi[2]),Ur];case"hsla":if(fi.length!==4)return null;Ur=nm(fi.pop());case"hsl":if(fi.length!==3)return null;var us=(parseFloat(fi[0])%360+360)%360/360,ul=nm(fi[1]),Ju=nm(fi[2]),oh=Ju<=.5?Ju*(ul+1):Ju+ul-Ju*ul,gh=2*Ju-oh;return[Xd(255*Tm(gh,oh,us+1/3)),Xd(255*Tm(gh,oh,us)),Xd(255*Tm(gh,oh,us-1/3)),Ur];default:return null}}return null}}catch{}class hp{constructor(f,S,j,ut=1){this.r=f,this.g=S,this.b=j,this.a=ut}static parse(f){if(!f)return;if(f instanceof hp)return f;if(typeof f!="string")return;const S=qp(f);return S?new hp(S[0]/255*S[3],S[1]/255*S[3],S[2]/255*S[3],S[3]):void 0}toString(){const[f,S,j,ut]=this.toArray();return`rgba(${Math.round(f)},${Math.round(S)},${Math.round(j)},${ut})`}toArray(){const{r:f,g:S,b:j,a:ut}=this;return ut===0?[0,0,0,0]:[255*f/ut,255*S/ut,255*j/ut,ut]}}hp.black=new hp(0,0,0,1),hp.white=new hp(1,1,1,1),hp.transparent=new hp(0,0,0,0),hp.red=new hp(1,0,0,1);class Em{constructor(f,S,j){this.sensitivity=f?S?"variant":"case":S?"accent":"base",this.locale=j,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(f,S){return this.collator.compare(f,S)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qp{constructor(f,S,j,ut,Ot){this.text=f,this.image=S,this.scale=j,this.fontStack=ut,this.textColor=Ot}}class lm{constructor(f){this.sections=f}static fromString(f){return new lm([new Qp(f,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(f=>f.text.length!==0||f.image&&f.image.name.length!==0)}static factory(f){return f instanceof lm?f:lm.fromString(f)}toString(){return this.sections.length===0?"":this.sections.map(f=>f.text).join("")}}class Dd{constructor(f){this.values=f.slice()}static parse(f){if(f instanceof Dd)return f;if(typeof f=="number")return new Dd([f,f,f,f]);if(Array.isArray(f)&&!(f.length<1||f.length>4)){for(const S of f)if(typeof S!="number")return;switch(f.length){case 1:f=[f[0],f[0],f[0],f[0]];break;case 2:f=[f[0],f[1],f[0],f[1]];break;case 3:f=[f[0],f[1],f[2],f[1]]}return new Dd(f)}}toString(){return JSON.stringify(this.values)}}class Hf{constructor(f){this.name=f.name,this.available=f.available}toString(){return this.name}static fromString(f){return f?new Hf({name:f,available:!1}):null}}function mh(_,f,S,j){return typeof _=="number"&&_>=0&&_<=255&&typeof f=="number"&&f>=0&&f<=255&&typeof S=="number"&&S>=0&&S<=255?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid rgba value [${[_,f,S,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof j=="number"?[_,f,S,j]:[_,f,S]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jh(_){if(_===null||typeof _=="string"||typeof _=="boolean"||typeof _=="number"||_ instanceof hp||_ instanceof Em||_ instanceof lm||_ instanceof Dd||_ instanceof Hf)return!0;if(Array.isArray(_)){for(const f of _)if(!Jh(f))return!1;return!0}if(typeof _=="object"){for(const f in _)if(!Jh(_[f]))return!1;return!0}return!1}function Wu(_){if(_===null)return fp;if(typeof _=="string")return Yd;if(typeof _=="boolean")return ad;if(typeof _=="number")return Qh;if(_ instanceof hp)return Zd;if(_ instanceof Em)return Kf;if(_ instanceof lm)return If;if(_ instanceof Dd)return Df;if(_ instanceof Hf)return Jf;if(Array.isArray(_)){const f=_.length;let S;for(const j of _){const ut=Wu(j);if(S){if(S===ut)continue;S=Ld;break}S=ut}return Nf(S||Ld,f)}return Xh}function al(_){const f=typeof _;return _===null?"":f==="string"||f==="number"||f==="boolean"?String(_):_ instanceof hp||_ instanceof lm||_ instanceof Dd||_ instanceof Hf?_.toString():JSON.stringify(_)}class Xr{constructor(f,S){this.type=f,this.value=S}static parse(f,S){if(f.length!==2)return S.error(`'literal' expression requires exactly one argument, but found ${f.length-1} instead.`);if(!Jh(f[1]))return S.error("invalid value");const j=f[1];let ut=Wu(j);const Ot=S.expectedType;return ut.kind!=="array"||ut.N!==0||!Ot||Ot.kind!=="array"||typeof Ot.N=="number"&&Ot.N!==0||(ut=Ot),new Xr(ut,j)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class mr{constructor(f){this.name="ExpressionEvaluationError",this.message=f}toJSON(){return this.message}}const cs={string:Yd,number:Qh,boolean:ad,object:Xh};class $u{constructor(f,S){this.type=f,this.args=S}static parse(f,S){if(f.length<2)return S.error("Expected at least one argument.");let j,ut=1;const Ot=f[0];if(Ot==="array"){let Ur,us;if(f.length>2){const ul=f[1];if(typeof ul!="string"||!(ul in cs)||ul==="object")return S.error('The item type argument of "array" must be one of string, number, boolean',1);Ur=cs[ul],ut++}else Ur=Ld;if(f.length>3){if(f[2]!==null&&(typeof f[2]!="number"||f[2]<0||f[2]!==Math.floor(f[2])))return S.error('The length argument to "array" must be a positive integer literal',2);us=f[2],ut++}j=Nf(Ur,us)}else{if(!cs[Ot])throw new Error(`Types doesn't contain name = ${Ot}`);j=cs[Ot]}const fi=[];for(;ut<f.length;ut++){const Ur=S.parse(f[ut],ut,Ld);if(!Ur)return null;fi.push(Ur)}return new $u(j,fi)}evaluate(f){for(let S=0;S<this.args.length;S++){const j=this.args[S].evaluate(f);if(!Tp(this.type,Wu(j)))return j;if(S===this.args.length-1)throw new mr(`Expected value to be of type ${Wf(this.type)}, but found ${Wf(Wu(j))} instead.`)}throw new Error}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const eh={"to-boolean":ad,"to-color":Zd,"to-number":Qh,"to-string":Yd};class rh{constructor(f,S){this.type=f,this.args=S}static parse(f,S){if(f.length<2)return S.error("Expected at least one argument.");const j=f[0];if(!eh[j])throw new Error(`Can't parse ${j} as it is not part of the known types`);if((j==="to-boolean"||j==="to-string")&&f.length!==2)return S.error("Expected one argument.");const ut=eh[j],Ot=[];for(let fi=1;fi<f.length;fi++){const Ur=S.parse(f[fi],fi,Ld);if(!Ur)return null;Ot.push(Ur)}return new rh(ut,Ot)}evaluate(f){if(this.type.kind==="boolean")return!!this.args[0].evaluate(f);if(this.type.kind==="color"){let S,j;for(const ut of this.args){if(S=ut.evaluate(f),j=null,S instanceof hp)return S;if(typeof S=="string"){const Ot=f.parseColor(S);if(Ot)return Ot}else if(Array.isArray(S)&&(j=S.length<3||S.length>4?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:mh(S[0],S[1],S[2],S[3]),!j))return new hp(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new mr(j||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="padding"){let S;for(const j of this.args){S=j.evaluate(f);const ut=Dd.parse(S);if(ut)return ut}throw new mr(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="number"){let S=null;for(const j of this.args){if(S=j.evaluate(f),S===null)return 0;const ut=Number(S);if(!isNaN(ut))return ut}throw new mr(`Could not convert ${JSON.stringify(S)} to number.`)}return this.type.kind==="formatted"?lm.fromString(al(this.args[0].evaluate(f))):this.type.kind==="resolvedImage"?Hf.fromString(al(this.args[0].evaluate(f))):al(this.args[0].evaluate(f))}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const uh=["Unknown","Point","LineString","Polygon"];class dh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(f){let S=this._parseColorCache[f];return S||(S=this._parseColorCache[f]=hp.parse(f)),S}}class yh{constructor(f,S,j,ut){this.name=f,this.type=S,this._evaluate=j,this.args=ut}evaluate(f){return this._evaluate(f,this.args)}eachChild(f){this.args.forEach(f)}outputDefined(){return!1}static parse(f,S){const j=f[0],ut=yh.definitions[j];if(!ut)return S.error(`Unknown expression "${j}". If you wanted a literal array, use ["literal", [...]].`,0);const Ot=Array.isArray(ut)?ut[0]:ut.type,fi=Array.isArray(ut)?[[ut[1],ut[2]]]:ut.overloads,Ur=fi.filter(([ul])=>!Array.isArray(ul)||ul.length===f.length-1);let us=null;for(const[ul,Ju]of Ur){us=new c_(S.registry,S.path,null,S.scope);const oh=[];let gh=!1;for(let vh=1;vh<f.length;vh++){const bh=f[vh],Wh=Array.isArray(ul)?ul[vh-1]:ul.type,Zh=us.parse(bh,1+oh.length,Wh);if(!Zh){gh=!0;break}oh.push(Zh)}if(!gh)if(Array.isArray(ul)&&ul.length!==oh.length)us.error(`Expected ${ul.length} arguments, but found ${oh.length} instead.`);else{for(let vh=0;vh<oh.length;vh++){const bh=Array.isArray(ul)?ul[vh]:ul.type,Wh=oh[vh];us.concat(vh+1).checkSubtype(bh,Wh.type)}if(us.errors.length===0)return new yh(j,Ot,Ju,oh)}}if(Ur.length===1)S.errors.push(...us.errors);else{const ul=(Ur.length?Ur:fi).map(([oh])=>{return gh=oh,Array.isArray(gh)?`(${gh.map(Wf).join(", ")})`:`(${Wf(gh.type)}...)`;var gh}).join(" | "),Ju=[];for(let oh=1;oh<f.length;oh++){const gh=S.parse(f[oh],1+Ju.length);if(!gh)return null;Ju.push(Wf(gh.type))}S.error(`Expected arguments of type ${ul}, but found (${Ju.join(", ")}) instead.`)}return null}static register(f,S){yh.definitions=S;for(const j in S)f[j]=yh}}class Ph{constructor(f,S,j){this.type=Kf,this.locale=j,this.caseSensitive=f,this.diacriticSensitive=S}static parse(f,S){if(f.length!==2)return S.error("Expected one argument.");const j=f[1];if(typeof j!="object"||Array.isArray(j))return S.error("Collator options argument must be an object.");const ut=S.parse(j["case-sensitive"]!==void 0&&j["case-sensitive"],1,ad);if(!ut)return null;const Ot=S.parse(j["diacritic-sensitive"]!==void 0&&j["diacritic-sensitive"],1,ad);if(!Ot)return null;let fi=null;return j.locale&&(fi=S.parse(j.locale,1,Yd),!fi)?null:new Ph(ut,Ot,fi)}evaluate(f){return new Em(this.caseSensitive.evaluate(f),this.diacriticSensitive.evaluate(f),this.locale?this.locale.evaluate(f):null)}eachChild(f){f(this.caseSensitive),f(this.diacriticSensitive),this.locale&&f(this.locale)}outputDefined(){return!1}}const Fh=8192;function Ad(_,f){_[0]=Math.min(_[0],f[0]),_[1]=Math.min(_[1],f[1]),_[2]=Math.max(_[2],f[0]),_[3]=Math.max(_[3],f[1])}function wd(_,f){return!(_[0]<=f[0]||_[2]>=f[2]||_[1]<=f[1]||_[3]>=f[3])}function Kd(_,f){const S=(180+_[0])/360,j=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_[1]*Math.PI/360)))/360,ut=Math.pow(2,f.z);return[Math.round(S*ut*Fh),Math.round(j*ut*Fh)]}function xf(_,f,S){const j=_[0]-f[0],ut=_[1]-f[1],Ot=_[0]-S[0],fi=_[1]-S[1];return j*fi-Ot*ut==0&&j*Ot<=0&&ut*fi<=0}function Ff(_,f){let S=!1;for(let fi=0,Ur=f.length;fi<Ur;fi++){const us=f[fi];for(let ul=0,Ju=us.length;ul<Ju-1;ul++){if(xf(_,us[ul],us[ul+1]))return!1;(ut=us[ul])[1]>(j=_)[1]!=(Ot=us[ul+1])[1]>j[1]&&j[0]<(Ot[0]-ut[0])*(j[1]-ut[1])/(Ot[1]-ut[1])+ut[0]&&(S=!S)}}var j,ut,Ot;return S}function rp(_,f){for(let S=0;S<f.length;S++)if(Ff(_,f[S]))return!0;return!1}function Ah(_,f,S,j){const ut=j[0]-S[0],Ot=j[1]-S[1],fi=(_[0]-S[0])*Ot-ut*(_[1]-S[1]),Ur=(f[0]-S[0])*Ot-ut*(f[1]-S[1]);return fi>0&&Ur<0||fi<0&&Ur>0}function Jd(_,f,S){for(const ul of S)for(let Ju=0;Ju<ul.length-1;++Ju)if((Ur=[(fi=ul[Ju+1])[0]-(Ot=ul[Ju])[0],fi[1]-Ot[1]])[0]*(us=[(ut=f)[0]-(j=_)[0],ut[1]-j[1]])[1]-Ur[1]*us[0]!=0&&Ah(j,ut,Ot,fi)&&Ah(Ot,fi,j,ut))return!0;var j,ut,Ot,fi,Ur,us;return!1}function Od(_,f){for(let S=0;S<_.length;++S)if(!Ff(_[S],f))return!1;for(let S=0;S<_.length-1;++S)if(Jd(_[S],_[S+1],f))return!1;return!0}function qf(_,f){for(let S=0;S<f.length;S++)if(Od(_,f[S]))return!0;return!1}function mp(_,f,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=[];for(let fi=0;fi<_[ut].length;fi++){const Ur=Kd(_[ut][fi],S);Ad(f,Ur),Ot.push(Ur)}j.push(Ot)}return j}function Vp(_,f,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=mp(_[ut],f,S);j.push(Ot)}return j}function om(_,f,S,j){if(_[0]<S[0]||_[0]>S[2]){const ut=.5*j;let Ot=_[0]-S[0]>ut?-j:S[0]-_[0]>ut?j:0;Ot===0&&(Ot=_[0]-S[2]>ut?-j:S[2]-_[0]>ut?j:0),_[0]+=Ot}Ad(f,_)}function Pd(_,f,S,j){const ut=Math.pow(2,j.z)*Fh,Ot=[j.x*Fh,j.y*Fh],fi=[];for(const Ur of _)for(const us of Ur){const ul=[us.x+Ot[0],us.y+Ot[1]];om(ul,f,S,ut),fi.push(ul)}return fi}function Hg(_,f,S,j){const ut=Math.pow(2,j.z)*Fh,Ot=[j.x*Fh,j.y*Fh],fi=[];for(const us of _){const ul=[];for(const Ju of us){const oh=[Ju.x+Ot[0],Ju.y+Ot[1]];Ad(f,oh),ul.push(oh)}fi.push(ul)}if(f[2]-f[0]<=ut/2){(Ur=f)[0]=Ur[1]=1/0,Ur[2]=Ur[3]=-1/0;for(const us of fi)for(const ul of us)om(ul,f,S,ut)}var Ur;return fi}class $m{constructor(f,S){this.type=ad,this.geojson=f,this.geometries=S}static parse(f,S){if(f.length!==2)return S.error(`'within' expression requires exactly one argument, but found ${f.length-1} instead.`);if(Jh(f[1])){const j=f[1];if(j.type==="FeatureCollection")for(let ut=0;ut<j.features.length;++ut){const Ot=j.features[ut].geometry.type;if(Ot==="Polygon"||Ot==="MultiPolygon")return new $m(j,j.features[ut].geometry)}else if(j.type==="Feature"){const ut=j.geometry.type;if(ut==="Polygon"||ut==="MultiPolygon")return new $m(j,j.geometry)}else if(j.type==="Polygon"||j.type==="MultiPolygon")return new $m(j,j)}return S.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(f){if(f.geometry()!=null&&f.canonicalID()!=null){if(f.geometryType()==="Point")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const Ur=mp(j.coordinates,Ot,fi),us=Pd(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!Ff(ul,Ur))return!1}if(j.type==="MultiPolygon"){const Ur=Vp(j.coordinates,Ot,fi),us=Pd(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!rp(ul,Ur))return!1}return!0}(f,this.geometries);if(f.geometryType()==="LineString")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const Ur=mp(j.coordinates,Ot,fi),us=Hg(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!Od(ul,Ur))return!1}if(j.type==="MultiPolygon"){const Ur=Vp(j.coordinates,Ot,fi),us=Hg(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!qf(ul,Ur))return!1}return!0}(f,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function I_(_){if(_ instanceof yh&&(_.name==="get"&&_.args.length===1||_.name==="feature-state"||_.name==="has"&&_.args.length===1||_.name==="properties"||_.name==="geometry-type"||_.name==="id"||/^filter-/.test(_.name))||_ instanceof $m)return!1;let f=!0;return _.eachChild(S=>{f&&!I_(S)&&(f=!1)}),f}function Dy(_){if(_ instanceof yh&&_.name==="feature-state")return!1;let f=!0;return _.eachChild(S=>{f&&!Dy(S)&&(f=!1)}),f}function Pg(_,f){if(_ instanceof yh&&f.indexOf(_.name)>=0)return!1;let S=!0;return _.eachChild(j=>{S&&!Pg(j,f)&&(S=!1)}),S}class l_{constructor(f,S){this.type=S.type,this.name=f,this.boundExpression=S}static parse(f,S){if(f.length!==2||typeof f[1]!="string")return S.error("'var' expression requires exactly one string literal argument.");const j=f[1];return S.scope.has(j)?new l_(j,S.scope.get(j)):S.error(`Unknown variable "${j}". Make sure "${j}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(f){return this.boundExpression.evaluate(f)}eachChild(){}outputDefined(){return!1}}class ev{constructor(f,S=[],j,ut=new bp,Ot=[]){this.registry=f,this.path=S,this.key=S.map(fi=>`[${fi}]`).join(""),this.scope=ut,this.errors=Ot,this.expectedType=j}parse(f,S,j,ut,Ot={}){return S?this.concat(S,j,ut)._parse(f,Ot):this._parse(f,Ot)}_parse(f,S){function j(ut,Ot,fi){return fi==="assert"?new $u(Ot,[ut]):fi==="coerce"?new rh(Ot,[ut]):ut}if(f!==null&&typeof f!="string"&&typeof f!="boolean"&&typeof f!="number"||(f=["literal",f]),Array.isArray(f)){if(f.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ut=f[0];if(typeof ut!="string")return this.error(`Expression name must be a string, but found ${typeof ut} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Ot=this.registry[ut];if(Ot){let fi=Ot.parse(f,this);if(!fi)return null;if(this.expectedType){const Ur=this.expectedType,us=fi.type;if(Ur.kind!=="string"&&Ur.kind!=="number"&&Ur.kind!=="boolean"&&Ur.kind!=="object"&&Ur.kind!=="array"||us.kind!=="value")if(Ur.kind!=="color"&&Ur.kind!=="formatted"&&Ur.kind!=="resolvedImage"||us.kind!=="value"&&us.kind!=="string")if(Ur.kind!=="padding"||us.kind!=="value"&&us.kind!=="number"&&us.kind!=="array"){if(this.checkSubtype(Ur,us))return null}else fi=j(fi,Ur,S.typeAnnotation||"coerce");else fi=j(fi,Ur,S.typeAnnotation||"coerce");else fi=j(fi,Ur,S.typeAnnotation||"assert")}if(!(fi instanceof Xr)&&fi.type.kind!=="resolvedImage"&&ep(fi)){const Ur=new dh;try{fi=new Xr(fi.type,fi.evaluate(Ur))}catch(us){return this.error(us.message),null}}return fi}return this.error(`Unknown expression "${ut}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(f===void 0?"'undefined' value invalid. Use null instead.":typeof f=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof f} instead.`)}concat(f,S,j){const ut=typeof f=="number"?this.path.concat(f):this.path,Ot=j?this.scope.concat(j):this.scope;return new ev(this.registry,ut,S||null,Ot,this.errors)}error(f,...S){const j=`${this.key}${S.map(ut=>`[${ut}]`).join("")}`;this.errors.push(new op(j,f))}checkSubtype(f,S){const j=Tp(f,S);return j&&this.error(j),j}}var c_=ev;function ep(_){if(_ instanceof l_)return ep(_.boundExpression);if(_ instanceof yh&&_.name==="error"||_ instanceof Ph||_ instanceof $m)return!1;const f=_ instanceof rh||_ instanceof $u;let S=!0;return _.eachChild(j=>{S=f?S&&ep(j):S&&j instanceof Xr}),!!S&&I_(_)&&Pg(_,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function im(_,f){const S=_.length-1;let j,ut,Ot=0,fi=S,Ur=0;for(;Ot<=fi;)if(Ur=Math.floor((Ot+fi)/2),j=_[Ur],ut=_[Ur+1],j<=f){if(Ur===S||f<ut)return Ur;Ot=Ur+1}else{if(!(j>f))throw new mr("Input is not a number.");fi=Ur-1}return 0}class Jp{constructor(f,S,j){this.type=f,this.input=S,this.labels=[],this.outputs=[];for(const[ut,Ot]of j)this.labels.push(ut),this.outputs.push(Ot)}static parse(f,S){if(f.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return S.error("Expected an even number of arguments.");const j=S.parse(f[1],1,Qh);if(!j)return null;const ut=[];let Ot=null;S.expectedType&&S.expectedType.kind!=="value"&&(Ot=S.expectedType);for(let fi=1;fi<f.length;fi+=2){const Ur=fi===1?-1/0:f[fi],us=f[fi+1],ul=fi,Ju=fi+1;if(typeof Ur!="number")return S.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ul);if(ut.length&&ut[ut.length-1][0]>=Ur)return S.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ul);const oh=S.parse(us,Ju,Ot);if(!oh)return null;Ot=Ot||oh.type,ut.push([Ur,oh])}return new Jp(Ot,j,ut)}evaluate(f){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(f);const ut=this.input.evaluate(f);if(ut<=S[0])return j[0].evaluate(f);const Ot=S.length;return ut>=S[Ot-1]?j[Ot-1].evaluate(f):j[im(S,ut)].evaluate(f)}eachChild(f){f(this.input);for(const S of this.outputs)f(S)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function mm(_,f,S){return _*(1-S)+f*S}var kn=Object.freeze({__proto__:null,array:function(_,f,S){return _.map((j,ut)=>mm(j,f[ut],S))},color:function(_,f,S){return new hp(mm(_.r,f.r,S),mm(_.g,f.g,S),mm(_.b,f.b,S),mm(_.a,f.a,S))},number:mm,padding:function(_,f,S){const j=_.values,ut=f.values;return new Dd([mm(j[0],ut[0],S),mm(j[1],ut[1],S),mm(j[2],ut[2],S),mm(j[3],ut[3],S)])}});const el=.95047,_h=1.08883,Vh=4/29,rd=6/29,od=3*rd*rd,sd=Math.PI/180,Gf=180/Math.PI;function Ef(_){return _>.008856451679035631?Math.pow(_,1/3):_/od+Vh}function _p(_){return _>rd?_*_*_:od*(_-Vh)}function sp(_){return 255*(_<=.0031308?12.92*_:1.055*Math.pow(_,1/2.4)-.055)}function lp(_){return(_/=255)<=.04045?_/12.92:Math.pow((_+.055)/1.055,2.4)}function Zp(_){const f=lp(_.r),S=lp(_.g),j=lp(_.b),ut=Ef((.4124564*f+.3575761*S+.1804375*j)/el),Ot=Ef((.2126729*f+.7151522*S+.072175*j)/1);return{l:116*Ot-16,a:500*(ut-Ot),b:200*(Ot-Ef((.0193339*f+.119192*S+.9503041*j)/_h)),alpha:_.a}}function Rm(_){let f=(_.l+16)/116,S=isNaN(_.a)?f:f+_.a/500,j=isNaN(_.b)?f:f-_.b/200;return f=1*_p(f),S=el*_p(S),j=_h*_p(j),new hp(sp(3.2404542*S-1.5371385*f-.4985314*j),sp(-.969266*S+1.8760108*f+.041556*j),sp(.0556434*S-.2040259*f+1.0572252*j),_.alpha)}function Yp(_,f,S){const j=f-_;return _+S*(j>180||j<-180?j-360*Math.round(j/360):j)}const Pm={forward:Zp,reverse:Rm,interpolate:function(_,f,S){return{l:mm(_.l,f.l,S),a:mm(_.a,f.a,S),b:mm(_.b,f.b,S),alpha:mm(_.alpha,f.alpha,S)}}},kf={forward:function(_){const{l:f,a:S,b:j}=Zp(_),ut=Math.atan2(j,S)*Gf;return{h:ut<0?ut+360:ut,c:Math.sqrt(S*S+j*j),l:f,alpha:_.a}},reverse:function(_){const f=_.h*sd,S=_.c;return Rm({l:_.l,a:Math.cos(f)*S,b:Math.sin(f)*S,alpha:_.alpha})},interpolate:function(_,f,S){return{h:Yp(_.h,f.h,S),c:mm(_.c,f.c,S),l:mm(_.l,f.l,S),alpha:mm(_.alpha,f.alpha,S)}}};var Sp=Object.freeze({__proto__:null,hcl:kf,lab:Pm});class Np{constructor(f,S,j,ut,Ot){this.type=f,this.operator=S,this.interpolation=j,this.input=ut,this.labels=[],this.outputs=[];for(const[fi,Ur]of Ot)this.labels.push(fi),this.outputs.push(Ur)}static interpolationFactor(f,S,j,ut){let Ot=0;if(f.name==="exponential")Ot=Jm(S,f.base,j,ut);else if(f.name==="linear")Ot=Jm(S,1,j,ut);else if(f.name==="cubic-bezier"){const fi=f.controlPoints;Ot=new x(fi[0],fi[1],fi[2],fi[3]).solve(Jm(S,1,j,ut))}return Ot}static parse(f,S){let[j,ut,Ot,...fi]=f;if(!Array.isArray(ut)||ut.length===0)return S.error("Expected an interpolation type expression.",1);if(ut[0]==="linear")ut={name:"linear"};else if(ut[0]==="exponential"){const ul=ut[1];if(typeof ul!="number")return S.error("Exponential interpolation requires a numeric base.",1,1);ut={name:"exponential",base:ul}}else{if(ut[0]!=="cubic-bezier")return S.error(`Unknown interpolation type ${String(ut[0])}`,1,0);{const ul=ut.slice(1);if(ul.length!==4||ul.some(Ju=>typeof Ju!="number"||Ju<0||Ju>1))return S.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ut={name:"cubic-bezier",controlPoints:ul}}}if(f.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return S.error("Expected an even number of arguments.");if(Ot=S.parse(Ot,2,Qh),!Ot)return null;const Ur=[];let us=null;j==="interpolate-hcl"||j==="interpolate-lab"?us=Zd:S.expectedType&&S.expectedType.kind!=="value"&&(us=S.expectedType);for(let ul=0;ul<fi.length;ul+=2){const Ju=fi[ul],oh=fi[ul+1],gh=ul+3,vh=ul+4;if(typeof Ju!="number")return S.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',gh);if(Ur.length&&Ur[Ur.length-1][0]>=Ju)return S.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',gh);const bh=S.parse(oh,vh,us);if(!bh)return null;us=us||bh.type,Ur.push([Ju,bh])}return us.kind==="number"||us.kind==="color"||us.kind==="padding"||us.kind==="array"&&us.itemType.kind==="number"&&typeof us.N=="number"?new Np(us,j,ut,Ot,Ur):S.error(`Type ${Wf(us)} is not interpolatable.`)}evaluate(f){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(f);const ut=this.input.evaluate(f);if(ut<=S[0])return j[0].evaluate(f);const Ot=S.length;if(ut>=S[Ot-1])return j[Ot-1].evaluate(f);const fi=im(S,ut),Ur=Np.interpolationFactor(this.interpolation,ut,S[fi],S[fi+1]),us=j[fi].evaluate(f),ul=j[fi+1].evaluate(f);return this.operator==="interpolate"?kn[this.type.kind.toLowerCase()](us,ul,Ur):this.operator==="interpolate-hcl"?kf.reverse(kf.interpolate(kf.forward(us),kf.forward(ul),Ur)):Pm.reverse(Pm.interpolate(Pm.forward(us),Pm.forward(ul),Ur))}eachChild(f){f(this.input);for(const S of this.outputs)f(S)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function Jm(_,f,S,j){const ut=j-S,Ot=_-S;return ut===0?0:f===1?Ot/ut:(Math.pow(f,Ot)-1)/(Math.pow(f,ut)-1)}class Um{constructor(f,S){this.type=f,this.args=S}static parse(f,S){if(f.length<2)return S.error("Expectected at least one argument.");let j=null;const ut=S.expectedType;ut&&ut.kind!=="value"&&(j=ut);const Ot=[];for(const Ur of f.slice(1)){const us=S.parse(Ur,1+Ot.length,j,void 0,{typeAnnotation:"omit"});if(!us)return null;j=j||us.type,Ot.push(us)}if(!j)throw new Error("No output type");const fi=ut&&Ot.some(Ur=>Tp(ut,Ur.type));return new Um(fi?Ld:j,Ot)}evaluate(f){let S,j=null,ut=0;for(const Ot of this.args)if(ut++,j=Ot.evaluate(f),j&&j instanceof Hf&&!j.available&&(S||(S=j.name),j=null,ut===this.args.length&&(j=S)),j!==null)break;return j}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}class bg{constructor(f,S){this.type=S.type,this.bindings=[].concat(f),this.result=S}evaluate(f){return this.result.evaluate(f)}eachChild(f){for(const S of this.bindings)f(S[1]);f(this.result)}static parse(f,S){if(f.length<4)return S.error(`Expected at least 3 arguments, but found ${f.length-1} instead.`);const j=[];for(let Ot=1;Ot<f.length-1;Ot+=2){const fi=f[Ot];if(typeof fi!="string")return S.error(`Expected string, but found ${typeof fi} instead.`,Ot);if(/[^a-zA-Z0-9_]/.test(fi))return S.error("Variable names must contain only alphanumeric characters or '_'.",Ot);const Ur=S.parse(f[Ot+1],Ot+1);if(!Ur)return null;j.push([fi,Ur])}const ut=S.parse(f[f.length-1],f.length-1,S.expectedType,j);return ut?new bg(j,ut):null}outputDefined(){return this.result.outputDefined()}}class kg{constructor(f,S,j){this.type=f,this.index=S,this.input=j}static parse(f,S){if(f.length!==3)return S.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const j=S.parse(f[1],1,Qh),ut=S.parse(f[2],2,Nf(S.expectedType||Ld));return j&&ut?new kg(ut.type.itemType,j,ut):null}evaluate(f){const S=this.index.evaluate(f),j=this.input.evaluate(f);if(S<0)throw new mr(`Array index out of bounds: ${S} < 0.`);if(S>=j.length)throw new mr(`Array index out of bounds: ${S} > ${j.length-1}.`);if(S!==Math.floor(S))throw new mr(`Array index must be an integer, but found ${S} instead.`);return j[S]}eachChild(f){f(this.index),f(this.input)}outputDefined(){return!1}}class Bm{constructor(f,S){this.type=ad,this.needle=f,this.haystack=S}static parse(f,S){if(f.length!==3)return S.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const j=S.parse(f[1],1,Ld),ut=S.parse(f[2],2,Ld);return j&&ut?Pp(j.type,[ad,Yd,Qh,fp,Ld])?new Bm(j,ut):S.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(j.type)} instead`):null}evaluate(f){const S=this.needle.evaluate(f),j=this.haystack.evaluate(f);if(!j)return!1;if(!Yf(S,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(Wu(S))} instead.`);if(!Yf(j,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Wf(Wu(j))} instead.`);return j.indexOf(S)>=0}eachChild(f){f(this.needle),f(this.haystack)}outputDefined(){return!0}}class fy{constructor(f,S,j){this.type=Qh,this.needle=f,this.haystack=S,this.fromIndex=j}static parse(f,S){if(f.length<=2||f.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const j=S.parse(f[1],1,Ld),ut=S.parse(f[2],2,Ld);if(!j||!ut)return null;if(!Pp(j.type,[ad,Yd,Qh,fp,Ld]))return S.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(j.type)} instead`);if(f.length===4){const Ot=S.parse(f[3],3,Qh);return Ot?new fy(j,ut,Ot):null}return new fy(j,ut)}evaluate(f){const S=this.needle.evaluate(f),j=this.haystack.evaluate(f);if(!Yf(S,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(Wu(S))} instead.`);if(!Yf(j,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Wf(Wu(j))} instead.`);if(this.fromIndex){const ut=this.fromIndex.evaluate(f);return j.indexOf(S,ut)}return j.indexOf(S)}eachChild(f){f(this.needle),f(this.haystack),this.fromIndex&&f(this.fromIndex)}outputDefined(){return!1}}class Km{constructor(f,S,j,ut,Ot,fi){this.inputType=f,this.type=S,this.input=j,this.cases=ut,this.outputs=Ot,this.otherwise=fi}static parse(f,S){if(f.length<5)return S.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if(f.length%2!=1)return S.error("Expected an even number of arguments.");let j,ut;S.expectedType&&S.expectedType.kind!=="value"&&(ut=S.expectedType);const Ot={},fi=[];for(let ul=2;ul<f.length-1;ul+=2){let Ju=f[ul];const oh=f[ul+1];Array.isArray(Ju)||(Ju=[Ju]);const gh=S.concat(ul);if(Ju.length===0)return gh.error("Expected at least one branch label.");for(const bh of Ju){if(typeof bh!="number"&&typeof bh!="string")return gh.error("Branch labels must be numbers or strings.");if(typeof bh=="number"&&Math.abs(bh)>Number.MAX_SAFE_INTEGER)return gh.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof bh=="number"&&Math.floor(bh)!==bh)return gh.error("Numeric branch labels must be integer values.");if(j){if(gh.checkSubtype(j,Wu(bh)))return null}else j=Wu(bh);if(Ot[String(bh)]!==void 0)return gh.error("Branch labels must be unique.");Ot[String(bh)]=fi.length}const vh=S.parse(oh,ul,ut);if(!vh)return null;ut=ut||vh.type,fi.push(vh)}const Ur=S.parse(f[1],1,Ld);if(!Ur)return null;const us=S.parse(f[f.length-1],f.length-1,ut);return us?Ur.type.kind!=="value"&&S.concat(1).checkSubtype(j,Ur.type)?null:new Km(j,ut,Ur,Ot,fi,us):null}evaluate(f){const S=this.input.evaluate(f);return(Wu(S)===this.inputType&&this.outputs[this.cases[S]]||this.otherwise).evaluate(f)}eachChild(f){f(this.input),this.outputs.forEach(f),f(this.otherwise)}outputDefined(){return this.outputs.every(f=>f.outputDefined())&&this.otherwise.outputDefined()}}class Xg{constructor(f,S,j){this.type=f,this.branches=S,this.otherwise=j}static parse(f,S){if(f.length<4)return S.error(`Expected at least 3 arguments, but found only ${f.length-1}.`);if(f.length%2!=0)return S.error("Expected an odd number of arguments.");let j;S.expectedType&&S.expectedType.kind!=="value"&&(j=S.expectedType);const ut=[];for(let fi=1;fi<f.length-1;fi+=2){const Ur=S.parse(f[fi],fi,ad);if(!Ur)return null;const us=S.parse(f[fi+1],fi+1,j);if(!us)return null;ut.push([Ur,us]),j=j||us.type}const Ot=S.parse(f[f.length-1],f.length-1,j);if(!Ot)return null;if(!j)throw new Error("Can't infer output type");return new Xg(j,ut,Ot)}evaluate(f){for(const[S,j]of this.branches)if(S.evaluate(f))return j.evaluate(f);return this.otherwise.evaluate(f)}eachChild(f){for(const[S,j]of this.branches)f(S),f(j);f(this.otherwise)}outputDefined(){return this.branches.every(([f,S])=>S.outputDefined())&&this.otherwise.outputDefined()}}class Ly{constructor(f,S,j,ut){this.type=f,this.input=S,this.beginIndex=j,this.endIndex=ut}static parse(f,S){if(f.length<=2||f.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const j=S.parse(f[1],1,Ld),ut=S.parse(f[2],2,Qh);if(!j||!ut)return null;if(!Pp(j.type,[Nf(Ld),Yd,Ld]))return S.error(`Expected first argument to be of type array or string, but found ${Wf(j.type)} instead`);if(f.length===4){const Ot=S.parse(f[3],3,Qh);return Ot?new Ly(j.type,j,ut,Ot):null}return new Ly(j.type,j,ut)}evaluate(f){const S=this.input.evaluate(f),j=this.beginIndex.evaluate(f);if(!Yf(S,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${Wf(Wu(S))} instead.`);if(this.endIndex){const ut=this.endIndex.evaluate(f);return S.slice(j,ut)}return S.slice(j)}eachChild(f){f(this.input),f(this.beginIndex),this.endIndex&&f(this.endIndex)}outputDefined(){return!1}}function Ry(_,f){return _==="=="||_==="!="?f.kind==="boolean"||f.kind==="string"||f.kind==="number"||f.kind==="null"||f.kind==="value":f.kind==="string"||f.kind==="number"||f.kind==="value"}function wg(_,f,S,j){return j.compare(f,S)===0}function u_(_,f,S){const j=_!=="=="&&_!=="!=";return class JE{constructor(Ot,fi,Ur){this.type=ad,this.lhs=Ot,this.rhs=fi,this.collator=Ur,this.hasUntypedArgument=Ot.type.kind==="value"||fi.type.kind==="value"}static parse(Ot,fi){if(Ot.length!==3&&Ot.length!==4)return fi.error("Expected two or three arguments.");const Ur=Ot[0];let us=fi.parse(Ot[1],1,Ld);if(!us)return null;if(!Ry(Ur,us.type))return fi.concat(1).error(`"${Ur}" comparisons are not supported for type '${Wf(us.type)}'.`);let ul=fi.parse(Ot[2],2,Ld);if(!ul)return null;if(!Ry(Ur,ul.type))return fi.concat(2).error(`"${Ur}" comparisons are not supported for type '${Wf(ul.type)}'.`);if(us.type.kind!==ul.type.kind&&us.type.kind!=="value"&&ul.type.kind!=="value")return fi.error(`Cannot compare types '${Wf(us.type)}' and '${Wf(ul.type)}'.`);j&&(us.type.kind==="value"&&ul.type.kind!=="value"?us=new $u(ul.type,[us]):us.type.kind!=="value"&&ul.type.kind==="value"&&(ul=new $u(us.type,[ul])));let Ju=null;if(Ot.length===4){if(us.type.kind!=="string"&&ul.type.kind!=="string"&&us.type.kind!=="value"&&ul.type.kind!=="value")return fi.error("Cannot use collator to compare non-string types.");if(Ju=fi.parse(Ot[3],3,Kf),!Ju)return null}return new JE(us,ul,Ju)}evaluate(Ot){const fi=this.lhs.evaluate(Ot),Ur=this.rhs.evaluate(Ot);if(j&&this.hasUntypedArgument){const us=Wu(fi),ul=Wu(Ur);if(us.kind!==ul.kind||us.kind!=="string"&&us.kind!=="number")throw new mr(`Expected arguments for "${_}" to be (string, string) or (number, number), but found (${us.kind}, ${ul.kind}) instead.`)}if(this.collator&&!j&&this.hasUntypedArgument){const us=Wu(fi),ul=Wu(Ur);if(us.kind!=="string"||ul.kind!=="string")return f(Ot,fi,Ur)}return this.collator?S(Ot,fi,Ur,this.collator.evaluate(Ot)):f(Ot,fi,Ur)}eachChild(Ot){Ot(this.lhs),Ot(this.rhs),this.collator&&Ot(this.collator)}outputDefined(){return!0}}}const Oy=u_("==",function(_,f,S){return f===S},wg),V_=u_("!=",function(_,f,S){return f!==S},function(_,f,S,j){return!wg(0,f,S,j)}),r0=u_("<",function(_,f,S){return f<S},function(_,f,S,j){return j.compare(f,S)<0}),O0=u_(">",function(_,f,S){return f>S},function(_,f,S,j){return j.compare(f,S)>0}),l1=u_("<=",function(_,f,S){return f<=S},function(_,f,S,j){return j.compare(f,S)<=0}),tv=u_(">=",function(_,f,S){return f>=S},function(_,f,S,j){return j.compare(f,S)>=0});class oy{constructor(f,S,j,ut,Ot){this.type=Yd,this.number=f,this.locale=S,this.currency=j,this.minFractionDigits=ut,this.maxFractionDigits=Ot}static parse(f,S){if(f.length!==3)return S.error("Expected two arguments.");const j=S.parse(f[1],1,Qh);if(!j)return null;const ut=f[2];if(typeof ut!="object"||Array.isArray(ut))return S.error("NumberFormat options argument must be an object.");let Ot=null;if(ut.locale&&(Ot=S.parse(ut.locale,1,Yd),!Ot))return null;let fi=null;if(ut.currency&&(fi=S.parse(ut.currency,1,Yd),!fi))return null;let Ur=null;if(ut["min-fraction-digits"]&&(Ur=S.parse(ut["min-fraction-digits"],1,Qh),!Ur))return null;let us=null;return ut["max-fraction-digits"]&&(us=S.parse(ut["max-fraction-digits"],1,Qh),!us)?null:new oy(j,Ot,fi,Ur,us)}evaluate(f){return new Intl.NumberFormat(this.locale?this.locale.evaluate(f):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(f):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(f):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(f):void 0}).format(this.number.evaluate(f))}eachChild(f){f(this.number),this.locale&&f(this.locale),this.currency&&f(this.currency),this.minFractionDigits&&f(this.minFractionDigits),this.maxFractionDigits&&f(this.maxFractionDigits)}outputDefined(){return!1}}class o0{constructor(f){this.type=If,this.sections=f}static parse(f,S){if(f.length<2)return S.error("Expected at least one argument.");const j=f[1];if(!Array.isArray(j)&&typeof j=="object")return S.error("First argument must be an image or text section.");const ut=[];let Ot=!1;for(let fi=1;fi<=f.length-1;++fi){const Ur=f[fi];if(Ot&&typeof Ur=="object"&&!Array.isArray(Ur)){Ot=!1;let us=null;if(Ur["font-scale"]&&(us=S.parse(Ur["font-scale"],1,Qh),!us))return null;let ul=null;if(Ur["text-font"]&&(ul=S.parse(Ur["text-font"],1,Nf(Yd)),!ul))return null;let Ju=null;if(Ur["text-color"]&&(Ju=S.parse(Ur["text-color"],1,Zd),!Ju))return null;const oh=ut[ut.length-1];oh.scale=us,oh.font=ul,oh.textColor=Ju}else{const us=S.parse(f[fi],1,Ld);if(!us)return null;const ul=us.type.kind;if(ul!=="string"&&ul!=="value"&&ul!=="null"&&ul!=="resolvedImage")return S.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Ot=!0,ut.push({content:us,scale:null,font:null,textColor:null})}}return new o0(ut)}evaluate(f){return new lm(this.sections.map(S=>{const j=S.content.evaluate(f);return Wu(j)===Jf?new Qp("",j,null,null,null):new Qp(al(j),null,S.scale?S.scale.evaluate(f):null,S.font?S.font.evaluate(f).join(","):null,S.textColor?S.textColor.evaluate(f):null)}))}eachChild(f){for(const S of this.sections)f(S.content),S.scale&&f(S.scale),S.font&&f(S.font),S.textColor&&f(S.textColor)}outputDefined(){return!1}}class By{constructor(f){this.type=Jf,this.input=f}static parse(f,S){if(f.length!==2)return S.error("Expected two arguments.");const j=S.parse(f[1],1,Yd);return j?new By(j):S.error("No image name provided.")}evaluate(f){const S=this.input.evaluate(f),j=Hf.fromString(S);return j&&f.availableImages&&(j.available=f.availableImages.indexOf(S)>-1),j}eachChild(f){f(this.input)}outputDefined(){return!1}}class py{constructor(f){this.type=Qh,this.input=f}static parse(f,S){if(f.length!==2)return S.error(`Expected 1 argument, but found ${f.length-1} instead.`);const j=S.parse(f[1],1);return j?j.type.kind!=="array"&&j.type.kind!=="string"&&j.type.kind!=="value"?S.error(`Expected argument of type string or array, but found ${Wf(j.type)} instead.`):new py(j):null}evaluate(f){const S=this.input.evaluate(f);if(typeof S=="string"||Array.isArray(S))return S.length;throw new mr(`Expected value to be of type string or array, but found ${Wf(Wu(S))} instead.`)}eachChild(f){f(this.input)}outputDefined(){return!1}}const Vg={"==":Oy,"!=":V_,">":O0,"<":r0,">=":tv,"<=":l1,array:$u,at:kg,boolean:$u,case:Xg,coalesce:Um,collator:Ph,format:o0,image:By,in:Bm,"index-of":fy,interpolate:Np,"interpolate-hcl":Np,"interpolate-lab":Np,length:py,let:bg,literal:Xr,match:Km,number:$u,"number-format":oy,object:$u,slice:Ly,step:Jp,string:$u,"to-boolean":rh,"to-color":rh,"to-number":rh,"to-string":rh,var:l_,within:$m};function fm(_,[f,S,j,ut]){f=f.evaluate(_),S=S.evaluate(_),j=j.evaluate(_);const Ot=ut?ut.evaluate(_):1,fi=mh(f,S,j,Ot);if(fi)throw new mr(fi);return new hp(f/255*Ot,S/255*Ot,j/255*Ot,Ot)}function G_(_,f){return _ in f}function eg(_,f){const S=f[_];return S===void 0?null:S}function h_(_){return{type:_}}function iv(_){return{result:"success",value:_}}function zy(_){return{result:"error",value:_}}function j_(_){return _["property-type"]==="data-driven"||_["property-type"]==="cross-faded-data-driven"}function s0(_){return!!_.expression&&_.expression.parameters.indexOf("zoom")>-1}function a0(_){return!!_.expression&&_.expression.interpolated}function wm(_){return _ instanceof Number?"number":_ instanceof String?"string":_ instanceof Boolean?"boolean":Array.isArray(_)?"array":_===null?"null":typeof _}function sy(_){return typeof _=="object"&&_!==null&&!Array.isArray(_)}function my(_){return _}function l0(_,f){const S=f.type==="color",j=_.stops&&typeof _.stops[0][0]=="object",ut=j||!(j||_.property!==void 0),Ot=_.type||(a0(f)?"exponential":"interval");if(S||f.type==="padding"){const ul=S?hp.parse:Dd.parse;(_=jf({},_)).stops&&(_.stops=_.stops.map(Ju=>[Ju[0],ul(Ju[1])])),_.default=ul(_.default?_.default:f.default)}if(_.colorSpace&&_.colorSpace!=="rgb"&&!Sp[_.colorSpace])throw new Error(`Unknown color space: ${_.colorSpace}`);let fi,Ur,us;if(Ot==="exponential")fi=cm;else if(Ot==="interval")fi=ay;else if(Ot==="categorical"){fi=vv,Ur=Object.create(null);for(const ul of _.stops)Ur[ul[0]]=ul[1];us=typeof _.stops[0][0]}else{if(Ot!=="identity")throw new Error(`Unknown function type "${Ot}"`);fi=Ny}if(j){const ul={},Ju=[];for(let vh=0;vh<_.stops.length;vh++){const bh=_.stops[vh],Wh=bh[0].zoom;ul[Wh]===void 0&&(ul[Wh]={zoom:Wh,type:_.type,property:_.property,default:_.default,stops:[]},Ju.push(Wh)),ul[Wh].stops.push([bh[0].value,bh[1]])}const oh=[];for(const vh of Ju)oh.push([ul[vh].zoom,l0(ul[vh],f)]);const gh={name:"linear"};return{kind:"composite",interpolationType:gh,interpolationFactor:Np.interpolationFactor.bind(void 0,gh),zoomStops:oh.map(vh=>vh[0]),evaluate:({zoom:vh},bh)=>cm({stops:oh,base:_.base},f,vh).evaluate(vh,bh)}}if(ut){const ul=Ot==="exponential"?{name:"exponential",base:_.base!==void 0?_.base:1}:null;return{kind:"camera",interpolationType:ul,interpolationFactor:Np.interpolationFactor.bind(void 0,ul),zoomStops:_.stops.map(Ju=>Ju[0]),evaluate:({zoom:Ju})=>fi(_,f,Ju,Ur,us)}}return{kind:"source",evaluate(ul,Ju){const oh=Ju&&Ju.properties?Ju.properties[_.property]:void 0;return oh===void 0?gy(_.default,f.default):fi(_,f,oh,Ur,us)}}}function gy(_,f,S){return _!==void 0?_:f!==void 0?f:S!==void 0?S:void 0}function vv(_,f,S,j,ut){return gy(typeof S===ut?j[S]:void 0,_.default,f.default)}function ay(_,f,S){if(wm(S)!=="number")return gy(_.default,f.default);const j=_.stops.length;if(j===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[j-1][0])return _.stops[j-1][1];const ut=im(_.stops.map(Ot=>Ot[0]),S);return _.stops[ut][1]}function cm(_,f,S){const j=_.base!==void 0?_.base:1;if(wm(S)!=="number")return gy(_.default,f.default);const ut=_.stops.length;if(ut===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[ut-1][0])return _.stops[ut-1][1];const Ot=im(_.stops.map(Ju=>Ju[0]),S),fi=function(Ju,oh,gh,vh){const bh=vh-gh,Wh=Ju-gh;return bh===0?0:oh===1?Wh/bh:(Math.pow(oh,Wh)-1)/(Math.pow(oh,bh)-1)}(S,j,_.stops[Ot][0],_.stops[Ot+1][0]),Ur=_.stops[Ot][1],us=_.stops[Ot+1][1];let ul=kn[f.type]||my;if(_.colorSpace&&_.colorSpace!=="rgb"){const Ju=Sp[_.colorSpace];ul=(oh,gh)=>Ju.reverse(Ju.interpolate(Ju.forward(oh),Ju.forward(gh),fi))}return typeof Ur.evaluate=="function"?{evaluate(...Ju){const oh=Ur.evaluate.apply(void 0,Ju),gh=us.evaluate.apply(void 0,Ju);if(oh!==void 0&&gh!==void 0)return ul(oh,gh,fi)}}:ul(Ur,us,fi)}function Ny(_,f,S){switch(f.type){case"color":S=hp.parse(S);break;case"formatted":S=lm.fromString(S.toString());break;case"resolvedImage":S=Hf.fromString(S.toString());break;case"padding":S=Dd.parse(S);break;default:wm(S)===f.type||f.type==="enum"&&f.values[S]||(S=void 0)}return gy(S,_.default,f.default)}yh.register(Vg,{error:[{kind:"error"},[Yd],(_,[f])=>{throw new mr(f.evaluate(_))}],typeof:[Yd,[Ld],(_,[f])=>Wf(Wu(f.evaluate(_)))],"to-rgba":[Nf(Qh,4),[Zd],(_,[f])=>f.evaluate(_).toArray()],rgb:[Zd,[Qh,Qh,Qh],fm],rgba:[Zd,[Qh,Qh,Qh,Qh],fm],has:{type:ad,overloads:[[[Yd],(_,[f])=>G_(f.evaluate(_),_.properties())],[[Yd,Xh],(_,[f,S])=>G_(f.evaluate(_),S.evaluate(_))]]},get:{type:Ld,overloads:[[[Yd],(_,[f])=>eg(f.evaluate(_),_.properties())],[[Yd,Xh],(_,[f,S])=>eg(f.evaluate(_),S.evaluate(_))]]},"feature-state":[Ld,[Yd],(_,[f])=>eg(f.evaluate(_),_.featureState||{})],properties:[Xh,[],_=>_.properties()],"geometry-type":[Yd,[],_=>_.geometryType()],id:[Ld,[],_=>_.id()],zoom:[Qh,[],_=>_.globals.zoom],"heatmap-density":[Qh,[],_=>_.globals.heatmapDensity||0],"line-progress":[Qh,[],_=>_.globals.lineProgress||0],accumulated:[Ld,[],_=>_.globals.accumulated===void 0?null:_.globals.accumulated],"+":[Qh,h_(Qh),(_,f)=>{let S=0;for(const j of f)S+=j.evaluate(_);return S}],"*":[Qh,h_(Qh),(_,f)=>{let S=1;for(const j of f)S*=j.evaluate(_);return S}],"-":{type:Qh,overloads:[[[Qh,Qh],(_,[f,S])=>f.evaluate(_)-S.evaluate(_)],[[Qh],(_,[f])=>-f.evaluate(_)]]},"/":[Qh,[Qh,Qh],(_,[f,S])=>f.evaluate(_)/S.evaluate(_)],"%":[Qh,[Qh,Qh],(_,[f,S])=>f.evaluate(_)%S.evaluate(_)],ln2:[Qh,[],()=>Math.LN2],pi:[Qh,[],()=>Math.PI],e:[Qh,[],()=>Math.E],"^":[Qh,[Qh,Qh],(_,[f,S])=>Math.pow(f.evaluate(_),S.evaluate(_))],sqrt:[Qh,[Qh],(_,[f])=>Math.sqrt(f.evaluate(_))],log10:[Qh,[Qh],(_,[f])=>Math.log(f.evaluate(_))/Math.LN10],ln:[Qh,[Qh],(_,[f])=>Math.log(f.evaluate(_))],log2:[Qh,[Qh],(_,[f])=>Math.log(f.evaluate(_))/Math.LN2],sin:[Qh,[Qh],(_,[f])=>Math.sin(f.evaluate(_))],cos:[Qh,[Qh],(_,[f])=>Math.cos(f.evaluate(_))],tan:[Qh,[Qh],(_,[f])=>Math.tan(f.evaluate(_))],asin:[Qh,[Qh],(_,[f])=>Math.asin(f.evaluate(_))],acos:[Qh,[Qh],(_,[f])=>Math.acos(f.evaluate(_))],atan:[Qh,[Qh],(_,[f])=>Math.atan(f.evaluate(_))],min:[Qh,h_(Qh),(_,f)=>Math.min(...f.map(S=>S.evaluate(_)))],max:[Qh,h_(Qh),(_,f)=>Math.max(...f.map(S=>S.evaluate(_)))],abs:[Qh,[Qh],(_,[f])=>Math.abs(f.evaluate(_))],round:[Qh,[Qh],(_,[f])=>{const S=f.evaluate(_);return S<0?-Math.round(-S):Math.round(S)}],floor:[Qh,[Qh],(_,[f])=>Math.floor(f.evaluate(_))],ceil:[Qh,[Qh],(_,[f])=>Math.ceil(f.evaluate(_))],"filter-==":[ad,[Yd,Ld],(_,[f,S])=>_.properties()[f.value]===S.value],"filter-id-==":[ad,[Ld],(_,[f])=>_.id()===f.value],"filter-type-==":[ad,[Yd],(_,[f])=>_.geometryType()===f.value],"filter-<":[ad,[Yd,Ld],(_,[f,S])=>{const j=_.properties()[f.value],ut=S.value;return typeof j==typeof ut&&j<ut}],"filter-id-<":[ad,[Ld],(_,[f])=>{const S=_.id(),j=f.value;return typeof S==typeof j&&S<j}],"filter->":[ad,[Yd,Ld],(_,[f,S])=>{const j=_.properties()[f.value],ut=S.value;return typeof j==typeof ut&&j>ut}],"filter-id->":[ad,[Ld],(_,[f])=>{const S=_.id(),j=f.value;return typeof S==typeof j&&S>j}],"filter-<=":[ad,[Yd,Ld],(_,[f,S])=>{const j=_.properties()[f.value],ut=S.value;return typeof j==typeof ut&&j<=ut}],"filter-id-<=":[ad,[Ld],(_,[f])=>{const S=_.id(),j=f.value;return typeof S==typeof j&&S<=j}],"filter->=":[ad,[Yd,Ld],(_,[f,S])=>{const j=_.properties()[f.value],ut=S.value;return typeof j==typeof ut&&j>=ut}],"filter-id->=":[ad,[Ld],(_,[f])=>{const S=_.id(),j=f.value;return typeof S==typeof j&&S>=j}],"filter-has":[ad,[Ld],(_,[f])=>f.value in _.properties()],"filter-has-id":[ad,[],_=>_.id()!==null&&_.id()!==void 0],"filter-type-in":[ad,[Nf(Yd)],(_,[f])=>f.value.indexOf(_.geometryType())>=0],"filter-id-in":[ad,[Nf(Ld)],(_,[f])=>f.value.indexOf(_.id())>=0],"filter-in-small":[ad,[Yd,Nf(Ld)],(_,[f,S])=>S.value.indexOf(_.properties()[f.value])>=0],"filter-in-large":[ad,[Yd,Nf(Ld)],(_,[f,S])=>function(j,ut,Ot,fi){for(;Ot<=fi;){const Ur=Ot+fi>>1;if(ut[Ur]===j)return!0;ut[Ur]>j?fi=Ur-1:Ot=Ur+1}return!1}(_.properties()[f.value],S.value,0,S.value.length-1)],all:{type:ad,overloads:[[[ad,ad],(_,[f,S])=>f.evaluate(_)&&S.evaluate(_)],[h_(ad),(_,f)=>{for(const S of f)if(!S.evaluate(_))return!1;return!0}]]},any:{type:ad,overloads:[[[ad,ad],(_,[f,S])=>f.evaluate(_)||S.evaluate(_)],[h_(ad),(_,f)=>{for(const S of f)if(S.evaluate(_))return!0;return!1}]]},"!":[ad,[ad],(_,[f])=>!f.evaluate(_)],"is-supported-script":[ad,[Yd],(_,[f])=>{const S=_.globals&&_.globals.isSupportedScript;return!S||S(f.evaluate(_))}],upcase:[Yd,[Yd],(_,[f])=>f.evaluate(_).toUpperCase()],downcase:[Yd,[Yd],(_,[f])=>f.evaluate(_).toLowerCase()],concat:[Yd,h_(Ld),(_,f)=>f.map(S=>al(S.evaluate(_))).join("")],"resolved-locale":[Yd,[Kf],(_,[f])=>f.evaluate(_).resolvedLocale()]});class Fy{constructor(f,S){this.expression=f,this._warningHistory={},this._evaluator=new dh,this._defaultValue=S?function(j){return j.type==="color"&&sy(j.default)?new hp(0,0,0,0):j.type==="color"?hp.parse(j.default)||null:j.type==="padding"?Dd.parse(j.default)||null:j.default===void 0?null:j.default}(S):null,this._enumValues=S&&S.type==="enum"?S.values:null}evaluateWithoutErrorHandling(f,S,j,ut,Ot,fi){return this._evaluator.globals=f,this._evaluator.feature=S,this._evaluator.featureState=j,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi,this.expression.evaluate(this._evaluator)}evaluate(f,S,j,ut,Ot,fi){this._evaluator.globals=f,this._evaluator.feature=S||null,this._evaluator.featureState=j||null,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi||null;try{const Ur=this.expression.evaluate(this._evaluator);if(Ur==null||typeof Ur=="number"&&Ur!=Ur)return this._defaultValue;if(this._enumValues&&!(Ur in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(us=>JSON.stringify(us)).join(", ")}, but found ${JSON.stringify(Ur)} instead.`);return Ur}catch(Ur){return this._warningHistory[Ur.message]||(this._warningHistory[Ur.message]=!0,typeof console<"u"&&console.warn(Ur.message)),this._defaultValue}}}function q_(_){return Array.isArray(_)&&_.length>0&&typeof _[0]=="string"&&_[0]in Vg}function d_(_,f){const S=new c_(Vg,[],f?function(ut){const Ot={color:Zd,string:Yd,number:Qh,enum:Yd,boolean:ad,formatted:If,padding:Df,resolvedImage:Jf};return ut.type==="array"?Nf(Ot[ut.value]||Ld,ut.length):Ot[ut.type]}(f):void 0),j=S.parse(_,void 0,void 0,void 0,f&&f.type==="string"?{typeAnnotation:"coerce"}:void 0);return j?iv(new Fy(j,f)):zy(S.errors)}class c0{constructor(f,S){this.kind=f,this._styleExpression=S,this.isStateDependent=f!=="constant"&&!Dy(S.expression)}evaluateWithoutErrorHandling(f,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(f,S,j,ut,Ot,fi)}evaluate(f,S,j,ut,Ot,fi){return this._styleExpression.evaluate(f,S,j,ut,Ot,fi)}}class u0{constructor(f,S,j,ut){this.kind=f,this.zoomStops=j,this._styleExpression=S,this.isStateDependent=f!=="camera"&&!Dy(S.expression),this.interpolationType=ut}evaluateWithoutErrorHandling(f,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(f,S,j,ut,Ot,fi)}evaluate(f,S,j,ut,Ot,fi){return this._styleExpression.evaluate(f,S,j,ut,Ot,fi)}interpolationFactor(f,S,j){return this.interpolationType?Np.interpolationFactor(this.interpolationType,f,S,j):0}}function nv(_,f){const S=d_(_,f);if(S.result==="error")return S;const j=S.value.expression,ut=I_(j);if(!ut&&!j_(f))return zy([new op("","data expressions not supported")]);const Ot=Pg(j,["zoom"]);if(!Ot&&!s0(f))return zy([new op("","zoom expressions not supported")]);const fi=h0(j);return fi||Ot?fi instanceof op?zy([fi]):fi instanceof Np&&!a0(f)?zy([new op("",'"interpolate" expressions cannot be used with this property')]):iv(fi?new u0(ut?"camera":"composite",S.value,fi.labels,fi instanceof Np?fi.interpolation:void 0):new c0(ut?"constant":"source",S.value)):zy([new op("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $y{constructor(f,S){this._parameters=f,this._specification=S,jf(this,l0(this._parameters,this._specification))}static deserialize(f){return new $y(f._parameters,f._specification)}static serialize(f){return{_parameters:f._parameters,_specification:f._specification}}}function h0(_){let f=null;if(_ instanceof bg)f=h0(_.result);else if(_ instanceof Um){for(const S of _.args)if(f=h0(S),f)break}else(_ instanceof Jp||_ instanceof Np)&&_.input instanceof yh&&_.input.name==="zoom"&&(f=_);return f instanceof op||_.eachChild(S=>{const j=h0(S);j instanceof op?f=j:!f&&j?f=new op("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):f&&j&&f!==j&&(f=new op("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),f}function Eg(_){const f=_.key,S=_.value,j=_.valueSpec||{},ut=_.objectElementValidators||{},Ot=_.style,fi=_.styleSpec,Ur=_.validateSpec;let us=[];const ul=wm(S);if(ul!=="object")return[new $d(f,S,`object expected, ${ul} found`)];for(const Ju in S){const oh=Ju.split(".")[0],gh=j[oh]||j["*"];let vh;if(ut[oh])vh=ut[oh];else if(j[oh])vh=Ur;else if(ut["*"])vh=ut["*"];else{if(!j["*"]){us.push(new $d(f,S[Ju],`unknown property "${Ju}"`));continue}vh=Ur}us=us.concat(vh({key:(f&&`${f}.`)+Ju,value:S[Ju],valueSpec:gh,style:Ot,styleSpec:fi,object:S,objectKey:Ju,validateSpec:Ur},S))}for(const Ju in j)ut[Ju]||j[Ju].required&&j[Ju].default===void 0&&S[Ju]===void 0&&us.push(new $d(f,S,`missing required property "${Ju}"`));return us}function Z_(_){const f=_.value,S=_.valueSpec,j=_.style,ut=_.styleSpec,Ot=_.key,fi=_.arrayElementValidator||_.validateSpec;if(wm(f)!=="array")return[new $d(Ot,f,`array expected, ${wm(f)} found`)];if(S.length&&f.length!==S.length)return[new $d(Ot,f,`array length ${S.length} expected, length ${f.length} found`)];if(S["min-length"]&&f.length<S["min-length"])return[new $d(Ot,f,`array length at least ${S["min-length"]} expected, length ${f.length} found`)];let Ur={type:S.value,values:S.values};ut.$version<7&&(Ur.function=S.function),wm(S.value)==="object"&&(Ur=S.value);let us=[];for(let ul=0;ul<f.length;ul++)us=us.concat(fi({array:f,arrayIndex:ul,value:f[ul],valueSpec:Ur,validateSpec:_.validateSpec,style:j,styleSpec:ut,key:`${Ot}[${ul}]`}));return us}function f_(_){const f=_.key,S=_.value,j=_.valueSpec;let ut=wm(S);return ut==="number"&&S!=S&&(ut="NaN"),ut!=="number"?[new $d(f,S,`number expected, ${ut} found`)]:"minimum"in j&&S<j.minimum?[new $d(f,S,`${S} is less than the minimum value ${j.minimum}`)]:"maximum"in j&&S>j.maximum?[new $d(f,S,`${S} is greater than the maximum value ${j.maximum}`)]:[]}function p_(_){const f=_.valueSpec,S=yd(_.value.type);let j,ut,Ot,fi={};const Ur=S!=="categorical"&&_.value.property===void 0,us=!Ur,ul=wm(_.value.stops)==="array"&&wm(_.value.stops[0])==="array"&&wm(_.value.stops[0][0])==="object",Ju=Eg({key:_.key,value:_.value,valueSpec:_.styleSpec.function,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(vh){if(S==="identity")return[new $d(vh.key,vh.value,'identity function may not have a "stops" property')];let bh=[];const Wh=vh.value;return bh=bh.concat(Z_({key:vh.key,value:Wh,valueSpec:vh.valueSpec,validateSpec:vh.validateSpec,style:vh.style,styleSpec:vh.styleSpec,arrayElementValidator:oh})),wm(Wh)==="array"&&Wh.length===0&&bh.push(new $d(vh.key,Wh,"array must have at least one stop")),bh},default:function(vh){return vh.validateSpec({key:vh.key,value:vh.value,valueSpec:f,validateSpec:vh.validateSpec,style:vh.style,styleSpec:vh.styleSpec})}}});return S==="identity"&&Ur&&Ju.push(new $d(_.key,_.value,'missing required property "property"')),S==="identity"||_.value.stops||Ju.push(new $d(_.key,_.value,'missing required property "stops"')),S==="exponential"&&_.valueSpec.expression&&!a0(_.valueSpec)&&Ju.push(new $d(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(us&&!j_(_.valueSpec)?Ju.push(new $d(_.key,_.value,"property functions not supported")):Ur&&!s0(_.valueSpec)&&Ju.push(new $d(_.key,_.value,"zoom functions not supported"))),S!=="categorical"&&!ul||_.value.property!==void 0||Ju.push(new $d(_.key,_.value,'"property" property is required')),Ju;function oh(vh){let bh=[];const Wh=vh.value,Zh=vh.key;if(wm(Wh)!=="array")return[new $d(Zh,Wh,`array expected, ${wm(Wh)} found`)];if(Wh.length!==2)return[new $d(Zh,Wh,`array length 2 expected, length ${Wh.length} found`)];if(ul){if(wm(Wh[0])!=="object")return[new $d(Zh,Wh,`object expected, ${wm(Wh[0])} found`)];if(Wh[0].zoom===void 0)return[new $d(Zh,Wh,"object stop key must have zoom")];if(Wh[0].value===void 0)return[new $d(Zh,Wh,"object stop key must have value")];if(Ot&&Ot>yd(Wh[0].zoom))return[new $d(Zh,Wh[0].zoom,"stop zoom values must appear in ascending order")];yd(Wh[0].zoom)!==Ot&&(Ot=yd(Wh[0].zoom),ut=void 0,fi={}),bh=bh.concat(Eg({key:`${Zh}[0]`,value:Wh[0],valueSpec:{zoom:{}},validateSpec:vh.validateSpec,style:vh.style,styleSpec:vh.styleSpec,objectElementValidators:{zoom:f_,value:gh}}))}else bh=bh.concat(gh({key:`${Zh}[0]`,value:Wh[0],valueSpec:{},validateSpec:vh.validateSpec,style:vh.style,styleSpec:vh.styleSpec},Wh));return q_(Qd(Wh[1]))?bh.concat([new $d(`${Zh}[1]`,Wh[1],"expressions are not allowed in function stops.")]):bh.concat(vh.validateSpec({key:`${Zh}[1]`,value:Wh[1],valueSpec:f,validateSpec:vh.validateSpec,style:vh.style,styleSpec:vh.styleSpec}))}function gh(vh,bh){const Wh=wm(vh.value),Zh=yd(vh.value),bd=vh.value!==null?vh.value:bh;if(j){if(Wh!==j)return[new $d(vh.key,bd,`${Wh} stop domain type must match previous stop domain type ${j}`)]}else j=Wh;if(Wh!=="number"&&Wh!=="string"&&Wh!=="boolean")return[new $d(vh.key,bd,"stop domain value must be a number, string, or boolean")];if(Wh!=="number"&&S!=="categorical"){let zd=`number expected, ${Wh} found`;return j_(f)&&S===void 0&&(zd+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $d(vh.key,bd,zd)]}return S!=="categorical"||Wh!=="number"||isFinite(Zh)&&Math.floor(Zh)===Zh?S!=="categorical"&&Wh==="number"&&ut!==void 0&&Zh<ut?[new $d(vh.key,bd,"stop domain values must appear in ascending order")]:(ut=Zh,S==="categorical"&&Zh in fi?[new $d(vh.key,bd,"stop domain values must be unique")]:(fi[Zh]=!0,[])):[new $d(vh.key,bd,`integer expected, found ${Zh}`)]}}function Kp(_){const f=(_.expressionContext==="property"?nv:d_)(Qd(_.value),_.valueSpec);if(f.result==="error")return f.value.map(j=>new $d(`${_.key}${j.key}`,_.value,j.message));const S=f.value.expression||f.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!S.outputDefined())return[new $d(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!Dy(S))return[new $d(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter"&&!Dy(S))return[new $d(_.key,_.value,'"feature-state" data expressions are not supported with filters.')];if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!Pg(S,["zoom","feature-state"]))return[new $d(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!I_(S))return[new $d(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function M_(_){const f=_.key,S=_.value,j=_.valueSpec,ut=[];return Array.isArray(j.values)?j.values.indexOf(yd(S))===-1&&ut.push(new $d(f,S,`expected one of [${j.values.join(", ")}], ${JSON.stringify(S)} found`)):Object.keys(j.values).indexOf(yd(S))===-1&&ut.push(new $d(f,S,`expected one of [${Object.keys(j.values).join(", ")}], ${JSON.stringify(S)} found`)),ut}function m_(_){if(_===!0||_===!1)return!0;if(!Array.isArray(_)||_.length===0)return!1;switch(_[0]){case"has":return _.length>=2&&_[1]!=="$id"&&_[1]!=="$type";case"in":return _.length>=3&&(typeof _[1]!="string"||Array.isArray(_[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return _.length!==3||Array.isArray(_[1])||Array.isArray(_[2]);case"any":case"all":for(const f of _.slice(1))if(!m_(f)&&typeof f!="boolean")return!1;return!0;default:return!0}}const Nv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _y(_){if(_==null)return{filter:()=>!0,needGeometry:!1};m_(_)||(_=d0(_));const f=d_(_,Nv);if(f.result==="error")throw new Error(f.value.map(S=>`${S.key}: ${S.message}`).join(", "));return{filter:(S,j,ut)=>f.value.evaluate(S,j,{},ut),needGeometry:Xm(_)}}function Uy(_,f){return _<f?-1:_>f?1:0}function Xm(_){if(!Array.isArray(_))return!1;if(_[0]==="within")return!0;for(let f=1;f<_.length;f++)if(Xm(_[f]))return!0;return!1}function d0(_){if(!_)return!0;const f=_[0];return _.length<=1?f!=="any":f==="=="?um(_[1],_[2],"=="):f==="!="?Im(um(_[1],_[2],"==")):f==="<"||f===">"||f==="<="||f===">="?um(_[1],_[2],f):f==="any"?(S=_.slice(1),["any"].concat(S.map(d0))):f==="all"?["all"].concat(_.slice(1).map(d0)):f==="none"?["all"].concat(_.slice(1).map(d0).map(Im)):f==="in"?Vy(_[1],_.slice(2)):f==="!in"?Im(Vy(_[1],_.slice(2))):f==="has"?zm(_[1]):f==="!has"?Im(zm(_[1])):f!=="within"||_;var S}function um(_,f,S){switch(_){case"$type":return[`filter-type-${S}`,f];case"$id":return[`filter-id-${S}`,f];default:return[`filter-${S}`,_,f]}}function Vy(_,f){if(f.length===0)return!1;switch(_){case"$type":return["filter-type-in",["literal",f]];case"$id":return["filter-id-in",["literal",f]];default:return f.length>200&&!f.some(S=>typeof S!=typeof f[0])?["filter-in-large",_,["literal",f.sort(Uy)]]:["filter-in-small",_,["literal",f]]}}function zm(_){switch(_){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",_]}}function Im(_){return["!",_]}function g_(_){return m_(Qd(_.value))?Kp(jf({},_,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ly(_)}function ly(_){const f=_.value,S=_.key;if(wm(f)!=="array")return[new $d(S,f,`array expected, ${wm(f)} found`)];const j=_.styleSpec;let ut,Ot=[];if(f.length<1)return[new $d(S,f,"filter array must have at least 1 element")];switch(Ot=Ot.concat(M_({key:`${S}[0]`,value:f[0],valueSpec:j.filter_operator,style:_.style,styleSpec:_.styleSpec})),yd(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&yd(f[1])==="$type"&&Ot.push(new $d(S,f,`"$type" cannot be use with operator "${f[0]}"`));case"==":case"!=":f.length!==3&&Ot.push(new $d(S,f,`filter array for operator "${f[0]}" must have 3 elements`));case"in":case"!in":f.length>=2&&(ut=wm(f[1]),ut!=="string"&&Ot.push(new $d(`${S}[1]`,f[1],`string expected, ${ut} found`)));for(let fi=2;fi<f.length;fi++)ut=wm(f[fi]),yd(f[1])==="$type"?Ot=Ot.concat(M_({key:`${S}[${fi}]`,value:f[fi],valueSpec:j.geometry_type,style:_.style,styleSpec:_.styleSpec})):ut!=="string"&&ut!=="number"&&ut!=="boolean"&&Ot.push(new $d(`${S}[${fi}]`,f[fi],`string, number, or boolean expected, ${ut} found`));break;case"any":case"all":case"none":for(let fi=1;fi<f.length;fi++)Ot=Ot.concat(ly({key:`${S}[${fi}]`,value:f[fi],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":ut=wm(f[1]),f.length!==2?Ot.push(new $d(S,f,`filter array for "${f[0]}" operator must have 2 elements`)):ut!=="string"&&Ot.push(new $d(`${S}[1]`,f[1],`string expected, ${ut} found`));break;case"within":ut=wm(f[1]),f.length!==2?Ot.push(new $d(S,f,`filter array for "${f[0]}" operator must have 2 elements`)):ut!=="object"&&Ot.push(new $d(`${S}[1]`,f[1],`object expected, ${ut} found`))}return Ot}function xv(_,f){const S=_.key,j=_.validateSpec,ut=_.style,Ot=_.styleSpec,fi=_.value,Ur=_.objectKey,us=Ot[`${f}_${_.layerType}`];if(!us)return[];const ul=Ur.match(/^(.*)-transition$/);if(f==="paint"&&ul&&us[ul[1]]&&us[ul[1]].transition)return j({key:S,value:fi,valueSpec:Ot.transition,style:ut,styleSpec:Ot});const Ju=_.valueSpec||us[Ur];if(!Ju)return[new $d(S,fi,`unknown property "${Ur}"`)];let oh;if(wm(fi)==="string"&&j_(Ju)&&!Ju.tokens&&(oh=/^{([^}]+)}$/.exec(fi)))return[new $d(S,fi,`"${Ur}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(oh[1])} }\`.`)];const gh=[];return _.layerType==="symbol"&&(Ur==="text-field"&&ut&&!ut.glyphs&&gh.push(new $d(S,fi,'use of "text-field" requires a style "glyphs" property')),Ur==="text-font"&&sy(Qd(fi))&&yd(fi.type)==="identity"&&gh.push(new $d(S,fi,'"text-font" does not support identity functions'))),gh.concat(j({key:_.key,value:fi,valueSpec:Ju,style:ut,styleSpec:Ot,expressionContext:"property",propertyType:f,propertyKey:Ur}))}function cy(_){return xv(_,"paint")}function f0(_){return xv(_,"layout")}function __(_){let f=[];const S=_.value,j=_.key,ut=_.style,Ot=_.styleSpec;S.type||S.ref||f.push(new $d(j,S,'either "type" or "ref" is required'));let fi=yd(S.type);const Ur=yd(S.ref);if(S.id){const us=yd(S.id);for(let ul=0;ul<_.arrayIndex;ul++){const Ju=ut.layers[ul];yd(Ju.id)===us&&f.push(new $d(j,S.id,`duplicate layer id "${S.id}", previously used at line ${Ju.id.__line__}`))}}if("ref"in S){let us;["type","source","source-layer","filter","layout"].forEach(ul=>{ul in S&&f.push(new $d(j,S[ul],`"${ul}" is prohibited for ref layers`))}),ut.layers.forEach(ul=>{yd(ul.id)===Ur&&(us=ul)}),us?us.ref?f.push(new $d(j,S.ref,"ref cannot reference another ref layer")):fi=yd(us.type):f.push(new $d(j,S.ref,`ref layer "${Ur}" not found`))}else if(fi!=="background")if(S.source){const us=ut.sources&&ut.sources[S.source],ul=us&&yd(us.type);us?ul==="vector"&&fi==="raster"?f.push(new $d(j,S.source,`layer "${S.id}" requires a raster source`)):ul==="raster"&&fi!=="raster"?f.push(new $d(j,S.source,`layer "${S.id}" requires a vector source`)):ul!=="vector"||S["source-layer"]?ul==="raster-dem"&&fi!=="hillshade"?f.push(new $d(j,S.source,"raster-dem source can only be used with layer type 'hillshade'.")):fi!=="line"||!S.paint||!S.paint["line-gradient"]||ul==="geojson"&&us.lineMetrics||f.push(new $d(j,S,`layer "${S.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):f.push(new $d(j,S,`layer "${S.id}" must specify a "source-layer"`)):f.push(new $d(j,S.source,`source "${S.source}" not found`))}else f.push(new $d(j,S,'missing required property "source"'));return f=f.concat(Eg({key:j,value:S,valueSpec:Ot.layer,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":()=>[],type:()=>_.validateSpec({key:`${j}.type`,value:S.type,valueSpec:Ot.layer.type,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,object:S,objectKey:"type"}),filter:g_,layout:us=>Eg({layer:S,key:us.key,value:us.value,style:us.style,styleSpec:us.styleSpec,validateSpec:us.validateSpec,objectElementValidators:{"*":ul=>f0(jf({layerType:fi},ul))}}),paint:us=>Eg({layer:S,key:us.key,value:us.value,style:us.style,styleSpec:us.styleSpec,validateSpec:us.validateSpec,objectElementValidators:{"*":ul=>cy(jf({layerType:fi},ul))}})}})),f}function H_(_){const f=_.value,S=_.key,j=wm(f);return j!=="string"?[new $d(S,f,`string expected, ${j} found`)]:[]}const jy={promoteId:function({key:_,value:f}){if(wm(f)==="string")return H_({key:_,value:f});{const S=[];for(const j in f)S.push(...H_({key:`${_}.${j}`,value:f[j]}));return S}}};function yy(_){const f=_.value,S=_.key,j=_.styleSpec,ut=_.style,Ot=_.validateSpec;if(!f.type)return[new $d(S,f,'"type" is required')];const fi=yd(f.type);let Ur;switch(fi){case"vector":case"raster":case"raster-dem":return Ur=Eg({key:S,value:f,valueSpec:j[`source_${fi.replace("-","_")}`],style:_.style,styleSpec:j,objectElementValidators:jy,validateSpec:Ot}),Ur;case"geojson":if(Ur=Eg({key:S,value:f,valueSpec:j.source_geojson,style:ut,styleSpec:j,validateSpec:Ot,objectElementValidators:jy}),f.cluster)for(const us in f.clusterProperties){const[ul,Ju]=f.clusterProperties[us],oh=typeof ul=="string"?[ul,["accumulated"],["get",us]]:ul;Ur.push(...Kp({key:`${S}.${us}.map`,value:Ju,validateSpec:Ot,expressionContext:"cluster-map"})),Ur.push(...Kp({key:`${S}.${us}.reduce`,value:oh,validateSpec:Ot,expressionContext:"cluster-reduce"}))}return Ur;case"video":return Eg({key:S,value:f,valueSpec:j.source_video,style:ut,validateSpec:Ot,styleSpec:j});case"image":return Eg({key:S,value:f,valueSpec:j.source_image,style:ut,validateSpec:Ot,styleSpec:j});case"canvas":return[new $d(S,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return M_({key:`${S}.type`,value:f.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ut,validateSpec:Ot,styleSpec:j})}}function Qg(_){const f=_.value,S=_.styleSpec,j=S.light,ut=_.style;let Ot=[];const fi=wm(f);if(f===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new $d("light",f,`object expected, ${fi} found`)]),Ot;for(const Ur in f){const us=Ur.match(/^(.*)-transition$/);Ot=Ot.concat(us&&j[us[1]]&&j[us[1]].transition?_.validateSpec({key:Ur,value:f[Ur],valueSpec:S.transition,validateSpec:_.validateSpec,style:ut,styleSpec:S}):j[Ur]?_.validateSpec({key:Ur,value:f[Ur],valueSpec:j[Ur],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new $d(Ur,f[Ur],`unknown property "${Ur}"`)])}return Ot}function qy(_){const f=_.value,S=_.styleSpec,j=S.terrain,ut=_.style;let Ot=[];const fi=wm(f);if(f===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new $d("terrain",f,`object expected, ${fi} found`)]),Ot;for(const Ur in f)Ot=Ot.concat(j[Ur]?_.validateSpec({key:Ur,value:f[Ur],valueSpec:j[Ur],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new $d(Ur,f[Ur],`unknown property "${Ur}"`)]);return Ot}function rv(_){let f=[];const S=_.value,j=_.key;if(Array.isArray(S)){const ut=[],Ot=[];for(const fi in S)S[fi].id&&ut.includes(S[fi].id)&&f.push(new $d(j,S,`all the sprites' ids must be unique, but ${S[fi].id} is duplicated`)),ut.push(S[fi].id),S[fi].url&&Ot.includes(S[fi].url)&&f.push(new $d(j,S,`all the sprites' URLs must be unique, but ${S[fi].url} is duplicated`)),Ot.push(S[fi].url),f=f.concat(Eg({key:`${j}[${fi}]`,value:S[fi],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:_.validateSpec}));return f}return H_({key:j,value:S})}const p0={"*":()=>[],array:Z_,boolean:function(_){const f=_.value,S=_.key,j=wm(f);return j!=="boolean"?[new $d(S,f,`boolean expected, ${j} found`)]:[]},number:f_,color:function(_){const f=_.key,S=_.value,j=wm(S);return j!=="string"?[new $d(f,S,`color expected, ${j} found`)]:qp(S)===null?[new $d(f,S,`color expected, "${S}" found`)]:[]},constants:np,enum:M_,filter:g_,function:p_,layer:__,object:Eg,source:yy,light:Qg,terrain:qy,string:H_,formatted:function(_){return H_(_).length===0?[]:Kp(_)},resolvedImage:function(_){return H_(_).length===0?[]:Kp(_)},padding:function(_){const f=_.key,S=_.value;if(wm(S)==="array"){if(S.length<1||S.length>4)return[new $d(f,S,`padding requires 1 to 4 values; ${S.length} values found`)];const j={type:"number"};let ut=[];for(let Ot=0;Ot<S.length;Ot++)ut=ut.concat(_.validateSpec({key:`${f}[${Ot}]`,value:S[Ot],validateSpec:_.validateSpec,valueSpec:j}));return ut}return f_({key:f,value:S,valueSpec:{}})},sprite:rv};function C_(_){const f=_.value,S=_.valueSpec,j=_.styleSpec;return _.validateSpec=C_,S.expression&&sy(yd(f))?p_(_):S.expression&&q_(Qd(f))?Kp(_):S.type&&p0[S.type]?p0[S.type](_):Eg(jf({},_,{valueSpec:S.type?j[S.type]:S}))}function m0(_){const f=_.value,S=_.key,j=H_(_);return j.length||(f.indexOf("{fontstack}")===-1&&j.push(new $d(S,f,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&j.push(new $d(S,f,'"glyphs" url must include a "{range}" token'))),j}function X_(_,f=td){let S=[];return S=S.concat(C_({key:"",value:_,valueSpec:f.$root,styleSpec:f,style:_,validateSpec:C_,objectElementValidators:{glyphs:m0,"*":()=>[]}})),_.constants&&(S=S.concat(np({key:"constants",value:_.constants,style:_,styleSpec:f,validateSpec:C_}))),wf(S)}function hd(_){return function(f){return _({...f,validateSpec:C_})}}function wf(_){return[].concat(_).sort((f,S)=>f.line-S.line)}function ip(_){return function(...f){return wf(_.apply(this,f))}}X_.source=ip(hd(yy)),X_.sprite=ip(hd(rv)),X_.glyphs=ip(hd(m0)),X_.light=ip(hd(Qg)),X_.terrain=ip(hd(qy)),X_.layer=ip(hd(__)),X_.filter=ip(hd(g_)),X_.paintProperty=ip(hd(cy)),X_.layoutProperty=ip(hd(f0));const Bp=X_,Nm=Bp.light,hm=Bp.paintProperty,Qm=Bp.layoutProperty;function og(_,f){let S=!1;if(f&&f.length)for(const j of f)_.fire(new bf(new Error(j.message))),S=!0;return S}class sg{constructor(f,S,j){const ut=this.cells=[];if(f instanceof ArrayBuffer){this.arrayBuffer=f;const fi=new Int32Array(this.arrayBuffer);f=fi[0],this.d=(S=fi[1])+2*(j=fi[2]);for(let us=0;us<this.d*this.d;us++){const ul=fi[3+us],Ju=fi[3+us+1];ut.push(ul===Ju?null:fi.subarray(ul,Ju))}const Ur=fi[3+ut.length+1];this.keys=fi.subarray(fi[3+ut.length],Ur),this.bboxes=fi.subarray(Ur),this.insert=this._insertReadonly}else{this.d=S+2*j;for(let fi=0;fi<this.d*this.d;fi++)ut.push([]);this.keys=[],this.bboxes=[]}this.n=S,this.extent=f,this.padding=j,this.scale=S/f,this.uid=0;const Ot=j/S*f;this.min=-Ot,this.max=f+Ot}insert(f,S,j,ut,Ot){this._forEachCell(S,j,ut,Ot,this._insertCell,this.uid++,void 0,void 0),this.keys.push(f),this.bboxes.push(S),this.bboxes.push(j),this.bboxes.push(ut),this.bboxes.push(Ot)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(f,S,j,ut,Ot,fi){this.cells[Ot].push(fi)}query(f,S,j,ut,Ot){const fi=this.min,Ur=this.max;if(f<=fi&&S<=fi&&Ur<=j&&Ur<=ut&&!Ot)return Array.prototype.slice.call(this.keys);{const us=[];return this._forEachCell(f,S,j,ut,this._queryCell,us,{},Ot),us}}_queryCell(f,S,j,ut,Ot,fi,Ur,us){const ul=this.cells[Ot];if(ul!==null){const Ju=this.keys,oh=this.bboxes;for(let gh=0;gh<ul.length;gh++){const vh=ul[gh];if(Ur[vh]===void 0){const bh=4*vh;(us?us(oh[bh+0],oh[bh+1],oh[bh+2],oh[bh+3]):f<=oh[bh+2]&&S<=oh[bh+3]&&j>=oh[bh+0]&&ut>=oh[bh+1])?(Ur[vh]=!0,fi.push(Ju[vh])):Ur[vh]=!1}}}}_forEachCell(f,S,j,ut,Ot,fi,Ur,us){const ul=this._convertToCellCoord(f),Ju=this._convertToCellCoord(S),oh=this._convertToCellCoord(j),gh=this._convertToCellCoord(ut);for(let vh=ul;vh<=oh;vh++)for(let bh=Ju;bh<=gh;bh++){const Wh=this.d*bh+vh;if((!us||us(this._convertFromCellCoord(vh),this._convertFromCellCoord(bh),this._convertFromCellCoord(vh+1),this._convertFromCellCoord(bh+1)))&&Ot.call(this,f,S,j,ut,Wh,fi,Ur,us))return}}_convertFromCellCoord(f){return(f-this.padding)/this.scale}_convertToCellCoord(f){return Math.max(0,Math.min(this.d-1,Math.floor(f*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const f=this.cells,S=3+this.cells.length+1+1;let j=0;for(let fi=0;fi<this.cells.length;fi++)j+=this.cells[fi].length;const ut=new Int32Array(S+j+this.keys.length+this.bboxes.length);ut[0]=this.extent,ut[1]=this.n,ut[2]=this.padding;let Ot=S;for(let fi=0;fi<f.length;fi++){const Ur=f[fi];ut[3+fi]=Ot,ut.set(Ur,Ot),Ot+=Ur.length}return ut[3+f.length]=Ot,ut.set(this.keys,Ot),Ot+=this.keys.length,ut[3+f.length+1]=Ot,ut.set(this.bboxes,Ot),Ot+=this.bboxes.length,ut.buffer}static serialize(f,S){const j=f.toArrayBuffer();return S&&S.push(j),{buffer:j}}static deserialize(f){return new sg(f.buffer)}}const Vm={};function tp(_,f,S={}){if(Vm[_])throw new Error(`${_} is already registered.`);Object.defineProperty(f,"_classRegistryKey",{value:_,writeable:!1}),Vm[_]={klass:f,omit:S.omit||[],shallow:S.shallow||[]}}tp("Object",Object),tp("TransferableGridIndex",sg),tp("Color",hp),tp("Error",Error),tp("AJAXError",Af),tp("ResolvedImage",Hf),tp("StylePropertyFunction",$y),tp("StyleExpression",Fy,{omit:["_evaluator"]}),tp("ZoomDependentExpression",u0),tp("ZoomConstantExpression",c0),tp("CompoundExpression",yh,{omit:["_evaluate"]});for(const _ in Vg)Vg[_]._classRegistryKey||tp(`Expression_${_}`,Vg[_]);function Wg(_){return _&&typeof ArrayBuffer<"u"&&(_ instanceof ArrayBuffer||_.constructor&&_.constructor.name==="ArrayBuffer")}function Sg(_,f){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob)return _;if(Wg(_)||sh(_))return f&&f.push(_),_;if(ArrayBuffer.isView(_)){const S=_;return f&&f.push(S.buffer),S}if(_ instanceof ImageData)return f&&f.push(_.data.buffer),_;if(Array.isArray(_)){const S=[];for(const j of _)S.push(Sg(j,f));return S}if(typeof _=="object"){const S=_.constructor,j=S._classRegistryKey;if(!j)throw new Error("can't serialize object of unregistered class");if(!Vm[j])throw new Error(`${j} is not registered.`);const ut=S.serialize?S.serialize(_,f):{};if(S.serialize){if(f&&ut===f[f.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Ot in _){if(!_.hasOwnProperty(Ot)||Vm[j].omit.indexOf(Ot)>=0)continue;const fi=_[Ot];ut[Ot]=Vm[j].shallow.indexOf(Ot)>=0?fi:Sg(fi,f)}_ instanceof Error&&(ut.message=_.message)}if(ut.$name)throw new Error("$name property is reserved for worker serialization logic.");return j!=="Object"&&(ut.$name=j),ut}throw new Error("can't serialize object of type "+typeof _)}function fg(_){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob||Wg(_)||sh(_)||ArrayBuffer.isView(_)||_ instanceof ImageData)return _;if(Array.isArray(_))return _.map(fg);if(typeof _=="object"){const f=_.$name||"Object";if(!Vm[f])throw new Error(`can't deserialize unregistered class ${f}`);const{klass:S}=Vm[f];if(!S)throw new Error(`can't deserialize unregistered class ${f}`);if(S.deserialize)return S.deserialize(_);const j=Object.create(S.prototype);for(const ut of Object.keys(_)){if(ut==="$name")continue;const Ot=_[ut];j[ut]=Vm[f].shallow.indexOf(ut)>=0?Ot:fg(Ot)}return j}throw new Error("can't deserialize object of type "+typeof _)}class A_{constructor(){this.first=!0}update(f,S){const j=Math.floor(f);return this.first?(this.first=!1,this.lastIntegerZoom=j,this.lastIntegerZoomTime=0,this.lastZoom=f,this.lastFloorZoom=j,!0):(this.lastFloorZoom>j?(this.lastIntegerZoom=j+1,this.lastIntegerZoomTime=S):this.lastFloorZoom<j&&(this.lastIntegerZoom=j,this.lastIntegerZoomTime=S),f!==this.lastZoom&&(this.lastZoom=f,this.lastFloorZoom=j,!0))}}const ap={"Latin-1 Supplement":_=>_>=128&&_<=255,Arabic:_=>_>=1536&&_<=1791,"Arabic Supplement":_=>_>=1872&&_<=1919,"Arabic Extended-A":_=>_>=2208&&_<=2303,"Hangul Jamo":_=>_>=4352&&_<=4607,"Unified Canadian Aboriginal Syllabics":_=>_>=5120&&_<=5759,Khmer:_=>_>=6016&&_<=6143,"Unified Canadian Aboriginal Syllabics Extended":_=>_>=6320&&_<=6399,"General Punctuation":_=>_>=8192&&_<=8303,"Letterlike Symbols":_=>_>=8448&&_<=8527,"Number Forms":_=>_>=8528&&_<=8591,"Miscellaneous Technical":_=>_>=8960&&_<=9215,"Control Pictures":_=>_>=9216&&_<=9279,"Optical Character Recognition":_=>_>=9280&&_<=9311,"Enclosed Alphanumerics":_=>_>=9312&&_<=9471,"Geometric Shapes":_=>_>=9632&&_<=9727,"Miscellaneous Symbols":_=>_>=9728&&_<=9983,"Miscellaneous Symbols and Arrows":_=>_>=11008&&_<=11263,"CJK Radicals Supplement":_=>_>=11904&&_<=12031,"Kangxi Radicals":_=>_>=12032&&_<=12255,"Ideographic Description Characters":_=>_>=12272&&_<=12287,"CJK Symbols and Punctuation":_=>_>=12288&&_<=12351,Hiragana:_=>_>=12352&&_<=12447,Katakana:_=>_>=12448&&_<=12543,Bopomofo:_=>_>=12544&&_<=12591,"Hangul Compatibility Jamo":_=>_>=12592&&_<=12687,Kanbun:_=>_>=12688&&_<=12703,"Bopomofo Extended":_=>_>=12704&&_<=12735,"CJK Strokes":_=>_>=12736&&_<=12783,"Katakana Phonetic Extensions":_=>_>=12784&&_<=12799,"Enclosed CJK Letters and Months":_=>_>=12800&&_<=13055,"CJK Compatibility":_=>_>=13056&&_<=13311,"CJK Unified Ideographs Extension A":_=>_>=13312&&_<=19903,"Yijing Hexagram Symbols":_=>_>=19904&&_<=19967,"CJK Unified Ideographs":_=>_>=19968&&_<=40959,"Yi Syllables":_=>_>=40960&&_<=42127,"Yi Radicals":_=>_>=42128&&_<=42191,"Hangul Jamo Extended-A":_=>_>=43360&&_<=43391,"Hangul Syllables":_=>_>=44032&&_<=55215,"Hangul Jamo Extended-B":_=>_>=55216&&_<=55295,"Private Use Area":_=>_>=57344&&_<=63743,"CJK Compatibility Ideographs":_=>_>=63744&&_<=64255,"Arabic Presentation Forms-A":_=>_>=64336&&_<=65023,"Vertical Forms":_=>_>=65040&&_<=65055,"CJK Compatibility Forms":_=>_>=65072&&_<=65103,"Small Form Variants":_=>_>=65104&&_<=65135,"Arabic Presentation Forms-B":_=>_>=65136&&_<=65279,"Halfwidth and Fullwidth Forms":_=>_>=65280&&_<=65519};function Zy(_){for(const f of _)if(g0(f.charCodeAt(0)))return!0;return!1}function vy(_){for(const f of _)if(!B0(f.charCodeAt(0)))return!1;return!0}function B0(_){return!(ap.Arabic(_)||ap["Arabic Supplement"](_)||ap["Arabic Extended-A"](_)||ap["Arabic Presentation Forms-A"](_)||ap["Arabic Presentation Forms-B"](_))}function g0(_){return!(_!==746&&_!==747&&(_<4352||!(ap["Bopomofo Extended"](_)||ap.Bopomofo(_)||ap["CJK Compatibility Forms"](_)&&!(_>=65097&&_<=65103)||ap["CJK Compatibility Ideographs"](_)||ap["CJK Compatibility"](_)||ap["CJK Radicals Supplement"](_)||ap["CJK Strokes"](_)||!(!ap["CJK Symbols and Punctuation"](_)||_>=12296&&_<=12305||_>=12308&&_<=12319||_===12336)||ap["CJK Unified Ideographs Extension A"](_)||ap["CJK Unified Ideographs"](_)||ap["Enclosed CJK Letters and Months"](_)||ap["Hangul Compatibility Jamo"](_)||ap["Hangul Jamo Extended-A"](_)||ap["Hangul Jamo Extended-B"](_)||ap["Hangul Jamo"](_)||ap["Hangul Syllables"](_)||ap.Hiragana(_)||ap["Ideographic Description Characters"](_)||ap.Kanbun(_)||ap["Kangxi Radicals"](_)||ap["Katakana Phonetic Extensions"](_)||ap.Katakana(_)&&_!==12540||!(!ap["Halfwidth and Fullwidth Forms"](_)||_===65288||_===65289||_===65293||_>=65306&&_<=65310||_===65339||_===65341||_===65343||_>=65371&&_<=65503||_===65507||_>=65512&&_<=65519)||!(!ap["Small Form Variants"](_)||_>=65112&&_<=65118||_>=65123&&_<=65126)||ap["Unified Canadian Aboriginal Syllabics"](_)||ap["Unified Canadian Aboriginal Syllabics Extended"](_)||ap["Vertical Forms"](_)||ap["Yijing Hexagram Symbols"](_)||ap["Yi Syllables"](_)||ap["Yi Radicals"](_))))}function ov(_){return!(g0(_)||function(f){return!!(ap["Latin-1 Supplement"](f)&&(f===167||f===169||f===174||f===177||f===188||f===189||f===190||f===215||f===247)||ap["General Punctuation"](f)&&(f===8214||f===8224||f===8225||f===8240||f===8241||f===8251||f===8252||f===8258||f===8263||f===8264||f===8265||f===8273)||ap["Letterlike Symbols"](f)||ap["Number Forms"](f)||ap["Miscellaneous Technical"](f)&&(f>=8960&&f<=8967||f>=8972&&f<=8991||f>=8996&&f<=9e3||f===9003||f>=9085&&f<=9114||f>=9150&&f<=9165||f===9167||f>=9169&&f<=9179||f>=9186&&f<=9215)||ap["Control Pictures"](f)&&f!==9251||ap["Optical Character Recognition"](f)||ap["Enclosed Alphanumerics"](f)||ap["Geometric Shapes"](f)||ap["Miscellaneous Symbols"](f)&&!(f>=9754&&f<=9759)||ap["Miscellaneous Symbols and Arrows"](f)&&(f>=11026&&f<=11055||f>=11088&&f<=11097||f>=11192&&f<=11243)||ap["CJK Symbols and Punctuation"](f)||ap.Katakana(f)||ap["Private Use Area"](f)||ap["CJK Compatibility Forms"](f)||ap["Small Form Variants"](f)||ap["Halfwidth and Fullwidth Forms"](f)||f===8734||f===8756||f===8757||f>=9984&&f<=10087||f>=10102&&f<=10131||f===65532||f===65533)}(_))}function _0(_){return _>=1424&&_<=2303||ap["Arabic Presentation Forms-A"](_)||ap["Arabic Presentation Forms-B"](_)}function Cm(_,f){return!(!f&&_0(_)||_>=2304&&_<=3583||_>=3840&&_<=4255||ap.Khmer(_))}function sm(_){for(const f of _)if(_0(f.charCodeAt(0)))return!0;return!1}const P_="deferred",Ng="loading",W_="loaded";let Dg=null,Gm="unavailable",ag=null;const Jg=function(_){_&&typeof _=="string"&&_.indexOf("NetworkError")>-1&&(Gm="error"),Dg&&Dg(_)};function k_(){em.fire(new Gd("pluginStateChange",{pluginStatus:Gm,pluginURL:ag}))}const em=new Id,Gg=function(){return Gm},bv=function(){if(Gm!==P_||!ag)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gm=Ng,k_(),ag&&Ed({url:ag},_=>{_?Jg(_):(Gm=W_,k_())})},Ig={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gm===W_||Ig.applyArabicShaping!=null,isLoading:()=>Gm===Ng,setState(_){if(!Zu())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gm=_.pluginStatus,ag=_.pluginURL},isParsed(){if(!Zu())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ig.applyArabicShaping!=null&&Ig.processBidirectionalText!=null&&Ig.processStyledBidirectionalText!=null},getPluginURL(){if(!Zu())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ag}};class Mm{constructor(f,S){this.zoom=f,S?(this.now=S.now,this.fadeDuration=S.fadeDuration,this.zoomHistory=S.zoomHistory,this.transition=S.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new A_,this.transition={})}isSupportedScript(f){return function(S,j){for(const ut of S)if(!Cm(ut.charCodeAt(0),j))return!1;return!0}(f,Ig.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const f=this.zoom,S=f-Math.floor(f),j=this.crossFadingFactor();return f>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:S+(1-S)*j}:{fromScale:.5,toScale:1,t:1-(1-j)*S}}}class D_{constructor(f,S){this.property=f,this.value=S,this.expression=function(j,ut){if(sy(j))return new $y(j,ut);if(q_(j)){const Ot=nv(j,ut);if(Ot.result==="error")throw new Error(Ot.value.map(fi=>`${fi.key}: ${fi.message}`).join(", "));return Ot.value}{let Ot=j;return ut.type==="color"&&typeof j=="string"?Ot=hp.parse(j):ut.type!=="padding"||typeof j!="number"&&!Array.isArray(j)||(Ot=Dd.parse(j)),{kind:"constant",evaluate:()=>Ot}}}(S===void 0?f.specification.default:S,f.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(f,S,j){return this.property.possiblyEvaluate(this,f,S,j)}}class xy{constructor(f){this.property=f,this.value=new D_(f,void 0)}transitioned(f,S){return new y0(this.property,this.value,S,Bt({},f.transition,this.transition),f.now)}untransitioned(){return new y0(this.property,this.value,null,{},0)}}class Hy{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitionablePropertyValues)}getValue(f){return Co(this._values[f].value.value)}setValue(f,S){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new xy(this._values[f].property)),this._values[f].value=new D_(this._values[f].property,S===null?void 0:Co(S))}getTransition(f){return Co(this._values[f].transition)}setTransition(f,S){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new xy(this._values[f].property)),this._values[f].transition=Co(S)||void 0}serialize(){const f={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(f[S]=j);const ut=this.getTransition(S);ut!==void 0&&(f[`${S}-transition`]=ut)}return f}transitioned(f,S){const j=new Y_(this._properties);for(const ut of Object.keys(this._values))j._values[ut]=this._values[ut].transitioned(f,S._values[ut]);return j}untransitioned(){const f=new Y_(this._properties);for(const S of Object.keys(this._values))f._values[S]=this._values[S].untransitioned();return f}}class y0{constructor(f,S,j,ut,Ot){this.property=f,this.value=S,this.begin=Ot+ut.delay||0,this.end=this.begin+ut.duration||0,f.specification.transition&&(ut.delay||ut.duration)&&(this.prior=j)}possiblyEvaluate(f,S,j){const ut=f.now||0,Ot=this.value.possiblyEvaluate(f,S,j),fi=this.prior;if(fi){if(ut>this.end)return this.prior=null,Ot;if(this.value.isDataDriven())return this.prior=null,Ot;if(ut<this.begin)return fi.possiblyEvaluate(f,S,j);{const Ur=(ut-this.begin)/(this.end-this.begin);return this.property.interpolate(fi.possiblyEvaluate(f,S,j),Ot,function(us){if(us<=0)return 0;if(us>=1)return 1;const ul=us*us,Ju=ul*us;return 4*(us<.5?Ju:3*(us-ul)+Ju-.75)}(Ur))}}return Ot}}class Y_{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitioningPropertyValues)}possiblyEvaluate(f,S,j){const ut=new z0(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(f,S,j);return ut}hasTransition(){for(const f of Object.keys(this._values))if(this._values[f].prior)return!0;return!1}}class Xy{constructor(f){this._properties=f,this._values=Object.create(f.defaultPropertyValues)}getValue(f){return Co(this._values[f].value)}setValue(f,S){this._values[f]=new D_(this._values[f].property,S===null?void 0:Co(S))}serialize(){const f={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(f[S]=j)}return f}possiblyEvaluate(f,S,j){const ut=new z0(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(f,S,j);return ut}}class e_{constructor(f,S,j){this.property=f,this.value=S,this.parameters=j}isConstant(){return this.value.kind==="constant"}constantOr(f){return this.value.kind==="constant"?this.value.value:f}evaluate(f,S,j,ut){return this.property.evaluate(this.value,this.parameters,f,S,j,ut)}}class z0{constructor(f){this._properties=f,this._values=Object.create(f.defaultPossiblyEvaluatedValues)}get(f){return this._values[f]}}class kp{constructor(f){this.specification=f}possiblyEvaluate(f,S){if(f.isDataDriven())throw new Error("Value should not be data driven");return f.expression.evaluate(S)}interpolate(f,S,j){const ut=kn[this.specification.type];return ut?ut(f,S,j):f}}class Up{constructor(f,S){this.specification=f,this.overrides=S}possiblyEvaluate(f,S,j,ut){return new e_(this,f.expression.kind==="constant"||f.expression.kind==="camera"?{kind:"constant",value:f.expression.evaluate(S,null,{},j,ut)}:f.expression,S)}interpolate(f,S,j){if(f.value.kind!=="constant"||S.value.kind!=="constant")return f;if(f.value.value===void 0||S.value.value===void 0)return new e_(this,{kind:"constant",value:void 0},f.parameters);const ut=kn[this.specification.type];return ut?new e_(this,{kind:"constant",value:ut(f.value.value,S.value.value,j)},f.parameters):f}evaluate(f,S,j,ut,Ot,fi){return f.kind==="constant"?f.value:f.evaluate(S,j,ut,Ot,fi)}}class by extends Up{possiblyEvaluate(f,S,j,ut){if(f.value===void 0)return new e_(this,{kind:"constant",value:void 0},S);if(f.expression.kind==="constant"){const Ot=f.expression.evaluate(S,null,{},j,ut),fi=f.property.specification.type==="resolvedImage"&&typeof Ot!="string"?Ot.name:Ot,Ur=this._calculate(fi,fi,fi,S);return new e_(this,{kind:"constant",value:Ur},S)}if(f.expression.kind==="camera"){const Ot=this._calculate(f.expression.evaluate({zoom:S.zoom-1}),f.expression.evaluate({zoom:S.zoom}),f.expression.evaluate({zoom:S.zoom+1}),S);return new e_(this,{kind:"constant",value:Ot},S)}return new e_(this,f.expression,S)}evaluate(f,S,j,ut,Ot,fi){if(f.kind==="source"){const Ur=f.evaluate(S,j,ut,Ot,fi);return this._calculate(Ur,Ur,Ur,S)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(S.zoom)-1},j,ut),f.evaluate({zoom:Math.floor(S.zoom)},j,ut),f.evaluate({zoom:Math.floor(S.zoom)+1},j,ut),S):f.value}_calculate(f,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:f,to:S}:{from:j,to:S}}interpolate(f){return f}}class N0{constructor(f){this.specification=f}possiblyEvaluate(f,S,j,ut){if(f.value!==void 0){if(f.expression.kind==="constant"){const Ot=f.expression.evaluate(S,null,{},j,ut);return this._calculate(Ot,Ot,Ot,S)}return this._calculate(f.expression.evaluate(new Mm(Math.floor(S.zoom-1),S)),f.expression.evaluate(new Mm(Math.floor(S.zoom),S)),f.expression.evaluate(new Mm(Math.floor(S.zoom+1),S)),S)}}_calculate(f,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:f,to:S}:{from:j,to:S}}interpolate(f){return f}}class pp{constructor(f){this.specification=f}possiblyEvaluate(f,S,j,ut){return!!f.expression.evaluate(S,null,{},j,ut)}interpolate(){return!1}}class tg{constructor(f){this.properties=f,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const S in f){const j=f[S];j.specification.overridable&&this.overridableProperties.push(S);const ut=this.defaultPropertyValues[S]=new D_(j,void 0),Ot=this.defaultTransitionablePropertyValues[S]=new xy(j);this.defaultTransitioningPropertyValues[S]=Ot.untransitioned(),this.defaultPossiblyEvaluatedValues[S]=ut.possiblyEvaluate({})}}}tp("DataDrivenProperty",Up),tp("DataConstantProperty",kp),tp("CrossFadedDataDrivenProperty",by),tp("CrossFadedProperty",N0),tp("ColorRampProperty",pp);const wv="-transition";class L_ extends Id{constructor(f,S){if(super(),this.id=f.id,this.type=f.type,this._featureFilter={filter:()=>!0,needGeometry:!1},f.type!=="custom"&&(this.metadata=f.metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),S.layout&&(this._unevaluatedLayout=new Xy(S.layout)),S.paint)){this._transitionablePaint=new Hy(S.paint);for(const j in f.paint)this.setPaintProperty(j,f.paint[j],{validate:!1});for(const j in f.layout)this.setLayoutProperty(j,f.layout[j],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new z0(S.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)}setLayoutProperty(f,S,j={}){S!=null&&this._validate(Qm,`layers.${this.id}.layout.${f}`,f,S,j)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,S):this.visibility=S)}getPaintProperty(f){return f.endsWith(wv)?this._transitionablePaint.getTransition(f.slice(0,-wv.length)):this._transitionablePaint.getValue(f)}setPaintProperty(f,S,j={}){if(S!=null&&this._validate(hm,`layers.${this.id}.paint.${f}`,f,S,j))return!1;if(f.endsWith(wv))return this._transitionablePaint.setTransition(f.slice(0,-wv.length),S||void 0),!1;{const ut=this._transitionablePaint._values[f],Ot=ut.property.specification["property-type"]==="cross-faded-data-driven",fi=ut.value.isDataDriven(),Ur=ut.value;this._transitionablePaint.setValue(f,S),this._handleSpecialPaintPropertyUpdate(f);const us=this._transitionablePaint._values[f].value;return us.isDataDriven()||fi||Ot||this._handleOverridablePaintPropertyUpdate(f,Ur,us)}}_handleSpecialPaintPropertyUpdate(f){}_handleOverridablePaintPropertyUpdate(f,S,j){return!1}isHidden(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"}updateTransitions(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(f,S){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,S)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,S)}serialize(){const f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),rl(f,(S,j)=>!(S===void 0||j==="layout"&&!Object.keys(S).length||j==="paint"&&!Object.keys(S).length))}_validate(f,S,j,ut,Ot={}){return(!Ot||Ot.validate!==!1)&&og(this,f.call(Bp,{key:S,layerType:this.type,objectKey:j,value:ut,styleSpec:td,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const f in this.paint._values){const S=this.paint.get(f);if(S instanceof e_&&j_(S.property.specification)&&(S.value.kind==="source"||S.value.kind==="composite")&&S.value.isStateDependent)return!0}return!1}}const Ev={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wy{constructor(f,S){this._structArray=f,this._pos1=S*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pg{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(f,S){return f._trim(),S&&(f.isTransferred=!0,S.push(f.arrayBuffer)),{length:f.length,arrayBuffer:f.arrayBuffer}}static deserialize(f){const S=Object.create(this.prototype);return S.arrayBuffer=f.arrayBuffer,S.length=f.length,S.capacity=f.arrayBuffer.byteLength/S.bytesPerElement,S._refreshViews(),S}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(f){this.reserve(f),this.length=f}reserve(f){if(f>this.capacity){this.capacity=Math.max(f,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const S=this.uint8;this._refreshViews(),S&&this.uint8.set(S)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mg(_,f=1){let S=0,j=0;return{members:_.map(ut=>{const Ot=Ev[ut.type].BYTES_PER_ELEMENT,fi=S=Fv(S,Math.max(f,Ot)),Ur=ut.components||1;return j=Math.max(j,Ot),S+=Ot*Ur,{name:ut.name,type:ut.type,components:Ur,offset:fi}}),size:Fv(S,Math.max(j,f)),alignment:f}}function Fv(_,f){return Math.ceil(_/f)*f}class v0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S){const j=this.length;return this.resize(j+1),this.emplace(j,f,S)}emplace(f,S,j){const ut=2*f;return this.int16[ut+0]=S,this.int16[ut+1]=j,f}}v0.prototype.bytesPerElement=4,tp("StructArrayLayout2i4",v0);class x0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,f,S,j)}emplace(f,S,j,ut){const Ot=3*f;return this.int16[Ot+0]=S,this.int16[Ot+1]=j,this.int16[Ot+2]=ut,f}}x0.prototype.bytesPerElement=6,tp("StructArrayLayout3i6",x0);class wy extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,f,S,j,ut)}emplace(f,S,j,ut,Ot){const fi=4*f;return this.int16[fi+0]=S,this.int16[fi+1]=j,this.int16[fi+2]=ut,this.int16[fi+3]=Ot,f}}wy.prototype.bytesPerElement=8,tp("StructArrayLayout4i8",wy);class Lg extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi){const Ur=this.length;return this.resize(Ur+1),this.emplace(Ur,f,S,j,ut,Ot,fi)}emplace(f,S,j,ut,Ot,fi,Ur){const us=6*f;return this.int16[us+0]=S,this.int16[us+1]=j,this.int16[us+2]=ut,this.int16[us+3]=Ot,this.int16[us+4]=fi,this.int16[us+5]=Ur,f}}Lg.prototype.bytesPerElement=12,tp("StructArrayLayout2i4i12",Lg);class b0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi){const Ur=this.length;return this.resize(Ur+1),this.emplace(Ur,f,S,j,ut,Ot,fi)}emplace(f,S,j,ut,Ot,fi,Ur){const us=4*f,ul=8*f;return this.int16[us+0]=S,this.int16[us+1]=j,this.uint8[ul+4]=ut,this.uint8[ul+5]=Ot,this.uint8[ul+6]=fi,this.uint8[ul+7]=Ur,f}}b0.prototype.bytesPerElement=8,tp("StructArrayLayout2i4ub8",b0);class Sv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S){const j=this.length;return this.resize(j+1),this.emplace(j,f,S)}emplace(f,S,j){const ut=2*f;return this.float32[ut+0]=S,this.float32[ut+1]=j,f}}Sv.prototype.bytesPerElement=8,tp("StructArrayLayout2f8",Sv);class $v extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi,Ur,us,ul,Ju){const oh=this.length;return this.resize(oh+1),this.emplace(oh,f,S,j,ut,Ot,fi,Ur,us,ul,Ju)}emplace(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh){const gh=10*f;return this.uint16[gh+0]=S,this.uint16[gh+1]=j,this.uint16[gh+2]=ut,this.uint16[gh+3]=Ot,this.uint16[gh+4]=fi,this.uint16[gh+5]=Ur,this.uint16[gh+6]=us,this.uint16[gh+7]=ul,this.uint16[gh+8]=Ju,this.uint16[gh+9]=oh,f}}$v.prototype.bytesPerElement=20,tp("StructArrayLayout10ui20",$v);class sv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh){const vh=this.length;return this.resize(vh+1),this.emplace(vh,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh)}emplace(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh){const bh=12*f;return this.int16[bh+0]=S,this.int16[bh+1]=j,this.int16[bh+2]=ut,this.int16[bh+3]=Ot,this.uint16[bh+4]=fi,this.uint16[bh+5]=Ur,this.uint16[bh+6]=us,this.uint16[bh+7]=ul,this.int16[bh+8]=Ju,this.int16[bh+9]=oh,this.int16[bh+10]=gh,this.int16[bh+11]=vh,f}}sv.prototype.bytesPerElement=24,tp("StructArrayLayout4i4ui4i24",sv);class av extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,f,S,j)}emplace(f,S,j,ut){const Ot=3*f;return this.float32[Ot+0]=S,this.float32[Ot+1]=j,this.float32[Ot+2]=ut,f}}av.prototype.bytesPerElement=12,tp("StructArrayLayout3f12",av);class F0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(f){const S=this.length;return this.resize(S+1),this.emplace(S,f)}emplace(f,S){return this.uint32[1*f+0]=S,f}}F0.prototype.bytesPerElement=4,tp("StructArrayLayout1ul4",F0);class Uv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi,Ur,us,ul){const Ju=this.length;return this.resize(Ju+1),this.emplace(Ju,f,S,j,ut,Ot,fi,Ur,us,ul)}emplace(f,S,j,ut,Ot,fi,Ur,us,ul,Ju){const oh=10*f,gh=5*f;return this.int16[oh+0]=S,this.int16[oh+1]=j,this.int16[oh+2]=ut,this.int16[oh+3]=Ot,this.int16[oh+4]=fi,this.int16[oh+5]=Ur,this.uint32[gh+3]=us,this.uint16[oh+8]=ul,this.uint16[oh+9]=Ju,f}}Uv.prototype.bytesPerElement=20,tp("StructArrayLayout6i1ul2ui20",Uv);class w0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi){const Ur=this.length;return this.resize(Ur+1),this.emplace(Ur,f,S,j,ut,Ot,fi)}emplace(f,S,j,ut,Ot,fi,Ur){const us=6*f;return this.int16[us+0]=S,this.int16[us+1]=j,this.int16[us+2]=ut,this.int16[us+3]=Ot,this.int16[us+4]=fi,this.int16[us+5]=Ur,f}}w0.prototype.bytesPerElement=12,tp("StructArrayLayout2i2i2i12",w0);class Tv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot){const fi=this.length;return this.resize(fi+1),this.emplace(fi,f,S,j,ut,Ot)}emplace(f,S,j,ut,Ot,fi){const Ur=4*f,us=8*f;return this.float32[Ur+0]=S,this.float32[Ur+1]=j,this.float32[Ur+2]=ut,this.int16[us+6]=Ot,this.int16[us+7]=fi,f}}Tv.prototype.bytesPerElement=16,tp("StructArrayLayout2f1f2i16",Tv);class Vv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,f,S,j,ut)}emplace(f,S,j,ut,Ot){const fi=12*f,Ur=3*f;return this.uint8[fi+0]=S,this.uint8[fi+1]=j,this.float32[Ur+1]=ut,this.float32[Ur+2]=Ot,f}}Vv.prototype.bytesPerElement=12,tp("StructArrayLayout2ub2f12",Vv);class $0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,f,S,j)}emplace(f,S,j,ut){const Ot=3*f;return this.uint16[Ot+0]=S,this.uint16[Ot+1]=j,this.uint16[Ot+2]=ut,f}}$0.prototype.bytesPerElement=6,tp("StructArrayLayout3ui6",$0);class Gv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd){const zd=this.length;return this.resize(zd+1),this.emplace(zd,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd)}emplace(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd,zd){const dd=24*f,Nd=12*f,$f=48*f;return this.int16[dd+0]=S,this.int16[dd+1]=j,this.uint16[dd+2]=ut,this.uint16[dd+3]=Ot,this.uint32[Nd+2]=fi,this.uint32[Nd+3]=Ur,this.uint32[Nd+4]=us,this.uint16[dd+10]=ul,this.uint16[dd+11]=Ju,this.uint16[dd+12]=oh,this.float32[Nd+7]=gh,this.float32[Nd+8]=vh,this.uint8[$f+36]=bh,this.uint8[$f+37]=Wh,this.uint8[$f+38]=Zh,this.uint32[Nd+10]=bd,this.int16[dd+22]=zd,f}}Gv.prototype.bytesPerElement=48,tp("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gv);class Ey extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd,zd,dd,Nd,$f,zf,Ap,zp,wp,yp,cp,Ep){const gp=this.length;return this.resize(gp+1),this.emplace(gp,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd,zd,dd,Nd,$f,zf,Ap,zp,wp,yp,cp,Ep)}emplace(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh,Zh,bd,zd,dd,Nd,$f,zf,Ap,zp,wp,yp,cp,Ep,gp){const Qf=34*f,Gp=17*f;return this.int16[Qf+0]=S,this.int16[Qf+1]=j,this.int16[Qf+2]=ut,this.int16[Qf+3]=Ot,this.int16[Qf+4]=fi,this.int16[Qf+5]=Ur,this.int16[Qf+6]=us,this.int16[Qf+7]=ul,this.uint16[Qf+8]=Ju,this.uint16[Qf+9]=oh,this.uint16[Qf+10]=gh,this.uint16[Qf+11]=vh,this.uint16[Qf+12]=bh,this.uint16[Qf+13]=Wh,this.uint16[Qf+14]=Zh,this.uint16[Qf+15]=bd,this.uint16[Qf+16]=zd,this.uint16[Qf+17]=dd,this.uint16[Qf+18]=Nd,this.uint16[Qf+19]=$f,this.uint16[Qf+20]=zf,this.uint16[Qf+21]=Ap,this.uint16[Qf+22]=zp,this.uint32[Gp+12]=wp,this.float32[Gp+13]=yp,this.float32[Gp+14]=cp,this.float32[Gp+15]=Ep,this.float32[Gp+16]=gp,f}}Ey.prototype.bytesPerElement=68,tp("StructArrayLayout8i15ui1ul4f68",Ey);class lv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f){const S=this.length;return this.resize(S+1),this.emplace(S,f)}emplace(f,S){return this.float32[1*f+0]=S,f}}lv.prototype.bytesPerElement=4,tp("StructArrayLayout1f4",lv);class E0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,f,S,j)}emplace(f,S,j,ut){const Ot=4*f;return this.uint32[2*f+0]=S,this.uint16[Ot+2]=j,this.uint16[Ot+3]=ut,f}}E0.prototype.bytesPerElement=8,tp("StructArrayLayout1ul2ui8",E0);class cv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,S){const j=this.length;return this.resize(j+1),this.emplace(j,f,S)}emplace(f,S,j){const ut=2*f;return this.uint16[ut+0]=S,this.uint16[ut+1]=j,f}}cv.prototype.bytesPerElement=4,tp("StructArrayLayout2ui4",cv);class S0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f){const S=this.length;return this.resize(S+1),this.emplace(S,f)}emplace(f,S){return this.uint16[1*f+0]=S,f}}S0.prototype.bytesPerElement=2,tp("StructArrayLayout1ui2",S0);class jv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,f,S,j,ut)}emplace(f,S,j,ut,Ot){const fi=4*f;return this.float32[fi+0]=S,this.float32[fi+1]=j,this.float32[fi+2]=ut,this.float32[fi+3]=Ot,f}}jv.prototype.bytesPerElement=16,tp("StructArrayLayout4f16",jv);class c1 extends Wy{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new cd(this.anchorPointX,this.anchorPointY)}}c1.prototype.size=20;class Iv extends Uv{get(f){return new c1(this,f)}}tp("CollisionBoxArray",Iv);class Mv extends Wy{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(f){this._structArray.uint8[this._pos1+37]=f}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(f){this._structArray.uint8[this._pos1+38]=f}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(f){this._structArray.uint32[this._pos4+10]=f}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Mv.prototype.size=48;class uv extends Gv{get(f){return new Mv(this,f)}}tp("PlacedSymbolArray",uv);class Fg extends Wy{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(f){this._structArray.uint32[this._pos4+12]=f}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Fg.prototype.size=68;class R1 extends Ey{get(f){return new Fg(this,f)}}tp("SymbolInstanceArray",R1);class T0 extends lv{getoffsetX(f){return this.float32[1*f+0]}}tp("GlyphOffsetArray",T0);class Cv extends x0{getx(f){return this.int16[3*f+0]}gety(f){return this.int16[3*f+1]}gettileUnitDistanceFromAnchor(f){return this.int16[3*f+2]}}tp("SymbolLineVertexArray",Cv);class U0 extends Wy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}U0.prototype.size=8;class Sy extends E0{get(f){return new U0(this,f)}}tp("FeatureIndexArray",Sy);class qv extends v0{}class Ty extends v0{}class Iy extends v0{}class Zv extends Lg{}class Ip extends b0{}class O1 extends Sv{}class K_ extends $v{}class Y extends sv{}class g extends av{}class A extends F0{}class q extends w0{}class ze extends Vv{}class Ft extends $0{}class Gn extends cv{}const ls=mg([{name:"a_pos",components:2,type:"Int16"}],4),{members:$s}=ls;class ol{constructor(f=[]){this.segments=f}prepareSegment(f,S,j,ut){let Ot=this.segments[this.segments.length-1];return f>ol.MAX_VERTEX_ARRAY_LENGTH&&Js(`Max vertices per segment is ${ol.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${f}`),(!Ot||Ot.vertexLength+f>ol.MAX_VERTEX_ARRAY_LENGTH||Ot.sortKey!==ut)&&(Ot={vertexOffset:S.length,primitiveOffset:j.length,vertexLength:0,primitiveLength:0},ut!==void 0&&(Ot.sortKey=ut),this.segments.push(Ot)),Ot}get(){return this.segments}destroy(){for(const f of this.segments)for(const S in f.vaos)f.vaos[S].destroy()}static simpleSegment(f,S,j,ut){return new ol([{vertexOffset:f,primitiveOffset:S,vertexLength:j,primitiveLength:ut,vaos:{},sortKey:0}])}}function nh(_,f){return 256*(_=nt(Math.floor(_),0,255))+nt(Math.floor(f),0,255)}ol.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tp("SegmentVector",ol);const ih=mg([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ph={},Lh={get exports(){return ph},set exports(_){ph=_}},Bh={};({get exports(){return Bh},set exports(_){Bh=_}}).exports=function(_,f){var S,j,ut,Ot,fi,Ur,us,ul;for(j=_.length-(S=3&_.length),ut=f,fi=3432918353,Ur=461845907,ul=0;ul<j;)us=255&_.charCodeAt(ul)|(255&_.charCodeAt(++ul))<<8|(255&_.charCodeAt(++ul))<<16|(255&_.charCodeAt(++ul))<<24,++ul,ut=27492+(65535&(Ot=5*(65535&(ut=(ut^=us=(65535&(us=(us=(65535&us)*fi+(((us>>>16)*fi&65535)<<16)&4294967295)<<15|us>>>17))*Ur+(((us>>>16)*Ur&65535)<<16)&4294967295)<<13|ut>>>19))+((5*(ut>>>16)&65535)<<16)&4294967295))+((58964+(Ot>>>16)&65535)<<16);switch(us=0,S){case 3:us^=(255&_.charCodeAt(ul+2))<<16;case 2:us^=(255&_.charCodeAt(ul+1))<<8;case 1:ut^=us=(65535&(us=(us=(65535&(us^=255&_.charCodeAt(ul)))*fi+(((us>>>16)*fi&65535)<<16)&4294967295)<<15|us>>>17))*Ur+(((us>>>16)*Ur&65535)<<16)&4294967295}return ut^=_.length,ut=2246822507*(65535&(ut^=ut>>>16))+((2246822507*(ut>>>16)&65535)<<16)&4294967295,ut=3266489909*(65535&(ut^=ut>>>13))+((3266489909*(ut>>>16)&65535)<<16)&4294967295,(ut^=ut>>>16)>>>0};var Ch={};({get exports(){return Ch},set exports(_){Ch=_}}).exports=function(_,f){for(var S,j=_.length,ut=f^j,Ot=0;j>=4;)S=1540483477*(65535&(S=255&_.charCodeAt(Ot)|(255&_.charCodeAt(++Ot))<<8|(255&_.charCodeAt(++Ot))<<16|(255&_.charCodeAt(++Ot))<<24))+((1540483477*(S>>>16)&65535)<<16),ut=1540483477*(65535&ut)+((1540483477*(ut>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),j-=4,++Ot;switch(j){case 3:ut^=(255&_.charCodeAt(Ot+2))<<16;case 2:ut^=(255&_.charCodeAt(Ot+1))<<8;case 1:ut=1540483477*(65535&(ut^=255&_.charCodeAt(Ot)))+((1540483477*(ut>>>16)&65535)<<16)}return ut=1540483477*(65535&(ut^=ut>>>13))+((1540483477*(ut>>>16)&65535)<<16),(ut^=ut>>>15)>>>0};var Kh=Bh,fd=Ch;Lh.exports=Kh,ph.murmur3=Kh,ph.murmur2=fd;class ud{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(f,S,j,ut){this.ids.push(jh(f)),this.positions.push(S,j,ut)}getPositions(f){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const S=jh(f);let j=0,ut=this.ids.length-1;for(;j<ut;){const fi=j+ut>>1;this.ids[fi]>=S?ut=fi:j=fi+1}const Ot=[];for(;this.ids[j]===S;)Ot.push({index:this.positions[3*j],start:this.positions[3*j+1],end:this.positions[3*j+2]}),j++;return Ot}static serialize(f,S){const j=new Float64Array(f.ids),ut=new Uint32Array(f.positions);return Sd(j,ut,0,j.length-1),S&&S.push(j.buffer,ut.buffer),{ids:j,positions:ut}}static deserialize(f){const S=new ud;return S.ids=f.ids,S.positions=f.positions,S.indexed=!0,S}}function jh(_){const f=+_;return!isNaN(f)&&f<=Number.MAX_SAFE_INTEGER?f:ph(String(_))}function Sd(_,f,S,j){for(;S<j;){const ut=_[S+j>>1];let Ot=S-1,fi=j+1;for(;;){do Ot++;while(_[Ot]<ut);do fi--;while(_[fi]>ut);if(Ot>=fi)break;Vd(_,Ot,fi),Vd(f,3*Ot,3*fi),Vd(f,3*Ot+1,3*fi+1),Vd(f,3*Ot+2,3*fi+2)}fi-S<j-fi?(Sd(_,f,S,fi),S=fi+1):(Sd(_,f,fi+1,j),j=fi)}}function Vd(_,f,S){const j=_[f];_[f]=_[S],_[S]=j}tp("FeaturePositionMap",ud);class Wd{constructor(f,S){this.gl=f.gl,this.location=S}}class Cf extends Wd{constructor(f,S){super(f,S),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Of extends Wd{constructor(f,S){super(f,S),this.current=[0,0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))}}class L extends Wd{constructor(f,S){super(f,S),this.current=hp.transparent}set(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))}}const u=new Float32Array(16);function E(_){return[nh(255*_.r,255*_.g),nh(255*_.b,255*_.a)]}class B{constructor(f,S,j){this.value=f,this.uniformNames=S.map(ut=>`u_${ut}`),this.type=j}setUniform(f,S,j){f.set(j.constantOr(this.value))}getBinding(f,S,j){return this.type==="color"?new L(f,S):new Cf(f,S)}}class ge{constructor(f,S){this.uniformNames=S.map(j=>`u_${j}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(f,S){this.pixelRatioFrom=S.pixelRatio,this.pixelRatioTo=f.pixelRatio,this.patternFrom=S.tlbr,this.patternTo=f.tlbr}setUniform(f,S,j,ut){const Ot=ut==="u_pattern_to"?this.patternTo:ut==="u_pattern_from"?this.patternFrom:ut==="u_pixel_ratio_to"?this.pixelRatioTo:ut==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Ot&&f.set(Ot)}getBinding(f,S,j){return j.substr(0,9)==="u_pattern"?new Of(f,S):new Cf(f,S)}}class St{constructor(f,S,j,ut){this.expression=f,this.type=j,this.maxValue=0,this.paintVertexAttributes=S.map(Ot=>({name:`a_${Ot}`,type:"Float32",components:j==="color"?2:1,offset:0})),this.paintVertexArray=new ut}populatePaintArray(f,S,j,ut,Ot){const fi=this.paintVertexArray.length,Ur=this.expression.evaluate(new Mm(0),S,{},ut,[],Ot);this.paintVertexArray.resize(f),this._setPaintValue(fi,f,Ur)}updatePaintArray(f,S,j,ut){const Ot=this.expression.evaluate({zoom:0},j,ut);this._setPaintValue(f,S,Ot)}_setPaintValue(f,S,j){if(this.type==="color"){const ut=E(j);for(let Ot=f;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,ut[0],ut[1])}else{for(let ut=f;ut<S;ut++)this.paintVertexArray.emplace(ut,j);this.maxValue=Math.max(this.maxValue,Math.abs(j))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _n{constructor(f,S,j,ut,Ot,fi){this.expression=f,this.uniformNames=S.map(Ur=>`u_${Ur}_t`),this.type=j,this.useIntegerZoom=ut,this.zoom=Ot,this.maxValue=0,this.paintVertexAttributes=S.map(Ur=>({name:`a_${Ur}`,type:"Float32",components:j==="color"?4:2,offset:0})),this.paintVertexArray=new fi}populatePaintArray(f,S,j,ut,Ot){const fi=this.expression.evaluate(new Mm(this.zoom),S,{},ut,[],Ot),Ur=this.expression.evaluate(new Mm(this.zoom+1),S,{},ut,[],Ot),us=this.paintVertexArray.length;this.paintVertexArray.resize(f),this._setPaintValue(us,f,fi,Ur)}updatePaintArray(f,S,j,ut){const Ot=this.expression.evaluate({zoom:this.zoom},j,ut),fi=this.expression.evaluate({zoom:this.zoom+1},j,ut);this._setPaintValue(f,S,Ot,fi)}_setPaintValue(f,S,j,ut){if(this.type==="color"){const Ot=E(j),fi=E(ut);for(let Ur=f;Ur<S;Ur++)this.paintVertexArray.emplace(Ur,Ot[0],Ot[1],fi[0],fi[1])}else{for(let Ot=f;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,j,ut);this.maxValue=Math.max(this.maxValue,Math.abs(j),Math.abs(ut))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(f,S){const j=this.useIntegerZoom?Math.floor(S.zoom):S.zoom,ut=nt(this.expression.interpolationFactor(j,this.zoom,this.zoom+1),0,1);f.set(ut)}getBinding(f,S,j){return new Cf(f,S)}}class Bn{constructor(f,S,j,ut,Ot,fi){this.expression=f,this.type=S,this.useIntegerZoom=j,this.zoom=ut,this.layerId=fi,this.zoomInPaintVertexArray=new Ot,this.zoomOutPaintVertexArray=new Ot}populatePaintArray(f,S,j){const ut=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(f),this.zoomOutPaintVertexArray.resize(f),this._setPaintValues(ut,f,S.patterns&&S.patterns[this.layerId],j)}updatePaintArray(f,S,j,ut,Ot){this._setPaintValues(f,S,j.patterns&&j.patterns[this.layerId],Ot)}_setPaintValues(f,S,j,ut){if(!ut||!j)return;const{min:Ot,mid:fi,max:Ur}=j,us=ut[Ot],ul=ut[fi],Ju=ut[Ur];if(us&&ul&&Ju)for(let oh=f;oh<S;oh++)this.zoomInPaintVertexArray.emplace(oh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],us.tl[0],us.tl[1],us.br[0],us.br[1],ul.pixelRatio,us.pixelRatio),this.zoomOutPaintVertexArray.emplace(oh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],Ju.tl[0],Ju.tl[1],Ju.br[0],Ju.br[1],ul.pixelRatio,Ju.pixelRatio)}upload(f){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=f.createVertexBuffer(this.zoomInPaintVertexArray,ih.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=f.createVertexBuffer(this.zoomOutPaintVertexArray,ih.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ss{constructor(f,S,j){this.binders={},this._buffers=[];const ut=[];for(const Ot in f.paint._values){if(!j(Ot))continue;const fi=f.paint.get(Ot);if(!(fi instanceof e_&&j_(fi.property.specification)))continue;const Ur=il(Ot,f.type),us=fi.value,ul=fi.property.specification.type,Ju=fi.property.useIntegerZoom,oh=fi.property.specification["property-type"],gh=oh==="cross-faded"||oh==="cross-faded-data-driven";if(us.kind==="constant")this.binders[Ot]=gh?new ge(us.value,Ur):new B(us.value,Ur,ul),ut.push(`/u_${Ot}`);else if(us.kind==="source"||gh){const vh=Qu(Ot,ul,"source");this.binders[Ot]=gh?new Bn(us,ul,Ju,S,vh,f.id):new St(us,Ur,ul,vh),ut.push(`/a_${Ot}`)}else{const vh=Qu(Ot,ul,"composite");this.binders[Ot]=new _n(us,Ur,ul,Ju,S,vh),ut.push(`/z_${Ot}`)}}this.cacheKey=ut.sort().join("")}getMaxValue(f){const S=this.binders[f];return S instanceof St||S instanceof _n?S.maxValue:0}populatePaintArrays(f,S,j,ut,Ot){for(const fi in this.binders){const Ur=this.binders[fi];(Ur instanceof St||Ur instanceof _n||Ur instanceof Bn)&&Ur.populatePaintArray(f,S,j,ut,Ot)}}setConstantPatternPositions(f,S){for(const j in this.binders){const ut=this.binders[j];ut instanceof ge&&ut.setConstantPatternPositions(f,S)}}updatePaintArrays(f,S,j,ut,Ot){let fi=!1;for(const Ur in f){const us=S.getPositions(Ur);for(const ul of us){const Ju=j.feature(ul.index);for(const oh in this.binders){const gh=this.binders[oh];if((gh instanceof St||gh instanceof _n||gh instanceof Bn)&&gh.expression.isStateDependent===!0){const vh=ut.paint.get(oh);gh.expression=vh.value,gh.updatePaintArray(ul.start,ul.end,Ju,f[Ur],Ot),fi=!0}}}}return fi}defines(){const f=[];for(const S in this.binders){const j=this.binders[S];(j instanceof B||j instanceof ge)&&f.push(...j.uniformNames.map(ut=>`#define HAS_UNIFORM_${ut}`))}return f}getBinderAttributes(){const f=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof St||j instanceof _n)for(let ut=0;ut<j.paintVertexAttributes.length;ut++)f.push(j.paintVertexAttributes[ut].name);else if(j instanceof Bn)for(let ut=0;ut<ih.members.length;ut++)f.push(ih.members[ut].name)}return f}getBinderUniforms(){const f=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof B||j instanceof ge||j instanceof _n)for(const ut of j.uniformNames)f.push(ut)}return f}getPaintVertexBuffers(){return this._buffers}getUniforms(f,S){const j=[];for(const ut in this.binders){const Ot=this.binders[ut];if(Ot instanceof B||Ot instanceof ge||Ot instanceof _n){for(const fi of Ot.uniformNames)if(S[fi]){const Ur=Ot.getBinding(f,S[fi],fi);j.push({name:fi,property:ut,binding:Ur})}}}return j}setUniforms(f,S,j,ut){for(const{name:Ot,property:fi,binding:Ur}of S)this.binders[fi].setUniform(Ur,ut,j.get(fi),Ot)}updatePaintBuffers(f){this._buffers=[];for(const S in this.binders){const j=this.binders[S];if(f&&j instanceof Bn){const ut=f.fromScale===2?j.zoomInPaintVertexBuffer:j.zoomOutPaintVertexBuffer;ut&&this._buffers.push(ut)}else(j instanceof St||j instanceof _n)&&j.paintVertexBuffer&&this._buffers.push(j.paintVertexBuffer)}}upload(f){for(const S in this.binders){const j=this.binders[S];(j instanceof St||j instanceof _n||j instanceof Bn)&&j.upload(f)}this.updatePaintBuffers()}destroy(){for(const f in this.binders){const S=this.binders[f];(S instanceof St||S instanceof _n||S instanceof Bn)&&S.destroy()}}}class tl{constructor(f,S,j=()=>!0){this.programConfigurations={};for(const ut of f)this.programConfigurations[ut.id]=new ss(ut,S,j);this.needsUpload=!1,this._featureMap=new ud,this._bufferOffset=0}populatePaintArrays(f,S,j,ut,Ot,fi){for(const Ur in this.programConfigurations)this.programConfigurations[Ur].populatePaintArrays(f,S,ut,Ot,fi);S.id!==void 0&&this._featureMap.add(S.id,j,this._bufferOffset,f),this._bufferOffset=f,this.needsUpload=!0}updatePaintArrays(f,S,j,ut){for(const Ot of j)this.needsUpload=this.programConfigurations[Ot.id].updatePaintArrays(f,this._featureMap,S,Ot,ut)||this.needsUpload}get(f){return this.programConfigurations[f]}upload(f){if(this.needsUpload){for(const S in this.programConfigurations)this.programConfigurations[S].upload(f);this.needsUpload=!1}}destroy(){for(const f in this.programConfigurations)this.programConfigurations[f].destroy()}}function il(_,f){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[_]||[_.replace(`${f}-`,"").replace(/-/g,"_")]}function Qu(_,f,S){const j={color:{source:Sv,composite:jv},number:{source:lv,composite:Sv}},ut=function(Ot){return{"line-pattern":{source:K_,composite:K_},"fill-pattern":{source:K_,composite:K_},"fill-extrusion-pattern":{source:K_,composite:K_}}[Ot]}(_);return ut&&ut[S]||j[f][S]}tp("ConstantBinder",B),tp("CrossFadedConstantBinder",ge),tp("SourceExpressionBinder",St),tp("CrossFadedCompositeBinder",Bn),tp("CompositeExpressionBinder",_n),tp("ProgramConfiguration",ss,{omit:["_buffers"]}),tp("ProgramConfigurationSet",tl);var fh=8192;const wh=Math.pow(2,14)-1,Th=-wh-1;function Sh(_){const f=fh/_.extent,S=_.loadGeometry();for(let j=0;j<S.length;j++){const ut=S[j];for(let Ot=0;Ot<ut.length;Ot++){const fi=ut[Ot],Ur=Math.round(fi.x*f),us=Math.round(fi.y*f);fi.x=nt(Ur,Th,wh),fi.y=nt(us,Th,wh),(Ur<fi.x||Ur>fi.x+1||us<fi.y||us>fi.y+1)&&Js("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return S}function Ih(_,f){return{type:_.type,id:_.id,properties:_.properties,geometry:f?Sh(_):[]}}function hh(_,f,S,j,ut){_.emplaceBack(2*f+(j+1)/2,2*S+(ut+1)/2)}class Oh{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(S=>S.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new Ty,this.indexArray=new Ft,this.segments=new ol,this.programConfigurations=new tl(f.layers,f.zoom),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(f,S,j){const ut=this.layers[0],Ot=[];let fi=null,Ur=!1;ut.type==="circle"&&(fi=ut.layout.get("circle-sort-key"),Ur=!fi.isConstant());for(const{feature:us,id:ul,index:Ju,sourceLayerIndex:oh}of f){const gh=this.layers[0]._featureFilter.needGeometry,vh=Ih(us,gh);if(!this.layers[0]._featureFilter.filter(new Mm(this.zoom),vh,j))continue;const bh=Ur?fi.evaluate(vh,{},j):void 0,Wh={id:ul,properties:us.properties,type:us.type,sourceLayerIndex:oh,index:Ju,geometry:gh?vh.geometry:Sh(us),patterns:{},sortKey:bh};Ot.push(Wh)}Ur&&Ot.sort((us,ul)=>us.sortKey-ul.sortKey);for(const us of Ot){const{geometry:ul,index:Ju,sourceLayerIndex:oh}=us,gh=f[Ju].feature;this.addFeature(us,ul,Ju,j),S.featureIndex.insert(gh,ul,Ju,oh,this.index)}}update(f,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,$s),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(f,S,j,ut){for(const Ot of S)for(const fi of Ot){const Ur=fi.x,us=fi.y;if(Ur<0||Ur>=fh||us<0||us>=fh)continue;const ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,f.sortKey),Ju=ul.vertexLength;hh(this.layoutVertexArray,Ur,us,-1,-1),hh(this.layoutVertexArray,Ur,us,1,-1),hh(this.layoutVertexArray,Ur,us,1,1),hh(this.layoutVertexArray,Ur,us,-1,1),this.indexArray.emplaceBack(Ju,Ju+1,Ju+2),this.indexArray.emplaceBack(Ju,Ju+3,Ju+2),ul.vertexLength+=4,ul.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,j,{},ut)}}function Rh(_,f){for(let S=0;S<_.length;S++)if(_d(f,_[S]))return!0;for(let S=0;S<f.length;S++)if(_d(_,f[S]))return!0;return!!Hh(_,f)}function Nh(_,f,S){return!!_d(_,f)||!!xd(f,_,S)}function qh(_,f){if(_.length===1)return Vf(f,_[0]);for(let S=0;S<f.length;S++){const j=f[S];for(let ut=0;ut<j.length;ut++)if(_d(_,j[ut]))return!0}for(let S=0;S<_.length;S++)if(Vf(f,_[S]))return!0;for(let S=0;S<f.length;S++)if(Hh(_,f[S]))return!0;return!1}function $h(_,f,S){if(_.length>1){if(Hh(_,f))return!0;for(let j=0;j<f.length;j++)if(xd(f[j],_,S))return!0}for(let j=0;j<_.length;j++)if(xd(_[j],f,S))return!0;return!1}function Hh(_,f){if(_.length===0||f.length===0)return!1;for(let S=0;S<_.length-1;S++){const j=_[S],ut=_[S+1];for(let Ot=0;Ot<f.length-1;Ot++)if(ld(j,ut,f[Ot],f[Ot+1]))return!0}return!1}function ld(_,f,S,j){return lh(_,S,j)!==lh(f,S,j)&&lh(_,f,S)!==lh(_,f,j)}function xd(_,f,S){const j=S*S;if(f.length===1)return _.distSqr(f[0])<j;for(let ut=1;ut<f.length;ut++)if(gd(_,f[ut-1],f[ut])<j)return!0;return!1}function gd(_,f,S){const j=f.distSqr(S);if(j===0)return _.distSqr(f);const ut=((_.x-f.x)*(S.x-f.x)+(_.y-f.y)*(S.y-f.y))/j;return _.distSqr(ut<0?f:ut>1?S:S.sub(f)._mult(ut)._add(f))}function Vf(_,f){let S,j,ut,Ot=!1;for(let fi=0;fi<_.length;fi++){S=_[fi];for(let Ur=0,us=S.length-1;Ur<S.length;us=Ur++)j=S[Ur],ut=S[us],j.y>f.y!=ut.y>f.y&&f.x<(ut.x-j.x)*(f.y-j.y)/(ut.y-j.y)+j.x&&(Ot=!Ot)}return Ot}function _d(_,f){let S=!1;for(let j=0,ut=_.length-1;j<_.length;ut=j++){const Ot=_[j],fi=_[ut];Ot.y>f.y!=fi.y>f.y&&f.x<(fi.x-Ot.x)*(f.y-Ot.y)/(fi.y-Ot.y)+Ot.x&&(S=!S)}return S}function Mf(_,f,S){const j=S[0],ut=S[2];if(_.x<j.x&&f.x<j.x||_.x>ut.x&&f.x>ut.x||_.y<j.y&&f.y<j.y||_.y>ut.y&&f.y>ut.y)return!1;const Ot=lh(_,f,S[0]);return Ot!==lh(_,f,S[1])||Ot!==lh(_,f,S[2])||Ot!==lh(_,f,S[3])}function Ud(_,f,S){const j=f.paint.get(_).value;return j.kind==="constant"?j.value:S.programConfigurations.get(f.id).getMaxValue(_)}function Lf(_){return Math.sqrt(_[0]*_[0]+_[1]*_[1])}function Md(_,f,S,j,ut){if(!f[0]&&!f[1])return _;const Ot=cd.convert(f)._mult(ut);S==="viewport"&&Ot._rotate(-j);const fi=[];for(let Ur=0;Ur<_.length;Ur++)fi.push(_[Ur].sub(Ot));return fi}tp("CircleBucket",Oh,{omit:["layers"]});const pd=new tg({"circle-sort-key":new Up(td.layout_circle["circle-sort-key"])});var Bd={paint:new tg({"circle-radius":new Up(td.paint_circle["circle-radius"]),"circle-color":new Up(td.paint_circle["circle-color"]),"circle-blur":new Up(td.paint_circle["circle-blur"]),"circle-opacity":new Up(td.paint_circle["circle-opacity"]),"circle-translate":new kp(td.paint_circle["circle-translate"]),"circle-translate-anchor":new kp(td.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kp(td.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kp(td.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Up(td.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Up(td.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Up(td.paint_circle["circle-stroke-opacity"])}),layout:pd},mf=1e-6,Bf=typeof Float32Array<"u"?Float32Array:Array;function Dp(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function rm(_,f,S){var j=f[0],ut=f[1],Ot=f[2],fi=f[3],Ur=f[4],us=f[5],ul=f[6],Ju=f[7],oh=f[8],gh=f[9],vh=f[10],bh=f[11],Wh=f[12],Zh=f[13],bd=f[14],zd=f[15],dd=S[0],Nd=S[1],$f=S[2],zf=S[3];return _[0]=dd*j+Nd*Ur+$f*oh+zf*Wh,_[1]=dd*ut+Nd*us+$f*gh+zf*Zh,_[2]=dd*Ot+Nd*ul+$f*vh+zf*bd,_[3]=dd*fi+Nd*Ju+$f*bh+zf*zd,_[4]=(dd=S[4])*j+(Nd=S[5])*Ur+($f=S[6])*oh+(zf=S[7])*Wh,_[5]=dd*ut+Nd*us+$f*gh+zf*Zh,_[6]=dd*Ot+Nd*ul+$f*vh+zf*bd,_[7]=dd*fi+Nd*Ju+$f*bh+zf*zd,_[8]=(dd=S[8])*j+(Nd=S[9])*Ur+($f=S[10])*oh+(zf=S[11])*Wh,_[9]=dd*ut+Nd*us+$f*gh+zf*Zh,_[10]=dd*Ot+Nd*ul+$f*vh+zf*bd,_[11]=dd*fi+Nd*Ju+$f*bh+zf*zd,_[12]=(dd=S[12])*j+(Nd=S[13])*Ur+($f=S[14])*oh+(zf=S[15])*Wh,_[13]=dd*ut+Nd*us+$f*gh+zf*Zh,_[14]=dd*Ot+Nd*ul+$f*vh+zf*bd,_[15]=dd*fi+Nd*Ju+$f*bh+zf*zd,_}Math.hypot||(Math.hypot=function(){for(var _=0,f=arguments.length;f--;)_+=arguments[f]*arguments[f];return Math.sqrt(_)});var Mp,xp=rm;function Lp(_,f,S){var j=f[0],ut=f[1],Ot=f[2],fi=f[3];return _[0]=S[0]*j+S[4]*ut+S[8]*Ot+S[12]*fi,_[1]=S[1]*j+S[5]*ut+S[9]*Ot+S[13]*fi,_[2]=S[2]*j+S[6]*ut+S[10]*Ot+S[14]*fi,_[3]=S[3]*j+S[7]*ut+S[11]*Ot+S[15]*fi,_}function dm(_,f){const S=Lp([],[_.x,_.y,0,1],f);return new cd(S[0]/S[3],S[1]/S[3])}Mp=new Bf(4),Bf!=Float32Array&&(Mp[0]=0,Mp[1]=0,Mp[2]=0,Mp[3]=0);class Fp extends Oh{}tp("HeatmapBucket",Fp,{omit:["layers"]});var km={paint:new tg({"heatmap-radius":new Up(td.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Up(td.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kp(td.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pp(td.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kp(td.paint_heatmap["heatmap-opacity"])})};function Am(_,{width:f,height:S},j,ut){if(ut){if(ut instanceof Uint8ClampedArray)ut=new Uint8Array(ut.buffer);else if(ut.length!==f*S*j)throw new RangeError(`mismatched image size. expected: ${ut.length} but got: ${f*S*j}`)}else ut=new Uint8Array(f*S*j);return _.width=f,_.height=S,_.data=ut,_}function jm(_,{width:f,height:S},j){if(f===_.width&&S===_.height)return;const ut=Am({},{width:f,height:S},j);Fm(_,ut,{x:0,y:0},{x:0,y:0},{width:Math.min(_.width,f),height:Math.min(_.height,S)},j),_.width=f,_.height=S,_.data=ut.data}function Fm(_,f,S,j,ut,Ot){if(ut.width===0||ut.height===0)return f;if(ut.width>_.width||ut.height>_.height||S.x>_.width-ut.width||S.y>_.height-ut.height)throw new RangeError("out of range source coordinates for image copy");if(ut.width>f.width||ut.height>f.height||j.x>f.width-ut.width||j.y>f.height-ut.height)throw new RangeError("out of range destination coordinates for image copy");const fi=_.data,Ur=f.data;if(fi===Ur)throw new Error("srcData equals dstData, so image is already copied");for(let us=0;us<ut.height;us++){const ul=((S.y+us)*_.width+S.x)*Ot,Ju=((j.y+us)*f.width+j.x)*Ot;for(let oh=0;oh<ut.width*Ot;oh++)Ur[Ju+oh]=fi[ul+oh]}return f}class gg{constructor(f,S){Am(this,f,1,S)}resize(f){jm(this,f,1)}clone(){return new gg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,S,j,ut,Ot){Fm(f,S,j,ut,Ot,1)}}class lg{constructor(f,S){Am(this,f,4,S)}resize(f){jm(this,f,4)}replace(f,S){S?this.data.set(f):this.data=f instanceof Uint8ClampedArray?new Uint8Array(f.buffer):f}clone(){return new lg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,S,j,ut,Ot){Fm(f,S,j,ut,Ot,4)}}function My(_){const f={},S=_.resolution||256,j=_.clips?_.clips.length:1,ut=_.image||new lg({width:S,height:j});if(Math.log(S)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${S}`);const Ot=(fi,Ur,us)=>{f[_.evaluationKey]=us;const ul=_.expression.evaluate(f);ut.data[fi+Ur+0]=Math.floor(255*ul.r/ul.a),ut.data[fi+Ur+1]=Math.floor(255*ul.g/ul.a),ut.data[fi+Ur+2]=Math.floor(255*ul.b/ul.a),ut.data[fi+Ur+3]=Math.floor(255*ul.a)};if(_.clips)for(let fi=0,Ur=0;fi<j;++fi,Ur+=4*S)for(let us=0,ul=0;us<S;us++,ul+=4){const Ju=us/(S-1),{start:oh,end:gh}=_.clips[fi];Ot(Ur,ul,oh*(1-Ju)+gh*Ju)}else for(let fi=0,Ur=0;fi<S;fi++,Ur+=4)Ot(0,Ur,fi/(S-1));return ut}tp("AlphaImage",gg),tp("RGBAImage",lg);var V0={paint:new tg({"hillshade-illumination-direction":new kp(td.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kp(td.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kp(td.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kp(td.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kp(td.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kp(td.paint_hillshade["hillshade-accent-color"])})};const ig=mg([{name:"a_pos",components:2,type:"Int16"}],4),{members:qm}=ig;var _m={};function cg(_,f,S){S=S||2;var j,ut,Ot,fi,Ur,us,ul,Ju=f&&f.length,oh=Ju?f[0]*S:_.length,gh=r_(_,0,oh,S,!0),vh=[];if(!gh||gh.next===gh.prev)return vh;if(Ju&&(gh=function(Wh,Zh,bd,zd){var dd,Nd,$f,zf=[];for(dd=0,Nd=Zh.length;dd<Nd;dd++)($f=r_(Wh,Zh[dd]*zd,dd<Nd-1?Zh[dd+1]*zd:Wh.length,zd,!1))===$f.next&&($f.steiner=!0),zf.push(Xv($f));for(zf.sort(Cy),dd=0;dd<zf.length;dd++)bd=G0(zf[dd],bd);return bd}(_,f,gh,S)),_.length>80*S){j=Ot=_[0],ut=fi=_[1];for(var bh=S;bh<oh;bh+=S)(Ur=_[bh])<j&&(j=Ur),(us=_[bh+1])<ut&&(ut=us),Ur>Ot&&(Ot=Ur),us>fi&&(fi=us);ul=(ul=Math.max(Ot-j,fi-ut))!==0?32767/ul:0}return jg(gh,vh,S,j,ut,ul,0),vh}function r_(_,f,S,j,ut){var Ot,fi;if(ut===mb(_,f,S,j)>0)for(Ot=f;Ot<S;Ot+=j)fi=fb(Ot,_[Ot],_[Ot+1],fi);else for(Ot=S-j;Ot>=f;Ot-=j)fi=fb(Ot,_[Ot],_[Ot+1],fi);return fi&&sx(fi,fi.next)&&(z1(fi),fi=fi.next),fi}function Dm(_,f){if(!_)return _;f||(f=_);var S,j=_;do if(S=!1,j.steiner||!sx(j,j.next)&&Rg(j.prev,j,j.next)!==0)j=j.next;else{if(z1(j),(j=f=j.prev)===j.next)break;S=!0}while(S||j!==f);return f}function jg(_,f,S,j,ut,Ot,fi){if(_){!fi&&Ot&&function(Ju,oh,gh,vh){var bh=Ju;do bh.z===0&&(bh.z=I0(bh.x,bh.y,oh,gh,vh)),bh.prevZ=bh.prev,bh.nextZ=bh.next,bh=bh.next;while(bh!==Ju);bh.prevZ.nextZ=null,bh.prevZ=null,function(Wh){var Zh,bd,zd,dd,Nd,$f,zf,Ap,zp=1;do{for(bd=Wh,Wh=null,Nd=null,$f=0;bd;){for($f++,zd=bd,zf=0,Zh=0;Zh<zp&&(zf++,zd=zd.nextZ);Zh++);for(Ap=zp;zf>0||Ap>0&&zd;)zf!==0&&(Ap===0||!zd||bd.z<=zd.z)?(dd=bd,bd=bd.nextZ,zf--):(dd=zd,zd=zd.nextZ,Ap--),Nd?Nd.nextZ=dd:Wh=dd,dd.prevZ=Nd,Nd=dd;bd=zd}Nd.nextZ=null,zp*=2}while($f>1)}(bh)}(_,j,ut,Ot);for(var Ur,us,ul=_;_.prev!==_.next;)if(Ur=_.prev,us=_.next,Ot?hv(_,j,ut,Ot):y_(_))f.push(Ur.i/S|0),f.push(_.i/S|0),f.push(us.i/S|0),z1(_),_=us.next,ul=us.next;else if((_=us)===ul){fi?fi===1?jg(_=Hv(Dm(_),f,S),f,S,j,ut,Ot,2):fi===2&&uy(_,f,S,j,ut,Ot):jg(Dm(_),f,S,j,ut,Ot,1);break}}}function y_(_){var f=_.prev,S=_,j=_.next;if(Rg(f,S,j)>=0)return!1;for(var ut=f.x,Ot=S.x,fi=j.x,Ur=f.y,us=S.y,ul=j.y,Ju=ut<Ot?ut<fi?ut:fi:Ot<fi?Ot:fi,oh=Ur<us?Ur<ul?Ur:ul:us<ul?us:ul,gh=ut>Ot?ut>fi?ut:fi:Ot>fi?Ot:fi,vh=Ur>us?Ur>ul?Ur:ul:us>ul?us:ul,bh=j.next;bh!==f;){if(bh.x>=Ju&&bh.x<=gh&&bh.y>=oh&&bh.y<=vh&&u1(ut,Ur,Ot,us,fi,ul,bh.x,bh.y)&&Rg(bh.prev,bh,bh.next)>=0)return!1;bh=bh.next}return!0}function hv(_,f,S,j){var ut=_.prev,Ot=_,fi=_.next;if(Rg(ut,Ot,fi)>=0)return!1;for(var Ur=ut.x,us=Ot.x,ul=fi.x,Ju=ut.y,oh=Ot.y,gh=fi.y,vh=Ur<us?Ur<ul?Ur:ul:us<ul?us:ul,bh=Ju<oh?Ju<gh?Ju:gh:oh<gh?oh:gh,Wh=Ur>us?Ur>ul?Ur:ul:us>ul?us:ul,Zh=Ju>oh?Ju>gh?Ju:gh:oh>gh?oh:gh,bd=I0(vh,bh,f,S,j),zd=I0(Wh,Zh,f,S,j),dd=_.prevZ,Nd=_.nextZ;dd&&dd.z>=bd&&Nd&&Nd.z<=zd;){if(dd.x>=vh&&dd.x<=Wh&&dd.y>=bh&&dd.y<=Zh&&dd!==ut&&dd!==fi&&u1(Ur,Ju,us,oh,ul,gh,dd.x,dd.y)&&Rg(dd.prev,dd,dd.next)>=0||(dd=dd.prevZ,Nd.x>=vh&&Nd.x<=Wh&&Nd.y>=bh&&Nd.y<=Zh&&Nd!==ut&&Nd!==fi&&u1(Ur,Ju,us,oh,ul,gh,Nd.x,Nd.y)&&Rg(Nd.prev,Nd,Nd.next)>=0))return!1;Nd=Nd.nextZ}for(;dd&&dd.z>=bd;){if(dd.x>=vh&&dd.x<=Wh&&dd.y>=bh&&dd.y<=Zh&&dd!==ut&&dd!==fi&&u1(Ur,Ju,us,oh,ul,gh,dd.x,dd.y)&&Rg(dd.prev,dd,dd.next)>=0)return!1;dd=dd.prevZ}for(;Nd&&Nd.z<=zd;){if(Nd.x>=vh&&Nd.x<=Wh&&Nd.y>=bh&&Nd.y<=Zh&&Nd!==ut&&Nd!==fi&&u1(Ur,Ju,us,oh,ul,gh,Nd.x,Nd.y)&&Rg(Nd.prev,Nd,Nd.next)>=0)return!1;Nd=Nd.nextZ}return!0}function Hv(_,f,S){var j=_;do{var ut=j.prev,Ot=j.next.next;!sx(ut,Ot)&&hb(ut,j,j.next,Ot)&&B1(ut,Ot)&&B1(Ot,ut)&&(f.push(ut.i/S|0),f.push(j.i/S|0),f.push(Ot.i/S|0),z1(j),z1(j.next),j=_=Ot),j=j.next}while(j!==_);return Dm(j)}function uy(_,f,S,j,ut,Ot){var fi=_;do{for(var Ur=fi.next.next;Ur!==fi.prev;){if(fi.i!==Ur.i&&ub(fi,Ur)){var us=db(fi,Ur);return fi=Dm(fi,fi.next),us=Dm(us,us.next),jg(fi,f,S,j,ut,Ot,0),void jg(us,f,S,j,ut,Ot,0)}Ur=Ur.next}fi=fi.next}while(fi!==_)}function Cy(_,f){return _.x-f.x}function G0(_,f){var S=function(ut,Ot){var fi,Ur=Ot,us=ut.x,ul=ut.y,Ju=-1/0;do{if(ul<=Ur.y&&ul>=Ur.next.y&&Ur.next.y!==Ur.y){var oh=Ur.x+(ul-Ur.y)*(Ur.next.x-Ur.x)/(Ur.next.y-Ur.y);if(oh<=us&&oh>Ju&&(Ju=oh,fi=Ur.x<Ur.next.x?Ur:Ur.next,oh===us))return fi}Ur=Ur.next}while(Ur!==Ot);if(!fi)return null;var gh,vh=fi,bh=fi.x,Wh=fi.y,Zh=1/0;Ur=fi;do us>=Ur.x&&Ur.x>=bh&&us!==Ur.x&&u1(ul<Wh?us:Ju,ul,bh,Wh,ul<Wh?Ju:us,ul,Ur.x,Ur.y)&&(gh=Math.abs(ul-Ur.y)/(us-Ur.x),B1(Ur,ut)&&(gh<Zh||gh===Zh&&(Ur.x>fi.x||Ur.x===fi.x&&dv(fi,Ur)))&&(fi=Ur,Zh=gh)),Ur=Ur.next;while(Ur!==vh);return fi}(_,f);if(!S)return f;var j=db(S,_);return Dm(j,j.next),Dm(S,S.next)}function dv(_,f){return Rg(_.prev,_,f.prev)<0&&Rg(f.next,_,_.next)<0}function I0(_,f,S,j,ut){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-S)*ut|0)|_<<8))|_<<4))|_<<2))|_<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-j)*ut|0)|f<<8))|f<<4))|f<<2))|f<<1))<<1}function Xv(_){var f=_,S=_;do(f.x<S.x||f.x===S.x&&f.y<S.y)&&(S=f),f=f.next;while(f!==_);return S}function u1(_,f,S,j,ut,Ot,fi,Ur){return(ut-fi)*(f-Ur)>=(_-fi)*(Ot-Ur)&&(_-fi)*(j-Ur)>=(S-fi)*(f-Ur)&&(S-fi)*(Ot-Ur)>=(ut-fi)*(j-Ur)}function ub(_,f){return _.next.i!==f.i&&_.prev.i!==f.i&&!function(S,j){var ut=S;do{if(ut.i!==S.i&&ut.next.i!==S.i&&ut.i!==j.i&&ut.next.i!==j.i&&hb(ut,ut.next,S,j))return!0;ut=ut.next}while(ut!==S);return!1}(_,f)&&(B1(_,f)&&B1(f,_)&&function(S,j){var ut=S,Ot=!1,fi=(S.x+j.x)/2,Ur=(S.y+j.y)/2;do ut.y>Ur!=ut.next.y>Ur&&ut.next.y!==ut.y&&fi<(ut.next.x-ut.x)*(Ur-ut.y)/(ut.next.y-ut.y)+ut.x&&(Ot=!Ot),ut=ut.next;while(ut!==S);return Ot}(_,f)&&(Rg(_.prev,_,f.prev)||Rg(_,f.prev,f))||sx(_,f)&&Rg(_.prev,_,_.next)>0&&Rg(f.prev,f,f.next)>0)}function Rg(_,f,S){return(f.y-_.y)*(S.x-f.x)-(f.x-_.x)*(S.y-f.y)}function sx(_,f){return _.x===f.x&&_.y===f.y}function hb(_,f,S,j){var ut=lx(Rg(_,f,S)),Ot=lx(Rg(_,f,j)),fi=lx(Rg(S,j,_)),Ur=lx(Rg(S,j,f));return ut!==Ot&&fi!==Ur||!(ut!==0||!ax(_,S,f))||!(Ot!==0||!ax(_,j,f))||!(fi!==0||!ax(S,_,j))||!(Ur!==0||!ax(S,f,j))}function ax(_,f,S){return f.x<=Math.max(_.x,S.x)&&f.x>=Math.min(_.x,S.x)&&f.y<=Math.max(_.y,S.y)&&f.y>=Math.min(_.y,S.y)}function lx(_){return _>0?1:_<0?-1:0}function B1(_,f){return Rg(_.prev,_,_.next)<0?Rg(_,f,_.next)>=0&&Rg(_,_.prev,f)>=0:Rg(_,f,_.prev)<0||Rg(_,_.next,f)<0}function db(_,f){var S=new pb(_.i,_.x,_.y),j=new pb(f.i,f.x,f.y),ut=_.next,Ot=f.prev;return _.next=f,f.prev=_,S.next=ut,ut.prev=S,j.next=S,S.prev=j,Ot.next=j,j.prev=Ot,j}function fb(_,f,S,j){var ut=new pb(_,f,S);return j?(ut.next=j.next,ut.prev=j,j.next.prev=ut,j.next=ut):(ut.prev=ut,ut.next=ut),ut}function z1(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function pb(_,f,S){this.i=_,this.x=f,this.y=S,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mb(_,f,S,j){for(var ut=0,Ot=f,fi=S-j;Ot<S;Ot+=j)ut+=(_[fi]-_[Ot])*(_[Ot+1]+_[fi+1]),fi=Ot;return ut}function h1(_,f,S,j,ut){ew(_,f,S||0,j||_.length-1,ut||gb)}function ew(_,f,S,j,ut){for(;j>S;){if(j-S>600){var Ot=j-S+1,fi=f-S+1,Ur=Math.log(Ot),us=.5*Math.exp(2*Ur/3),ul=.5*Math.sqrt(Ur*us*(Ot-us)/Ot)*(fi-Ot/2<0?-1:1);ew(_,f,Math.max(S,Math.floor(f-fi*us/Ot+ul)),Math.min(j,Math.floor(f+(Ot-fi)*us/Ot+ul)),ut)}var Ju=_[f],oh=S,gh=j;for(d1(_,S,f),ut(_[j],Ju)>0&&d1(_,S,j);oh<gh;){for(d1(_,oh,gh),oh++,gh--;ut(_[oh],Ju)<0;)oh++;for(;ut(_[gh],Ju)>0;)gh--}ut(_[S],Ju)===0?d1(_,S,gh):d1(_,++gh,j),gh<=f&&(S=gh+1),f<=gh&&(j=gh-1)}}function d1(_,f,S){var j=_[f];_[f]=_[S],_[S]=j}function gb(_,f){return _<f?-1:_>f?1:0}function Ox(_,f){const S=_.length;if(S<=1)return[_];const j=[];let ut,Ot;for(let fi=0;fi<S;fi++){const Ur=ch(_[fi]);Ur!==0&&(_[fi].area=Math.abs(Ur),Ot===void 0&&(Ot=Ur<0),Ot===Ur<0?(ut&&j.push(ut),ut=[_[fi]]):ut.push(_[fi]))}if(ut&&j.push(ut),f>1)for(let fi=0;fi<j.length;fi++)j[fi].length<=f||(h1(j[fi],f,1,j[fi].length-1,Yw),j[fi]=j[fi].slice(0,f));return j}function Yw(_,f){return f.area-_.area}function N1(_,f,S){const j=S.patternDependencies;let ut=!1;for(const Ot of f){const fi=Ot.paint.get(`${_}-pattern`);fi.isConstant()||(ut=!0);const Ur=fi.constantOr(null);Ur&&(ut=!0,j[Ur.to]=!0,j[Ur.from]=!0)}return ut}function Bx(_,f,S,j,ut){const Ot=ut.patternDependencies;for(const fi of f){const Ur=fi.paint.get(`${_}-pattern`).value;if(Ur.kind!=="constant"){let us=Ur.evaluate({zoom:j-1},S,{},ut.availableImages),ul=Ur.evaluate({zoom:j},S,{},ut.availableImages),Ju=Ur.evaluate({zoom:j+1},S,{},ut.availableImages);us=us&&us.name?us.name:us,ul=ul&&ul.name?ul.name:ul,Ju=Ju&&Ju.name?Ju.name:Ju,Ot[us]=!0,Ot[ul]=!0,Ot[Ju]=!0,S.patterns[fi.id]={min:us,mid:ul,max:Ju}}}return S}({get exports(){return _m},set exports(_){_m=_}}).exports=cg,_m.default=cg,cg.deviation=function(_,f,S,j){var ut=f&&f.length,Ot=Math.abs(mb(_,0,ut?f[0]*S:_.length,S));if(ut)for(var fi=0,Ur=f.length;fi<Ur;fi++)Ot-=Math.abs(mb(_,f[fi]*S,fi<Ur-1?f[fi+1]*S:_.length,S));var us=0;for(fi=0;fi<j.length;fi+=3){var ul=j[fi]*S,Ju=j[fi+1]*S,oh=j[fi+2]*S;us+=Math.abs((_[ul]-_[oh])*(_[Ju+1]-_[ul+1])-(_[ul]-_[Ju])*(_[oh+1]-_[ul+1]))}return Ot===0&&us===0?0:Math.abs((us-Ot)/Ot)},cg.flatten=function(_){for(var f=_[0][0].length,S={vertices:[],holes:[],dimensions:f},j=0,ut=0;ut<_.length;ut++){for(var Ot=0;Ot<_[ut].length;Ot++)for(var fi=0;fi<f;fi++)S.vertices.push(_[ut][Ot][fi]);ut>0&&S.holes.push(j+=_[ut-1].length)}return S};class cx{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(S=>S.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Iy,this.indexArray=new Ft,this.indexArray2=new Gn,this.programConfigurations=new tl(f.layers,f.zoom),this.segments=new ol,this.segments2=new ol,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(f,S,j){this.hasPattern=N1("fill",this.layers,S);const ut=this.layers[0].layout.get("fill-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:Ur,id:us,index:ul,sourceLayerIndex:Ju}of f){const oh=this.layers[0]._featureFilter.needGeometry,gh=Ih(Ur,oh);if(!this.layers[0]._featureFilter.filter(new Mm(this.zoom),gh,j))continue;const vh=Ot?ut.evaluate(gh,{},j,S.availableImages):void 0,bh={id:us,properties:Ur.properties,type:Ur.type,sourceLayerIndex:Ju,index:ul,geometry:oh?gh.geometry:Sh(Ur),patterns:{},sortKey:vh};fi.push(bh)}Ot&&fi.sort((Ur,us)=>Ur.sortKey-us.sortKey);for(const Ur of fi){const{geometry:us,index:ul,sourceLayerIndex:Ju}=Ur;if(this.hasPattern){const oh=Bx("fill",this.layers,Ur,this.zoom,S);this.patternFeatures.push(oh)}else this.addFeature(Ur,us,ul,j,{});S.featureIndex.insert(f[ul].feature,us,ul,Ju,this.index)}}update(f,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,S,this.stateDependentLayers,j)}addFeatures(f,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,qm),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.indexBuffer2=f.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(f,S,j,ut,Ot){for(const fi of Ox(S,500)){let Ur=0;for(const vh of fi)Ur+=vh.length;const us=this.segments.prepareSegment(Ur,this.layoutVertexArray,this.indexArray),ul=us.vertexLength,Ju=[],oh=[];for(const vh of fi){if(vh.length===0)continue;vh!==fi[0]&&oh.push(Ju.length/2);const bh=this.segments2.prepareSegment(vh.length,this.layoutVertexArray,this.indexArray2),Wh=bh.vertexLength;this.layoutVertexArray.emplaceBack(vh[0].x,vh[0].y),this.indexArray2.emplaceBack(Wh+vh.length-1,Wh),Ju.push(vh[0].x),Ju.push(vh[0].y);for(let Zh=1;Zh<vh.length;Zh++)this.layoutVertexArray.emplaceBack(vh[Zh].x,vh[Zh].y),this.indexArray2.emplaceBack(Wh+Zh-1,Wh+Zh),Ju.push(vh[Zh].x),Ju.push(vh[Zh].y);bh.vertexLength+=vh.length,bh.primitiveLength+=vh.length}const gh=_m(Ju,oh);for(let vh=0;vh<gh.length;vh+=3)this.indexArray.emplaceBack(ul+gh[vh],ul+gh[vh+1],ul+gh[vh+2]);us.vertexLength+=Ur,us.primitiveLength+=gh.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,j,Ot,ut)}}tp("FillBucket",cx,{omit:["layers","patternFeatures"]});const zx=new tg({"fill-sort-key":new Up(td.layout_fill["fill-sort-key"])});var Av={paint:new tg({"fill-antialias":new kp(td.paint_fill["fill-antialias"]),"fill-opacity":new Up(td.paint_fill["fill-opacity"]),"fill-color":new Up(td.paint_fill["fill-color"]),"fill-outline-color":new Up(td.paint_fill["fill-outline-color"]),"fill-translate":new kp(td.paint_fill["fill-translate"]),"fill-translate-anchor":new kp(td.paint_fill["fill-translate-anchor"]),"fill-pattern":new by(td.paint_fill["fill-pattern"])}),layout:zx};const Nx=mg([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tw=mg([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iw}=Nx;var Wv={},Kw=cd,nw=Yv;function Yv(_,f,S,j,ut){this.properties={},this.extent=S,this.type=0,this._pbf=_,this._geometry=-1,this._keys=j,this._values=ut,_.readFields(ux,this,f)}function ux(_,f,S){_==1?f.id=S.readVarint():_==2?function(j,ut){for(var Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=ut._keys[j.readVarint()],Ur=ut._values[j.readVarint()];ut.properties[fi]=Ur}}(S,f):_==3?f.type=S.readVarint():_==4&&(f._geometry=S.pos)}function F1(_){for(var f,S,j=0,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)j+=((S=_[fi]).x-(f=_[ut]).x)*(f.y+S.y);return j}Yv.types=["Unknown","Point","LineString","Polygon"],Yv.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var f,S=_.readVarint()+_.pos,j=1,ut=0,Ot=0,fi=0,Ur=[];_.pos<S;){if(ut<=0){var us=_.readVarint();j=7&us,ut=us>>3}if(ut--,j===1||j===2)Ot+=_.readSVarint(),fi+=_.readSVarint(),j===1&&(f&&Ur.push(f),f=[]),f.push(new Kw(Ot,fi));else{if(j!==7)throw new Error("unknown command "+j);f&&f.push(f[0].clone())}}return f&&Ur.push(f),Ur},Yv.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var f=_.readVarint()+_.pos,S=1,j=0,ut=0,Ot=0,fi=1/0,Ur=-1/0,us=1/0,ul=-1/0;_.pos<f;){if(j<=0){var Ju=_.readVarint();S=7&Ju,j=Ju>>3}if(j--,S===1||S===2)(ut+=_.readSVarint())<fi&&(fi=ut),ut>Ur&&(Ur=ut),(Ot+=_.readSVarint())<us&&(us=Ot),Ot>ul&&(ul=Ot);else if(S!==7)throw new Error("unknown command "+S)}return[fi,us,Ur,ul]},Yv.prototype.toGeoJSON=function(_,f,S){var j,ut,Ot=this.extent*Math.pow(2,S),fi=this.extent*_,Ur=this.extent*f,us=this.loadGeometry(),ul=Yv.types[this.type];function Ju(vh){for(var bh=0;bh<vh.length;bh++){var Wh=vh[bh];vh[bh]=[360*(Wh.x+fi)/Ot-180,360/Math.PI*Math.atan(Math.exp((180-360*(Wh.y+Ur)/Ot)*Math.PI/180))-90]}}switch(this.type){case 1:var oh=[];for(j=0;j<us.length;j++)oh[j]=us[j][0];Ju(us=oh);break;case 2:for(j=0;j<us.length;j++)Ju(us[j]);break;case 3:for(us=function(vh){var bh=vh.length;if(bh<=1)return[vh];for(var Wh,Zh,bd=[],zd=0;zd<bh;zd++){var dd=F1(vh[zd]);dd!==0&&(Zh===void 0&&(Zh=dd<0),Zh===dd<0?(Wh&&bd.push(Wh),Wh=[vh[zd]]):Wh.push(vh[zd]))}return Wh&&bd.push(Wh),bd}(us),j=0;j<us.length;j++)for(ut=0;ut<us[j].length;ut++)Ju(us[j][ut])}us.length===1?us=us[0]:ul="Multi"+ul;var gh={type:"Feature",geometry:{type:ul,coordinates:us},properties:this.properties};return"id"in this&&(gh.id=this.id),gh};var Pv=nw,M0=kv;function kv(_,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=_,this._keys=[],this._values=[],this._features=[],_.readFields(Kv,this,f),this.length=this._features.length}function Kv(_,f,S){_===15?f.version=S.readVarint():_===1?f.name=S.readString():_===5?f.extent=S.readVarint():_===2?f._features.push(S.pos):_===3?f._keys.push(S.readString()):_===4&&f._values.push(function(j){for(var ut=null,Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=j.readVarint()>>3;ut=fi===1?j.readString():fi===2?j.readFloat():fi===3?j.readDouble():fi===4?j.readVarint64():fi===5?j.readVarint():fi===6?j.readSVarint():fi===7?j.readBoolean():null}return ut}(S))}kv.prototype.feature=function(_){if(_<0||_>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[_];var f=this._pbf.readVarint()+this._pbf.pos;return new Pv(this._pbf,f,this.extent,this._keys,this._values)};var f1=M0;function Qw(_,f,S){if(_===3){var j=new f1(S,S.readVarint()+S.pos);j.length&&(f[j.name]=j)}}Wv.VectorTile=function(_,f){this.layers=_.readFields(Qw,{},f)},Wv.VectorTileFeature=nw,Wv.VectorTileLayer=M0;const Jw=Wv.VectorTileFeature.types,_b=Math.pow(2,13);function hx(_,f,S,j,ut,Ot,fi,Ur){_.emplaceBack(f,S,2*Math.floor(j*_b)+fi,ut*_b*2,Ot*_b*2,Math.round(Ur))}class Fx{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(S=>S.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new Zv,this.centroidVertexArray=new qv,this.indexArray=new Ft,this.programConfigurations=new tl(f.layers,f.zoom),this.segments=new ol,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(f,S,j){this.features=[],this.hasPattern=N1("fill-extrusion",this.layers,S);for(const{feature:ut,id:Ot,index:fi,sourceLayerIndex:Ur}of f){const us=this.layers[0]._featureFilter.needGeometry,ul=Ih(ut,us);if(!this.layers[0]._featureFilter.filter(new Mm(this.zoom),ul,j))continue;const Ju={id:Ot,sourceLayerIndex:Ur,index:fi,geometry:us?ul.geometry:Sh(ut),properties:ut.properties,type:ut.type,patterns:{}};this.hasPattern?this.features.push(Bx("fill-extrusion",this.layers,Ju,this.zoom,S)):this.addFeature(Ju,Ju.geometry,fi,j,{}),S.featureIndex.insert(ut,Ju.geometry,fi,Ur,this.index,!0)}}addFeatures(f,S,j){for(const ut of this.features){const{geometry:Ot}=ut;this.addFeature(ut,Ot,ut.index,S,j)}}update(f,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,iw),this.centroidVertexBuffer=f.createVertexBuffer(this.centroidVertexArray,tw.members,!0),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(f,S,j,ut,Ot){const fi={x:0,y:0,vertexCount:0};for(const Ur of Ox(S,500)){let us=0;for(const bh of Ur)us+=bh.length;let ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const bh of Ur){if(bh.length===0||j0(bh))continue;let Wh=0;for(let Zh=0;Zh<bh.length;Zh++){const bd=bh[Zh];if(Zh>=1){const zd=bh[Zh-1];if(!$x(bd,zd)){ul.vertexLength+4>ol.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const dd=bd.sub(zd)._perp()._unit(),Nd=zd.dist(bd);Wh+Nd>32768&&(Wh=0),hx(this.layoutVertexArray,bd.x,bd.y,dd.x,dd.y,0,0,Wh),hx(this.layoutVertexArray,bd.x,bd.y,dd.x,dd.y,0,1,Wh),fi.x+=2*bd.x,fi.y+=2*bd.y,fi.vertexCount+=2,Wh+=Nd,hx(this.layoutVertexArray,zd.x,zd.y,dd.x,dd.y,0,0,Wh),hx(this.layoutVertexArray,zd.x,zd.y,dd.x,dd.y,0,1,Wh),fi.x+=2*zd.x,fi.y+=2*zd.y,fi.vertexCount+=2;const $f=ul.vertexLength;this.indexArray.emplaceBack($f,$f+2,$f+1),this.indexArray.emplaceBack($f+1,$f+2,$f+3),ul.vertexLength+=4,ul.primitiveLength+=2}}}}if(ul.vertexLength+us>ol.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(us,this.layoutVertexArray,this.indexArray)),Jw[f.type]!=="Polygon")continue;const Ju=[],oh=[],gh=ul.vertexLength;for(const bh of Ur)if(bh.length!==0){bh!==Ur[0]&&oh.push(Ju.length/2);for(let Wh=0;Wh<bh.length;Wh++){const Zh=bh[Wh];hx(this.layoutVertexArray,Zh.x,Zh.y,0,0,1,1,0),fi.x+=Zh.x,fi.y+=Zh.y,fi.vertexCount+=1,Ju.push(Zh.x),Ju.push(Zh.y)}}const vh=_m(Ju,oh);for(let bh=0;bh<vh.length;bh+=3)this.indexArray.emplaceBack(gh+vh[bh],gh+vh[bh+2],gh+vh[bh+1]);ul.primitiveLength+=vh.length/3,ul.vertexLength+=us}for(let Ur=0;Ur<fi.vertexCount;Ur++)this.centroidVertexArray.emplaceBack(Math.floor(fi.x/fi.vertexCount),Math.floor(fi.y/fi.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,j,Ot,ut)}}function $x(_,f){return _.x===f.x&&(_.x<0||_.x>fh)||_.y===f.y&&(_.y<0||_.y>fh)}function j0(_){return _.every(f=>f.x<0)||_.every(f=>f.x>fh)||_.every(f=>f.y<0)||_.every(f=>f.y>fh)}tp("FillExtrusionBucket",Fx,{omit:["layers","features"]});var e2={paint:new tg({"fill-extrusion-opacity":new kp(td["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Up(td["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kp(td["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kp(td["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new by(td["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Up(td["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Up(td["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kp(td["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function dx(_,f){return _.x*f.x+_.y*f.y}function Og(_,f){if(_.length===1){let S=0;const j=f[S++];let ut;for(;!ut||j.equals(ut);)if(ut=f[S++],!ut)return 1/0;for(;S<f.length;S++){const Ot=f[S],fi=_[0],Ur=ut.sub(j),us=Ot.sub(j),ul=fi.sub(j),Ju=dx(Ur,Ur),oh=dx(Ur,us),gh=dx(us,us),vh=dx(ul,Ur),bh=dx(ul,us),Wh=Ju*gh-oh*oh,Zh=(gh*vh-oh*bh)/Wh,bd=(Ju*bh-oh*vh)/Wh,zd=j.z*(1-Zh-bd)+ut.z*Zh+Ot.z*bd;if(isFinite(zd))return zd}return 1/0}{let S=1/0;for(const j of f)S=Math.min(S,j.z);return S}}const Hp=mg([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qv}=Hp,Ux=mg([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ay}=Ux,rw=Wv.VectorTileFeature.types,ow=Math.cos(Math.PI/180*37.5),C0=Math.pow(2,14)/.5;class fx{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(S=>S.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(S=>{this.gradients[S.id]={}}),this.layoutVertexArray=new Ip,this.layoutVertexArray2=new O1,this.indexArray=new Ft,this.programConfigurations=new tl(f.layers,f.zoom),this.segments=new ol,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(f,S,j){this.hasPattern=N1("line",this.layers,S);const ut=this.layers[0].layout.get("line-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:Ur,id:us,index:ul,sourceLayerIndex:Ju}of f){const oh=this.layers[0]._featureFilter.needGeometry,gh=Ih(Ur,oh);if(!this.layers[0]._featureFilter.filter(new Mm(this.zoom),gh,j))continue;const vh=Ot?ut.evaluate(gh,{},j):void 0,bh={id:us,properties:Ur.properties,type:Ur.type,sourceLayerIndex:Ju,index:ul,geometry:oh?gh.geometry:Sh(Ur),patterns:{},sortKey:vh};fi.push(bh)}Ot&&fi.sort((Ur,us)=>Ur.sortKey-us.sortKey);for(const Ur of fi){const{geometry:us,index:ul,sourceLayerIndex:Ju}=Ur;if(this.hasPattern){const oh=Bx("line",this.layers,Ur,this.zoom,S);this.patternFeatures.push(oh)}else this.addFeature(Ur,us,ul,j,{});S.featureIndex.insert(f[ul].feature,us,ul,Ju,this.index)}}update(f,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,S,this.stateDependentLayers,j)}addFeatures(f,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=f.createVertexBuffer(this.layoutVertexArray2,Ay)),this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,Qv),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(f){if(f.properties&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_end"))return{start:+f.properties.mapbox_clip_start,end:+f.properties.mapbox_clip_end}}addFeature(f,S,j,ut,Ot){const fi=this.layers[0].layout,Ur=fi.get("line-join").evaluate(f,{}),us=fi.get("line-cap"),ul=fi.get("line-miter-limit"),Ju=fi.get("line-round-limit");this.lineClips=this.lineFeatureClips(f);for(const oh of S)this.addLine(oh,f,Ur,us,ul,Ju);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,j,Ot,ut)}addLine(f,S,j,ut,Ot,fi){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let bd=0;bd<f.length-1;bd++)this.totalDistance+=f[bd].dist(f[bd+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const Ur=rw[S.type]==="Polygon";let us=f.length;for(;us>=2&&f[us-1].equals(f[us-2]);)us--;let ul=0;for(;ul<us-1&&f[ul].equals(f[ul+1]);)ul++;if(us<(Ur?3:2))return;j==="bevel"&&(Ot=1.05);const Ju=this.overscaling<=16?122880/(512*this.overscaling):0,oh=this.segments.prepareSegment(10*us,this.layoutVertexArray,this.indexArray);let gh,vh,bh,Wh,Zh;this.e1=this.e2=-1,Ur&&(gh=f[us-2],Zh=f[ul].sub(gh)._unit()._perp());for(let bd=ul;bd<us;bd++){if(bh=bd===us-1?Ur?f[ul+1]:void 0:f[bd+1],bh&&f[bd].equals(bh))continue;Zh&&(Wh=Zh),gh&&(vh=gh),gh=f[bd],Zh=bh?bh.sub(gh)._unit()._perp():Wh,Wh=Wh||Zh;let zd=Wh.add(Zh);zd.x===0&&zd.y===0||zd._unit();const dd=Wh.x*Zh.x+Wh.y*Zh.y,Nd=zd.x*Zh.x+zd.y*Zh.y,$f=Nd!==0?1/Nd:1/0,zf=2*Math.sqrt(2-2*Nd),Ap=Nd<ow&&vh&&bh,zp=Wh.x*Zh.y-Wh.y*Zh.x>0;if(Ap&&bd>ul){const cp=gh.dist(vh);if(cp>2*Ju){const Ep=gh.sub(gh.sub(vh)._mult(Ju/cp)._round());this.updateDistance(vh,Ep),this.addCurrentVertex(Ep,Wh,0,0,oh),vh=Ep}}const wp=vh&&bh;let yp=wp?j:Ur?"butt":ut;if(wp&&yp==="round"&&($f<fi?yp="miter":$f<=2&&(yp="fakeround")),yp==="miter"&&$f>Ot&&(yp="bevel"),yp==="bevel"&&($f>2&&(yp="flipbevel"),$f<Ot&&(yp="miter")),vh&&this.updateDistance(vh,gh),yp==="miter")zd._mult($f),this.addCurrentVertex(gh,zd,0,0,oh);else if(yp==="flipbevel"){if($f>100)zd=Zh.mult(-1);else{const cp=$f*Wh.add(Zh).mag()/Wh.sub(Zh).mag();zd._perp()._mult(cp*(zp?-1:1))}this.addCurrentVertex(gh,zd,0,0,oh),this.addCurrentVertex(gh,zd.mult(-1),0,0,oh)}else if(yp==="bevel"||yp==="fakeround"){const cp=-Math.sqrt($f*$f-1),Ep=zp?cp:0,gp=zp?0:cp;if(vh&&this.addCurrentVertex(gh,Wh,Ep,gp,oh),yp==="fakeround"){const Qf=Math.round(180*zf/Math.PI/20);for(let Gp=1;Gp<Qf;Gp++){let $p=Gp/Qf;if($p!==.5){const ug=$p-.5;$p+=$p*ug*($p-1)*((1.0904+dd*(dd*(3.55645-1.43519*dd)-3.2452))*ug*ug+(.848013+dd*(.215638*dd-1.06021)))}const ym=Zh.sub(Wh)._mult($p)._add(Wh)._unit()._mult(zp?-1:1);this.addHalfVertex(gh,ym.x,ym.y,!1,zp,0,oh)}}bh&&this.addCurrentVertex(gh,Zh,-Ep,-gp,oh)}else if(yp==="butt")this.addCurrentVertex(gh,zd,0,0,oh);else if(yp==="square"){const cp=vh?1:-1;this.addCurrentVertex(gh,zd,cp,cp,oh)}else yp==="round"&&(vh&&(this.addCurrentVertex(gh,Wh,0,0,oh),this.addCurrentVertex(gh,Wh,1,1,oh,!0)),bh&&(this.addCurrentVertex(gh,Zh,-1,-1,oh,!0),this.addCurrentVertex(gh,Zh,0,0,oh)));if(Ap&&bd<us-1){const cp=gh.dist(bh);if(cp>2*Ju){const Ep=gh.add(bh.sub(gh)._mult(Ju/cp)._round());this.updateDistance(gh,Ep),this.addCurrentVertex(Ep,Zh,0,0,oh),gh=Ep}}}}addCurrentVertex(f,S,j,ut,Ot,fi=!1){const Ur=S.y*ut-S.x,us=-S.y-S.x*ut;this.addHalfVertex(f,S.x+S.y*j,S.y-S.x*j,fi,!1,j,Ot),this.addHalfVertex(f,Ur,us,fi,!0,-ut,Ot),this.distance>C0/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(f,S,j,ut,Ot,fi))}addHalfVertex({x:f,y:S},j,ut,Ot,fi,Ur,us){const ul=.5*(this.lineClips?this.scaledDistance*(C0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((f<<1)+(Ot?1:0),(S<<1)+(fi?1:0),Math.round(63*j)+128,Math.round(63*ut)+128,1+(Ur===0?0:Ur<0?-1:1)|(63&ul)<<2,ul>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ju=us.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ju),us.primitiveLength++),fi?this.e2=Ju:this.e1=Ju}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(f,S){this.distance+=f.dist(S),this.updateScaledDistance()}}tp("LineBucket",fx,{omit:["layers","patternFeatures"]});const p1=new tg({"line-cap":new kp(td.layout_line["line-cap"]),"line-join":new Up(td.layout_line["line-join"]),"line-miter-limit":new kp(td.layout_line["line-miter-limit"]),"line-round-limit":new kp(td.layout_line["line-round-limit"]),"line-sort-key":new Up(td.layout_line["line-sort-key"])});var $1={paint:new tg({"line-opacity":new Up(td.paint_line["line-opacity"]),"line-color":new Up(td.paint_line["line-color"]),"line-translate":new kp(td.paint_line["line-translate"]),"line-translate-anchor":new kp(td.paint_line["line-translate-anchor"]),"line-width":new Up(td.paint_line["line-width"]),"line-gap-width":new Up(td.paint_line["line-gap-width"]),"line-offset":new Up(td.paint_line["line-offset"]),"line-blur":new Up(td.paint_line["line-blur"]),"line-dasharray":new N0(td.paint_line["line-dasharray"]),"line-pattern":new by(td.paint_line["line-pattern"]),"line-gradient":new pp(td.paint_line["line-gradient"])}),layout:p1};const Jv=new class extends Up{possiblyEvaluate(_,f){return f=new Mm(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(_,f)}evaluate(_,f,S,j){return f=Bt({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(_,f,S,j)}}($1.paint.properties["line-width"].specification);function Vx(_,f){return f>0?f+2*_:_}Jv.useIntegerZoom=!0;const jx=mg([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sw=mg([{name:"a_projected_pos",components:3,type:"Float32"}],4);mg([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aw=mg([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mg([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lw=mg([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yb=mg([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function uw(_,f,S){return _.sections.forEach(j=>{j.text=function(ut,Ot,fi){const Ur=Ot.layout.get("text-transform").evaluate(fi,{});return Ur==="uppercase"?ut=ut.toLocaleUpperCase():Ur==="lowercase"&&(ut=ut.toLocaleLowerCase()),Ig.applyArabicShaping&&(ut=Ig.applyArabicShaping(ut)),ut}(j.text,f,S)}),_}mg([{name:"triangle",components:3,type:"Uint16"}]),mg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mg([{type:"Float32",name:"offsetX"}]),mg([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Dv={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Bg=24,q0=Om,qx=function(_,f,S,j,ut){var Ot,fi,Ur=8*ut-j-1,us=(1<<Ur)-1,ul=us>>1,Ju=-7,oh=S?ut-1:0,gh=S?-1:1,vh=_[f+oh];for(oh+=gh,Ot=vh&(1<<-Ju)-1,vh>>=-Ju,Ju+=Ur;Ju>0;Ot=256*Ot+_[f+oh],oh+=gh,Ju-=8);for(fi=Ot&(1<<-Ju)-1,Ot>>=-Ju,Ju+=j;Ju>0;fi=256*fi+_[f+oh],oh+=gh,Ju-=8);if(Ot===0)Ot=1-ul;else{if(Ot===us)return fi?NaN:1/0*(vh?-1:1);fi+=Math.pow(2,j),Ot-=ul}return(vh?-1:1)*fi*Math.pow(2,Ot-j)},vb=function(_,f,S,j,ut,Ot){var fi,Ur,us,ul=8*Ot-ut-1,Ju=(1<<ul)-1,oh=Ju>>1,gh=ut===23?Math.pow(2,-24)-Math.pow(2,-77):0,vh=j?0:Ot-1,bh=j?1:-1,Wh=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(Ur=isNaN(f)?1:0,fi=Ju):(fi=Math.floor(Math.log(f)/Math.LN2),f*(us=Math.pow(2,-fi))<1&&(fi--,us*=2),(f+=fi+oh>=1?gh/us:gh*Math.pow(2,1-oh))*us>=2&&(fi++,us/=2),fi+oh>=Ju?(Ur=0,fi=Ju):fi+oh>=1?(Ur=(f*us-1)*Math.pow(2,ut),fi+=oh):(Ur=f*Math.pow(2,oh-1)*Math.pow(2,ut),fi=0));ut>=8;_[S+vh]=255&Ur,vh+=bh,Ur/=256,ut-=8);for(fi=fi<<ut|Ur,ul+=ut;ul>0;_[S+vh]=255&fi,vh+=bh,fi/=256,ul-=8);_[S+vh-bh]|=128*Wh};function Om(_){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(_)?_:new Uint8Array(_||0),this.pos=0,this.type=0,this.length=this.buf.length}Om.Varint=0,Om.Fixed64=1,Om.Bytes=2,Om.Fixed32=5;var A0,hy=4294967296,U1=1/hy,R_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function t_(_){return _.type===Om.Bytes?_.readVarint()+_.pos:_.pos+1}function e1(_,f,S){return S?4294967296*f+(_>>>0):4294967296*(f>>>0)+(_>>>0)}function Mg(_,f,S){var j=f<=16383?1:f<=2097151?2:f<=268435455?3:Math.floor(Math.log(f)/(7*Math.LN2));S.realloc(j);for(var ut=S.pos-1;ut>=_;ut--)S.buf[ut+j]=S.buf[ut]}function hw(_,f){for(var S=0;S<_.length;S++)f.writeVarint(_[S])}function px(_,f){for(var S=0;S<_.length;S++)f.writeSVarint(_[S])}function Z0(_,f){for(var S=0;S<_.length;S++)f.writeFloat(_[S])}function t2(_,f){for(var S=0;S<_.length;S++)f.writeDouble(_[S])}function i2(_,f){for(var S=0;S<_.length;S++)f.writeBoolean(_[S])}function dw(_,f){for(var S=0;S<_.length;S++)f.writeFixed32(_[S])}function fw(_,f){for(var S=0;S<_.length;S++)f.writeSFixed32(_[S])}function m1(_,f){for(var S=0;S<_.length;S++)f.writeFixed64(_[S])}function pw(_,f){for(var S=0;S<_.length;S++)f.writeSFixed64(_[S])}function mx(_,f){return(_[f]|_[f+1]<<8|_[f+2]<<16)+16777216*_[f+3]}function g1(_,f,S){_[S]=f,_[S+1]=f>>>8,_[S+2]=f>>>16,_[S+3]=f>>>24}function xb(_,f){return(_[f]|_[f+1]<<8|_[f+2]<<16)+(_[f+3]<<24)}function n2(_,f,S){_===1&&S.readMessage(r2,f)}function r2(_,f,S){if(_===3){const{id:j,bitmap:ut,width:Ot,height:fi,left:Ur,top:us,advance:ul}=S.readMessage(mw,{});f.push({id:j,bitmap:new gg({width:Ot+6,height:fi+6},ut),metrics:{width:Ot,height:fi,left:Ur,top:us,advance:ul}})}}function mw(_,f,S){_===1?f.id=S.readVarint():_===2?f.bitmap=S.readBytes():_===3?f.width=S.readVarint():_===4?f.height=S.readVarint():_===5?f.left=S.readSVarint():_===6?f.top=S.readSVarint():_===7&&(f.advance=S.readVarint())}function bb(_){let f=0,S=0;for(const fi of _)f+=fi.w*fi.h,S=Math.max(S,fi.w);_.sort((fi,Ur)=>Ur.h-fi.h);const j=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(f/.95)),S),h:1/0}];let ut=0,Ot=0;for(const fi of _)for(let Ur=j.length-1;Ur>=0;Ur--){const us=j[Ur];if(!(fi.w>us.w||fi.h>us.h)){if(fi.x=us.x,fi.y=us.y,Ot=Math.max(Ot,fi.y+fi.h),ut=Math.max(ut,fi.x+fi.w),fi.w===us.w&&fi.h===us.h){const ul=j.pop();Ur<j.length&&(j[Ur]=ul)}else fi.h===us.h?(us.x+=fi.w,us.w-=fi.w):fi.w===us.w?(us.y+=fi.h,us.h-=fi.h):(j.push({x:us.x+fi.w,y:us.y,w:us.w-fi.w,h:fi.h}),us.y+=fi.h,us.h-=fi.h);break}}return{w:ut,h:Ot,fill:f/(ut*Ot)||0}}Om.prototype={destroy:function(){this.buf=null},readFields:function(_,f,S){for(S=S||this.length;this.pos<S;){var j=this.readVarint(),ut=j>>3,Ot=this.pos;this.type=7&j,_(ut,f,this),this.pos===Ot&&this.skip(j)}return f},readMessage:function(_,f){return this.readFields(_,f,this.readVarint()+this.pos)},readFixed32:function(){var _=mx(this.buf,this.pos);return this.pos+=4,_},readSFixed32:function(){var _=xb(this.buf,this.pos);return this.pos+=4,_},readFixed64:function(){var _=mx(this.buf,this.pos)+mx(this.buf,this.pos+4)*hy;return this.pos+=8,_},readSFixed64:function(){var _=mx(this.buf,this.pos)+xb(this.buf,this.pos+4)*hy;return this.pos+=8,_},readFloat:function(){var _=qx(this.buf,this.pos,!0,23,4);return this.pos+=4,_},readDouble:function(){var _=qx(this.buf,this.pos,!0,52,8);return this.pos+=8,_},readVarint:function(_){var f,S,j=this.buf;return f=127&(S=j[this.pos++]),S<128?f:(f|=(127&(S=j[this.pos++]))<<7,S<128?f:(f|=(127&(S=j[this.pos++]))<<14,S<128?f:(f|=(127&(S=j[this.pos++]))<<21,S<128?f:function(ut,Ot,fi){var Ur,us,ul=fi.buf;if(Ur=(112&(us=ul[fi.pos++]))>>4,us<128||(Ur|=(127&(us=ul[fi.pos++]))<<3,us<128)||(Ur|=(127&(us=ul[fi.pos++]))<<10,us<128)||(Ur|=(127&(us=ul[fi.pos++]))<<17,us<128)||(Ur|=(127&(us=ul[fi.pos++]))<<24,us<128)||(Ur|=(1&(us=ul[fi.pos++]))<<31,us<128))return e1(ut,Ur,Ot);throw new Error("Expected varint not more than 10 bytes")}(f|=(15&(S=j[this.pos]))<<28,_,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var _=this.readVarint();return _%2==1?(_+1)/-2:_/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var _=this.readVarint()+this.pos,f=this.pos;return this.pos=_,_-f>=12&&R_?function(S,j,ut){return R_.decode(S.subarray(j,ut))}(this.buf,f,_):function(S,j,ut){for(var Ot="",fi=j;fi<ut;){var Ur,us,ul,Ju=S[fi],oh=null,gh=Ju>239?4:Ju>223?3:Ju>191?2:1;if(fi+gh>ut)break;gh===1?Ju<128&&(oh=Ju):gh===2?(192&(Ur=S[fi+1]))==128&&(oh=(31&Ju)<<6|63&Ur)<=127&&(oh=null):gh===3?(us=S[fi+2],(192&(Ur=S[fi+1]))==128&&(192&us)==128&&((oh=(15&Ju)<<12|(63&Ur)<<6|63&us)<=2047||oh>=55296&&oh<=57343)&&(oh=null)):gh===4&&(us=S[fi+2],ul=S[fi+3],(192&(Ur=S[fi+1]))==128&&(192&us)==128&&(192&ul)==128&&((oh=(15&Ju)<<18|(63&Ur)<<12|(63&us)<<6|63&ul)<=65535||oh>=1114112)&&(oh=null)),oh===null?(oh=65533,gh=1):oh>65535&&(oh-=65536,Ot+=String.fromCharCode(oh>>>10&1023|55296),oh=56320|1023&oh),Ot+=String.fromCharCode(oh),fi+=gh}return Ot}(this.buf,f,_)},readBytes:function(){var _=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,_);return this.pos=_,f},readPackedVarint:function(_,f){if(this.type!==Om.Bytes)return _.push(this.readVarint(f));var S=t_(this);for(_=_||[];this.pos<S;)_.push(this.readVarint(f));return _},readPackedSVarint:function(_){if(this.type!==Om.Bytes)return _.push(this.readSVarint());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readSVarint());return _},readPackedBoolean:function(_){if(this.type!==Om.Bytes)return _.push(this.readBoolean());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readBoolean());return _},readPackedFloat:function(_){if(this.type!==Om.Bytes)return _.push(this.readFloat());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readFloat());return _},readPackedDouble:function(_){if(this.type!==Om.Bytes)return _.push(this.readDouble());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readDouble());return _},readPackedFixed32:function(_){if(this.type!==Om.Bytes)return _.push(this.readFixed32());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readFixed32());return _},readPackedSFixed32:function(_){if(this.type!==Om.Bytes)return _.push(this.readSFixed32());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readSFixed32());return _},readPackedFixed64:function(_){if(this.type!==Om.Bytes)return _.push(this.readFixed64());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readFixed64());return _},readPackedSFixed64:function(_){if(this.type!==Om.Bytes)return _.push(this.readSFixed64());var f=t_(this);for(_=_||[];this.pos<f;)_.push(this.readSFixed64());return _},skip:function(_){var f=7&_;if(f===Om.Varint)for(;this.buf[this.pos++]>127;);else if(f===Om.Bytes)this.pos=this.readVarint()+this.pos;else if(f===Om.Fixed32)this.pos+=4;else{if(f!==Om.Fixed64)throw new Error("Unimplemented type: "+f);this.pos+=8}},writeTag:function(_,f){this.writeVarint(_<<3|f)},realloc:function(_){for(var f=this.length||16;f<this.pos+_;)f*=2;if(f!==this.length){var S=new Uint8Array(f);S.set(this.buf),this.buf=S,this.length=f}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(_){this.realloc(4),g1(this.buf,_,this.pos),this.pos+=4},writeSFixed32:function(_){this.realloc(4),g1(this.buf,_,this.pos),this.pos+=4},writeFixed64:function(_){this.realloc(8),g1(this.buf,-1&_,this.pos),g1(this.buf,Math.floor(_*U1),this.pos+4),this.pos+=8},writeSFixed64:function(_){this.realloc(8),g1(this.buf,-1&_,this.pos),g1(this.buf,Math.floor(_*U1),this.pos+4),this.pos+=8},writeVarint:function(_){(_=+_||0)>268435455||_<0?function(f,S){var j,ut;if(f>=0?(j=f%4294967296|0,ut=f/4294967296|0):(ut=~(-f/4294967296),4294967295^(j=~(-f%4294967296))?j=j+1|0:(j=0,ut=ut+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");S.realloc(10),function(Ot,fi,Ur){Ur.buf[Ur.pos++]=127&Ot|128,Ot>>>=7,Ur.buf[Ur.pos++]=127&Ot|128,Ot>>>=7,Ur.buf[Ur.pos++]=127&Ot|128,Ot>>>=7,Ur.buf[Ur.pos++]=127&Ot|128,Ur.buf[Ur.pos]=127&(Ot>>>=7)}(j,0,S),function(Ot,fi){var Ur=(7&Ot)<<4;fi.buf[fi.pos++]|=Ur|((Ot>>>=3)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot)))))}(ut,S)}(_,this):(this.realloc(4),this.buf[this.pos++]=127&_|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=_>>>7&127))))},writeSVarint:function(_){this.writeVarint(_<0?2*-_-1:2*_)},writeBoolean:function(_){this.writeVarint(!!_)},writeString:function(_){_=String(_),this.realloc(4*_.length),this.pos++;var f=this.pos;this.pos=function(j,ut,Ot){for(var fi,Ur,us=0;us<ut.length;us++){if((fi=ut.charCodeAt(us))>55295&&fi<57344){if(!Ur){fi>56319||us+1===ut.length?(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189):Ur=fi;continue}if(fi<56320){j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,Ur=fi;continue}fi=Ur-55296<<10|fi-56320|65536,Ur=null}else Ur&&(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,Ur=null);fi<128?j[Ot++]=fi:(fi<2048?j[Ot++]=fi>>6|192:(fi<65536?j[Ot++]=fi>>12|224:(j[Ot++]=fi>>18|240,j[Ot++]=fi>>12&63|128),j[Ot++]=fi>>6&63|128),j[Ot++]=63&fi|128)}return Ot}(this.buf,_,this.pos);var S=this.pos-f;S>=128&&Mg(f,S,this),this.pos=f-1,this.writeVarint(S),this.pos+=S},writeFloat:function(_){this.realloc(4),vb(this.buf,_,this.pos,!0,23,4),this.pos+=4},writeDouble:function(_){this.realloc(8),vb(this.buf,_,this.pos,!0,52,8),this.pos+=8},writeBytes:function(_){var f=_.length;this.writeVarint(f),this.realloc(f);for(var S=0;S<f;S++)this.buf[this.pos++]=_[S]},writeRawMessage:function(_,f){this.pos++;var S=this.pos;_(f,this);var j=this.pos-S;j>=128&&Mg(S,j,this),this.pos=S-1,this.writeVarint(j),this.pos+=j},writeMessage:function(_,f,S){this.writeTag(_,Om.Bytes),this.writeRawMessage(f,S)},writePackedVarint:function(_,f){f.length&&this.writeMessage(_,hw,f)},writePackedSVarint:function(_,f){f.length&&this.writeMessage(_,px,f)},writePackedBoolean:function(_,f){f.length&&this.writeMessage(_,i2,f)},writePackedFloat:function(_,f){f.length&&this.writeMessage(_,Z0,f)},writePackedDouble:function(_,f){f.length&&this.writeMessage(_,t2,f)},writePackedFixed32:function(_,f){f.length&&this.writeMessage(_,dw,f)},writePackedSFixed32:function(_,f){f.length&&this.writeMessage(_,fw,f)},writePackedFixed64:function(_,f){f.length&&this.writeMessage(_,m1,f)},writePackedSFixed64:function(_,f){f.length&&this.writeMessage(_,pw,f)},writeBytesField:function(_,f){this.writeTag(_,Om.Bytes),this.writeBytes(f)},writeFixed32Field:function(_,f){this.writeTag(_,Om.Fixed32),this.writeFixed32(f)},writeSFixed32Field:function(_,f){this.writeTag(_,Om.Fixed32),this.writeSFixed32(f)},writeFixed64Field:function(_,f){this.writeTag(_,Om.Fixed64),this.writeFixed64(f)},writeSFixed64Field:function(_,f){this.writeTag(_,Om.Fixed64),this.writeSFixed64(f)},writeVarintField:function(_,f){this.writeTag(_,Om.Varint),this.writeVarint(f)},writeSVarintField:function(_,f){this.writeTag(_,Om.Varint),this.writeSVarint(f)},writeStringField:function(_,f){this.writeTag(_,Om.Bytes),this.writeString(f)},writeFloatField:function(_,f){this.writeTag(_,Om.Fixed32),this.writeFloat(f)},writeDoubleField:function(_,f){this.writeTag(_,Om.Fixed64),this.writeDouble(f)},writeBooleanField:function(_,f){this.writeVarintField(_,!!f)}};class _1{constructor(f,{pixelRatio:S,version:j,stretchX:ut,stretchY:Ot,content:fi}){this.paddedRect=f,this.pixelRatio=S,this.stretchX=ut,this.stretchY=Ot,this.content=fi,this.version=j}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zx{constructor(f,S){const j={},ut={};this.haveRenderCallbacks=[];const Ot=[];this.addImages(f,j,Ot),this.addImages(S,ut,Ot);const{w:fi,h:Ur}=bb(Ot),us=new lg({width:fi||1,height:Ur||1});for(const ul in f){const Ju=f[ul],oh=j[ul].paddedRect;lg.copy(Ju.data,us,{x:0,y:0},{x:oh.x+1,y:oh.y+1},Ju.data)}for(const ul in S){const Ju=S[ul],oh=ut[ul].paddedRect,gh=oh.x+1,vh=oh.y+1,bh=Ju.data.width,Wh=Ju.data.height;lg.copy(Ju.data,us,{x:0,y:0},{x:gh,y:vh},Ju.data),lg.copy(Ju.data,us,{x:0,y:Wh-1},{x:gh,y:vh-1},{width:bh,height:1}),lg.copy(Ju.data,us,{x:0,y:0},{x:gh,y:vh+Wh},{width:bh,height:1}),lg.copy(Ju.data,us,{x:bh-1,y:0},{x:gh-1,y:vh},{width:1,height:Wh}),lg.copy(Ju.data,us,{x:0,y:0},{x:gh+bh,y:vh},{width:1,height:Wh})}this.image=us,this.iconPositions=j,this.patternPositions=ut}addImages(f,S,j){for(const ut in f){const Ot=f[ut],fi={x:0,y:0,w:Ot.data.width+2,h:Ot.data.height+2};j.push(fi),S[ut]=new _1(fi,Ot),Ot.hasRenderCallback&&this.haveRenderCallbacks.push(ut)}}patchUpdatedImages(f,S){f.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const j in f.updatedImages)this.patchUpdatedImage(this.iconPositions[j],f.getImage(j),S),this.patchUpdatedImage(this.patternPositions[j],f.getImage(j),S)}patchUpdatedImage(f,S,j){if(!f||!S||f.version===S.version)return;f.version=S.version;const[ut,Ot]=f.tl;j.update(S.data,void 0,{x:ut,y:Ot})}}tp("ImagePosition",_1),tp("ImageAtlas",Zx),o.WritingMode=void 0,(A0=o.WritingMode||(o.WritingMode={}))[A0.none=0]="none",A0[A0.horizontal=1]="horizontal",A0[A0.vertical=2]="vertical",A0[A0.horizontalOnly=3]="horizontalOnly";const V1=-17;class y1{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(f,S){const j=new y1;return j.scale=f||1,j.fontStack=S,j}static forImage(f){const S=new y1;return S.imageName=f,S}}class Yg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(f,S){const j=new Yg;for(let ut=0;ut<f.sections.length;ut++){const Ot=f.sections[ut];Ot.image?j.addImageSection(Ot):j.addTextSection(Ot,S)}return j}length(){return this.text.length}getSection(f){return this.sections[this.sectionIndex[f]]}getSectionIndex(f){return this.sectionIndex[f]}getCharCode(f){return this.text.charCodeAt(f)}verticalizePunctuation(){this.text=function(f){let S="";for(let j=0;j<f.length;j++){const ut=f.charCodeAt(j+1)||null,Ot=f.charCodeAt(j-1)||null;S+=ut&&ov(ut)&&!Dv[f[j+1]]||Ot&&ov(Ot)&&!Dv[f[j-1]]||!Dv[f[j]]?f[j]:Dv[f[j]]}return S}(this.text)}trim(){let f=0;for(let j=0;j<this.text.length&&fv[this.text.charCodeAt(j)];j++)f++;let S=this.text.length;for(let j=this.text.length-1;j>=0&&j>=f&&fv[this.text.charCodeAt(j)];j--)S--;this.text=this.text.substring(f,S),this.sectionIndex=this.sectionIndex.slice(f,S)}substring(f,S){const j=new Yg;return j.text=this.text.substring(f,S),j.sectionIndex=this.sectionIndex.slice(f,S),j.sections=this.sections,j}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((f,S)=>Math.max(f,this.sections[S].scale),0)}addTextSection(f,S){this.text+=f.text,this.sections.push(y1.forText(f.scale,f.fontStack||S));const j=this.sections.length-1;for(let ut=0;ut<f.text.length;++ut)this.sectionIndex.push(j)}addImageSection(f){const S=f.image?f.image.name:"";if(S.length===0)return void Js("Can't add FormattedSection with an empty image.");const j=this.getNextImageSectionCharCode();j?(this.text+=String.fromCharCode(j),this.sections.push(y1.forImage(S)),this.sectionIndex.push(this.sections.length-1)):Js("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yy(_,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh){const Zh=Yg.fromFeature(_,ut);let bd;oh===o.WritingMode.vertical&&Zh.verticalizePunctuation();const{processBidirectionalText:zd,processStyledBidirectionalText:dd}=Ig;if(zd&&Zh.sections.length===1){bd=[];const zf=zd(Zh.toString(),Eb(Zh,ul,Ot,f,j,vh,bh));for(const Ap of zf){const zp=new Yg;zp.text=Ap,zp.sections=Zh.sections;for(let wp=0;wp<Ap.length;wp++)zp.sectionIndex.push(0);bd.push(zp)}}else if(dd){bd=[];const zf=dd(Zh.text,Zh.sectionIndex,Eb(Zh,ul,Ot,f,j,vh,bh));for(const Ap of zf){const zp=new Yg;zp.text=Ap[0],zp.sectionIndex=Ap[1],zp.sections=Zh.sections,bd.push(zp)}}else bd=function(zf,Ap){const zp=[],wp=zf.text;let yp=0;for(const cp of Ap)zp.push(zf.substring(yp,cp)),yp=cp;return yp<wp.length&&zp.push(zf.substring(yp,wp.length)),zp}(Zh,Eb(Zh,ul,Ot,f,j,vh,bh));const Nd=[],$f={positionedLines:Nd,text:Zh.toString(),top:Ju[1],bottom:Ju[1],left:Ju[0],right:Ju[0],writingMode:oh,iconsInText:!1,verticalizable:!1};return function(zf,Ap,zp,wp,yp,cp,Ep,gp,Qf,Gp,$p,ym){let ug=0,_g=V1,zg=0,i0=0;const s_=gp==="right"?1:gp==="left"?0:.5;let yg=0;for(const $g of yp){$g.trim();const x_=$g.getMaxScale(),B_=(x_-1)*Bg,ey={positionedGlyphs:[],lineOffset:0};zf.positionedLines[yg]=ey;const z_=ey.positionedGlyphs;let b_=0;if(!$g.length()){_g+=cp,++yg;continue}for(let w_=0;w_<$g.length();w_++){const vm=$g.getSection(w_),E_=$g.getSectionIndex(w_),qg=$g.getCharCode(w_);let S_=0,ty=null,k0=null,Y0=null,gv=Bg;const n0=!(Qf===o.WritingMode.horizontal||!$p&&!g0(qg)||$p&&(fv[qg]||(i_=qg,ap.Arabic(i_)||ap["Arabic Supplement"](i_)||ap["Arabic Extended-A"](i_)||ap["Arabic Presentation Forms-A"](i_)||ap["Arabic Presentation Forms-B"](i_))));if(vm.imageName){const Py=wp[vm.imageName];if(!Py)continue;Y0=vm.imageName,zf.iconsInText=zf.iconsInText||!0,k0=Py.paddedRect;const iy=Py.displaySize;vm.scale=vm.scale*Bg/ym,ty={width:iy[0],height:iy[1],left:1,top:-3,advance:n0?iy[1]:iy[0]},S_=B_+(Bg-iy[1]*vm.scale),gv=ty.advance;const _v=n0?iy[0]*vm.scale-Bg*x_:iy[1]*vm.scale-Bg*x_;_v>0&&_v>b_&&(b_=_v)}else{const Py=zp[vm.fontStack],iy=Py&&Py[qg];if(iy&&iy.rect)k0=iy.rect,ty=iy.metrics;else{const _v=Ap[vm.fontStack],K1=_v&&_v[qg];if(!K1)continue;ty=K1.metrics}S_=(x_-vm.scale)*Bg}n0?(zf.verticalizable=!0,z_.push({glyph:qg,imageName:Y0,x:ug,y:_g+S_,vertical:n0,scale:vm.scale,fontStack:vm.fontStack,sectionIndex:E_,metrics:ty,rect:k0}),ug+=gv*vm.scale+Gp):(z_.push({glyph:qg,imageName:Y0,x:ug,y:_g+S_,vertical:n0,scale:vm.scale,fontStack:vm.fontStack,sectionIndex:E_,metrics:ty,rect:k0}),ug+=ty.advance*vm.scale+Gp)}z_.length!==0&&(zg=Math.max(ug-Gp,zg),pv(z_,0,z_.length-1,s_,b_)),ug=0;const vg=cp*x_+b_;ey.lineOffset=Math.max(b_,B_),_g+=vg,i0=Math.max(vg,i0),++yg}var i_;const v_=_g-V1,{horizontalAlign:O_,verticalAlign:J_}=yx(Ep);(function($g,x_,B_,ey,z_,b_,vg,w_,vm){const E_=(x_-B_)*z_;let qg=0;qg=b_!==vg?-w_*ey-V1:(-ey*vm+.5)*vg;for(const S_ of $g)for(const ty of S_.positionedGlyphs)ty.x+=E_,ty.y+=qg})(zf.positionedLines,s_,O_,J_,zg,i0,cp,v_,yp.length),zf.top+=-J_*v_,zf.bottom=zf.top+v_,zf.left+=-O_*zg,zf.right=zf.left+zg}($f,f,S,j,bd,fi,Ur,us,oh,ul,gh,Wh),!function(zf){for(const Ap of zf)if(Ap.positionedGlyphs.length!==0)return!1;return!0}(Nd)&&$f}const fv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ky(_,f,S,j,ut,Ot){if(f.imageName){const fi=j[f.imageName];return fi?fi.displaySize[0]*f.scale*Bg/Ot+ut:0}{const fi=S[f.fontStack],Ur=fi&&fi[_];return Ur?Ur.metrics.advance*f.scale+ut:0}}function Qy(_,f,S,j){const ut=Math.pow(_-f,2);return j?_<f?ut/2:2*ut:ut+Math.abs(S)*S}function o2(_,f,S){let j=0;return _===10&&(j-=1e4),S&&(j+=150),_!==40&&_!==65288||(j+=50),f!==41&&f!==65289||(j+=50),j}function _x(_,f,S,j,ut,Ot){let fi=null,Ur=Qy(f,S,ut,Ot);for(const us of j){const ul=Qy(f-us.x,S,ut,Ot)+us.badness;ul<=Ur&&(fi=us,Ur=ul)}return{index:_,x:f,priorBreak:fi,badness:Ur}}function wb(_){return _?wb(_.priorBreak).concat(_.index):[]}function Eb(_,f,S,j,ut,Ot,fi){if(Ot!=="point")return[];if(!_)return[];const Ur=[],us=function(gh,vh,bh,Wh,Zh,bd){let zd=0;for(let dd=0;dd<gh.length();dd++){const Nd=gh.getSection(dd);zd+=Ky(gh.getCharCode(dd),Nd,Wh,Zh,vh,bd)}return zd/Math.max(1,Math.ceil(zd/bh))}(_,f,S,j,ut,fi),ul=_.text.indexOf("​")>=0;let Ju=0;for(let gh=0;gh<_.length();gh++){const vh=_.getSection(gh),bh=_.getCharCode(gh);if(fv[bh]||(Ju+=Ky(bh,vh,j,ut,f,fi)),gh<_.length()-1){const Wh=!((oh=bh)<11904||!(ap["Bopomofo Extended"](oh)||ap.Bopomofo(oh)||ap["CJK Compatibility Forms"](oh)||ap["CJK Compatibility Ideographs"](oh)||ap["CJK Compatibility"](oh)||ap["CJK Radicals Supplement"](oh)||ap["CJK Strokes"](oh)||ap["CJK Symbols and Punctuation"](oh)||ap["CJK Unified Ideographs Extension A"](oh)||ap["CJK Unified Ideographs"](oh)||ap["Enclosed CJK Letters and Months"](oh)||ap["Halfwidth and Fullwidth Forms"](oh)||ap.Hiragana(oh)||ap["Ideographic Description Characters"](oh)||ap["Kangxi Radicals"](oh)||ap["Katakana Phonetic Extensions"](oh)||ap.Katakana(oh)||ap["Vertical Forms"](oh)||ap["Yi Radicals"](oh)||ap["Yi Syllables"](oh)));(gx[bh]||Wh||vh.imageName)&&Ur.push(_x(gh+1,Ju,us,Ur,o2(bh,_.getCharCode(gh+1),Wh&&ul),!1))}}var oh;return wb(_x(_.length(),Ju,us,Ur,0,!0))}function yx(_){let f=.5,S=.5;switch(_){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0}switch(_){case"bottom":case"bottom-right":case"bottom-left":S=1;break;case"top":case"top-right":case"top-left":S=0}return{horizontalAlign:f,verticalAlign:S}}function pv(_,f,S,j,ut){if(!j&&!ut)return;const Ot=_[S],fi=(_[S].x+Ot.metrics.advance*Ot.scale)*j;for(let Ur=f;Ur<=S;Ur++)_[Ur].x-=fi,_[Ur].y+=ut}function v1(_,f,S){const{horizontalAlign:j,verticalAlign:ut}=yx(S),Ot=f[0]-_.displaySize[0]*j,fi=f[1]-_.displaySize[1]*ut;return{image:_,top:fi,bottom:fi+_.displaySize[1],left:Ot,right:Ot+_.displaySize[0]}}function Sb(_,f,S,j,ut,Ot){const fi=_.image;let Ur;if(fi.content){const Zh=fi.content,bd=fi.pixelRatio||1;Ur=[Zh[0]/bd,Zh[1]/bd,fi.displaySize[0]-Zh[2]/bd,fi.displaySize[1]-Zh[3]/bd]}const us=f.left*Ot,ul=f.right*Ot;let Ju,oh,gh,vh;S==="width"||S==="both"?(vh=ut[0]+us-j[3],oh=ut[0]+ul+j[1]):(vh=ut[0]+(us+ul-fi.displaySize[0])/2,oh=vh+fi.displaySize[0]);const bh=f.top*Ot,Wh=f.bottom*Ot;return S==="height"||S==="both"?(Ju=ut[1]+bh-j[0],gh=ut[1]+Wh+j[2]):(Ju=ut[1]+(bh+Wh-fi.displaySize[1])/2,gh=Ju+fi.displaySize[1]),{image:fi,top:Ju,right:oh,bottom:gh,left:vh,collisionPadding:Ur}}const mv=128;function gw(_,f){const{expression:S}=f;if(S.kind==="constant")return{kind:"constant",layoutSize:S.evaluate(new Mm(_+1))};if(S.kind==="source")return{kind:"source"};{const{zoomStops:j,interpolationType:ut}=S;let Ot=0;for(;Ot<j.length&&j[Ot]<=_;)Ot++;Ot=Math.max(0,Ot-1);let fi=Ot;for(;fi<j.length&&j[fi]<_+1;)fi++;fi=Math.min(j.length-1,fi);const Ur=j[Ot],us=j[fi];return S.kind==="composite"?{kind:"composite",minZoom:Ur,maxZoom:us,interpolationType:ut}:{kind:"camera",minZoom:Ur,maxZoom:us,minSize:S.evaluate(new Mm(Ur)),maxSize:S.evaluate(new Mm(us)),interpolationType:ut}}}class H0 extends cd{constructor(f,S,j,ut){super(f,S),this.angle=j,ut!==void 0&&(this.segment=ut)}clone(){return new H0(this.x,this.y,this.angle,this.segment)}}function Hx(_,f,S,j,ut){if(f.segment===void 0)return!0;let Ot=f,fi=f.segment+1,Ur=0;for(;Ur>-S/2;){if(fi--,fi<0)return!1;Ur-=_[fi].dist(Ot),Ot=_[fi]}Ur+=_[fi].dist(_[fi+1]),fi++;const us=[];let ul=0;for(;Ur<S/2;){const Ju=_[fi],oh=_[fi+1];if(!oh)return!1;let gh=_[fi-1].angleTo(Ju)-Ju.angleTo(oh);for(gh=Math.abs((gh+3*Math.PI)%(2*Math.PI)-Math.PI),us.push({distance:Ur,angleDelta:gh}),ul+=gh;Ur-us[0].distance>j;)ul-=us.shift().angleDelta;if(ul>ut)return!1;fi++,Ur+=Ju.dist(oh)}return!0}function x1(_){let f=0;for(let S=0;S<_.length-1;S++)f+=_[S].dist(_[S+1]);return f}function b1(_,f,S){return _?.6*f*S:0}function G1(_,f){return Math.max(_?_.right-_.left:0,f?f.right-f.left:0)}function Xx(_,f,S,j,ut,Ot){const fi=b1(S,ut,Ot),Ur=G1(S,j)*Ot;let us=0;const ul=x1(_)/2;for(let Ju=0;Ju<_.length-1;Ju++){const oh=_[Ju],gh=_[Ju+1],vh=oh.dist(gh);if(us+vh>ul){const bh=(ul-us)/vh,Wh=mm(oh.x,gh.x,bh),Zh=mm(oh.y,gh.y,bh),bd=new H0(Wh,Zh,gh.angleTo(oh),Ju);return bd._round(),!fi||Hx(_,bd,Ur,fi,f)?bd:void 0}us+=vh}}function _w(_,f,S,j,ut,Ot,fi,Ur,us){const ul=b1(j,Ot,fi),Ju=G1(j,ut),oh=Ju*fi,gh=_[0].x===0||_[0].x===us||_[0].y===0||_[0].y===us;return f-oh<f/4&&(f=oh+f/4),j1(_,gh?f/2*Ur%f:(Ju/2+2*Ot)*fi*Ur%f,f,ul,S,oh,gh,!1,us)}function j1(_,f,S,j,ut,Ot,fi,Ur,us){const ul=Ot/2,Ju=x1(_);let oh=0,gh=f-S,vh=[];for(let bh=0;bh<_.length-1;bh++){const Wh=_[bh],Zh=_[bh+1],bd=Wh.dist(Zh),zd=Zh.angleTo(Wh);for(;gh+S<oh+bd;){gh+=S;const dd=(gh-oh)/bd,Nd=mm(Wh.x,Zh.x,dd),$f=mm(Wh.y,Zh.y,dd);if(Nd>=0&&Nd<us&&$f>=0&&$f<us&&gh-ul>=0&&gh+ul<=Ju){const zf=new H0(Nd,$f,zd,bh);zf._round(),j&&!Hx(_,zf,Ot,j,ut)||vh.push(zf)}}oh+=bd}return Ur||vh.length||fi||(vh=j1(_,oh/2,S,j,ut,Ot,fi,!0,us)),vh}function Wx(_,f,S,j,ut){const Ot=[];for(let fi=0;fi<_.length;fi++){const Ur=_[fi];let us;for(let ul=0;ul<Ur.length-1;ul++){let Ju=Ur[ul],oh=Ur[ul+1];Ju.x<f&&oh.x<f||(Ju.x<f?Ju=new cd(f,Ju.y+(f-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round():oh.x<f&&(oh=new cd(f,Ju.y+(f-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round()),Ju.y<S&&oh.y<S||(Ju.y<S?Ju=new cd(Ju.x+(S-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),S)._round():oh.y<S&&(oh=new cd(Ju.x+(S-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),S)._round()),Ju.x>=j&&oh.x>=j||(Ju.x>=j?Ju=new cd(j,Ju.y+(j-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round():oh.x>=j&&(oh=new cd(j,Ju.y+(j-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round()),Ju.y>=ut&&oh.y>=ut||(Ju.y>=ut?Ju=new cd(Ju.x+(ut-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),ut)._round():oh.y>=ut&&(oh=new cd(Ju.x+(ut-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),ut)._round()),us&&Ju.equals(us[us.length-1])||(us=[Ju],Ot.push(us)),us.push(oh)))))}}return Ot}function Tb(_,f,S,j){const ut=[],Ot=_.image,fi=Ot.pixelRatio,Ur=Ot.paddedRect.w-2,us=Ot.paddedRect.h-2,ul=_.right-_.left,Ju=_.bottom-_.top,oh=Ot.stretchX||[[0,Ur]],gh=Ot.stretchY||[[0,us]],vh=(cp,Ep)=>cp+Ep[1]-Ep[0],bh=oh.reduce(vh,0),Wh=gh.reduce(vh,0),Zh=Ur-bh,bd=us-Wh;let zd=0,dd=bh,Nd=0,$f=Wh,zf=0,Ap=Zh,zp=0,wp=bd;if(Ot.content&&j){const cp=Ot.content;zd=Lv(oh,0,cp[0]),Nd=Lv(gh,0,cp[1]),dd=Lv(oh,cp[0],cp[2]),$f=Lv(gh,cp[1],cp[3]),zf=cp[0]-zd,zp=cp[1]-Nd,Ap=cp[2]-cp[0]-dd,wp=cp[3]-cp[1]-$f}const yp=(cp,Ep,gp,Qf)=>{const Gp=q1(cp.stretch-zd,dd,ul,_.left),$p=vx(cp.fixed-zf,Ap,cp.stretch,bh),ym=q1(Ep.stretch-Nd,$f,Ju,_.top),ug=vx(Ep.fixed-zp,wp,Ep.stretch,Wh),_g=q1(gp.stretch-zd,dd,ul,_.left),zg=vx(gp.fixed-zf,Ap,gp.stretch,bh),i0=q1(Qf.stretch-Nd,$f,Ju,_.top),s_=vx(Qf.fixed-zp,wp,Qf.stretch,Wh),yg=new cd(Gp,ym),i_=new cd(_g,ym),v_=new cd(_g,i0),O_=new cd(Gp,i0),J_=new cd($p/fi,ug/fi),$g=new cd(zg/fi,s_/fi),x_=f*Math.PI/180;if(x_){const z_=Math.sin(x_),b_=Math.cos(x_),vg=[b_,-z_,z_,b_];yg._matMult(vg),i_._matMult(vg),O_._matMult(vg),v_._matMult(vg)}const B_=cp.stretch+cp.fixed,ey=Ep.stretch+Ep.fixed;return{tl:yg,tr:i_,bl:O_,br:v_,tex:{x:Ot.paddedRect.x+1+B_,y:Ot.paddedRect.y+1+ey,w:gp.stretch+gp.fixed-B_,h:Qf.stretch+Qf.fixed-ey},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:J_,pixelOffsetBR:$g,minFontScaleX:Ap/fi/ul,minFontScaleY:wp/fi/Ju,isSDF:S}};if(j&&(Ot.stretchX||Ot.stretchY)){const cp=Ib(oh,Zh,bh),Ep=Ib(gh,bd,Wh);for(let gp=0;gp<cp.length-1;gp++){const Qf=cp[gp],Gp=cp[gp+1];for(let $p=0;$p<Ep.length-1;$p++)ut.push(yp(Qf,Ep[$p],Gp,Ep[$p+1]))}}else ut.push(yp({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Ur+1},{fixed:0,stretch:us+1}));return ut}function Lv(_,f,S){let j=0;for(const ut of _)j+=Math.max(f,Math.min(S,ut[1]))-Math.max(f,Math.min(S,ut[0]));return j}function Ib(_,f,S){const j=[{fixed:-1,stretch:0}];for(const[ut,Ot]of _){const fi=j[j.length-1];j.push({fixed:ut-fi.stretch,stretch:fi.stretch}),j.push({fixed:ut-fi.stretch,stretch:fi.stretch+(Ot-ut)})}return j.push({fixed:f+1,stretch:S}),j}function q1(_,f,S,j){return _/f*S+j}function vx(_,f,S,j){return _-f*S/j}tp("Anchor",H0);class Yx{constructor(f,S,j,ut,Ot,fi,Ur,us,ul,Ju){if(this.boxStartIndex=f.length,ul){let oh=fi.top,gh=fi.bottom;const vh=fi.collisionPadding;vh&&(oh-=vh[1],gh+=vh[3]);let bh=gh-oh;bh>0&&(bh=Math.max(10,bh),this.circleDiameter=bh)}else{let oh=fi.top*Ur-us[0],gh=fi.bottom*Ur+us[2],vh=fi.left*Ur-us[3],bh=fi.right*Ur+us[1];const Wh=fi.collisionPadding;if(Wh&&(vh-=Wh[0]*Ur,oh-=Wh[1]*Ur,bh+=Wh[2]*Ur,gh+=Wh[3]*Ur),Ju){const Zh=new cd(vh,oh),bd=new cd(bh,oh),zd=new cd(vh,gh),dd=new cd(bh,gh),Nd=Ju*Math.PI/180;Zh._rotate(Nd),bd._rotate(Nd),zd._rotate(Nd),dd._rotate(Nd),vh=Math.min(Zh.x,bd.x,zd.x,dd.x),bh=Math.max(Zh.x,bd.x,zd.x,dd.x),oh=Math.min(Zh.y,bd.y,zd.y,dd.y),gh=Math.max(Zh.y,bd.y,zd.y,dd.y)}f.emplaceBack(S.x,S.y,vh,oh,bh,gh,j,ut,Ot)}this.boxEndIndex=f.length}}class s2{constructor(f=[],S=xx){if(this.data=f,this.length=this.data.length,this.compare=S,this.length>0)for(let j=(this.length>>1)-1;j>=0;j--)this._down(j)}push(f){this.data.push(f),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const f=this.data[0],S=this.data.pop();return this.length--,this.length>0&&(this.data[0]=S,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:S,compare:j}=this,ut=S[f];for(;f>0;){const Ot=f-1>>1,fi=S[Ot];if(j(ut,fi)>=0)break;S[f]=fi,f=Ot}S[f]=ut}_down(f){const{data:S,compare:j}=this,ut=this.length>>1,Ot=S[f];for(;f<ut;){let fi=1+(f<<1),Ur=S[fi];const us=fi+1;if(us<this.length&&j(S[us],Ur)<0&&(fi=us,Ur=S[us]),j(Ur,Ot)>=0)break;S[f]=Ur,f=fi}S[f]=Ot}}function xx(_,f){return _<f?-1:_>f?1:0}function yw(_,f=1,S=!1){let j=1/0,ut=1/0,Ot=-1/0,fi=-1/0;const Ur=_[0];for(let vh=0;vh<Ur.length;vh++){const bh=Ur[vh];(!vh||bh.x<j)&&(j=bh.x),(!vh||bh.y<ut)&&(ut=bh.y),(!vh||bh.x>Ot)&&(Ot=bh.x),(!vh||bh.y>fi)&&(fi=bh.y)}const us=Math.min(Ot-j,fi-ut);let ul=us/2;const Ju=new s2([],Sm);if(us===0)return new cd(j,ut);for(let vh=j;vh<Ot;vh+=us)for(let bh=ut;bh<fi;bh+=us)Ju.push(new t1(vh+ul,bh+ul,ul,_));let oh=function(vh){let bh=0,Wh=0,Zh=0;const bd=vh[0];for(let zd=0,dd=bd.length,Nd=dd-1;zd<dd;Nd=zd++){const $f=bd[zd],zf=bd[Nd],Ap=$f.x*zf.y-zf.x*$f.y;Wh+=($f.x+zf.x)*Ap,Zh+=($f.y+zf.y)*Ap,bh+=3*Ap}return new t1(Wh/bh,Zh/bh,0,vh)}(_),gh=Ju.length;for(;Ju.length;){const vh=Ju.pop();(vh.d>oh.d||!oh.d)&&(oh=vh,S&&console.log("found best %d after %d probes",Math.round(1e4*vh.d)/1e4,gh)),vh.max-oh.d<=f||(ul=vh.h/2,Ju.push(new t1(vh.p.x-ul,vh.p.y-ul,ul,_)),Ju.push(new t1(vh.p.x+ul,vh.p.y-ul,ul,_)),Ju.push(new t1(vh.p.x-ul,vh.p.y+ul,ul,_)),Ju.push(new t1(vh.p.x+ul,vh.p.y+ul,ul,_)),gh+=4)}return S&&(console.log(`num probes: ${gh}`),console.log(`best distance: ${oh.d}`)),oh.p}function Sm(_,f){return f.max-_.max}function t1(_,f,S,j){this.p=new cd(_,f),this.h=S,this.d=function(ut,Ot){let fi=!1,Ur=1/0;for(let us=0;us<Ot.length;us++){const ul=Ot[us];for(let Ju=0,oh=ul.length,gh=oh-1;Ju<oh;gh=Ju++){const vh=ul[Ju],bh=ul[gh];vh.y>ut.y!=bh.y>ut.y&&ut.x<(bh.x-vh.x)*(ut.y-vh.y)/(bh.y-vh.y)+vh.x&&(fi=!fi),Ur=Math.min(Ur,gd(ut,vh,bh))}}return(fi?1:-1)*Math.sqrt(Ur)}(this.p,j),this.max=this.d+this.h*Math.SQRT2}const P0=Number.POSITIVE_INFINITY;function X0(_,f){return f[1]!==P0?function(S,j,ut){let Ot=0,fi=0;switch(j=Math.abs(j),ut=Math.abs(ut),S){case"top-right":case"top-left":case"top":fi=ut-7;break;case"bottom-right":case"bottom-left":case"bottom":fi=7-ut}switch(S){case"top-right":case"bottom-right":case"right":Ot=-j;break;case"top-left":case"bottom-left":case"left":Ot=j}return[Ot,fi]}(_,f[0],f[1]):function(S,j){let ut=0,Ot=0;j<0&&(j=0);const fi=j/Math.sqrt(2);switch(S){case"top-right":case"top-left":Ot=fi-7;break;case"bottom-right":case"bottom-left":Ot=7-fi;break;case"bottom":Ot=7-j;break;case"top":Ot=j-7}switch(S){case"top-right":case"bottom-right":ut=-fi;break;case"top-left":case"bottom-left":ut=fi;break;case"left":ut=j;break;case"right":ut=-j}return[ut,Ot]}(_,f[0])}function Jy(_){switch(_){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e0(_,f,S,j,ut,Ot,fi,Ur,us,ul,Ju){let oh=Ot.textMaxSize.evaluate(f,{});oh===void 0&&(oh=fi);const gh=_.layers[0].layout,vh=gh.get("icon-offset").evaluate(f,{},Ju),bh=o_(S.horizontal),Wh=fi/24,Zh=_.tilePixelRatio*Wh,bd=_.tilePixelRatio*oh/24,zd=_.tilePixelRatio*Ur,dd=_.tilePixelRatio*gh.get("symbol-spacing"),Nd=gh.get("text-padding")*_.tilePixelRatio,$f=function(Qf,Gp,$p,ym=1){const ug=Qf.get("icon-padding").evaluate(Gp,{},$p),_g=ug&&ug.values;return[_g[0]*ym,_g[1]*ym,_g[2]*ym,_g[3]*ym]}(gh,f,Ju,_.tilePixelRatio),zf=gh.get("text-max-angle")/180*Math.PI,Ap=gh.get("text-rotation-alignment")!=="viewport"&&gh.get("symbol-placement")!=="point",zp=gh.get("icon-rotation-alignment")==="map"&&gh.get("symbol-placement")!=="point",wp=gh.get("symbol-placement"),yp=dd/2,cp=gh.get("icon-text-fit");let Ep;j&&cp!=="none"&&(_.allowVerticalPlacement&&S.vertical&&(Ep=Sb(j,S.vertical,cp,gh.get("icon-text-fit-padding"),vh,Wh)),bh&&(j=Sb(j,bh,cp,gh.get("icon-text-fit-padding"),vh,Wh)));const gp=(Qf,Gp)=>{Gp.x<0||Gp.x>=fh||Gp.y<0||Gp.y>=fh||function($p,ym,ug,_g,zg,i0,s_,yg,i_,v_,O_,J_,$g,x_,B_,ey,z_,b_,vg,w_,vm,E_,qg,S_,ty){const k0=$p.addToLineVertexArray(ym,ug);let Y0,gv,n0,Py,iy=0,_v=0,K1=0,Cw=0,Fb=-1,eb=-1;const D0={};let $b=ph(""),T_=0,M1=0;if(yg._unevaluatedLayout.getValue("text-radial-offset")===void 0?[T_,M1]=yg.layout.get("text-offset").evaluate(vm,{},S_).map(ny=>ny*Bg):(T_=yg.layout.get("text-radial-offset").evaluate(vm,{},S_)*Bg,M1=P0),$p.allowVerticalPlacement&&_g.vertical){const ny=yg.layout.get("text-rotate").evaluate(vm,{},S_)+90;n0=new Yx(i_,ym,v_,O_,J_,_g.vertical,$g,x_,B_,ny),s_&&(Py=new Yx(i_,ym,v_,O_,J_,s_,z_,b_,B_,ny))}if(zg){const ny=yg.layout.get("icon-rotate").evaluate(vm,{}),Q0=yg.layout.get("icon-text-fit")!=="none",Q1=Tb(zg,ny,qg,Q0),Px=s_?Tb(s_,ny,qg,Q0):void 0;gv=new Yx(i_,ym,v_,O_,J_,zg,z_,b_,!1,ny),iy=4*Q1.length;const Dw=$p.iconSizeData;let P1=null;Dw.kind==="source"?(P1=[mv*yg.layout.get("icon-size").evaluate(vm,{})],P1[0]>Cg&&Js(`${$p.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Dw.kind==="composite"&&(P1=[mv*E_.compositeIconSizes[0].evaluate(vm,{},S_),mv*E_.compositeIconSizes[1].evaluate(vm,{},S_)],(P1[0]>Cg||P1[1]>Cg)&&Js(`${$p.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$p.addSymbols($p.icon,Q1,P1,w_,vg,vm,o.WritingMode.none,ym,k0.lineStartIndex,k0.lineLength,-1,S_),Fb=$p.icon.placedSymbolArray.length-1,Px&&(_v=4*Px.length,$p.addSymbols($p.icon,Px,P1,w_,vg,vm,o.WritingMode.vertical,ym,k0.lineStartIndex,k0.lineLength,-1,S_),eb=$p.icon.placedSymbolArray.length-1)}const C1=Object.keys(_g.horizontal);for(const ny of C1){const Q0=_g.horizontal[ny];if(!Y0){$b=ph(Q0.text);const Px=yg.layout.get("text-rotate").evaluate(vm,{},S_);Y0=new Yx(i_,ym,v_,O_,J_,Q0,$g,x_,B_,Px)}const Q1=Q0.positionedLines.length===1;if(K1+=Mb($p,ym,Q0,i0,yg,B_,vm,ey,k0,_g.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Q1?C1:[ny],D0,Fb,E_,S_),Q1)break}_g.vertical&&(Cw+=Mb($p,ym,_g.vertical,i0,yg,B_,vm,ey,k0,o.WritingMode.vertical,["vertical"],D0,eb,E_,S_));const Ax=Y0?Y0.boxStartIndex:$p.collisionBoxArray.length,Aw=Y0?Y0.boxEndIndex:$p.collisionBoxArray.length,Pw=n0?n0.boxStartIndex:$p.collisionBoxArray.length,d2=n0?n0.boxEndIndex:$p.collisionBoxArray.length,f2=gv?gv.boxStartIndex:$p.collisionBoxArray.length,p2=gv?gv.boxEndIndex:$p.collisionBoxArray.length,m2=Py?Py.boxStartIndex:$p.collisionBoxArray.length,g2=Py?Py.boxEndIndex:$p.collisionBoxArray.length;let K0=-1;const A1=(ny,Q0)=>ny&&ny.circleDiameter?Math.max(ny.circleDiameter,Q0):Q0;K0=A1(Y0,K0),K0=A1(n0,K0),K0=A1(gv,K0),K0=A1(Py,K0);const kw=K0>-1?1:0;kw&&(K0*=ty/Bg),$p.glyphOffsetArray.length>=H1.MAX_GLYPHS&&Js("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vm.sortKey!==void 0&&$p.addToSortKeyRanges($p.symbolInstances.length,vm.sortKey),$p.symbolInstances.emplaceBack(ym.x,ym.y,D0.right>=0?D0.right:-1,D0.center>=0?D0.center:-1,D0.left>=0?D0.left:-1,D0.vertical||-1,Fb,eb,$b,Ax,Aw,Pw,d2,f2,p2,m2,g2,v_,K1,Cw,iy,_v,kw,0,$g,T_,M1,K0)}(_,Gp,Qf,S,j,ut,Ep,_.layers[0],_.collisionBoxArray,f.index,f.sourceLayerIndex,_.index,Zh,[Nd,Nd,Nd,Nd],Ap,us,zd,$f,zp,vh,f,Ot,ul,Ju,fi)};if(wp==="line")for(const Qf of Wx(f.geometry,0,0,fh,fh)){const Gp=_w(Qf,dd,zf,S.vertical||bh,j,24,bd,_.overscaling,fh);for(const $p of Gp)bh&&vw(_,bh.text,yp,$p)||gp(Qf,$p)}else if(wp==="line-center"){for(const Qf of f.geometry)if(Qf.length>1){const Gp=Xx(Qf,zf,S.vertical||bh,j,24,bd);Gp&&gp(Qf,Gp)}}else if(f.type==="Polygon")for(const Qf of Ox(f.geometry,0)){const Gp=yw(Qf,16);gp(Qf[0],new H0(Gp.x,Gp.y,0))}else if(f.type==="LineString")for(const Qf of f.geometry)gp(Qf,new H0(Qf[0].x,Qf[0].y,0));else if(f.type==="Point")for(const Qf of f.geometry)for(const Gp of Qf)gp([Gp],new H0(Gp.x,Gp.y,0))}const Cg=32640;function Mb(_,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh){const Wh=function(zd,dd,Nd,$f,zf,Ap,zp,wp){const yp=$f.layout.get("text-rotate").evaluate(Ap,{})*Math.PI/180,cp=[];for(const Ep of dd.positionedLines)for(const gp of Ep.positionedGlyphs){if(!gp.rect)continue;const Qf=gp.rect||{};let Gp=4,$p=!0,ym=1,ug=0;const _g=(zf||wp)&&gp.vertical,zg=gp.metrics.advance*gp.scale/2;if(wp&&dd.verticalizable&&(ug=Ep.lineOffset/2-(gp.imageName?-(Bg-gp.metrics.width*gp.scale)/2:(gp.scale-1)*Bg)),gp.imageName){const vg=zp[gp.imageName];$p=vg.sdf,ym=vg.pixelRatio,Gp=1/ym}const i0=zf?[gp.x+zg,gp.y]:[0,0];let s_=zf?[0,0]:[gp.x+zg+Nd[0],gp.y+Nd[1]-ug],yg=[0,0];_g&&(yg=s_,s_=[0,0]);const i_=(gp.metrics.left-Gp)*gp.scale-zg+s_[0],v_=(-gp.metrics.top-Gp)*gp.scale+s_[1],O_=i_+Qf.w*gp.scale/ym,J_=v_+Qf.h*gp.scale/ym,$g=new cd(i_,v_),x_=new cd(O_,v_),B_=new cd(i_,J_),ey=new cd(O_,J_);if(_g){const vg=new cd(-zg,zg-V1),w_=-Math.PI/2,vm=12-zg,E_=new cd(22-vm,-(gp.imageName?vm:0)),qg=new cd(...yg);$g._rotateAround(w_,vg)._add(E_)._add(qg),x_._rotateAround(w_,vg)._add(E_)._add(qg),B_._rotateAround(w_,vg)._add(E_)._add(qg),ey._rotateAround(w_,vg)._add(E_)._add(qg)}if(yp){const vg=Math.sin(yp),w_=Math.cos(yp),vm=[w_,-vg,vg,w_];$g._matMult(vm),x_._matMult(vm),B_._matMult(vm),ey._matMult(vm)}const z_=new cd(0,0),b_=new cd(0,0);cp.push({tl:$g,tr:x_,bl:B_,br:ey,tex:Qf,writingMode:dd.writingMode,glyphOffset:i0,sectionIndex:gp.sectionIndex,isSDF:$p,pixelOffsetTL:z_,pixelOffsetBR:b_,minFontScaleX:0,minFontScaleY:0})}return cp}(0,S,Ur,ut,Ot,fi,j,_.allowVerticalPlacement),Zh=_.textSizeData;let bd=null;Zh.kind==="source"?(bd=[mv*ut.layout.get("text-size").evaluate(fi,{})],bd[0]>Cg&&Js(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Zh.kind==="composite"&&(bd=[mv*vh.compositeTextSizes[0].evaluate(fi,{},bh),mv*vh.compositeTextSizes[1].evaluate(fi,{},bh)],(bd[0]>Cg||bd[1]>Cg)&&Js(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),_.addSymbols(_.text,Wh,bd,Ur,Ot,fi,ul,f,us.lineStartIndex,us.lineLength,gh,bh);for(const zd of Ju)oh[zd]=_.text.placedSymbolArray.length-1;return 4*Wh.length}function o_(_){for(const f in _)return _[f];return null}function vw(_,f,S,j){const ut=_.compareText;if(f in ut){const Ot=ut[f];for(let fi=Ot.length-1;fi>=0;fi--)if(j.dist(Ot[fi])<S)return!0}else ut[f]=[];return ut[f].push(j),!1}const Z1=Wv.VectorTileFeature.types,Cb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bx(_,f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh){const vh=Ur?Math.min(Cg,Math.round(Ur[0])):0,bh=Ur?Math.min(Cg,Math.round(Ur[1])):0;_.emplaceBack(f,S,Math.round(32*j),Math.round(32*ut),Ot,fi,(vh<<1)+(us?1:0),bh,16*ul,16*Ju,256*oh,256*gh)}function wx(_,f,S){_.emplaceBack(f.x,f.y,S),_.emplaceBack(f.x,f.y,S),_.emplaceBack(f.x,f.y,S),_.emplaceBack(f.x,f.y,S)}function a2(_){for(const f of _.sections)if(sm(f.text))return!0;return!1}class Ex{constructor(f){this.layoutVertexArray=new Y,this.indexArray=new Ft,this.programConfigurations=f,this.segments=new ol,this.dynamicLayoutVertexArray=new g,this.opacityVertexArray=new A,this.hasVisibleVertices=!1,this.placedSymbolArray=new uv}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(f,S,j,ut){this.isEmpty()||(j&&(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,jx.members),this.indexBuffer=f.createIndexBuffer(this.indexArray,S),this.dynamicLayoutVertexBuffer=f.createVertexBuffer(this.dynamicLayoutVertexArray,sw.members,!0),this.opacityVertexBuffer=f.createVertexBuffer(this.opacityVertexArray,Cb,!0),this.opacityVertexBuffer.itemSize=1),(j||ut)&&this.programConfigurations.upload(f))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tp("SymbolBuffers",Ex);class Kx{constructor(f,S,j){this.layoutVertexArray=new f,this.layoutAttributes=S,this.indexArray=new j,this.segments=new ol,this.collisionVertexArray=new ze}upload(f){this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=f.createVertexBuffer(this.collisionVertexArray,aw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tp("CollisionBuffers",Kx);class H1{constructor(f){this.collisionBoxArray=f.collisionBoxArray,this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(fi=>fi.id),this.index=f.index,this.pixelRatio=f.pixelRatio,this.sourceLayerIndex=f.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dp([]),this.placementViewportMatrix=Dp([]);const S=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gw(this.zoom,S["text-size"]),this.iconSizeData=gw(this.zoom,S["icon-size"]);const j=this.layers[0].layout,ut=j.get("symbol-sort-key"),Ot=j.get("symbol-z-order");this.canOverlap=Tx(j,"text-overlap","text-allow-overlap")!=="never"||Tx(j,"icon-overlap","icon-allow-overlap")!=="never"||j.get("text-ignore-placement")||j.get("icon-ignore-placement"),this.sortFeaturesByKey=Ot!=="viewport-y"&&!ut.isConstant(),this.sortFeaturesByY=(Ot==="viewport-y"||Ot==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,j.get("symbol-placement")==="point"&&(this.writingModes=j.get("text-writing-mode").map(fi=>o.WritingMode[fi])),this.stateDependentLayerIds=this.layers.filter(fi=>fi.isStateDependent()).map(fi=>fi.id),this.sourceID=f.sourceID}createArrays(){this.text=new Ex(new tl(this.layers,this.zoom,f=>/^text/.test(f))),this.icon=new Ex(new tl(this.layers,this.zoom,f=>/^icon/.test(f))),this.glyphOffsetArray=new T0,this.lineVertexArray=new Cv,this.symbolInstances=new R1}calculateGlyphDependencies(f,S,j,ut,Ot){for(let fi=0;fi<f.length;fi++)if(S[f.charCodeAt(fi)]=!0,(j||ut)&&Ot){const Ur=Dv[f.charAt(fi)];Ur&&(S[Ur.charCodeAt(0)]=!0)}}populate(f,S,j){const ut=this.layers[0],Ot=ut.layout,fi=Ot.get("text-font"),Ur=Ot.get("text-field"),us=Ot.get("icon-image"),ul=(Ur.value.kind!=="constant"||Ur.value.value instanceof lm&&!Ur.value.value.isEmpty()||Ur.value.value.toString().length>0)&&(fi.value.kind!=="constant"||fi.value.value.length>0),Ju=us.value.kind!=="constant"||!!us.value.value||Object.keys(us.parameters).length>0,oh=Ot.get("symbol-sort-key");if(this.features=[],!ul&&!Ju)return;const gh=S.iconDependencies,vh=S.glyphDependencies,bh=S.availableImages,Wh=new Mm(this.zoom);for(const{feature:Zh,id:bd,index:zd,sourceLayerIndex:dd}of f){const Nd=ut._featureFilter.needGeometry,$f=Ih(Zh,Nd);if(!ut._featureFilter.filter(Wh,$f,j))continue;let zf,Ap;if(Nd||($f.geometry=Sh(Zh)),ul){const wp=ut.getValueAndResolveTokens("text-field",$f,j,bh),yp=lm.factory(wp);a2(yp)&&(this.hasRTLText=!0),(!this.hasRTLText||Gg()==="unavailable"||this.hasRTLText&&Ig.isParsed())&&(zf=uw(yp,ut,$f))}if(Ju){const wp=ut.getValueAndResolveTokens("icon-image",$f,j,bh);Ap=wp instanceof Hf?wp:Hf.fromString(wp)}if(!zf&&!Ap)continue;const zp=this.sortFeaturesByKey?oh.evaluate($f,{},j):void 0;if(this.features.push({id:bd,text:zf,icon:Ap,index:zd,sourceLayerIndex:dd,geometry:$f.geometry,properties:Zh.properties,type:Z1[Zh.type],sortKey:zp}),Ap&&(gh[Ap.name]=!0),zf){const wp=fi.evaluate($f,{},j).join(","),yp=Ot.get("text-rotation-alignment")!=="viewport"&&Ot.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const cp of zf.sections)if(cp.image)gh[cp.image.name]=!0;else{const Ep=Zy(zf.toString()),gp=cp.fontStack||wp,Qf=vh[gp]=vh[gp]||{};this.calculateGlyphDependencies(cp.text,Qf,yp,this.allowVerticalPlacement,Ep)}}}Ot.get("symbol-placement")==="line"&&(this.features=function(Zh){const bd={},zd={},dd=[];let Nd=0;function $f(wp){dd.push(Zh[wp]),Nd++}function zf(wp,yp,cp){const Ep=zd[wp];return delete zd[wp],zd[yp]=Ep,dd[Ep].geometry[0].pop(),dd[Ep].geometry[0]=dd[Ep].geometry[0].concat(cp[0]),Ep}function Ap(wp,yp,cp){const Ep=bd[yp];return delete bd[yp],bd[wp]=Ep,dd[Ep].geometry[0].shift(),dd[Ep].geometry[0]=cp[0].concat(dd[Ep].geometry[0]),Ep}function zp(wp,yp,cp){const Ep=cp?yp[0][yp[0].length-1]:yp[0][0];return`${wp}:${Ep.x}:${Ep.y}`}for(let wp=0;wp<Zh.length;wp++){const yp=Zh[wp],cp=yp.geometry,Ep=yp.text?yp.text.toString():null;if(!Ep){$f(wp);continue}const gp=zp(Ep,cp),Qf=zp(Ep,cp,!0);if(gp in zd&&Qf in bd&&zd[gp]!==bd[Qf]){const Gp=Ap(gp,Qf,cp),$p=zf(gp,Qf,dd[Gp].geometry);delete bd[gp],delete zd[Qf],zd[zp(Ep,dd[$p].geometry,!0)]=$p,dd[Gp].geometry=null}else gp in zd?zf(gp,Qf,cp):Qf in bd?Ap(gp,Qf,cp):($f(wp),bd[gp]=Nd-1,zd[Qf]=Nd-1)}return dd.filter(wp=>wp.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Zh,bd)=>Zh.sortKey-bd.sortKey)}update(f,S,j){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(f,S,this.layers,j),this.icon.programConfigurations.updatePaintArrays(f,S,this.layers,j))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(f),this.iconCollisionBox.upload(f)),this.text.upload(f,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(f,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(f,S){const j=this.lineVertexArray.length;if(f.segment!==void 0){let ut=f.dist(S[f.segment+1]),Ot=f.dist(S[f.segment]);const fi={};for(let Ur=f.segment+1;Ur<S.length;Ur++)fi[Ur]={x:S[Ur].x,y:S[Ur].y,tileUnitDistanceFromAnchor:ut},Ur<S.length-1&&(ut+=S[Ur+1].dist(S[Ur]));for(let Ur=f.segment||0;Ur>=0;Ur--)fi[Ur]={x:S[Ur].x,y:S[Ur].y,tileUnitDistanceFromAnchor:Ot},Ur>0&&(Ot+=S[Ur-1].dist(S[Ur]));for(let Ur=0;Ur<S.length;Ur++){const us=fi[Ur];this.lineVertexArray.emplaceBack(us.x,us.y,us.tileUnitDistanceFromAnchor)}}return{lineStartIndex:j,lineLength:this.lineVertexArray.length-j}}addSymbols(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh){const vh=f.indexArray,bh=f.layoutVertexArray,Wh=f.segments.prepareSegment(4*S.length,bh,vh,this.canOverlap?fi.sortKey:void 0),Zh=this.glyphOffsetArray.length,bd=Wh.vertexLength,zd=this.allowVerticalPlacement&&Ur===o.WritingMode.vertical?Math.PI/2:0,dd=fi.text&&fi.text.sections;for(let Nd=0;Nd<S.length;Nd++){const{tl:$f,tr:zf,bl:Ap,br:zp,tex:wp,pixelOffsetTL:yp,pixelOffsetBR:cp,minFontScaleX:Ep,minFontScaleY:gp,glyphOffset:Qf,isSDF:Gp,sectionIndex:$p}=S[Nd],ym=Wh.vertexLength,ug=Qf[1];bx(bh,us.x,us.y,$f.x,ug+$f.y,wp.x,wp.y,j,Gp,yp.x,yp.y,Ep,gp),bx(bh,us.x,us.y,zf.x,ug+zf.y,wp.x+wp.w,wp.y,j,Gp,cp.x,yp.y,Ep,gp),bx(bh,us.x,us.y,Ap.x,ug+Ap.y,wp.x,wp.y+wp.h,j,Gp,yp.x,cp.y,Ep,gp),bx(bh,us.x,us.y,zp.x,ug+zp.y,wp.x+wp.w,wp.y+wp.h,j,Gp,cp.x,cp.y,Ep,gp),wx(f.dynamicLayoutVertexArray,us,zd),vh.emplaceBack(ym,ym+1,ym+2),vh.emplaceBack(ym+1,ym+2,ym+3),Wh.vertexLength+=4,Wh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qf[0]),Nd!==S.length-1&&$p===S[Nd+1].sectionIndex||f.programConfigurations.populatePaintArrays(bh.length,fi,fi.index,{},gh,dd&&dd[$p])}f.placedSymbolArray.emplaceBack(us.x,us.y,Zh,this.glyphOffsetArray.length-Zh,bd,ul,Ju,us.segment,j?j[0]:0,j?j[1]:0,ut[0],ut[1],Ur,0,!1,0,oh)}_addCollisionDebugVertex(f,S,j,ut,Ot,fi){return S.emplaceBack(0,0),f.emplaceBack(j.x,j.y,ut,Ot,Math.round(fi.x),Math.round(fi.y))}addCollisionDebugVertices(f,S,j,ut,Ot,fi,Ur){const us=Ot.segments.prepareSegment(4,Ot.layoutVertexArray,Ot.indexArray),ul=us.vertexLength,Ju=Ot.layoutVertexArray,oh=Ot.collisionVertexArray,gh=Ur.anchorX,vh=Ur.anchorY;this._addCollisionDebugVertex(Ju,oh,fi,gh,vh,new cd(f,S)),this._addCollisionDebugVertex(Ju,oh,fi,gh,vh,new cd(j,S)),this._addCollisionDebugVertex(Ju,oh,fi,gh,vh,new cd(j,ut)),this._addCollisionDebugVertex(Ju,oh,fi,gh,vh,new cd(f,ut)),us.vertexLength+=4;const bh=Ot.indexArray;bh.emplaceBack(ul,ul+1),bh.emplaceBack(ul+1,ul+2),bh.emplaceBack(ul+2,ul+3),bh.emplaceBack(ul+3,ul),us.primitiveLength+=4}addDebugCollisionBoxes(f,S,j,ut){for(let Ot=f;Ot<S;Ot++){const fi=this.collisionBoxArray.get(Ot);this.addCollisionDebugVertices(fi.x1,fi.y1,fi.x2,fi.y2,ut?this.textCollisionBox:this.iconCollisionBox,fi.anchorPoint,j)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kx(q,lw.members,Gn),this.iconCollisionBox=new Kx(q,lw.members,Gn);for(let f=0;f<this.symbolInstances.length;f++){const S=this.symbolInstances.get(f);this.addDebugCollisionBoxes(S.textBoxStartIndex,S.textBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.iconBoxStartIndex,S.iconBoxEndIndex,S,!1),this.addDebugCollisionBoxes(S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,!1)}}_deserializeCollisionBoxesForSymbol(f,S,j,ut,Ot,fi,Ur,us,ul){const Ju={};for(let oh=S;oh<j;oh++){const gh=f.get(oh);Ju.textBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.textFeatureIndex=gh.featureIndex;break}for(let oh=ut;oh<Ot;oh++){const gh=f.get(oh);Ju.verticalTextBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.verticalTextFeatureIndex=gh.featureIndex;break}for(let oh=fi;oh<Ur;oh++){const gh=f.get(oh);Ju.iconBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.iconFeatureIndex=gh.featureIndex;break}for(let oh=us;oh<ul;oh++){const gh=f.get(oh);Ju.verticalIconBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.verticalIconFeatureIndex=gh.featureIndex;break}return Ju}deserializeCollisionBoxes(f){this.collisionArrays=[];for(let S=0;S<this.symbolInstances.length;S++){const j=this.symbolInstances.get(S);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(f,j.textBoxStartIndex,j.textBoxEndIndex,j.verticalTextBoxStartIndex,j.verticalTextBoxEndIndex,j.iconBoxStartIndex,j.iconBoxEndIndex,j.verticalIconBoxStartIndex,j.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(f,S){const j=f.placedSymbolArray.get(S),ut=j.vertexStartIndex+4*j.numGlyphs;for(let Ot=j.vertexStartIndex;Ot<ut;Ot+=4)f.indexArray.emplaceBack(Ot,Ot+1,Ot+2),f.indexArray.emplaceBack(Ot+1,Ot+2,Ot+3)}getSortedSymbolIndexes(f){if(this.sortedAngle===f&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const S=Math.sin(f),j=Math.cos(f),ut=[],Ot=[],fi=[];for(let Ur=0;Ur<this.symbolInstances.length;++Ur){fi.push(Ur);const us=this.symbolInstances.get(Ur);ut.push(0|Math.round(S*us.anchorX+j*us.anchorY)),Ot.push(us.featureIndex)}return fi.sort((Ur,us)=>ut[Ur]-ut[us]||Ot[us]-Ot[Ur]),fi}addToSortKeyRanges(f,S){const j=this.sortKeyRanges[this.sortKeyRanges.length-1];j&&j.sortKey===S?j.symbolInstanceEnd=f+1:this.sortKeyRanges.push({sortKey:S,symbolInstanceStart:f,symbolInstanceEnd:f+1})}sortFeatures(f){if(this.sortFeaturesByY&&this.sortedAngle!==f&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(f),this.sortedAngle=f,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const S of this.symbolInstanceIndexes){const j=this.symbolInstances.get(S);this.featureSortOrder.push(j.featureIndex),[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach((ut,Ot,fi)=>{ut>=0&&fi.indexOf(ut)===Ot&&this.addIndicesForPlacedSymbol(this.text,ut)}),j.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,j.verticalPlacedTextSymbolIndex),j.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.placedIconSymbolIndex),j.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tp("SymbolBucket",H1,{omit:["layers","collisionBoxArray","features","compareText"]}),H1.MAX_GLYPHS=65535,H1.addDynamicAttributes=wx;const Rv=new tg({"symbol-placement":new kp(td.layout_symbol["symbol-placement"]),"symbol-spacing":new kp(td.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kp(td.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Up(td.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kp(td.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kp(td.layout_symbol["icon-allow-overlap"]),"icon-overlap":new kp(td.layout_symbol["icon-overlap"]),"icon-ignore-placement":new kp(td.layout_symbol["icon-ignore-placement"]),"icon-optional":new kp(td.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kp(td.layout_symbol["icon-rotation-alignment"]),"icon-size":new Up(td.layout_symbol["icon-size"]),"icon-text-fit":new kp(td.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kp(td.layout_symbol["icon-text-fit-padding"]),"icon-image":new Up(td.layout_symbol["icon-image"]),"icon-rotate":new Up(td.layout_symbol["icon-rotate"]),"icon-padding":new Up(td.layout_symbol["icon-padding"]),"icon-keep-upright":new kp(td.layout_symbol["icon-keep-upright"]),"icon-offset":new Up(td.layout_symbol["icon-offset"]),"icon-anchor":new Up(td.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kp(td.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kp(td.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kp(td.layout_symbol["text-rotation-alignment"]),"text-field":new Up(td.layout_symbol["text-field"]),"text-font":new Up(td.layout_symbol["text-font"]),"text-size":new Up(td.layout_symbol["text-size"]),"text-max-width":new Up(td.layout_symbol["text-max-width"]),"text-line-height":new kp(td.layout_symbol["text-line-height"]),"text-letter-spacing":new Up(td.layout_symbol["text-letter-spacing"]),"text-justify":new Up(td.layout_symbol["text-justify"]),"text-radial-offset":new Up(td.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kp(td.layout_symbol["text-variable-anchor"]),"text-anchor":new Up(td.layout_symbol["text-anchor"]),"text-max-angle":new kp(td.layout_symbol["text-max-angle"]),"text-writing-mode":new kp(td.layout_symbol["text-writing-mode"]),"text-rotate":new Up(td.layout_symbol["text-rotate"]),"text-padding":new kp(td.layout_symbol["text-padding"]),"text-keep-upright":new kp(td.layout_symbol["text-keep-upright"]),"text-transform":new Up(td.layout_symbol["text-transform"]),"text-offset":new Up(td.layout_symbol["text-offset"]),"text-allow-overlap":new kp(td.layout_symbol["text-allow-overlap"]),"text-overlap":new kp(td.layout_symbol["text-overlap"]),"text-ignore-placement":new kp(td.layout_symbol["text-ignore-placement"]),"text-optional":new kp(td.layout_symbol["text-optional"])});var Ov={paint:new tg({"icon-opacity":new Up(td.paint_symbol["icon-opacity"]),"icon-color":new Up(td.paint_symbol["icon-color"]),"icon-halo-color":new Up(td.paint_symbol["icon-halo-color"]),"icon-halo-width":new Up(td.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Up(td.paint_symbol["icon-halo-blur"]),"icon-translate":new kp(td.paint_symbol["icon-translate"]),"icon-translate-anchor":new kp(td.paint_symbol["icon-translate-anchor"]),"text-opacity":new Up(td.paint_symbol["text-opacity"]),"text-color":new Up(td.paint_symbol["text-color"],{runtimeType:Zd,getOverride:_=>_.textColor,hasOverride:_=>!!_.textColor}),"text-halo-color":new Up(td.paint_symbol["text-halo-color"]),"text-halo-width":new Up(td.paint_symbol["text-halo-width"]),"text-halo-blur":new Up(td.paint_symbol["text-halo-blur"]),"text-translate":new kp(td.paint_symbol["text-translate"]),"text-translate-anchor":new kp(td.paint_symbol["text-translate-anchor"])}),layout:Rv};class Sx{constructor(f){if(f.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=f.property.overrides?f.property.overrides.runtimeType:fp,this.defaultValue=f}evaluate(f){if(f.formattedSection){const S=this.defaultValue.property.overrides;if(S&&S.hasOverride(f.formattedSection))return S.getOverride(f.formattedSection)}return f.feature&&f.featureState?this.defaultValue.evaluate(f.feature,f.featureState):this.defaultValue.property.specification.default}eachChild(f){this.defaultValue.isConstant()||f(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tp("FormatSectionOverride",Sx,{omit:["defaultValue"]});class w1 extends L_{constructor(f){super(f,Ov)}recalculate(f,S){if(super.recalculate(f,S),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const j=this.layout.get("text-writing-mode");if(j){const ut=[];for(const Ot of j)ut.indexOf(Ot)<0&&ut.push(Ot);this.layout._values["text-writing-mode"]=ut}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(f,S,j,ut){const Ot=this.layout.get(f).evaluate(S,{},j,ut),fi=this._unevaluatedLayout._values[f];return fi.isDataDriven()||q_(fi.value)||!Ot?Ot:function(Ur,us){return us.replace(/{([^{}]+)}/g,(ul,Ju)=>Ju in Ur?String(Ur[Ju]):"")}(S.properties,Ot)}createBucket(f){return new H1(f)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const f of Ov.paint.overridableProperties){if(!w1.hasPaintOverride(this.layout,f))continue;const S=this.paint.get(f),j=new Sx(S),ut=new Fy(j,S.property.specification);let Ot=null;Ot=S.value.kind==="constant"||S.value.kind==="source"?new c0("source",ut):new u0("composite",ut,S.value.zoomStops),this.paint._values[f]=new e_(S.property,Ot,S.parameters)}}_handleOverridablePaintPropertyUpdate(f,S,j){return!(!this.layout||S.isDataDriven()||j.isDataDriven())&&w1.hasPaintOverride(this.layout,f)}static hasPaintOverride(f,S){const j=f.get("text-field"),ut=Ov.paint.properties[S];let Ot=!1;const fi=Ur=>{for(const us of Ur)if(ut.overrides&&ut.overrides.hasOverride(us))return void(Ot=!0)};if(j.value.kind==="constant"&&j.value.value instanceof lm)fi(j.value.value.sections);else if(j.value.kind==="source"){const Ur=ul=>{Ot||(ul instanceof Xr&&Wu(ul.value)===If?fi(ul.value.sections):ul instanceof o0?fi(ul.sections):ul.eachChild(Ur))},us=j.value;us._styleExpression&&Ur(us._styleExpression.expression)}return Ot}}function Tx(_,f,S){let j="never";const ut=_.get(f);return ut?j=ut:_.get(S)&&(j="always"),j}var xw={paint:new tg({"background-color":new kp(td.paint_background["background-color"]),"background-pattern":new N0(td.paint_background["background-pattern"]),"background-opacity":new kp(td.paint_background["background-opacity"])})},l2={paint:new tg({"raster-opacity":new kp(td.paint_raster["raster-opacity"]),"raster-hue-rotate":new kp(td.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kp(td.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kp(td.paint_raster["raster-brightness-max"]),"raster-saturation":new kp(td.paint_raster["raster-saturation"]),"raster-contrast":new kp(td.paint_raster["raster-contrast"]),"raster-resampling":new kp(td.paint_raster["raster-resampling"]),"raster-fade-duration":new kp(td.paint_raster["raster-fade-duration"])})};class bw extends L_{constructor(f){super(f,{}),this.onAdd=S=>{this.implementation.onAdd&&this.implementation.onAdd(S,S.painter.context.gl)},this.onRemove=S=>{this.implementation.onRemove&&this.implementation.onRemove(S,S.painter.context.gl)},this.implementation=f}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const c2={circle:class extends L_{constructor(_){super(_,Bd)}createBucket(_){return new Oh(_)}queryRadius(_){const f=_;return Ud("circle-radius",this,f)+Ud("circle-stroke-width",this,f)+Lf(this.paint.get("circle-translate"))}queryIntersectsFeature(_,f,S,j,ut,Ot,fi,Ur){const us=Md(_,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Ot.angle,fi),ul=this.paint.get("circle-radius").evaluate(f,S)+this.paint.get("circle-stroke-width").evaluate(f,S),Ju=this.paint.get("circle-pitch-alignment")==="map",oh=Ju?us:function(vh,bh){return vh.map(Wh=>dm(Wh,bh))}(us,Ur),gh=Ju?ul*fi:ul;for(const vh of j)for(const bh of vh){const Wh=Ju?bh:dm(bh,Ur);let Zh=gh;const bd=Lp([],[bh.x,bh.y,0,1],Ur);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zh*=bd[3]/Ot.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zh*=Ot.cameraToCenterDistance/bd[3]),Nh(oh,Wh,Zh))return!0}return!1}},heatmap:class extends L_{createBucket(_){return new Fp(_)}constructor(_){super(_,km),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(_){_==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=My({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends L_{constructor(_){super(_,V0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends L_{constructor(_){super(_,Av)}recalculate(_,f){super.recalculate(_,f);const S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(_){return new cx(_)}queryRadius(){return Lf(this.paint.get("fill-translate"))}queryIntersectsFeature(_,f,S,j,ut,Ot,fi){return qh(Md(_,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Ot.angle,fi),j)}isTileClipped(){return!0}},"fill-extrusion":class extends L_{constructor(_){super(_,e2)}createBucket(_){return new Fx(_)}queryRadius(){return Lf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(_,f,S,j,ut,Ot,fi,Ur){const us=Md(_,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),Ot.angle,fi),ul=this.paint.get("fill-extrusion-height").evaluate(f,S),Ju=this.paint.get("fill-extrusion-base").evaluate(f,S),oh=function(vh,bh,Wh,Zh){const bd=[];for(const zd of vh){const dd=[zd.x,zd.y,0,1];Lp(dd,dd,bh),bd.push(new cd(dd[0]/dd[3],dd[1]/dd[3]))}return bd}(us,Ur),gh=function(vh,bh,Wh,Zh){const bd=[],zd=[],dd=Zh[8]*bh,Nd=Zh[9]*bh,$f=Zh[10]*bh,zf=Zh[11]*bh,Ap=Zh[8]*Wh,zp=Zh[9]*Wh,wp=Zh[10]*Wh,yp=Zh[11]*Wh;for(const cp of vh){const Ep=[],gp=[];for(const Qf of cp){const Gp=Qf.x,$p=Qf.y,ym=Zh[0]*Gp+Zh[4]*$p+Zh[12],ug=Zh[1]*Gp+Zh[5]*$p+Zh[13],_g=Zh[2]*Gp+Zh[6]*$p+Zh[14],zg=Zh[3]*Gp+Zh[7]*$p+Zh[15],i0=_g+$f,s_=zg+zf,yg=ym+Ap,i_=ug+zp,v_=_g+wp,O_=zg+yp,J_=new cd((ym+dd)/s_,(ug+Nd)/s_);J_.z=i0/s_,Ep.push(J_);const $g=new cd(yg/O_,i_/O_);$g.z=v_/O_,gp.push($g)}bd.push(Ep),zd.push(gp)}return[bd,zd]}(j,Ju,ul,Ur);return function(vh,bh,Wh){let Zh=1/0;qh(Wh,bh)&&(Zh=Og(Wh,bh[0]));for(let bd=0;bd<bh.length;bd++){const zd=bh[bd],dd=vh[bd];for(let Nd=0;Nd<zd.length-1;Nd++){const $f=zd[Nd],zf=[$f,zd[Nd+1],dd[Nd+1],dd[Nd],$f];Rh(Wh,zf)&&(Zh=Math.min(Zh,Og(Wh,zf)))}}return Zh!==1/0&&Zh}(gh[0],gh[1],oh)}},line:class extends L_{constructor(_){super(_,$1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(_){_==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Jp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(_,f){super.recalculate(_,f),this.paint._values["line-floorwidth"]=Jv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,_)}createBucket(_){return new fx(_)}queryRadius(_){const f=_,S=Vx(Ud("line-width",this,f),Ud("line-gap-width",this,f)),j=Ud("line-offset",this,f);return S/2+Math.abs(j)+Lf(this.paint.get("line-translate"))}queryIntersectsFeature(_,f,S,j,ut,Ot,fi){const Ur=Md(_,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),Ot.angle,fi),us=fi/2*Vx(this.paint.get("line-width").evaluate(f,S),this.paint.get("line-gap-width").evaluate(f,S)),ul=this.paint.get("line-offset").evaluate(f,S);return ul&&(j=function(Ju,oh){const gh=[];for(let vh=0;vh<Ju.length;vh++){const bh=Ju[vh],Wh=[];for(let Zh=0;Zh<bh.length;Zh++){const bd=bh[Zh-1],zd=bh[Zh],dd=bh[Zh+1],Nd=Zh===0?new cd(0,0):zd.sub(bd)._unit()._perp(),$f=Zh===bh.length-1?new cd(0,0):dd.sub(zd)._unit()._perp(),zf=Nd._add($f)._unit(),Ap=zf.x*$f.x+zf.y*$f.y;Ap!==0&&zf._mult(1/Ap),Wh.push(zf._mult(oh)._add(zd))}gh.push(Wh)}return gh}(j,ul*fi)),function(Ju,oh,gh){for(let vh=0;vh<oh.length;vh++){const bh=oh[vh];if(Ju.length>=3){for(let Wh=0;Wh<bh.length;Wh++)if(_d(Ju,bh[Wh]))return!0}if($h(Ju,bh,gh))return!0}return!1}(Ur,j,us)}isTileClipped(){return!0}},symbol:w1,background:class extends L_{constructor(_){super(_,xw)}},raster:class extends L_{constructor(_){super(_,l2)}}};class Ab{constructor(f){this._callback=f,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Pb=63710088e-1;class Tg{constructor(f,S){if(isNaN(f)||isNaN(S))throw new Error(`Invalid LngLat object: (${f}, ${S})`);if(this.lng=+f,this.lat=+S,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tg(_e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(f){const S=Math.PI/180,j=this.lat*S,ut=f.lat*S,Ot=Math.sin(j)*Math.sin(ut)+Math.cos(j)*Math.cos(ut)*Math.cos((f.lng-this.lng)*S);return Pb*Math.acos(Math.min(Ot,1))}toBounds(f=0){const S=360*f/40075017,j=S/Math.cos(Math.PI/180*this.lat);return new kb(new Tg(this.lng-j,this.lat-S),new Tg(this.lng+j,this.lat+S))}static convert(f){if(f instanceof Tg)return f;if(Array.isArray(f)&&(f.length===2||f.length===3))return new Tg(Number(f[0]),Number(f[1]));if(!Array.isArray(f)&&typeof f=="object"&&f!==null)return new Tg(Number("lng"in f?f.lng:f.lon),Number(f.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class E1{constructor(f,S){f&&(S?this.setSouthWest(f).setNorthEast(S):f.length===4?this.setSouthWest([f[0],f[1]]).setNorthEast([f[2],f[3]]):this.setSouthWest(f[0]).setNorthEast(f[1]))}setNorthEast(f){return this._ne=f instanceof Tg?new Tg(f.lng,f.lat):Tg.convert(f),this}setSouthWest(f){return this._sw=f instanceof Tg?new Tg(f.lng,f.lat):Tg.convert(f),this}extend(f){const S=this._sw,j=this._ne;let ut,Ot;if(f instanceof Tg)ut=f,Ot=f;else{if(!(f instanceof E1))return Array.isArray(f)?f.length===4||f.every(Array.isArray)?this.extend(E1.convert(f)):this.extend(Tg.convert(f)):this;if(ut=f._sw,Ot=f._ne,!ut||!Ot)return this}return S||j?(S.lng=Math.min(ut.lng,S.lng),S.lat=Math.min(ut.lat,S.lat),j.lng=Math.max(Ot.lng,j.lng),j.lat=Math.max(Ot.lat,j.lat)):(this._sw=new Tg(ut.lng,ut.lat),this._ne=new Tg(Ot.lng,Ot.lat)),this}getCenter(){return new Tg((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tg(this.getWest(),this.getNorth())}getSouthEast(){return new Tg(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(f){const{lng:S,lat:j}=Tg.convert(f);let ut=this._sw.lng<=S&&S<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ut=this._sw.lng>=S&&S>=this._ne.lng),this._sw.lat<=j&&j<=this._ne.lat&&ut}static convert(f){return f instanceof E1?f:f&&new E1(f)}}var kb=E1;const i1=2*Math.PI*Pb;function Db(_){return i1*Math.cos(_*Math.PI/180)}function ww(_){return(180+_)/360}function S1(_){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_*Math.PI/360)))/360}function Ix(_,f){return _/Db(f)}function Qx(_){return 360/Math.PI*Math.atan(Math.exp((180-360*_)*Math.PI/180))-90}class Mx{constructor(f,S,j=0){this.x=+f,this.y=+S,this.z=+j}static fromLngLat(f,S=0){const j=Tg.convert(f);return new Mx(ww(j.lng),S1(j.lat),Ix(S,j.lat))}toLngLat(){return new Tg(360*this.x-180,Qx(this.y))}toAltitude(){return this.z*Db(Qx(this.y))}meterInMercatorCoordinateUnits(){return 1/i1*(f=Qx(this.y),1/Math.cos(f*Math.PI/180));var f}}function Ew(_,f,S){var j=2*Math.PI*6378137/256/Math.pow(2,S);return[_*j-2*Math.PI*6378137/2,f*j-2*Math.PI*6378137/2]}class Lb{constructor(f,S,j){if(f<0||f>25||j<0||j>=Math.pow(2,f)||S<0||S>=Math.pow(2,f))throw new Error(`x=${S}, y=${j}, z=${f} outside of bounds. 0<=x<${Math.pow(2,f)}, 0<=y<${Math.pow(2,f)} 0<=z<=25 `);this.z=f,this.x=S,this.y=j,this.key=X1(0,f,f,S,j)}equals(f){return this.z===f.z&&this.x===f.x&&this.y===f.y}url(f,S,j){const ut=(fi=this.y,Ur=this.z,us=Ew(256*(Ot=this.x),256*(fi=Math.pow(2,Ur)-fi-1),Ur),ul=Ew(256*(Ot+1),256*(fi+1),Ur),us[0]+","+us[1]+","+ul[0]+","+ul[1]);var Ot,fi,Ur,us,ul;const Ju=function(oh,gh,vh){let bh,Wh="";for(let Zh=oh;Zh>0;Zh--)bh=1<<Zh-1,Wh+=(gh&bh?1:0)+(vh&bh?2:0);return Wh}(this.z,this.x,this.y);return f[(this.x+this.y)%f.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(j==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,S>1?"@2x":"").replace(/{quadkey}/g,Ju).replace(/{bbox-epsg-3857}/g,ut)}isChildOf(f){const S=this.z-f.z;return S>0&&f.x===this.x>>S&&f.y===this.y>>S}getTilePoint(f){const S=Math.pow(2,this.z);return new cd((f.x*S-this.x)*fh,(f.y*S-this.y)*fh)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rb{constructor(f,S){this.wrap=f,this.canonical=S,this.key=X1(f,S.z,S.z,S.x,S.y)}}class t0{constructor(f,S,j,ut,Ot){if(f<j)throw new Error(`overscaledZ should be >= z; overscaledZ = ${f}; z = ${j}`);this.overscaledZ=f,this.wrap=S,this.canonical=new Lb(j,+ut,+Ot),this.key=X1(S,f,j,ut,Ot)}clone(){return new t0(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(f){return this.overscaledZ===f.overscaledZ&&this.wrap===f.wrap&&this.canonical.equals(f.canonical)}scaledTo(f){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const S=this.canonical.z-f;return f>this.canonical.z?new t0(f,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new t0(f,this.wrap,f,this.canonical.x>>S,this.canonical.y>>S)}calculateScaledKey(f,S){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const j=this.canonical.z-f;return f>this.canonical.z?X1(this.wrap*+S,f,this.canonical.z,this.canonical.x,this.canonical.y):X1(this.wrap*+S,f,f,this.canonical.x>>j,this.canonical.y>>j)}isChildOf(f){if(f.wrap!==this.wrap)return!1;const S=this.canonical.z-f.canonical.z;return f.overscaledZ===0||f.overscaledZ<this.overscaledZ&&f.canonical.x===this.canonical.x>>S&&f.canonical.y===this.canonical.y>>S}children(f){if(this.overscaledZ>=f)return[new t0(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const S=this.canonical.z+1,j=2*this.canonical.x,ut=2*this.canonical.y;return[new t0(S,this.wrap,S,j,ut),new t0(S,this.wrap,S,j+1,ut),new t0(S,this.wrap,S,j,ut+1),new t0(S,this.wrap,S,j+1,ut+1)]}isLessThan(f){return this.wrap<f.wrap||!(this.wrap>f.wrap)&&(this.overscaledZ<f.overscaledZ||!(this.overscaledZ>f.overscaledZ)&&(this.canonical.x<f.canonical.x||!(this.canonical.x>f.canonical.x)&&this.canonical.y<f.canonical.y))}wrapped(){return new t0(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(f){return new t0(this.overscaledZ,f,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(f){return this.canonical.getTilePoint(new Mx(f.x-this.wrap,f.y))}}function X1(_,f,S,j,ut){(_*=2)<0&&(_=-1*_-1);const Ot=1<<S;return(Ot*Ot*_+Ot*ut+j).toString(36)+S.toString(36)+f.toString(36)}tp("CanonicalTileID",Lb),tp("OverscaledTileID",t0,{omit:["posMatrix"]});class Sw{constructor(f,S,j){if(this.uid=f,S.height!==S.width)throw new RangeError("DEM tiles must be square");if(j&&j!=="mapbox"&&j!=="terrarium")return void Js(`"${j}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=S.height;const ut=this.dim=S.height-2;this.data=new Uint32Array(S.data.buffer),this.encoding=j||"mapbox";for(let Ot=0;Ot<ut;Ot++)this.data[this._idx(-1,Ot)]=this.data[this._idx(0,Ot)],this.data[this._idx(ut,Ot)]=this.data[this._idx(ut-1,Ot)],this.data[this._idx(Ot,-1)]=this.data[this._idx(Ot,0)],this.data[this._idx(Ot,ut)]=this.data[this._idx(Ot,ut-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ut,-1)]=this.data[this._idx(ut-1,0)],this.data[this._idx(-1,ut)]=this.data[this._idx(0,ut-1)],this.data[this._idx(ut,ut)]=this.data[this._idx(ut-1,ut-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ot=0;Ot<ut;Ot++)for(let fi=0;fi<ut;fi++){const Ur=this.get(Ot,fi);Ur>this.max&&(this.max=Ur),Ur<this.min&&(this.min=Ur)}}get(f,S){const j=new Uint8Array(this.data.buffer),ut=4*this._idx(f,S);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(j[ut],j[ut+1],j[ut+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(f,S){if(f<-1||f>=this.dim+1||S<-1||S>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(S+1)*this.stride+(f+1)}_unpackMapbox(f,S,j){return(256*f*256+256*S+j)/10-1e4}_unpackTerrarium(f,S,j){return 256*f+S+j/256-32768}getPixels(){return new lg({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(f,S,j){if(this.dim!==f.dim)throw new Error("dem dimension mismatch");let ut=S*this.dim,Ot=S*this.dim+this.dim,fi=j*this.dim,Ur=j*this.dim+this.dim;switch(S){case-1:ut=Ot-1;break;case 1:Ot=ut+1}switch(j){case-1:fi=Ur-1;break;case 1:Ur=fi+1}const us=-S*this.dim,ul=-j*this.dim;for(let Ju=fi;Ju<Ur;Ju++)for(let oh=ut;oh<Ot;oh++)this.data[this._idx(oh,Ju)]=f.data[this._idx(oh+us,Ju+ul)]}}tp("DEMData",Sw);class Tw{constructor(f){this._stringToNumber={},this._numberToString=[];for(let S=0;S<f.length;S++){const j=f[S];this._stringToNumber[j]=S,this._numberToString[S]=j}}encode(f){return this._stringToNumber[f]}decode(f){if(f>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${f} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[f]}}class Ob{constructor(f,S,j,ut,Ot){this.type="Feature",this._vectorTileFeature=f,f._z=S,f._x=j,f._y=ut,this.properties=f.properties,this.id=Ot}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(f){this._geometry=f}toJSON(){const f={geometry:this.geometry};for(const S in this)S!=="_geometry"&&S!=="_vectorTileFeature"&&(f[S]=this[S]);return f}}class Bb{constructor(f,S){this.tileID=f,this.x=f.canonical.x,this.y=f.canonical.y,this.z=f.canonical.z,this.grid=new sg(fh,16,0),this.grid3D=new sg(fh,16,0),this.featureIndexArray=new Sy,this.promoteId=S}insert(f,S,j,ut,Ot,fi){const Ur=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(j,ut,Ot);const us=fi?this.grid3D:this.grid;for(let ul=0;ul<S.length;ul++){const Ju=S[ul],oh=[1/0,1/0,-1/0,-1/0];for(let gh=0;gh<Ju.length;gh++){const vh=Ju[gh];oh[0]=Math.min(oh[0],vh.x),oh[1]=Math.min(oh[1],vh.y),oh[2]=Math.max(oh[2],vh.x),oh[3]=Math.max(oh[3],vh.y)}oh[0]<fh&&oh[1]<fh&&oh[2]>=0&&oh[3]>=0&&us.insert(Ur,oh[0],oh[1],oh[2],oh[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wv.VectorTile(new q0(this.rawTileData)).layers,this.sourceLayerCoder=new Tw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(f,S,j,ut){this.loadVTLayers();const Ot=f.params||{},fi=fh/f.tileSize/f.scale,Ur=_y(Ot.filter),us=f.queryGeometry,ul=f.queryPadding*fi,Ju=Jx(us),oh=this.grid.query(Ju.minX-ul,Ju.minY-ul,Ju.maxX+ul,Ju.maxY+ul),gh=Jx(f.cameraQueryGeometry),vh=this.grid3D.query(gh.minX-ul,gh.minY-ul,gh.maxX+ul,gh.maxY+ul,(Zh,bd,zd,dd)=>function(Nd,$f,zf,Ap,zp){for(const yp of Nd)if($f<=yp.x&&zf<=yp.y&&Ap>=yp.x&&zp>=yp.y)return!0;const wp=[new cd($f,zf),new cd($f,zp),new cd(Ap,zp),new cd(Ap,zf)];if(Nd.length>2){for(const yp of wp)if(_d(Nd,yp))return!0}for(let yp=0;yp<Nd.length-1;yp++)if(Mf(Nd[yp],Nd[yp+1],wp))return!0;return!1}(f.cameraQueryGeometry,Zh-ul,bd-ul,zd+ul,dd+ul));for(const Zh of vh)oh.push(Zh);oh.sort(Bv);const bh={};let Wh;for(let Zh=0;Zh<oh.length;Zh++){const bd=oh[Zh];if(bd===Wh)continue;Wh=bd;const zd=this.featureIndexArray.get(bd);let dd=null;this.loadMatchingFeature(bh,zd.bucketIndex,zd.sourceLayerIndex,zd.featureIndex,Ur,Ot.layers,Ot.availableImages,S,j,ut,(Nd,$f,zf)=>(dd||(dd=Sh(Nd)),$f.queryIntersectsFeature(us,Nd,zf,dd,this.z,f.transform,fi,f.pixelPosMatrix)))}return bh}loadMatchingFeature(f,S,j,ut,Ot,fi,Ur,us,ul,Ju,oh){const gh=this.bucketLayerIDs[S];if(fi&&!function(Zh,bd){for(let zd=0;zd<Zh.length;zd++)if(bd.indexOf(Zh[zd])>=0)return!0;return!1}(fi,gh))return;const vh=this.sourceLayerCoder.decode(j),bh=this.vtLayers[vh].feature(ut);if(Ot.needGeometry){const Zh=Ih(bh,!0);if(!Ot.filter(new Mm(this.tileID.overscaledZ),Zh,this.tileID.canonical))return}else if(!Ot.filter(new Mm(this.tileID.overscaledZ),bh))return;const Wh=this.getId(bh,vh);for(let Zh=0;Zh<gh.length;Zh++){const bd=gh[Zh];if(fi&&fi.indexOf(bd)<0)continue;const zd=us[bd];if(!zd)continue;let dd={};Wh&&Ju&&(dd=Ju.getState(zd.sourceLayer||"_geojsonTileLayer",Wh));const Nd=Bt({},ul[bd]);Nd.paint=zb(Nd.paint,zd.paint,bh,dd,Ur),Nd.layout=zb(Nd.layout,zd.layout,bh,dd,Ur);const $f=!oh||oh(bh,zd,dd);if(!$f)continue;const zf=new Ob(bh,this.z,this.x,this.y,Wh);zf.layer=Nd;let Ap=f[bd];Ap===void 0&&(Ap=f[bd]=[]),Ap.push({featureIndex:ut,feature:zf,intersectionZ:$f})}}lookupSymbolFeatures(f,S,j,ut,Ot,fi,Ur,us){const ul={};this.loadVTLayers();const Ju=_y(Ot);for(const oh of f)this.loadMatchingFeature(ul,j,ut,oh,Ju,fi,Ur,us,S);return ul}hasLayer(f){for(const S of this.bucketLayerIDs)for(const j of S)if(f===j)return!0;return!1}getId(f,S){let j=f.id;return this.promoteId&&(j=f.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[S]],typeof j=="boolean"&&(j=Number(j))),j}}function zb(_,f,S,j,ut){return Io(_,(Ot,fi)=>{const Ur=f instanceof z0?f.get(fi):null;return Ur&&Ur.evaluate?Ur.evaluate(S,j,ut):Ur})}function Jx(_){let f=1/0,S=1/0,j=-1/0,ut=-1/0;for(const Ot of _)f=Math.min(f,Ot.x),S=Math.min(S,Ot.y),j=Math.max(j,Ot.x),ut=Math.max(ut,Ot.y);return{minX:f,minY:S,maxX:j,maxY:ut}}function Bv(_,f){return f-_}function Q_(_,f,S,j,ut,Ot){if(ut-j<=S)return;const fi=j+ut>>1;Iw(_,f,fi,j,ut,Ot%2),Q_(_,f,S,j,fi-1,Ot+1),Q_(_,f,S,fi+1,ut,Ot+1)}function Iw(_,f,S,j,ut,Ot){for(;ut>j;){if(ut-j>600){const ul=ut-j+1,Ju=S-j+1,oh=Math.log(ul),gh=.5*Math.exp(2*oh/3),vh=.5*Math.sqrt(oh*gh*(ul-gh)/ul)*(Ju-ul/2<0?-1:1);Iw(_,f,S,Math.max(j,Math.floor(S-Ju*gh/ul+vh)),Math.min(ut,Math.floor(S+(ul-Ju)*gh/ul+vh)),Ot)}const fi=f[2*S+Ot];let Ur=j,us=ut;for(T1(_,f,j,S),f[2*ut+Ot]>fi&&T1(_,f,j,ut);Ur<us;){for(T1(_,f,Ur,us),Ur++,us--;f[2*Ur+Ot]<fi;)Ur++;for(;f[2*us+Ot]>fi;)us--}f[2*j+Ot]===fi?T1(_,f,j,us):(us++,T1(_,f,us,ut)),us<=S&&(j=us+1),S<=us&&(ut=us-1)}}function T1(_,f,S,j){Nb(_,S,j),Nb(f,2*S,2*j),Nb(f,2*S+1,2*j+1)}function Nb(_,f,S){const j=_[f];_[f]=_[S],_[S]=j}function Mw(_,f,S,j){const ut=_-S,Ot=f-j;return ut*ut+Ot*Ot}tp("FeatureIndex",Bb,{omit:["rawTileData","sourceLayerCoder"]});const u2=_=>_[0],W1=_=>_[1];var Y1;o.PerformanceMarkers=void 0,(Y1=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",Y1.load="load",Y1.fullLoad="fullLoad";let Cx=null,W0=[];const I1=1e3/30,h2={mark(_){performance.mark(_)},frame(_){const f=_;Cx!=null&&W0.push(f-Cx),Cx=f},clearMetrics(){Cx=null,W0=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const _ in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[_])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const _=performance.getEntriesByName("loadTime")[0].duration,f=performance.getEntriesByName("fullLoadTime")[0].duration,S=W0.length,j=1/(W0.reduce((Ot,fi)=>Ot+fi,0)/S/1e3),ut=W0.filter(Ot=>Ot>I1).reduce((Ot,fi)=>Ot+(fi-I1)/I1,0);return{loadTime:_,fullLoadTime:f,fps:j,percentDroppedFrames:ut/(S+ut)*100}}};o.AJAXError=Af,o.ARRAY_TYPE=Bf,o.Actor=class{constructor(_,f,S){this.target=_,this.parent=f,this.mapId=S,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yr(["receive","process"],this),this.invoker=new Ab(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zu()?_:window}send(_,f,S,j,ut=!1){const Ot=Math.round(1e18*Math.random()).toString(36).substring(0,10);S&&(this.callbacks[Ot]=S);const fi=sl(this.globalScope)?void 0:[];return this.target.postMessage({id:Ot,type:_,hasCallback:!!S,targetMapId:j,mustQueue:ut,sourceMapId:this.mapId,data:Sg(f,fi)},fi),{cancel:()=>{S&&delete this.callbacks[Ot],this.target.postMessage({id:Ot,type:"<cancel>",targetMapId:j,sourceMapId:this.mapId})}}}receive(_){const f=_.data,S=f.id;if(S&&(!f.targetMapId||this.mapId===f.targetMapId))if(f.type==="<cancel>"){delete this.tasks[S];const j=this.cancelCallbacks[S];delete this.cancelCallbacks[S],j&&j()}else Zu()||f.mustQueue?(this.tasks[S]=f,this.taskQueue.push(S),this.invoker.trigger()):this.processTask(S,f)}process(){if(!this.taskQueue.length)return;const _=this.taskQueue.shift(),f=this.tasks[_];delete this.tasks[_],this.taskQueue.length&&this.invoker.trigger(),f&&this.processTask(_,f)}processTask(_,f){if(f.type==="<response>"){const S=this.callbacks[_];delete this.callbacks[_],S&&(f.error?S(fg(f.error)):S(null,fg(f.data)))}else{let S=!1;const j=sl(this.globalScope)?void 0:[],ut=f.hasCallback?(Ur,us)=>{S=!0,delete this.cancelCallbacks[_],this.target.postMessage({id:_,type:"<response>",sourceMapId:this.mapId,error:Ur?Sg(Ur):null,data:Sg(us,j)},j)}:Ur=>{S=!0};let Ot=null;const fi=fg(f.data);if(this.parent[f.type])Ot=this.parent[f.type](f.sourceMapId,fi,ut);else if(this.parent.getWorkerSource){const Ur=f.type.split(".");Ot=this.parent.getWorkerSource(f.sourceMapId,Ur[0],fi.source)[Ur[1]](fi,ut)}else ut(new Error(`Could not find function ${f.type}`));!S&&Ot&&Ot.cancel&&(this.cancelCallbacks[_]=Ot.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=gg,o.CanonicalTileID=Lb,o.CollisionBoxArray=Iv,o.CollisionCircleLayoutArray=class extends Tv{},o.Color=hp,o.DEMData=Sw,o.DataConstantProperty=kp,o.DictionaryCoder=Tw,o.EXTENT=fh,o.ErrorEvent=bf,o.EvaluationParameters=Mm,o.Event=Gd,o.Evented=Id,o.FeatureIndex=Bb,o.FillBucket=cx,o.FillExtrusionBucket=Fx,o.GeoJSONFeature=Ob,o.ImageAtlas=Zx,o.ImagePosition=_1,o.KDBush=class{constructor(_,f=u2,S=W1,j=64,ut=Float64Array){this.nodeSize=j,this.points=_;const Ot=_.length<65536?Uint16Array:Uint32Array,fi=this.ids=new Ot(_.length),Ur=this.coords=new ut(2*_.length);for(let us=0;us<_.length;us++)fi[us]=us,Ur[2*us]=f(_[us]),Ur[2*us+1]=S(_[us]);Q_(fi,Ur,j,0,fi.length-1,0)}range(_,f,S,j){return function(ut,Ot,fi,Ur,us,ul,Ju){const oh=[0,ut.length-1,0],gh=[];let vh,bh;for(;oh.length;){const Wh=oh.pop(),Zh=oh.pop(),bd=oh.pop();if(Zh-bd<=Ju){for(let Nd=bd;Nd<=Zh;Nd++)vh=Ot[2*Nd],bh=Ot[2*Nd+1],vh>=fi&&vh<=us&&bh>=Ur&&bh<=ul&&gh.push(ut[Nd]);continue}const zd=Math.floor((bd+Zh)/2);vh=Ot[2*zd],bh=Ot[2*zd+1],vh>=fi&&vh<=us&&bh>=Ur&&bh<=ul&&gh.push(ut[zd]);const dd=(Wh+1)%2;(Wh===0?fi<=vh:Ur<=bh)&&(oh.push(bd),oh.push(zd-1),oh.push(dd)),(Wh===0?us>=vh:ul>=bh)&&(oh.push(zd+1),oh.push(Zh),oh.push(dd))}return gh}(this.ids,this.coords,_,f,S,j,this.nodeSize)}within(_,f,S){return function(j,ut,Ot,fi,Ur,us){const ul=[0,j.length-1,0],Ju=[],oh=Ur*Ur;for(;ul.length;){const gh=ul.pop(),vh=ul.pop(),bh=ul.pop();if(vh-bh<=us){for(let dd=bh;dd<=vh;dd++)Mw(ut[2*dd],ut[2*dd+1],Ot,fi)<=oh&&Ju.push(j[dd]);continue}const Wh=Math.floor((bh+vh)/2),Zh=ut[2*Wh],bd=ut[2*Wh+1];Mw(Zh,bd,Ot,fi)<=oh&&Ju.push(j[Wh]);const zd=(gh+1)%2;(gh===0?Ot-Ur<=Zh:fi-Ur<=bd)&&(ul.push(bh),ul.push(Wh-1),ul.push(zd)),(gh===0?Ot+Ur>=Zh:fi+Ur>=bd)&&(ul.push(Wh+1),ul.push(vh),ul.push(zd))}return Ju}(this.ids,this.coords,_,f,S,this.nodeSize)}},o.LineBucket=fx,o.LineStripIndexArray=class extends S0{},o.LngLat=Tg,o.LngLatBounds=kb,o.MercatorCoordinate=Mx,o.ONE_EM=Bg,o.OverscaledTileID=t0,o.PerformanceUtils=h2,o.Pos3dArray=class extends x0{},o.PosArray=qv,o.Properties=tg,o.QuadTriangleArray=class extends $0{},o.RGBAImage=lg,o.RasterBoundsArray=class extends wy{},o.RequestPerformance=class{constructor(_){this._marks={start:[_.url,"start"].join("#"),end:[_.url,"end"].join("#"),measure:_.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let _=performance.getEntriesByName(this._marks.measure);return _.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),_=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),_}},o.SegmentVector=ol,o.SymbolBucket=H1,o.Transitionable=Hy,o.TriangleIndexArray=Ft,o.Uniform1f=Cf,o.Uniform1i=class extends Wd{constructor(_,f){super(_,f),this.current=0}set(_){this.current!==_&&(this.current=_,this.gl.uniform1i(this.location,_))}},o.Uniform2f=class extends Wd{constructor(_,f){super(_,f),this.current=[0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]||(this.current=_,this.gl.uniform2f(this.location,_[0],_[1]))}},o.Uniform3f=class extends Wd{constructor(_,f){super(_,f),this.current=[0,0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]||(this.current=_,this.gl.uniform3f(this.location,_[0],_[1],_[2]))}},o.Uniform4f=Of,o.UniformColor=L,o.UniformMatrix4f=class extends Wd{constructor(_,f){super(_,f),this.current=u}set(_){if(_[12]!==this.current[12]||_[0]!==this.current[0])return this.current=_,void this.gl.uniformMatrix4fv(this.location,!1,_);for(let f=1;f<16;f++)if(_[f]!==this.current[f]){this.current=_,this.gl.uniformMatrix4fv(this.location,!1,_);break}}},o.UnwrappedTileID=Rb,o.ValidationError=$d,o.ZoomHistory=A_,o.addDynamicAttributes=wx,o.arrayBufferToImage=function(_,f){const S=new Image;S.onload=()=>{f(null,S),URL.revokeObjectURL(S.src),S.onload=null,window.requestAnimationFrame(()=>{S.src=xh})},S.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(_)],{type:"image/png"});S.src=_.byteLength?URL.createObjectURL(j):xh},o.arrayBufferToImageBitmap=function(_,f){const S=new Blob([new Uint8Array(_)],{type:"image/png"});createImageBitmap(S).then(j=>{f(null,j)}).catch(j=>{f(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(_,f,S){if(!_.length)return S(null,[]);let j=_.length;const ut=new Array(_.length);let Ot=null;_.forEach((fi,Ur)=>{f(fi,(us,ul)=>{us&&(Ot=us),ut[Ur]=ul,--j==0&&S(Ot,ut)})})},o.bezier=P,o.bindAll=yr,o.clamp=nt,o.clipLine=Wx,o.clone=function(_){var f=new Bf(16);return f[0]=_[0],f[1]=_[1],f[2]=_[2],f[3]=_[3],f[4]=_[4],f[5]=_[5],f[6]=_[6],f[7]=_[7],f[8]=_[8],f[9]=_[9],f[10]=_[10],f[11]=_[11],f[12]=_[12],f[13]=_[13],f[14]=_[14],f[15]=_[15],f},o.clone$1=Co,o.collisionCircleLayout=yb,o.config=yf,o.copy=function(_,f){return _[0]=f[0],_[1]=f[1],_[2]=f[2],_[3]=f[3],_[4]=f[4],_[5]=f[5],_[6]=f[6],_[7]=f[7],_[8]=f[8],_[9]=f[9],_[10]=f[10],_[11]=f[11],_[12]=f[12],_[13]=f[13],_[14]=f[14],_[15]=f[15],_},o.create=function(){var _=new Bf(16);return Bf!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},o.createExpression=d_,o.createFilter=_y,o.createLayout=mg,o.createStyleLayer=function(_){return _.type==="custom"?new bw(_):new c2[_.type](_)},o.dot=function(_,f){return _[0]*f[0]+_[1]*f[1]+_[2]*f[2]+_[3]*f[3]},o.earthRadius=Pb,o.ease=he,o.emitValidationErrors=og,o.equals=function(_,f){var S=_[0],j=_[1],ut=_[2],Ot=_[3],fi=_[4],Ur=_[5],us=_[6],ul=_[7],Ju=_[8],oh=_[9],gh=_[10],vh=_[11],bh=_[12],Wh=_[13],Zh=_[14],bd=_[15],zd=f[0],dd=f[1],Nd=f[2],$f=f[3],zf=f[4],Ap=f[5],zp=f[6],wp=f[7],yp=f[8],cp=f[9],Ep=f[10],gp=f[11],Qf=f[12],Gp=f[13],$p=f[14],ym=f[15];return Math.abs(S-zd)<=mf*Math.max(1,Math.abs(S),Math.abs(zd))&&Math.abs(j-dd)<=mf*Math.max(1,Math.abs(j),Math.abs(dd))&&Math.abs(ut-Nd)<=mf*Math.max(1,Math.abs(ut),Math.abs(Nd))&&Math.abs(Ot-$f)<=mf*Math.max(1,Math.abs(Ot),Math.abs($f))&&Math.abs(fi-zf)<=mf*Math.max(1,Math.abs(fi),Math.abs(zf))&&Math.abs(Ur-Ap)<=mf*Math.max(1,Math.abs(Ur),Math.abs(Ap))&&Math.abs(us-zp)<=mf*Math.max(1,Math.abs(us),Math.abs(zp))&&Math.abs(ul-wp)<=mf*Math.max(1,Math.abs(ul),Math.abs(wp))&&Math.abs(Ju-yp)<=mf*Math.max(1,Math.abs(Ju),Math.abs(yp))&&Math.abs(oh-cp)<=mf*Math.max(1,Math.abs(oh),Math.abs(cp))&&Math.abs(gh-Ep)<=mf*Math.max(1,Math.abs(gh),Math.abs(Ep))&&Math.abs(vh-gp)<=mf*Math.max(1,Math.abs(vh),Math.abs(gp))&&Math.abs(bh-Qf)<=mf*Math.max(1,Math.abs(bh),Math.abs(Qf))&&Math.abs(Wh-Gp)<=mf*Math.max(1,Math.abs(Wh),Math.abs(Gp))&&Math.abs(Zh-$p)<=mf*Math.max(1,Math.abs(Zh),Math.abs($p))&&Math.abs(bd-ym)<=mf*Math.max(1,Math.abs(bd),Math.abs(ym))},o.evaluateSizeForFeature=function(_,{uSize:f,uSizeT:S},{lowerSize:j,upperSize:ut}){return _.kind==="source"?j/mv:_.kind==="composite"?mm(j/mv,ut/mv,S):f},o.evaluateSizeForZoom=function(_,f){let S=0,j=0;if(_.kind==="constant")j=_.layoutSize;else if(_.kind!=="source"){const{interpolationType:ut,minZoom:Ot,maxZoom:fi}=_,Ur=ut?nt(Np.interpolationFactor(ut,f,Ot,fi),0,1):0;_.kind==="camera"?j=mm(_.minSize,_.maxSize,Ur):S=Ur}return{uSizeT:S,uSize:j}},o.evaluateVariableOffset=X0,o.evented=em,o.exported=Uh,o.extend=Bt,o.filterObject=rl,o.fromScaling=function(_,f){return _[0]=f[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=f[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=f[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},o.getAnchorAlignment=yx,o.getAnchorJustification=Jy,o.getArrayBuffer=Ed,o.getJSON=function(_,f){return qd(Bt(_,{type:"json"}),f)},o.getOverlapMode=Tx,o.getRTLTextPluginStatus=Gg,o.getReferrer=md,o.getVideo=function(_,f){const S=window.document.createElement("video");S.muted=!0,S.onloadstart=function(){f(null,S)};for(let j=0;j<_.length;j++){const ut=window.document.createElement("source");Td(_[j])||(S.crossOrigin="Anonymous"),ut.src=_[j],S.appendChild(ut)}return{cancel:()=>{}}},o.identity=Dp,o.invert=function(_,f){var S=f[0],j=f[1],ut=f[2],Ot=f[3],fi=f[4],Ur=f[5],us=f[6],ul=f[7],Ju=f[8],oh=f[9],gh=f[10],vh=f[11],bh=f[12],Wh=f[13],Zh=f[14],bd=f[15],zd=S*Ur-j*fi,dd=S*us-ut*fi,Nd=S*ul-Ot*fi,$f=j*us-ut*Ur,zf=j*ul-Ot*Ur,Ap=ut*ul-Ot*us,zp=Ju*Wh-oh*bh,wp=Ju*Zh-gh*bh,yp=Ju*bd-vh*bh,cp=oh*Zh-gh*Wh,Ep=oh*bd-vh*Wh,gp=gh*bd-vh*Zh,Qf=zd*gp-dd*Ep+Nd*cp+$f*yp-zf*wp+Ap*zp;return Qf?(_[0]=(Ur*gp-us*Ep+ul*cp)*(Qf=1/Qf),_[1]=(ut*Ep-j*gp-Ot*cp)*Qf,_[2]=(Wh*Ap-Zh*zf+bd*$f)*Qf,_[3]=(gh*zf-oh*Ap-vh*$f)*Qf,_[4]=(us*yp-fi*gp-ul*wp)*Qf,_[5]=(S*gp-ut*yp+Ot*wp)*Qf,_[6]=(Zh*Nd-bh*Ap-bd*dd)*Qf,_[7]=(Ju*Ap-gh*Nd+vh*dd)*Qf,_[8]=(fi*Ep-Ur*yp+ul*zp)*Qf,_[9]=(j*yp-S*Ep-Ot*zp)*Qf,_[10]=(bh*zf-Wh*Nd+bd*zd)*Qf,_[11]=(oh*Nd-Ju*zf-vh*zd)*Qf,_[12]=(Ur*wp-fi*cp-us*zp)*Qf,_[13]=(S*cp-j*wp+ut*zp)*Qf,_[14]=(Wh*dd-bh*$f-Zh*zd)*Qf,_[15]=(Ju*$f-oh*dd+gh*zd)*Qf,_):null},o.isImageBitmap=sh,o.isSafari=sl,o.isWorker=Zu,o.keysDifference=function(_,f){const S=[];for(const j in _)j in f||S.push(j);return S},o.lazyLoadRTLTextPlugin=function(){Ig.isLoading()||Ig.isLoaded()||Gg()!=="deferred"||bv()},o.makeRequest=qd,o.mapObject=Io,o.mercatorXfromLng=ww,o.mercatorYfromLat=S1,o.mercatorZfromAltitude=Ix,o.mul=xp,o.mul$1=function(_,f,S){return _[0]=f[0]*S[0],_[1]=f[1]*S[1],_[2]=f[2]*S[2],_[3]=f[3]*S[3],_},o.multiply=rm,o.nextPowerOfTwo=function(_){return _<=1?1:Math.pow(2,Math.ceil(Math.log(_)/Math.LN2))},o.number=mm,o.ortho=function(_,f,S,j,ut,Ot,fi){var Ur=1/(f-S),us=1/(j-ut),ul=1/(Ot-fi);return _[0]=-2*Ur,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*us,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*ul,_[11]=0,_[12]=(f+S)*Ur,_[13]=(ut+j)*us,_[14]=(fi+Ot)*ul,_[15]=1,_},o.parseCacheControl=function(_){const f={};if(_.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(S,j,ut,Ot)=>{const fi=ut||Ot;return f[j]=!fi||fi.toLowerCase(),""}),f["max-age"]){const S=parseInt(f["max-age"],10);isNaN(S)?delete f["max-age"]:f["max-age"]=S}return f},o.parseGlyphPbf=function(_){return new q0(_).readFields(n2,[])},o.pbf=q0,o.performSymbolLayout=function(_){_.bucket.createArrays(),_.bucket.tilePixelRatio=fh/(512*_.bucket.overscaling),_.bucket.compareText={},_.bucket.iconsNeedLinear=!1;const f=_.bucket.layers[0].layout,S=_.bucket.layers[0]._unevaluatedLayout._values,j={layoutIconSize:S["icon-size"].possiblyEvaluate(new Mm(_.bucket.zoom+1),_.canonical),layoutTextSize:S["text-size"].possiblyEvaluate(new Mm(_.bucket.zoom+1),_.canonical),textMaxSize:S["text-size"].possiblyEvaluate(new Mm(18))};if(_.bucket.textSizeData.kind==="composite"){const{minZoom:us,maxZoom:ul}=_.bucket.textSizeData;j.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Mm(us),_.canonical),S["text-size"].possiblyEvaluate(new Mm(ul),_.canonical)]}if(_.bucket.iconSizeData.kind==="composite"){const{minZoom:us,maxZoom:ul}=_.bucket.iconSizeData;j.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Mm(us),_.canonical),S["icon-size"].possiblyEvaluate(new Mm(ul),_.canonical)]}const ut=f.get("text-line-height")*Bg,Ot=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",fi=f.get("text-keep-upright"),Ur=f.get("text-size");for(const us of _.bucket.features){const ul=f.get("text-font").evaluate(us,{},_.canonical).join(","),Ju=Ur.evaluate(us,{},_.canonical),oh=j.layoutTextSize.evaluate(us,{},_.canonical),gh=j.layoutIconSize.evaluate(us,{},_.canonical),vh={horizontal:{},vertical:void 0},bh=us.text;let Wh,Zh=[0,0];if(bh){const dd=bh.toString(),Nd=f.get("text-letter-spacing").evaluate(us,{},_.canonical)*Bg,$f=vy(dd)?Nd:0,zf=f.get("text-anchor").evaluate(us,{},_.canonical),Ap=f.get("text-variable-anchor");if(!Ap){const Ep=f.get("text-radial-offset").evaluate(us,{},_.canonical);Zh=Ep?X0(zf,[Ep*Bg,P0]):f.get("text-offset").evaluate(us,{},_.canonical).map(gp=>gp*Bg)}let zp=Ot?"center":f.get("text-justify").evaluate(us,{},_.canonical);const wp=f.get("symbol-placement"),yp=wp==="point"?f.get("text-max-width").evaluate(us,{},_.canonical)*Bg:0,cp=()=>{_.bucket.allowVerticalPlacement&&Zy(dd)&&(vh.vertical=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,zf,"left",$f,Zh,o.WritingMode.vertical,!0,wp,oh,Ju))};if(!Ot&&Ap){const Ep=zp==="auto"?Ap.map(Qf=>Jy(Qf)):[zp];let gp=!1;for(let Qf=0;Qf<Ep.length;Qf++){const Gp=Ep[Qf];if(!vh.horizontal[Gp])if(gp)vh.horizontal[Gp]=vh.horizontal[0];else{const $p=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,"center",Gp,$f,Zh,o.WritingMode.horizontal,!1,wp,oh,Ju);$p&&(vh.horizontal[Gp]=$p,gp=$p.positionedLines.length===1)}}cp()}else{zp==="auto"&&(zp=Jy(zf));const Ep=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,zf,zp,$f,Zh,o.WritingMode.horizontal,!1,wp,oh,Ju);Ep&&(vh.horizontal[zp]=Ep),cp(),Zy(dd)&&Ot&&fi&&(vh.vertical=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,zf,zp,$f,Zh,o.WritingMode.vertical,!1,wp,oh,Ju))}}let bd=!1;if(us.icon&&us.icon.name){const dd=_.imageMap[us.icon.name];dd&&(Wh=v1(_.imagePositions[us.icon.name],f.get("icon-offset").evaluate(us,{},_.canonical),f.get("icon-anchor").evaluate(us,{},_.canonical)),bd=!!dd.sdf,_.bucket.sdfIcons===void 0?_.bucket.sdfIcons=bd:_.bucket.sdfIcons!==bd&&Js("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dd.pixelRatio!==_.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(_.bucket.iconsNeedLinear=!0))}const zd=o_(vh.horizontal)||vh.vertical;_.bucket.iconsInText=!!zd&&zd.iconsInText,(zd||Wh)&&e0(_.bucket,us,vh,Wh,_.imageMap,j,oh,gh,Zh,bd,_.canonical)}_.showCollisionBoxes&&_.bucket.generateCollisionDebugBuffers()},o.perspective=function(_,f,S,j,ut){var Ot,fi=1/Math.tan(f/2);return _[0]=fi/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=fi,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,ut!=null&&ut!==1/0?(_[10]=(ut+j)*(Ot=1/(j-ut)),_[14]=2*ut*j*Ot):(_[10]=-1,_[14]=-2*j),_},o.pick=function(_,f){const S={};for(let j=0;j<f.length;j++){const ut=f[j];ut in _&&(S[ut]=_[ut])}return S},o.plugin=Ig,o.pointGeometry=cd,o.polygonIntersectsPolygon=Rh,o.potpack=bb,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=tp,o.registerForPluginStateChange=function(_){return _({pluginStatus:Gm,pluginURL:ag}),em.on("pluginStateChange",_),_},o.renderColorRamp=My,o.rotateX=function(_,f,S){var j=Math.sin(S),ut=Math.cos(S),Ot=f[4],fi=f[5],Ur=f[6],us=f[7],ul=f[8],Ju=f[9],oh=f[10],gh=f[11];return f!==_&&(_[0]=f[0],_[1]=f[1],_[2]=f[2],_[3]=f[3],_[12]=f[12],_[13]=f[13],_[14]=f[14],_[15]=f[15]),_[4]=Ot*ut+ul*j,_[5]=fi*ut+Ju*j,_[6]=Ur*ut+oh*j,_[7]=us*ut+gh*j,_[8]=ul*ut-Ot*j,_[9]=Ju*ut-fi*j,_[10]=oh*ut-Ur*j,_[11]=gh*ut-us*j,_},o.rotateZ=function(_,f,S){var j=Math.sin(S),ut=Math.cos(S),Ot=f[0],fi=f[1],Ur=f[2],us=f[3],ul=f[4],Ju=f[5],oh=f[6],gh=f[7];return f!==_&&(_[8]=f[8],_[9]=f[9],_[10]=f[10],_[11]=f[11],_[12]=f[12],_[13]=f[13],_[14]=f[14],_[15]=f[15]),_[0]=Ot*ut+ul*j,_[1]=fi*ut+Ju*j,_[2]=Ur*ut+oh*j,_[3]=us*ut+gh*j,_[4]=ul*ut-Ot*j,_[5]=Ju*ut-fi*j,_[6]=oh*ut-Ur*j,_[7]=gh*ut-us*j,_},o.scale=function(_,f,S){var j=S[0],ut=S[1],Ot=S[2];return _[0]=f[0]*j,_[1]=f[1]*j,_[2]=f[2]*j,_[3]=f[3]*j,_[4]=f[4]*ut,_[5]=f[5]*ut,_[6]=f[6]*ut,_[7]=f[7]*ut,_[8]=f[8]*Ot,_[9]=f[9]*Ot,_[10]=f[10]*Ot,_[11]=f[11]*Ot,_[12]=f[12],_[13]=f[13],_[14]=f[14],_[15]=f[15],_},o.setRTLTextPlugin=function(_,f,S=!1){if(Gm===P_||Gm===Ng||Gm===W_)throw new Error("setRTLTextPlugin cannot be called multiple times.");ag=Uh.resolveURL(_),Gm=P_,Dg=f,k_(),S||bv()},o.spec=td,o.sphericalToCartesian=function([_,f,S]){return f+=90,f*=Math.PI/180,S*=Math.PI/180,{x:_*Math.cos(f)*Math.sin(S),y:_*Math.sin(f)*Math.sin(S),z:_*Math.cos(S)}},o.toEvaluationFeature=Ih,o.transformMat4=Lp,o.translate=function(_,f,S){var j,ut,Ot,fi,Ur,us,ul,Ju,oh,gh,vh,bh,Wh=S[0],Zh=S[1],bd=S[2];return f===_?(_[12]=f[0]*Wh+f[4]*Zh+f[8]*bd+f[12],_[13]=f[1]*Wh+f[5]*Zh+f[9]*bd+f[13],_[14]=f[2]*Wh+f[6]*Zh+f[10]*bd+f[14],_[15]=f[3]*Wh+f[7]*Zh+f[11]*bd+f[15]):(ut=f[1],Ot=f[2],fi=f[3],Ur=f[4],us=f[5],ul=f[6],Ju=f[7],oh=f[8],gh=f[9],vh=f[10],bh=f[11],_[0]=j=f[0],_[1]=ut,_[2]=Ot,_[3]=fi,_[4]=Ur,_[5]=us,_[6]=ul,_[7]=Ju,_[8]=oh,_[9]=gh,_[10]=vh,_[11]=bh,_[12]=j*Wh+Ur*Zh+oh*bd+f[12],_[13]=ut*Wh+us*Zh+gh*bd+f[13],_[14]=Ot*Wh+ul*Zh+vh*bd+f[14],_[15]=fi*Wh+Ju*Zh+bh*bd+f[15]),_},o.triggerPluginCompletionEvent=Jg,o.unicodeBlockLookup=ap,o.uniqueId=function(){return Fn++},o.validateCustomStyleLayer=function(_){const f=[],S=_.id;return S===void 0&&f.push({message:`layers.${S}: missing required property "id"`}),_.render===void 0&&f.push({message:`layers.${S}: missing required method "render"`}),_.renderingMode&&_.renderingMode!=="2d"&&_.renderingMode!=="3d"&&f.push({message:`layers.${S}: property "renderingMode" must be either "2d" or "3d"`}),f},o.validateLight=Nm,o.validateStyle=Bp,o.vectorTile=Wv,o.warnOnce=Js,o.wrap=_e}),l(["./shared"],function(o){function x(Wu){const al=typeof Wu;if(al==="number"||al==="boolean"||al==="string"||Wu==null)return JSON.stringify(Wu);if(Array.isArray(Wu)){let cs="[";for(const $u of Wu)cs+=`${x($u)},`;return`${cs}]`}const Xr=Object.keys(Wu).sort();let mr="{";for(let cs=0;cs<Xr.length;cs++)mr+=`${JSON.stringify(Xr[cs])}:${x(Wu[Xr[cs]])},`;return`${mr}}`}function M(Wu){let al="";for(const Xr of o.refProperties)al+=`/${x(Wu[Xr])}`;return al}class P{constructor(al){this.keyCache={},al&&this.replace(al)}replace(al){this._layerConfigs={},this._layers={},this.update(al,[])}update(al,Xr){for(const cs of al){this._layerConfigs[cs.id]=cs;const $u=this._layers[cs.id]=o.createStyleLayer(cs);$u._featureFilter=o.createFilter($u.filter),this.keyCache[cs.id]&&delete this.keyCache[cs.id]}for(const cs of Xr)delete this.keyCache[cs],delete this._layerConfigs[cs],delete this._layers[cs];this.familiesBySource={};const mr=function(cs,$u){const eh={};for(let uh=0;uh<cs.length;uh++){const dh=$u&&$u[cs[uh].id]||M(cs[uh]);$u&&($u[cs[uh].id]=dh);let yh=eh[dh];yh||(yh=eh[dh]=[]),yh.push(cs[uh])}const rh=[];for(const uh in eh)rh.push(eh[uh]);return rh}(Object.values(this._layerConfigs),this.keyCache);for(const cs of mr){const $u=cs.map(Ph=>this._layers[Ph.id]),eh=$u[0];if(eh.visibility==="none")continue;const rh=eh.source||"";let uh=this.familiesBySource[rh];uh||(uh=this.familiesBySource[rh]={});const dh=eh.sourceLayer||"_geojsonTileLayer";let yh=uh[dh];yh||(yh=uh[dh]=[]),yh.push($u)}}}class he{constructor(al){const Xr={},mr=[];for(const rh in al){const uh=al[rh],dh=Xr[rh]={};for(const yh in uh){const Ph=uh[+yh];if(!Ph||Ph.bitmap.width===0||Ph.bitmap.height===0)continue;const Fh={x:0,y:0,w:Ph.bitmap.width+2,h:Ph.bitmap.height+2};mr.push(Fh),dh[yh]={rect:Fh,metrics:Ph.metrics}}}const{w:cs,h:$u}=o.potpack(mr),eh=new o.AlphaImage({width:cs||1,height:$u||1});for(const rh in al){const uh=al[rh];for(const dh in uh){const yh=uh[+dh];if(!yh||yh.bitmap.width===0||yh.bitmap.height===0)continue;const Ph=Xr[rh][dh].rect;o.AlphaImage.copy(yh.bitmap,eh,{x:0,y:0},{x:Ph.x+1,y:Ph.y+1},yh.bitmap)}}this.image=eh,this.positions=Xr}}o.register("GlyphAtlas",he);class nt{constructor(al){this.tileID=new o.OverscaledTileID(al.tileID.overscaledZ,al.tileID.wrap,al.tileID.canonical.z,al.tileID.canonical.x,al.tileID.canonical.y),this.uid=al.uid,this.zoom=al.zoom,this.pixelRatio=al.pixelRatio,this.tileSize=al.tileSize,this.source=al.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=al.showCollisionBoxes,this.collectResourceTiming=!!al.collectResourceTiming,this.returnDependencies=!!al.returnDependencies,this.promoteId=al.promoteId}parse(al,Xr,mr,cs,$u){this.status="parsing",this.data=al,this.collisionBoxArray=new o.CollisionBoxArray;const eh=new o.DictionaryCoder(Object.keys(al.layers).sort()),rh=new o.FeatureIndex(this.tileID,this.promoteId);rh.bucketLayerIDs=[];const uh={},dh={featureIndex:rh,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:mr},yh=Xr.familiesBySource[this.source];for(const Ah in yh){const Jd=al.layers[Ah];if(!Jd)continue;Jd.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${Ah}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Od=eh.encode(Ah),qf=[];for(let mp=0;mp<Jd.length;mp++){const Vp=Jd.feature(mp),om=rh.getId(Vp,Ah);qf.push({feature:Vp,id:om,index:mp,sourceLayerIndex:Od})}for(const mp of yh[Ah]){const Vp=mp[0];Vp.source!==this.source&&o.warnOnce(`layer.source = ${Vp.source} does not equal this.source = ${this.source}`),Vp.minzoom&&this.zoom<Math.floor(Vp.minzoom)||Vp.maxzoom&&this.zoom>=Vp.maxzoom||Vp.visibility!=="none"&&(_e(mp,this.zoom,mr),(uh[Vp.id]=Vp.createBucket({index:rh.bucketLayerIDs.length,layers:mp,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Od,sourceID:this.source})).populate(qf,dh,this.tileID.canonical),rh.bucketLayerIDs.push(mp.map(om=>om.id)))}}let Ph,Fh,Ad,wd;const Kd=o.mapObject(dh.glyphDependencies,Ah=>Object.keys(Ah).map(Number));Object.keys(Kd).length?cs.send("getGlyphs",{uid:this.uid,stacks:Kd,source:this.source,tileID:this.tileID,type:"glyphs"},(Ah,Jd)=>{Ph||(Ph=Ah,Fh=Jd,rp.call(this))}):Fh={};const xf=Object.keys(dh.iconDependencies);xf.length?cs.send("getImages",{icons:xf,source:this.source,tileID:this.tileID,type:"icons"},(Ah,Jd)=>{Ph||(Ph=Ah,Ad=Jd,rp.call(this))}):Ad={};const Ff=Object.keys(dh.patternDependencies);function rp(){if(Ph)return $u(Ph);if(Fh&&Ad&&wd){const Ah=new he(Fh),Jd=new o.ImageAtlas(Ad,wd);for(const Od in uh){const qf=uh[Od];qf instanceof o.SymbolBucket?(_e(qf.layers,this.zoom,mr),o.performSymbolLayout({bucket:qf,glyphMap:Fh,glyphPositions:Ah.positions,imageMap:Ad,imagePositions:Jd.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):qf.hasPattern&&(qf instanceof o.LineBucket||qf instanceof o.FillBucket||qf instanceof o.FillExtrusionBucket)&&(_e(qf.layers,this.zoom,mr),qf.addFeatures(dh,this.tileID.canonical,Jd.patternPositions))}this.status="done",$u(null,{buckets:Object.values(uh).filter(Od=>!Od.isEmpty()),featureIndex:rh,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ah.image,imageAtlas:Jd,glyphMap:this.returnDependencies?Fh:null,iconMap:this.returnDependencies?Ad:null,glyphPositions:this.returnDependencies?Ah.positions:null})}}Ff.length?cs.send("getImages",{icons:Ff,source:this.source,tileID:this.tileID,type:"patterns"},(Ah,Jd)=>{Ph||(Ph=Ah,wd=Jd,rp.call(this))}):wd={},rp.call(this)}}function _e(Wu,al,Xr){const mr=new o.EvaluationParameters(al);for(const cs of Wu)cs.recalculate(mr,Xr)}function Bt(Wu,al){const Xr=o.getArrayBuffer(Wu.request,(mr,cs,$u,eh)=>{mr?al(mr):cs&&al(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(cs)),rawData:cs,cacheControl:$u,expires:eh})});return()=>{Xr.cancel(),al()}}class Fn{constructor(al,Xr,mr,cs){this.actor=al,this.layerIndex=Xr,this.availableImages=mr,this.loadVectorData=cs||Bt,this.loading={},this.loaded={}}loadTile(al,Xr){const mr=al.uid;this.loading||(this.loading={});const cs=!!(al&&al.request&&al.request.collectResourceTiming)&&new o.RequestPerformance(al.request),$u=this.loading[mr]=new nt(al);$u.abort=this.loadVectorData(al,(eh,rh)=>{if(delete this.loading[mr],eh||!rh)return $u.status="done",this.loaded[mr]=$u,Xr(eh);const uh=rh.rawData,dh={};rh.expires&&(dh.expires=rh.expires),rh.cacheControl&&(dh.cacheControl=rh.cacheControl);const yh={};if(cs){const Ph=cs.finish();Ph&&(yh.resourceTiming=JSON.parse(JSON.stringify(Ph)))}$u.vectorTile=rh.vectorTile,$u.parse(rh.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ph,Fh)=>{if(Ph||!Fh)return Xr(Ph);Xr(null,o.extend({rawTileData:uh.slice(0)},Fh,dh,yh))}),this.loaded=this.loaded||{},this.loaded[mr]=$u})}reloadTile(al,Xr){const mr=this.loaded,cs=al.uid,$u=this;if(mr&&mr[cs]){const eh=mr[cs];eh.showCollisionBoxes=al.showCollisionBoxes;const rh=(uh,dh)=>{const yh=eh.reloadCallback;yh&&(delete eh.reloadCallback,eh.parse(eh.vectorTile,$u.layerIndex,this.availableImages,$u.actor,yh)),Xr(uh,dh)};eh.status==="parsing"?eh.reloadCallback=rh:eh.status==="done"&&(eh.vectorTile?eh.parse(eh.vectorTile,this.layerIndex,this.availableImages,this.actor,rh):rh())}}abortTile(al,Xr){const mr=this.loading,cs=al.uid;mr&&mr[cs]&&mr[cs].abort&&(mr[cs].abort(),delete mr[cs]),Xr()}removeTile(al,Xr){const mr=this.loaded,cs=al.uid;mr&&mr[cs]&&delete mr[cs],Xr()}}class yr{constructor(){this.loaded={}}loadTile(al,Xr){const{uid:mr,encoding:cs,rawImageData:$u}=al,eh=o.isImageBitmap($u)?this.getImageData($u):$u,rh=new o.DEMData(mr,eh,cs);this.loaded=this.loaded||{},this.loaded[mr]=rh,Xr(null,rh)}getImageData(al){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(al.width,al.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=al.width,this.offscreenCanvas.height=al.height,this.offscreenCanvasContext.drawImage(al,0,0,al.width,al.height);const Xr=this.offscreenCanvasContext.getImageData(-1,-1,al.width+2,al.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:Xr.width,height:Xr.height},Xr.data)}removeTile(al){const Xr=this.loaded,mr=al.uid;Xr&&Xr[mr]&&delete Xr[mr]}}var Io=function Wu(al,Xr){var mr,cs=al&&al.type;if(cs==="FeatureCollection")for(mr=0;mr<al.features.length;mr++)Wu(al.features[mr],Xr);else if(cs==="GeometryCollection")for(mr=0;mr<al.geometries.length;mr++)Wu(al.geometries[mr],Xr);else if(cs==="Feature")Wu(al.geometry,Xr);else if(cs==="Polygon")rl(al.coordinates,Xr);else if(cs==="MultiPolygon")for(mr=0;mr<al.coordinates.length;mr++)rl(al.coordinates[mr],Xr);return al};function rl(Wu,al){if(Wu.length!==0){Co(Wu[0],al);for(var Xr=1;Xr<Wu.length;Xr++)Co(Wu[Xr],!al)}}function Co(Wu,al){for(var Xr=0,mr=0,cs=0,$u=Wu.length,eh=$u-1;cs<$u;eh=cs++){var rh=(Wu[cs][0]-Wu[eh][0])*(Wu[eh][1]+Wu[cs][1]),uh=Xr+rh;mr+=Math.abs(Xr)>=Math.abs(rh)?Xr-uh+rh:rh-uh+Xr,Xr=uh}Xr+mr>=0!=!!al&&Wu.reverse()}const as=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Js={},lh={get exports(){return Js},set exports(Wu){Js=Wu}},ch=o.pointGeometry,Zu=o.vectorTile.VectorTileFeature,th=sl;function sl(Wu,al){this.options=al||{},this.features=Wu,this.length=Wu.length}function sh(Wu,al){this.id=typeof Wu.id=="number"?Wu.id:void 0,this.type=Wu.type,this.rawGeometry=Wu.type===1?[Wu.geometry]:Wu.geometry,this.properties=Wu.tags,this.extent=al||4096}sl.prototype.feature=function(Wu){return new sh(this.features[Wu],this.options.extent)},sh.prototype.loadGeometry=function(){var Wu=this.rawGeometry;this.geometry=[];for(var al=0;al<Wu.length;al++){for(var Xr=Wu[al],mr=[],cs=0;cs<Xr.length;cs++)mr.push(new ch(Xr[cs][0],Xr[cs][1]));this.geometry.push(mr)}return this.geometry},sh.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Wu=this.geometry,al=1/0,Xr=-1/0,mr=1/0,cs=-1/0,$u=0;$u<Wu.length;$u++)for(var eh=Wu[$u],rh=0;rh<eh.length;rh++){var uh=eh[rh];al=Math.min(al,uh.x),Xr=Math.max(Xr,uh.x),mr=Math.min(mr,uh.y),cs=Math.max(cs,uh.y)}return[al,mr,Xr,cs]},sh.prototype.toGeoJSON=Zu.prototype.toGeoJSON;var xh=o.pbf,Mh=th;function Dh(Wu){var al=new xh;return function(Xr,mr){for(var cs in Xr.layers)mr.writeMessage(3,Uh,Xr.layers[cs])}(Wu,al),al.finish()}function Uh(Wu,al){var Xr;al.writeVarintField(15,Wu.version||1),al.writeStringField(1,Wu.name||""),al.writeVarintField(5,Wu.extent||4096);var mr={keys:[],values:[],keycache:{},valuecache:{}};for(Xr=0;Xr<Wu.length;Xr++)mr.feature=Wu.feature(Xr),al.writeMessage(2,cd,mr);var cs=mr.keys;for(Xr=0;Xr<cs.length;Xr++)al.writeStringField(3,cs[Xr]);var $u=mr.values;for(Xr=0;Xr<$u.length;Xr++)al.writeMessage(4,vd,$u[Xr])}function cd(Wu,al){var Xr=Wu.feature;Xr.id!==void 0&&al.writeVarintField(1,Xr.id),al.writeMessage(2,Tf,Wu),al.writeVarintField(3,Xr.type),al.writeMessage(4,md,Xr)}function Tf(Wu,al){var Xr=Wu.feature,mr=Wu.keys,cs=Wu.values,$u=Wu.keycache,eh=Wu.valuecache;for(var rh in Xr.properties){var uh=Xr.properties[rh],dh=$u[rh];if(uh!==null){dh===void 0&&(mr.push(rh),$u[rh]=dh=mr.length-1),al.writeVarint(dh);var yh=typeof uh;yh!=="string"&&yh!=="boolean"&&yh!=="number"&&(uh=JSON.stringify(uh));var Ph=yh+":"+uh,Fh=eh[Ph];Fh===void 0&&(cs.push(uh),eh[Ph]=Fh=cs.length-1),al.writeVarint(Fh)}}}function yf(Wu,al){return(al<<3)+(7&Wu)}function Af(Wu){return Wu<<1^Wu>>31}function md(Wu,al){for(var Xr=Wu.loadGeometry(),mr=Wu.type,cs=0,$u=0,eh=Xr.length,rh=0;rh<eh;rh++){var uh=Xr[rh],dh=1;mr===1&&(dh=uh.length),al.writeVarint(yf(1,dh));for(var yh=mr===3?uh.length-1:uh.length,Ph=0;Ph<yh;Ph++){Ph===1&&mr!==1&&al.writeVarint(yf(2,yh-1));var Fh=uh[Ph].x-cs,Ad=uh[Ph].y-$u;al.writeVarint(Af(Fh)),al.writeVarint(Af(Ad)),cs+=Fh,$u+=Ad}mr===3&&al.writeVarint(yf(7,1))}}function vd(Wu,al){var Xr=typeof Wu;Xr==="string"?al.writeStringField(1,Wu):Xr==="boolean"?al.writeBooleanField(7,Wu):Xr==="number"&&(Wu%1!=0?al.writeDoubleField(3,Wu):Wu<0?al.writeSVarintField(6,Wu):al.writeVarintField(5,Wu))}lh.exports=Dh,Js.fromVectorTileJs=Dh,Js.fromGeojsonVt=function(Wu,al){al=al||{};var Xr={};for(var mr in Wu)Xr[mr]=new Mh(Wu[mr].features,al),Xr[mr].name=mr,Xr[mr].version=al.version,Xr[mr].extent=al.extent;return Dh({layers:Xr})},Js.GeoJSONWrapper=Mh;const qd={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Wu=>Wu},Ed=Math.fround||(Td=new Float32Array(1),Wu=>(Td[0]=+Wu,Td[0]));var Td;class Fd{constructor(al){this.options=jf(Object.create(qd),al),this.trees=new Array(this.options.maxZoom+1)}load(al){const{log:Xr,minZoom:mr,maxZoom:cs,nodeSize:$u}=this.options;Xr&&console.time("total time");const eh=`prepare ${al.length} points`;Xr&&console.time(eh),this.points=al;let rh=[];for(let uh=0;uh<al.length;uh++)al[uh].geometry&&rh.push(Gd(al[uh],uh));this.trees[cs+1]=new o.KDBush(rh,yd,Qd,$u,Float32Array),Xr&&console.timeEnd(eh);for(let uh=cs;uh>=mr;uh--){const dh=+Date.now();rh=this._cluster(rh,uh),this.trees[uh]=new o.KDBush(rh,yd,Qd,$u,Float32Array),Xr&&console.log("z%d: %d clusters in %dms",uh,rh.length,+Date.now()-dh)}return Xr&&console.timeEnd("total time"),this}getClusters(al,Xr){let mr=((al[0]+180)%360+360)%360-180;const cs=Math.max(-90,Math.min(90,al[1]));let $u=al[2]===180?180:((al[2]+180)%360+360)%360-180;const eh=Math.max(-90,Math.min(90,al[3]));if(al[2]-al[0]>=360)mr=-180,$u=180;else if(mr>$u){const yh=this.getClusters([mr,cs,180,eh],Xr),Ph=this.getClusters([-180,cs,$u,eh],Xr);return yh.concat(Ph)}const rh=this.trees[this._limitZoom(Xr)],uh=rh.range(td(mr),$d(eh),td($u),$d(cs)),dh=[];for(const yh of uh){const Ph=rh.points[yh];dh.push(Ph.numPoints?bf(Ph):this.points[Ph.index])}return dh}getChildren(al){const Xr=this._getOriginId(al),mr=this._getOriginZoom(al),cs="No cluster with the specified id.",$u=this.trees[mr];if(!$u)throw new Error(cs);const eh=$u.points[Xr];if(!eh)throw new Error(cs);const rh=this.options.radius/(this.options.extent*Math.pow(2,mr-1)),uh=$u.within(eh.x,eh.y,rh),dh=[];for(const yh of uh){const Ph=$u.points[yh];Ph.parentId===al&&dh.push(Ph.numPoints?bf(Ph):this.points[Ph.index])}if(dh.length===0)throw new Error(cs);return dh}getLeaves(al,Xr,mr){const cs=[];return this._appendLeaves(cs,al,Xr=Xr||10,mr=mr||0,0),cs}getTile(al,Xr,mr){const cs=this.trees[this._limitZoom(al)],$u=Math.pow(2,al),{extent:eh,radius:rh}=this.options,uh=rh/eh,dh=(mr-uh)/$u,yh=(mr+1+uh)/$u,Ph={features:[]};return this._addTileFeatures(cs.range((Xr-uh)/$u,dh,(Xr+1+uh)/$u,yh),cs.points,Xr,mr,$u,Ph),Xr===0&&this._addTileFeatures(cs.range(1-uh/$u,dh,1,yh),cs.points,$u,mr,$u,Ph),Xr===$u-1&&this._addTileFeatures(cs.range(0,dh,uh/$u,yh),cs.points,-1,mr,$u,Ph),Ph.features.length?Ph:null}getClusterExpansionZoom(al){let Xr=this._getOriginZoom(al)-1;for(;Xr<=this.options.maxZoom;){const mr=this.getChildren(al);if(Xr++,mr.length!==1)break;al=mr[0].properties.cluster_id}return Xr}_appendLeaves(al,Xr,mr,cs,$u){const eh=this.getChildren(Xr);for(const rh of eh){const uh=rh.properties;if(uh&&uh.cluster?$u+uh.point_count<=cs?$u+=uh.point_count:$u=this._appendLeaves(al,uh.cluster_id,mr,cs,$u):$u<cs?$u++:al.push(rh),al.length===mr)break}return $u}_addTileFeatures(al,Xr,mr,cs,$u,eh){for(const rh of al){const uh=Xr[rh],dh=uh.numPoints;let yh,Ph,Fh;if(dh)yh=Id(uh),Ph=uh.x,Fh=uh.y;else{const Kd=this.points[uh.index];yh=Kd.properties,Ph=td(Kd.geometry.coordinates[0]),Fh=$d(Kd.geometry.coordinates[1])}const Ad={type:1,geometry:[[Math.round(this.options.extent*(Ph*$u-mr)),Math.round(this.options.extent*(Fh*$u-cs))]],tags:yh};let wd;dh?wd=uh.id:this.options.generateId?wd=uh.index:this.points[uh.index].id&&(wd=this.points[uh.index].id),wd!==void 0&&(Ad.id=wd),eh.features.push(Ad)}}_limitZoom(al){return Math.max(this.options.minZoom,Math.min(Math.floor(+al),this.options.maxZoom+1))}_cluster(al,Xr){const mr=[],{radius:cs,extent:$u,reduce:eh,minPoints:rh}=this.options,uh=cs/($u*Math.pow(2,Xr));for(let dh=0;dh<al.length;dh++){const yh=al[dh];if(yh.zoom<=Xr)continue;yh.zoom=Xr;const Ph=this.trees[Xr+1],Fh=Ph.within(yh.x,yh.y,uh),Ad=yh.numPoints||1;let wd=Ad;for(const Kd of Fh){const xf=Ph.points[Kd];xf.zoom>Xr&&(wd+=xf.numPoints||1)}if(wd>Ad&&wd>=rh){let Kd=yh.x*Ad,xf=yh.y*Ad,Ff=eh&&Ad>1?this._map(yh,!0):null;const rp=(dh<<5)+(Xr+1)+this.points.length;for(const Ah of Fh){const Jd=Ph.points[Ah];if(Jd.zoom<=Xr)continue;Jd.zoom=Xr;const Od=Jd.numPoints||1;Kd+=Jd.x*Od,xf+=Jd.y*Od,Jd.parentId=rp,eh&&(Ff||(Ff=this._map(yh,!0)),eh(Ff,this._map(Jd)))}yh.parentId=rp,mr.push(Cd(Kd/wd,xf/wd,rp,wd,Ff))}else if(mr.push(yh),wd>1)for(const Kd of Fh){const xf=Ph.points[Kd];xf.zoom<=Xr||(xf.zoom=Xr,mr.push(xf))}}return mr}_getOriginId(al){return al-this.points.length>>5}_getOriginZoom(al){return(al-this.points.length)%32}_map(al,Xr){if(al.numPoints)return Xr?jf({},al.properties):al.properties;const mr=this.points[al.index].properties,cs=this.options.map(mr);return Xr&&cs===mr?jf({},cs):cs}}function Cd(Wu,al,Xr,mr,cs){return{x:Ed(Wu),y:Ed(al),zoom:1/0,id:Xr,parentId:-1,numPoints:mr,properties:cs}}function Gd(Wu,al){const[Xr,mr]=Wu.geometry.coordinates;return{x:Ed(td(Xr)),y:Ed($d(mr)),zoom:1/0,index:al,parentId:-1}}function bf(Wu){return{type:"Feature",id:Wu.id,properties:Id(Wu),geometry:{type:"Point",coordinates:[(al=Wu.x,360*(al-.5)),np(Wu.y)]}};var al}function Id(Wu){const al=Wu.numPoints,Xr=al>=1e4?`${Math.round(al/1e3)}k`:al>=1e3?Math.round(al/100)/10+"k":al;return jf(jf({},Wu.properties),{cluster:!0,cluster_id:Wu.id,point_count:al,point_count_abbreviated:Xr})}function td(Wu){return Wu/360+.5}function $d(Wu){const al=Math.sin(Wu*Math.PI/180),Xr=.5-.25*Math.log((1+al)/(1-al))/Math.PI;return Xr<0?0:Xr>1?1:Xr}function np(Wu){const al=(180-360*Wu)*Math.PI/180;return 360*Math.atan(Math.exp(al))/Math.PI-90}function jf(Wu,al){for(const Xr in al)Wu[Xr]=al[Xr];return Wu}function yd(Wu){return Wu.x}function Qd(Wu){return Wu.y}function op(Wu,al,Xr,mr){for(var cs,$u=mr,eh=Xr-al>>1,rh=Xr-al,uh=Wu[al],dh=Wu[al+1],yh=Wu[Xr],Ph=Wu[Xr+1],Fh=al+3;Fh<Xr;Fh+=3){var Ad=bp(Wu[Fh],Wu[Fh+1],uh,dh,yh,Ph);if(Ad>$u)cs=Fh,$u=Ad;else if(Ad===$u){var wd=Math.abs(Fh-eh);wd<rh&&(cs=Fh,rh=wd)}}$u>mr&&(cs-al>3&&op(Wu,al,cs,mr),Wu[cs+2]=$u,Xr-cs>3&&op(Wu,cs,Xr,mr))}function bp(Wu,al,Xr,mr,cs,$u){var eh=cs-Xr,rh=$u-mr;if(eh!==0||rh!==0){var uh=((Wu-Xr)*eh+(al-mr)*rh)/(eh*eh+rh*rh);uh>1?(Xr=cs,mr=$u):uh>0&&(Xr+=eh*uh,mr+=rh*uh)}return(eh=Wu-Xr)*eh+(rh=al-mr)*rh}function fp(Wu,al,Xr,mr){var cs={id:Wu===void 0?null:Wu,type:al,geometry:Xr,tags:mr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($u){var eh=$u.geometry,rh=$u.type;if(rh==="Point"||rh==="MultiPoint"||rh==="LineString")Qh($u,eh);else if(rh==="Polygon"||rh==="MultiLineString")for(var uh=0;uh<eh.length;uh++)Qh($u,eh[uh]);else if(rh==="MultiPolygon")for(uh=0;uh<eh.length;uh++)for(var dh=0;dh<eh[uh].length;dh++)Qh($u,eh[uh][dh])}(cs),cs}function Qh(Wu,al){for(var Xr=0;Xr<al.length;Xr+=3)Wu.minX=Math.min(Wu.minX,al[Xr]),Wu.minY=Math.min(Wu.minY,al[Xr+1]),Wu.maxX=Math.max(Wu.maxX,al[Xr]),Wu.maxY=Math.max(Wu.maxY,al[Xr+1])}function Yd(Wu,al,Xr,mr){if(al.geometry){var cs=al.geometry.coordinates,$u=al.geometry.type,eh=Math.pow(Xr.tolerance/((1<<Xr.maxZoom)*Xr.extent),2),rh=[],uh=al.id;if(Xr.promoteId?uh=al.properties[Xr.promoteId]:Xr.generateId&&(uh=mr||0),$u==="Point")ad(cs,rh);else if($u==="MultiPoint")for(var dh=0;dh<cs.length;dh++)ad(cs[dh],rh);else if($u==="LineString")Zd(cs,rh,eh,!1);else if($u==="MultiLineString"){if(Xr.lineMetrics){for(dh=0;dh<cs.length;dh++)Zd(cs[dh],rh=[],eh,!1),Wu.push(fp(uh,"LineString",rh,al.properties));return}Xh(cs,rh,eh,!1)}else if($u==="Polygon")Xh(cs,rh,eh,!0);else{if($u!=="MultiPolygon"){if($u==="GeometryCollection"){for(dh=0;dh<al.geometry.geometries.length;dh++)Yd(Wu,{id:uh,geometry:al.geometry.geometries[dh],properties:al.properties},Xr,mr);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dh=0;dh<cs.length;dh++){var yh=[];Xh(cs[dh],yh,eh,!0),rh.push(yh)}}Wu.push(fp(uh,$u,rh,al.properties))}}function ad(Wu,al){al.push(Ld(Wu[0])),al.push(Kf(Wu[1])),al.push(0)}function Zd(Wu,al,Xr,mr){for(var cs,$u,eh=0,rh=0;rh<Wu.length;rh++){var uh=Ld(Wu[rh][0]),dh=Kf(Wu[rh][1]);al.push(uh),al.push(dh),al.push(0),rh>0&&(eh+=mr?(cs*dh-uh*$u)/2:Math.sqrt(Math.pow(uh-cs,2)+Math.pow(dh-$u,2))),cs=uh,$u=dh}var yh=al.length-3;al[2]=1,op(al,0,yh,Xr),al[yh+2]=1,al.size=Math.abs(eh),al.start=0,al.end=al.size}function Xh(Wu,al,Xr,mr){for(var cs=0;cs<Wu.length;cs++){var $u=[];Zd(Wu[cs],$u,Xr,mr),al.push($u)}}function Ld(Wu){return Wu/360+.5}function Kf(Wu){var al=Math.sin(Wu*Math.PI/180),Xr=.5-.25*Math.log((1+al)/(1-al))/Math.PI;return Xr<0?0:Xr>1?1:Xr}function If(Wu,al,Xr,mr,cs,$u,eh,rh){if(mr/=al,$u>=(Xr/=al)&&eh<mr)return Wu;if(eh<Xr||$u>=mr)return null;for(var uh=[],dh=0;dh<Wu.length;dh++){var yh=Wu[dh],Ph=yh.geometry,Fh=yh.type,Ad=cs===0?yh.minX:yh.minY,wd=cs===0?yh.maxX:yh.maxY;if(Ad>=Xr&&wd<mr)uh.push(yh);else if(!(wd<Xr||Ad>=mr)){var Kd=[];if(Fh==="Point"||Fh==="MultiPoint")Df(Ph,Kd,Xr,mr,cs);else if(Fh==="LineString")Jf(Ph,Kd,Xr,mr,cs,!1,rh.lineMetrics);else if(Fh==="MultiLineString")Wf(Ph,Kd,Xr,mr,cs,!1);else if(Fh==="Polygon")Wf(Ph,Kd,Xr,mr,cs,!0);else if(Fh==="MultiPolygon")for(var xf=0;xf<Ph.length;xf++){var Ff=[];Wf(Ph[xf],Ff,Xr,mr,cs,!0),Ff.length&&Kd.push(Ff)}if(Kd.length){if(rh.lineMetrics&&Fh==="LineString"){for(xf=0;xf<Kd.length;xf++)uh.push(fp(yh.id,Fh,Kd[xf],yh.tags));continue}Fh!=="LineString"&&Fh!=="MultiLineString"||(Kd.length===1?(Fh="LineString",Kd=Kd[0]):Fh="MultiLineString"),Fh!=="Point"&&Fh!=="MultiPoint"||(Fh=Kd.length===3?"Point":"MultiPoint"),uh.push(fp(yh.id,Fh,Kd,yh.tags))}}}return uh.length?uh:null}function Df(Wu,al,Xr,mr,cs){for(var $u=0;$u<Wu.length;$u+=3){var eh=Wu[$u+cs];eh>=Xr&&eh<=mr&&(al.push(Wu[$u]),al.push(Wu[$u+1]),al.push(Wu[$u+2]))}}function Jf(Wu,al,Xr,mr,cs,$u,eh){for(var rh,uh,dh=Nf(Wu),yh=cs===0?Tp:Pp,Ph=Wu.start,Fh=0;Fh<Wu.length-3;Fh+=3){var Ad=Wu[Fh],wd=Wu[Fh+1],Kd=Wu[Fh+2],xf=Wu[Fh+3],Ff=Wu[Fh+4],rp=cs===0?Ad:wd,Ah=cs===0?xf:Ff,Jd=!1;eh&&(rh=Math.sqrt(Math.pow(Ad-xf,2)+Math.pow(wd-Ff,2))),rp<Xr?Ah>Xr&&(uh=yh(dh,Ad,wd,xf,Ff,Xr),eh&&(dh.start=Ph+rh*uh)):rp>mr?Ah<mr&&(uh=yh(dh,Ad,wd,xf,Ff,mr),eh&&(dh.start=Ph+rh*uh)):Cp(dh,Ad,wd,Kd),Ah<Xr&&rp>=Xr&&(uh=yh(dh,Ad,wd,xf,Ff,Xr),Jd=!0),Ah>mr&&rp<=mr&&(uh=yh(dh,Ad,wd,xf,Ff,mr),Jd=!0),!$u&&Jd&&(eh&&(dh.end=Ph+rh*uh),al.push(dh),dh=Nf(Wu)),eh&&(Ph+=rh)}var Od=Wu.length-3;Ad=Wu[Od],wd=Wu[Od+1],Kd=Wu[Od+2],(rp=cs===0?Ad:wd)>=Xr&&rp<=mr&&Cp(dh,Ad,wd,Kd),Od=dh.length-3,$u&&Od>=3&&(dh[Od]!==dh[0]||dh[Od+1]!==dh[1])&&Cp(dh,dh[0],dh[1],dh[2]),dh.length&&al.push(dh)}function Nf(Wu){var al=[];return al.size=Wu.size,al.start=Wu.start,al.end=Wu.end,al}function Wf(Wu,al,Xr,mr,cs,$u){for(var eh=0;eh<Wu.length;eh++)Jf(Wu[eh],al,Xr,mr,cs,$u,!1)}function Cp(Wu,al,Xr,mr){Wu.push(al),Wu.push(Xr),Wu.push(mr)}function Tp(Wu,al,Xr,mr,cs,$u){var eh=($u-al)/(mr-al);return Wu.push($u),Wu.push(Xr+(cs-Xr)*eh),Wu.push(1),eh}function Pp(Wu,al,Xr,mr,cs,$u){var eh=($u-Xr)/(cs-Xr);return Wu.push(al+(mr-al)*eh),Wu.push($u),Wu.push(1),eh}function Yf(Wu,al){for(var Xr=[],mr=0;mr<Wu.length;mr++){var cs,$u=Wu[mr],eh=$u.type;if(eh==="Point"||eh==="MultiPoint"||eh==="LineString")cs=qp($u.geometry,al);else if(eh==="MultiLineString"||eh==="Polygon"){cs=[];for(var rh=0;rh<$u.geometry.length;rh++)cs.push(qp($u.geometry[rh],al))}else if(eh==="MultiPolygon")for(cs=[],rh=0;rh<$u.geometry.length;rh++){for(var uh=[],dh=0;dh<$u.geometry[rh].length;dh++)uh.push(qp($u.geometry[rh][dh],al));cs.push(uh)}Xr.push(fp($u.id,eh,cs,$u.tags))}return Xr}function qp(Wu,al){var Xr=[];Xr.size=Wu.size,Wu.start!==void 0&&(Xr.start=Wu.start,Xr.end=Wu.end);for(var mr=0;mr<Wu.length;mr+=3)Xr.push(Wu[mr]+al,Wu[mr+1],Wu[mr+2]);return Xr}function am(Wu,al){if(Wu.transformed)return Wu;var Xr,mr,cs,$u=1<<Wu.z,eh=Wu.x,rh=Wu.y;for(Xr=0;Xr<Wu.features.length;Xr++){var uh=Wu.features[Xr],dh=uh.geometry,yh=uh.type;if(uh.geometry=[],yh===1)for(mr=0;mr<dh.length;mr+=2)uh.geometry.push(Xd(dh[mr],dh[mr+1],al,$u,eh,rh));else for(mr=0;mr<dh.length;mr++){var Ph=[];for(cs=0;cs<dh[mr].length;cs+=2)Ph.push(Xd(dh[mr][cs],dh[mr][cs+1],al,$u,eh,rh));uh.geometry.push(Ph)}}return Wu.transformed=!0,Wu}function Xd(Wu,al,Xr,mr,cs,$u){return[Math.round(Xr*(Wu*mr-cs)),Math.round(Xr*(al*mr-$u))]}function Op(Wu,al,Xr,mr,cs){for(var $u=al===cs.maxZoom?0:cs.tolerance/((1<<al)*cs.extent),eh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Xr,y:mr,z:al,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},rh=0;rh<Wu.length;rh++){eh.numFeatures++,nm(eh,Wu[rh],$u,cs);var uh=Wu[rh].minX,dh=Wu[rh].minY,yh=Wu[rh].maxX,Ph=Wu[rh].maxY;uh<eh.minX&&(eh.minX=uh),dh<eh.minY&&(eh.minY=dh),yh>eh.maxX&&(eh.maxX=yh),Ph>eh.maxY&&(eh.maxY=Ph)}return eh}function nm(Wu,al,Xr,mr){var cs=al.geometry,$u=al.type,eh=[];if($u==="Point"||$u==="MultiPoint")for(var rh=0;rh<cs.length;rh+=3)eh.push(cs[rh]),eh.push(cs[rh+1]),Wu.numPoints++,Wu.numSimplified++;else if($u==="LineString")Tm(eh,cs,Wu,Xr,!1,!1);else if($u==="MultiLineString"||$u==="Polygon")for(rh=0;rh<cs.length;rh++)Tm(eh,cs[rh],Wu,Xr,$u==="Polygon",rh===0);else if($u==="MultiPolygon")for(var uh=0;uh<cs.length;uh++){var dh=cs[uh];for(rh=0;rh<dh.length;rh++)Tm(eh,dh[rh],Wu,Xr,!0,rh===0)}if(eh.length){var yh=al.tags||null;if($u==="LineString"&&mr.lineMetrics){for(var Ph in yh={},al.tags)yh[Ph]=al.tags[Ph];yh.mapbox_clip_start=cs.start/cs.size,yh.mapbox_clip_end=cs.end/cs.size}var Fh={geometry:eh,type:$u==="Polygon"||$u==="MultiPolygon"?3:$u==="LineString"||$u==="MultiLineString"?2:1,tags:yh};al.id!==null&&(Fh.id=al.id),Wu.features.push(Fh)}}function Tm(Wu,al,Xr,mr,cs,$u){var eh=mr*mr;if(mr>0&&al.size<(cs?eh:mr))Xr.numPoints+=al.length/3;else{for(var rh=[],uh=0;uh<al.length;uh+=3)(mr===0||al[uh+2]>eh)&&(Xr.numSimplified++,rh.push(al[uh]),rh.push(al[uh+1])),Xr.numPoints++;cs&&function(dh,yh){for(var Ph=0,Fh=0,Ad=dh.length,wd=Ad-2;Fh<Ad;wd=Fh,Fh+=2)Ph+=(dh[Fh]-dh[wd])*(dh[Fh+1]+dh[wd+1]);if(Ph>0===yh)for(Fh=0,Ad=dh.length;Fh<Ad/2;Fh+=2){var Kd=dh[Fh],xf=dh[Fh+1];dh[Fh]=dh[Ad-2-Fh],dh[Fh+1]=dh[Ad-1-Fh],dh[Ad-2-Fh]=Kd,dh[Ad-1-Fh]=xf}}(rh,$u),Wu.push(rh)}}function hp(Wu,al){var Xr=(al=this.options=function(cs,$u){for(var eh in $u)cs[eh]=$u[eh];return cs}(Object.create(this.options),al)).debug;if(Xr&&console.time("preprocess data"),al.maxZoom<0||al.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(al.promoteId&&al.generateId)throw new Error("promoteId and generateId cannot be used together.");var mr=function(cs,$u){var eh=[];if(cs.type==="FeatureCollection")for(var rh=0;rh<cs.features.length;rh++)Yd(eh,cs.features[rh],$u,rh);else Yd(eh,cs.type==="Feature"?cs:{geometry:cs},$u);return eh}(Wu,al);this.tiles={},this.tileCoords=[],Xr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",al.indexMaxZoom,al.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),mr=function(cs,$u){var eh=$u.buffer/$u.extent,rh=cs,uh=If(cs,1,-1-eh,eh,0,-1,2,$u),dh=If(cs,1,1-eh,2+eh,0,-1,2,$u);return(uh||dh)&&(rh=If(cs,1,-eh,1+eh,0,-1,2,$u)||[],uh&&(rh=Yf(uh,1).concat(rh)),dh&&(rh=rh.concat(Yf(dh,-1)))),rh}(mr,al),mr.length&&this.splitTile(mr,0,0,0),Xr&&(mr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Em(Wu,al,Xr){return 32*((1<<Wu)*Xr+al)+Wu}function Qp(Wu,al){return al?Wu.properties[al]:Wu.id}function lm(Wu,al){if(Wu==null)return!0;if(Wu.type==="Feature")return Qp(Wu,al)!=null;if(Wu.type==="FeatureCollection"){const Xr=new Set;for(const mr of Wu.features){const cs=Qp(mr,al);if(cs==null||Xr.has(cs))return!1;Xr.add(cs)}return!0}return!1}function Dd(Wu,al){const Xr=new Map;if(Wu!=null)if(Wu.type==="Feature")Xr.set(Qp(Wu,al),Wu);else for(const mr of Wu.features)Xr.set(Qp(mr,al),mr);return Xr}function Hf(Wu,al){const Xr=Wu.tileID.canonical;if(!this._geoJSONIndex)return al(null,null);const mr=this._geoJSONIndex.getTile(Xr.z,Xr.x,Xr.y);if(!mr)return al(null,null);const cs=new class{constructor(eh){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=eh.length,this._features=eh}feature(eh){return new class{constructor(rh){this._feature=rh,this.extent=o.EXTENT,this.type=rh.type,this.properties=rh.tags,"id"in rh&&!isNaN(rh.id)&&(this.id=parseInt(rh.id,10))}loadGeometry(){if(this._feature.type===1){const rh=[];for(const uh of this._feature.geometry)rh.push([new o.pointGeometry(uh[0],uh[1])]);return rh}{const rh=[];for(const uh of this._feature.geometry){const dh=[];for(const yh of uh)dh.push(new o.pointGeometry(yh[0],yh[1]));rh.push(dh)}return rh}}toGeoJSON(rh,uh,dh){return as.call(this,rh,uh,dh)}}(this._features[eh])}}(mr.features);let $u=Js(cs);$u.byteOffset===0&&$u.byteLength===$u.buffer.byteLength||($u=new Uint8Array($u)),al(null,{vectorTile:cs,rawData:$u.buffer})}hp.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},hp.prototype.splitTile=function(Wu,al,Xr,mr,cs,$u,eh){for(var rh=[Wu,al,Xr,mr],uh=this.options,dh=uh.debug;rh.length;){mr=rh.pop(),Xr=rh.pop(),al=rh.pop(),Wu=rh.pop();var yh=1<<al,Ph=Em(al,Xr,mr),Fh=this.tiles[Ph];if(!Fh&&(dh>1&&console.time("creation"),Fh=this.tiles[Ph]=Op(Wu,al,Xr,mr,uh),this.tileCoords.push({z:al,x:Xr,y:mr}),dh)){dh>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",al,Xr,mr,Fh.numFeatures,Fh.numPoints,Fh.numSimplified),console.timeEnd("creation"));var Ad="z"+al;this.stats[Ad]=(this.stats[Ad]||0)+1,this.total++}if(Fh.source=Wu,cs){if(al===uh.maxZoom||al===cs)continue;var wd=1<<cs-al;if(Xr!==Math.floor($u/wd)||mr!==Math.floor(eh/wd))continue}else if(al===uh.indexMaxZoom||Fh.numPoints<=uh.indexMaxPoints)continue;if(Fh.source=null,Wu.length!==0){dh>1&&console.time("clipping");var Kd,xf,Ff,rp,Ah,Jd,Od=.5*uh.buffer/uh.extent,qf=.5-Od,mp=.5+Od,Vp=1+Od;Kd=xf=Ff=rp=null,Ah=If(Wu,yh,Xr-Od,Xr+mp,0,Fh.minX,Fh.maxX,uh),Jd=If(Wu,yh,Xr+qf,Xr+Vp,0,Fh.minX,Fh.maxX,uh),Wu=null,Ah&&(Kd=If(Ah,yh,mr-Od,mr+mp,1,Fh.minY,Fh.maxY,uh),xf=If(Ah,yh,mr+qf,mr+Vp,1,Fh.minY,Fh.maxY,uh),Ah=null),Jd&&(Ff=If(Jd,yh,mr-Od,mr+mp,1,Fh.minY,Fh.maxY,uh),rp=If(Jd,yh,mr+qf,mr+Vp,1,Fh.minY,Fh.maxY,uh),Jd=null),dh>1&&console.timeEnd("clipping"),rh.push(Kd||[],al+1,2*Xr,2*mr),rh.push(xf||[],al+1,2*Xr,2*mr+1),rh.push(Ff||[],al+1,2*Xr+1,2*mr),rh.push(rp||[],al+1,2*Xr+1,2*mr+1)}}},hp.prototype.getTile=function(Wu,al,Xr){var mr=this.options,cs=mr.extent,$u=mr.debug;if(Wu<0||Wu>24)return null;var eh=1<<Wu,rh=Em(Wu,al=(al%eh+eh)%eh,Xr);if(this.tiles[rh])return am(this.tiles[rh],cs);$u>1&&console.log("drilling down to z%d-%d-%d",Wu,al,Xr);for(var uh,dh=Wu,yh=al,Ph=Xr;!uh&&dh>0;)dh--,yh=Math.floor(yh/2),Ph=Math.floor(Ph/2),uh=this.tiles[Em(dh,yh,Ph)];return uh&&uh.source?($u>1&&console.log("found parent tile z%d-%d-%d",dh,yh,Ph),$u>1&&console.time("drilling down"),this.splitTile(uh.source,dh,yh,Ph,Wu,al,Xr),$u>1&&console.timeEnd("drilling down"),this.tiles[rh]?am(this.tiles[rh],cs):null):null};class mh extends Fn{constructor(al,Xr,mr,cs){super(al,Xr,mr,Hf),this._dataUpdateable=new Map,this.loadGeoJSON=($u,eh)=>{const{promoteId:rh}=$u;if($u.request)return o.getJSON($u.request,(uh,dh,yh,Ph)=>{this._dataUpdateable=lm(dh,rh)?Dd(dh,rh):void 0,eh(uh,dh,yh,Ph)});if(typeof $u.data=="string")try{const uh=JSON.parse($u.data);this._dataUpdateable=lm(uh,rh)?Dd(uh,rh):void 0,eh(null,uh)}catch{eh(new Error(`Input data given to '${$u.source}' is not a valid GeoJSON object.`))}else $u.dataDiff?this._dataUpdateable?(function(uh,dh,yh){var Ph,Fh,Ad,wd;if(dh.removeAll&&uh.clear(),dh.remove)for(const Kd of dh.remove)uh.delete(Kd);if(dh.add)for(const Kd of dh.add){const xf=Qp(Kd,yh);xf!=null&&uh.set(xf,Kd)}if(dh.update)for(const Kd of dh.update){let xf=uh.get(Kd.id);if(xf==null)continue;const Ff=!Kd.removeAllProperties&&(((Ph=Kd.removeProperties)===null||Ph===void 0?void 0:Ph.length)>0||((Fh=Kd.addOrUpdateProperties)===null||Fh===void 0?void 0:Fh.length)>0);if((Kd.newGeometry||Kd.removeAllProperties||Ff)&&(xf={...xf},uh.set(Kd.id,xf),Ff&&(xf.properties={...xf.properties})),Kd.newGeometry&&(xf.geometry=Kd.newGeometry),Kd.removeAllProperties)xf.properties={};else if(((Ad=Kd.removeProperties)===null||Ad===void 0?void 0:Ad.length)>0)for(const rp of Kd.removeProperties)Object.prototype.hasOwnProperty.call(xf.properties,rp)&&delete xf.properties[rp];if(((wd=Kd.addOrUpdateProperties)===null||wd===void 0?void 0:wd.length)>0)for(const{key:rp,value:Ah}of Kd.addOrUpdateProperties)xf.properties[rp]=Ah}}(this._dataUpdateable,$u.dataDiff,rh),eh(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):eh(new Error(`Cannot update existing geojson data in ${$u.source}`)):eh(new Error(`Input data given to '${$u.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},cs&&(this.loadGeoJSON=cs)}loadData(al,Xr){var mr;(mr=this._pendingRequest)===null||mr===void 0||mr.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const cs=!!(al&&al.request&&al.request.collectResourceTiming)&&new o.RequestPerformance(al.request);this._pendingCallback=Xr,this._pendingRequest=this.loadGeoJSON(al,($u,eh)=>{if(delete this._pendingCallback,delete this._pendingRequest,$u||!eh)return Xr($u);if(typeof eh!="object")return Xr(new Error(`Input data given to '${al.source}' is not a valid GeoJSON object.`));{Io(eh,!0);try{if(al.filter){const uh=o.createExpression(al.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(uh.result==="error")throw new Error(uh.value.map(yh=>`${yh.key}: ${yh.message}`).join(", "));eh={type:"FeatureCollection",features:eh.features.filter(yh=>uh.value.evaluate({zoom:0},yh))}}this._geoJSONIndex=al.cluster?new Fd(function({superclusterOptions:uh,clusterProperties:dh}){if(!dh||!uh)return uh;const yh={},Ph={},Fh={accumulated:null,zoom:0},Ad={properties:null},wd=Object.keys(dh);for(const Kd of wd){const[xf,Ff]=dh[Kd],rp=o.createExpression(Ff),Ah=o.createExpression(typeof xf=="string"?[xf,["accumulated"],["get",Kd]]:xf);yh[Kd]=rp.value,Ph[Kd]=Ah.value}return uh.map=Kd=>{Ad.properties=Kd;const xf={};for(const Ff of wd)xf[Ff]=yh[Ff].evaluate(Fh,Ad);return xf},uh.reduce=(Kd,xf)=>{Ad.properties=xf;for(const Ff of wd)Fh.accumulated=Kd[Ff],Kd[Ff]=Ph[Ff].evaluate(Fh,Ad)},uh}(al)).load(eh.features):function(uh,dh){return new hp(uh,dh)}(eh,al.geojsonVtOptions)}catch(uh){return Xr(uh)}this.loaded={};const rh={};if(cs){const uh=cs.finish();uh&&(rh.resourceTiming={},rh.resourceTiming[al.source]=JSON.parse(JSON.stringify(uh)))}Xr(null,rh)}})}reloadTile(al,Xr){const mr=this.loaded;return mr&&mr[al.uid]?super.reloadTile(al,Xr):this.loadTile(al,Xr)}removeSource(al,Xr){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Xr()}getClusterExpansionZoom(al,Xr){try{Xr(null,this._geoJSONIndex.getClusterExpansionZoom(al.clusterId))}catch(mr){Xr(mr)}}getClusterChildren(al,Xr){try{Xr(null,this._geoJSONIndex.getChildren(al.clusterId))}catch(mr){Xr(mr)}}getClusterLeaves(al,Xr){try{Xr(null,this._geoJSONIndex.getLeaves(al.clusterId,al.limit,al.offset))}catch(mr){Xr(mr)}}}class Jh{constructor(al){this.self=al,this.actor=new o.Actor(al,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Fn,geojson:mh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Xr,mr)=>{if(this.workerSourceTypes[Xr])throw new Error(`Worker source with name "${Xr}" already registered.`);this.workerSourceTypes[Xr]=mr},this.self.registerRTLTextPlugin=Xr=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Xr.applyArabicShaping,o.plugin.processBidirectionalText=Xr.processBidirectionalText,o.plugin.processStyledBidirectionalText=Xr.processStyledBidirectionalText}}setReferrer(al,Xr){this.referrer=Xr}setImages(al,Xr,mr){this.availableImages[al]=Xr;for(const cs in this.workerSources[al]){const $u=this.workerSources[al][cs];for(const eh in $u)$u[eh].availableImages=Xr}mr()}setLayers(al,Xr,mr){this.getLayerIndex(al).replace(Xr),mr()}updateLayers(al,Xr,mr){this.getLayerIndex(al).update(Xr.layers,Xr.removedIds),mr()}loadTile(al,Xr,mr){this.getWorkerSource(al,Xr.type,Xr.source).loadTile(Xr,mr)}loadDEMTile(al,Xr,mr){this.getDEMWorkerSource(al,Xr.source).loadTile(Xr,mr)}reloadTile(al,Xr,mr){this.getWorkerSource(al,Xr.type,Xr.source).reloadTile(Xr,mr)}abortTile(al,Xr,mr){this.getWorkerSource(al,Xr.type,Xr.source).abortTile(Xr,mr)}removeTile(al,Xr,mr){this.getWorkerSource(al,Xr.type,Xr.source).removeTile(Xr,mr)}removeDEMTile(al,Xr){this.getDEMWorkerSource(al,Xr.source).removeTile(Xr)}removeSource(al,Xr,mr){if(!this.workerSources[al]||!this.workerSources[al][Xr.type]||!this.workerSources[al][Xr.type][Xr.source])return;const cs=this.workerSources[al][Xr.type][Xr.source];delete this.workerSources[al][Xr.type][Xr.source],cs.removeSource!==void 0?cs.removeSource(Xr,mr):mr()}loadWorkerSource(al,Xr,mr){try{this.self.importScripts(Xr.url),mr()}catch(cs){mr(cs.toString())}}syncRTLPluginState(al,Xr,mr){try{o.plugin.setState(Xr);const cs=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&cs!=null){this.self.importScripts(cs);const $u=o.plugin.isParsed();mr($u?void 0:new Error(`RTL Text Plugin failed to import scripts from ${cs}`),$u)}}catch(cs){mr(cs.toString())}}getAvailableImages(al){let Xr=this.availableImages[al];return Xr||(Xr=[]),Xr}getLayerIndex(al){let Xr=this.layerIndexes[al];return Xr||(Xr=this.layerIndexes[al]=new P),Xr}getWorkerSource(al,Xr,mr){if(this.workerSources[al]||(this.workerSources[al]={}),this.workerSources[al][Xr]||(this.workerSources[al][Xr]={}),!this.workerSources[al][Xr][mr]){const cs={send:($u,eh,rh)=>{this.actor.send($u,eh,rh,al)}};this.workerSources[al][Xr][mr]=new this.workerSourceTypes[Xr](cs,this.getLayerIndex(al),this.getAvailableImages(al))}return this.workerSources[al][Xr][mr]}getDEMWorkerSource(al,Xr){return this.demWorkerSources[al]||(this.demWorkerSources[al]={}),this.demWorkerSources[al][Xr]||(this.demWorkerSources[al][Xr]=new yr),this.demWorkerSources[al][Xr]}}return o.isWorker()&&(self.worker=new Jh(self)),Jh}),l(["./shared"],function(o){var x=M;function M(Y){return!function(g){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var q,ze,Ft=new Blob([""],{type:"text/javascript"}),Gn=URL.createObjectURL(Ft);try{ze=new Worker(Gn),q=!0}catch{q=!1}return ze&&ze.terminate(),URL.revokeObjectURL(Gn),q}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var q=document.createElement("canvas");q.width=q.height=1;var ze=q.getContext("2d");if(!ze)return!1;var Ft=ze.getImageData(0,0,1,1);return Ft&&Ft.width===q.width}()?(P[A=g&&g.failIfMajorPerformanceCaveat]===void 0&&(P[A]=function(q){var ze,Ft=function(Gn){var ls=document.createElement("canvas"),$s=Object.create(M.webGLContextAttributes);return $s.failIfMajorPerformanceCaveat=Gn,ls.getContext("webgl",$s)||ls.getContext("experimental-webgl",$s)}(q);if(!Ft)return!1;try{ze=Ft.createShader(Ft.VERTEX_SHADER)}catch{return!1}return!(!ze||Ft.isContextLost())&&(Ft.shaderSource(ze,"void main() {}"),Ft.compileShader(ze),Ft.getShaderParameter(ze,Ft.COMPILE_STATUS)===!0)}(A)),P[A]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}(Y)}var P={};M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var he="3.0.0-pre.4";function nt(Y,g){if(Array.isArray(Y)){if(!Array.isArray(g)||Y.length!==g.length)return!1;for(let A=0;A<Y.length;A++)if(!nt(Y[A],g[A]))return!1;return!0}if(typeof Y=="object"&&Y!==null&&g!==null){if(typeof g!="object"||Object.keys(Y).length!==Object.keys(g).length)return!1;for(const A in Y)if(!nt(Y[A],g[A]))return!1;return!0}return Y===g}class _e{static testProp(g){if(!_e.docStyle)return g[0];for(let A=0;A<g.length;A++)if(g[A]in _e.docStyle)return g[A];return g[0]}static create(g,A,q){const ze=window.document.createElement(g);return A!==void 0&&(ze.className=A),q&&q.appendChild(ze),ze}static createNS(g,A){return window.document.createElementNS(g,A)}static disableDrag(){_e.docStyle&&_e.selectProp&&(_e.userSelect=_e.docStyle[_e.selectProp],_e.docStyle[_e.selectProp]="none")}static enableDrag(){_e.docStyle&&_e.selectProp&&(_e.docStyle[_e.selectProp]=_e.userSelect)}static setTransform(g,A){g.style[_e.transformProp]=A}static addEventListener(g,A,q,ze={}){g.addEventListener(A,q,"passive"in ze?ze:ze.capture)}static removeEventListener(g,A,q,ze={}){g.removeEventListener(A,q,"passive"in ze?ze:ze.capture)}static suppressClickInternal(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",_e.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_e.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_e.suppressClickInternal,!0)},0)}static mousePos(g,A){const q=g.getBoundingClientRect();return new o.pointGeometry(A.clientX-q.left-g.clientLeft,A.clientY-q.top-g.clientTop)}static touchPos(g,A){const q=g.getBoundingClientRect(),ze=[];for(let Ft=0;Ft<A.length;Ft++)ze.push(new o.pointGeometry(A[Ft].clientX-q.left-g.clientLeft,A[Ft].clientY-q.top-g.clientTop));return ze}static mouseButton(g){return g.button}static remove(g){g.parentNode&&g.parentNode.removeChild(g)}}_e.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_e.selectProp=_e.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_e.transformProp=_e.testProp(["transform","WebkitTransform"]);const Bt={supported:!1,testSupport:function(Y){!Io&&yr&&(rl?Co(Y):Fn=Y)}};let Fn,yr,Io=!1,rl=!1;function Co(Y){const g=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,g);try{if(Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,yr),Y.isContextLost())return;Bt.supported=!0}catch{}Y.deleteTexture(g),Io=!0}var as;typeof document<"u"&&(yr=document.createElement("img"),yr.onload=function(){Fn&&Co(Fn),Fn=null,rl=!0},yr.onerror=function(){Io=!0,Fn=null},yr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(Y){let g,A,q,ze;Y.resetRequestQueue=()=>{g=[],A=0,q=0,ze={}},Y.addThrottleControl=ls=>{const $s=q++;return ze[$s]=ls,$s},Y.removeThrottleControl=ls=>{delete ze[ls]};const Ft=()=>{const ls=Object.keys(ze);let $s=!1;if(ls.length>0){for(const ol of ls)if($s=ze[ol](),$s)break}return $s};Y.getImage=(ls,$s)=>{Bt.supported&&(ls.headers||(ls.headers={}),ls.headers.accept="image/webp,*/*");const ol={requestParameters:ls,callback:$s,cancelled:!1,completed:!1,cancel:()=>{}};return g.push(ol),Ft()||Y.processQueue(),ol};const Gn=ls=>{const{requestParameters:$s,callback:ol}=ls;return o.getArrayBuffer($s,(nh,ih,ph,Lh)=>{nh?ol(nh):ih&&((Bh,Ch)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(Bh,Ch):o.arrayBufferToImage(Bh,Ch)})(ih,(Bh,Ch)=>{Bh!=null?ol(Bh):Ch!=null&&ol(null,Ch,{cacheControl:ph,expires:Lh})}),ls.cancelled||(ls.completed=!0,A--,Ft()||Y.processQueue())})};Y.processQueue=(ls=0)=>{ls<=0&&(ls=Ft()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS);for(let $s=A;$s<ls&&g.length>0;$s++){const ol=g.shift();if(ol.cancelled)continue;const nh=Gn(ol);A++,ol.innerRequest=nh,ol.cancel=()=>{var ih;(ih=ol).completed||ih.cancelled||(A--,ih.cancelled=!0,ih.innerRequest.cancel(),Y.processQueue())}}return g.length}}(as||(as={})),as.resetRequestQueue();var Js,lh=as;(function(Y){Y.Glyphs="Glyphs",Y.Image="Image",Y.Source="Source",Y.SpriteImage="SpriteImage",Y.SpriteJSON="SpriteJSON",Y.Style="Style",Y.Tile="Tile",Y.Unknown="Unknown"})(Js||(Js={}));class ch{constructor(g){this._transformRequestFn=g}transformRequest(g,A){return this._transformRequestFn&&this._transformRequestFn(g,A)||{url:g}}normalizeSpriteURL(g,A,q){const ze=function(Ft){const Gn=Ft.match(Zu);if(!Gn)throw new Error(`Unable to parse URL "${Ft}"`);return{protocol:Gn[1],authority:Gn[2],path:Gn[3]||"/",params:Gn[4]?Gn[4].split("&"):[]}}(g);return ze.path+=`${A}${q}`,function(Ft){const Gn=Ft.params.length?`?${Ft.params.join("&")}`:"";return`${Ft.protocol}://${Ft.authority}${Ft.path}${Gn}`}(ze)}setTransformRequest(g){this._transformRequestFn=g}}const Zu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function th(Y){var g=new o.ARRAY_TYPE(3);return g[0]=Y[0],g[1]=Y[1],g[2]=Y[2],g}var sl,sh=function(Y,g,A){return Y[0]=g[0]-A[0],Y[1]=g[1]-A[1],Y[2]=g[2]-A[2],Y};sl=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(sl[0]=0,sl[1]=0,sl[2]=0);var xh=function(Y){var g=Y[0],A=Y[1];return g*g+A*A};function Mh(Y){return typeof Y=="string"?[{id:"default",url:Y}]:Y??[]}(function(){var Y=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(Y[0]=0,Y[1]=0)})();class Dh{constructor(g,A,q,ze){this.context=g,this.format=q,this.texture=g.gl.createTexture(),this.update(A,ze)}update(g,A,q){const{width:ze,height:Ft}=g,Gn=!(this.size&&this.size[0]===ze&&this.size[1]===Ft||q),{context:ls}=this,{gl:$s}=ls;if(this.useMipmap=!!(A&&A.useMipmap),$s.bindTexture($s.TEXTURE_2D,this.texture),ls.pixelStoreUnpackFlipY.set(!1),ls.pixelStoreUnpack.set(1),ls.pixelStoreUnpackPremultiplyAlpha.set(this.format===$s.RGBA&&(!A||A.premultiply!==!1)),Gn)this.size=[ze,Ft],g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?$s.texImage2D($s.TEXTURE_2D,0,this.format,this.format,$s.UNSIGNED_BYTE,g):$s.texImage2D($s.TEXTURE_2D,0,this.format,ze,Ft,0,this.format,$s.UNSIGNED_BYTE,g.data);else{const{x:ol,y:nh}=q||{x:0,y:0};g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?$s.texSubImage2D($s.TEXTURE_2D,0,ol,nh,$s.RGBA,$s.UNSIGNED_BYTE,g):$s.texSubImage2D($s.TEXTURE_2D,0,ol,nh,ze,Ft,$s.RGBA,$s.UNSIGNED_BYTE,g.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$s.generateMipmap($s.TEXTURE_2D)}bind(g,A,q){const{context:ze}=this,{gl:Ft}=ze;Ft.bindTexture(Ft.TEXTURE_2D,this.texture),q!==Ft.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(q=Ft.LINEAR),g!==this.filter&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MAG_FILTER,g),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,q||g),this.filter=g),A!==this.wrap&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_S,A),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_T,A),this.wrap=A)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}}function Uh(Y){const{userImage:g}=Y;return!!(g&&g.render&&g.render())&&(Y.data.replace(new Uint8Array(g.data.buffer)),!0)}class cd extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(g){if(this.loaded!==g&&(this.loaded=g,g)){for(const{ids:A,callback:q}of this.requestors)this._notify(A,q);this.requestors=[]}}getImage(g){const A=this.images[g];if(A&&!A.data&&A.spriteData){const q=A.spriteData;A.data=new o.RGBAImage({width:q.width,height:q.height},q.context.getImageData(q.x,q.y,q.width,q.height).data),A.spriteData=null}return A}addImage(g,A){if(this.images[g])throw new Error(`Image id ${g} already exist, use updateImage instead`);this._validate(g,A)&&(this.images[g]=A)}_validate(g,A){let q=!0;const ze=A.data||A.spriteData;return this._validateStretch(A.stretchX,ze&&ze.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchX" value`))),q=!1),this._validateStretch(A.stretchY,ze&&ze.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchY" value`))),q=!1),this._validateContent(A.content,A)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "content" value`))),q=!1),q}_validateStretch(g,A){if(!g)return!0;let q=0;for(const ze of g){if(ze[0]<q||ze[1]<ze[0]||A<ze[1])return!1;q=ze[1]}return!0}_validateContent(g,A){if(!g)return!0;if(g.length!==4)return!1;const q=A.spriteData,ze=q&&q.width||A.data.width,Ft=q&&q.height||A.data.height;return!(g[0]<0||ze<g[0]||g[1]<0||Ft<g[1]||g[2]<0||ze<g[2]||g[3]<0||Ft<g[3]||g[2]<g[0]||g[3]<g[1])}updateImage(g,A,q=!0){const ze=this.getImage(g);if(q&&(ze.data.width!==A.data.width||ze.data.height!==A.data.height))throw new Error(`size mismatch between old image (${ze.data.width}x${ze.data.height}) and new image (${A.data.width}x${A.data.height}).`);A.version=ze.version+1,this.images[g]=A,this.updatedImages[g]=!0}removeImage(g){const A=this.images[g];delete this.images[g],delete this.patterns[g],A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(g,A){let q=!0;if(!this.isLoaded())for(const ze of g)this.images[ze]||(q=!1);this.isLoaded()||q?this._notify(g,A):this.requestors.push({ids:g,callback:A})}_notify(g,A){const q={};for(const ze of g){const Ft=this.getImage(ze);Ft?q[ze]={data:Ft.data.clone(),pixelRatio:Ft.pixelRatio,sdf:Ft.sdf,version:Ft.version,stretchX:Ft.stretchX,stretchY:Ft.stretchY,content:Ft.content,hasRenderCallback:!!(Ft.userImage&&Ft.userImage.render)}:(this.fire(new o.Event("styleimagemissing",{id:ze})),o.warnOnce(`Image "${ze}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`))}A(null,q)}getPixelSize(){const{width:g,height:A}=this.atlasImage;return{width:g,height:A}}getPattern(g){const A=this.patterns[g],q=this.getImage(g);if(!q)return null;if(A&&A.position.version===q.version)return A.position;if(A)A.position.version=q.version;else{const ze={w:q.data.width+2,h:q.data.height+2,x:0,y:0},Ft=new o.ImagePosition(ze,q);this.patterns[g]={bin:ze,position:Ft}}return this._updatePatternAtlas(),this.patterns[g].position}bind(g){const A=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Dh(g,this.atlasImage,A.RGBA),this.atlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE)}_updatePatternAtlas(){const g=[];for(const Ft in this.patterns)g.push(this.patterns[Ft].bin);const{w:A,h:q}=o.potpack(g),ze=this.atlasImage;ze.resize({width:A||1,height:q||1});for(const Ft in this.patterns){const{bin:Gn}=this.patterns[Ft],ls=Gn.x+1,$s=Gn.y+1,ol=this.getImage(Ft).data,nh=ol.width,ih=ol.height;o.RGBAImage.copy(ol,ze,{x:0,y:0},{x:ls,y:$s},{width:nh,height:ih}),o.RGBAImage.copy(ol,ze,{x:0,y:ih-1},{x:ls,y:$s-1},{width:nh,height:1}),o.RGBAImage.copy(ol,ze,{x:0,y:0},{x:ls,y:$s+ih},{width:nh,height:1}),o.RGBAImage.copy(ol,ze,{x:nh-1,y:0},{x:ls-1,y:$s},{width:1,height:ih}),o.RGBAImage.copy(ol,ze,{x:0,y:0},{x:ls+nh,y:$s},{width:1,height:ih})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(g){for(const A of g){if(this.callbackDispatchedThisFrame[A])continue;this.callbackDispatchedThisFrame[A]=!0;const q=this.getImage(A);q||o.warnOnce(`Image with ID: "${A}" was not found`),Uh(q)&&this.updateImage(A,q)}}}const Tf=1e20;function yf(Y,g,A,q,ze,Ft,Gn,ls,$s){for(let ol=g;ol<g+q;ol++)Af(Y,A*Ft+ol,Ft,ze,Gn,ls,$s);for(let ol=A;ol<A+ze;ol++)Af(Y,ol*Ft+g,1,q,Gn,ls,$s)}function Af(Y,g,A,q,ze,Ft,Gn){Ft[0]=0,Gn[0]=-Tf,Gn[1]=Tf,ze[0]=Y[g];for(let ls=1,$s=0,ol=0;ls<q;ls++){ze[ls]=Y[g+ls*A];const nh=ls*ls;do{const ih=Ft[$s];ol=(ze[ls]-ze[ih]+nh-ih*ih)/(ls-ih)/2}while(ol<=Gn[$s]&&--$s>-1);$s++,Ft[$s]=ls,Gn[$s]=ol,Gn[$s+1]=Tf}for(let ls=0,$s=0;ls<q;ls++){for(;Gn[$s+1]<ls;)$s++;const ol=Ft[$s],nh=ls-ol;Y[g+ls*A]=ze[ol]+nh*nh}}class md{constructor(g,A){this.requestManager=g,this.localIdeographFontFamily=A,this.entries={}}setURL(g){this.url=g}getGlyphs(g,A){const q=[];for(const ze in g)for(const Ft of g[ze])q.push({stack:ze,id:Ft});o.asyncAll(q,({stack:ze,id:Ft},Gn)=>{let ls=this.entries[ze];ls||(ls=this.entries[ze]={glyphs:{},requests:{},ranges:{}});let $s=ls.glyphs[Ft];if($s!==void 0)return void Gn(null,{stack:ze,id:Ft,glyph:$s});if($s=this._tinySDF(ls,ze,Ft),$s)return ls.glyphs[Ft]=$s,void Gn(null,{stack:ze,id:Ft,glyph:$s});const ol=Math.floor(Ft/256);if(256*ol>65535)return void Gn(new Error("glyphs > 65535 not supported"));if(ls.ranges[ol])return void Gn(null,{stack:ze,id:Ft,glyph:$s});if(!this.url)return void Gn(new Error("glyphsUrl is not set"));let nh=ls.requests[ol];nh||(nh=ls.requests[ol]=[],md.loadGlyphRange(ze,ol,this.url,this.requestManager,(ih,ph)=>{if(ph){for(const Lh in ph)this._doesCharSupportLocalGlyph(+Lh)||(ls.glyphs[+Lh]=ph[+Lh]);ls.ranges[ol]=!0}for(const Lh of nh)Lh(ih,ph);delete ls.requests[ol]})),nh.push((ih,ph)=>{ih?Gn(ih):ph&&Gn(null,{stack:ze,id:Ft,glyph:ph[Ft]||null})})},(ze,Ft)=>{if(ze)A(ze);else if(Ft){const Gn={};for(const{stack:ls,id:$s,glyph:ol}of Ft)(Gn[ls]||(Gn[ls]={}))[$s]=ol&&{id:ol.id,bitmap:ol.bitmap.clone(),metrics:ol.metrics};A(null,Gn)}})}_doesCharSupportLocalGlyph(g){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](g)||o.unicodeBlockLookup["Hangul Syllables"](g)||o.unicodeBlockLookup.Hiragana(g)||o.unicodeBlockLookup.Katakana(g))}_tinySDF(g,A,q){const ze=this.localIdeographFontFamily;if(!ze||!this._doesCharSupportLocalGlyph(q))return;let Ft=g.tinySDF;if(!Ft){let ls="400";/bold/i.test(A)?ls="900":/medium/i.test(A)?ls="500":/light/i.test(A)&&(ls="200"),Ft=g.tinySDF=new md.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:ze,fontWeight:ls})}const Gn=Ft.draw(String.fromCharCode(q));return{id:q,bitmap:new o.AlphaImage({width:Gn.width||30,height:Gn.height||30},Gn.data),metrics:{width:Gn.glyphWidth||24,height:Gn.glyphHeight||24,left:Gn.glyphLeft||0,top:Gn.glyphTop-27||-8,advance:Gn.glyphAdvance||24}}}}md.loadGlyphRange=function(Y,g,A,q,ze){const Ft=256*g,Gn=Ft+255,ls=q.transformRequest(A.replace("{fontstack}",Y).replace("{range}",`${Ft}-${Gn}`),Js.Glyphs);o.getArrayBuffer(ls,($s,ol)=>{if($s)ze($s);else if(ol){const nh={};for(const ih of o.parseGlyphPbf(ol))nh[ih.id]=ih;ze(null,nh)}})},md.TinySDF=class{constructor({fontSize:Y=24,buffer:g=3,radius:A=8,cutoff:q=.25,fontFamily:ze="sans-serif",fontWeight:Ft="normal",fontStyle:Gn="normal"}={}){this.buffer=g,this.cutoff=q,this.radius=A;const ls=this.size=Y+4*g,$s=this._createCanvas(ls),ol=this.ctx=$s.getContext("2d",{willReadFrequently:!0});ol.font=`${Gn} ${Ft} ${Y}px ${ze}`,ol.textBaseline="alphabetic",ol.textAlign="left",ol.fillStyle="black",this.gridOuter=new Float64Array(ls*ls),this.gridInner=new Float64Array(ls*ls),this.f=new Float64Array(ls),this.z=new Float64Array(ls+1),this.v=new Uint16Array(ls)}_createCanvas(Y){const g=document.createElement("canvas");return g.width=g.height=Y,g}draw(Y){const{width:g,actualBoundingBoxAscent:A,actualBoundingBoxDescent:q,actualBoundingBoxLeft:ze,actualBoundingBoxRight:Ft}=this.ctx.measureText(Y),Gn=Math.ceil(A),ls=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(Ft-ze))),$s=Math.min(this.size-this.buffer,Gn+Math.ceil(q)),ol=ls+2*this.buffer,nh=$s+2*this.buffer,ih=Math.max(ol*nh,0),ph=new Uint8ClampedArray(ih),Lh={data:ph,width:ol,height:nh,glyphWidth:ls,glyphHeight:$s,glyphTop:Gn,glyphLeft:0,glyphAdvance:g};if(ls===0||$s===0)return Lh;const{ctx:Bh,buffer:Ch,gridInner:Kh,gridOuter:fd}=this;Bh.clearRect(Ch,Ch,ls,$s),Bh.fillText(Y,Ch,Ch+Gn);const ud=Bh.getImageData(Ch,Ch,ls,$s);fd.fill(Tf,0,ih),Kh.fill(0,0,ih);for(let jh=0;jh<$s;jh++)for(let Sd=0;Sd<ls;Sd++){const Vd=ud.data[4*(jh*ls+Sd)+3]/255;if(Vd===0)continue;const Wd=(jh+Ch)*ol+Sd+Ch;if(Vd===1)fd[Wd]=0,Kh[Wd]=Tf;else{const Cf=.5-Vd;fd[Wd]=Cf>0?Cf*Cf:0,Kh[Wd]=Cf<0?Cf*Cf:0}}yf(fd,0,0,ol,nh,ol,this.f,this.v,this.z),yf(Kh,Ch,Ch,ls,$s,ol,this.f,this.v,this.z);for(let jh=0;jh<ih;jh++){const Sd=Math.sqrt(fd[jh])-Math.sqrt(Kh[jh]);ph[jh]=Math.round(255-255*(Sd/this.radius+this.cutoff))}return Lh}};const vd=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(Y,g){return o.sphericalToCartesian(Y.expression.evaluate(g))}interpolate(Y,g,A){return{x:o.number(Y.x,g.x,A),y:o.number(Y.y,g.y,A),z:o.number(Y.z,g.z,A)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),qd="-transition";class Ed extends o.Evented{constructor(g){super(),this._transitionable=new o.Transitionable(vd),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(g,A={}){if(!this._validate(o.validateLight,g,A))for(const q in g){const ze=g[q];q.endsWith(qd)?this._transitionable.setTransition(q.slice(0,-qd.length),ze):this._transitionable.setValue(q,ze)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,A,q){return(!q||q.validate!==!1)&&o.emitValidationErrors(this,g.call(o.validateStyle,o.extend({value:A,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Td{constructor(g,A){this.width=g,this.height=A,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(g,A){const q=g.join(",")+String(A);return this.dashEntry[q]||(this.dashEntry[q]=this.addDash(g,A)),this.dashEntry[q]}getDashRanges(g,A,q){const ze=[];let Ft=g.length%2==1?-g[g.length-1]*q:0,Gn=g[0]*q,ls=!0;ze.push({left:Ft,right:Gn,isDash:ls,zeroLength:g[0]===0});let $s=g[0];for(let ol=1;ol<g.length;ol++){ls=!ls;const nh=g[ol];Ft=$s*q,$s+=nh,Gn=$s*q,ze.push({left:Ft,right:Gn,isDash:ls,zeroLength:nh===0})}return ze}addRoundDash(g,A,q){const ze=A/2;for(let Ft=-q;Ft<=q;Ft++){const Gn=this.width*(this.nextRow+q+Ft);let ls=0,$s=g[ls];for(let ol=0;ol<this.width;ol++){ol/$s.right>1&&($s=g[++ls]);const nh=Math.abs(ol-$s.left),ih=Math.abs(ol-$s.right),ph=Math.min(nh,ih);let Lh;const Bh=Ft/q*(ze+1);if($s.isDash){const Ch=ze-Math.abs(Bh);Lh=Math.sqrt(ph*ph+Ch*Ch)}else Lh=ze-Math.sqrt(ph*ph+Bh*Bh);this.data[Gn+ol]=Math.max(0,Math.min(255,Lh+128))}}}addRegularDash(g){for(let ls=g.length-1;ls>=0;--ls){const $s=g[ls],ol=g[ls+1];$s.zeroLength?g.splice(ls,1):ol&&ol.isDash===$s.isDash&&(ol.left=$s.left,g.splice(ls,1))}const A=g[0],q=g[g.length-1];A.isDash===q.isDash&&(A.left=q.left-this.width,q.right=A.right+this.width);const ze=this.width*this.nextRow;let Ft=0,Gn=g[Ft];for(let ls=0;ls<this.width;ls++){ls/Gn.right>1&&(Gn=g[++Ft]);const $s=Math.abs(ls-Gn.left),ol=Math.abs(ls-Gn.right),nh=Math.min($s,ol);this.data[ze+ls]=Math.max(0,Math.min(255,(Gn.isDash?nh:-nh)+128))}}addDash(g,A){const q=A?7:0,ze=2*q+1;if(this.nextRow+ze>this.height)return o.warnOnce("LineAtlas out of space"),null;let Ft=0;for(let ls=0;ls<g.length;ls++)Ft+=g[ls];if(Ft!==0){const ls=this.width/Ft,$s=this.getDashRanges(g,this.width,ls);A?this.addRoundDash($s,ls,q):this.addRegularDash($s)}const Gn={y:(this.nextRow+q+.5)/this.height,height:2*q/this.height,width:Ft};return this.nextRow+=ze,this.dirty=!0,Gn}bind(g){const A=g.gl;this.texture?(A.bindTexture(A.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,A.texSubImage2D(A.TEXTURE_2D,0,0,0,this.width,this.height,A.ALPHA,A.UNSIGNED_BYTE,this.data))):(this.texture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.texture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texImage2D(A.TEXTURE_2D,0,A.ALPHA,this.width,this.height,0,A.ALPHA,A.UNSIGNED_BYTE,this.data))}}class Fd{constructor(g,A,q){this.workerPool=g,this.actors=[],this.currentActor=0,this.id=q;const ze=this.workerPool.acquire(q);for(let Ft=0;Ft<ze.length;Ft++){const Gn=new Fd.Actor(ze[Ft],A,q);Gn.name=`Worker ${Ft}`,this.actors.push(Gn)}if(!this.actors.length)throw new Error("No actors found")}broadcast(g,A,q){o.asyncAll(this.actors,(ze,Ft)=>{ze.send(g,A,Ft)},q=q||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(g=!0){this.actors.forEach(A=>{A.remove()}),this.actors=[],g&&this.workerPool.release(this.id)}}function Cd(Y,g,A){const q=function(ze,Ft){if(ze)return A(ze);if(Ft){const Gn=o.pick(o.extend(Ft,Y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);Ft.vector_layers&&(Gn.vectorLayers=Ft.vector_layers,Gn.vectorLayerIds=Gn.vectorLayers.map(ls=>ls.id)),A(null,Gn)}};return Y.url?o.getJSON(g.transformRequest(Y.url,Js.Source),q):o.exported.frame(()=>q(null,Y))}Fd.Actor=o.Actor;class Gd{constructor(g,A,q){this.bounds=o.LngLatBounds.convert(this.validateBounds(g)),this.minzoom=A||0,this.maxzoom=q||24}validateBounds(g){return Array.isArray(g)&&g.length===4?[Math.max(-180,g[0]),Math.max(-90,g[1]),Math.min(180,g[2]),Math.min(90,g[3])]:[-180,-90,180,90]}contains(g){const A=Math.pow(2,g.z),q=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*A),ze=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*A),Ft=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*A),Gn=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*A);return g.x>=q&&g.x<Ft&&g.y>=ze&&g.y<Gn}}class bf extends o.Evented{constructor(g,A,q,ze){if(super(),this.id=g,this.dispatcher=q,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(A,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},A),this._collectResourceTiming=A.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ze)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Cd(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Gd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ze={request:this.map._requestManager.transformRequest(q,Js.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function Ft(Gn,ls){return delete g.request,g.aborted?A(null):Gn&&Gn.status!==404?A(Gn):(ls&&ls.resourceTiming&&(g.resourceTiming=ls.resourceTiming),this.map._refreshExpiredTiles&&ls&&g.setExpiryData(ls),g.loadVectorData(ls,this.map.painter),A(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}ze.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=A:g.request=g.actor.send("reloadTile",ze,Ft.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",ze,Ft.bind(this)))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Id extends o.Evented{constructor(g,A,q,ze){super(),this.id=g,this.dispatcher=q,this.setEventedParent(ze),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},A),o.extend(this,o.pick(A,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Cd(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Gd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(g){this.map=g,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);g.request=lh.getImage(this.map._requestManager.transformRequest(q,Js.Tile),(ze,Ft,Gn)=>{if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(ze)g.state="errored",A(ze);else if(Ft){this.map._refreshExpiredTiles&&g.setExpiryData(Gn);const ls=this.map.painter.context,$s=ls.gl;g.texture=this.map.painter.getTileTexture(Ft.width),g.texture?g.texture.update(Ft,{useMipmap:!0}):(g.texture=new Dh(ls,Ft,$s.RGBA,{useMipmap:!0}),g.texture.bind($s.LINEAR,$s.CLAMP_TO_EDGE,$s.LINEAR_MIPMAP_NEAREST),ls.extTextureFilterAnisotropic&&$s.texParameterf($s.TEXTURE_2D,ls.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ls.extTextureFilterAnisotropicMax)),g.state="loaded",A(null)}})}abortTile(g,A){g.request&&(g.request.cancel(),delete g.request),A()}unloadTile(g,A){g.texture&&this.map.painter.saveTileTexture(g.texture),A()}hasTransition(){return!1}}let td;class $d extends Id{constructor(g,A,q,ze){super(g,A,q,ze),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},A),this.encoding=A.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function ze(Ft,Gn){Ft&&(g.state="errored",A(Ft)),Gn&&(g.dem=Gn,g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0,g.state="loaded",A(null))}g.request=lh.getImage(this.map._requestManager.transformRequest(q,Js.Tile),function(Ft,Gn){if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(Ft)g.state="errored",A(Ft);else if(Gn){this.map._refreshExpiredTiles&&g.setExpiryData(Gn),delete Gn.cacheControl,delete Gn.expires;const ls=o.isImageBitmap(Gn)&&(td==null&&(td=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),td)?Gn:o.exported.getImageData(Gn,1),$s={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:ls,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",$s,ze.bind(this)))}}.bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)}_getNeighboringTiles(g){const A=g.canonical,q=Math.pow(2,A.z),ze=(A.x-1+q)%q,Ft=A.x===0?g.wrap-1:g.wrap,Gn=(A.x+1+q)%q,ls=A.x+1===q?g.wrap+1:g.wrap,$s={};return $s[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,ze,A.y).key]={backfilled:!1},$s[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Gn,A.y).key]={backfilled:!1},A.y>0&&($s[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,ze,A.y-1).key]={backfilled:!1},$s[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y-1).key]={backfilled:!1},$s[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Gn,A.y-1).key]={backfilled:!1}),A.y+1<q&&($s[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,ze,A.y+1).key]={backfilled:!1},$s[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y+1).key]={backfilled:!1},$s[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Gn,A.y+1).key]={backfilled:!1}),$s}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})}}class np extends o.Evented{constructor(g,A,q,ze){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=q.getActor(),this.setEventedParent(ze),this._data=A.data,this._options=o.extend({},A),this._collectResourceTiming=A.collectResourceTiming,A.maxzoom!==void 0&&(this.maxzoom=A.maxzoom),A.type&&(this.type=A.type),A.attribution&&(this.attribution=A.attribution),this.promoteId=A.promoteId;const Ft=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:A.cluster||!1,geojsonVtOptions:{buffer:(A.buffer!==void 0?A.buffer:128)*Ft,tolerance:(A.tolerance!==void 0?A.tolerance:.375)*Ft,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:A.lineMetrics||!1,generateId:A.generateId||!1},superclusterOptions:{maxZoom:A.clusterMaxZoom!==void 0?A.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,A.clusterMinPoints||2),extent:o.EXTENT,radius:(A.clusterRadius||50)*Ft,log:!1,generateId:A.generateId||!1},clusterProperties:A.clusterProperties,filter:A.filter},A.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(g){this.map=g,this.load()}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){return this._updateWorkerData(g),this}setClusterOptions(g){return this.workerOptions.cluster=g.cluster,g&&(g.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=g.clusterRadius),g.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=g.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(g,A){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},A),this}getClusterChildren(g,A){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},A),this}getClusterLeaves(g,A,q,ze){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:A,offset:q},ze),this}_updateWorkerData(g){const A=o.extend({},this.workerOptions);g?A.dataDiff=g:typeof this._data=="string"?(A.request=this.map._requestManager.transformRequest(o.exported.resolveURL(this._data),Js.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,A,(q,ze)=>{if(this._pendingLoads--,this._removed||ze&&ze.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let Ft=null;if(ze&&ze.resourceTiming&&ze.resourceTiming[this.id]&&(Ft=ze.resourceTiming[this.id].slice(0)),q)return void this.fire(new o.ErrorEvent(q));const Gn={dataType:"source"};this._collectResourceTiming&&Ft&&Ft.length>0&&o.extend(Gn,{resourceTiming:Ft}),this.fire(new o.Event("data",{...Gn,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...Gn,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(g,A){const q=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const ze={type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request=this.actor.send(q,ze,(Ft,Gn)=>(delete g.request,g.unloadVectorData(),g.aborted?A(null):Ft?A(Ft):(g.loadVectorData(Gn,this.map.painter,q==="reloadTile"),A(null))))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jf=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class yd extends o.Evented{constructor(g,A,q,ze){super(),this.id=g,this.dispatcher=q,this.coordinates=A.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ze),this.options=A}load(g,A){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=lh.getImage(this.map._requestManager.transformRequest(this.url,Js.Image),(q,ze)=>{this._request=null,this._loaded=!0,q?this.fire(new o.ErrorEvent(q)):ze&&(this.image=ze,g&&(this.coordinates=g),A&&A(),this._finishLoading())})}loaded(){return this._loaded}updateImage(g){return g.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=g.url,this.load(g.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(g){this.map=g,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(g){this.coordinates=g;const A=g.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(ze){let Ft=1/0,Gn=1/0,ls=-1/0,$s=-1/0;for(const ph of ze)Ft=Math.min(Ft,ph.x),Gn=Math.min(Gn,ph.y),ls=Math.max(ls,ph.x),$s=Math.max($s,ph.y);const ol=Math.max(ls-Ft,$s-Gn),nh=Math.max(0,Math.floor(-Math.log(ol)/Math.LN2)),ih=Math.pow(2,nh);return new o.CanonicalTileID(nh,Math.floor((Ft+ls)/2*ih),Math.floor((Gn+$s)/2*ih))}(A),this.minzoom=this.maxzoom=this.tileID.z;const q=A.map(ze=>this.tileID.getTilePoint(ze)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(q[0].x,q[0].y,0,0),this._boundsArray.emplaceBack(q[1].x,q[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(q[3].x,q[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(q[2].x,q[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Dh(g,this.image,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const q in this.tiles){const ze=this.tiles[q];ze.state!=="loaded"&&(ze.state="loaded",ze.texture=this.texture)}}loadTile(g,A){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},A(null)):(g.state="errored",A(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Qd extends yd{constructor(g,A,q,ze){super(g,A,q,ze),this.roundZoom=!0,this.type="video",this.options=A}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const A of g.urls)this.urls.push(this.map._requestManager.transformRequest(A,Js.Source).url);o.getVideo(this.urls,(A,q)=>{this._loaded=!0,A?this.fire(new o.ErrorEvent(A)):q&&(this.video=q,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const A=this.video.seekable;g<A.start(0)||g>A.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${A.start(0)} and ${A.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.texSubImage2D(A.TEXTURE_2D,0,0,0,A.RGBA,A.UNSIGNED_BYTE,this.video)):(this.texture=new Dh(g,this.video,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const q in this.tiles){const ze=this.tiles[q];ze.state!=="loaded"&&(ze.state="loaded",ze.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class op extends yd{constructor(g,A,q,ze){super(g,A,q,ze),A.coordinates?Array.isArray(A.coordinates)&&A.coordinates.length===4&&!A.coordinates.some(Ft=>!Array.isArray(Ft)||Ft.length!==2||Ft.some(Gn=>typeof Gn!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),A.animate&&typeof A.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),A.canvas?typeof A.canvas=="string"||A.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=A,this.animate=A.animate===void 0||A.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const A=this.map.painter.context,q=A.gl;this.boundsBuffer||(this.boundsBuffer=A.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Dh(A,this.canvas,q.RGBA,{premultiply:!0});for(const ze in this.tiles){const Ft=this.tiles[ze];Ft.state!=="loaded"&&(Ft.state="loaded",Ft.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}const bp={vector:bf,raster:Id,"raster-dem":$d,geojson:np,video:Qd,image:yd,canvas:op};function fp(Y,g){const A=o.create();return o.translate(A,A,[1,1,0]),o.scale(A,A,[.5*Y.width,.5*Y.height,1]),o.multiply(A,A,Y.calculatePosMatrix(g.toUnwrapped()))}function Qh(Y,g,A,q,ze,Ft){const Gn=function(ih,ph,Lh){if(ih)for(const Bh of ih){const Ch=ph[Bh];if(Ch&&Ch.source===Lh&&Ch.type==="fill-extrusion")return!0}else for(const Bh in ph){const Ch=ph[Bh];if(Ch.source===Lh&&Ch.type==="fill-extrusion")return!0}return!1}(ze&&ze.layers,g,Y.id),ls=Ft.maxPitchScaleFactor(),$s=Y.tilesIn(q,ls,Gn);$s.sort(Yd);const ol=[];for(const ih of $s)ol.push({wrappedTileID:ih.tileID.wrapped().key,queryResults:ih.tile.queryRenderedFeatures(g,A,Y._state,ih.queryGeometry,ih.cameraQueryGeometry,ih.scale,ze,Ft,ls,fp(Y.transform,ih.tileID))});const nh=function(ih){const ph={},Lh={};for(const Bh of ih){const Ch=Bh.queryResults,Kh=Bh.wrappedTileID,fd=Lh[Kh]=Lh[Kh]||{};for(const ud in Ch){const jh=Ch[ud],Sd=fd[ud]=fd[ud]||{},Vd=ph[ud]=ph[ud]||[];for(const Wd of jh)Sd[Wd.featureIndex]||(Sd[Wd.featureIndex]=!0,Vd.push(Wd))}}return ph}(ol);for(const ih in nh)nh[ih].forEach(ph=>{const Lh=ph.feature,Bh=Y.getFeatureState(Lh.layer["source-layer"],Lh.id);Lh.source=Lh.layer.source,Lh.layer["source-layer"]&&(Lh.sourceLayer=Lh.layer["source-layer"]),Lh.state=Bh});return nh}function Yd(Y,g){const A=Y.tileID,q=g.tileID;return A.overscaledZ-q.overscaledZ||A.canonical.y-q.canonical.y||A.wrap-q.wrap||A.canonical.x-q.canonical.x}class ad{constructor(g,A){this.tileID=g,this.uid=o.uniqueId(),this.uses=0,this.tileSize=A,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(g){const A=g+this.timeAdded;A<o.exported.now()||this.fadeEndTime&&A<this.fadeEndTime||(this.fadeEndTime=A)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(g){this.demTexture&&g.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(g,A,q){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",g){g.featureIndex&&(this.latestFeatureIndex=g.featureIndex,g.rawTileData?(this.latestRawTileData=g.rawTileData,this.latestFeatureIndex.rawTileData=g.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=g.collisionBoxArray,this.buckets=function(ze,Ft){const Gn={};if(!Ft)return Gn;for(const ls of ze){const $s=ls.layerIds.map(ol=>Ft.getLayer(ol)).filter(Boolean);if($s.length!==0){ls.layers=$s,ls.stateDependentLayerIds&&(ls.stateDependentLayers=ls.stateDependentLayerIds.map(ol=>$s.filter(nh=>nh.id===ol)[0]));for(const ol of $s)Gn[ol.id]=ls}}return Gn}(g.buckets,A.style),this.hasSymbolBuckets=!1;for(const ze in this.buckets){const Ft=this.buckets[ze];if(Ft instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!q)break;Ft.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const ze in this.buckets){const Ft=this.buckets[ze];if(Ft instanceof o.SymbolBucket&&Ft.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const ze in this.buckets){const Ft=this.buckets[ze];this.queryPadding=Math.max(this.queryPadding,A.style.getLayer(ze).queryRadius(Ft))}g.imageAtlas&&(this.imageAtlas=g.imageAtlas),g.glyphAtlasImage&&(this.glyphAtlasImage=g.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const g in this.buckets)this.buckets[g].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(g){return this.buckets[g.id]}upload(g){for(const q in this.buckets){const ze=this.buckets[q];ze.uploadPending()&&ze.upload(g)}const A=g.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dh(g,this.imageAtlas.image,A.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dh(g,this.glyphAtlasImage,A.ALPHA),this.glyphAtlasImage=null)}prepare(g){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(g,this.imageAtlasTexture)}queryRenderedFeatures(g,A,q,ze,Ft,Gn,ls,$s,ol,nh){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:ze,cameraQueryGeometry:Ft,scale:Gn,tileSize:this.tileSize,pixelPosMatrix:nh,transform:$s,params:ls,queryPadding:this.queryPadding*ol},g,A,q):{}}querySourceFeatures(g,A){const q=this.latestFeatureIndex;if(!q||!q.rawTileData)return;const ze=q.loadVTLayers(),Ft=A&&A.sourceLayer?A.sourceLayer:"",Gn=ze._geojsonTileLayer||ze[Ft];if(!Gn)return;const ls=o.createFilter(A&&A.filter),{z:$s,x:ol,y:nh}=this.tileID.canonical,ih={z:$s,x:ol,y:nh};for(let ph=0;ph<Gn.length;ph++){const Lh=Gn.feature(ph);if(ls.needGeometry){const Kh=o.toEvaluationFeature(Lh,!0);if(!ls.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Kh,this.tileID.canonical))continue}else if(!ls.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Lh))continue;const Bh=q.getId(Lh,Ft),Ch=new o.GeoJSONFeature(Lh,$s,ol,nh,Bh);Ch.tile=ih,g.push(Ch)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(g){const A=this.expirationTime;if(g.cacheControl){const q=o.parseCacheControl(g.cacheControl);q["max-age"]&&(this.expirationTime=Date.now()+1e3*q["max-age"])}else g.expires&&(this.expirationTime=new Date(g.expires).getTime());if(this.expirationTime){const q=Date.now();let ze=!1;if(this.expirationTime>q)ze=!1;else if(A)if(this.expirationTime<A)ze=!0;else{const Ft=this.expirationTime-A;Ft?this.expirationTime=q+Math.max(Ft,3e4):ze=!0}else ze=!0;ze?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(g,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(g).length===0)return;const q=this.latestFeatureIndex.loadVTLayers();for(const ze in this.buckets){if(!A.style.hasLayer(ze))continue;const Ft=this.buckets[ze],Gn=Ft.layers[0].sourceLayer||"_geojsonTileLayer",ls=q[Gn],$s=g[Gn];if(!ls||!$s||Object.keys($s).length===0)continue;Ft.update($s,ls,this.imageAtlas&&this.imageAtlas.patternPositions||{});const ol=A&&A.style&&A.style.getLayer(ze);ol&&(this.queryPadding=Math.max(this.queryPadding,ol.queryRadius(Ft)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(g){this.symbolFadeHoldUntil=o.exported.now()+g}setDependencies(g,A){const q={};for(const ze of A)q[ze]=!0;this.dependencies[g]=q}hasDependency(g,A){for(const q of g){const ze=this.dependencies[q];if(ze){for(const Ft of A)if(ze[Ft])return!0}}return!1}}class Zd{constructor(g,A){this.max=g,this.onRemove=A,this.reset()}reset(){for(const g in this.data)for(const A of this.data[g])A.timeout&&clearTimeout(A.timeout),this.onRemove(A.value);return this.data={},this.order=[],this}add(g,A,q){const ze=g.wrapped().key;this.data[ze]===void 0&&(this.data[ze]=[]);const Ft={value:A,timeout:void 0};if(q!==void 0&&(Ft.timeout=setTimeout(()=>{this.remove(g,Ft)},q)),this.data[ze].push(Ft),this.order.push(ze),this.order.length>this.max){const Gn=this._getAndRemoveByKey(this.order[0]);Gn&&this.onRemove(Gn)}return this}has(g){return g.wrapped().key in this.data}getAndRemove(g){return this.has(g)?this._getAndRemoveByKey(g.wrapped().key):null}_getAndRemoveByKey(g){const A=this.data[g].shift();return A.timeout&&clearTimeout(A.timeout),this.data[g].length===0&&delete this.data[g],this.order.splice(this.order.indexOf(g),1),A.value}getByKey(g){const A=this.data[g];return A?A[0].value:null}get(g){return this.has(g)?this.data[g.wrapped().key][0].value:null}remove(g,A){if(!this.has(g))return this;const q=g.wrapped().key,ze=A===void 0?0:this.data[q].indexOf(A),Ft=this.data[q][ze];return this.data[q].splice(ze,1),Ft.timeout&&clearTimeout(Ft.timeout),this.data[q].length===0&&delete this.data[q],this.onRemove(Ft.value),this.order.splice(this.order.indexOf(q),1),this}setMaxSize(g){for(this.max=g;this.order.length>this.max;){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}filter(g){const A=[];for(const q in this.data)for(const ze of this.data[q])g(ze.value)||A.push(ze);for(const q of A)this.remove(q.value.tileID,q)}}class Xh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(g,A,q){const ze=String(A);if(this.stateChanges[g]=this.stateChanges[g]||{},this.stateChanges[g][ze]=this.stateChanges[g][ze]||{},o.extend(this.stateChanges[g][ze],q),this.deletedStates[g]===null){this.deletedStates[g]={};for(const Ft in this.state[g])Ft!==ze&&(this.deletedStates[g][Ft]=null)}else if(this.deletedStates[g]&&this.deletedStates[g][ze]===null){this.deletedStates[g][ze]={};for(const Ft in this.state[g][ze])q[Ft]||(this.deletedStates[g][ze][Ft]=null)}else for(const Ft in q)this.deletedStates[g]&&this.deletedStates[g][ze]&&this.deletedStates[g][ze][Ft]===null&&delete this.deletedStates[g][ze][Ft]}removeFeatureState(g,A,q){if(this.deletedStates[g]===null)return;const ze=String(A);if(this.deletedStates[g]=this.deletedStates[g]||{},q&&A!==void 0)this.deletedStates[g][ze]!==null&&(this.deletedStates[g][ze]=this.deletedStates[g][ze]||{},this.deletedStates[g][ze][q]=null);else if(A!==void 0)if(this.stateChanges[g]&&this.stateChanges[g][ze])for(q in this.deletedStates[g][ze]={},this.stateChanges[g][ze])this.deletedStates[g][ze][q]=null;else this.deletedStates[g][ze]=null;else this.deletedStates[g]=null}getState(g,A){const q=String(A),ze=o.extend({},(this.state[g]||{})[q],(this.stateChanges[g]||{})[q]);if(this.deletedStates[g]===null)return{};if(this.deletedStates[g]){const Ft=this.deletedStates[g][A];if(Ft===null)return{};for(const Gn in Ft)delete ze[Gn]}return ze}initializeTileState(g,A){g.setFeatureState(this.state,A)}coalesceChanges(g,A){const q={};for(const ze in this.stateChanges){this.state[ze]=this.state[ze]||{};const Ft={};for(const Gn in this.stateChanges[ze])this.state[ze][Gn]||(this.state[ze][Gn]={}),o.extend(this.state[ze][Gn],this.stateChanges[ze][Gn]),Ft[Gn]=this.state[ze][Gn];q[ze]=Ft}for(const ze in this.deletedStates){this.state[ze]=this.state[ze]||{};const Ft={};if(this.deletedStates[ze]===null)for(const Gn in this.state[ze])Ft[Gn]={},this.state[ze][Gn]={};else for(const Gn in this.deletedStates[ze]){if(this.deletedStates[ze][Gn]===null)this.state[ze][Gn]={};else for(const ls of Object.keys(this.deletedStates[ze][Gn]))delete this.state[ze][Gn][ls];Ft[Gn]=this.state[ze][Gn]}q[ze]=q[ze]||{},o.extend(q[ze],Ft)}if(this.stateChanges={},this.deletedStates={},Object.keys(q).length!==0)for(const ze in g)g[ze].setFeatureState(q,A)}}class Ld extends o.Evented{constructor(g,A,q){super(),this.id=g,this.dispatcher=q,this.on("data",ze=>{ze.dataType==="source"&&ze.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&ze.dataType==="source"&&ze.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(ze,Ft,Gn,ls){const $s=new bp[Ft.type](ze,Ft,Gn,ls);if($s.id!==ze)throw new Error(`Expected Source id to be ${ze} instead of ${$s.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],$s),$s}(g,A,q,this),this._tiles={},this._cache=new Zd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xh}onAdd(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)}onRemove(g){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(g)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const g in this._tiles){const A=this._tiles[g];if(A.state!=="loaded"&&A.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(g,A){return this._source.loadTile(g,A)}_unloadTile(g){if(this._source.unloadTile)return this._source.unloadTile(g,()=>{})}_abortTile(g){this._source.abortTile&&this._source.abortTile(g,()=>{}),this._source.fire(new o.Event("dataabort",{tile:g,coord:g.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(g){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const A in this._tiles){const q=this._tiles[A];q.upload(g),q.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(g=>g.tileID).sort(Kf).map(g=>g.key)}getRenderableIds(g){const A=[];for(const q in this._tiles)this._isIdRenderable(q,g)&&A.push(this._tiles[q]);return g?A.sort((q,ze)=>{const Ft=q.tileID,Gn=ze.tileID,ls=new o.pointGeometry(Ft.canonical.x,Ft.canonical.y)._rotate(this.transform.angle),$s=new o.pointGeometry(Gn.canonical.x,Gn.canonical.y)._rotate(this.transform.angle);return Ft.overscaledZ-Gn.overscaledZ||$s.y-ls.y||$s.x-ls.x}).map(q=>q.tileID.key):A.map(q=>q.tileID).sort(Kf).map(q=>q.key)}hasRenderableParent(g){const A=this.findLoadedParent(g,0);return!!A&&this._isIdRenderable(A.tileID.key)}_isIdRenderable(g,A){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(A||!this._tiles[g].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const g in this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")}}_reloadTile(g,A){const q=this._tiles[g];q&&(q.state!=="loading"&&(q.state=A),this._loadTile(q,this._tileLoaded.bind(this,q,g,A)))}_tileLoaded(g,A,q,ze){if(ze)return g.state="errored",void(ze.status!==404?this._source.fire(new o.ErrorEvent(ze,{tile:g})):this.update(this.transform,this.terrain));g.timeAdded=o.exported.now(),q==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(A,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),g.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:g,coord:g.tileID}))}_backfillDEM(g){const A=this.getRenderableIds();for(let ze=0;ze<A.length;ze++){const Ft=A[ze];if(g.neighboringTiles&&g.neighboringTiles[Ft]){const Gn=this.getTileByID(Ft);q(g,Gn),q(Gn,g)}}function q(ze,Ft){ze.needsHillshadePrepare=!0,ze.needsTerrainPrepare=!0;let Gn=Ft.tileID.canonical.x-ze.tileID.canonical.x;const ls=Ft.tileID.canonical.y-ze.tileID.canonical.y,$s=Math.pow(2,ze.tileID.canonical.z),ol=Ft.tileID.key;Gn===0&&ls===0||Math.abs(ls)>1||(Math.abs(Gn)>1&&(Math.abs(Gn+$s)===1?Gn+=$s:Math.abs(Gn-$s)===1&&(Gn-=$s)),Ft.dem&&ze.dem&&(ze.dem.backfillBorder(Ft.dem,Gn,ls),ze.neighboringTiles&&ze.neighboringTiles[ol]&&(ze.neighboringTiles[ol].backfilled=!0)))}}getTile(g){return this.getTileByID(g.key)}getTileByID(g){return this._tiles[g]}_retainLoadedChildren(g,A,q,ze){for(const Ft in this._tiles){let Gn=this._tiles[Ft];if(ze[Ft]||!Gn.hasData()||Gn.tileID.overscaledZ<=A||Gn.tileID.overscaledZ>q)continue;let ls=Gn.tileID;for(;Gn&&Gn.tileID.overscaledZ>A+1;){const ol=Gn.tileID.scaledTo(Gn.tileID.overscaledZ-1);Gn=this._tiles[ol.key],Gn&&Gn.hasData()&&(ls=ol)}let $s=ls;for(;$s.overscaledZ>A;)if($s=$s.scaledTo($s.overscaledZ-1),g[$s.key]){ze[ls.key]=ls;break}}}findLoadedParent(g,A){if(g.key in this._loadedParentTiles){const q=this._loadedParentTiles[g.key];return q&&q.tileID.overscaledZ>=A?q:null}for(let q=g.overscaledZ-1;q>=A;q--){const ze=g.scaledTo(q),Ft=this._getLoadedTile(ze);if(Ft)return Ft}}_getLoadedTile(g){const A=this._tiles[g.key];return A&&A.hasData()?A:this._cache.getByKey(g.wrapped().key)}updateCacheSize(g){const A=Math.ceil(g.width/this._source.tileSize)+1,q=Math.ceil(g.height/this._source.tileSize)+1,ze=Math.floor(A*q*5),Ft=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,ze):ze;this._cache.setMaxSize(Ft)}handleWrapJump(g){const A=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,A){const q={};for(const ze in this._tiles){const Ft=this._tiles[ze];Ft.tileID=Ft.tileID.unwrapTo(Ft.tileID.wrap+A),q[Ft.tileID.key]=Ft}this._tiles=q;for(const ze in this._timers)clearTimeout(this._timers[ze]),delete this._timers[ze];for(const ze in this._tiles)this._setTileReloadTimer(ze,this._tiles[ze])}}update(g,A){if(this.transform=g,this.terrain=A,!this._sourceLoaded||this._paused)return;let q;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?q=g.getVisibleUnwrappedCoordinates(this._source.tileID).map(ol=>new o.OverscaledTileID(ol.canonical.z,ol.wrap,ol.canonical.z,ol.canonical.x,ol.canonical.y)):(q=g.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:A}),this._source.hasTile&&(q=q.filter(ol=>this._source.hasTile(ol)))):q=[];const ze=g.coveringZoomLevel(this._source),Ft=Math.max(ze-Ld.maxOverzooming,this._source.minzoom),Gn=Math.max(ze+Ld.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const ol={};for(const nh of q)if(nh.canonical.z>this._source.minzoom){const ih=nh.scaledTo(nh.canonical.z-1);ol[ih.key]=ih;const ph=nh.scaledTo(Math.max(this._source.minzoom,Math.min(nh.canonical.z,5)));ol[ph.key]=ph}q=q.concat(Object.values(ol))}const ls=this._updateRetainedTiles(q,ze);if(If(this._source.type)){const ol={},nh={},ih=Object.keys(ls);for(const ph of ih){const Lh=ls[ph],Bh=this._tiles[ph];if(!Bh||Bh.fadeEndTime&&Bh.fadeEndTime<=o.exported.now())continue;const Ch=this.findLoadedParent(Lh,Ft);Ch&&(this._addTile(Ch.tileID),ol[Ch.tileID.key]=Ch.tileID),nh[ph]=Lh}this._retainLoadedChildren(nh,ze,Gn,ls);for(const ph in ol)ls[ph]||(this._coveredTiles[ph]=!0,ls[ph]=ol[ph]);if(A){const ph={},Lh={};for(const Bh of q)this._tiles[Bh.key].hasData()?ph[Bh.key]=Bh:Lh[Bh.key]=Bh;for(const Bh in Lh){const Ch=Lh[Bh].children(this._source.maxzoom);this._tiles[Ch[0].key]&&this._tiles[Ch[1].key]&&this._tiles[Ch[2].key]&&this._tiles[Ch[3].key]&&(ph[Ch[0].key]=ls[Ch[0].key]=Ch[0],ph[Ch[1].key]=ls[Ch[1].key]=Ch[1],ph[Ch[2].key]=ls[Ch[2].key]=Ch[2],ph[Ch[3].key]=ls[Ch[3].key]=Ch[3],delete Lh[Bh])}for(const Bh in Lh){const Ch=this.findLoadedParent(Lh[Bh],this._source.minzoom);if(Ch){ph[Ch.tileID.key]=ls[Ch.tileID.key]=Ch.tileID;for(const Kh in ph)ph[Kh].isChildOf(Ch.tileID)&&delete ph[Kh]}}for(const Bh in this._tiles)ph[Bh]||(this._coveredTiles[Bh]=!0)}}for(const ol in ls)this._tiles[ol].clearFadeHold();const $s=o.keysDifference(this._tiles,ls);for(const ol of $s){const nh=this._tiles[ol];nh.hasSymbolBuckets&&!nh.holdingForFade()?nh.setHoldDuration(this.map._fadeDuration):nh.hasSymbolBuckets&&!nh.symbolFadeFinished()||this._removeTile(ol)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)}_updateRetainedTiles(g,A){const q={},ze={},Ft=Math.max(A-Ld.maxOverzooming,this._source.minzoom),Gn=Math.max(A+Ld.maxUnderzooming,this._source.minzoom),ls={};for(const $s of g){const ol=this._addTile($s);q[$s.key]=$s,ol.hasData()||A<this._source.maxzoom&&(ls[$s.key]=$s)}this._retainLoadedChildren(ls,A,Gn,q);for(const $s of g){let ol=this._tiles[$s.key];if(ol.hasData())continue;if(A+1>this._source.maxzoom){const ih=$s.children(this._source.maxzoom)[0],ph=this.getTile(ih);if(ph&&ph.hasData()){q[ih.key]=ih;continue}}else{const ih=$s.children(this._source.maxzoom);if(q[ih[0].key]&&q[ih[1].key]&&q[ih[2].key]&&q[ih[3].key])continue}let nh=ol.wasRequested();for(let ih=$s.overscaledZ-1;ih>=Ft;--ih){const ph=$s.scaledTo(ih);if(ze[ph.key]||(ze[ph.key]=!0,ol=this.getTile(ph),!ol&&nh&&(ol=this._addTile(ph)),ol&&(q[ph.key]=ph,nh=ol.wasRequested(),ol.hasData())))break}}return q}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const g in this._tiles){const A=[];let q,ze=this._tiles[g].tileID;for(;ze.overscaledZ>0;){if(ze.key in this._loadedParentTiles){q=this._loadedParentTiles[ze.key];break}A.push(ze.key);const Ft=ze.scaledTo(ze.overscaledZ-1);if(q=this._getLoadedTile(Ft),q)break;ze=Ft}for(const Ft of A)this._loadedParentTiles[Ft]=q}}_addTile(g){let A=this._tiles[g.key];if(A)return A;A=this._cache.getAndRemove(g),A&&(this._setTileReloadTimer(g.key,A),A.tileID=g,this._state.initializeTileState(A,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,A)));const q=A;return A||(A=new ad(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(A,this._tileLoaded.bind(this,A,g.key,A.state))),A.uses++,this._tiles[g.key]=A,q||this._source.fire(new o.Event("dataloading",{tile:A,coord:A.tileID,dataType:"source"})),A}_setTileReloadTimer(g,A){g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);const q=A.getExpiryTimeout();q&&(this._timers[g]=setTimeout(()=>{this._reloadTile(g,"expired"),delete this._timers[g]},q))}_removeTile(g){const A=this._tiles[g];A&&(A.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),A.uses>0||(A.hasData()&&A.state!=="reloading"?this._cache.add(A.tileID,A,A.getExpiryTimeout()):(A.aborted=!0,this._abortTile(A),this._unloadTile(A))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const g in this._tiles)this._removeTile(g);this._cache.reset()}tilesIn(g,A,q){const ze=[],Ft=this.transform;if(!Ft)return ze;const Gn=q?Ft.getCameraQueryGeometry(g):g,ls=g.map(Bh=>Ft.pointCoordinate(Bh,this.terrain)),$s=Gn.map(Bh=>Ft.pointCoordinate(Bh,this.terrain)),ol=this.getIds();let nh=1/0,ih=1/0,ph=-1/0,Lh=-1/0;for(const Bh of $s)nh=Math.min(nh,Bh.x),ih=Math.min(ih,Bh.y),ph=Math.max(ph,Bh.x),Lh=Math.max(Lh,Bh.y);for(let Bh=0;Bh<ol.length;Bh++){const Ch=this._tiles[ol[Bh]];if(Ch.holdingForFade())continue;const Kh=Ch.tileID,fd=Math.pow(2,Ft.zoom-Ch.tileID.overscaledZ),ud=A*Ch.queryPadding*o.EXTENT/Ch.tileSize/fd,jh=[Kh.getTilePoint(new o.MercatorCoordinate(nh,ih)),Kh.getTilePoint(new o.MercatorCoordinate(ph,Lh))];if(jh[0].x-ud<o.EXTENT&&jh[0].y-ud<o.EXTENT&&jh[1].x+ud>=0&&jh[1].y+ud>=0){const Sd=ls.map(Wd=>Kh.getTilePoint(Wd)),Vd=$s.map(Wd=>Kh.getTilePoint(Wd));ze.push({tile:Ch,tileID:Kh,queryGeometry:Sd,cameraQueryGeometry:Vd,scale:fd})}}return ze}getVisibleCoordinates(g){const A=this.getRenderableIds(g).map(q=>this._tiles[q].tileID);for(const q of A)q.posMatrix=this.transform.calculatePosMatrix(q.toUnwrapped());return A}hasTransition(){if(this._source.hasTransition())return!0;if(If(this._source.type))for(const g in this._tiles){const A=this._tiles[g];if(A.fadeEndTime!==void 0&&A.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(g,A,q){this._state.updateState(g=g||"_geojsonTileLayer",A,q)}removeFeatureState(g,A,q){this._state.removeFeatureState(g=g||"_geojsonTileLayer",A,q)}getFeatureState(g,A){return this._state.getState(g=g||"_geojsonTileLayer",A)}setDependencies(g,A,q){const ze=this._tiles[g];ze&&ze.setDependencies(A,q)}reloadTilesForDependencies(g,A){for(const q in this._tiles)this._tiles[q].hasDependency(g,A)&&this._reloadTile(q,"reloading");this._cache.filter(q=>!q.hasDependency(g,A))}}function Kf(Y,g){const A=Math.abs(2*Y.wrap)-+(Y.wrap<0),q=Math.abs(2*g.wrap)-+(g.wrap<0);return Y.overscaledZ-g.overscaledZ||q-A||g.canonical.y-Y.canonical.y||g.canonical.x-Y.canonical.x}function If(Y){return Y==="raster"||Y==="image"||Y==="video"}Ld.maxOverzooming=10,Ld.maxUnderzooming=3;const Df="mapboxgl_preloaded_worker_pool";class Jf{constructor(){this.active={}}acquire(g){if(!this.workers)for(this.workers=[];this.workers.length<Jf.workerCount;)this.workers.push(new Worker(K_.workerUrl));return this.active[g]=!0,this.workers.slice()}release(g){delete this.active[g],this.numActive()===0&&(this.workers.forEach(A=>{A.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Df]}numActive(){return Object.keys(this.active).length}}const Nf=Math.floor(o.exported.hardwareConcurrency/2);let Wf;function Cp(){return Wf||(Wf=new Jf),Wf}function Tp(Y,g){const A={};for(const q in Y)q!=="ref"&&(A[q]=Y[q]);return o.refProperties.forEach(q=>{q in g&&(A[q]=g[q])}),A}function Pp(Y){Y=Y.slice();const g=Object.create(null);for(let A=0;A<Y.length;A++)g[Y[A].id]=Y[A];for(let A=0;A<Y.length;A++)"ref"in Y[A]&&(Y[A]=Tp(Y[A],g[Y[A].ref]));return Y}Jf.workerCount=Math.max(Math.min(Nf,6),1);const Yf={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qp(Y,g,A){A.push({command:Yf.addSource,args:[Y,g[Y]]})}function am(Y,g,A){g.push({command:Yf.removeSource,args:[Y]}),A[Y]=!0}function Xd(Y,g,A,q){am(Y,A,q),qp(Y,g,A)}function Op(Y,g,A){let q;for(q in Y[A])if(Object.prototype.hasOwnProperty.call(Y[A],q)&&q!=="data"&&!nt(Y[A][q],g[A][q]))return!1;for(q in g[A])if(Object.prototype.hasOwnProperty.call(g[A],q)&&q!=="data"&&!nt(Y[A][q],g[A][q]))return!1;return!0}function nm(Y,g,A,q,ze,Ft){let Gn;for(Gn in g=g||{},Y=Y||{})Object.prototype.hasOwnProperty.call(Y,Gn)&&(nt(Y[Gn],g[Gn])||A.push({command:Ft,args:[q,Gn,g[Gn],ze]}));for(Gn in g)Object.prototype.hasOwnProperty.call(g,Gn)&&!Object.prototype.hasOwnProperty.call(Y,Gn)&&(nt(Y[Gn],g[Gn])||A.push({command:Ft,args:[q,Gn,g[Gn],ze]}))}function Tm(Y){return Y.id}function hp(Y,g){return Y[g.id]=g,Y}class Em{constructor(g,A){this.reset(g,A)}reset(g,A){this.points=g||[],this._distances=[0];for(let q=1;q<this.points.length;q++)this._distances[q]=this._distances[q-1]+this.points[q].dist(this.points[q-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(A||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(g){if(this.points.length===1)return this.points[0];g=o.clamp(g,0,1);let A=1,q=this._distances[A];const ze=g*this.paddedLength+this.padding;for(;q<ze&&A<this._distances.length;)q=this._distances[++A];const Ft=A-1,Gn=this._distances[Ft],ls=q-Gn,$s=ls>0?(ze-Gn)/ls:0;return this.points[Ft].mult(1-$s).add(this.points[A].mult($s))}}function Qp(Y,g){let A=!0;return Y==="always"||Y!=="never"&&g!=="never"||(A=!1),A}class lm{constructor(g,A,q){const ze=this.boxCells=[],Ft=this.circleCells=[];this.xCellCount=Math.ceil(g/q),this.yCellCount=Math.ceil(A/q);for(let Gn=0;Gn<this.xCellCount*this.yCellCount;Gn++)ze.push([]),Ft.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=g,this.height=A,this.xScale=this.xCellCount/g,this.yScale=this.yCellCount/A,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(g,A,q,ze,Ft){this._forEachCell(A,q,ze,Ft,this._insertBoxCell,this.boxUid++),this.boxKeys.push(g),this.bboxes.push(A),this.bboxes.push(q),this.bboxes.push(ze),this.bboxes.push(Ft)}insertCircle(g,A,q,ze){this._forEachCell(A-ze,q-ze,A+ze,q+ze,this._insertCircleCell,this.circleUid++),this.circleKeys.push(g),this.circles.push(A),this.circles.push(q),this.circles.push(ze)}_insertBoxCell(g,A,q,ze,Ft,Gn){this.boxCells[Ft].push(Gn)}_insertCircleCell(g,A,q,ze,Ft,Gn){this.circleCells[Ft].push(Gn)}_query(g,A,q,ze,Ft,Gn,ls){if(q<0||g>this.width||ze<0||A>this.height)return[];const $s=[];if(g<=0&&A<=0&&this.width<=q&&this.height<=ze){if(Ft)return[{key:null,x1:g,y1:A,x2:q,y2:ze}];for(let ol=0;ol<this.boxKeys.length;ol++)$s.push({key:this.boxKeys[ol],x1:this.bboxes[4*ol],y1:this.bboxes[4*ol+1],x2:this.bboxes[4*ol+2],y2:this.bboxes[4*ol+3]});for(let ol=0;ol<this.circleKeys.length;ol++){const nh=this.circles[3*ol],ih=this.circles[3*ol+1],ph=this.circles[3*ol+2];$s.push({key:this.circleKeys[ol],x1:nh-ph,y1:ih-ph,x2:nh+ph,y2:ih+ph})}}else this._forEachCell(g,A,q,ze,this._queryCell,$s,{hitTest:Ft,overlapMode:Gn,seenUids:{box:{},circle:{}}},ls);return $s}query(g,A,q,ze){return this._query(g,A,q,ze,!1,null)}hitTest(g,A,q,ze,Ft,Gn){return this._query(g,A,q,ze,!0,Ft,Gn).length>0}hitTestCircle(g,A,q,ze,Ft){const Gn=g-q,ls=g+q,$s=A-q,ol=A+q;if(ls<0||Gn>this.width||ol<0||$s>this.height)return!1;const nh=[];return this._forEachCell(Gn,$s,ls,ol,this._queryCellCircle,nh,{hitTest:!0,overlapMode:ze,circle:{x:g,y:A,radius:q},seenUids:{box:{},circle:{}}},Ft),nh.length>0}_queryCell(g,A,q,ze,Ft,Gn,ls,$s){const{seenUids:ol,hitTest:nh,overlapMode:ih}=ls,ph=this.boxCells[Ft];if(ph!==null){const Bh=this.bboxes;for(const Ch of ph)if(!ol.box[Ch]){ol.box[Ch]=!0;const Kh=4*Ch,fd=this.boxKeys[Ch];if(g<=Bh[Kh+2]&&A<=Bh[Kh+3]&&q>=Bh[Kh+0]&&ze>=Bh[Kh+1]&&(!$s||$s(fd))&&(!nh||!Qp(ih,fd.overlapMode))&&(Gn.push({key:fd,x1:Bh[Kh],y1:Bh[Kh+1],x2:Bh[Kh+2],y2:Bh[Kh+3]}),nh))return!0}}const Lh=this.circleCells[Ft];if(Lh!==null){const Bh=this.circles;for(const Ch of Lh)if(!ol.circle[Ch]){ol.circle[Ch]=!0;const Kh=3*Ch,fd=this.circleKeys[Ch];if(this._circleAndRectCollide(Bh[Kh],Bh[Kh+1],Bh[Kh+2],g,A,q,ze)&&(!$s||$s(fd))&&(!nh||!Qp(ih,fd.overlapMode))){const ud=Bh[Kh],jh=Bh[Kh+1],Sd=Bh[Kh+2];if(Gn.push({key:fd,x1:ud-Sd,y1:jh-Sd,x2:ud+Sd,y2:jh+Sd}),nh)return!0}}}return!1}_queryCellCircle(g,A,q,ze,Ft,Gn,ls,$s){const{circle:ol,seenUids:nh,overlapMode:ih}=ls,ph=this.boxCells[Ft];if(ph!==null){const Bh=this.bboxes;for(const Ch of ph)if(!nh.box[Ch]){nh.box[Ch]=!0;const Kh=4*Ch,fd=this.boxKeys[Ch];if(this._circleAndRectCollide(ol.x,ol.y,ol.radius,Bh[Kh+0],Bh[Kh+1],Bh[Kh+2],Bh[Kh+3])&&(!$s||$s(fd))&&!Qp(ih,fd.overlapMode))return Gn.push(!0),!0}}const Lh=this.circleCells[Ft];if(Lh!==null){const Bh=this.circles;for(const Ch of Lh)if(!nh.circle[Ch]){nh.circle[Ch]=!0;const Kh=3*Ch,fd=this.circleKeys[Ch];if(this._circlesCollide(Bh[Kh],Bh[Kh+1],Bh[Kh+2],ol.x,ol.y,ol.radius)&&(!$s||$s(fd))&&!Qp(ih,fd.overlapMode))return Gn.push(!0),!0}}}_forEachCell(g,A,q,ze,Ft,Gn,ls,$s){const ol=this._convertToXCellCoord(g),nh=this._convertToYCellCoord(A),ih=this._convertToXCellCoord(q),ph=this._convertToYCellCoord(ze);for(let Lh=ol;Lh<=ih;Lh++)for(let Bh=nh;Bh<=ph;Bh++)if(Ft.call(this,g,A,q,ze,this.xCellCount*Bh+Lh,Gn,ls,$s))return}_convertToXCellCoord(g){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(g*this.xScale)))}_convertToYCellCoord(g){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(g*this.yScale)))}_circlesCollide(g,A,q,ze,Ft,Gn){const ls=ze-g,$s=Ft-A,ol=q+Gn;return ol*ol>ls*ls+$s*$s}_circleAndRectCollide(g,A,q,ze,Ft,Gn,ls){const $s=(Gn-ze)/2,ol=Math.abs(g-(ze+$s));if(ol>$s+q)return!1;const nh=(ls-Ft)/2,ih=Math.abs(A-(Ft+nh));if(ih>nh+q)return!1;if(ol<=$s||ih<=nh)return!0;const ph=ol-$s,Lh=ih-nh;return ph*ph+Lh*Lh<=q*q}}function Dd(Y,g,A,q,ze){const Ft=o.create();return g?(o.scale(Ft,Ft,[1/ze,1/ze,1]),A||o.rotateZ(Ft,Ft,q.angle)):o.multiply(Ft,q.labelPlaneMatrix,Y),Ft}function Hf(Y,g,A,q,ze){if(g){const Ft=o.clone(Y);return o.scale(Ft,Ft,[ze,ze,1]),A||o.rotateZ(Ft,Ft,-q.angle),Ft}return q.glCoordMatrix}function mh(Y,g,A){let q;A?(q=[Y.x,Y.y,A(Y.x,Y.y),1],o.transformMat4(q,q,g)):(q=[Y.x,Y.y,0,1],dh(q,q,g));const ze=q[3];return{point:new o.pointGeometry(q[0]/ze,q[1]/ze),signedDistanceFromCamera:ze}}function Jh(Y,g){return .5+Y/g*.5}function Wu(Y,g){const A=Y[0]/Y[3],q=Y[1]/Y[3];return A>=-g[0]&&A<=g[0]&&q>=-g[1]&&q<=g[1]}function al(Y,g,A,q,ze,Ft,Gn,ls,$s,ol){const nh=q?Y.textSizeData:Y.iconSizeData,ih=o.evaluateSizeForZoom(nh,A.transform.zoom),ph=[256/A.width*2+1,256/A.height*2+1],Lh=q?Y.text.dynamicLayoutVertexArray:Y.icon.dynamicLayoutVertexArray;Lh.clear();const Bh=Y.lineVertexArray,Ch=q?Y.text.placedSymbolArray:Y.icon.placedSymbolArray,Kh=A.transform.width/A.transform.height;let fd=!1;for(let ud=0;ud<Ch.length;ud++){const jh=Ch.get(ud);if(jh.hidden||jh.writingMode===o.WritingMode.vertical&&!fd){uh(jh.numGlyphs,Lh);continue}let Sd;if(fd=!1,ol?(Sd=[jh.anchorX,jh.anchorY,ol(jh.anchorX,jh.anchorY),1],o.transformMat4(Sd,Sd,g)):(Sd=[jh.anchorX,jh.anchorY,0,1],dh(Sd,Sd,g)),!Wu(Sd,ph)){uh(jh.numGlyphs,Lh);continue}const Vd=Jh(A.transform.cameraToCenterDistance,Sd[3]),Wd=o.evaluateSizeForFeature(nh,ih,jh),Cf=Gn?Wd/Vd:Wd*Vd,Of=new o.pointGeometry(jh.anchorX,jh.anchorY),L=mh(Of,ze,ol).point,u={},E=cs(jh,Cf,!1,ls,g,ze,Ft,Y.glyphOffsetArray,Bh,Lh,L,Of,u,Kh,$s,ol);fd=E.useVertical,(E.notEnoughRoom||fd||E.needsFlipping&&cs(jh,Cf,!0,ls,g,ze,Ft,Y.glyphOffsetArray,Bh,Lh,L,Of,u,Kh,$s,ol).notEnoughRoom)&&uh(jh.numGlyphs,Lh)}q?Y.text.dynamicLayoutVertexBuffer.updateData(Lh):Y.icon.dynamicLayoutVertexBuffer.updateData(Lh)}function Xr(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph){const Lh=ls.glyphStartIndex+ls.numGlyphs,Bh=ls.lineStartIndex,Ch=ls.lineStartIndex+ls.lineLength,Kh=g.getoffsetX(ls.glyphStartIndex),fd=g.getoffsetX(Lh-1),ud=eh(Y*Kh,A,q,ze,Ft,Gn,ls.segment,Bh,Ch,$s,ol,nh,ih,ph);if(!ud)return null;const jh=eh(Y*fd,A,q,ze,Ft,Gn,ls.segment,Bh,Ch,$s,ol,nh,ih,ph);return jh?{first:ud,last:jh}:null}function mr(Y,g,A,q){return Y===o.WritingMode.horizontal&&Math.abs(A.y-g.y)>Math.abs(A.x-g.x)*q?{useVertical:!0}:(Y===o.WritingMode.vertical?g.y<A.y:g.x>A.x)?{needsFlipping:!0}:null}function cs(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph,Lh,Bh,Ch){const Kh=g/24,fd=Y.lineOffsetX*Kh,ud=Y.lineOffsetY*Kh;let jh;if(Y.numGlyphs>1){const Sd=Y.glyphStartIndex+Y.numGlyphs,Vd=Y.lineStartIndex,Wd=Y.lineStartIndex+Y.lineLength,Cf=Xr(Kh,ls,fd,ud,A,nh,ih,Y,$s,Ft,ph,Bh,Ch);if(!Cf)return{notEnoughRoom:!0};const Of=mh(Cf.first.point,Gn,Ch).point,L=mh(Cf.last.point,Gn,Ch).point;if(q&&!A){const u=mr(Y.writingMode,Of,L,Lh);if(u)return u}jh=[Cf.first];for(let u=Y.glyphStartIndex+1;u<Sd-1;u++)jh.push(eh(Kh*ls.getoffsetX(u),fd,ud,A,nh,ih,Y.segment,Vd,Wd,$s,Ft,ph,Bh,Ch));jh.push(Cf.last)}else{if(q&&!A){const Vd=mh(ih,ze,Ch).point,Wd=Y.lineStartIndex+Y.segment+1,Cf=new o.pointGeometry($s.getx(Wd),$s.gety(Wd)),Of=mh(Cf,ze,Ch),L=Of.signedDistanceFromCamera>0?Of.point:$u(ih,Cf,Vd,1,ze,Ch),u=mr(Y.writingMode,Vd,L,Lh);if(u)return u}const Sd=eh(Kh*ls.getoffsetX(Y.glyphStartIndex),fd,ud,A,nh,ih,Y.segment,Y.lineStartIndex,Y.lineStartIndex+Y.lineLength,$s,Ft,ph,Bh,Ch);if(!Sd)return{notEnoughRoom:!0};jh=[Sd]}for(const Sd of jh)o.addDynamicAttributes(ol,Sd.point,Sd.angle);return{}}function $u(Y,g,A,q,ze,Ft){const Gn=mh(Y.add(Y.sub(g)._unit()),ze,Ft).point,ls=A.sub(Gn);return A.add(ls._mult(q/ls.mag()))}function eh(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph,Lh){const Bh=q?Y-g:Y+g;let Ch=Bh>0?1:-1,Kh=0;q&&(Ch*=-1,Kh=Math.PI),Ch<0&&(Kh+=Math.PI);let fd=Ch>0?ls+Gn:ls+Gn+1,ud=ze,jh=ze,Sd=0,Vd=0;const Wd=Math.abs(Bh),Cf=[];for(;Sd+Vd<=Wd;){if(fd+=Ch,fd<ls||fd>=$s)return null;if(jh=ud,Cf.push(ud),ud=ih[fd],ud===void 0){const B=new o.pointGeometry(ol.getx(fd),ol.gety(fd)),ge=mh(B,nh,Lh);if(ge.signedDistanceFromCamera>0)ud=ih[fd]=ge.point;else{const St=fd-Ch;ud=$u(Sd===0?Ft:new o.pointGeometry(ol.getx(St),ol.gety(St)),B,jh,Wd-Sd+1,nh,Lh)}}Sd+=Vd,Vd=jh.dist(ud)}const Of=(Wd-Sd)/Vd,L=ud.sub(jh),u=L.mult(Of)._add(jh);u._add(L._unit()._perp()._mult(A*Ch));const E=Kh+Math.atan2(ud.y-jh.y,ud.x-jh.x);return Cf.push(u),{point:u,angle:ph?E:0,path:Cf}}const rh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function uh(Y,g){for(let A=0;A<Y;A++){const q=g.length;g.resize(q+4),g.float32.set(rh,3*q)}}function dh(Y,g,A){const q=g[0],ze=g[1];return Y[0]=A[0]*q+A[4]*ze+A[12],Y[1]=A[1]*q+A[5]*ze+A[13],Y[3]=A[3]*q+A[7]*ze+A[15],Y}const yh=100;class Ph{constructor(g,A=new lm(g.width+200,g.height+200,25),q=new lm(g.width+200,g.height+200,25)){this.transform=g,this.grid=A,this.ignoredGrid=q,this.pitchfactor=Math.cos(g._pitch)*g.cameraToCenterDistance,this.screenRightBoundary=g.width+yh,this.screenBottomBoundary=g.height+yh,this.gridRightBoundary=g.width+200,this.gridBottomBoundary=g.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(g,A,q,ze,Ft,Gn){const ls=this.projectAndGetPerspectiveRatio(ze,g.anchorPointX,g.anchorPointY,Gn),$s=q*ls.perspectiveRatio,ol=g.x1*$s+ls.point.x,nh=g.y1*$s+ls.point.y,ih=g.x2*$s+ls.point.x,ph=g.y2*$s+ls.point.y;return!this.isInsideGrid(ol,nh,ih,ph)||A!=="always"&&this.grid.hitTest(ol,nh,ih,ph,A,Ft)||ls.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[ol,nh,ih,ph],offscreen:this.isOffscreen(ol,nh,ih,ph)}}placeCollisionCircles(g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph,Lh,Bh){const Ch=[],Kh=new o.pointGeometry(A.anchorX,A.anchorY),fd=mh(Kh,Gn,Bh),ud=Jh(this.transform.cameraToCenterDistance,fd.signedDistanceFromCamera),jh=(nh?Ft/ud:Ft*ud)/o.ONE_EM,Sd=mh(Kh,ls,Bh).point,Vd=Xr(jh,ze,A.lineOffsetX*jh,A.lineOffsetY*jh,!1,Sd,Kh,A,q,ls,{},!1,Bh);let Wd=!1,Cf=!1,Of=!0;if(Vd){const L=.5*ph*ud+Lh,u=new o.pointGeometry(-100,-100),E=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),B=new Em,ge=Vd.first,St=Vd.last;let _n=[];for(let tl=ge.path.length-1;tl>=1;tl--)_n.push(ge.path[tl]);for(let tl=1;tl<St.path.length;tl++)_n.push(St.path[tl]);const Bn=2.5*L;if($s){const tl=_n.map(il=>mh(il,$s,Bh));_n=tl.some(il=>il.signedDistanceFromCamera<=0)?[]:tl.map(il=>il.point)}let ss=[];if(_n.length>0){const tl=_n[0].clone(),il=_n[0].clone();for(let Qu=1;Qu<_n.length;Qu++)tl.x=Math.min(tl.x,_n[Qu].x),tl.y=Math.min(tl.y,_n[Qu].y),il.x=Math.max(il.x,_n[Qu].x),il.y=Math.max(il.y,_n[Qu].y);ss=tl.x>=u.x&&il.x<=E.x&&tl.y>=u.y&&il.y<=E.y?[_n]:il.x<u.x||tl.x>E.x||il.y<u.y||tl.y>E.y?[]:o.clipLine([_n],u.x,u.y,E.x,E.y)}for(const tl of ss){B.reset(tl,.25*L);let il=0;il=B.length<=.5*L?1:Math.ceil(B.paddedLength/Bn)+1;for(let Qu=0;Qu<il;Qu++){const fh=Qu/Math.max(il-1,1),wh=B.lerp(fh),Th=wh.x+yh,Sh=wh.y+yh;Ch.push(Th,Sh,L,0);const Ih=Th-L,hh=Sh-L,Oh=Th+L,Rh=Sh+L;if(Of=Of&&this.isOffscreen(Ih,hh,Oh,Rh),Cf=Cf||this.isInsideGrid(Ih,hh,Oh,Rh),g!=="always"&&this.grid.hitTestCircle(Th,Sh,L,g,ih)&&(Wd=!0,!ol))return{circles:[],offscreen:!1,collisionDetected:Wd}}}}return{circles:!ol&&Wd||!Cf||ud<this.perspectiveRatioCutoff?[]:Ch,offscreen:Of,collisionDetected:Wd}}queryRenderedSymbols(g){if(g.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const A=[];let q=1/0,ze=1/0,Ft=-1/0,Gn=-1/0;for(const nh of g){const ih=new o.pointGeometry(nh.x+yh,nh.y+yh);q=Math.min(q,ih.x),ze=Math.min(ze,ih.y),Ft=Math.max(Ft,ih.x),Gn=Math.max(Gn,ih.y),A.push(ih)}const ls=this.grid.query(q,ze,Ft,Gn).concat(this.ignoredGrid.query(q,ze,Ft,Gn)),$s={},ol={};for(const nh of ls){const ih=nh.key;if($s[ih.bucketInstanceId]===void 0&&($s[ih.bucketInstanceId]={}),$s[ih.bucketInstanceId][ih.featureIndex])continue;const ph=[new o.pointGeometry(nh.x1,nh.y1),new o.pointGeometry(nh.x2,nh.y1),new o.pointGeometry(nh.x2,nh.y2),new o.pointGeometry(nh.x1,nh.y2)];o.polygonIntersectsPolygon(A,ph)&&($s[ih.bucketInstanceId][ih.featureIndex]=!0,ol[ih.bucketInstanceId]===void 0&&(ol[ih.bucketInstanceId]=[]),ol[ih.bucketInstanceId].push(ih.featureIndex))}return ol}insertCollisionBox(g,A,q,ze,Ft,Gn){(q?this.ignoredGrid:this.grid).insert({bucketInstanceId:ze,featureIndex:Ft,collisionGroupID:Gn,overlapMode:A},g[0],g[1],g[2],g[3])}insertCollisionCircles(g,A,q,ze,Ft,Gn){const ls=q?this.ignoredGrid:this.grid,$s={bucketInstanceId:ze,featureIndex:Ft,collisionGroupID:Gn,overlapMode:A};for(let ol=0;ol<g.length;ol+=4)ls.insertCircle($s,g[ol],g[ol+1],g[ol+2])}projectAndGetPerspectiveRatio(g,A,q,ze){let Ft;return ze?(Ft=[A,q,ze(A,q),1],o.transformMat4(Ft,Ft,g)):(Ft=[A,q,0,1],dh(Ft,Ft,g)),{point:new o.pointGeometry((Ft[0]/Ft[3]+1)/2*this.transform.width+yh,(-Ft[1]/Ft[3]+1)/2*this.transform.height+yh),perspectiveRatio:.5+this.transform.cameraToCenterDistance/Ft[3]*.5}}isOffscreen(g,A,q,ze){return q<yh||g>=this.screenRightBoundary||ze<yh||A>this.screenBottomBoundary}isInsideGrid(g,A,q,ze){return q>=0&&g<this.gridRightBoundary&&ze>=0&&A<this.gridBottomBoundary}getViewportMatrix(){const g=o.identity([]);return o.translate(g,g,[-100,-100,0]),g}}function Fh(Y,g,A){return g*(o.EXTENT/(Y.tileSize*Math.pow(2,A-Y.tileID.overscaledZ)))}class Ad{constructor(g,A,q,ze){this.opacity=g?Math.max(0,Math.min(1,g.opacity+(g.placed?A:-A))):ze&&q?1:0,this.placed=q}isHidden(){return this.opacity===0&&!this.placed}}class wd{constructor(g,A,q,ze,Ft){this.text=new Ad(g?g.text:null,A,q,Ft),this.icon=new Ad(g?g.icon:null,A,ze,Ft)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kd{constructor(g,A,q){this.text=g,this.icon=A,this.skipFade=q}}class xf{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Ff{constructor(g,A,q,ze,Ft){this.bucketInstanceId=g,this.featureIndex=A,this.sourceLayerIndex=q,this.bucketIndex=ze,this.tileID=Ft}}class rp{constructor(g){this.crossSourceCollisions=g,this.maxGroupID=0,this.collisionGroups={}}get(g){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[g]){const A=++this.maxGroupID;this.collisionGroups[g]={ID:A,predicate:q=>q.collisionGroupID===A}}return this.collisionGroups[g]}}function Ah(Y,g,A,q,ze){const{horizontalAlign:Ft,verticalAlign:Gn}=o.getAnchorAlignment(Y),ls=-(Ft-.5)*g,$s=-(Gn-.5)*A,ol=o.evaluateVariableOffset(Y,q);return new o.pointGeometry(ls+ol[0]*ze,$s+ol[1]*ze)}function Jd(Y,g,A,q,ze,Ft){const{x1:Gn,x2:ls,y1:$s,y2:ol,anchorPointX:nh,anchorPointY:ih}=Y,ph=new o.pointGeometry(g,A);return q&&ph._rotate(ze?Ft:-Ft),{x1:Gn+ph.x,y1:$s+ph.y,x2:ls+ph.x,y2:ol+ph.y,anchorPointX:nh,anchorPointY:ih}}class Od{constructor(g,A,q,ze,Ft){this.transform=g.clone(),this.terrain=A,this.collisionIndex=new Ph(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=q,this.retainedQueryData={},this.collisionGroups=new rp(ze),this.collisionCircleArrays={},this.prevPlacement=Ft,Ft&&(Ft.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(g,A,q,ze){const Ft=q.getBucket(A),Gn=q.latestFeatureIndex;if(!Ft||!Gn||A.id!==Ft.layerIds[0])return;const ls=q.collisionBoxArray,$s=Ft.layers[0].layout,ol=Math.pow(2,this.transform.zoom-q.tileID.overscaledZ),nh=q.tileSize/o.EXTENT,ih=this.transform.calculatePosMatrix(q.tileID.toUnwrapped()),ph=$s.get("text-pitch-alignment")==="map",Lh=$s.get("text-rotation-alignment")==="map",Bh=Fh(q,1,this.transform.zoom),Ch=Dd(ih,ph,Lh,this.transform,Bh);let Kh=null;if(ph){const ud=Hf(ih,ph,Lh,this.transform,Bh);Kh=o.multiply([],this.transform.labelPlaneMatrix,ud)}this.retainedQueryData[Ft.bucketInstanceId]=new Ff(Ft.bucketInstanceId,Gn,Ft.sourceLayerIndex,Ft.index,q.tileID);const fd={bucket:Ft,layout:$s,posMatrix:ih,textLabelPlaneMatrix:Ch,labelToScreenMatrix:Kh,scale:ol,textPixelRatio:nh,holdingForFade:q.holdingForFade(),collisionBoxArray:ls,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(Ft.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(Ft.sourceID)};if(ze)for(const ud of Ft.sortKeyRanges){const{sortKey:jh,symbolInstanceStart:Sd,symbolInstanceEnd:Vd}=ud;g.push({sortKey:jh,symbolInstanceStart:Sd,symbolInstanceEnd:Vd,parameters:fd})}else g.push({symbolInstanceStart:0,symbolInstanceEnd:Ft.symbolInstances.length,parameters:fd})}attemptAnchorPlacement(g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph,Lh,Bh,Ch,Kh){const fd=[ph.textOffset0,ph.textOffset1],ud=Ah(g,q,ze,fd,Ft),jh=this.collisionIndex.placeCollisionBox(Jd(A,ud.x,ud.y,Gn,ls,this.transform.angle),ih,$s,ol,nh.predicate,Kh);if((!Ch||this.collisionIndex.placeCollisionBox(Jd(Ch,ud.x,ud.y,Gn,ls,this.transform.angle),ih,$s,ol,nh.predicate,Kh).box.length!==0)&&jh.box.length>0){let Sd;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID].text&&(Sd=this.prevPlacement.variableOffsets[ph.crossTileID].anchor),ph.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ph.crossTileID]={textOffset:fd,width:q,height:ze,anchor:g,textBoxScale:Ft,prevAnchor:Sd},this.markUsedJustification(Lh,g,ph,Bh),Lh.allowVerticalPlacement&&(this.markUsedOrientation(Lh,Bh,ph),this.placedOrientations[ph.crossTileID]=Bh),{shift:ud,placedGlyphBoxes:jh}}}placeLayerBucketPart(g,A,q){const{bucket:ze,layout:Ft,posMatrix:Gn,textLabelPlaneMatrix:ls,labelToScreenMatrix:$s,textPixelRatio:ol,holdingForFade:nh,collisionBoxArray:ih,partiallyEvaluatedTextSize:ph,collisionGroup:Lh}=g.parameters,Bh=Ft.get("text-optional"),Ch=Ft.get("icon-optional"),Kh=o.getOverlapMode(Ft,"text-overlap","text-allow-overlap"),fd=Kh==="always",ud=o.getOverlapMode(Ft,"icon-overlap","icon-allow-overlap"),jh=ud==="always",Sd=Ft.get("text-rotation-alignment")==="map",Vd=Ft.get("text-pitch-alignment")==="map",Wd=Ft.get("icon-text-fit")!=="none",Cf=Ft.get("symbol-z-order")==="viewport-y",Of=fd&&(jh||!ze.hasIconData()||Ch),L=jh&&(fd||!ze.hasTextData()||Bh);!ze.collisionArrays&&ih&&ze.deserializeCollisionBoxes(ih);const u=(E,B)=>{if(A[E.crossTileID])return;if(nh)return void(this.placements[E.crossTileID]=new Kd(!1,!1,!1));let ge=!1,St=!1,_n=!0,Bn=null,ss={box:null,offscreen:null},tl={box:null,offscreen:null},il=null,Qu=null,fh=null,wh=0,Th=0,Sh=0;B.textFeatureIndex?wh=B.textFeatureIndex:E.useRuntimeCollisionCircles&&(wh=E.featureIndex),B.verticalTextFeatureIndex&&(Th=B.verticalTextFeatureIndex);const Ih=this.retainedQueryData[ze.bucketInstanceId].tileID,hh=this.terrain?(qh,$h)=>this.terrain.getElevation(Ih,qh,$h):null;for(const qh of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const $h=B[qh];$h&&($h.elevation=hh?hh($h.anchorPointX,$h.anchorPointY):0)}const Oh=B.textBox;if(Oh){const qh=Hh=>{let ld=o.WritingMode.horizontal;if(ze.allowVerticalPlacement&&!Hh&&this.prevPlacement){const xd=this.prevPlacement.placedOrientations[E.crossTileID];xd&&(this.placedOrientations[E.crossTileID]=xd,ld=xd,this.markUsedOrientation(ze,ld,E))}return ld},$h=(Hh,ld)=>{if(ze.allowVerticalPlacement&&E.numVerticalGlyphVertices>0&&B.verticalTextBox){for(const xd of ze.writingModes)if(xd===o.WritingMode.vertical?(ss=ld(),tl=ss):ss=Hh(),ss&&ss.box&&ss.box.length)break}else ss=Hh()};if(Ft.get("text-variable-anchor")){let Hh=Ft.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[E.crossTileID]){const gd=this.prevPlacement.variableOffsets[E.crossTileID];Hh.indexOf(gd.anchor)>0&&(Hh=Hh.filter(Vf=>Vf!==gd.anchor),Hh.unshift(gd.anchor))}const ld=(gd,Vf,_d)=>{const Mf=gd.x2-gd.x1,Ud=gd.y2-gd.y1,Lf=E.textBoxScale,Md=Wd&&ud==="never"?Vf:null;let pd={box:[],offscreen:!1};const Bd=Kh!=="never"?2*Hh.length:Hh.length;for(let mf=0;mf<Bd;++mf){const Bf=this.attemptAnchorPlacement(Hh[mf%Hh.length],gd,Mf,Ud,Lf,Sd,Vd,ol,Gn,Lh,mf>=Hh.length?Kh:"never",E,ze,_d,Md,hh);if(Bf&&(pd=Bf.placedGlyphBoxes,pd&&pd.box&&pd.box.length)){ge=!0,Bn=Bf.shift;break}}return pd};$h(()=>ld(Oh,B.iconBox,o.WritingMode.horizontal),()=>{const gd=B.verticalTextBox;return ze.allowVerticalPlacement&&!(ss&&ss.box&&ss.box.length)&&E.numVerticalGlyphVertices>0&&gd?ld(gd,B.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),ss&&(ge=ss.box,_n=ss.offscreen);const xd=qh(ss&&ss.box);if(!ge&&this.prevPlacement){const gd=this.prevPlacement.variableOffsets[E.crossTileID];gd&&(this.variableOffsets[E.crossTileID]=gd,this.markUsedJustification(ze,gd.anchor,E,xd))}}else{const Hh=(ld,xd)=>{const gd=this.collisionIndex.placeCollisionBox(ld,Kh,ol,Gn,Lh.predicate,hh);return gd&&gd.box&&gd.box.length&&(this.markUsedOrientation(ze,xd,E),this.placedOrientations[E.crossTileID]=xd),gd};$h(()=>Hh(Oh,o.WritingMode.horizontal),()=>{const ld=B.verticalTextBox;return ze.allowVerticalPlacement&&E.numVerticalGlyphVertices>0&&ld?Hh(ld,o.WritingMode.vertical):{box:null,offscreen:null}}),qh(ss&&ss.box&&ss.box.length)}}if(il=ss,ge=il&&il.box&&il.box.length>0,_n=il&&il.offscreen,E.useRuntimeCollisionCircles){const qh=ze.text.placedSymbolArray.get(E.centerJustifiedTextSymbolIndex),$h=o.evaluateSizeForFeature(ze.textSizeData,ph,qh),Hh=Ft.get("text-padding");Qu=this.collisionIndex.placeCollisionCircles(Kh,qh,ze.lineVertexArray,ze.glyphOffsetArray,$h,Gn,ls,$s,q,Vd,Lh.predicate,E.collisionCircleDiameter,Hh,hh),Qu.circles.length&&Qu.collisionDetected&&!q&&o.warnOnce("Collisions detected, but collision boxes are not shown"),ge=fd||Qu.circles.length>0&&!Qu.collisionDetected,_n=_n&&Qu.offscreen}if(B.iconFeatureIndex&&(Sh=B.iconFeatureIndex),B.iconBox){const qh=$h=>{const Hh=Wd&&Bn?Jd($h,Bn.x,Bn.y,Sd,Vd,this.transform.angle):$h;return this.collisionIndex.placeCollisionBox(Hh,ud,ol,Gn,Lh.predicate,hh)};tl&&tl.box&&tl.box.length&&B.verticalIconBox?(fh=qh(B.verticalIconBox),St=fh.box.length>0):(fh=qh(B.iconBox),St=fh.box.length>0),_n=_n&&fh.offscreen}const Rh=Bh||E.numHorizontalGlyphVertices===0&&E.numVerticalGlyphVertices===0,Nh=Ch||E.numIconVertices===0;if(Rh||Nh?Nh?Rh||(St=St&&ge):ge=St&&ge:St=ge=St&&ge,ge&&il&&il.box&&this.collisionIndex.insertCollisionBox(il.box,Kh,Ft.get("text-ignore-placement"),ze.bucketInstanceId,tl&&tl.box&&Th?Th:wh,Lh.ID),St&&fh&&this.collisionIndex.insertCollisionBox(fh.box,ud,Ft.get("icon-ignore-placement"),ze.bucketInstanceId,Sh,Lh.ID),Qu&&(ge&&this.collisionIndex.insertCollisionCircles(Qu.circles,Kh,Ft.get("text-ignore-placement"),ze.bucketInstanceId,wh,Lh.ID),q)){const qh=ze.bucketInstanceId;let $h=this.collisionCircleArrays[qh];$h===void 0&&($h=this.collisionCircleArrays[qh]=new xf);for(let Hh=0;Hh<Qu.circles.length;Hh+=4)$h.circles.push(Qu.circles[Hh+0]),$h.circles.push(Qu.circles[Hh+1]),$h.circles.push(Qu.circles[Hh+2]),$h.circles.push(Qu.collisionDetected?1:0)}if(E.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(ze.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[E.crossTileID]=new Kd(ge||Of,St||L,_n||ze.justReloaded),A[E.crossTileID]=!0};if(Cf){if(g.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const E=ze.getSortedSymbolIndexes(this.transform.angle);for(let B=E.length-1;B>=0;--B){const ge=E[B];u(ze.symbolInstances.get(ge),ze.collisionArrays[ge])}}else for(let E=g.symbolInstanceStart;E<g.symbolInstanceEnd;E++)u(ze.symbolInstances.get(E),ze.collisionArrays[E]);if(q&&ze.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[ze.bucketInstanceId];o.invert(E.invProjMatrix,Gn),E.viewportMatrix=this.collisionIndex.getViewportMatrix()}ze.justReloaded=!1}markUsedJustification(g,A,q,ze){let Ft;Ft=ze===o.WritingMode.vertical?q.verticalPlacedTextSymbolIndex:{left:q.leftJustifiedTextSymbolIndex,center:q.centerJustifiedTextSymbolIndex,right:q.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(A)];const Gn=[q.leftJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.rightJustifiedTextSymbolIndex,q.verticalPlacedTextSymbolIndex];for(const ls of Gn)ls>=0&&(g.text.placedSymbolArray.get(ls).crossTileID=Ft>=0&&ls!==Ft?0:q.crossTileID)}markUsedOrientation(g,A,q){const ze=A===o.WritingMode.horizontal||A===o.WritingMode.horizontalOnly?A:0,Ft=A===o.WritingMode.vertical?A:0,Gn=[q.leftJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.rightJustifiedTextSymbolIndex];for(const ls of Gn)g.text.placedSymbolArray.get(ls).placedOrientation=ze;q.verticalPlacedTextSymbolIndex&&(g.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).placedOrientation=Ft)}commit(g){this.commitTime=g,this.zoomAtLastRecencyCheck=this.transform.zoom;const A=this.prevPlacement;let q=!1;this.prevZoomAdjustment=A?A.zoomAdjustment(this.transform.zoom):0;const ze=A?A.symbolFadeChange(g):1,Ft=A?A.opacities:{},Gn=A?A.variableOffsets:{},ls=A?A.placedOrientations:{};for(const $s in this.placements){const ol=this.placements[$s],nh=Ft[$s];nh?(this.opacities[$s]=new wd(nh,ze,ol.text,ol.icon),q=q||ol.text!==nh.text.placed||ol.icon!==nh.icon.placed):(this.opacities[$s]=new wd(null,ze,ol.text,ol.icon,ol.skipFade),q=q||ol.text||ol.icon)}for(const $s in Ft){const ol=Ft[$s];if(!this.opacities[$s]){const nh=new wd(ol,ze,!1,!1);nh.isHidden()||(this.opacities[$s]=nh,q=q||ol.text.placed||ol.icon.placed)}}for(const $s in Gn)this.variableOffsets[$s]||!this.opacities[$s]||this.opacities[$s].isHidden()||(this.variableOffsets[$s]=Gn[$s]);for(const $s in ls)this.placedOrientations[$s]||!this.opacities[$s]||this.opacities[$s].isHidden()||(this.placedOrientations[$s]=ls[$s]);if(A&&A.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");q?this.lastPlacementChangeTime=g:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=A?A.lastPlacementChangeTime:g)}updateLayerOpacities(g,A){const q={};for(const ze of A){const Ft=ze.getBucket(g);Ft&&ze.latestFeatureIndex&&g.id===Ft.layerIds[0]&&this.updateBucketOpacities(Ft,q,ze.collisionBoxArray)}}updateBucketOpacities(g,A,q){g.hasTextData()&&(g.text.opacityVertexArray.clear(),g.text.hasVisibleVertices=!1),g.hasIconData()&&(g.icon.opacityVertexArray.clear(),g.icon.hasVisibleVertices=!1),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexArray.clear(),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexArray.clear();const ze=g.layers[0].layout,Ft=new wd(null,0,!1,!1,!0),Gn=ze.get("text-allow-overlap"),ls=ze.get("icon-allow-overlap"),$s=ze.get("text-variable-anchor"),ol=ze.get("text-rotation-alignment")==="map",nh=ze.get("text-pitch-alignment")==="map",ih=ze.get("icon-text-fit")!=="none",ph=new wd(null,0,Gn&&(ls||!g.hasIconData()||ze.get("icon-optional")),ls&&(Gn||!g.hasTextData()||ze.get("text-optional")),!0);!g.collisionArrays&&q&&(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData())&&g.deserializeCollisionBoxes(q);const Lh=(Bh,Ch,Kh)=>{for(let fd=0;fd<Ch/4;fd++)Bh.opacityVertexArray.emplaceBack(Kh);Bh.hasVisibleVertices=Bh.hasVisibleVertices||Kh!==Pg};for(let Bh=0;Bh<g.symbolInstances.length;Bh++){const Ch=g.symbolInstances.get(Bh),{numHorizontalGlyphVertices:Kh,numVerticalGlyphVertices:fd,crossTileID:ud}=Ch;let jh=this.opacities[ud];A[ud]?jh=Ft:jh||(jh=ph,this.opacities[ud]=jh),A[ud]=!0;const Sd=Ch.numIconVertices>0,Vd=this.placedOrientations[Ch.crossTileID],Wd=Vd===o.WritingMode.vertical,Cf=Vd===o.WritingMode.horizontal||Vd===o.WritingMode.horizontalOnly;if(Kh>0||fd>0){const Of=Dy(jh.text);Lh(g.text,Kh,Wd?Pg:Of),Lh(g.text,fd,Cf?Pg:Of);const L=jh.text.isHidden();[Ch.rightJustifiedTextSymbolIndex,Ch.centerJustifiedTextSymbolIndex,Ch.leftJustifiedTextSymbolIndex].forEach(B=>{B>=0&&(g.text.placedSymbolArray.get(B).hidden=L||Wd?1:0)}),Ch.verticalPlacedTextSymbolIndex>=0&&(g.text.placedSymbolArray.get(Ch.verticalPlacedTextSymbolIndex).hidden=L||Cf?1:0);const u=this.variableOffsets[Ch.crossTileID];u&&this.markUsedJustification(g,u.anchor,Ch,Vd);const E=this.placedOrientations[Ch.crossTileID];E&&(this.markUsedJustification(g,"left",Ch,E),this.markUsedOrientation(g,E,Ch))}if(Sd){const Of=Dy(jh.icon),L=!(ih&&Ch.verticalPlacedIconSymbolIndex&&Wd);Ch.placedIconSymbolIndex>=0&&(Lh(g.icon,Ch.numIconVertices,L?Of:Pg),g.icon.placedSymbolArray.get(Ch.placedIconSymbolIndex).hidden=jh.icon.isHidden()),Ch.verticalPlacedIconSymbolIndex>=0&&(Lh(g.icon,Ch.numVerticalIconVertices,L?Pg:Of),g.icon.placedSymbolArray.get(Ch.verticalPlacedIconSymbolIndex).hidden=jh.icon.isHidden())}if(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData()){const Of=g.collisionArrays[Bh];if(Of){let L=new o.pointGeometry(0,0);if(Of.textBox||Of.verticalTextBox){let E=!0;if($s){const B=this.variableOffsets[ud];B?(L=Ah(B.anchor,B.width,B.height,B.textOffset,B.textBoxScale),ol&&L._rotate(nh?this.transform.angle:-this.transform.angle)):E=!1}Of.textBox&&qf(g.textCollisionBox.collisionVertexArray,jh.text.placed,!E||Wd,L.x,L.y),Of.verticalTextBox&&qf(g.textCollisionBox.collisionVertexArray,jh.text.placed,!E||Cf,L.x,L.y)}const u=!!(!Cf&&Of.verticalIconBox);Of.iconBox&&qf(g.iconCollisionBox.collisionVertexArray,jh.icon.placed,u,ih?L.x:0,ih?L.y:0),Of.verticalIconBox&&qf(g.iconCollisionBox.collisionVertexArray,jh.icon.placed,!u,ih?L.x:0,ih?L.y:0)}}}if(g.sortFeatures(this.transform.angle),this.retainedQueryData[g.bucketInstanceId]&&(this.retainedQueryData[g.bucketInstanceId].featureSortOrder=g.featureSortOrder),g.hasTextData()&&g.text.opacityVertexBuffer&&g.text.opacityVertexBuffer.updateData(g.text.opacityVertexArray),g.hasIconData()&&g.icon.opacityVertexBuffer&&g.icon.opacityVertexBuffer.updateData(g.icon.opacityVertexArray),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexBuffer&&g.iconCollisionBox.collisionVertexBuffer.updateData(g.iconCollisionBox.collisionVertexArray),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexBuffer&&g.textCollisionBox.collisionVertexBuffer.updateData(g.textCollisionBox.collisionVertexArray),g.text.opacityVertexArray.length!==g.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${g.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${g.text.layoutVertexArray.length}) / 4`);if(g.icon.opacityVertexArray.length!==g.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${g.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${g.icon.layoutVertexArray.length}) / 4`);if(g.bucketInstanceId in this.collisionCircleArrays){const Bh=this.collisionCircleArrays[g.bucketInstanceId];g.placementInvProjMatrix=Bh.invProjMatrix,g.placementViewportMatrix=Bh.viewportMatrix,g.collisionCircleArray=Bh.circles,delete this.collisionCircleArrays[g.bucketInstanceId]}}symbolFadeChange(g){return this.fadeDuration===0?1:(g-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(g){return Math.max(0,(this.transform.zoom-g)/1.5)}hasTransitions(g){return this.stale||g-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(g,A){const q=this.zoomAtLastRecencyCheck===A?1-this.zoomAdjustment(A):1;return this.zoomAtLastRecencyCheck=A,this.commitTime+this.fadeDuration*q>g}setStale(){this.stale=!0}}function qf(Y,g,A,q,ze){Y.emplaceBack(g?1:0,A?1:0,q||0,ze||0),Y.emplaceBack(g?1:0,A?1:0,q||0,ze||0),Y.emplaceBack(g?1:0,A?1:0,q||0,ze||0),Y.emplaceBack(g?1:0,A?1:0,q||0,ze||0)}const mp=Math.pow(2,25),Vp=Math.pow(2,24),om=Math.pow(2,17),Pd=Math.pow(2,16),Hg=Math.pow(2,9),$m=Math.pow(2,8),I_=Math.pow(2,1);function Dy(Y){if(Y.opacity===0&&!Y.placed)return 0;if(Y.opacity===1&&Y.placed)return 4294967295;const g=Y.placed?1:0,A=Math.floor(127*Y.opacity);return A*mp+g*Vp+A*om+g*Pd+A*Hg+g*$m+A*I_+g}const Pg=0;class l_{constructor(g){this._sortAcrossTiles=g.layout.get("symbol-z-order")!=="viewport-y"&&!g.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(g,A,q,ze,Ft){const Gn=this._bucketParts;for(;this._currentTileIndex<g.length;)if(A.getBucketParts(Gn,ze,g[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Ft())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Gn.sort((ls,$s)=>ls.sortKey-$s.sortKey));this._currentPartIndex<Gn.length;)if(A.placeLayerBucketPart(Gn[this._currentPartIndex],this._seenCrossTileIDs,q),this._currentPartIndex++,Ft())return!0;return!1}}class ev{constructor(g,A,q,ze,Ft,Gn,ls,$s){this.placement=new Od(g,A,Gn,ls,$s),this._currentPlacementIndex=q.length-1,this._forceFullPlacement=ze,this._showCollisionBoxes=Ft,this._done=!1}isDone(){return this._done}continuePlacement(g,A,q){const ze=o.exported.now(),Ft=()=>{const Gn=o.exported.now()-ze;return!this._forceFullPlacement&&Gn>2};for(;this._currentPlacementIndex>=0;){const Gn=A[g[this._currentPlacementIndex]],ls=this.placement.collisionIndex.transform.zoom;if(Gn.type==="symbol"&&(!Gn.minzoom||Gn.minzoom<=ls)&&(!Gn.maxzoom||Gn.maxzoom>ls)){if(this._inProgressLayer||(this._inProgressLayer=new l_(Gn)),this._inProgressLayer.continuePlacement(q[Gn.source],this.placement,this._showCollisionBoxes,Gn,Ft))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(g){return this.placement.commit(g),this.placement}}const c_=512/o.EXTENT/2;class ep{constructor(g,A,q){this.tileID=g,this.bucketInstanceId=q,this._symbolsByKey={};const ze=new Map;for(let Ft=0;Ft<A.length;Ft++){const Gn=A.get(Ft),ls=Gn.key,$s=ze.get(ls);$s?$s.push(Gn):ze.set(ls,[Gn])}for(const[Ft,Gn]of ze){const ls={positions:Gn.map($s=>({x:Math.floor($s.anchorX*c_),y:Math.floor($s.anchorY*c_)})),crossTileIDs:Gn.map($s=>$s.crossTileID)};if(ls.positions.length>128){const $s=new o.KDBush(ls.positions,ol=>ol.x,ol=>ol.y,16,Uint16Array);delete $s.points,delete ls.positions,ls.index=$s}this._symbolsByKey[Ft]=ls}}getScaledCoordinates(g,A){const{x:q,y:ze,z:Ft}=this.tileID.canonical,{x:Gn,y:ls,z:$s}=A.canonical,ol=c_/Math.pow(2,$s-Ft),nh=(ls*o.EXTENT+g.anchorY)*ol,ih=ze*o.EXTENT*c_;return{x:Math.floor((Gn*o.EXTENT+g.anchorX)*ol-q*o.EXTENT*c_),y:Math.floor(nh-ih)}}findMatches(g,A,q){const ze=this.tileID.canonical.z<A.canonical.z?1:Math.pow(2,this.tileID.canonical.z-A.canonical.z);for(let Ft=0;Ft<g.length;Ft++){const Gn=g.get(Ft);if(Gn.crossTileID)continue;const ls=this._symbolsByKey[Gn.key];if(!ls)continue;const $s=this.getScaledCoordinates(Gn,A);if(ls.index){const ol=ls.index.range($s.x-ze,$s.y-ze,$s.x+ze,$s.y+ze).sort();for(const nh of ol){const ih=ls.crossTileIDs[nh];if(!q[ih]){q[ih]=!0,Gn.crossTileID=ih;break}}}else if(ls.positions)for(let ol=0;ol<ls.positions.length;ol++){const nh=ls.positions[ol],ih=ls.crossTileIDs[ol];if(Math.abs(nh.x-$s.x)<=ze&&Math.abs(nh.y-$s.y)<=ze&&!q[ih]){q[ih]=!0,Gn.crossTileID=ih;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:g})=>g)}}class im{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(g){const A=Math.round((g-this.lng)/360);if(A!==0)for(const q in this.indexes){const ze=this.indexes[q],Ft={};for(const Gn in ze){const ls=ze[Gn];ls.tileID=ls.tileID.unwrapTo(ls.tileID.wrap+A),Ft[ls.tileID.key]=ls}this.indexes[q]=Ft}this.lng=g}addBucket(g,A,q){if(this.indexes[g.overscaledZ]&&this.indexes[g.overscaledZ][g.key]){if(this.indexes[g.overscaledZ][g.key].bucketInstanceId===A.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(g.overscaledZ,this.indexes[g.overscaledZ][g.key])}for(let Ft=0;Ft<A.symbolInstances.length;Ft++)A.symbolInstances.get(Ft).crossTileID=0;this.usedCrossTileIDs[g.overscaledZ]||(this.usedCrossTileIDs[g.overscaledZ]={});const ze=this.usedCrossTileIDs[g.overscaledZ];for(const Ft in this.indexes){const Gn=this.indexes[Ft];if(Number(Ft)>g.overscaledZ)for(const ls in Gn){const $s=Gn[ls];$s.tileID.isChildOf(g)&&$s.findMatches(A.symbolInstances,g,ze)}else{const ls=Gn[g.scaledTo(Number(Ft)).key];ls&&ls.findMatches(A.symbolInstances,g,ze)}}for(let Ft=0;Ft<A.symbolInstances.length;Ft++){const Gn=A.symbolInstances.get(Ft);Gn.crossTileID||(Gn.crossTileID=q.generate(),ze[Gn.crossTileID]=!0)}return this.indexes[g.overscaledZ]===void 0&&(this.indexes[g.overscaledZ]={}),this.indexes[g.overscaledZ][g.key]=new ep(g,A.symbolInstances,A.bucketInstanceId),!0}removeBucketCrossTileIDs(g,A){for(const q of A.getCrossTileIDsLists())for(const ze of q)delete this.usedCrossTileIDs[g][ze]}removeStaleBuckets(g){let A=!1;for(const q in this.indexes){const ze=this.indexes[q];for(const Ft in ze)g[ze[Ft].bucketInstanceId]||(this.removeBucketCrossTileIDs(q,ze[Ft]),delete ze[Ft],A=!0)}return A}}class mm{constructor(){this.layerIndexes={},this.crossTileIDs=new im,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(g,A,q){let ze=this.layerIndexes[g.id];ze===void 0&&(ze=this.layerIndexes[g.id]=new Jp);let Ft=!1;const Gn={};ze.handleWrapJump(q);for(const ls of A){const $s=ls.getBucket(g);$s&&g.id===$s.layerIds[0]&&($s.bucketInstanceId||($s.bucketInstanceId=++this.maxBucketInstanceId),ze.addBucket(ls.tileID,$s,this.crossTileIDs)&&(Ft=!0),Gn[$s.bucketInstanceId]=!0)}return ze.removeStaleBuckets(Gn)&&(Ft=!0),Ft}pruneUnusedLayers(g){const A={};g.forEach(q=>{A[q]=!0});for(const q in this.layerIndexes)A[q]||delete this.layerIndexes[q]}}const kn=(Y,g)=>o.emitValidationErrors(Y,g&&g.filter(A=>A.identifier!=="source.canvas")),el=o.pick(Yf,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),_h=o.pick(Yf,["setCenter","setZoom","setBearing","setPitch"]),Vh=function(){const Y={},g=o.spec.$version;for(const A in o.spec.$root){const q=o.spec.$root[A];if(q.required){let ze=null;ze=A==="version"?g:q.type==="array"?[]:{},ze!=null&&(Y[A]=ze)}}return Y}();class rd extends o.Evented{constructor(g,A={}){super(),this.map=g,this.dispatcher=new Fd(Cp(),this,g._getMapId()),this.imageManager=new cd,this.imageManager.setEventedParent(this),this.glyphManager=new md(g._requestManager,A.localIdeographFontFamily),this.lineAtlas=new Td(256,512),this.crossTileSymbolIndex=new mm,this._spritesImagesIds={},this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const q=this;this._rtlTextPluginCallback=rd.registerForPluginStateChange(ze=>{q.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ze.pluginStatus,pluginURL:ze.pluginURL},(Ft,Gn)=>{if(o.triggerPluginCompletionEvent(Ft),Gn&&Gn.every(ls=>ls))for(const ls in q.sourceCaches)q.sourceCaches[ls].reload()})}),this.on("data",ze=>{if(ze.dataType!=="source"||ze.sourceDataType!=="metadata")return;const Ft=this.sourceCaches[ze.sourceId];if(!Ft)return;const Gn=Ft.getSource();if(Gn&&Gn.vectorLayerIds)for(const ls in this._layers){const $s=this._layers[ls];$s.source===Gn.id&&this._validateLayer($s)}})}loadURL(g,A={},q){this.fire(new o.Event("dataloading",{dataType:"style"})),A.validate=typeof A.validate!="boolean"||A.validate;const ze=this.map._requestManager.transformRequest(g,Js.Style);this._request=o.getJSON(ze,(Ft,Gn)=>{this._request=null,Ft?this.fire(new o.ErrorEvent(Ft)):Gn&&this._load(Gn,A,q)})}loadJSON(g,A={},q){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,A.validate=A.validate!==!1,this._load(g,A,q)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Vh,{validate:!1})}_load(g,A,q){const ze=A.transformStyle?A.transformStyle(q,g):g;if(A.validate&&kn(this,o.validateStyle(ze)))return;this._loaded=!0,this.stylesheet=ze;for(const Gn in ze.sources)this.addSource(Gn,ze.sources[Gn],{validate:!1});ze.sprite?this._loadSprite(ze.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(ze.glyphs);const Ft=Pp(this.stylesheet.layers);this._order=Ft.map(Gn=>Gn.id),this._layers={},this._serializedLayers={};for(let Gn of Ft)Gn=o.createStyleLayer(Gn),Gn.setEventedParent(this,{layer:{id:Gn.id}}),this._layers[Gn.id]=Gn,this._serializedLayers[Gn.id]=Gn.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ed(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(g,A=!1,q){this.imageManager.setLoaded(!1),this._spriteRequest=function(ze,Ft,Gn,ls){const $s=Mh(ze),ol=Gn>1?"@2x":"";let nh;const ih=[],ph=[],Lh={},Bh={};for(const{id:Kh,url:fd}of $s){const ud=ih.push(o.getJSON(Ft.transformRequest(Ft.normalizeSpriteURL(fd,ol,".json"),Js.SpriteJSON),(Sd,Vd)=>{ih.splice(ud,1),nh||(nh=Sd,Lh[Kh]=Vd,Ch())})),jh=ph.push(lh.getImage(Ft.transformRequest(Ft.normalizeSpriteURL(fd,ol,".png"),Js.SpriteImage),(Sd,Vd)=>{ph.splice(jh,1),nh||(nh=Sd,Bh[Kh]=Vd,Ch())}))}function Ch(){const Kh=Object.values(Lh).length,fd=Object.values(Bh).length;if(nh)ls(nh);else if($s.length===Kh&&Kh===fd){const ud={};for(const jh in Lh){ud[jh]={};const Sd=o.exported.getImageCanvasContext(Bh[jh]),Vd=Lh[jh];for(const Wd in Vd){const{width:Cf,height:Of,x:L,y:u,sdf:E,pixelRatio:B,stretchX:ge,stretchY:St,content:_n}=Vd[Wd];ud[jh][Wd]={data:null,pixelRatio:B,sdf:E,stretchX:ge,stretchY:St,content:_n,spriteData:{width:Cf,height:Of,x:L,y:u,context:Sd}}}}ls(null,ud)}}return{cancel(){if(ih.length)for(const Kh of ih)Kh.cancel(),ih.splice(ih.indexOf(Kh),1);if(ph.length)for(const Kh of ph)Kh.cancel(),ph.splice(ph.indexOf(Kh),1)}}}(g,this.map._requestManager,this.map.getPixelRatio(),(ze,Ft)=>{if(this._spriteRequest=null,ze)this.fire(new o.ErrorEvent(ze));else if(Ft)for(const Gn in Ft){this._spritesImagesIds[Gn]=[];const ls=this._spritesImagesIds[Gn]?this._spritesImagesIds[Gn].filter($s=>!($s in Ft)):[];for(const $s of ls)this.imageManager.removeImage($s),this._changedImages[$s]=!0;for(const $s in Ft[Gn]){const ol=Gn==="default"?$s:`${Gn}:${$s}`;this._spritesImagesIds[Gn].push(ol),ol in this.imageManager.images?this.imageManager.updateImage(ol,Ft[Gn][$s],!1):this.imageManager.addImage(ol,Ft[Gn][$s]),A&&(this._changedImages[ol]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),A&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),q&&q(ze)})}_unloadSprite(){for(const g of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(g),this._changedImages[g]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(g){const A=this.sourceCaches[g.source];if(!A)return;const q=g.sourceLayer;if(!q)return;const ze=A.getSource();(ze.type==="geojson"||ze.vectorLayerIds&&ze.vectorLayerIds.indexOf(q)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${q}" does not exist on source "${ze.id}" as specified by style layer "${g.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(g){const A=[];for(const q of g){const ze=this._layers[q];ze.type!=="custom"&&A.push(ze.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(g){if(!this._loaded)return;const A=this._changed;if(this._changed){const ze=Object.keys(this._updatedLayers),Ft=Object.keys(this._removedLayers);(ze.length||Ft.length)&&this._updateWorkerLayers(ze,Ft);for(const Gn in this._updatedSources){const ls=this._updatedSources[Gn];if(ls==="reload")this._reloadSource(Gn);else{if(ls!=="clear")throw new Error(`Invalid action ${ls}`);this._clearSource(Gn)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Gn in this._updatedPaintProps)this._layers[Gn].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}const q={};for(const ze in this.sourceCaches){const Ft=this.sourceCaches[ze];q[ze]=Ft.used,Ft.used=!1}for(const ze of this._order){const Ft=this._layers[ze];Ft.recalculate(g,this._availableImages),!Ft.isHidden(g.zoom)&&Ft.source&&(this.sourceCaches[Ft.source].used=!0)}for(const ze in q){const Ft=this.sourceCaches[ze];q[ze]!==Ft.used&&Ft.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ze}))}this.light.recalculate(g),this.z=g.zoom,A&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const g=Object.keys(this._changedImages);if(g.length){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(g,A){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:A})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(g,A={}){if(this._checkLoaded(),g=A.transformStyle?A.transformStyle(this.serialize(),g):g,kn(this,o.validateStyle(g)))return!1;(g=o.clone$1(g)).layers=Pp(g.layers);const q=function(Ft,Gn){if(!Ft)return[{command:Yf.setStyle,args:[Gn]}];let ls=[];try{if(!nt(Ft.version,Gn.version))return[{command:Yf.setStyle,args:[Gn]}];nt(Ft.center,Gn.center)||ls.push({command:Yf.setCenter,args:[Gn.center]}),nt(Ft.zoom,Gn.zoom)||ls.push({command:Yf.setZoom,args:[Gn.zoom]}),nt(Ft.bearing,Gn.bearing)||ls.push({command:Yf.setBearing,args:[Gn.bearing]}),nt(Ft.pitch,Gn.pitch)||ls.push({command:Yf.setPitch,args:[Gn.pitch]}),nt(Ft.sprite,Gn.sprite)||ls.push({command:Yf.setSprite,args:[Gn.sprite]}),nt(Ft.glyphs,Gn.glyphs)||ls.push({command:Yf.setGlyphs,args:[Gn.glyphs]}),nt(Ft.transition,Gn.transition)||ls.push({command:Yf.setTransition,args:[Gn.transition]}),nt(Ft.light,Gn.light)||ls.push({command:Yf.setLight,args:[Gn.light]});const $s={},ol=[];(function(ih,ph,Lh,Bh){let Ch;for(Ch in ph=ph||{},ih=ih||{})Object.prototype.hasOwnProperty.call(ih,Ch)&&(Object.prototype.hasOwnProperty.call(ph,Ch)||am(Ch,Lh,Bh));for(Ch in ph)Object.prototype.hasOwnProperty.call(ph,Ch)&&(Object.prototype.hasOwnProperty.call(ih,Ch)?nt(ih[Ch],ph[Ch])||(ih[Ch].type==="geojson"&&ph[Ch].type==="geojson"&&Op(ih,ph,Ch)?Lh.push({command:Yf.setGeoJSONSourceData,args:[Ch,ph[Ch].data]}):Xd(Ch,ph,Lh,Bh)):qp(Ch,ph,Lh))})(Ft.sources,Gn.sources,ol,$s);const nh=[];Ft.layers&&Ft.layers.forEach(ih=>{$s[ih.source]?ls.push({command:Yf.removeLayer,args:[ih.id]}):nh.push(ih)}),ls=ls.concat(ol),function(ih,ph,Lh){ph=ph||[];const Bh=(ih=ih||[]).map(Tm),Ch=ph.map(Tm),Kh=ih.reduce(hp,{}),fd=ph.reduce(hp,{}),ud=Bh.slice(),jh=Object.create(null);let Sd,Vd,Wd,Cf,Of,L,u;for(Sd=0,Vd=0;Sd<Bh.length;Sd++)Wd=Bh[Sd],Object.prototype.hasOwnProperty.call(fd,Wd)?Vd++:(Lh.push({command:Yf.removeLayer,args:[Wd]}),ud.splice(ud.indexOf(Wd,Vd),1));for(Sd=0,Vd=0;Sd<Ch.length;Sd++)Wd=Ch[Ch.length-1-Sd],ud[ud.length-1-Sd]!==Wd&&(Object.prototype.hasOwnProperty.call(Kh,Wd)?(Lh.push({command:Yf.removeLayer,args:[Wd]}),ud.splice(ud.lastIndexOf(Wd,ud.length-Vd),1)):Vd++,L=ud[ud.length-Sd],Lh.push({command:Yf.addLayer,args:[fd[Wd],L]}),ud.splice(ud.length-Sd,0,Wd),jh[Wd]=!0);for(Sd=0;Sd<Ch.length;Sd++)if(Wd=Ch[Sd],Cf=Kh[Wd],Of=fd[Wd],!jh[Wd]&&!nt(Cf,Of))if(nt(Cf.source,Of.source)&&nt(Cf["source-layer"],Of["source-layer"])&&nt(Cf.type,Of.type)){for(u in nm(Cf.layout,Of.layout,Lh,Wd,null,Yf.setLayoutProperty),nm(Cf.paint,Of.paint,Lh,Wd,null,Yf.setPaintProperty),nt(Cf.filter,Of.filter)||Lh.push({command:Yf.setFilter,args:[Wd,Of.filter]}),nt(Cf.minzoom,Of.minzoom)&&nt(Cf.maxzoom,Of.maxzoom)||Lh.push({command:Yf.setLayerZoomRange,args:[Wd,Of.minzoom,Of.maxzoom]}),Cf)Object.prototype.hasOwnProperty.call(Cf,u)&&u!=="layout"&&u!=="paint"&&u!=="filter"&&u!=="metadata"&&u!=="minzoom"&&u!=="maxzoom"&&(u.indexOf("paint.")===0?nm(Cf[u],Of[u],Lh,Wd,u.slice(6),Yf.setPaintProperty):nt(Cf[u],Of[u])||Lh.push({command:Yf.setLayerProperty,args:[Wd,u,Of[u]]}));for(u in Of)Object.prototype.hasOwnProperty.call(Of,u)&&!Object.prototype.hasOwnProperty.call(Cf,u)&&u!=="layout"&&u!=="paint"&&u!=="filter"&&u!=="metadata"&&u!=="minzoom"&&u!=="maxzoom"&&(u.indexOf("paint.")===0?nm(Cf[u],Of[u],Lh,Wd,u.slice(6),Yf.setPaintProperty):nt(Cf[u],Of[u])||Lh.push({command:Yf.setLayerProperty,args:[Wd,u,Of[u]]}))}else Lh.push({command:Yf.removeLayer,args:[Wd]}),L=ud[ud.lastIndexOf(Wd)+1],Lh.push({command:Yf.addLayer,args:[Of,L]})}(nh,Gn.layers,ls)}catch($s){console.warn("Unable to compute style diff:",$s),ls=[{command:Yf.setStyle,args:[Gn]}]}return ls}(this.serialize(),g).filter(Ft=>!(Ft.command in _h));if(q.length===0)return!1;const ze=q.filter(Ft=>!(Ft.command in el));if(ze.length>0)throw new Error(`Unimplemented: ${ze.map(Ft=>Ft.command).join(", ")}.`);return q.forEach(Ft=>{Ft.command!=="setTransition"&&this[Ft.command].apply(this,Ft.args)}),this.stylesheet=g,!0}addImage(g,A){if(this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" already exists.`)));this.imageManager.addImage(g,A),this._afterImageUpdated(g)}updateImage(g,A){this.imageManager.updateImage(g,A)}getImage(g){return this.imageManager.getImage(g)}removeImage(g){if(!this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" does not exist.`)));this.imageManager.removeImage(g),this._afterImageUpdated(g)}_afterImageUpdated(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(g,A,q={}){if(this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error(`Source "${g}" already exists.`);if(!A.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(A).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(A.type)>=0&&this._validate(o.validateStyle.source,`sources.${g}`,A,null,q))return;this.map&&this.map._collectResourceTiming&&(A.collectResourceTiming=!0);const ze=this.sourceCaches[g]=new Ld(g,A,this.dispatcher);ze.style=this,ze.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:ze.serialize(),sourceId:g})),ze.onAdd(this.map),this._changed=!0}removeSource(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(const q in this._layers)if(this._layers[q].source===g)return this.fire(new o.ErrorEvent(new Error(`Source "${g}" cannot be removed while layer "${q}" is using it.`)));const A=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],A.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),A.setEventedParent(null),A.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(g,A){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error(`There is no source with this ID=${g}`);const q=this.sourceCaches[g].getSource();if(q.type!=="geojson")throw new Error(`geojsonSource.type is ${q.type}, which is !== 'geojson`);q.setData(A),this._changed=!0}getSource(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()}addLayer(g,A,q={}){this._checkLoaded();const ze=g.id;if(this.getLayer(ze))return void this.fire(new o.ErrorEvent(new Error(`Layer "${ze}" already exists on this map.`)));let Ft;if(g.type==="custom"){if(kn(this,o.validateCustomStyleLayer(g)))return;Ft=o.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(ze,g.source),g=o.clone$1(g),g=o.extend(g,{source:ze})),this._validate(o.validateStyle.layer,`layers.${ze}`,g,{arrayIndex:-1},q))return;Ft=o.createStyleLayer(g),this._validateLayer(Ft),Ft.setEventedParent(this,{layer:{id:ze}}),this._serializedLayers[Ft.id]=Ft.serialize()}const Gn=A?this._order.indexOf(A):this._order.length;if(A&&Gn===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${ze}" before non-existing layer "${A}".`)));else{if(this._order.splice(Gn,0,ze),this._layerOrderChanged=!0,this._layers[ze]=Ft,this._removedLayers[ze]&&Ft.source&&Ft.type!=="custom"){const ls=this._removedLayers[ze];delete this._removedLayers[ze],ls.type!==Ft.type?this._updatedSources[Ft.source]="clear":(this._updatedSources[Ft.source]="reload",this.sourceCaches[Ft.source].pause())}this._updateLayer(Ft),Ft.onAdd&&Ft.onAdd(this.map)}}moveLayer(g,A){if(this._checkLoaded(),this._changed=!0,!this._layers[g])return void this.fire(new o.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be moved.`)));if(g===A)return;const q=this._order.indexOf(g);this._order.splice(q,1);const ze=A?this._order.indexOf(A):this._order.length;A&&ze===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${g}" before non-existing layer "${A}".`))):(this._order.splice(ze,0,g),this._layerOrderChanged=!0)}removeLayer(g){this._checkLoaded();const A=this._layers[g];if(!A)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${g}".`)));A.setEventedParent(null);const q=this._order.indexOf(g);this._order.splice(q,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=A,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],A.onRemove&&A.onRemove(this.map)}getLayer(g){return this._layers[g]}hasLayer(g){return g in this._layers}setLayerZoomRange(g,A,q){this._checkLoaded();const ze=this.getLayer(g);ze?ze.minzoom===A&&ze.maxzoom===q||(A!=null&&(ze.minzoom=A),q!=null&&(ze.maxzoom=q),this._updateLayer(ze)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${g}".`)))}setFilter(g,A,q={}){this._checkLoaded();const ze=this.getLayer(g);if(ze){if(!nt(ze.filter,A))return A==null?(ze.filter=void 0,void this._updateLayer(ze)):void(this._validate(o.validateStyle.filter,`layers.${ze.id}.filter`,A,null,q)||(ze.filter=o.clone$1(A),this._updateLayer(ze)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${g}".`)))}getFilter(g){return o.clone$1(this.getLayer(g).filter)}setLayoutProperty(g,A,q,ze={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?nt(Ft.getLayoutProperty(A),q)||(Ft.setLayoutProperty(A,q,ze),this._updateLayer(Ft)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getLayoutProperty(g,A){const q=this.getLayer(g);if(q)return q.getLayoutProperty(A);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${g}".`)))}setPaintProperty(g,A,q,ze={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?nt(Ft.getPaintProperty(A),q)||(Ft.setPaintProperty(A,q,ze)&&this._updateLayer(Ft),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getPaintProperty(g,A){return this.getLayer(g).getPaintProperty(A)}setFeatureState(g,A){this._checkLoaded();const q=g.source,ze=g.sourceLayer,Ft=this.sourceCaches[q];if(Ft===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${q}' does not exist in the map's style.`)));const Gn=Ft.getSource().type;Gn==="geojson"&&ze?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Gn!=="vector"||ze?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),Ft.setFeatureState(ze,g.id,A)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(g,A){this._checkLoaded();const q=g.source,ze=this.sourceCaches[q];if(ze===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${q}' does not exist in the map's style.`)));const Ft=ze.getSource().type,Gn=Ft==="vector"?g.sourceLayer:void 0;Ft!=="vector"||Gn?A&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):ze.removeFeatureState(Gn,g.id,A):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(g){this._checkLoaded();const A=g.source,q=g.sourceLayer,ze=this.sourceCaches[A];if(ze!==void 0)return ze.getSource().type!=="vector"||q?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),ze.getFeatureState(q,g.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${A}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,g=>g.serialize()),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(g){const A=Gn=>this._layers[Gn].type==="fill-extrusion",q={},ze=[];for(let Gn=this._order.length-1;Gn>=0;Gn--){const ls=this._order[Gn];if(A(ls)){q[ls]=Gn;for(const $s of g){const ol=$s[ls];if(ol)for(const nh of ol)ze.push(nh)}}}ze.sort((Gn,ls)=>ls.intersectionZ-Gn.intersectionZ);const Ft=[];for(let Gn=this._order.length-1;Gn>=0;Gn--){const ls=this._order[Gn];if(A(ls))for(let $s=ze.length-1;$s>=0;$s--){const ol=ze[$s].feature;if(q[ol.layer.id]<Gn)break;Ft.push(ol),ze.pop()}else for(const $s of g){const ol=$s[ls];if(ol)for(const nh of ol)Ft.push(nh.feature)}}return Ft}queryRenderedFeatures(g,A,q){A&&A.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",A.filter,null,A);const ze={};if(A&&A.layers){if(!Array.isArray(A.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Gn of A.layers){const ls=this._layers[Gn];if(!ls)return this.fire(new o.ErrorEvent(new Error(`The layer '${Gn}' does not exist in the map's style and cannot be queried for features.`))),[];ze[ls.source]=!0}}const Ft=[];A.availableImages=this._availableImages;for(const Gn in this.sourceCaches)A.layers&&!ze[Gn]||Ft.push(Qh(this.sourceCaches[Gn],this._layers,this._serializedLayers,g,A,q));return this.placement&&Ft.push(function(Gn,ls,$s,ol,nh,ih,ph){const Lh={},Bh=ih.queryRenderedSymbols(ol),Ch=[];for(const Kh of Object.keys(Bh).map(Number))Ch.push(ph[Kh]);Ch.sort(Yd);for(const Kh of Ch){const fd=Kh.featureIndex.lookupSymbolFeatures(Bh[Kh.bucketInstanceId],ls,Kh.bucketIndex,Kh.sourceLayerIndex,nh.filter,nh.layers,nh.availableImages,Gn);for(const ud in fd){const jh=Lh[ud]=Lh[ud]||[],Sd=fd[ud];Sd.sort((Vd,Wd)=>{const Cf=Kh.featureSortOrder;if(Cf){const Of=Cf.indexOf(Vd.featureIndex);return Cf.indexOf(Wd.featureIndex)-Of}return Wd.featureIndex-Vd.featureIndex});for(const Vd of Sd)jh.push(Vd)}}for(const Kh in Lh)Lh[Kh].forEach(fd=>{const ud=fd.feature,jh=$s[Gn[Kh].source].getFeatureState(ud.layer["source-layer"],ud.id);ud.source=ud.layer.source,ud.layer["source-layer"]&&(ud.sourceLayer=ud.layer["source-layer"]),ud.state=jh});return Lh}(this._layers,this._serializedLayers,this.sourceCaches,g,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ft)}querySourceFeatures(g,A){A&&A.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",A.filter,null,A);const q=this.sourceCaches[g];return q?function(ze,Ft){const Gn=ze.getRenderableIds().map(ol=>ze.getTileByID(ol)),ls=[],$s={};for(let ol=0;ol<Gn.length;ol++){const nh=Gn[ol],ih=nh.tileID.canonical.key;$s[ih]||($s[ih]=!0,nh.querySourceFeatures(ls,Ft))}return ls}(q,A):[]}addSourceType(g,A,q){return rd.getSourceType(g)?q(new Error(`A source type called "${g}" already exists.`)):(rd.setSourceType(g,A),A.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:A.workerSourceURL},q):q(null,null))}getLight(){return this.light.getLight()}setLight(g,A={}){this._checkLoaded();const q=this.light.getLight();let ze=!1;for(const Gn in g)if(!nt(g[Gn],q[Gn])){ze=!0;break}if(!ze)return;const Ft={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,A),this.light.updateTransitions(Ft)}_validate(g,A,q,ze,Ft={}){return(!Ft||Ft.validate!==!1)&&kn(this,g.call(o.validateStyle,o.extend({key:A,style:this.serialize(),value:q,styleSpec:o.spec},ze)))}_remove(g=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const A in this._layers)this._layers[A].setEventedParent(null);for(const A in this.sourceCaches){const q=this.sourceCaches[A];q.setEventedParent(null),q.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(g)}_clearSource(g){this.sourceCaches[g].clearTiles()}_reloadSource(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()}_updateSources(g){for(const A in this.sourceCaches)this.sourceCaches[A].update(g,this.map.terrain)}_generateCollisionBoxes(){for(const g in this.sourceCaches)this._reloadSource(g)}_updatePlacement(g,A,q,ze,Ft=!1){let Gn=!1,ls=!1;const $s={};for(const ol of this._order){const nh=this._layers[ol];if(nh.type!=="symbol")continue;if(!$s[nh.source]){const ph=this.sourceCaches[nh.source];$s[nh.source]=ph.getRenderableIds(!0).map(Lh=>ph.getTileByID(Lh)).sort((Lh,Bh)=>Bh.tileID.overscaledZ-Lh.tileID.overscaledZ||(Lh.tileID.isLessThan(Bh.tileID)?-1:1))}const ih=this.crossTileSymbolIndex.addLayer(nh,$s[nh.source],g.center.lng);Gn=Gn||ih}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((Ft=Ft||this._layerOrderChanged||q===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),g.zoom))&&(this.pauseablePlacement=new ev(g,this.map.terrain,this._order,Ft,A,q,ze,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),ls=!0),Gn&&this.pauseablePlacement.placement.setStale()),ls||Gn)for(const ol of this._order){const nh=this._layers[ol];nh.type==="symbol"&&this.placement.updateLayerOpacities(nh,$s[nh.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()}getImages(g,A,q){this.imageManager.getImages(A.icons,q),this._updateTilesForChangedImages();const ze=this.sourceCaches[A.source];ze&&ze.setDependencies(A.tileID.key,A.type,A.icons)}getGlyphs(g,A,q){this.glyphManager.getGlyphs(A.stacks,q);const ze=this.sourceCaches[A.source];ze&&ze.setDependencies(A.tileID.key,A.type,[""])}getResource(g,A,q){return o.makeRequest(A,q)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(g,A={}){this._checkLoaded(),g&&this._validate(o.validateStyle.glyphs,"glyphs",g,null,A)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=g,this.glyphManager.entries={},this.glyphManager.setURL(g))}addSprite(g,A,q={},ze){this._checkLoaded();const Ft=[{id:g,url:A}],Gn=[...Mh(this.stylesheet.sprite),...Ft];this._validate(o.validateStyle.sprite,"sprite",Gn,null,q)||(this.stylesheet.sprite=Gn,this._loadSprite(Ft,!0,ze))}removeSprite(g){this._checkLoaded();const A=Mh(this.stylesheet.sprite);if(A.find(q=>q.id===g)){if(this._spritesImagesIds[g])for(const q of this._spritesImagesIds[g])this.imageManager.removeImage(q),this._changedImages[q]=!0;A.splice(A.findIndex(q=>q.id===g),1),this.stylesheet.sprite=A.length>0?A:void 0,delete this._spritesImagesIds[g],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${g}" doesn't exists on this map.`)))}getSprite(){return Mh(this.stylesheet.sprite)}setSprite(g,A={},q){this._checkLoaded(),g&&this._validate(o.validateStyle.sprite,"sprite",g,null,A)||(this.stylesheet.sprite=g,g?this._loadSprite(g,!0,q):(this._unloadSprite(),q(null)))}}rd.getSourceType=function(Y){return bp[Y]},rd.setSourceType=function(Y,g){bp[Y]=g},rd.registerForPluginStateChange=o.registerForPluginStateChange;var od=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),sd="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Gf={prelude:Ef(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ef(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ef(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ef(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ef("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ef(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ef(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ef("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ef("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ef("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ef(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ef(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ef(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ef(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ef(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ef(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ef(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ef(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ef(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ef(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ef(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ef(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ef(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ef("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",sd),terrainDepth:Ef("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",sd),terrainCoords:Ef("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",sd)};function Ef(Y,g){const A=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,q=g.match(/attribute ([\w]+) ([\w]+)/g),ze=Y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Ft=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Gn=Ft?Ft.concat(ze):ze,ls={};return{fragmentSource:Y=Y.replace(A,($s,ol,nh,ih,ph)=>(ls[ph]=!0,ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
varying ${nh} ${ih} ${ph};
#else
uniform ${nh} ${ih} u_${ph};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ph}
    ${nh} ${ih} ${ph} = u_${ph};
#endif
`)),vertexSource:g=g.replace(A,($s,ol,nh,ih,ph)=>{const Lh=ih==="float"?"vec2":"vec4",Bh=ph.match(/color/)?"color":Lh;return ls[ph]?ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${nh} ${Lh} a_${ph};
varying ${nh} ${ih} ${ph};
#else
uniform ${nh} ${ih} u_${ph};
#endif
`:Bh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = a_${ph};
#else
    ${nh} ${ih} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = unpack_mix_${Bh}(a_${ph}, u_${ph}_t);
#else
    ${nh} ${ih} ${ph} = u_${ph};
#endif
`:ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${nh} ${Lh} a_${ph};
#else
uniform ${nh} ${ih} u_${ph};
#endif
`:Bh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${nh} ${ih} ${ph} = a_${ph};
#else
    ${nh} ${ih} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${nh} ${ih} ${ph} = unpack_mix_${Bh}(a_${ph}, u_${ph}_t);
#else
    ${nh} ${ih} ${ph} = u_${ph};
#endif
`}),staticAttributes:q,staticUniforms:Gn}}class _p{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(g,A,q,ze,Ft,Gn,ls,$s,ol){this.context=g;let nh=this.boundPaintVertexBuffers.length!==ze.length;for(let ih=0;!nh&&ih<ze.length;ih++)this.boundPaintVertexBuffers[ih]!==ze[ih]&&(nh=!0);g.extVertexArrayObject&&this.vao&&this.boundProgram===A&&this.boundLayoutVertexBuffer===q&&!nh&&this.boundIndexBuffer===Ft&&this.boundVertexOffset===Gn&&this.boundDynamicVertexBuffer===ls&&this.boundDynamicVertexBuffer2===$s&&this.boundDynamicVertexBuffer3===ol?(g.bindVertexArrayOES.set(this.vao),ls&&ls.bind(),Ft&&Ft.dynamicDraw&&Ft.bind(),$s&&$s.bind(),ol&&ol.bind()):this.freshBind(A,q,ze,Ft,Gn,ls,$s,ol)}freshBind(g,A,q,ze,Ft,Gn,ls,$s){let ol;const nh=g.numAttributes,ih=this.context,ph=ih.gl;if(ih.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ih.extVertexArrayObject.createVertexArrayOES(),ih.bindVertexArrayOES.set(this.vao),ol=0,this.boundProgram=g,this.boundLayoutVertexBuffer=A,this.boundPaintVertexBuffers=q,this.boundIndexBuffer=ze,this.boundVertexOffset=Ft,this.boundDynamicVertexBuffer=Gn,this.boundDynamicVertexBuffer2=ls,this.boundDynamicVertexBuffer3=$s;else{ol=ih.currentNumAttributes||0;for(let Lh=nh;Lh<ol;Lh++)ph.disableVertexAttribArray(Lh)}A.enableAttributes(ph,g);for(const Lh of q)Lh.enableAttributes(ph,g);Gn&&Gn.enableAttributes(ph,g),ls&&ls.enableAttributes(ph,g),$s&&$s.enableAttributes(ph,g),A.bind(),A.setVertexAttribPointers(ph,g,Ft);for(const Lh of q)Lh.bind(),Lh.setVertexAttribPointers(ph,g,Ft);Gn&&(Gn.bind(),Gn.setVertexAttribPointers(ph,g,Ft)),ze&&ze.bind(),ls&&(ls.bind(),ls.setVertexAttribPointers(ph,g,Ft)),$s&&($s.bind(),$s.setVertexAttribPointers(ph,g,Ft)),ih.currentNumAttributes=nh}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sp(Y){const g=[];for(let A=0;A<Y.length;A++){if(Y[A]===null)continue;const q=Y[A].split(" ");g.push(q.pop())}return g}class lp{constructor(g,A,q,ze,Ft,Gn,ls){const $s=g.gl;this.program=$s.createProgram();const ol=sp(q.staticAttributes),nh=ze?ze.getBinderAttributes():[],ih=ol.concat(nh),ph=Gf.prelude.staticUniforms?sp(Gf.prelude.staticUniforms):[],Lh=q.staticUniforms?sp(q.staticUniforms):[],Bh=ze?ze.getBinderUniforms():[],Ch=ph.concat(Lh).concat(Bh),Kh=[];for(const Cf of Ch)Kh.indexOf(Cf)<0&&Kh.push(Cf);const fd=ze?ze.defines():[];Gn&&fd.push("#define OVERDRAW_INSPECTOR;"),ls&&fd.push("#define TERRAIN3D;");const ud=fd.concat(Gf.prelude.fragmentSource,q.fragmentSource).join(`
`),jh=fd.concat(Gf.prelude.vertexSource,q.vertexSource).join(`
`),Sd=$s.createShader($s.FRAGMENT_SHADER);if($s.isContextLost())return void(this.failedToCreate=!0);$s.shaderSource(Sd,ud),$s.compileShader(Sd),$s.attachShader(this.program,Sd);const Vd=$s.createShader($s.VERTEX_SHADER);if($s.isContextLost())return void(this.failedToCreate=!0);$s.shaderSource(Vd,jh),$s.compileShader(Vd),$s.attachShader(this.program,Vd),this.attributes={};const Wd={};this.numAttributes=ih.length;for(let Cf=0;Cf<this.numAttributes;Cf++)ih[Cf]&&($s.bindAttribLocation(this.program,Cf,ih[Cf]),this.attributes[ih[Cf]]=Cf);$s.linkProgram(this.program),$s.deleteShader(Vd),$s.deleteShader(Sd);for(let Cf=0;Cf<Kh.length;Cf++){const Of=Kh[Cf];if(Of&&!Wd[Of]){const L=$s.getUniformLocation(this.program,Of);L&&(Wd[Of]=L)}}this.fixedUniforms=Ft(g,Wd),this.terrainUniforms=((Cf,Of)=>({u_depth:new o.Uniform1i(Cf,Of.u_depth),u_terrain:new o.Uniform1i(Cf,Of.u_terrain),u_terrain_dim:new o.Uniform1f(Cf,Of.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(Cf,Of.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(Cf,Of.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(Cf,Of.u_terrain_exaggeration)}))(g,Wd),this.binderUniforms=ze?ze.getUniforms(g,Wd):[]}draw(g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih,ph,Lh,Bh,Ch,Kh,fd,ud){const jh=g.gl;if(this.failedToCreate)return;if(g.program.set(this.program),g.setDepthMode(q),g.setStencilMode(ze),g.setColorMode(Ft),g.setCullFace(Gn),$s){g.activeTexture.set(jh.TEXTURE2),jh.bindTexture(jh.TEXTURE_2D,$s.depthTexture),g.activeTexture.set(jh.TEXTURE3),jh.bindTexture(jh.TEXTURE_2D,$s.texture);for(const Vd in this.terrainUniforms)this.terrainUniforms[Vd].set($s[Vd])}for(const Vd in this.fixedUniforms)this.fixedUniforms[Vd].set(ls[Vd]);Ch&&Ch.setUniforms(g,this.binderUniforms,Lh,{zoom:Bh});let Sd=0;switch(A){case jh.LINES:Sd=2;break;case jh.TRIANGLES:Sd=3;break;case jh.LINE_STRIP:Sd=1}for(const Vd of ph.get()){const Wd=Vd.vaos||(Vd.vaos={});(Wd[ol]||(Wd[ol]=new _p)).bind(g,this,nh,Ch?Ch.getPaintVertexBuffers():[],ih,Vd.vertexOffset,Kh,fd,ud),jh.drawElements(A,Vd.primitiveLength*Sd,jh.UNSIGNED_SHORT,Vd.primitiveOffset*Sd*2)}}}function Zp(Y,g,A){const q=1/Fh(A,1,g.transform.tileZoom),ze=Math.pow(2,A.tileID.overscaledZ),Ft=A.tileSize*Math.pow(2,g.transform.tileZoom)/ze,Gn=Ft*(A.tileID.canonical.x+A.tileID.wrap*ze),ls=Ft*A.tileID.canonical.y;return{u_image:0,u_texsize:A.imageAtlasTexture.size,u_scale:[q,Y.fromScale,Y.toScale],u_fade:Y.t,u_pixel_coord_upper:[Gn>>16,ls>>16],u_pixel_coord_lower:[65535&Gn,65535&ls]}}const Rm=(Y,g,A,q)=>{const ze=g.style.light,Ft=ze.properties.get("position"),Gn=[Ft.x,Ft.y,Ft.z],ls=function(){var ol=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(ol[1]=0,ol[2]=0,ol[3]=0,ol[5]=0,ol[6]=0,ol[7]=0),ol[0]=1,ol[4]=1,ol[8]=1,ol}();ze.properties.get("anchor")==="viewport"&&function(ol,nh){var ih=Math.sin(nh),ph=Math.cos(nh);ol[0]=ph,ol[1]=ih,ol[2]=0,ol[3]=-ih,ol[4]=ph,ol[5]=0,ol[6]=0,ol[7]=0,ol[8]=1}(ls,-g.transform.angle),function(ol,nh,ih){var ph=nh[0],Lh=nh[1],Bh=nh[2];ol[0]=ph*ih[0]+Lh*ih[3]+Bh*ih[6],ol[1]=ph*ih[1]+Lh*ih[4]+Bh*ih[7],ol[2]=ph*ih[2]+Lh*ih[5]+Bh*ih[8]}(Gn,Gn,ls);const $s=ze.properties.get("color");return{u_matrix:Y,u_lightpos:Gn,u_lightintensity:ze.properties.get("intensity"),u_lightcolor:[$s.r,$s.g,$s.b],u_vertical_gradient:+A,u_opacity:q}},Yp=(Y,g,A,q,ze,Ft,Gn)=>o.extend(Rm(Y,g,A,q),Zp(Ft,g,Gn),{u_height_factor:-Math.pow(2,ze.overscaledZ)/Gn.tileSize/8}),Pm=Y=>({u_matrix:Y}),kf=(Y,g,A,q)=>o.extend(Pm(Y),Zp(A,g,q)),Sp=(Y,g)=>({u_matrix:Y,u_world:g}),Np=(Y,g,A,q,ze)=>o.extend(kf(Y,g,A,q),{u_world:ze}),Jm=(Y,g,A,q)=>{const ze=Y.transform;let Ft,Gn;if(q.paint.get("circle-pitch-alignment")==="map"){const ls=Fh(A,1,ze.zoom);Ft=!0,Gn=[ls,ls]}else Ft=!1,Gn=ze.pixelsToGLUnits;return{u_camera_to_center_distance:ze.cameraToCenterDistance,u_scale_with_map:+(q.paint.get("circle-pitch-scale")==="map"),u_matrix:Y.translatePosMatrix(g.posMatrix,A,q.paint.get("circle-translate"),q.paint.get("circle-translate-anchor")),u_pitch_with_map:+Ft,u_device_pixel_ratio:Y.pixelRatio,u_extrude_scale:Gn}},Um=(Y,g,A)=>{const q=Fh(A,1,g.zoom),ze=Math.pow(2,g.zoom-A.tileID.overscaledZ),Ft=A.tileID.overscaleFactor();return{u_matrix:Y,u_camera_to_center_distance:g.cameraToCenterDistance,u_pixels_to_tile_units:q,u_extrude_scale:[g.pixelsToGLUnits[0]/(q*ze),g.pixelsToGLUnits[1]/(q*ze)],u_overscale_factor:Ft}},bg=(Y,g,A=1)=>({u_matrix:Y,u_color:g,u_overlay:0,u_overlay_scale:A}),kg=Y=>({u_matrix:Y}),Bm=(Y,g,A,q)=>({u_matrix:Y,u_extrude_scale:Fh(g,1,A),u_intensity:q});function fy(Y,g){const A=Math.pow(2,g.canonical.z),q=g.canonical.y;return[new o.MercatorCoordinate(0,q/A).toLngLat().lat,new o.MercatorCoordinate(0,(q+1)/A).toLngLat().lat]}const Km=(Y,g,A,q)=>{const ze=Y.transform;return{u_matrix:u_(Y,g,A,q),u_ratio:1/Fh(g,1,ze.zoom),u_device_pixel_ratio:Y.pixelRatio,u_units_to_pixels:[1/ze.pixelsToGLUnits[0],1/ze.pixelsToGLUnits[1]]}},Xg=(Y,g,A,q,ze)=>o.extend(Km(Y,g,A,ze),{u_image:0,u_image_height:q}),Ly=(Y,g,A,q,ze)=>{const Ft=Y.transform,Gn=wg(g,Ft);return{u_matrix:u_(Y,g,A,ze),u_texsize:g.imageAtlasTexture.size,u_ratio:1/Fh(g,1,Ft.zoom),u_device_pixel_ratio:Y.pixelRatio,u_image:0,u_scale:[Gn,q.fromScale,q.toScale],u_fade:q.t,u_units_to_pixels:[1/Ft.pixelsToGLUnits[0],1/Ft.pixelsToGLUnits[1]]}},Ry=(Y,g,A,q,ze,Ft)=>{const Gn=Y.lineAtlas,ls=wg(g,Y.transform),$s=A.layout.get("line-cap")==="round",ol=Gn.getDash(q.from,$s),nh=Gn.getDash(q.to,$s),ih=ol.width*ze.fromScale,ph=nh.width*ze.toScale;return o.extend(Km(Y,g,A,Ft),{u_patternscale_a:[ls/ih,-ol.height/2],u_patternscale_b:[ls/ph,-nh.height/2],u_sdfgamma:Gn.width/(256*Math.min(ih,ph)*Y.pixelRatio)/2,u_image:0,u_tex_y_a:ol.y,u_tex_y_b:nh.y,u_mix:ze.t})};function wg(Y,g){return 1/Fh(Y,1,g.tileZoom)}function u_(Y,g,A,q){return Y.translatePosMatrix(q?q.posMatrix:g.tileID.posMatrix,g,A.paint.get("line-translate"),A.paint.get("line-translate-anchor"))}const Oy=(Y,g,A,q,ze)=>{return{u_matrix:Y,u_tl_parent:g,u_scale_parent:A,u_buffer_scale:1,u_fade_t:q.mix,u_opacity:q.opacity*ze.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ze.paint.get("raster-brightness-min"),u_brightness_high:ze.paint.get("raster-brightness-max"),u_saturation_factor:(Gn=ze.paint.get("raster-saturation"),Gn>0?1-1/(1.001-Gn):-Gn),u_contrast_factor:(Ft=ze.paint.get("raster-contrast"),Ft>0?1/(1-Ft):1+Ft),u_spin_weights:V_(ze.paint.get("raster-hue-rotate"))};var Ft,Gn};function V_(Y){Y*=Math.PI/180;const g=Math.sin(Y),A=Math.cos(Y);return[(2*A+1)/3,(-Math.sqrt(3)*g-A+1)/3,(Math.sqrt(3)*g-A+1)/3]}const r0=(Y,g,A,q,ze,Ft,Gn,ls,$s,ol)=>{const nh=ze.transform;return{u_is_size_zoom_constant:+(Y==="constant"||Y==="source"),u_is_size_feature_constant:+(Y==="constant"||Y==="camera"),u_size_t:g?g.uSizeT:0,u_size:g?g.uSize:0,u_camera_to_center_distance:nh.cameraToCenterDistance,u_pitch:nh.pitch/360*2*Math.PI,u_rotate_symbol:+A,u_aspect_ratio:nh.width/nh.height,u_fade_change:ze.options.fadeDuration?ze.symbolFadeChange:1,u_matrix:Ft,u_label_plane_matrix:Gn,u_coord_matrix:ls,u_is_text:+$s,u_pitch_with_map:+q,u_texsize:ol,u_texture:0}},O0=(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh)=>{const ih=ze.transform;return o.extend(r0(Y,g,A,q,ze,Ft,Gn,ls,$s,ol),{u_gamma_scale:q?Math.cos(ih._pitch)*ih.cameraToCenterDistance:1,u_device_pixel_ratio:ze.pixelRatio,u_is_halo:+nh})},l1=(Y,g,A,q,ze,Ft,Gn,ls,$s,ol)=>o.extend(O0(Y,g,A,q,ze,Ft,Gn,ls,!0,$s,!0),{u_texsize_icon:ol,u_texture_icon:1}),tv=(Y,g,A)=>({u_matrix:Y,u_opacity:g,u_color:A}),oy=(Y,g,A,q,ze,Ft)=>o.extend(function(Gn,ls,$s,ol){const nh=$s.imageManager.getPattern(Gn.from.toString()),ih=$s.imageManager.getPattern(Gn.to.toString()),{width:ph,height:Lh}=$s.imageManager.getPixelSize(),Bh=Math.pow(2,ol.tileID.overscaledZ),Ch=ol.tileSize*Math.pow(2,$s.transform.tileZoom)/Bh,Kh=Ch*(ol.tileID.canonical.x+ol.tileID.wrap*Bh),fd=Ch*ol.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:nh.tl,u_pattern_br_a:nh.br,u_pattern_tl_b:ih.tl,u_pattern_br_b:ih.br,u_texsize:[ph,Lh],u_mix:ls.t,u_pattern_size_a:nh.displaySize,u_pattern_size_b:ih.displaySize,u_scale_a:ls.fromScale,u_scale_b:ls.toScale,u_tile_units_to_pixels:1/Fh(ol,1,$s.transform.tileZoom),u_pixel_coord_upper:[Kh>>16,fd>>16],u_pixel_coord_lower:[65535&Kh,65535&fd]}}(q,Ft,A,ze),{u_matrix:Y,u_opacity:g}),o0={fillExtrusion:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_lightpos:new o.Uniform3f(Y,g.u_lightpos),u_lightintensity:new o.Uniform1f(Y,g.u_lightintensity),u_lightcolor:new o.Uniform3f(Y,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(Y,g.u_vertical_gradient),u_opacity:new o.Uniform1f(Y,g.u_opacity)}),fillExtrusionPattern:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_lightpos:new o.Uniform3f(Y,g.u_lightpos),u_lightintensity:new o.Uniform1f(Y,g.u_lightintensity),u_lightcolor:new o.Uniform3f(Y,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(Y,g.u_vertical_gradient),u_height_factor:new o.Uniform1f(Y,g.u_height_factor),u_image:new o.Uniform1i(Y,g.u_image),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(Y,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(Y,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(Y,g.u_scale),u_fade:new o.Uniform1f(Y,g.u_fade),u_opacity:new o.Uniform1f(Y,g.u_opacity)}),fill:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix)}),fillPattern:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_image:new o.Uniform1i(Y,g.u_image),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(Y,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(Y,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(Y,g.u_scale),u_fade:new o.Uniform1f(Y,g.u_fade)}),fillOutline:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_world:new o.Uniform2f(Y,g.u_world)}),fillOutlinePattern:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_world:new o.Uniform2f(Y,g.u_world),u_image:new o.Uniform1i(Y,g.u_image),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(Y,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(Y,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(Y,g.u_scale),u_fade:new o.Uniform1f(Y,g.u_fade)}),circle:(Y,g)=>({u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(Y,g.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(Y,g.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(Y,g.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix)}),collisionBox:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(Y,g.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(Y,g.u_extrude_scale),u_overscale_factor:new o.Uniform1f(Y,g.u_overscale_factor)}),collisionCircle:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_inv_matrix:new o.UniformMatrix4f(Y,g.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(Y,g.u_viewport_size)}),debug:(Y,g)=>({u_color:new o.UniformColor(Y,g.u_color),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_overlay:new o.Uniform1i(Y,g.u_overlay),u_overlay_scale:new o.Uniform1f(Y,g.u_overlay_scale)}),clippingMask:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix)}),heatmap:(Y,g)=>({u_extrude_scale:new o.Uniform1f(Y,g.u_extrude_scale),u_intensity:new o.Uniform1f(Y,g.u_intensity),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix)}),heatmapTexture:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_world:new o.Uniform2f(Y,g.u_world),u_image:new o.Uniform1i(Y,g.u_image),u_color_ramp:new o.Uniform1i(Y,g.u_color_ramp),u_opacity:new o.Uniform1f(Y,g.u_opacity)}),hillshade:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_image:new o.Uniform1i(Y,g.u_image),u_latrange:new o.Uniform2f(Y,g.u_latrange),u_light:new o.Uniform2f(Y,g.u_light),u_shadow:new o.UniformColor(Y,g.u_shadow),u_highlight:new o.UniformColor(Y,g.u_highlight),u_accent:new o.UniformColor(Y,g.u_accent)}),hillshadePrepare:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_image:new o.Uniform1i(Y,g.u_image),u_dimension:new o.Uniform2f(Y,g.u_dimension),u_zoom:new o.Uniform1f(Y,g.u_zoom),u_unpack:new o.Uniform4f(Y,g.u_unpack)}),line:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_ratio:new o.Uniform1f(Y,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(Y,g.u_units_to_pixels)}),lineGradient:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_ratio:new o.Uniform1f(Y,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(Y,g.u_units_to_pixels),u_image:new o.Uniform1i(Y,g.u_image),u_image_height:new o.Uniform1f(Y,g.u_image_height)}),linePattern:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_ratio:new o.Uniform1f(Y,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_image:new o.Uniform1i(Y,g.u_image),u_units_to_pixels:new o.Uniform2f(Y,g.u_units_to_pixels),u_scale:new o.Uniform3f(Y,g.u_scale),u_fade:new o.Uniform1f(Y,g.u_fade)}),lineSDF:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_ratio:new o.Uniform1f(Y,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(Y,g.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(Y,g.u_patternscale_a),u_patternscale_b:new o.Uniform2f(Y,g.u_patternscale_b),u_sdfgamma:new o.Uniform1f(Y,g.u_sdfgamma),u_image:new o.Uniform1i(Y,g.u_image),u_tex_y_a:new o.Uniform1f(Y,g.u_tex_y_a),u_tex_y_b:new o.Uniform1f(Y,g.u_tex_y_b),u_mix:new o.Uniform1f(Y,g.u_mix)}),raster:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_tl_parent:new o.Uniform2f(Y,g.u_tl_parent),u_scale_parent:new o.Uniform1f(Y,g.u_scale_parent),u_buffer_scale:new o.Uniform1f(Y,g.u_buffer_scale),u_fade_t:new o.Uniform1f(Y,g.u_fade_t),u_opacity:new o.Uniform1f(Y,g.u_opacity),u_image0:new o.Uniform1i(Y,g.u_image0),u_image1:new o.Uniform1i(Y,g.u_image1),u_brightness_low:new o.Uniform1f(Y,g.u_brightness_low),u_brightness_high:new o.Uniform1f(Y,g.u_brightness_high),u_saturation_factor:new o.Uniform1f(Y,g.u_saturation_factor),u_contrast_factor:new o.Uniform1f(Y,g.u_contrast_factor),u_spin_weights:new o.Uniform3f(Y,g.u_spin_weights)}),symbolIcon:(Y,g)=>({u_is_size_zoom_constant:new o.Uniform1i(Y,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(Y,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(Y,g.u_size_t),u_size:new o.Uniform1f(Y,g.u_size),u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(Y,g.u_pitch),u_rotate_symbol:new o.Uniform1i(Y,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(Y,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(Y,g.u_fade_change),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(Y,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(Y,g.u_coord_matrix),u_is_text:new o.Uniform1i(Y,g.u_is_text),u_pitch_with_map:new o.Uniform1i(Y,g.u_pitch_with_map),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_texture:new o.Uniform1i(Y,g.u_texture)}),symbolSDF:(Y,g)=>({u_is_size_zoom_constant:new o.Uniform1i(Y,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(Y,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(Y,g.u_size_t),u_size:new o.Uniform1f(Y,g.u_size),u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(Y,g.u_pitch),u_rotate_symbol:new o.Uniform1i(Y,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(Y,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(Y,g.u_fade_change),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(Y,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(Y,g.u_coord_matrix),u_is_text:new o.Uniform1i(Y,g.u_is_text),u_pitch_with_map:new o.Uniform1i(Y,g.u_pitch_with_map),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_texture:new o.Uniform1i(Y,g.u_texture),u_gamma_scale:new o.Uniform1f(Y,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(Y,g.u_is_halo)}),symbolTextAndIcon:(Y,g)=>({u_is_size_zoom_constant:new o.Uniform1i(Y,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(Y,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(Y,g.u_size_t),u_size:new o.Uniform1f(Y,g.u_size),u_camera_to_center_distance:new o.Uniform1f(Y,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(Y,g.u_pitch),u_rotate_symbol:new o.Uniform1i(Y,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(Y,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(Y,g.u_fade_change),u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(Y,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(Y,g.u_coord_matrix),u_is_text:new o.Uniform1i(Y,g.u_is_text),u_pitch_with_map:new o.Uniform1i(Y,g.u_pitch_with_map),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_texsize_icon:new o.Uniform2f(Y,g.u_texsize_icon),u_texture:new o.Uniform1i(Y,g.u_texture),u_texture_icon:new o.Uniform1i(Y,g.u_texture_icon),u_gamma_scale:new o.Uniform1f(Y,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(Y,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(Y,g.u_is_halo)}),background:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_opacity:new o.Uniform1f(Y,g.u_opacity),u_color:new o.UniformColor(Y,g.u_color)}),backgroundPattern:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_opacity:new o.Uniform1f(Y,g.u_opacity),u_image:new o.Uniform1i(Y,g.u_image),u_pattern_tl_a:new o.Uniform2f(Y,g.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(Y,g.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(Y,g.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(Y,g.u_pattern_br_b),u_texsize:new o.Uniform2f(Y,g.u_texsize),u_mix:new o.Uniform1f(Y,g.u_mix),u_pattern_size_a:new o.Uniform2f(Y,g.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(Y,g.u_pattern_size_b),u_scale_a:new o.Uniform1f(Y,g.u_scale_a),u_scale_b:new o.Uniform1f(Y,g.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(Y,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(Y,g.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(Y,g.u_tile_units_to_pixels)}),terrain:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_texture:new o.Uniform1i(Y,g.u_texture),u_ele_delta:new o.Uniform1f(Y,g.u_ele_delta)}),terrainDepth:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_ele_delta:new o.Uniform1f(Y,g.u_ele_delta)}),terrainCoords:(Y,g)=>({u_matrix:new o.UniformMatrix4f(Y,g.u_matrix),u_texture:new o.Uniform1i(Y,g.u_texture),u_terrain_coords_id:new o.Uniform1f(Y,g.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(Y,g.u_ele_delta)})};class By{constructor(g,A,q){this.context=g;const ze=g.gl;this.buffer=ze.createBuffer(),this.dynamicDraw=!!q,this.context.unbindVAO(),g.bindElementBuffer.set(this.buffer),ze.bufferData(ze.ELEMENT_ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?ze.DYNAMIC_DRAW:ze.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(g){const A=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),A.bufferSubData(A.ELEMENT_ARRAY_BUFFER,0,g.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const py={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vg{constructor(g,A,q,ze){this.length=A.length,this.attributes=q,this.itemSize=A.bytesPerElement,this.dynamicDraw=ze,this.context=g;const Ft=g.gl;this.buffer=Ft.createBuffer(),g.bindVertexBuffer.set(this.buffer),Ft.bufferData(Ft.ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?Ft.DYNAMIC_DRAW:Ft.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(g){if(g.length!==this.length)throw new Error(`Length of new data is ${g.length}, which doesn't match current length of ${this.length}`);const A=this.context.gl;this.bind(),A.bufferSubData(A.ARRAY_BUFFER,0,g.arrayBuffer)}enableAttributes(g,A){for(let q=0;q<this.attributes.length;q++){const ze=A.attributes[this.attributes[q].name];ze!==void 0&&g.enableVertexAttribArray(ze)}}setVertexAttribPointers(g,A,q){for(let ze=0;ze<this.attributes.length;ze++){const Ft=this.attributes[ze],Gn=A.attributes[Ft.name];Gn!==void 0&&g.vertexAttribPointer(Gn,Ft.components,g[py[Ft.type]],!1,this.itemSize,Ft.offset+this.itemSize*(q||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fm{constructor(g){this.gl=g.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(g){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class G_ extends fm{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class eg extends fm{getDefault(){return 1}set(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)}}class h_ extends fm{getDefault(){return 0}set(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)}}class iv extends fm{getDefault(){return[!0,!0,!0,!0]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class zy extends fm{getDefault(){return!0}set(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)}}class j_ extends fm{getDefault(){return 255}set(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)}}class s0 extends fm{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(g){const A=this.current;(g.func!==A.func||g.ref!==A.ref||g.mask!==A.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)}}class a0 extends fm{getDefault(){const g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)}}class wm extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this.current=g,this.dirty=!1}}class sy extends fm{getDefault(){return[0,1]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)}}class my extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST),this.current=g,this.dirty=!1}}class l0 extends fm{getDefault(){return this.gl.LESS}set(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)}}class gy extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.BLEND):A.disable(A.BLEND),this.current=g,this.dirty=!1}}class vv extends fm{getDefault(){const g=this.gl;return[g.ONE,g.ZERO]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)}}class ay extends fm{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class cm extends fm{getDefault(){return this.gl.FUNC_ADD}set(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)}}class Ny extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),this.current=g,this.dirty=!1}}class Fy extends fm{getDefault(){return this.gl.BACK}set(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)}}class q_ extends fm{getDefault(){return this.gl.CCW}set(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)}}class d_ extends fm{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}}class c0 extends fm{getDefault(){return this.gl.TEXTURE0}set(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)}}class u0 extends fm{getDefault(){const g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class nv extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindFramebuffer(A.FRAMEBUFFER,g),this.current=g,this.dirty=!1}}class $y extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindRenderbuffer(A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class h0 extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindTexture(A.TEXTURE_2D,g),this.current=g,this.dirty=!1}}class Eg extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindBuffer(A.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class Z_ extends fm{getDefault(){return null}set(g){const A=this.gl;A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class f_ extends fm{constructor(g){super(g),this.vao=g.extVertexArrayObject}getDefault(){return null}set(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)}}class p_ extends fm{getDefault(){return 4}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}}class Kp extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}}class M_ extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}}class m_ extends fm{constructor(g,A){super(g),this.context=g,this.parent=A}getDefault(){return null}}class Nv extends m_{setDirty(){this.dirty=!0}set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}}class _y extends m_{set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class Uy{constructor(g,A,q,ze){this.context=g,this.width=A,this.height=q;const Ft=g.gl,Gn=this.framebuffer=Ft.createFramebuffer();if(this.colorAttachment=new Nv(g,Gn),ze&&(this.depthAttachment=new _y(g,Gn)),Ft.checkFramebufferStatus(Ft.FRAMEBUFFER)!==Ft.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const g=this.context.gl,A=this.colorAttachment.get();if(A&&g.deleteTexture(A),this.depthAttachment){const q=this.depthAttachment.get();q&&g.deleteRenderbuffer(q)}g.deleteFramebuffer(this.framebuffer)}}class Xm{constructor(g,A,q){this.blendFunction=g,this.blendColor=A,this.mask=q}}Xm.Replace=[1,0],Xm.disabled=new Xm(Xm.Replace,o.Color.transparent,[!1,!1,!1,!1]),Xm.unblended=new Xm(Xm.Replace,o.Color.transparent,[!0,!0,!0,!0]),Xm.alphaBlended=new Xm([1,771],o.Color.transparent,[!0,!0,!0,!0]);class d0{constructor(g){this.gl=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G_(this),this.clearDepth=new eg(this),this.clearStencil=new h_(this),this.colorMask=new iv(this),this.depthMask=new zy(this),this.stencilMask=new j_(this),this.stencilFunc=new s0(this),this.stencilOp=new a0(this),this.stencilTest=new wm(this),this.depthRange=new sy(this),this.depthTest=new my(this),this.depthFunc=new l0(this),this.blend=new gy(this),this.blendFunc=new vv(this),this.blendColor=new ay(this),this.blendEquation=new cm(this),this.cullFace=new Ny(this),this.cullFaceSide=new Fy(this),this.frontFace=new q_(this),this.program=new d_(this),this.activeTexture=new c0(this),this.viewport=new u0(this),this.bindFramebuffer=new nv(this),this.bindRenderbuffer=new $y(this),this.bindTexture=new h0(this),this.bindVertexBuffer=new Eg(this),this.bindElementBuffer=new Z_(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new f_(this),this.pixelStoreUnpack=new p_(this),this.pixelStoreUnpackPremultiplyAlpha=new Kp(this),this.pixelStoreUnpackFlipY=new M_(this),this.extTextureFilterAnisotropic=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=g.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=g.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(g.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=g.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=g.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(g,A){return new By(this,g,A)}createVertexBuffer(g,A,q){return new Vg(this,g,A,q)}createRenderbuffer(g,A,q){const ze=this.gl,Ft=ze.createRenderbuffer();return this.bindRenderbuffer.set(Ft),ze.renderbufferStorage(ze.RENDERBUFFER,g,A,q),this.bindRenderbuffer.set(null),Ft}createFramebuffer(g,A,q){return new Uy(this,g,A,q)}clear({color:g,depth:A}){const q=this.gl;let ze=0;g&&(ze|=q.COLOR_BUFFER_BIT,this.clearColor.set(g),this.colorMask.set([!0,!0,!0,!0])),A!==void 0&&(ze|=q.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(A),this.depthMask.set(!0)),q.clear(ze)}setCullFace(g){g.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(g.mode),this.frontFace.set(g.frontFace))}setDepthMode(g){g.func!==this.gl.ALWAYS||g.mask?(this.depthTest.set(!0),this.depthFunc.set(g.func),this.depthMask.set(g.mask),this.depthRange.set(g.range)):this.depthTest.set(!1)}setStencilMode(g){g.test.func!==this.gl.ALWAYS||g.mask?(this.stencilTest.set(!0),this.stencilMask.set(g.mask),this.stencilOp.set([g.fail,g.depthFail,g.pass]),this.stencilFunc.set({func:g.test.func,ref:g.ref,mask:g.test.mask})):this.stencilTest.set(!1)}setColorMode(g){nt(g.blendFunction,Xm.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(g.blendFunction),this.blendColor.set(g.blendColor)),this.colorMask.set(g.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class um{constructor(g,A,q){this.func=g,this.mask=A,this.range=q}}um.ReadOnly=!1,um.ReadWrite=!0,um.disabled=new um(519,um.ReadOnly,[0,1]);const Vy=7680;class zm{constructor(g,A,q,ze,Ft,Gn){this.test=g,this.ref=A,this.mask=q,this.fail=ze,this.depthFail=Ft,this.pass=Gn}}zm.disabled=new zm({func:519,mask:0},0,0,Vy,Vy,Vy);class Im{constructor(g,A,q){this.enable=g,this.mode=A,this.frontFace=q}}let g_;function ly(Y,g,A,q,ze,Ft,Gn){const ls=Y.context,$s=ls.gl,ol=Y.useProgram("collisionBox"),nh=[];let ih=0,ph=0;for(let jh=0;jh<q.length;jh++){const Sd=q[jh],Vd=g.getTile(Sd),Wd=Vd.getBucket(A);if(!Wd)continue;let Cf=Sd.posMatrix;ze[0]===0&&ze[1]===0||(Cf=Y.translatePosMatrix(Sd.posMatrix,Vd,ze,Ft));const Of=Gn?Wd.textCollisionBox:Wd.iconCollisionBox,L=Wd.collisionCircleArray;if(L.length>0){const u=o.create(),E=Cf;o.mul(u,Wd.placementInvProjMatrix,Y.transform.glCoordMatrix),o.mul(u,u,Wd.placementViewportMatrix),nh.push({circleArray:L,circleOffset:ph,transform:E,invTransform:u,coord:Sd}),ih+=L.length/4,ph=ih}Of&&ol.draw(ls,$s.LINES,um.disabled,zm.disabled,Y.colorModeForRenderPass(),Im.disabled,Um(Cf,Y.transform,Vd),Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(Sd),A.id,Of.layoutVertexBuffer,Of.indexBuffer,Of.segments,null,Y.transform.zoom,null,null,Of.collisionVertexBuffer)}if(!Gn||!nh.length)return;const Lh=Y.useProgram("collisionCircle"),Bh=new o.CollisionCircleLayoutArray;Bh.resize(4*ih),Bh._trim();let Ch=0;for(const jh of nh)for(let Sd=0;Sd<jh.circleArray.length/4;Sd++){const Vd=4*Sd,Wd=jh.circleArray[Vd+0],Cf=jh.circleArray[Vd+1],Of=jh.circleArray[Vd+2],L=jh.circleArray[Vd+3];Bh.emplace(Ch++,Wd,Cf,Of,L,0),Bh.emplace(Ch++,Wd,Cf,Of,L,1),Bh.emplace(Ch++,Wd,Cf,Of,L,2),Bh.emplace(Ch++,Wd,Cf,Of,L,3)}(!g_||g_.length<2*ih)&&(g_=function(jh){const Sd=2*jh,Vd=new o.QuadTriangleArray;Vd.resize(Sd),Vd._trim();for(let Wd=0;Wd<Sd;Wd++){const Cf=6*Wd;Vd.uint16[Cf+0]=4*Wd+0,Vd.uint16[Cf+1]=4*Wd+1,Vd.uint16[Cf+2]=4*Wd+2,Vd.uint16[Cf+3]=4*Wd+2,Vd.uint16[Cf+4]=4*Wd+3,Vd.uint16[Cf+5]=4*Wd+0}return Vd}(ih));const Kh=ls.createIndexBuffer(g_,!0),fd=ls.createVertexBuffer(Bh,o.collisionCircleLayout.members,!0);for(const jh of nh){const Sd={u_matrix:jh.transform,u_inv_matrix:jh.invTransform,u_camera_to_center_distance:(ud=Y.transform).cameraToCenterDistance,u_viewport_size:[ud.width,ud.height]};Lh.draw(ls,$s.TRIANGLES,um.disabled,zm.disabled,Y.colorModeForRenderPass(),Im.disabled,Sd,Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(jh.coord),A.id,fd,Kh,o.SegmentVector.simpleSegment(0,2*jh.circleOffset,jh.circleArray.length,jh.circleArray.length/2),null,Y.transform.zoom,null,null,null)}var ud;fd.destroy(),Kh.destroy()}Im.disabled=new Im(!1,1029,2305),Im.backCCW=new Im(!0,1029,2305);const xv=o.identity(new Float32Array(16));function cy(Y,g,A,q,ze,Ft){const{horizontalAlign:Gn,verticalAlign:ls}=o.getAnchorAlignment(Y),$s=-(Gn-.5)*g,ol=-(ls-.5)*A,nh=o.evaluateVariableOffset(Y,q);return new o.pointGeometry(($s/ze+nh[0])*Ft,(ol/ze+nh[1])*Ft)}function f0(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh){const ih=Y.text.placedSymbolArray,ph=Y.text.dynamicLayoutVertexArray,Lh=Y.icon.dynamicLayoutVertexArray,Bh={};ph.clear();for(let Ch=0;Ch<ih.length;Ch++){const Kh=ih.get(Ch),fd=Kh.hidden||!Kh.crossTileID||Y.allowVerticalPlacement&&!Kh.placedOrientation?null:q[Kh.crossTileID];if(fd){const ud=new o.pointGeometry(Kh.anchorX,Kh.anchorY),jh=mh(ud,A?Gn:Ft,nh),Sd=Jh(ze.cameraToCenterDistance,jh.signedDistanceFromCamera);let Vd=o.evaluateSizeForFeature(Y.textSizeData,$s,Kh)*Sd/o.ONE_EM;A&&(Vd*=Y.tilePixelRatio/ls);const{width:Wd,height:Cf,anchor:Of,textOffset:L,textBoxScale:u}=fd,E=cy(Of,Wd,Cf,L,u,Vd),B=A?mh(ud.add(E),Ft,nh).point:jh.point.add(g?E.rotate(-ze.angle):E),ge=Y.allowVerticalPlacement&&Kh.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<Kh.numGlyphs;St++)o.addDynamicAttributes(ph,B,ge);ol&&Kh.associatedIconIndex>=0&&(Bh[Kh.associatedIconIndex]={shiftedAnchor:B,angle:ge})}else uh(Kh.numGlyphs,ph)}if(ol){Lh.clear();const Ch=Y.icon.placedSymbolArray;for(let Kh=0;Kh<Ch.length;Kh++){const fd=Ch.get(Kh);if(fd.hidden)uh(fd.numGlyphs,Lh);else{const ud=Bh[Kh];if(ud)for(let jh=0;jh<fd.numGlyphs;jh++)o.addDynamicAttributes(Lh,ud.shiftedAnchor,ud.angle);else uh(fd.numGlyphs,Lh)}}Y.icon.dynamicLayoutVertexBuffer.updateData(Lh)}Y.text.dynamicLayoutVertexBuffer.updateData(ph)}function __(Y,g,A){return A.iconsInText&&g?"symbolTextAndIcon":Y?"symbolSDF":"symbolIcon"}function H_(Y,g,A,q,ze,Ft,Gn,ls,$s,ol,nh,ih){const ph=Y.context,Lh=ph.gl,Bh=Y.transform,Ch=ls==="map",Kh=$s==="map",fd=ls!=="viewport"&&A.layout.get("symbol-placement")!=="point",ud=Ch&&!Kh&&!fd,jh=!A.layout.get("symbol-sort-key").isConstant();let Sd=!1;const Vd=Y.depthModeForSublayer(0,um.ReadOnly),Wd=A.layout.get("text-variable-anchor"),Cf=[];for(const Of of q){const L=g.getTile(Of),u=L.getBucket(A);if(!u)continue;const E=ze?u.text:u.icon;if(!E||!E.segments.get().length||!E.hasVisibleVertices)continue;const B=E.programConfigurations.get(A.id),ge=ze||u.sdfIcons,St=ze?u.textSizeData:u.iconSizeData,_n=Kh||Bh.pitch!==0,Bn=Y.useProgram(__(ge,ze,u),B),ss=o.evaluateSizeForZoom(St,Bh.zoom),tl=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(Of);let il,Qu,fh,wh,Th=[0,0],Sh=null;if(ze)Qu=L.glyphAtlasTexture,fh=Lh.LINEAR,il=L.glyphAtlasTexture.size,u.iconsInText&&(Th=L.imageAtlasTexture.size,Sh=L.imageAtlasTexture,wh=_n||Y.options.rotating||Y.options.zooming||St.kind==="composite"||St.kind==="camera"?Lh.LINEAR:Lh.NEAREST);else{const Vf=A.layout.get("icon-size").constantOr(0)!==1||u.iconsNeedLinear;Qu=L.imageAtlasTexture,fh=ge||Y.options.rotating||Y.options.zooming||Vf||_n?Lh.LINEAR:Lh.NEAREST,il=L.imageAtlasTexture.size}const Ih=Fh(L,1,Y.transform.zoom),hh=Dd(Of.posMatrix,Kh,Ch,Y.transform,Ih),Oh=Hf(Of.posMatrix,Kh,Ch,Y.transform,Ih),Rh=Wd&&u.hasTextData(),Nh=A.layout.get("icon-text-fit")!=="none"&&Rh&&u.hasIconData();if(fd){const Vf=Y.style.map.terrain?(Mf,Ud)=>Y.style.map.terrain.getElevation(Of,Mf,Ud):null,_d=A.layout.get("text-rotation-alignment")==="map";al(u,Of.posMatrix,Y,ze,hh,Oh,Kh,ol,_d,Vf)}const qh=Y.translatePosMatrix(Of.posMatrix,L,Ft,Gn),$h=fd||ze&&Wd||Nh?xv:hh,Hh=Y.translatePosMatrix(Oh,L,Ft,Gn,!0),ld=ge&&A.paint.get(ze?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xd;xd=ge?u.iconsInText?l1(St.kind,ss,ud,Kh,Y,qh,$h,Hh,il,Th):O0(St.kind,ss,ud,Kh,Y,qh,$h,Hh,ze,il,!0):r0(St.kind,ss,ud,Kh,Y,qh,$h,Hh,ze,il);const gd={program:Bn,buffers:E,uniformValues:xd,atlasTexture:Qu,atlasTextureIcon:Sh,atlasInterpolation:fh,atlasInterpolationIcon:wh,isSDF:ge,hasHalo:ld};if(jh&&u.canOverlap){Sd=!0;const Vf=E.segments.get();for(const _d of Vf)Cf.push({segments:new o.SegmentVector([_d]),sortKey:_d.sortKey,state:gd,terrainData:tl})}else Cf.push({segments:E.segments,sortKey:0,state:gd,terrainData:tl})}Sd&&Cf.sort((Of,L)=>Of.sortKey-L.sortKey);for(const Of of Cf){const L=Of.state;if(ph.activeTexture.set(Lh.TEXTURE0),L.atlasTexture.bind(L.atlasInterpolation,Lh.CLAMP_TO_EDGE),L.atlasTextureIcon&&(ph.activeTexture.set(Lh.TEXTURE1),L.atlasTextureIcon&&L.atlasTextureIcon.bind(L.atlasInterpolationIcon,Lh.CLAMP_TO_EDGE)),L.isSDF){const u=L.uniformValues;L.hasHalo&&(u.u_is_halo=1,jy(L.buffers,Of.segments,A,Y,L.program,Vd,nh,ih,u,Of.terrainData)),u.u_is_halo=0}jy(L.buffers,Of.segments,A,Y,L.program,Vd,nh,ih,L.uniformValues,Of.terrainData)}}function jy(Y,g,A,q,ze,Ft,Gn,ls,$s,ol){const nh=q.context;ze.draw(nh,nh.gl.TRIANGLES,Ft,Gn,ls,Im.disabled,$s,ol,A.id,Y.layoutVertexBuffer,Y.indexBuffer,g,A.paint,q.transform.zoom,Y.programConfigurations.get(A.id),Y.dynamicLayoutVertexBuffer,Y.opacityVertexBuffer)}function yy(Y,g,A,q,ze){if(!A||!q||!q.imageAtlas)return;const Ft=q.imageAtlas.patternPositions;let Gn=Ft[A.to.toString()],ls=Ft[A.from.toString()];if(!Gn||!ls){const $s=ze.getPaintProperty(g);Gn=Ft[$s],ls=Ft[$s]}Gn&&ls&&Y.setConstantPatternPositions(Gn,ls)}function Qg(Y,g,A,q,ze,Ft,Gn){const ls=Y.context.gl,$s="fill-pattern",ol=A.paint.get($s),nh=ol&&ol.constantOr(1),ih=A.getCrossfadeParameters();let ph,Lh,Bh,Ch,Kh;Gn?(Lh=nh&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ph=ls.LINES):(Lh=nh?"fillPattern":"fill",ph=ls.TRIANGLES);const fd=ol.constantOr(null);for(const ud of q){const jh=g.getTile(ud);if(nh&&!jh.patternsLoaded())continue;const Sd=jh.getBucket(A);if(!Sd)continue;const Vd=Sd.programConfigurations.get(A.id),Wd=Y.useProgram(Lh,Vd),Cf=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(ud);nh&&(Y.context.activeTexture.set(ls.TEXTURE0),jh.imageAtlasTexture.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),Vd.updatePaintBuffers(ih)),yy(Vd,$s,fd,jh,A);const Of=Cf?ud:null,L=Y.translatePosMatrix(Of?Of.posMatrix:ud.posMatrix,jh,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));if(Gn){Ch=Sd.indexBuffer2,Kh=Sd.segments2;const u=[ls.drawingBufferWidth,ls.drawingBufferHeight];Bh=Lh==="fillOutlinePattern"&&nh?Np(L,Y,ih,jh,u):Sp(L,u)}else Ch=Sd.indexBuffer,Kh=Sd.segments,Bh=nh?kf(L,Y,ih,jh):Pm(L);Wd.draw(Y.context,ph,ze,Y.stencilModeForClipping(ud),Ft,Im.disabled,Bh,Cf,A.id,Sd.layoutVertexBuffer,Ch,Kh,A.paint,Y.transform.zoom,Vd)}}function qy(Y,g,A,q,ze,Ft,Gn){const ls=Y.context,$s=ls.gl,ol="fill-extrusion-pattern",nh=A.paint.get(ol),ih=nh.constantOr(1),ph=A.getCrossfadeParameters(),Lh=A.paint.get("fill-extrusion-opacity"),Bh=nh.constantOr(null);for(const Ch of q){const Kh=g.getTile(Ch),fd=Kh.getBucket(A);if(!fd)continue;const ud=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(Ch),jh=fd.programConfigurations.get(A.id),Sd=Y.useProgram(ih?"fillExtrusionPattern":"fillExtrusion",jh);ih&&(Y.context.activeTexture.set($s.TEXTURE0),Kh.imageAtlasTexture.bind($s.LINEAR,$s.CLAMP_TO_EDGE),jh.updatePaintBuffers(ph)),yy(jh,ol,Bh,Kh,A);const Vd=Y.translatePosMatrix(Ch.posMatrix,Kh,A.paint.get("fill-extrusion-translate"),A.paint.get("fill-extrusion-translate-anchor")),Wd=A.paint.get("fill-extrusion-vertical-gradient"),Cf=ih?Yp(Vd,Y,Wd,Lh,Ch,ph,Kh):Rm(Vd,Y,Wd,Lh);Sd.draw(ls,ls.gl.TRIANGLES,ze,Ft,Gn,Im.backCCW,Cf,ud,A.id,fd.layoutVertexBuffer,fd.indexBuffer,fd.segments,A.paint,Y.transform.zoom,jh,Y.style.map.terrain&&fd.centroidVertexBuffer)}}function rv(Y,g,A,q,ze,Ft,Gn){const ls=Y.context,$s=ls.gl,ol=A.fbo;if(!ol)return;const nh=Y.useProgram("hillshade"),ih=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(g);ls.activeTexture.set($s.TEXTURE0),$s.bindTexture($s.TEXTURE_2D,ol.colorAttachment.get()),nh.draw(ls,$s.TRIANGLES,ze,Ft,Gn,Im.disabled,((ph,Lh,Bh,Ch)=>{const Kh=Bh.paint.get("hillshade-shadow-color"),fd=Bh.paint.get("hillshade-highlight-color"),ud=Bh.paint.get("hillshade-accent-color");let jh=Bh.paint.get("hillshade-illumination-direction")*(Math.PI/180);Bh.paint.get("hillshade-illumination-anchor")==="viewport"&&(jh-=ph.transform.angle);const Sd=!ph.options.moving;return{u_matrix:Ch?Ch.posMatrix:ph.transform.calculatePosMatrix(Lh.tileID.toUnwrapped(),Sd),u_image:0,u_latrange:fy(0,Lh.tileID),u_light:[Bh.paint.get("hillshade-exaggeration"),jh],u_shadow:Kh,u_highlight:fd,u_accent:ud}})(Y,A,q,ih?g:null),ih,q.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments)}function p0(Y,g,A,q,ze,Ft){const Gn=Y.context,ls=Gn.gl,$s=g.dem;if($s&&$s.data){const ol=$s.dim,nh=$s.stride,ih=$s.getPixels();if(Gn.activeTexture.set(ls.TEXTURE1),Gn.pixelStoreUnpackPremultiplyAlpha.set(!1),g.demTexture=g.demTexture||Y.getTileTexture(nh),g.demTexture){const Lh=g.demTexture;Lh.update(ih,{premultiply:!1}),Lh.bind(ls.NEAREST,ls.CLAMP_TO_EDGE)}else g.demTexture=new Dh(Gn,ih,ls.RGBA,{premultiply:!1}),g.demTexture.bind(ls.NEAREST,ls.CLAMP_TO_EDGE);Gn.activeTexture.set(ls.TEXTURE0);let ph=g.fbo;if(!ph){const Lh=new Dh(Gn,{width:ol,height:ol,data:null},ls.RGBA);Lh.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),ph=g.fbo=Gn.createFramebuffer(ol,ol,!0),ph.colorAttachment.set(Lh.texture)}Gn.bindFramebuffer.set(ph.framebuffer),Gn.viewport.set([0,0,ol,ol]),Y.useProgram("hillshadePrepare").draw(Gn,ls.TRIANGLES,q,ze,Ft,Im.disabled,((Lh,Bh)=>{const Ch=Bh.stride,Kh=o.create();return o.ortho(Kh,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Kh,Kh,[0,-o.EXTENT,0]),{u_matrix:Kh,u_image:1,u_dimension:[Ch,Ch],u_zoom:Lh.overscaledZ,u_unpack:Bh.getUnpackVector()}})(g.tileID,$s),null,A.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments),g.needsHillshadePrepare=!1}}function C_(Y,g,A,q,ze,Ft){const Gn=q.paint.get("raster-fade-duration");if(!Ft&&Gn>0){const ls=o.exported.now(),$s=(ls-Y.timeAdded)/Gn,ol=g?(ls-g.timeAdded)/Gn:-1,nh=A.getSource(),ih=ze.coveringZoomLevel({tileSize:nh.tileSize,roundZoom:nh.roundZoom}),ph=!g||Math.abs(g.tileID.overscaledZ-ih)>Math.abs(Y.tileID.overscaledZ-ih),Lh=ph&&Y.refreshedUponExpiration?1:o.clamp(ph?$s:1-ol,0,1);return Y.refreshedUponExpiration&&$s>=1&&(Y.refreshedUponExpiration=!1),g?{opacity:1,mix:1-Lh}:{opacity:Lh,mix:0}}return{opacity:1,mix:0}}const m0=new o.Color(1,0,0,1),X_=new o.Color(0,1,0,1),hd=new o.Color(0,0,1,1),wf=new o.Color(1,0,1,1),ip=new o.Color(0,1,1,1);function Bp(Y,g,A,q){hm(Y,0,g+A/2,Y.transform.width,A,q)}function Nm(Y,g,A,q){hm(Y,g-A/2,0,A,Y.transform.height,q)}function hm(Y,g,A,q,ze,Ft){const Gn=Y.context,ls=Gn.gl;ls.enable(ls.SCISSOR_TEST),ls.scissor(g*Y.pixelRatio,A*Y.pixelRatio,q*Y.pixelRatio,ze*Y.pixelRatio),Gn.clear({color:Ft}),ls.disable(ls.SCISSOR_TEST)}function Qm(Y,g,A){const q=Y.context,ze=q.gl,Ft=A.posMatrix,Gn=Y.useProgram("debug"),ls=um.disabled,$s=zm.disabled,ol=Y.colorModeForRenderPass(),nh="$debug",ih=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(A);q.activeTexture.set(ze.TEXTURE0),Y.emptyTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE);const ph=g.getTileByID(A.key).latestRawTileData,Lh=Math.floor((ph&&ph.byteLength||0)/1024),Bh=g.getTile(A).tileSize,Ch=512/Math.min(Bh,512)*(A.overscaledZ/Y.transform.zoom)*.5;let Kh=A.canonical.toString();A.overscaledZ!==A.canonical.z&&(Kh+=` => ${A.overscaledZ}`),function(fd,ud){fd.initDebugOverlayCanvas();const jh=fd.debugOverlayCanvas,Sd=fd.context.gl,Vd=fd.debugOverlayCanvas.getContext("2d");Vd.clearRect(0,0,jh.width,jh.height),Vd.shadowColor="white",Vd.shadowBlur=2,Vd.lineWidth=1.5,Vd.strokeStyle="white",Vd.textBaseline="top",Vd.font="bold 36px Open Sans, sans-serif",Vd.fillText(ud,5,5),Vd.strokeText(ud,5,5),fd.debugOverlayTexture.update(jh),fd.debugOverlayTexture.bind(Sd.LINEAR,Sd.CLAMP_TO_EDGE)}(Y,`${Kh} ${Lh}kB`),Gn.draw(q,ze.TRIANGLES,ls,$s,Xm.alphaBlended,Im.disabled,bg(Ft,o.Color.transparent,Ch),null,nh,Y.debugBuffer,Y.quadTriangleIndexBuffer,Y.debugSegments),Gn.draw(q,ze.LINE_STRIP,ls,$s,ol,Im.disabled,bg(Ft,o.Color.red),ih,nh,Y.debugBuffer,Y.tileBorderIndexBuffer,Y.debugSegments)}function og(Y,g,A){const q=Y.context,ze=q.gl,Ft=Y.colorModeForRenderPass(),Gn=new um(ze.LEQUAL,um.ReadWrite,Y.depthRangeFor3D),ls=Y.useProgram("terrain"),$s=g.getTerrainMesh();q.bindFramebuffer.set(null),q.viewport.set([0,0,Y.width,Y.height]);for(const ol of A){const nh=Y.renderToTexture.getTexture(ol),ih=g.getTerrainData(ol.tileID);q.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,nh.texture);const ph={u_matrix:Y.transform.calculatePosMatrix(ol.tileID.toUnwrapped()),u_texture:0,u_ele_delta:g.getMeshFrameDelta(Y.transform.zoom)};ls.draw(q,ze.TRIANGLES,Gn,zm.disabled,Ft,Im.backCCW,ph,ih,"terrain",$s.vertexBuffer,$s.indexBuffer,$s.segments)}}const sg={symbol:function(Y,g,A,q,ze){if(Y.renderPass!=="translucent")return;const Ft=zm.disabled,Gn=Y.colorModeForRenderPass();A.layout.get("text-variable-anchor")&&function(ls,$s,ol,nh,ih,ph,Lh){const Bh=$s.transform,Ch=ih==="map",Kh=ph==="map";for(const fd of ls){const ud=nh.getTile(fd),jh=ud.getBucket(ol);if(!jh||!jh.text||!jh.text.segments.get().length)continue;const Sd=o.evaluateSizeForZoom(jh.textSizeData,Bh.zoom),Vd=Fh(ud,1,$s.transform.zoom),Wd=Dd(fd.posMatrix,Kh,Ch,$s.transform,Vd),Cf=ol.layout.get("icon-text-fit")!=="none"&&jh.hasIconData();if(Sd){const Of=Math.pow(2,Bh.zoom-ud.tileID.overscaledZ);f0(jh,Ch,Kh,Lh,Bh,Wd,fd.posMatrix,Of,Sd,Cf,$s.style.map.terrain?(L,u)=>$s.style.map.terrain.getElevation(fd,L,u):null)}}}(q,Y,A,g,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),ze),A.paint.get("icon-opacity").constantOr(1)!==0&&H_(Y,g,A,q,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),Ft,Gn),A.paint.get("text-opacity").constantOr(1)!==0&&H_(Y,g,A,q,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),Ft,Gn),g.map.showCollisionBoxes&&(ly(Y,g,A,q,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),ly(Y,g,A,q,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))},circle:function(Y,g,A,q){if(Y.renderPass!=="translucent")return;const ze=A.paint.get("circle-opacity"),Ft=A.paint.get("circle-stroke-width"),Gn=A.paint.get("circle-stroke-opacity"),ls=!A.layout.get("circle-sort-key").isConstant();if(ze.constantOr(1)===0&&(Ft.constantOr(1)===0||Gn.constantOr(1)===0))return;const $s=Y.context,ol=$s.gl,nh=Y.depthModeForSublayer(0,um.ReadOnly),ih=zm.disabled,ph=Y.colorModeForRenderPass(),Lh=[];for(let Bh=0;Bh<q.length;Bh++){const Ch=q[Bh],Kh=g.getTile(Ch),fd=Kh.getBucket(A);if(!fd)continue;const ud=fd.programConfigurations.get(A.id),jh=Y.useProgram("circle",ud),Sd=fd.layoutVertexBuffer,Vd=fd.indexBuffer,Wd=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(Ch),Cf={programConfiguration:ud,program:jh,layoutVertexBuffer:Sd,indexBuffer:Vd,uniformValues:Jm(Y,Ch,Kh,A),terrainData:Wd};if(ls){const Of=fd.segments.get();for(const L of Of)Lh.push({segments:new o.SegmentVector([L]),sortKey:L.sortKey,state:Cf})}else Lh.push({segments:fd.segments,sortKey:0,state:Cf})}ls&&Lh.sort((Bh,Ch)=>Bh.sortKey-Ch.sortKey);for(const Bh of Lh){const{programConfiguration:Ch,program:Kh,layoutVertexBuffer:fd,indexBuffer:ud,uniformValues:jh,terrainData:Sd}=Bh.state;Kh.draw($s,ol.TRIANGLES,nh,ih,ph,Im.disabled,jh,Sd,A.id,fd,ud,Bh.segments,A.paint,Y.transform.zoom,Ch)}},heatmap:function(Y,g,A,q){if(A.paint.get("heatmap-opacity")!==0)if(Y.renderPass==="offscreen"){const ze=Y.context,Ft=ze.gl,Gn=zm.disabled,ls=new Xm([Ft.ONE,Ft.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function($s,ol,nh){const ih=$s.gl;$s.activeTexture.set(ih.TEXTURE1),$s.viewport.set([0,0,ol.width/4,ol.height/4]);let ph=nh.heatmapFbo;if(ph)ih.bindTexture(ih.TEXTURE_2D,ph.colorAttachment.get()),$s.bindFramebuffer.set(ph.framebuffer);else{const Lh=ih.createTexture();ih.bindTexture(ih.TEXTURE_2D,Lh),ih.texParameteri(ih.TEXTURE_2D,ih.TEXTURE_WRAP_S,ih.CLAMP_TO_EDGE),ih.texParameteri(ih.TEXTURE_2D,ih.TEXTURE_WRAP_T,ih.CLAMP_TO_EDGE),ih.texParameteri(ih.TEXTURE_2D,ih.TEXTURE_MIN_FILTER,ih.LINEAR),ih.texParameteri(ih.TEXTURE_2D,ih.TEXTURE_MAG_FILTER,ih.LINEAR),ph=nh.heatmapFbo=$s.createFramebuffer(ol.width/4,ol.height/4,!1),function(Bh,Ch,Kh,fd){const ud=Bh.gl;ud.texImage2D(ud.TEXTURE_2D,0,ud.RGBA,Ch.width/4,Ch.height/4,0,ud.RGBA,Bh.extRenderToTextureHalfFloat?Bh.extTextureHalfFloat.HALF_FLOAT_OES:ud.UNSIGNED_BYTE,null),fd.colorAttachment.set(Kh)}($s,ol,Lh,ph)}})(ze,Y,A),ze.clear({color:o.Color.transparent});for(let $s=0;$s<q.length;$s++){const ol=q[$s];if(g.hasRenderableParent(ol))continue;const nh=g.getTile(ol),ih=nh.getBucket(A);if(!ih)continue;const ph=ih.programConfigurations.get(A.id),Lh=Y.useProgram("heatmap",ph),{zoom:Bh}=Y.transform;Lh.draw(ze,Ft.TRIANGLES,um.disabled,Gn,ls,Im.disabled,Bm(ol.posMatrix,nh,Bh,A.paint.get("heatmap-intensity")),null,A.id,ih.layoutVertexBuffer,ih.indexBuffer,ih.segments,A.paint,Y.transform.zoom,ph)}ze.viewport.set([0,0,Y.width,Y.height])}else Y.renderPass==="translucent"&&(Y.context.setColorMode(Y.colorModeForRenderPass()),function(ze,Ft){const Gn=ze.context,ls=Gn.gl,$s=Ft.heatmapFbo;if(!$s)return;Gn.activeTexture.set(ls.TEXTURE0),ls.bindTexture(ls.TEXTURE_2D,$s.colorAttachment.get()),Gn.activeTexture.set(ls.TEXTURE1);let ol=Ft.colorRampTexture;ol||(ol=Ft.colorRampTexture=new Dh(Gn,Ft.colorRamp,ls.RGBA)),ol.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),ze.useProgram("heatmapTexture").draw(Gn,ls.TRIANGLES,um.disabled,zm.disabled,ze.colorModeForRenderPass(),Im.disabled,((nh,ih,ph,Lh)=>{const Bh=o.create();o.ortho(Bh,0,nh.width,nh.height,0,0,1);const Ch=nh.context.gl;return{u_matrix:Bh,u_world:[Ch.drawingBufferWidth,Ch.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ih.paint.get("heatmap-opacity")}})(ze,Ft),null,Ft.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments,Ft.paint,ze.transform.zoom)}(Y,A))},line:function(Y,g,A,q){if(Y.renderPass!=="translucent")return;const ze=A.paint.get("line-opacity"),Ft=A.paint.get("line-width");if(ze.constantOr(1)===0||Ft.constantOr(1)===0)return;const Gn=Y.depthModeForSublayer(0,um.ReadOnly),ls=Y.colorModeForRenderPass(),$s=A.paint.get("line-dasharray"),ol=A.paint.get("line-pattern"),nh=ol.constantOr(1),ih=A.paint.get("line-gradient"),ph=A.getCrossfadeParameters(),Lh=nh?"linePattern":$s?"lineSDF":ih?"lineGradient":"line",Bh=Y.context,Ch=Bh.gl;let Kh=!0;for(const fd of q){const ud=g.getTile(fd);if(nh&&!ud.patternsLoaded())continue;const jh=ud.getBucket(A);if(!jh)continue;const Sd=jh.programConfigurations.get(A.id),Vd=Y.context.program.get(),Wd=Y.useProgram(Lh,Sd),Cf=Kh||Wd.program!==Vd,Of=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(fd),L=ol.constantOr(null);if(L&&ud.imageAtlas){const B=ud.imageAtlas,ge=B.patternPositions[L.to.toString()],St=B.patternPositions[L.from.toString()];ge&&St&&Sd.setConstantPatternPositions(ge,St)}const u=Of?fd:null,E=nh?Ly(Y,ud,A,ph,u):$s?Ry(Y,ud,A,$s,ph,u):ih?Xg(Y,ud,A,jh.lineClipsArray.length,u):Km(Y,ud,A,u);if(nh)Bh.activeTexture.set(Ch.TEXTURE0),ud.imageAtlasTexture.bind(Ch.LINEAR,Ch.CLAMP_TO_EDGE),Sd.updatePaintBuffers(ph);else if($s&&(Cf||Y.lineAtlas.dirty))Bh.activeTexture.set(Ch.TEXTURE0),Y.lineAtlas.bind(Bh);else if(ih){const B=jh.gradients[A.id];let ge=B.texture;if(A.gradientVersion!==B.version){let St=256;if(A.stepInterpolant){const _n=g.getSource().maxzoom,Bn=fd.canonical.z===_n?Math.ceil(1<<Y.transform.maxZoom-fd.canonical.z):1;St=o.clamp(o.nextPowerOfTwo(jh.maxLineLength/o.EXTENT*1024*Bn),256,Bh.maxTextureSize)}B.gradient=o.renderColorRamp({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:B.gradient||void 0,clips:jh.lineClipsArray}),B.texture?B.texture.update(B.gradient):B.texture=new Dh(Bh,B.gradient,Ch.RGBA),B.version=A.gradientVersion,ge=B.texture}Bh.activeTexture.set(Ch.TEXTURE0),ge.bind(A.stepInterpolant?Ch.NEAREST:Ch.LINEAR,Ch.CLAMP_TO_EDGE)}Wd.draw(Bh,Ch.TRIANGLES,Gn,Y.stencilModeForClipping(fd),ls,Im.disabled,E,Of,A.id,jh.layoutVertexBuffer,jh.indexBuffer,jh.segments,A.paint,Y.transform.zoom,Sd,jh.layoutVertexBuffer2),Kh=!1}},fill:function(Y,g,A,q){const ze=A.paint.get("fill-color"),Ft=A.paint.get("fill-opacity");if(Ft.constantOr(1)===0)return;const Gn=Y.colorModeForRenderPass(),ls=A.paint.get("fill-pattern"),$s=Y.opaquePassEnabledForLayer()&&!ls.constantOr(1)&&ze.constantOr(o.Color.transparent).a===1&&Ft.constantOr(0)===1?"opaque":"translucent";if(Y.renderPass===$s){const ol=Y.depthModeForSublayer(1,Y.renderPass==="opaque"?um.ReadWrite:um.ReadOnly);Qg(Y,g,A,q,ol,Gn,!1)}if(Y.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ol=Y.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,um.ReadOnly);Qg(Y,g,A,q,ol,Gn,!0)}},"fill-extrusion":function(Y,g,A,q){const ze=A.paint.get("fill-extrusion-opacity");if(ze!==0&&Y.renderPass==="translucent"){const Ft=new um(Y.context.gl.LEQUAL,um.ReadWrite,Y.depthRangeFor3D);if(ze!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))qy(Y,g,A,q,Ft,zm.disabled,Xm.disabled),qy(Y,g,A,q,Ft,Y.stencilModeFor3D(),Y.colorModeForRenderPass());else{const Gn=Y.colorModeForRenderPass();qy(Y,g,A,q,Ft,zm.disabled,Gn)}}},hillshade:function(Y,g,A,q){if(Y.renderPass!=="offscreen"&&Y.renderPass!=="translucent")return;const ze=Y.context,Ft=Y.depthModeForSublayer(0,um.ReadOnly),Gn=Y.colorModeForRenderPass(),[ls,$s]=Y.renderPass==="translucent"?Y.stencilConfigForOverlap(q):[{},q];for(const ol of $s){const nh=g.getTile(ol);nh.needsHillshadePrepare!==void 0&&nh.needsHillshadePrepare&&Y.renderPass==="offscreen"?p0(Y,nh,A,Ft,zm.disabled,Gn):Y.renderPass==="translucent"&&rv(Y,ol,nh,A,Ft,ls[ol.overscaledZ],Gn)}ze.viewport.set([0,0,Y.width,Y.height])},raster:function(Y,g,A,q){if(Y.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!q.length)return;const ze=Y.context,Ft=ze.gl,Gn=g.getSource(),ls=Y.useProgram("raster"),$s=Y.colorModeForRenderPass(),[ol,nh]=Gn instanceof yd?[{},q]:Y.stencilConfigForOverlap(q),ih=nh[nh.length-1].overscaledZ,ph=!Y.options.moving;for(const Lh of nh){const Bh=Y.depthModeForSublayer(Lh.overscaledZ-ih,A.paint.get("raster-opacity")===1?um.ReadWrite:um.ReadOnly,Ft.LESS),Ch=g.getTile(Lh);Ch.registerFadeDuration(A.paint.get("raster-fade-duration"));const Kh=g.findLoadedParent(Lh,0),fd=C_(Ch,Kh,g,A,Y.transform,Y.style.map.terrain);let ud,jh;const Sd=A.paint.get("raster-resampling")==="nearest"?Ft.NEAREST:Ft.LINEAR;ze.activeTexture.set(Ft.TEXTURE0),Ch.texture.bind(Sd,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),ze.activeTexture.set(Ft.TEXTURE1),Kh?(Kh.texture.bind(Sd,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),ud=Math.pow(2,Kh.tileID.overscaledZ-Ch.tileID.overscaledZ),jh=[Ch.tileID.canonical.x*ud%1,Ch.tileID.canonical.y*ud%1]):Ch.texture.bind(Sd,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST);const Vd=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(Lh),Wd=Vd?Lh:null,Cf=Wd?Wd.posMatrix:Y.transform.calculatePosMatrix(Lh.toUnwrapped(),ph),Of=Oy(Cf,jh||[0,0],ud||1,fd,A);Gn instanceof yd?ls.draw(ze,Ft.TRIANGLES,Bh,zm.disabled,$s,Im.disabled,Of,Vd,A.id,Gn.boundsBuffer,Y.quadTriangleIndexBuffer,Gn.boundsSegments):ls.draw(ze,Ft.TRIANGLES,Bh,ol[Lh.overscaledZ],$s,Im.disabled,Of,Vd,A.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments)}},background:function(Y,g,A,q){const ze=A.paint.get("background-color"),Ft=A.paint.get("background-opacity");if(Ft===0)return;const Gn=Y.context,ls=Gn.gl,$s=Y.transform,ol=$s.tileSize,nh=A.paint.get("background-pattern");if(Y.isPatternMissing(nh))return;const ih=!nh&&ze.a===1&&Ft===1&&Y.opaquePassEnabledForLayer()?"opaque":"translucent";if(Y.renderPass!==ih)return;const ph=zm.disabled,Lh=Y.depthModeForSublayer(0,ih==="opaque"?um.ReadWrite:um.ReadOnly),Bh=Y.colorModeForRenderPass(),Ch=Y.useProgram(nh?"backgroundPattern":"background"),Kh=q||$s.coveringTiles({tileSize:ol,terrain:Y.style.map.terrain});nh&&(Gn.activeTexture.set(ls.TEXTURE0),Y.imageManager.bind(Y.context));const fd=A.getCrossfadeParameters();for(const ud of Kh){const jh=q?ud.posMatrix:Y.transform.calculatePosMatrix(ud.toUnwrapped()),Sd=nh?oy(jh,Ft,Y,nh,{tileID:ud,tileSize:ol},fd):tv(jh,Ft,ze),Vd=Y.style.map.terrain&&Y.style.map.terrain.getTerrainData(ud);Ch.draw(Gn,ls.TRIANGLES,Lh,ph,Bh,Im.disabled,Sd,Vd,A.id,Y.tileExtentBuffer,Y.quadTriangleIndexBuffer,Y.tileExtentSegments)}},debug:function(Y,g,A){for(let q=0;q<A.length;q++)Qm(Y,g,A[q])},custom:function(Y,g,A){const q=Y.context,ze=A.implementation;if(Y.renderPass==="offscreen"){const Ft=ze.prerender;Ft&&(Y.setCustomLayerDefaults(),q.setColorMode(Y.colorModeForRenderPass()),Ft.call(ze,q.gl,Y.transform.customLayerMatrix()),q.setDirty(),Y.setBaseState())}else if(Y.renderPass==="translucent"){Y.setCustomLayerDefaults(),q.setColorMode(Y.colorModeForRenderPass()),q.setStencilMode(zm.disabled);const Ft=ze.renderingMode==="3d"?new um(Y.context.gl.LEQUAL,um.ReadWrite,Y.depthRangeFor3D):Y.depthModeForSublayer(0,um.ReadOnly);q.setDepthMode(Ft),ze.render(q.gl,Y.transform.customLayerMatrix()),q.setDirty(),Y.setBaseState(),q.bindFramebuffer.set(null)}}};class Vm{constructor(g,A){this.context=new d0(g),this.transform=A,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Ld.maxUnderzooming+Ld.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mm,this.gpuTimers={}}resize(g,A,q){if(this.width=g*q,this.height=A*q,this.pixelRatio=q,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const ze of this.style._order)this.style._layers[ze].resize()}setup(){const g=this.context,A=new o.PosArray;A.emplaceBack(0,0),A.emplaceBack(o.EXTENT,0),A.emplaceBack(0,o.EXTENT),A.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=g.createVertexBuffer(A,od.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const q=new o.PosArray;q.emplaceBack(0,0),q.emplaceBack(o.EXTENT,0),q.emplaceBack(0,o.EXTENT),q.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=g.createVertexBuffer(q,od.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const ze=new o.RasterBoundsArray;ze.emplaceBack(0,0,0,0),ze.emplaceBack(o.EXTENT,0,o.EXTENT,0),ze.emplaceBack(0,o.EXTENT,0,o.EXTENT),ze.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=g.createVertexBuffer(ze,jf.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Ft=new o.PosArray;Ft.emplaceBack(0,0),Ft.emplaceBack(1,0),Ft.emplaceBack(0,1),Ft.emplaceBack(1,1),this.viewportBuffer=g.createVertexBuffer(Ft,od.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Gn=new o.LineStripIndexArray;Gn.emplaceBack(0),Gn.emplaceBack(1),Gn.emplaceBack(3),Gn.emplaceBack(2),Gn.emplaceBack(0),this.tileBorderIndexBuffer=g.createIndexBuffer(Gn);const ls=new o.TriangleIndexArray;ls.emplaceBack(0,1,2),ls.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=g.createIndexBuffer(ls),this.emptyTexture=new Dh(g,{width:1,height:1,data:new Uint8Array([0,0,0,0])},g.gl.RGBA);const $s=this.context.gl;this.stencilClearMode=new zm({func:$s.ALWAYS,mask:0},0,255,$s.ZERO,$s.ZERO,$s.ZERO)}clearStencil(){const g=this.context,A=g.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const q=o.create();o.ortho(q,0,this.width,this.height,0,0,1),o.scale(q,q,[A.drawingBufferWidth,A.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(g,A.TRIANGLES,um.disabled,this.stencilClearMode,Xm.disabled,Im.disabled,kg(q),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(g,A){if(this.currentStencilSource===g.source||!g.isTileClipped()||!A||!A.length)return;this.currentStencilSource=g.source;const q=this.context,ze=q.gl;this.nextStencilID+A.length>256&&this.clearStencil(),q.setColorMode(Xm.disabled),q.setDepthMode(um.disabled);const Ft=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Gn of A){const ls=this._tileClippingMaskIDs[Gn.key]=this.nextStencilID++,$s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Gn);Ft.draw(q,ze.TRIANGLES,um.disabled,new zm({func:ze.ALWAYS,mask:0},ls,255,ze.KEEP,ze.KEEP,ze.REPLACE),Xm.disabled,Im.disabled,kg(Gn.posMatrix),$s,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const g=this.nextStencilID++,A=this.context.gl;return new zm({func:A.NOTEQUAL,mask:255},g,255,A.KEEP,A.KEEP,A.REPLACE)}stencilModeForClipping(g){const A=this.context.gl;return new zm({func:A.EQUAL,mask:255},this._tileClippingMaskIDs[g.key],0,A.KEEP,A.KEEP,A.REPLACE)}stencilConfigForOverlap(g){const A=this.context.gl,q=g.sort((Gn,ls)=>ls.overscaledZ-Gn.overscaledZ),ze=q[q.length-1].overscaledZ,Ft=q[0].overscaledZ-ze+1;if(Ft>1){this.currentStencilSource=void 0,this.nextStencilID+Ft>256&&this.clearStencil();const Gn={};for(let ls=0;ls<Ft;ls++)Gn[ls+ze]=new zm({func:A.GEQUAL,mask:255},ls+this.nextStencilID,255,A.KEEP,A.KEEP,A.REPLACE);return this.nextStencilID+=Ft,[Gn,q]}return[{[ze]:zm.disabled},q]}colorModeForRenderPass(){const g=this.context.gl;return this._showOverdrawInspector?new Xm([g.CONSTANT_COLOR,g.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xm.unblended:Xm.alphaBlended}depthModeForSublayer(g,A,q){if(!this.opaquePassEnabledForLayer())return um.disabled;const ze=1-((1+this.currentLayer)*this.numSublayers+g)*this.depthEpsilon;return new um(q||this.context.gl.LEQUAL,A,[ze,ze])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(g,A){this.style=g,this.options=A,this.lineAtlas=g.lineAtlas,this.imageManager=g.imageManager,this.glyphManager=g.glyphManager,this.symbolFadeChange=g.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const q=this.style._order,ze=this.style.sourceCaches,Ft={},Gn={},ls={};for(const $s in ze){const ol=ze[$s];ol.used&&ol.prepare(this.context),Ft[$s]=ol.getVisibleCoordinates(),Gn[$s]=Ft[$s].slice().reverse(),ls[$s]=ol.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $s=0;$s<q.length;$s++)if(this.style._layers[q[$s]].is3D()){this.opaquePassCutoff=$s;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const $s=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||$s.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(ol,nh){const ih=ol.context,ph=ih.gl,Lh=Xm.unblended,Bh=new um(ph.LEQUAL,um.ReadWrite,[0,1]),Ch=nh.getTerrainMesh(),Kh=nh.sourceCache.getRenderableTiles(),fd=ol.useProgram("terrainDepth");ih.bindFramebuffer.set(nh.getFramebuffer("depth").framebuffer),ih.viewport.set([0,0,ol.width/devicePixelRatio,ol.height/devicePixelRatio]),ih.clear({color:o.Color.transparent,depth:1});for(const ud of Kh){const jh=nh.getTerrainData(ud.tileID),Sd={u_matrix:ol.transform.calculatePosMatrix(ud.tileID.toUnwrapped()),u_ele_delta:nh.getMeshFrameDelta(ol.transform.zoom)};fd.draw(ih,ph.TRIANGLES,Bh,zm.disabled,Lh,Im.backCCW,Sd,jh,"terrain",Ch.vertexBuffer,Ch.indexBuffer,Ch.segments)}ih.bindFramebuffer.set(null),ih.viewport.set([0,0,ol.width,ol.height])}(this,this.style.map.terrain),function(ol,nh){const ih=ol.context,ph=ih.gl,Lh=Xm.unblended,Bh=new um(ph.LEQUAL,um.ReadWrite,[0,1]),Ch=nh.getTerrainMesh(),Kh=nh.getCoordsTexture(),fd=nh.sourceCache.getRenderableTiles(),ud=ol.useProgram("terrainCoords");ih.bindFramebuffer.set(nh.getFramebuffer("coords").framebuffer),ih.viewport.set([0,0,ol.width/devicePixelRatio,ol.height/devicePixelRatio]),ih.clear({color:o.Color.transparent,depth:1}),nh.coordsIndex=[];for(const jh of fd){const Sd=nh.getTerrainData(jh.tileID);ih.activeTexture.set(ph.TEXTURE0),ph.bindTexture(ph.TEXTURE_2D,Kh.texture);const Vd={u_matrix:ol.transform.calculatePosMatrix(jh.tileID.toUnwrapped()),u_terrain_coords_id:(255-nh.coordsIndex.length)/255,u_texture:0,u_ele_delta:nh.getMeshFrameDelta(ol.transform.zoom)};ud.draw(ih,ph.TRIANGLES,Bh,zm.disabled,Lh,Im.backCCW,Vd,Sd,"terrain",Ch.vertexBuffer,Ch.indexBuffer,Ch.segments),nh.coordsIndex.push(jh.tileID.key)}ih.bindFramebuffer.set(null),ih.viewport.set([0,0,ol.width,ol.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const $s of q){const ol=this.style._layers[$s];if(!ol.hasOffscreenPass()||ol.isHidden(this.transform.zoom))continue;const nh=Gn[ol.source];(ol.type==="custom"||nh.length)&&this.renderLayer(this,ze[ol.source],ol,nh)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:A.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=A.showOverdrawInspector,this.depthRangeFor3D=[0,1-(g._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=q.length-1;this.currentLayer>=0;this.currentLayer--){const $s=this.style._layers[q[this.currentLayer]],ol=ze[$s.source],nh=Ft[$s.source];this._renderTileClippingMasks($s,nh),this.renderLayer(this,ol,$s,nh)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const $s=this.style._layers[q[this.currentLayer]],ol=ze[$s.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($s))continue;const nh=($s.type==="symbol"?ls:Gn)[$s.source];this._renderTileClippingMasks($s,Ft[$s.source]),this.renderLayer(this,ol,$s,nh)}if(this.options.showTileBoundaries){const $s=function(ol,nh){let ih=null;const ph=Object.values(ol._layers).flatMap(Kh=>Kh.source&&!Kh.isHidden(nh)?[ol.sourceCaches[Kh.source]]:[]),Lh=ph.filter(Kh=>Kh.getSource().type==="vector"),Bh=ph.filter(Kh=>Kh.getSource().type!=="vector"),Ch=Kh=>{(!ih||ih.getSource().maxzoom<Kh.getSource().maxzoom)&&(ih=Kh)};return Lh.forEach(Kh=>Ch(Kh)),ih||Bh.forEach(Kh=>Ch(Kh)),ih}(this.style,this.transform.zoom);$s&&sg.debug(this,$s,$s.getVisibleCoordinates())}this.options.showPadding&&function($s){const ol=$s.transform.padding;Bp($s,$s.transform.height-(ol.top||0),3,m0),Bp($s,ol.bottom||0,3,X_),Nm($s,ol.left||0,3,hd),Nm($s,$s.transform.width-(ol.right||0),3,wf);const nh=$s.transform.centerPoint;(function(ih,ph,Lh,Bh){hm(ih,ph-1,Lh-10,2,20,Bh),hm(ih,ph-10,Lh-1,20,2,Bh)})($s,nh.x,$s.transform.height-nh.y,ip)}(this),this.context.setDefault()}renderLayer(g,A,q,ze){q.isHidden(this.transform.zoom)||(q.type==="background"||q.type==="custom"||(ze||[]).length)&&(this.id=q.id,this.gpuTimingStart(q),sg[q.type](g,A,q,ze,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(g){if(!this.options.gpuTiming)return;const A=this.context.extTimerQuery;let q=this.gpuTimers[g.id];q||(q=this.gpuTimers[g.id]={calls:0,cpuTime:0,query:A.createQueryEXT()}),q.calls++,A.beginQueryEXT(A.TIME_ELAPSED_EXT,q.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;g.endQueryEXT(g.TIME_ELAPSED_EXT)}collectGpuTimers(){const g=this.gpuTimers;return this.gpuTimers={},g}queryGpuTimers(g){const A={};for(const q in g){const ze=g[q],Ft=this.context.extTimerQuery,Gn=Ft.getQueryObjectEXT(ze.query,Ft.QUERY_RESULT_EXT)/1e6;Ft.deleteQueryEXT(ze.query),A[q]=Gn}return A}translatePosMatrix(g,A,q,ze,Ft){if(!q[0]&&!q[1])return g;const Gn=Ft?ze==="map"?this.transform.angle:0:ze==="viewport"?-this.transform.angle:0;if(Gn){const ol=Math.sin(Gn),nh=Math.cos(Gn);q=[q[0]*nh-q[1]*ol,q[0]*ol+q[1]*nh]}const ls=[Ft?q[0]:Fh(A,q[0],this.transform.zoom),Ft?q[1]:Fh(A,q[1],this.transform.zoom),0],$s=new Float32Array(16);return o.translate($s,g,ls),$s}saveTileTexture(g){const A=this._tileTextures[g.size[0]];A?A.push(g):this._tileTextures[g.size[0]]=[g]}getTileTexture(g){const A=this._tileTextures[g];return A&&A.length>0?A.pop():null}isPatternMissing(g){if(!g)return!1;if(!g.from||!g.to)return!0;const A=this.imageManager.getPattern(g.from.toString()),q=this.imageManager.getPattern(g.to.toString());return!A||!q}useProgram(g,A){this.cache=this.cache||{};const q=g+(A?A.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[q]||(this.cache[q]=new lp(this.context,g,Gf[g],A,o0[g],this._showOverdrawInspector,this.style.map.terrain)),this.cache[q]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const g=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(g.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Dh(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class tp{constructor(g,A){this.points=g,this.planes=A}static fromInvProjectionMatrix(g,A,q){const ze=Math.pow(2,q),Ft=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ls=>{const $s=1/(ls=o.transformMat4([],ls,g))[3]/A*ze;return o.mul$1(ls,ls,[$s,$s,1/ls[3],$s])}),Gn=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ls=>{const $s=function(ph,Lh){var Bh=Lh[0],Ch=Lh[1],Kh=Lh[2],fd=Bh*Bh+Ch*Ch+Kh*Kh;return fd>0&&(fd=1/Math.sqrt(fd)),ph[0]=Lh[0]*fd,ph[1]=Lh[1]*fd,ph[2]=Lh[2]*fd,ph}([],function(ph,Lh,Bh){var Ch=Lh[0],Kh=Lh[1],fd=Lh[2],ud=Bh[0],jh=Bh[1],Sd=Bh[2];return ph[0]=Kh*Sd-fd*jh,ph[1]=fd*ud-Ch*Sd,ph[2]=Ch*jh-Kh*ud,ph}([],sh([],Ft[ls[0]],Ft[ls[1]]),sh([],Ft[ls[2]],Ft[ls[1]]))),ol=-((nh=$s)[0]*(ih=Ft[ls[1]])[0]+nh[1]*ih[1]+nh[2]*ih[2]);var nh,ih;return $s.concat(ol)});return new tp(Ft,Gn)}}class Wg{constructor(g,A){this.min=g,this.max=A,this.center=function(q,ze,Ft){return q[0]=.5*ze[0],q[1]=.5*ze[1],q[2]=.5*ze[2],q}([],function(q,ze,Ft){return q[0]=ze[0]+Ft[0],q[1]=ze[1]+Ft[1],q[2]=ze[2]+Ft[2],q}([],this.min,this.max))}quadrant(g){const A=[g%2==0,g<2],q=th(this.min),ze=th(this.max);for(let Ft=0;Ft<A.length;Ft++)q[Ft]=A[Ft]?this.min[Ft]:this.center[Ft],ze[Ft]=A[Ft]?this.center[Ft]:this.max[Ft];return ze[2]=this.max[2],new Wg(q,ze)}distanceX(g){return Math.max(Math.min(this.max[0],g[0]),this.min[0])-g[0]}distanceY(g){return Math.max(Math.min(this.max[1],g[1]),this.min[1])-g[1]}intersects(g){const A=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let q=!0;for(let ze=0;ze<g.planes.length;ze++){const Ft=g.planes[ze];let Gn=0;for(let ls=0;ls<A.length;ls++)o.dot(Ft,A[ls])>=0&&Gn++;if(Gn===0)return 0;Gn!==A.length&&(q=!1)}if(q)return 2;for(let ze=0;ze<3;ze++){let Ft=Number.MAX_VALUE,Gn=-Number.MAX_VALUE;for(let ls=0;ls<g.points.length;ls++){const $s=g.points[ls][ze]-this.min[ze];Ft=Math.min(Ft,$s),Gn=Math.max(Gn,$s)}if(Gn<0||Ft>this.max[ze]-this.min[ze])return 0}return 1}}class Sg{constructor(g=0,A=0,q=0,ze=0){if(isNaN(g)||g<0||isNaN(A)||A<0||isNaN(q)||q<0||isNaN(ze)||ze<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=g,this.bottom=A,this.left=q,this.right=ze}interpolate(g,A,q){return A.top!=null&&g.top!=null&&(this.top=o.number(g.top,A.top,q)),A.bottom!=null&&g.bottom!=null&&(this.bottom=o.number(g.bottom,A.bottom,q)),A.left!=null&&g.left!=null&&(this.left=o.number(g.left,A.left,q)),A.right!=null&&g.right!=null&&(this.right=o.number(g.right,A.right,q)),this}getCenter(g,A){const q=o.clamp((this.left+g-this.right)/2,0,g),ze=o.clamp((this.top+A-this.bottom)/2,0,A);return new o.pointGeometry(q,ze)}equals(g){return this.top===g.top&&this.bottom===g.bottom&&this.left===g.left&&this.right===g.right}clone(){return new Sg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fg{constructor(g,A,q,ze,Ft){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=Ft===void 0||!!Ft,this._minZoom=g||0,this._maxZoom=A||22,this._minPitch=q??0,this._maxPitch=ze??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Sg,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const g=new fg(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return g.tileSize=this.tileSize,g.latRange=this.latRange,g.width=this.width,g.height=this.height,g._center=this._center,g._elevation=this._elevation,g.zoom=this.zoom,g.angle=this.angle,g._fov=this._fov,g._pitch=this._pitch,g._unmodified=this._unmodified,g._edgeInsets=this._edgeInsets.clone(),g._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(g){this._minZoom!==g&&(this._minZoom=g,this.zoom=Math.max(this.zoom,g))}get maxZoom(){return this._maxZoom}set maxZoom(g){this._maxZoom!==g&&(this._maxZoom=g,this.zoom=Math.min(this.zoom,g))}get minPitch(){return this._minPitch}set minPitch(g){this._minPitch!==g&&(this._minPitch=g,this.pitch=Math.max(this.pitch,g))}get maxPitch(){return this._maxPitch}set maxPitch(g){this._maxPitch!==g&&(this._maxPitch=g,this.pitch=Math.min(this.pitch,g))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(g){g===void 0?g=!0:g===null&&(g=!1),this._renderWorldCopies=g}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(g){const A=-o.wrap(g,-180,180)*Math.PI/180;this.angle!==A&&(this._unmodified=!1,this.angle=A,this._calcMatrices(),this.rotationMatrix=function(){var q=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(q[1]=0,q[2]=0),q[0]=1,q[3]=1,q}(),function(q,ze,Ft){var Gn=ze[0],ls=ze[1],$s=ze[2],ol=ze[3],nh=Math.sin(Ft),ih=Math.cos(Ft);q[0]=Gn*ih+$s*nh,q[1]=ls*ih+ol*nh,q[2]=Gn*-nh+$s*ih,q[3]=ls*-nh+ol*ih}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(g){const A=o.clamp(g,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==A&&(this._unmodified=!1,this._pitch=A,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(g){g=Math.max(.01,Math.min(60,g)),this._fov!==g&&(this._unmodified=!1,this._fov=g/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(g){const A=Math.min(Math.max(g,this.minZoom),this.maxZoom);this._zoom!==A&&(this._unmodified=!1,this._zoom=A,this.tileZoom=Math.max(0,Math.floor(A)),this.scale=this.zoomScale(A),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(g){g.lat===this._center.lat&&g.lng===this._center.lng||(this._unmodified=!1,this._center=g,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(g){g!==this._elevation&&(this._elevation=g,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(g){this._edgeInsets.equals(g)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,g,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(g){return this._edgeInsets.equals(g)}interpolatePadding(g,A,q){this._unmodified=!1,this._edgeInsets.interpolate(g,A,q),this._constrain(),this._calcMatrices()}coveringZoomLevel(g){const A=(g.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/g.tileSize));return Math.max(0,A)}getVisibleUnwrappedCoordinates(g){const A=[new o.UnwrappedTileID(0,g)];if(this._renderWorldCopies){const q=this.pointCoordinate(new o.pointGeometry(0,0)),ze=this.pointCoordinate(new o.pointGeometry(this.width,0)),Ft=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),Gn=this.pointCoordinate(new o.pointGeometry(0,this.height)),ls=Math.floor(Math.min(q.x,ze.x,Ft.x,Gn.x)),$s=Math.floor(Math.max(q.x,ze.x,Ft.x,Gn.x)),ol=1;for(let nh=ls-ol;nh<=$s+ol;nh++)nh!==0&&A.push(new o.UnwrappedTileID(nh,g))}return A}coveringTiles(g){var A,q;let ze=this.coveringZoomLevel(g);const Ft=ze;if(g.minzoom!==void 0&&ze<g.minzoom)return[];g.maxzoom!==void 0&&ze>g.maxzoom&&(ze=g.maxzoom);const Gn=this.pointCoordinate(this.getCameraPoint()),ls=o.MercatorCoordinate.fromLngLat(this.center),$s=Math.pow(2,ze),ol=[$s*Gn.x,$s*Gn.y,0],nh=[$s*ls.x,$s*ls.y,0],ih=tp.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ze);let ph=g.minzoom||0;!g.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ph=ze);const Lh=g.terrain?2/Math.min(this.tileSize,g.tileSize)*this.tileSize:3,Bh=jh=>({aabb:new Wg([jh*$s,0,0],[(jh+1)*$s,$s,0]),zoom:0,x:0,y:0,wrap:jh,fullyVisible:!1}),Ch=[],Kh=[],fd=ze,ud=g.reparseOverscaled?Ft:ze;if(this._renderWorldCopies)for(let jh=1;jh<=3;jh++)Ch.push(Bh(-jh)),Ch.push(Bh(jh));for(Ch.push(Bh(0));Ch.length>0;){const jh=Ch.pop(),Sd=jh.x,Vd=jh.y;let Wd=jh.fullyVisible;if(!Wd){const E=jh.aabb.intersects(ih);if(E===0)continue;Wd=E===2}const Cf=g.terrain?ol:nh,Of=jh.aabb.distanceX(Cf),L=jh.aabb.distanceY(Cf),u=Math.max(Math.abs(Of),Math.abs(L));if(jh.zoom===fd||u>Lh+(1<<fd-jh.zoom)-2&&jh.zoom>=ph){const E=fd-jh.zoom,B=ol[0]-.5-(Sd<<E),ge=ol[1]-.5-(Vd<<E);Kh.push({tileID:new o.OverscaledTileID(jh.zoom===fd?ud:jh.zoom,jh.wrap,jh.zoom,Sd,Vd),distanceSq:xh([nh[0]-.5-Sd,nh[1]-.5-Vd]),tileDistanceToCamera:Math.sqrt(B*B+ge*ge)})}else for(let E=0;E<4;E++){const B=(Sd<<1)+E%2,ge=(Vd<<1)+(E>>1),St=jh.zoom+1;let _n=jh.aabb.quadrant(E);if(g.terrain){const Bn=new o.OverscaledTileID(St,jh.wrap,St,B,ge),ss=g.terrain.getMinMaxElevation(Bn),tl=(A=ss.minElevation)!==null&&A!==void 0?A:this.elevation,il=(q=ss.maxElevation)!==null&&q!==void 0?q:this.elevation;_n=new Wg([_n.min[0],_n.min[1],tl],[_n.max[0],_n.max[1],il])}Ch.push({aabb:_n,zoom:St,x:B,y:ge,wrap:jh.wrap,fullyVisible:Wd})}}return Kh.sort((jh,Sd)=>jh.distanceSq-Sd.distanceSq).map(jh=>jh.tileID)}resize(g,A){this.width=g,this.height=A,this.pixelsToGLUnits=[2/g,-2/A],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(g){return Math.pow(2,g)}scaleZoom(g){return Math.log(g)/Math.LN2}project(g){const A=o.clamp(g.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(g.lng)*this.worldSize,o.mercatorYfromLat(A)*this.worldSize)}unproject(g){return new o.MercatorCoordinate(g.x/this.worldSize,g.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(g){this.freezeElevation||(this.elevation=g?this.getElevation(this._center,g):0)}getElevation(g,A){const q=o.MercatorCoordinate.fromLngLat(g),ze=(1<<this.tileZoom)*o.EXTENT,Ft=q.x*ze,Gn=q.y*ze,ls=Math.floor(Ft/o.EXTENT),$s=Math.floor(Gn/o.EXTENT),ol=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,ls,$s);return A.getElevation(ol,Ft%o.EXTENT,Gn%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(g){const A=this.pointLocation(this.centerPoint,g),q=this.getElevation(A,g);if(!(this.elevation-q))return;const ze=this.getCameraPosition(),Ft=o.MercatorCoordinate.fromLngLat(ze.lngLat,ze.altitude),Gn=o.MercatorCoordinate.fromLngLat(A,q),ls=Ft.x-Gn.x,$s=Ft.y-Gn.y,ol=Ft.z-Gn.z,nh=Math.sqrt(ls*ls+$s*$s+ol*ol),ih=this.scaleZoom(this.cameraToCenterDistance/nh/this.tileSize);this._elevation=q,this._center=A,this.zoom=ih}setLocationAtPoint(g,A){const q=this.pointCoordinate(A),ze=this.pointCoordinate(this.centerPoint),Ft=this.locationCoordinate(g),Gn=new o.MercatorCoordinate(Ft.x-(q.x-ze.x),Ft.y-(q.y-ze.y));this.center=this.coordinateLocation(Gn),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(g,A){return A?this.coordinatePoint(this.locationCoordinate(g),this.getElevation(g,A),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(g))}pointLocation(g,A){return this.coordinateLocation(this.pointCoordinate(g,A))}locationCoordinate(g){return o.MercatorCoordinate.fromLngLat(g)}coordinateLocation(g){return g&&g.toLngLat()}pointCoordinate(g,A){if(A){const ph=A.pointCoordinate(g);if(ph!=null)return ph}const q=[g.x,g.y,0,1],ze=[g.x,g.y,1,1];o.transformMat4(q,q,this.pixelMatrixInverse),o.transformMat4(ze,ze,this.pixelMatrixInverse);const Ft=q[3],Gn=ze[3],ls=q[1]/Ft,$s=ze[1]/Gn,ol=q[2]/Ft,nh=ze[2]/Gn,ih=ol===nh?0:(0-ol)/(nh-ol);return new o.MercatorCoordinate(o.number(q[0]/Ft,ze[0]/Gn,ih)/this.worldSize,o.number(ls,$s,ih)/this.worldSize)}coordinatePoint(g,A=0,q=this.pixelMatrix){const ze=[g.x*this.worldSize,g.y*this.worldSize,A,1];return o.transformMat4(ze,ze,q),new o.pointGeometry(ze[0]/ze[3],ze[1]/ze[3])}getBounds(){const g=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,g))).extend(this.pointLocation(new o.pointGeometry(this.width,g))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(g){g?(this.lngRange=[g.getWest(),g.getEast()],this.latRange=[g.getSouth(),g.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(g,A=!1){const q=g.key,ze=A?this._alignedPosMatrixCache:this._posMatrixCache;if(ze[q])return ze[q];const Ft=g.canonical,Gn=this.worldSize/this.zoomScale(Ft.z),ls=Ft.x+Math.pow(2,Ft.z)*g.wrap,$s=o.identity(new Float64Array(16));return o.translate($s,$s,[ls*Gn,Ft.y*Gn,0]),o.scale($s,$s,[Gn/o.EXTENT,Gn/o.EXTENT,1]),o.multiply($s,A?this.alignedProjMatrix:this.projMatrix,$s),ze[q]=new Float32Array($s),ze[q]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let g,A,q,ze,Ft=-90,Gn=90,ls=-180,$s=180;const ol=this.size,nh=this._unmodified;if(this.latRange){const Lh=this.latRange;Ft=o.mercatorYfromLat(Lh[1])*this.worldSize,Gn=o.mercatorYfromLat(Lh[0])*this.worldSize,g=Gn-Ft<ol.y?ol.y/(Gn-Ft):0}if(this.lngRange){const Lh=this.lngRange;ls=o.wrap(o.mercatorXfromLng(Lh[0])*this.worldSize,0,this.worldSize),$s=o.wrap(o.mercatorXfromLng(Lh[1])*this.worldSize,0,this.worldSize),$s<ls&&($s+=this.worldSize),A=$s-ls<ol.x?ol.x/($s-ls):0}const ih=this.point,ph=Math.max(A||0,g||0);if(ph)return this.center=this.unproject(new o.pointGeometry(A?($s+ls)/2:ih.x,g?(Gn+Ft)/2:ih.y)),this.zoom+=this.scaleZoom(ph),this._unmodified=nh,void(this._constraining=!1);if(this.latRange){const Lh=ih.y,Bh=ol.y/2;Lh-Bh<Ft&&(ze=Ft+Bh),Lh+Bh>Gn&&(ze=Gn-Bh)}if(this.lngRange){const Lh=(ls+$s)/2,Bh=o.wrap(ih.x,Lh-this.worldSize/2,Lh+this.worldSize/2),Ch=ol.x/2;Bh-Ch<ls&&(q=ls+Ch),Bh+Ch>$s&&(q=$s-Ch)}q===void 0&&ze===void 0||(this.center=this.unproject(new o.pointGeometry(q!==void 0?q:ih.x,ze!==void 0?ze:ih.y)).wrap()),this._unmodified=nh,this._constraining=!1}_calcMatrices(){if(!this.height)return;const g=this.centerOffset,A=this.point.x,q=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let ze=o.identity(new Float64Array(16));o.scale(ze,ze,[this.width/2,-this.height/2,1]),o.translate(ze,ze,[1,-1,0]),this.labelPlaneMatrix=ze,ze=o.identity(new Float64Array(16)),o.scale(ze,ze,[1,-1,1]),o.translate(ze,ze,[-1,-1,0]),o.scale(ze,ze,[2/this.width,2/this.height,1]),this.glCoordMatrix=ze,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const Ft=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,Gn=Math.PI/2+this._pitch,ls=this._fov*(.5+g.y/this.height),$s=Math.sin(ls)*Ft/Math.sin(o.clamp(Math.PI-Gn-ls,.01,Math.PI-.01)),ol=this.getHorizon(),nh=2*Math.atan(ol/this.cameraToCenterDistance)*(.5+g.y/(2*ol)),ih=Math.sin(nh)*Ft/Math.sin(o.clamp(Math.PI-Gn-nh,.01,Math.PI-.01)),ph=Math.min($s,ih),Lh=1.01*(Math.cos(Math.PI/2-this._pitch)*ph+Ft),Bh=this.height/50;ze=new Float64Array(16),o.perspective(ze,this._fov,this.width/this.height,Bh,Lh),ze[8]=2*-g.x/this.width,ze[9]=2*g.y/this.height,o.scale(ze,ze,[1,-1,1]),o.translate(ze,ze,[0,0,-this.cameraToCenterDistance]),o.rotateX(ze,ze,this._pitch),o.rotateZ(ze,ze,this.angle),o.translate(ze,ze,[-A,-q,0]),this.mercatorMatrix=o.scale([],ze,[this.worldSize,this.worldSize,this.worldSize]),o.scale(ze,ze,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,ze),o.translate(ze,ze,[0,0,-this.elevation]),this.projMatrix=ze,this.invProjMatrix=o.invert([],ze),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,ze);const Ch=this.width%2/2,Kh=this.height%2/2,fd=Math.cos(this.angle),ud=Math.sin(this.angle),jh=A-Math.round(A)+fd*Ch+ud*Kh,Sd=q-Math.round(q)+fd*Kh+ud*Ch,Vd=new Float64Array(ze);if(o.translate(Vd,Vd,[jh>.5?jh-1:jh,Sd>.5?Sd-1:Sd,0]),this.alignedProjMatrix=Vd,ze=o.invert(new Float64Array(16),this.pixelMatrix),!ze)throw new Error("failed to invert matrix");this.pixelMatrixInverse=ze,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const g=this.pointCoordinate(new o.pointGeometry(0,0)),A=[g.x*this.worldSize,g.y*this.worldSize,0,1];return o.transformMat4(A,A,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const g=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,g))}getCameraQueryGeometry(g){const A=this.getCameraPoint();if(g.length===1)return[g[0],A];{let q=A.x,ze=A.y,Ft=A.x,Gn=A.y;for(const ls of g)q=Math.min(q,ls.x),ze=Math.min(ze,ls.y),Ft=Math.max(Ft,ls.x),Gn=Math.max(Gn,ls.y);return[new o.pointGeometry(q,ze),new o.pointGeometry(Ft,ze),new o.pointGeometry(Ft,Gn),new o.pointGeometry(q,Gn),new o.pointGeometry(q,ze)]}}}class A_{constructor(g){this._hashName=g&&encodeURIComponent(g),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(A,q){let ze=!1,Ft=null;const Gn=()=>{Ft=null,ze&&(A(),Ft=setTimeout(Gn,300),ze=!1)};return()=>(ze=!0,Ft||Gn(),Ft)}(this._updateHashUnthrottled.bind(this))}addTo(g){return this._map=g,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(g){const A=this._map.getCenter(),q=Math.round(100*this._map.getZoom())/100,ze=Math.ceil((q*Math.LN2+Math.log(512/360/.5))/Math.LN10),Ft=Math.pow(10,ze),Gn=Math.round(A.lng*Ft)/Ft,ls=Math.round(A.lat*Ft)/Ft,$s=this._map.getBearing(),ol=this._map.getPitch();let nh="";if(nh+=g?`/${Gn}/${ls}/${q}`:`${q}/${ls}/${Gn}`,($s||ol)&&(nh+="/"+Math.round(10*$s)/10),ol&&(nh+=`/${Math.round(ol)}`),this._hashName){const ih=this._hashName;let ph=!1;const Lh=window.location.hash.slice(1).split("&").map(Bh=>{const Ch=Bh.split("=")[0];return Ch===ih?(ph=!0,`${Ch}=${nh}`):Bh}).filter(Bh=>Bh);return ph||Lh.push(`${ih}=${nh}`),`#${Lh.join("&")}`}return`#${nh}`}_getCurrentHash(){const g=window.location.hash.replace("#","");if(this._hashName){let A;return g.split("&").map(q=>q.split("=")).forEach(q=>{q[0]===this._hashName&&(A=q)}),(A&&A[1]||"").split("/")}return g.split("/")}_onHashChange(){const g=this._getCurrentHash();if(g.length>=3&&!g.some(A=>isNaN(A))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:A,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}}}const ap={linearity:.3,easing:o.bezier(0,0,.3,1)},Zy=o.extend({deceleration:2500,maxSpeed:1400},ap),vy=o.extend({deceleration:20,maxSpeed:1400},ap),B0=o.extend({deceleration:1e3,maxSpeed:360},ap),g0=o.extend({deceleration:1e3,maxSpeed:90},ap);class ov{constructor(g){this._map=g,this.clear()}clear(){this._inertiaBuffer=[]}record(g){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:g})}_drainInertiaBuffer(){const g=this._inertiaBuffer,A=o.exported.now();for(;g.length>0&&A-g[0].time>160;)g.shift()}_onMoveEnd(g){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const A={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:Ft}of this._inertiaBuffer)A.zoom+=Ft.zoomDelta||0,A.bearing+=Ft.bearingDelta||0,A.pitch+=Ft.pitchDelta||0,Ft.panDelta&&A.pan._add(Ft.panDelta),Ft.around&&(A.around=Ft.around),Ft.pinchAround&&(A.pinchAround=Ft.pinchAround);const q=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ze={};if(A.pan.mag()){const Ft=Cm(A.pan.mag(),q,o.extend({},Zy,g||{}));ze.offset=A.pan.mult(Ft.amount/A.pan.mag()),ze.center=this._map.transform.center,_0(ze,Ft)}if(A.zoom){const Ft=Cm(A.zoom,q,vy);ze.zoom=this._map.transform.zoom+Ft.amount,_0(ze,Ft)}if(A.bearing){const Ft=Cm(A.bearing,q,B0);ze.bearing=this._map.transform.bearing+o.clamp(Ft.amount,-179,179),_0(ze,Ft)}if(A.pitch){const Ft=Cm(A.pitch,q,g0);ze.pitch=this._map.transform.pitch+Ft.amount,_0(ze,Ft)}if(ze.zoom||ze.bearing){const Ft=A.pinchAround===void 0?A.around:A.pinchAround;ze.around=Ft?this._map.unproject(Ft):this._map.getCenter()}return this.clear(),o.extend(ze,{noMoveStart:!0})}}function _0(Y,g){(!Y.duration||Y.duration<g.duration)&&(Y.duration=g.duration,Y.easing=g.easing)}function Cm(Y,g,A){const{maxSpeed:q,linearity:ze,deceleration:Ft}=A,Gn=o.clamp(Y*ze/(g/1e3),-q,q),ls=Math.abs(Gn)/(Ft*ze);return{easing:A.easing,duration:1e3*ls,amount:Gn*(ls/2)}}class sm extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q,ze={}){const Ft=_e.mousePos(A.getCanvasContainer(),q),Gn=A.unproject(Ft);super(g,o.extend({point:Ft,lngLat:Gn,originalEvent:q},ze)),this._defaultPrevented=!1,this.target=A}}class P_ extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q){const ze=g==="touchend"?q.changedTouches:q.touches,Ft=_e.touchPos(A.getCanvasContainer(),ze),Gn=Ft.map($s=>A.unproject($s)),ls=Ft.reduce(($s,ol,nh,ih)=>$s.add(ol.div(ih.length)),new o.pointGeometry(0,0));super(g,{points:Ft,point:ls,lngLats:Gn,lngLat:A.unproject(ls),originalEvent:q}),this._defaultPrevented=!1}}class Ng extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q){super(g,{originalEvent:q}),this._defaultPrevented=!1}}class W_{constructor(g,A){this._map=g,this._clickTolerance=A.clickTolerance}reset(){delete this._mousedownPos}wheel(g){return this._firePreventable(new Ng(g.type,this._map,g))}mousedown(g,A){return this._mousedownPos=A,this._firePreventable(new sm(g.type,this._map,g))}mouseup(g){this._map.fire(new sm(g.type,this._map,g))}click(g,A){this._mousedownPos&&this._mousedownPos.dist(A)>=this._clickTolerance||this._map.fire(new sm(g.type,this._map,g))}dblclick(g){return this._firePreventable(new sm(g.type,this._map,g))}mouseover(g){this._map.fire(new sm(g.type,this._map,g))}mouseout(g){this._map.fire(new sm(g.type,this._map,g))}touchstart(g){return this._firePreventable(new P_(g.type,this._map,g))}touchmove(g){this._map.fire(new P_(g.type,this._map,g))}touchend(g){this._map.fire(new P_(g.type,this._map,g))}touchcancel(g){this._map.fire(new P_(g.type,this._map,g))}_firePreventable(g){if(this._map.fire(g),g.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dg{constructor(g){this._map=g}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(g){this._map.fire(new sm(g.type,this._map,g))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sm("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(g){this._delayContextMenu?this._contextMenuEvent=g:this._ignoreContextMenu||this._map.fire(new sm(g.type,this._map,g)),this._map.listens("contextmenu")&&g.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gm{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._container=g.getContainer(),this._clickTolerance=A.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(g,A){this.isEnabled()&&g.shiftKey&&g.button===0&&(_e.disableDrag(),this._startPos=this._lastPos=A,this._active=!0)}mousemoveWindow(g,A){if(!this._active)return;const q=A;if(this._lastPos.equals(q)||!this._box&&q.dist(this._startPos)<this._clickTolerance)return;const ze=this._startPos;this._lastPos=q,this._box||(this._box=_e.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",g));const Ft=Math.min(ze.x,q.x),Gn=Math.max(ze.x,q.x),ls=Math.min(ze.y,q.y),$s=Math.max(ze.y,q.y);_e.setTransform(this._box,`translate(${Ft}px,${ls}px)`),this._box.style.width=Gn-Ft+"px",this._box.style.height=$s-ls+"px"}mouseupWindow(g,A){if(!this._active||g.button!==0)return;const q=this._startPos,ze=A;if(this.reset(),_e.suppressClick(),q.x!==ze.x||q.y!==ze.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:g})),{cameraAnimation:Ft=>Ft.fitScreenCoordinates(q,ze,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",g)}keydown(g){this._active&&g.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",g))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_e.remove(this._box),this._box=null),_e.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(g,A){return this._map.fire(new o.Event(g,{originalEvent:A}))}}function ag(Y,g){if(Y.length!==g.length)throw new Error(`The number of touches and points are not equal - touches ${Y.length}, points ${g.length}`);const A={};for(let q=0;q<Y.length;q++)A[Y[q].identifier]=g[q];return A}class Jg{constructor(g){this.reset(),this.numTouches=g.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(g,A,q){(this.centroid||q.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=g.timeStamp),q.length===this.numTouches&&(this.centroid=function(ze){const Ft=new o.pointGeometry(0,0);for(const Gn of ze)Ft._add(Gn);return Ft.div(ze.length)}(A),this.touches=ag(q,A)))}touchmove(g,A,q){if(this.aborted||!this.centroid)return;const ze=ag(q,A);for(const Ft in this.touches){const Gn=ze[Ft];(!Gn||Gn.dist(this.touches[Ft])>30)&&(this.aborted=!0)}}touchend(g,A,q){if((!this.centroid||g.timeStamp-this.startTime>500)&&(this.aborted=!0),q.length===0){const ze=!this.aborted&&this.centroid;if(this.reset(),ze)return ze}}}class k_{constructor(g){this.singleTap=new Jg(g),this.numTaps=g.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(g,A,q){this.singleTap.touchstart(g,A,q)}touchmove(g,A,q){this.singleTap.touchmove(g,A,q)}touchend(g,A,q){const ze=this.singleTap.touchend(g,A,q);if(ze){const Ft=g.timeStamp-this.lastTime<500,Gn=!this.lastTap||this.lastTap.dist(ze)<30;if(Ft&&Gn||this.reset(),this.count++,this.lastTime=g.timeStamp,this.lastTap=ze,this.count===this.numTaps)return this.reset(),ze}}}class em{constructor(){this._zoomIn=new k_({numTouches:1,numTaps:2}),this._zoomOut=new k_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(g,A,q){this._zoomIn.touchstart(g,A,q),this._zoomOut.touchstart(g,A,q)}touchmove(g,A,q){this._zoomIn.touchmove(g,A,q),this._zoomOut.touchmove(g,A,q)}touchend(g,A,q){const ze=this._zoomIn.touchend(g,A,q),Ft=this._zoomOut.touchend(g,A,q);return ze?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Gn=>Gn.easeTo({duration:300,zoom:Gn.getZoom()+1,around:Gn.unproject(ze)},{originalEvent:g})}):Ft?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Gn=>Gn.easeTo({duration:300,zoom:Gn.getZoom()-1,around:Gn.unproject(Ft)},{originalEvent:g})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gg{constructor(g){this._enabled=!!g.enable,this._moveStateManager=g.moveStateManager,this._clickTolerance=g.clickTolerance||1,this._moveFunction=g.move,this._activateOnStart=!!g.activateOnStart,g.assignEvents(this),this.reset()}reset(g){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(g)}_move(...g){const A=this._moveFunction(...g);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(g,A){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(g)&&(this._moveStateManager.startMove(g),this._lastPoint=A.length?A[0]:A,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(g,A){if(!this.isEnabled())return;const q=this._lastPoint;if(!q)return;if(g.preventDefault(),!this._moveStateManager.isValidMoveEvent(g))return void this.reset(g);const ze=A.length?A[0]:A;return!this._moved&&ze.dist(q)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=ze,this._move(q,ze))}dragEnd(g){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(g)&&(this._moved&&_e.suppressClick(),this.reset(g))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bv={0:1,2:2};class Ig{constructor(g){this._correctEvent=g.checkCorrectEvent}startMove(g){const A=_e.mouseButton(g);this._eventButton=A}endMove(g){delete this._eventButton}isValidStartEvent(g){return this._correctEvent(g)}isValidMoveEvent(g){return!function(A,q){const ze=bv[q];return A.buttons===void 0||(A.buttons&ze)!==ze}(g,this._eventButton)}isValidEndEvent(g){return _e.mouseButton(g)===this._eventButton}}class Mm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(g){return g.targetTouches.length===1}_isSameTouchEvent(g){return g.targetTouches[0].identifier===this._firstTouch}startMove(g){this._firstTouch=g.targetTouches[0].identifier}endMove(g){delete this._firstTouch}isValidStartEvent(g){return this._isOneFingerTouch(g)}isValidMoveEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}isValidEndEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}}const D_=Y=>{Y.mousedown=Y.dragStart,Y.mousemoveWindow=Y.dragMove,Y.mouseup=Y.dragEnd,Y.contextmenu=function(g){g.preventDefault()}},xy=({enable:Y,clickTolerance:g,bearingDegreesPerPixelMoved:A=.8})=>{const q=new Ig({checkCorrectEvent:ze=>_e.mouseButton(ze)===0&&ze.ctrlKey||_e.mouseButton(ze)===2});return new Gg({clickTolerance:g,move:(ze,Ft)=>({bearingDelta:(Ft.x-ze.x)*A}),moveStateManager:q,enable:Y,assignEvents:D_})},Hy=({enable:Y,clickTolerance:g,pitchDegreesPerPixelMoved:A=-.5})=>{const q=new Ig({checkCorrectEvent:ze=>_e.mouseButton(ze)===0&&ze.ctrlKey||_e.mouseButton(ze)===2});return new Gg({clickTolerance:g,move:(ze,Ft)=>({pitchDelta:(Ft.y-ze.y)*A}),moveStateManager:q,enable:Y,assignEvents:D_})};class y0{constructor(g,A){this._minTouches=g.cooperativeGestures?2:1,this._clickTolerance=g.clickTolerance||1,this._map=A,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(g,A,q){return this._calculateTransform(g,A,q)}touchmove(g,A,q){if(this._map._cooperativeGestures&&(this._minTouches===2&&q.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(g,!1,q.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(q.length<this._minTouches))return g.preventDefault(),this._calculateTransform(g,A,q)}touchend(g,A,q){this._calculateTransform(g,A,q),this._active&&q.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(g,A,q){q.length>0&&(this._active=!0);const ze=ag(q,A),Ft=new o.pointGeometry(0,0),Gn=new o.pointGeometry(0,0);let ls=0;for(const ol in ze){const nh=ze[ol],ih=this._touches[ol];ih&&(Ft._add(nh),Gn._add(nh.sub(ih)),ls++,ze[ol]=nh)}if(this._touches=ze,ls<this._minTouches||!Gn.mag())return;const $s=Gn.div(ls);return this._sum._add($s),this._sum.mag()<this._clickTolerance?void 0:{around:Ft.div(ls),panDelta:$s}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Y_{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(g){}_move(g,A,q){return{}}touchstart(g,A,q){this._firstTwoTouches||q.length<2||(this._firstTwoTouches=[q[0].identifier,q[1].identifier],this._start([A[0],A[1]]))}touchmove(g,A,q){if(!this._firstTwoTouches)return;g.preventDefault();const[ze,Ft]=this._firstTwoTouches,Gn=Xy(q,A,ze),ls=Xy(q,A,Ft);if(!Gn||!ls)return;const $s=this._aroundCenter?null:Gn.add(ls).div(2);return this._move([Gn,ls],$s,g)}touchend(g,A,q){if(!this._firstTwoTouches)return;const[ze,Ft]=this._firstTwoTouches,Gn=Xy(q,A,ze),ls=Xy(q,A,Ft);Gn&&ls||(this._active&&_e.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(g){this._enabled=!0,this._aroundCenter=!!g&&g.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xy(Y,g,A){for(let q=0;q<Y.length;q++)if(Y[q].identifier===A)return g[q]}function e_(Y,g){return Math.log(Y/g)/Math.LN2}class z0 extends Y_{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(g){this._startDistance=this._distance=g[0].dist(g[1])}_move(g,A){const q=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(e_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:e_(this._distance,q),pinchAround:A}}}function kp(Y,g){return 180*Y.angleWith(g)/Math.PI}class Up extends Y_{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])}_move(g,A){const q=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:kp(this._vector,q),pinchAround:A}}_isBelowThreshold(g){this._minDiameter=Math.min(this._minDiameter,g.mag());const A=25/(Math.PI*this._minDiameter)*360,q=kp(g,this._startVector);return Math.abs(q)<A}}function by(Y){return Math.abs(Y.y)>Math.abs(Y.x)}class N0 extends Y_{constructor(g){super(),this._map=g}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(g,A,q){super.touchstart(g,A,q),this._currentTouchCount=q.length}_start(g){this._lastPoints=g,by(g[0].sub(g[1]))&&(this._valid=!1)}_move(g,A,q){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const ze=g[0].sub(this._lastPoints[0]),Ft=g[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(ze,Ft,q.timeStamp),this._valid?(this._lastPoints=g,this._active=!0,{pitchDelta:(ze.y+Ft.y)/2*-.5}):void 0}gestureBeginsVertically(g,A,q){if(this._valid!==void 0)return this._valid;const ze=g.mag()>=2,Ft=A.mag()>=2;if(!ze&&!Ft)return;if(!ze||!Ft)return this._firstMove===void 0&&(this._firstMove=q),q-this._firstMove<100&&void 0;const Gn=g.y>0==A.y>0;return by(g)&&by(A)&&Gn}}const pp={panStep:100,bearingStep:15,pitchStep:10};class tg{constructor(){const g=pp;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(g){if(g.altKey||g.ctrlKey||g.metaKey)return;let A=0,q=0,ze=0,Ft=0,Gn=0;switch(g.keyCode){case 61:case 107:case 171:case 187:A=1;break;case 189:case 109:case 173:A=-1;break;case 37:g.shiftKey?q=-1:(g.preventDefault(),Ft=-1);break;case 39:g.shiftKey?q=1:(g.preventDefault(),Ft=1);break;case 38:g.shiftKey?ze=1:(g.preventDefault(),Gn=-1);break;case 40:g.shiftKey?ze=-1:(g.preventDefault(),Gn=1);break;default:return}return this._rotationDisabled&&(q=0,ze=0),{cameraAnimation:ls=>{const $s=ls.getZoom();ls.easeTo({duration:300,easeId:"keyboardHandler",easing:wv,zoom:A?Math.round($s)+A*(g.shiftKey?2:1):$s,bearing:ls.getBearing()+q*this._bearingStep,pitch:ls.getPitch()+ze*this._pitchStep,offset:[-Ft*this._panStep,-Gn*this._panStep],center:ls.getCenter()},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wv(Y){return Y*(2-Y)}const L_=4.000244140625;class Ev{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._handler=A,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(g){this._defaultZoomRate=g}setWheelZoomRate(g){this._wheelZoomRate=g}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(g){this.isEnabled()||(this._enabled=!0,this._aroundCenter=g&&g.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(g){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;g.preventDefault()}let A=g.deltaMode===WheelEvent.DOM_DELTA_LINE?40*g.deltaY:g.deltaY;const q=o.exported.now(),ze=q-(this._lastWheelEventTime||0);this._lastWheelEventTime=q,A!==0&&A%L_==0?this._type="wheel":A!==0&&Math.abs(A)<4?this._type="trackpad":ze>400?(this._type=null,this._lastValue=A,this._timeout=setTimeout(this._onTimeout,40,g)):this._type||(this._type=Math.abs(ze*A)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,A+=this._lastValue)),g.shiftKey&&A&&(A/=4),this._type&&(this._lastWheelEvent=g,this._delta-=A,this._active||this._start(g)),g.preventDefault()}_onTimeout(g){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)}_start(g){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const A=_e.mousePos(this._el,g);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(A)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const g=this._map.transform;if(this._delta!==0){const ls=this._type==="wheel"&&Math.abs(this._delta)>L_?this._wheelZoomRate:this._defaultZoomRate;let $s=2/(1+Math.exp(-Math.abs(this._delta*ls)));this._delta<0&&$s!==0&&($s=1/$s);const ol=typeof this._targetZoom=="number"?g.zoomScale(this._targetZoom):g.scale;this._targetZoom=Math.min(g.maxZoom,Math.max(g.minZoom,g.scaleZoom(ol*$s))),this._type==="wheel"&&(this._startZoom=g.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const A=typeof this._targetZoom=="number"?this._targetZoom:g.zoom,q=this._startZoom,ze=this._easing;let Ft,Gn=!1;if(this._type==="wheel"&&q&&ze){const ls=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),$s=ze(ls);Ft=o.number(q,A,$s),ls<1?this._frameId||(this._frameId=!0):Gn=!0}else Ft=A,Gn=!0;return this._active=!0,Gn&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Gn,zoomDelta:Ft-g.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(g){let A=o.ease;if(this._prevEase){const q=this._prevEase,ze=(o.exported.now()-q.start)/q.duration,Ft=q.easing(ze+.01)-q.easing(ze),Gn=.27/Math.sqrt(Ft*Ft+1e-4)*.01,ls=Math.sqrt(.0729-Gn*Gn);A=o.bezier(Gn,ls,.25,1)}return this._prevEase={start:o.exported.now(),duration:g,easing:A},A}reset(){this._active=!1}}class Wy{constructor(g,A){this._clickZoom=g,this._tapZoom=A}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pg{constructor(){this.reset()}reset(){this._active=!1}dblclick(g,A){return g.preventDefault(),{cameraAnimation:q=>{q.easeTo({duration:300,zoom:q.getZoom()+(g.shiftKey?-1:1),around:q.unproject(A)},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mg{constructor(){this._tap=new k_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(g,A,q){this._swipePoint||(this._tapTime&&g.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?q.length>0&&(this._swipePoint=A[0],this._swipeTouch=q[0].identifier):this._tap.touchstart(g,A,q))}touchmove(g,A,q){if(this._tapTime){if(this._swipePoint){if(q[0].identifier!==this._swipeTouch)return;const ze=A[0],Ft=ze.y-this._swipePoint.y;return this._swipePoint=ze,g.preventDefault(),this._active=!0,{zoomDelta:Ft/128}}}else this._tap.touchmove(g,A,q)}touchend(g,A,q){this._tapTime?this._swipePoint&&q.length===0&&this.reset():this._tap.touchend(g,A,q)&&(this._tapTime=g.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fv{constructor(g,A,q){this._el=g,this._mousePan=A,this._touchPan=q}enable(g){this._inertiaOptions=g||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class v0{constructor(g,A,q){this._pitchWithRotate=g.pitchWithRotate,this._mouseRotate=A,this._mousePitch=q}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class x0{constructor(g,A,q,ze){this._el=g,this._touchZoom=A,this._touchRotate=q,this._tapDragZoom=ze,this._rotationDisabled=!1,this._enabled=!0}enable(g){this._touchZoom.enable(g),this._rotationDisabled||this._touchRotate.enable(g),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wy=Y=>Y.zoom||Y.drag||Y.pitch||Y.rotate;class Lg extends o.Event{}function b0(Y){return Y.panDelta&&Y.panDelta.mag()||Y.zoomDelta||Y.bearingDelta||Y.pitchDelta}class Sv{constructor(g,A){this._map=g,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ov(g),this._bearingSnap=A.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(A),o.bindAll(["handleEvent","handleWindowEvent"],this);const q=this._el;this._listeners=[[q,"touchstart",{passive:!0}],[q,"touchmove",{passive:!1}],[q,"touchend",void 0],[q,"touchcancel",void 0],[q,"mousedown",void 0],[q,"mousemove",void 0],[q,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[q,"mouseover",void 0],[q,"mouseout",void 0],[q,"dblclick",void 0],[q,"click",void 0],[q,"keydown",{capture:!1}],[q,"keyup",void 0],[q,"wheel",{passive:!1}],[q,"contextmenu",void 0],[window,"blur",void 0]];for(const[ze,Ft,Gn]of this._listeners)_e.addEventListener(ze,Ft,ze===document?this.handleWindowEvent:this.handleEvent,Gn)}destroy(){for(const[g,A,q]of this._listeners)_e.removeEventListener(g,A,g===document?this.handleWindowEvent:this.handleEvent,q)}_addDefaultHandlers(g){const A=this._map,q=A.getCanvasContainer();this._add("mapEvent",new W_(A,g));const ze=A.boxZoom=new Gm(A,g);this._add("boxZoom",ze);const Ft=new em,Gn=new pg;A.doubleClickZoom=new Wy(Gn,Ft),this._add("tapZoom",Ft),this._add("clickZoom",Gn);const ls=new mg;this._add("tapDragZoom",ls);const $s=A.touchPitch=new N0(A);this._add("touchPitch",$s);const ol=xy(g),nh=Hy(g);A.dragRotate=new v0(g,ol,nh),this._add("mouseRotate",ol,["mousePitch"]),this._add("mousePitch",nh,["mouseRotate"]);const ih=(({enable:fd,clickTolerance:ud})=>{const jh=new Ig({checkCorrectEvent:Sd=>_e.mouseButton(Sd)===0&&!Sd.ctrlKey});return new Gg({clickTolerance:ud,move:(Sd,Vd)=>({around:Vd,panDelta:Vd.sub(Sd)}),activateOnStart:!0,moveStateManager:jh,enable:fd,assignEvents:D_})})(g),ph=new y0(g,A);A.dragPan=new Fv(q,ih,ph),this._add("mousePan",ih),this._add("touchPan",ph,["touchZoom","touchRotate"]);const Lh=new Up,Bh=new z0;A.touchZoomRotate=new x0(q,Bh,Lh,ls),this._add("touchRotate",Lh,["touchPan","touchZoom"]),this._add("touchZoom",Bh,["touchPan","touchRotate"]);const Ch=A.scrollZoom=new Ev(A,this);this._add("scrollZoom",Ch,["mousePan"]);const Kh=A.keyboard=new tg;this._add("keyboard",Kh),this._add("blockableMapEvent",new Dg(A));for(const fd of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])g.interactive&&g[fd]&&A[fd].enable(g[fd])}_add(g,A,q){this._handlers.push({handlerName:g,handler:A,allowed:q}),this._handlersById[g]=A}stop(g){if(!this._updatingCamera){for(const{handler:A}of this._handlers)A.reset();this._inertia.clear(),this._fireEvents({},{},g),this._changes=[]}}isActive(){for(const{handler:g}of this._handlers)if(g.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wy(this._eventsInProgress)||this.isZooming()}_blockedByActive(g,A,q){for(const ze in g)if(ze!==q&&(!A||A.indexOf(ze)<0))return!0;return!1}handleWindowEvent(g){this.handleEvent(g,`${g.type}Window`)}_getMapTouches(g){const A=[];for(const q of g)this._el.contains(q.target)&&A.push(q);return A}handleEvent(g,A){if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const q=g.type==="renderFrame"?void 0:g,ze={needsRenderFrame:!1},Ft={},Gn={},ls=g.touches,$s=ls?this._getMapTouches(ls):void 0,ol=$s?_e.touchPos(this._el,$s):_e.mousePos(this._el,g);for(const{handlerName:ph,handler:Lh,allowed:Bh}of this._handlers){if(!Lh.isEnabled())continue;let Ch;this._blockedByActive(Gn,Bh,ph)?Lh.reset():Lh[A||g.type]&&(Ch=Lh[A||g.type](g,ol,$s),this.mergeHandlerResult(ze,Ft,Ch,ph,q),Ch&&Ch.needsRenderFrame&&this._triggerRenderFrame()),(Ch||Lh.isActive())&&(Gn[ph]=Lh)}const nh={};for(const ph in this._previousActiveHandlers)Gn[ph]||(nh[ph]=q);this._previousActiveHandlers=Gn,(Object.keys(nh).length||b0(ze))&&(this._changes.push([ze,Ft,nh]),this._triggerRenderFrame()),(Object.keys(Gn).length||b0(ze))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ih}=ze;ih&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ih(this._map))}mergeHandlerResult(g,A,q,ze,Ft){if(!q)return;o.extend(g,q);const Gn={handlerName:ze,originalEvent:q.originalEvent||Ft};q.zoomDelta!==void 0&&(A.zoom=Gn),q.panDelta!==void 0&&(A.drag=Gn),q.pitchDelta!==void 0&&(A.pitch=Gn),q.bearingDelta!==void 0&&(A.rotate=Gn)}_applyChanges(){const g={},A={},q={};for(const[ze,Ft,Gn]of this._changes)ze.panDelta&&(g.panDelta=(g.panDelta||new o.pointGeometry(0,0))._add(ze.panDelta)),ze.zoomDelta&&(g.zoomDelta=(g.zoomDelta||0)+ze.zoomDelta),ze.bearingDelta&&(g.bearingDelta=(g.bearingDelta||0)+ze.bearingDelta),ze.pitchDelta&&(g.pitchDelta=(g.pitchDelta||0)+ze.pitchDelta),ze.around!==void 0&&(g.around=ze.around),ze.pinchAround!==void 0&&(g.pinchAround=ze.pinchAround),ze.noInertia&&(g.noInertia=ze.noInertia),o.extend(A,Ft),o.extend(q,Gn);this._updateMapTransform(g,A,q),this._changes=[]}_updateMapTransform(g,A,q){const ze=this._map,Ft=ze.transform,Gn=ze.terrain;if(!(b0(g)||Gn&&this._terrainMovement))return this._fireEvents(A,q,!0);let{panDelta:ls,zoomDelta:$s,bearingDelta:ol,pitchDelta:nh,around:ih,pinchAround:ph}=g;ph!==void 0&&(ih=ph),ze._stop(!0),ih=ih||ze.transform.centerPoint;const Lh=Ft.pointLocation(ls?ih.sub(ls):ih);ol&&(Ft.bearing+=ol),nh&&(Ft.pitch+=nh),$s&&(Ft.zoom+=$s),Gn?this._terrainMovement||!A.drag&&!A.zoom?A.drag&&this._terrainMovement?Ft.center=Ft.pointLocation(Ft.centerPoint.sub(ls)):Ft.setLocationAtPoint(Lh,ih):(this._terrainMovement=!0,Ft.freezeElevation=!0,Ft.setLocationAtPoint(Lh,ih),this._map.once("moveend",()=>{Ft.freezeElevation=!1,this._terrainMovement=!1,Ft.recalculateZoom(ze.terrain)})):Ft.setLocationAtPoint(Lh,ih),this._map._update(),g.noInertia||this._inertia.record(g),this._fireEvents(A,q,!0)}_fireEvents(g,A,q){const ze=wy(this._eventsInProgress),Ft=wy(g),Gn={};for(const nh in g){const{originalEvent:ih}=g[nh];this._eventsInProgress[nh]||(Gn[`${nh}start`]=ih),this._eventsInProgress[nh]=g[nh]}!ze&&Ft&&this._fireEvent("movestart",Ft.originalEvent);for(const nh in Gn)this._fireEvent(nh,Gn[nh]);Ft&&this._fireEvent("move",Ft.originalEvent);for(const nh in g){const{originalEvent:ih}=g[nh];this._fireEvent(nh,ih)}const ls={};let $s;for(const nh in this._eventsInProgress){const{handlerName:ih,originalEvent:ph}=this._eventsInProgress[nh];this._handlersById[ih].isActive()||(delete this._eventsInProgress[nh],$s=A[ih]||ph,ls[`${nh}end`]=$s)}for(const nh in ls)this._fireEvent(nh,ls[nh]);const ol=wy(this._eventsInProgress);if(q&&(ze||Ft)&&!ol){this._updatingCamera=!0;const nh=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ih=ph=>ph!==0&&-this._bearingSnap<ph&&ph<this._bearingSnap;nh?(ih(nh.bearing||this._map.getBearing())&&(nh.bearing=0),nh.freezeElevation=!0,this._map.easeTo(nh,{originalEvent:$s})):(this._map.fire(new o.Event("moveend",{originalEvent:$s})),ih(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(g,A){this._map.fire(new o.Event(g,A?{originalEvent:A}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(g=>{delete this._frameId,this.handleEvent(new Lg("renderFrame",{timeStamp:g})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const $v={extend:(Y,...g)=>o.extend(Y,...g),run(Y){Y()},logToElement(Y,g=!1,A="log"){const q=window.document.getElementById(A);q&&(g&&(q.innerHTML=""),q.innerHTML+=`<br>${Y}`)}};class sv extends o.Evented{constructor(g,A){super(),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=A.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(g,A){return this.jumpTo({center:g},A)}panBy(g,A,q){return g=o.pointGeometry.convert(g).mult(-1),this.panTo(this.transform.center,o.extend({offset:g},A),q)}panTo(g,A,q){return this.easeTo(o.extend({center:g},A),q)}getZoom(){return this.transform.zoom}setZoom(g,A){return this.jumpTo({zoom:g},A),this}zoomTo(g,A,q){return this.easeTo(o.extend({zoom:g},A),q)}zoomIn(g,A){return this.zoomTo(this.getZoom()+1,g,A),this}zoomOut(g,A){return this.zoomTo(this.getZoom()-1,g,A),this}getBearing(){return this.transform.bearing}setBearing(g,A){return this.jumpTo({bearing:g},A),this}getPadding(){return this.transform.padding}setPadding(g,A){return this.jumpTo({padding:g},A),this}rotateTo(g,A,q){return this.easeTo(o.extend({bearing:g},A),q)}resetNorth(g,A){return this.rotateTo(0,o.extend({duration:1e3},g),A),this}resetNorthPitch(g,A){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},g),A),this}snapToNorth(g,A){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,A):this}getPitch(){return this.transform.pitch}setPitch(g,A){return this.jumpTo({pitch:g},A),this}cameraForBounds(g,A){g=o.LngLatBounds.convert(g);const q=A&&A.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),q,A)}_cameraForBoxAndBearing(g,A,q,ze){const Ft={top:0,bottom:0,right:0,left:0};if(typeof(ze=o.extend({padding:Ft,offset:[0,0],maxZoom:this.transform.maxZoom},ze)).padding=="number"){const Vd=ze.padding;ze.padding={top:Vd,bottom:Vd,right:Vd,left:Vd}}ze.padding=o.extend(Ft,ze.padding);const Gn=this.transform,ls=Gn.padding,$s=Gn.project(o.LngLat.convert(g)),ol=Gn.project(o.LngLat.convert(A)),nh=$s.rotate(-q*Math.PI/180),ih=ol.rotate(-q*Math.PI/180),ph=new o.pointGeometry(Math.max(nh.x,ih.x),Math.max(nh.y,ih.y)),Lh=new o.pointGeometry(Math.min(nh.x,ih.x),Math.min(nh.y,ih.y)),Bh=ph.sub(Lh),Ch=(Gn.width-(ls.left+ls.right+ze.padding.left+ze.padding.right))/Bh.x,Kh=(Gn.height-(ls.top+ls.bottom+ze.padding.top+ze.padding.bottom))/Bh.y;if(Kh<0||Ch<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const fd=Math.min(Gn.scaleZoom(Gn.scale*Math.min(Ch,Kh)),ze.maxZoom),ud=o.pointGeometry.convert(ze.offset),jh=new o.pointGeometry((ze.padding.left-ze.padding.right)/2,(ze.padding.top-ze.padding.bottom)/2).rotate(q*Math.PI/180),Sd=ud.add(jh).mult(Gn.scale/Gn.zoomScale(fd));return{center:Gn.unproject($s.add(ol).div(2).sub(Sd)),zoom:fd,bearing:q}}fitBounds(g,A,q){return this._fitInternal(this.cameraForBounds(g,A),A,q)}fitScreenCoordinates(g,A,q,ze,Ft){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(g)),this.transform.pointLocation(o.pointGeometry.convert(A)),q,ze),ze,Ft)}_fitInternal(g,A,q){return g?(delete(A=o.extend(g,A)).padding,A.linear?this.easeTo(A,q):this.flyTo(A,q)):this}jumpTo(g,A){this.stop();const q=this.transform;let ze=!1,Ft=!1,Gn=!1;return"zoom"in g&&q.zoom!==+g.zoom&&(ze=!0,q.zoom=+g.zoom),g.center!==void 0&&(q.center=o.LngLat.convert(g.center)),"bearing"in g&&q.bearing!==+g.bearing&&(Ft=!0,q.bearing=+g.bearing),"pitch"in g&&q.pitch!==+g.pitch&&(Gn=!0,q.pitch=+g.pitch),g.padding==null||q.isPaddingEqual(g.padding)||(q.padding=g.padding),this.fire(new o.Event("movestart",A)).fire(new o.Event("move",A)),ze&&this.fire(new o.Event("zoomstart",A)).fire(new o.Event("zoom",A)).fire(new o.Event("zoomend",A)),Ft&&this.fire(new o.Event("rotatestart",A)).fire(new o.Event("rotate",A)).fire(new o.Event("rotateend",A)),Gn&&this.fire(new o.Event("pitchstart",A)).fire(new o.Event("pitch",A)).fire(new o.Event("pitchend",A)),this.fire(new o.Event("moveend",A))}calculateCameraOptionsFromTo(g,A,q,ze=0){const Ft=o.MercatorCoordinate.fromLngLat(g,A),Gn=o.MercatorCoordinate.fromLngLat(q,ze),ls=Gn.x-Ft.x,$s=Gn.y-Ft.y,ol=Gn.z-Ft.z,nh=Math.hypot(ls,$s,ol);if(nh===0)throw new Error("Can't calculate camera options with same From and To");const ih=Math.hypot(ls,$s),ph=this.transform.scaleZoom(this.transform.cameraToCenterDistance/nh/this.transform.tileSize),Lh=180*Math.atan2(ls,-$s)/Math.PI;let Bh=180*Math.acos(ih/nh)/Math.PI;return Bh=ol<0?90-Bh:90+Bh,{center:Gn.toLngLat(),zoom:ph,pitch:Bh,bearing:Lh}}easeTo(g,A){this._stop(!1,g.easeId),((g=o.extend({offset:[0,0],duration:500,easing:o.ease},g)).animate===!1||!g.essential&&o.exported.prefersReducedMotion)&&(g.duration=0);const q=this.transform,ze=this.getZoom(),Ft=this.getBearing(),Gn=this.getPitch(),ls=this.getPadding(),$s="zoom"in g?+g.zoom:ze,ol="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,nh="pitch"in g?+g.pitch:Gn,ih="padding"in g?g.padding:q.padding,ph=o.pointGeometry.convert(g.offset);let Lh=q.centerPoint.add(ph);const Bh=q.pointLocation(Lh),Ch=o.LngLat.convert(g.center||Bh);this._normalizeCenter(Ch);const Kh=q.project(Bh),fd=q.project(Ch).sub(Kh),ud=q.zoomScale($s-ze);let jh,Sd;g.around&&(jh=o.LngLat.convert(g.around),Sd=q.locationPoint(jh));const Vd={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||$s!==ze,this._rotating=this._rotating||Ft!==ol,this._pitching=this._pitching||nh!==Gn,this._padding=!q.isPaddingEqual(ih),this._easeId=g.easeId,this._prepareEase(A,g.noMoveStart,Vd),this.terrain&&this._prepareElevation(Ch),this._ease(Wd=>{if(this._zooming&&(q.zoom=o.number(ze,$s,Wd)),this._rotating&&(q.bearing=o.number(Ft,ol,Wd)),this._pitching&&(q.pitch=o.number(Gn,nh,Wd)),this._padding&&(q.interpolatePadding(ls,ih,Wd),Lh=q.centerPoint.add(ph)),this.terrain&&!g.freezeElevation&&this._updateElevation(Wd),jh)q.setLocationAtPoint(jh,Sd);else{const Cf=q.zoomScale(q.zoom-ze),Of=$s>ze?Math.min(2,ud):Math.max(.5,ud),L=Math.pow(Of,1-Wd),u=q.unproject(Kh.add(fd.mult(Wd*L)).mult(Cf));q.setLocationAtPoint(q.renderWorldCopies?u.wrap():u,Lh)}this._fireMoveEvents(A)},Wd=>{this.terrain&&this._finalizeElevation(),this._afterEase(A,Wd)},g),this}_prepareEase(g,A,q={}){this._moving=!0,A||q.moving||this.fire(new o.Event("movestart",g)),this._zooming&&!q.zooming&&this.fire(new o.Event("zoomstart",g)),this._rotating&&!q.rotating&&this.fire(new o.Event("rotatestart",g)),this._pitching&&!q.pitching&&this.fire(new o.Event("pitchstart",g))}_prepareElevation(g){this._elevationCenter=g,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(g,this.terrain),this.transform.freezeElevation=!0}_updateElevation(g){const A=this.transform.getElevation(this._elevationCenter,this.terrain);if(g<1&&A!==this._elevationTarget){const q=this._elevationTarget-this._elevationStart;this._elevationStart+=g*(q-(A-(q*g+this._elevationStart))/(1-g)),this._elevationTarget=A}this.transform.elevation=o.number(this._elevationStart,this._elevationTarget,g)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_fireMoveEvents(g){this.fire(new o.Event("move",g)),this._zooming&&this.fire(new o.Event("zoom",g)),this._rotating&&this.fire(new o.Event("rotate",g)),this._pitching&&this.fire(new o.Event("pitch",g))}_afterEase(g,A){if(this._easeId&&A&&this._easeId===A)return;delete this._easeId;const q=this._zooming,ze=this._rotating,Ft=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,q&&this.fire(new o.Event("zoomend",g)),ze&&this.fire(new o.Event("rotateend",g)),Ft&&this.fire(new o.Event("pitchend",g)),this.fire(new o.Event("moveend",g))}flyTo(g,A){if(!g.essential&&o.exported.prefersReducedMotion){const _n=o.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_n,A)}this.stop(),g=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},g);const q=this.transform,ze=this.getZoom(),Ft=this.getBearing(),Gn=this.getPitch(),ls=this.getPadding(),$s="zoom"in g?o.clamp(+g.zoom,q.minZoom,q.maxZoom):ze,ol="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,nh="pitch"in g?+g.pitch:Gn,ih="padding"in g?g.padding:q.padding,ph=q.zoomScale($s-ze),Lh=o.pointGeometry.convert(g.offset);let Bh=q.centerPoint.add(Lh);const Ch=q.pointLocation(Bh),Kh=o.LngLat.convert(g.center||Ch);this._normalizeCenter(Kh);const fd=q.project(Ch),ud=q.project(Kh).sub(fd);let jh=g.curve;const Sd=Math.max(q.width,q.height),Vd=Sd/ph,Wd=ud.mag();if("minZoom"in g){const _n=o.clamp(Math.min(g.minZoom,ze,$s),q.minZoom,q.maxZoom),Bn=Sd/q.zoomScale(_n-ze);jh=Math.sqrt(Bn/Wd*2)}const Cf=jh*jh;function Of(_n){const Bn=(Vd*Vd-Sd*Sd+(_n?-1:1)*Cf*Cf*Wd*Wd)/(2*(_n?Vd:Sd)*Cf*Wd);return Math.log(Math.sqrt(Bn*Bn+1)-Bn)}function L(_n){return(Math.exp(_n)-Math.exp(-_n))/2}function u(_n){return(Math.exp(_n)+Math.exp(-_n))/2}const E=Of(0);let B=function(_n){return u(E)/u(E+jh*_n)},ge=function(_n){return Sd*((u(E)*(L(Bn=E+jh*_n)/u(Bn))-L(E))/Cf)/Wd;var Bn},St=(Of(1)-E)/jh;if(Math.abs(Wd)<1e-6||!isFinite(St)){if(Math.abs(Sd-Vd)<1e-6)return this.easeTo(g,A);const _n=Vd<Sd?-1:1;St=Math.abs(Math.log(Vd/Sd))/jh,ge=function(){return 0},B=function(Bn){return Math.exp(_n*jh*Bn)}}return g.duration="duration"in g?+g.duration:1e3*St/("screenSpeed"in g?+g.screenSpeed/jh:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=Ft!==ol,this._pitching=nh!==Gn,this._padding=!q.isPaddingEqual(ih),this._prepareEase(A,!1),this.terrain&&this._prepareElevation(Kh),this._ease(_n=>{const Bn=_n*St,ss=1/B(Bn);q.zoom=_n===1?$s:ze+q.scaleZoom(ss),this._rotating&&(q.bearing=o.number(Ft,ol,_n)),this._pitching&&(q.pitch=o.number(Gn,nh,_n)),this._padding&&(q.interpolatePadding(ls,ih,_n),Bh=q.centerPoint.add(Lh)),this.terrain&&!g.freezeElevation&&this._updateElevation(_n);const tl=_n===1?Kh:q.unproject(fd.add(ud.mult(ge(Bn))).mult(ss));q.setLocationAtPoint(q.renderWorldCopies?tl.wrap():tl,Bh),this._fireMoveEvents(A)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(A)},g),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(g,A){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const q=this._onEaseEnd;delete this._onEaseEnd,q.call(this,A)}if(!g){const q=this.handlers;q&&q.stop(!1)}return this}_ease(g,A,q){q.animate===!1||q.duration===0?(g(1),A()):(this._easeStart=o.exported.now(),this._easeOptions=q,this._onEaseFrame=g,this._onEaseEnd=A,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const g=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(g,A){g=o.wrap(g,-180,180);const q=Math.abs(g-A);return Math.abs(g-360-A)<q&&(g-=360),Math.abs(g+360-A)<q&&(g+=360),g}_normalizeCenter(g){const A=this.transform;if(!A.renderWorldCopies||A.lngRange)return;const q=g.lng-A.center.lng;g.lng+=q>180?-360:q<-180?360:0}}class av{constructor(g={}){this.options=g,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(g){return this._map=g,this._compact=this.options&&this.options.compact,this._container=_e.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_e.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_e.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_e.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(g,A){const q=this._map._getUIString(`AttributionControl.${A}`);g.title=q,g.setAttribute("aria-label",q)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(g){!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let g=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?g=g.concat(this.options.customAttribution.map(ze=>typeof ze!="string"?"":ze)):typeof this.options.customAttribution=="string"&&g.push(this.options.customAttribution)),this._map.style.stylesheet){const ze=this._map.style.stylesheet;this.styleOwner=ze.owner,this.styleId=ze.id}const A=this._map.style.sourceCaches;for(const ze in A){const Ft=A[ze];if(Ft.used||Ft.usedForTerrain){const Gn=Ft.getSource();Gn.attribution&&g.indexOf(Gn.attribution)<0&&g.push(Gn.attribution)}}g=g.filter(ze=>String(ze).trim()),g.sort((ze,Ft)=>ze.length-Ft.length),g=g.filter((ze,Ft)=>{for(let Gn=Ft+1;Gn<g.length;Gn++)if(g[Gn].indexOf(ze)>=0)return!1;return!0});const q=g.join(" | ");q!==this._attribHTML&&(this._attribHTML=q,g.length?(this._innerContainer.innerHTML=q,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class F0{constructor(g={}){this.options=g,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(g){this._map=g,this._compact=this.options&&this.options.compact,this._container=_e.create("div","maplibregl-ctrl");const A=_e.create("a","maplibregl-ctrl-logo");return A.target="_blank",A.rel="noopener nofollow",A.href="https://maplibre.org/",A.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),A.setAttribute("rel","noopener nofollow"),this._container.appendChild(A),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_e.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const g=this._container.children;if(g.length){const A=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}}}class Uv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(g){const A=++this._id;return this._queue.push({callback:g,id:A,cancelled:!1}),A}remove(g){const A=this._currentlyRunning,q=A?this._queue.concat(A):this._queue;for(const ze of q)if(ze.id===g)return void(ze.cancelled=!0)}run(g=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const A=this._currentlyRunning=this._queue;this._queue=[];for(const q of A)if(!q.cancelled&&(q.callback(g),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const w0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Tv=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Vv extends o.Evented{constructor(g){super(),this.sourceCache=g,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,g.usedForTerrain=!0,g.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(g,A){this.sourceCache.update(g,A),this._renderableTilesKeys=[];const q={};for(const ze of g.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:A}))q[ze.key]=!0,this._renderableTilesKeys.push(ze.key),this._tiles[ze.key]||(ze.posMatrix=new Float64Array(16),o.ortho(ze.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[ze.key]=new ad(ze,this.tileSize));for(const ze in this._tiles)q[ze]||delete this._tiles[ze]}freeRtt(g){for(const A in this._tiles){const q=this._tiles[A];(!g||q.tileID.equals(g)||q.tileID.isChildOf(g)||g.isChildOf(q.tileID))&&(q.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(g=>this.getTileByID(g))}getTileByID(g){return this._tiles[g]}getTerrainCoords(g){const A={};for(const q of this._renderableTilesKeys){const ze=this._tiles[q].tileID;if(ze.canonical.equals(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16),o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),A[q]=Ft}else if(ze.canonical.isChildOf(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Gn=ze.canonical.z-g.canonical.z,ls=ze.canonical.x-(ze.canonical.x>>Gn<<Gn),$s=ze.canonical.y-(ze.canonical.y>>Gn<<Gn),ol=o.EXTENT>>Gn;o.ortho(Ft.posMatrix,0,ol,0,ol,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[-ls*ol,-$s*ol,0]),A[q]=Ft}else if(g.canonical.isChildOf(ze.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Gn=g.canonical.z-ze.canonical.z,ls=g.canonical.x-(g.canonical.x>>Gn<<Gn),$s=g.canonical.y-(g.canonical.y>>Gn<<Gn),ol=o.EXTENT>>Gn;o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[ls*ol,$s*ol,0]),o.scale(Ft.posMatrix,Ft.posMatrix,[1/2**Gn,1/2**Gn,0]),A[q]=Ft}}return A}getSourceTile(g,A){const q=this.sourceCache._source;let ze=g.overscaledZ-this.deltaZoom;if(ze>q.maxzoom&&(ze=q.maxzoom),ze<q.minzoom)return null;this._sourceTileCache[g.key]||(this._sourceTileCache[g.key]=g.scaledTo(ze).key);let Ft=this.sourceCache.getTileByID(this._sourceTileCache[g.key]);if((!Ft||!Ft.dem)&&A)for(;ze>=q.minzoom&&(!Ft||!Ft.dem);)Ft=this.sourceCache.getTileByID(g.scaledTo(ze--).key);return Ft}tilesAfterTime(g=Date.now()){return Object.values(this._tiles).filter(A=>A.timeAdded>=g)}}class $0{constructor(g,A,q){this.painter=g,this.sourceCache=new Vv(A),this.options=q,this.exaggeration=typeof q.exaggeration=="number"?q.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(g,A,q,ze=o.EXTENT){if(!(A>=0&&A<ze&&q>=0&&q<ze))return 0;let Ft=0;const Gn=this.getTerrainData(g);if(Gn.tile&&Gn.tile.dem){const ls=function(Bh,Ch,Kh){var fd=Ch[0],ud=Ch[1];return Bh[0]=Kh[0]*fd+Kh[4]*ud+Kh[12],Bh[1]=Kh[1]*fd+Kh[5]*ud+Kh[13],Bh}([],[A/ze*o.EXTENT,q/ze*o.EXTENT],Gn.u_terrain_matrix),$s=[ls[0]*Gn.tile.dem.dim,ls[1]*Gn.tile.dem.dim],ol=[Math.floor($s[0]),Math.floor($s[1])],nh=Gn.tile.dem.get(ol[0],ol[1]),ih=Gn.tile.dem.get(ol[0],ol[1]+1),ph=Gn.tile.dem.get(ol[0]+1,ol[1]),Lh=Gn.tile.dem.get(ol[0]+1,ol[1]+1);Ft=o.number(o.number(nh,ih,$s[0]-ol[0]),o.number(ph,Lh,$s[0]-ol[0]),$s[1]-ol[1])}return Ft}getElevation(g,A,q,ze=o.EXTENT){return this.getDEMElevation(g,A,q,ze)*this.exaggeration}getTerrainData(g){if(!this._emptyDemTexture){const ze=this.painter.context,Ft=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Dh(ze,Ft,ze.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Dh(ze,new o.RGBAImage({width:1,height:1}),ze.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(ze.gl.NEAREST,ze.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const A=this.sourceCache.getSourceTile(g,!0);if(A&&A.dem&&(!A.demTexture||A.needsTerrainPrepare)){const ze=this.painter.context;A.demTexture=this.painter.getTileTexture(A.dem.stride),A.demTexture?A.demTexture.update(A.dem.getPixels(),{premultiply:!1}):A.demTexture=new Dh(ze,A.dem.getPixels(),ze.gl.RGBA,{premultiply:!1}),A.demTexture.bind(ze.gl.NEAREST,ze.gl.CLAMP_TO_EDGE),A.needsTerrainPrepare=!1}const q=A&&A+A.tileID.key+g.key;if(q&&!this._demMatrixCache[q]){const ze=this.sourceCache.sourceCache._source.maxzoom;let Ft=g.canonical.z-A.tileID.canonical.z;g.overscaledZ>g.canonical.z&&(g.canonical.z>=ze?Ft=g.canonical.z-ze:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Gn=g.canonical.x-(g.canonical.x>>Ft<<Ft),ls=g.canonical.y-(g.canonical.y>>Ft<<Ft),$s=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<Ft),1/(o.EXTENT<<Ft),0]);o.translate($s,$s,[Gn*o.EXTENT,ls*o.EXTENT,0]),this._demMatrixCache[g.key]={matrix:$s,coord:g}}return{u_depth:2,u_terrain:3,u_terrain_dim:A&&A.dem&&A.dem.dim||1,u_terrain_matrix:q?this._demMatrixCache[g.key].matrix:this._emptyDemMatrix,u_terrain_unpack:A&&A.dem&&A.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(A&&A.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:A}}getFramebuffer(g){const A=this.painter,q=A.width/devicePixelRatio,ze=A.height/devicePixelRatio;return!this._fbo||this._fbo.width===q&&this._fbo.height===ze||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Dh(A.context,{width:q,height:ze,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Dh(A.context,{width:q,height:ze,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=A.context.createFramebuffer(q,ze,!0),this._fbo.depthAttachment.set(A.context.createRenderbuffer(A.context.gl.DEPTH_COMPONENT16,q,ze))),this._fbo.colorAttachment.set(g==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const g=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const A=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let Ft=0,Gn=0;Ft<this._coordsTextureSize;Ft++)for(let ls=0;ls<this._coordsTextureSize;ls++,Gn+=4)A[Gn+0]=255&ls,A[Gn+1]=255&Ft,A[Gn+2]=ls>>8<<4|Ft>>8,A[Gn+3]=0;const q=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(A.buffer)),ze=new Dh(g,q,g.gl.RGBA,{premultiply:!1});return ze.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._coordsTexture=ze,ze}pointCoordinate(g){const A=new Uint8Array(4),q=this.painter.context,ze=q.gl;q.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),ze.readPixels(g.x,this.painter.height/devicePixelRatio-g.y-1,1,1,ze.RGBA,ze.UNSIGNED_BYTE,A),q.bindFramebuffer.set(null);const Ft=A[0]+(A[2]>>4<<8),Gn=A[1]+((15&A[2])<<8),ls=this.coordsIndex[255-A[3]],$s=ls&&this.sourceCache.getTileByID(ls);if(!$s)return null;const ol=this._coordsTextureSize,nh=(1<<$s.tileID.canonical.z)*ol;return new o.MercatorCoordinate(($s.tileID.canonical.x*ol+Ft)/nh,($s.tileID.canonical.y*ol+Gn)/nh,this.getElevation($s.tileID,Ft,Gn,ol))}getTerrainMesh(){if(this._mesh)return this._mesh;const g=this.painter.context,A=new o.Pos3dArray,q=new o.TriangleIndexArray,ze=this.meshSize,Ft=o.EXTENT/ze,Gn=ze*ze;for(let ih=0;ih<=ze;ih++)for(let ph=0;ph<=ze;ph++)A.emplaceBack(ph*Ft,ih*Ft,0);for(let ih=0;ih<Gn;ih+=ze+1)for(let ph=0;ph<ze;ph++)q.emplaceBack(ph+ih,ze+ph+ih+1,ze+ph+ih+2),q.emplaceBack(ph+ih,ze+ph+ih+2,ph+ih+1);const ls=A.length,$s=ls+2*(ze+1);for(const ih of[0,1])for(let ph=0;ph<=ze;ph++)for(const Lh of[0,1])A.emplaceBack(ph*Ft,ih*o.EXTENT,Lh);for(let ih=0;ih<2*ze;ih+=2)q.emplaceBack($s+ih,$s+ih+1,$s+ih+3),q.emplaceBack($s+ih,$s+ih+3,$s+ih+2),q.emplaceBack(ls+ih,ls+ih+3,ls+ih+1),q.emplaceBack(ls+ih,ls+ih+2,ls+ih+3);const ol=A.length,nh=ol+2*(ze+1);for(const ih of[0,1])for(let ph=0;ph<=ze;ph++)for(const Lh of[0,1])A.emplaceBack(ih*o.EXTENT,ph*Ft,Lh);for(let ih=0;ih<2*ze;ih+=2)q.emplaceBack(ol+ih,ol+ih+1,ol+ih+3),q.emplaceBack(ol+ih,ol+ih+3,ol+ih+2),q.emplaceBack(nh+ih,nh+ih+3,nh+ih+1),q.emplaceBack(nh+ih,nh+ih+2,nh+ih+3);return this._mesh={indexBuffer:g.createIndexBuffer(q),vertexBuffer:g.createVertexBuffer(A,Tv.members),segments:o.SegmentVector.simpleSegment(0,0,A.length,q.length)},this._mesh}getMeshFrameDelta(g){return 2*Math.PI*o.earthRadius/Math.pow(2,g)/5}getMinMaxElevation(g){const A=this.getTerrainData(g).tile,q={minElevation:null,maxElevation:null};return A&&A.dem&&(q.minElevation=A.dem.min*this.exaggeration,q.maxElevation=A.dem.max*this.exaggeration),q}}class Gv{constructor(g,A,q){this._context=g,this._size=A,this._tileSize=q,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const g of this._objects)g.texture.destroy(),g.fbo.destroy()}_createObject(g){const A=this._context.createFramebuffer(this._tileSize,this._tileSize,!0),q=new Dh(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return q.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),A.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_COMPONENT16,this._tileSize,this._tileSize)),A.colorAttachment.set(q.texture),{id:g,fbo:A,texture:q,stamp:-1,inUse:!1}}getObjectForId(g){return this._objects[g]}useObject(g){g.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(A=>g.id!==A),this._recentlyUsed.push(g.id)}stampObject(g){g.stamp=++this._stamp}getOrCreateFreeObject(){for(const A of this._recentlyUsed)if(!this._objects[A].inUse)return this._objects[A];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const g=this._createObject(this._objects.length);return this._objects.push(g),g}freeObject(g){g.inUse=!1}freeAllObjects(){for(const g of this._objects)this.freeObject(g)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(g=>!g.inUse)===!1}}const Ey={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class lv{constructor(g,A){this.painter=g,this.terrain=A,this.pool=new Gv(g.context,30,A.sourceCache.tileSize*A.qualityFactor)}destruct(){this.pool.destruct()}getTexture(g){return this.pool.getObjectForId(g.rtt[this._stacks.length-1].id).texture}prepareForRender(g,A){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=g._order.filter(q=>!g._layers[q].isHidden(A)),this._coordsDescendingInv={};for(const q in g.sourceCaches){this._coordsDescendingInv[q]={};const ze=g.sourceCaches[q].getVisibleCoordinates();for(const Ft of ze){const Gn=this.terrain.sourceCache.getTerrainCoords(Ft);for(const ls in Gn)this._coordsDescendingInv[q][ls]||(this._coordsDescendingInv[q][ls]=[]),this._coordsDescendingInv[q][ls].push(Gn[ls])}}this._coordsDescendingInvStr={};for(const q of g._order){const ze=g._layers[q],Ft=ze.source;if(Ey[ze.type]&&!this._coordsDescendingInvStr[Ft]){this._coordsDescendingInvStr[Ft]={};for(const Gn in this._coordsDescendingInv[Ft])this._coordsDescendingInvStr[Ft][Gn]=this._coordsDescendingInv[Ft][Gn].map(ls=>ls.key).sort().join()}}for(const q of this._renderableTiles)for(const ze in this._coordsDescendingInvStr){const Ft=this._coordsDescendingInvStr[ze][q.tileID.key];Ft&&Ft!==q.rttCoords[ze]&&(q.rtt=[])}}renderLayer(g){if(g.isHidden(this.painter.transform.zoom))return!1;const A=g.type,q=this.painter,ze=this._renderableLayerIds[this._renderableLayerIds.length-1]===g.id;if(Ey[A]&&(this._prevType&&Ey[this._prevType]||this._stacks.push([]),this._prevType=A,this._stacks[this._stacks.length-1].push(g.id),!ze))return!0;if(Ey[this._prevType]||Ey[A]&&ze){this._prevType=A;const Ft=this._stacks.length-1,Gn=this._stacks[Ft]||[];for(const ls of this._renderableTiles){if(this.pool.isFull()&&(og(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ls),ls.rtt[Ft]){const ol=this.pool.getObjectForId(ls.rtt[Ft].id);if(ol.stamp===ls.rtt[Ft].stamp){this.pool.useObject(ol);continue}}const $s=this.pool.getOrCreateFreeObject();this.pool.useObject($s),this.pool.stampObject($s),ls.rtt[Ft]={id:$s.id,stamp:$s.stamp},q.context.bindFramebuffer.set($s.fbo.framebuffer),q.context.clear({color:o.Color.transparent});for(let ol=0;ol<Gn.length;ol++){const nh=q.style._layers[Gn[ol]],ih=nh.source?this._coordsDescendingInv[nh.source][ls.tileID.key]:[ls.tileID];q.context.viewport.set([0,0,$s.fbo.width,$s.fbo.height]),q._renderTileClippingMasks(nh,ih),q.renderLayer(q,q.style.sourceCaches[nh.source],nh,ih),nh.source&&(ls.rttCoords[nh.source]=this._coordsDescendingInvStr[nh.source][ls.tileID.key])}}return og(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ey[A]}return!1}}const E0=he,cv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},S0=Y=>{Y.touchstart=Y.dragStart,Y.touchmoveWindow=Y.dragMove,Y.touchend=Y.dragEnd},jv={showCompass:!0,showZoom:!0,visualizePitch:!1};class c1{constructor(g,A,q=!1){this._clickTolerance=10;const ze=g.dragRotate._mouseRotate.getClickTolerance(),Ft=g.dragRotate._mousePitch.getClickTolerance();this.element=A,this.mouseRotate=xy({clickTolerance:ze,enable:!0}),this.touchRotate=(({enable:Gn,clickTolerance:ls,bearingDegreesPerPixelMoved:$s=.8})=>{const ol=new Mm;return new Gg({clickTolerance:ls,move:(nh,ih)=>({bearingDelta:(ih.x-nh.x)*$s}),moveStateManager:ol,enable:Gn,assignEvents:S0})})({clickTolerance:ze,enable:!0}),this.map=g,q&&(this.mousePitch=Hy({clickTolerance:Ft,enable:!0}),this.touchPitch=(({enable:Gn,clickTolerance:ls,pitchDegreesPerPixelMoved:$s=-.5})=>{const ol=new Mm;return new Gg({clickTolerance:ls,move:(nh,ih)=>({pitchDelta:(ih.y-nh.y)*$s}),moveStateManager:ol,enable:Gn,assignEvents:S0})})({clickTolerance:Ft,enable:!0})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),_e.addEventListener(A,"mousedown",this.mousedown),_e.addEventListener(A,"touchstart",this.touchstart,{passive:!1}),_e.addEventListener(A,"touchcancel",this.reset)}startMouse(g,A){this.mouseRotate.dragStart(g,A),this.mousePitch&&this.mousePitch.dragStart(g,A),_e.disableDrag()}startTouch(g,A){this.touchRotate.dragStart(g,A),this.touchPitch&&this.touchPitch.dragStart(g,A),_e.disableDrag()}moveMouse(g,A){const q=this.map,{bearingDelta:ze}=this.mouseRotate.dragMove(g,A)||{};if(ze&&q.setBearing(q.getBearing()+ze),this.mousePitch){const{pitchDelta:Ft}=this.mousePitch.dragMove(g,A)||{};Ft&&q.setPitch(q.getPitch()+Ft)}}moveTouch(g,A){const q=this.map,{bearingDelta:ze}=this.touchRotate.dragMove(g,A)||{};if(ze&&q.setBearing(q.getBearing()+ze),this.touchPitch){const{pitchDelta:Ft}=this.touchPitch.dragMove(g,A)||{};Ft&&q.setPitch(q.getPitch()+Ft)}}off(){const g=this.element;_e.removeEventListener(g,"mousedown",this.mousedown),_e.removeEventListener(g,"touchstart",this.touchstart,{passive:!1}),_e.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_e.removeEventListener(window,"touchend",this.touchend),_e.removeEventListener(g,"touchcancel",this.reset),this.offTemp()}offTemp(){_e.enableDrag(),_e.removeEventListener(window,"mousemove",this.mousemove),_e.removeEventListener(window,"mouseup",this.mouseup),_e.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_e.removeEventListener(window,"touchend",this.touchend)}mousedown(g){this.startMouse(o.extend({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),_e.mousePos(this.element,g)),_e.addEventListener(window,"mousemove",this.mousemove),_e.addEventListener(window,"mouseup",this.mouseup)}mousemove(g){this.moveMouse(g,_e.mousePos(this.element,g))}mouseup(g){this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()}touchstart(g){g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_e.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),_e.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_e.addEventListener(window,"touchend",this.touchend))}touchmove(g){g.targetTouches.length!==1?this.reset():(this._lastPos=_e.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))}touchend(g){g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Iv(Y,g,A){if(Y=new o.LngLat(Y.lng,Y.lat),g){const q=new o.LngLat(Y.lng-360,Y.lat),ze=new o.LngLat(Y.lng+360,Y.lat),Ft=A.locationPoint(Y).distSqr(g);A.locationPoint(q).distSqr(g)<Ft?Y=q:A.locationPoint(ze).distSqr(g)<Ft&&(Y=ze)}for(;Math.abs(Y.lng-A.center.lng)>180;){const q=A.locationPoint(Y);if(q.x>=0&&q.y>=0&&q.x<=A.width&&q.y<=A.height)break;Y.lng>A.center.lng?Y.lng-=360:Y.lng+=360}return Y}const Mv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function uv(Y,g,A){const q=Y.classList;for(const ze in Mv)q.remove(`maplibregl-${A}-anchor-${ze}`);q.add(`maplibregl-${A}-anchor-${g}`)}class Fg extends o.Evented{constructor(g,A){if(super(),(g instanceof HTMLElement||A)&&(g=o.extend({element:g},A)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=o.pointGeometry.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=_e.create("div"),this._element.setAttribute("aria-label","Map marker");const q=_e.createNS("http://www.w3.org/2000/svg","svg"),ze=41,Ft=27;q.setAttributeNS(null,"display","block"),q.setAttributeNS(null,"height",`${ze}px`),q.setAttributeNS(null,"width",`${Ft}px`),q.setAttributeNS(null,"viewBox",`0 0 ${Ft} ${ze}`);const Gn=_e.createNS("http://www.w3.org/2000/svg","g");Gn.setAttributeNS(null,"stroke","none"),Gn.setAttributeNS(null,"stroke-width","1"),Gn.setAttributeNS(null,"fill","none"),Gn.setAttributeNS(null,"fill-rule","evenodd");const ls=_e.createNS("http://www.w3.org/2000/svg","g");ls.setAttributeNS(null,"fill-rule","nonzero");const $s=_e.createNS("http://www.w3.org/2000/svg","g");$s.setAttributeNS(null,"transform","translate(3.0, 29.0)"),$s.setAttributeNS(null,"fill","#000000");const ol=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ud of ol){const jh=_e.createNS("http://www.w3.org/2000/svg","ellipse");jh.setAttributeNS(null,"opacity","0.04"),jh.setAttributeNS(null,"cx","10.5"),jh.setAttributeNS(null,"cy","5.80029008"),jh.setAttributeNS(null,"rx",ud.rx),jh.setAttributeNS(null,"ry",ud.ry),$s.appendChild(jh)}const nh=_e.createNS("http://www.w3.org/2000/svg","g");nh.setAttributeNS(null,"fill",this._color);const ih=_e.createNS("http://www.w3.org/2000/svg","path");ih.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),nh.appendChild(ih);const ph=_e.createNS("http://www.w3.org/2000/svg","g");ph.setAttributeNS(null,"opacity","0.25"),ph.setAttributeNS(null,"fill","#000000");const Lh=_e.createNS("http://www.w3.org/2000/svg","path");Lh.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ph.appendChild(Lh);const Bh=_e.createNS("http://www.w3.org/2000/svg","g");Bh.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Bh.setAttributeNS(null,"fill","#FFFFFF");const Ch=_e.createNS("http://www.w3.org/2000/svg","g");Ch.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Kh=_e.createNS("http://www.w3.org/2000/svg","circle");Kh.setAttributeNS(null,"fill","#000000"),Kh.setAttributeNS(null,"opacity","0.25"),Kh.setAttributeNS(null,"cx","5.5"),Kh.setAttributeNS(null,"cy","5.5"),Kh.setAttributeNS(null,"r","5.4999962");const fd=_e.createNS("http://www.w3.org/2000/svg","circle");fd.setAttributeNS(null,"fill","#FFFFFF"),fd.setAttributeNS(null,"cx","5.5"),fd.setAttributeNS(null,"cy","5.5"),fd.setAttributeNS(null,"r","5.4999962"),Ch.appendChild(Kh),Ch.appendChild(fd),ls.appendChild($s),ls.appendChild(nh),ls.appendChild(ph),ls.appendChild(Bh),ls.appendChild(Ch),q.appendChild(ls),q.setAttributeNS(null,"height",ze*this._scale+"px"),q.setAttributeNS(null,"width",Ft*this._scale+"px"),this._element.appendChild(q),this._offset=o.pointGeometry.convert(g&&g.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",q=>{q.preventDefault()}),this._element.addEventListener("mousedown",q=>{q.preventDefault()}),uv(this._element,this._anchor,"marker"),this._popup=null}addTo(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_e.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){const ze=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ze,-1*(38.1-13.5+ze)],"bottom-right":[-ze,-1*(38.1-13.5+ze)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(g){const A=g.code,q=g.charCode||g.keyCode;A!=="Space"&&A!=="Enter"&&q!==32&&q!==13||this.togglePopup()}_onMapClick(g){const A=g.originalEvent.target,q=this._element;this._popup&&(A===q||q.contains(A))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this}_update(g){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Iv(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let q="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?q="rotateX(0deg)":this._pitchAlignment==="map"&&(q=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),_e.setTransform(this._element,`${Mv[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${q} ${A}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const ze=this._map.unproject(this._pos),Ft=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=ze.distanceTo(this._lngLat)>20*Ft?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(g){return this._offset=o.pointGeometry.convert(g),this._update(),this}_onMove(g){if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(g){return this._rotation=g||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(g){return this._rotationAlignment=g||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const R1={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let T0,Cv=0,U0=!1;const Sy={maxWidth:100,unit:"metric"};function qv(Y,g,A){const q=A&&A.maxWidth||100,ze=Y._container.clientHeight/2,Ft=Y.unproject([0,ze]),Gn=Y.unproject([q,ze]),ls=Ft.distanceTo(Gn);if(A&&A.unit==="imperial"){const $s=3.2808*ls;$s>5280?Ty(g,q,$s/5280,Y._getUIString("ScaleControl.Miles")):Ty(g,q,$s,Y._getUIString("ScaleControl.Feet"))}else A&&A.unit==="nautical"?Ty(g,q,ls/1852,Y._getUIString("ScaleControl.NauticalMiles")):ls>=1e3?Ty(g,q,ls/1e3,Y._getUIString("ScaleControl.Kilometers")):Ty(g,q,ls,Y._getUIString("ScaleControl.Meters"))}function Ty(Y,g,A,q){const ze=function(Ft){const Gn=Math.pow(10,`${Math.floor(Ft)}`.length-1);let ls=Ft/Gn;return ls=ls>=10?10:ls>=5?5:ls>=3?3:ls>=2?2:ls>=1?1:function($s){const ol=Math.pow(10,Math.ceil(-Math.log($s)/Math.LN10));return Math.round($s*ol)/ol}(ls),Gn*ls}(A);Y.style.width=g*(ze/A)+"px",Y.innerHTML=`${ze}&nbsp;${q}`}const Iy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ip(Y){if(Y){if(typeof Y=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(Y,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,Y),"top-left":new o.pointGeometry(g,g),"top-right":new o.pointGeometry(-g,g),bottom:new o.pointGeometry(0,-Y),"bottom-left":new o.pointGeometry(g,-g),"bottom-right":new o.pointGeometry(-g,-g),left:new o.pointGeometry(Y,0),right:new o.pointGeometry(-Y,0)}}if(Y instanceof o.pointGeometry||Array.isArray(Y)){const g=o.pointGeometry.convert(Y);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}return{center:o.pointGeometry.convert(Y.center||[0,0]),top:o.pointGeometry.convert(Y.top||[0,0]),"top-left":o.pointGeometry.convert(Y["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(Y["top-right"]||[0,0]),bottom:o.pointGeometry.convert(Y.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(Y["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(Y["bottom-right"]||[0,0]),left:o.pointGeometry.convert(Y.left||[0,0]),right:o.pointGeometry.convert(Y.right||[0,0])}}return Ip(new o.pointGeometry(0,0))}const O1=he,K_={supported:x,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends sv{constructor(Y){var g;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(Y=o.extend({},cv,Y)).minZoom!=null&&Y.maxZoom!=null&&Y.minZoom>Y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(Y.minPitch!=null&&Y.maxPitch!=null&&Y.minPitch>Y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(Y.minPitch!=null&&Y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(Y.maxPitch!=null&&Y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fg(Y.minZoom,Y.maxZoom,Y.minPitch,Y.maxPitch,Y.renderWorldCopies),{bearingSnap:Y.bearingSnap}),this._interactive=Y.interactive,this._cooperativeGestures=Y.cooperativeGestures,this._maxTileCacheSize=Y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=Y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=Y.preserveDrawingBuffer,this._antialias=Y.antialias,this._trackResize=Y.trackResize,this._bearingSnap=Y.bearingSnap,this._refreshExpiredTiles=Y.refreshExpiredTiles,this._fadeDuration=Y.fadeDuration,this._crossSourceCollisions=Y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=Y.collectResourceTiming,this._renderTaskQueue=new Uv,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},w0,Y.locale),this._clickTolerance=Y.clickTolerance,this._pixelRatio=(g=Y.pixelRatio)!==null&&g!==void 0?g:devicePixelRatio,this._imageQueueHandle=lh.addThrottleControl(()=>this.isMoving()),this._requestManager=new ch(Y.transformRequest),typeof Y.container=="string"){if(this._container=document.getElementById(Y.container),!this._container)throw new Error(`Container '${Y.container}' not found.`)}else{if(!(Y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=Y.container}Y.maxBounds&&this.setMaxBounds(Y.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sv(this,Y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=Y.hash&&new A_(typeof Y.hash=="string"&&Y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:Y.center,zoom:Y.zoom,bearing:Y.bearing,pitch:Y.pitch}),Y.bounds&&(this.resize(),this.fitBounds(Y.bounds,o.extend({},Y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=Y.localIdeographFontFamily,Y.style&&this.setStyle(Y.style,{localIdeographFontFamily:Y.localIdeographFontFamily}),Y.attributionControl&&this.addControl(new av({customAttribution:Y.customAttribution})),Y.maplibreLogo&&this.addControl(new F0,Y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new o.Event(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new o.Event(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new o.Event("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(Y,g){if(g===void 0&&(g=Y.getDefaultPosition?Y.getDefaultPosition():"top-right"),!Y||!Y.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const A=Y.onAdd(this);this._controls.push(Y);const q=this._controlPositions[g];return g.indexOf("bottom")!==-1?q.insertBefore(A,q.firstChild):q.appendChild(A),this}removeControl(Y){if(!Y||!Y.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const g=this._controls.indexOf(Y);return g>-1&&this._controls.splice(g,1),Y.onRemove(this),this}hasControl(Y){return this._controls.indexOf(Y)>-1}calculateCameraOptionsFromTo(Y,g,A,q){return q==null&&this.terrain&&(q=this.transform.getElevation(A,this.terrain)),super.calculateCameraOptionsFromTo(Y,g,A,q)}resize(Y){const g=this._containerDimensions(),A=g[0],q=g[1];this._resizeCanvas(A,q,this.getPixelRatio()),this.transform.resize(A,q),this.painter.resize(A,q,this.getPixelRatio());const ze=!this._moving;return ze&&(this.stop(),this.fire(new o.Event("movestart",Y)).fire(new o.Event("move",Y))),this.fire(new o.Event("resize",Y)),ze&&this.fire(new o.Event("moveend",Y)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(Y){const[g,A]=this._containerDimensions();this._pixelRatio=Y,this._resizeCanvas(g,A,Y),this.painter.resize(g,A,Y)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(Y){return this.transform.setMaxBounds(o.LngLatBounds.convert(Y)),this._update()}setMinZoom(Y){if((Y=Y??-2)>=-2&&Y<=this.transform.maxZoom)return this.transform.minZoom=Y,this._update(),this.getZoom()<Y&&this.setZoom(Y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(Y){if((Y=Y??22)>=this.transform.minZoom)return this.transform.maxZoom=Y,this._update(),this.getZoom()>Y&&this.setZoom(Y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(Y){if((Y=Y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(Y>=0&&Y<=this.transform.maxPitch)return this.transform.minPitch=Y,this._update(),this.getPitch()<Y&&this.setPitch(Y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(Y){if((Y=Y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(Y>=this.transform.minPitch)return this.transform.maxPitch=Y,this._update(),this.getPitch()>Y&&this.setPitch(Y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(Y){return this.transform.renderWorldCopies=Y,this._update()}project(Y){return this.transform.locationPoint(o.LngLat.convert(Y),this.style&&this.terrain)}unproject(Y){return this.transform.pointLocation(o.pointGeometry.convert(Y),this.terrain)}isMoving(){var Y;return this._moving||((Y=this.handlers)===null||Y===void 0?void 0:Y.isMoving())}isZooming(){var Y;return this._zooming||((Y=this.handlers)===null||Y===void 0?void 0:Y.isZooming())}isRotating(){var Y;return this._rotating||((Y=this.handlers)===null||Y===void 0?void 0:Y.isRotating())}_createDelegatedListener(Y,g,A){if(Y==="mouseenter"||Y==="mouseover"){let q=!1;return{layer:g,listener:A,delegates:{mousemove:Ft=>{const Gn=this.getLayer(g)?this.queryRenderedFeatures(Ft.point,{layers:[g]}):[];Gn.length?q||(q=!0,A.call(this,new sm(Y,this,Ft.originalEvent,{features:Gn}))):q=!1},mouseout:()=>{q=!1}}}}if(Y==="mouseleave"||Y==="mouseout"){let q=!1;return{layer:g,listener:A,delegates:{mousemove:Gn=>{(this.getLayer(g)?this.queryRenderedFeatures(Gn.point,{layers:[g]}):[]).length?q=!0:q&&(q=!1,A.call(this,new sm(Y,this,Gn.originalEvent)))},mouseout:Gn=>{q&&(q=!1,A.call(this,new sm(Y,this,Gn.originalEvent)))}}}}{const q=ze=>{const Ft=this.getLayer(g)?this.queryRenderedFeatures(ze.point,{layers:[g]}):[];Ft.length&&(ze.features=Ft,A.call(this,ze),delete ze.features)};return{layer:g,listener:A,delegates:{[Y]:q}}}}on(Y,g,A){if(A===void 0)return super.on(Y,g);const q=this._createDelegatedListener(Y,g,A);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[Y]=this._delegatedListeners[Y]||[],this._delegatedListeners[Y].push(q);for(const ze in q.delegates)this.on(ze,q.delegates[ze]);return this}once(Y,g,A){if(A===void 0)return super.once(Y,g);const q=this._createDelegatedListener(Y,g,A);for(const ze in q.delegates)this.once(ze,q.delegates[ze]);return this}off(Y,g,A){return A===void 0?super.off(Y,g):(this._delegatedListeners&&this._delegatedListeners[Y]&&(q=>{const ze=this._delegatedListeners[Y];for(let Ft=0;Ft<ze.length;Ft++){const Gn=ze[Ft];if(Gn.layer===g&&Gn.listener===A){for(const ls in Gn.delegates)this.off(ls,Gn.delegates[ls]);return ze.splice(Ft,1),this}}})(),this)}queryRenderedFeatures(Y,g){if(!this.style)return[];let A;const q=Y instanceof o.pointGeometry||Array.isArray(Y),ze=q?Y:[[0,0],[this.transform.width,this.transform.height]];if(g=g||(q?{}:Y)||{},ze instanceof o.pointGeometry||typeof ze[0]=="number")A=[o.pointGeometry.convert(ze)];else{const Ft=o.pointGeometry.convert(ze[0]),Gn=o.pointGeometry.convert(ze[1]);A=[Ft,new o.pointGeometry(Gn.x,Ft.y),Gn,new o.pointGeometry(Ft.x,Gn.y),Ft]}return this.style.queryRenderedFeatures(A,g,this.transform)}querySourceFeatures(Y,g){return this.style.querySourceFeatures(Y,g)}setStyle(Y,g){return(g=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&Y?(this._diffStyle(Y,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(Y,g))}setTransformRequest(Y){return this._requestManager.setTransformRequest(Y),this}_getUIString(Y){const g=this._locale[Y];if(g==null)throw new Error(`Missing UI string '${Y}'`);return g}_updateStyle(Y,g){if(g.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(Y,g));const A=this.style&&g.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!Y)),Y?(this.style=new rd(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof Y=="string"?this.style.loadURL(Y,g,A):this.style.loadJSON(Y,g,A),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new rd(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(Y,g){if(typeof Y=="string"){const A=this._requestManager.transformRequest(Y,Js.Style);o.getJSON(A,(q,ze)=>{q?this.fire(new o.ErrorEvent(q)):ze&&this._updateDiff(ze,g)})}else typeof Y=="object"&&this._updateDiff(Y,g)}_updateDiff(Y,g){try{this.style.setState(Y,g)&&this._update(!0)}catch(A){o.warnOnce(`Unable to perform style diff: ${A.message||A.error||A}.  Rebuilding the style from scratch.`),this._updateStyle(Y,g)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(Y,g){return this._lazyInitEmptyStyle(),this.style.addSource(Y,g),this._update(!0)}isSourceLoaded(Y){const g=this.style&&this.style.sourceCaches[Y];if(g!==void 0)return g.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${Y}'`)))}setTerrain(Y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),Y){const g=this.style.sourceCaches[Y.source];if(!g)throw new Error(`cannot load terrain, because there exists no source with ID: ${Y.source}`);this.terrain=new $0(this.painter,g,Y),this.painter.renderToTexture=new lv(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=A=>{A.dataType==="style"?this.terrain.sourceCache.freeRtt():A.dataType==="source"&&A.tile&&(A.sourceId===Y.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(A.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new o.Event("terrain",{terrain:Y})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const Y=this.style&&this.style.sourceCaches;for(const g in Y){const A=Y[g]._tiles;for(const q in A){const ze=A[q];if(ze.state!=="loaded"&&ze.state!=="errored")return!1}}return!0}addSourceType(Y,g,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(Y,g,A)}removeSource(Y){return this.style.removeSource(Y),this._update(!0)}getSource(Y){return this.style.getSource(Y)}addImage(Y,g,{pixelRatio:A=1,sdf:q=!1,stretchX:ze,stretchY:Ft,content:Gn}={}){if(this._lazyInitEmptyStyle(),g instanceof HTMLImageElement||o.isImageBitmap(g)){const{width:ls,height:$s,data:ol}=o.exported.getImageData(g);this.style.addImage(Y,{data:new o.RGBAImage({width:ls,height:$s},ol),pixelRatio:A,stretchX:ze,stretchY:Ft,content:Gn,sdf:q,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ls,height:$s,data:ol}=g,nh=g;this.style.addImage(Y,{data:new o.RGBAImage({width:ls,height:$s},new Uint8Array(ol)),pixelRatio:A,stretchX:ze,stretchY:Ft,content:Gn,sdf:q,version:0,userImage:nh}),nh.onAdd&&nh.onAdd(this,Y)}}}updateImage(Y,g){const A=this.style.getImage(Y);if(!A)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const q=g instanceof HTMLImageElement||o.isImageBitmap(g)?o.exported.getImageData(g):g,{width:ze,height:Ft,data:Gn}=q;if(ze===void 0||Ft===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ze!==A.data.width||Ft!==A.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const ls=!(g instanceof HTMLImageElement||o.isImageBitmap(g));A.data.replace(Gn,ls),this.style.updateImage(Y,A)}hasImage(Y){return Y?!!this.style.getImage(Y):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(Y){this.style.removeImage(Y)}loadImage(Y,g){lh.getImage(this._requestManager.transformRequest(Y,Js.Image),g)}listImages(){return this.style.listImages()}addLayer(Y,g){return this._lazyInitEmptyStyle(),this.style.addLayer(Y,g),this._update(!0)}moveLayer(Y,g){return this.style.moveLayer(Y,g),this._update(!0)}removeLayer(Y){return this.style.removeLayer(Y),this._update(!0)}getLayer(Y){return this.style.getLayer(Y)}setLayerZoomRange(Y,g,A){return this.style.setLayerZoomRange(Y,g,A),this._update(!0)}setFilter(Y,g,A={}){return this.style.setFilter(Y,g,A),this._update(!0)}getFilter(Y){return this.style.getFilter(Y)}setPaintProperty(Y,g,A,q={}){return this.style.setPaintProperty(Y,g,A,q),this._update(!0)}getPaintProperty(Y,g){return this.style.getPaintProperty(Y,g)}setLayoutProperty(Y,g,A,q={}){return this.style.setLayoutProperty(Y,g,A,q),this._update(!0)}getLayoutProperty(Y,g){return this.style.getLayoutProperty(Y,g)}setGlyphs(Y,g={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(Y,g),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(Y,g,A={}){return this._lazyInitEmptyStyle(),this.style.addSprite(Y,g,A,q=>{q||this._update(!0)}),this}removeSprite(Y){return this._lazyInitEmptyStyle(),this.style.removeSprite(Y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(Y,g={}){return this._lazyInitEmptyStyle(),this.style.setSprite(Y,g,A=>{A||this._update(!0)}),this}setLight(Y,g={}){return this._lazyInitEmptyStyle(),this.style.setLight(Y,g),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(Y,g){return this.style.setFeatureState(Y,g),this._update()}removeFeatureState(Y,g){return this.style.removeFeatureState(Y,g),this._update()}getFeatureState(Y){return this.style.getFeatureState(Y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let Y=0,g=0;return this._container&&(Y=this._container.clientWidth||400,g=this._container.clientHeight||300),[Y,g]}_setupContainer(){const Y=this._container;Y.classList.add("maplibregl-map");const g=this._canvasContainer=_e.create("div","maplibregl-canvas-container",Y);this._interactive&&g.classList.add("maplibregl-interactive"),this._canvas=_e.create("canvas","maplibregl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const A=this._containerDimensions();this._resizeCanvas(A[0],A[1],this.getPixelRatio());const q=this._controlContainer=_e.create("div","maplibregl-control-container",Y),ze=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Ft=>{ze[Ft]=_e.create("div",`maplibregl-ctrl-${Ft} `,q)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const Y=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=_e.create("div","maplibregl-cooperative-gesture-screen",Y);let g="Control",A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",g="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${A}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",q=>{q.key===g&&(this._metaPress=!0)}),document.addEventListener("keyup",q=>{q.key===g&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",q=>{this._onCooperativeGesture(q,this._metaPress,1)},!1),this._canvasContainer.classList.remove("maplibregl-touch-drag-pan")}_resizeCanvas(Y,g,A){this._canvas.width=A*Y,this._canvas.height=A*g,this._canvas.style.width=`${Y}px`,this._canvas.style.height=`${g}px`}_setupPainter(){const Y=o.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1});let g=null;this._canvas.addEventListener("webglcontextcreationerror",q=>{g={requestedAttributes:Y},q&&(g.statusMessage=q.statusMessage,g.type=q.type)},{once:!0});const A=this._canvas.getContext("webgl",Y)||this._canvas.getContext("experimental-webgl",Y);if(!A){const q="Failed to initialize WebGL";throw g?(g.message=q,new Error(JSON.stringify(g))):new Error(q)}this.painter=new Vm(A,this.transform),Bt.testSupport(A)}_contextLost(Y){Y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:Y}))}_contextRestored(Y){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:Y}))}_onMapScroll(Y){if(Y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(Y,g,A){return!g&&A<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(Y){return this.style?(this._styleDirty=this._styleDirty||Y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(Y){return this._update(),this._renderTaskQueue.add(Y)}_cancelRenderFrame(Y){this._renderTaskQueue.remove(Y)}_render(Y){let g,A=0;const q=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=q.createQueryEXT(),q.beginQueryEXT(q.TIME_ELAPSED_EXT,g),A=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(Y),this._removed)return;let ze=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Gn=this.transform.zoom,ls=o.exported.now();this.style.zoomHistory.update(Gn,ls);const $s=new o.EvaluationParameters(Gn,{now:ls,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ol=$s.crossFadingFactor();ol===1&&ol===this._crossFadingFactor||(ze=!0,this._crossFadingFactor=ol),this.style.update($s)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._imageQueueDirty=lh.processQueue()>0,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||ze)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const Gn=o.exported.now()-A;q.endQueryEXT(q.TIME_ELAPSED_EXT,g),setTimeout(()=>{const ls=q.getQueryObjectEXT(g,q.QUERY_RESULT_EXT)/1e6;q.deleteQueryEXT(g),this.fire(new o.Event("gpu-timing-frame",{cpuTime:Gn,gpuTime:ls}))},50)}if(this.listens("gpu-timing-layer")){const Gn=this.painter.collectGpuTimers();setTimeout(()=>{const ls=this.painter.queryGpuTimers(Gn);this.fire(new o.Event("gpu-timing-layer",{layerTimes:ls}))},50)}const Ft=this._sourcesDirty||this._styleDirty||this._placementDirty||this._imageQueueDirty;return Ft||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Ft||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1)),lh.removeThrottleControl(this._imageQueueHandle);const Y=this.painter.context.gl.getExtension("WEBGL_lose_context");Y&&Y.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_e.remove(this._canvasContainer),_e.remove(this._controlContainer),this._cooperativeGestures&&_e.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(Y=>{o.PerformanceUtils.frame(Y),this._frame=null,this._render(Y)}))}_onWindowOnline(){this._update()}_onWindowResize(Y){this._trackResize&&this.resize({originalEvent:Y})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(Y){this._showTileBoundaries!==Y&&(this._showTileBoundaries=Y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(Y){this._showPadding!==Y&&(this._showPadding=Y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(Y){this._showCollisionBoxes!==Y&&(this._showCollisionBoxes=Y,Y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(Y){this._showOverdrawInspector!==Y&&(this._showOverdrawInspector=Y,this._update())}get repaint(){return!!this._repaint}set repaint(Y){this._repaint!==Y&&(this._repaint=Y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(Y){this._vertices=Y,this._update()}get version(){return E0}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(Y){this.options=o.extend({},jv,Y),this._container=_e.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",g=>g.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",g=>this._map.zoomIn({},{originalEvent:g})),_e.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",g=>this._map.zoomOut({},{originalEvent:g})),_e.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",g=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:g}):this._map.resetNorth({},{originalEvent:g})}),this._compassIcon=_e.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const Y=this._map.getZoom(),g=Y===this._map.getMaxZoom(),A=Y===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())}_rotateCompassArrow(){const Y=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=Y}onAdd(Y){return this._map=Y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new c1(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_e.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(Y,g){const A=_e.create("button",Y,this._container);return A.type="button",A.addEventListener("click",g),A}_setButtonTitle(Y,g){const A=this._map._getUIString(`NavigationControl.${g}`);Y.title=A,Y.setAttribute("aria-label",A)}},GeolocateControl:class extends o.Evented{constructor(Y){super(),this.options=o.extend({},R1,Y),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(Y){var g;return this._map=Y,this._container=_e.create("div","maplibregl-ctrl maplibregl-ctrl-group"),g=this._setupUI,T0!==void 0?g(T0):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(A=>{T0=A.state!=="denied",g(T0)}):(T0=!!window.navigator.geolocation,g(T0)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_e.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Cv=0,U0=!1}_isOutOfMapMaxBounds(Y){const g=this._map.getMaxBounds(),A=Y.coords;return g&&(A.longitude<g.getWest()||A.longitude>g.getEast()||A.latitude<g.getSouth()||A.latitude>g.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(Y){if(this._map){if(this._isOutOfMapMaxBounds(Y))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",Y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=Y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(Y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(Y),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",Y)),this._finish()}}_updateCamera(Y){const g=new o.LngLat(Y.coords.longitude,Y.coords.latitude),A=Y.coords.accuracy,q=this._map.getBearing(),ze=o.extend({bearing:q},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(A),ze,{geolocateSource:!0})}_updateMarker(Y){if(Y){const g=new o.LngLat(Y.coords.longitude,Y.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=Y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const Y=this._map._container.clientHeight/2,g=this._map.unproject([0,Y]),A=this._map.unproject([1,Y]),q=g.distanceTo(A),ze=Math.ceil(2*this._accuracy/q);this._circleElement.style.width=`${ze}px`,this._circleElement.style.height=`${ze}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(Y){if(this._map){if(this.options.trackUserLocation)if(Y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(Y.code===3&&U0)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",Y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(Y){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=_e.create("button","maplibregl-ctrl-geolocate",this._container),_e.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",Y===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_e.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fg(this._dotElement),this._circleElement=_e.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Cv--,U0=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let Y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Cv++,Cv>1?(Y={maximumAge:6e5,timeout:0},U0=!0):(Y=this.options.positionOptions,U0=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,Y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:av,LogoControl:F0,ScaleControl:class{constructor(Y){this.options=o.extend({},Sy,Y),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){qv(this._map,this._container,this.options)}onAdd(Y){return this._map=Y,this._container=_e.create("div","maplibregl-ctrl maplibregl-ctrl-scale",Y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_e.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(Y){this.options.unit=Y,qv(this._map,this._container,this.options)}},FullscreenControl:class extends o.Evented{constructor(Y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,Y&&Y.container&&(Y.container instanceof HTMLElement?this._container=Y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(Y){return this._map=Y,this._container||(this._container=this._map.getContainer()),this._controlContainer=_e.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_e.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const Y=this._fullscreenButton=_e.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_e.create("span","maplibregl-ctrl-icon",Y).setAttribute("aria-hidden","true"),Y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const Y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",Y),this._fullscreenButton.title=Y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this.fire(new o.Event(this._fullscreen?"fullscreenstart":"fullscreenend"))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(Y){this.options=Y,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(Y){return this._map=Y,this._container=_e.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_e.create("button","maplibregl-ctrl-terrain",this._container),_e.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_e.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(Y){super(),this.options=o.extend(Object.create(Iy),Y),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(Y){return this._map&&this.remove(),this._map=Y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&_e.remove(this._content),this._container&&(_e.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(Y){return this._lngLat=o.LngLat.convert(Y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(Y){return this.setDOMContent(document.createTextNode(Y))}setHTML(Y){const g=document.createDocumentFragment(),A=document.createElement("body");let q;for(A.innerHTML=Y;q=A.firstChild,q;)g.appendChild(q);return this.setDOMContent(g)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(Y){return this.options.maxWidth=Y,this._update(),this}setDOMContent(Y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_e.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(Y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(Y){this._container&&this._container.classList.add(Y)}removeClassName(Y){this._container&&this._container.classList.remove(Y)}setOffset(Y){return this.options.offset=Y,this._update(),this}toggleClassName(Y){if(this._container)return this._container.classList.toggle(Y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=_e.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(Y){this._update(Y.point)}_onMouseMove(Y){this._update(Y.point)}_onDrag(Y){this._update(Y.point)}_update(Y){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=_e.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_e.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(Ft=>this._container.classList.add(Ft)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Iv(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!Y))return;const g=this._pos=this._trackPointer&&Y?Y:this._map.project(this._lngLat);let A=this.options.anchor;const q=Ip(this.options.offset);if(!A){const Ft=this._container.offsetWidth,Gn=this._container.offsetHeight;let ls;ls=g.y+q.bottom.y<Gn?["top"]:g.y>this._map.transform.height-Gn?["bottom"]:[],g.x<Ft/2?ls.push("left"):g.x>this._map.transform.width-Ft/2&&ls.push("right"),A=ls.length===0?"bottom":ls.join("-")}const ze=g.add(q[A]).round();_e.setTransform(this._container,`${Mv[A]} translate(${ze.x}px,${ze.y}px)`),uv(this._container,A,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const Y=this._container.querySelector(Zv);Y&&Y.focus()}_onClose(){this.remove()}},Marker:Fg,Style:rd,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:op,GeoJSONSource:np,ImageSource:yd,RasterDEMTileSource:$d,RasterTileSource:Id,VectorTileSource:bf,VideoSource:Qd,prewarm:function(){Cp().acquire(Df)},clearPrewarmedResources:function(){const Y=Wf;Y&&(Y.isPreloaded()&&Y.numActive()===1?(Y.release(Df),Wf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return O1},get workerCount(){return Jf.workerCount},set workerCount(Y){Jf.workerCount=Y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(Y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=Y},workerUrl:"",addProtocol(Y,g){o.config.REGISTERED_PROTOCOLS[Y]=g},removeProtocol(Y){delete o.config.REGISTERED_PROTOCOLS[Y]}};return $v.extend(K_,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),K_});var p=s;return p})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl__default=getDefaultExportFromCjs(maplibreGlExports),version$2="3.7.5",VERSION=version$2,_hasatob=typeof atob=="function",_hasbtoa=typeof btoa=="function",_hasBuffer=typeof Buffer=="function",_TD=typeof TextDecoder=="function"?new TextDecoder:void 0,_TE=typeof TextEncoder=="function"?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(e=>{let t={};return e.forEach((n,r)=>t[n]=r),t})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_mkUriSafe=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),_tidyB64=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=e=>{let t,n,r,s,l="";const p=e.length%3;for(let o=0;o<e.length;){if((n=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(s=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=n<<16|r<<8|s,l+=b64chs[t>>18&63]+b64chs[t>>12&63]+b64chs[t>>6&63]+b64chs[t&63]}return p?l.slice(0,p-3)+"===".substring(p):l},_btoa=_hasbtoa?e=>btoa(e):_hasBuffer?e=>Buffer.from(e,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let r=0,s=e.length;r<s;r+=4096)n.push(_fromCC.apply(null,e.subarray(r,r+4096)));return _btoa(n.join(""))},fromUint8Array=(e,t=!1)=>t?_mkUriSafe(_fromUint8Array(e)):_fromUint8Array(e),cb_utob=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?_fromCC(192|t>>>6)+_fromCC(128|t&63):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return _fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=e=>e.replace(re_utob,cb_utob),_encode=_hasBuffer?e=>Buffer.from(e,"utf8").toString("base64"):_TE?e=>_fromUint8Array(_TE.encode(e)):e=>_btoa(utob(e)),encode=(e,t=!1)=>t?_mkUriSafe(_encode(e)):_encode(e),encodeURI=e=>encode(e,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return _fromCC((n>>>10)+55296)+_fromCC((n&1023)+56320);case 3:return _fromCC((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return _fromCC((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=e=>e.replace(re_btou,cb_btou),atobPolyfill=e=>{if(e=e.replace(/\s+/g,""),!b64re.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,n="",r,s;for(let l=0;l<e.length;)t=b64tab[e.charAt(l++)]<<18|b64tab[e.charAt(l++)]<<12|(r=b64tab[e.charAt(l++)])<<6|(s=b64tab[e.charAt(l++)]),n+=r===64?_fromCC(t>>16&255):s===64?_fromCC(t>>16&255,t>>8&255):_fromCC(t>>16&255,t>>8&255,t&255);return n},_atob=_hasatob?e=>atob(_tidyB64(e)):_hasBuffer?e=>Buffer.from(e,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?e=>_U8Afrom(Buffer.from(e,"base64")):e=>_U8Afrom(_atob(e).split("").map(t=>t.charCodeAt(0))),toUint8Array=e=>_toUint8Array(_unURI(e)),_decode=_hasBuffer?e=>Buffer.from(e,"base64").toString("utf8"):_TD?e=>_TD.decode(_toUint8Array(e)):e=>btou(_atob(e)),_unURI=e=>_tidyB64(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),decode=e=>_decode(_unURI(e)),isValid=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},_noEnum=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){const e=(t,n)=>Object.defineProperty(String.prototype,t,_noEnum(n));e("fromBase64",function(){return decode(this)}),e("toBase64",function(t){return encode(this,t)}),e("toBase64URI",function(){return encode(this,!0)}),e("toBase64URL",function(){return encode(this,!0)}),e("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){const e=(t,n)=>Object.defineProperty(Uint8Array.prototype,t,_noEnum(n));e("toBase64",function(t){return fromUint8Array(this,t)}),e("toBase64URI",function(){return fromUint8Array(this,!0)}),e("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$2,VERSION,atob:_atob,atobPolyfill,btoa:_btoa,btoaPolyfill,fromBase64:decode,toBase64:encode,encode,encodeURI,encodeURL:encodeURI,utob,btou,decode,isValid,fromUint8Array,toUint8Array,extendString,extendUint8Array,extendBuiltins};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(e,t,n){if(native.randomUUID&&!t&&!e)return native.randomUUID();e=e||{};const r=e.random||(e.rng||rng)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let s=0;s<16;++s)t[n+s]=r[s];return t}return unsafeStringify(r)}function tryGettingFetch(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ClientConfig{constructor(){this._apiKey="",this._fetch=tryGettingFetch()}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}}const config$1=new ClientConfig,LanguageGeocoding={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languageCodeSet$1=new Set(Object.values(LanguageGeocoding));function getAutoLanguageGeocoding(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet$1.has(t));return e.length?e[0]:LanguageGeocoding.ENGLISH}var __async$4=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});function callFetch(e){return __async$4(this,arguments,function*(t,n={}){if(config$1.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(t).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return config$1.fetch(t,n)})}const defaults$1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(defaults$1);class ServiceError extends Error{constructor(t,n=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${n}`),this.res=t}}var __async$3=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});const customMessages$3={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function addLanguageGeocodingOptions(e,t){if(t.language==null)return;const n=Array.from(new Set((Array.isArray(t.language)?t.language:[t.language]).map(r=>r===LanguageGeocoding.AUTO?getAutoLanguageGeocoding():r))).join(",");e.set("language",n)}function addCommonForwardAndReverseGeocodingOptions(e,t){var n;e.set("key",(n=t.apiKey)!=null?n:config$1.apiKey),t.limit!=null&&e.set("limit",String(t.limit)),t.types!=null&&e.set("types",t.types.join(",")),addLanguageGeocodingOptions(e,t)}function addForwardGeocodingOptions(e,t){addCommonForwardAndReverseGeocodingOptions(e,t),t.bbox!=null&&e.set("bbox",t.bbox.join(",")),t.proximity!=null&&e.set("proximity",t.proximity.join(",")),t.country!=null&&e.set("country",t.country.join(",")),t.fuzzyMatch!=null&&e.set("fuzzyMatch",t.fuzzyMatch?"true":"false"),t.autocomplete!=null&&e.set("autocomplete",t.autocomplete?"true":"false")}function forward(e){return __async$3(this,arguments,function*(t,n={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const s=new URL(`geocoding/${encodeURIComponent(t)}.json`,defaults$1.maptilerApiURL),{searchParams:l}=s;addForwardGeocodingOptions(l,n);const p=s.toString(),o=yield callFetch(p);if(!o.ok)throw new ServiceError(o,(r=customMessages$3[o.status])!=null?r:"");return yield o.json()})}function reverse(e){return __async$3(this,arguments,function*(t,n={}){var r;if(!Array.isArray(t)||t.length<2)throw new Error("The position must be an array of form [lng, lat].");const s=new URL(`geocoding/${t[0]},${t[1]}.json`,defaults$1.maptilerApiURL);addCommonForwardAndReverseGeocodingOptions(s.searchParams,n);const l=s.toString(),p=yield callFetch(l);if(!p.ok)throw new ServiceError(p,(r=customMessages$3[p.status])!=null?r:"");return yield p.json()})}function byId(e){return __async$3(this,arguments,function*(t,n={}){var r;const s=new URL(`geocoding/${t}.json`,defaults$1.maptilerApiURL);addLanguageGeocodingOptions(s.searchParams,n);const l=s.toString(),p=yield callFetch(l);if(!p.ok)throw new ServiceError(p,(r=customMessages$3[p.status])!=null?r:"");return yield p.json()})}function batch(e){return __async$3(this,arguments,function*(t,n={}){var r;if(!t.length)return[];const s=t.map(P=>encodeURIComponent(P)).join(";"),l=new URL(`geocoding/${s}.json`,defaults$1.maptilerApiURL),{searchParams:p}=l;addForwardGeocodingOptions(p,n);const o=l.toString(),x=yield callFetch(o);if(!x.ok)throw new ServiceError(x,(r=customMessages$3[x.status])!=null?r:"");const M=yield x.json();return t.length===1?[M]:M})}const geocoding={forward,reverse,byId,batch,language:LanguageGeocoding};var __async$2=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});const customMessages$2={403:"Key is missing, invalid or restricted"};function info(){return __async$2(this,arguments,function*(e={}){var t;const n=new URL("geolocation/ip.json",defaults$1.maptilerApiURL);n.searchParams.set("key",(t=e.apiKey)!=null?t:config$1.apiKey);const r=n.toString(),s=yield callFetch(r);if(!s.ok)throw new ServiceError(s,s.status in customMessages$2?customMessages$2[s.status]:"");return yield s.json()})}const geolocation={info};var __async$1=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});const customMessages$1={403:"Key is missing, invalid or restricted"};function search(e){return __async$1(this,arguments,function*(t,n={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const s=new URL(`coordinates/search/${t}.json`,defaults$1.maptilerApiURL);s.searchParams.set("key",(r=n.apiKey)!=null?r:config$1.apiKey),"limit"in n&&s.searchParams.set("limit",n.limit.toString()),"transformations"in n&&s.searchParams.set("transformations",n.transformations.toString()),"exports"in n&&s.searchParams.set("exports",n.exports.toString());const l=s.toString(),p=yield callFetch(l);if(!p.ok)throw new ServiceError(p,p.status in customMessages$1?customMessages$1[p.status]:"");return yield p.json()})}function transform(e){return __async$1(this,arguments,function*(t,n={}){var r;const s=(Array.isArray(t[0])?t:[t]).map(M=>`${M[0]},${M[1]}`).join(";"),l=new URL(`coordinates/transform/${s}.json`,defaults$1.maptilerApiURL);l.searchParams.set("key",(r=n.apiKey)!=null?r:config$1.apiKey),"sourceCrs"in n&&l.searchParams.set("s_srs",n.sourceCrs.toString()),"targetCrs"in n&&l.searchParams.set("t_srs",n.targetCrs.toString()),"operations"in n&&l.searchParams.set("ops",(Array.isArray(n.operations)?n.operations:[n.operations]).join("|"));const p=l.toString(),o=yield callFetch(p);if(!o.ok)throw new ServiceError(o,o.status in customMessages$1?customMessages$1[o.status]:"");return yield o.json()})}const coordinates={search,transform};var __async$5=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});const customMessages={403:"Key is missing, invalid or restricted"};function get(e){return __async$5(this,arguments,function*(t,n={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The data ID must be a non-empty string");const s=new URL(`data/${encodeURIComponent(t)}/features.json`,defaults$1.maptilerApiURL);s.searchParams.set("key",(r=n.apiKey)!=null?r:config$1.apiKey);const l=s.toString(),p=yield callFetch(l);if(!p.ok)throw new ServiceError(p,p.status in customMessages?customMessages[p.status]:"");return yield p.json()})}const data={get};function expandMapStyle(e){const t=/^maptiler:\/\/(.*)/;let n;const r=e.trim();let s;return r.startsWith("http://")||r.startsWith("https://")?s=r:(n=t.exec(r))!==null?s=`https://api.maptiler.com/maps/${n[1]}/style.json`:s=`https://api.maptiler.com/maps/${r}/style.json`,s}class MapStyleVariant{constructor(t,n,r,s,l,p){this.name=t,this.variantType=n,this.id=r,this.referenceStyle=s,this.description=l,this.imageURL=p}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return expandMapStyle(this.getId())}}class ReferenceMapStyle{constructor(t,n){this.name=t,this.id=n,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const mapStylePresetList=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function makeReferenceStyleProxy(e){return new Proxy(e,{get(t,n,r){return t.hasVariant(n)?t.getVariant(n):n.toString().toUpperCase()===n?e.getDefaultVariant():Reflect.get(t,n,r)}})}function buildMapStyles(){const e={};for(let t=0;t<mapStylePresetList.length;t+=1){const n=mapStylePresetList[t],r=makeReferenceStyleProxy(new ReferenceMapStyle(n.name,n.referenceStyleID));for(let s=0;s<n.variants.length;s+=1){const l=n.variants[s],p=new MapStyleVariant(l.name,l.variantType,l.id,r,l.description,l.imageURL);r.addVariant(p)}e[n.referenceStyleID]=r}return e}function styleToStyle$1(e){if(!e)return MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getId();if(typeof e=="string"||e instanceof String)return e.trim().toLowerCase();if(e instanceof MapStyleVariant)return e.getId();if(e instanceof ReferenceMapStyle)return e.getDefaultVariant().getId()}const MapStyle=buildMapStyles();function getSqSegDist(e,t,n){let r=t[0],s=t[1],l=n[0]-r,p=n[1]-s;if(l!==0||p!==0){const o=((e[0]-r)*l+(e[1]-s)*p)/(l*l+p*p);o>1?(r=n[0],s=n[1]):o>0&&(r+=l*o,s+=p*o)}return l=e[0]-r,p=e[1]-s,l*l+p*p}function simplifyDPStep(e,t,n,r,s){let l=r,p;for(let o=t+1;o<n;o++){const x=getSqSegDist(e[o],e[t],e[n]);x>l&&(p=o,l=x)}l>r&&(p-t>1&&simplifyDPStep(e,t,p,r,s),s.push(e[p]),n-p>1&&simplifyDPStep(e,p,n,r,s))}function simplifyDouglasPeucker(e,t){const n=e.length-1,r=[e[0]];return simplifyDPStep(e,0,n,t,r),r.push(e[n]),r}function simplify(e,t){if(e.length<=2)return e;const n=t!==void 0?t*t:1;return simplifyDouglasPeucker(e,n)}function staticMapMarkerToString(e,t=!0){let n=`${e[0]},${e[1]}`;return e.length===3&&t&&(n+=`,${e[2]}`),n}function simplifyAndStringify(e,t=3e3){let n=e.map(l=>l.join(",")).join("|"),r=5e-6;const s=1e-5;for(;n.length>t;)n=simplify(e,r).map(p=>`${p[0]},${p[1]}`).join("|"),r+=s;return n}function centered(e,t,n={}){var r,s,l,p,o;const x=styleToStyle$1(n.style),M=n.hiDPI?"@2x":"",P=(r=n.format)!=null?r:"png";let he=~~((s=n.width)!=null?s:1024),nt=~~((l=n.height)!=null?l:1024);n.hiDPI&&(he=~~(he/2),nt=~~(nt/2));const _e=new URL(`maps/${encodeURIComponent(x)}/static/${e[0]},${e[1]},${t}/${he}x${nt}${M}.${P}`,defaults$1.maptilerApiURL);if("attribution"in n&&_e.searchParams.set("attribution",n.attribution.toString()),"markers"in n){let Bt="";const Fn="markerIcon"in n;Fn&&(Bt+=`icon:${n.markerIcon}|`),Fn&&"markerAnchor"in n&&(Bt+=`anchor:${n.markerAnchor}|`),Fn&&n.hiDPI&&(Bt+="scale:2|");const yr=Array.isArray(n.markers[0])?n.markers:[n.markers];Bt+=yr.map(Io=>staticMapMarkerToString(Io,!Fn)).join("|"),_e.searchParams.set("markers",Bt)}if("path"in n){let Bt="";if(Bt+=`fill:${(p=n.pathFillColor)!=null?p:"none"}|`,"pathStrokeColor"in n&&(Bt+=`stroke:${n.pathStrokeColor}|`),"pathWidth"in n){const Fn=n.pathWidth/(n.hiDPI?2:1);Bt+=`width:${Fn.toString()}|`}Bt+=simplifyAndStringify(n.path),_e.searchParams.set("path",Bt)}return _e.searchParams.set("key",(o=n.apiKey)!=null?o:config$1.apiKey),_e.toString()}function bounded(e,t={}){var n,r,s,l,p;const o=styleToStyle$1(t.style),x=t.hiDPI?"@2x":"",M=(n=t.format)!=null?n:"png";let P=~~((r=t.width)!=null?r:1024),he=~~((s=t.height)!=null?s:1024);t.hiDPI&&(P=~~(P/2),he=~~(he/2));const nt=new URL(`maps/${encodeURIComponent(o)}/static/${e[0]},${e[1]},${e[2]},${e[3]}/${P}x${he}${x}.${M}`,defaults$1.maptilerApiURL);if("attribution"in t&&nt.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&nt.searchParams.set("padding",t.padding.toString()),"markers"in t){let _e="";const Bt="markerIcon"in t;Bt&&(_e+=`icon:${t.markerIcon}|`),Bt&&"markerAnchor"in t&&(_e+=`anchor:${t.markerAnchor}|`),Bt&&t.hiDPI&&(_e+="scale:2|");const Fn=Array.isArray(t.markers[0])?t.markers:[t.markers];_e+=Fn.map(yr=>staticMapMarkerToString(yr,!Bt)).join("|"),nt.searchParams.set("markers",_e)}if("path"in t){let _e="";if(_e+=`fill:${(l=t.pathFillColor)!=null?l:"none"}|`,"pathStrokeColor"in t&&(_e+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){const Bt=t.pathWidth/(t.hiDPI?2:1);_e+=`width:${Bt.toString()}|`}_e+=simplifyAndStringify(t.path),nt.searchParams.set("path",_e)}return nt.searchParams.set("key",(p=t.apiKey)!=null?p:config$1.apiKey),nt.toString()}function automatic(e={}){var t,n,r,s,l;if(!("markers"in e)&&!("path"in e))throw new Error("Automatic static maps require markers and/or path to be created.");const p=styleToStyle$1(e.style),o=e.hiDPI?"@2x":"",x=(t=e.format)!=null?t:"png";let M=~~((n=e.width)!=null?n:1024),P=~~((r=e.height)!=null?r:1024);e.hiDPI&&(M=~~(M/2),P=~~(P/2));const he=new URL(`maps/${encodeURIComponent(p)}/static/auto/${M}x${P}${o}.${x}`,defaults$1.maptilerApiURL);if("attribution"in e&&he.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&he.searchParams.set("padding",e.padding.toString()),"markers"in e){let nt="";const _e="markerIcon"in e;_e&&(nt+=`icon:${e.markerIcon}|`),_e&&"markerAnchor"in e&&(nt+=`anchor:${e.markerAnchor}|`),_e&&e.hiDPI&&(nt+="scale:2|");const Bt=Array.isArray(e.markers[0])?e.markers:[e.markers];nt+=Bt.map(Fn=>staticMapMarkerToString(Fn,!_e)).join("|"),he.searchParams.set("markers",nt)}if("path"in e){let nt="";if(nt+=`fill:${(s=e.pathFillColor)!=null?s:"none"}|`,"pathStrokeColor"in e&&(nt+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){const _e=e.pathWidth/(e.hiDPI?2:1);nt+=`width:${_e.toString()}|`}nt+=simplifyAndStringify(e.path),he.searchParams.set("path",nt)}return he.searchParams.set("key",(l=e.apiKey)!=null?l:config$1.apiKey),he.toString()}const staticMaps={centered,bounded,automatic},Language={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languagesIsoSet=new Set(Object.values(Language));function isLanguageSupported(e){return languagesIsoSet.has(e)}const languageCodeSet=new Set(Object.values(Language));function getBrowserLanguage(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet.has(t));return e.length?e[0]:Language.LATIN}class SdkConfig extends EventEmitter$4{constructor(){super(),this.primaryLanguage=Language.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,config$1.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){config$1.fetch=t}get fetch(){return config$1.fetch}}const config=new SdkConfig,defaults={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Language.AUTO,secondaryLanguage:Language.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(defaults);class LogoControl extends maplibregl__default.LogoControl{onAdd(t){return super.onAdd(t)}}class MaptilerLogoControl extends LogoControl{constructor(t={}){var n,r;super(t),this.logoURL="",this.linkURL="",this.logoURL=(n=t.logoURL)!=null?n:defaults.maptilerLogoURL,this.linkURL=(r=t.linkURL)!=null?r:defaults.maptilerURL}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage=`url(${this.logoURL})`,n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener nofollow",n.href=this.linkURL,n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}function enableRTL(){maplibregl__default.getRTLTextPluginStatus()==="unavailable"&&maplibregl__default.setRTLTextPlugin(defaults.rtlPluginURL,null,!0)}function bindAll(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function DOMcreate(e,t,n){const r=window.document.createElement(e);return t!==void 0&&(r.className=t),n&&n.appendChild(r),r}function DOMremove(e){e.parentNode&&e.parentNode.removeChild(e)}function styleToStyle(e){return e?typeof e=="string"||e instanceof String?!e.startsWith("http")&&e.toLowerCase().includes(".json")?e:expandMapStyle(e):e instanceof MapStyleVariant?e.getExpandedStyleURL():e instanceof ReferenceMapStyle?e.getDefaultVariant().getExpandedStyleURL():e:MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class MaptilerTerrainControl{constructor(){bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=DOMcreate("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=DOMcreate("button","maplibregl-ctrl-terrain",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){DOMremove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class NavigationControl extends maplibregl__default.NavigationControl{onAdd(t){return super.onAdd(t)}}class MaptilerNavigationControl extends NavigationControl{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})}_createButton(t,n){const r=super._createButton(t,n);return r.clickFunction=n,r}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}}class GeolocateControl extends maplibregl__default.GeolocateControl{onAdd(t){return super.onAdd(t)}}var __defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(e,t,n)=>t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues$1=(e,t)=>{for(var n in t||(t={}))__hasOwnProp$1.call(t,n)&&__defNormalProp$1(e,n,t[n]);if(__getOwnPropSymbols$1)for(var n of __getOwnPropSymbols$1(t))__propIsEnum$1.call(t,n)&&__defNormalProp$1(e,n,t[n]);return e},__spreadProps$1=(e,t)=>__defProps$1(e,__getOwnPropDescs$1(t));const Marker$1=maplibregl__default.Marker,LngLat$1=maplibregl__default.LngLat;class MaptilerGeolocateControl extends GeolocateControl{constructor(){super(...arguments),this.lastUpdatedCenter=new LngLat$1(0,0)}_updateCamera(t){const n=new LngLat$1(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,s=this._map.getBearing(),l=__spreadProps$1(__spreadValues$1({bearing:s},this.options.fitBoundsOptions),{linear:!0}),p=this._map.getZoom();p>this.options.fitBoundsOptions.maxZoom&&(l.zoom=p),this._map.fitBounds(n.toBounds(r),l,{geolocateSource:!0});let o=!1;const x=()=>{o=!0};this._map.once("click",x),this._map.once("dblclick",x),this._map.once("dragstart",x),this._map.once("mousedown",x),this._map.once("touchstart",x),this._map.once("wheel",x),this._map.once("moveend",()=>{this._map.off("click",x),this._map.off("dblclick",x),this._map.off("dragstart",x),this._map.off("mousedown",x),this._map.off("touchstart",x),this._map.off("wheel",x),!o&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(t){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=DOMcreate("button","maplibregl-ctrl-geolocate",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOMcreate("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Marker$1(this._dotElement),this._circleElement=DOMcreate("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Marker$1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",n=>{const r=n.originalEvent&&n.originalEvent.type==="resize",s=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!n.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!r&&s>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],n=this._map.project(t),r=this._map.unproject([n.x,n.y]),s=this._map.unproject([n.x+20,n.y]),l=r.distanceTo(s)/20,p=Math.ceil(2*this._accuracy/l);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class AttributionControl extends maplibregl__default.AttributionControl{onAdd(t){return super.onAdd(t)}}class ScaleControl extends maplibregl__default.ScaleControl{onAdd(t){return super.onAdd(t)}}class FullscreenControl extends maplibregl__default.FullscreenControl{onAdd(t){return super.onAdd(t)}}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,n)=>new Promise((r,s)=>{var l=x=>{try{o(n.next(x))}catch(M){s(M)}},p=x=>{try{o(n.throw(x))}catch(M){s(M)}},o=x=>x.done?r(x.value):Promise.resolve(x.value).then(l,p);o((n=n.apply(e,t)).next())});const MAPTILER_SESSION_ID=v4(),GeolocationType={POINT:"POINT",COUNTRY:"COUNTRY"};let Map$1=class extends maplibregl__default.Map{constructor(t){var n,r,s;t.apiKey&&(config.apiKey=t.apiKey);const l=styleToStyle(t.style),p=location.hash;config.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(__spreadProps(__spreadValues({},t),{style:l,maplibreLogo:!1,transformRequest:he=>{let nt=null;try{nt=new URL(he)}catch{return{url:he,headers:{}}}return nt.host===defaults.maptilerApiHost&&(nt.searchParams.has("key")||nt.searchParams.append("key",config.apiKey),config.session&&nt.searchParams.append("mtsid",MAPTILER_SESSION_ID)),{url:nt.href,headers:{}}}})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(n=t.language)!=null?n:config.primaryLanguage,this.secondaryLanguage=config.secondaryLanguage,this.terrainExaggeration=(r=t.terrainExaggeration)!=null?r:this.terrainExaggeration,this.once("styledata",()=>__async(this,null,function*(){if(!t.geolocate||t.center||t.hash&&p)return;try{if(t.geolocate===GeolocationType.COUNTRY){yield this.fitToIpBounds();return}}catch(_e){console.warn(_e.message)}let he=null;try{yield this.centerOnIpPoint(t.zoom),he=this.getCameraHash()}catch(_e){console.warn(_e.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(_e=>{he===this.getCameraHash()&&(this.terrain?this.easeTo({center:[_e.coords.longitude,_e.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[_e.coords.longitude,_e.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>__async(this,null,function*(){enableRTL()})),this.once("load",()=>__async(this,null,function*(){let he={logo:null};try{const nt=Object.keys(this.style.sourceCaches).map(Fn=>this.getSource(Fn)).filter(Fn=>typeof Fn.url=="string"&&Fn.url.includes("tiles.json")),_e=new URL(nt[0].url);_e.searchParams.has("key")||_e.searchParams.append("key",config.apiKey),he=yield(yield fetch(_e.href)).json()}catch{}if("logo"in he&&he.logo){const nt=he.logo;this.addControl(new MaptilerLogoControl({logoURL:nt}),t.logoPosition),t.attributionControl===!1&&this.addControl(new AttributionControl(t))}else t.maptilerLogo&&this.addControl(new MaptilerLogoControl,t.logoPosition);if(t.scaleControl){const nt=t.scaleControl===!0||t.scaleControl===void 0?"bottom-right":t.scaleControl,_e=new ScaleControl({unit:config.unit});this.addControl(_e,nt),config.on("unit",Bt=>{_e.setUnit(Bt)})}if(t.navigationControl!==!1){const nt=t.navigationControl===!0||t.navigationControl===void 0?"top-right":t.navigationControl;this.addControl(new MaptilerNavigationControl,nt)}if(t.geolocateControl!==!1){const nt=t.geolocateControl===!0||t.geolocateControl===void 0?"top-right":t.geolocateControl;this.addControl(new MaptilerGeolocateControl({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),nt)}if(t.terrainControl){const nt=t.terrainControl===!0||t.terrainControl===void 0?"top-right":t.terrainControl;this.addControl(new MaptilerTerrainControl,nt)}if(t.fullscreenControl){const nt=t.fullscreenControl===!0||t.fullscreenControl===void 0?"top-right":t.fullscreenControl;this.addControl(new FullscreenControl({}),nt)}}));let o=!1,x=!1,M=null;this.once("load",he=>{o=!0,x&&this.fire("loadWithTerrain",M)});const P=he=>{he.terrain&&(x=!0,M={type:"loadWithTerrain",target:this,terrain:he.terrain},this.off("terrain",P),o&&this.fire("loadWithTerrain",M))};this.on("terrain",P),t.terrain&&this.enableTerrain((s=t.terrainExaggeration)!=null?s:this.terrainExaggeration)}onLoadAsync(){return __async(this,null,function*(){return new Promise((t,n)=>{if(this.loaded())return t(this);this.once("load",r=>{t(this)})})})}onLoadWithTerrainAsync(){return __async(this,null,function*(){return new Promise((t,n)=>{if(this.loaded()&&this.terrain)return t(this);this.once("loadWithTerrain",r=>{t(this)})})})}setStyle(t,n){return super.setStyle(styleToStyle(t),n)}setLanguage(t=defaults.primaryLanguage){if(t===Language.AUTO)return this.setLanguage(getBrowserLanguage());this.setPrimaryLanguage(t)}setPrimaryLanguage(t=defaults.primaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.primaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setPrimaryLanguage(getBrowserLanguage());const n=this.getStyle().layers,r=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,s=/^\s*name\s*(:\s*(\S*))?\s*$/,l=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,p=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,o=t?`name:${t}`:"name",x=["case",["has",o],["get",o],["get","name"]];for(let M=0;M<n.length;M+=1){const P=n[M],he=P.layout;if(!he||!he["text-field"])continue;const nt=this.getLayoutProperty(P.id,"text-field");let _e;if(Array.isArray(nt)&&nt.length>=2&&nt[0].trim().toLowerCase()==="concat"){const Bt=nt.slice();for(let Fn=0;Fn<nt.length;Fn+=1){const yr=nt[Fn];if((typeof yr=="string"||yr instanceof String)&&r.exec(yr.toString())){Bt[Fn]=x;break}else if(Array.isArray(yr)&&yr.length>=2&&yr[0].trim().toLowerCase()==="get"&&s.exec(yr[1].toString())){Bt[Fn]=x;break}else if(Array.isArray(yr)&&yr.length===4&&yr[0].trim().toLowerCase()==="case"){Bt[Fn]=x;break}}this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(nt)&&nt.length>=2&&nt[0].trim().toLowerCase()==="get"&&s.exec(nt[1].toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&r.exec(nt.toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(nt)&&nt.length===4&&nt[0].trim().toLowerCase()==="case"){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&(_e=l.exec(nt.toString()))!==null){const Bt=`{${o}}${_e[3]}{name${_e[4]||""}}`;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&(_e=p.exec(nt.toString()))!==null){const Bt=`${_e[1]}{${o}}${_e[5]}`;this.setLayoutProperty(P.id,"text-field",Bt)}}}))}setSecondaryLanguage(t=defaults.secondaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.secondaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setSecondaryLanguage(getBrowserLanguage());const n=this.getStyle().layers,r=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,s=/^\s*name\s*(:\s*(\S*))?\s*$/,l=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let p;for(let o=0;o<n.length;o+=1){const x=n[o],M=x.layout;if(!M||!M["text-field"])continue;const P=this.getLayoutProperty(x.id,"text-field");let he;if(Array.isArray(P)&&P.length>=2&&P[0].trim().toLowerCase()==="concat"){he=P.slice();let nt=0;for(let _e=0;_e<P.length;_e+=1){const Bt=P[_e];if((typeof Bt=="string"||Bt instanceof String)&&r.exec(Bt.toString())){if(nt===1){he[_e]=`{name:${t}}`;break}nt+=1}else if(Array.isArray(Bt)&&Bt.length>=2&&Bt[0].trim().toLowerCase()==="get"&&s.exec(Bt[1].toString())){if(nt===1){he[_e][1]=`name:${t}`;break}nt+=1}else if(Array.isArray(Bt)&&Bt.length===4&&Bt[0].trim().toLowerCase()==="case"){if(nt===1){he[_e]=["get",`name:${t}`];break}nt+=1}}this.setLayoutProperty(x.id,"text-field",he)}else if((typeof P=="string"||P instanceof String)&&(p=l.exec(P.toString()))!==null){const nt=t?`name:${t}`:"name";he=`{name${p[1]||""}}${p[3]}{${nt}}`,this.setLayoutProperty(x.id,"text-field",he)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,n=1e3){if(!this.terrain)return;const r=performance.now(),s=this.terrain.exaggeration,l=t-s,p=()=>{if(!this.terrain||this.terrainFlattening)return;const o=(performance.now()-r)/n;if(o<.99){const x=1-Math.pow(1-o,4),M=s+x*l;this.terrain.exaggeration=M,requestAnimationFrame(p)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(p)}enableTerrain(t=this.terrainExaggeration){if(t<0){console.warn("Terrain exaggeration cannot be negative.");return}const n=s=>__async(this,null,function*(){!this.terrain||s.type!=="data"||s.dataType!=="source"||!("source"in s)||s.sourceId!=="maptiler-terrain"||s.source.type!=="raster-dem"||s.isSourceLoaded&&(this.off("data",n),this.growTerrain(t))}),r=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",n),this.addSource(defaults.terrainSourceId,{type:"raster-dem",url:defaults.terrainSourceURL}),this.setTerrain({source:defaults.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(t);return}this.loaded()||this.isTerrainEnabled?r():this.once("load",()=>{this.getTerrain()&&this.getSource(defaults.terrainSourceId)||r()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=1*1e3,n=performance.now(),r=this.terrain.exaggeration,s=()=>{if(!this.terrain||this.terrainGrowing)return;const l=(performance.now()-n)/t;if(l<.99){const p=Math.pow(1-l,4),o=r*p;this.terrain.exaggeration=o,requestAnimationFrame(s)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(defaults.terrainSourceId)&&this.removeSource(defaults.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(s)}setTerrainExaggeration(t,n=!0){!n&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}fitToIpBounds(){return __async(this,null,function*(){const t=yield geolocation.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(t){return __async(this,null,function*(){const n=yield geolocation.info();this.jumpTo({center:[n.longitude,n.latitude],zoom:t||11})})}getCameraHash(){const t=new Float32Array(5),n=this.getCenter();return t[0]=n.lng,t[1]=n.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),gBase64.fromUint8Array(new Uint8Array(t.buffer))}getSdkConfig(){return config}getMaptilerSessionId(){return MAPTILER_SESSION_ID}};class Marker extends maplibregl__default.Marker{addTo(t){return super.addTo(t)}}class Popup extends maplibregl__default.Popup{addTo(t){return super.addTo(t)}}class Style extends maplibregl__default.Style{constructor(t,n={}){super(t,n)}}class CanvasSource extends maplibregl__default.CanvasSource{onAdd(t){super.onAdd(t)}}class GeoJSONSource extends maplibregl__default.GeoJSONSource{onAdd(t){super.onAdd(t)}}class ImageSource extends maplibregl__default.ImageSource{onAdd(t){super.onAdd(t)}}class RasterTileSource extends maplibregl__default.RasterTileSource{onAdd(t){super.onAdd(t)}}class RasterDEMTileSource extends maplibregl__default.RasterDEMTileSource{onAdd(t){super.onAdd(t)}}class VectorTileSource extends maplibregl__default.VectorTileSource{onAdd(t){super.onAdd(t)}}class VideoSource extends maplibregl__default.VideoSource{onAdd(t){super.onAdd(t)}}class TerrainControl extends maplibregl__default.TerrainControl{onAdd(t){return super.onAdd(t)}}class Point{constructor(t,n){this.x=t,this.y=n}_matMult(t){const n=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=r,this}_add(t){return this.x+=t.x,this.y+=t.y,this}_sub(t){return this.x-=t.x,this.y-=t.y,this}_mult(t){return this.x*=t,this.y*=t,this}_div(t){return this.x/=t,this.y/=t,this}_multByPoint(t){return this.x*=t.x,this.y*=t.y,this}_divByPoint(t){return this.x/=t.x,this.y/=t.y,this}_unit(){return this._div(this.mag()),this}_perp(){const t=this.y;return this.y=this.x,this.x=-t,this}_rotate(t){const n=Math.cos(t),r=Math.sin(t),s=n*this.x-r*this.y,l=r*this.x+n*this.y;return this.x=s,this.y=l,this}_rotateAround(t,n){const r=Math.cos(t),s=Math.sin(t),l=n.x+r*(this.x-n.x)-s*(this.y-n.y),p=n.y+s*(this.x-n.x)+r*(this.y-n.y);return this.x=l,this.y=p,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clone(){return new Point(this.x,this.y)}add(t){return this.clone()._add(t)}sub(t){return this.clone()._sub(t)}multByPoint(t){return this.clone()._multByPoint(t)}divByPoint(t){return this.clone()._divByPoint(t)}mult(t){return this.clone()._mult(t)}div(t){return this.clone()._div(t)}rotate(t){return this.clone()._rotate(t)}rotateAround(t,n){return this.clone()._rotateAround(t,n)}matMult(t){return this.clone()._matMult(t)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(t){return this.x===t.x&&this.y===t.y}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){const n=t.x-this.x,r=t.y-this.y;return n*n+r*r}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleWith(t){return this.angleWithSep(t.x,t.y)}angleWithSep(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)}static convert(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t}}const{supported,setRTLTextPlugin,getRTLTextPluginStatus,LngLat,LngLatBounds,MercatorCoordinate,Evented,AJAXError,prewarm,clearPrewarmedResources,version:version$1,workerCount,maxParallelImageRequests,workerUrl,addProtocol,removeProtocol}=maplibregl__default,MapMLGL=maplibregl__default.Map,MarkerMLGL=maplibregl__default.Marker,PopupMLGL=maplibregl__default.Popup,StyleMLGL=maplibregl__default.Style,CanvasSourceMLGL=maplibregl__default.CanvasSource,GeoJSONSourceMLGL=maplibregl__default.GeoJSONSource,ImageSourceMLGL=maplibregl__default.ImageSource,RasterTileSourceMLGL=maplibregl__default.RasterTileSource,RasterDEMTileSourceMLGL=maplibregl__default.RasterDEMTileSource,VectorTileSourceMLGL=maplibregl__default.VectorTileSource,VideoSourceMLGL=maplibregl__default.VideoSource;maplibregl__default.NavigationControl;maplibregl__default.GeolocateControl;maplibregl__default.AttributionControl;maplibregl__default.LogoControl;maplibregl__default.ScaleControl;maplibregl__default.FullscreenControl;maplibregl__default.TerrainControl;const ll=_mergeNamespaces({__proto__:null,AJAXError,AttributionControl,CanvasSource,CanvasSourceMLGL,Evented,FullscreenControl,GeoJSONSource,GeoJSONSourceMLGL,GeolocateControl,GeolocationType,ImageSource,ImageSourceMLGL,Language,LanguageGeocoding,LngLat,LngLatBounds,LogoControl,Map:Map$1,MapMLGL,MapStyle,MapStyleVariant,MaptilerGeolocateControl,MaptilerLogoControl,MaptilerNavigationControl,MaptilerTerrainControl,Marker,MarkerMLGL,MercatorCoordinate,NavigationControl,Point,Popup,PopupMLGL,RasterDEMTileSource,RasterDEMTileSourceMLGL,RasterTileSource,RasterTileSourceMLGL,ReferenceMapStyle,ScaleControl,SdkConfig,ServiceError,Style,StyleMLGL,TerrainControl,VectorTileSource,VectorTileSourceMLGL,VideoSource,VideoSourceMLGL,addProtocol,clearPrewarmedResources,config,coordinates,data,geocoding,geolocation,getRTLTextPluginStatus,maxParallelImageRequests,prewarm,removeProtocol,setRTLTextPlugin,staticMaps,supported,version:version$1,workerCount,workerUrl},[maplibreGlExports]);var ta=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},zn=(e,t,n)=>(ta(e,t,"read from private field"),n?n.call(e):t.get(e)),fs=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},No=(e,t,n,r)=>(ta(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);function _t(){}function cl(e,t){for(const n in t)e[n]=t[n];return e}function Wa(e){return e()}function ea(){return Object.create(null)}function Fr(e){e.forEach(Wa)}function ja(e){return typeof e=="function"}function Br(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function fl(e){return Object.keys(e).length===0}function hl(e,t,n,r){if(e){const s=Ka(e,t,n,r);return e[0](s)}}function Ka(e,t,n,r){return e[1]&&r?cl(n.ctx.slice(),e[1](r(t))):n.ctx}function gl(e,t,n,r){if(e[2]&&r){const s=e[2](r(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const l=[],p=Math.max(t.dirty.length,s.length);for(let o=0;o<p;o+=1)l[o]=t.dirty[o]|s[o];return l}return t.dirty|s}return t.dirty}function pl(e,t,n,r,s,l){if(s){const p=Ka(t,n,r,l);e.p(p,s)}}function dl(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let r=0;r<n;r++)t[r]=-1;return t}return-1}function na(e){return e??""}function rt(e,t){e.appendChild(t)}function Be(e,t,n){e.insertBefore(t,n||null)}function Pe(e){e.parentNode&&e.parentNode.removeChild(e)}function vl(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function Gt(e){return document.createElement(e)}function jn(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Wr(e){return document.createTextNode(e)}function In(){return Wr(" ")}function Re(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function yl(e){return function(t){return t.preventDefault(),e.call(this,t)}}function D(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ml(e){return Array.from(e.childNodes)}function Ki(e,t){t=""+t,e.data!==t&&(e.data=t)}function ra(e,t){e.value=t??""}function nn(e,t,n){e.classList[n?"add":"remove"](t)}function _l(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,r,t),s}let Qi;function Wi(e){Qi=e}function Qa(){if(!Qi)throw new Error("Function called outside component initialization");return Qi}function El(e){Qa().$$.on_destroy.push(e)}function Il(){const e=Qa();return(t,n,{cancelable:r=!1}={})=>{const s=e.$$.callbacks[t];if(s){const l=_l(t,n,{cancelable:r});return s.slice().forEach(p=>{p.call(e,l)}),!l.defaultPrevented}return!0}}function ia(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const gi=[],ys=[];let di=[];const oa=[],Cl=Promise.resolve();let ms=!1;function Nl(){ms||(ms=!0,Cl.then(Ja))}function _s(e){di.push(e)}const hs=new Set;let hi=0;function Ja(){if(hi!==0)return;const e=Qi;do{try{for(;hi<gi.length;){const t=gi[hi];hi++,Wi(t),xl(t.$$)}}catch(t){throw gi.length=0,hi=0,t}for(Wi(null),gi.length=0,hi=0;ys.length;)ys.pop()();for(let t=0;t<di.length;t+=1){const n=di[t];hs.has(n)||(hs.add(n),n())}di.length=0}while(gi.length);for(;oa.length;)oa.pop()();ms=!1,hs.clear(),Wi(e)}function xl(e){if(e.fragment!==null){e.update(),Fr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_s)}}function Sl(e){const t=[],n=[];di.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),di=t}const Po=new Set;let Yr;function Ro(){Yr={r:0,c:[],p:Yr}}function Oo(){Yr.r||Fr(Yr.c),Yr=Yr.p}function Dt(e,t){e&&e.i&&(Po.delete(e),e.i(t))}function ae(e,t,n,r){if(e&&e.o){if(Po.has(e))return;Po.add(e),Yr.c.push(()=>{Po.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function Sr(e){e&&e.c()}function sr(e,t,n,r){const{fragment:s,after_update:l}=e.$$;s&&s.m(t,n),r||_s(()=>{const p=e.$$.on_mount.map(Wa).filter(ja);e.$$.on_destroy?e.$$.on_destroy.push(...p):Fr(p),e.$$.on_mount=[]}),l.forEach(_s)}function ar(e,t){const n=e.$$;n.fragment!==null&&(Sl(n.after_update),Fr(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function wl(e,t){e.$$.dirty[0]===-1&&(gi.push(e),Nl(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function kr(e,t,n,r,s,l,p,o=[-1]){const x=Qi;Wi(e);const M=e.$$={fragment:null,ctx:[],props:l,update:_t,not_equal:s,bound:ea(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(x?x.$$.context:[])),callbacks:ea(),dirty:o,skip_bound:!1,root:t.target||x.$$.root};p&&p(M.root);let P=!1;if(M.ctx=n?n(e,t.props||{},(he,nt,..._e)=>{const Bt=_e.length?_e[0]:nt;return M.ctx&&s(M.ctx[he],M.ctx[he]=Bt)&&(!M.skip_bound&&M.bound[he]&&M.bound[he](Bt),P&&wl(e,he)),nt}):[],M.update(),P=!0,Fr(M.before_update),M.fragment=r?r(M.ctx):!1,t.target){if(t.hydrate){const he=ml(t.target);M.fragment&&M.fragment.l(he),he.forEach(Pe)}else M.fragment&&M.fragment.c();t.intro&&Dt(e.$$.fragment),sr(e,t.target,t.anchor,t.customElement),Ja()}Wi(x)}class Gr{$destroy(){ar(this,1),this.$destroy=_t}$on(t,n){if(!ja(n))return _t;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(t){this.$$set&&!fl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ll(e){let t,n;return{c(){t=jn("svg"),n=jn("path"),D(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),D(t,"viewBox","0 0 14 14"),D(t,"width","13"),D(t,"height","13"),D(t,"class","svelte-en2qvf")},m(r,s){Be(r,t,s),rt(t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class Za extends Gr{constructor(t){super(),kr(this,t,null,Ll,Br,{})}}function bl(e){let t,n;return{c(){t=jn("svg"),n=jn("path"),D(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),D(t,"viewBox","0 0 30 30"),D(t,"fill","none"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"class","svelte-d2loi5")},m(r,s){Be(r,t,s),rt(t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class $a extends Gr{constructor(t){super(),kr(this,t,null,bl,Br,{})}}function sa(e){var t,n;let r,s=(((n=(t=e[0].properties)==null?void 0:t.place_type_name)==null?void 0:n[0])??e[0].place_type[0])+"",l;return{c(){r=Gt("span"),l=Wr(s),D(r,"class","line2 svelte-ewziy4")},m(p,o){Be(p,r,o),rt(r,l)},p(p,o){var x,M;o&1&&s!==(s=(((M=(x=p[0].properties)==null?void 0:x.place_type_name)==null?void 0:M[0])??p[0].place_type[0])+"")&&Ki(l,s)},d(p){p&&Pe(r)}}}function Pl(e){let t,n,r,s,l=e[0].place_name.replace(/,.*/,"")+"",p,o,x,M=e[0].place_name.replace(/[^,]*,?\s*/,"")+"",P,he,nt,_e,Bt=e[2]&&sa(e);return{c(){t=Gt("li"),n=Gt("span"),r=Gt("span"),s=Gt("span"),p=Wr(l),o=In(),x=Gt("span"),P=Wr(M),he=In(),Bt&&Bt.c(),D(s,"class","primary svelte-ewziy4"),D(x,"class","secondary svelte-ewziy4"),D(r,"class","svelte-ewziy4"),D(n,"class","texts svelte-ewziy4"),D(t,"tabindex","0"),D(t,"data-selected",e[1]),D(t,"class","svelte-ewziy4"),nn(t,"selected",e[1])},m(Fn,yr){Be(Fn,t,yr),rt(t,n),rt(n,r),rt(r,s),rt(s,p),rt(r,o),rt(r,x),rt(x,P),rt(n,he),Bt&&Bt.m(n,null),nt||(_e=[Re(t,"mouseenter",e[3]),Re(t,"focus",e[4])],nt=!0)},p(Fn,[yr]){yr&1&&l!==(l=Fn[0].place_name.replace(/,.*/,"")+"")&&Ki(p,l),yr&1&&M!==(M=Fn[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&Ki(P,M),Fn[2]?Bt?Bt.p(Fn,yr):(Bt=sa(Fn),Bt.c(),Bt.m(n,null)):Bt&&(Bt.d(1),Bt=null),yr&2&&D(t,"data-selected",Fn[1]),yr&2&&nn(t,"selected",Fn[1])},i:_t,o:_t,d(Fn){Fn&&Pe(t),Bt&&Bt.d(),nt=!1,Fr(_e)}}}function Rl(e,t,n){let{feature:r}=t,{selected:s=!1}=t,{showPlaceType:l=!1}=t;function p(x){ia.call(this,e,x)}function o(x){ia.call(this,e,x)}return e.$$set=x=>{"feature"in x&&n(0,r=x.feature),"selected"in x&&n(1,s=x.selected),"showPlaceType"in x&&n(2,l=x.showPlaceType)},[r,s,l,p,o]}class Ol extends Gr{constructor(t){super(),kr(this,t,Rl,Pl,Br,{feature:0,selected:1,showPlaceType:2})}}function Dl(e){let t;return{c(){t=Gt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',D(t,"class","svelte-7cmwmc")},m(n,r){Be(n,t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Tl extends Gr{constructor(t){super(),kr(this,t,null,Dl,Br,{})}}function Ml(e){let t,n;return{c(){t=jn("svg"),n=jn("path"),D(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),D(t,"viewBox","0 0 60.006 21.412"),D(t,"width","14"),D(t,"height","20"),D(t,"class","svelte-en2qvf")},m(r,s){Be(r,t,s),rt(t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class Al extends Gr{constructor(t){super(),kr(this,t,null,Ml,Br,{})}}function Fl(e){let t,n;return{c(){t=jn("svg"),n=jn("path"),D(n,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),D(t,"width","14"),D(t,"height","14"),D(t,"viewBox","0 0 15 15"),D(t,"class","svelte-en2qvf")},m(r,s){Be(r,t,s),rt(t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class Bl extends Gr{constructor(t){super(),kr(this,t,null,Fl,Br,{})}}function aa(e,t,n){const r=e.slice();return r[70]=t[n],r[72]=n,r}function ua(e){let t,n;return t=new Tl({}),{c(){Sr(t.$$.fragment)},m(r,s){sr(t,r,s),n=!0},i(r){n||(Dt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){ar(t,r)}}}function la(e){let t,n,r,s,l;return n=new Al({}),{c(){t=Gt("button"),Sr(n.$$.fragment),D(t,"type","button"),D(t,"title",e[9]),D(t,"class","svelte-1r7dvt7"),nn(t,"active",e[0])},m(p,o){Be(p,t,o),sr(n,t,null),r=!0,s||(l=Re(t,"click",e[56]),s=!0)},p(p,o){(!r||o[0]&512)&&D(t,"title",p[9]),(!r||o[0]&1)&&nn(t,"active",p[0])},i(p){r||(Dt(n.$$.fragment,p),r=!0)},o(p){ae(n.$$.fragment,p),r=!1},d(p){p&&Pe(t),ar(n),s=!1,l()}}}function kl(e){let t,n,r,s,l=e[12],p=[];for(let x=0;x<l.length;x+=1)p[x]=ca(aa(e,l,x));const o=x=>ae(p[x],1,1,()=>{p[x]=null});return{c(){t=Gt("ul");for(let x=0;x<p.length;x+=1)p[x].c();D(t,"class","svelte-1r7dvt7")},m(x,M){Be(x,t,M);for(let P=0;P<p.length;P+=1)p[P]&&p[P].m(t,null);n=!0,r||(s=[Re(t,"mouseleave",e[60]),Re(t,"blur",e[61])],r=!0)},p(x,M){if(M[0]&2110464){l=x[12];let P;for(P=0;P<l.length;P+=1){const he=aa(x,l,P);p[P]?(p[P].p(he,M),Dt(p[P],1)):(p[P]=ca(he),p[P].c(),Dt(p[P],1),p[P].m(t,null))}for(Ro(),P=l.length;P<p.length;P+=1)o(P);Oo()}},i(x){if(!n){for(let M=0;M<l.length;M+=1)Dt(p[M]);n=!0}},o(x){p=p.filter(Boolean);for(let M=0;M<p.length;M+=1)ae(p[M]);n=!1},d(x){x&&Pe(t),vl(p,x),r=!1,Fr(s)}}}function Gl(e){let t,n,r,s,l,p;return n=new $a({}),{c(){t=Gt("div"),Sr(n.$$.fragment),r=In(),s=Gt("div"),l=Wr(e[7]),D(s,"class","svelte-1r7dvt7"),D(t,"class","no-results svelte-1r7dvt7")},m(o,x){Be(o,t,x),sr(n,t,null),rt(t,r),rt(t,s),rt(s,l),p=!0},p(o,x){(!p||x[0]&128)&&Ki(l,o[7])},i(o){p||(Dt(n.$$.fragment,o),p=!0)},o(o){ae(n.$$.fragment,o),p=!1},d(o){o&&Pe(t),ar(n)}}}function zl(e){let t="",n;return{c(){n=Wr(t)},m(r,s){Be(r,n,s)},p:_t,i:_t,o:_t,d(r){r&&Pe(n)}}}function Vl(e){let t,n,r,s,l,p,o,x,M,P,he;return n=new $a({}),x=new Za({}),{c(){t=Gt("div"),Sr(n.$$.fragment),r=In(),s=Gt("div"),l=Wr(e[6]),p=In(),o=Gt("button"),Sr(x.$$.fragment),D(s,"class","svelte-1r7dvt7"),D(o,"class","svelte-1r7dvt7"),D(t,"class","error svelte-1r7dvt7")},m(nt,_e){Be(nt,t,_e),sr(n,t,null),rt(t,r),rt(t,s),rt(s,l),rt(t,p),rt(t,o),sr(x,o,null),M=!0,P||(he=Re(o,"click",e[57]),P=!0)},p(nt,_e){(!M||_e[0]&64)&&Ki(l,nt[6])},i(nt){M||(Dt(n.$$.fragment,nt),Dt(x.$$.fragment,nt),M=!0)},o(nt){ae(n.$$.fragment,nt),ae(x.$$.fragment,nt),M=!1},d(nt){nt&&Pe(t),ar(n),ar(x),P=!1,he()}}}function ca(e){let t,n;function r(){return e[58](e[72])}function s(){return e[59](e[70])}return t=new Ol({props:{feature:e[70],showPlaceType:e[10],selected:e[13]===e[72]}}),t.$on("mouseenter",r),t.$on("focus",s),{c(){Sr(t.$$.fragment)},m(l,p){sr(t,l,p),n=!0},p(l,p){e=l;const o={};p[0]&4096&&(o.feature=e[70]),p[0]&1024&&(o.showPlaceType=e[10]),p[0]&8192&&(o.selected=e[13]===e[72]),t.$set(o)},i(l){n||(Dt(t.$$.fragment,l),n=!0)},o(l){ae(t.$$.fragment,l),n=!1},d(l){ar(t,l)}}}function Ul(e){let t,n,r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr,Io,rl,Co,as;s=new Bl({}),P=new Za({});let Js=e[17]&&ua(),lh=e[5]===!0&&la(e);const ch=e[48].default,Zu=hl(ch,e,e[47],null),th=[Vl,zl,Gl,kl],sl=[];function sh(xh,Mh){var Dh,Uh;return xh[16]?0:xh[14]?((Dh=xh[12])==null?void 0:Dh.length)===0?2:xh[14]&&(Uh=xh[12])!=null&&Uh.length?3:-1:1}return~(Fn=sh(e))&&(yr=sl[Fn]=th[Fn](e)),{c(){t=Gt("form"),n=Gt("div"),r=Gt("button"),Sr(s.$$.fragment),l=In(),p=Gt("input"),o=In(),x=Gt("div"),M=Gt("button"),Sr(P.$$.fragment),he=In(),Js&&Js.c(),nt=In(),lh&&lh.c(),_e=In(),Zu&&Zu.c(),Bt=In(),yr&&yr.c(),D(r,"class","search-button svelte-1r7dvt7"),D(r,"type","button"),D(p,"placeholder",e[8]),D(p,"aria-label",e[8]),D(p,"class","svelte-1r7dvt7"),D(M,"type","button"),D(M,"title",e[3]),D(M,"class","svelte-1r7dvt7"),D(x,"class","clear-button-container svelte-1r7dvt7"),nn(x,"displayable",e[1]!==""),D(n,"class","input-group svelte-1r7dvt7"),D(t,"tabindex","0"),D(t,"class",Io=na(e[2])+" svelte-1r7dvt7"),nn(t,"can-collapse",e[4]&&e[1]==="")},m(xh,Mh){Be(xh,t,Mh),rt(t,n),rt(n,r),sr(s,r,null),rt(n,l),rt(n,p),e[50](p),ra(p,e[1]),rt(n,o),rt(n,x),rt(x,M),sr(P,M,null),rt(x,he),Js&&Js.m(x,null),rt(n,nt),lh&&lh.m(n,null),rt(n,_e),Zu&&Zu.m(n,null),rt(t,Bt),~Fn&&sl[Fn].m(t,null),rl=!0,Co||(as=[Re(r,"click",e[49]),Re(p,"input",e[51]),Re(p,"focus",e[52]),Re(p,"blur",e[53]),Re(p,"keydown",e[19]),Re(p,"input",e[54]),Re(M,"click",e[55]),Re(t,"submit",yl(e[18]))],Co=!0)},p(xh,Mh){(!rl||Mh[0]&256)&&D(p,"placeholder",xh[8]),(!rl||Mh[0]&256)&&D(p,"aria-label",xh[8]),Mh[0]&2&&p.value!==xh[1]&&ra(p,xh[1]),(!rl||Mh[0]&8)&&D(M,"title",xh[3]),xh[17]?Js?Mh[0]&131072&&Dt(Js,1):(Js=ua(),Js.c(),Dt(Js,1),Js.m(x,null)):Js&&(Ro(),ae(Js,1,1,()=>{Js=null}),Oo()),(!rl||Mh[0]&2)&&nn(x,"displayable",xh[1]!==""),xh[5]===!0?lh?(lh.p(xh,Mh),Mh[0]&32&&Dt(lh,1)):(lh=la(xh),lh.c(),Dt(lh,1),lh.m(n,_e)):lh&&(Ro(),ae(lh,1,1,()=>{lh=null}),Oo()),Zu&&Zu.p&&(!rl||Mh[1]&65536)&&pl(Zu,ch,xh,xh[47],rl?gl(ch,xh[47],Mh,null):dl(xh[47]),null);let Dh=Fn;Fn=sh(xh),Fn===Dh?~Fn&&sl[Fn].p(xh,Mh):(yr&&(Ro(),ae(sl[Dh],1,1,()=>{sl[Dh]=null}),Oo()),~Fn?(yr=sl[Fn],yr?yr.p(xh,Mh):(yr=sl[Fn]=th[Fn](xh),yr.c()),Dt(yr,1),yr.m(t,null)):yr=null),(!rl||Mh[0]&4&&Io!==(Io=na(xh[2])+" svelte-1r7dvt7"))&&D(t,"class",Io),(!rl||Mh[0]&22)&&nn(t,"can-collapse",xh[4]&&xh[1]==="")},i(xh){rl||(Dt(s.$$.fragment,xh),Dt(P.$$.fragment,xh),Dt(Js),Dt(lh),Dt(Zu,xh),Dt(yr),rl=!0)},o(xh){ae(s.$$.fragment,xh),ae(P.$$.fragment,xh),ae(Js),ae(lh),ae(Zu,xh),ae(yr),rl=!1},d(xh){xh&&Pe(t),ar(s),e[50](null),ar(P),Js&&Js.d(),lh&&lh.d(),Zu&&Zu.d(xh),~Fn&&sl[Fn].d(),Co=!1,Fr(as)}}}function ql(e,t,n){const r=t[1],s=t[0],l=r-s;return e===r&&n?e:((e-s)%l+l)%l+s}function fa(e){let t=[...e];return t[2]<t[0]&&(t[2]+=360),t}function Xl(e,t,n){let r,{$$slots:s={},$$scope:l}=t,{class:p=void 0}=t,{apiKey:o}=t,{bbox:x=void 0}=t,{clearButtonTitle:M="clear"}=t,{clearOnBlur:P=!1}=t,{collapsed:he=!1}=t,{country:nt=void 0}=t,{debounceSearch:_e=200}=t,{enableReverse:Bt=!1}=t,{errorMessage:Fn="Something went wrong…"}=t,{filter:yr=()=>!0}=t,{flyTo:Io=!0}=t,{fuzzyMatch:rl=!0}=t,{language:Co=void 0}=t,{limit:as=void 0}=t,{mapController:Js=void 0}=t,{minLength:lh=2}=t,{noResultsMessage:ch="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:Zu="Search"}=t,{proximity:th=void 0}=t,{reverseActive:sl=Bt==="always"}=t,{reverseButtonTitle:sh="toggle reverse geocoding"}=t,{searchValue:xh=""}=t,{showFullGeometry:Mh=!0}=t,{showPlaceType:Dh=!1}=t,{showResultsWhileTyping:Uh=!0}=t,{trackProximity:cd=!0}=t,{types:Tf=void 0}=t,{zoom:yf=16}=t,{fetchParameters:Af={}}=t;function md(){bf.focus()}function vd(){bf.blur()}function qd(Xd,Op=!0){n(1,xh=Xd),Op?(n(13,Id=-1),op()):(Zd(),setTimeout(()=>{bf.focus(),bf.select()}))}let Ed=!1,Td,Fd,Cd,Gd="",bf,Id=-1,td,$d=[],np,jf,yd;const Qd=Il();El(()=>{Js&&(Js.setEventHandler(void 0),Js.indicateReverse(!1),Js.setSelectedMarker(-1),Js.setMarkers(void 0,void 0))});function op(Xd){if(jf&&(clearTimeout(jf),jf=void 0),Id>-1&&Td)n(45,Cd=Td[Id]),n(1,xh=Cd.place_name.replace(/,.*/,"")),n(16,td=void 0),n(44,Fd=void 0),n(13,Id=-1);else if(xh){const Op=Xd||!bp();fp(xh,{exact:!0}).then(()=>{n(44,Fd=Td),n(45,Cd=void 0),Op&&Qh()}).catch(nm=>n(16,td=nm))}}function bp(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(xh)}async function fp(Xd,{byId:Op=!1,exact:nm=!1}={}){n(16,td=void 0);const Tm=bp(),hp=new URLSearchParams;Co!=null&&hp.set("language",Array.isArray(Co)?Co.join(","):Co),Tf&&hp.set("types",Tf.join(",")),Tm||(x&&hp.set("bbox",x.map(Hf=>Hf.toFixed(6)).join(",")),nt&&hp.set("country",Array.isArray(nt)?nt.join(","):nt)),Op||(th&&hp.set("proximity",th.map(Hf=>Hf.toFixed(6)).join(",")),(nm||!Uh)&&hp.set("autocomplete","false"),hp.set("fuzzyMatch",String(rl))),as!==void 0&&hp.set("limit",String(as)),hp.set("key",o);const Em="https://api.maptiler.com/geocoding/"+encodeURIComponent(Xd)+".json?"+hp.toString();if(Em===Gd){Op?(n(12,Td=void 0),n(45,Cd=$d[0])):n(12,Td=$d);return}Gd=Em,np?.abort();const Qp=new AbortController;n(17,np=Qp);let lm;try{lm=await fetch(Em,{signal:Qp.signal,...Af}).finally(()=>{Qp===np&&n(17,np=void 0)})}catch(Hf){if(Hf&&typeof Hf=="object"&&"name"in Hf&&Hf.name==="AbortError")return;throw new Error}if(!lm.ok)throw new Error;const Dd=await lm.json();Qd("response",{url:Em,featureCollection:Dd}),Op?(n(12,Td=void 0),n(45,Cd=Dd.features[0]),$d=[Cd]):(n(12,Td=Dd.features.filter(yr)),$d=Td,Tm&&bf.focus())}function Qh(){var Xd,Op,nm,Tm;if(!(Fd!=null&&Fd.length)||!Io)return;const hp=[180,90,-180,-90],Em=!Fd.some(Qp=>!Qp.matching_text);for(const Qp of Fd)(Em||!Qp.matching_text)&&(hp[0]=Math.min(hp[0],((Xd=Qp.bbox)==null?void 0:Xd[0])??Qp.center[0]),hp[1]=Math.min(hp[1],((Op=Qp.bbox)==null?void 0:Op[1])??Qp.center[1]),hp[2]=Math.max(hp[2],((nm=Qp.bbox)==null?void 0:nm[2])??Qp.center[0]),hp[3]=Math.max(hp[3],((Tm=Qp.bbox)==null?void 0:Tm[3])??Qp.center[1]));Js&&Fd.length>0&&(Cd&&hp[0]===hp[2]&&hp[1]===hp[3]?Js.flyTo(Cd.center,yf):Js.fitBounds(fa(hp),50))}function Yd(Xd){n(0,sl=Bt==="always"),qd(ql(Xd[0],[-180,180],!0).toFixed(6)+","+Xd[1].toFixed(6))}function ad(Xd){if(!Td)return;let Op=Xd.key==="ArrowDown"?1:Xd.key==="ArrowUp"?-1:0;Op?(Id===-1&&Op===-1&&n(13,Id=Td.length),n(13,Id+=Op),Id>=Td.length&&n(13,Id=-1),Xd.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(Xd.key)&&n(13,Id=-1)}function Zd(Xd=!0){if(n(16,td=void 0),Uh){if(jf&&clearTimeout(jf),xh.length<=lh)return;const Op=xh;jf=window.setTimeout(()=>{fp(Op).catch(nm=>n(16,td=nm))},Xd?_e:0)}else n(12,Td=void 0),n(16,td=void 0)}function Xh(Xd){n(45,Cd=Xd),n(1,xh=Xd.place_name),n(13,Id=-1)}const Ld=()=>bf.focus();function Kf(Xd){ys[Xd?"unshift":"push"](()=>{bf=Xd,n(15,bf)})}function If(){xh=this.value,n(1,xh),n(11,Ed),n(25,P)}const Df=()=>n(11,Ed=!0),Jf=()=>n(11,Ed=!1),Nf=()=>Zd(),Wf=()=>{n(1,xh=""),bf.focus()},Cp=()=>n(0,sl=!sl),Tp=()=>n(16,td=void 0),Pp=Xd=>n(13,Id=Xd),Yf=Xd=>Xh(Xd),qp=()=>n(13,Id=-1),am=()=>{};return e.$$set=Xd=>{"class"in Xd&&n(2,p=Xd.class),"apiKey"in Xd&&n(23,o=Xd.apiKey),"bbox"in Xd&&n(24,x=Xd.bbox),"clearButtonTitle"in Xd&&n(3,M=Xd.clearButtonTitle),"clearOnBlur"in Xd&&n(25,P=Xd.clearOnBlur),"collapsed"in Xd&&n(4,he=Xd.collapsed),"country"in Xd&&n(26,nt=Xd.country),"debounceSearch"in Xd&&n(27,_e=Xd.debounceSearch),"enableReverse"in Xd&&n(5,Bt=Xd.enableReverse),"errorMessage"in Xd&&n(6,Fn=Xd.errorMessage),"filter"in Xd&&n(28,yr=Xd.filter),"flyTo"in Xd&&n(29,Io=Xd.flyTo),"fuzzyMatch"in Xd&&n(30,rl=Xd.fuzzyMatch),"language"in Xd&&n(31,Co=Xd.language),"limit"in Xd&&n(32,as=Xd.limit),"mapController"in Xd&&n(33,Js=Xd.mapController),"minLength"in Xd&&n(34,lh=Xd.minLength),"noResultsMessage"in Xd&&n(7,ch=Xd.noResultsMessage),"placeholder"in Xd&&n(8,Zu=Xd.placeholder),"proximity"in Xd&&n(22,th=Xd.proximity),"reverseActive"in Xd&&n(0,sl=Xd.reverseActive),"reverseButtonTitle"in Xd&&n(9,sh=Xd.reverseButtonTitle),"searchValue"in Xd&&n(1,xh=Xd.searchValue),"showFullGeometry"in Xd&&n(35,Mh=Xd.showFullGeometry),"showPlaceType"in Xd&&n(10,Dh=Xd.showPlaceType),"showResultsWhileTyping"in Xd&&n(36,Uh=Xd.showResultsWhileTyping),"trackProximity"in Xd&&n(37,cd=Xd.trackProximity),"types"in Xd&&n(38,Tf=Xd.types),"zoom"in Xd&&n(39,yf=Xd.zoom),"fetchParameters"in Xd&&n(40,Af=Xd.fetchParameters),"$$scope"in Xd&&n(47,l=Xd.$$scope)},e.$$.update=()=>{if(e.$$.dirty[1]&64&&(cd||n(22,th=void 0)),e.$$.dirty[0]&33556480&&setTimeout(()=>{n(14,yd=Ed),P&&!Ed&&n(1,xh="")}),e.$$.dirty[0]&4098&&(xh||(n(45,Cd=void 0),n(12,Td=void 0),n(16,td=void 0),n(44,Fd=Td))),e.$$.dirty[1]&16400&&Mh&&Cd&&!Cd.address&&Cd.geometry.type==="Point"&&fp(Cd.id,{byId:!0}).catch(Xd=>n(16,td=Xd)),e.$$.dirty[0]&536870912|e.$$.dirty[1]&16644&&Js&&Cd&&Io&&(!Cd.bbox||Cd.bbox[0]===Cd.bbox[2]&&Cd.bbox[1]===Cd.bbox[3]?Js.flyTo(Cd.center,yf):Js.fitBounds(fa(Cd.bbox),50),n(12,Td=void 0),n(44,Fd=void 0),n(13,Id=-1)),e.$$.dirty[0]&4096|e.$$.dirty[1]&8192&&Fd!==Td&&n(44,Fd=void 0),e.$$.dirty[1]&24580&&Js&&Js.setMarkers(Fd,Cd),e.$$.dirty[0]&2&&n(13,Id=-1),e.$$.dirty[0]&20481|e.$$.dirty[1]&68&&Js&&Js.setEventHandler(Xd=>{switch(Xd.type){case"mapClick":sl&&Yd(Xd.coordinates);break;case"proximityChange":n(22,th=cd?Xd.proximity:void 0);break;case"markerClick":{const Op=Td?.find(nm=>nm.id===Xd.id);Op&&Xh(Op)}break;case"markerMouseEnter":n(13,Id=yd?Td?.findIndex(Op=>Op.id===Xd.id)??-1:-1);break;case"markerMouseLeave":n(13,Id=-1);break}}),e.$$.dirty[0]&8192|e.$$.dirty[1]&4&&Js?.setSelectedMarker(Id),e.$$.dirty[0]&12288&&n(46,r=Td?.[Id]),e.$$.dirty[0]&2|e.$$.dirty[1]&4){const Xd=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(xh);Js?.setReverseMarker(Xd?[Number(Xd[1]),Number(Xd[2])]:void 0)}e.$$.dirty[1]&32768&&Qd("select",r),e.$$.dirty[1]&16384&&Qd("pick",Cd),e.$$.dirty[0]&20480&&Qd("optionsVisibilityChange",yd&&!!Td),e.$$.dirty[0]&4096&&Qd("featuresListed",Td),e.$$.dirty[1]&8192&&Qd("featuresMarked",Fd),e.$$.dirty[0]&1&&Qd("reverseToggle",sl),e.$$.dirty[0]&2&&Qd("queryChange",xh),e.$$.dirty[0]&1|e.$$.dirty[1]&4&&Js&&Js.indicateReverse(sl)},[sl,xh,p,M,he,Bt,Fn,ch,Zu,sh,Dh,Ed,Td,Id,yd,bf,td,np,op,ad,Zd,Xh,th,o,x,P,nt,_e,yr,Io,rl,Co,as,Js,lh,Mh,Uh,cd,Tf,yf,Af,md,vd,qd,Fd,Cd,r,l,s,Ld,Kf,If,Df,Jf,Nf,Wf,Cp,Tp,Pp,Yf,qp,am]}let Yl=class extends Gr{constructor(e){super(),kr(this,e,Xl,Ul,Br,{class:2,apiKey:23,bbox:24,clearButtonTitle:3,clearOnBlur:25,collapsed:4,country:26,debounceSearch:27,enableReverse:5,errorMessage:6,filter:28,flyTo:29,fuzzyMatch:30,language:31,limit:32,mapController:33,minLength:34,noResultsMessage:7,placeholder:8,proximity:22,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:35,showPlaceType:10,showResultsWhileTyping:36,trackProximity:37,types:38,zoom:39,fetchParameters:40,focus:41,blur:42,setQuery:43},null,[-1,-1,-1])}get focus(){return this.$$.ctx[41]}get blur(){return this.$$.ctx[42]}get setQuery(){return this.$$.ctx[43]}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Hl(e,t){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,s,l,p;return p={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function o(M){return function(P){return x([M,P])}}function x(M){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(l=M[0]&2?s.return:M[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,M[1])).done)return l;switch(s=0,l&&(M=[M[0]&2,l.value]),M[0]){case 0:case 1:l=M;break;case 4:return n.label++,{value:M[1],done:!1};case 5:n.label++,s=M[1],M=[0];continue;case 7:M=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(M[0]===6||M[0]===2)){n=0;continue}if(M[0]===3&&(!l||M[1]>l[0]&&M[1]<l[3])){n.label=M[1];break}if(M[0]===6&&n.label<l[1]){n.label=l[1],l=M;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(M);break}l[2]&&n.ops.pop(),n.trys.pop();continue}M=t.call(e,n)}catch(P){M=[6,P],s=0}finally{r=l=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}}var wr=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function Wl(e,t){return e>t?1:e<t?-1:0}function Ir(e,t,n){for(var r=new wr(null,null),s=r,l=r;;){var p=n(e,t.key);if(p<0){if(t.left===null)break;if(n(e,t.left.key)<0){var o=t.left;if(t.left=o.right,o.right=t,t=o,t.left===null)break}l.left=t,l=t,t=t.left}else if(p>0){if(t.right===null)break;if(n(e,t.right.key)>0){var o=t.right;if(t.right=o.left,o.left=t,t=o,t.right===null)break}s.right=t,s=t,t=t.right}else break}return s.right=t.left,l.left=t.right,t.left=r.right,t.right=r.left,t}function gs(e,t,n,r){var s=new wr(e,t);if(n===null)return s.left=s.right=null,s;n=Ir(e,n,r);var l=r(e,n.key);return l<0?(s.left=n.left,s.right=n,n.left=null):l>=0&&(s.right=n.right,s.left=n,n.right=null),s}function ha(e,t,n){var r=null,s=null;if(t){t=Ir(e,t,n);var l=n(t.key,e);l===0?(r=t.left,s=t.right):l<0?(s=t.right,t.right=null,r=t):(r=t.left,t.left=null,s=t)}return{left:r,right:s}}function jl(e,t,n){return t===null?e:(e===null||(t=Ir(e.key,t,n),t.left=e),t)}function Es(e,t,n,r,s){if(e){r(""+t+(n?"└── ":"├── ")+s(e)+`
`);var l=t+(n?"    ":"│   ");e.left&&Es(e.left,l,!1,r,s),e.right&&Es(e.right,l,!0,r,s)}}var Ms=function(){function e(t){t===void 0&&(t=Wl),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=gs(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var r=new wr(t,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var s=this._comparator,l=Ir(t,this._root,s),p=s(t,l.key);return p===0?this._root=l:(p<0?(r.left=l.left,r.right=l,l.left=null):p>0&&(r.right=l.right,r.left=l,l.right=null),this._size++,this._root=r),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,r){var s;if(n===null)return null;n=Ir(t,n,r);var l=r(t,n.key);return l===0?(n.left===null?s=n.right:(s=Ir(t,n.left,r),s.right=n.right),this._size--,s):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Ir(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,r=this._comparator;n;){var s=r(t,n.key);if(s===0)return n;s<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Ir(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,r=this._comparator;n;){var s=r(t,n.key);if(s===0)return!0;s<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var r=this._root,s=[],l=!1;!l;)r!==null?(s.push(r),r=r.left):s.length!==0?(r=s.pop(),t.call(n,r),r=r.right):l=!0;return this},e.prototype.range=function(t,n,r,s){for(var l=[],p=this._comparator,o=this._root,x;l.length!==0||o;)if(o)l.push(o),o=o.left;else{if(o=l.pop(),x=p(o.key,n),x>0)break;if(p(o.key,t)>=0&&r.call(s,o))return this;o=o.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var r=n.key;return t.push(r)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var r=n.data;return t.push(r)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,r=!1,s=0,l=[];!r;)if(n)l.push(n),n=n.left;else if(l.length>0){if(n=l.pop(),s===t)return n;s++,n=n.right}else r=!0;return null},e.prototype.next=function(t){var n=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var s=this._comparator;n;){var l=s(t.key,n.key);if(l===0)break;l<0?(r=n,n=n.left):n=n.right}return r},e.prototype.prev=function(t){var n=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var s=this._comparator;n;){var l=s(t.key,n.key);if(l===0)break;l<0?n=n.left:(r=n,n=n.right)}return r},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return Ql(this._root)},e.prototype.load=function(t,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var s=t.length,l=this._comparator;if(r&&Ns(t,n,0,s-1,l),this._root===null)this._root=Is(t,n,0,s),this._size=s;else{var p=Jl(this.toList(),Kl(t,n),l);s=this._size+s,this._root=Cs({head:p},0,s)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var n=[];return Es(this._root,"",!0,function(r){return n.push(r)},t),n.join("")},e.prototype.update=function(t,n,r){var s=this._comparator,l=ha(t,this._root,s),p=l.left,o=l.right;s(t,n)<0?o=gs(n,r,o,s):p=gs(n,r,p,s),this._root=jl(p,o,s)},e.prototype.split=function(t){return ha(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t;return Hl(this,function(n){switch(n.label){case 0:t=this.minNode(),n.label=1;case 1:return t?[4,t]:[3,3];case 2:return n.sent(),t=this.next(t),[3,1];case 3:return[2]}})},e}();function Is(e,t,n,r){var s=r-n;if(s>0){var l=n+Math.floor(s/2),p=e[l],o=t[l],x=new wr(p,o);return x.left=Is(e,t,n,l),x.right=Is(e,t,l+1,r),x}return null}function Kl(e,t){for(var n=new wr(null,null),r=n,s=0;s<e.length;s++)r=r.next=new wr(e[s],t[s]);return r.next=null,n.next}function Ql(e){for(var t=e,n=[],r=!1,s=new wr(null,null),l=s;!r;)t?(n.push(t),t=t.left):n.length>0?(t=l=l.next=n.pop(),t=t.right):r=!0;return l.next=null,s.next}function Cs(e,t,n){var r=n-t;if(r>0){var s=t+Math.floor(r/2),l=Cs(e,t,s),p=e.head;return p.left=l,e.head=e.head.next,p.right=Cs(e,s+1,n),p}return null}function Jl(e,t,n){for(var r=new wr(null,null),s=r,l=e,p=t;l!==null&&p!==null;)n(l.key,p.key)<0?(s.next=l,l=l.next):(s.next=p,p=p.next),s=s.next;return l!==null?s.next=l:p!==null&&(s.next=p),r.next}function Ns(e,t,n,r,s){if(!(n>=r)){for(var l=e[n+r>>1],p=n-1,o=r+1;;){do p++;while(s(e[p],l)<0);do o--;while(s(e[o],l)>0);if(p>=o)break;var x=e[p];e[p]=e[o],e[o]=x,x=t[p],t[p]=t[o],t[o]=x}Ns(e,t,n,o,s),Ns(e,t,o+1,r,s)}}function vn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ga(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ne(e,t,n){return t&&ga(e.prototype,t),n&&ga(e,n),e}var qi=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},xs=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,s=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:s},ur:{x:r,y:l}}},Cr=Number.EPSILON;Cr===void 0&&(Cr=Math.pow(2,-52));var Zl=Cr*Cr,Ss=function(e,t){if(-Cr<e&&e<Cr&&-Cr<t&&t<Cr)return 0;var n=e-t;return n*n<Zl*e*t?0:e<t?-1:1},$l=function(){function e(){vn(this,e),this.reset()}return Ne(e,[{key:"reset",value:function(){this.xRounder=new pa,this.yRounder=new pa}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),pa=function(){function e(){vn(this,e),this.tree=new Ms,this.round(0)}return Ne(e,[{key:"round",value:function(t){var n=this.tree.add(t),r=this.tree.prev(n);if(r!==null&&Ss(n.key,r.key)===0)return this.tree.remove(t),r.key;var s=this.tree.next(n);return s!==null&&Ss(n.key,s.key)===0?(this.tree.remove(t),s.key):t}}]),e}(),Ji=new $l,ji=function(e,t){return e.x*t.y-e.y*t.x},tu=function(e,t){return e.x*t.x+e.y*t.y},da=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},s={x:n.x-e.x,y:n.y-e.y},l=ji(r,s);return Ss(l,0)},Mo=function(e){return Math.sqrt(tu(e,e))},tc=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},s={x:n.x-e.x,y:n.y-e.y};return ji(s,r)/Mo(s)/Mo(r)},ec=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},s={x:n.x-e.x,y:n.y-e.y};return tu(s,r)/Mo(s)/Mo(r)},va=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},ya=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},nc=function(e,t,n,r){if(t.x===0)return ya(n,r,e.x);if(r.x===0)return ya(e,t,n.x);if(t.y===0)return va(n,r,e.y);if(r.y===0)return va(e,t,n.y);var s=ji(t,r);if(s==0)return null;var l={x:n.x-e.x,y:n.y-e.y},p=ji(l,t)/s,o=ji(l,r)/s,x=e.x+o*t.x,M=n.x+p*r.x,P=e.y+o*t.y,he=n.y+p*r.y,nt=(x+M)/2,_e=(P+he)/2;return{x:nt,y:_e}},Xn=function(){Ne(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return r!==0?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Ao.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){vn(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return Ne(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,r=0,s=n.length;r<s;r++){var l=n[r];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var s=n+1;s<t;s++){var l=this.point.events[s];l.consumedBy===void 0&&r.otherSE.point.events===l.otherSE.point.events&&r.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,r=this.point.events.length;n<r;n++){var s=this.point.events[n];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&t.push(s)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,r=new Map,s=function(l){var p=l.otherSE;r.set(l,{sine:tc(n.point,t.point,p.point),cosine:ec(n.point,t.point,p.point)})};return function(l,p){r.has(l)||s(l),r.has(p)||s(p);var o=r.get(l),x=o.sine,M=o.cosine,P=r.get(p),he=P.sine,nt=P.cosine;return x>=0&&he>=0?M<nt?1:M>nt?-1:0:x<0&&he<0?M<nt?-1:M>nt?1:0:he<x?-1:he>x?1:0}}}]),e}(),rc=0,Ao=function(){Ne(e,null,[{key:"compare",value:function(t,n){var r=t.leftSE.point.x,s=n.leftSE.point.x,l=t.rightSE.point.x,p=n.rightSE.point.x;if(p<r)return 1;if(l<s)return-1;var o=t.leftSE.point.y,x=n.leftSE.point.y,M=t.rightSE.point.y,P=n.rightSE.point.y;if(r<s){if(x<o&&x<M)return 1;if(x>o&&x>M)return-1;var he=t.comparePoint(n.leftSE.point);if(he<0)return 1;if(he>0)return-1;var nt=n.comparePoint(t.rightSE.point);return nt!==0?nt:-1}if(r>s){if(o<x&&o<P)return-1;if(o>x&&o>P)return 1;var _e=n.comparePoint(t.leftSE.point);if(_e!==0)return _e;var Bt=t.comparePoint(n.rightSE.point);return Bt<0?1:Bt>0?-1:1}if(o<x)return-1;if(o>x)return 1;if(l<p){var Fn=n.comparePoint(t.rightSE.point);if(Fn!==0)return Fn}if(l>p){var yr=t.comparePoint(n.rightSE.point);if(yr<0)return 1;if(yr>0)return-1}if(l!==p){var Io=M-o,rl=l-r,Co=P-x,as=p-s;if(Io>rl&&Co<as)return 1;if(Io<rl&&Co>as)return-1}return l>p?1:l<p||M<P?-1:M>P?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,r,s){vn(this,e),this.id=++rc,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=s}return Ne(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,r=this.rightSE.point,s=this.vector();if(n.x===r.x)return t.x===n.x?0:t.x<n.x?1:-1;var l=(t.y-n.y)/s.y,p=n.x+l*s.x;if(t.x===p)return 0;var o=(t.x-n.x)/s.x,x=n.y+o*s.y;return t.y===x?0:t.y<x?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),r=t.bbox(),s=xs(n,r);if(s===null)return null;var l=this.leftSE.point,p=this.rightSE.point,o=t.leftSE.point,x=t.rightSE.point,M=qi(n,o)&&this.comparePoint(o)===0,P=qi(r,l)&&t.comparePoint(l)===0,he=qi(n,x)&&this.comparePoint(x)===0,nt=qi(r,p)&&t.comparePoint(p)===0;if(P&&M)return nt&&!he?p:!nt&&he?x:null;if(P)return he&&l.x===x.x&&l.y===x.y?null:l;if(M)return nt&&p.x===o.x&&p.y===o.y?null:o;if(nt&&he)return null;if(nt)return p;if(he)return x;var _e=nc(l,this.vector(),o,t.vector());return _e===null||!qi(s,_e)?null:Ji.round(_e.x,_e.y)}},{key:"split",value:function(t){var n=[],r=t.events!==void 0,s=new Xn(t,!0),l=new Xn(t,!1),p=this.rightSE;this.replaceRightSE(l),n.push(l),n.push(s);var o=new e(s,p,this.rings.slice(),this.windings.slice());return Xn.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Xn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(s.checkForConsuming(),l.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var s=e.compare(n,r);if(s!==0){if(s>0){var l=n;n=r,r=l}if(n.prev===r){var p=n;n=r,r=p}for(var o=0,x=r.rings.length;o<x;o++){var M=r.rings[o],P=r.windings[o],he=n.rings.indexOf(M);he===-1?(n.rings.push(M),n.windings.push(P)):n.windings[he]+=P}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,s=this._afterState.multiPolys,l=0,p=this.rings.length;l<p;l++){var o=this.rings[l],x=this.windings[l],M=n.indexOf(o);M===-1?(n.push(o),r.push(x)):r[M]+=x}for(var P=[],he=[],nt=0,_e=n.length;nt<_e;nt++)if(r[nt]!==0){var Bt=n[nt],Fn=Bt.poly;if(he.indexOf(Fn)===-1)if(Bt.isExterior)P.push(Fn);else{he.indexOf(Fn)===-1&&he.push(Fn);var yr=P.indexOf(Bt.poly);yr!==-1&&P.splice(yr,1)}}for(var Io=0,rl=P.length;Io<rl;Io++){var Co=P[Io].multiPoly;s.indexOf(Co)===-1&&s.push(Co)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Nn.type){case"union":{var r=t.length===0,s=n.length===0;this._isInResult=r!==s;break}case"intersection":{var l,p;t.length<n.length?(l=t.length,p=n.length):(l=n.length,p=t.length),this._isInResult=p===Nn.numMultiPolys&&l<p;break}case"xor":{var o=Math.abs(t.length-n.length);this._isInResult=o%2===1;break}case"difference":{var x=function(M){return M.length===1&&M[0].isSubject};this._isInResult=x(t)!==x(n);break}default:throw new Error("Unrecognized operation type found ".concat(Nn.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var s,l,p,o=Xn.comparePoints(t,n);if(o<0)s=t,l=n,p=1;else if(o>0)s=n,l=t,p=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var x=new Xn(s,!0),M=new Xn(l,!1);return new e(x,M,[r],[p])}}]),e}(),ma=function(){function e(t,n,r){if(vn(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var s=Ji.round(t[0][0],t[0][1]);this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};for(var l=s,p=1,o=t.length;p<o;p++){if(typeof t[p][0]!="number"||typeof t[p][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var x=Ji.round(t[p][0],t[p][1]);x.x===l.x&&x.y===l.y||(this.segments.push(Ao.fromRing(l,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),l=x)}(s.x!==l.x||s.y!==l.y)&&this.segments.push(Ao.fromRing(l,s,this))}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.segments.length;n<r;n++){var s=this.segments[n];t.push(s.leftSE),t.push(s.rightSE)}return t}}]),e}(),ic=function(){function e(t,n){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ma(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,s=t.length;r<s;r++){var l=new ma(t[r],this,!1);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.interiorRings.push(l)}this.multiPoly=n}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var s=this.interiorRings[n].getSweepEvents(),l=0,p=s.length;l<p;l++)t.push(s[l]);return t}}]),e}(),_a=function(){function e(t,n){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,s=t.length;r<s;r++){var l=new ic(t[r],this);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.polys.push(l)}this.isSubject=n}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++)for(var s=this.polys[n].getSweepEvents(),l=0,p=s.length;l<p;l++)t.push(s[l]);return t}}]),e}(),oc=function(){Ne(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,s=t.length;r<s;r++){var l=t[r];if(!(!l.isInResult()||l.ringOut)){for(var p=null,o=l.leftSE,x=l.rightSE,M=[o],P=o.point,he=[];p=o,o=x,M.push(o),o.point!==P;)for(;;){var nt=o.getAvailableLinkedEvents();if(nt.length===0){var _e=M[0].point,Bt=M[M.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(_e.x,",")+" ".concat(_e.y,"]. Last matching segment found ends at")+" [".concat(Bt.x,", ").concat(Bt.y,"]."))}if(nt.length===1){x=nt[0].otherSE;break}for(var Fn=null,yr=0,Io=he.length;yr<Io;yr++)if(he[yr].point===o.point){Fn=yr;break}if(Fn!==null){var rl=he.splice(Fn)[0],Co=M.splice(rl.index);Co.unshift(Co[0].otherSE),n.push(new e(Co.reverse()));continue}he.push({index:M.length,point:o.point});var as=o.getLeftmostComparator(p);x=nt.sort(as)[0].otherSE;break}n.push(new e(M))}}return n}}]);function e(t){vn(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return Ne(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],r=1,s=this.events.length-1;r<s;r++){var l=this.events[r].point,p=this.events[r+1].point;da(l,t,p)!==0&&(n.push(l),t=l)}if(n.length===1)return null;var o=n[0],x=n[1];da(o,t,x)===0&&n.shift(),n.push(n[0]);for(var M=this.isExteriorRing()?1:-1,P=this.isExteriorRing()?0:n.length-1,he=this.isExteriorRing()?n.length:-1,nt=[],_e=P;_e!=he;_e+=M)nt.push([n[_e].x,n[_e].y]);return nt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,r=this.events.length;n<r;n++){var s=this.events[n];Xn.compare(t,s)>0&&(t=s)}for(var l=t.segment.prevInResult(),p=l?l.prevInResult():null;;){if(!l)return null;if(!p)return l.ringOut;if(p.ringOut!==l.ringOut)return p.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=p.prevInResult(),p=l?l.prevInResult():null}}}]),e}(),Ea=function(){function e(t){vn(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Ne(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var s=this.interiorRings[n].getGeom();s!==null&&t.push(s)}return t}}]),e}(),sc=function(){function e(t){vn(this,e),this.rings=t,this.polys=this._composePolys(t)}return Ne(e,[{key:"getGeom",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++){var s=this.polys[n].getGeom();s!==null&&t.push(s)}return t}},{key:"_composePolys",value:function(t){for(var n=[],r=0,s=t.length;r<s;r++){var l=t[r];if(!l.poly)if(l.isExteriorRing())n.push(new Ea(l));else{var p=l.enclosingRing();p.poly||n.push(new Ea(p)),p.poly.addInterior(l)}}return n}}]),e}(),ac=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ao.compare;vn(this,e),this.queue=t,this.tree=new Ms(n),this.segments=[]}return Ne(e,[{key:"process",value:function(t){var n=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),r;var s=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!s)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=s,p=s,o=void 0,x=void 0;o===void 0;)l=this.tree.prev(l),l===null?o=null:l.key.consumedBy===void 0&&(o=l.key);for(;x===void 0;)p=this.tree.next(p),p===null?x=null:p.key.consumedBy===void 0&&(x=p.key);if(t.isLeft){var M=null;if(o){var P=o.getIntersection(n);if(P!==null&&(n.isAnEndpoint(P)||(M=P),!o.isAnEndpoint(P)))for(var he=this._splitSafely(o,P),nt=0,_e=he.length;nt<_e;nt++)r.push(he[nt])}var Bt=null;if(x){var Fn=x.getIntersection(n);if(Fn!==null&&(n.isAnEndpoint(Fn)||(Bt=Fn),!x.isAnEndpoint(Fn)))for(var yr=this._splitSafely(x,Fn),Io=0,rl=yr.length;Io<rl;Io++)r.push(yr[Io])}if(M!==null||Bt!==null){var Co=null;if(M===null)Co=Bt;else if(Bt===null)Co=M;else{var as=Xn.comparePoints(M,Bt);Co=as<=0?M:Bt}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var Js=n.split(Co),lh=0,ch=Js.length;lh<ch;lh++)r.push(Js[lh])}r.length>0?(this.tree.remove(n),r.push(t)):(this.segments.push(n),n.prev=o)}else{if(o&&x){var Zu=o.getIntersection(x);if(Zu!==null){if(!o.isAnEndpoint(Zu))for(var th=this._splitSafely(o,Zu),sl=0,sh=th.length;sl<sh;sl++)r.push(th[sl]);if(!x.isAnEndpoint(Zu))for(var xh=this._splitSafely(x,Zu),Mh=0,Dh=xh.length;Mh<Dh;Mh++)r.push(xh[Mh])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var s=t.split(n);return s.push(r),t.consumedBy===void 0&&this.tree.insert(t),s}}]),e}(),Ia=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,uc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,lc=function(){function e(){vn(this,e)}return Ne(e,[{key:"run",value:function(t,n,r){Nn.type=t,Ji.reset();for(var s=[new _a(n,!0)],l=0,p=r.length;l<p;l++)s.push(new _a(r[l],!1));if(Nn.numMultiPolys=s.length,Nn.type==="difference")for(var o=s[0],x=1;x<s.length;)xs(s[x].bbox,o.bbox)!==null?x++:s.splice(x,1);if(Nn.type==="intersection"){for(var M=0,P=s.length;M<P;M++)for(var he=s[M],nt=M+1,_e=s.length;nt<_e;nt++)if(xs(he.bbox,s[nt].bbox)===null)return[]}for(var Bt=new Ms(Xn.compare),Fn=0,yr=s.length;Fn<yr;Fn++)for(var Io=s[Fn].getSweepEvents(),rl=0,Co=Io.length;rl<Co;rl++)if(Bt.insert(Io[rl]),Bt.size>Ia)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var as=new ac(Bt),Js=Bt.size,lh=Bt.pop();lh;){var ch=lh.key;if(Bt.size===Js){var Zu=ch.segment;throw new Error("Unable to pop() ".concat(ch.isLeft?"left":"right"," SweepEvent ")+"[".concat(ch.point.x,", ").concat(ch.point.y,"] from segment #").concat(Zu.id," ")+"[".concat(Zu.leftSE.point.x,", ").concat(Zu.leftSE.point.y,"] -> ")+"[".concat(Zu.rightSE.point.x,", ").concat(Zu.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Bt.size>Ia)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(as.segments.length>uc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var th=as.process(ch),sl=0,sh=th.length;sl<sh;sl++){var xh=th[sl];xh.consumedBy===void 0&&Bt.insert(xh)}Js=Bt.size,lh=Bt.pop()}Ji.reset();var Mh=oc.factory(as.segments),Dh=new sc(Mh);return Dh.getGeom()}}]),e}(),Nn=new lc,cc=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nn.run("union",e,n)},fc=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nn.run("intersection",e,n)},hc=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nn.run("xor",e,n)},gc=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nn.run("difference",e,n)},eu={union:cc,intersection:fc,xor:hc,difference:gc},Ee=63710088e-1,nu={centimeters:Ee*100,centimetres:Ee*100,degrees:Ee/111325,feet:Ee*3.28084,inches:Ee*39.37,kilometers:Ee/1e3,kilometres:Ee/1e3,meters:Ee,metres:Ee,miles:Ee/1609.344,millimeters:Ee*1e3,millimetres:Ee*1e3,nauticalmiles:Ee/1852,radians:1,yards:Ee*1.0936};function Wo(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function pc(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ca(e[0])||!Ca(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return Wo(r,t,n)}function ru(e,t,n){n===void 0&&(n={});for(var r=0,s=e;r<s.length;r++){var l=s[r];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<l[l.length-1].length;p++)if(l[l.length-1][p]!==l[0][p])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return Wo(o,t,n)}function ws(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function iu(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return Wo(r,t,n)}function dc(e,t){t===void 0&&(t="kilometers");var n=nu[t];if(!n)throw new Error(t+" units is invalid");return e*n}function vc(e,t){t===void 0&&(t="kilometers");var n=nu[t];if(!n)throw new Error(t+" units is invalid");return e/n}function Ca(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Fo(e){return e.type==="Feature"?e.geometry:e}function yc(e,t,n){n===void 0&&(n={});var r=Fo(e),s=Fo(t),l=eu.union(r.coordinates,s.coordinates);return l.length===0?null:l.length===1?ru(l[0],n.properties):iu(l,n.properties)}function mc(e){let t,n,r;return{c(){t=jn("svg"),n=jn("path"),D(n,"stroke-width","4"),D(n,"fill-rule","evenodd"),D(n,"clip-rule","evenodd"),D(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),D(n,"class","svelte-1k1cmht"),D(t,"width",r=e[0]!=="list"?void 0:"20"),D(t,"viewBox","0 0 70 85"),D(t,"fill","none"),D(t,"class","svelte-1k1cmht"),nn(t,"in-map",e[0]!=="list"),nn(t,"list-icon",e[0]==="list")},m(s,l){Be(s,t,l),rt(t,n)},p(s,[l]){l&1&&r!==(r=s[0]!=="list"?void 0:"20")&&D(t,"width",r),l&1&&nn(t,"in-map",s[0]!=="list"),l&1&&nn(t,"list-icon",s[0]==="list")},i:_t,o:_t,d(s){s&&Pe(t)}}}function _c(e,t,n){let{displayIn:r}=t;return e.$$set=s=>{"displayIn"in s&&n(0,r=s.displayIn)},[r]}class Ec extends Gr{constructor(t){super(),kr(this,t,_c,mc,Br,{displayIn:0})}}function ou(e,t,n){if(e!==null)for(var r,s,l,p,o,x,M,P=0,he=0,nt,_e=e.type,Bt=_e==="FeatureCollection",Fn=_e==="Feature",yr=Bt?e.features.length:1,Io=0;Io<yr;Io++){M=Bt?e.features[Io].geometry:Fn?e.geometry:e,nt=M?M.type==="GeometryCollection":!1,o=nt?M.geometries.length:1;for(var rl=0;rl<o;rl++){var Co=0,as=0;if(p=nt?M.geometries[rl]:M,p!==null){x=p.coordinates;var Js=p.type;switch(P=n&&(Js==="Polygon"||Js==="MultiPolygon")?1:0,Js){case null:break;case"Point":if(t(x,he,Io,Co,as)===!1)return!1;he++,Co++;break;case"LineString":case"MultiPoint":for(r=0;r<x.length;r++){if(t(x[r],he,Io,Co,as)===!1)return!1;he++,Js==="MultiPoint"&&Co++}Js==="LineString"&&Co++;break;case"Polygon":case"MultiLineString":for(r=0;r<x.length;r++){for(s=0;s<x[r].length-P;s++){if(t(x[r][s],he,Io,Co,as)===!1)return!1;he++}Js==="MultiLineString"&&Co++,Js==="Polygon"&&as++}Js==="Polygon"&&Co++;break;case"MultiPolygon":for(r=0;r<x.length;r++){for(as=0,s=0;s<x[r].length;s++){for(l=0;l<x[r][s].length-P;l++){if(t(x[r][s][l],he,Io,Co,as)===!1)return!1;he++}as++}Co++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(ou(p.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Na(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function su(e,t){var n,r,s,l,p,o,x,M,P,he,nt=0,_e=e.type==="FeatureCollection",Bt=e.type==="Feature",Fn=_e?e.features.length:1;for(n=0;n<Fn;n++){for(o=_e?e.features[n].geometry:Bt?e.geometry:e,M=_e?e.features[n].properties:Bt?e.properties:{},P=_e?e.features[n].bbox:Bt?e.bbox:void 0,he=_e?e.features[n].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,p=x?o.geometries.length:1,s=0;s<p;s++){if(l=x?o.geometries[s]:o,l===null){if(t(null,nt,M,P,he)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,nt,M,P,he)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<l.geometries.length;r++)if(t(l.geometries[r],nt,M,P,he)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}nt++}}function Ls(e){var t=[1/0,1/0,-1/0,-1/0];return ou(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Ls.default=Ls;function Ic(e,t){t===void 0&&(t={});var n=Ls(e),r=(n[0]+n[2])/2,s=(n[1]+n[3])/2;return pc([r,s],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var s=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(s=s<0?Math.max(n+arguments[2],0):Math.min(s,n);r<s;)t[r]=e,++r;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var jr=function(){};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};jr.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var ct=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),z=function(){},au={MAX_VALUE:{configurable:!0}};z.isNaN=function(e){return Number.isNaN(e)};z.doubleToLongBits=function(e){return e};z.longBitsToDouble=function(e){return e};z.isInfinite=function(e){return!Number.isFinite(e)};au.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(z,au);var ke=function(){},jo=function(){},vi=function(){};function Ge(){}var v=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},si={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};v.prototype.setOrdinate=function(e,t){switch(e){case v.X:this.x=t;break;case v.Y:this.y=t;break;case v.Z:this.z=t;break;default:throw new ct("Invalid ordinate index: "+e)}};v.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!jr.equalsWithTolerance(this.x,t.x,n)||!jr.equalsWithTolerance(this.y,t.y,n))}};v.prototype.getOrdinate=function(e){switch(e){case v.X:return this.x;case v.Y:return this.y;case v.Z:return this.z}throw new ct("Invalid ordinate index: "+e)};v.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||z.isNaN(this.z))&&z.isNaN(e.z)};v.prototype.equals=function(e){return e instanceof v?this.equals2D(e):!1};v.prototype.equalInZ=function(e,t){return jr.equalsWithTolerance(this.z,e.z,t)};v.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};v.prototype.clone=function(){};v.prototype.copy=function(){return new v(this)};v.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};v.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)};v.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};v.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this.x),e=37*e+v.hashCode(this.y),e};v.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};v.prototype.interfaces_=function(){return[ke,jo,Ge]};v.prototype.getClass=function(){return v};v.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=z.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};si.DimensionalComparator.get=function(){return rr};si.serialVersionUID.get=function(){return 6683108902428367e3};si.NULL_ORDINATE.get=function(){return z.NaN};si.X.get=function(){return 0};si.Y.get=function(){return 1};si.Z.get=function(){return 2};Object.defineProperties(v,si);var rr=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new ct("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};rr.prototype.compare=function(e,t){var n=e,r=t,s=rr.compare(n.x,r.x);if(s!==0)return s;var l=rr.compare(n.y,r.y);if(l!==0)return l;if(this._dimensionsToTest<=2)return 0;var p=rr.compare(n.z,r.z);return p};rr.prototype.interfaces_=function(){return[vi]};rr.prototype.getClass=function(){return rr};rr.compare=function(e,t){return e<t?-1:e>t?1:z.isNaN(e)?z.isNaN(t)?0:-1:z.isNaN(t)?1:0};var yi=function(){};yi.prototype.create=function(){};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};var m=function(){},ho={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};m.prototype.interfaces_=function(){return[]};m.prototype.getClass=function(){return m};m.toLocationSymbol=function(e){switch(e){case m.EXTERIOR:return"e";case m.BOUNDARY:return"b";case m.INTERIOR:return"i";case m.NONE:return"-"}throw new ct("Unknown location value: "+e)};ho.INTERIOR.get=function(){return 0};ho.BOUNDARY.get=function(){return 1};ho.EXTERIOR.get=function(){return 2};ho.NONE.get=function(){return-1};Object.defineProperties(m,ho);var G=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},xe=function(){},uu={LOG_10:{configurable:!0}};xe.prototype.interfaces_=function(){return[]};xe.prototype.getClass=function(){return xe};xe.log10=function(e){var t=Math.log(e);return z.isInfinite(t)||z.isNaN(t)?t:t/xe.LOG_10};xe.min=function(e,t,n,r){var s=e;return t<s&&(s=t),n<s&&(s=n),r<s&&(s=r),s};xe.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],s=arguments[1],l=arguments[2];return r<s?s:r>l?l:r}};xe.wrap=function(e,t){return e<0?t- -e%t:e%t};xe.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],r=e;return t>r&&(r=t),n>r&&(r=n),r}else if(arguments.length===4){var s=arguments[0],l=arguments[1],p=arguments[2],o=arguments[3],x=s;return l>x&&(x=l),p>x&&(x=p),o>x&&(x=o),x}};xe.average=function(e,t){return(e+t)/2};uu.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(xe,uu);var yn=function(e){this.str=e};yn.prototype.append=function(e){this.str+=e};yn.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};yn.prototype.toString=function(e){return this.str};var sn=function(e){this.value=e};sn.prototype.intValue=function(){return this.value};sn.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};sn.isNaN=function(e){return Number.isNaN(e)};var Zi=function(){};Zi.isWhitespace=function(e){return e<=32&&e>=0||e===127};Zi.toUpperCase=function(e){return e.toUpperCase()};var I=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];e.call(this,e.parse(r))}}else if(arguments.length===2){var s=arguments[0],l=arguments[1];this.init(s,l)}},Qe={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};I.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};I.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),r=I.magnitude(n._hi),s=I.TEN.pow(r);n=n.divide(s),n.gt(I.TEN)?(n=n.divide(I.TEN),r+=1):n.lt(I.ONE)&&(n=n.multiply(I.TEN),r-=1);for(var l=r+1,p=new yn,o=I.MAX_PRINT_DIGITS-1,x=0;x<=o;x++){e&&x===l&&p.append(".");var M=Math.trunc(n._hi);if(M<0)break;var P=!1,he=0;M>9?(P=!0,he="9"):he="0"+M,p.append(he),n=n.subtract(I.valueOf(M)).multiply(I.TEN),P&&n.selfAdd(I.TEN);var nt=!0,_e=I.magnitude(n._hi);if(_e<0&&Math.abs(_e)>=o-x&&(nt=!1),!nt)break}return t[0]=r,p.toString()};I.prototype.sqr=function(){return this.multiply(this)};I.prototype.doubleValue=function(){return this._hi+this._lo};I.prototype.subtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};I.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};I.prototype.isZero=function(){return this._hi===0&&this._lo===0};I.prototype.selfSubtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};I.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};I.prototype.min=function(e){return this.le(e)?this:e};I.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=null,l=null,p=null,o=null,x=null,M=null,P=null,he=null;return x=this._hi/n,M=I.SPLIT*x,s=M-x,he=I.SPLIT*n,s=M-s,l=x-s,p=he-n,P=x*n,p=he-p,o=n-p,he=s*p-P+s*o+l*p+l*o,M=(this._hi-P-he+this._lo-x*r)/n,he=x+M,this._hi=he,this._lo=x-he+M,this}};I.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};I.prototype.divide=function(){if(arguments[0]instanceof I){var e=arguments[0],t=null,n=null,r=null,s=null,l=null,p=null,o=null,x=null;l=this._hi/e._hi,p=I.SPLIT*l,t=p-l,x=I.SPLIT*e._hi,t=p-t,n=l-t,r=x-e._hi,o=l*e._hi,r=x-r,s=e._hi-r,x=t*r-o+t*s+n*r+n*s,p=(this._hi-o-x+this._lo-l*e._lo)/e._hi,x=l+p;var M=x,P=l-x+p;return new I(M,P)}else if(typeof arguments[0]=="number"){var he=arguments[0];return z.isNaN(he)?I.createNaN():I.copy(this).selfDivide(he,0)}};I.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};I.prototype.pow=function(e){if(e===0)return I.valueOf(1);var t=new I(this),n=I.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(t),r/=2,r>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};I.prototype.ceil=function(){if(this.isNaN())return I.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new I(e,t)};I.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};I.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};I.prototype.setValue=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};I.prototype.max=function(e){return this.ge(e)?this:e};I.prototype.sqrt=function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=I.valueOf(t),r=this.subtract(n.sqr()),s=r._hi*(e*.5);return n.add(s)};I.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,r=null,s=null,l=null,p=null,o=null;return s=this._hi+t,p=s-this._hi,l=s-p,l=t-p+(this._hi-l),o=l+this._lo,n=s+o,r=o+(s-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var x=arguments[0],M=arguments[1],P=null,he=null,nt=null,_e=null,Bt=null,Fn=null,yr=null,Io=null;Bt=this._hi+x,nt=this._lo+M,yr=Bt-this._hi,Io=nt-this._lo,Fn=Bt-yr,_e=nt-Io,Fn=x-yr+(this._hi-Fn),_e=M-Io+(this._lo-_e),yr=Fn+nt,P=Bt+yr,he=yr+(Bt-P),yr=_e+he;var rl=P+yr,Co=yr+(P-rl);return this._hi=rl,this._lo=Co,this}};I.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=null,l=null,p=null,o=null,x=null,M=null;x=I.SPLIT*this._hi,s=x-this._hi,M=I.SPLIT*n,s=x-s,l=this._hi-s,p=M-n,x=this._hi*n,p=M-p,o=n-p,M=s*p-x+s*o+l*p+l*o+(this._hi*r+this._lo*n);var P=x+M;s=x-P;var he=M+s;return this._hi=P,this._lo=he,this}};I.prototype.selfSqr=function(){return this.selfMultiply(this)};I.prototype.floor=function(){if(this.isNaN())return I.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new I(e,t)};I.prototype.negate=function(){return this.isNaN()?this:new I(-this._hi,-this._lo)};I.prototype.clone=function(){};I.prototype.multiply=function(){if(arguments[0]instanceof I){var e=arguments[0];return e.isNaN()?I.createNaN():I.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return z.isNaN(t)?I.createNaN():I.copy(this).selfMultiply(t,0)}};I.prototype.isNaN=function(){return z.isNaN(this._hi)};I.prototype.intValue=function(){return Math.trunc(this._hi)};I.prototype.toString=function(){var e=I.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};I.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),r=t[0]+1,s=n;if(n.charAt(0)===".")s="0"+n;else if(r<0)s="0."+I.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var l=r-n.length,p=I.stringOfChar("0",l);s=n+p+".0"}return this.isNegative()?"-"+s:s};I.prototype.reciprocal=function(){var e=null,t=null,n=null,r=null,s=null,l=null,p=null,o=null;s=1/this._hi,l=I.SPLIT*s,e=l-s,o=I.SPLIT*this._hi,e=l-e,t=s-e,n=o-this._hi,p=s*this._hi,n=o-n,r=this._hi-n,o=e*n-p+e*r+t*n+t*r,l=(1-p-o-s*this._lo)/this._hi;var x=s+l,M=s-x+l;return new I(x,M)};I.prototype.toSciNotation=function(){if(this.isZero())return I.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=I.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var s="";n.length>1&&(s=n.substring(1));var l=n.charAt(0)+"."+s;return this.isNegative()?"-"+l+r:l+r};I.prototype.abs=function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)};I.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};I.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};I.prototype.add=function(){if(arguments[0]instanceof I){var e=arguments[0];return I.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return I.copy(this).selfAdd(t)}};I.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof I){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};I.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};I.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};I.prototype.trunc=function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()};I.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};I.prototype.interfaces_=function(){return[Ge,ke,jo]};I.prototype.getClass=function(){return I};I.sqr=function(e){return I.valueOf(e).selfMultiply(e)};I.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return I.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new I(t)}};I.sqrt=function(e){return I.valueOf(e).sqrt()};I.parse=function(e){for(var t=0,n=e.length;Zi.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<n){var s=e.charAt(t);(s==="-"||s==="+")&&(t++,s==="-"&&(r=!0))}for(var l=new I,p=0,o=0,x=0;!(t>=n);){var M=e.charAt(t);if(t++,Zi.isDigit(M)){var P=M-"0";l.selfMultiply(I.TEN),l.selfAdd(P),p++;continue}if(M==="."){o=p;continue}if(M==="e"||M==="E"){var he=e.substring(t);try{x=sn.parseInt(he)}catch(yr){throw yr instanceof Error?new Error("Invalid exponent "+he+" in string "+e):yr}finally{}break}throw new Error("Unexpected character '"+M+"' at position "+t+" in string "+e)}var nt=l,_e=p-o-x;if(_e===0)nt=l;else if(_e>0){var Bt=I.TEN.pow(_e);nt=l.divide(Bt)}else if(_e<0){var Fn=I.TEN.pow(-_e);nt=l.multiply(Fn)}return r?nt.negate():nt};I.createNaN=function(){return new I(z.NaN,z.NaN)};I.copy=function(e){return new I(e)};I.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n)),s=Math.pow(10,r);return s*10<=t&&(r+=1),r};I.stringOfChar=function(e,t){for(var n=new yn,r=0;r<t;r++)n.append(e);return n.toString()};Qe.PI.get=function(){return new I(3.141592653589793,12246467991473532e-32)};Qe.TWO_PI.get=function(){return new I(6.283185307179586,24492935982947064e-32)};Qe.PI_2.get=function(){return new I(1.5707963267948966,6123233995736766e-32)};Qe.E.get=function(){return new I(2.718281828459045,14456468917292502e-32)};Qe.NaN.get=function(){return new I(z.NaN,z.NaN)};Qe.EPS.get=function(){return 123259516440783e-46};Qe.SPLIT.get=function(){return 134217729};Qe.MAX_PRINT_DIGITS.get=function(){return 32};Qe.TEN.get=function(){return I.valueOf(10)};Qe.ONE.get=function(){return I.valueOf(1)};Qe.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Qe.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(I,Qe);var ue=function(){},lu={DP_SAFE_EPSILON:{configurable:!0}};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.orientationIndex=function(e,t,n){var r=ue.orientationIndexFilter(e,t,n);if(r<=1)return r;var s=I.valueOf(t.x).selfAdd(-e.x),l=I.valueOf(t.y).selfAdd(-e.y),p=I.valueOf(n.x).selfAdd(-t.x),o=I.valueOf(n.y).selfAdd(-t.y);return s.selfMultiply(o).selfSubtract(l.selfMultiply(p)).signum()};ue.signOfDet2x2=function(e,t,n,r){var s=e.multiply(r).selfSubtract(t.multiply(n));return s.signum()};ue.intersection=function(e,t,n,r){var s=I.valueOf(r.y).selfSubtract(n.y).selfMultiply(I.valueOf(t.x).selfSubtract(e.x)),l=I.valueOf(r.x).selfSubtract(n.x).selfMultiply(I.valueOf(t.y).selfSubtract(e.y)),p=s.subtract(l),o=I.valueOf(r.x).selfSubtract(n.x).selfMultiply(I.valueOf(e.y).selfSubtract(n.y)),x=I.valueOf(r.y).selfSubtract(n.y).selfMultiply(I.valueOf(e.x).selfSubtract(n.x)),M=o.subtract(x),P=M.selfDivide(p).doubleValue(),he=I.valueOf(e.x).selfAdd(I.valueOf(t.x).selfSubtract(e.x).selfMultiply(P)).doubleValue(),nt=I.valueOf(t.x).selfSubtract(e.x).selfMultiply(I.valueOf(e.y).selfSubtract(n.y)),_e=I.valueOf(t.y).selfSubtract(e.y).selfMultiply(I.valueOf(e.x).selfSubtract(n.x)),Bt=nt.subtract(_e),Fn=Bt.selfDivide(p).doubleValue(),yr=I.valueOf(n.y).selfAdd(I.valueOf(r.y).selfSubtract(n.y).selfMultiply(Fn)).doubleValue();return new v(he,yr)};ue.orientationIndexFilter=function(e,t,n){var r=null,s=(e.x-n.x)*(t.y-n.y),l=(e.y-n.y)*(t.x-n.x),p=s-l;if(s>0){if(l<=0)return ue.signum(p);r=s+l}else if(s<0){if(l>=0)return ue.signum(p);r=-s-l}else return ue.signum(p);var o=ue.DP_SAFE_EPSILON*r;return p>=o||-p>=o?ue.signum(p):2};ue.signum=function(e){return e>0?1:e<0?-1:0};lu.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ue,lu);var Q=function(){},go={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};go.X.get=function(){return 0};go.Y.get=function(){return 1};go.Z.get=function(){return 2};go.M.get=function(){return 3};Q.prototype.setOrdinate=function(e,t,n){};Q.prototype.size=function(){};Q.prototype.getOrdinate=function(e,t){};Q.prototype.getCoordinate=function(){};Q.prototype.getCoordinateCopy=function(e){};Q.prototype.getDimension=function(){};Q.prototype.getX=function(e){};Q.prototype.clone=function(){};Q.prototype.expandEnvelope=function(e){};Q.prototype.copy=function(){};Q.prototype.getY=function(e){};Q.prototype.toCoordinateArray=function(){};Q.prototype.interfaces_=function(){return[jo]};Q.prototype.getClass=function(){return Q};Object.defineProperties(Q,go);var cu=function(){},ki=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cu),Ut=function(){};Ut.arraycopy=function(e,t,n,r,s){for(var l=0,p=t;p<t+s;p++)n[r+l]=e[p],l++};Ut.getProperty=function(e){return{"line.separator":`
`}[e]};var Ve=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var s=arguments[0],l=arguments[1];this.x=s.y*l.w-l.y*s.w,this.y=l.x*s.w-s.x*l.w,this.w=s.x*l.y-l.x*s.y}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var p=arguments[0],o=arguments[1];this.x=p.y-o.y,this.y=o.x-p.x,this.w=p.x*o.y-o.x*p.y}}else if(arguments.length===3){var x=arguments[0],M=arguments[1],P=arguments[2];this.x=x,this.y=M,this.w=P}else if(arguments.length===4){var he=arguments[0],nt=arguments[1],_e=arguments[2],Bt=arguments[3],Fn=he.y-nt.y,yr=nt.x-he.x,Io=he.x*nt.y-nt.x*he.y,rl=_e.y-Bt.y,Co=Bt.x-_e.x,as=_e.x*Bt.y-Bt.x*_e.y;this.x=yr*as-Co*Io,this.y=rl*Io-Fn*as,this.w=Fn*Co-rl*yr}};Ve.prototype.getY=function(){var e=this.y/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getX=function(){var e=this.x/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getCoordinate=function(){var e=new v;return e.x=this.getX(),e.y=this.getY(),e};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=function(){return Ve};Ve.intersection=function(e,t,n,r){var s=e.y-t.y,l=t.x-e.x,p=e.x*t.y-t.x*e.y,o=n.y-r.y,x=r.x-n.x,M=n.x*r.y-r.x*n.y,P=l*M-x*p,he=o*p-s*M,nt=s*x-o*l,_e=P/nt,Bt=he/nt;if(z.isNaN(_e)||z.isInfinite(_e)||z.isNaN(Bt)||z.isInfinite(Bt))throw new ki;return new v(_e,Bt)};var T=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof v){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.init(r.x,s.x,r.y,s.y)}else if(arguments.length===4){var l=arguments[0],p=arguments[1],o=arguments[2],x=arguments[3];this.init(l,p,o,x)}},fu={serialVersionUID:{configurable:!0}};T.prototype.getArea=function(){return this.getWidth()*this.getHeight()};T.prototype.equals=function(e){if(!(e instanceof T))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};T.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new T;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,s=this._maxy<e._maxy?this._maxy:e._maxy;return new T(t,r,n,s)};T.prototype.isNull=function(){return this._maxx<this._minx};T.prototype.getMaxX=function(){return this._maxx};T.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};T.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof v){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};T.prototype.getMinY=function(){return this._miny};T.prototype.getMinX=function(){return this._minx};T.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};T.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};T.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};T.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};T.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};T.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};T.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};T.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};T.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};T.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};T.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};T.prototype.centre=function(){return this.isNull()?null:new v((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};T.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var s=arguments[0],l=arguments[1],p=arguments[2],o=arguments[3];s<l?(this._minx=s,this._maxx=l):(this._minx=l,this._maxx=s),p<o?(this._miny=p,this._maxy=o):(this._miny=o,this._maxy=p)}};T.prototype.getMaxY=function(){return this._maxy};T.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};T.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this._minx),e=37*e+v.hashCode(this._maxx),e=37*e+v.hashCode(this._miny),e=37*e+v.hashCode(this._maxy),e};T.prototype.interfaces_=function(){return[ke,Ge]};T.prototype.getClass=function(){return T};T.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var r=arguments[0],s=arguments[1],l=arguments[2],p=arguments[3],o=Math.min(l.x,p.x),x=Math.max(l.x,p.x),M=Math.min(r.x,s.x),P=Math.max(r.x,s.x);return!(M>x||P<o||(o=Math.min(l.y,p.y),x=Math.max(l.y,p.y),M=Math.min(r.y,s.y),P=Math.max(r.y,s.y),M>x)||P<o)}};fu.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(T,fu);var Ze={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ko=function(e){this.geometryFactory=e||new H};Ko.prototype.read=function(e){var t,n,r;e=e.replace(/[\n\r]/g," ");var s=Ze.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(s=Ze.emptyTypeStr.exec(e),s[2]=void 0),s&&(n=s[1].toLowerCase(),r=s[2],pi[n]&&(t=pi[n].apply(this,[r]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};Ko.prototype.write=function(e){return this.extractGeometry(e)};Ko.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Un[t])return null;var n=t.toUpperCase(),r;return e.isEmpty()?r=n+" EMPTY":r=n+"("+Un[t].apply(this,[e])+")",r};var Un={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Un.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],r=0,s=e._geometries.length;r<s;++r)n.push("("+Un.point.apply(t,[e._geometries[r]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],r=0,s=e._points._coordinates.length;r<s;++r)n.push(Un.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],r=0,s=e._points._coordinates.length;r<s;++r)n.push(Un.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],r=0,s=e._geometries.length;r<s;++r)n.push("("+Un.linestring.apply(t,[e._geometries[r]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+Un.linestring.apply(this,[e._shell])+")");for(var r=0,s=e._holes.length;r<s;++r)n.push("("+Un.linestring.apply(t,[e._holes[r]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],r=0,s=e._geometries.length;r<s;++r)n.push("("+Un.polygon.apply(t,[e._geometries[r]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],r=0,s=e._geometries.length;r<s;++r)n.push(t.extractGeometry(e._geometries[r]));return n.join(",")}},pi={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Ze.spaces);return this.geometryFactory.createPoint(new v(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=e.trim().split(","),s=[],l=0,p=r.length;l<p;++l)n=r[l].replace(Ze.trimParens,"$1"),s.push(pi.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(s)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],r,s=0,l=t.length;s<l;++s)r=t[s].trim().split(Ze.spaces),n.push(new v(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],r,s=0,l=t.length;s<l;++s)r=t[s].trim().split(Ze.spaces),n.push(new v(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=e.trim().split(Ze.parenComma),s=[],l=0,p=r.length;l<p;++l)n=r[l].replace(Ze.trimParens,"$1"),s.push(pi.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(s)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,r,s,l=e.trim().split(Ze.parenComma),p,o=[],x=0,M=l.length;x<M;++x)n=l[x].replace(Ze.trimParens,"$1"),r=pi.linestring.apply(t,[n]),s=t.geometryFactory.createLinearRing(r._points),x===0?p=s:o.push(s);return this.geometryFactory.createPolygon(p,o)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=e.trim().split(Ze.doubleParenComma),s=[],l=0,p=r.length;l<p;++l)n=r[l].replace(Ze.trimParens,"$1"),s.push(pi.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(s)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),r=[],s=0,l=n.length;s<l;++s)r.push(t.read(n[s]));return this.geometryFactory.createGeometryCollection(r)}},qe=function(e){this.parser=new Ko(e)};qe.prototype.write=function(e){return this.parser.write(e)};qe.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Kn=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Bo=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kn),U=function(){};U.prototype.interfaces_=function(){return[]};U.prototype.getClass=function(){return U};U.shouldNeverReachHere=function(){if(arguments.length===0)U.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Bo("Should never reach here"+(e!==null?": "+e:""))}};U.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],U.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Bo:new Bo(t)};U.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],U.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new Bo("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var ft=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new v,this._intPt[1]=new v,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ai={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ft.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};ft.prototype.getTopologySummary=function(){var e=new yn;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};ft.prototype.computeIntersection=function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)};ft.prototype.getIntersectionNum=function(){return this._result};ft.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};ft.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};ft.prototype.setPrecisionModel=function(e){this._precisionModel=e};ft.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};ft.prototype.getIntersection=function(e){return this._intPt[e]};ft.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};ft.prototype.hasIntersection=function(){return this._result!==ft.NO_INTERSECTION};ft.prototype.getEdgeDistance=function(e,t){var n=ft.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};ft.prototype.isCollinear=function(){return this._result===ft.COLLINEAR_INTERSECTION};ft.prototype.toString=function(){return qe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};ft.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};ft.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};ft.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};ft.prototype.interfaces_=function(){return[]};ft.prototype.getClass=function(){return ft};ft.computeEdgeDistance=function(e,t,n){var r=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),l=-1;if(e.equals(t))l=0;else if(e.equals(n))r>s?l=r:l=s;else{var p=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);r>s?l=p:l=o,l===0&&!e.equals(t)&&(l=Math.max(p,o))}return U.isTrue(!(l===0&&!e.equals(t)),"Bad distance calculation"),l};ft.nonRobustComputeEdgeDistance=function(e,t,n){var r=e.x-t.x,s=e.y-t.y,l=Math.sqrt(r*r+s*s);return U.isTrue(!(l===0&&!e.equals(t)),"Invalid distance calculation"),l};ai.DONT_INTERSECT.get=function(){return 0};ai.DO_INTERSECT.get=function(){return 1};ai.COLLINEAR.get=function(){return 2};ai.NO_INTERSECTION.get=function(){return 0};ai.POINT_INTERSECTION.get=function(){return 1};ai.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(ft,ai);var zr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var r=new T(this._inputLines[0][0],this._inputLines[0][1]),s=new T(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&s.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];if(this._isProper=!1,T.intersects(r,s,n)&&O.orientationIndex(r,s,n)===0&&O.orientationIndex(s,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(s))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,r,s,l,p){p.x=this.smallestInAbsValue(n.x,r.x,s.x,l.x),p.y=this.smallestInAbsValue(n.y,r.y,s.y,l.y),n.x-=p.x,n.y-=p.y,r.x-=p.x,r.y-=p.y,s.x-=p.x,s.y-=p.y,l.x-=p.x,l.y-=p.y},t.prototype.safeHCoordinateIntersection=function(n,r,s,l){var p=null;try{p=Ve.intersection(n,r,s,l)}catch(o){if(o instanceof ki)p=t.nearestEndpoint(n,r,s,l);else throw o}finally{}return p},t.prototype.intersection=function(n,r,s,l){var p=this.intersectionWithNormalization(n,r,s,l);return this.isInSegmentEnvelopes(p)||(p=new v(t.nearestEndpoint(n,r,s,l))),this._precisionModel!==null&&this._precisionModel.makePrecise(p),p},t.prototype.smallestInAbsValue=function(n,r,s,l){var p=n,o=Math.abs(p);return Math.abs(r)<o&&(p=r,o=Math.abs(r)),Math.abs(s)<o&&(p=s,o=Math.abs(s)),Math.abs(l)<o&&(p=l),p},t.prototype.checkDD=function(n,r,s,l,p){var o=ue.intersection(n,r,s,l),x=this.isInSegmentEnvelopes(o);Ut.out.println("DD in env = "+x+"  --------------------- "+o),p.distance(o)>1e-4&&Ut.out.println("Distance = "+p.distance(o))},t.prototype.intersectionWithNormalization=function(n,r,s,l){var p=new v(n),o=new v(r),x=new v(s),M=new v(l),P=new v;this.normalizeToEnvCentre(p,o,x,M,P);var he=this.safeHCoordinateIntersection(p,o,x,M);return he.x+=P.x,he.y+=P.y,he},t.prototype.computeCollinearIntersection=function(n,r,s,l){var p=T.intersects(n,r,s),o=T.intersects(n,r,l),x=T.intersects(s,l,n),M=T.intersects(s,l,r);return p&&o?(this._intPt[0]=s,this._intPt[1]=l,e.COLLINEAR_INTERSECTION):x&&M?(this._intPt[0]=n,this._intPt[1]=r,e.COLLINEAR_INTERSECTION):p&&x?(this._intPt[0]=s,this._intPt[1]=n,s.equals(n)&&!o&&!M?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):p&&M?(this._intPt[0]=s,this._intPt[1]=r,s.equals(r)&&!o&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&x?(this._intPt[0]=l,this._intPt[1]=n,l.equals(n)&&!p&&!M?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&M?(this._intPt[0]=l,this._intPt[1]=r,l.equals(r)&&!p&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,r,s,l,p){var o=n.x<r.x?n.x:r.x,x=n.y<r.y?n.y:r.y,M=n.x>r.x?n.x:r.x,P=n.y>r.y?n.y:r.y,he=s.x<l.x?s.x:l.x,nt=s.y<l.y?s.y:l.y,_e=s.x>l.x?s.x:l.x,Bt=s.y>l.y?s.y:l.y,Fn=o>he?o:he,yr=M<_e?M:_e,Io=x>nt?x:nt,rl=P<Bt?P:Bt,Co=(Fn+yr)/2,as=(Io+rl)/2;p.x=Co,p.y=as,n.x-=p.x,n.y-=p.y,r.x-=p.x,r.y-=p.y,s.x-=p.x,s.y-=p.y,l.x-=p.x,l.y-=p.y},t.prototype.computeIntersect=function(n,r,s,l){if(this._isProper=!1,!T.intersects(n,r,s,l))return e.NO_INTERSECTION;var p=O.orientationIndex(n,r,s),o=O.orientationIndex(n,r,l);if(p>0&&o>0||p<0&&o<0)return e.NO_INTERSECTION;var x=O.orientationIndex(s,l,n),M=O.orientationIndex(s,l,r);if(x>0&&M>0||x<0&&M<0)return e.NO_INTERSECTION;var P=p===0&&o===0&&x===0&&M===0;return P?this.computeCollinearIntersection(n,r,s,l):(p===0||o===0||x===0||M===0?(this._isProper=!1,n.equals2D(s)||n.equals2D(l)?this._intPt[0]=n:r.equals2D(s)||r.equals2D(l)?this._intPt[0]=r:p===0?this._intPt[0]=new v(s):o===0?this._intPt[0]=new v(l):x===0?this._intPt[0]=new v(n):M===0&&(this._intPt[0]=new v(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,s,l)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,r,s,l){var p=n,o=O.distancePointLine(n,s,l),x=O.distancePointLine(r,s,l);return x<o&&(o=x,p=r),x=O.distancePointLine(s,n,r),x<o&&(o=x,p=s),x=O.distancePointLine(l,n,r),x<o&&(o=x,p=l),p},t}(ft),Kr=function(){};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};Kr.orientationIndex=function(e,t,n){var r=t.x-e.x,s=t.y-e.y,l=n.x-t.x,p=n.y-t.y;return Kr.signOfDet2x2(r,s,l,p)};Kr.signOfDet2x2=function(e,t,n,r){var s=null,l=null,p=null;if(s=1,e===0||r===0)return t===0||n===0?0:t>0?n>0?-s:s:n>0?s:-s;if(t===0||n===0)return r>0?e>0?s:-s:e>0?-s:s;if(t>0?r>0?t<=r||(s=-s,l=e,e=n,n=l,l=t,t=r,r=l):t<=-r?(s=-s,n=-n,r=-r):(l=e,e=-n,n=l,l=t,t=-r,r=l):r>0?-t<=r?(s=-s,e=-e,t=-t):(l=-e,e=n,n=l,l=-t,t=r,r=l):t>=r?(e=-e,t=-t,n=-n,r=-r):(s=-s,l=-e,e=-n,n=l,l=-t,t=-r,r=l),e>0)if(n>0){if(!(e<=n))return s}else return s;else{if(n>0)return-s;if(e>=n)s=-s,e=-e,n=-n;else return-s}for(;;){if(p=Math.floor(n/e),n=n-p*e,r=r-p*t,r<0)return-s;if(r>t)return s;if(e>n+n){if(t<r+r)return s}else{if(t>r+r)return-s;n=e-n,r=t-r,s=-s}if(r===0)return n===0?0:-s;if(n===0||(p=Math.floor(e/n),e=e-p*n,t=t-p*r,t<0))return s;if(t>r)return-s;if(n>e+e){if(r<t+t)return-s}else{if(r>t+t)return s;e=n-e,t=r-t,s=-s}if(t===0)return e===0?0:s;if(e===0)return-s}};var rn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};rn.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var s=e.x-this._p.x,l=e.y-this._p.y,p=t.x-this._p.x,o=t.y-this._p.y,x=Kr.signOfDet2x2(s,l,p,o);if(x===0)return this._isPointOnSegment=!0,null;o<l&&(x=-x),x>0&&this._crossingCount++}};rn.prototype.isPointInPolygon=function(){return this.getLocation()!==m.EXTERIOR};rn.prototype.getLocation=function(){return this._isPointOnSegment?m.BOUNDARY:this._crossingCount%2===1?m.INTERIOR:m.EXTERIOR};rn.prototype.isOnSegment=function(){return this._isPointOnSegment};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.locatePointInRing=function(){if(arguments[0]instanceof v&&G(arguments[1],Q)){for(var e=arguments[0],t=arguments[1],n=new rn(e),r=new v,s=new v,l=1;l<t.size();l++)if(t.getCoordinate(l,r),t.getCoordinate(l-1,s),n.countSegment(r,s),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof v&&arguments[1]instanceof Array){for(var p=arguments[0],o=arguments[1],x=new rn(p),M=1;M<o.length;M++){var P=o[M],he=o[M-1];if(x.countSegment(P,he),x.isOnSegment())return x.getLocation()}return x.getLocation()}};var O=function(){},ui={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};O.prototype.interfaces_=function(){return[]};O.prototype.getClass=function(){return O};O.orientationIndex=function(e,t,n){return ue.orientationIndex(e,t,n)};O.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var s=e[r].x-n,l=e[r+1].y,p=e[r-1].y;t+=s*(p-l)}return t/2}else if(G(arguments[0],Q)){var o=arguments[0],x=o.size();if(x<3)return 0;var M=new v,P=new v,he=new v;o.getCoordinate(0,P),o.getCoordinate(1,he);var nt=P.x;he.x-=nt;for(var _e=0,Bt=1;Bt<x-1;Bt++)M.y=P.y,P.x=he.x,P.y=he.y,o.getCoordinate(Bt+1,he),he.x-=nt,_e+=P.x*(M.y-he.y);return _e/2}};O.distanceLineLine=function(e,t,n,r){if(e.equals(t))return O.distancePointLine(e,n,r);if(n.equals(r))return O.distancePointLine(r,e,t);var s=!1;if(!T.intersects(e,t,n,r))s=!0;else{var l=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(l===0)s=!0;else{var p=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),o=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),x=o/l,M=p/l;(M<0||M>1||x<0||x>1)&&(s=!0)}}return s?xe.min(O.distancePointLine(e,n,r),O.distancePointLine(t,n,r),O.distancePointLine(n,e,t),O.distancePointLine(r,e,t)):0};O.isPointInRing=function(e,t){return O.locatePointInRing(e,t)!==m.EXTERIOR};O.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new v;e.getCoordinate(0,r);for(var s=r.x,l=r.y,p=1;p<t;p++){e.getCoordinate(p,r);var o=r.x,x=r.y,M=o-s,P=x-l;n+=Math.sqrt(M*M+P*P),s=o,l=x}return n};O.isCCW=function(e){var t=e.length-1;if(t<3)throw new ct("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],r=0,s=1;s<=t;s++){var l=e[s];l.y>n.y&&(n=l,r=s)}var p=r;do p=p-1,p<0&&(p=t);while(e[p].equals2D(n)&&p!==r);var o=r;do o=(o+1)%t;while(e[o].equals2D(n)&&o!==r);var x=e[p],M=e[o];if(x.equals2D(n)||M.equals2D(n)||x.equals2D(M))return!1;var P=O.computeOrientation(x,n,M),he=!1;return P===0?he=x.x>M.x:he=P>0,he};O.locatePointInRing=function(e,t){return rn.locatePointInRing(e,t)};O.distancePointLinePerpendicular=function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),s=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(s)*Math.sqrt(r)};O.computeOrientation=function(e,t,n){return O.orientationIndex(e,t,n)};O.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new ct("Line array must contain at least one vertex");for(var n=e.distance(t[0]),r=0;r<t.length-1;r++){var s=O.distancePointLine(e,t[r],t[r+1]);s<n&&(n=s)}return n}else if(arguments.length===3){var l=arguments[0],p=arguments[1],o=arguments[2];if(p.x===o.x&&p.y===o.y)return l.distance(p);var x=(o.x-p.x)*(o.x-p.x)+(o.y-p.y)*(o.y-p.y),M=((l.x-p.x)*(o.x-p.x)+(l.y-p.y)*(o.y-p.y))/x;if(M<=0)return l.distance(p);if(M>=1)return l.distance(o);var P=((p.y-l.y)*(o.x-p.x)-(p.x-l.x)*(o.y-p.y))/x;return Math.abs(P)*Math.sqrt(x)}};O.isOnLine=function(e,t){for(var n=new zr,r=1;r<t.length;r++){var s=t[r-1],l=t[r];if(n.computeIntersection(e,s,l),n.hasIntersection())return!0}return!1};ui.CLOCKWISE.get=function(){return-1};ui.RIGHT.get=function(){return O.CLOCKWISE};ui.COUNTERCLOCKWISE.get=function(){return 1};ui.LEFT.get=function(){return O.COUNTERCLOCKWISE};ui.COLLINEAR.get=function(){return 0};ui.STRAIGHT.get=function(){return O.COLLINEAR};Object.defineProperties(O,ui);var Qn=function(){};Qn.prototype.filter=function(e){};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};var k=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},An={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};k.prototype.isGeometryCollection=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION};k.prototype.getFactory=function(){return this._factory};k.prototype.getGeometryN=function(e){return this};k.prototype.getArea=function(){return 0};k.prototype.isRectangle=function(){return!1};k.prototype.equals=function(){if(arguments[0]instanceof k){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof k))return!1;var n=t;return this.equalsExact(n)}};k.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};k.prototype.geometryChanged=function(){this.apply(k.geometryChangedFilter)};k.prototype.geometryChangedAction=function(){this._envelope=null};k.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};k.prototype.getLength=function(){return 0};k.prototype.getNumGeometries=function(){return 1};k.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};k.prototype.getUserData=function(){return this._userData};k.prototype.getSRID=function(){return this._SRID};k.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};k.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION)throw new ct("This method does not support GeometryCollection arguments")};k.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};k.prototype.norm=function(){var e=this.copy();return e.normalize(),e};k.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};k.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new T(this._envelope)};k.prototype.setSRID=function(e){this._SRID=e};k.prototype.setUserData=function(e){this._userData=e};k.prototype.compare=function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var s=n.next(),l=r.next(),p=s.compareTo(l);if(p!==0)return p}return n.hasNext()?1:r.hasNext()?-1:0};k.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};k.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===k.SORTINDEX_MULTIPOINT||this.getSortIndex()===k.SORTINDEX_MULTILINESTRING||this.getSortIndex()===k.SORTINDEX_MULTIPOLYGON};k.prototype.interfaces_=function(){return[jo,ke,Ge]};k.prototype.getClass=function(){return k};k.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};k.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};An.serialVersionUID.get=function(){return 8763622679187377e3};An.SORTINDEX_POINT.get=function(){return 0};An.SORTINDEX_MULTIPOINT.get=function(){return 1};An.SORTINDEX_LINESTRING.get=function(){return 2};An.SORTINDEX_LINEARRING.get=function(){return 3};An.SORTINDEX_MULTILINESTRING.get=function(){return 4};An.SORTINDEX_POLYGON.get=function(){return 5};An.SORTINDEX_MULTIPOLYGON.get=function(){return 6};An.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};An.geometryChangedFilter.get=function(){return As};Object.defineProperties(k,An);var As=function(){};As.interfaces_=function(){return[Qn]};As.filter=function(e){e.geometryChangedAction()};var wn=function(){};wn.prototype.filter=function(e){};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};var Me=function(){},er={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Me.prototype.isInBoundary=function(e){};Me.prototype.interfaces_=function(){return[]};Me.prototype.getClass=function(){return Me};er.Mod2BoundaryNodeRule.get=function(){return mi};er.EndPointBoundaryNodeRule.get=function(){return _i};er.MultiValentEndPointBoundaryNodeRule.get=function(){return Ei};er.MonoValentEndPointBoundaryNodeRule.get=function(){return Ii};er.MOD2_BOUNDARY_RULE.get=function(){return new mi};er.ENDPOINT_BOUNDARY_RULE.get=function(){return new _i};er.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ei};er.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ii};er.OGC_SFS_BOUNDARY_RULE.get=function(){return Me.MOD2_BOUNDARY_RULE};Object.defineProperties(Me,er);var mi=function(){};mi.prototype.isInBoundary=function(e){return e%2===1};mi.prototype.interfaces_=function(){return[Me]};mi.prototype.getClass=function(){return mi};var _i=function(){};_i.prototype.isInBoundary=function(e){return e>0};_i.prototype.interfaces_=function(){return[Me]};_i.prototype.getClass=function(){return _i};var Ei=function(){};Ei.prototype.isInBoundary=function(e){return e>1};Ei.prototype.interfaces_=function(){return[Me]};Ei.prototype.getClass=function(){return Ei};var Ii=function(){};Ii.prototype.isInBoundary=function(e){return e===1};Ii.prototype.interfaces_=function(){return[Me]};Ii.prototype.getClass=function(){return Ii};var wt=function(){};wt.prototype.add=function(){};wt.prototype.addAll=function(){};wt.prototype.isEmpty=function(){};wt.prototype.iterator=function(){};wt.prototype.size=function(){};wt.prototype.toArray=function(){};wt.prototype.remove=function(){};function Fs(e){this.message=e||""}Fs.prototype=new Error;Fs.prototype.name="IndexOutOfBoundsException";var Gi=function(){};Gi.prototype.hasNext=function(){};Gi.prototype.next=function(){};Gi.prototype.remove=function(){};var Ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(wt);function zi(e){this.message=e||""}zi.prototype=new Error;zi.prototype.name="NoSuchElementException";var b=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,wt]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var r=this,s=n.iterator();s.hasNext();)r.add(s.next());return!0},t.prototype.set=function(n,r){var s=this.array_[n];return this.array_[n]=r,s},t.prototype.iterator=function(){return new Cc(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new Fs;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,r=[],s=0,l=this.array_.length;s<l;s++)r.push(n.array_[s]);return r},t.prototype.remove=function(n){for(var r=this,s=!1,l=0,p=this.array_.length;l<p;l++)if(r.array_[l]===n){r.array_.splice(l,1),s=!0;break}return s},t}(Ue),Cc=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new zi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Gi),po=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var s=arguments[0],l=arguments[1];this.ensureCapacity(s.length),this.add(s,l)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(r){return this.get(r)},t.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var s=arguments[0],l=arguments[1],p=!1,o=s.iterator();o.hasNext();)r.add(o.next(),l),p=!0;return p}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var r=this,s=e.prototype.clone.call(this),l=0;l<this.size();l++)s.add(l,r.get(l).copy());return s},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var r=this;if(arguments.length===1){var s=arguments[0];e.prototype.add.call(this,s)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var l=arguments[0],p=arguments[1];return this.add(l,p,!0),!0}else if(arguments[0]instanceof v&&typeof arguments[1]=="boolean"){var o=arguments[0],x=arguments[1];if(!x&&this.size()>=1){var M=this.get(this.size()-1);if(M.equals2D(o))return null}e.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var P=arguments[0],he=arguments[1];return this.add(P,he),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var nt=arguments[0],_e=arguments[1],Bt=arguments[2];if(Bt)for(var Fn=0;Fn<nt.length;Fn++)r.add(nt[Fn],_e);else for(var yr=nt.length-1;yr>=0;yr--)r.add(nt[yr],_e);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2];if(!Co){var as=this.size();if(as>0){if(Io>0){var Js=this.get(Io-1);if(Js.equals2D(rl))return null}if(Io<as){var lh=this.get(Io);if(lh.equals2D(rl))return null}}}e.prototype.add.call(this,Io,rl)}}else if(arguments.length===4){var ch=arguments[0],Zu=arguments[1],th=arguments[2],sl=arguments[3],sh=1;th>sl&&(sh=-1);for(var xh=th;xh!==sl;xh+=sh)r.add(ch[xh],Zu);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new v(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(b),W=function(){},Qo={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Qo.ForwardComparator.get=function(){return $i};Qo.BidirectionalComparator.get=function(){return Ci};Qo.coordArrayType.get=function(){return new Array(0).fill(null)};W.prototype.interfaces_=function(){return[]};W.prototype.getClass=function(){return W};W.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};W.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(W.indexOf(r,t)<0)return r}return null};W.scroll=function(e,t){var n=W.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);Ut.arraycopy(e,n,r,0,e.length-n),Ut.arraycopy(e,0,r,e.length-n,n),Ut.arraycopy(r,0,e,0,e.length)};W.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2];if(r===s)return!0;if(r===null||s===null||r.length!==s.length)return!1;for(var p=0;p<r.length;p++)if(l.compare(r[p],s[p])!==0)return!1;return!0}};W.intersection=function(e,t){for(var n=new po,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()};W.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};W.removeRepeatedPoints=function(e){if(!W.hasRepeatedPoints(e))return e;var t=new po(e,!1);return t.toCoordinateArray()};W.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var s=e[r];e[r]=e[t-r],e[t-r]=s}};W.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var r=new Array(t).fill(null);if(t===0)return r;for(var s=0,l=0;l<e.length;l++)e[l]!==null&&(r[s++]=e[l]);return r};W.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new v(e[n]);return t}else if(arguments.length===5)for(var r=arguments[0],s=arguments[1],l=arguments[2],p=arguments[3],o=arguments[4],x=0;x<o;x++)l[p+x]=new v(r[s+x])};W.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],s=t[e.length-n-1];if(r.compareTo(s)!==0)return!1}return!0};W.envelope=function(e){for(var t=new T,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};W.toCoordinateArray=function(e){return e.toArray(W.coordArrayType)};W.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};W.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};W.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(r!==0)return r}return 1};W.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(r!==0)return r;n++}return n<t.length?-1:n<e.length?1:0};W.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};W.extract=function(e,t,n){t=xe.clamp(t,0,e.length),n=xe.clamp(n,-1,e.length);var r=n-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var s=new Array(r).fill(null);if(r===0)return s;for(var l=0,p=t;p<=n;p++)s[l++]=e[p];return s};Object.defineProperties(W,Qo);var $i=function(){};$i.prototype.compare=function(e,t){var n=e,r=t;return W.compare(n,r)};$i.prototype.interfaces_=function(){return[vi]};$i.prototype.getClass=function(){return $i};var Ci=function(){};Ci.prototype.compare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var s=W.compare(n,r),l=W.isEqualReversed(n,r);return l?0:s};Ci.prototype.OLDcompare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var s=W.increasingDirection(n),l=W.increasingDirection(r),p=s>0?0:n.length-1,o=l>0?0:n.length-1,x=0;x<n.length;x++){var M=n[p].compareTo(r[o]);if(M!==0)return M;p+=s,o+=l}return 0};Ci.prototype.interfaces_=function(){return[vi]};Ci.prototype.getClass=function(){return Ci};var li=function(){};li.prototype.get=function(){};li.prototype.put=function(){};li.prototype.size=function(){};li.prototype.values=function(){};li.prototype.entrySet=function(){};var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(li);function vo(e){this.message=e||""}vo.prototype=new Error;vo.prototype.name="OperationNotSupported";function Jo(){}Jo.prototype=new wt;Jo.prototype.contains=function(){};var Bs=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var r=this,s=0,l=this.array_.length;s<l;s++){var p=r.array_[s];if(p===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var r=this,s=n.iterator();s.hasNext();)r.add(s.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,r=[],s=0,l=this.array_.length;s<l;s++)r.push(n.array_[s]);return r},t.prototype.iterator=function(){return new xc(this)},t}(Jo),xc=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new zi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new vo},t}(Gi),Yn=0,_r=1;function xa(e){return e===null?Yn:e.color}function st(e){return e===null?null:e.parent}function Vn(e,t){e!==null&&(e.color=t)}function ps(e){return e===null?null:e.left}function Sa(e){return e===null?null:e.right}function jt(){this.root_=null,this.size_=0}jt.prototype=new Nc;jt.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};jt.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,s;do if(r=n,s=e.compareTo(n.key),s<0)n=n.left;else if(s>0)n=n.right;else{var l=n.value;return n.value=t,l}while(n!==null);var p={key:e,left:null,right:null,value:t,parent:r,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}};return s<0?r.left=p:r.right=p,this.fixAfterInsertion(p),this.size_++,null};jt.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=_r;e!=null&&e!==this.root_&&e.parent.color===_r;)if(st(e)===ps(st(st(e)))){var n=Sa(st(st(e)));xa(n)===_r?(Vn(st(e),Yn),Vn(n,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===Sa(st(e))&&(e=st(e),t.rotateLeft(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateRight(st(st(e))))}else{var r=ps(st(st(e)));xa(r)===_r?(Vn(st(e),Yn),Vn(r,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===ps(st(e))&&(e=st(e),t.rotateRight(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateLeft(st(st(e))))}this.root_.color=Yn};jt.prototype.values=function(){var e=new b,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=jt.successor(t))!==null;)e.add(t.value);return e};jt.prototype.entrySet=function(){var e=new Bs,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=jt.successor(t))!==null;)e.add(t);return e};jt.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};jt.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};jt.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};jt.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,r=e;n!==null&&r===n.right;)r=n,n=n.parent;return n}};jt.prototype.size=function(){return this.size_};var to=function(){};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};function hu(){}hu.prototype=new Jo;function an(){this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}an.prototype=new hu;an.prototype.contains=function(e){for(var t=this,n=0,r=this.array_.length;n<r;n++){var s=t.array_[n];if(s.compareTo(e)===0)return!0}return!1};an.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,r=this.array_.length;n<r;n++){var s=t.array_[n];if(s.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};an.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};an.prototype.remove=function(e){throw new vo};an.prototype.size=function(){return this.array_.length};an.prototype.isEmpty=function(){return this.array_.length===0};an.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};an.prototype.iterator=function(){return new Zo(this)};var Zo=function(e){this.treeSet_=e,this.position_=0};Zo.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new zi;return this.treeSet_.array_[this.position_++]};Zo.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Zo.prototype.remove=function(){throw new vo};var Nr=function(){};Nr.sort=function(){var e=arguments[0],t,n,r,s;if(arguments.length===1)s=function(p,o){return p.compareTo(o)},e.sort(s);else if(arguments.length===2)r=arguments[1],s=function(p,o){return r.compare(p,o)},e.sort(s);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var l=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),r=arguments[3],s=function(p,o){return r.compare(p,o)},n.sort(s),l=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])};Nr.asList=function(e){for(var t=new b,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};var J=function(){},Je={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Je.P.get=function(){return 0};Je.L.get=function(){return 1};Je.A.get=function(){return 2};Je.FALSE.get=function(){return-1};Je.TRUE.get=function(){return-2};Je.DONTCARE.get=function(){return-3};Je.SYM_FALSE.get=function(){return"F"};Je.SYM_TRUE.get=function(){return"T"};Je.SYM_DONTCARE.get=function(){return"*"};Je.SYM_P.get=function(){return"0"};Je.SYM_L.get=function(){return"1"};Je.SYM_A.get=function(){return"2"};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.toDimensionSymbol=function(e){switch(e){case J.FALSE:return J.SYM_FALSE;case J.TRUE:return J.SYM_TRUE;case J.DONTCARE:return J.SYM_DONTCARE;case J.P:return J.SYM_P;case J.L:return J.SYM_L;case J.A:return J.SYM_A}throw new ct("Unknown dimension value: "+e)};J.toDimensionValue=function(e){switch(Zi.toUpperCase(e)){case J.SYM_FALSE:return J.FALSE;case J.SYM_TRUE:return J.TRUE;case J.SYM_DONTCARE:return J.DONTCARE;case J.SYM_P:return J.P;case J.SYM_L:return J.L;case J.SYM_A:return J.A}throw new ct("Unknown dimension symbol: "+e)};Object.defineProperties(J,Je);var un=function(){};un.prototype.filter=function(e){};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};var Xe=function(){};Xe.prototype.filter=function(e,t){};Xe.prototype.isDone=function(){};Xe.prototype.isGeometryChanged=function(){};Xe.prototype.interfaces_=function(){return[]};Xe.prototype.getClass=function(){return Xe};var ne=function(e){function t(r,s){if(e.call(this,s),this._geometries=r||[],e.hasNullElements(this._geometries))throw new ct("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var r=this,s=new T,l=0;l<this._geometries.length;l++)s.expandToInclude(r._geometries[l].getEnvelopeInternal());return s},t.prototype.getGeometryN=function(r){return this._geometries[r]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var r=this,s=new Array(this.getNumPoints()).fill(null),l=-1,p=0;p<this._geometries.length;p++)for(var o=r._geometries[p].getCoordinates(),x=0;x<o.length;x++)l++,s[l]=o[x];return s},t.prototype.getArea=function(){for(var r=this,s=0,l=0;l<this._geometries.length;l++)s+=r._geometries[l].getArea();return s},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var s=arguments[0],l=arguments[1];if(!this.isEquivalentClass(s))return!1;var p=s;if(this._geometries.length!==p._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!r._geometries[o].equalsExact(p._geometries[o],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,s=0;s<this._geometries.length;s++)r._geometries[s].normalize();Nr.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var r=this,s=J.FALSE,l=0;l<this._geometries.length;l++)s=Math.max(s,r._geometries[l].getBoundaryDimension());return s},t.prototype.getDimension=function(){for(var r=this,s=J.FALSE,l=0;l<this._geometries.length;l++)s=Math.max(s,r._geometries[l].getDimension());return s},t.prototype.getLength=function(){for(var r=this,s=0,l=0;l<this._geometries.length;l++)s+=r._geometries[l].getLength();return s},t.prototype.getNumPoints=function(){for(var r=this,s=0,l=0;l<this._geometries.length;l++)s+=r._geometries[l].getNumPoints();return s},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var r=this,s=this._geometries.length,l=new Array(s).fill(null),p=0;p<this._geometries.length;p++)l[p]=r._geometries[p].reverse();return this.getFactory().createGeometryCollection(l)},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var s=arguments[0],l=new an(Nr.asList(this._geometries)),p=new an(Nr.asList(s._geometries));return this.compare(l,p)}else if(arguments.length===2){for(var o=arguments[0],x=arguments[1],M=o,P=this.getNumGeometries(),he=M.getNumGeometries(),nt=0;nt<P&&nt<he;){var _e=r.getGeometryN(nt),Bt=M.getGeometryN(nt),Fn=_e.compareToSameClass(Bt,x);if(Fn!==0)return Fn;nt++}return nt<P?1:nt<he?-1:0}},t.prototype.apply=function(){var r=this;if(G(arguments[0],wn))for(var s=arguments[0],l=0;l<this._geometries.length;l++)r._geometries[l].apply(s);else if(G(arguments[0],Xe)){var p=arguments[0];if(this._geometries.length===0)return null;for(var o=0;o<this._geometries.length&&(r._geometries[o].apply(p),!p.isDone());o++);p.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this);for(var M=0;M<this._geometries.length;M++)r._geometries[M].apply(x)}else if(G(arguments[0],Qn)){var P=arguments[0];P.filter(this);for(var he=0;he<this._geometries.length;he++)r._geometries[he].apply(P)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),U.shouldNeverReachHere(),null},t.prototype.clone=function(){var r=this,s=e.prototype.clone.call(this);s._geometries=new Array(this._geometries.length).fill(null);for(var l=0;l<this._geometries.length;l++)s._geometries[l]=r._geometries[l].clone();return s},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var r=this,s=new Array(this._geometries.length).fill(null),l=0;l<s.length;l++)s[l]=r._geometries[l].copy();return new t(s,this._factory)},t.prototype.isEmpty=function(){for(var r=this,s=0;s<this._geometries.length;s++)if(!r._geometries[s].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(k),Lr=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!r._geometries[s].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var r=this,s=this._geometries.length,l=new Array(s).fill(null),p=0;p<this._geometries.length;p++)l[s-1-p]=r._geometries[p].reverse();return this.getFactory().createMultiLineString(l)},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var r=this,s=new Array(this._geometries.length).fill(null),l=0;l<s.length;l++)s[l]=r._geometries[l].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(ne),Oe=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=Me.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Oe.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};Oe.prototype.getBoundary=function(){return this._geom instanceof pt?this.boundaryLineString(this._geom):this._geom instanceof Lr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Oe.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};Oe.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Oe.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new b;this._endpointMap=new jt;for(var r=0;r<e.getNumGeometries();r++){var s=e.getGeometryN(r);s.getNumPoints()!==0&&(t.addEndpoint(s.getCoordinateN(0)),t.addEndpoint(s.getCoordinateN(s.getNumPoints()-1)))}for(var l=this._endpointMap.entrySet().iterator();l.hasNext();){var p=l.next(),o=p.getValue(),x=o.count;t._bnRule.isInBoundary(x)&&n.add(p.getKey())}return W.toCoordinateArray(n)};Oe.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new ko,this._endpointMap.put(e,t)),t.count++};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new Oe(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=new Oe(n,r);return s.getBoundary()}};var ko=function(){this.count=null};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};function Sc(){}function wc(){}var Lc=function(){};function bc(){}function Pc(){}function Rc(){}var De=function(){},ks={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};De.prototype.interfaces_=function(){return[]};De.prototype.getClass=function(){return De};De.chars=function(e,t){for(var n=new Array(t).fill(null),r=0;r<t;r++)n[r]=e;return String(n)};De.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new bc,n=new Sc;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var r=arguments[0],s=arguments[1],l="";new wc(De.getStackTrace(r));for(var p=new Rc,o=0;o<s;o++)try{l+=p.readLine()+De.NEWLINE}catch(x){if(x instanceof Pc)U.shouldNeverReachHere();else throw x}finally{}return l}};De.split=function(e,t){for(var n=t.length,r=new b,s=""+e,l=s.indexOf(t);l>=0;){var p=s.substring(0,l);r.add(p),s=s.substring(l+n),l=s.indexOf(t)}s.length>0&&r.add(s);for(var o=new Array(r.size()).fill(null),x=0;x<o.length;x++)o[x]=r.get(x);return o};De.toString=function(){if(arguments.length===1){var e=arguments[0];return De.SIMPLE_ORDINATE_FORMAT.format(e)}};De.spaces=function(e){return De.chars(" ",e)};ks.NEWLINE.get=function(){return Ut.getProperty("line.separator")};ks.SIMPLE_ORDINATE_FORMAT.get=function(){return new Lc};Object.defineProperties(De,ks);var Et=function(){};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.copyCoord=function(e,t,n,r){for(var s=Math.min(e.getDimension(),n.getDimension()),l=0;l<s;l++)n.setOrdinate(r,l,e.getOrdinate(t,l))};Et.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Q.X)===e.getOrdinate(t-1,Q.X)&&e.getOrdinate(0,Q.Y)===e.getOrdinate(t-1,Q.Y)};Et.isEqual=function(e,t){var n=e.size(),r=t.size();if(n!==r)return!1;for(var s=Math.min(e.getDimension(),t.getDimension()),l=0;l<n;l++)for(var p=0;p<s;p++){var o=e.getOrdinate(l,p),x=t.getOrdinate(l,p);if(e.getOrdinate(l,p)!==t.getOrdinate(l,p)&&!(z.isNaN(o)&&z.isNaN(x)))return!1}return!0};Et.extend=function(e,t,n){var r=e.create(n,t.getDimension()),s=t.size();if(Et.copy(t,0,r,0,s),s>0)for(var l=s;l<n;l++)Et.copy(t,s-1,r,l,1);return r};Et.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)Et.swap(e,r,t-r)};Et.swap=function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var s=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,s)}};Et.copy=function(e,t,n,r,s){for(var l=0;l<s;l++)Et.copyCoord(e,t+l,n,r+l)};Et.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),r=new yn;r.append("(");for(var s=0;s<t;s++){s>0&&r.append(" ");for(var l=0;l<n;l++)l>0&&r.append(","),r.append(De.toString(e.getOrdinate(s,l)))}return r.append(")"),r.toString()}};Et.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return Et.createClosedRing(e,t,4);var r=t.getOrdinate(0,Q.X)===t.getOrdinate(n-1,Q.X)&&t.getOrdinate(0,Q.Y)===t.getOrdinate(n-1,Q.Y);return r?t:Et.createClosedRing(e,t,n+1)};Et.createClosedRing=function(e,t,n){var r=e.create(n,t.getDimension()),s=t.size();Et.copy(t,0,r,0,s);for(var l=s;l<n;l++)Et.copy(t,0,r,l,1);return r};var pt=function(e){function t(r,s){e.call(this,s),this._points=null,this.init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new T:this._points.expandEnvelope(new T)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var s=arguments[0],l=arguments[1];if(!this.isEquivalentClass(s))return!1;var p=s;if(this._points.size()!==p._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!r.equal(r._points.getCoordinate(o),p._points.getCoordinate(o),l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,s=0;s<Math.trunc(this._points.size()/2);s++){var l=r._points.size()-1-s;if(!r._points.getCoordinate(s).equals(r._points.getCoordinate(l)))return r._points.getCoordinate(s).compareTo(r._points.getCoordinate(l))>0&&Et.reverse(r._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return O.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var r=this._points.copy();Et.reverse(r);var s=this.getFactory().createLineString(r);return s},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var s=arguments[0],l=s,p=0,o=0;p<this._points.size()&&o<l._points.size();){var x=r._points.getCoordinate(p).compareTo(l._points.getCoordinate(o));if(x!==0)return x;p++,o++}return p<this._points.size()?1:o<l._points.size()?-1:0}else if(arguments.length===2){var M=arguments[0],P=arguments[1],he=M;return P.compare(this._points,he._points)}},t.prototype.apply=function(){var r=this;if(G(arguments[0],wn))for(var s=arguments[0],l=0;l<this._points.size();l++)s.filter(r._points.getCoordinate(l));else if(G(arguments[0],Xe)){var p=arguments[0];if(this._points.size()===0)return null;for(var o=0;o<this._points.size()&&(p.filter(r._points,o),!p.isDone());o++);p.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this)}else if(G(arguments[0],Qn)){var M=arguments[0];M.filter(this)}},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.isEquivalentClass=function(r){return r instanceof t},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._points=this._points.clone(),r},t.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new ct("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},t.prototype.isCoordinate=function(r){for(var s=this,l=0;l<this._points.size();l++)if(s._points.getCoordinate(l).equals(r))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(k),eo=function(){};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};var de=function(e){function t(r,s){e.call(this,s),this._coordinates=r||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new T;var r=new T;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],s=r;return this.getCoordinate().compareTo(s.getCoordinate())}else if(arguments.length===2){var l=arguments[0],p=arguments[1],o=l;return p.compare(this._coordinates,o._coordinates)}},t.prototype.apply=function(){if(G(arguments[0],wn)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(G(arguments[0],Xe)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this._coordinates,0),s.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var l=arguments[0];l.filter(this)}else if(G(arguments[0],Qn)){var p=arguments[0];p.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),U.isTrue(r.size()<=1),this._coordinates=r},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(k),ur=function(){};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};var Rt=function(e){function t(r,s,l){if(e.call(this,l),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),s===null&&(s=[]),e.hasNullElements(s))throw new ct("holes must not contain null elements");if(r.isEmpty()&&e.hasNonEmptyElements(s))throw new ct("shell is empty but holes are not");this._shell=r,this._holes=s}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),l=-1,p=this._shell.getCoordinates(),o=0;o<p.length;o++)l++,s[l]=p[o];for(var x=0;x<this._holes.length;x++)for(var M=r._holes[x].getCoordinates(),P=0;P<M.length;P++)l++,s[l]=M[P];return s},t.prototype.getArea=function(){var r=this,s=0;s+=Math.abs(O.signedArea(this._shell.getCoordinateSequence()));for(var l=0;l<this._holes.length;l++)s-=Math.abs(O.signedArea(r._holes[l].getCoordinateSequence()));return s},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),s=this.getEnvelopeInternal(),l=0;l<5;l++){var p=r.getX(l);if(!(p===s.getMinX()||p===s.getMaxX()))return!1;var o=r.getY(l);if(!(o===s.getMinY()||o===s.getMaxY()))return!1}for(var x=r.getX(0),M=r.getY(0),P=1;P<=4;P++){var he=r.getX(P),nt=r.getY(P),_e=he!==x,Bt=nt!==M;if(_e===Bt)return!1;x=he,M=nt}return!0},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var s=arguments[0],l=arguments[1];if(!this.isEquivalentClass(s))return!1;var p=s,o=this._shell,x=p._shell;if(!o.equalsExact(x,l)||this._holes.length!==p._holes.length)return!1;for(var M=0;M<this._holes.length;M++)if(!r._holes[M].equalsExact(p._holes[M],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var s=0;s<this._holes.length;s++)r.normalize(r._holes[s],!1);Nr.sort(this._holes)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];if(l.isEmpty())return null;var o=new Array(l.getCoordinates().length-1).fill(null);Ut.arraycopy(l.getCoordinates(),0,o,0,o.length);var x=W.minCoordinate(l.getCoordinates());W.scroll(o,x),Ut.arraycopy(o,0,l.getCoordinates(),0,o.length),l.getCoordinates()[o.length]=o[0],O.isCCW(l.getCoordinates())===p&&W.reverse(l.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var r=this,s=0;s+=this._shell.getLength();for(var l=0;l<this._holes.length;l++)s+=r._holes[l].getLength();return s},t.prototype.getNumPoints=function(){for(var r=this,s=this._shell.getNumPoints(),l=0;l<this._holes.length;l++)s+=r._holes[l].getNumPoints();return s},t.prototype.reverse=function(){var r=this,s=this.copy();s._shell=this._shell.copy().reverse(),s._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)s._holes[l]=r._holes[l].copy().reverse();return s},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var s=arguments[0],l=this._shell,p=s._shell;return l.compareToSameClass(p)}else if(arguments.length===2){var o=arguments[0],x=arguments[1],M=o,P=this._shell,he=M._shell,nt=P.compareToSameClass(he,x);if(nt!==0)return nt;for(var _e=this.getNumInteriorRing(),Bt=M.getNumInteriorRing(),Fn=0;Fn<_e&&Fn<Bt;){var yr=r.getInteriorRingN(Fn),Io=M.getInteriorRingN(Fn),rl=yr.compareToSameClass(Io,x);if(rl!==0)return rl;Fn++}return Fn<_e?1:Fn<Bt?-1:0}},t.prototype.apply=function(r){var s=this;if(G(r,wn)){this._shell.apply(r);for(var l=0;l<this._holes.length;l++)s._holes[l].apply(r)}else if(G(r,Xe)){if(this._shell.apply(r),!r.isDone())for(var p=0;p<this._holes.length&&(s._holes[p].apply(r),!r.isDone());p++);r.isGeometryChanged()&&this.geometryChanged()}else if(G(r,un))r.filter(this);else if(G(r,Qn)){r.filter(this),this._shell.apply(r);for(var o=0;o<this._holes.length;o++)s._holes[o].apply(r)}},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var l=0;l<this._holes.length;l++)s[l+1]=r._holes[l];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)},t.prototype.clone=function(){var r=this,s=e.prototype.clone.call(this);s._shell=this._shell.clone(),s._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)s._holes[l]=r._holes[l].clone();return s},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var r=this,s=this._shell.copy(),l=new Array(this._holes.length).fill(null),p=0;p<l.length;p++)l[p]=r._holes[p].copy();return new t(s,l,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(r){return this._holes[r]},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(k),Ni=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var r=this,s=new Array(this._geometries.length).fill(null),l=0;l<s.length;l++)s[l]=r._geometries[l].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(ne),Ln=function(e){function t(r,s){r instanceof v&&s instanceof H&&(r=s.getCoordinateSequenceFactory().create(r)),e.call(this,r,s),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var r=this._points.copy();Et.reverse(r);var s=this.getFactory().createLinearRing(r);return s},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new ct("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new ct("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(pt),xn=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var r=this,s=this._geometries.length,l=new Array(s).fill(null),p=0;p<this._geometries.length;p++)l[p]=r._geometries[p].reverse();return this.getFactory().createMultiPolygon(l)},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new b,l=0;l<this._geometries.length;l++)for(var p=r._geometries[l],o=p.getBoundary(),x=0;x<o.getNumGeometries();x++)s.add(o.getGeometryN(x));var M=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(M))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var r=this,s=new Array(this._geometries.length).fill(null),l=0;l<s.length;l++)s[l]=r._geometries[l].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(ne),Ae=function(e){this._factory=e||null,this._isUserDataCopied=!1},$o={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ae.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Ae.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};Ae.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof ne?this.editGeometryCollection(e,t):e instanceof Rt?this.editPolygon(e,t):e instanceof de?t.edit(e,this._factory):e instanceof pt?t.edit(e,this._factory):(U.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Ae.prototype.editGeometryCollection=function(e,t){for(var n=this,r=t.edit(e,this._factory),s=new b,l=0;l<r.getNumGeometries();l++){var p=n.edit(r.getGeometryN(l),t);p===null||p.isEmpty()||s.add(p)}return r.getClass()===Ni?this._factory.createMultiPoint(s.toArray([])):r.getClass()===Lr?this._factory.createMultiLineString(s.toArray([])):r.getClass()===xn?this._factory.createMultiPolygon(s.toArray([])):this._factory.createGeometryCollection(s.toArray([]))};Ae.prototype.editPolygon=function(e,t){var n=this,r=t.edit(e,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var s=this.edit(r.getExteriorRing(),t);if(s===null||s.isEmpty())return this._factory.createPolygon();for(var l=new b,p=0;p<r.getNumInteriorRing();p++){var o=n.edit(r.getInteriorRingN(p),t);o===null||o.isEmpty()||l.add(o)}return this._factory.createPolygon(s,l.toArray([]))};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};Ae.GeometryEditorOperation=function(){};$o.NoOpGeometryOperation.get=function(){return no};$o.CoordinateOperation.get=function(){return ro};$o.CoordinateSequenceOperation.get=function(){return io};Object.defineProperties(Ae,$o);var no=function(){};no.prototype.edit=function(e,t){return e};no.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};no.prototype.getClass=function(){return no};var ro=function(){};ro.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof Ln?t.createLinearRing(n):e instanceof pt?t.createLineString(n):e instanceof de?n.length>0?t.createPoint(n[0]):t.createPoint():e};ro.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};ro.prototype.getClass=function(){return ro};var io=function(){};io.prototype.edit=function(e,t){return e instanceof Ln?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof pt?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof de?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};io.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};io.prototype.getClass=function(){return io};var yt=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new v}else if(G(arguments[0],Q)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)e._coordinates[s]=r.getCoordinateCopy(s)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var l=arguments[0],p=arguments[1];this._coordinates=l,this._dimension=p,l===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],x=arguments[1];this._coordinates=new Array(o).fill(null),this._dimension=x;for(var M=0;M<o;M++)e._coordinates[M]=new v}}},gu={serialVersionUID:{configurable:!0}};yt.prototype.setOrdinate=function(e,t,n){switch(t){case Q.X:this._coordinates[e].x=n;break;case Q.Y:this._coordinates[e].y=n;break;case Q.Z:this._coordinates[e].z=n;break;default:throw new ct("invalid ordinateIndex")}};yt.prototype.size=function(){return this._coordinates.length};yt.prototype.getOrdinate=function(e,t){switch(t){case Q.X:return this._coordinates[e].x;case Q.Y:return this._coordinates[e].y;case Q.Z:return this._coordinates[e].z}return z.NaN};yt.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};yt.prototype.getCoordinateCopy=function(e){return new v(this._coordinates[e])};yt.prototype.getDimension=function(){return this._dimension};yt.prototype.getX=function(e){return this._coordinates[e].x};yt.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new yt(t,this._dimension)};yt.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};yt.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new yt(t,this._dimension)};yt.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new yn(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};yt.prototype.getY=function(e){return this._coordinates[e].y};yt.prototype.toCoordinateArray=function(){return this._coordinates};yt.prototype.interfaces_=function(){return[Q,Ge]};yt.prototype.getClass=function(){return yt};gu.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(yt,gu);var bn=function(){},Gs={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};bn.prototype.readResolve=function(){return bn.instance()};bn.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new yt(e)}else if(G(arguments[0],Q)){var t=arguments[0];return new yt(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new yt(n):new yt(n,r)}};bn.prototype.interfaces_=function(){return[yi,Ge]};bn.prototype.getClass=function(){return bn};bn.instance=function(){return bn.instanceObject};Gs.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Gs.instanceObject.get=function(){return new bn};Object.defineProperties(bn,Gs);var pu=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,r){return this.map_.set(n,r),r},t.prototype.values=function(){for(var n=new b,r=this.map_.values(),s=r.next();!s.done;)n.add(s.value),s=r.next();return n},t.prototype.entrySet=function(){var n=new Bs;return this.map_.entries().forEach(function(r){return n.add(r)}),n},t.prototype.size=function(){return this.map_.size()},t}(li),$=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ln){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},zs={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};$.prototype.equals=function(e){if(!(e instanceof $))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};$.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new sn(n).compareTo(new sn(r))};$.prototype.getScale=function(){return this._scale};$.prototype.isFloating=function(){return this._modelType===$.FLOATING||this._modelType===$.FLOATING_SINGLE};$.prototype.getType=function(){return this._modelType};$.prototype.toString=function(){var e="UNKNOWN";return this._modelType===$.FLOATING?e="Floating":this._modelType===$.FLOATING_SINGLE?e="Floating-Single":this._modelType===$.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};$.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(z.isNaN(e))return e;if(this._modelType===$.FLOATING_SINGLE){var t=e;return t}return this._modelType===$.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof v){var n=arguments[0];if(this._modelType===$.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};$.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===$.FLOATING?e=16:this._modelType===$.FLOATING_SINGLE?e=6:this._modelType===$.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};$.prototype.setScale=function(e){this._scale=Math.abs(e)};$.prototype.interfaces_=function(){return[Ge,ke]};$.prototype.getClass=function(){return $};$.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};zs.serialVersionUID.get=function(){return 7777263578777804e3};zs.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties($,zs);var ln=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Vs={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ln.prototype.readResolve=function(){return ln.nameToTypeMap.get(this._name)};ln.prototype.toString=function(){return this._name};ln.prototype.interfaces_=function(){return[Ge]};ln.prototype.getClass=function(){return ln};Vs.serialVersionUID.get=function(){return-552860263173159e4};Vs.nameToTypeMap.get=function(){return new pu};Object.defineProperties(ln,Vs);$.Type=ln;$.FIXED=new ln("FIXED");$.FLOATING=new ln("FLOATING");$.FLOATING_SINGLE=new ln("FLOATING SINGLE");var H=function e(){this._precisionModel=new $,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?G(arguments[0],yi)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof $&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},du={serialVersionUID:{configurable:!0}};H.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new v(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new v(e.getMinX(),e.getMinY()),new v(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new v(e.getMinX(),e.getMinY()),new v(e.getMinX(),e.getMaxY()),new v(e.getMaxX(),e.getMaxY()),new v(e.getMaxX(),e.getMinY()),new v(e.getMinX(),e.getMinY())]),null)};H.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new pt(this.getCoordinateSequenceFactory().create(e),this);if(G(e,Q))return new pt(e,this)}else return new pt(this.getCoordinateSequenceFactory().create([]),this)};H.prototype.createMultiLineString=function(){if(arguments.length===0)return new Lr(null,this);if(arguments.length===1){var e=arguments[0];return new Lr(e,this)}};H.prototype.buildGeometry=function(e){for(var t=null,n=!1,r=!1,s=e.iterator();s.hasNext();){var l=s.next(),p=l.getClass();t===null&&(t=p),p!==t&&(n=!0),l.isGeometryCollectionOrDerived()&&(r=!0)}if(t===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(H.toGeometryArray(e));var o=e.iterator().next(),x=e.size()>1;if(x){if(o instanceof Rt)return this.createMultiPolygon(H.toPolygonArray(e));if(o instanceof pt)return this.createMultiLineString(H.toLineStringArray(e));if(o instanceof de)return this.createMultiPoint(H.toPointArray(e));U.shouldNeverReachHere("Unhandled class: "+o.getClass().getName())}return o};H.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};H.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new de(t,this)}}};H.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};H.prototype.createPolygon=function(){if(arguments.length===0)return new Rt(null,null,this);if(arguments.length===1){if(G(arguments[0],Q)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Ln){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];return new Rt(r,s,this)}};H.prototype.getSRID=function(){return this._SRID};H.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ne(null,this);if(arguments.length===1){var e=arguments[0];return new ne(e,this)}};H.prototype.createGeometry=function(e){var t=new Ae(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};H.prototype.getPrecisionModel=function(){return this._precisionModel};H.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new Ln(t,this)}}};H.prototype.createMultiPolygon=function(){if(arguments.length===0)return new xn(null,this);if(arguments.length===1){var e=arguments[0];return new xn(e,this)}};H.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Ni(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Ni(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(G(arguments[0],Q)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(r.size()).fill(null),l=0;l<r.size();l++){var p=e.getCoordinateSequenceFactory().create(1,r.getDimension());Et.copy(r,l,p,0,1),s[l]=e.createPoint(p)}return this.createMultiPoint(s)}}};H.prototype.interfaces_=function(){return[Ge]};H.prototype.getClass=function(){return H};H.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};H.getDefaultCoordinateSequenceFactory=function(){return bn.instance()};H.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};du.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(H,du);var Oc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ts=function(e){this.geometryFactory=e||new H};ts.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var n=t.type;if(!tn[n])throw new Error("Unknown GeoJSON type: "+t.type);return Oc.indexOf(n)!==-1?tn[n].apply(this,[t.coordinates]):n==="GeometryCollection"?tn[n].apply(this,[t.geometries]):tn[n].apply(this,[t])};ts.prototype.write=function(e){var t=e.getGeometryType();if(!qn[t])throw new Error("Geometry is not supported");return qn[t].apply(this,[e])};var tn={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var r=e.geometry.type;if(!tn[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=tn.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,n={};if(e.features){n.features=[];for(var r=0;r<e.features.length;++r)n.features.push(t.read(e.features[r]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(new v(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new v(e[0],e[1]),new v(e[2],e[1]),new v(e[2],e[3]),new v(e[0],e[3]),new v(e[0],e[1])])},Point:function(e){var t=new v(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,n=[],r=0;r<e.length;++r)n.push(tn.Point.apply(t,[e[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var t=tn.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,n=[],r=0;r<e.length;++r)n.push(tn.LineString.apply(t,[e[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var t=this,n=tn.coordinates.apply(this,[e[0]]),r=this.geometryFactory.createLinearRing(n),s=[],l=1;l<e.length;++l){var p=e[l],o=tn.coordinates.apply(t,[p]),x=t.geometryFactory.createLinearRing(o);s.push(x)}return this.geometryFactory.createPolygon(r,s)},MultiPolygon:function(e){for(var t=this,n=[],r=0;r<e.length;++r){var s=e[r];n.push(tn.Polygon.apply(t,[s]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var t=this,n=[],r=0;r<e.length;++r){var s=e[r];n.push(t.read(s))}return this.geometryFactory.createGeometryCollection(n)}},qn={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=qn.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var s=e._geometries[r],l=qn.Point.apply(t,[s]);n.push(l.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var t=this,n=[],r=e.getCoordinates(),s=0;s<r.length;++s){var l=r[s];n.push(qn.coordinate.apply(t,[l]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var s=e._geometries[r],l=qn.LineString.apply(t,[s]);n.push(l.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var t=this,n=[],r=qn.LineString.apply(this,[e._shell]);n.push(r.coordinates);for(var s=0;s<e._holes.length;++s){var l=e._holes[s],p=qn.LineString.apply(t,[l]);n.push(p.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var s=e._geometries[r],l=qn.Polygon.apply(t,[s]);n.push(l.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var s=e._geometries[r],l=s.getGeometryType();n.push(qn[l].apply(t,[s]))}return{type:"GeometryCollection",geometries:n}}},Us=function(e){this.geometryFactory=e||new H,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ts(this.geometryFactory)};Us.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===$.FIXED&&this.reducePrecision(t),t};Us.prototype.reducePrecision=function(e){var t=this,n,r;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,r=e.points.length;n<r;n++)t.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,r=e.geometries.length;n<r;n++)t.reducePrecision(e.geometries[n])};var vu=function(){this.parser=new ts(this.geometryFactory)};vu.prototype.write=function(e){return this.parser.write(e)};var w=function(){},es={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};w.prototype.interfaces_=function(){return[]};w.prototype.getClass=function(){return w};w.opposite=function(e){return e===w.LEFT?w.RIGHT:e===w.RIGHT?w.LEFT:e};es.ON.get=function(){return 0};es.LEFT.get=function(){return 1};es.RIGHT.get=function(){return 2};Object.defineProperties(w,es);function ns(e){this.message=e||""}ns.prototype=new Error;ns.prototype.name="EmptyStackException";function mn(){this.array_=[]}mn.prototype=new Ue;mn.prototype.add=function(e){return this.array_.push(e),!0};mn.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};mn.prototype.push=function(e){return this.array_.push(e),e};mn.prototype.pop=function(e){if(this.array_.length===0)throw new ns;return this.array_.pop()};mn.prototype.peek=function(){if(this.array_.length===0)throw new ns;return this.array_[this.array_.length-1]};mn.prototype.empty=function(){return this.array_.length===0};mn.prototype.isEmpty=function(){return this.empty()};mn.prototype.search=function(e){return this.array_.indexOf(e)};mn.prototype.size=function(){return this.array_.length};mn.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};var cn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};cn.prototype.getCoordinate=function(){return this._minCoord};cn.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};cn.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();U.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=O.computeOrientation(this._minCoord,n,t),s=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===O.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===O.CLOCKWISE)&&(s=!0),s&&(this._minIndex=this._minIndex-1)};cn.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),r=n.getCoordinates();if(t<0||t+1>=r.length||r[t].y===r[t+1].y)return-1;var s=w.LEFT;return r[t].y<r[t+1].y&&(s=w.RIGHT),s};cn.prototype.getEdge=function(){return this._orientedDe};cn.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(t._minCoord===null||n[r].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=r,t._minCoord=n[r])};cn.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};cn.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();r.isForward()&&t.checkForRightmostCoordinate(r)}U.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var s=this.getRightmostSide(this._minDe,this._minIndex);s===w.LEFT&&(this._orientedDe=this._minDe.getSym())};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var Jn=function(e){function t(n,r){e.call(this,t.msgWithCoord(n,r)),this.pt=r?new v(r):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},t}(Kn),rs=function(){this.array_=[]};rs.prototype.addLast=function(e){this.array_.push(e)};rs.prototype.removeFirst=function(){return this.array_.shift()};rs.prototype.isEmpty=function(){return this.array_.length===0};var re=function(){this._finder=null,this._dirEdgeList=new b,this._nodes=new b,this._rightMostCoord=null,this._env=null,this._finder=new cn};re.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};re.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};re.prototype.computeNodeDepth=function(e){for(var t=this,n=null,r=e.getEdges().iterator();r.hasNext();){var s=r.next();if(s.isVisited()||s.getSym().isVisited()){n=s;break}}if(n===null)throw new Jn("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var l=e.getEdges().iterator();l.hasNext();){var p=l.next();p.setVisited(!0),t.copySymDepths(p)}};re.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(w.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};re.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};re.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(w.RIGHT)>=1&&t.getDepth(w.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};re.prototype.computeDepths=function(e){var t=this,n=new Bs,r=new rs,s=e.getNode();for(r.addLast(s),n.add(s),e.setVisited(!0);!r.isEmpty();){var l=r.removeFirst();n.add(l),t.computeNodeDepth(l);for(var p=l.getEdges().iterator();p.hasNext();){var o=p.next(),x=o.getSym();if(!x.isVisited()){var M=x.getNode();n.contains(M)||(r.addLast(M),n.add(M))}}}};re.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};re.prototype.getEnvelope=function(){if(this._env===null){for(var e=new T,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),r=n.getEdge().getCoordinates(),s=0;s<r.length-1;s++)e.expandToInclude(r[s]);this._env=e}return this._env};re.prototype.addReachable=function(e){var t=this,n=new mn;for(n.add(e);!n.empty();){var r=n.pop();t.add(r,n)}};re.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(w.LEFT,e.getDepth(w.RIGHT)),t.setDepth(w.RIGHT,e.getDepth(w.LEFT))};re.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var r=e.getEdges().iterator();r.hasNext();){var s=r.next();n._dirEdgeList.add(s);var l=s.getSym(),p=l.getNode();p.isVisited()||t.push(p)}};re.prototype.getNodes=function(){return this._nodes};re.prototype.getDirectedEdges=function(){return this._dirEdgeList};re.prototype.interfaces_=function(){return[ke]};re.prototype.getClass=function(){return re};var at=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[w.ON]=r}else if(arguments[0]instanceof e){var s=arguments[0];if(this.init(s.location.length),s!==null)for(var l=0;l<this.location.length;l++)t.location[l]=s.location[l]}}else if(arguments.length===3){var p=arguments[0],o=arguments[1],x=arguments[2];this.init(3),this.location[w.ON]=p,this.location[w.LEFT]=o,this.location[w.RIGHT]=x}};at.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};at.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==m.NONE)return!1;return!0};at.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===m.NONE&&(t.location[n]=e)};at.prototype.isLine=function(){return this.location.length===1};at.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[w.ON]=this.location[w.ON],n[w.LEFT]=m.NONE,n[w.RIGHT]=m.NONE,this.location=n}for(var r=0;r<this.location.length;r++)t.location[r]===m.NONE&&r<e.location.length&&(t.location[r]=e.location[r])};at.prototype.getLocations=function(){return this.location};at.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[w.LEFT];this.location[w.LEFT]=this.location[w.RIGHT],this.location[w.RIGHT]=e};at.prototype.toString=function(){var e=new yn;return this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.LEFT])),e.append(m.toLocationSymbol(this.location[w.ON])),this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.RIGHT])),e.toString()};at.prototype.setLocations=function(e,t,n){this.location[w.ON]=e,this.location[w.LEFT]=t,this.location[w.RIGHT]=n};at.prototype.get=function(e){return e<this.location.length?this.location[e]:m.NONE};at.prototype.isArea=function(){return this.location.length>1};at.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===m.NONE)return!0;return!1};at.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(w.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};at.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(m.NONE)};at.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};at.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};at.prototype.interfaces_=function(){return[]};at.prototype.getClass=function(){return at};var et=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new at(t),this.elt[1]=new at(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new at(n.elt[0]),this.elt[1]=new at(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.elt[0]=new at(m.NONE),this.elt[1]=new at(m.NONE),this.elt[r].setLocation(s)}else if(arguments.length===3){var l=arguments[0],p=arguments[1],o=arguments[2];this.elt[0]=new at(l,p,o),this.elt[1]=new at(l,p,o)}else if(arguments.length===4){var x=arguments[0],M=arguments[1],P=arguments[2],he=arguments[3];this.elt[0]=new at(m.NONE,m.NONE,m.NONE),this.elt[1]=new at(m.NONE,m.NONE,m.NONE),this.elt[x].setLocations(M,P,he)}};et.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};et.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};et.prototype.isNull=function(e){return this.elt[e].isNull()};et.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};et.prototype.isLine=function(e){return this.elt[e].isLine()};et.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new at(e.elt[n]):t.elt[n].merge(e.elt[n])};et.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};et.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(w.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};et.prototype.toString=function(){var e=new yn;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};et.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};et.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};et.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(w.ON,t)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];this.elt[n].setLocation(r,s)}};et.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};et.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};et.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new at(this.elt[e].location[0]))};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.toLineLabel=function(e){for(var t=new et(m.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var xt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new b,this._pts=new b,this._label=new et(m.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new b,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};xt.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=O.isCCW(this._ring.getCoordinates())};xt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};xt.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,r=!0;do{if(n===null)throw new Jn("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new Jn("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var s=n.getLabel();U.isTrue(s.isArea()),t.mergeLabel(s),t.addPoints(n.getEdge(),n.isForward(),r),r=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};xt.prototype.getLinearRing=function(){return this._ring};xt.prototype.getCoordinate=function(e){return this._pts.get(e)};xt.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),r=n.getEdges().getOutgoingDegree(e);r>e._maxNodeDegree&&(e._maxNodeDegree=r),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};xt.prototype.addPoints=function(e,t,n){var r=this,s=e.getCoordinates();if(t){var l=1;n&&(l=0);for(var p=l;p<s.length;p++)r._pts.add(s[p])}else{var o=s.length-2;n&&(o=s.length-1);for(var x=o;x>=0;x--)r._pts.add(s[x])}};xt.prototype.isHole=function(){return this._isHole};xt.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};xt.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!O.isPointInRing(e,t.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var s=r.next();if(s.containsPoint(e))return!1}return!0};xt.prototype.addHole=function(e){this._holes.add(e)};xt.prototype.isShell=function(){return this._shell===null};xt.prototype.getLabel=function(){return this._label};xt.prototype.getEdges=function(){return this._edges};xt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};xt.prototype.getShell=function(){return this._shell};xt.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=t.getLocation(n,w.RIGHT);if(r===m.NONE)return null;if(this._label.getLocation(n)===m.NONE)return this._label.setLocation(n,r),null}};xt.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};xt.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=t._holes.get(r).getLinearRing();var s=e.createPolygon(this.getLinearRing(),n);return s};xt.prototype.interfaces_=function(){return[]};xt.prototype.getClass=function(){return xt};var Dc=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Tc=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,r=new b,s=this._startDe;do{if(s.getMinEdgeRing()===null){var l=new Dc(s,n._geometryFactory);r.add(l)}s=s.getNext()}while(s!==this._startDe);return r},t.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var s=r.getNode();s.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Se=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Se.prototype.setVisited=function(e){this._isVisited=e};Se.prototype.setInResult=function(e){this._isInResult=e};Se.prototype.isCovered=function(){return this._isCovered};Se.prototype.isCoveredSet=function(){return this._isCoveredSet};Se.prototype.setLabel=function(e){this._label=e};Se.prototype.getLabel=function(){return this._label};Se.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Se.prototype.updateIM=function(e){U.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Se.prototype.isInResult=function(){return this._isInResult};Se.prototype.isVisited=function(){return this._isVisited};Se.prototype.interfaces_=function(){return[]};Se.prototype.getClass=function(){return Se};var is=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new et(0,m.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,r){var s=m.NONE;if(s=this._label.getLocation(r),!n.isNull(r)){var l=n.getLocation(r);s!==m.BOUNDARY&&(s=l)}return s},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new et(n,r):this._label.setLocation(n,r)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof et)for(var s=arguments[0],l=0;l<2;l++){var p=n.computeMergedLocation(s,l),o=n._label.getLocation(l);o===m.NONE&&n._label.setLocation(l,p)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=m.NONE;this._label!==null&&(r=this._label.getLocation(n));var s=null;switch(r){case m.BOUNDARY:s=m.INTERIOR;break;case m.INTERIOR:s=m.BOUNDARY;break;default:s=m.BOUNDARY;break}this._label.setLocation(n,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Se),fn=function(){this.nodeMap=new jt,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};fn.prototype.find=function(e){return this.nodeMap.get(e)};fn.prototype.addNode=function(){if(arguments[0]instanceof v){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof is){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};fn.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};fn.prototype.iterator=function(){return this.nodeMap.values().iterator()};fn.prototype.values=function(){return this.nodeMap.values()};fn.prototype.getBoundaryNodes=function(e){for(var t=new b,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===m.BOUNDARY&&t.add(r)}return t};fn.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};fn.prototype.interfaces_=function(){return[]};fn.prototype.getClass=function(){return fn};var it=function(){},yo={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};it.prototype.interfaces_=function(){return[]};it.prototype.getClass=function(){return it};it.isNorthern=function(e){return e===it.NE||e===it.NW};it.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};it.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var r=e<t?e:t,s=e>t?e:t;return r===0&&s===3?3:r};it.isInHalfPlane=function(e,t){return t===it.SE?e===it.SE||e===it.SW:e===t||e===t+1};it.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?it.NE:it.SE:t>=0?it.NW:it.SW}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new ct("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?it.NE:it.SE:r.y>=n.y?it.NW:it.SW}};yo.NE.get=function(){return 0};yo.NW.get=function(){return 1};yo.SW.get=function(){return 2};yo.SE.get=function(){return 3};Object.defineProperties(it,yo);var Kt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],s=null;this._edge=t,this.init(n,r),this._label=s}else if(arguments.length===4){var l=arguments[0],p=arguments[1],o=arguments[2],x=arguments[3];this._edge=l,this.init(p,o),this._label=x}};Kt.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:O.computeOrientation(e._p0,e._p1,this._p1)};Kt.prototype.getDy=function(){return this._dy};Kt.prototype.getCoordinate=function(){return this._p0};Kt.prototype.setNode=function(e){this._node=e};Kt.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),s=n.substring(r+1);e.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Kt.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Kt.prototype.getDirectedCoordinate=function(){return this._p1};Kt.prototype.getDx=function(){return this._dx};Kt.prototype.getLabel=function(){return this._label};Kt.prototype.getEdge=function(){return this._edge};Kt.prototype.getQuadrant=function(){return this._quadrant};Kt.prototype.getNode=function(){return this._node};Kt.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),r=t.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Kt.prototype.computeLabel=function(e){};Kt.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=it.quadrant(this._dx,this._dy),U.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Kt.prototype.interfaces_=function(){return[ke]};Kt.prototype.getClass=function(){return Kt};var bs=function(e){function t(){var n=arguments[0],r=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var s=n.getNumPoints()-1;this.init(n.getCoordinate(s),n.getCoordinate(s-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new et(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new Jn("assigned depths do not match",this.getCoordinate());this._depth[n]=r},t.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,s=0;s<2;s++)n._label.isArea(s)&&n._label.getLocation(s,w.LEFT)===m.INTERIOR&&n._label.getLocation(s,w.RIGHT)===m.INTERIOR||(r=!1);return r},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[w.LEFT]+"/"+this._depth[w.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,m.EXTERIOR),s=!this._label.isArea(1)||this._label.allPositionsEqual(1,m.EXTERIOR);return n&&r&&s},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,r){var s=this.getEdge().getDepthDelta();this._isForward||(s=-s);var l=1;n===w.LEFT&&(l=-1);var p=w.opposite(n),o=s*l,x=r+o;this.setDepth(n,r),this.setDepth(p,x)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,r){return n===m.EXTERIOR&&r===m.INTERIOR?1:n===m.INTERIOR&&r===m.EXTERIOR?-1:0},t}(Kt),xi=function(){};xi.prototype.createNode=function(e){return new is(e,null)};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};var ht=function(){if(this._edges=new b,this._nodes=null,this._edgeEndList=new b,arguments.length===0)this._nodes=new fn(new xi);else if(arguments.length===1){var e=arguments[0];this._nodes=new fn(e)}};ht.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var r=t._edges.get(n);r.print(e),r.eiList.print(e)}};ht.prototype.find=function(e){return this._nodes.find(e)};ht.prototype.addNode=function(){if(arguments[0]instanceof is){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this._nodes.addNode(t)}};ht.prototype.getNodeIterator=function(){return this._nodes.iterator()};ht.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};ht.prototype.debugPrintln=function(e){Ut.out.println(e)};ht.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(e)===m.BOUNDARY};ht.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};ht.prototype.matchInSameDirection=function(e,t,n,r){return e.equals(n)?O.computeOrientation(e,t,r)===O.COLLINEAR&&it.quadrant(e,t)===it.quadrant(n,r):!1};ht.prototype.getEdgeEnds=function(){return this._edgeEndList};ht.prototype.debugPrint=function(e){Ut.out.print(e)};ht.prototype.getEdgeIterator=function(){return this._edges.iterator()};ht.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var s=n._edges.get(r),l=s.getCoordinates();if(n.matchInSameDirection(e,t,l[0],l[1])||n.matchInSameDirection(e,t,l[l.length-1],l[l.length-2]))return s}return null};ht.prototype.insertEdge=function(e){this._edges.add(e)};ht.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};ht.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();t._edges.add(r);var s=new bs(r,!0),l=new bs(r,!1);s.setSym(l),l.setSym(s),t.add(s),t.add(l)}};ht.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};ht.prototype.getNodes=function(){return this._nodes.values()};ht.prototype.findEdge=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var s=n._edges.get(r),l=s.getCoordinates();if(e.equals(l[0])&&t.equals(l[1]))return s}return null};ht.prototype.interfaces_=function(){return[]};ht.prototype.getClass=function(){return ht};ht.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var ve=function(){this._geometryFactory=null,this._shellList=new b;var e=arguments[0];this._geometryFactory=e};ve.prototype.sortShellsAndHoles=function(e,t,n){for(var r=e.iterator();r.hasNext();){var s=r.next();s.isHole()?n.add(s):t.add(s)}};ve.prototype.computePolygons=function(e){for(var t=this,n=new b,r=e.iterator();r.hasNext();){var s=r.next(),l=s.toPolygon(t._geometryFactory);n.add(l)}return n};ve.prototype.placeFreeHoles=function(e,t){for(var n=this,r=t.iterator();r.hasNext();){var s=r.next();if(s.getShell()===null){var l=n.findEdgeRingContaining(s,e);if(l===null)throw new Jn("unable to assign hole to a shell",s.getCoordinate(0));s.setShell(l)}}};ve.prototype.buildMinimalEdgeRings=function(e,t,n){for(var r=this,s=new b,l=e.iterator();l.hasNext();){var p=l.next();if(p.getMaxNodeDegree()>2){p.linkDirectedEdgesForMinimalEdgeRings();var o=p.buildMinimalRings(),x=r.findShell(o);x!==null?(r.placePolygonHoles(x,o),t.add(x)):n.addAll(o)}else s.add(p)}return s};ve.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};ve.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new b,r=e.iterator();r.hasNext();){var s=r.next();if(s.isInResult()&&s.getLabel().isArea()&&s.getEdgeRing()===null){var l=new Tc(s,t._geometryFactory);n.add(l),l.setInResult()}}return n};ve.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}};ve.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};ve.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),s=n.getCoordinateN(0),l=null,p=null,o=t.iterator();o.hasNext();){var x=o.next(),M=x.getLinearRing(),P=M.getEnvelopeInternal();l!==null&&(p=l.getLinearRing().getEnvelopeInternal());var he=!1;P.contains(r)&&O.isPointInRing(s,M.getCoordinates())&&(he=!0),he&&(l===null||p.contains(P))&&(l=x)}return l};ve.prototype.findShell=function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var s=r.next();s.isHole()||(n=s,t++)}return U.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};ve.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];ht.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(t),s=new b,l=this.buildMinimalEdgeRings(r,this._shellList,s);this.sortShellsAndHoles(l,this._shellList,s),this.placeFreeHoles(this._shellList,s)}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};var Si=function(){};Si.prototype.getBounds=function(){};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};var Ye=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};Ye.prototype.getItem=function(){return this._item};Ye.prototype.getBounds=function(){return this._bounds};Ye.prototype.interfaces_=function(){return[Si,Ge]};Ye.prototype.getClass=function(){return Ye};var Zn=function(){this._size=null,this._items=null,this._size=0,this._items=new b,this._items.add(null)};Zn.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Zn.prototype.size=function(){return this._size};Zn.prototype.reorder=function(e){for(var t=this,n=null,r=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(r)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,r)};Zn.prototype.clear=function(){this._size=0,this._items.clear()};Zn.prototype.isEmpty=function(){return this._size===0};Zn.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};var lr=function(){};lr.prototype.visitItem=function(e){};lr.prototype.interfaces_=function(){return[]};lr.prototype.getClass=function(){return lr};var Qr=function(){};Qr.prototype.insert=function(e,t){};Qr.prototype.remove=function(e,t){};Qr.prototype.query=function(){};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};var Pt=function(){if(this._childBoundables=new b,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},yu={serialVersionUID:{configurable:!0}};Pt.prototype.getLevel=function(){return this._level};Pt.prototype.size=function(){return this._childBoundables.size()};Pt.prototype.getChildBoundables=function(){return this._childBoundables};Pt.prototype.addChildBoundable=function(e){U.isTrue(this._bounds===null),this._childBoundables.add(e)};Pt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Pt.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Pt.prototype.interfaces_=function(){return[Si,Ge]};Pt.prototype.getClass=function(){return Pt};yu.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Pt,yu);var He=function(){};He.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};He.min=function(e){return He.sort(e),e.get(0)};He.sort=function(e,t){var n=e.toArray();t?Nr.sort(n,t):Nr.sort(n);for(var r=e.iterator(),s=0,l=n.length;s<l;s++)r.next(),r.set(n[s])};He.singletonList=function(e){var t=new b;return t.add(e),t};var Ct=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};Ct.prototype.expandToQueue=function(e,t){var n=Ct.isComposite(this._boundable1),r=Ct.isComposite(this._boundable2);if(n&&r)return Ct.area(this._boundable1)>Ct.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new ct("neither boundable is composite")};Ct.prototype.isLeaves=function(){return!(Ct.isComposite(this._boundable1)||Ct.isComposite(this._boundable2))};Ct.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};Ct.prototype.expand=function(e,t,n,r){for(var s=this,l=e.getChildBoundables(),p=l.iterator();p.hasNext();){var o=p.next(),x=new Ct(o,t,s._itemDistance);x.getDistance()<r&&n.add(x)}};Ct.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Ct.prototype.getDistance=function(){return this._distance};Ct.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Ct.prototype.interfaces_=function(){return[ke]};Ct.prototype.getClass=function(){return Ct};Ct.area=function(e){return e.getBounds().getArea()};Ct.isComposite=function(e){return e instanceof Pt};var Tt=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new b,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];U.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},os={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Tt.prototype.getNodeCapacity=function(){return this._nodeCapacity};Tt.prototype.lastNode=function(e){return e.get(e.size()-1)};Tt.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var s=r.next();s instanceof Pt?n+=e.size(s):s instanceof Ye&&(n+=1)}return n}};Tt.prototype.removeItem=function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var s=r.next();s instanceof Ye&&s.getItem()===t&&(n=s)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};Tt.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new b:t}else if(arguments.length===1){for(var n=arguments[0],r=new b,s=n.getChildBoundables().iterator();s.hasNext();){var l=s.next();if(l instanceof Pt){var p=e.itemsTree(l);p!==null&&r.add(p)}else l instanceof Ye?r.add(l.getItem()):U.shouldNeverReachHere()}return r.size()<=0?null:r}};Tt.prototype.insert=function(e,t){U.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ye(e,t))};Tt.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new b;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2];if(U.isTrue(r>-2),s.getLevel()===r)return l.add(s),null;for(var p=s.getChildBoundables().iterator();p.hasNext();){var o=p.next();o instanceof Pt?e.boundablesAtLevel(r,o,l):(U.isTrue(o instanceof Ye),r===-1&&l.add(o))}return null}};Tt.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new b;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var r=arguments[0],s=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,s)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var l=arguments[0],p=arguments[1],o=arguments[2],x=p.getChildBoundables(),M=0;M<x.size();M++){var P=x.get(M);e.getIntersectsOp().intersects(P.getBounds(),l)&&(P instanceof Pt?e.query(l,P,o):P instanceof Ye?o.visitItem(P.getItem()):U.shouldNeverReachHere())}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var he=arguments[0],nt=arguments[1],_e=arguments[2],Bt=nt.getChildBoundables(),Fn=0;Fn<Bt.size();Fn++){var yr=Bt.get(Fn);e.getIntersectsOp().intersects(yr.getBounds(),he)&&(yr instanceof Pt?e.query(he,yr,_e):yr instanceof Ye?_e.add(yr.getItem()):U.shouldNeverReachHere())}}};Tt.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Tt.prototype.getRoot=function(){return this.build(),this._root};Tt.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2],p=this.removeItem(s,l);if(p)return!0;for(var o=null,x=s.getChildBoundables().iterator();x.hasNext();){var M=x.next();if(e.getIntersectsOp().intersects(M.getBounds(),r)&&M instanceof Pt&&(p=e.remove(r,M,l),p)){o=M;break}}return o!==null&&o.getChildBoundables().isEmpty()&&s.getChildBoundables().remove(o),p}};Tt.prototype.createHigherLevels=function(e,t){U.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};Tt.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var s=r.next();if(s instanceof Pt){var l=e.depth(s);l>n&&(n=l)}}return n+1}};Tt.prototype.createParentBoundables=function(e,t){var n=this;U.isTrue(!e.isEmpty());var r=new b;r.add(this.createNode(t));var s=new b(e);He.sort(s,this.getComparator());for(var l=s.iterator();l.hasNext();){var p=l.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(t)),n.lastNode(r).addChildBoundable(p)}return r};Tt.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Tt.prototype.interfaces_=function(){return[Ge]};Tt.prototype.getClass=function(){return Tt};Tt.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};os.IntersectsOp.get=function(){return Mc};os.serialVersionUID.get=function(){return-3886435814360241e3};os.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Tt,os);var Mc=function(){},wi=function(){};wi.prototype.distance=function(e,t){};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};var mu=function(e){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,e.call(this,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(r,s){var l=this;U.isTrue(r.length>0);for(var p=new b,o=0;o<r.length;o++)p.addAll(l.createParentBoundablesFromVerticalSlice(r[o],s));return p},t.prototype.createNode=function(r){return new wa(r)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];if(r.isNull())return null;e.prototype.insert.call(this,r,s)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(r,s){for(var l=Math.trunc(Math.ceil(r.size()/s)),p=new Array(s).fill(null),o=r.iterator(),x=0;x<s;x++){p[x]=new b;for(var M=0;o.hasNext()&&M<l;){var P=o.next();p[x].add(P),M++}}return p},t.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return e.prototype.query.call(this,r)}else if(arguments.length===2){var s=arguments[0],l=arguments[1];e.prototype.query.call(this,s,l)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var p=arguments[0],o=arguments[1],x=arguments[2];e.prototype.query.call(this,p,o,x)}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var M=arguments[0],P=arguments[1],he=arguments[2];e.prototype.query.call(this,M,P,he)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(r,s){return e.prototype.createParentBoundables.call(this,r,s)},t.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return e.prototype.remove.call(this,r,s)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(r,s){U.isTrue(!r.isEmpty());var l=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),p=new b(r);He.sort(p,t.xComparator);var o=this.verticalSlices(p,Math.trunc(Math.ceil(Math.sqrt(l))));return this.createParentBoundablesFromVerticalSlices(o,s)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(G(arguments[0],wi)){var r=arguments[0],s=new Ct(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(s)}else if(arguments[0]instanceof Ct){var l=arguments[0];return this.nearestNeighbour(l,z.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&G(arguments[1],wi)){var p=arguments[0],o=arguments[1],x=new Ct(this.getRoot(),p.getRoot(),o);return this.nearestNeighbour(x)}else if(arguments[0]instanceof Ct&&typeof arguments[1]=="number"){var M=arguments[0],P=arguments[1],he=P,nt=null,_e=new Zn;for(_e.add(M);!_e.isEmpty()&&he>0;){var Bt=_e.poll(),Fn=Bt.getDistance();if(Fn>=he)break;Bt.isLeaves()?(he=Fn,nt=Bt):Bt.expandToQueue(_e,he)}return[nt.getBoundable(0).getItem(),nt.getBoundable(1).getItem()]}}else if(arguments.length===3){var yr=arguments[0],Io=arguments[1],rl=arguments[2],Co=new Ye(yr,Io),as=new Ct(this.getRoot(),Co,rl);return this.nearestNeighbour(as)[0]}},t.prototype.interfaces_=function(){return[Qr,Ge]},t.prototype.getClass=function(){return t},t.centreX=function(r){return t.avg(r.getMinX(),r.getMaxX())},t.avg=function(r,s){return(r+s)/2},t.centreY=function(r){return t.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return wa},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(r,s){return e.compareDoubles(t.centreX(r.getBounds()),t.centreX(s.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(r,s){return e.compareDoubles(t.centreY(r.getBounds()),t.centreY(s.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(r,s){return r.intersects(s)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(Tt),wa=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var s=r.next();n===null?n=new T(s.getBounds()):n.expandToInclude(s.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Pt),se=function(){};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};se.relativeSign=function(e,t){return e<t?-1:e>t?1:0};se.compare=function(e,t,n){if(t.equals2D(n))return 0;var r=se.relativeSign(t.x,n.x),s=se.relativeSign(t.y,n.y);switch(e){case 0:return se.compareValue(r,s);case 1:return se.compareValue(s,r);case 2:return se.compareValue(s,-r);case 3:return se.compareValue(-r,s);case 4:return se.compareValue(-r,-s);case 5:return se.compareValue(-s,-r);case 6:return se.compareValue(-s,r);case 7:return se.compareValue(r,-s)}return U.shouldNeverReachHere("invalid octant value"),0};se.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var cr=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._segString=e,this.coord=new v(t),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(n))};cr.prototype.getCoordinate=function(){return this.coord};cr.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};cr.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:se.compare(this._segmentOctant,this.coord,t.coord)};cr.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};cr.prototype.isInterior=function(){return this._isInterior};cr.prototype.interfaces_=function(){return[ke]};cr.prototype.getClass=function(){return cr};var ie=function(){this._nodeMap=new jt,this._edge=null;var e=arguments[0];this._edge=e};ie.prototype.getSplitCoordinates=function(){var e=this,t=new po;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next();e.addEdgeCoordinates(r,s,t),r=s}return t.toCoordinateArray()};ie.prototype.addCollapsedNodes=function(){var e=this,t=new b;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var r=n.next().intValue();e.add(e._edge.getCoordinate(r),r)}};ie.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};ie.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var r=t._edge.getCoordinate(n),s=t._edge.getCoordinate(n+2);r.equals2D(s)&&e.add(new sn(n+1))}};ie.prototype.addEdgeCoordinates=function(e,t,n){var r=this,s=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(s);n.add(new v(e.coord),!1);for(var p=e.segmentIndex+1;p<=t.segmentIndex;p++)n.add(r._edge.getCoordinate(p));l&&n.add(new v(t.coord))};ie.prototype.iterator=function(){return this._nodeMap.values().iterator()};ie.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next(),l=t.createSplitEdge(r,s);e.add(l),r=s}};ie.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,r===1?(n[0]=e.segmentIndex+1,!0):!1};ie.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),r=this.iterator(),s=r.next();r.hasNext();){var l=r.next(),p=t.findCollapseIndex(s,l,n);p&&e.add(new sn(n[0])),s=l}};ie.prototype.getEdge=function(){return this._edge};ie.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};ie.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,s=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(s);l||r--;var p=new Array(r).fill(null),o=0;p[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)p[o++]=n._edge.getCoordinate(x);return l&&(p[o]=new v(t.coord)),new It(p,this._edge.getData())};ie.prototype.add=function(e,t){var n=new cr(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return r!==null?(U.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};ie.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),r=n.getCoordinate(0);if(!r.equals2D(t[0]))throw new Kn("bad split edge start point at "+r);var s=e.get(e.size()-1),l=s.getCoordinates(),p=l[l.length-1];if(!p.equals2D(t[t.length-1]))throw new Kn("bad split edge end point at "+p)};ie.prototype.interfaces_=function(){return[]};ie.prototype.getClass=function(){return ie};var Jr=function(){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?n>=r?0:1:n>=r?7:6:t>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var s=arguments[0],l=arguments[1],p=l.x-s.x,o=l.y-s.y;if(p===0&&o===0)throw new ct("Cannot compute the octant for two identical points "+s);return Jr.octant(p,o)}};var Pn=function(){};Pn.prototype.getCoordinates=function(){};Pn.prototype.size=function(){};Pn.prototype.getCoordinate=function(e){};Pn.prototype.isClosed=function(){};Pn.prototype.setData=function(e){};Pn.prototype.getData=function(){};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};var oo=function(){};oo.prototype.addIntersection=function(e,t){};oo.prototype.interfaces_=function(){return[Pn]};oo.prototype.getClass=function(){return oo};var It=function(){this._nodeList=new ie(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};It.prototype.getCoordinates=function(){return this._pts};It.prototype.size=function(){return this._pts.length};It.prototype.getCoordinate=function(e){return this._pts[e]};It.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};It.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};It.prototype.setData=function(e){this._data=e};It.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Jr.octant(e,t)};It.prototype.getData=function(){return this._data};It.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],s=arguments[3],l=new v(n.getIntersection(s));this.addIntersection(l,r)}};It.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};It.prototype.getNodeList=function(){return this._nodeList};It.prototype.addIntersectionNode=function(e,t){var n=t,r=n+1;if(r<this._pts.length){var s=this._pts[r];e.equals2D(s)&&(n=r)}var l=this._nodeList.add(e,n);return l};It.prototype.addIntersections=function(e,t,n){for(var r=this,s=0;s<e.getIntersectionNum();s++)r.addIntersection(e,t,n,s)};It.prototype.interfaces_=function(){return[oo]};It.prototype.getClass=function(){return It};It.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new b;return It.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],s=n.iterator();s.hasNext();){var l=s.next();l.getNodeList().addSplitEdges(r)}};var F=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new v,this.p1=new v;else if(arguments.length===1){var e=arguments[0];this.p0=new v(e.p0),this.p1=new v(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];this.p0=new v(t,n),this.p1=new v(r,s)}},_u={serialVersionUID:{configurable:!0}};F.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};F.prototype.orientationIndex=function(){if(arguments[0]instanceof F){var e=arguments[0],t=O.orientationIndex(this.p0,this.p1,e.p0),n=O.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof v){var r=arguments[0];return O.orientationIndex(this.p0,this.p1,r)}};F.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};F.prototype.isVertical=function(){return this.p0.x===this.p1.x};F.prototype.equals=function(e){if(!(e instanceof F))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};F.prototype.intersection=function(e){var t=new zr;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};F.prototype.project=function(){if(arguments[0]instanceof v){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new v(e);var t=this.projectionFactor(e),n=new v;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof F){var r=arguments[0],s=this.projectionFactor(r.p0),l=this.projectionFactor(r.p1);if(s>=1&&l>=1||s<=0&&l<=0)return null;var p=this.project(r.p0);s<0&&(p=this.p0),s>1&&(p=this.p1);var o=this.project(r.p1);return l<0&&(o=this.p0),l>1&&(o=this.p1),new F(p,o)}};F.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};F.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};F.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};F.prototype.distancePerpendicular=function(e){return O.distancePointLinePerpendicular(e,this.p0,this.p1)};F.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};F.prototype.midPoint=function(){return F.midPoint(this.p0,this.p1)};F.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;if(r<=0)return z.NaN;var s=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r;return s};F.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),r=z.MAX_VALUE,s=null,l=this.closestPoint(e.p0);r=l.distance(e.p0),n[0]=l,n[1]=e.p0;var p=this.closestPoint(e.p1);s=p.distance(e.p1),s<r&&(r=s,n[0]=p,n[1]=e.p1);var o=e.closestPoint(this.p0);s=o.distance(this.p0),s<r&&(r=s,n[0]=this.p0,n[1]=o);var x=e.closestPoint(this.p1);return s=x.distance(this.p1),s<r&&(r=s,n[0]=this.p1,n[1]=x),n};F.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),r=this.p1.distance(e);return n<r?this.p0:this.p1};F.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};F.prototype.getLength=function(){return this.p0.distance(this.p1)};F.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};F.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};F.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};F.prototype.lineIntersection=function(e){try{var t=Ve.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof ki))throw n}finally{}return null};F.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};F.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,l=this.p1.y-this.p0.y,p=Math.sqrt(s*s+l*l),o=0,x=0;if(t!==0){if(p<=0)throw new Error("Cannot compute offset from zero-length line segment");o=t*s/p,x=t*l/p}var M=n-x,P=r+o,he=new v(M,P);return he};F.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};F.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||z.isNaN(t))&&(t=1),t};F.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};F.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};F.prototype.distance=function(){if(arguments[0]instanceof F){var e=arguments[0];return O.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof v){var t=arguments[0];return O.distancePointLine(t,this.p0,this.p1)}};F.prototype.pointAlong=function(e){var t=new v;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};F.prototype.hashCode=function(){var e=z.doubleToLongBits(this.p0.x);e^=z.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=z.doubleToLongBits(this.p1.x);n^=z.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return t^r};F.prototype.interfaces_=function(){return[ke,Ge]};F.prototype.getClass=function(){return F};F.midPoint=function(e,t){return new v((e.x+t.x)/2,(e.y+t.y)/2)};_u.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(F,_u);var so=function(){this.tempEnv1=new T,this.tempEnv2=new T,this._overlapSeg1=new F,this._overlapSeg2=new F};so.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var ye=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=r};ye.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};ye.prototype.computeSelect=function(e,t,n,r){var s=this._pts[t],l=this._pts[n];if(r.tempEnv1.init(s,l),n-t===1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var p=Math.trunc((t+n)/2);t<p&&this.computeSelect(e,t,p,r),p<n&&this.computeSelect(e,p,n,r)};ye.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)t[n++]=e._pts[r];return t};ye.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};ye.prototype.setId=function(e){this._id=e};ye.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};ye.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new T(e,t)}return this._env};ye.prototype.getEndIndex=function(){return this._end};ye.prototype.getStartIndex=function(){return this._start};ye.prototype.getContext=function(){return this._context};ye.prototype.getId=function(){return this._id};ye.prototype.computeOverlapsInternal=function(e,t,n,r,s,l){var p=this._pts[e],o=this._pts[t],x=n._pts[r],M=n._pts[s];if(t-e===1&&s-r===1)return l.overlap(this,e,n,r),null;if(l.tempEnv1.init(p,o),l.tempEnv2.init(x,M),!l.tempEnv1.intersects(l.tempEnv2))return null;var P=Math.trunc((e+t)/2),he=Math.trunc((r+s)/2);e<P&&(r<he&&this.computeOverlapsInternal(e,P,n,r,he,l),he<s&&this.computeOverlapsInternal(e,P,n,he,s,l)),P<t&&(r<he&&this.computeOverlapsInternal(P,t,n,r,he,l),he<s&&this.computeOverlapsInternal(P,t,n,he,s,l))};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var on=function(){};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};on.getChainStartIndices=function(e){var t=0,n=new b;n.add(new sn(t));do{var r=on.findChainEnd(e,t);n.add(new sn(r)),t=r}while(t<e.length-1);var s=on.toIntArray(n);return s};on.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=it.quadrant(e[n],e[n+1]),s=t+1;s<e.length;){if(!e[s-1].equals2D(e[s])){var l=it.quadrant(e[s-1],e[s]);if(l!==r)break}s++}return s-1};on.getChains=function(){if(arguments.length===1){var e=arguments[0];return on.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],r=new b,s=on.getChainStartIndices(t),l=0;l<s.length-1;l++){var p=new ye(t,s[l],s[l+1],n);r.add(p)}return r}};on.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var br=function(){};br.prototype.computeNodes=function(e){};br.prototype.getNodedSubstrings=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};var ao=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};ao.prototype.setSegmentIntersector=function(e){this._segInt=e};ao.prototype.interfaces_=function(){return[br]};ao.prototype.getClass=function(){return ao};var qs=function(e){function t(r){r?e.call(this,r):e.call(this),this._monoChains=new b,this._index=new mu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(r){for(var s=this,l=on.getChains(r.getCoordinates(),r),p=l.iterator();p.hasNext();){var o=p.next();o.setId(s._idCounter++),s._index.insert(o.getEnvelope(),o),s._monoChains.add(o)}},t.prototype.computeNodes=function(r){var s=this;this._nodedSegStrings=r;for(var l=r.iterator();l.hasNext();)s.add(l.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var r=this,s=new La(this._segInt),l=this._monoChains.iterator();l.hasNext();)for(var p=l.next(),o=r._index.query(p.getEnvelope()),x=o.iterator();x.hasNext();){var M=x.next();if(M.getId()>p.getId()&&(p.computeOverlaps(M,s),r._nOverlaps++),r._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return La},Object.defineProperties(t,n),t}(ao),La=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],s=arguments[2],l=arguments[3],p=n.getContext(),o=s.getContext();this._si.processIntersections(p,r,o,l)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(so),Z=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var s=arguments[0],l=arguments[1],p=arguments[2],o=arguments[3];this.setQuadrantSegments(s),this.setEndCapStyle(l),this.setJoinStyle(p),this.setMitreLimit(o)}}},nr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Z.prototype.getEndCapStyle=function(){return this._endCapStyle};Z.prototype.isSingleSided=function(){return this._isSingleSided};Z.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Z.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Z.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Z.JOIN_ROUND&&(this._quadrantSegments=Z.DEFAULT_QUADRANT_SEGMENTS)};Z.prototype.getJoinStyle=function(){return this._joinStyle};Z.prototype.setJoinStyle=function(e){this._joinStyle=e};Z.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Z.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Z.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Z.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Z.prototype.getMitreLimit=function(){return this._mitreLimit};Z.prototype.setMitreLimit=function(e){this._mitreLimit=e};Z.prototype.setSingleSided=function(e){this._isSingleSided=e};Z.prototype.interfaces_=function(){return[]};Z.prototype.getClass=function(){return Z};Z.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};nr.CAP_ROUND.get=function(){return 1};nr.CAP_FLAT.get=function(){return 2};nr.CAP_SQUARE.get=function(){return 3};nr.JOIN_ROUND.get=function(){return 1};nr.JOIN_MITRE.get=function(){return 2};nr.JOIN_BEVEL.get=function(){return 3};nr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};nr.DEFAULT_MITRE_LIMIT.get=function(){return 5};nr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Z,nr);var dt=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=O.COUNTERCLOCKWISE,this._inputLine=e||null},mo={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};dt.prototype.isDeletable=function(e,t,n,r){var s=this._inputLine[e],l=this._inputLine[t],p=this._inputLine[n];return!this.isConcave(s,l,p)||!this.isShallow(s,l,p,r)?!1:this.isShallowSampled(s,l,e,n,r)};dt.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(n),s=!1;r<this._inputLine.length;){var l=!1;e.isDeletable(t,n,r,e._distanceTol)&&(e._isDeleted[n]=dt.DELETE,l=!0,s=!0),l?t=r:t=n,n=e.findNextNonDeletedIndex(t),r=e.findNextNonDeletedIndex(n)}return s};dt.prototype.isShallowConcavity=function(e,t,n,r){var s=O.computeOrientation(e,t,n),l=s===this._angleOrientation;if(!l)return!1;var p=O.distancePointLine(t,e,n);return p<r};dt.prototype.isShallowSampled=function(e,t,n,r,s){var l=this,p=Math.trunc((r-n)/dt.NUM_PTS_TO_CHECK);p<=0&&(p=1);for(var o=n;o<r;o+=p)if(!l.isShallow(e,t,l._inputLine[o],s))return!1;return!0};dt.prototype.isConcave=function(e,t,n){var r=O.computeOrientation(e,t,n),s=r===this._angleOrientation;return s};dt.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=O.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};dt.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===dt.DELETE;)t++;return t};dt.prototype.isShallow=function(e,t,n,r){var s=O.distancePointLine(t,e,n);return s<r};dt.prototype.collapseLine=function(){for(var e=this,t=new po,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==dt.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};dt.prototype.interfaces_=function(){return[]};dt.prototype.getClass=function(){return dt};dt.simplify=function(e,t){var n=new dt(e);return n.simplify(t)};mo.INIT.get=function(){return 0};mo.DELETE.get=function(){return 1};mo.KEEP.get=function(){return 1};mo.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(dt,mo);var we=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new b},Eu={COORDINATE_ARRAY_TYPE:{configurable:!0}};we.prototype.getCoordinates=function(){var e=this._ptList.toArray(we.COORDINATE_ARRAY_TYPE);return e};we.prototype.setPrecisionModel=function(e){this._precisionModel=e};we.prototype.addPt=function(e){var t=new v(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};we.prototype.revere=function(){};we.prototype.addPts=function(e,t){var n=this;if(t)for(var r=0;r<e.length;r++)n.addPt(e[r]);else for(var s=e.length-1;s>=0;s--)n.addPt(e[s])};we.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};we.prototype.toString=function(){var e=new H,t=e.createLineString(this.getCoordinates());return t.toString()};we.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new v(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};we.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};Eu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(we,Eu);var K=function(){},ci={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};K.prototype.interfaces_=function(){return[]};K.prototype.getClass=function(){return K};K.toDegrees=function(e){return e*180/Math.PI};K.normalize=function(e){for(;e>Math.PI;)e-=K.PI_TIMES_2;for(;e<=-Math.PI;)e+=K.PI_TIMES_2;return e};K.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=n.x-t.x,s=n.y-t.y;return Math.atan2(s,r)}};K.isAcute=function(e,t,n){var r=e.x-t.x,s=e.y-t.y,l=n.x-t.x,p=n.y-t.y,o=r*l+s*p;return o>0};K.isObtuse=function(e,t,n){var r=e.x-t.x,s=e.y-t.y,l=n.x-t.x,p=n.y-t.y,o=r*l+s*p;return o<0};K.interiorAngle=function(e,t,n){var r=K.angle(t,e),s=K.angle(t,n);return Math.abs(s-r)};K.normalizePositive=function(e){if(e<0){for(;e<0;)e+=K.PI_TIMES_2;e>=K.PI_TIMES_2&&(e=0)}else{for(;e>=K.PI_TIMES_2;)e-=K.PI_TIMES_2;e<0&&(e=0)}return e};K.angleBetween=function(e,t,n){var r=K.angle(t,e),s=K.angle(t,n);return K.diff(r,s)};K.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};K.toRadians=function(e){return e*Math.PI/180};K.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?K.COUNTERCLOCKWISE:n<0?K.CLOCKWISE:K.NONE};K.angleBetweenOriented=function(e,t,n){var r=K.angle(t,e),s=K.angle(t,n),l=s-r;return l<=-Math.PI?l+K.PI_TIMES_2:l>Math.PI?l-K.PI_TIMES_2:l};ci.PI_TIMES_2.get=function(){return 2*Math.PI};ci.PI_OVER_2.get=function(){return Math.PI/2};ci.PI_OVER_4.get=function(){return Math.PI/4};ci.COUNTERCLOCKWISE.get=function(){return O.COUNTERCLOCKWISE};ci.CLOCKWISE.get=function(){return O.CLOCKWISE};ci.NONE.get=function(){return O.COLLINEAR};Object.defineProperties(K,ci);var lt=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new F,this._seg1=new F,this._offset0=new F,this._offset1=new F,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new zr,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Z.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},_o={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};lt.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=O.computeOrientation(this._s0,this._s1,this._s2),r=n===O.CLOCKWISE&&this._side===w.LEFT||n===O.COUNTERCLOCKWISE&&this._side===w.RIGHT;n===0?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};lt.prototype.addLineEndCap=function(e,t){var n=new F(e,t),r=new F;this.computeOffsetSegment(n,w.LEFT,this._distance,r);var s=new F;this.computeOffsetSegment(n,w.RIGHT,this._distance,s);var l=t.x-e.x,p=t.y-e.y,o=Math.atan2(p,l);switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,o+Math.PI/2,o-Math.PI/2,O.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case Z.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(s.p1);break;case Z.CAP_SQUARE:var x=new v;x.x=Math.abs(this._distance)*Math.cos(o),x.y=Math.abs(this._distance)*Math.sin(o);var M=new v(r.p1.x+x.x,r.p1.y+x.y),P=new v(s.p1.x+x.x,s.p1.y+x.y);this._segList.addPt(M),this._segList.addPt(P);break}};lt.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};lt.prototype.addMitreJoin=function(e,t,n,r){var s=!0,l=null;try{l=Ve.intersection(t.p0,t.p1,n.p0,n.p1);var p=r<=0?1:l.distance(e)/Math.abs(r);p>this._bufParams.getMitreLimit()&&(s=!1)}catch(o){if(o instanceof ki)l=new v(0,0),s=!1;else throw o}finally{}s?this._segList.addPt(l):this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())};lt.prototype.addFilletCorner=function(e,t,n,r,s){var l=t.x-e.x,p=t.y-e.y,o=Math.atan2(p,l),x=n.x-e.x,M=n.y-e.y,P=Math.atan2(M,x);r===O.CLOCKWISE?o<=P&&(o+=2*Math.PI):o>=P&&(o-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,o,P,r,s),this._segList.addPt(n)};lt.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Z.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Z.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};lt.prototype.createSquare=function(e){this._segList.addPt(new v(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new v(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};lt.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};lt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};lt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};lt.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};lt.prototype.addLimitedMitreJoin=function(e,t,n,r){var s=this._seg0.p1,l=K.angle(s,this._seg0.p0),p=K.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1),o=p/2,x=K.normalize(l+o),M=K.normalize(x+Math.PI),P=r*n,he=P*Math.abs(Math.sin(o)),nt=n-he,_e=s.x+P*Math.cos(M),Bt=s.y+P*Math.sin(M),Fn=new v(_e,Bt),yr=new F(s,Fn),Io=yr.pointAlongOffset(1,nt),rl=yr.pointAlongOffset(1,-nt);this._side===w.LEFT?(this._segList.addPt(Io),this._segList.addPt(rl)):(this._segList.addPt(rl),this._segList.addPt(Io))};lt.prototype.computeOffsetSegment=function(e,t,n,r){var s=t===w.LEFT?1:-1,l=e.p1.x-e.p0.x,p=e.p1.y-e.p0.y,o=Math.sqrt(l*l+p*p),x=s*n*l/o,M=s*n*p/o;r.p0.x=e.p0.x-M,r.p0.y=e.p0.y+x,r.p1.x=e.p1.x-M,r.p1.y=e.p1.y+x};lt.prototype.addFilletArc=function(e,t,n,r,s){var l=this,p=r===O.CLOCKWISE?-1:1,o=Math.abs(t-n),x=Math.trunc(o/this._filletAngleQuantum+.5);if(x<1)return null;for(var M=0,P=o/x,he=M,nt=new v;he<o;){var _e=t+p*he;nt.x=e.x+s*Math.cos(_e),nt.y=e.y+s*Math.sin(_e),l._segList.addPt(nt),he+=P}};lt.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new v((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new v((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};lt.prototype.createCircle=function(e){var t=new v(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};lt.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};lt.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new we,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*lt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};lt.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Z.JOIN_BEVEL||this._bufParams.getJoinStyle()===Z.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,O.CLOCKWISE,this._distance))};lt.prototype.closeRing=function(){this._segList.closeRing()};lt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};lt.prototype.interfaces_=function(){return[]};lt.prototype.getClass=function(){return lt};_o.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};_o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};_o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};_o.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(lt,_o);var le=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};le.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,r=Math.abs(t),s=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],s):this.computeOffsetCurve(e,n,s);var l=s.getCoordinates();return n&&W.reverse(l),l};le.prototype.computeSingleSidedBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var s=dt.simplify(e,-r),l=s.length-1;n.initSideSegments(s[l],s[l-1],w.LEFT),n.addFirstSegment();for(var p=l-2;p>=0;p--)n.addNextSegment(s[p],!0)}else{n.addSegments(e,!1);var o=dt.simplify(e,r),x=o.length-1;n.initSideSegments(o[0],o[1],w.LEFT),n.addFirstSegment();for(var M=2;M<=x;M++)n.addNextSegment(o[M],!0)}n.addLastSegment(),n.closeRing()};le.prototype.computeRingBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);t===w.RIGHT&&(r=-r);var s=dt.simplify(e,r),l=s.length-1;n.initSideSegments(s[l-1],s[0],t);for(var p=1;p<=l;p++){var o=p!==1;n.addNextSegment(s[p],o)}n.closeRing()};le.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),r=dt.simplify(e,n),s=r.length-1;t.initSideSegments(r[0],r[1],w.LEFT);for(var l=2;l<=s;l++)t.addNextSegment(r[l],!0);t.addLastSegment(),t.addLineEndCap(r[s-1],r[s]);var p=dt.simplify(e,-n),o=p.length-1;t.initSideSegments(p[o],p[o-1],w.LEFT);for(var x=o-2;x>=0;x--)t.addNextSegment(p[x],!0);t.addLastSegment(),t.addLineEndCap(p[1],p[0]),t.closeRing()};le.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:t.createCircle(e);break;case Z.CAP_SQUARE:t.createSquare(e);break}};le.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var s=t<0;this.computeSingleSidedBufferCurve(e,s,r)}else this.computeLineBufferCurve(e,r);var l=r.getCoordinates();return l};le.prototype.getBufferParameters=function(){return this._bufParams};le.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};le.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return le.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()};le.prototype.computeOffsetCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var s=dt.simplify(e,-r),l=s.length-1;n.initSideSegments(s[l],s[l-1],w.LEFT),n.addFirstSegment();for(var p=l-2;p>=0;p--)n.addNextSegment(s[p],!0)}else{var o=dt.simplify(e,r),x=o.length-1;n.initSideSegments(o[0],o[1],w.LEFT),n.addFirstSegment();for(var M=2;M<=x;M++)n.addNextSegment(o[M],!0)}n.addLastSegment()};le.prototype.getSegGen=function(e){return new lt(this._precisionModel,this._bufParams,e)};le.prototype.interfaces_=function(){return[]};le.prototype.getClass=function(){return le};le.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new v(e[n]);return t};var Zr=function(){this._subgraphs=null,this._seg=new F,this._cga=new O;var e=arguments[0];this._subgraphs=e},Iu={DepthSegment:{configurable:!0}};Zr.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new b,r=this._subgraphs.iterator();r.hasNext();){var s=r.next(),l=s.getEnvelope();t.y<l.getMinY()||t.y>l.getMaxY()||e.findStabbedSegments(t,s.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(G(arguments[2],Ue)&&arguments[0]instanceof v&&arguments[1]instanceof bs)for(var p=arguments[0],o=arguments[1],x=arguments[2],M=o.getEdge().getCoordinates(),P=0;P<M.length-1;P++){e._seg.p0=M[P],e._seg.p1=M[P+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var he=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(he<p.x)&&!e._seg.isHorizontal()&&!(p.y<e._seg.p0.y||p.y>e._seg.p1.y)&&O.computeOrientation(e._seg.p0,e._seg.p1,p)!==O.RIGHT){var nt=o.getDepth(w.LEFT);e._seg.p0.equals(M[P])||(nt=o.getDepth(w.RIGHT));var _e=new Pr(e._seg,nt);x.add(_e)}}else if(G(arguments[2],Ue)&&arguments[0]instanceof v&&G(arguments[1],Ue))for(var Bt=arguments[0],Fn=arguments[1],yr=arguments[2],Io=Fn.iterator();Io.hasNext();){var rl=Io.next();rl.isForward()&&e.findStabbedSegments(Bt,rl,yr)}}};Zr.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=He.min(t);return n._leftDepth};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Iu.DepthSegment.get=function(){return Pr};Object.defineProperties(Zr,Iu);var Pr=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new F(e),this._leftDepth=t};Pr.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};Pr.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};Pr.prototype.toString=function(){return this._upwardSeg.toString()};Pr.prototype.interfaces_=function(){return[ke]};Pr.prototype.getClass=function(){return Pr};var tt=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};tt.prototype.area=function(){return tt.area(this.p0,this.p1,this.p2)};tt.prototype.signedArea=function(){return tt.signedArea(this.p0,this.p1,this.p2)};tt.prototype.interpolateZ=function(e){if(e===null)throw new ct("Supplied point is null.");return tt.interpolateZ(e,this.p0,this.p1,this.p2)};tt.prototype.longestSideLength=function(){return tt.longestSideLength(this.p0,this.p1,this.p2)};tt.prototype.isAcute=function(){return tt.isAcute(this.p0,this.p1,this.p2)};tt.prototype.circumcentre=function(){return tt.circumcentre(this.p0,this.p1,this.p2)};tt.prototype.area3D=function(){return tt.area3D(this.p0,this.p1,this.p2)};tt.prototype.centroid=function(){return tt.centroid(this.p0,this.p1,this.p2)};tt.prototype.inCentre=function(){return tt.inCentre(this.p0,this.p1,this.p2)};tt.prototype.interfaces_=function(){return[]};tt.prototype.getClass=function(){return tt};tt.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};tt.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};tt.det=function(e,t,n,r){return e*r-t*n};tt.interpolateZ=function(e,t,n,r){var s=t.x,l=t.y,p=n.x-s,o=r.x-s,x=n.y-l,M=r.y-l,P=p*M-o*x,he=e.x-s,nt=e.y-l,_e=(M*he-o*nt)/P,Bt=(-x*he+p*nt)/P,Fn=t.z+_e*(n.z-t.z)+Bt*(r.z-t.z);return Fn};tt.longestSideLength=function(e,t,n){var r=e.distance(t),s=t.distance(n),l=n.distance(e),p=r;return s>p&&(p=s),l>p&&(p=l),p};tt.isAcute=function(e,t,n){return!(!K.isAcute(e,t,n)||!K.isAcute(t,n,e)||!K.isAcute(n,e,t))};tt.circumcentre=function(e,t,n){var r=n.x,s=n.y,l=e.x-r,p=e.y-s,o=t.x-r,x=t.y-s,M=2*tt.det(l,p,o,x),P=tt.det(p,l*l+p*p,x,o*o+x*x),he=tt.det(l,l*l+p*p,o,o*o+x*x),nt=r-P/M,_e=s+he/M;return new v(nt,_e)};tt.perpendicularBisector=function(e,t){var n=t.x-e.x,r=t.y-e.y,s=new Ve(e.x+n/2,e.y+r/2,1),l=new Ve(e.x-r+n/2,e.y+n+r/2,1);return new Ve(s,l)};tt.angleBisector=function(e,t,n){var r=t.distance(e),s=t.distance(n),l=r/(r+s),p=n.x-e.x,o=n.y-e.y,x=new v(e.x+l*p,e.y+l*o);return x};tt.area3D=function(e,t,n){var r=t.x-e.x,s=t.y-e.y,l=t.z-e.z,p=n.x-e.x,o=n.y-e.y,x=n.z-e.z,M=s*x-l*o,P=l*p-r*x,he=r*o-s*p,nt=M*M+P*P+he*he,_e=Math.sqrt(nt)/2;return _e};tt.centroid=function(e,t,n){var r=(e.x+t.x+n.x)/3,s=(e.y+t.y+n.y)/3;return new v(r,s)};tt.inCentre=function(e,t,n){var r=t.distance(n),s=e.distance(n),l=e.distance(t),p=r+s+l,o=(r*e.x+s*t.x+l*n.x)/p,x=(r*e.y+s*t.y+l*n.y)/p;return new v(o,x)};var Fe=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new b;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};Fe.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addPolygon=function(e){var t=this,n=this._distance,r=w.LEFT;this._distance<0&&(n=-this._distance,r=w.RIGHT);var s=e.getExteriorRing(),l=W.removeRepeatedPoints(s.getCoordinates());if(this._distance<0&&this.isErodedCompletely(s,this._distance)||this._distance<=0&&l.length<3)return null;this.addPolygonRing(l,n,r,m.EXTERIOR,m.INTERIOR);for(var p=0;p<e.getNumInteriorRing();p++){var o=e.getInteriorRingN(p),x=W.removeRepeatedPoints(o.getCoordinates());t._distance>0&&t.isErodedCompletely(o,-t._distance)||t.addPolygonRing(x,n,w.opposite(r),m.INTERIOR,m.EXTERIOR)}};Fe.prototype.isTriangleErodedCompletely=function(e,t){var n=new tt(e[0],e[1],e[2]),r=n.inCentre(),s=O.distancePointLine(r,n.p0,n.p1);return s<Math.abs(t)};Fe.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=W.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var r=new It(e,new et(0,m.BOUNDARY,t,n));this._curveList.add(r)};Fe.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Fe.prototype.addPolygonRing=function(e,t,n,r,s){if(t===0&&e.length<Ln.MINIMUM_VALID_SIZE)return null;var l=r,p=s;e.length>=Ln.MINIMUM_VALID_SIZE&&O.isCCW(e)&&(l=s,p=r,n=w.opposite(n));var o=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(o,l,p)};Fe.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Rt?this.addPolygon(e):e instanceof pt?this.addLineString(e):e instanceof de?this.addPoint(e):e instanceof Ni?this.addCollection(e):e instanceof Lr?this.addCollection(e):e instanceof xn?this.addCollection(e):e instanceof ne&&this.addCollection(e)};Fe.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),s=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>s};Fe.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);t.add(r)}};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};var Li=function(){};Li.prototype.locate=function(e){};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};var Sn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};Sn.prototype.next=function(){if(this._atStart)return this._atStart=!1,Sn.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new zi;var e=this._parent.getGeometryN(this._index++);return e instanceof ne?(this._subcollectionIterator=new Sn(e),this._subcollectionIterator.next()):e};Sn.prototype.remove=function(){throw new Error(this.getClass().getName())};Sn.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Sn.prototype.interfaces_=function(){return[Gi]};Sn.prototype.getClass=function(){return Sn};Sn.isAtomic=function(e){return!(e instanceof ne)};var Ce=function(){this._geom=null;var e=arguments[0];this._geom=e};Ce.prototype.locate=function(e){return Ce.locate(e,this._geom)};Ce.prototype.interfaces_=function(){return[Li]};Ce.prototype.getClass=function(){return Ce};Ce.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.isPointInRing(e,t.getCoordinates()):!1};Ce.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!Ce.isPointInRing(e,n))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var s=t.getInteriorRingN(r);if(Ce.isPointInRing(e,s))return!1}return!0};Ce.containsPoint=function(e,t){if(t instanceof Rt)return Ce.containsPointInPolygon(e,t);if(t instanceof ne)for(var n=new Sn(t);n.hasNext();){var r=n.next();if(r!==t&&Ce.containsPoint(e,r))return!0}return!1};Ce.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:Ce.containsPoint(e,t)?m.INTERIOR:m.EXTERIOR};var Qt=function(){this._edgeMap=new jt,this._edgeList=null,this._ptInAreaLocation=[m.NONE,m.NONE]};Qt.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Qt.prototype.propagateSideLabels=function(e){for(var t=m.NONE,n=this.iterator();n.hasNext();){var r=n.next(),s=r.getLabel();s.isArea(e)&&s.getLocation(e,w.LEFT)!==m.NONE&&(t=s.getLocation(e,w.LEFT))}if(t===m.NONE)return null;for(var l=t,p=this.iterator();p.hasNext();){var o=p.next(),x=o.getLabel();if(x.getLocation(e,w.ON)===m.NONE&&x.setLocation(e,w.ON,l),x.isArea(e)){var M=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(P!==m.NONE){if(P!==l)throw new Jn("side location conflict",o.getCoordinate());M===m.NONE&&U.shouldNeverReachHere("found single null side (at "+o.getCoordinate()+")"),l=M}else U.isTrue(x.getLocation(e,w.LEFT)===m.NONE,"found single null side"),x.setLocation(e,w.RIGHT,l),x.setLocation(e,w.LEFT,l)}}};Qt.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};Qt.prototype.print=function(e){Ut.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Qt.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Qt.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel(),s=r.getLocation(e,w.LEFT);U.isTrue(s!==m.NONE,"Found unlabelled area edge");for(var l=s,p=this.iterator();p.hasNext();){var o=p.next(),x=o.getLabel();U.isTrue(x.isArea(e),"Found non-area edge");var M=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(M===P||P!==l)return!1;l=M}return!0};Qt.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=t._edgeList.get(n);if(r===e)return n}return-1};Qt.prototype.iterator=function(){return this.getEdges().iterator()};Qt.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new b(this._edgeMap.values())),this._edgeList};Qt.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===m.NONE&&(this._ptInAreaLocation[e]=Ce.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};Qt.prototype.toString=function(){var e=new yn;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};Qt.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};Qt.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var s=r.next(),l=s.getLabel(),p=0;p<2;p++)l.isLine(p)&&l.getLocation(p)===m.BOUNDARY&&(n[p]=!0);for(var o=this.iterator();o.hasNext();)for(var x=o.next(),M=x.getLabel(),P=0;P<2;P++)if(M.isAnyNull(P)){var he=m.NONE;if(n[P])he=m.EXTERIOR;else{var nt=x.getCoordinate();he=t.getLocation(P,nt,e)}M.setAllLocationsIfNull(P,he)}};Qt.prototype.getDegree=function(){return this._edgeMap.size()};Qt.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};Qt.prototype.interfaces_=function(){return[]};Qt.prototype.getClass=function(){return Qt};var Ac=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,s=null,l=this._SCANNING_FOR_INCOMING,p=0;p<this._resultAreaEdgeList.size();p++){var o=n._resultAreaEdgeList.get(p),x=o.getSym();if(o.getLabel().isArea())switch(r===null&&o.isInResult()&&(r=o),l){case n._SCANNING_FOR_INCOMING:if(!x.isInResult())continue;s=x,l=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!o.isInResult())continue;s.setNext(o),l=n._SCANNING_FOR_INCOMING;break}}if(l===this._LINKING_TO_OUTGOING){if(r===null)throw new Jn("no outgoing dirEdge found",this.getCoordinate());U.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),s.setNext(r)}},t.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var s=n.get(0);if(r===1)return s;var l=n.get(r-1),p=s.getQuadrant(),o=l.getQuadrant();return it.isNorthern(p)&&it.isNorthern(o)?s:!it.isNorthern(p)&&!it.isNorthern(o)?l:s.getDy()!==0?s:l.getDy()!==0?l:(U.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){Ut.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var s=r.next();n.print("out "),s.print(n),n.println(),n.print("in "),s.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new b;for(var r=this.iterator();r.hasNext();){var s=r.next();(s.isInResult()||s.getSym().isInResult())&&n._resultAreaEdgeList.add(s)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var s=r.next(),l=s.getLabel();l.setAllLocationsIfNull(0,n.getLocation(0)),l.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,s=null,l=this._edgeList.size()-1;l>=0;l--){var p=n._edgeList.get(l),o=p.getSym();s===null&&(s=o),r!==null&&o.setNext(r),r=p}s.setNext(r)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],s=this.findIndex(r),l=r.getDepth(w.LEFT),p=r.getDepth(w.RIGHT),o=this.computeDepths(s+1,this._edgeList.size(),l),x=this.computeDepths(0,s,o);if(x!==p)throw new Jn("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var M=arguments[0],P=arguments[1],he=arguments[2],nt=he,_e=M;_e<P;_e++){var Bt=n._edgeList.get(_e);Bt.setEdgeDepths(w.RIGHT,nt),nt=Bt.getDepth(w.LEFT)}return nt}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),s=r.getLabel();s.merge(r.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,s=null,l=null,p=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var x=r._resultAreaEdgeList.get(o),M=x.getSym();switch(s===null&&x.getEdgeRing()===n&&(s=x),p){case r._SCANNING_FOR_INCOMING:if(M.getEdgeRing()!==n)continue;l=M,p=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(x.getEdgeRing()!==n)continue;l.setNextMin(x),p=r._SCANNING_FOR_INCOMING;break}}p===this._LINKING_TO_OUTGOING&&(U.isTrue(s!==null,"found null for first outgoing dirEdge"),U.isTrue(s.getEdgeRing()===n,"unable to link last incoming dirEdge"),l.setNextMin(s))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var s=r.next();s.isInResult()&&n++}return n}else if(arguments.length===1){for(var l=arguments[0],p=0,o=this.iterator();o.hasNext();){var x=o.next();x.getEdgeRing()===l&&p++}return p}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=m.NONE,r=this.iterator();r.hasNext();){var s=r.next(),l=s.getSym();if(!s.isLineEdge()){if(s.isInResult()){n=m.INTERIOR;break}if(l.isInResult()){n=m.EXTERIOR;break}}}if(n===m.NONE)return null;for(var p=n,o=this.iterator();o.hasNext();){var x=o.next(),M=x.getSym();x.isLineEdge()?x.getEdge().setCovered(p===m.INTERIOR):(x.isInResult()&&(p=m.EXTERIOR),M.isInResult()&&(p=m.INTERIOR))}},t.prototype.computeLabelling=function(n){var r=this;e.prototype.computeLabelling.call(this,n),this._label=new et(m.NONE);for(var s=this.iterator();s.hasNext();)for(var l=s.next(),p=l.getEdge(),o=p.getLabel(),x=0;x<2;x++){var M=o.getLocation(x);(M===m.INTERIOR||M===m.BOUNDARY)&&r._label.setLocation(x,m.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qt),Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new is(n,new Ac)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xi),fr=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};fr.prototype.compareTo=function(e){var t=e,n=fr.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};fr.prototype.interfaces_=function(){return[ke]};fr.prototype.getClass=function(){return fr};fr.orientation=function(e){return W.increasingDirection(e)===1};fr.compareOriented=function(e,t,n,r){for(var s=t?1:-1,l=r?1:-1,p=t?e.length:-1,o=r?n.length:-1,x=t?0:e.length-1,M=r?0:n.length-1;;){var P=e[x].compareTo(n[M]);if(P!==0)return P;x+=s,M+=l;var he=x===p,nt=M===o;if(he&&!nt)return-1;if(!he&&nt)return 1;if(he&&nt)return 0}};var We=function(){this._edges=new b,this._ocaMap=new jt};We.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var s=r.getCoordinates(),l=0;l<s.length;l++)l>0&&e.print(","),e.print(s[l].x+" "+s[l].y);e.println(")")}e.print(")  ")};We.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};We.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};We.prototype.iterator=function(){return this._edges.iterator()};We.prototype.getEdges=function(){return this._edges};We.prototype.get=function(e){return this._edges.get(e)};We.prototype.findEqualEdge=function(e){var t=new fr(e.getCoordinates()),n=this._ocaMap.get(t);return n};We.prototype.add=function(e){this._edges.add(e);var t=new fr(e.getCoordinates());this._ocaMap.put(t,e)};We.prototype.interfaces_=function(){return[]};We.prototype.getClass=function(){return We};var Rr=function(){};Rr.prototype.processIntersections=function(e,t,n,r){};Rr.prototype.isDone=function(){};Rr.prototype.interfaces_=function(){return[]};Rr.prototype.getClass=function(){return Rr};var Le=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Le.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(Le.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var s=e.size()-1;if(t===0&&r===s||r===0&&t===s)return!0}}return!1};Le.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Le.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Le.prototype.getLineIntersector=function(){return this._li};Le.prototype.hasProperIntersection=function(){return this._hasProper};Le.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var s=e.getCoordinates()[t],l=e.getCoordinates()[t+1],p=n.getCoordinates()[r],o=n.getCoordinates()[r+1];this._li.computeIntersection(s,l,p,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Le.prototype.hasIntersection=function(){return this._hasIntersection};Le.prototype.isDone=function(){return!1};Le.prototype.hasInteriorIntersection=function(){return this._hasInterior};Le.prototype.interfaces_=function(){return[Rr]};Le.prototype.getClass=function(){return Le};Le.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var hn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new v(e),this.segmentIndex=t,this.dist=n};hn.prototype.getSegmentIndex=function(){return this.segmentIndex};hn.prototype.getCoordinate=function(){return this.coord};hn.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};hn.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};hn.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};hn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};hn.prototype.getDistance=function(){return this.dist};hn.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};hn.prototype.interfaces_=function(){return[ke]};hn.prototype.getClass=function(){return hn};var Rn=function(){this._nodeMap=new jt,this.edge=null;var e=arguments[0];this.edge=e};Rn.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Rn.prototype.iterator=function(){return this._nodeMap.values().iterator()};Rn.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next(),l=t.createSplitEdge(r,s);e.add(l),r=s}};Rn.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Rn.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,s=this.edge.pts[t.segmentIndex],l=t.dist>0||!t.coord.equals2D(s);l||r--;var p=new Array(r).fill(null),o=0;p[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)p[o++]=n.edge.pts[x];return l&&(p[o]=t.coord),new Go(p,new et(this.edge._label))};Rn.prototype.add=function(e,t,n){var r=new hn(e,t,n),s=this._nodeMap.get(r);return s!==null?s:(this._nodeMap.put(r,r),r)};Rn.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};var Or=function(){};Or.prototype.getChainStartIndices=function(e){var t=this,n=0,r=new b;r.add(new sn(n));do{var s=t.findChainEnd(e,n);r.add(new sn(s)),n=s}while(n<e.length-1);var l=Or.toIntArray(r);return l};Or.prototype.findChainEnd=function(e,t){for(var n=it.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){var s=it.quadrant(e[r-1],e[r]);if(s!==n)break;r++}return r-1};Or.prototype.interfaces_=function(){return[]};Or.prototype.getClass=function(){return Or};Or.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var $n=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new T,this.env2=new T;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Or;this.startIndex=t.getChainStartIndices(this.pts)};$n.prototype.getCoordinates=function(){return this.pts};$n.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};$n.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};$n.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r)}else if(arguments.length===6){var s=arguments[0],l=arguments[1],p=arguments[2],o=arguments[3],x=arguments[4],M=arguments[5],P=this.pts[s],he=this.pts[l],nt=p.pts[o],_e=p.pts[x];if(l-s===1&&x-o===1)return M.addIntersections(this.e,s,p.e,o),null;if(this.env1.init(P,he),this.env2.init(nt,_e),!this.env1.intersects(this.env2))return null;var Bt=Math.trunc((s+l)/2),Fn=Math.trunc((o+x)/2);s<Bt&&(o<Fn&&this.computeIntersectsForChain(s,Bt,p,o,Fn,M),Fn<x&&this.computeIntersectsForChain(s,Bt,p,Fn,x,M)),Bt<l&&(o<Fn&&this.computeIntersectsForChain(Bt,l,p,o,Fn,M),Fn<x&&this.computeIntersectsForChain(Bt,l,p,Fn,x,M))}};$n.prototype.getStartIndexes=function(){return this.startIndex};$n.prototype.computeIntersects=function(e,t){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var s=0;s<e.startIndex.length-1;s++)n.computeIntersectsForChain(r,e,s,t)};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var Vt=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)t._depth[n][r]=e.NULL_VALUE},Nu={NULL_VALUE:{configurable:!0}};Vt.prototype.getDepth=function(e,t){return this._depth[e][t]};Vt.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};Vt.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==Vt.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===Vt.NULL_VALUE}else if(arguments.length===2){var s=arguments[0],l=arguments[1];return this._depth[s][l]===Vt.NULL_VALUE}};Vt.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var r=1;r<3;r++){var s=0;e._depth[t][r]>n&&(s=1),e._depth[t][r]=s}}};Vt.prototype.getDelta=function(e){return this._depth[e][w.RIGHT]-this._depth[e][w.LEFT]};Vt.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?m.EXTERIOR:m.INTERIOR};Vt.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Vt.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var s=t.getLocation(n,r);(s===m.EXTERIOR||s===m.INTERIOR)&&(e.isNull(n,r)?e._depth[n][r]=Vt.depthAtLocation(s):e._depth[n][r]+=Vt.depthAtLocation(s))}else if(arguments.length===3){var l=arguments[0],p=arguments[1],o=arguments[2];o===m.INTERIOR&&this._depth[l][p]++}};Vt.prototype.interfaces_=function(){return[]};Vt.prototype.getClass=function(){return Vt};Vt.depthAtLocation=function(e){return e===m.EXTERIOR?0:e===m.INTERIOR?1:Vt.NULL_VALUE};Nu.NULL_VALUE.get=function(){return-1};Object.defineProperties(Vt,Nu);var Go=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Rn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Vt,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.pts=r,this._label=s}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new t(n,et.toLineLabel(this._label));return r},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var r=this;if(!(n instanceof t))return!1;var s=n;if(this.pts.length!==s.pts.length)return!1;for(var l=!0,p=!0,o=this.pts.length,x=0;x<this.pts.length;x++)if(r.pts[x].equals2D(s.pts[x])||(l=!1),r.pts[x].equals2D(s.pts[--o])||(p=!1),!l&&!p)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&n.print(","),n.print(r.pts[s].x+" "+r.pts[s].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var s=this.pts.length-1;s>=0;s--)n.print(r.pts[s]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new $n(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new T;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},t.prototype.addIntersection=function(n,r,s,l){var p=new v(n.getIntersection(l)),o=r,x=n.getEdgeDistance(s,l),M=o+1;if(M<this.pts.length){var P=this.pts[M];p.equals2D(P)&&(o=M,x=0)}this.eiList.add(p,o,x)},t.prototype.toString=function(){var n=this,r=new yn;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&r.append(","),r.append(n.pts[s].x+" "+n.pts[s].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},t.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var s=0;s<this.pts.length;s++)if(!r.pts[s].equals2D(n.pts[s]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,r,s){for(var l=this,p=0;p<n.getIntersectionNum();p++)l.addIntersection(n,r,s,p)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,w.ON),n.getLocation(1,w.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,w.LEFT),n.getLocation(1,w.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,w.RIGHT),n.getLocation(1,w.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Se),ee=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new We,this._bufParams=e||null};ee.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};ee.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new et(e.getLabel()),r.flip()),n.merge(r);var s=ee.depthDelta(r),l=t.getDepthDelta(),p=l+s;t.setDepthDelta(p)}else this._edgeList.add(e),e.setDepthDelta(ee.depthDelta(e.getLabel()))};ee.prototype.buildSubgraphs=function(e,t){for(var n=new b,r=e.iterator();r.hasNext();){var s=r.next(),l=s.getRightmostCoordinate(),p=new Zr(n),o=p.getDepth(l);s.computeDepth(o),s.findResultEdges(),n.add(s),t.add(s.getDirectedEdges(),s.getNodes())}};ee.prototype.createSubgraphs=function(e){for(var t=new b,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var s=new re;s.create(r),t.add(s)}}return He.sort(t,He.reverseOrder()),t};ee.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};ee.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new qs,n=new zr;return n.setPrecisionModel(e),t.setSegmentIntersector(new Le(n)),t};ee.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new le(n,this._bufParams),s=new Fe(e,t,r),l=s.getCurves();if(l.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(l,n),this._graph=new ht(new Cu),this._graph.addEdges(this._edgeList.getEdges());var p=this.createSubgraphs(this._graph),o=new ve(this._geomFact);this.buildSubgraphs(p,o);var x=o.getPolygons();if(x.size()<=0)return this.createEmptyResultGeometry();var M=this._geomFact.buildGeometry(x);return M};ee.prototype.computeNodedEdges=function(e,t){var n=this,r=this.getNoder(t);r.computeNodes(e);for(var s=r.getNodedSubstrings(),l=s.iterator();l.hasNext();){var p=l.next(),o=p.getCoordinates();if(!(o.length===2&&o[0].equals2D(o[1]))){var x=p.getData(),M=new Go(p.getCoordinates(),new et(x));n.insertUniqueEdge(M)}}};ee.prototype.setNoder=function(e){this._workingNoder=e};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};ee.depthDelta=function(e){var t=e.getLocation(0,w.LEFT),n=e.getLocation(0,w.RIGHT);return t===m.INTERIOR&&n===m.EXTERIOR?1:t===m.EXTERIOR&&n===m.INTERIOR?-1:0};ee.convertSegStrings=function(e){for(var t=new H,n=new b;e.hasNext();){var r=e.next(),s=t.createLineString(r.getCoordinates());n.add(s)}return t.buildGeometry(n)};var hr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],s=arguments[2],l=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=s,this._offsetY=l,this._isScaled=!this.isIntegerPrecision()}};hr.prototype.rescale=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var s=arguments[0],l=0;l<s.length;l++)s[l].x=s[l].x/e._scaleFactor+e._offsetX,s[l].y=s[l].y/e._scaleFactor+e._offsetY;s.length===2&&s[0].equals2D(s[1])&&Ut.out.println(s)}};hr.prototype.scale=function(){var e=this;if(G(arguments[0],wt)){for(var t=arguments[0],n=new b,r=t.iterator();r.hasNext();){var s=r.next();n.add(new It(e.scale(s.getCoordinates()),s.getData()))}return n}else if(arguments[0]instanceof Array){for(var l=arguments[0],p=new Array(l.length).fill(null),o=0;o<l.length;o++)p[o]=new v(Math.round((l[o].x-e._offsetX)*e._scaleFactor),Math.round((l[o].y-e._offsetY)*e._scaleFactor),l[o].z);var x=W.removeRepeatedPoints(p);return x}};hr.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};hr.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};hr.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};hr.prototype.interfaces_=function(){return[br]};hr.prototype.getClass=function(){return hr};var gn=function(){this._li=new zr,this._segStrings=null;var e=arguments[0];this._segStrings=e},xu={fact:{configurable:!0}};gn.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),r=n.getCoordinates();e.checkEndPtVertexIntersections(r[0],e._segStrings),e.checkEndPtVertexIntersections(r[r.length-1],e._segStrings)}else if(arguments.length===2){for(var s=arguments[0],l=arguments[1],p=l.iterator();p.hasNext();)for(var o=p.next(),x=o.getCoordinates(),M=1;M<x.length-1;M++)if(x[M].equals(s))throw new Kn("found endpt/interior pt intersection at index "+M+" :pt "+s)}};gn.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),r=this._segStrings.iterator();r.hasNext();){var s=r.next();e.checkInteriorIntersections(n,s)}else if(arguments.length===2)for(var l=arguments[0],p=arguments[1],o=l.getCoordinates(),x=p.getCoordinates(),M=0;M<o.length-1;M++)for(var P=0;P<x.length-1;P++)e.checkInteriorIntersections(l,M,p,P);else if(arguments.length===4){var he=arguments[0],nt=arguments[1],_e=arguments[2],Bt=arguments[3];if(he===_e&&nt===Bt)return null;var Fn=he.getCoordinates()[nt],yr=he.getCoordinates()[nt+1],Io=_e.getCoordinates()[Bt],rl=_e.getCoordinates()[Bt+1];if(this._li.computeIntersection(Fn,yr,Io,rl),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Fn,yr)||this.hasInteriorIntersection(this._li,Io,rl)))throw new Kn("found non-noded intersection at "+Fn+"-"+yr+" and "+Io+"-"+rl)}};gn.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};gn.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],s=r.getCoordinates(),l=0;l<s.length-2;l++)e.checkCollapse(s[l],s[l+1],s[l+2])};gn.prototype.hasInteriorIntersection=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var s=e.getIntersection(r);if(!(s.equals(t)||s.equals(n)))return!0}return!1};gn.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new Kn("found non-noded collapse at "+gn.fact.createLineString([e,t,n]))};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};xu.fact.get=function(){return new H};Object.defineProperties(gn,xu);var ce=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new ct("Scale factor must be non-zero");t!==1&&(this._pt=new v(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new v,this._p1Scaled=new v),this.initCorners(this._pt)},Su={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ce.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),s=Math.min(e.y,t.y),l=Math.max(e.y,t.y),p=this._maxx<n||this._minx>r||this._maxy<s||this._miny>l;if(p)return!1;var o=this.intersectsToleranceSquare(e,t);return U.isTrue(!(p&&o),"Found bad envelope test"),o};ce.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new v(this._maxx,this._maxy),this._corner[1]=new v(this._minx,this._maxy),this._corner[2]=new v(this._minx,this._miny),this._corner[3]=new v(this._maxx,this._miny)};ce.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};ce.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};ce.prototype.getCoordinate=function(){return this._originalPt};ce.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};ce.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=ce.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new T(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};ce.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};ce.prototype.intersectsToleranceSquare=function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||e.equals(this._pt)||t.equals(this._pt))};ce.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return this.intersects(n,r)?(e.addIntersection(this.getCoordinate(),t),!0):!1};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};Su.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(ce,Su);var uo=function(){this.tempEnv1=new T,this.selectedSegment=new F};uo.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};var bi=function(){this._index=null;var e=arguments[0];this._index=e},wu={HotPixelSnapAction:{configurable:!0}};bi.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],s=t.getSafeEnvelope(),l=new Lu(t,n,r);return this._index.query(s,{interfaces_:function(){return[lr]},visitItem:function(p){var o=p;o.select(s,l)}}),l.isNodeAdded()}};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};wu.HotPixelSnapAction.get=function(){return Lu};Object.defineProperties(bi,wu);var Lu=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],s=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=s}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],s=n.getContext();if(this._parentEdge!==null&&s===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(s,r)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(uo),$r=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new b};$r.prototype.processIntersections=function(e,t,n,r){var s=this;if(e===n&&t===r)return null;var l=e.getCoordinates()[t],p=e.getCoordinates()[t+1],o=n.getCoordinates()[r],x=n.getCoordinates()[r+1];if(this._li.computeIntersection(l,p,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var M=0;M<this._li.getIntersectionNum();M++)s._interiorIntersections.add(s._li.getIntersection(M));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}};$r.prototype.isDone=function(){return!1};$r.prototype.getInteriorIntersections=function(){return this._interiorIntersections};$r.prototype.interfaces_=function(){return[Rr]};$r.prototype.getClass=function(){return $r};var On=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new zr,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};On.prototype.checkCorrectness=function(e){var t=It.getNodedSubstrings(e),n=new gn(t);try{n.checkValid()}catch(r){if(r instanceof cu)r.printStackTrace();else throw r}finally{}};On.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)};On.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};On.prototype.findInteriorIntersections=function(e,t){var n=new $r(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};On.prototype.computeVertexSnaps=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.computeVertexSnaps(r)}else if(arguments[0]instanceof It)for(var s=arguments[0],l=s.getCoordinates(),p=0;p<l.length;p++){var o=new ce(l[p],e._scaleFactor,e._li),x=e._pointSnapper.snap(o,s,p);x&&s.addIntersection(l[p],p)}};On.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new qs,this._pointSnapper=new bi(this._noder.getIndex()),this.snapRound(e,this._li)};On.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),s=new ce(r,t._scaleFactor,t._li);t._pointSnapper.snap(s)}};On.prototype.interfaces_=function(){return[br]};On.prototype.getClass=function(){return On};var zt=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Z,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},Vi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};zt.prototype.bufferFixedPrecision=function(e){var t=new hr(new On(new $(1)),e.getScale()),n=new ee(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};zt.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=zt.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(l){if(l instanceof Jn)e._saveException=l;else throw l}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=zt.precisionScaleFactor(this._argGeom,this._distance,n),s=new $(r);this.bufferFixedPrecision(s)}};zt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===$.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};zt.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};zt.prototype.bufferOriginalPrecision=function(){try{var e=new ee(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Kn)this._saveException=t;else throw t}finally{}};zt.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};zt.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new zt(e),r=n.getResultGeometry(t);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var s=arguments[0],l=arguments[1],p=arguments[2],o=new zt(s);o.setQuadrantSegments(p);var x=o.getResultGeometry(l);return x}else if(arguments[2]instanceof Z&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var M=arguments[0],P=arguments[1],he=arguments[2],nt=new zt(M,he),_e=nt.getResultGeometry(P);return _e}}else if(arguments.length===4){var Bt=arguments[0],Fn=arguments[1],yr=arguments[2],Io=arguments[3],rl=new zt(Bt);rl.setQuadrantSegments(yr),rl.setEndCapStyle(Io);var Co=rl.getResultGeometry(Fn);return Co}};zt.precisionScaleFactor=function(e,t,n){var r=e.getEnvelopeInternal(),s=xe.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),l=t>0?t:0,p=s+2*l,o=Math.trunc(Math.log(p)/Math.log(10)+1),x=n-o,M=Math.pow(10,x);return M};Vi.CAP_ROUND.get=function(){return Z.CAP_ROUND};Vi.CAP_BUTT.get=function(){return Z.CAP_FLAT};Vi.CAP_FLAT.get=function(){return Z.CAP_FLAT};Vi.CAP_SQUARE.get=function(){return Z.CAP_SQUARE};Vi.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(zt,Vi);var Zt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Zt.prototype.getCoordinates=function(){return this._pt};Zt.prototype.getCoordinate=function(e){return this._pt[e]};Zt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};Zt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=s,this._isNull=!1}};Zt.prototype.getDistance=function(){return this._distance};Zt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};var Cn=function(){};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.computeDistance=function(){if(arguments[2]instanceof Zt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=e.getCoordinates(),s=new F,l=0;l<r.length-1;l++){s.setCoordinates(r[l],r[l+1]);var p=s.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],M=arguments[2];Cn.computeDistance(o.getExteriorRing(),x,M);for(var P=0;P<o.getNumInteriorRing();P++)Cn.computeDistance(o.getInteriorRingN(P),x,M)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof k&&arguments[1]instanceof v){var he=arguments[0],nt=arguments[1],_e=arguments[2];if(he instanceof pt)Cn.computeDistance(he,nt,_e);else if(he instanceof Rt)Cn.computeDistance(he,nt,_e);else if(he instanceof ne)for(var Bt=he,Fn=0;Fn<Bt.getNumGeometries();Fn++){var yr=Bt.getGeometryN(Fn);Cn.computeDistance(yr,nt,_e)}else _e.setMinimum(he.getCoordinate(),nt)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2],as=Io.closestPoint(rl);Co.setMinimum(as,rl)}};var Dr=function(e){this._maxPtDist=new Zt,this._inputGeom=e||null},Xs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Dr.prototype.computeMaxMidpointDistance=function(e){var t=new gr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.computeMaxVertexDistance=function(e){var t=new ti(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Dr.prototype.getDistancePoints=function(){return this._maxPtDist};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};Xs.MaxPointDistanceFilter.get=function(){return ti};Xs.MaxMidpointDistanceFilter.get=function(){return gr};Object.defineProperties(Dr,Xs);var ti=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};ti.prototype.filter=function(e){this._minPtDist.initialize(),Cn.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ti.prototype.getMaxPointDistance=function(){return this._maxPtDist};ti.prototype.interfaces_=function(){return[wn]};ti.prototype.getClass=function(){return ti};var gr=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};gr.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),r=e.getCoordinate(t),s=new v((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Cn.computeDistance(this._geom,s,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};gr.prototype.isDone=function(){return!1};gr.prototype.isGeometryChanged=function(){return!1};gr.prototype.getMaxPointDistance=function(){return this._maxPtDist};gr.prototype.interfaces_=function(){return[Xe]};gr.prototype.getClass=function(){return gr};var Wn=function(e){this._comps=e||null};Wn.prototype.filter=function(e){e instanceof Rt&&this._comps.add(e)};Wn.prototype.interfaces_=function(){return[un]};Wn.prototype.getClass=function(){return Wn};Wn.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Wn.getPolygons(e,new b)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Rt?n.add(t):t instanceof ne&&t.apply(new Wn(n)),n}};var kt=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};kt.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ln){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof pt&&this._lines.add(e)};kt.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};kt.prototype.interfaces_=function(){return[Qn]};kt.prototype.getClass=function(){return kt};kt.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(kt.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(kt.getLines(t,n))}};kt.getLines=function(){if(arguments.length===1){var e=arguments[0];return kt.getLines(e,!1)}else if(arguments.length===2){if(G(arguments[0],wt)&&G(arguments[1],wt)){for(var t=arguments[0],n=arguments[1],r=t.iterator();r.hasNext();){var s=r.next();kt.getLines(s,n)}return n}else if(arguments[0]instanceof k&&typeof arguments[1]=="boolean"){var l=arguments[0],p=arguments[1],o=new b;return l.apply(new kt(o,p)),o}else if(arguments[0]instanceof k&&G(arguments[1],wt)){var x=arguments[0],M=arguments[1];return x instanceof pt?M.add(x):x.apply(new kt(M)),M}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&G(arguments[0],wt)&&G(arguments[1],wt)){for(var P=arguments[0],he=arguments[1],nt=arguments[2],_e=P.iterator();_e.hasNext();){var Bt=_e.next();kt.getLines(Bt,he,nt)}return he}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof k&&G(arguments[1],wt)){var Fn=arguments[0],yr=arguments[1],Io=arguments[2];return Fn.apply(new kt(yr,Io)),yr}}};var je=function(){if(this._boundaryRule=Me.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new ct("Rule must be non-null");this._boundaryRule=e}};je.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof v&&arguments[1]instanceof Rt){var t=arguments[0],n=arguments[1];if(n.isEmpty())return m.EXTERIOR;var r=n.getExteriorRing(),s=this.locateInPolygonRing(t,r);if(s===m.EXTERIOR)return m.EXTERIOR;if(s===m.BOUNDARY)return m.BOUNDARY;for(var l=0;l<n.getNumInteriorRing();l++){var p=n.getInteriorRingN(l),o=e.locateInPolygonRing(t,p);if(o===m.INTERIOR)return m.EXTERIOR;if(o===m.BOUNDARY)return m.BOUNDARY}return m.INTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof pt){var x=arguments[0],M=arguments[1];if(!M.getEnvelopeInternal().intersects(x))return m.EXTERIOR;var P=M.getCoordinates();return!M.isClosed()&&(x.equals(P[0])||x.equals(P[P.length-1]))?m.BOUNDARY:O.isOnLine(x,P)?m.INTERIOR:m.EXTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof de){var he=arguments[0],nt=arguments[1],_e=nt.getCoordinate();return _e.equals2D(he)?m.INTERIOR:m.EXTERIOR}};je.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.locatePointInRing(e,t.getCoordinates()):m.EXTERIOR};je.prototype.intersects=function(e,t){return this.locate(e,t)!==m.EXTERIOR};je.prototype.updateLocationInfo=function(e){e===m.INTERIOR&&(this._isIn=!0),e===m.BOUNDARY&&this._numBoundaries++};je.prototype.computeLocation=function(e,t){var n=this;if(t instanceof de&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof pt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Rt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Lr)for(var r=t,s=0;s<r.getNumGeometries();s++){var l=r.getGeometryN(s);n.updateLocationInfo(n.locateInternal(e,l))}else if(t instanceof xn)for(var p=t,o=0;o<p.getNumGeometries();o++){var x=p.getGeometryN(o);n.updateLocationInfo(n.locateInternal(e,x))}else if(t instanceof ne)for(var M=new Sn(t);M.hasNext();){var P=M.next();P!==t&&n.computeLocation(e,P)}};je.prototype.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:t instanceof pt?this.locateInternal(e,t):t instanceof Rt?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?m.BOUNDARY:this._numBoundaries>0||this._isIn?m.INTERIOR:m.EXTERIOR)};je.prototype.interfaces_=function(){return[]};je.prototype.getClass=function(){return je};var $t=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2];this._component=r,this._segIndex=s,this._pt=l}},bu={INSIDE_AREA:{configurable:!0}};$t.prototype.isInsideArea=function(){return this._segIndex===$t.INSIDE_AREA};$t.prototype.getCoordinate=function(){return this._pt};$t.prototype.getGeometryComponent=function(){return this._component};$t.prototype.getSegmentIndex=function(){return this._segIndex};$t.prototype.interfaces_=function(){return[]};$t.prototype.getClass=function(){return $t};bu.INSIDE_AREA.get=function(){return-1};Object.defineProperties($t,bu);var ir=function(e){this._pts=e||null};ir.prototype.filter=function(e){e instanceof de&&this._pts.add(e)};ir.prototype.interfaces_=function(){return[un]};ir.prototype.getClass=function(){return ir};ir.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof de?He.singletonList(e):ir.getPoints(e,new b)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof de?n.add(t):t instanceof ne&&t.apply(new ir(n)),n}};var ei=function(){this._locations=null;var e=arguments[0];this._locations=e};ei.prototype.filter=function(e){(e instanceof de||e instanceof pt||e instanceof Rt)&&this._locations.add(new $t(e,0,e.getCoordinate()))};ei.prototype.interfaces_=function(){return[un]};ei.prototype.getClass=function(){return ei};ei.getLocations=function(e){var t=new b;return e.apply(new ei(t)),t};var qt=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new je,this._minDistanceLocation=null,this._minDistance=z.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=s}};qt.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=1-n,l=Wn.getPolygons(this._geom[n]);if(l.size()>0){var p=ei.getLocations(this._geom[s]);if(this.computeContainmentDistance(p,l,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[s]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&G(arguments[0],Ue)&&G(arguments[1],Ue)){for(var o=arguments[0],x=arguments[1],M=arguments[2],P=0;P<o.size();P++)for(var he=o.get(P),nt=0;nt<x.size();nt++)if(e.computeContainmentDistance(he,x.get(nt),M),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $t&&arguments[1]instanceof Rt){var _e=arguments[0],Bt=arguments[1],Fn=arguments[2],yr=_e.getCoordinate();if(m.EXTERIOR!==this._ptLocator.locate(yr,Bt))return this._minDistance=0,Fn[0]=_e,Fn[1]=new $t(Bt,yr),null}}};qt.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var r=this,s=0;s<e.size();s++)for(var l=e.get(s),p=0;p<t.size();p++){var o=t.get(p);if(r.computeMinDistance(l,o,n),r._minDistance<=r._terminateDistance)return null}};qt.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=kt.getLines(this._geom[0]),n=kt.getLines(this._geom[1]),r=ir.getPoints(this._geom[0]),s=ir.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,s,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(r,s,e),this.updateMinDistance(e,!1)};qt.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};qt.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};qt.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};qt.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof de){var t=arguments[0],n=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var s=t.getCoordinates(),l=n.getCoordinate(),p=0;p<s.length-1;p++){var o=O.distancePointLine(l,s[p],s[p+1]);if(o<e._minDistance){e._minDistance=o;var x=new F(s[p],s[p+1]),M=x.closestPoint(l);r[0]=new $t(t,p,M),r[1]=new $t(n,0,l)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof pt){var P=arguments[0],he=arguments[1],nt=arguments[2];if(P.getEnvelopeInternal().distance(he.getEnvelopeInternal())>this._minDistance)return null;for(var _e=P.getCoordinates(),Bt=he.getCoordinates(),Fn=0;Fn<_e.length-1;Fn++)for(var yr=0;yr<Bt.length-1;yr++){var Io=O.distanceLineLine(_e[Fn],_e[Fn+1],Bt[yr],Bt[yr+1]);if(Io<e._minDistance){e._minDistance=Io;var rl=new F(_e[Fn],_e[Fn+1]),Co=new F(Bt[yr],Bt[yr+1]),as=rl.closestPoints(Co);nt[0]=new $t(P,Fn,as[0]),nt[1]=new $t(he,yr,as[1])}if(e._minDistance<=e._terminateDistance)return null}}}};qt.prototype.computeMinDistancePoints=function(e,t,n){for(var r=this,s=0;s<e.size();s++)for(var l=e.get(s),p=0;p<t.size();p++){var o=t.get(p),x=l.getCoordinate().distance(o.getCoordinate());if(x<r._minDistance&&(r._minDistance=x,n[0]=new $t(l,0,l.getCoordinate()),n[1]=new $t(o,0,o.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};qt.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ct("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};qt.prototype.computeMinDistanceLines=function(e,t,n){for(var r=this,s=0;s<e.size();s++)for(var l=e.get(s),p=0;p<t.size();p++){var o=t.get(p);if(r.computeMinDistance(l,o,n),r._minDistance<=r._terminateDistance)return null}};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};qt.distance=function(e,t){var n=new qt(e,t);return n.distance()};qt.isWithinDistance=function(e,t,n){var r=new qt(e,t,n);return r.distance()<=n};qt.nearestPoints=function(e,t){var n=new qt(e,t);return n.nearestPoints()};var Wt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Wt.prototype.getCoordinates=function(){return this._pt};Wt.prototype.getCoordinate=function(e){return this._pt[e]};Wt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};Wt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=s,this._isNull=!1}};Wt.prototype.toString=function(){return qe.toLineString(this._pt[0],this._pt[1])};Wt.prototype.getDistance=function(){return this._distance};Wt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};Wt.prototype.interfaces_=function(){return[]};Wt.prototype.getClass=function(){return Wt};var en=function(){};en.prototype.interfaces_=function(){return[]};en.prototype.getClass=function(){return en};en.computeDistance=function(){if(arguments[2]instanceof Wt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=new F,s=e.getCoordinates(),l=0;l<s.length-1;l++){r.setCoordinates(s[l],s[l+1]);var p=r.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],M=arguments[2];en.computeDistance(o.getExteriorRing(),x,M);for(var P=0;P<o.getNumInteriorRing();P++)en.computeDistance(o.getInteriorRingN(P),x,M)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof k&&arguments[1]instanceof v){var he=arguments[0],nt=arguments[1],_e=arguments[2];if(he instanceof pt)en.computeDistance(he,nt,_e);else if(he instanceof Rt)en.computeDistance(he,nt,_e);else if(he instanceof ne)for(var Bt=he,Fn=0;Fn<Bt.getNumGeometries();Fn++){var yr=Bt.getGeometryN(Fn);en.computeDistance(yr,nt,_e)}else _e.setMinimum(he.getCoordinate(),nt)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2],as=Io.closestPoint(rl);Co.setMinimum(as,rl)}};var Te=function(){this._g0=null,this._g1=null,this._ptDist=new Wt,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Ys={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Te.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Te.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new ct("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};Te.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};Te.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Te.prototype.computeOrientedDistance=function(e,t,n){var r=new ni(t);if(e.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var s=new pr(t,this._densifyFrac);e.apply(s),n.setMaximum(s.getMaxPointDistance())}};Te.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Te(e,t);return n.distance()}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2],p=new Te(r,s);return p.setDensifyFraction(l),p.distance()}};Ys.MaxPointDistanceFilter.get=function(){return ni};Ys.MaxDensifiedByFractionDistanceFilter.get=function(){return pr};Object.defineProperties(Te,Ys);var ni=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._euclideanDist=new en,this._geom=null;var e=arguments[0];this._geom=e};ni.prototype.filter=function(e){this._minPtDist.initialize(),en.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};ni.prototype.interfaces_=function(){return[wn]};ni.prototype.getClass=function(){return ni};var pr=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};pr.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var r=e.getCoordinate(t-1),s=e.getCoordinate(t),l=(s.x-r.x)/this._numSubSegs,p=(s.y-r.y)/this._numSubSegs,o=0;o<this._numSubSegs;o++){var x=r.x+o*l,M=r.y+o*p,P=new v(x,M);n._minPtDist.initialize(),en.computeDistance(n._geom,P,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};pr.prototype.isDone=function(){return!1};pr.prototype.isGeometryChanged=function(){return!1};pr.prototype.getMaxPointDistance=function(){return this._maxPtDist};pr.prototype.interfaces_=function(){return[Xe]};pr.prototype.getClass=function(){return pr};var pe=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},Hs={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};pe.prototype.checkMaximumDistance=function(e,t,n){var r=new Te(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var s=r.getCoordinates();this._errorLocation=s[1],this._errorIndicator=e.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+qe.toLineString(s[0],s[1])+")"}};pe.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=pe.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),pe.VERBOSE&&Ut.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};pe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Rt||this._input instanceof xn||this._input instanceof ne))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};pe.prototype.getErrorIndicator=function(){return this._errorIndicator};pe.prototype.checkMinimumDistance=function(e,t,n){var r=new qt(e,t,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var s=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+qe.toLineString(s[0],s[1])+" )"}};pe.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};pe.prototype.getErrorLocation=function(){return this._errorLocation};pe.prototype.getPolygonLines=function(e){for(var t=new b,n=new kt(t),r=Wn.getPolygons(e),s=r.iterator();s.hasNext();){var l=s.next();l.apply(n)}return e.getFactory().buildGeometry(t)};pe.prototype.getErrorMessage=function(){return this._errMsg};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};Hs.VERBOSE.get=function(){return!1};Hs.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(pe,Hs);var Xt=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},Ws={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Xt.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Xt.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Xt.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new T(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new T(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Xt.prototype.checkDistance=function(){var e=new pe(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Xt.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Xt.prototype.checkPolygonal=function(){this._result instanceof Rt||this._result instanceof xn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Xt.prototype.getErrorIndicator=function(){return this._errorIndicator};Xt.prototype.getErrorLocation=function(){return this._errorLocation};Xt.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Xt.prototype.report=function(e){if(!Xt.VERBOSE)return null;Ut.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Xt.prototype.getErrorMessage=function(){return this._errorMsg};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.isValidMsg=function(e,t,n){var r=new Xt(e,t,n);return r.isValid()?null:r.getErrorMessage()};Xt.isValid=function(e,t,n){var r=new Xt(e,t,n);return!!r.isValid()};Ws.VERBOSE.get=function(){return!1};Ws.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Xt,Ws);var pn=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};pn.prototype.getCoordinates=function(){return this._pts};pn.prototype.size=function(){return this._pts.length};pn.prototype.getCoordinate=function(e){return this._pts[e]};pn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};pn.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Jr.octant(this.getCoordinate(e),this.getCoordinate(e+1))};pn.prototype.setData=function(e){this._data=e};pn.prototype.getData=function(){return this._data};pn.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};pn.prototype.interfaces_=function(){return[Pn]};pn.prototype.getClass=function(){return pn};var Mt=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new b,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Mt.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Mt.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Mt.prototype.getIntersectionSegments=function(){return this._intSegments};Mt.prototype.count=function(){return this._intersectionCount};Mt.prototype.getIntersections=function(){return this._intersections};Mt.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Mt.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Mt.prototype.processIntersections=function(e,t,n,r){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===r)return null;if(this._isCheckEndSegmentsOnly){var s=this.isEndSegment(e,t)||this.isEndSegment(n,r);if(!s)return null}var l=e.getCoordinates()[t],p=e.getCoordinates()[t+1],o=n.getCoordinates()[r],x=n.getCoordinates()[r+1];this._li.computeIntersection(l,p,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=l,this._intSegments[1]=p,this._intSegments[2]=o,this._intSegments[3]=x,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Mt.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Mt.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Mt.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Mt.prototype.interfaces_=function(){return[Rr]};Mt.prototype.getClass=function(){return Mt};Mt.createAllIntersectionsFinder=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t};Mt.createAnyIntersectionFinder=function(e){return new Mt(e)};Mt.createIntersectionCounter=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Ke=function(){this._li=new zr,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Ke.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ke.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ke.prototype.isValid=function(){return this.execute(),this._isValid};Ke.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Ke.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Mt(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new qs;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ke.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ke.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+qe.toLineString(e[0],e[1])+" and "+qe.toLineString(e[2],e[3])};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};Ke.computeIntersections=function(e){var t=new Ke(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Tr=function e(){this._nv=null;var t=arguments[0];this._nv=new Ke(e.toSegmentStrings(t))};Tr.prototype.checkValid=function(){this._nv.checkValid()};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.toSegmentStrings=function(e){for(var t=new b,n=e.iterator();n.hasNext();){var r=n.next();t.add(new pn(r.getCoordinates(),r))}return t};Tr.checkValid=function(e){var t=new Tr(e);t.checkValid()};var ri=function(e){this._mapOp=e};ri.prototype.map=function(e){for(var t=this,n=new b,r=0;r<e.getNumGeometries();r++){var s=t._mapOp.map(e.getGeometryN(r));s.isEmpty()||n.add(s)}return e.getFactory().createGeometryCollection(H.toGeometryArray(n))};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};ri.map=function(e,t){var n=new ri(t);return n.map(e)};var dn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new b,this._resultLineList=new b;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};dn.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();t.collectLineEdge(r,e,t._lineEdgesList),t.collectBoundaryTouchEdge(r,e,t._lineEdgesList)}};dn.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};dn.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};dn.prototype.collectLineEdge=function(e,t,n){var r=e.getLabel(),s=e.getEdge();e.isLineEdge()&&!e.isVisited()&&V.isResultOfOp(r,t)&&!s.isCovered()&&(n.add(s),e.setVisitedEdge(!0))};dn.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var s=r.next(),l=s.getEdge();if(s.isLineEdge()&&!l.isCoveredSet()){var p=e._op.isCoveredByA(s.getCoordinate());l.setCovered(p)}}};dn.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),s=r.getLabel();r.isIsolated()&&(s.isNull(0)?t.labelIsolatedLine(r,0):t.labelIsolatedLine(r,1))}};dn.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),s=t._geometryFactory.createLineString(r.getCoordinates());t._resultLineList.add(s),r.setInResult(!0)}};dn.prototype.collectBoundaryTouchEdge=function(e,t,n){var r=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;U.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),V.isResultOfOp(r,t)&&t===V.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};var ii=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new b;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};ii.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};ii.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||e===V.INTERSECTION)){var s=r.getLabel();V.isResultOfOp(s,e)&&t.filterCoveredNodeToPoint(r)}}};ii.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};var fe=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};fe.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformPolygon=function(e,t){var n=this,r=!0,s=this.transformLinearRing(e.getExteriorRing(),e);(s===null||!(s instanceof Ln)||s.isEmpty())&&(r=!1);for(var l=new b,p=0;p<e.getNumInteriorRing();p++){var o=n.transformLinearRing(e.getInteriorRingN(p),e);o===null||o.isEmpty()||(o instanceof Ln||(r=!1),l.add(o))}if(r)return this._factory.createPolygon(s,l.toArray([]));var x=new b;return s!==null&&x.add(s),x.addAll(l),this._factory.buildGeometry(x)};fe.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};fe.prototype.getInputGeometry=function(){return this._inputGeom};fe.prototype.transformMultiLineString=function(e,t){for(var n=this,r=new b,s=0;s<e.getNumGeometries();s++){var l=n.transformLineString(e.getGeometryN(s),e);l!==null&&(l.isEmpty()||r.add(l))}return this._factory.buildGeometry(r)};fe.prototype.transformCoordinates=function(e,t){return this.copy(e)};fe.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformMultiPoint=function(e,t){for(var n=this,r=new b,s=0;s<e.getNumGeometries();s++){var l=n.transformPoint(e.getGeometryN(s),e);l!==null&&(l.isEmpty()||r.add(l))}return this._factory.buildGeometry(r)};fe.prototype.transformMultiPolygon=function(e,t){for(var n=this,r=new b,s=0;s<e.getNumGeometries();s++){var l=n.transformPolygon(e.getGeometryN(s),e);l!==null&&(l.isEmpty()||r.add(l))}return this._factory.buildGeometry(r)};fe.prototype.copy=function(e){return e.copy()};fe.prototype.transformGeometryCollection=function(e,t){for(var n=this,r=new b,s=0;s<e.getNumGeometries();s++){var l=n.transform(e.getGeometryN(s));l!==null&&(n._pruneEmptyGeometry&&l.isEmpty()||r.add(l))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(H.toGeometryArray(r)):this._factory.buildGeometry(r)};fe.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof de)return this.transformPoint(e,null);if(e instanceof Ni)return this.transformMultiPoint(e,null);if(e instanceof Ln)return this.transformLinearRing(e,null);if(e instanceof pt)return this.transformLineString(e,null);if(e instanceof Lr)return this.transformMultiLineString(e,null);if(e instanceof Rt)return this.transformPolygon(e,null);if(e instanceof xn)return this.transformMultiPolygon(e,null);if(e instanceof ne)return this.transformGeometryCollection(e,null);throw new ct("Unknown Geometry subtype: "+e.getClass().getName())};fe.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};var Dn=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new F,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof pt&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],s=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=s}};Dn.prototype.snapVertices=function(e,t){for(var n=this,r=this._isClosed?e.size()-1:e.size(),s=0;s<r;s++){var l=e.get(s),p=n.findSnapForVertex(l,t);p!==null&&(e.set(s,new v(p)),s===0&&n._isClosed&&e.set(e.size()-1,new v(p)))}};Dn.prototype.findSnapForVertex=function(e,t){for(var n=this,r=0;r<t.length;r++){if(e.equals2D(t[r]))return null;if(e.distance(t[r])<n._snapTolerance)return t[r]}return null};Dn.prototype.snapTo=function(e){var t=new po(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};Dn.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var r=t.length;t[0].equals2D(t[t.length-1])&&(r=t.length-1);for(var s=0;s<r;s++){var l=t[s],p=n.findSegmentIndexToSnap(l,e);p>=0&&e.add(p+1,new v(l),!1)}};Dn.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,r=z.MAX_VALUE,s=-1,l=0;l<t.size()-1;l++){if(n._seg.p0=t.get(l),n._seg.p1=t.get(l+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var p=n._seg.distance(e);p<n._snapTolerance&&p<r&&(r=p,s=l)}return s};Dn.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var mt=function(e){this._srcGeom=e||null},Pu={SNAP_PRECISION_FACTOR:{configurable:!0}};mt.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),r=new Ru(t,n);return r.transform(this._srcGeom)};mt.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),r=new Ru(e,n,!0),s=r.transform(this._srcGeom),l=s;return t&&G(l,ur)&&(l=s.buffer(0)),l};mt.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};mt.prototype.extractTargetCoordinates=function(e){for(var t=new an,n=e.getCoordinates(),r=0;r<n.length;r++)t.add(n[r]);return t.toArray(new Array(0).fill(null))};mt.prototype.computeMinimumSegmentLength=function(e){for(var t=z.MAX_VALUE,n=0;n<e.length-1;n++){var r=e[n].distance(e[n+1]);r<t&&(t=r)}return t};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.snap=function(e,t,n){var r=new Array(2).fill(null),s=new mt(e);r[0]=s.snapTo(t,n);var l=new mt(t);return r[1]=l.snapTo(r[0],n),r};mt.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=mt.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===$.FIXED){var r=1/n.getScale()*2/1.415;r>t&&(t=r)}return t}else if(arguments.length===2){var s=arguments[0],l=arguments[1];return Math.min(mt.computeOverlaySnapTolerance(s),mt.computeOverlaySnapTolerance(l))}};mt.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),r=n*mt.SNAP_PRECISION_FACTOR;return r};mt.snapToSelf=function(e,t,n){var r=new mt(e);return r.snapToSelf(t,n)};Pu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(mt,Pu);var Ru=function(e){function t(n,r,s){e.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=s!==void 0?s:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,r){var s=new Dn(n,this._snapTolerance);return s.setAllowSnappingToSourceVertices(this._isSelfSnap),s.snapTo(r)},t.prototype.transformCoordinates=function(n,r){var s=n.toCoordinateArray(),l=this.snapLine(s,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(l)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fe),Jt=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Jt.prototype.getCommon=function(){return z.longBitsToDouble(this._commonBits)};Jt.prototype.add=function(e){var t=z.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Jt.signExpBits(this._commonBits),this._isFirst=!1,null;var n=Jt.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Jt.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Jt.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Jt.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=z.longBitsToDouble(e),n=z.toBinaryString(e),r="0000000000000000000000000000000000000000000000000000000000000000"+n,s=r.substring(r.length-64),l=s.substring(0,1)+"  "+s.substring(1,12)+"(exp) "+s.substring(12)+" [ "+t+" ]";return l}};Jt.prototype.interfaces_=function(){return[]};Jt.prototype.getClass=function(){return Jt};Jt.getBit=function(e,t){var n=1<<t;return e&n?1:0};Jt.signExpBits=function(e){return e>>52};Jt.zeroLowerBits=function(e,t){var n=(1<<t)-1,r=~n,s=e&r;return s};Jt.numCommonMostSigMantissaBits=function(e,t){for(var n=0,r=52;r>=0;r--){if(Jt.getBit(e,r)!==Jt.getBit(t,r))return n;n++}return 52};var dr=function(){this._commonCoord=null,this._ccFilter=new oi},js={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};dr.prototype.addCommonBits=function(e){var t=new vr(this._commonCoord);e.apply(t),e.geometryChanged()};dr.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new v(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new vr(t);return e.apply(n),e.geometryChanged(),e};dr.prototype.getCommonCoordinate=function(){return this._commonCoord};dr.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};js.CommonCoordinateFilter.get=function(){return oi};js.Translater.get=function(){return vr};Object.defineProperties(dr,js);var oi=function(){this._commonBitsX=new Jt,this._commonBitsY=new Jt};oi.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};oi.prototype.getCommonCoordinate=function(){return new v(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};oi.prototype.interfaces_=function(){return[wn]};oi.prototype.getClass=function(){return oi};var vr=function(){this.trans=null;var e=arguments[0];this.trans=e};vr.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,r)};vr.prototype.isDone=function(){return!1};vr.prototype.isGeometryChanged=function(){return!0};vr.prototype.interfaces_=function(){return[Xe]};vr.prototype.getClass=function(){return vr};var At=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};At.prototype.selfSnap=function(e){var t=new mt(e),n=t.snapTo(e,this._snapTolerance);return n};At.prototype.removeCommonBits=function(e){this._cbr=new dr,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};At.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};At.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=V.overlayOp(t[0],t[1],e);return this.prepareResult(n)};At.prototype.checkValid=function(e){e.isValid()||Ut.out.println("Snapped geometry is invalid")};At.prototype.computeSnapTolerance=function(){this._snapTolerance=mt.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};At.prototype.snap=function(e){var t=this.removeCommonBits(e),n=mt.snap(t[0],t[1],this._snapTolerance);return n};At.prototype.interfaces_=function(){return[]};At.prototype.getClass=function(){return At};At.overlayOp=function(e,t,n){var r=new At(e,t);return r.getResultGeometry(n)};At.union=function(e,t){return At.overlayOp(e,t,V.UNION)};At.intersection=function(e,t){return At.overlayOp(e,t,V.INTERSECTION)};At.symDifference=function(e,t){return At.overlayOp(e,t,V.SYMDIFFERENCE)};At.difference=function(e,t){return At.overlayOp(e,t,V.DIFFERENCE)};var oe=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};oe.prototype.getResultGeometry=function(e){var t=null,n=!1,r=null;try{t=V.overlayOp(this._geom[0],this._geom[1],e);var s=!0;s&&(n=!0)}catch(l){if(l instanceof Kn)r=l;else throw l}finally{}if(!n)try{t=At.overlayOp(this._geom[0],this._geom[1],e)}catch(l){throw l instanceof Kn?r:l}finally{}return t};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.overlayOp=function(e,t,n){var r=new oe(e,t);return r.getResultGeometry(n)};oe.union=function(e,t){return oe.overlayOp(e,t,V.UNION)};oe.intersection=function(e,t){return oe.overlayOp(e,t,V.INTERSECTION)};oe.symDifference=function(e,t){return oe.overlayOp(e,t,V.SYMDIFFERENCE)};oe.difference=function(e,t){return oe.overlayOp(e,t,V.DIFFERENCE)};var lo=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};lo.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};var me=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=s,this._obj=l}},Ks={INSERT:{configurable:!0},DELETE:{configurable:!0}};me.prototype.isDelete=function(){return this._eventType===me.DELETE};me.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};me.prototype.getObject=function(){return this._obj};me.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};me.prototype.getInsertEvent=function(){return this._insertEvent};me.prototype.isInsert=function(){return this._eventType===me.INSERT};me.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};me.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};me.prototype.interfaces_=function(){return[ke]};me.prototype.getClass=function(){return me};Ks.INSERT.get=function(){return 1};Ks.DELETE.get=function(){return 2};Object.defineProperties(me,Ks);var zo=function(){};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};var Yt=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};Yt.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(Yt.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var s=e.getNumPoints()-1;if(t===0&&r===s||r===0&&t===s)return!0}}return!1};Yt.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Yt.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Yt.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Yt.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next(),s=r.getCoordinate();if(e.isIntersection(s))return!0}return!1};Yt.prototype.hasProperIntersection=function(){return this._hasProper};Yt.prototype.hasIntersection=function(){return this._hasIntersection};Yt.prototype.isDone=function(){return this._isDone};Yt.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};Yt.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};Yt.prototype.addIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var s=e.getCoordinates()[t],l=e.getCoordinates()[t+1],p=n.getCoordinates()[r],o=n.getCoordinates()[r+1];this._li.computeIntersection(s,l,p,o),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var Fc=function(e){function t(){e.call(this),this.events=new b,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;He.sort(this.events);for(var r=0;r<this.events.size();r++){var s=n.events.get(r);s.isDelete()&&s.getInsertEvent().setDeleteEventIndex(r)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var s=0;s<this.events.size();s++){var l=n.events.get(s);if(l.isInsert()&&n.processOverlaps(s,l.getDeleteEventIndex(),l,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Yt&&G(arguments[0],Ue)&&G(arguments[1],Ue)){var p=arguments[0],o=arguments[1],x=arguments[2];this.addEdges(p,p),this.addEdges(o,o),this.computeIntersections(x)}else if(typeof arguments[2]=="boolean"&&G(arguments[0],Ue)&&arguments[1]instanceof Yt){var M=arguments[0],P=arguments[1],he=arguments[2];he?this.addEdges(M,null):this.addEdges(M),this.computeIntersections(P)}}},t.prototype.addEdge=function(n,r){for(var s=this,l=n.getMonotoneChainEdge(),p=l.getStartIndexes(),o=0;o<p.length-1;o++){var x=new lo(l,o),M=new me(r,l.getMinX(o),x);s.events.add(M),s.events.add(new me(l.getMaxX(o),M))}},t.prototype.processOverlaps=function(n,r,s,l){for(var p=this,o=s.getObject(),x=n;x<r;x++){var M=p.events.get(x);if(M.isInsert()){var P=M.getObject();s.isSameLabel(M)||(o.computeIntersections(P,l),p.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],s=r.iterator();s.hasNext();){var l=s.next();n.addEdge(l,l)}else if(arguments.length===2)for(var p=arguments[0],o=arguments[1],x=p.iterator();x.hasNext();){var M=x.next();n.addEdge(M,o)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(zo),Tn=function(){this._min=z.POSITIVE_INFINITY,this._max=z.NEGATIVE_INFINITY},Ou={NodeComparator:{configurable:!0}};Tn.prototype.getMin=function(){return this._min};Tn.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};Tn.prototype.getMax=function(){return this._max};Tn.prototype.toString=function(){return qe.toLineString(new v(this._min,0),new v(this._max,0))};Tn.prototype.interfaces_=function(){return[]};Tn.prototype.getClass=function(){return Tn};Ou.NodeComparator.get=function(){return co};Object.defineProperties(Tn,Ou);var co=function(){};co.prototype.compare=function(e,t){var n=e,r=t,s=(n._min+n._max)/2,l=(r._min+r._max)/2;return s<l?-1:s>l?1:0};co.prototype.interfaces_=function(){return[vi]};co.prototype.getClass=function(){return co};var Bc=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],r=arguments[1],s=arguments[2];this._min=n,this._max=r,this._item=s}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,r,s){if(!this.intersects(n,r))return null;s.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),kc=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},t.prototype.query=function(n,r,s){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,s),this._node2!==null&&this._node2.query(n,r,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),Mn=function(){this._leaves=new b,this._root=null,this._level=0};Mn.prototype.buildTree=function(){var e=this;He.sort(this._leaves,new Tn.NodeComparator);for(var t=this._leaves,n=null,r=new b;;){if(e.buildLevel(t,r),r.size()===1)return r.get(0);n=t,t=r,r=n}};Mn.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Bc(e,t,n))};Mn.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};Mn.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Mn.prototype.printNode=function(e){Ut.out.println(qe.toLineString(new v(e._min,this._level),new v(e._max,this._level)))};Mn.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Mn.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var r=e.get(n),s=n+1<e.size()?e.get(n):null;if(s===null)t.add(r);else{var l=new kc(e.get(n),e.get(n+1));t.add(l)}}};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};var Pi=function(){this._items=new b};Pi.prototype.visitItem=function(e){this._items.add(e)};Pi.prototype.getItems=function(){return this._items};Pi.prototype.interfaces_=function(){return[lr]};Pi.prototype.getClass=function(){return Pi};var Ri=function(){this._index=null;var e=arguments[0];if(!G(e,ur))throw new ct("Argument must be Polygonal");this._index=new Mr(e)},Qs={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Ri.prototype.locate=function(e){var t=new rn(e),n=new Oi(t);return this._index.query(e.y,e.y,n),t.getLocation()};Ri.prototype.interfaces_=function(){return[Li]};Ri.prototype.getClass=function(){return Ri};Qs.SegmentVisitor.get=function(){return Oi};Qs.IntervalIndexedGeometry.get=function(){return Mr};Object.defineProperties(Ri,Qs);var Oi=function(){this._counter=null;var e=arguments[0];this._counter=e};Oi.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Oi.prototype.interfaces_=function(){return[lr]};Oi.prototype.getClass=function(){return Oi};var Mr=function(){this._index=new Mn;var e=arguments[0];this.init(e)};Mr.prototype.init=function(e){for(var t=this,n=kt.getLines(e),r=n.iterator();r.hasNext();){var s=r.next(),l=s.getCoordinates();t.addLine(l)}};Mr.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var r=new F(e[n-1],e[n]),s=Math.min(r.p0.y,r.p1.y),l=Math.max(r.p0.y,r.p1.y);t._index.insert(s,l,r)}};Mr.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Pi;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2];this._index.query(r,s,l)}};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};var Xi=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new pu,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new je,arguments.length===2){var n=arguments[0],r=arguments[1],s=Me.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=s,r!==null&&this.add(r)}else if(arguments.length===3){var l=arguments[0],p=arguments[1],o=arguments[2];this._argIndex=l,this._parentGeom=p,this._boundaryNodeRule=o,p!==null&&this.add(p)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,r){var s=this._nodes.addNode(r),l=s.getLabel(),p=1,o=m.NONE;o=l.getLocation(n,w.ON),o===m.BOUNDARY&&p++;var x=t.determineBoundary(this._boundaryNodeRule,p);l.setLocation(n,x)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var s=arguments[0],l=arguments[1],p=arguments[2],o=new Yt(s,!0,!1);o.setIsDoneIfProperInt(p);var x=this.createEdgeSetIntersector(),M=this._parentGeom instanceof Ln||this._parentGeom instanceof Rt||this._parentGeom instanceof xn,P=l||!M;return x.computeIntersections(this._edges,o,P),this.addSelfIntersectionNodes(this._argIndex),o}},t.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var s=r.next();s.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,r,s){var l=new Yt(r,s,!0);l.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var p=this.createEdgeSetIntersector();return p.computeIntersections(this._edges,n._edges,l),l},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof de){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,m.INTERIOR)}else if(arguments[0]instanceof v){var s=arguments[0];this.insertPoint(this._argIndex,s,m.INTERIOR)}},t.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),m.EXTERIOR,m.INTERIOR);for(var s=0;s<n.getNumInteriorRing();s++){var l=n.getInteriorRingN(s);r.addPolygonRing(l,m.INTERIOR,m.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],m.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],m.BOUNDARY)},t.prototype.addLineString=function(n){var r=W.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var s=new Go(r,new et(this._argIndex,m.INTERIOR));this._lineEdgeMap.put(n,s),this.insertEdge(s),U.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),s=0,l=n.iterator();l.hasNext();){var p=l.next();r[s++]=p.getCoordinate().copy()}return r},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,r,s){if(this.isBoundaryNode(n,r))return null;s===m.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,s)},t.prototype.addPolygonRing=function(n,r,s){if(n.isEmpty())return null;var l=W.removeRepeatedPoints(n.getCoordinates());if(l.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=l[0],null;var p=r,o=s;O.isCCW(l)&&(p=s,o=r);var x=new Go(l,new et(this._argIndex,m.BOUNDARY,p,o));this._lineEdgeMap.put(n,x),this.insertEdge(x),this.insertPoint(this._argIndex,l[0],m.BOUNDARY)},t.prototype.insertPoint=function(n,r,s){var l=this._nodes.addNode(r),p=l.getLabel();p===null?l._label=new et(n,s):p.setLocation(n,s)},t.prototype.createEdgeSetIntersector=function(){return new Fc},t.prototype.addSelfIntersectionNodes=function(n){for(var r=this,s=this._edges.iterator();s.hasNext();)for(var l=s.next(),p=l.getLabel().getLocation(n),o=l.eiList.iterator();o.hasNext();){var x=o.next();r.addSelfIntersectionNode(n,x.coord,p)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof xn&&(this._useBoundaryDeterminationRule=!1),n instanceof Rt)this.addPolygon(n);else if(n instanceof pt)this.addLineString(n);else if(n instanceof de)this.addPoint(n);else if(n instanceof Ni)this.addCollection(n);else if(n instanceof Lr)this.addCollection(n);else if(n instanceof xn)this.addCollection(n);else if(n instanceof ne)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var r=this,s=0;s<n.getNumGeometries();s++){var l=n.getGeometryN(s);r.add(l)}},t.prototype.locate=function(n){return G(this._parentGeom,ur)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Ri(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,r){return n.isInBoundary(r)?m.BOUNDARY:m.INTERIOR},t}(ht),Di=function(){if(this._li=new zr,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Xi(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=Me.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,t,r),this._arg[1]=new Xi(1,n,r)}else if(arguments.length===3){var s=arguments[0],l=arguments[1],p=arguments[2];s.getPrecisionModel().compareTo(l.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(l.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,s,p),this._arg[1]=new Xi(1,l,p)}};Di.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Di.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};var xr=function(){};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.map=function(){if(arguments[0]instanceof k&&G(arguments[1],xr.MapOp)){for(var e=arguments[0],t=arguments[1],n=new b,r=0;r<e.getNumGeometries();r++){var s=t.map(e.getGeometryN(r));s!==null&&n.add(s)}return e.getFactory().buildGeometry(n)}else if(G(arguments[0],wt)&&G(arguments[1],xr.MapOp)){for(var l=arguments[0],p=arguments[1],o=new b,x=l.iterator();x.hasNext();){var M=x.next(),P=p.map(M);P!==null&&o.add(P)}return o}};xr.MapOp=function(){};var V=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r),this._ptLocator=new je,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new We,this._resultPolyList=new b,this._resultLineList=new b,this._resultPointList=new b,this._graph=new ht(new Cu),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var s=r.getLabel(),l=n.getLabel();r.isPointwiseEqual(n)||(l=new et(n.getLabel()),l.flip());var p=r.getDepth();p.isNull()&&p.add(s),p.add(l),s.merge(l)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),s=r.getSym();r.isInResult()&&s.isInResult()&&(r.setInResult(!1),s.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,r,s,l){var p=new b;return p.addAll(n),p.addAll(r),p.addAll(s),p.isEmpty()?t.createEmptyResult(l,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(p)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,r){for(var s=this,l=r.iterator();l.hasNext();){var p=l.next(),o=s._ptLocator.locate(n,p);if(o!==m.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new b,r=this._edgeList.iterator();r.hasNext();){var s=r.next();s.isCollapsed()&&(r.remove(),n.add(s.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),s=r.getEdges().getLabel();r.getLabel().merge(s)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var r=this,s=n.iterator();s.hasNext();){var l=s.next();r.insertUniqueEdge(l)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new b;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Tr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var s=new ve(this._geomFact);s.add(this._graph),this._resultPolyList=s.getPolygons();var l=new dn(this,this._geomFact,this._ptLocator);this._resultLineList=l.build(n);var p=new ii(this,this._geomFact,this._ptLocator);this._resultPointList=p.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,r){var s=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,s)},t.prototype.copyPoints=function(n){for(var r=this,s=this._arg[n].getNodeIterator();s.hasNext();){var l=s.next(),p=r._graph.addNode(l.getCoordinate());p.setLabel(n,l.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var s=r.next(),l=s.getLabel();l.isArea()&&!s.isInteriorAreaEdge()&&t.isResultOfOp(l.getLocation(0,w.RIGHT),l.getLocation(1,w.RIGHT),n)&&s.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),s=r.getLabel(),l=r.getDepth();if(!l.isNull()){l.normalize();for(var p=0;p<2;p++)!s.isNull(p)&&s.isArea()&&!l.isNull(p)&&(l.getDelta(p)===0?s.toLine(p):(U.isTrue(!l.isNull(p,w.LEFT),"depth of LEFT side has not been initialized"),s.setLocation(p,w.LEFT,l.getLocation(p,w.LEFT)),U.isTrue(!l.isNull(p,w.RIGHT),"depth of RIGHT side has not been initialized"),s.setLocation(p,w.RIGHT,l.getLocation(p,w.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var s=r.next();s.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var s=r.next(),l=s.getLabel();s.isIsolated()&&(l.isNull(0)?n.labelIncompleteNode(s,0):n.labelIncompleteNode(s,1)),s.getEdges().updateLabelling(l)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Di);V.overlayOp=function(e,t,n){var r=new V(e,t),s=r.getResultGeometry(n);return s};V.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return V.createEmptyResult(V.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return ri.map(e,{interfaces_:function(){return[xr.MapOp]},map:function(r){return r.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.INTERSECTION)};V.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.SYMDIFFERENCE)};V.resultDimension=function(e,t,n){var r=t.getDimension(),s=n.getDimension(),l=-1;switch(e){case V.INTERSECTION:l=Math.min(r,s);break;case V.UNION:l=Math.max(r,s);break;case V.DIFFERENCE:l=r;break;case V.SYMDIFFERENCE:l=Math.max(r,s);break}return l};V.createEmptyResult=function(e,t,n,r){var s=null;switch(V.resultDimension(e,t,n)){case-1:s=r.createGeometryCollection(new Array(0).fill(null));break;case 0:s=r.createPoint();break;case 1:s=r.createLineString();break;case 2:s=r.createPolygon();break}return s};V.difference=function(e,t){return e.isEmpty()?V.createEmptyResult(V.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.DIFFERENCE))};V.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return V.isResultOfOp(n,r,t)}else if(arguments.length===3){var s=arguments[0],l=arguments[1],p=arguments[2];switch(s===m.BOUNDARY&&(s=m.INTERIOR),l===m.BOUNDARY&&(l=m.INTERIOR),p){case V.INTERSECTION:return s===m.INTERIOR&&l===m.INTERIOR;case V.UNION:return s===m.INTERIOR||l===m.INTERIOR;case V.DIFFERENCE:return s===m.INTERIOR&&l!==m.INTERIOR;case V.SYMDIFFERENCE:return s===m.INTERIOR&&l!==m.INTERIOR||s!==m.INTERIOR&&l===m.INTERIOR}return!1}};V.INTERSECTION=1;V.UNION=2;V.DIFFERENCE=3;V.SYMDIFFERENCE=4;var or=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new je,this._seg=new F;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};or.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=t._linework.getGeometryN(n),s=r.getCoordinateSequence(),l=0;l<s.size()-1;l++){s.getCoordinate(l,t._seg.p0),s.getCoordinate(l+1,t._seg.p1);var p=t._seg.distance(e);if(p<=t._boundaryDistanceTolerance)return!0}return!1};or.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?m.BOUNDARY:this._ptLocator.locate(e,this._g)};or.prototype.extractLinework=function(e){var t=new Ti;e.apply(t);var n=t.getLinework(),r=H.toLineStringArray(n);return e.getFactory().createMultiLineString(r)};or.prototype.interfaces_=function(){return[]};or.prototype.getClass=function(){return or};var Ti=function(){this._linework=null,this._linework=new b};Ti.prototype.getLinework=function(){return this._linework};Ti.prototype.filter=function(e){var t=this;if(e instanceof Rt){var n=e;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)t._linework.add(n.getInteriorRingN(r))}};Ti.prototype.interfaces_=function(){return[un]};Ti.prototype.getClass=function(){return Ti};var Ar=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};Ar.prototype.extractPoints=function(e,t,n){for(var r=this,s=e.getCoordinates(),l=0;l<s.length-1;l++)r.computeOffsetPoints(s[l],s[l+1],t,n)};Ar.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};Ar.prototype.getPoints=function(e){for(var t=this,n=new b,r=kt.getLines(this._g),s=r.iterator();s.hasNext();){var l=s.next();t.extractPoints(l,e,n)}return n};Ar.prototype.computeOffsetPoints=function(e,t,n,r){var s=t.x-e.x,l=t.y-e.y,p=Math.sqrt(s*s+l*l),o=n*s/p,x=n*l/p,M=(t.x+e.x)/2,P=(t.y+e.y)/2;if(this._doLeft){var he=new v(M-x,P+o);r.add(he)}if(this._doRight){var nt=new v(M+x,P-o);r.add(nt)}};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};var be=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new b;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,r],this._locFinder=[new or(this._geom[0],this._boundaryDistanceTolerance),new or(this._geom[1],this._boundaryDistanceTolerance),new or(this._geom[2],this._boundaryDistanceTolerance)]},Du={TOLERANCE:{configurable:!0}};be.prototype.reportResult=function(e,t,n){Ut.out.println("Overlay result invalid - A:"+m.toLocationSymbol(t[0])+" B:"+m.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+m.toLocationSymbol(t[2]))};be.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};be.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var r=e._testCoords.get(n);if(!e.checkValid(t,r))return e._invalidLocation=r,!1}return!0}else if(arguments.length===2){var s=arguments[0],l=arguments[1];return this._location[0]=this._locFinder[0].getLocation(l),this._location[1]=this._locFinder[1].getLocation(l),this._location[2]=this._locFinder[2].getLocation(l),be.hasLocation(this._location,m.BOUNDARY)?!0:this.isValidResult(s,this._location)}};be.prototype.addTestPts=function(e){var t=new Ar(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};be.prototype.isValidResult=function(e,t){var n=V.isResultOfOp(t[0],t[1],e),r=t[2]===m.INTERIOR,s=!(n^r);return s||this.reportResult(e,t,n),s};be.prototype.getInvalidLocation=function(){return this._invalidLocation};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};be.computeBoundaryDistanceTolerance=function(e,t){return Math.min(mt.computeSizeBasedSnapTolerance(e),mt.computeSizeBasedSnapTolerance(t))};be.isValid=function(e,t,n,r){var s=new be(e,t,r);return s.isValid(n)};Du.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(be,Du);var Ie=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Ie.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var r=0;r<e.getNumGeometries();r++){var s=e.getGeometryN(r);n._skipEmpty&&s.isEmpty()||t.add(s)}};Ie.prototype.combine=function(){for(var e=this,t=new b,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();e.extractElements(r,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ie.prototype.interfaces_=function(){return[]};Ie.prototype.getClass=function(){return Ie};Ie.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Ie(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=new Ie(Ie.createList(n,r));return s.combine()}else if(arguments.length===3){var l=arguments[0],p=arguments[1],o=arguments[2],x=new Ie(Ie.createList(l,p,o));return x.combine()}};Ie.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Ie.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new b;return n.add(e),n.add(t),n}else if(arguments.length===3){var r=arguments[0],s=arguments[1],l=arguments[2],p=new b;return p.add(r),p.add(s),p.add(l),p}};var Nt=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new b)},Tu={STRTREE_NODE_CAPACITY:{configurable:!0}};Nt.prototype.reduceToGeometries=function(e){for(var t=this,n=new b,r=e.iterator();r.hasNext();){var s=r.next(),l=null;G(s,Ue)?l=t.unionTree(s):s instanceof k&&(l=s),n.add(l)}return n};Nt.prototype.extractByEnvelope=function(e,t,n){for(var r=new b,s=0;s<t.getNumGeometries();s++){var l=t.getGeometryN(s);l.getEnvelopeInternal().intersects(e)?r.add(l):n.add(l)}return this._geomFactory.buildGeometry(r)};Nt.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!n.intersects(r)){var s=Ie.combine(e,t);return s}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var l=n.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,l)};Nt.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new mu(Nt.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=e.itemsTree(),s=this.unionTree(r);return s};Nt.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var s=Nt.getGeometry(t,n);return this.unionSafe(s,null)}else{if(r-n===2)return this.unionSafe(Nt.getGeometry(t,n),Nt.getGeometry(t,n+1));var l=Math.trunc((r+n)/2),p=this.binaryUnion(t,n,l),o=this.binaryUnion(t,l,r);return this.unionSafe(p,o)}}};Nt.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var r=n.next();t===null?t=r.copy():t=t.union(r)}return t};Nt.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Nt.prototype.unionActual=function(e,t){return Nt.restrictToPolygons(e.union(t))};Nt.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};Nt.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var r=new b,s=this.extractByEnvelope(n,e,r),l=this.extractByEnvelope(n,t,r),p=this.unionActual(s,l);r.add(p);var o=Ie.combine(r);return o};Nt.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),r=n.buffer(0);return r}else if(arguments.length===2){var s=arguments[0],l=arguments[1],p=s.getFactory(),o=p.createGeometryCollection([s,l]),x=o.buffer(0);return x}};Nt.prototype.interfaces_=function(){return[]};Nt.prototype.getClass=function(){return Nt};Nt.restrictToPolygons=function(e){if(G(e,ur))return e;var t=Wn.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(H.toPolygonArray(t))};Nt.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Nt.union=function(e){var t=new Nt(e);return t.union()};Tu.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Nt,Tu);var Vo=function(){};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.UNION)};function Vr(){return new Uo}function Uo(){this.reset()}Uo.prototype={constructor:Uo,reset:function(){this.s=this.t=0},add:function(e){ba(xo,e,this.t),ba(this,xo.s,this.s),this.s?this.t+=xo.t:this.s=xo.t},valueOf:function(){return this.s}};var xo=new Uo;function ba(e,t,n){var r=e.s=t+n,s=r-t,l=r-s;e.t=t-l+(n-s)}var gt=1e-6,ot=Math.PI,Hn=ot/2,Pa=ot/4,tr=ot*2,Er=180/ot,$e=ot/180,te=Math.abs,Gc=Math.atan,Mi=Math.atan2,Lt=Math.cos,bt=Math.sin,Eo=Math.sqrt;function Mu(e){return e>1?0:e<-1?ot:Math.acos(e)}function Ai(e){return e>1?Hn:e<-1?-Hn:Math.asin(e)}function Yi(){}function qo(e,t){e&&Oa.hasOwnProperty(e.type)&&Oa[e.type](e,t)}var Ra={Feature:function(e,t){qo(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,s=n.length;++r<s;)qo(n[r].geometry,t)}},Oa={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,s=n.length;++r<s;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ps(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,s=n.length;++r<s;)Ps(n[r],t,0)},Polygon:function(e,t){Da(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,s=n.length;++r<s;)Da(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,s=n.length;++r<s;)qo(n[r],t)}};function Ps(e,t,n){var r=-1,s=e.length-n,l;for(t.lineStart();++r<s;)l=e[r],t.point(l[0],l[1],l[2]);t.lineEnd()}function Da(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Ps(e[n],t,1);t.polygonEnd()}function zc(e,t){e&&Ra.hasOwnProperty(e.type)?Ra[e.type](e,t):qo(e,t)}Vr();Vr();function Rs(e){return[Mi(e[1],e[0]),Ai(e[2])]}function Fi(e){var t=e[0],n=e[1],r=Lt(n);return[r*Lt(t),r*bt(t),bt(n)]}function So(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xo(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ds(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function wo(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Os(e){var t=Eo(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Vr();function Au(e,t){function n(r,s){return r=e(r,s),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,s){return r=t.invert(r,s),r&&e.invert(r[0],r[1])}),n}function Ds(e,t){return[e>ot?e-tr:e<-ot?e+tr:e,t]}Ds.invert=Ds;function Vc(e,t,n){return(e%=tr)?t||n?Au(Ma(e),Aa(t,n)):Ma(e):t||n?Aa(t,n):Ds}function Ta(e){return function(t,n){return t+=e,[t>ot?t-tr:t<-ot?t+tr:t,n]}}function Ma(e){var t=Ta(e);return t.invert=Ta(-e),t}function Aa(e,t){var n=Lt(e),r=bt(e),s=Lt(t),l=bt(t);function p(o,x){var M=Lt(x),P=Lt(o)*M,he=bt(o)*M,nt=bt(x),_e=nt*n+P*r;return[Mi(he*s-_e*l,P*n-nt*r),Ai(_e*s+he*l)]}return p.invert=function(o,x){var M=Lt(x),P=Lt(o)*M,he=bt(o)*M,nt=bt(x),_e=nt*s-he*l;return[Mi(he*s+nt*l,P*n+_e*r),Ai(_e*n-P*r)]},p}function Uc(e,t,n,r,s,l){if(n){var p=Lt(t),o=bt(t),x=r*n;s==null?(s=t+r*tr,l=t-x/2):(s=Fa(p,s),l=Fa(p,l),(r>0?s<l:s>l)&&(s+=r*tr));for(var M,P=s;r>0?P>l:P<l;P-=x)M=Rs([p,-o*Lt(P),-o*bt(P)]),e.point(M[0],M[1])}}function Fa(e,t){t=Fi(t),t[0]-=e,Os(t);var n=Mu(-t[1]);return((-t[2]<0?-n:n)+tr-gt)%tr}function Fu(){var e=[],t;return{point:function(n,r){t.push([n,r])},lineStart:function(){e.push(t=[])},lineEnd:Yi,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function qc(e,t,n,r,s,l){var p=e[0],o=e[1],x=t[0],M=t[1],P=0,he=1,nt=x-p,_e=M-o,Bt;if(Bt=n-p,!(!nt&&Bt>0)){if(Bt/=nt,nt<0){if(Bt<P)return;Bt<he&&(he=Bt)}else if(nt>0){if(Bt>he)return;Bt>P&&(P=Bt)}if(Bt=s-p,!(!nt&&Bt<0)){if(Bt/=nt,nt<0){if(Bt>he)return;Bt>P&&(P=Bt)}else if(nt>0){if(Bt<P)return;Bt<he&&(he=Bt)}if(Bt=r-o,!(!_e&&Bt>0)){if(Bt/=_e,_e<0){if(Bt<P)return;Bt<he&&(he=Bt)}else if(_e>0){if(Bt>he)return;Bt>P&&(P=Bt)}if(Bt=l-o,!(!_e&&Bt<0)){if(Bt/=_e,_e<0){if(Bt>he)return;Bt>P&&(P=Bt)}else if(_e>0){if(Bt<P)return;Bt<he&&(he=Bt)}return P>0&&(e[0]=p+P*nt,e[1]=o+P*_e),he<1&&(t[0]=p+he*nt,t[1]=o+he*_e),!0}}}}}function Do(e,t){return te(e[0]-t[0])<gt&&te(e[1]-t[1])<gt}function Lo(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Bu(e,t,n,r,s){var l=[],p=[],o,x;if(e.forEach(function(Bt){if(!((Fn=Bt.length-1)<=0)){var Fn,yr=Bt[0],Io=Bt[Fn],rl;if(Do(yr,Io)){for(s.lineStart(),o=0;o<Fn;++o)s.point((yr=Bt[o])[0],yr[1]);s.lineEnd();return}l.push(rl=new Lo(yr,Bt,null,!0)),p.push(rl.o=new Lo(yr,null,rl,!1)),l.push(rl=new Lo(Io,Bt,null,!1)),p.push(rl.o=new Lo(Io,null,rl,!0))}}),!!l.length){for(p.sort(t),Ba(l),Ba(p),o=0,x=p.length;o<x;++o)p[o].e=n=!n;for(var M=l[0],P,he;;){for(var nt=M,_e=!0;nt.v;)if((nt=nt.n)===M)return;P=nt.z,s.lineStart();do{if(nt.v=nt.o.v=!0,nt.e){if(_e)for(o=0,x=P.length;o<x;++o)s.point((he=P[o])[0],he[1]);else r(nt.x,nt.n.x,1,s);nt=nt.n}else{if(_e)for(P=nt.p.z,o=P.length-1;o>=0;--o)s.point((he=P[o])[0],he[1]);else r(nt.x,nt.p.x,-1,s);nt=nt.p}nt=nt.o,P=nt.z,_e=!_e}while(!nt.v);s.lineEnd()}}}function Ba(e){if(t=e.length){for(var t,n=0,r=e[0],s;++n<t;)r.n=s=e[n],s.p=r,r=s;r.n=s=e[0],s.p=r}}function ku(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xc(e){return e.length===1&&(e=Yc(e)),{left:function(t,n,r,s){for(r==null&&(r=0),s==null&&(s=t.length);r<s;){var l=r+s>>>1;e(t[l],n)<0?r=l+1:s=l}return r},right:function(t,n,r,s){for(r==null&&(r=0),s==null&&(s=t.length);r<s;){var l=r+s>>>1;e(t[l],n)>0?s=l:r=l+1}return r}}}function Yc(e){return function(t,n){return ku(e(t),n)}}Xc(ku);function Gu(e){for(var t=e.length,n,r=-1,s=0,l,p;++r<t;)s+=e[r].length;for(l=new Array(s);--t>=0;)for(p=e[t],n=p.length;--n>=0;)l[--s]=p[n];return l}var Hi=1e9,bo=-Hi;function Hc(e,t,n,r){function s(M,P){return e<=M&&M<=n&&t<=P&&P<=r}function l(M,P,he,nt){var _e=0,Bt=0;if(M==null||(_e=p(M,he))!==(Bt=p(P,he))||x(M,P)<0^he>0)do nt.point(_e===0||_e===3?e:n,_e>1?r:t);while((_e=(_e+he+4)%4)!==Bt);else nt.point(P[0],P[1])}function p(M,P){return te(M[0]-e)<gt?P>0?0:3:te(M[0]-n)<gt?P>0?2:1:te(M[1]-t)<gt?P>0?1:0:P>0?3:2}function o(M,P){return x(M.x,P.x)}function x(M,P){var he=p(M,1),nt=p(P,1);return he!==nt?he-nt:he===0?P[1]-M[1]:he===1?M[0]-P[0]:he===2?M[1]-P[1]:P[0]-M[0]}return function(M){var P=M,he=Fu(),nt,_e,Bt,Fn,yr,Io,rl,Co,as,Js,lh,ch={point:Zu,lineStart:xh,lineEnd:Mh,polygonStart:sl,polygonEnd:sh};function Zu(Uh,cd){s(Uh,cd)&&P.point(Uh,cd)}function th(){for(var Uh=0,cd=0,Tf=_e.length;cd<Tf;++cd)for(var yf=_e[cd],Af=1,md=yf.length,vd=yf[0],qd,Ed,Td=vd[0],Fd=vd[1];Af<md;++Af)qd=Td,Ed=Fd,vd=yf[Af],Td=vd[0],Fd=vd[1],Ed<=r?Fd>r&&(Td-qd)*(r-Ed)>(Fd-Ed)*(e-qd)&&++Uh:Fd<=r&&(Td-qd)*(r-Ed)<(Fd-Ed)*(e-qd)&&--Uh;return Uh}function sl(){P=he,nt=[],_e=[],lh=!0}function sh(){var Uh=th(),cd=lh&&Uh,Tf=(nt=Gu(nt)).length;(cd||Tf)&&(M.polygonStart(),cd&&(M.lineStart(),l(null,null,1,M),M.lineEnd()),Tf&&Bu(nt,o,Uh,l,M),M.polygonEnd()),P=M,nt=_e=Bt=null}function xh(){ch.point=Dh,_e&&_e.push(Bt=[]),Js=!0,as=!1,rl=Co=NaN}function Mh(){nt&&(Dh(Fn,yr),Io&&as&&he.rejoin(),nt.push(he.result())),ch.point=Zu,as&&P.lineEnd()}function Dh(Uh,cd){var Tf=s(Uh,cd);if(_e&&Bt.push([Uh,cd]),Js)Fn=Uh,yr=cd,Io=Tf,Js=!1,Tf&&(P.lineStart(),P.point(Uh,cd));else if(Tf&&as)P.point(Uh,cd);else{var yf=[rl=Math.max(bo,Math.min(Hi,rl)),Co=Math.max(bo,Math.min(Hi,Co))],Af=[Uh=Math.max(bo,Math.min(Hi,Uh)),cd=Math.max(bo,Math.min(Hi,cd))];qc(yf,Af,e,t,n,r)?(as||(P.lineStart(),P.point(yf[0],yf[1])),P.point(Af[0],Af[1]),Tf||P.lineEnd(),lh=!1):Tf&&(P.lineStart(),P.point(Uh,cd),lh=!1)}rl=Uh,Co=cd,as=Tf}return ch}}var vs=Vr();function Wc(e,t){var n=t[0],r=t[1],s=[bt(n),-Lt(n),0],l=0,p=0;vs.reset();for(var o=0,x=e.length;o<x;++o)if(P=(M=e[o]).length)for(var M,P,he=M[P-1],nt=he[0],_e=he[1]/2+Pa,Bt=bt(_e),Fn=Lt(_e),yr=0;yr<P;++yr,nt=rl,Bt=as,Fn=Js,he=Io){var Io=M[yr],rl=Io[0],Co=Io[1]/2+Pa,as=bt(Co),Js=Lt(Co),lh=rl-nt,ch=lh>=0?1:-1,Zu=ch*lh,th=Zu>ot,sl=Bt*as;if(vs.add(Mi(sl*ch*bt(Zu),Fn*Js+sl*Lt(Zu))),l+=th?lh+ch*tr:lh,th^nt>=n^rl>=n){var sh=Xo(Fi(he),Fi(Io));Os(sh);var xh=Xo(s,sh);Os(xh);var Mh=(th^lh>=0?-1:1)*Ai(xh[2]);(r>Mh||r===Mh&&(sh[0]||sh[1]))&&(p+=th^lh>=0?1:-1)}}return(l<-gt||l<gt&&vs<-gt)^p&1}Vr();function ka(e){return e}Vr();Vr();var Bi=1/0,Yo=Bi,fo=-Bi,Ho=fo,Ga={point:jc,lineStart:Yi,lineEnd:Yi,polygonStart:Yi,polygonEnd:Yi,result:function(){var e=[[Bi,Yo],[fo,Ho]];return fo=Ho=-(Yo=Bi=1/0),e}};function jc(e,t){e<Bi&&(Bi=e),e>fo&&(fo=e),t<Yo&&(Yo=t),t>Ho&&(Ho=t)}Vr();function zu(e,t,n,r){return function(s,l){var p=t(l),o=s.invert(r[0],r[1]),x=Fu(),M=t(x),P=!1,he,nt,_e,Bt={point:Fn,lineStart:Io,lineEnd:rl,polygonStart:function(){Bt.point=Co,Bt.lineStart=as,Bt.lineEnd=Js,nt=[],he=[]},polygonEnd:function(){Bt.point=Fn,Bt.lineStart=Io,Bt.lineEnd=rl,nt=Gu(nt);var lh=Wc(he,o);nt.length?(P||(l.polygonStart(),P=!0),Bu(nt,Qc,lh,n,l)):lh&&(P||(l.polygonStart(),P=!0),l.lineStart(),n(null,null,1,l),l.lineEnd()),P&&(l.polygonEnd(),P=!1),nt=he=null},sphere:function(){l.polygonStart(),l.lineStart(),n(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function Fn(lh,ch){var Zu=s(lh,ch);e(lh=Zu[0],ch=Zu[1])&&l.point(lh,ch)}function yr(lh,ch){var Zu=s(lh,ch);p.point(Zu[0],Zu[1])}function Io(){Bt.point=yr,p.lineStart()}function rl(){Bt.point=Fn,p.lineEnd()}function Co(lh,ch){_e.push([lh,ch]);var Zu=s(lh,ch);M.point(Zu[0],Zu[1])}function as(){M.lineStart(),_e=[]}function Js(){Co(_e[0][0],_e[0][1]),M.lineEnd();var lh=M.clean(),ch=x.result(),Zu,th=ch.length,sl,sh,xh;if(_e.pop(),he.push(_e),_e=null,!!th){if(lh&1){if(sh=ch[0],(sl=sh.length-1)>0){for(P||(l.polygonStart(),P=!0),l.lineStart(),Zu=0;Zu<sl;++Zu)l.point((xh=sh[Zu])[0],xh[1]);l.lineEnd()}return}th>1&&lh&2&&ch.push(ch.pop().concat(ch.shift())),nt.push(ch.filter(Kc))}}return Bt}}function Kc(e){return e.length>1}function Qc(e,t){return((e=e.x)[0]<0?e[1]-Hn-gt:Hn-e[1])-((t=t.x)[0]<0?t[1]-Hn-gt:Hn-t[1])}const za=zu(function(){return!0},Jc,$c,[-ot,-Hn]);function Jc(e){var t=NaN,n=NaN,r=NaN,s;return{lineStart:function(){e.lineStart(),s=1},point:function(l,p){var o=l>0?ot:-ot,x=te(l-t);te(x-ot)<gt?(e.point(t,n=(n+p)/2>0?Hn:-Hn),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(o,n),e.point(l,n),s=0):r!==o&&x>=ot&&(te(t-r)<gt&&(t-=r*gt),te(l-o)<gt&&(l-=o*gt),n=Zc(t,n,l,p),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(o,n),s=0),e.point(t=l,n=p),r=o},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-s}}}function Zc(e,t,n,r){var s,l,p=bt(e-n);return te(p)>gt?Gc((bt(t)*(l=Lt(r))*bt(n)-bt(r)*(s=Lt(t))*bt(e))/(s*l*p)):(t+r)/2}function $c(e,t,n,r){var s;if(e==null)s=n*Hn,r.point(-ot,s),r.point(0,s),r.point(ot,s),r.point(ot,0),r.point(ot,-s),r.point(0,-s),r.point(-ot,-s),r.point(-ot,0),r.point(-ot,s);else if(te(e[0]-t[0])>gt){var l=e[0]<t[0]?ot:-ot;s=n*l/2,r.point(-l,s),r.point(0,s),r.point(l,s)}else r.point(t[0],t[1])}function tf(e,t){var n=Lt(e),r=n>0,s=te(n)>gt;function l(P,he,nt,_e){Uc(_e,e,t,nt,P,he)}function p(P,he){return Lt(P)*Lt(he)>n}function o(P){var he,nt,_e,Bt,Fn;return{lineStart:function(){Bt=_e=!1,Fn=1},point:function(yr,Io){var rl=[yr,Io],Co,as=p(yr,Io),Js=r?as?0:M(yr,Io):as?M(yr+(yr<0?ot:-ot),Io):0;if(!he&&(Bt=_e=as)&&P.lineStart(),as!==_e&&(Co=x(he,rl),(!Co||Do(he,Co)||Do(rl,Co))&&(rl[0]+=gt,rl[1]+=gt,as=p(rl[0],rl[1]))),as!==_e)Fn=0,as?(P.lineStart(),Co=x(rl,he),P.point(Co[0],Co[1])):(Co=x(he,rl),P.point(Co[0],Co[1]),P.lineEnd()),he=Co;else if(s&&he&&r^as){var lh;!(Js&nt)&&(lh=x(rl,he,!0))&&(Fn=0,r?(P.lineStart(),P.point(lh[0][0],lh[0][1]),P.point(lh[1][0],lh[1][1]),P.lineEnd()):(P.point(lh[1][0],lh[1][1]),P.lineEnd(),P.lineStart(),P.point(lh[0][0],lh[0][1])))}as&&(!he||!Do(he,rl))&&P.point(rl[0],rl[1]),he=rl,_e=as,nt=Js},lineEnd:function(){_e&&P.lineEnd(),he=null},clean:function(){return Fn|(Bt&&_e)<<1}}}function x(P,he,nt){var _e=Fi(P),Bt=Fi(he),Fn=[1,0,0],yr=Xo(_e,Bt),Io=So(yr,yr),rl=yr[0],Co=Io-rl*rl;if(!Co)return!nt&&P;var as=n*Io/Co,Js=-n*rl/Co,lh=Xo(Fn,yr),ch=wo(Fn,as),Zu=wo(yr,Js);ds(ch,Zu);var th=lh,sl=So(ch,th),sh=So(th,th),xh=sl*sl-sh*(So(ch,ch)-1);if(!(xh<0)){var Mh=Eo(xh),Dh=wo(th,(-sl-Mh)/sh);if(ds(Dh,ch),Dh=Rs(Dh),!nt)return Dh;var Uh=P[0],cd=he[0],Tf=P[1],yf=he[1],Af;cd<Uh&&(Af=Uh,Uh=cd,cd=Af);var md=cd-Uh,vd=te(md-ot)<gt,qd=vd||md<gt;if(!vd&&yf<Tf&&(Af=Tf,Tf=yf,yf=Af),qd?vd?Tf+yf>0^Dh[1]<(te(Dh[0]-Uh)<gt?Tf:yf):Tf<=Dh[1]&&Dh[1]<=yf:md>ot^(Uh<=Dh[0]&&Dh[0]<=cd)){var Ed=wo(th,(-sl+Mh)/sh);return ds(Ed,ch),[Dh,Rs(Ed)]}}}function M(P,he){var nt=r?e:ot-e,_e=0;return P<-nt?_e|=1:P>nt&&(_e|=2),he<-nt?_e|=4:he>nt&&(_e|=8),_e}return zu(p,o,l,r?[0,-e]:[-ot,e-ot])}function Vu(e){return function(t){var n=new Ts;for(var r in e)n[r]=e[r];return n.stream=t,n}}function Ts(){}Ts.prototype={constructor:Ts,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Uu(e,t,n){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],l=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),l!=null&&e.clipExtent(null),zc(n,e.stream(Ga));var p=Ga.result(),o=Math.min(r/(p[1][0]-p[0][0]),s/(p[1][1]-p[0][1])),x=+t[0][0]+(r-o*(p[1][0]+p[0][0]))/2,M=+t[0][1]+(s-o*(p[1][1]+p[0][1]))/2;return l!=null&&e.clipExtent(l),e.scale(o*150).translate([x,M])}function ef(e,t,n){return Uu(e,[[0,0],t],n)}var Va=16,nf=Lt(30*$e);function Ua(e,t){return+t?of(e,t):rf(e)}function rf(e){return Vu({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function of(e,t){function n(r,s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr){var Io=M-r,rl=P-s,Co=Io*Io+rl*rl;if(Co>4*t&&Fn--){var as=p+nt,Js=o+_e,lh=x+Bt,ch=Eo(as*as+Js*Js+lh*lh),Zu=Ai(lh/=ch),th=te(te(lh)-1)<gt||te(l-he)<gt?(l+he)/2:Mi(Js,as),sl=e(th,Zu),sh=sl[0],xh=sl[1],Mh=sh-r,Dh=xh-s,Uh=rl*Mh-Io*Dh;(Uh*Uh/Co>t||te((Io*Mh+rl*Dh)/Co-.5)>.3||p*nt+o*_e+x*Bt<nf)&&(n(r,s,l,p,o,x,sh,xh,th,as/=ch,Js/=ch,lh,Fn,yr),yr.point(sh,xh),n(sh,xh,th,as,Js,lh,M,P,he,nt,_e,Bt,Fn,yr))}}return function(r){var s,l,p,o,x,M,P,he,nt,_e,Bt,Fn,yr={point:Io,lineStart:rl,lineEnd:as,polygonStart:function(){r.polygonStart(),yr.lineStart=Js},polygonEnd:function(){r.polygonEnd(),yr.lineStart=rl}};function Io(Zu,th){Zu=e(Zu,th),r.point(Zu[0],Zu[1])}function rl(){he=NaN,yr.point=Co,r.lineStart()}function Co(Zu,th){var sl=Fi([Zu,th]),sh=e(Zu,th);n(he,nt,P,_e,Bt,Fn,he=sh[0],nt=sh[1],P=Zu,_e=sl[0],Bt=sl[1],Fn=sl[2],Va,r),r.point(he,nt)}function as(){yr.point=Io,r.lineEnd()}function Js(){rl(),yr.point=lh,yr.lineEnd=ch}function lh(Zu,th){Co(s=Zu,th),l=he,p=nt,o=_e,x=Bt,M=Fn,yr.point=Co}function ch(){n(he,nt,P,_e,Bt,Fn,l,p,s,o,x,M,Va,r),yr.lineEnd=as,as()}return yr}}var sf=Vu({point:function(e,t){this.stream.point(e*$e,t*$e)}});function af(e){return uf(function(){return e})()}function uf(e){var t,n=150,r=480,s=250,l,p,o=0,x=0,M=0,P=0,he=0,nt,_e,Bt=null,Fn=za,yr=null,Io,rl,Co,as=ka,Js=.5,lh=Ua(sh,Js),ch,Zu;function th(Dh){return Dh=_e(Dh[0]*$e,Dh[1]*$e),[Dh[0]*n+l,p-Dh[1]*n]}function sl(Dh){return Dh=_e.invert((Dh[0]-l)/n,(p-Dh[1])/n),Dh&&[Dh[0]*Er,Dh[1]*Er]}function sh(Dh,Uh){return Dh=t(Dh,Uh),[Dh[0]*n+l,p-Dh[1]*n]}th.stream=function(Dh){return ch&&Zu===Dh?ch:ch=sf(Fn(nt,lh(as(Zu=Dh))))},th.clipAngle=function(Dh){return arguments.length?(Fn=+Dh?tf(Bt=Dh*$e,6*$e):(Bt=null,za),Mh()):Bt*Er},th.clipExtent=function(Dh){return arguments.length?(as=Dh==null?(yr=Io=rl=Co=null,ka):Hc(yr=+Dh[0][0],Io=+Dh[0][1],rl=+Dh[1][0],Co=+Dh[1][1]),Mh()):yr==null?null:[[yr,Io],[rl,Co]]},th.scale=function(Dh){return arguments.length?(n=+Dh,xh()):n},th.translate=function(Dh){return arguments.length?(r=+Dh[0],s=+Dh[1],xh()):[r,s]},th.center=function(Dh){return arguments.length?(o=Dh[0]%360*$e,x=Dh[1]%360*$e,xh()):[o*Er,x*Er]},th.rotate=function(Dh){return arguments.length?(M=Dh[0]%360*$e,P=Dh[1]%360*$e,he=Dh.length>2?Dh[2]%360*$e:0,xh()):[M*Er,P*Er,he*Er]},th.precision=function(Dh){return arguments.length?(lh=Ua(sh,Js=Dh*Dh),Mh()):Eo(Js)},th.fitExtent=function(Dh,Uh){return Uu(th,Dh,Uh)},th.fitSize=function(Dh,Uh){return ef(th,Dh,Uh)};function xh(){_e=Au(nt=Vc(M,P,he),t);var Dh=t(o,x);return l=r-Dh[0]*n,p=s+Dh[1]*n,Mh()}function Mh(){return ch=Zu=null,th}return function(){return t=e.apply(this,arguments),th.invert=t.invert&&sl,xh()}}function lf(e){return function(t,n){var r=Lt(t),s=Lt(n),l=e(r*s);return[l*s*bt(t),l*bt(n)]}}function cf(e){return function(t,n){var r=Eo(t*t+n*n),s=e(r),l=bt(s),p=Lt(s);return[Mi(t*l,r*p),Ai(r&&n*l/r)]}}var qu=lf(function(e){return(e=Mu(e))&&e/bt(e)});qu.invert=cf(function(e){return e});function ff(){return af(qu).scale(79.4188).clipAngle(180-.001)}function qa(e,t){return[e,t]}qa.invert=qa;function hf(e,t,n){n=n||{};var r=n.units||"kilometers",s=n.steps||8;if(!e)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof s!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(s<=0)throw new Error("steps must be greater than 0");var l=[];switch(e.type){case"GeometryCollection":return su(e,function(p){var o=To(p,t,r,s);o&&l.push(o)}),ws(l);case"FeatureCollection":return Na(e,function(p){var o=To(p,t,r,s);o&&Na(o,function(x){x&&l.push(x)})}),ws(l)}return To(e,t,r,s)}function To(e,t,n,r){var s=e.properties||{},l=e.type==="Feature"?e.geometry:e;if(l.type==="GeometryCollection"){var p=[];return su(e,function(Fn){var yr=To(Fn,t,n,r);yr&&p.push(yr)}),ws(p)}var o=gf(l),x={type:l.type,coordinates:Yu(l.coordinates,o)},M=new Us,P=M.read(x),he=dc(vc(t,n),"meters"),nt=zt.bufferOp(P,he,r),_e=new vu;if(nt=_e.write(nt),!Xu(nt.coordinates)){var Bt={type:nt.type,coordinates:Hu(nt.coordinates,o)};return Wo(Bt,s)}}function Xu(e){return Array.isArray(e[0])?Xu(e[0]):isNaN(e[0])}function Yu(e,t){return typeof e[0]!="object"?t(e):e.map(function(n){return Yu(n,t)})}function Hu(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(n){return Hu(n,t)})}function gf(e){var t=Ic(e).geometry.coordinates,n=[-t[0],-t[1]];return ff().rotate(n).scale(Ee)}function pf(e,t){var n=Fo(e),r=Fo(t),s=e.properties||{},l=eu.difference(n.coordinates,r.coordinates);return l.length===0?null:l.length===1?ru(l[0],s):iu(l,s)}function Xa(e){let t;for(const n of e)t&&n[0]-t[0]>=180?n[0]-=360:t&&n[0]-t[0]<-180&&(n[0]+=360),t=n}function Ya(e,t){const n=pf({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!n)return;n.properties={isMask:"y"};const r=hf(e,0);if(r.geometry.type==="Polygon")for(const s of r.geometry.coordinates)Xa(s);else for(const s of r.geometry.coordinates)for(const l of s)Xa(l);t({type:"FeatureCollection",features:[r,n]})}let Ha={type:"FeatureCollection",features:[]};function df(e,t,n=!0,r=!0,s={},l={},p={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let o,x,M=[],P,he;function nt(){(p!=null&&p.fill||p!=null&&p.line)&&e.addSource("full-geom",{type:"geojson",data:Ha}),p!=null&&p.fill&&e.addLayer({...p?.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),p!=null&&p.line&&e.addLayer({...p?.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?nt():e.once("load",()=>{nt()});const _e=yr=>{o?.({type:"mapClick",coordinates:[yr.lngLat.lng,yr.lngLat.lat]})},Bt=()=>{let yr;const Io=e.getZoom()>9?[(yr=e.getCenter().wrap()).lng,yr.lat]:void 0;x!==Io&&(x=Io,o?.({type:"proximityChange",proximity:Io}))};function Fn(yr=!1){if(!t)throw new Error;const Io=document.createElement("div");return yr&&Io.classList.add("marker-interactive"),new Ec({props:{displayIn:"maplibre"},target:Io}),new t.Marker({element:Io,offset:[1,-13]})}return{setEventHandler(yr){yr?(o=yr,e.on("moveend",Bt),Bt(),e.on("click",_e)):(e.off("moveend",Bt),o?.({type:"proximityChange",proximity:void 0}),o=void 0,e.off("click",_e))},flyTo(yr,Io){e.flyTo({center:yr,zoom:Io,...s})},fitBounds(yr,Io){e.fitBounds([[yr[0],yr[1]],[yr[2],yr[3]]],{padding:Io,...l})},indicateReverse(yr){e.getCanvasContainer().style.cursor=yr?"crosshair":""},setReverseMarker(yr){!t||!n||(he?yr?he.setLngLat(yr):(he.remove(),he=void 0):yr&&(he=(typeof n=="object"?new t.Marker(n):Fn()).setLngLat(yr).addTo(e),he.getElement().classList.add("marker-reverse")))},setMarkers(yr,Io){if(!n)return;function rl(Co){var as;(as=e.getSource("full-geom"))==null||as.setData(Co)}for(const Co of M)Co.remove();if(M.length=0,rl(Ha),!!t){if(Io){let Co=!1;if(Io.geometry.type==="GeometryCollection"){const as=Io.geometry.geometries.filter(Js=>Js.type==="Polygon"||Js.type==="MultiPolygon");if(as.length>0){let Js=as.pop();for(const lh of as)Js=yc(Js,lh);Ya({...Io,geometry:Js},rl),Co=!0}else{const Js=Io.geometry.geometries.filter(lh=>lh.type==="LineString"||lh.type==="MultiLineString");Js.length>0&&(rl({...Io,geometry:{type:"GeometryCollection",geometries:Js}}),Co=!0)}}if(!Co){if(Io.geometry.type==="Polygon"||Io.geometry.type==="MultiPolygon")Ya(Io,rl);else if(Io.geometry.type==="LineString"||Io.geometry.type==="MultiLineString"){rl(Io);return}}n&&M.push((typeof n=="object"?new t.Marker(n):Fn()).setLngLat(Io.center).addTo(e))}if(r)for(const Co of yr??[]){if(Co===Io)continue;const as=(typeof r=="object"?new t.Marker(r):Fn(!0)).setLngLat(Co.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Co.place_name.replace(/,.*/,""))).addTo(e),Js=as.getElement();Js.addEventListener("click",lh=>{lh.stopPropagation(),o?.({type:"markerClick",id:Co.id})}),Js.addEventListener("mouseenter",()=>{o?.({type:"markerMouseEnter",id:Co.id}),as.togglePopup()}),Js.addEventListener("mouseleave",()=>{o?.({type:"markerMouseLeave",id:Co.id}),as.togglePopup()}),Js.classList.toggle("marker-fuzzy",!!Co.matching_text),M.push(as)}}},setSelectedMarker(yr){P&&P.getElement().classList.toggle("marker-selected",!1),P=yr>-1?M[yr]:void 0,P?.getElement().classList.toggle("marker-selected",!0)}}}var En,Hr;class vf extends EventTarget{constructor(t){super(),fs(this,En,void 0),fs(this,Hr,void 0),No(this,Hr,t)}onAdd(t){const n=document.createElement("div");n.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:r,showResultMarkers:s,flyTo:l,fullGeometryStyle:p,...o}=zn(this,Hr),x=typeof l=="boolean"?{}:l,M=this.getExtraProps(t,n),P={mapController:df(t,this.getMapLibreGl(),r,s,x,x,p),flyTo:l===void 0?!0:!!l,apiKey:"",...M,...o};if(!P.apiKey)throw new Error("no apiKey provided");No(this,En,new Yl({target:n,props:P}));for(const he of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])zn(this,En).$on(he,nt=>this.dispatchEvent(nt));return n}setOptions(t){var n;No(this,Hr,t);const{marker:r,showResultMarkers:s,flyTo:l,fullGeometryStyle:p,...o}=zn(this,Hr);(n=zn(this,En))==null||n.$set(o)}setQuery(t,n=!0){var r;(r=zn(this,En))==null||r.setQuery(t,n)}setReverseMode(t){var n;(n=zn(this,En))==null||n.$set({reverseActive:t})}focus(){var t;(t=zn(this,En))==null||t.focus()}blur(){var t;(t=zn(this,En))==null||t.blur()}onRemove(){var t;(t=zn(this,En))==null||t.$destroy()}}En=new WeakMap,Hr=new WeakMap;class _f extends vf{getMapLibreGl(){return ll}getExtraProps(t,n){const r={};if(!("getSdkConfig"in t&&typeof t.getSdkConfig=="function"))throw new Error("MapTiler SDK not detected");const{primaryLanguage:s,apiKey:l}=t.getSdkConfig();r.apiKey=l;const p=/^([a-z]{2})($|_|-)/.exec(s);return p&&(r.language=p[1]),n.className+=" maptiler-ctrl",r}}const style="",maptilerMapViewer_vue_vue_type_style_index_0_scoped_d80d7b81_lang="",_sfc_main$4={name:"maptiler-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,map:ref(null),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_rgb_image_url:ref(""),maptiler_raster_png_dem:ref(""),maptiler_api_url:ref(""),rasterFromStyle:ref(!1),zoom:ref("")}},mounted(){},methods:{async loadMapSourcesLayers(e){this.rasterFromStyle===!1&&(e.addSource("maptiler_terrain_dem",{type:"raster-dem",url:this.maptiler_raster_png_dem+"tiles.json"}),e.addLayer({id:"hillshading",source:"maptiler_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}))},resizeMap(){this.map.resize()},async loadMapTilerMap(){this.maptiler_access_token=await idbKeyval.get("maptiler_access_token"),this.dirHandle=await idbKeyval.get("dirHandle"),this.maptiler_style_url=await idbKeyval.get("maptiler_style_url"),this.maptiler_api_url=await idbKeyval.get("maptiler_api_url"),this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem"),this.dirHandle=await idbKeyval.get("dirHandle"),config.apiKey=this.maptiler_access_token;let e=this,t=new Map$1({container:"map",trackResize:!0,antialias:!0,style:this.maptiler_style_url,center:[-121.7598,46.876],zoom:9,maxZoom:14,doubleClickZoom:!1,terrainControl:!0,fullscreenControl:!0,failIfMajorPerformance:!0});this.map=t;const n=new _f({apiKey:config.apiKey,class:"geocoder",showResultsWhileTyping:!0,placeholder:"Try: Lng , Lat or Name"});t.addControl(n,"top-right"),t.on("load",function(){e.loadMapSourcesLayers(t)}),t.on("click",async function(r){let s=r.lngLat.lng,l=r.lngLat.lat,p=Math.floor(t.getZoom());e.zoom=p;let o=mapUtils.getTileInfo(s,l,!1,0,0,p);idbKeyval.set("tile_info",o),e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance,t.getSource("bounding_box_source").setData(o.polygon_bb),t.setPaintProperty("bounding_box","fill-opacity",.45)}),t.on("wheel",()=>{e.zoom=Math.floor(t.getZoom())}),t.on("error",r=>{console.error(r)}),t.on("dblclick",async function(r){let s=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(s,!0)===!1){console.error(`User did not grant permission to '${s.name}'`);return}let l=await idbKeyval.get("tile_info");e.tileInfoString="Slippy Tile Info String: "+l.x+","+l.y+","+l.z+" Bounding Box sides in KM: "+l.distance,e.maptiler_rgb_image_url=e.maptiler_raster_png_dem+`${l.z}/${l.x}/${l.y}.webp?key=`+e.maptiler_access_token;let p=await mapUtils.getMapboxTerrainRgb(e.maptiler_rgb_image_url),o=await p.toBuffer();await idbKeyval.set("rgb_image_buffer",o),await fileUtils.writeFileToDisk(s,l.rgbFileName,o);let x=mapUtils.createHeightMapImage(p,32,"GREY");if(await fileUtils.fileExists(s,l.thirtyTwoFileName)===!1){let P=await x.image.toBuffer();await fileUtils.writeFileToDisk(s,l.thirtyTwoFileName,P)}emitter.emit("updatePreviewImage",{dir_handle:s,tile_info:l,preview_image_info:x,map:t})})}}},_withScopeId=e=>(pushScopeId("data-v-d80d7b81"),e=e(),popScopeId(),e),_hoisted_1$4={id:"map"},_hoisted_2$3=_withScopeId(()=>createBaseVNode("pre",{id:"features"},null,-1)),_hoisted_3$3=_withScopeId(()=>createBaseVNode("div",{class:"row no-wrap q-pa-md"},[createBaseVNode("div",{class:"column"})],-1)),_hoisted_4$3=_withScopeId(()=>createBaseVNode("div",{class:"text-h6"},"Alert",-1));function _sfc_render$4(e,t,n,r,s,l){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$4,[_hoisted_2$3,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[_hoisted_3$3]),_:1})]),_:1}),createTextVNode("   "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:r.alert,"onUpdate:modelValue":t[0]||(t[0]=p=>r.alert=p)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_4$3]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MaptilerMapViewer=_export_sfc(_sfc_main$4,[["render",_sfc_render$4],["__scopeId","data-v-d80d7b81"]]),wieghtmapViewer_vue_vue_type_style_index_0_scoped_a7c2d78d_lang="";let mapweight=null;const _sfc_main$3={name:"weightmap-viewer",setup(){return{qt:useQuasar(),access_token:ref("")}},methods:{async loadMapboxWeightMap(){let e=await idbKeyval.get("tile_info");if(e.hasOwnProperty("bbox")){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken;let n="mapbox://styles/"+(await idbKeyval.get("mapbox_raster_style_url")||"");mapweight===null&&(mapweight=new mapboxgl.Map({container:"mapweight",style:n})),mapweight.on("load",()=>{this.loadMapSourcesLayers(mapweight),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}},loadMapSourcesLayers(e){mapweight.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),mapweight.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}})}}},_hoisted_1$3={id:"mapweight"};function _sfc_render$3(e,t,n,r,s,l){return openBlock(),createElementBlock("div",_hoisted_1$3)}const WeightmapViewer=_export_sfc(_sfc_main$3,[["render",_sfc_render$3],["__scopeId","data-v-a7c2d78d"]]),useRatioProps={ratio:[String,Number]};function useRatio(e,t){return computed(()=>{const n=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(n)!==!0&&n>0?{paddingBottom:`${100/n}%`}:null})}const defaultRatio=16/9,QImg=createComponent({name:"QImg",props:{...useRatioProps,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:defaultRatio},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:n}){const r=ref(e.initialRatio),s=useRatio(e,r);let l=null,p=!1;const o=[ref(null),ref(yr())],x=ref(0),M=ref(!1),P=ref(!1),he=computed(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),nt=computed(()=>({width:e.width,height:e.height})),_e=computed(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),Bt=computed(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));watch(()=>Fn(),Io);function Fn(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function yr(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function Io(Zu){l!==null&&(clearTimeout(l),l=null),P.value=!1,Zu===null?(M.value=!1,o[x.value^1].value=yr()):M.value=!0,o[x.value].value=Zu}function rl({target:Zu}){p!==!0&&(l!==null&&(clearTimeout(l),l=null),r.value=Zu.naturalHeight===0?.5:Zu.naturalWidth/Zu.naturalHeight,Co(Zu,1))}function Co(Zu,th){p===!0||th===1e3||(Zu.complete===!0?as(Zu):l=setTimeout(()=>{l=null,Co(Zu,th+1)},50))}function as(Zu){p!==!0&&(x.value=x.value^1,o[x.value].value=null,M.value=!1,P.value=!1,n("load",Zu.currentSrc||Zu.src))}function Js(Zu){l!==null&&(clearTimeout(l),l=null),M.value=!1,P.value=!0,o[x.value].value=null,o[x.value^1].value=yr(),n("error",Zu)}function lh(Zu){const th=o[Zu].value,sl={key:"img_"+Zu,class:_e.value,style:Bt.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...th};return x.value===Zu?(sl.class+=" q-img__image--waiting",Object.assign(sl,{onLoad:rl,onError:Js})):sl.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+Zu},h("img",sl))}function ch(){return M.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},hSlot(t[P.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[h(QSpinner,{color:e.spinnerColor,size:e.spinnerSize})])}return Io(Fn()),onBeforeUnmount(()=>{p=!0,l!==null&&(clearTimeout(l),l=null)}),()=>{const Zu=[];return s.value!==null&&Zu.push(h("div",{key:"filler",style:s.value})),P.value!==!0&&(o[0].value!==null&&Zu.push(lh(0)),o[1].value!==null&&Zu.push(lh(1))),Zu.push(h(Transition,{name:"q-transition--fade"},ch)),h("div",{class:he.value,style:nt.value,role:"img","aria-label":e.alt},Zu)}}});let Gdal,ZrangeSeaLevel=32767;const _sfc_main$2={name:"SideNav",setup(){const e=useQuasar();return{alert:ref(!1),isAlphaBrush:ref(!1),blurRadius:ref(0),blurRadiusWeightmap:ref(10),gridSize:ref(2),mapbox_access_token:ref(""),maptiler_access_token:ref(""),isDisabled:ref(!1),isDownload:ref(!0),isWorldPartition:ref(!1),isLandscape:ref(!0),isExportOptions:ref(!0),isBlurRadius:ref(!0),isSendToUnreal:ref(!0),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"6097x6097",value:6097},{label:"4033x4033",value:4033},{label:"3025x3025",value:3025},{label:"2017x2017",value:2017},{label:"1513x1513",value:1513},{label:"1009x1009",value:1009},{label:"512x512 -- Native Resolution",value:512},{label:"505x505",value:505}],url:ref(""),tile_info:ref(""),satellite_endpoint:ref(""),save_fileName:ref(""),dirHandle:ref(""),preview_image_info:ref(""),rgb_image:ref(""),img_min:ref(""),img_max:ref(""),map:null,data:null,bbinfoalert:ref(!1),exportType:ref({label:"Unreal Heightmap",value:"Unreal Heightmap"}),landscapeName:ref(""),alphaBrushName:ref(""),alphaBrushHeight:ref(505),alphaBrushWidth:ref(505),unrealMapPath:ref(""),qt:e,exportOptionsModel:ref(["zrange","combine_features"]),alertMsg:ref(""),exportOptions:[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"},{label:"Create Weightmap (Splatmap) Files",value:"raster_style"}],exportTyprOptions:[{label:"Unreal Heightmap",value:"Unreal Heightmap"},{label:"Unreal Terrain Magic Plugin -- EarthLandscape Clip",value:"Unreal Terrain Magic Plugin -- EarthLandscape Clip"},{label:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip",value:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"},{label:"Unreal Stamp Brush Plugin",value:"Unreal Stamp Brush Plugin"},{label:"Unreal Landmass Effect Brush Plugin",value:"Unreal Landmass Effect Brush Plugin",cannotSelect:!1},{label:"None",value:"none"},{label:"Geojson Only",value:"geojson_only"}]}},async mounted(){Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1}),emitter.on("updatePreviewImage",e=>{this.data=e,this.updatePreviewImage()})},methods:{showNotify(e,t,n,r,s){this.qt.notify({message:e,color:t,position:n,icon:r,textColor:s})},copyTileInfoString(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Tile info string copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},copyExtents(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.bboxW+","+this.tile_info.bboxS+","+this.tile_info.bboxE+","+this.tile_info.bboxN;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Bounding box coordinates copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},landscapeSizeChange(){this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale()},adjustedZscale(){let e=this.getUnrealZScale(this.preview_image_info.maxElevation,this.preview_image_info.minElevation),t=this.getUnrealXYScale();return this.tile_info.xyscale=t.toFixed(3),this.exportOptionsModel.includes("zrange")?(this.tile_info.startZRange=ZrangeSeaLevel,this.tile_info.zscale=e.toFixed(3)):(this.tile_info.startZRange=0,this.tile_info.zscale=e.toFixed(3)),this.tile_info.zscale},exportOptionsModelChange(e){this.exportOptionsModel=e,this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale();let t=toRaw(this.exportOptionsModel);idbKeyval.set("exportOptionsModel",t)},exportType_Change(e){this.exportType.label==="Unreal Heightmap"||this.exportType.label==="None"||this.exportType.label==="Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"?(this.isDownload=!0,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!0,this.isBlurRadius=!0):this.exportType.label==="Unreal Stamp Brush Plugin"||this.exportType.label==="Unreal Landmass Effect Brush Plugin"?(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!0,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!0):this.exportType.label==="Geojson Only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Unreal Terrain Magic Plugin -- EarthLandscape Clip"&&(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1)},showBBInfo(){this.tile_info?this.bbinfoalert=!0:(this.bbinfoalert=!1,this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},updateStats(){this.preview_image_info.maxElevation!==""?(this.tile_info.MaxElevation=this.preview_image_info.maxElevation,this.tile_info.MinElevation=this.preview_image_info.minElevation,this.tile_info.minmax=this.tile_info.MinElevation.toFixed(3)+" / "+this.tile_info.MaxElevation.toFixed(3),this.tile_info.elevation_range=(this.tile_info.MaxElevation-this.tile_info.MinElevation).toFixed(3),this.tile_info.zscale=this.adjustedZscale()):this.tile_info.minmax=""},getUnrealZScale(e,t){let n,r;return this.exportOptionsModel.includes("zrange")?n=e*100:(t<0&&(t=0),n=(e-t)*100),r=n*.001953125,r},getUnrealXYScale(){return this.tile_info.distance*1e3/this.unrealLandscape.value*100},async updatePreviewImage(){this.preview_image_info=await this.data.preview_image_info,this.tile_info=this.data.tile_info,this.map=this.data.map;let e=await this.preview_image_info.image.toBlob();const t=URL.createObjectURL(e);this.url=t,this.updateStats(this.tile_info)},async saveImage(e,t,n){let r=await idbKeyval.get("dirHandle"),s=new Blob([e],{type:"image/"+n});await fileUtils.writeFileToDisk(r,t,s)},async processGdal(e,t,n,r,s){let l=new Blob([new Uint8Array(e)],{type:"image/"+r});const p=new File([l],t),x=(await Gdal.open(p)).datasets[0],M=await Gdal.gdal_translate(x,n),P=await Gdal.getFileBytes(M);s==="createHeightmap"&&await this.saveImage(P,t,r),Gdal.close(x)},async sendToUnreal(){let e="http://localhost:30010/",t="remote/object/call",n={},r,s,l,p="Mapbox_BP",o,x,M,P;if(this.tile_info)if(n={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},r=await mapUtils.unrealRemoteControl(n,e+t),r.error)r.error.message==="Failed to fetch"?this.alertMsg="Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server":this.alertMsg=r.error.message,this.alert=!0;else{let he=await r.response.json();for(let nt of he.ReturnValue)if(s=nt.includes(p),s===!0){l=nt;break}else l=null;if(l){this.exportType.label!=="Unreal Terrain Magic Plugin -- EarthLandscape Clip"?await this.createSixteenHeightMap():this.tile_info.resolution="505",this.exportType.label==="Unreal Stamp Brush Plugin"&&(o="/Game/Brushes/CustomBrushes/",x="/Game/Brushes/PEAKS/Peak_10_brush.Peak_10_brush",M="Textures/",P="HeightMap"),this.exportType.label==="Unreal Landmass Effect Brush Plugin"&&(o="/Game/Editor/Landscape/LandmassEffectBrush/CustomBrushes/",x="/Game/Editor/Landscape/LandmassEffectBrush/Effects/Variants/Map/HeightMapEffect.HeightMapEffect",M="Textures/",P="Heightmap (Greyscale / White is High)"),this.unrealMapPath=await idbKeyval.get("mappath"),this.tile_info.landscapeName=this.landscapeName;let nt=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z,_e;this.isWorldPartition===!0?_e=this.gridSize:_e=0,n={objectPath:l,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:this.tile_info.landscapeName,LandscapeSize:this.tile_info.resolution.toString(),TileHeightmapFileName:this.tile_info.sixteenFileName,TileGeojsonFileName:this.tile_info.geoJsonFileName,TileInfoFileName:this.tile_info.tileInfoFileName,MapMiddleLngX:this.tile_info.center.lng,MapMiddleLatY:this.tile_info.center.lat,MapBtmRLng:this.tile_info.bottomRight.lng,MapBtmLLng:this.tile_info.bottomLeft.lng,MapTopLLat:this.tile_info.topLeft.lat,MapBtmLLat:this.tile_info.bottomLeft.lat,RunFunction:this.exportType.label,SlippyMapTileString:nt.trim(),HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:this.tile_info.alphaBrushFileName,AlphaBrushDestinationPath:o,AlphaBrushTemplatePath:x,AlphaBrushTexturesPath:M,HeightmapProperty:P,WorldPartitionGridSize:_e.toString()}},r=await mapUtils.unrealRemoteControl(n,e+t),r.error?(console.log(r.error),this.alertMsg=r.error.message,this.alert=!0):console.log(await r.response.json())}else this.alertMsg="Could not find Mapbox_BP in scene",this.alert=!0}else this.alertMsg="Please double click on your chosen selection first",this.alert=!0;this.qt.loading.hide()},async unrealTileFeatures(e){let t=mapUtils.getFeaturesFromBB(this.map,this.tile_info,e),n=JSON.stringify(t),r=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.geoJsonFileName,n),await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.tileInfoFileName,r)},async createSixteenHeightMap(){if(await idbKeyval.get("mapserver"),this.mapserver==="Mapbox"?(this.access_token=await idbKeyval.get("mapbox_access_token"),this.satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint")):this.mapserver==="Maptiler"&&(this.access_token=await idbKeyval.get("maptiler_access_token"),this.satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint")),this.tile_info){let e,t;if(this.tile_info.resolution=this.unrealLandscape.value,this.access_token=await idbKeyval.get("access_token"),this.tile_info.geoJsonFileName="geojson-"+this.tile_info.mapboxTileName+".json",this.tile_info.tileInfoFileName="tile-info-"+this.tile_info.mapboxTileName+".json",this.tile_info.sixteenFileName="sixteen-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".png",this.tile_info.mapbox_satellite_image_url=this.satellite_endpoint+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token,this.tile_info.satelliteFileName="satellite-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".jpg",this.qt.loading.show(),this.dirHandle=await idbKeyval.get("dirHandle"),await fileUtils.verifyPermission(this.dirHandle,!0)===!1){console.error(`User did not grant permission to '${this.dirHandle.name}'`);return}if(fileUtils.fileExists(this.dirHandle,this.tile_info.thirtytwoFile)){let r=await idbKeyval.get("rgb_image_buffer"),s=await mapUtils.loadImageFromArray(r),l=mapUtils.createHeightMapImage(s,16,"GREY"),p=l.image;if(this.exportOptionsModel.includes("flipy")&&(p=await p.flipY()),this.exportOptionsModel.includes("flipx")&&(p=await p.flipX()),this.blurRadius>=1&&(p=p.blurFilter({radius:this.blurRadius})),t=await p.toBuffer(),this.img_min=parseInt(l.minElevation).toString(),this.img_max=parseInt(l.maxElevation).toString(),this.tile_info.resampleSize=this.unrealLandscape.value.toString(),this.tile_info.resizeMethod="lanczos",this.tile_info.exportTypeLabel=this.exportType.label,this.tile_info.alphaBrushFileName="alphabrush-"+this.tile_info.mapboxTileName+"-height-"+this.alphaBrushHeight+"-width-"+this.alphaBrushWidth,this.exportOptionsModel.includes("features")){let o=!1;this.exportOptionsModel.includes("combine_features")&&(o=!0),await this.unrealTileFeatures(o)}switch(this.tile_info.exportTypeLabel){case"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip":if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")&&this.mapserver==="Mapbox"){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let o=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.processGdal(o,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}this.qt.loading.hide();break;case"Unreal Heightmap":if(this.tile_info.resampleSize!==512){if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.mapserver==="Mapbox"){if(this.exportOptionsModel.includes("satellite")){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let o=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.processGdal(o,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}if(this.exportOptionsModel.includes("raster_style")){let o=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",x=await idbKeyval.get("mapbox_raster_style_url")||"",M=o+"/"+x+`/tiles/512/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token,P=await mapUtils.downloadTerrainRgb(M),he=await mapUtils.loadImageFromArray(P);await this.saveImage(P,"splat_"+this.tile_info.sixteenFileName,"png");let nt=he.getPixelsArray(),_e=[0,0,0],Bt=[255,255,255],Fn=[],yr=await idbKeyval.get("weightmap_data");for(let Io of yr){Fn=JSON.stringify(Io.color.split(",").map(Number));for(let as=0;as<nt.length;as++)JSON.stringify(nt[as])===Fn?he.setPixel(as,Bt):he.setPixel(as,_e);let Co=await he.resize({width:this.tile_info.resampleSize,height:this.tile_info.resampleSize}).gaussianFilter({radius:this.blurRadiusWeightmap}).toBuffer();await this.saveImage(Co,"splat_"+Io.name+"_"+this.tile_info.sixteenFileName,"png")}}}}else if(await this.saveImage(t,this.tile_info.sixteenFileName,"png"),this.mapserver==="Mapbox"&&this.exportOptionsModel.includes("satellite")){let o=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.saveImage(o,this.tile_info.satelliteFileName,"png")}this.qt.loading.hide();break;case"Geojson Only":await this.unrealTileFeatures(!0),this.qt.loading.hide();break;case"Unreal Stamp Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"Unreal Landmass Effect Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"None":await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.sixteenFileName,p.toBuffer()),this.qt.loading.hide();break}}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0}}},_hoisted_1$2=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$2={class:"row justify-start q-pa-none q-mb-md"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Type:")],-1),_hoisted_7$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Options:")],-1),_hoisted_8$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Coordinates for Unreal LandscapeGen Plugin")],-1),_hoisted_9$2=createBaseVNode("div",{class:"text-h6"},"Zoom:",-1),_hoisted_10$2=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lat/Lng:",-1),_hoisted_11$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Bounding Box Corners Lat/Lng:")],-1),_hoisted_12$2=createBaseVNode("div",{class:"text-h6"},"Top Left:",-1),_hoisted_13$2=createBaseVNode("div",{class:"text-h6"},"Bottom Left:",-1),_hoisted_14=createBaseVNode("div",{class:"text-h6"},"Top Right:",-1),_hoisted_15=createBaseVNode("div",{class:"text-h6"},"Bottom Right:",-1),_hoisted_16=createBaseVNode("div",{class:"text-h6"},"Lng/Lat Max/Min:",-1),_hoisted_17=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$2(e,t,n,r,s,l){return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$2,createVNode(QImg,{src:r.url,height:"150px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(QField,{dense:"",class:"text-weight-bolder q-pt-none q-mt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(this.tile_info.minmax),1)]),_:1}),createVNode(QField,{class:"q-pt-none q-mt-xs",dense:"",label:"Unreal X,Y and Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$2,toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.zscale),1)]),_:1}),createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_6$2]),_:1}),createVNode(QSelect,{class:"q-mt-none q-pt-none","bg-color":"blue-2",outlined:"",filled:"",dense:"",modelValue:r.exportType,"onUpdate:modelValue":[t[0]||(t[0]=p=>r.exportType=p),l.exportType_Change],options:r.exportTyprOptions,"option-disable":"cannotSelect"},null,8,["modelValue","options","option-disable","onUpdate:modelValue"]),withDirectives(createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_7$2]),_:1},512),[[vShow,r.isExportOptions]]),withDirectives(createVNode(QOptionGroup,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:r.exportOptions,"onUpdate:modelValue":[l.exportOptionsModelChange,t[1]||(t[1]=p=>r.exportOptionsModel=p)],type:"checkbox",modelValue:r.exportOptionsModel},null,8,["options","onUpdate:modelValue","modelValue"]),[[vShow,r.isExportOptions]]),withDirectives(createVNode(QSelect,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:r.unrealLandscape,"onUpdate:modelValue":[t[2]||(t[2]=p=>r.unrealLandscape=p),l.landscapeSizeChange],options:r.landscapeSize},null,8,["modelValue","options","onUpdate:modelValue"]),[[vShow,r.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[createVNode(QCheckbox,{modelValue:r.isWorldPartition,"onUpdate:modelValue":t[3]||(t[3]=p=>r.isWorldPartition=p),label:"Enable World Partition"},null,8,["modelValue"])]),_:1},512),[[vShow,r.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"World Partition Grid Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:r.gridSize,"onUpdate:modelValue":t[4]||(t[4]=p=>r.gridSize=p)},null,8,["modelValue"])]),_:1},512),[[vShow,r.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Brush Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:r.alphaBrushHeight,"onUpdate:modelValue":t[5]||(t[5]=p=>r.alphaBrushHeight=p),label:"Height"},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:r.alphaBrushWidth,"onUpdate:modelValue":t[6]||(t[6]=p=>r.alphaBrushWidth=p),label:"Width"},null,8,["modelValue"]),createVNode(QInput,{ref:"alphaBrushNameRef",dense:"",modelValue:r.alphaBrushName,"onUpdate:modelValue":t[7]||(t[7]=p=>r.alphaBrushName=p),label:"Brush Name"},null,8,["modelValue"])]),_:1},512),[[vShow,r.isAlphaBrush]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Name (Optional)",hint:"Enter Unique Landscape Name"},{default:withCtx(()=>[createVNode(QInput,{dense:"",modelValue:r.landscapeName,"onUpdate:modelValue":t[8]||(t[8]=p=>r.landscapeName=p)},null,8,["modelValue"])]),_:1},512),[[vShow,r.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:r.blurRadius,"onUpdate:modelValue":t[9]||(t[9]=p=>r.blurRadius=p)},null,8,["modelValue"])]),_:1},512),[[vShow,r.isBlurRadius]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Weightmap Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:r.blurRadiusWeightmap,"onUpdate:modelValue":t[10]||(t[10]=p=>r.blurRadiusWeightmap=p)},null,8,["modelValue"])]),_:1},512),[[vShow,r.isBlurRadius]])])]),withDirectives(createVNode(QBtn,{onClick:l.createSixteenHeightMap,ref:"btnDownload",dense:"",color:"primary","no-caps":"",label:"Download HeightMap"},null,8,["onClick"]),[[vShow,r.isDownload]]),withDirectives(createVNode(QBtn,{onClick:l.sendToUnreal,disabled:r.isDisabled,dense:"",color:"green",class:"q-ml-xs","no-caps":"",label:"Send To Unreal"},null,8,["onClick","disabled"]),[[vShow,r.isSendToUnreal]]),createVNode(QBtn,{onClick:l.copyExtents,disabled:r.isDisabled,dense:"",color:"purple",class:"q-ml-xs","no-caps":"",label:"Copy Bounds for Blender Osm"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:l.copyTileInfoString,disabled:r.isDisabled,dense:"",color:"cyan",class:"q-ml-xs","no-caps":"",label:"Copy Slippy Tile Info String"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:l.showBBInfo,dense:"",color:"orange","no-caps":"",label:"Show Bounding Box Info"},null,8,["onClick"]),createVNode(QDialog,{modelValue:r.bbinfoalert,"onUpdate:modelValue":t[11]||(t[11]=p=>r.bbinfoalert=p)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_8$2]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_9$2,createTextVNode(" "+toDisplayString(r.tile_info.z)+" ",1),_hoisted_10$2,createTextVNode(" Lat: "+toDisplayString(r.tile_info.pointLat)+" Lng: "+toDisplayString(r.tile_info.pointLng)+" ",1),_hoisted_11$2,_hoisted_12$2,createTextVNode(" Lat: "+toDisplayString(r.tile_info.topLeft.lat)+" Lng: "+toDisplayString(r.tile_info.topLeft.lng)+" ",1),_hoisted_13$2,createTextVNode(" Lat: "+toDisplayString(r.tile_info.bottomLeft.lat)+" Lng: "+toDisplayString(r.tile_info.bottomLeft.lng)+" ",1),_hoisted_14,createTextVNode(" Lat: "+toDisplayString(r.tile_info.topRight.lat)+" Lng: "+toDisplayString(r.tile_info.topRight.lng)+" ",1),_hoisted_15,createTextVNode(" Lat: "+toDisplayString(r.tile_info.bottomRight.lat)+" Lng: "+toDisplayString(r.tile_info.bottomRight.lng)+" ",1),_hoisted_16,createTextVNode(" Lng/Lat-Min: "+toDisplayString(r.tile_info.bboxW)+" , "+toDisplayString(r.tile_info.bboxS)+" Lng/Lat-Max: "+toDisplayString(r.tile_info.bboxE)+" , "+toDisplayString(r.tile_info.bboxN),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(QDialog,{modelValue:r.alert,"onUpdate:modelValue":t[12]||(t[12]=p=>r.alert=p)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_17]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const SideNav=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]),version="2.7.0",_sfc_main$1={setup(){return{appVersion:ref(version)}},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$1=createBaseVNode("div",null,[createBaseVNode("b",null,"Help")],-1),_hoisted_2$1=createBaseVNode("br",null,null,-1),_hoisted_3$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Settings Page:")],-1),_hoisted_4$1=createBaseVNode("ol",null,[createBaseVNode("li",null,[createTextVNode(" You need to create a free Mapbox account and enter your mapbox access token. Goto "),createBaseVNode("a",{href:"https://www.mapbox.com",target:"_blank"},"Mapbox"),createTextVNode(" then goto your account page. There you can copy your access token. ")]),createBaseVNode("li",null," Select a download folder. This is a folder on your local pc where your heightmap files will be saved. ")],-1),_hoisted_5$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Map Page:")],-1),_hoisted_6$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Map Settings"),createTextVNode(" -- Enable different layers for viewing. This does not affect downloaded data ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Search Bar"),createTextVNode(" -- Enter the name of a location or Longitude Latitude seperated by a comma. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Top Bar"),createTextVNode(" -- Area in KM show the area of the blue bounding box in Kilometers. Slippy Tile Info String is a standard format identification for downloading map tiles. Format is X,Y,Z Z = zoom level. ")])],-1),_hoisted_7$1=createBaseVNode("div",{class:""},[createBaseVNode("b",null,"Map Navigation:")],-1),_hoisted_8$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Select a Draw mode"),createTextVNode(" -- Select a draw mode from the control on the right of the map. "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/single_tile.png",alt:"Single select"}),createTextVNode(" Single tile select")]),createTextVNode(" -- Select a single tile (default mode) "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/multiple_tile.png",alt:"Multiple select"}),createTextVNode(" Draw rectangle to select multiple tiles")]),createTextVNode(" -- Note you need to run the backend server for tile stitching See Tile stitching video at the bottom for use. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Click"),createTextVNode(" -- Selects a location on the map indicated by a blue bounding box. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Double Left Mouse Click"),createTextVNode(" -- Download the tile preview and tile information. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Right Mouse Hold"),createTextVNode(" -- Tilt and Rotate the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Scroll Wheel"),createTextVNode(" -- Zoom in and out. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Arrow Keys"),createTextVNode(" -- Move around the map. ")])],-1),_hoisted_9$1=createBaseVNode("div",{class:"q-mb-md"},[createBaseVNode("b",null,"Left Side Bar:")],-1),_hoisted_10$1=createBaseVNode("div",{class:"q-ml-md"},[createBaseVNode("div",null,[createBaseVNode("u",null,"Export Type:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Heightmap"),createTextVNode(" -- Generates a 16-bit png heightmap file. Can be used in other applications besides Unreal. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- EarthLandscape Clip"),createTextVNode(" -- Sends tile info string x,y and zoom to Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added it to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"),createTextVNode(" -- Downloads heightmap from this app and loads it into Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Stamp Brush Plugin"),createTextVNode(" -- You need to install paid plugin "),createBaseVNode("a",{href:"https://www.unrealengine.com/marketplace/en-US/product/landscape-stamping-tool-100-custom-brushes?sessionInvalidated=true"},"Landscape Stamping Tool - 100+ Custom Brushes"),createTextVNode(". This automates the creation of new stamps from selected map location. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Landmass Effect Brush Plugin"),createTextVNode(" -- Open source plugin for creating non-destructive landmass stamps and other features. Download the source from here "),createBaseVNode("a",{href:"https://github.com/AWeinb/SimplerLandmassBlueprints"},"SimplerLandmassBlueprints"),createTextVNode(". From the Content folder copy the whole Editor folder to your Content directory. Each time you click Send To Unreal it will import the texture to a sub folder CustomBrushes > Textures. For now it only imports the texture you have to manually add the texture to the brush according to the github instructions. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"None"),createTextVNode(" -- Generate 16-bit png heightmap but do not do any other transformations to the image. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Geojson Only"),createTextVNode(" -- Do not download a heightmap png file. Just download a Geojson file. ")])])]),createBaseVNode("div",null,[createBaseVNode("u",null,"Export Options:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Zrange-sea level="),createTextVNode(" -- By checking this the imported heightmap will keep the landscape height near 100 Unreal Units. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"FlipX/FlipY"),createTextVNode(" -- Flips the sides of the heightmap image in the X or Y direction. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Satellite"),createTextVNode(" -- Downloads a Satellite Image of the selected area. This can be used as on overlay in UE. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Geojson Features"),createTextVNode(" -- Downloads the features of the selected area in geojson format. Search Mapbox for geosjon. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Combine Unique Features"),createTextVNode(" -- Removes overlapping features when downloading geojson ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Create Weightmap (Splatmap) Files"),createTextVNode(" -- You can now create weightmap files for use in Unreal for texturing your landscape. Setup and Use instructions https://www.youtube.com/watch?v=j_4pZ5EneVc&t=6s ")])])])],-1),_hoisted_11$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Landscape:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Size"),createTextVNode(" -- Resamples the size of the image to recommended Unreal Landscape sizes. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Enable World Partition"),createTextVNode(" -- If you have a World Partition project and want a World Partition landscape with proxies, enable this.. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"World Partition Grid Size"),createTextVNode(" -- Grid size setting. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Name"),createTextVNode(" -- Name of the landscape to be imported. (Optional ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Blur Radius"),createTextVNode(" -- Adds a gaussian blur to the heightmap png. This can help smooth out your imported landscape if it has some sharp edges. The greater the number the greater the blur. 0 = no blur. ")])])],-1),_hoisted_12$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Buttons:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Download Heightmap"),createTextVNode(" -- Downloads the heightmap png to the folder location on the settings page. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Send To Unreal"),createTextVNode(" -- Automatically imports heightmap or stamp into your Unreal project. Required -- Mapbox_BP has to be installed in to your unreal project and configured. You can download the free plugin here "),createBaseVNode("a",{href:"https://github.com/delebash/UnrealMapboxBridgePlugin"},"Unreal Mapbox Bridge Plugin"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Bounds for Blender OSM"),createTextVNode(" -- A plugin for blend that downloads real world map info into blender. It has it's own map but you can use this one as well since it has a search by name feature. Download "),createBaseVNode("a",{href:"https://github.com/vvoovv/blender-osm"},"Blender OSM"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Slippy Tile Info String"),createTextVNode(" -- This format is used in many other GIS applications to download map tile information. This is just a convenience function. This is also the same string Terrain Magic expects. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Show Bounding Box Info"),createTextVNode(" -- General info such as Long/Lat info for bounding box. ")])])],-1),_hoisted_13$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Videos:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("a",{href:"https://www.youtube.com/playlist?list=PLFCVXzupw1r_7ExUSGDxHGHU-gPRxOGeZ"},"Unreal Mapbox Bridge Tutorial Playlist")])])],-1);function _sfc_render$1(e,t,n,r,s,l){return openBlock(),createBlock(QDialog,{class:"dialog-plugin",ref:"dialog",onHide:l.onDialogHide},{default:withCtx(()=>[createVNode(QCard,{style:{width:"900px","max-width":"80vw",height:"700px"}},{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_1$1,_hoisted_2$1,createVNode(QSeparator),_hoisted_3$1,_hoisted_4$1,_hoisted_5$1,_hoisted_6$1,_hoisted_7$1,_hoisted_8$1,_hoisted_9$1,_hoisted_10$1,_hoisted_11$1,_hoisted_12$1,_hoisted_13$1,createVNode(QCardActions,{class:"absolute-top",align:"right"},{default:withCtx(()=>[createTextVNode(" App Version "+toDisplayString(r.appVersion)+"  ",1),createVNode(QBtn,{color:"primary",label:"Close",onClick:l.onOKClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"])}const Help=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),columns=[{name:"name",align:"left",label:"Name",field:"name",sortable:!0},{name:"color",align:"left",label:"Color",field:"color",sortable:!0}];let rows=[{name:"Forest",color:"201, 28, 19"},{name:"Water",color:"78, 143, 207"},{name:"Scrub",color:"143, 253, 139"},{name:"Trees",color:"34, 106, 32"},{name:"Rock",color:"101, 100, 93"},{name:"Sand",color:"243, 234, 129"},{name:"Grass",color:"33, 225, 29"},{name:"Glacier",color:"255, 255, 255"},{name:"Landcover",color:"0, 0, 0"},{name:"Hillshade",color:"242, 110, 220"}];const _sfc_main={setup(){const e=useQuasar(),t=ref([]),n=ref(!1);return{mapserver:ref("Mapbox"),servertype:["Maptiler","Mapbox"],selected:t,columns,rows:ref(rows),loading:n,pagination:ref({rowsPerPage:0}),getSelectedString(){return t.value.length===0?"":`${t.value.length} record${t.value.length>1?"s":""} selected of ${rows.length}`},showDialog(){e.dialog({component:Help,componentProps:{text:""}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),alert:ref(!1),alertMsg:ref(""),backendServer:ref(""),saveStitchingFiles:ref(!1),dirHandle:ref(""),dirName:ref(""),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_api_url:ref(""),maptiler_raster_png_dem:ref(""),mapbox_style_url:ref(""),mapbox_access_token:ref(""),mapbox_api_url:ref(""),mapbox_raster_style_endpoint:ref(""),mapbox_raster_style_url:ref(""),mapbox_raster_png_dem:ref(""),mapbox_satellite_endpoint:ref(""),isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){this.checkFileApiSupport(),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap()},methods:{async mapserverChange(e){this.mapserver=e,idbKeyval.set("mapserver",this.mapserver),await this.loadUserData()},addRow(){let e={name:"Color",color:"0, 0, 0"};this.rows.push(e)},removeRow(){if(this.selected.length>0){let e=this.rows.filter(t=>!this.selected.includes(t));this.rows=JSON.parse(JSON.stringify(e)),this.saveRow()}else this.alertMsg="Select row(s) to delete.",this.alert=!0},saveRow(){if(isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows)},checkFileApiSupport(){fileUtils.checkFileApiSupport()===!1&&(this.alertMsg="This browser does not support File System Access API.  Try Edge or Chrome.",this.alert=!0)},resizeMap(){this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.resizeMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.loadMapboxMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.loadMapTilerMap()})},async loadWeightMap(){await this.$nextTick(()=>{this.mapserver==="Mapbox"&&this.$refs.weightmapViewerRef.loadMapboxWeightMap()})},isRequiredSettings(){if(this.mapserver==="Mapbox")return this.mapbox_access_token&&this.mapbox_style_url&&this.dirName?!0:(this.redirectToSettings(),!1);if(this.mapserver==="Maptiler")return!0},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let e;try{e=await fileUtils.getDirHandle()}catch(t){if(t.name==="AbortError")return;console.error("An error occured trying to open the file.",t)}e&&(idbKeyval.set("dirHandle",e),this.dirName=e.name)},saveUserSettings(){if(idbKeyval.set("mapserver",this.mapserver),this.mapserver==="Maptiler"?(idbKeyval.set("maptiler_access_token",this.maptiler_access_token),idbKeyval.set("maptiler_style_url",this.maptiler_style_url),idbKeyval.set("maptiler_api_url",this.maptiler_api_url),idbKeyval.set("maptiler_raster_png_dem",this.maptiler_raster_png_dem)):this.mapserver==="Mapbox"&&(idbKeyval.set("mapbox_access_token",this.mapbox_access_token),idbKeyval.set("mapbox_style_url",this.mapbox_style_url),idbKeyval.set("mapbox_api_url",this.mapbox_api_url),idbKeyval.set("mapbox_satellite_endpoint",this.mapbox_satellite_endpoint),idbKeyval.set("mapbox_raster_png_dem",this.mapbox_raster_png_dem),idbKeyval.set("mapbox_raster_style_endpoint",this.mapbox_raster_style_endpoint),idbKeyval.set("mapbox_raster_style_url",this.mapbox_raster_style_url)),idbKeyval.set("mapserver",this.mapserver),idbKeyval.set("create_folder",this.createFolder),idbKeyval.set("backendServer",this.backendServer),idbKeyval.set("saveStitchingFiles",this.saveStitchingFiles),isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows);this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){this.mapserver=await idbKeyval.get("mapserver"),this.mapserver==="Maptiler"?(this.maptiler_access_token=await idbKeyval.get("maptiler_access_token")||"",this.maptiler_style_url=await idbKeyval.get("maptiler_style_url")||"https://api.maptiler.com/maps/streets/style.json",this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem")||"https://api.maptiler.com/tiles/terrain-rgb-v2/",this.maptiler_api_url=await idbKeyval.get("maptiler_api_url")||"https://api.maptiler.com"):this.mapserver==="Mapbox"&&(this.mapbox_access_token=await idbKeyval.get("mapbox_access_token")||"",this.mapbox_style_url=await idbKeyval.get("mapbox_style_url")||"mapbox://styles/mapbox/streets-v11",this.mapbox_api_url=await idbKeyval.get("mapbox_api_url")||"https://api.mapbox.com/v4/",this.mapbox_satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint")||"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles",this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem")||"mapbox.mapbox-terrain-dem-v1",this.mapbox_raster_style_endpoint=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",this.mapbox_raster_style_url=await idbKeyval.get("mapbox_raster_style_url")||"");let e=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.saveStitchingFiles=await idbKeyval.get("saveStitchingFiles")||!1,this.backendServer=await idbKeyval.get("backendServer")||"http://localhost:3000/backend";let t=await idbKeyval.get("weightmap_data")||[];t.length===0?(idbKeyval.set("weightmap_data",rows),this.rows=rows):this.rows=t,this.dirHandle=e,this.dirName=e.name}},components:{MapboxMapViewer,MaptilerMapViewer,WeightmapViewer,SideNav,Help}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2={key:0},_hoisted_3=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Maptiler Settings")],-1),_hoisted_4={key:1},_hoisted_5=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Mapbox Settings")],-1),_hoisted_6=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_7=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_8=createBaseVNode("a",{href:"https://api.mapbox.com/styles/v1/delebash/clfzz7dot000001qilz330eyt.html?title=copy&access_token=pk.eyJ1IjoiZGVsZWJhc2giLCJhIjoiY2t1YWxkODF0MGh2NjJxcXA4czBpdXlmdyJ9.D_ngzR7j4vU1CILtpNLg4Q&zoomwheel=true&fresh=true#8.76/35.8732/5.8202/0/7"},"Copy Mapbox Weightmap Style",-1),_hoisted_9={class:"q-pa-none row items-start"},_hoisted_10={class:"col q-pa-none"},_hoisted_11=createBaseVNode("br",null,null,-1),_hoisted_12={class:"q-pa-md"},_hoisted_13=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render(e,t,n,r,s,l){const p=resolveComponent("side-nav"),o=resolveComponent("mapbox-map-viewer"),x=resolveComponent("maptiler-map-viewer"),M=resolveComponent("weightmap-viewer");return openBlock(),createBlock(QLayout,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(QHeader,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(QDrawer,{dense:"","show-if-above":"",modelValue:r.drawerLeft,"onUpdate:modelValue":t[0]||(t[0]=P=>r.drawerLeft=P),side:"left",onHide:l.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QCard,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(p)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(QPageContainer,null,{default:withCtx(()=>[createVNode(QPage,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(QCard,{class:"col"},{default:withCtx(()=>[createVNode(QTabs,{dense:"",modelValue:r.selectedTab,"onUpdate:modelValue":t[3]||(t[3]=P=>r.selectedTab=P),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(QBtn,{dense:"",flat:"",onClick:l.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(QTab,{dense:"",name:"map",label:"Map"}),createVNode(QTab,{dense:"",name:"weightmap",onClick:t[1]||(t[1]=P=>l.loadWeightMap()),label:"Weight Map"}),createVNode(QTab,{dense:"",name:"settings",label:"Settings"}),createVNode(QBtn,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:r.showDialog},null,8,["onClick"]),createVNode(QBtn,{dense:"",flat:"",round:"",onClick:t[2]||(t[2]=P=>e.$q.dark.toggle()),icon:e.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(QSeparator),createVNode(QTabPanels,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:r.selectedTab,"onUpdate:modelValue":t[26]||(t[26]=P=>r.selectedTab=P),animated:""},{default:withCtx(()=>[createVNode(QTabPanel,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[r.mapserver=="Mapbox"?(openBlock(),createBlock(o,{key:0,class:"col",ref:"mapBoxViewer"},null,512)):createCommentVNode("",!0),r.mapserver=="Maptiler"?(openBlock(),createBlock(x,{key:1,class:"col",ref:"mapTilerViewer"},null,512)):createCommentVNode("",!0)]),_:1}),createVNode(QTabPanel,{name:"weightmap",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(M,{class:"col",ref:"weightmapViewerRef"},null,512)]),_:1}),createVNode(QTabPanel,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[createVNode(QSelect,{"onUpdate:modelValue":[t[4]||(t[4]=P=>l.mapserverChange(P)),t[5]||(t[5]=P=>r.mapserver=P)],modelValue:r.mapserver,options:r.servertype,label:"Server Type"},null,8,["modelValue","options"]),r.mapserver=="Maptiler"?(openBlock(),createElementBlock("div",_hoisted_2,[_hoisted_3,createVNode(QInput,{dense:"",modelValue:r.maptiler_access_token,"onUpdate:modelValue":t[7]||(t[7]=P=>r.maptiler_access_token=P),label:"Maptiler Access Token *",filled:"",type:r.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Maptiler accounts page. The Mapbox free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:r.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[6]||(t[6]=P=>r.isPwd=!r.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.maptiler_style_url,"onUpdate:modelValue":t[8]||(t[8]=P=>r.maptiler_style_url=P),label:"Enter your Maptiler style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Maptiler Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.maptiler_api_url,"onUpdate:modelValue":t[9]||(t[9]=P=>r.maptiler_api_url=P),label:"Maptiler base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.maptiler_raster_png_dem,"onUpdate:modelValue":t[10]||(t[10]=P=>r.maptiler_raster_png_dem=P),label:"Maptiler Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"])])):createCommentVNode("",!0),r.mapserver=="Mapbox"?(openBlock(),createElementBlock("div",_hoisted_4,[_hoisted_5,createTextVNode(" See: "),_hoisted_6,createVNode(QInput,{dense:"",modelValue:r.mapbox_access_token,"onUpdate:modelValue":t[12]||(t[12]=P=>r.mapbox_access_token=P),label:"Mapbox Access Token *",filled:"",type:r.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:r.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[11]||(t[11]=P=>r.isPwd=!r.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createTextVNode(" See: "),_hoisted_7,createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_style_url,"onUpdate:modelValue":t[13]||(t[13]=P=>r.mapbox_style_url=P),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_api_url,"onUpdate:modelValue":t[14]||(t[14]=P=>r.mapbox_api_url=P),label:"Mapbox base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_raster_png_dem,"onUpdate:modelValue":t[15]||(t[15]=P=>r.mapbox_raster_png_dem=P),label:"Mapbox Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_satellite_endpoint,"onUpdate:modelValue":t[16]||(t[16]=P=>r.mapbox_satellite_endpoint=P),label:"Mapbox Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createTextVNode(" Click "),_hoisted_8,createTextVNode(" to copy this style to your mapbox account and then paste your new style address in text box below in the format name/style id example: delebash/clfzz7dot000001qilz330eyt "),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_raster_style_url,"onUpdate:modelValue":t[17]||(t[17]=P=>r.mapbox_raster_style_url=P),label:"Mapbox Weight Map Style",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.mapbox_raster_style_endpoint,"onUpdate:modelValue":t[18]||(t[18]=P=>r.mapbox_raster_style_endpoint=P),label:"Mapbox Raster From Style Endpoint",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"])])):createCommentVNode("",!0),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:r.backendServer,"onUpdate:modelValue":t[19]||(t[19]=P=>r.backendServer=P),label:"Backend Server for Tile Stitching",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"]),createVNode(QCheckbox,{modelValue:r.saveStitchingFiles,"onUpdate:modelValue":t[20]||(t[20]=P=>r.saveStitchingFiles=P),label:"Save Temp Stitching files to disk"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createVNode(QInput,{dense:"",class:"q-pb-none",modelValue:r.dirName,"onUpdate:modelValue":t[21]||(t[21]=P=>r.dirName=P),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[P=>P&&P.length>0||"Please type something"],type:r.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(QBtn,{class:"q-pb-none",dense:"",onClick:t[22]||(t[22]=P=>l.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_11,createBaseVNode("div",_hoisted_12,[createVNode(QTable,{flat:"",bordered:"",title:"Weightmap colors",rows:r.rows,columns:r.columns,"row-key":"name","selected-rows-label":r.getSelectedString,selection:"multiple",selected:r.selected,"onUpdate:selected":t[23]||(t[23]=P=>r.selected=P),"virtual-scroll":"",pagination:r.pagination,"onUpdate:pagination":t[24]||(t[24]=P=>r.pagination=P),"rows-per-page-options":[0],loading:r.loading},{top:withCtx(()=>[createVNode(QBtn,{color:"primary",disable:r.loading,label:"Add new color",onClick:l.addRow},null,8,["disable","onClick"]),createVNode(QBtn,{class:"q-ml-sm",color:"primary",disable:r.loading,label:"Delete selected rows",onClick:l.removeRow},null,8,["disable","onClick"])]),body:withCtx(P=>[createVNode(QTr,{props:P},{default:withCtx(()=>[createVNode(QTd,null,{default:withCtx(()=>[createVNode(QCheckbox,{dense:"",modelValue:P.selected,"onUpdate:modelValue":he=>P.selected=he},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),createVNode(QTd,{key:"name",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.name)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.name,"onUpdate:modelValue":he=>P.row.name=he,title:"Name",onSave:l.saveRow},{default:withCtx(he=>[createVNode(QInput,{modelValue:he.value,"onUpdate:modelValue":nt=>he.value=nt,dense:"",autofocus:"",counter:"",onKeyup:withKeys(he.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),createVNode(QTd,{key:"color",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.color)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.color,"onUpdate:modelValue":he=>P.row.color=he,title:"r,g,b",onSave:l.saveRow},{default:withCtx(he=>[createVNode(QInput,{modelValue:he.value,"onUpdate:modelValue":nt=>he.value=nt,dense:"",autofocus:"",counter:"",onKeyup:withKeys(he.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected-rows-label","selected","pagination","loading"])]),createVNode(QBtn,{class:"q-pt-none",dense:"",onClick:t[25]||(t[25]=P=>l.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(QDialog,{modelValue:r.alert,"onUpdate:modelValue":t[27]||(t[27]=P=>r.alert=P)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_13]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
