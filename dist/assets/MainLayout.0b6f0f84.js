var ig=Object.defineProperty;var Lf=Object.getOwnPropertySymbols;var rg=Object.prototype.hasOwnProperty,ng=Object.prototype.propertyIsEnumerable;var zf=(d,h,p)=>h in d?ig(d,h,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[h]=p,Su=(d,h)=>{for(var p in h||(h={}))rg.call(h,p)&&zf(d,p,h[p]);if(Lf)for(var p of Lf(h))ng.call(h,p)&&zf(d,p,h[p]);return d};import{g as commonjsGlobal,h as getAugmentedNamespace,i as commonjsRequire,j as ref,r as resolveComponent,o as openBlock,k as createElementBlock,l as createVNode,w as withCtx,m as createBaseVNode,u as useQuasar,n as resolveDirective,t as toDisplayString,p as createTextVNode,q as withDirectives,F as Fragment,c as createBlock,d as defineComponent,s as unref,v as createCommentVNode,N as Notify,x as vShow}from"./vendor.9778e53c.js";import{_ as _export_sfc}from"./index.f78aea62.js";class Store{constructor(h="unreal-mapbox",p="keyval"){this.storeName=p,this._dbp=new Promise((m,w)=>{const M=indexedDB.open(h,3);M.onerror=()=>w(M.error),M.onsuccess=()=>m(M.result),M.onupgradeneeded=()=>{try{M.result.deleteObjectStore(p)}catch{}M.result.createObjectStore(p)}})}_withIDBStore(h,p){return this._dbp.then(m=>new Promise((w,M)=>{const k=m.transaction(this.storeName,h);k.oncomplete=()=>w(),k.onabort=k.onerror=()=>M(k.error),p(k.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(d,h=getDefaultStore()){let p;return h._withIDBStore("readonly",m=>{p=m.get(d)}).then(()=>p.result)}function set(d,h,p=getDefaultStore()){return p._withIDBStore("readwrite",m=>{m.put(h,d)})}function del(d,h=getDefaultStore()){return h._withIDBStore("readwrite",p=>{p.delete(d)})}function clear(d=getDefaultStore()){return d._withIDBStore("readwrite",h=>{h.clear()})}function keys(d=getDefaultStore()){const h=[];return d._withIDBStore("readonly",p=>{(p.openKeyCursor||p.openCursor).call(p).onsuccess=function(){!this.result||(h.push(this.result.key),this.result.continue())}}).then(()=>h)}var idbKeyval={keys,clear,del,set,get};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(d=>d[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(d=>d)}async function verifyPermission(d,h){const p={};return h&&(p.writable=!0,p.mode="readwrite"),await d.queryPermission(p)==="granted"||await d.requestPermission(p)==="granted"}async function writeFileToDisk(d,h,p){let w=await(await d.getFileHandle(h,{create:!0})).createWritable();await w.write(p),await w.close()}async function fileExists(d,h){try{return await d.getFileHandle(h),!0}catch(p){if(p.name==="NotFoundError")return!1;if(p.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(d,h){return await(await(await d.getFileHandle(h)).getFile()).arrayBuffer()}var fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk},mapboxGl={exports:{}};(function(d,h){(function(p,m){d.exports=m()})(commonjsGlobal,function(){var p,m,w;function M(x,L){if(!p)p=L;else if(!m)m=L;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",$={};p($),w=L($),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}M(["exports"],function(x){var L="2.7.0",B=$;function $(g,l,b,T){this.cx=3*g,this.bx=3*(b-g)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(T-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=g,this.p1y=T,this.p2x=b,this.p2y=T}$.prototype.sampleCurveX=function(g){return((this.ax*g+this.bx)*g+this.cx)*g},$.prototype.sampleCurveY=function(g){return((this.ay*g+this.by)*g+this.cy)*g},$.prototype.sampleCurveDerivativeX=function(g){return(3*this.ax*g+2*this.bx)*g+this.cx},$.prototype.solveCurveX=function(g,l){var b,T,A,I,P;for(l===void 0&&(l=1e-6),A=g,P=0;P<8;P++){if(I=this.sampleCurveX(A)-g,Math.abs(I)<l)return A;var F=this.sampleCurveDerivativeX(A);if(Math.abs(F)<1e-6)break;A-=I/F}if((A=g)<(b=0))return b;if(A>(T=1))return T;for(;b<T;){if(I=this.sampleCurveX(A),Math.abs(I-g)<l)return A;g>I?b=A:T=A,A=.5*(T-b)+b}return A},$.prototype.solve=function(g,l){return this.sampleCurveY(this.solveCurveX(g,l))};var U=q;function q(g,l){this.x=g,this.y=l}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(g){return this.clone()._add(g)},sub:function(g){return this.clone()._sub(g)},multByPoint:function(g){return this.clone()._multByPoint(g)},divByPoint:function(g){return this.clone()._divByPoint(g)},mult:function(g){return this.clone()._mult(g)},div:function(g){return this.clone()._div(g)},rotate:function(g){return this.clone()._rotate(g)},rotateAround:function(g,l){return this.clone()._rotateAround(g,l)},matMult:function(g){return this.clone()._matMult(g)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(g){return this.x===g.x&&this.y===g.y},dist:function(g){return Math.sqrt(this.distSqr(g))},distSqr:function(g){var l=g.x-this.x,b=g.y-this.y;return l*l+b*b},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(g){return Math.atan2(this.y-g.y,this.x-g.x)},angleWith:function(g){return this.angleWithSep(g.x,g.y)},angleWithSep:function(g,l){return Math.atan2(this.x*l-this.y*g,this.x*g+this.y*l)},_matMult:function(g){var l=g[2]*this.x+g[3]*this.y;return this.x=g[0]*this.x+g[1]*this.y,this.y=l,this},_add:function(g){return this.x+=g.x,this.y+=g.y,this},_sub:function(g){return this.x-=g.x,this.y-=g.y,this},_mult:function(g){return this.x*=g,this.y*=g,this},_div:function(g){return this.x/=g,this.y/=g,this},_multByPoint:function(g){return this.x*=g.x,this.y*=g.y,this},_divByPoint:function(g){return this.x/=g.x,this.y/=g.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var g=this.y;return this.y=this.x,this.x=-g,this},_rotate:function(g){var l=Math.cos(g),b=Math.sin(g),T=b*this.x+l*this.y;return this.x=l*this.x-b*this.y,this.y=T,this},_rotateAround:function(g,l){var b=Math.cos(g),T=Math.sin(g),A=l.y+T*(this.x-l.x)+b*(this.y-l.y);return this.x=l.x+b*(this.x-l.x)-T*(this.y-l.y),this.y=A,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(g){return g instanceof q?g:Array.isArray(g)?new q(g[0],g[1]):g};var G=typeof self!="undefined"?self:{},W=1e-6,te=typeof Float32Array!="undefined"?Float32Array:Array;function oe(){var g=new te(9);return te!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,g}function ee(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function _e(g,l,b){var T=l[0],A=l[1],I=l[2],P=l[3],F=l[4],N=l[5],j=l[6],X=l[7],Y=l[8],H=l[9],re=l[10],ue=l[11],me=l[12],be=l[13],Ie=l[14],Le=l[15],Ne=b[0],je=b[1],qe=b[2],Ye=b[3];return g[0]=Ne*T+je*F+qe*Y+Ye*me,g[1]=Ne*A+je*N+qe*H+Ye*be,g[2]=Ne*I+je*j+qe*re+Ye*Ie,g[3]=Ne*P+je*X+qe*ue+Ye*Le,g[4]=(Ne=b[4])*T+(je=b[5])*F+(qe=b[6])*Y+(Ye=b[7])*me,g[5]=Ne*A+je*N+qe*H+Ye*be,g[6]=Ne*I+je*j+qe*re+Ye*Ie,g[7]=Ne*P+je*X+qe*ue+Ye*Le,g[8]=(Ne=b[8])*T+(je=b[9])*F+(qe=b[10])*Y+(Ye=b[11])*me,g[9]=Ne*A+je*N+qe*H+Ye*be,g[10]=Ne*I+je*j+qe*re+Ye*Ie,g[11]=Ne*P+je*X+qe*ue+Ye*Le,g[12]=(Ne=b[12])*T+(je=b[13])*F+(qe=b[14])*Y+(Ye=b[15])*me,g[13]=Ne*A+je*N+qe*H+Ye*be,g[14]=Ne*I+je*j+qe*re+Ye*Ie,g[15]=Ne*P+je*X+qe*ue+Ye*Le,g}function se(g,l,b){var T,A,I,P,F,N,j,X,Y,H,re,ue,me=b[0],be=b[1],Ie=b[2];return l===g?(g[12]=l[0]*me+l[4]*be+l[8]*Ie+l[12],g[13]=l[1]*me+l[5]*be+l[9]*Ie+l[13],g[14]=l[2]*me+l[6]*be+l[10]*Ie+l[14],g[15]=l[3]*me+l[7]*be+l[11]*Ie+l[15]):(A=l[1],I=l[2],P=l[3],F=l[4],N=l[5],j=l[6],X=l[7],Y=l[8],H=l[9],re=l[10],ue=l[11],g[0]=T=l[0],g[1]=A,g[2]=I,g[3]=P,g[4]=F,g[5]=N,g[6]=j,g[7]=X,g[8]=Y,g[9]=H,g[10]=re,g[11]=ue,g[12]=T*me+F*be+Y*Ie+l[12],g[13]=A*me+N*be+H*Ie+l[13],g[14]=I*me+j*be+re*Ie+l[14],g[15]=P*me+X*be+ue*Ie+l[15]),g}function he(g,l,b){var T=b[0],A=b[1],I=b[2];return g[0]=l[0]*T,g[1]=l[1]*T,g[2]=l[2]*T,g[3]=l[3]*T,g[4]=l[4]*A,g[5]=l[5]*A,g[6]=l[6]*A,g[7]=l[7]*A,g[8]=l[8]*I,g[9]=l[9]*I,g[10]=l[10]*I,g[11]=l[11]*I,g[12]=l[12],g[13]=l[13],g[14]=l[14],g[15]=l[15],g}function ge(g,l,b){var T=Math.sin(b),A=Math.cos(b),I=l[4],P=l[5],F=l[6],N=l[7],j=l[8],X=l[9],Y=l[10],H=l[11];return l!==g&&(g[0]=l[0],g[1]=l[1],g[2]=l[2],g[3]=l[3],g[12]=l[12],g[13]=l[13],g[14]=l[14],g[15]=l[15]),g[4]=I*A+j*T,g[5]=P*A+X*T,g[6]=F*A+Y*T,g[7]=N*A+H*T,g[8]=j*A-I*T,g[9]=X*A-P*T,g[10]=Y*A-F*T,g[11]=H*A-N*T,g}function Re(g,l,b){var T=Math.sin(b),A=Math.cos(b),I=l[0],P=l[1],F=l[2],N=l[3],j=l[8],X=l[9],Y=l[10],H=l[11];return l!==g&&(g[4]=l[4],g[5]=l[5],g[6]=l[6],g[7]=l[7],g[12]=l[12],g[13]=l[13],g[14]=l[14],g[15]=l[15]),g[0]=I*A-j*T,g[1]=P*A-X*T,g[2]=F*A-Y*T,g[3]=N*A-H*T,g[8]=I*T+j*A,g[9]=P*T+X*A,g[10]=F*T+Y*A,g[11]=N*T+H*A,g}Math.hypot||(Math.hypot=function(){for(var g=0,l=arguments.length;l--;)g+=arguments[l]*arguments[l];return Math.sqrt(g)});var ve=_e;function de(){var g=new te(3);return te!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g}function Se(g){var l=new te(3);return l[0]=g[0],l[1]=g[1],l[2]=g[2],l}function ce(g){return Math.hypot(g[0],g[1],g[2])}function ye(g,l,b){var T=new te(3);return T[0]=g,T[1]=l,T[2]=b,T}function ze(g,l,b){return g[0]=l[0]+b[0],g[1]=l[1]+b[1],g[2]=l[2]+b[2],g}function Xe(g,l,b){return g[0]=l[0]-b[0],g[1]=l[1]-b[1],g[2]=l[2]-b[2],g}function at(g,l,b){return g[0]=l[0]*b[0],g[1]=l[1]*b[1],g[2]=l[2]*b[2],g}function ct(g,l,b){return g[0]=Math.max(l[0],b[0]),g[1]=Math.max(l[1],b[1]),g[2]=Math.max(l[2],b[2]),g}function Bt(g,l,b){return g[0]=l[0]*b,g[1]=l[1]*b,g[2]=l[2]*b,g}function Lt(g,l,b,T){return g[0]=l[0]+b[0]*T,g[1]=l[1]+b[1]*T,g[2]=l[2]+b[2]*T,g}function It(g,l){var b=l[0],T=l[1],A=l[2],I=b*b+T*T+A*A;return I>0&&(I=1/Math.sqrt(I)),g[0]=l[0]*I,g[1]=l[1]*I,g[2]=l[2]*I,g}function Vt(g,l){return g[0]*l[0]+g[1]*l[1]+g[2]*l[2]}function Ft(g,l,b){var T=l[0],A=l[1],I=l[2],P=b[0],F=b[1],N=b[2];return g[0]=A*N-I*F,g[1]=I*P-T*N,g[2]=T*F-A*P,g}function Mt(g,l,b){var T=l[0],A=l[1],I=l[2],P=b[3]*T+b[7]*A+b[11]*I+b[15];return g[0]=(b[0]*T+b[4]*A+b[8]*I+b[12])/(P=P||1),g[1]=(b[1]*T+b[5]*A+b[9]*I+b[13])/P,g[2]=(b[2]*T+b[6]*A+b[10]*I+b[14])/P,g}function ri(g,l,b){var T=b[0],A=b[1],I=b[2],P=l[0],F=l[1],N=l[2],j=A*N-I*F,X=I*P-T*N,Y=T*F-A*P,H=A*Y-I*X,re=I*j-T*Y,ue=T*X-A*j,me=2*b[3];return X*=me,Y*=me,re*=2,ue*=2,g[0]=P+(j*=me)+(H*=2),g[1]=F+X+re,g[2]=N+Y+ue,g}var St,At=Xe,Et=at,Ut=ce;function jt(g,l,b){var T=l[0],A=l[1],I=l[2],P=l[3];return g[0]=b[0]*T+b[4]*A+b[8]*I+b[12]*P,g[1]=b[1]*T+b[5]*A+b[9]*I+b[13]*P,g[2]=b[2]*T+b[6]*A+b[10]*I+b[14]*P,g[3]=b[3]*T+b[7]*A+b[11]*I+b[15]*P,g}function mi(){var g=new te(4);return te!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g[3]=1,g}function oi(g){return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g}function yi(g,l,b){b*=.5;var T=l[0],A=l[1],I=l[2],P=l[3],F=Math.sin(b),N=Math.cos(b);return g[0]=T*N+P*F,g[1]=A*N+I*F,g[2]=I*N-A*F,g[3]=P*N-T*F,g}function xi(g,l){return g[0]===l[0]&&g[1]===l[1]}de(),St=new te(4),te!=Float32Array&&(St[0]=0,St[1]=0,St[2]=0,St[3]=0),de(),ye(1,0,0),ye(0,1,0),mi(),mi(),oe(),function(){var g;g=new te(2),te!=Float32Array&&(g[0]=0,g[1]=0)}();const Bi=Math.PI/180,fi=180/Math.PI;function mt(g){return g*Bi}function vt(g){return g*fi}const pi=[[0,0],[1,0],[1,1],[0,1]];function si(g){if(g<=0)return 0;if(g>=1)return 1;const l=g*g,b=l*g;return 4*(g<.5?b:3*(g-l)+b-.75)}function We(g,l,b,T){const A=new B(g,l,b,T);return function(I){return A.solve(I)}}const Wt=We(.25,.1,.25,1);function Rt(g,l,b){return Math.min(b,Math.max(l,g))}function ti(g,l,b){return(b=Rt((b-g)/(l-g),0,1))*b*(3-2*b)}function ni(g,l,b){const T=b-l,A=((g-l)%T+T)%T+l;return A===l?b:A}function bt(g,l,b){if(!g.length)return b(null,[]);let T=g.length;const A=new Array(g.length);let I=null;g.forEach((P,F)=>{l(P,(N,j)=>{N&&(I=N),A[F]=j,--T==0&&b(I,A)})})}function Pi(g){const l=[];for(const b in g)l.push(g[b]);return l}function Kt(g,...l){for(const b of l)for(const T in b)g[T]=b[T];return g}let qt=1;function Zt(){return qt++}function kt(){return function g(l){return l?(l^16*Math.random()>>l/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,g)}()}function ci(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log(g)/Math.LN2))}function vi(g){return!!g&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(g)}function Ti(g,l){g.forEach(b=>{l[b]&&(l[b]=l[b].bind(l))})}function ei(g,l){return g.indexOf(l,g.length-l.length)!==-1}function hi(g,l,b){const T={};for(const A in g)T[A]=l.call(b||this,g[A],A,g);return T}function Ni(g,l,b){const T={};for(const A in g)l.call(b||this,g[A],A,g)&&(T[A]=g[A]);return T}function Ai(g){return Array.isArray(g)?g.map(Ai):typeof g=="object"&&g?hi(g,Ai):g}const Xi={};function Ii(g){Xi[g]||(typeof console!="undefined"&&console.warn(g),Xi[g]=!0)}function fr(g,l,b){return(b.y-g.y)*(l.x-g.x)>(l.y-g.y)*(b.x-g.x)}function sn(g){let l=0;for(let b,T,A=0,I=g.length,P=I-1;A<I;P=A++)b=g[A],T=g[P],l+=(T.x-b.x)*(b.y+T.y);return l}function pr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Br(g){const l={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(b,T,A,I)=>{const P=A||I;return l[T]=!P||P.toLowerCase(),""}),l["max-age"]){const b=parseInt(l["max-age"],10);isNaN(b)?delete l["max-age"]:l["max-age"]=b}return l}let Lr,Tr,br,Nr=null;function Sr(g){if(Nr==null){const l=g.navigator?g.navigator.userAgent:null;Nr=!!g.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Nr}function Me(g){try{const l=G[g];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}const Ge={now:()=>br!==void 0?br:G.performance.now(),setNow(g){br=g},restoreNow(){br=void 0},frame(g){const l=G.requestAnimationFrame(g);return{cancel:()=>G.cancelAnimationFrame(l)}},getImageData(g,l=0){const b=G.document.createElement("canvas"),T=b.getContext("2d");if(!T)throw new Error("failed to create canvas 2d context");return b.width=g.width,b.height=g.height,T.drawImage(g,0,0,g.width,g.height),T.getImageData(-l,-l,g.width+2*l,g.height+2*l)},resolveURL:g=>(Lr||(Lr=G.document.createElement("a")),Lr.href=g,Lr.href),get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(Tr==null&&(Tr=G.matchMedia("(prefers-reduced-motion: reduce)")),Tr.matches)}};let le;const J={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(le==null){const g=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{le={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):g}catch{le=g}}return le},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ne={supported:!1,testSupport:function(g){!Pe&&Ae&&(Ue?Ve(g):fe=g)}};let fe,Ae,Pe=!1,Ue=!1;function Ve(g){const l=g.createTexture();g.bindTexture(g.TEXTURE_2D,l);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Ae),g.isContextLost())return;ne.supported=!0}catch{}g.deleteTexture(l),Pe=!0}G.document&&(Ae=G.document.createElement("img"),Ae.onload=function(){fe&&Ve(fe),fe=null,Ue=!0},Ae.onerror=function(){Pe=!0,fe=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $e="01",Ze="NO_ACCESS_TOKEN";function Qe(g){return g.indexOf("mapbox:")===0}function et(g){return J.API_URL_REGEX.test(g)}const lt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ct(g){const l=g.match(lt);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Gt(g){const l=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${l}`}function Xt(g){if(!g)return null;const l=g.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(l[1]).split("").map(b=>"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(l){this.type=l,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const b=Xt(J.ACCESS_TOKEN);let T="";return T=b&&b.u?G.btoa(encodeURIComponent(b.u).replace(/%([0-9A-F]{2})/g,(A,I)=>String.fromCharCode(Number("0x"+I)))):J.ACCESS_TOKEN||"",l?`mapbox.eventData.${l}:${T}`:`mapbox.eventData:${T}`}fetchEventData(){const l=Me("localStorage"),b=this.getStorageKey(),T=this.getStorageKey("uuid");if(l)try{const A=G.localStorage.getItem(b);A&&(this.eventData=JSON.parse(A));const I=G.localStorage.getItem(T);I&&(this.anonId=I)}catch{Ii("Unable to read from LocalStorage")}}saveEventData(){const l=Me("localStorage"),b=this.getStorageKey(),T=this.getStorageKey("uuid");if(l)try{G.localStorage.setItem(T,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(b,JSON.stringify(this.eventData))}catch{Ii("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,b,T,A){if(!J.EVENTS_URL)return;const I=Ct(J.EVENTS_URL);I.params.push(`access_token=${A||J.ACCESS_TOKEN||""}`);const P={event:this.type,created:new Date(l).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:$e,userId:this.anonId},F=b?Kt(P,b):P,N={url:Gt(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([F])};this.pendingRequest=Mn(N,j=>{this.pendingRequest=null,T(j),this.saveEventData(),this.processRequests(A)})}queueRequest(l,b){this.queue.push(l),this.processRequests(b)}}const gi=new class extends Ht{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,l){J.EVENTS_URL&&J.ACCESS_TOKEN&&Array.isArray(g)&&g.some(b=>Qe(b)||et(b))&&this.queueRequest(Date.now(),l)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=Xt(J.ACCESS_TOKEN),b=l?l.u:J.ACCESS_TOKEN;let T=b!==this.eventData.tokenU;vi(this.anonId)||(this.anonId=kt(),T=!0);const A=this.queue.shift();if(this.eventData.lastSuccess){const I=new Date(this.eventData.lastSuccess),P=new Date(A),F=(A-this.eventData.lastSuccess)/864e5;T=T||F>=1||F<-1||I.getDate()!==P.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(A,{"enabled.telemetry":!1},I=>{I||(this.eventData.lastSuccess=A,this.eventData.tokenU=b)},g)}},Yi=gi.postTurnstileEvent.bind(gi),Ji=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,l,b,T){this.skuToken=l,this.errorCb=T,J.EVENTS_URL&&(b||J.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},b):this.errorCb(new Error(Ze)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:b}=this.queue.shift();l&&this.success[l]||(this.anonId||this.fetchEventData(),vi(this.anonId)||(this.anonId=kt()),this.postEvent(b,{skuToken:this.skuToken},T=>{T?this.errorCb(T):l&&(this.success[l]=!0)},g))}},qi=Ji.postMapLoadEvent.bind(Ji),Hi=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,l,b,T){if(!J.API_URL||!J.SESSION_PATH)return;const A=Ct(J.API_URL+J.SESSION_PATH);A.params.push(`sku=${l||""}`),A.params.push(`access_token=${T||J.ACCESS_TOKEN||""}`);const I={url:Gt(A),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ic(I,P=>{this.pendingRequest=null,b(P),this.saveEventData(),this.processRequests(T)})}getSessionAPI(g,l,b,T){this.skuToken=l,this.errorCb=T,J.SESSION_PATH&&J.API_URL&&(b||J.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},b):this.errorCb(new Error(Ze)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:b}=this.queue.shift();l&&this.success[l]||this.getSession(b,this.skuToken,T=>{T?this.errorCb(T):l&&(this.success[l]=!0)},g)}},Gn=Hi.getSessionAPI.bind(Hi),Rn=new Set,zr="mapbox-tiles";let Tn,Ps,Rl=500,Ba=50;function Ho(){G.caches&&!Tn&&(Tn=G.caches.open(zr))}function La(g){const l=g.indexOf("?");return l<0?g:g.slice(0,l)}let Rs=1/0;const Bs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Bs);class Wo extends Error{constructor(l,b,T){b===401&&et(T)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(l),this.status=b,this.url=T}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const za=pr()?()=>self.worker&&self.worker.referrer:()=>(G.location.protocol==="blob:"?G.parent:G).location.href,gn=function(g,l){if(!(/^file:/.test(b=g.url)||/^file:/.test(za())&&!/^\w+:/.test(b))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(T,A){const I=new G.AbortController,P=new G.Request(T.url,{method:T.method||"GET",body:T.body,credentials:T.credentials,headers:T.headers,referrer:za(),signal:I.signal});let F=!1,N=!1;const j=(X=P.url).indexOf("sku=")>0&&et(X);var X;T.type==="json"&&P.headers.set("Accept","application/json");const Y=(re,ue,me)=>{if(N)return;if(re&&re.message!=="SecurityError"&&Ii(re),ue&&me)return H(ue);const be=Date.now();G.fetch(P).then(Ie=>{if(Ie.ok){const Le=j?Ie.clone():null;return H(Ie,Le,be)}return A(new Wo(Ie.statusText,Ie.status,T.url))}).catch(Ie=>{Ie.code!==20&&A(new Error(Ie.message))})},H=(re,ue,me)=>{(T.type==="arrayBuffer"?re.arrayBuffer():T.type==="json"?re.json():re.text()).then(be=>{N||(ue&&me&&function(Ie,Le,Ne){if(Ho(),!Tn)return;const je={status:Le.status,statusText:Le.statusText,headers:new G.Headers};Le.headers.forEach((Ye,ot)=>je.headers.set(ot,Ye));const qe=Br(Le.headers.get("Cache-Control")||"");qe["no-store"]||(qe["max-age"]&&je.headers.set("Expires",new Date(Ne+1e3*qe["max-age"]).toUTCString()),new Date(je.headers.get("Expires")).getTime()-Ne<42e4||function(Ye,ot){if(Ps===void 0)try{new Response(new ReadableStream),Ps=!0}catch{Ps=!1}Ps?ot(Ye.body):Ye.blob().then(ot)}(Le,Ye=>{const ot=new G.Response(Ye,je);Ho(),Tn&&Tn.then(rt=>rt.put(La(Ie.url),ot)).catch(rt=>Ii(rt.message))}))}(P,ue,me),F=!0,A(null,be,re.headers.get("Cache-Control"),re.headers.get("Expires")))}).catch(be=>{N||A(new Error(be.message))})};return j?function(re,ue){if(Ho(),!Tn)return ue(null);const me=La(re.url);Tn.then(be=>{be.match(me).then(Ie=>{const Le=function(Ne){if(!Ne)return!1;const je=new Date(Ne.headers.get("Expires")||0),qe=Br(Ne.headers.get("Cache-Control")||"");return je>Date.now()&&!qe["no-cache"]}(Ie);be.delete(me),Le&&be.put(me,Ie.clone()),ue(null,Ie,Le)}).catch(ue)}).catch(ue)}(P,Y):Y(null,null),{cancel:()=>{N=!0,F||I.abort()}}}(g,l);if(pr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",g,l,void 0,!0)}var b;return function(T,A){const I=new G.XMLHttpRequest;I.open(T.method||"GET",T.url,!0),T.type==="arrayBuffer"&&(I.responseType="arraybuffer");for(const P in T.headers)I.setRequestHeader(P,T.headers[P]);return T.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=T.credentials==="include",I.onerror=()=>{A(new Error(I.statusText))},I.onload=()=>{if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let P=I.response;if(T.type==="json")try{P=JSON.parse(I.response)}catch(F){return A(F)}A(null,P,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else A(new Wo(I.statusText,I.status,T.url))},I.send(T.body),{cancel:()=>I.abort()}}(g,l)},Ko=function(g,l){return gn(Kt(g,{type:"arrayBuffer"}),l)},Mn=function(g,l){return gn(Kt(g,{method:"POST"}),l)},ic=function(g,l){return gn(Kt(g,{method:"GET"}),l)};function Bl(g){const l=G.document.createElement("a");return l.href=g,l.protocol===G.document.location.protocol&&l.host===G.document.location.host}const wo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Eo,Jo;Eo=[],Jo=0;const Ll=function(g,l){if(ne.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),Jo>=J.MAX_PARALLEL_IMAGE_REQUESTS){const I={requestParameters:g,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return Eo.push(I),I}Jo++;let b=!1;const T=()=>{if(!b)for(b=!0,Jo--;Eo.length&&Jo<J.MAX_PARALLEL_IMAGE_REQUESTS;){const I=Eo.shift(),{requestParameters:P,callback:F,cancelled:N}=I;N||(I.cancel=Ll(P,F).cancel)}},A=Ko(g,(I,P,F,N)=>{T(),I?l(I):P&&(G.createImageBitmap?function(j,X){const Y=new G.Blob([new Uint8Array(j)],{type:"image/png"});G.createImageBitmap(Y).then(H=>{X(null,H)}).catch(H=>{X(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(P,(j,X)=>l(j,X,F,N)):function(j,X){const Y=new G.Image,H=G.URL;Y.onload=()=>{X(null,Y),H.revokeObjectURL(Y.src),Y.onload=null,G.requestAnimationFrame(()=>{Y.src=wo})},Y.onerror=()=>X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const re=new G.Blob([new Uint8Array(j)],{type:"image/png"});Y.src=j.byteLength?H.createObjectURL(re):wo}(P,(j,X)=>l(j,X,F,N)))});return{cancel:()=>{A.cancel(),T()}}};function zl(g,l,b){b[g]&&b[g].indexOf(l)!==-1||(b[g]=b[g]||[],b[g].push(l))}function Ls(g,l,b){if(b&&b[g]){const T=b[g].indexOf(l);T!==-1&&b[g].splice(T,1)}}class qn{constructor(l,b={}){Kt(this,b),this.type=l}}class zs extends qn{constructor(l,b={}){super("error",Kt({error:l},b))}}class Zn{on(l,b){return this._listeners=this._listeners||{},zl(l,b,this._listeners),this}off(l,b){return Ls(l,b,this._listeners),Ls(l,b,this._oneTimeListeners),this}once(l,b){return b?(this._oneTimeListeners=this._oneTimeListeners||{},zl(l,b,this._oneTimeListeners),this):new Promise(T=>this.once(l,T))}fire(l,b){typeof l=="string"&&(l=new qn(l,b||{}));const T=l.type;if(this.listens(T)){l.target=this;const A=this._listeners&&this._listeners[T]?this._listeners[T].slice():[];for(const F of A)F.call(this,l);const I=this._oneTimeListeners&&this._oneTimeListeners[T]?this._oneTimeListeners[T].slice():[];for(const F of I)Ls(T,F,this._oneTimeListeners),F.call(this,l);const P=this._eventedParent;P&&(Kt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(l))}else l instanceof zs&&console.error(l.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,b){return this._eventedParent=l,this._eventedParentData=b,this}}var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Pt{constructor(l,b,T,A){this.message=(l?`${l}: `:"")+T,A&&(this.identifier=A),b!=null&&b.__line__&&(this.line=b.__line__)}}function Fl(g){const l=g.value;return l?[new Pt(g.key,l,"constants have been deprecated as of v8")]:[]}function Xn(g,...l){for(const b of l)for(const T in b)g[T]=b[T];return g}function ur(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function Bn(g){if(Array.isArray(g))return g.map(Bn);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const l={};for(const b in g)l[b]=Bn(g[b]);return l}return ur(g)}class Sn extends Error{constructor(l,b){super(b),this.message=b,this.key=l}}class Fs{constructor(l,b=[]){this.parent=l,this.bindings={};for(const[T,A]of b)this.bindings[T]=A}concat(l){return new Fs(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Yn={kind:"null"},Dt={kind:"number"},ki={kind:"string"},wi={kind:"boolean"},An={kind:"color"},To={kind:"object"},Ei={kind:"value"},Qo={kind:"collator"},Hn={kind:"formatted"},es={kind:"resolvedImage"};function an(g,l){return{kind:"array",itemType:g,N:l}}function ar(g){if(g.kind==="array"){const l=ar(g.itemType);return typeof g.N=="number"?`array<${l}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${l}>`}return g.kind}const rc=[Yn,Dt,ki,wi,An,Hn,To,an(Ei),es];function Xr(g,l){if(l.kind==="error")return null;if(g.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Xr(g.itemType,l.itemType))&&(typeof g.N!="number"||g.N===l.N))return null}else{if(g.kind===l.kind)return null;if(g.kind==="value"){for(const b of rc)if(!Xr(b,l))return null}}return`Expected ${ar(g)} but found ${ar(l)} instead.`}function Os(g,l){return l.some(b=>b.kind===g.kind)}function Mo(g,l){return l.some(b=>b==="null"?g===null:b==="array"?Array.isArray(g):b==="object"?g&&!Array.isArray(g)&&typeof g=="object":b===typeof g)}function So(g){var l={exports:{}};return g(l,l.exports),l.exports}var Ao=So(function(g,l){var b={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function T(F){return(F=Math.round(F))<0?0:F>255?255:F}function A(F){return T(F[F.length-1]==="%"?parseFloat(F)/100*255:parseInt(F))}function I(F){return(N=F[F.length-1]==="%"?parseFloat(F)/100:parseFloat(F))<0?0:N>1?1:N;var N}function P(F,N,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?F+(N-F)*j*6:2*j<1?N:3*j<2?F+(N-F)*(2/3-j)*6:F}try{l.parseCSSColor=function(F){var N,j=F.replace(/ /g,"").toLowerCase();if(j in b)return b[j].slice();if(j[0]==="#")return j.length===4?(N=parseInt(j.substr(1),16))>=0&&N<=4095?[(3840&N)>>4|(3840&N)>>8,240&N|(240&N)>>4,15&N|(15&N)<<4,1]:null:j.length===7&&(N=parseInt(j.substr(1),16))>=0&&N<=16777215?[(16711680&N)>>16,(65280&N)>>8,255&N,1]:null;var X=j.indexOf("("),Y=j.indexOf(")");if(X!==-1&&Y+1===j.length){var H=j.substr(0,X),re=j.substr(X+1,Y-(X+1)).split(","),ue=1;switch(H){case"rgba":if(re.length!==4)return null;ue=I(re.pop());case"rgb":return re.length!==3?null:[A(re[0]),A(re[1]),A(re[2]),ue];case"hsla":if(re.length!==4)return null;ue=I(re.pop());case"hsl":if(re.length!==3)return null;var me=(parseFloat(re[0])%360+360)%360/360,be=I(re[1]),Ie=I(re[2]),Le=Ie<=.5?Ie*(be+1):Ie+be-Ie*be,Ne=2*Ie-Le;return[T(255*P(Ne,Le,me+1/3)),T(255*P(Ne,Le,me)),T(255*P(Ne,Le,me-1/3)),ue];default:return null}}return null}}catch{}});class Oi{constructor(l,b,T,A=1){this.r=l,this.g=b,this.b=T,this.a=A}static parse(l){if(!l)return;if(l instanceof Oi)return l;if(typeof l!="string")return;const b=Ao.parseCSSColor(l);return b?new Oi(b[0]/255*b[3],b[1]/255*b[3],b[2]/255*b[3],b[3]):void 0}toString(){const[l,b,T,A]=this.toArray();return`rgba(${Math.round(l)},${Math.round(b)},${Math.round(T)},${A})`}toArray(){const{r:l,g:b,b:T,a:A}=this;return A===0?[0,0,0,0]:[255*l/A,255*b/A,255*T/A,A]}}Oi.black=new Oi(0,0,0,1),Oi.white=new Oi(1,1,1,1),Oi.transparent=new Oi(0,0,0,0),Oi.red=new Oi(1,0,0,1),Oi.blue=new Oi(0,0,1,1);class $s{constructor(l,b,T){this.sensitivity=l?b?"variant":"case":b?"accent":"base",this.locale=T,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,b){return this.collator.compare(l,b)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fa{constructor(l,b,T,A,I){this.text=l.normalize?l.normalize():l,this.image=b,this.scale=T,this.fontStack=A,this.textColor=I}}class _i{constructor(l){this.sections=l}static fromString(l){return new _i([new Fa(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof _i?l:_i.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const b of this.sections){if(b.image){l.push(["image",b.image.name]);continue}l.push(b.text);const T={};b.fontStack&&(T["text-font"]=["literal",b.fontStack.split(",")]),b.scale&&(T["font-scale"]=b.scale),b.textColor&&(T["text-color"]=["rgba"].concat(b.textColor.toArray())),l.push(T)}return l}}class ln{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new ln({name:l,available:!1}):null}serialize(){return["image",this.name]}}function Ol(g,l,b,T){return typeof g=="number"&&g>=0&&g<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof b=="number"&&b>=0&&b<=255?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid rgba value [${[g,l,b,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof T=="number"?[g,l,b,T]:[g,l,b]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof Oi||g instanceof $s||g instanceof _i||g instanceof ln)return!0;if(Array.isArray(g)){for(const l of g)if(!Ns(l))return!1;return!0}if(typeof g=="object"){for(const l in g)if(!Ns(g[l]))return!1;return!0}return!1}function mr(g){if(g===null)return Yn;if(typeof g=="string")return ki;if(typeof g=="boolean")return wi;if(typeof g=="number")return Dt;if(g instanceof Oi)return An;if(g instanceof $s)return Qo;if(g instanceof _i)return Hn;if(g instanceof ln)return es;if(Array.isArray(g)){const l=g.length;let b;for(const T of g){const A=mr(T);if(b){if(b===A)continue;b=Ei;break}b=A}return an(b||Ei,l)}return To}function ts(g){const l=typeof g;return g===null?"":l==="string"||l==="number"||l==="boolean"?String(g):g instanceof Oi||g instanceof _i||g instanceof ln?g.toString():JSON.stringify(g)}class Wn{constructor(l,b){this.type=l,this.value=b}static parse(l,b){if(l.length!==2)return b.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Ns(l[1]))return b.error("invalid value");const T=l[1];let A=mr(T);const I=b.expectedType;return A.kind!=="array"||A.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(A=I),new Wn(A,T)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Oi?["rgba"].concat(this.value.toArray()):this.value instanceof _i?this.value.serialize():this.value}}class Ar{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Us={string:ki,number:Dt,boolean:wi,object:To};class hn{constructor(l,b){this.type=l,this.args=b}static parse(l,b){if(l.length<2)return b.error("Expected at least one argument.");let T,A=1;const I=l[0];if(I==="array"){let F,N;if(l.length>2){const j=l[1];if(typeof j!="string"||!(j in Us)||j==="object")return b.error('The item type argument of "array" must be one of string, number, boolean',1);F=Us[j],A++}else F=Ei;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return b.error('The length argument to "array" must be a positive integer literal',2);N=l[2],A++}T=an(F,N)}else T=Us[I];const P=[];for(;A<l.length;A++){const F=b.parse(l[A],A,Ei);if(!F)return null;P.push(F)}return new hn(T,P)}evaluate(l){for(let b=0;b<this.args.length;b++){const T=this.args[b].evaluate(l);if(!Xr(this.type,mr(T)))return T;if(b===this.args.length-1)throw new Ar(`Expected value to be of type ${ar(this.type)}, but found ${ar(mr(T))} instead.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,b=[l.kind];if(l.kind==="array"){const T=l.itemType;if(T.kind==="string"||T.kind==="number"||T.kind==="boolean"){b.push(T.kind);const A=l.N;(typeof A=="number"||this.args.length>1)&&b.push(A)}}return b.concat(this.args.map(T=>T.serialize()))}}class In{constructor(l){this.type=Hn,this.sections=l}static parse(l,b){if(l.length<2)return b.error("Expected at least one argument.");const T=l[1];if(!Array.isArray(T)&&typeof T=="object")return b.error("First argument must be an image or text section.");const A=[];let I=!1;for(let P=1;P<=l.length-1;++P){const F=l[P];if(I&&typeof F=="object"&&!Array.isArray(F)){I=!1;let N=null;if(F["font-scale"]&&(N=b.parse(F["font-scale"],1,Dt),!N))return null;let j=null;if(F["text-font"]&&(j=b.parse(F["text-font"],1,an(ki)),!j))return null;let X=null;if(F["text-color"]&&(X=b.parse(F["text-color"],1,An),!X))return null;const Y=A[A.length-1];Y.scale=N,Y.font=j,Y.textColor=X}else{const N=b.parse(l[P],1,Ei);if(!N)return null;const j=N.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return b.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,A.push({content:N,scale:null,font:null,textColor:null})}}return new In(A)}evaluate(l){return new _i(this.sections.map(b=>{const T=b.content.evaluate(l);return mr(T)===es?new Fa("",T,null,null,null):new Fa(ts(T),null,b.scale?b.scale.evaluate(l):null,b.font?b.font.evaluate(l).join(","):null,b.textColor?b.textColor.evaluate(l):null)}))}eachChild(l){for(const b of this.sections)l(b.content),b.scale&&l(b.scale),b.font&&l(b.font),b.textColor&&l(b.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const b of this.sections){l.push(b.content.serialize());const T={};b.scale&&(T["font-scale"]=b.scale.serialize()),b.font&&(T["text-font"]=b.font.serialize()),b.textColor&&(T["text-color"]=b.textColor.serialize()),l.push(T)}return l}}class ho{constructor(l){this.type=es,this.input=l}static parse(l,b){if(l.length!==2)return b.error("Expected two arguments.");const T=b.parse(l[1],1,ki);return T?new ho(T):b.error("No image name provided.")}evaluate(l){const b=this.input.evaluate(l),T=ln.fromString(b);return T&&l.availableImages&&(T.available=l.availableImages.indexOf(b)>-1),T}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const nc={"to-boolean":wi,"to-color":An,"to-number":Dt,"to-string":ki};class kn{constructor(l,b){this.type=l,this.args=b}static parse(l,b){if(l.length<2)return b.error("Expected at least one argument.");const T=l[0];if((T==="to-boolean"||T==="to-string")&&l.length!==2)return b.error("Expected one argument.");const A=nc[T],I=[];for(let P=1;P<l.length;P++){const F=b.parse(l[P],P,Ei);if(!F)return null;I.push(F)}return new kn(A,I)}evaluate(l){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(l));if(this.type.kind==="color"){let b,T;for(const A of this.args){if(b=A.evaluate(l),T=null,b instanceof Oi)return b;if(typeof b=="string"){const I=l.parseColor(b);if(I)return I}else if(Array.isArray(b)&&(T=b.length<3||b.length>4?`Invalid rbga value ${JSON.stringify(b)}: expected an array containing either three or four numeric values.`:Ol(b[0],b[1],b[2],b[3]),!T))return new Oi(b[0]/255,b[1]/255,b[2]/255,b[3])}throw new Ar(T||`Could not parse color from value '${typeof b=="string"?b:String(JSON.stringify(b))}'`)}if(this.type.kind==="number"){let b=null;for(const T of this.args){if(b=T.evaluate(l),b===null)return 0;const A=Number(b);if(!isNaN(A))return A}throw new Ar(`Could not convert ${JSON.stringify(b)} to number.`)}return this.type.kind==="formatted"?_i.fromString(ts(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?ln.fromString(ts(this.args[0].evaluate(l))):ts(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new In([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ho(this.args[0]).serialize();const l=[`to-${this.type.kind}`];return this.eachChild(b=>{l.push(b.serialize())}),l}}const $l=["Unknown","Point","LineString","Polygon"];class Nl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$l[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,b=this.featureDistanceData.scale,{x:T,y:A}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(T*b-l[0])+this.featureDistanceData.bearing[1]*(A*b-l[1])}return 0}parseColor(l){let b=this._parseColorCache[l];return b||(b=this._parseColorCache[l]=Oi.parse(l)),b}}class Qr{constructor(l,b,T,A){this.name=l,this.type=b,this._evaluate=T,this.args=A}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,b){const T=l[0],A=Qr.definitions[T];if(!A)return b.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0);const I=Array.isArray(A)?A[0]:A.type,P=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,F=P.filter(([j])=>!Array.isArray(j)||j.length===l.length-1);let N=null;for(const[j,X]of F){N=new Gs(b.registry,b.path,null,b.scope);const Y=[];let H=!1;for(let re=1;re<l.length;re++){const ue=l[re],me=Array.isArray(j)?j[re-1]:j.type,be=N.parse(ue,1+Y.length,me);if(!be){H=!0;break}Y.push(be)}if(!H)if(Array.isArray(j)&&j.length!==Y.length)N.error(`Expected ${j.length} arguments, but found ${Y.length} instead.`);else{for(let re=0;re<Y.length;re++){const ue=Array.isArray(j)?j[re]:j.type,me=Y[re];N.concat(re+1).checkSubtype(ue,me.type)}if(N.errors.length===0)return new Qr(T,I,X,Y)}}if(F.length===1)b.errors.push(...N.errors);else{const j=(F.length?F:P).map(([Y])=>{return H=Y,Array.isArray(H)?`(${H.map(ar).join(", ")})`:`(${ar(H.type)}...)`;var H}).join(" | "),X=[];for(let Y=1;Y<l.length;Y++){const H=b.parse(l[Y],1+X.length);if(!H)return null;X.push(ar(H.type))}b.error(`Expected arguments of type ${j}, but found (${X.join(", ")}) instead.`)}return null}static register(l,b){Qr.definitions=b;for(const T in b)l[T]=Qr}}class is{constructor(l,b,T){this.type=Qo,this.locale=T,this.caseSensitive=l,this.diacriticSensitive=b}static parse(l,b){if(l.length!==2)return b.error("Expected one argument.");const T=l[1];if(typeof T!="object"||Array.isArray(T))return b.error("Collator options argument must be an object.");const A=b.parse(T["case-sensitive"]!==void 0&&T["case-sensitive"],1,wi);if(!A)return null;const I=b.parse(T["diacritic-sensitive"]!==void 0&&T["diacritic-sensitive"],1,wi);if(!I)return null;let P=null;return T.locale&&(P=b.parse(T.locale,1,ki),!P)?null:new is(A,I,P)}evaluate(l){return new $s(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}const Kn=8192;function Vs(g,l){g[0]=Math.min(g[0],l[0]),g[1]=Math.min(g[1],l[1]),g[2]=Math.max(g[2],l[0]),g[3]=Math.max(g[3],l[1])}function rs(g,l){return!(g[0]<=l[0]||g[2]>=l[2]||g[1]<=l[1]||g[3]>=l[3])}function Ul(g,l){const b=(180+g[0])/360,T=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,A=Math.pow(2,l.z);return[Math.round(b*A*Kn),Math.round(T*A*Kn)]}function Vl(g,l,b){const T=g[0]-l[0],A=g[1]-l[1],I=g[0]-b[0],P=g[1]-b[1];return T*P-I*A==0&&T*I<=0&&A*P<=0}function Oa(g,l){let b=!1;for(let P=0,F=l.length;P<F;P++){const N=l[P];for(let j=0,X=N.length;j<X-1;j++){if(Vl(g,N[j],N[j+1]))return!1;(A=N[j])[1]>(T=g)[1]!=(I=N[j+1])[1]>T[1]&&T[0]<(I[0]-A[0])*(T[1]-A[1])/(I[1]-A[1])+A[0]&&(b=!b)}}var T,A,I;return b}function jl(g,l){for(let b=0;b<l.length;b++)if(Oa(g,l[b]))return!0;return!1}function $a(g,l,b,T){const A=T[0]-b[0],I=T[1]-b[1],P=(g[0]-b[0])*I-A*(g[1]-b[1]),F=(l[0]-b[0])*I-A*(l[1]-b[1]);return P>0&&F<0||P<0&&F>0}function oc(g,l,b){for(const j of b)for(let X=0;X<j.length-1;++X)if((F=[(P=j[X+1])[0]-(I=j[X])[0],P[1]-I[1]])[0]*(N=[(A=l)[0]-(T=g)[0],A[1]-T[1]])[1]-F[1]*N[0]!=0&&$a(T,A,I,P)&&$a(I,P,T,A))return!0;var T,A,I,P,F,N;return!1}function Gl(g,l){for(let b=0;b<g.length;++b)if(!Oa(g[b],l))return!1;for(let b=0;b<g.length-1;++b)if(oc(g[b],g[b+1],l))return!1;return!0}function sc(g,l){for(let b=0;b<l.length;b++)if(Gl(g,l[b]))return!0;return!1}function Na(g,l,b){const T=[];for(let A=0;A<g.length;A++){const I=[];for(let P=0;P<g[A].length;P++){const F=Ul(g[A][P],b);Vs(l,F),I.push(F)}T.push(I)}return T}function ql(g,l,b){const T=[];for(let A=0;A<g.length;A++){const I=Na(g[A],l,b);T.push(I)}return T}function Ua(g,l,b,T){if(g[0]<b[0]||g[0]>b[2]){const A=.5*T;let I=g[0]-b[0]>A?-T:b[0]-g[0]>A?T:0;I===0&&(I=g[0]-b[2]>A?-T:b[2]-g[0]>A?T:0),g[0]+=I}Vs(l,g)}function Zl(g,l,b,T){const A=Math.pow(2,T.z)*Kn,I=[T.x*Kn,T.y*Kn],P=[];for(const F of g)for(const N of F){const j=[N.x+I[0],N.y+I[1]];Ua(j,l,b,A),P.push(j)}return P}function Xl(g,l,b,T){const A=Math.pow(2,T.z)*Kn,I=[T.x*Kn,T.y*Kn],P=[];for(const N of g){const j=[];for(const X of N){const Y=[X.x+I[0],X.y+I[1]];Vs(l,Y),j.push(Y)}P.push(j)}if(l[2]-l[0]<=A/2){(F=l)[0]=F[1]=1/0,F[2]=F[3]=-1/0;for(const N of P)for(const j of N)Ua(j,l,b,A)}var F;return P}class co{constructor(l,b){this.type=wi,this.geojson=l,this.geometries=b}static parse(l,b){if(l.length!==2)return b.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Ns(l[1])){const T=l[1];if(T.type==="FeatureCollection")for(let A=0;A<T.features.length;++A){const I=T.features[A].geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new co(T,T.features[A].geometry)}else if(T.type==="Feature"){const A=T.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new co(T,T.geometry)}else if(T.type==="Polygon"||T.type==="MultiPolygon")return new co(T,T)}return b.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(b,T){const A=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=b.canonicalID();if(T.type==="Polygon"){const F=Na(T.coordinates,I,P),N=Zl(b.geometry(),A,I,P);if(!rs(A,I))return!1;for(const j of N)if(!Oa(j,F))return!1}if(T.type==="MultiPolygon"){const F=ql(T.coordinates,I,P),N=Zl(b.geometry(),A,I,P);if(!rs(A,I))return!1;for(const j of N)if(!jl(j,F))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(b,T){const A=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=b.canonicalID();if(T.type==="Polygon"){const F=Na(T.coordinates,I,P),N=Xl(b.geometry(),A,I,P);if(!rs(A,I))return!1;for(const j of N)if(!Gl(j,F))return!1}if(T.type==="MultiPolygon"){const F=ql(T.coordinates,I,P),N=Xl(b.geometry(),A,I,P);if(!rs(A,I))return!1;for(const j of N)if(!sc(j,F))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Io(g){if(g instanceof Qr&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof co)return!1;let l=!0;return g.eachChild(b=>{l&&!Io(b)&&(l=!1)}),l}function ns(g){if(g instanceof Qr&&g.name==="feature-state")return!1;let l=!0;return g.eachChild(b=>{l&&!ns(b)&&(l=!1)}),l}function os(g,l){if(g instanceof Qr&&l.indexOf(g.name)>=0)return!1;let b=!0;return g.eachChild(T=>{b&&!os(T,l)&&(b=!1)}),b}class js{constructor(l,b){this.type=b.type,this.name=l,this.boundExpression=b}static parse(l,b){if(l.length!==2||typeof l[1]!="string")return b.error("'var' expression requires exactly one string literal argument.");const T=l[1];return b.scope.has(T)?new js(T,b.scope.get(T)):b.error(`Unknown variable "${T}". Make sure "${T}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Gs{constructor(l,b=[],T,A=new Fs,I=[]){this.registry=l,this.path=b,this.key=b.map(P=>`[${P}]`).join(""),this.scope=A,this.errors=I,this.expectedType=T}parse(l,b,T,A,I={}){return b?this.concat(b,T,A)._parse(l,I):this._parse(l,I)}_parse(l,b){function T(A,I,P){return P==="assert"?new hn(I,[A]):P==="coerce"?new kn(I,[A]):A}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=l[0];if(typeof A!="string")return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const I=this.registry[A];if(I){let P=I.parse(l,this);if(!P)return null;if(this.expectedType){const F=this.expectedType,N=P.type;if(F.kind!=="string"&&F.kind!=="number"&&F.kind!=="boolean"&&F.kind!=="object"&&F.kind!=="array"||N.kind!=="value")if(F.kind!=="color"&&F.kind!=="formatted"&&F.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(F,N))return null}else P=T(P,F,b.typeAnnotation||"coerce");else P=T(P,F,b.typeAnnotation||"assert")}if(!(P instanceof Wn)&&P.type.kind!=="resolvedImage"&&qs(P)){const F=new Nl;try{P=new Wn(P.type,P.evaluate(F))}catch(N){return this.error(N.message),null}}return P}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,b,T){const A=typeof l=="number"?this.path.concat(l):this.path,I=T?this.scope.concat(T):this.scope;return new Gs(this.registry,A,b||null,I,this.errors)}error(l,...b){const T=`${this.key}${b.map(A=>`[${A}]`).join("")}`;this.errors.push(new Sn(T,l))}checkSubtype(l,b){const T=Xr(l,b);return T&&this.error(T),T}}function qs(g){if(g instanceof js)return qs(g.boundExpression);if(g instanceof Qr&&g.name==="error"||g instanceof is||g instanceof co)return!1;const l=g instanceof kn||g instanceof hn;let b=!0;return g.eachChild(T=>{b=l?b&&qs(T):b&&T instanceof Wn}),!!b&&Io(g)&&os(g,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ss(g,l){const b=g.length-1;let T,A,I=0,P=b,F=0;for(;I<=P;)if(F=Math.floor((I+P)/2),T=g[F],A=g[F+1],T<=l){if(F===b||l<A)return F;I=F+1}else{if(!(T>l))throw new Ar("Input is not a number.");P=F-1}return 0}class as{constructor(l,b,T){this.type=l,this.input=b,this.labels=[],this.outputs=[];for(const[A,I]of T)this.labels.push(A),this.outputs.push(I)}static parse(l,b){if(l.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return b.error("Expected an even number of arguments.");const T=b.parse(l[1],1,Dt);if(!T)return null;const A=[];let I=null;b.expectedType&&b.expectedType.kind!=="value"&&(I=b.expectedType);for(let P=1;P<l.length;P+=2){const F=P===1?-1/0:l[P],N=l[P+1],j=P,X=P+1;if(typeof F!="number")return b.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(A.length&&A[A.length-1][0]>=F)return b.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const Y=b.parse(N,X,I);if(!Y)return null;I=I||Y.type,A.push([F,Y])}return new as(I,T,A)}evaluate(l){const b=this.labels,T=this.outputs;if(b.length===1)return T[0].evaluate(l);const A=this.input.evaluate(l);if(A<=b[0])return T[0].evaluate(l);const I=b.length;return A>=b[I-1]?T[I-1].evaluate(l):T[ss(b,A)].evaluate(l)}eachChild(l){l(this.input);for(const b of this.outputs)l(b)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let b=0;b<this.labels.length;b++)b>0&&l.push(this.labels[b]),l.push(this.outputs[b].serialize());return l}}function Gi(g,l,b){return g*(1-b)+l*b}var Zs=Object.freeze({__proto__:null,number:Gi,color:function(g,l,b){return new Oi(Gi(g.r,l.r,b),Gi(g.g,l.g,b),Gi(g.b,l.b,b),Gi(g.a,l.a,b))},array:function(g,l,b){return g.map((T,A)=>Gi(T,l[A],b))}});const Yl=.95047,ls=1.08883,Va=4/29,Xs=6/29,Hl=3*Xs*Xs,ac=Math.PI/180,lc=180/Math.PI;function Ys(g){return g>.008856451679035631?Math.pow(g,1/3):g/Hl+Va}function Hs(g){return g>Xs?g*g*g:Hl*(g-Va)}function Ws(g){return 255*(g<=.0031308?12.92*g:1.055*Math.pow(g,1/2.4)-.055)}function hs(g){return(g/=255)<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function Wl(g){const l=hs(g.r),b=hs(g.g),T=hs(g.b),A=Ys((.4124564*l+.3575761*b+.1804375*T)/Yl),I=Ys((.2126729*l+.7151522*b+.072175*T)/1);return{l:116*I-16,a:500*(A-I),b:200*(I-Ys((.0193339*l+.119192*b+.9503041*T)/ls)),alpha:g.a}}function Kl(g){let l=(g.l+16)/116,b=isNaN(g.a)?l:l+g.a/500,T=isNaN(g.b)?l:l-g.b/200;return l=1*Hs(l),b=Yl*Hs(b),T=ls*Hs(T),new Oi(Ws(3.2404542*b-1.5371385*l-.4985314*T),Ws(-.969266*b+1.8760108*l+.041556*T),Ws(.0556434*b-.2040259*l+1.0572252*T),g.alpha)}function hc(g,l,b){const T=l-g;return g+b*(T>180||T<-180?T-360*Math.round(T/360):T)}const cs={forward:Wl,reverse:Kl,interpolate:function(g,l,b){return{l:Gi(g.l,l.l,b),a:Gi(g.a,l.a,b),b:Gi(g.b,l.b,b),alpha:Gi(g.alpha,l.alpha,b)}}},us={forward:function(g){const{l,a:b,b:T}=Wl(g),A=Math.atan2(T,b)*lc;return{h:A<0?A+360:A,c:Math.sqrt(b*b+T*T),l,alpha:g.a}},reverse:function(g){const l=g.h*ac,b=g.c;return Kl({l:g.l,a:Math.cos(l)*b,b:Math.sin(l)*b,alpha:g.alpha})},interpolate:function(g,l,b){return{h:hc(g.h,l.h,b),c:Gi(g.c,l.c,b),l:Gi(g.l,l.l,b),alpha:Gi(g.alpha,l.alpha,b)}}};var Jl=Object.freeze({__proto__:null,lab:cs,hcl:us});class Yr{constructor(l,b,T,A,I){this.type=l,this.operator=b,this.interpolation=T,this.input=A,this.labels=[],this.outputs=[];for(const[P,F]of I)this.labels.push(P),this.outputs.push(F)}static interpolationFactor(l,b,T,A){let I=0;if(l.name==="exponential")I=Ks(b,l.base,T,A);else if(l.name==="linear")I=Ks(b,1,T,A);else if(l.name==="cubic-bezier"){const P=l.controlPoints;I=new B(P[0],P[1],P[2],P[3]).solve(Ks(b,1,T,A))}return I}static parse(l,b){let[T,A,I,...P]=l;if(!Array.isArray(A)||A.length===0)return b.error("Expected an interpolation type expression.",1);if(A[0]==="linear")A={name:"linear"};else if(A[0]==="exponential"){const j=A[1];if(typeof j!="number")return b.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:j}}else{if(A[0]!=="cubic-bezier")return b.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const j=A.slice(1);if(j.length!==4||j.some(X=>typeof X!="number"||X<0||X>1))return b.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:j}}}if(l.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return b.error("Expected an even number of arguments.");if(I=b.parse(I,2,Dt),!I)return null;const F=[];let N=null;T==="interpolate-hcl"||T==="interpolate-lab"?N=An:b.expectedType&&b.expectedType.kind!=="value"&&(N=b.expectedType);for(let j=0;j<P.length;j+=2){const X=P[j],Y=P[j+1],H=j+3,re=j+4;if(typeof X!="number")return b.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(F.length&&F[F.length-1][0]>=X)return b.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const ue=b.parse(Y,re,N);if(!ue)return null;N=N||ue.type,F.push([X,ue])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new Yr(N,T,A,I,F):b.error(`Type ${ar(N)} is not interpolatable.`)}evaluate(l){const b=this.labels,T=this.outputs;if(b.length===1)return T[0].evaluate(l);const A=this.input.evaluate(l);if(A<=b[0])return T[0].evaluate(l);const I=b.length;if(A>=b[I-1])return T[I-1].evaluate(l);const P=ss(b,A),F=Yr.interpolationFactor(this.interpolation,A,b[P],b[P+1]),N=T[P].evaluate(l),j=T[P+1].evaluate(l);return this.operator==="interpolate"?Zs[this.type.kind.toLowerCase()](N,j,F):this.operator==="interpolate-hcl"?us.reverse(us.interpolate(us.forward(N),us.forward(j),F)):cs.reverse(cs.interpolate(cs.forward(N),cs.forward(j),F))}eachChild(l){l(this.input);for(const b of this.outputs)l(b)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const b=[this.operator,l,this.input.serialize()];for(let T=0;T<this.labels.length;T++)b.push(this.labels[T],this.outputs[T].serialize());return b}}function Ks(g,l,b,T){const A=T-b,I=g-b;return A===0?0:l===1?I/A:(Math.pow(l,I)-1)/(Math.pow(l,A)-1)}class uo{constructor(l,b){this.type=l,this.args=b}static parse(l,b){if(l.length<2)return b.error("Expectected at least one argument.");let T=null;const A=b.expectedType;A&&A.kind!=="value"&&(T=A);const I=[];for(const F of l.slice(1)){const N=b.parse(F,1+I.length,T,void 0,{typeAnnotation:"omit"});if(!N)return null;T=T||N.type,I.push(N)}const P=A&&I.some(F=>Xr(A,F.type));return new uo(P?Ei:T,I)}evaluate(l){let b,T=null,A=0;for(const I of this.args){if(A++,T=I.evaluate(l),T&&T instanceof ln&&!T.available&&(b||(b=T),T=null,A===this.args.length))return b;if(T!==null)break}return T}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(b=>{l.push(b.serialize())}),l}}class Js{constructor(l,b){this.type=b.type,this.bindings=[].concat(l),this.result=b}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const b of this.bindings)l(b[1]);l(this.result)}static parse(l,b){if(l.length<4)return b.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const T=[];for(let I=1;I<l.length-1;I+=2){const P=l[I];if(typeof P!="string")return b.error(`Expected string, but found ${typeof P} instead.`,I);if(/[^a-zA-Z0-9_]/.test(P))return b.error("Variable names must contain only alphanumeric characters or '_'.",I);const F=b.parse(l[I+1],I+1);if(!F)return null;T.push([P,F])}const A=b.parse(l[l.length-1],l.length-1,b.expectedType,T);return A?new Js(T,A):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[b,T]of this.bindings)l.push(b,T.serialize());return l.push(this.result.serialize()),l}}class ja{constructor(l,b,T){this.type=l,this.index=b,this.input=T}static parse(l,b){if(l.length!==3)return b.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=b.parse(l[1],1,Dt),A=b.parse(l[2],2,an(b.expectedType||Ei));return T&&A?new ja(A.type.itemType,T,A):null}evaluate(l){const b=this.index.evaluate(l),T=this.input.evaluate(l);if(b<0)throw new Ar(`Array index out of bounds: ${b} < 0.`);if(b>=T.length)throw new Ar(`Array index out of bounds: ${b} > ${T.length-1}.`);if(b!==Math.floor(b))throw new Ar(`Array index must be an integer, but found ${b} instead.`);return T[b]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ga{constructor(l,b){this.type=wi,this.needle=l,this.haystack=b}static parse(l,b){if(l.length!==3)return b.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=b.parse(l[1],1,Ei),A=b.parse(l[2],2,Ei);return T&&A?Os(T.type,[wi,ki,Dt,Yn,Ei])?new Ga(T,A):b.error(`Expected first argument to be of type boolean, string, number or null, but found ${ar(T.type)} instead`):null}evaluate(l){const b=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!T)return!1;if(!Mo(b,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${ar(mr(b))} instead.`);if(!Mo(T,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${ar(mr(T))} instead.`);return T.indexOf(b)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class _n{constructor(l,b,T){this.type=Dt,this.needle=l,this.haystack=b,this.fromIndex=T}static parse(l,b){if(l.length<=2||l.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=b.parse(l[1],1,Ei),A=b.parse(l[2],2,Ei);if(!T||!A)return null;if(!Os(T.type,[wi,ki,Dt,Yn,Ei]))return b.error(`Expected first argument to be of type boolean, string, number or null, but found ${ar(T.type)} instead`);if(l.length===4){const I=b.parse(l[3],3,Dt);return I?new _n(T,A,I):null}return new _n(T,A)}evaluate(l){const b=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!Mo(b,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${ar(mr(b))} instead.`);if(!Mo(T,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${ar(mr(T))} instead.`);if(this.fromIndex){const A=this.fromIndex.evaluate(l);return T.indexOf(b,A)}return T.indexOf(b)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qs{constructor(l,b,T,A,I,P){this.inputType=l,this.type=b,this.input=T,this.cases=A,this.outputs=I,this.otherwise=P}static parse(l,b){if(l.length<5)return b.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return b.error("Expected an even number of arguments.");let T,A;b.expectedType&&b.expectedType.kind!=="value"&&(A=b.expectedType);const I={},P=[];for(let j=2;j<l.length-1;j+=2){let X=l[j];const Y=l[j+1];Array.isArray(X)||(X=[X]);const H=b.concat(j);if(X.length===0)return H.error("Expected at least one branch label.");for(const ue of X){if(typeof ue!="number"&&typeof ue!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return H.error("Numeric branch labels must be integer values.");if(T){if(H.checkSubtype(T,mr(ue)))return null}else T=mr(ue);if(I[String(ue)]!==void 0)return H.error("Branch labels must be unique.");I[String(ue)]=P.length}const re=b.parse(Y,j,A);if(!re)return null;A=A||re.type,P.push(re)}const F=b.parse(l[1],1,Ei);if(!F)return null;const N=b.parse(l[l.length-1],l.length-1,A);return N?F.type.kind!=="value"&&b.concat(1).checkSubtype(T,F.type)?null:new Qs(T,A,F,I,P,N):null}evaluate(l){const b=this.input.evaluate(l);return(mr(b)===this.inputType&&this.outputs[this.cases[b]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],b=Object.keys(this.cases).sort(),T=[],A={};for(const P of b){const F=A[this.cases[P]];F===void 0?(A[this.cases[P]]=T.length,T.push([this.cases[P],[P]])):T[F][1].push(P)}const I=P=>this.inputType.kind==="number"?Number(P):P;for(const[P,F]of T)l.push(F.length===1?I(F[0]):F.map(I)),l.push(this.outputs[P].serialize());return l.push(this.otherwise.serialize()),l}}class Jn{constructor(l,b,T){this.type=l,this.branches=b,this.otherwise=T}static parse(l,b){if(l.length<4)return b.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return b.error("Expected an odd number of arguments.");let T;b.expectedType&&b.expectedType.kind!=="value"&&(T=b.expectedType);const A=[];for(let P=1;P<l.length-1;P+=2){const F=b.parse(l[P],P,wi);if(!F)return null;const N=b.parse(l[P+1],P+1,T);if(!N)return null;A.push([F,N]),T=T||N.type}const I=b.parse(l[l.length-1],l.length-1,T);return I?new Jn(T,A,I):null}evaluate(l){for(const[b,T]of this.branches)if(b.evaluate(l))return T.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[b,T]of this.branches)l(b),l(T);l(this.otherwise)}outputDefined(){return this.branches.every(([l,b])=>b.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(b=>{l.push(b.serialize())}),l}}class ds{constructor(l,b,T,A){this.type=l,this.input=b,this.beginIndex=T,this.endIndex=A}static parse(l,b){if(l.length<=2||l.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=b.parse(l[1],1,Ei),A=b.parse(l[2],2,Dt);if(!T||!A)return null;if(!Os(T.type,[an(Ei),ki,Ei]))return b.error(`Expected first argument to be of type array or string, but found ${ar(T.type)} instead`);if(l.length===4){const I=b.parse(l[3],3,Dt);return I?new ds(T.type,T,A,I):null}return new ds(T.type,T,A)}evaluate(l){const b=this.input.evaluate(l),T=this.beginIndex.evaluate(l);if(!Mo(b,["string","array"]))throw new Ar(`Expected first argument to be of type array or string, but found ${ar(mr(b))} instead.`);if(this.endIndex){const A=this.endIndex.evaluate(l);return b.slice(T,A)}return b.slice(T)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ql(g,l){return g==="=="||g==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function ea(g,l,b,T){return T.compare(l,b)===0}function Qn(g,l,b){const T=g!=="=="&&g!=="!=";return class Ff{constructor(I,P,F){this.type=wi,this.lhs=I,this.rhs=P,this.collator=F,this.hasUntypedArgument=I.type.kind==="value"||P.type.kind==="value"}static parse(I,P){if(I.length!==3&&I.length!==4)return P.error("Expected two or three arguments.");const F=I[0];let N=P.parse(I[1],1,Ei);if(!N)return null;if(!Ql(F,N.type))return P.concat(1).error(`"${F}" comparisons are not supported for type '${ar(N.type)}'.`);let j=P.parse(I[2],2,Ei);if(!j)return null;if(!Ql(F,j.type))return P.concat(2).error(`"${F}" comparisons are not supported for type '${ar(j.type)}'.`);if(N.type.kind!==j.type.kind&&N.type.kind!=="value"&&j.type.kind!=="value")return P.error(`Cannot compare types '${ar(N.type)}' and '${ar(j.type)}'.`);T&&(N.type.kind==="value"&&j.type.kind!=="value"?N=new hn(j.type,[N]):N.type.kind!=="value"&&j.type.kind==="value"&&(j=new hn(N.type,[j])));let X=null;if(I.length===4){if(N.type.kind!=="string"&&j.type.kind!=="string"&&N.type.kind!=="value"&&j.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if(X=P.parse(I[3],3,Qo),!X)return null}return new Ff(N,j,X)}evaluate(I){const P=this.lhs.evaluate(I),F=this.rhs.evaluate(I);if(T&&this.hasUntypedArgument){const N=mr(P),j=mr(F);if(N.kind!==j.kind||N.kind!=="string"&&N.kind!=="number")throw new Ar(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${N.kind}, ${j.kind}) instead.`)}if(this.collator&&!T&&this.hasUntypedArgument){const N=mr(P),j=mr(F);if(N.kind!=="string"||j.kind!=="string")return l(I,P,F)}return this.collator?b(I,P,F,this.collator.evaluate(I)):l(I,P,F)}eachChild(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)}outputDefined(){return!0}serialize(){const I=[g];return this.eachChild(P=>{I.push(P.serialize())}),I}}}const eh=Qn("==",function(g,l,b){return l===b},ea),qa=Qn("!=",function(g,l,b){return l!==b},function(g,l,b,T){return!ea(0,l,b,T)}),Za=Qn("<",function(g,l,b){return l<b},function(g,l,b,T){return T.compare(l,b)<0}),th=Qn(">",function(g,l,b){return l>b},function(g,l,b,T){return T.compare(l,b)>0}),Xa=Qn("<=",function(g,l,b){return l<=b},function(g,l,b,T){return T.compare(l,b)<=0}),ih=Qn(">=",function(g,l,b){return l>=b},function(g,l,b,T){return T.compare(l,b)>=0});class ta{constructor(l,b,T,A,I){this.type=ki,this.number=l,this.locale=b,this.currency=T,this.minFractionDigits=A,this.maxFractionDigits=I}static parse(l,b){if(l.length!==3)return b.error("Expected two arguments.");const T=b.parse(l[1],1,Dt);if(!T)return null;const A=l[2];if(typeof A!="object"||Array.isArray(A))return b.error("NumberFormat options argument must be an object.");let I=null;if(A.locale&&(I=b.parse(A.locale,1,ki),!I))return null;let P=null;if(A.currency&&(P=b.parse(A.currency,1,ki),!P))return null;let F=null;if(A["min-fraction-digits"]&&(F=b.parse(A["min-fraction-digits"],1,Dt),!F))return null;let N=null;return A["max-fraction-digits"]&&(N=b.parse(A["max-fraction-digits"],1,Dt),!N)?null:new ta(T,I,P,F,N)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class ia{constructor(l){this.type=Dt,this.input=l}static parse(l,b){if(l.length!==2)return b.error(`Expected 1 argument, but found ${l.length-1} instead.`);const T=b.parse(l[1],1);return T?T.type.kind!=="array"&&T.type.kind!=="string"&&T.type.kind!=="value"?b.error(`Expected argument of type string or array, but found ${ar(T.type)} instead.`):new ia(T):null}evaluate(l){const b=this.input.evaluate(l);if(typeof b=="string"||Array.isArray(b))return b.length;throw new Ar(`Expected value to be of type string or array, but found ${ar(mr(b))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(b=>{l.push(b.serialize())}),l}}const yn={"==":eh,"!=":qa,">":th,"<":Za,">=":ih,"<=":Xa,array:hn,at:ja,boolean:hn,case:Jn,coalesce:uo,collator:is,format:In,image:ho,in:Ga,"index-of":_n,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:ia,let:Js,literal:Wn,match:Qs,number:hn,"number-format":ta,object:hn,slice:ds,step:as,string:hn,"to-boolean":kn,"to-color":kn,"to-number":kn,"to-string":kn,var:js,within:co};function Ya(g,[l,b,T,A]){l=l.evaluate(g),b=b.evaluate(g),T=T.evaluate(g);const I=A?A.evaluate(g):1,P=Ol(l,b,T,I);if(P)throw new Ar(P);return new Oi(l/255*I,b/255*I,T/255*I,I)}function Ha(g,l){return g in l}function fs(g,l){const b=l[g];return b===void 0?null:b}function eo(g){return{type:g}}function rh(g){return{result:"success",value:g}}function Ln(g){return{result:"error",value:g}}function ko(g){return g["property-type"]==="data-driven"||g["property-type"]==="cross-faded-data-driven"}function nh(g){return!!g.expression&&g.expression.parameters.indexOf("zoom")>-1}function Wa(g){return!!g.expression&&g.expression.interpolated}function Ui(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}function ra(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function na(g){return g}function ps(g,l){const b=l.type==="color",T=g.stops&&typeof g.stops[0][0]=="object",A=T||!(T||g.property!==void 0),I=g.type||(Wa(l)?"exponential":"interval");if(b&&((g=Xn({},g)).stops&&(g.stops=g.stops.map(j=>[j[0],Oi.parse(j[1])])),g.default=Oi.parse(g.default?g.default:l.default)),g.colorSpace&&g.colorSpace!=="rgb"&&!Jl[g.colorSpace])throw new Error(`Unknown color space: ${g.colorSpace}`);let P,F,N;if(I==="exponential")P=oh;else if(I==="interval")P=cc;else if(I==="categorical"){P=oa,F=Object.create(null);for(const j of g.stops)F[j[0]]=j[1];N=typeof g.stops[0][0]}else{if(I!=="identity")throw new Error(`Unknown function type "${I}"`);P=uc}if(T){const j={},X=[];for(let re=0;re<g.stops.length;re++){const ue=g.stops[re],me=ue[0].zoom;j[me]===void 0&&(j[me]={zoom:me,type:g.type,property:g.property,default:g.default,stops:[]},X.push(me)),j[me].stops.push([ue[0].value,ue[1]])}const Y=[];for(const re of X)Y.push([j[re].zoom,ps(j[re],l)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Yr.interpolationFactor.bind(void 0,H),zoomStops:Y.map(re=>re[0]),evaluate:({zoom:re},ue)=>oh({stops:Y,base:g.base},l,re).evaluate(re,ue)}}if(A){const j=I==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:Yr.interpolationFactor.bind(void 0,j),zoomStops:g.stops.map(X=>X[0]),evaluate:({zoom:X})=>P(g,l,X,F,N)}}return{kind:"source",evaluate(j,X){const Y=X&&X.properties?X.properties[g.property]:void 0;return Y===void 0?Fr(g.default,l.default):P(g,l,Y,F,N)}}}function Fr(g,l,b){return g!==void 0?g:l!==void 0?l:b!==void 0?b:void 0}function oa(g,l,b,T,A){return Fr(typeof b===A?T[b]:void 0,g.default,l.default)}function cc(g,l,b){if(Ui(b)!=="number")return Fr(g.default,l.default);const T=g.stops.length;if(T===1||b<=g.stops[0][0])return g.stops[0][1];if(b>=g.stops[T-1][0])return g.stops[T-1][1];const A=ss(g.stops.map(I=>I[0]),b);return g.stops[A][1]}function oh(g,l,b){const T=g.base!==void 0?g.base:1;if(Ui(b)!=="number")return Fr(g.default,l.default);const A=g.stops.length;if(A===1||b<=g.stops[0][0])return g.stops[0][1];if(b>=g.stops[A-1][0])return g.stops[A-1][1];const I=ss(g.stops.map(X=>X[0]),b),P=function(X,Y,H,re){const ue=re-H,me=X-H;return ue===0?0:Y===1?me/ue:(Math.pow(Y,me)-1)/(Math.pow(Y,ue)-1)}(b,T,g.stops[I][0],g.stops[I+1][0]),F=g.stops[I][1],N=g.stops[I+1][1];let j=Zs[l.type]||na;if(g.colorSpace&&g.colorSpace!=="rgb"){const X=Jl[g.colorSpace];j=(Y,H)=>X.reverse(X.interpolate(X.forward(Y),X.forward(H),P))}return typeof F.evaluate=="function"?{evaluate(...X){const Y=F.evaluate.apply(void 0,X),H=N.evaluate.apply(void 0,X);if(Y!==void 0&&H!==void 0)return j(Y,H,P)}}:j(F,N,P)}function uc(g,l,b){return l.type==="color"?b=Oi.parse(b):l.type==="formatted"?b=_i.fromString(b.toString()):l.type==="resolvedImage"?b=ln.fromString(b.toString()):Ui(b)===l.type||l.type==="enum"&&l.values[b]||(b=void 0),Fr(b,g.default,l.default)}Qr.register(yn,{error:[{kind:"error"},[ki],(g,[l])=>{throw new Ar(l.evaluate(g))}],typeof:[ki,[Ei],(g,[l])=>ar(mr(l.evaluate(g)))],"to-rgba":[an(Dt,4),[An],(g,[l])=>l.evaluate(g).toArray()],rgb:[An,[Dt,Dt,Dt],Ya],rgba:[An,[Dt,Dt,Dt,Dt],Ya],has:{type:wi,overloads:[[[ki],(g,[l])=>Ha(l.evaluate(g),g.properties())],[[ki,To],(g,[l,b])=>Ha(l.evaluate(g),b.evaluate(g))]]},get:{type:Ei,overloads:[[[ki],(g,[l])=>fs(l.evaluate(g),g.properties())],[[ki,To],(g,[l,b])=>fs(l.evaluate(g),b.evaluate(g))]]},"feature-state":[Ei,[ki],(g,[l])=>fs(l.evaluate(g),g.featureState||{})],properties:[To,[],g=>g.properties()],"geometry-type":[ki,[],g=>g.geometryType()],id:[Ei,[],g=>g.id()],zoom:[Dt,[],g=>g.globals.zoom],pitch:[Dt,[],g=>g.globals.pitch||0],"distance-from-center":[Dt,[],g=>g.distanceFromCenter()],"heatmap-density":[Dt,[],g=>g.globals.heatmapDensity||0],"line-progress":[Dt,[],g=>g.globals.lineProgress||0],"sky-radial-progress":[Dt,[],g=>g.globals.skyRadialProgress||0],accumulated:[Ei,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[Dt,eo(Dt),(g,l)=>{let b=0;for(const T of l)b+=T.evaluate(g);return b}],"*":[Dt,eo(Dt),(g,l)=>{let b=1;for(const T of l)b*=T.evaluate(g);return b}],"-":{type:Dt,overloads:[[[Dt,Dt],(g,[l,b])=>l.evaluate(g)-b.evaluate(g)],[[Dt],(g,[l])=>-l.evaluate(g)]]},"/":[Dt,[Dt,Dt],(g,[l,b])=>l.evaluate(g)/b.evaluate(g)],"%":[Dt,[Dt,Dt],(g,[l,b])=>l.evaluate(g)%b.evaluate(g)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(g,[l,b])=>Math.pow(l.evaluate(g),b.evaluate(g))],sqrt:[Dt,[Dt],(g,[l])=>Math.sqrt(l.evaluate(g))],log10:[Dt,[Dt],(g,[l])=>Math.log(l.evaluate(g))/Math.LN10],ln:[Dt,[Dt],(g,[l])=>Math.log(l.evaluate(g))],log2:[Dt,[Dt],(g,[l])=>Math.log(l.evaluate(g))/Math.LN2],sin:[Dt,[Dt],(g,[l])=>Math.sin(l.evaluate(g))],cos:[Dt,[Dt],(g,[l])=>Math.cos(l.evaluate(g))],tan:[Dt,[Dt],(g,[l])=>Math.tan(l.evaluate(g))],asin:[Dt,[Dt],(g,[l])=>Math.asin(l.evaluate(g))],acos:[Dt,[Dt],(g,[l])=>Math.acos(l.evaluate(g))],atan:[Dt,[Dt],(g,[l])=>Math.atan(l.evaluate(g))],min:[Dt,eo(Dt),(g,l)=>Math.min(...l.map(b=>b.evaluate(g)))],max:[Dt,eo(Dt),(g,l)=>Math.max(...l.map(b=>b.evaluate(g)))],abs:[Dt,[Dt],(g,[l])=>Math.abs(l.evaluate(g))],round:[Dt,[Dt],(g,[l])=>{const b=l.evaluate(g);return b<0?-Math.round(-b):Math.round(b)}],floor:[Dt,[Dt],(g,[l])=>Math.floor(l.evaluate(g))],ceil:[Dt,[Dt],(g,[l])=>Math.ceil(l.evaluate(g))],"filter-==":[wi,[ki,Ei],(g,[l,b])=>g.properties()[l.value]===b.value],"filter-id-==":[wi,[Ei],(g,[l])=>g.id()===l.value],"filter-type-==":[wi,[ki],(g,[l])=>g.geometryType()===l.value],"filter-<":[wi,[ki,Ei],(g,[l,b])=>{const T=g.properties()[l.value],A=b.value;return typeof T==typeof A&&T<A}],"filter-id-<":[wi,[Ei],(g,[l])=>{const b=g.id(),T=l.value;return typeof b==typeof T&&b<T}],"filter->":[wi,[ki,Ei],(g,[l,b])=>{const T=g.properties()[l.value],A=b.value;return typeof T==typeof A&&T>A}],"filter-id->":[wi,[Ei],(g,[l])=>{const b=g.id(),T=l.value;return typeof b==typeof T&&b>T}],"filter-<=":[wi,[ki,Ei],(g,[l,b])=>{const T=g.properties()[l.value],A=b.value;return typeof T==typeof A&&T<=A}],"filter-id-<=":[wi,[Ei],(g,[l])=>{const b=g.id(),T=l.value;return typeof b==typeof T&&b<=T}],"filter->=":[wi,[ki,Ei],(g,[l,b])=>{const T=g.properties()[l.value],A=b.value;return typeof T==typeof A&&T>=A}],"filter-id->=":[wi,[Ei],(g,[l])=>{const b=g.id(),T=l.value;return typeof b==typeof T&&b>=T}],"filter-has":[wi,[Ei],(g,[l])=>l.value in g.properties()],"filter-has-id":[wi,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[wi,[an(ki)],(g,[l])=>l.value.indexOf(g.geometryType())>=0],"filter-id-in":[wi,[an(Ei)],(g,[l])=>l.value.indexOf(g.id())>=0],"filter-in-small":[wi,[ki,an(Ei)],(g,[l,b])=>b.value.indexOf(g.properties()[l.value])>=0],"filter-in-large":[wi,[ki,an(Ei)],(g,[l,b])=>function(T,A,I,P){for(;I<=P;){const F=I+P>>1;if(A[F]===T)return!0;A[F]>T?P=F-1:I=F+1}return!1}(g.properties()[l.value],b.value,0,b.value.length-1)],all:{type:wi,overloads:[[[wi,wi],(g,[l,b])=>l.evaluate(g)&&b.evaluate(g)],[eo(wi),(g,l)=>{for(const b of l)if(!b.evaluate(g))return!1;return!0}]]},any:{type:wi,overloads:[[[wi,wi],(g,[l,b])=>l.evaluate(g)||b.evaluate(g)],[eo(wi),(g,l)=>{for(const b of l)if(b.evaluate(g))return!0;return!1}]]},"!":[wi,[wi],(g,[l])=>!l.evaluate(g)],"is-supported-script":[wi,[ki],(g,[l])=>{const b=g.globals&&g.globals.isSupportedScript;return!b||b(l.evaluate(g))}],upcase:[ki,[ki],(g,[l])=>l.evaluate(g).toUpperCase()],downcase:[ki,[ki],(g,[l])=>l.evaluate(g).toLowerCase()],concat:[ki,eo(Ei),(g,l)=>l.map(b=>ts(b.evaluate(g))).join("")],"resolved-locale":[ki,[Qo],(g,[l])=>l.evaluate(g).resolvedLocale()]});class Ka{constructor(l,b){this.expression=l,this._warningHistory={},this._evaluator=new Nl,this._defaultValue=b?function(T){return T.type==="color"&&ra(T.default)?new Oi(0,0,0,0):T.type==="color"?Oi.parse(T.default)||null:T.default===void 0?null:T.default}(b):null,this._enumValues=b&&b.type==="enum"?b.values:null}evaluateWithoutErrorHandling(l,b,T,A,I,P,F,N){return this._evaluator.globals=l,this._evaluator.feature=b,this._evaluator.featureState=T,this._evaluator.canonical=A,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P,this._evaluator.featureTileCoord=F||null,this._evaluator.featureDistanceData=N||null,this.expression.evaluate(this._evaluator)}evaluate(l,b,T,A,I,P,F,N){this._evaluator.globals=l,this._evaluator.feature=b||null,this._evaluator.featureState=T||null,this._evaluator.canonical=A,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P||null,this._evaluator.featureTileCoord=F||null,this._evaluator.featureDistanceData=N||null;try{const j=this.expression.evaluate(this._evaluator);if(j==null||typeof j=="number"&&j!=j)return this._defaultValue;if(this._enumValues&&!(j in this._enumValues))throw new Ar(`Expected value to be one of ${Object.keys(this._enumValues).map(X=>JSON.stringify(X)).join(", ")}, but found ${JSON.stringify(j)} instead.`);return j}catch(j){return this._warningHistory[j.message]||(this._warningHistory[j.message]=!0,typeof console!="undefined"&&console.warn(j.message)),this._defaultValue}}}function Co(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in yn}function ms(g,l){const b=new Gs(yn,[],l?function(A){const I={color:An,string:ki,number:Dt,enum:ki,boolean:wi,formatted:Hn,resolvedImage:es};return A.type==="array"?an(I[A.value]||Ei,A.length):I[A.type]}(l):void 0),T=b.parse(g,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?rh(new Ka(T,l)):Ln(b.errors)}class gs{constructor(l,b){this.kind=l,this._styleExpression=b,this.isStateDependent=l!=="constant"&&!ns(b.expression)}evaluateWithoutErrorHandling(l,b,T,A,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,b,T,A,I,P)}evaluate(l,b,T,A,I,P){return this._styleExpression.evaluate(l,b,T,A,I,P)}}class Ja{constructor(l,b,T,A){this.kind=l,this.zoomStops=T,this._styleExpression=b,this.isStateDependent=l!=="camera"&&!ns(b.expression),this.interpolationType=A}evaluateWithoutErrorHandling(l,b,T,A,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,b,T,A,I,P)}evaluate(l,b,T,A,I,P){return this._styleExpression.evaluate(l,b,T,A,I,P)}interpolationFactor(l,b,T){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,l,b,T):0}}function sh(g,l){if((g=ms(g,l)).result==="error")return g;const b=g.value.expression,T=Io(b);if(!T&&!ko(l))return Ln([new Sn("","data expressions not supported")]);const A=os(b,["zoom","pitch","distance-from-center"]);if(!A&&!nh(l))return Ln([new Sn("","zoom expressions not supported")]);const I=sa(b);return I||A?I instanceof Sn?Ln([I]):I instanceof Yr&&!Wa(l)?Ln([new Sn("",'"interpolate" expressions cannot be used with this property')]):rh(I?new Ja(T?"camera":"composite",g.value,I.labels,I instanceof Yr?I.interpolation:void 0):new gs(T?"constant":"source",g.value)):Ln([new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Do{constructor(l,b){this._parameters=l,this._specification=b,Xn(this,ps(this._parameters,this._specification))}static deserialize(l){return new Do(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function sa(g){let l=null;if(g instanceof Js)l=sa(g.result);else if(g instanceof uo){for(const b of g.args)if(l=sa(b),l)break}else(g instanceof as||g instanceof Yr)&&g.input instanceof Qr&&g.input.name==="zoom"&&(l=g);return l instanceof Sn||g.eachChild(b=>{const T=sa(b);T instanceof Sn?l=T:!l&&T?l=new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&T&&l!==T&&(l=new Sn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function cn(g){const l=g.key,b=g.value,T=g.valueSpec||{},A=g.objectElementValidators||{},I=g.style,P=g.styleSpec;let F=[];const N=Ui(b);if(N!=="object")return[new Pt(l,b,`object expected, ${N} found`)];for(const j in b){const X=j.split(".")[0],Y=T[X]||T["*"];let H;if(A[X])H=A[X];else if(T[X])H=Ir;else if(A["*"])H=A["*"];else{if(!T["*"]){F.push(new Pt(l,b[j],`unknown property "${j}"`));continue}H=Ir}F=F.concat(H({key:(l&&`${l}.`)+j,value:b[j],valueSpec:Y,style:I,styleSpec:P,object:b,objectKey:j},b))}for(const j in T)A[j]||T[j].required&&T[j].default===void 0&&b[j]===void 0&&F.push(new Pt(l,b,`missing required property "${j}"`));return F}function Qa(g){const l=g.value,b=g.valueSpec,T=g.style,A=g.styleSpec,I=g.key,P=g.arrayElementValidator||Ir;if(Ui(l)!=="array")return[new Pt(I,l,`array expected, ${Ui(l)} found`)];if(b.length&&l.length!==b.length)return[new Pt(I,l,`array length ${b.length} expected, length ${l.length} found`)];if(b["min-length"]&&l.length<b["min-length"])return[new Pt(I,l,`array length at least ${b["min-length"]} expected, length ${l.length} found`)];let F={type:b.value,values:b.values,minimum:b.minimum,maximum:b.maximum};A.$version<7&&(F.function=b.function),Ui(b.value)==="object"&&(F=b.value);let N=[];for(let j=0;j<l.length;j++)N=N.concat(P({array:l,arrayIndex:j,value:l[j],valueSpec:F,style:T,styleSpec:A,key:`${I}[${j}]`}));return N}function ah(g){const l=g.key,b=g.value,T=g.valueSpec;let A=Ui(b);if(A==="number"&&b!=b&&(A="NaN"),A!=="number")return[new Pt(l,b,`number expected, ${A} found`)];if("minimum"in T){let I=T.minimum;if(Ui(T.minimum)==="array"&&(I=T.minimum[g.arrayIndex]),b<I)return[new Pt(l,b,`${b} is less than the minimum value ${I}`)]}if("maximum"in T){let I=T.maximum;if(Ui(T.maximum)==="array"&&(I=T.maximum[g.arrayIndex]),b>I)return[new Pt(l,b,`${b} is greater than the maximum value ${I}`)]}return[]}function aa(g){const l=g.valueSpec,b=ur(g.value.type);let T,A,I,P={};const F=b!=="categorical"&&g.value.property===void 0,N=!F,j=Ui(g.value.stops)==="array"&&Ui(g.value.stops[0])==="array"&&Ui(g.value.stops[0][0])==="object",X=cn({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(re){if(b==="identity")return[new Pt(re.key,re.value,'identity function may not have a "stops" property')];let ue=[];const me=re.value;return ue=ue.concat(Qa({key:re.key,value:me,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:Y})),Ui(me)==="array"&&me.length===0&&ue.push(new Pt(re.key,me,"array must have at least one stop")),ue},default:function(re){return Ir({key:re.key,value:re.value,valueSpec:l,style:re.style,styleSpec:re.styleSpec})}}});return b==="identity"&&F&&X.push(new Pt(g.key,g.value,'missing required property "property"')),b==="identity"||g.value.stops||X.push(new Pt(g.key,g.value,'missing required property "stops"')),b==="exponential"&&g.valueSpec.expression&&!Wa(g.valueSpec)&&X.push(new Pt(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(N&&!ko(g.valueSpec)?X.push(new Pt(g.key,g.value,"property functions not supported")):F&&!nh(g.valueSpec)&&X.push(new Pt(g.key,g.value,"zoom functions not supported"))),b!=="categorical"&&!j||g.value.property!==void 0||X.push(new Pt(g.key,g.value,'"property" property is required')),X;function Y(re){let ue=[];const me=re.value,be=re.key;if(Ui(me)!=="array")return[new Pt(be,me,`array expected, ${Ui(me)} found`)];if(me.length!==2)return[new Pt(be,me,`array length 2 expected, length ${me.length} found`)];if(j){if(Ui(me[0])!=="object")return[new Pt(be,me,`object expected, ${Ui(me[0])} found`)];if(me[0].zoom===void 0)return[new Pt(be,me,"object stop key must have zoom")];if(me[0].value===void 0)return[new Pt(be,me,"object stop key must have value")];if(I&&I>ur(me[0].zoom))return[new Pt(be,me[0].zoom,"stop zoom values must appear in ascending order")];ur(me[0].zoom)!==I&&(I=ur(me[0].zoom),A=void 0,P={}),ue=ue.concat(cn({key:`${be}[0]`,value:me[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:ah,value:H}}))}else ue=ue.concat(H({key:`${be}[0]`,value:me[0],valueSpec:{},style:re.style,styleSpec:re.styleSpec},me));return Co(Bn(me[1]))?ue.concat([new Pt(`${be}[1]`,me[1],"expressions are not allowed in function stops.")]):ue.concat(Ir({key:`${be}[1]`,value:me[1],valueSpec:l,style:re.style,styleSpec:re.styleSpec}))}function H(re,ue){const me=Ui(re.value),be=ur(re.value),Ie=re.value!==null?re.value:ue;if(T){if(me!==T)return[new Pt(re.key,Ie,`${me} stop domain type must match previous stop domain type ${T}`)]}else T=me;if(me!=="number"&&me!=="string"&&me!=="boolean")return[new Pt(re.key,Ie,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&b!=="categorical"){let Le=`number expected, ${me} found`;return ko(l)&&b===void 0&&(Le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(re.key,Ie,Le)]}return b!=="categorical"||me!=="number"||isFinite(be)&&Math.floor(be)===be?b!=="categorical"&&me==="number"&&A!==void 0&&be<A?[new Pt(re.key,Ie,"stop domain values must appear in ascending order")]:(A=be,b==="categorical"&&be in P?[new Pt(re.key,Ie,"stop domain values must be unique")]:(P[be]=!0,[])):[new Pt(re.key,Ie,`integer expected, found ${be}`)]}}function zn(g){const l=(g.expressionContext==="property"?sh:ms)(Bn(g.value),g.valueSpec);if(l.result==="error")return l.value.map(T=>new Pt(`${g.key}${T.key}`,g.value,T.message));const b=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!b.outputDefined())return[new Pt(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!ns(b))return[new Pt(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return el(b,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!os(b,["zoom","feature-state"]))return[new Pt(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!Io(b))return[new Pt(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function el(g,l){const b=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const A of l.valueSpec.expression.parameters)b.delete(A);if(b.size===0)return[];const T=[];return g instanceof Qr&&b.has(g.name)?[new Pt(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(A=>{T.push(...el(A,l))}),T)}function la(g){const l=g.key,b=g.value,T=g.valueSpec,A=[];return Array.isArray(T.values)?T.values.indexOf(ur(b))===-1&&A.push(new Pt(l,b,`expected one of [${T.values.join(", ")}], ${JSON.stringify(b)} found`)):Object.keys(T.values).indexOf(ur(b))===-1&&A.push(new Pt(l,b,`expected one of [${Object.keys(T.values).join(", ")}], ${JSON.stringify(b)} found`)),A}function ha(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const l of g.slice(1))if(!ha(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function ca(g,l="fill"){if(g==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ha(g)||(g=da(g));const b=g;let T=!0;try{T=function(j){if(!Po(j))return j;let X=Bn(j);return lh(X),X=ua(X),X}(b)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(b,null,2)}
        `)}const A=tt[`filter_${l}`],I=ms(T,A);let P=null;if(I.result==="error")throw new Error(I.value.map(j=>`${j.key}: ${j.message}`).join(", "));P=(j,X,Y)=>I.value.evaluate(j,X,{},Y);let F=null,N=null;if(T!==b){const j=ms(b,A);if(j.result==="error")throw new Error(j.value.map(X=>`${X.key}: ${X.message}`).join(", "));F=(X,Y,H,re,ue)=>j.value.evaluate(X,Y,{},H,void 0,void 0,re,ue),N=!Io(j.value.expression)}return P=P,{filter:P,dynamicFilter:F||void 0,needGeometry:tl(T),needFeature:!!N}}function ua(g){if(!Array.isArray(g))return g;const l=function(b){if(dc.has(b[0])){for(let T=1;T<b.length;T++)if(Po(b[T]))return!0}return b}(g);return l===!0?l:l.map(b=>ua(b))}function lh(g){let l=!1;const b=[];if(g[0]==="case"){for(let T=1;T<g.length-1;T+=2)l=l||Po(g[T]),b.push(g[T+1]);b.push(g[g.length-1])}else if(g[0]==="match"){l=l||Po(g[1]);for(let T=2;T<g.length-1;T+=2)b.push(g[T+1]);b.push(g[g.length-1])}else if(g[0]==="step"){l=l||Po(g[1]);for(let T=1;T<g.length-1;T+=2)b.push(g[T+1])}l&&(g.length=0,g.push("any",...b));for(let T=1;T<g.length;T++)lh(g[T])}function Po(g){if(!Array.isArray(g))return!1;if((l=g[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let b=1;b<g.length;b++)if(Po(g[b]))return!0;return!1}const dc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fc(g,l){return g<l?-1:g>l?1:0}function tl(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(let l=1;l<g.length;l++)if(tl(g[l]))return!0;return!1}function da(g){if(!g)return!0;const l=g[0];return g.length<=1?l!=="any":l==="=="?il(g[1],g[2],"=="):l==="!="?fa(il(g[1],g[2],"==")):l==="<"||l===">"||l==="<="||l===">="?il(g[1],g[2],l):l==="any"?(b=g.slice(1),["any"].concat(b.map(da))):l==="all"?["all"].concat(g.slice(1).map(da)):l==="none"?["all"].concat(g.slice(1).map(da).map(fa)):l==="in"?hh(g[1],g.slice(2)):l==="!in"?fa(hh(g[1],g.slice(2))):l==="has"?ch(g[1]):l==="!has"?fa(ch(g[1])):l!=="within"||g;var b}function il(g,l,b){switch(g){case"$type":return[`filter-type-${b}`,l];case"$id":return[`filter-id-${b}`,l];default:return[`filter-${b}`,g,l]}}function hh(g,l){if(l.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(b=>typeof b!=typeof l[0])?["filter-in-large",g,["literal",l.sort(fc)]]:["filter-in-small",g,["literal",l]]}}function ch(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function fa(g){return["!",g]}function rl(g){if(ha(Bn(g.value))){const l=Bn(g.layerType);return zn(Xn({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${l||"fill"}`]}))}return uh(g)}function uh(g){const l=g.value,b=g.key;if(Ui(l)!=="array")return[new Pt(b,l,`array expected, ${Ui(l)} found`)];const T=g.styleSpec;let A,I=[];if(l.length<1)return[new Pt(b,l,"filter array must have at least 1 element")];switch(I=I.concat(la({key:`${b}[0]`,value:l[0],valueSpec:T.filter_operator,style:g.style,styleSpec:g.styleSpec})),ur(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&ur(l[1])==="$type"&&I.push(new Pt(b,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&I.push(new Pt(b,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(A=Ui(l[1]),A!=="string"&&I.push(new Pt(`${b}[1]`,l[1],`string expected, ${A} found`)));for(let P=2;P<l.length;P++)A=Ui(l[P]),ur(l[1])==="$type"?I=I.concat(la({key:`${b}[${P}]`,value:l[P],valueSpec:T.geometry_type,style:g.style,styleSpec:g.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&I.push(new Pt(`${b}[${P}]`,l[P],`string, number, or boolean expected, ${A} found`));break;case"any":case"all":case"none":for(let P=1;P<l.length;P++)I=I.concat(uh({key:`${b}[${P}]`,value:l[P],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":A=Ui(l[1]),l.length!==2?I.push(new Pt(b,l,`filter array for "${l[0]}" operator must have 2 elements`)):A!=="string"&&I.push(new Pt(`${b}[1]`,l[1],`string expected, ${A} found`));break;case"within":A=Ui(l[1]),l.length!==2?I.push(new Pt(b,l,`filter array for "${l[0]}" operator must have 2 elements`)):A!=="object"&&I.push(new Pt(`${b}[1]`,l[1],`object expected, ${A} found`))}return I}function _s(g,l){const b=g.key,T=g.style,A=g.styleSpec,I=g.value,P=g.objectKey,F=A[`${l}_${g.layerType}`];if(!F)return[];const N=P.match(/^(.*)-transition$/);if(l==="paint"&&N&&F[N[1]]&&F[N[1]].transition)return Ir({key:b,value:I,valueSpec:A.transition,style:T,styleSpec:A});const j=g.valueSpec||F[P];if(!j)return[new Pt(b,I,`unknown property "${P}"`)];let X;if(Ui(I)==="string"&&ko(j)&&!j.tokens&&(X=/^{([^}]+)}$/.exec(I)))return[new Pt(b,I,`"${P}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const Y=[];return g.layerType==="symbol"&&(P==="text-field"&&T&&!T.glyphs&&Y.push(new Pt(b,I,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&ra(Bn(I))&&ur(I.type)==="identity"&&Y.push(new Pt(b,I,'"text-font" does not support identity functions'))),Y.concat(Ir({key:g.key,value:I,valueSpec:j,style:T,styleSpec:A,expressionContext:"property",propertyType:l,propertyKey:P}))}function dh(g){return _s(g,"paint")}function fh(g){return _s(g,"layout")}function ys(g){let l=[];const b=g.value,T=g.key,A=g.style,I=g.styleSpec;b.type||b.ref||l.push(new Pt(T,b,'either "type" or "ref" is required'));let P=ur(b.type);const F=ur(b.ref);if(b.id){const N=ur(b.id);for(let j=0;j<g.arrayIndex;j++){const X=A.layers[j];ur(X.id)===N&&l.push(new Pt(T,b.id,`duplicate layer id "${b.id}", previously used at line ${X.id.__line__}`))}}if("ref"in b){let N;["type","source","source-layer","filter","layout"].forEach(j=>{j in b&&l.push(new Pt(T,b[j],`"${j}" is prohibited for ref layers`))}),A.layers.forEach(j=>{ur(j.id)===F&&(N=j)}),N?N.ref?l.push(new Pt(T,b.ref,"ref cannot reference another ref layer")):P=ur(N.type):l.push(new Pt(T,b.ref,`ref layer "${F}" not found`))}else if(P!=="background"&&P!=="sky")if(b.source){const N=A.sources&&A.sources[b.source],j=N&&ur(N.type);N?j==="vector"&&P==="raster"?l.push(new Pt(T,b.source,`layer "${b.id}" requires a raster source`)):j==="raster"&&P!=="raster"?l.push(new Pt(T,b.source,`layer "${b.id}" requires a vector source`)):j!=="vector"||b["source-layer"]?j==="raster-dem"&&P!=="hillshade"?l.push(new Pt(T,b.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!b.paint||!b.paint["line-gradient"]||j==="geojson"&&N.lineMetrics||l.push(new Pt(T,b,`layer "${b.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Pt(T,b,`layer "${b.id}" must specify a "source-layer"`)):l.push(new Pt(T,b.source,`source "${b.source}" not found`))}else l.push(new Pt(T,b,'missing required property "source"'));return l=l.concat(cn({key:T,value:b,valueSpec:I.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ir({key:`${T}.type`,value:b.type,valueSpec:I.layer.type,style:g.style,styleSpec:g.styleSpec,object:b,objectKey:"type"}),filter:N=>rl(Xn({layerType:P},N)),layout:N=>cn({layer:b,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":j=>fh(Xn({layerType:P},j))}}),paint:N=>cn({layer:b,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":j=>dh(Xn({layerType:P},j))}})}})),l}function Ro(g){const l=g.value,b=g.key,T=Ui(l);return T!=="string"?[new Pt(b,l,`string expected, ${T} found`)]:[]}const nl={promoteId:function({key:g,value:l}){if(Ui(l)==="string")return Ro({key:g,value:l});{const b=[];for(const T in l)b.push(...Ro({key:`${g}.${T}`,value:l[T]}));return b}}};function ph(g){const l=g.value,b=g.key,T=g.styleSpec,A=g.style;if(!l.type)return[new Pt(b,l,'"type" is required')];const I=ur(l.type);let P;switch(I){case"vector":case"raster":case"raster-dem":return P=cn({key:b,value:l,valueSpec:T[`source_${I.replace("-","_")}`],style:g.style,styleSpec:T,objectElementValidators:nl}),P;case"geojson":if(P=cn({key:b,value:l,valueSpec:T.source_geojson,style:A,styleSpec:T,objectElementValidators:nl}),l.cluster)for(const F in l.clusterProperties){const[N,j]=l.clusterProperties[F],X=typeof N=="string"?[N,["accumulated"],["get",F]]:N;P.push(...zn({key:`${b}.${F}.map`,value:j,expressionContext:"cluster-map"})),P.push(...zn({key:`${b}.${F}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return P;case"video":return cn({key:b,value:l,valueSpec:T.source_video,style:A,styleSpec:T});case"image":return cn({key:b,value:l,valueSpec:T.source_image,style:A,styleSpec:T});case"canvas":return[new Pt(b,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return la({key:`${b}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:A,styleSpec:T})}}function ol(g){const l=g.value,b=g.styleSpec,T=b.light,A=g.style;let I=[];const P=Ui(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new Pt("light",l,`object expected, ${P} found`)]),I;for(const F in l){const N=F.match(/^(.*)-transition$/);I=I.concat(N&&T[N[1]]&&T[N[1]].transition?Ir({key:F,value:l[F],valueSpec:b.transition,style:A,styleSpec:b}):T[F]?Ir({key:F,value:l[F],valueSpec:T[F],style:A,styleSpec:b}):[new Pt(F,l[F],`unknown property "${F}"`)])}return I}function sl(g){const l=g.value,b=g.key,T=g.style,A=g.styleSpec,I=A.terrain;let P=[];const F=Ui(l);if(l===void 0)return P;if(F!=="object")return P=P.concat([new Pt("terrain",l,`object expected, ${F} found`)]),P;for(const N in l){const j=N.match(/^(.*)-transition$/);P=P.concat(j&&I[j[1]]&&I[j[1]].transition?Ir({key:N,value:l[N],valueSpec:A.transition,style:T,styleSpec:A}):I[N]?Ir({key:N,value:l[N],valueSpec:I[N],style:T,styleSpec:A}):[new Pt(N,l[N],`unknown property "${N}"`)])}if(l.source){const N=T.sources&&T.sources[l.source],j=N&&ur(N.type);N?j!=="raster-dem"&&P.push(new Pt(b,l.source,`terrain cannot be used with a source of type ${j}, it only be used with a "raster-dem" source type`)):P.push(new Pt(b,l.source,`source "${l.source}" not found`))}else P.push(new Pt(b,l,'terrain is missing required property "source"'));return P}function al(g){const l=g.value,b=g.style,T=g.styleSpec,A=T.fog;let I=[];const P=Ui(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new Pt("fog",l,`object expected, ${P} found`)]),I;for(const F in l){const N=F.match(/^(.*)-transition$/);I=I.concat(N&&A[N[1]]&&A[N[1]].transition?Ir({key:F,value:l[F],valueSpec:T.transition,style:b,styleSpec:T}):A[F]?Ir({key:F,value:l[F],valueSpec:A[F],style:b,styleSpec:T}):[new Pt(F,l[F],`unknown property "${F}"`)])}return I}const ll={"*":()=>[],array:Qa,boolean:function(g){const l=g.value,b=g.key,T=Ui(l);return T!=="boolean"?[new Pt(b,l,`boolean expected, ${T} found`)]:[]},number:ah,color:function(g){const l=g.key,b=g.value,T=Ui(b);return T!=="string"?[new Pt(l,b,`color expected, ${T} found`)]:Ao.parseCSSColor(b)===null?[new Pt(l,b,`color expected, "${b}" found`)]:[]},constants:Fl,enum:la,filter:rl,function:aa,layer:ys,object:cn,source:ph,light:ol,terrain:sl,fog:al,string:Ro,formatted:function(g){return Ro(g).length===0?[]:zn(g)},resolvedImage:function(g){return Ro(g).length===0?[]:zn(g)},projection:function(g){const l=g.value,b=g.styleSpec,T=b.projection,A=g.style;let I=[];const P=Ui(l);if(P==="object")for(const F in l)I=I.concat(Ir({key:F,value:l[F],valueSpec:T[F],style:A,styleSpec:b}));else P!=="string"&&(I=I.concat([new Pt("projection",l,`object or string expected, ${P} found`)]));return I}};function Ir(g){const l=g.value,b=g.valueSpec,T=g.styleSpec;return b.expression&&ra(ur(l))?aa(g):b.expression&&Co(Bn(l))?zn(g):b.type&&ll[b.type]?ll[b.type](g):cn(Xn({},g,{valueSpec:b.type?T[b.type]:b}))}function hl(g){const l=g.value,b=g.key,T=Ro(g);return T.length||(l.indexOf("{fontstack}")===-1&&T.push(new Pt(b,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&T.push(new Pt(b,l,'"glyphs" url must include a "{range}" token'))),T}function Fn(g,l=tt){let b=[];return b=b.concat(Ir({key:"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:hl,"*":()=>[]}})),g.constants&&(b=b.concat(Fl({key:"constants",value:g.constants,style:g,styleSpec:l}))),mh(b)}function mh(g){return[].concat(g).sort((l,b)=>l.line-b.line)}function xn(g){return function(...l){return mh(g.apply(this,l))}}Fn.source=xn(ph),Fn.light=xn(ol),Fn.terrain=xn(sl),Fn.fog=xn(al),Fn.layer=xn(ys),Fn.filter=xn(rl),Fn.paintProperty=xn(dh),Fn.layoutProperty=xn(fh);const Bo=Fn,Lo=Bo.light,pc=Bo.fog,cl=Bo.paintProperty,mc=Bo.layoutProperty;function gh(g,l){let b=!1;if(l&&l.length)for(const T of l)g.fire(new zs(new Error(T.message))),b=!0;return b}var xs=jr;function jr(g,l,b){var T=this.cells=[];if(g instanceof ArrayBuffer){this.arrayBuffer=g;var A=new Int32Array(this.arrayBuffer);g=A[0],this.d=(l=A[1])+2*(b=A[2]);for(var I=0;I<this.d*this.d;I++){var P=A[3+I],F=A[3+I+1];T.push(P===F?null:A.subarray(P,F))}var N=A[3+T.length+1];this.keys=A.subarray(A[3+T.length],N),this.bboxes=A.subarray(N),this.insert=this._insertReadonly}else{this.d=l+2*b;for(var j=0;j<this.d*this.d;j++)T.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=g,this.padding=b,this.scale=l/g,this.uid=0;var X=b/l*g;this.min=-X,this.max=g+X}jr.prototype.insert=function(g,l,b,T,A){this._forEachCell(l,b,T,A,this._insertCell,this.uid++),this.keys.push(g),this.bboxes.push(l),this.bboxes.push(b),this.bboxes.push(T),this.bboxes.push(A)},jr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},jr.prototype._insertCell=function(g,l,b,T,A,I){this.cells[A].push(I)},jr.prototype.query=function(g,l,b,T,A){var I=this.min,P=this.max;if(g<=I&&l<=I&&P<=b&&P<=T&&!A)return Array.prototype.slice.call(this.keys);var F=[];return this._forEachCell(g,l,b,T,this._queryCell,F,{},A),F},jr.prototype._queryCell=function(g,l,b,T,A,I,P,F){var N=this.cells[A];if(N!==null)for(var j=this.keys,X=this.bboxes,Y=0;Y<N.length;Y++){var H=N[Y];if(P[H]===void 0){var re=4*H;(F?F(X[re+0],X[re+1],X[re+2],X[re+3]):g<=X[re+2]&&l<=X[re+3]&&b>=X[re+0]&&T>=X[re+1])?(P[H]=!0,I.push(j[H])):P[H]=!1}}},jr.prototype._forEachCell=function(g,l,b,T,A,I,P,F){for(var N=this._convertToCellCoord(g),j=this._convertToCellCoord(l),X=this._convertToCellCoord(b),Y=this._convertToCellCoord(T),H=N;H<=X;H++)for(var re=j;re<=Y;re++){var ue=this.d*re+H;if((!F||F(this._convertFromCellCoord(H),this._convertFromCellCoord(re),this._convertFromCellCoord(H+1),this._convertFromCellCoord(re+1)))&&A.call(this,g,l,b,T,ue,I,P,F))return}},jr.prototype._convertFromCellCoord=function(g){return(g-this.padding)/this.scale},jr.prototype._convertToCellCoord=function(g){return Math.max(0,Math.min(this.d-1,Math.floor(g*this.scale)+this.padding))},jr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var g=this.cells,l=3+this.cells.length+1+1,b=0,T=0;T<this.cells.length;T++)b+=this.cells[T].length;var A=new Int32Array(l+b+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;for(var I=l,P=0;P<g.length;P++){var F=g[P];A[3+P]=I,A.set(F,I),I+=F.length}return A[3+g.length]=I,A.set(this.keys,I),A[3+g.length+1]=I+=this.keys.length,A.set(this.bboxes,I),I+=this.bboxes.length,A.buffer};const{ImageData:vs,ImageBitmap:zo}=G,bs={};function Ot(g,l,b={}){Object.defineProperty(l,"_classRegistryKey",{value:g,writeable:!1}),bs[g]={klass:l,omit:b.omit||[],shallow:b.shallow||[]}}Ot("Object",Object),xs.serialize=function(g,l){const b=g.toArrayBuffer();return l&&l.push(b),{buffer:b}},xs.deserialize=function(g){return new xs(g.buffer)},Ot("Grid",xs),Ot("Color",Oi),Ot("Error",Error),Ot("ResolvedImage",ln),Ot("StylePropertyFunction",Do),Ot("StyleExpression",Ka,{omit:["_evaluator"]}),Ot("ZoomDependentExpression",Ja),Ot("ZoomConstantExpression",gs),Ot("CompoundExpression",Qr,{omit:["_evaluate"]});for(const g in yn)yn[g]._classRegistryKey||Ot(`Expression_${g}`,yn[g]);function Fo(g){return g&&typeof ArrayBuffer!="undefined"&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function _h(g){return zo&&g instanceof zo}function ws(g,l){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp)return g;if(Fo(g)||_h(g))return l&&l.push(g),g;if(ArrayBuffer.isView(g)){const b=g;return l&&l.push(b.buffer),b}if(g instanceof vs)return l&&l.push(g.data.buffer),g;if(Array.isArray(g)){const b=[];for(const T of g)b.push(ws(T,l));return b}if(typeof g=="object"){const b=g.constructor,T=b._classRegistryKey;if(!T)throw new Error("can't serialize object of unregistered class");const A=b.serialize?b.serialize(g,l):{};if(!b.serialize){for(const I in g){if(!g.hasOwnProperty(I)||bs[T].omit.indexOf(I)>=0)continue;const P=g[I];A[I]=bs[T].shallow.indexOf(I)>=0?P:ws(P,l)}g instanceof Error&&(A.message=g.message)}if(A.$name)throw new Error("$name property is reserved for worker serialization logic.");return T!=="Object"&&(A.$name=T),A}throw new Error("can't serialize object of type "+typeof g)}function to(g){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||Fo(g)||_h(g)||ArrayBuffer.isView(g)||g instanceof vs)return g;if(Array.isArray(g))return g.map(to);if(typeof g=="object"){const l=g.$name||"Object",{klass:b}=bs[l];if(!b)throw new Error(`can't deserialize unregistered class ${l}`);if(b.deserialize)return b.deserialize(g);const T=Object.create(b.prototype);for(const A of Object.keys(g)){if(A==="$name")continue;const I=g[A];T[A]=bs[l].shallow.indexOf(A)>=0?I:to(I)}return T}throw new Error("can't deserialize object of type "+typeof g)}class C{constructor(){this.first=!0}update(l,b){const T=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=T,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=T,!0):(this.lastFloorZoom>T?(this.lastIntegerZoom=T+1,this.lastIntegerZoomTime=b):this.lastFloorZoom<T&&(this.lastIntegerZoom=T,this.lastIntegerZoomTime=b),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=T,!0))}}const y=g=>g>=1536&&g<=1791,S=g=>g>=1872&&g<=1919,D=g=>g>=2208&&g<=2303,z=g=>g>=11904&&g<=12031,O=g=>g>=12032&&g<=12255,V=g=>g>=12272&&g<=12287,Z=g=>g>=12288&&g<=12351,K=g=>g>=12352&&g<=12447,Q=g=>g>=12448&&g<=12543,ie=g=>g>=12544&&g<=12591,ae=g=>g>=12704&&g<=12735,pe=g=>g>=12736&&g<=12783,Ee=g=>g>=12784&&g<=12799,xe=g=>g>=12800&&g<=13055,Te=g=>g>=13056&&g<=13311,Fe=g=>g>=13312&&g<=19903,we=g=>g>=19968&&g<=40959,De=g=>g>=40960&&g<=42127,Be=g=>g>=42128&&g<=42191,ke=g=>g>=44032&&g<=55215,Ce=g=>g>=63744&&g<=64255,Oe=g=>g>=64336&&g<=65023,He=g=>g>=65040&&g<=65055,Je=g=>g>=65072&&g<=65103,xt=g=>g>=65104&&g<=65135,ft=g=>g>=65136&&g<=65279,dt=g=>g>=65280&&g<=65519;function it(g){for(const l of g)if(st(l.charCodeAt(0)))return!0;return!1}function Ke(g){for(const l of g)if(!ut(l.charCodeAt(0)))return!1;return!0}function ut(g){return!(y(g)||S(g)||D(g)||Oe(g)||ft(g))}function st(g){return!(g!==746&&g!==747&&(g<4352||!(ae(g)||ie(g)||Je(g)&&!(g>=65097&&g<=65103)||Ce(g)||Te(g)||z(g)||pe(g)||!(!Z(g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||Fe(g)||we(g)||xe(g)||(l=>l>=12592&&l<=12687)(g)||(l=>l>=43360&&l<=43391)(g)||(l=>l>=55216&&l<=55295)(g)||(l=>l>=4352&&l<=4607)(g)||ke(g)||K(g)||V(g)||(l=>l>=12688&&l<=12703)(g)||O(g)||Ee(g)||Q(g)&&g!==12540||!(!dt(g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!xt(g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||(l=>l>=5120&&l<=5759)(g)||(l=>l>=6320&&l<=6399)(g)||He(g)||(l=>l>=19904&&l<=19967)(g)||De(g)||Be(g))))}function Yt(g){return!(st(g)||function(l){return!!((b=>b>=128&&b<=255)(l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||(b=>b>=8192&&b<=8303)(l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||(b=>b>=8448&&b<=8527)(l)||(b=>b>=8528&&b<=8591)(l)||(b=>b>=8960&&b<=9215)(l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||(b=>b>=9216&&b<=9279)(l)&&l!==9251||(b=>b>=9280&&b<=9311)(l)||(b=>b>=9312&&b<=9471)(l)||(b=>b>=9632&&b<=9727)(l)||(b=>b>=9728&&b<=9983)(l)&&!(l>=9754&&l<=9759)||(b=>b>=11008&&b<=11263)(l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Z(l)||Q(l)||(b=>b>=57344&&b<=63743)(l)||Je(l)||xt(l)||dt(l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(g))}function ii(g){return g>=1424&&g<=2303||Oe(g)||ft(g)}function bi(g,l){return!(!l&&ii(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||(b=>b>=6016&&b<=6143)(g))}function yt(g){for(const l of g)if(ii(l.charCodeAt(0)))return!0;return!1}const Jt="deferred",ui="loading",Zi="loaded";let Qi=null,ai="unavailable",Mi=null;const rr=function(g){g&&typeof g=="string"&&g.indexOf("NetworkError")>-1&&(ai="error"),Qi&&Qi(g)};function wr(){Hr.fire(new qn("pluginStateChange",{pluginStatus:ai,pluginURL:Mi}))}const Hr=new Zn,un=function(){return ai},vn=function(){if(ai!==Jt||!Mi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ai=ui,wr(),Mi&&Ko({url:Mi},g=>{g?rr(g):(ai=Zi,wr())})},Li={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ai===Zi||Li.applyArabicShaping!=null,isLoading:()=>ai===ui,setState(g){ai=g.pluginStatus,Mi=g.pluginURL},isParsed:()=>Li.applyArabicShaping!=null&&Li.processBidirectionalText!=null&&Li.processStyledBidirectionalText!=null,getPluginURL:()=>Mi};class di{constructor(l,b){this.zoom=l,b?(this.now=b.now,this.fadeDuration=b.fadeDuration,this.zoomHistory=b.zoomHistory,this.transition=b.transition,this.pitch=b.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new C,this.transition={},this.pitch=0)}isSupportedScript(l){return function(b,T){for(const A of b)if(!bi(A.charCodeAt(0),T))return!1;return!0}(l,Li.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,b=l-Math.floor(l),T=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:b+(1-b)*T}:{fromScale:.5,toScale:1,t:1-(1-T)*b}}}class Ci{constructor(l,b){this.property=l,this.value=b,this.expression=function(T,A){if(ra(T))return new Do(T,A);if(Co(T)){const I=sh(T,A);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));return I.value}{let I=T;return typeof T=="string"&&A.type==="color"&&(I=Oi.parse(T)),{kind:"constant",evaluate:()=>I}}}(b===void 0?l.specification.default:b,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,b,T){return this.property.possiblyEvaluate(this,l,b,T)}}class hr{constructor(l){this.property=l,this.value=new Ci(l,void 0)}transitioned(l,b){return new ir(this.property,this.value,b,Kt({},l.transition,this.transition),l.now)}untransitioned(){return new ir(this.property,this.value,null,{},0)}}class en{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Ai(this._values[l].value.value)}setValue(l,b){this._values.hasOwnProperty(l)||(this._values[l]=new hr(this._values[l].property)),this._values[l].value=new Ci(this._values[l].property,b===null?void 0:Ai(b))}getTransition(l){return Ai(this._values[l].transition)}setTransition(l,b){this._values.hasOwnProperty(l)||(this._values[l]=new hr(this._values[l].property)),this._values[l].transition=Ai(b)||void 0}serialize(){const l={};for(const b of Object.keys(this._values)){const T=this.getValue(b);T!==void 0&&(l[b]=T);const A=this.getTransition(b);A!==void 0&&(l[`${b}-transition`]=A)}return l}transitioned(l,b){const T=new tn(this._properties);for(const A of Object.keys(this._values))T._values[A]=this._values[A].transitioned(l,b._values[A]);return T}untransitioned(){const l=new tn(this._properties);for(const b of Object.keys(this._values))l._values[b]=this._values[b].untransitioned();return l}}class ir{constructor(l,b,T,A,I){const P=A.delay||0,F=A.duration||0;I=I||0,this.property=l,this.value=b,this.begin=I+P,this.end=this.begin+F,l.specification.transition&&(A.delay||A.duration)&&(this.prior=T)}possiblyEvaluate(l,b,T){const A=l.now||0,I=this.value.possiblyEvaluate(l,b,T),P=this.prior;if(P){if(A>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(A<this.begin)return P.possiblyEvaluate(l,b,T);{const F=(A-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(l,b,T),I,si(F))}}return I}}class tn{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,b,T){const A=new fo(this._properties);for(const I of Object.keys(this._values))A._values[I]=this._values[I].possiblyEvaluate(l,b,T);return A}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Es{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}getValue(l){return Ai(this._values[l].value)}setValue(l,b){this._values[l]=new Ci(this._values[l].property,b===null?void 0:Ai(b))}serialize(){const l={};for(const b of Object.keys(this._values)){const T=this.getValue(b);T!==void 0&&(l[b]=T)}return l}possiblyEvaluate(l,b,T){const A=new fo(this._properties);for(const I of Object.keys(this._values))A._values[I]=this._values[I].possiblyEvaluate(l,b,T);return A}}class Wr{constructor(l,b,T){this.property=l,this.value=b,this.parameters=T}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,b,T,A){return this.property.evaluate(this.value,this.parameters,l,b,T,A)}}class fo{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class $t{constructor(l){this.specification=l}possiblyEvaluate(l,b){return l.expression.evaluate(b)}interpolate(l,b,T){const A=Zs[this.specification.type];return A?A(l,b,T):l}}class Qt{constructor(l,b){this.specification=l,this.overrides=b}possiblyEvaluate(l,b,T,A){return new Wr(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(b,null,{},T,A)}:l.expression,b)}interpolate(l,b,T){if(l.value.kind!=="constant"||b.value.kind!=="constant")return l;if(l.value.value===void 0||b.value.value===void 0)return new Wr(this,{kind:"constant",value:void 0},l.parameters);const A=Zs[this.specification.type];return A?new Wr(this,{kind:"constant",value:A(l.value.value,b.value.value,T)},l.parameters):l}evaluate(l,b,T,A,I,P){return l.kind==="constant"?l.value:l.evaluate(b,T,A,I,P)}}class kr extends Qt{possiblyEvaluate(l,b,T,A){if(l.value===void 0)return new Wr(this,{kind:"constant",value:void 0},b);if(l.expression.kind==="constant"){const I=l.expression.evaluate(b,null,{},T,A),P=l.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,F=this._calculate(P,P,P,b);return new Wr(this,{kind:"constant",value:F},b)}if(l.expression.kind==="camera"){const I=this._calculate(l.expression.evaluate({zoom:b.zoom-1}),l.expression.evaluate({zoom:b.zoom}),l.expression.evaluate({zoom:b.zoom+1}),b);return new Wr(this,{kind:"constant",value:I},b)}return new Wr(this,l.expression,b)}evaluate(l,b,T,A,I,P){if(l.kind==="source"){const F=l.evaluate(b,T,A,I,P);return this._calculate(F,F,F,b)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(b.zoom)-1},T,A),l.evaluate({zoom:Math.floor(b.zoom)},T,A),l.evaluate({zoom:Math.floor(b.zoom)+1},T,A),b):l.value}_calculate(l,b,T,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:l,to:b,other:T}:{from:T,to:b,other:l}}interpolate(l){return l}}class po{constructor(l){this.specification=l}possiblyEvaluate(l,b,T,A){if(l.value!==void 0){if(l.expression.kind==="constant"){const I=l.expression.evaluate(b,null,{},T,A);return this._calculate(I,I,I,b)}return this._calculate(l.expression.evaluate(new di(Math.floor(b.zoom-1),b)),l.expression.evaluate(new di(Math.floor(b.zoom),b)),l.expression.evaluate(new di(Math.floor(b.zoom+1),b)),b)}}_calculate(l,b,T,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:l,to:b}:{from:T,to:b}}interpolate(l){return l}}class io{constructor(l){this.specification=l}possiblyEvaluate(l,b,T,A){return!!l.expression.evaluate(b,null,{},T,A)}interpolate(){return!1}}class Or{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const b in l){const T=l[b];T.specification.overridable&&this.overridableProperties.push(b);const A=this.defaultPropertyValues[b]=new Ci(T,void 0),I=this.defaultTransitionablePropertyValues[b]=new hr(T);this.defaultTransitioningPropertyValues[b]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=A.possiblyEvaluate({})}}}function Au(g,l){return 256*(g=Rt(Math.floor(g),0,255))+Rt(Math.floor(l),0,255)}Ot("DataDrivenProperty",Qt),Ot("DataConstantProperty",$t),Ot("CrossFadedDataDrivenProperty",kr),Ot("CrossFadedProperty",po),Ot("ColorRampProperty",io);const Of={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ul{constructor(l,b){this._structArray=l,this._pos1=b*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,b){return l._trim(),b&&(l.isTransferred=!0,b.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const b=Object.create(this.prototype);return b.arrayBuffer=l.arrayBuffer,b.length=l.length,b.capacity=l.arrayBuffer.byteLength/b.bytesPerElement,b._refreshViews(),b}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const b=this.uint8;this._refreshViews(),b&&this.uint8.set(b)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function lr(g,l=1){let b=0,T=0;return{members:g.map(A=>{const I=Of[A.type].BYTES_PER_ELEMENT,P=b=Iu(b,Math.max(l,I)),F=A.components||1;return T=Math.max(T,I),b+=I*F,{name:A.name,type:A.type,components:F,offset:P}}),size:Iu(b,Math.max(T,l)),alignment:l}}function Iu(g,l){return Math.ceil(g/l)*l}class pa extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,b){const T=this.length;return this.resize(T+1),this.emplace(T,l,b)}emplace(l,b,T){const A=2*l;return this.int16[A+0]=b,this.int16[A+1]=T,l}}pa.prototype.bytesPerElement=4,Ot("StructArrayLayout2i4",pa);class ma extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,b,T,A){const I=this.length;return this.resize(I+1),this.emplace(I,l,b,T,A)}emplace(l,b,T,A,I){const P=4*l;return this.int16[P+0]=b,this.int16[P+1]=T,this.int16[P+2]=A,this.int16[P+3]=I,l}}ma.prototype.bytesPerElement=8,Ot("StructArrayLayout4i8",ma);class gc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F){const N=this.length;return this.resize(N+1),this.emplace(N,l,b,T,A,I,P,F)}emplace(l,b,T,A,I,P,F,N){const j=6*l,X=12*l,Y=3*l;return this.int16[j+0]=b,this.int16[j+1]=T,this.uint8[X+4]=A,this.uint8[X+5]=I,this.uint8[X+6]=P,this.uint8[X+7]=F,this.float32[Y+2]=N,l}}gc.prototype.bytesPerElement=12,Ot("StructArrayLayout2i4ub1f12",gc);class ga extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,l,b,T)}emplace(l,b,T,A){const I=3*l;return this.float32[I+0]=b,this.float32[I+1]=T,this.float32[I+2]=A,l}}ga.prototype.bytesPerElement=12,Ot("StructArrayLayout3f12",ga);class Oo extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N,j,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,l,b,T,A,I,P,F,N,j,X)}emplace(l,b,T,A,I,P,F,N,j,X,Y){const H=10*l;return this.uint16[H+0]=b,this.uint16[H+1]=T,this.uint16[H+2]=A,this.uint16[H+3]=I,this.uint16[H+4]=P,this.uint16[H+5]=F,this.uint16[H+6]=N,this.uint16[H+7]=j,this.uint16[H+8]=X,this.uint16[H+9]=Y,l}}Oo.prototype.bytesPerElement=20,Ot("StructArrayLayout10ui20",Oo);class yh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N){const j=this.length;return this.resize(j+1),this.emplace(j,l,b,T,A,I,P,F,N)}emplace(l,b,T,A,I,P,F,N,j){const X=8*l;return this.uint16[X+0]=b,this.uint16[X+1]=T,this.uint16[X+2]=A,this.uint16[X+3]=I,this.uint16[X+4]=P,this.uint16[X+5]=F,this.uint16[X+6]=N,this.uint16[X+7]=j,l}}yh.prototype.bytesPerElement=16,Ot("StructArrayLayout8ui16",yh);class _c extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be)}emplace(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie){const Le=16*l;return this.int16[Le+0]=b,this.int16[Le+1]=T,this.int16[Le+2]=A,this.int16[Le+3]=I,this.uint16[Le+4]=P,this.uint16[Le+5]=F,this.uint16[Le+6]=N,this.uint16[Le+7]=j,this.int16[Le+8]=X,this.int16[Le+9]=Y,this.int16[Le+10]=H,this.int16[Le+11]=re,this.int16[Le+12]=ue,this.int16[Le+13]=me,this.int16[Le+14]=be,this.int16[Le+15]=Ie,l}}_c.prototype.bytesPerElement=32,Ot("StructArrayLayout4i4ui4i4i32",_c);class yc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const b=this.length;return this.resize(b+1),this.emplace(b,l)}emplace(l,b){return this.uint32[1*l+0]=b,l}}yc.prototype.bytesPerElement=4,Ot("StructArrayLayout1ul4",yc);class xc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N,j,X,Y,H,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,l,b,T,A,I,P,F,N,j,X,Y,H,re)}emplace(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue){const me=20*l,be=10*l;return this.int16[me+0]=b,this.int16[me+1]=T,this.int16[me+2]=A,this.int16[me+3]=I,this.int16[me+4]=P,this.float32[be+3]=F,this.float32[be+4]=N,this.float32[be+5]=j,this.float32[be+6]=X,this.int16[me+14]=Y,this.uint32[be+8]=H,this.uint16[me+18]=re,this.uint16[me+19]=ue,l}}xc.prototype.bytesPerElement=40,Ot("StructArrayLayout5i4f1i1ul2ui40",xc);class xh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F){const N=this.length;return this.resize(N+1),this.emplace(N,l,b,T,A,I,P,F)}emplace(l,b,T,A,I,P,F,N){const j=8*l;return this.int16[j+0]=b,this.int16[j+1]=T,this.int16[j+2]=A,this.int16[j+4]=I,this.int16[j+5]=P,this.int16[j+6]=F,this.int16[j+7]=N,l}}xh.prototype.bytesPerElement=16,Ot("StructArrayLayout3i2i2i16",xh);class vc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I){const P=this.length;return this.resize(P+1),this.emplace(P,l,b,T,A,I)}emplace(l,b,T,A,I,P){const F=4*l,N=8*l;return this.float32[F+0]=b,this.float32[F+1]=T,this.float32[F+2]=A,this.int16[N+6]=I,this.int16[N+7]=P,l}}vc.prototype.bytesPerElement=16,Ot("StructArrayLayout2f1f2i16",vc);class bc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b,T,A){const I=this.length;return this.resize(I+1),this.emplace(I,l,b,T,A)}emplace(l,b,T,A,I){const P=12*l,F=3*l;return this.uint8[P+0]=b,this.uint8[P+1]=T,this.float32[F+1]=A,this.float32[F+2]=I,l}}bc.prototype.bytesPerElement=12,Ot("StructArrayLayout2ub2f12",bc);class bn extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,l,b,T)}emplace(l,b,T,A){const I=3*l;return this.uint16[I+0]=b,this.uint16[I+1]=T,this.uint16[I+2]=A,l}}bn.prototype.bytesPerElement=6,Ot("StructArrayLayout3ui6",bn);class wc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe)}emplace(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe,Ye){const ot=30*l,rt=15*l,wt=60*l;return this.int16[ot+0]=b,this.int16[ot+1]=T,this.int16[ot+2]=A,this.float32[rt+2]=I,this.float32[rt+3]=P,this.uint16[ot+8]=F,this.uint16[ot+9]=N,this.uint32[rt+5]=j,this.uint32[rt+6]=X,this.uint32[rt+7]=Y,this.uint16[ot+16]=H,this.uint16[ot+17]=re,this.uint16[ot+18]=ue,this.float32[rt+10]=me,this.float32[rt+11]=be,this.uint8[wt+48]=Ie,this.uint8[wt+49]=Le,this.uint8[wt+50]=Ne,this.uint32[rt+13]=je,this.int16[ot+28]=qe,this.uint8[wt+58]=Ye,l}}wc.prototype.bytesPerElement=60,Ot("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",wc);class Ec extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe,Ye,ot,rt,wt,gt,nt,_t,Tt,ht){const zt=this.length;return this.resize(zt+1),this.emplace(zt,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe,Ye,ot,rt,wt,gt,nt,_t,Tt,ht)}emplace(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be,Ie,Le,Ne,je,qe,Ye,ot,rt,wt,gt,nt,_t,Tt,ht,zt){const Nt=38*l,Ri=19*l;return this.int16[Nt+0]=b,this.int16[Nt+1]=T,this.int16[Nt+2]=A,this.float32[Ri+2]=I,this.float32[Ri+3]=P,this.int16[Nt+8]=F,this.int16[Nt+9]=N,this.int16[Nt+10]=j,this.int16[Nt+11]=X,this.int16[Nt+12]=Y,this.int16[Nt+13]=H,this.uint16[Nt+14]=re,this.uint16[Nt+15]=ue,this.uint16[Nt+16]=me,this.uint16[Nt+17]=be,this.uint16[Nt+18]=Ie,this.uint16[Nt+19]=Le,this.uint16[Nt+20]=Ne,this.uint16[Nt+21]=je,this.uint16[Nt+22]=qe,this.uint16[Nt+23]=Ye,this.uint16[Nt+24]=ot,this.uint16[Nt+25]=rt,this.uint16[Nt+26]=wt,this.uint16[Nt+27]=gt,this.uint16[Nt+28]=nt,this.uint32[Ri+15]=_t,this.float32[Ri+16]=Tt,this.float32[Ri+17]=ht,this.float32[Ri+18]=zt,l}}Ec.prototype.bytesPerElement=76,Ot("StructArrayLayout3i2f6i15ui1ul3f76",Ec);class vh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const b=this.length;return this.resize(b+1),this.emplace(b,l)}emplace(l,b){return this.float32[1*l+0]=b,l}}vh.prototype.bytesPerElement=4,Ot("StructArrayLayout1f4",vh);class Tc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,l,b,T)}emplace(l,b,T,A){const I=3*l;return this.int16[I+0]=b,this.int16[I+1]=T,this.int16[I+2]=A,l}}Tc.prototype.bytesPerElement=6,Ot("StructArrayLayout3i6",Tc);class dl extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b,T,A,I,P,F){const N=this.length;return this.resize(N+1),this.emplace(N,l,b,T,A,I,P,F)}emplace(l,b,T,A,I,P,F,N){const j=7*l;return this.float32[j+0]=b,this.float32[j+1]=T,this.float32[j+2]=A,this.float32[j+3]=I,this.float32[j+4]=P,this.float32[j+5]=F,this.float32[j+6]=N,l}}dl.prototype.bytesPerElement=28,Ot("StructArrayLayout7f28",dl);class Mc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b,T,A){const I=this.length;return this.resize(I+1),this.emplace(I,l,b,T,A)}emplace(l,b,T,A,I){const P=6*l;return this.uint32[3*l+0]=b,this.uint16[P+2]=T,this.uint16[P+3]=A,this.uint16[P+4]=I,l}}Mc.prototype.bytesPerElement=12,Ot("StructArrayLayout1ul3ui12",Mc);class $o extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,b){const T=this.length;return this.resize(T+1),this.emplace(T,l,b)}emplace(l,b,T){const A=2*l;return this.uint16[A+0]=b,this.uint16[A+1]=T,l}}$o.prototype.bytesPerElement=4,Ot("StructArrayLayout2ui4",$o);class bh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const b=this.length;return this.resize(b+1),this.emplace(b,l)}emplace(l,b){return this.uint16[1*l+0]=b,l}}bh.prototype.bytesPerElement=2,Ot("StructArrayLayout1ui2",bh);class wh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b){const T=this.length;return this.resize(T+1),this.emplace(T,l,b)}emplace(l,b,T){const A=2*l;return this.float32[A+0]=b,this.float32[A+1]=T,l}}wh.prototype.bytesPerElement=8,Ot("StructArrayLayout2f8",wh);class Sc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,b,T,A){const I=this.length;return this.resize(I+1),this.emplace(I,l,b,T,A)}emplace(l,b,T,A,I){const P=4*l;return this.float32[P+0]=b,this.float32[P+1]=T,this.float32[P+2]=A,this.float32[P+3]=I,l}}Sc.prototype.bytesPerElement=16,Ot("StructArrayLayout4f16",Sc);class ku extends ul{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ku.prototype.size=40;class Ac extends xc{get(l){return new ku(this,l)}}Ot("CollisionBoxArray",Ac);class Cu extends ul{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}Cu.prototype.size=60;class Du extends wc{get(l){return new Cu(this,l)}}Ot("PlacedSymbolArray",Du);class Pu extends ul{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(l){this._structArray.uint32[this._pos4+15]=l}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pu.prototype.size=76;class Ru extends Ec{get(l){return new Pu(this,l)}}Ot("SymbolInstanceArray",Ru);class Bu extends vh{getoffsetX(l){return this.float32[1*l+0]}}Ot("GlyphOffsetArray",Bu);class Lu extends Tc{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Ot("SymbolLineVertexArray",Lu);class zu extends ul{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zu.prototype.size=12;class Fu extends Mc{get(l){return new zu(this,l)}}Ot("FeatureIndexArray",Fu);class Ou extends ul{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Ou.prototype.size=4;class $u extends $o{get(l){return new Ou(this,l)}}Ot("FillExtrusionCentroidArray",$u);const $f=lr([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Nf=lr([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Nu=So(function(g){g.exports=function(l,b){var T,A,I,P,F,N,j,X;for(A=l.length-(T=3&l.length),I=b,F=3432918353,N=461845907,X=0;X<A;)j=255&l.charCodeAt(X)|(255&l.charCodeAt(++X))<<8|(255&l.charCodeAt(++X))<<16|(255&l.charCodeAt(++X))<<24,++X,I=27492+(65535&(P=5*(65535&(I=(I^=j=(65535&(j=(j=(65535&j)*F+(((j>>>16)*F&65535)<<16)&4294967295)<<15|j>>>17))*N+(((j>>>16)*N&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(j=0,T){case 3:j^=(255&l.charCodeAt(X+2))<<16;case 2:j^=(255&l.charCodeAt(X+1))<<8;case 1:I^=j=(65535&(j=(j=(65535&(j^=255&l.charCodeAt(X)))*F+(((j>>>16)*F&65535)<<16)&4294967295)<<15|j>>>17))*N+(((j>>>16)*N&65535)<<16)&4294967295}return I^=l.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Uf=So(function(g){g.exports=function(l,b){for(var T,A=l.length,I=b^A,P=0;A>=4;)T=1540483477*(65535&(T=255&l.charCodeAt(P)|(255&l.charCodeAt(++P))<<8|(255&l.charCodeAt(++P))<<16|(255&l.charCodeAt(++P))<<24))+((1540483477*(T>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(T=1540483477*(65535&(T^=T>>>24))+((1540483477*(T>>>16)&65535)<<16)),A-=4,++P;switch(A){case 3:I^=(255&l.charCodeAt(P+2))<<16;case 2:I^=(255&l.charCodeAt(P+1))<<8;case 1:I=1540483477*(65535&(I^=255&l.charCodeAt(P)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),fl=Nu,Vf=Uf;fl.murmur3=Nu,fl.murmur2=Vf;class Eh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,b,T,A){this.ids.push(Uu(l)),this.positions.push(b,T,A)}getPositions(l){const b=Uu(l);let T=0,A=this.ids.length-1;for(;T<A;){const P=T+A>>1;this.ids[P]>=b?A=P:T=P+1}const I=[];for(;this.ids[T]===b;)I.push({index:this.positions[3*T],start:this.positions[3*T+1],end:this.positions[3*T+2]}),T++;return I}static serialize(l,b){const T=new Float64Array(l.ids),A=new Uint32Array(l.positions);return Ic(T,A,0,T.length-1),b&&b.push(T.buffer,A.buffer),{ids:T,positions:A}}static deserialize(l){const b=new Eh;return b.ids=l.ids,b.positions=l.positions,b.indexed=!0,b}}function Uu(g){const l=+g;return!isNaN(l)&&Number.MIN_SAFE_INTEGER<=l&&l<=Number.MAX_SAFE_INTEGER?l:fl(String(g))}function Ic(g,l,b,T){for(;b<T;){const A=g[b+T>>1];let I=b-1,P=T+1;for(;;){do I++;while(g[I]<A);do P--;while(g[P]>A);if(I>=P)break;Th(g,I,P),Th(l,3*I,3*P),Th(l,3*I+1,3*P+1),Th(l,3*I+2,3*P+2)}P-b<T-P?(Ic(g,l,b,P),b=P+1):(Ic(g,l,P+1,T),T=P)}}function Th(g,l,b){const T=g[l];g[l]=g[b],g[b]=T}Ot("FeaturePositionMap",Eh);class mo{constructor(l,b){this.gl=l.gl,this.location=b}}class Mh extends mo{constructor(l,b){super(l,b),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Vu extends mo{constructor(l,b){super(l,b),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class ju extends mo{constructor(l,b){super(l,b),this.current=Oi.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const jf=new Float32Array(16),Gf=new Float32Array(9),qf=new Float32Array(4);function kc(g){return[Au(255*g.r,255*g.g),Au(255*g.b,255*g.a)]}class pl{constructor(l,b,T){this.value=l,this.uniformNames=b.map(A=>`u_${A}`),this.type=T}setUniform(l,b,T){l.set(T.constantOr(this.value))}getBinding(l,b,T){return this.type==="color"?new ju(l,b):new Mh(l,b)}}class _a{constructor(l,b){this.uniformNames=b.map(T=>`u_${T}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,b){this.pixelRatioFrom=b.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=b.tl.concat(b.br),this.patternTo=l.tl.concat(l.br)}setUniform(l,b,T,A){const I=A==="u_pattern_to"||A==="u_dash_to"?this.patternTo:A==="u_pattern_from"||A==="u_dash_from"?this.patternFrom:A==="u_pixel_ratio_to"?this.pixelRatioTo:A==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&l.set(I)}getBinding(l,b,T){return T==="u_pattern_from"||T==="u_pattern_to"||T==="u_dash_from"||T==="u_dash_to"?new Vu(l,b):new Mh(l,b)}}class go{constructor(l,b,T,A){this.expression=l,this.type=T,this.maxValue=0,this.paintVertexAttributes=b.map(I=>({name:`a_${I}`,type:"Float32",components:T==="color"?2:1,offset:0})),this.paintVertexArray=new A}populatePaintArray(l,b,T,A,I,P){const F=this.paintVertexArray.length,N=this.expression.evaluate(new di(0),b,{},I,A,P);this.paintVertexArray.resize(l),this._setPaintValue(F,l,N)}updatePaintArray(l,b,T,A,I){const P=this.expression.evaluate({zoom:0},T,A,void 0,I);this._setPaintValue(l,b,P)}_setPaintValue(l,b,T){if(this.type==="color"){const A=kc(T);for(let I=l;I<b;I++)this.paintVertexArray.emplace(I,A[0],A[1])}else{for(let A=l;A<b;A++)this.paintVertexArray.emplace(A,T);this.maxValue=Math.max(this.maxValue,Math.abs(T))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class On{constructor(l,b,T,A,I,P){this.expression=l,this.uniformNames=b.map(F=>`u_${F}_t`),this.type=T,this.useIntegerZoom=A,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=b.map(F=>({name:`a_${F}`,type:"Float32",components:T==="color"?4:2,offset:0})),this.paintVertexArray=new P}populatePaintArray(l,b,T,A,I,P){const F=this.expression.evaluate(new di(this.zoom),b,{},I,A,P),N=this.expression.evaluate(new di(this.zoom+1),b,{},I,A,P),j=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(j,l,F,N)}updatePaintArray(l,b,T,A,I){const P=this.expression.evaluate({zoom:this.zoom},T,A,void 0,I),F=this.expression.evaluate({zoom:this.zoom+1},T,A,void 0,I);this._setPaintValue(l,b,P,F)}_setPaintValue(l,b,T,A){if(this.type==="color"){const I=kc(T),P=kc(A);for(let F=l;F<b;F++)this.paintVertexArray.emplace(F,I[0],I[1],P[0],P[1])}else{for(let I=l;I<b;I++)this.paintVertexArray.emplace(I,T,A);this.maxValue=Math.max(this.maxValue,Math.abs(T),Math.abs(A))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,b){const T=this.useIntegerZoom?Math.floor(b.zoom):b.zoom,A=Rt(this.expression.interpolationFactor(T,this.zoom,this.zoom+1),0,1);l.set(A)}getBinding(l,b,T){return new Mh(l,b)}}class No{constructor(l,b,T,A,I,P,F){this.expression=l,this.type=T,this.useIntegerZoom=A,this.zoom=I,this.layerId=F,this.paintVertexAttributes=(T==="array"?Nf:$f).members;for(let N=0;N<b.length;++N);this.zoomInPaintVertexArray=new P,this.zoomOutPaintVertexArray=new P}populatePaintArray(l,b,T){const A=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(A,l,b.patterns&&b.patterns[this.layerId],T)}updatePaintArray(l,b,T,A,I,P){this._setPaintValues(l,b,T.patterns&&T.patterns[this.layerId],P)}_setPaintValues(l,b,T,A){if(!A||!T)return;const{min:I,mid:P,max:F}=T,N=A[I],j=A[P],X=A[F];if(N&&j&&X)for(let Y=l;Y<b;Y++)this._setPaintValue(this.zoomInPaintVertexArray,Y,j,N),this._setPaintValue(this.zoomOutPaintVertexArray,Y,j,X)}_setPaintValue(l,b,T,A){l.emplace(b,T.tl[0],T.tl[1],T.br[0],T.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],T.pixelRatio,A.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _o{constructor(l,b,T=()=>!0){this.binders={},this._buffers=[];const A=[];for(const I in l.paint._values){if(!T(I))continue;const P=l.paint.get(I);if(!(P instanceof Wr&&ko(P.property.specification)))continue;const F=Xf(I,l.type),N=P.value,j=P.property.specification.type,X=P.property.useIntegerZoom,Y=P.property.specification["property-type"],H=Y==="cross-faded"||Y==="cross-faded-data-driven",re=String(I)==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant";if(N.kind!=="constant"||re)if(N.kind==="source"||re||H){const ue=Gu(I,j,"source");this.binders[I]=H?new No(N,F,j,X,b,ue,l.id):new go(N,F,j,ue),A.push(`/a_${I}`)}else{const ue=Gu(I,j,"composite");this.binders[I]=new On(N,F,j,X,b,ue),A.push(`/z_${I}`)}else this.binders[I]=H?new _a(N.value,F):new pl(N.value,F,j),A.push(`/u_${I}`)}this.cacheKey=A.sort().join("")}getMaxValue(l){const b=this.binders[l];return b instanceof go||b instanceof On?b.maxValue:0}populatePaintArrays(l,b,T,A,I,P){for(const F in this.binders){const N=this.binders[F];(N instanceof go||N instanceof On||N instanceof No)&&N.populatePaintArray(l,b,T,A,I,P)}}setConstantPatternPositions(l,b){for(const T in this.binders){const A=this.binders[T];A instanceof _a&&A.setConstantPatternPositions(l,b)}}updatePaintArrays(l,b,T,A,I,P){let F=!1;for(const N in l){const j=b.getPositions(N);for(const X of j){const Y=T.feature(X.index);for(const H in this.binders){const re=this.binders[H];if((re instanceof go||re instanceof On||re instanceof No)&&re.expression.isStateDependent===!0){const ue=A.paint.get(H);re.expression=ue.value,re.updatePaintArray(X.start,X.end,Y,l[N],I,P),F=!0}}}}return F}defines(){const l=[];for(const b in this.binders){const T=this.binders[b];(T instanceof pl||T instanceof _a)&&l.push(...T.uniformNames.map(A=>`#define HAS_UNIFORM_${A}`))}return l}getBinderAttributes(){const l=[];for(const b in this.binders){const T=this.binders[b];if(T instanceof go||T instanceof On||T instanceof No)for(let A=0;A<T.paintVertexAttributes.length;A++)l.push(T.paintVertexAttributes[A].name)}return l}getBinderUniforms(){const l=[];for(const b in this.binders){const T=this.binders[b];if(T instanceof pl||T instanceof _a||T instanceof On)for(const A of T.uniformNames)l.push(A)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,b){const T=[];for(const A in this.binders){const I=this.binders[A];if(I instanceof pl||I instanceof _a||I instanceof On){for(const P of I.uniformNames)if(b[P]){const F=I.getBinding(l,b[P],P);T.push({name:P,property:A,binding:F})}}}return T}setUniforms(l,b,T,A){for(const{name:I,property:P,binding:F}of b)this.binders[P].setUniform(F,A,T.get(P),I)}updatePaintBuffers(l){this._buffers=[];for(const b in this.binders){const T=this.binders[b];if(l&&T instanceof No){const A=l.fromScale===2?T.zoomInPaintVertexBuffer:T.zoomOutPaintVertexBuffer;A&&this._buffers.push(A)}else(T instanceof go||T instanceof On)&&T.paintVertexBuffer&&this._buffers.push(T.paintVertexBuffer)}}upload(l){for(const b in this.binders){const T=this.binders[b];(T instanceof go||T instanceof On||T instanceof No)&&T.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const b=this.binders[l];(b instanceof go||b instanceof On||b instanceof No)&&b.destroy()}}}class Ts{constructor(l,b,T=()=>!0){this.programConfigurations={};for(const A of l)this.programConfigurations[A.id]=new _o(A,b,T);this.needsUpload=!1,this._featureMap=new Eh,this._bufferOffset=0}populatePaintArrays(l,b,T,A,I,P,F){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(l,b,A,I,P,F);b.id!==void 0&&this._featureMap.add(b.id,T,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,b,T,A,I){for(const P of T)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(l,this._featureMap,b,P,A,I)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const b in this.programConfigurations)this.programConfigurations[b].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const Zf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Xf(g,l){return Zf[g]||[g.replace(`${l}-`,"").replace(/-/g,"_")]}const Yf={"line-pattern":{source:Oo,composite:Oo},"fill-pattern":{source:Oo,composite:Oo},"fill-extrusion-pattern":{source:Oo,composite:Oo},"line-dasharray":{source:yh,composite:yh}},Hf={color:{source:wh,composite:Sc},number:{source:vh,composite:wh}};function Gu(g,l,b){const T=Yf[g];return T&&T[b]||Hf[l][b]}Ot("ConstantBinder",pl),Ot("CrossFadedConstantBinder",_a),Ot("SourceExpressionBinder",go),Ot("CrossFadedCompositeBinder",No),Ot("CompositeExpressionBinder",On),Ot("ProgramConfiguration",_o,{omit:["_buffers"]}),Ot("ProgramConfigurationSet",Ts);const Sh="-transition";class $n extends Zn{constructor(l,b){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&l.type!=="sky"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),b.layout&&(this._unevaluatedLayout=new Es(b.layout)),b.paint)){this._transitionablePaint=new en(b.paint);for(const T in l.paint)this.setPaintProperty(T,l.paint[T],{validate:!1});for(const T in l.layout)this.setLayoutProperty(T,l.layout[T],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fo(b.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,b,T={}){b!=null&&this._validate(mc,`layers.${this.id}.layout.${l}`,l,b,T)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,b):this.visibility=b)}getPaintProperty(l){return ei(l,Sh)?this._transitionablePaint.getTransition(l.slice(0,-Sh.length)):this._transitionablePaint.getValue(l)}setPaintProperty(l,b,T={}){if(b!=null&&this._validate(cl,`layers.${this.id}.paint.${l}`,l,b,T))return!1;if(ei(l,Sh))return this._transitionablePaint.setTransition(l.slice(0,-Sh.length),b||void 0),!1;{const A=this._transitionablePaint._values[l],I=A.property.specification["property-type"]==="cross-faded-data-driven",P=A.value.isDataDriven(),F=A.value;this._transitionablePaint.setValue(l,b),this._handleSpecialPaintPropertyUpdate(l);const N=this._transitionablePaint._values[l].value;return N.isDataDriven()||P||I||this._handleOverridablePaintPropertyUpdate(l,F,N)}}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getProgramConfiguration(l){return null}_handleOverridablePaintPropertyUpdate(l,b,T){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,b){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,b)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,b)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Ni(l,(b,T)=>!(b===void 0||T==="layout"&&!Object.keys(b).length||T==="paint"&&!Object.keys(b).length))}_validate(l,b,T,A,I={}){return(!I||I.validate!==!1)&&gh(this,l.call(Bo,{key:b,layerType:this.type,objectKey:T,value:A,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const b=this.paint.get(l);if(b instanceof Wr&&ko(b.property.specification)&&(b.value.kind==="source"||b.value.kind==="composite")&&b.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ca(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wf=lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kf}=Wf;class _r{constructor(l=[]){this.segments=l}prepareSegment(l,b,T,A){let I=this.segments[this.segments.length-1];return l>_r.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${_r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!I||I.vertexLength+l>_r.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==A)&&(I={vertexOffset:b.length,primitiveOffset:T.length,vertexLength:0,primitiveLength:0},A!==void 0&&(I.sortKey=A),this.segments.push(I)),I}get(){return this.segments}destroy(){for(const l of this.segments)for(const b in l.vaos)l.vaos[b].destroy()}static simpleSegment(l,b,T,A){return new _r([{vertexOffset:l,primitiveOffset:b,vertexLength:T,primitiveLength:A,vaos:{},sortKey:0}])}}_r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot("SegmentVector",_r);var Si=8192;class Ms{constructor(l,b){l&&(b?this.setSouthWest(l).setNorthEast(b):l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof Wi?new Wi(l.lng,l.lat):Wi.convert(l),this}setSouthWest(l){return this._sw=l instanceof Wi?new Wi(l.lng,l.lat):Wi.convert(l),this}extend(l){const b=this._sw,T=this._ne;let A,I;if(l instanceof Wi)A=l,I=l;else{if(!(l instanceof Ms))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ms.convert(l)):this.extend(Wi.convert(l)):this;if(A=l._sw,I=l._ne,!A||!I)return this}return b||T?(b.lng=Math.min(A.lng,b.lng),b.lat=Math.min(A.lat,b.lat),T.lng=Math.max(I.lng,T.lng),T.lat=Math.max(I.lat,T.lat)):(this._sw=new Wi(A.lng,A.lat),this._ne=new Wi(I.lng,I.lat)),this}getCenter(){return new Wi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Wi(this.getWest(),this.getNorth())}getSouthEast(){return new Wi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:b,lat:T}=Wi.convert(l);let A=this._sw.lng<=b&&b<=this._ne.lng;return this._sw.lng>this._ne.lng&&(A=this._sw.lng>=b&&b>=this._ne.lng),this._sw.lat<=T&&T<=this._ne.lat&&A}static convert(l){return!l||l instanceof Ms?l:new Ms(l)}}const qu=63710088e-1;class Wi{constructor(l,b){if(isNaN(l)||isNaN(b))throw new Error(`Invalid LngLat object: (${l}, ${b})`);if(this.lng=+l,this.lat=+b,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wi(ni(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const b=Math.PI/180,T=this.lat*b,A=l.lat*b,I=Math.sin(T)*Math.sin(A)+Math.cos(T)*Math.cos(A)*Math.cos((l.lng-this.lng)*b);return qu*Math.acos(Math.min(I,1))}toBounds(l=0){const b=360*l/40075017,T=b/Math.cos(Math.PI/180*this.lat);return new Ms(new Wi(this.lng-T,this.lat-b),new Wi(this.lng+T,this.lat+b))}static convert(l){if(l instanceof Wi)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Wi(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Wi(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Zu=2*Math.PI*qu;function Xu(g){return Zu*Math.cos(g*Math.PI/180)}function ya(g){return(180+g)/360}function xa(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function Nn(g,l){return g/Xu(l)}function yo(g){return 360*g-180}function Cn(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function Yu(g,l){return g*Xu(Cn(l))}const ro=85.051129;class Ah{constructor(l,b,T=0){this.x=+l,this.y=+b,this.z=+T}static fromLngLat(l,b=0){const T=Wi.convert(l);return new Ah(ya(T.lng),xa(T.lat),Nn(b,T.lat))}toLngLat(){return new Wi(yo(this.x),Cn(this.y))}toAltitude(){return Yu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zu*(l=Cn(this.y),1/Math.cos(l*Math.PI/180));var l}}function Cc(g,l,b,T,A,I,P,F,N){const j=(l+T)/2,X=(b+A)/2,Y=new U(j,X);F(Y),function(H,re,ue,me,be,Ie){const Le=ue-be,Ne=me-Ie;return Math.abs((me-re)*Le-(ue-H)*Ne)/Math.hypot(Le,Ne)}(Y.x,Y.y,I.x,I.y,P.x,P.y)>=N?(Cc(g,l,b,j,X,I,Y,F,N),Cc(g,j,X,T,A,Y,P,F,N)):g.push(P)}function Jf(g,l,b){const T=[];let A,I,P;for(const F of g){const{x:N,y:j}=F;l(F),P?Cc(T,A,I,N,j,P,F,l,b):T.push(F),A=N,I=j,P=F}return T}const Dc=Math.pow(2,14)-1,Hu=-Dc-1;function Qf(g,l){const b=Math.round(g.x*l),T=Math.round(g.y*l);return g.x=Rt(b,Hu,Dc),g.y=Rt(T,Hu,Dc),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),g}function xo(g,l,b){const T=g.loadGeometry(),A=g.extent,I=Si/A;if(l&&b&&b.projection.isReprojectedInTileSpace){const P=1<<l.z,{scale:F,x:N,y:j,projection:X}=b,Y=H=>{const re=yo((l.x+H.x/A)/P),ue=Cn((l.y+H.y/A)/P),me=X.project(re,ue);H.x=(me.x*F-N)*A,H.y=(me.y*F-j)*A};for(let H=0;H<T.length;H++)if(g.type!==1)T[H]=Jf(T[H],Y,1);else{const re=[];for(const ue of T[H])ue.x<0||ue.x>=A||ue.y<0||ue.y>=A||(Y(ue),re.push(ue));T[H]=re}}for(const P of T)for(const F of P)Qf(F,I);return T}function Ss(g,l){return{type:g.type,id:g.id,properties:g.properties,geometry:l?xo(g):[]}}function Ih(g,l,b,T,A){g.emplaceBack(2*l+(T+1)/2,2*b+(A+1)/2)}class Pc{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(b=>b.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new pa,this.indexArray=new bn,this.segments=new _r,this.programConfigurations=new Ts(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(l,b,T,A){const I=this.layers[0],P=[];let F=null;I.type==="circle"&&(F=I.layout.get("circle-sort-key"));for(const{feature:N,id:j,index:X,sourceLayerIndex:Y}of l){const H=this.layers[0]._featureFilter.needGeometry,re=Ss(N,H);if(!this.layers[0]._featureFilter.filter(new di(this.zoom),re,T))continue;const ue=F?F.evaluate(re,{},T):void 0,me={id:j,properties:N.properties,type:N.type,sourceLayerIndex:Y,index:X,geometry:H?re.geometry:xo(N,T,A),patterns:{},sortKey:ue};P.push(me)}F&&P.sort((N,j)=>N.sortKey-j.sortKey);for(const N of P){const{geometry:j,index:X,sourceLayerIndex:Y}=N,H=l[X].feature;this.addFeature(N,j,X,b.availableImages,T),b.featureIndex.insert(H,j,X,Y,this.index)}}update(l,b,T,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,b,this.stateDependentLayers,T,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Kf),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,b,T,A,I){for(const P of b)for(const F of P){const N=F.x,j=F.y;if(N<0||N>=Si||j<0||j>=Si)continue;const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),Y=X.vertexLength;Ih(this.layoutVertexArray,N,j,-1,-1),Ih(this.layoutVertexArray,N,j,1,-1),Ih(this.layoutVertexArray,N,j,1,1),Ih(this.layoutVertexArray,N,j,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+3,Y+2),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,{},A,I)}}function Wu(g,l){for(let b=0;b<g.length;b++)if(va(l,g[b]))return!0;for(let b=0;b<l.length;b++)if(va(g,l[b]))return!0;return!!Rc(g,l)}function ep(g,l,b){return!!va(g,l)||!!Bc(l,g,b)}function Ku(g,l){if(g.length===1)return Qu(l,g[0]);for(let b=0;b<l.length;b++){const T=l[b];for(let A=0;A<T.length;A++)if(va(g,T[A]))return!0}for(let b=0;b<g.length;b++)if(Qu(l,g[b]))return!0;for(let b=0;b<l.length;b++)if(Rc(g,l[b]))return!0;return!1}function tp(g,l,b){if(g.length>1){if(Rc(g,l))return!0;for(let T=0;T<l.length;T++)if(Bc(l[T],g,b))return!0}for(let T=0;T<g.length;T++)if(Bc(g[T],l,b))return!0;return!1}function Rc(g,l){if(g.length===0||l.length===0)return!1;for(let b=0;b<g.length-1;b++){const T=g[b],A=g[b+1];for(let I=0;I<l.length-1;I++)if(ip(T,A,l[I],l[I+1]))return!0}return!1}function ip(g,l,b,T){return fr(g,b,T)!==fr(l,b,T)&&fr(g,l,b)!==fr(g,l,T)}function Bc(g,l,b){const T=b*b;if(l.length===1)return g.distSqr(l[0])<T;for(let A=1;A<l.length;A++)if(Ju(g,l[A-1],l[A])<T)return!0;return!1}function Ju(g,l,b){const T=l.distSqr(b);if(T===0)return g.distSqr(l);const A=((g.x-l.x)*(b.x-l.x)+(g.y-l.y)*(b.y-l.y))/T;return g.distSqr(A<0?l:A>1?b:b.sub(l)._mult(A)._add(l))}function Qu(g,l){let b,T,A,I=!1;for(let P=0;P<g.length;P++){b=g[P];for(let F=0,N=b.length-1;F<b.length;N=F++)T=b[F],A=b[N],T.y>l.y!=A.y>l.y&&l.x<(A.x-T.x)*(l.y-T.y)/(A.y-T.y)+T.x&&(I=!I)}return I}function va(g,l){let b=!1;for(let T=0,A=g.length-1;T<g.length;A=T++){const I=g[T],P=g[A];I.y>l.y!=P.y>l.y&&l.x<(P.x-I.x)*(l.y-I.y)/(P.y-I.y)+I.x&&(b=!b)}return b}function ed(g,l,b,T,A){for(const P of g)if(l<=P.x&&b<=P.y&&T>=P.x&&A>=P.y)return!0;const I=[new U(l,b),new U(l,A),new U(T,A),new U(T,b)];if(g.length>2){for(const P of I)if(va(g,P))return!0}for(let P=0;P<g.length-1;P++)if(rp(g[P],g[P+1],I))return!0;return!1}function rp(g,l,b){const T=b[0],A=b[2];if(g.x<T.x&&l.x<T.x||g.x>A.x&&l.x>A.x||g.y<T.y&&l.y<T.y||g.y>A.y&&l.y>A.y)return!1;const I=fr(g,l,b[0]);return I!==fr(g,l,b[1])||I!==fr(g,l,b[2])||I!==fr(g,l,b[3])}function ba(g,l,b){const T=l.paint.get(g).value;return T.kind==="constant"?T.value:b.programConfigurations.get(l.id).getMaxValue(g)}function kh(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function td(g,l,b,T,A){if(!l[0]&&!l[1])return g;const I=U.convert(l)._mult(A);b==="viewport"&&I._rotate(-T);const P=[];for(let F=0;F<g.length;F++)P.push(g[F].sub(I));return P}function id(g,l,b,T){const A=U.convert(g)._mult(T);return l==="viewport"&&A._rotate(-b),A}Ot("CircleBucket",Pc,{omit:["layers"]});const np=new Or({"circle-sort-key":new Qt(tt.layout_circle["circle-sort-key"])});var op={paint:new Or({"circle-radius":new Qt(tt.paint_circle["circle-radius"]),"circle-color":new Qt(tt.paint_circle["circle-color"]),"circle-blur":new Qt(tt.paint_circle["circle-blur"]),"circle-opacity":new Qt(tt.paint_circle["circle-opacity"]),"circle-translate":new $t(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt(tt.paint_circle["circle-stroke-opacity"])}),layout:np};class Lc{constructor(l,b){this.points=l,this.planes=b}static fromInvProjectionMatrix(l,b,T,A){const I=Math.pow(2,T),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const j=jt([],N,l),X=1/j[3]/b*I;return function(Y,H,re){return Y[0]=H[0]*re[0],Y[1]=H[1]*re[1],Y[2]=H[2]*re[2],Y[3]=H[3]*re[3],Y}(j,j,[X,X,A?1/j[3]:X,X])}),F=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const j=It([],Ft([],At([],P[N[0]],P[N[1]]),At([],P[N[2]],P[N[1]]))),X=-Vt(j,P[N[1]]);return j.concat(X)});return new Lc(P,F)}}class Un{constructor(l,b){this.min=l,this.max=b,this.center=Bt([],ze([],this.min,this.max),.5)}quadrant(l){const b=[l%2==0,l<2],T=Se(this.min),A=Se(this.max);for(let I=0;I<b.length;I++)T[I]=b[I]?this.min[I]:this.center[I],A[I]=b[I]?this.center[I]:this.max[I];return A[2]=this.max[2],new Un(T,A)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,b=this.max;return[[l[0],l[1],l[2]],[b[0],l[1],l[2]],[b[0],b[1],l[2]],[l[0],b[1],l[2]],[l[0],l[1],b[2]],[b[0],l[1],b[2]],[b[0],b[1],b[2]],[l[0],b[1],b[2]]]}intersects(l){const b=this.getCorners();let T=!0;for(let A=0;A<l.planes.length;A++){const I=l.planes[A];let P=0;for(let F=0;F<b.length;F++)P+=Vt(I,b[F])+I[3]>=0;if(P===0)return 0;P!==b.length&&(T=!1)}if(T)return 2;for(let A=0;A<3;A++){let I=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let F=0;F<l.points.length;F++){const N=l.points[F][A]-this.min[A];I=Math.min(I,N),P=Math.max(P,N)}if(P<0||I>this.max[A]-this.min[A])return 0}return 1}}function rd(g,l,b,T,A,I,P,F,N){if(I&&g.queryGeometry.isAboveHorizon)return!1;I&&(N*=g.pixelToTileUnitsFactor);for(const j of l)for(const X of j){const Y=X.add(F),H=A&&b.elevation?b.elevation.exaggeration()*A.getElevationAt(Y.x,Y.y,!0):0,re=I?Y:sp(Y,H,T),ue=I?g.tilespaceRays.map(be=>lp(be,H)):g.queryGeometry.screenGeometry,me=jt([],[X.x,X.y,H,1],T);if(!P&&I?N*=me[3]/b.cameraToCenterDistance:P&&!I&&(N*=b.cameraToCenterDistance/me[3]),ep(ue,re,N))return!0}return!1}function sp(g,l,b){const T=jt([],[g.x,g.y,l,1],b);return new U(T[0]/T[3],T[1]/T[3])}const nd=ye(0,0,0),ap=ye(0,0,1);function lp(g,l){const b=de();return nd[2]=l,g.intersectsPlane(nd,ap,b),new U(b[0],b[1])}class od extends Pc{}function zc(g,{width:l,height:b},T,A){if(A){if(A instanceof Uint8ClampedArray)A=new Uint8Array(A.buffer);else if(A.length!==l*b*T)throw new RangeError("mismatched image size")}else A=new Uint8Array(l*b*T);return g.width=l,g.height=b,g.data=A,g}function sd(g,{width:l,height:b},T){if(l===g.width&&b===g.height)return;const A=zc({},{width:l,height:b},T);Fc(g,A,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,l),height:Math.min(g.height,b)},T),g.width=l,g.height=b,g.data=A.data}function Fc(g,l,b,T,A,I){if(A.width===0||A.height===0)return l;if(A.width>g.width||A.height>g.height||b.x>g.width-A.width||b.y>g.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>l.width||A.height>l.height||T.x>l.width-A.width||T.y>l.height-A.height)throw new RangeError("out of range destination coordinates for image copy");const P=g.data,F=l.data;for(let N=0;N<A.height;N++){const j=((b.y+N)*g.width+b.x)*I,X=((T.y+N)*l.width+T.x)*I;for(let Y=0;Y<A.width*I;Y++)F[X+Y]=P[j+Y]}return l}Ot("HeatmapBucket",od,{omit:["layers"]});class Uo{constructor(l,b){zc(this,l,1,b)}resize(l){sd(this,l,1)}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,b,T,A,I){Fc(l,b,T,A,I,1)}}class wn{constructor(l,b){zc(this,l,4,b)}resize(l){sd(this,l,4)}replace(l,b){b?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,b,T,A,I){Fc(l,b,T,A,I,4)}}Ot("AlphaImage",Uo),Ot("RGBAImage",wn);var hp={paint:new Or({"heatmap-radius":new Qt(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new io(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(tt.paint_heatmap["heatmap-opacity"])})};function Oc(g){const l={},b=g.resolution||256,T=g.clips?g.clips.length:1,A=g.image||new wn({width:b,height:T}),I=(P,F,N)=>{l[g.evaluationKey]=N;const j=g.expression.evaluate(l);A.data[P+F+0]=Math.floor(255*j.r/j.a),A.data[P+F+1]=Math.floor(255*j.g/j.a),A.data[P+F+2]=Math.floor(255*j.b/j.a),A.data[P+F+3]=Math.floor(255*j.a)};if(g.clips)for(let P=0,F=0;P<T;++P,F+=4*b)for(let N=0,j=0;N<b;N++,j+=4){const X=N/(b-1),{start:Y,end:H}=g.clips[P];I(F,j,Y*(1-X)+H*X)}else for(let P=0,F=0;P<b;P++,F+=4)I(0,F,P/(b-1));return A}var cp={paint:new Or({"hillshade-illumination-direction":new $t(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(tt.paint_hillshade["hillshade-accent-color"])})};const up=lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:dp}=up;var Ch=Dh,fp=Dh;function Dh(g,l,b){b=b||2;var T,A,I,P,F,N,j,X=l&&l.length,Y=X?l[0]*b:g.length,H=ad(g,0,Y,b,!0),re=[];if(!H||H.next===H.prev)return re;if(X&&(H=function(me,be,Ie,Le){var Ne,je,qe,Ye=[];for(Ne=0,je=be.length;Ne<je;Ne++)(qe=ad(me,be[Ne]*Le,Ne<je-1?be[Ne+1]*Le:me.length,Le,!1))===qe.next&&(qe.steiner=!0),Ye.push(bp(qe));for(Ye.sort(yp),Ne=0;Ne<Ye.length;Ne++)Ie=Vo(Ie=xp(Ye[Ne],Ie),Ie.next);return Ie}(g,l,H,b)),g.length>80*b){T=I=g[0],A=P=g[1];for(var ue=b;ue<Y;ue+=b)(F=g[ue])<T&&(T=F),(N=g[ue+1])<A&&(A=N),F>I&&(I=F),N>P&&(P=N);j=(j=Math.max(I-T,P-A))!==0?1/j:0}return ml(H,re,b,T,A,j),re}function ad(g,l,b,T,A){var I,P;if(A===Uc(g,l,b,T)>0)for(I=l;I<b;I+=T)P=cd(I,g[I],g[I+1],P);else for(I=b-T;I>=l;I-=T)P=cd(I,g[I],g[I+1],P);return P&&Ph(P,P.next)&&(_l(P),P=P.next),P}function Vo(g,l){if(!g)return g;l||(l=g);var b,T=g;do if(b=!1,T.steiner||!Ph(T,T.next)&&yr(T.prev,T,T.next)!==0)T=T.next;else{if(_l(T),(T=l=T.prev)===T.next)break;b=!0}while(b||T!==l);return l}function ml(g,l,b,T,A,I,P){if(g){!P&&I&&function(X,Y,H,re){var ue=X;do ue.z===null&&(ue.z=$c(ue.x,ue.y,Y,H,re)),ue.prevZ=ue.prev,ue.nextZ=ue.next,ue=ue.next;while(ue!==X);ue.prevZ.nextZ=null,ue.prevZ=null,function(me){var be,Ie,Le,Ne,je,qe,Ye,ot,rt=1;do{for(Ie=me,me=null,je=null,qe=0;Ie;){for(qe++,Le=Ie,Ye=0,be=0;be<rt&&(Ye++,Le=Le.nextZ);be++);for(ot=rt;Ye>0||ot>0&&Le;)Ye!==0&&(ot===0||!Le||Ie.z<=Le.z)?(Ne=Ie,Ie=Ie.nextZ,Ye--):(Ne=Le,Le=Le.nextZ,ot--),je?je.nextZ=Ne:me=Ne,Ne.prevZ=je,je=Ne;Ie=Le}je.nextZ=null,rt*=2}while(qe>1)}(ue)}(g,T,A,I);for(var F,N,j=g;g.prev!==g.next;)if(F=g.prev,N=g.next,I?mp(g,T,A,I):pp(g))l.push(F.i/b),l.push(g.i/b),l.push(N.i/b),_l(g),g=N.next,j=N.next;else if((g=N)===j){P?P===1?ml(g=gp(Vo(g),l,b),l,b,T,A,I,2):P===2&&_p(g,l,b,T,A,I):ml(Vo(g),l,b,T,A,I,1);break}}}function pp(g){var l=g.prev,b=g,T=g.next;if(yr(l,b,T)>=0)return!1;for(var A=g.next.next;A!==g.prev;){if(wa(l.x,l.y,b.x,b.y,T.x,T.y,A.x,A.y)&&yr(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function mp(g,l,b,T){var A=g.prev,I=g,P=g.next;if(yr(A,I,P)>=0)return!1;for(var F=A.x>I.x?A.x>P.x?A.x:P.x:I.x>P.x?I.x:P.x,N=A.y>I.y?A.y>P.y?A.y:P.y:I.y>P.y?I.y:P.y,j=$c(A.x<I.x?A.x<P.x?A.x:P.x:I.x<P.x?I.x:P.x,A.y<I.y?A.y<P.y?A.y:P.y:I.y<P.y?I.y:P.y,l,b,T),X=$c(F,N,l,b,T),Y=g.prevZ,H=g.nextZ;Y&&Y.z>=j&&H&&H.z<=X;){if(Y!==g.prev&&Y!==g.next&&wa(A.x,A.y,I.x,I.y,P.x,P.y,Y.x,Y.y)&&yr(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,H!==g.prev&&H!==g.next&&wa(A.x,A.y,I.x,I.y,P.x,P.y,H.x,H.y)&&yr(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;Y&&Y.z>=j;){if(Y!==g.prev&&Y!==g.next&&wa(A.x,A.y,I.x,I.y,P.x,P.y,Y.x,Y.y)&&yr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;H&&H.z<=X;){if(H!==g.prev&&H!==g.next&&wa(A.x,A.y,I.x,I.y,P.x,P.y,H.x,H.y)&&yr(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function gp(g,l,b){var T=g;do{var A=T.prev,I=T.next.next;!Ph(A,I)&&ld(A,T,T.next,I)&&gl(A,I)&&gl(I,A)&&(l.push(A.i/b),l.push(T.i/b),l.push(I.i/b),_l(T),_l(T.next),T=g=I),T=T.next}while(T!==g);return Vo(T)}function _p(g,l,b,T,A,I){var P=g;do{for(var F=P.next.next;F!==P.prev;){if(P.i!==F.i&&wp(P,F)){var N=hd(P,F);return P=Vo(P,P.next),N=Vo(N,N.next),ml(P,l,b,T,A,I),void ml(N,l,b,T,A,I)}F=F.next}P=P.next}while(P!==g)}function yp(g,l){return g.x-l.x}function xp(g,l){var b=function(I,P){var F,N=P,j=I.x,X=I.y,Y=-1/0;do{if(X<=N.y&&X>=N.next.y&&N.next.y!==N.y){var H=N.x+(X-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(H<=j&&H>Y){if(Y=H,H===j){if(X===N.y)return N;if(X===N.next.y)return N.next}F=N.x<N.next.x?N:N.next}}N=N.next}while(N!==P);if(!F)return null;if(j===Y)return F;var re,ue=F,me=F.x,be=F.y,Ie=1/0;N=F;do j>=N.x&&N.x>=me&&j!==N.x&&wa(X<be?j:Y,X,me,be,X<be?Y:j,X,N.x,N.y)&&(re=Math.abs(X-N.y)/(j-N.x),gl(N,I)&&(re<Ie||re===Ie&&(N.x>F.x||N.x===F.x&&vp(F,N)))&&(F=N,Ie=re)),N=N.next;while(N!==ue);return F}(g,l);if(!b)return l;var T=hd(b,g),A=Vo(b,b.next);return Vo(T,T.next),l===b?A:l}function vp(g,l){return yr(g.prev,g,l.prev)<0&&yr(l.next,g,g.next)<0}function $c(g,l,b,T,A){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=32767*(g-b)*A)|g<<8))|g<<4))|g<<2))|g<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-T)*A)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function bp(g){var l=g,b=g;do(l.x<b.x||l.x===b.x&&l.y<b.y)&&(b=l),l=l.next;while(l!==g);return b}function wa(g,l,b,T,A,I,P,F){return(A-P)*(l-F)-(g-P)*(I-F)>=0&&(g-P)*(T-F)-(b-P)*(l-F)>=0&&(b-P)*(I-F)-(A-P)*(T-F)>=0}function wp(g,l){return g.next.i!==l.i&&g.prev.i!==l.i&&!function(b,T){var A=b;do{if(A.i!==b.i&&A.next.i!==b.i&&A.i!==T.i&&A.next.i!==T.i&&ld(A,A.next,b,T))return!0;A=A.next}while(A!==b);return!1}(g,l)&&(gl(g,l)&&gl(l,g)&&function(b,T){var A=b,I=!1,P=(b.x+T.x)/2,F=(b.y+T.y)/2;do A.y>F!=A.next.y>F&&A.next.y!==A.y&&P<(A.next.x-A.x)*(F-A.y)/(A.next.y-A.y)+A.x&&(I=!I),A=A.next;while(A!==b);return I}(g,l)&&(yr(g.prev,g,l.prev)||yr(g,l.prev,l))||Ph(g,l)&&yr(g.prev,g,g.next)>0&&yr(l.prev,l,l.next)>0)}function yr(g,l,b){return(l.y-g.y)*(b.x-l.x)-(l.x-g.x)*(b.y-l.y)}function Ph(g,l){return g.x===l.x&&g.y===l.y}function ld(g,l,b,T){var A=Bh(yr(g,l,b)),I=Bh(yr(g,l,T)),P=Bh(yr(b,T,g)),F=Bh(yr(b,T,l));return A!==I&&P!==F||!(A!==0||!Rh(g,b,l))||!(I!==0||!Rh(g,T,l))||!(P!==0||!Rh(b,g,T))||!(F!==0||!Rh(b,l,T))}function Rh(g,l,b){return l.x<=Math.max(g.x,b.x)&&l.x>=Math.min(g.x,b.x)&&l.y<=Math.max(g.y,b.y)&&l.y>=Math.min(g.y,b.y)}function Bh(g){return g>0?1:g<0?-1:0}function gl(g,l){return yr(g.prev,g,g.next)<0?yr(g,l,g.next)>=0&&yr(g,g.prev,l)>=0:yr(g,l,g.prev)<0||yr(g,g.next,l)<0}function hd(g,l){var b=new Nc(g.i,g.x,g.y),T=new Nc(l.i,l.x,l.y),A=g.next,I=l.prev;return g.next=l,l.prev=g,b.next=A,A.prev=b,T.next=b,b.prev=T,I.next=T,T.prev=I,T}function cd(g,l,b,T){var A=new Nc(g,l,b);return T?(A.next=T.next,A.prev=T,T.next.prev=A,T.next=A):(A.prev=A,A.next=A),A}function _l(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function Nc(g,l,b){this.i=g,this.x=l,this.y=b,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Uc(g,l,b,T){for(var A=0,I=l,P=b-T;I<b;I+=T)A+=(g[P]-g[I])*(g[I+1]+g[P+1]),P=I;return A}function Ep(g,l,b,T,A){ud(g,l,b||0,T||g.length-1,A||Tp)}function ud(g,l,b,T,A){for(;T>b;){if(T-b>600){var I=T-b+1,P=l-b+1,F=Math.log(I),N=.5*Math.exp(2*F/3),j=.5*Math.sqrt(F*N*(I-N)/I)*(P-I/2<0?-1:1);ud(g,l,Math.max(b,Math.floor(l-P*N/I+j)),Math.min(T,Math.floor(l+(I-P)*N/I+j)),A)}var X=g[l],Y=b,H=T;for(yl(g,b,l),A(g[T],X)>0&&yl(g,b,T);Y<H;){for(yl(g,Y,H),Y++,H--;A(g[Y],X)<0;)Y++;for(;A(g[H],X)>0;)H--}A(g[b],X)===0?yl(g,b,H):yl(g,++H,T),H<=l&&(b=H+1),l<=H&&(T=H-1)}}function yl(g,l,b){var T=g[l];g[l]=g[b],g[b]=T}function Tp(g,l){return g<l?-1:g>l?1:0}function Vc(g,l){const b=g.length;if(b<=1)return[g];const T=[];let A,I;for(let P=0;P<b;P++){const F=sn(g[P]);F!==0&&(g[P].area=Math.abs(F),I===void 0&&(I=F<0),I===F<0?(A&&T.push(A),A=[g[P]]):A.push(g[P]))}if(A&&T.push(A),l>1)for(let P=0;P<T.length;P++)T[P].length<=l||(Ep(T[P],l,1,T[P].length-1,Mp),T[P]=T[P].slice(0,l));return T}function Mp(g,l){return l.area-g.area}function jc(g,l,b){const T=b.patternDependencies;let A=!1;for(const I of l){const P=I.paint.get(`${g}-pattern`);P.isConstant()||(A=!0);const F=P.constantOr(null);F&&(A=!0,T[F.to]=!0,T[F.from]=!0)}return A}function Gc(g,l,b,T,A){const I=A.patternDependencies;for(const P of l){const F=P.paint.get(`${g}-pattern`).value;if(F.kind!=="constant"){let N=F.evaluate({zoom:T-1},b,{},A.availableImages),j=F.evaluate({zoom:T},b,{},A.availableImages),X=F.evaluate({zoom:T+1},b,{},A.availableImages);N=N&&N.name?N.name:N,j=j&&j.name?j.name:j,X=X&&X.name?X.name:X,I[N]=!0,I[j]=!0,I[X]=!0,b.patterns[P.id]={min:N,mid:j,max:X}}}return b}Dh.deviation=function(g,l,b,T){var A=l&&l.length,I=Math.abs(Uc(g,0,A?l[0]*b:g.length,b));if(A)for(var P=0,F=l.length;P<F;P++)I-=Math.abs(Uc(g,l[P]*b,P<F-1?l[P+1]*b:g.length,b));var N=0;for(P=0;P<T.length;P+=3){var j=T[P]*b,X=T[P+1]*b,Y=T[P+2]*b;N+=Math.abs((g[j]-g[Y])*(g[X+1]-g[j+1])-(g[j]-g[X])*(g[Y+1]-g[j+1]))}return I===0&&N===0?0:Math.abs((N-I)/I)},Dh.flatten=function(g){for(var l=g[0][0].length,b={vertices:[],holes:[],dimensions:l},T=0,A=0;A<g.length;A++){for(var I=0;I<g[A].length;I++)for(var P=0;P<l;P++)b.vertices.push(g[A][I][P]);A>0&&b.holes.push(T+=g[A-1].length)}return b},Ch.default=fp;class Lh{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(b=>b.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pa,this.indexArray=new bn,this.indexArray2=new $o,this.programConfigurations=new Ts(l.layers,l.zoom),this.segments=new _r,this.segments2=new _r,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(l,b,T,A){this.hasPattern=jc("fill",this.layers,b);const I=this.layers[0].layout.get("fill-sort-key"),P=[];for(const{feature:F,id:N,index:j,sourceLayerIndex:X}of l){const Y=this.layers[0]._featureFilter.needGeometry,H=Ss(F,Y);if(!this.layers[0]._featureFilter.filter(new di(this.zoom),H,T))continue;const re=I?I.evaluate(H,{},T,b.availableImages):void 0,ue={id:N,properties:F.properties,type:F.type,sourceLayerIndex:X,index:j,geometry:Y?H.geometry:xo(F,T,A),patterns:{},sortKey:re};P.push(ue)}I&&P.sort((F,N)=>F.sortKey-N.sortKey);for(const F of P){const{geometry:N,index:j,sourceLayerIndex:X}=F;if(this.hasPattern){const Y=Gc("fill",this.layers,F,this.zoom,b);this.patternFeatures.push(Y)}else this.addFeature(F,N,j,T,{},b.availableImages);b.featureIndex.insert(l[j].feature,N,j,X,this.index)}}update(l,b,T,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,b,this.stateDependentLayers,T,A)}addFeatures(l,b,T,A){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,b,T,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,dp),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,b,T,A,I,P=[]){for(const F of Vc(b,500)){let N=0;for(const ue of F)N+=ue.length;const j=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray),X=j.vertexLength,Y=[],H=[];for(const ue of F){if(ue.length===0)continue;ue!==F[0]&&H.push(Y.length/2);const me=this.segments2.prepareSegment(ue.length,this.layoutVertexArray,this.indexArray2),be=me.vertexLength;this.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),this.indexArray2.emplaceBack(be+ue.length-1,be),Y.push(ue[0].x),Y.push(ue[0].y);for(let Ie=1;Ie<ue.length;Ie++)this.layoutVertexArray.emplaceBack(ue[Ie].x,ue[Ie].y),this.indexArray2.emplaceBack(be+Ie-1,be+Ie),Y.push(ue[Ie].x),Y.push(ue[Ie].y);me.vertexLength+=ue.length,me.primitiveLength+=ue.length}const re=Ch(Y,H);for(let ue=0;ue<re.length;ue+=3)this.indexArray.emplaceBack(X+re[ue],X+re[ue+1],X+re[ue+2]);j.vertexLength+=N,j.primitiveLength+=re.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,I,P,A)}}Ot("FillBucket",Lh,{omit:["layers","patternFeatures"]});const Sp=new Or({"fill-sort-key":new Qt(tt.layout_fill["fill-sort-key"])});var Ap={paint:new Or({"fill-antialias":new $t(tt.paint_fill["fill-antialias"]),"fill-opacity":new Qt(tt.paint_fill["fill-opacity"]),"fill-color":new Qt(tt.paint_fill["fill-color"]),"fill-outline-color":new Qt(tt.paint_fill["fill-outline-color"]),"fill-translate":new $t(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new kr(tt.paint_fill["fill-pattern"])}),layout:Sp};const Ip=lr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),kp=lr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Cp}=Ip;var dd=Ea;function Ea(g,l,b,T,A){this.properties={},this.extent=b,this.type=0,this._pbf=g,this._geometry=-1,this._keys=T,this._values=A,g.readFields(Dp,this,l)}function Dp(g,l,b){g==1?l.id=b.readVarint():g==2?function(T,A){for(var I=T.readVarint()+T.pos;T.pos<I;){var P=A._keys[T.readVarint()],F=A._values[T.readVarint()];A.properties[P]=F}}(b,l):g==3?l.type=b.readVarint():g==4&&(l._geometry=b.pos)}function Pp(g){for(var l,b,T=0,A=0,I=g.length,P=I-1;A<I;P=A++)T+=((b=g[P]).x-(l=g[A]).x)*(l.y+b.y);return T}Ea.types=["Unknown","Point","LineString","Polygon"],Ea.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var l,b=g.readVarint()+g.pos,T=1,A=0,I=0,P=0,F=[];g.pos<b;){if(A<=0){var N=g.readVarint();T=7&N,A=N>>3}if(A--,T===1||T===2)I+=g.readSVarint(),P+=g.readSVarint(),T===1&&(l&&F.push(l),l=[]),l.push(new U(I,P));else{if(T!==7)throw new Error("unknown command "+T);l&&l.push(l[0].clone())}}return l&&F.push(l),F},Ea.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var l=g.readVarint()+g.pos,b=1,T=0,A=0,I=0,P=1/0,F=-1/0,N=1/0,j=-1/0;g.pos<l;){if(T<=0){var X=g.readVarint();b=7&X,T=X>>3}if(T--,b===1||b===2)(A+=g.readSVarint())<P&&(P=A),A>F&&(F=A),(I+=g.readSVarint())<N&&(N=I),I>j&&(j=I);else if(b!==7)throw new Error("unknown command "+b)}return[P,N,F,j]},Ea.prototype.toGeoJSON=function(g,l,b){var T,A,I=this.extent*Math.pow(2,b),P=this.extent*g,F=this.extent*l,N=this.loadGeometry(),j=Ea.types[this.type];function X(re){for(var ue=0;ue<re.length;ue++){var me=re[ue];re[ue]=[360*(me.x+P)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(me.y+F)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(T=0;T<N.length;T++)Y[T]=N[T][0];X(N=Y);break;case 2:for(T=0;T<N.length;T++)X(N[T]);break;case 3:for(N=function(re){var ue=re.length;if(ue<=1)return[re];for(var me,be,Ie=[],Le=0;Le<ue;Le++){var Ne=Pp(re[Le]);Ne!==0&&(be===void 0&&(be=Ne<0),be===Ne<0?(me&&Ie.push(me),me=[re[Le]]):me.push(re[Le]))}return me&&Ie.push(me),Ie}(N),T=0;T<N.length;T++)for(A=0;A<N[T].length;A++)X(N[T][A])}N.length===1?N=N[0]:j="Multi"+j;var H={type:"Feature",geometry:{type:j,coordinates:N},properties:this.properties};return"id"in this&&(H.id=this.id),H};var fd=pd;function pd(g,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(Rp,this,l),this.length=this._features.length}function Rp(g,l,b){g===15?l.version=b.readVarint():g===1?l.name=b.readString():g===5?l.extent=b.readVarint():g===2?l._features.push(b.pos):g===3?l._keys.push(b.readString()):g===4&&l._values.push(function(T){for(var A=null,I=T.readVarint()+T.pos;T.pos<I;){var P=T.readVarint()>>3;A=P===1?T.readString():P===2?T.readFloat():P===3?T.readDouble():P===4?T.readVarint64():P===5?T.readVarint():P===6?T.readSVarint():P===7?T.readBoolean():null}return A}(b))}function Bp(g,l,b){if(g===3){var T=new fd(b,b.readVarint()+b.pos);T.length&&(l[T.name]=T)}}pd.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var l=this._pbf.readVarint()+this._pbf.pos;return new dd(this._pbf,l,this.extent,this._keys,this._values)};var As={VectorTile:function(g,l){this.layers=g.readFields(Bp,{},l)},VectorTileFeature:dd,VectorTileLayer:fd};const Lp=As.VectorTileFeature.types,zp=Math.pow(2,13);function xl(g,l,b,T,A,I,P,F){g.emplaceBack((l<<1)+P,(b<<1)+I,(Math.floor(T*zp)<<1)+A,Math.round(F))}class md{constructor(){this.acc=new U(0,0),this.polyCount=[]}startRing(l){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new U(l.x,l.y),this.max=new U(l.x,l.y))}append(l,b){this.currentPolyCount.edges++,this.acc._add(l);let T=!!this.borders;const A=this.min,I=this.max;l.x<A.x?(A.x=l.x,T=!0):l.x>I.x&&(I.x=l.x,T=!0),l.y<A.y?(A.y=l.y,T=!0):l.y>I.y&&(I.y=l.y,T=!0),((l.x===0||l.x===Si)&&l.x===b.x)!=((l.y===0||l.y===Si)&&l.y===b.y)&&this.processBorderOverlap(l,b),T&&this.checkBorderIntersection(l,b)}checkBorderIntersection(l,b){b.x<0!=l.x<0&&this.addBorderIntersection(0,Gi(b.y,l.y,(0-b.x)/(l.x-b.x))),b.x>Si!=l.x>Si&&this.addBorderIntersection(1,Gi(b.y,l.y,(Si-b.x)/(l.x-b.x))),b.y<0!=l.y<0&&this.addBorderIntersection(2,Gi(b.x,l.x,(0-b.y)/(l.y-b.y))),b.y>Si!=l.y>Si&&this.addBorderIntersection(3,Gi(b.x,l.x,(Si-b.y)/(l.y-b.y)))}addBorderIntersection(l,b){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const T=this.borders[l];b<T[0]&&(T[0]=b),b>T[1]&&(T[1]=b)}processBorderOverlap(l,b){if(l.x===b.x){if(l.y===b.y)return;const T=l.x===0?0:1;this.addBorderIntersection(T,b.y),this.addBorderIntersection(T,l.y)}else{const T=l.y===0?2:3;this.addBorderIntersection(T,b.x),this.addBorderIntersection(T,l.x)}}centroid(){const l=this.polyCount.reduce((b,T)=>b+T.edges,0);return l!==0?this.acc.div(l)._round():new U(0,0)}span(){return new U(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((l,b)=>l+ +(b[0]!==Number.MAX_VALUE),0)}}class qc{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(b=>b.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new ma,this.centroidVertexArray=new $u,this.indexArray=new bn,this.programConfigurations=new Ts(l.layers,l.zoom),this.segments=new _r,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.enableTerrain=l.enableTerrain}populate(l,b,T,A){this.features=[],this.hasPattern=jc("fill-extrusion",this.layers,b),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(I){const P=Math.exp(Math.PI*(1-I.y/(1<<I.z)*2));return 80150034*P/(P*P+1)/Si/(1<<I.z)}(T);for(const{feature:I,id:P,index:F,sourceLayerIndex:N}of l){const j=this.layers[0]._featureFilter.needGeometry,X=Ss(I,j);if(!this.layers[0]._featureFilter.filter(new di(this.zoom),X,T))continue;const Y={id:P,sourceLayerIndex:N,index:F,geometry:j?X.geometry:xo(I,T,A),properties:I.properties,type:I.type,patterns:{}},H=this.layoutVertexArray.length;this.hasPattern?this.features.push(Gc("fill-extrusion",this.layers,Y,this.zoom,b)):this.addFeature(Y,Y.geometry,F,T,{},b.availableImages),b.featureIndex.insert(I,Y.geometry,F,N,this.index,H)}this.sortBorders()}addFeatures(l,b,T,A){for(const I of this.features){const{geometry:P}=I;this.addFeature(I,P,I.index,b,T,A)}this.sortBorders()}update(l,b,T,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,b,this.stateDependentLayers,T,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Cp),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,kp.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,b,T,A,I,P){const F=this.enableTerrain?new md:null;for(const j of Vc(b,500)){let X=0,Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(j.length===0||(N=j[0]).every(be=>be.x<=0)||N.every(be=>be.x>=Si)||N.every(be=>be.y<=0)||N.every(be=>be.y>=Si))continue;for(let be=0;be<j.length;be++){const Ie=j[be];if(Ie.length===0)continue;X+=Ie.length;let Le=0;F&&F.startRing(Ie[0]);for(let Ne=0;Ne<Ie.length;Ne++){const je=Ie[Ne];if(Ne>=1){const qe=Ie[Ne-1];if(!Fp(je,qe)){F&&F.append(je,qe),Y.vertexLength+4>_r.MAX_VERTEX_ARRAY_LENGTH&&(Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ye=je.sub(qe)._perp(),ot=Ye.x/(Math.abs(Ye.x)+Math.abs(Ye.y)),rt=Ye.y>0?1:0,wt=qe.dist(je);Le+wt>32768&&(Le=0),xl(this.layoutVertexArray,je.x,je.y,ot,rt,0,0,Le),xl(this.layoutVertexArray,je.x,je.y,ot,rt,0,1,Le),Le+=wt,xl(this.layoutVertexArray,qe.x,qe.y,ot,rt,0,0,Le),xl(this.layoutVertexArray,qe.x,qe.y,ot,rt,0,1,Le);const gt=Y.vertexLength;this.indexArray.emplaceBack(gt,gt+2,gt+1),this.indexArray.emplaceBack(gt+1,gt+2,gt+3),Y.vertexLength+=4,Y.primitiveLength+=2}}}}if(Y.vertexLength+X>_r.MAX_VERTEX_ARRAY_LENGTH&&(Y=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray)),Lp[l.type]!=="Polygon")continue;const H=[],re=[],ue=Y.vertexLength;for(let be=0;be<j.length;be++){const Ie=j[be];if(Ie.length!==0){Ie!==j[0]&&re.push(H.length/2);for(let Le=0;Le<Ie.length;Le++){const Ne=Ie[Le];xl(this.layoutVertexArray,Ne.x,Ne.y,0,0,1,1,0),H.push(Ne.x),H.push(Ne.y),F&&F.currentPolyCount.top++}}}const me=Ch(H,re);for(let be=0;be<me.length;be+=3)this.indexArray.emplaceBack(ue+me[be],ue+me[be+2],ue+me[be+1]);Y.primitiveLength+=me.length/3,Y.vertexLength+=X}var N;if(F&&F.polyCount.length>0){if(F.borders){F.vertexArrayOffset=this.centroidVertexArray.length;const j=F.borders,X=this.featuresOnBorder.push(F)-1;for(let Y=0;Y<4;Y++)j[Y][0]!==Number.MAX_VALUE&&this.borders[Y].push(X)}this.encodeCentroid(F.borders?void 0:F.centroid(),F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,I,P,A)}sortBorders(){for(let l=0;l<4;l++)this.borders[l].sort((b,T)=>this.featuresOnBorder[b].borders[l][0]-this.featuresOnBorder[T].borders[l][0])}encodeCentroid(l,b,T=!0){let A,I;if(l)if(l.y!==0){const F=b.span()._mult(this.tileToMeter);A=(Math.max(l.x,1)<<3)+Math.min(7,Math.round(F.x/10)),I=(Math.max(l.y,1)<<3)+Math.min(7,Math.round(F.y/10))}else A=Math.ceil(7*(l.x+450)),I=0;else A=0,I=+T;let P=T?this.centroidVertexArray.length:b.vertexArrayOffset;for(const F of b.polyCount){T&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*F.edges+F.top);for(let N=0;N<2*F.edges;N++)this.centroidVertexArray.emplace(P++,0,I),this.centroidVertexArray.emplace(P++,A,I);for(let N=0;N<F.top;N++)this.centroidVertexArray.emplace(P++,A,I)}}}function Fp(g,l){return g.x===l.x&&(g.x<0||g.x>Si)||g.y===l.y&&(g.y<0||g.y>Si)}Ot("FillExtrusionBucket",qc,{omit:["layers","features"]}),Ot("PartMetadata",md);var Op={paint:new Or({"fill-extrusion-opacity":new $t(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kr(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qt(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function vl(g,l){return g.x*l.x+g.y*l.y}function gd(g,l){if(g.length===1){let b=0;const T=l[b++];let A;for(;!A||T.equals(A);)if(A=l[b++],!A)return 1/0;for(;b<l.length;b++){const I=l[b],P=g[0],F=A.sub(T),N=I.sub(T),j=P.sub(T),X=vl(F,F),Y=vl(F,N),H=vl(N,N),re=vl(j,F),ue=vl(j,N),me=X*H-Y*Y,be=(H*re-Y*ue)/me,Ie=(X*ue-Y*re)/me,Le=T.z*(1-be-Ie)+A.z*be+I.z*Ie;if(isFinite(Le))return Le}return 1/0}{let b=1/0;for(const T of l)b=Math.min(b,T.z);return b}}function _d(g){const l=new U(g[0],g[1]);return l.z=g[2],l}function $p(g,l,b,T,A,I,P,F){const N=P*A.getElevationAt(g,l,!0,!0),j=I[0]!==0,X=j?I[1]===0?P*(I[0]/7-450):P*function(Y,H,re){const ue=Math.floor(H[0]/8),me=Math.floor(H[1]/8),be=10*(H[0]-8*ue),Ie=10*(H[1]-8*me),Le=Y.getElevationAt(ue,me,!0,!0),Ne=Y.getMeterToDEM(re),je=Math.floor(.5*(be*Ne-1)),qe=Math.floor(.5*(Ie*Ne-1)),Ye=Y.tileCoordToPixel(ue,me),ot=2*je+1,rt=2*qe+1,wt=function(zt,Nt,Ri,tr,zi){return[zt.getElevationAtPixel(Nt,Ri,!0),zt.getElevationAtPixel(Nt+zi,Ri,!0),zt.getElevationAtPixel(Nt,Ri+zi,!0),zt.getElevationAtPixel(Nt+tr,Ri+zi,!0)]}(Y,Ye.x-je,Ye.y-qe,ot,rt),gt=Math.abs(wt[0]-wt[1]),nt=Math.abs(wt[2]-wt[3]),_t=Math.abs(wt[0]-wt[2])+Math.abs(wt[1]-wt[3]),Tt=Math.min(.25,.5*Ne*(gt+nt)/ot),ht=Math.min(.25,.5*Ne*_t/rt);return Le+Math.max(Tt*be,ht*Ie)}(A,I,F):N;return{base:N+(b===0)?-1:b,top:j?Math.max(X+T,N+b+2):N+T}}const Np=lr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Up}=Np,Vp=lr([{name:"a_packed",components:3,type:"Float32"}]),{members:jp}=Vp,Gp=As.VectorTileFeature.types,qp=Math.cos(Math.PI/180*37.5);class zh{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(b=>b.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(b=>{this.gradients[b.id]={}}),this.layoutVertexArray=new gc,this.layoutVertexArray2=new ga,this.indexArray=new bn,this.programConfigurations=new Ts(l.layers,l.zoom),this.segments=new _r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(l,b,T,A){this.hasPattern=jc("line",this.layers,b);const I=this.layers[0].layout.get("line-sort-key"),P=[];for(const{feature:X,id:Y,index:H,sourceLayerIndex:re}of l){const ue=this.layers[0]._featureFilter.needGeometry,me=Ss(X,ue);if(!this.layers[0]._featureFilter.filter(new di(this.zoom),me,T))continue;const be=I?I.evaluate(me,{},T):void 0,Ie={id:Y,properties:X.properties,type:X.type,sourceLayerIndex:re,index:H,geometry:ue?me.geometry:xo(X,T,A),patterns:{},sortKey:be};P.push(Ie)}I&&P.sort((X,Y)=>X.sortKey-Y.sortKey);const{lineAtlas:F,featureIndex:N}=b,j=this.addConstantDashes(F);for(const X of P){const{geometry:Y,index:H,sourceLayerIndex:re}=X;if(j&&this.addFeatureDashes(X,F),this.hasPattern){const ue=Gc("line",this.layers,X,this.zoom,b);this.patternFeatures.push(ue)}else this.addFeature(X,Y,H,T,F.positions,b.availableImages);N.insert(l[H].feature,Y,H,re,this.index)}}addConstantDashes(l){let b=!1;for(const T of this.layers){const A=T.paint.get("line-dasharray").value,I=T.layout.get("line-cap").value;if(A.kind!=="constant"||I.kind!=="constant")b=!0;else{const P=I.value,F=A.value;if(!F)continue;l.addDash(F.from,P),l.addDash(F.to,P),F.other&&l.addDash(F.other,P)}}return b}addFeatureDashes(l,b){const T=this.zoom;for(const A of this.layers){const I=A.paint.get("line-dasharray").value,P=A.layout.get("line-cap").value;if(I.kind==="constant"&&P.kind==="constant")continue;let F,N,j,X,Y,H;if(I.kind==="constant"){const be=I.value;if(!be)continue;F=be.other||be.to,N=be.to,j=be.from}else F=I.evaluate({zoom:T-1},l),N=I.evaluate({zoom:T},l),j=I.evaluate({zoom:T+1},l);P.kind==="constant"?X=Y=H=P.value:(X=P.evaluate({zoom:T-1},l),Y=P.evaluate({zoom:T},l),H=P.evaluate({zoom:T+1},l)),b.addDash(F,X),b.addDash(N,Y),b.addDash(j,H);const re=b.getKey(F,X),ue=b.getKey(N,Y),me=b.getKey(j,H);l.patterns[A.id]={min:re,mid:ue,max:me}}}update(l,b,T,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,b,this.stateDependentLayers,T,A)}addFeatures(l,b,T,A){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,b,T,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,jp)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Up),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&l.properties.hasOwnProperty("mapbox_clip_start")&&l.properties.hasOwnProperty("mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,b,T,A,I,P){const F=this.layers[0].layout,N=F.get("line-join").evaluate(l,{}),j=F.get("line-cap").evaluate(l,{}),X=F.get("line-miter-limit"),Y=F.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const H of b)this.addLine(H,l,N,j,X,Y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,I,P,A)}addLine(l,b,T,A,I,P){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<l.length-1;Ie++)this.totalDistance+=l[Ie].dist(l[Ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=Gp[b.type]==="Polygon";let N=l.length;for(;N>=2&&l[N-1].equals(l[N-2]);)N--;let j=0;for(;j<N-1&&l[j].equals(l[j+1]);)j++;if(N<(F?3:2))return;T==="bevel"&&(I=1.05);const X=this.overscaling<=16?122880/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let H,re,ue,me,be;this.e1=this.e2=-1,F&&(H=l[N-2],be=l[j].sub(H)._unit()._perp());for(let Ie=j;Ie<N;Ie++){if(ue=Ie===N-1?F?l[j+1]:void 0:l[Ie+1],ue&&l[Ie].equals(ue))continue;be&&(me=be),H&&(re=H),H=l[Ie],be=ue?ue.sub(H)._unit()._perp():me,me=me||be;let Le=me.add(be);Le.x===0&&Le.y===0||Le._unit();const Ne=me.x*be.x+me.y*be.y,je=Le.x*be.x+Le.y*be.y,qe=je!==0?1/je:1/0,Ye=2*Math.sqrt(2-2*je),ot=je<qp&&re&&ue,rt=me.x*be.y-me.y*be.x>0;if(ot&&Ie>j){const nt=H.dist(re);if(nt>2*X){const _t=H.sub(H.sub(re)._mult(X/nt)._round());this.updateDistance(re,_t),this.addCurrentVertex(_t,me,0,0,Y),re=_t}}const wt=re&&ue;let gt=wt?T:F?"butt":A;if(wt&&gt==="round"&&(qe<P?gt="miter":qe<=2&&(gt="fakeround")),gt==="miter"&&qe>I&&(gt="bevel"),gt==="bevel"&&(qe>2&&(gt="flipbevel"),qe<I&&(gt="miter")),re&&this.updateDistance(re,H),gt==="miter")Le._mult(qe),this.addCurrentVertex(H,Le,0,0,Y);else if(gt==="flipbevel"){if(qe>100)Le=be.mult(-1);else{const nt=qe*me.add(be).mag()/me.sub(be).mag();Le._perp()._mult(nt*(rt?-1:1))}this.addCurrentVertex(H,Le,0,0,Y),this.addCurrentVertex(H,Le.mult(-1),0,0,Y)}else if(gt==="bevel"||gt==="fakeround"){const nt=-Math.sqrt(qe*qe-1),_t=rt?nt:0,Tt=rt?0:nt;if(re&&this.addCurrentVertex(H,me,_t,Tt,Y),gt==="fakeround"){const ht=Math.round(180*Ye/Math.PI/20);for(let zt=1;zt<ht;zt++){let Nt=zt/ht;if(Nt!==.5){const tr=Nt-.5;Nt+=Nt*tr*(Nt-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*tr*tr+(.848013+Ne*(.215638*Ne-1.06021)))}const Ri=be.sub(me)._mult(Nt)._add(me)._unit()._mult(rt?-1:1);this.addHalfVertex(H,Ri.x,Ri.y,!1,rt,0,Y)}}ue&&this.addCurrentVertex(H,be,-_t,-Tt,Y)}else if(gt==="butt")this.addCurrentVertex(H,Le,0,0,Y);else if(gt==="square"){const nt=re?1:-1;re||this.addCurrentVertex(H,Le,nt,nt,Y),this.addCurrentVertex(H,Le,0,0,Y),re&&this.addCurrentVertex(H,Le,nt,nt,Y)}else gt==="round"&&(re&&(this.addCurrentVertex(H,me,0,0,Y),this.addCurrentVertex(H,me,1,1,Y,!0)),ue&&(this.addCurrentVertex(H,be,-1,-1,Y,!0),this.addCurrentVertex(H,be,0,0,Y)));if(ot&&Ie<N-1){const nt=H.dist(ue);if(nt>2*X){const _t=H.add(ue.sub(H)._mult(X/nt)._round());this.updateDistance(H,_t),this.addCurrentVertex(_t,be,0,0,Y),H=_t}}}}addCurrentVertex(l,b,T,A,I,P=!1){const F=b.y*A-b.x,N=-b.y-b.x*A;this.addHalfVertex(l,b.x+b.y*T,b.y-b.x*T,P,!1,T,I),this.addHalfVertex(l,F,N,P,!0,-A,I)}addHalfVertex({x:l,y:b},T,A,I,P,F,N){this.layoutVertexArray.emplaceBack((l<<1)+(I?1:0),(b<<1)+(P?1:0),Math.round(63*T)+128,Math.round(63*A)+128,1+(F===0?0:F<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const j=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),N.primitiveLength++),P?this.e2=j:this.e1=j}updateScaledDistance(){if(this.lineClips){const l=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=l*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(l,b){this.distance+=l.dist(b),this.updateScaledDistance()}}Ot("LineBucket",zh,{omit:["layers","patternFeatures"]});const Zp=new Or({"line-cap":new Qt(tt.layout_line["line-cap"]),"line-join":new Qt(tt.layout_line["line-join"]),"line-miter-limit":new $t(tt.layout_line["line-miter-limit"]),"line-round-limit":new $t(tt.layout_line["line-round-limit"]),"line-sort-key":new Qt(tt.layout_line["line-sort-key"])});var yd={paint:new Or({"line-opacity":new Qt(tt.paint_line["line-opacity"]),"line-color":new Qt(tt.paint_line["line-color"]),"line-translate":new $t(tt.paint_line["line-translate"]),"line-translate-anchor":new $t(tt.paint_line["line-translate-anchor"]),"line-width":new Qt(tt.paint_line["line-width"]),"line-gap-width":new Qt(tt.paint_line["line-gap-width"]),"line-offset":new Qt(tt.paint_line["line-offset"]),"line-blur":new Qt(tt.paint_line["line-blur"]),"line-dasharray":new kr(tt.paint_line["line-dasharray"]),"line-pattern":new kr(tt.paint_line["line-pattern"]),"line-gradient":new io(tt.paint_line["line-gradient"])}),layout:Zp};const xd=new class extends Qt{possiblyEvaluate(g,l){return l=new di(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(g,l)}evaluate(g,l,b,T){return l=Kt({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(g,l,b,T)}}(yd.paint.properties["line-width"].specification);function vd(g,l){return l>0?l+2*g:g}xd.useIntegerZoom=!0;const Xp=lr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Yp=lr([{name:"a_projected_pos",components:3,type:"Float32"}],4);lr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hp=lr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wp=lr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);lr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bd=lr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kp=lr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);lr([{name:"triangle",components:3,type:"Uint16"}]),lr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),lr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),lr([{type:"Float32",name:"offsetX"}]),lr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ur=24;const no=128;function Zc(g,l){const{expression:b}=l;if(b.kind==="constant")return{kind:"constant",layoutSize:b.evaluate(new di(g+1))};if(b.kind==="source")return{kind:"source"};{const{zoomStops:T,interpolationType:A}=b;let I=0;for(;I<T.length&&T[I]<=g;)I++;I=Math.max(0,I-1);let P=I;for(;P<T.length&&T[P]<g+1;)P++;P=Math.min(T.length-1,P);const F=T[I],N=T[P];return b.kind==="composite"?{kind:"composite",minZoom:F,maxZoom:N,interpolationType:A}:{kind:"camera",minZoom:F,maxZoom:N,minSize:b.evaluate(new di(F)),maxSize:b.evaluate(new di(N)),interpolationType:A}}}function Fh(g,{uSize:l,uSizeT:b},{lowerSize:T,upperSize:A}){return g.kind==="source"?T/no:g.kind==="composite"?Gi(T/no,A/no,b):l}function Ta(g,l){let b=0,T=0;if(g.kind==="constant")T=g.layoutSize;else if(g.kind!=="source"){const{interpolationType:A,minZoom:I,maxZoom:P}=g,F=A?Rt(Yr.interpolationFactor(A,l,I,P),0,1):0;g.kind==="camera"?T=Gi(g.minSize,g.maxSize,F):b=F}return{uSizeT:b,uSize:T}}var Jp=Object.freeze({__proto__:null,getSizeData:Zc,evaluateSizeForFeature:Fh,evaluateSizeForZoom:Ta,SIZE_PACK_FACTOR:no});function Qp(g,l,b){return g.sections.forEach(T=>{T.text=function(A,I,P){const F=I.layout.get("text-transform").evaluate(P,{});return F==="uppercase"?A=A.toLocaleUpperCase():F==="lowercase"&&(A=A.toLocaleLowerCase()),Li.applyArabicShaping&&(A=Li.applyArabicShaping(A)),A}(T.text,l,b)}),g}const bl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function em(g){return g==="\uFE36"||g==="\uFE48"||g==="\uFE38"||g==="\uFE44"||g==="\uFE42"||g==="\uFE3E"||g==="\uFE3C"||g==="\uFE3A"||g==="\uFE18"||g==="\uFE40"||g==="\uFE10"||g==="\uFE13"||g==="\uFE14"||g==="\uFF40"||g==="\uFFE3"||g==="\uFE11"||g==="\uFE12"}function tm(g){return g==="\uFE35"||g==="\uFE47"||g==="\uFE37"||g==="\uFE43"||g==="\uFE41"||g==="\uFE3D"||g==="\uFE3B"||g==="\uFE39"||g==="\uFE17"||g==="\uFE3F"}var wd=function(g,l,b,T,A){var I,P,F=8*A-T-1,N=(1<<F)-1,j=N>>1,X=-7,Y=b?A-1:0,H=b?-1:1,re=g[l+Y];for(Y+=H,I=re&(1<<-X)-1,re>>=-X,X+=F;X>0;I=256*I+g[l+Y],Y+=H,X-=8);for(P=I&(1<<-X)-1,I>>=-X,X+=T;X>0;P=256*P+g[l+Y],Y+=H,X-=8);if(I===0)I=1-j;else{if(I===N)return P?NaN:1/0*(re?-1:1);P+=Math.pow(2,T),I-=j}return(re?-1:1)*P*Math.pow(2,I-T)},Ed=function(g,l,b,T,A,I){var P,F,N,j=8*I-A-1,X=(1<<j)-1,Y=X>>1,H=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=T?0:I-1,ue=T?1:-1,me=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(F=isNaN(l)?1:0,P=X):(P=Math.floor(Math.log(l)/Math.LN2),l*(N=Math.pow(2,-P))<1&&(P--,N*=2),(l+=P+Y>=1?H/N:H*Math.pow(2,1-Y))*N>=2&&(P++,N/=2),P+Y>=X?(F=0,P=X):P+Y>=1?(F=(l*N-1)*Math.pow(2,A),P+=Y):(F=l*Math.pow(2,Y-1)*Math.pow(2,A),P=0));A>=8;g[b+re]=255&F,re+=ue,F/=256,A-=8);for(P=P<<A|F,j+=A;j>0;g[b+re]=255&P,re+=ue,P/=256,j-=8);g[b+re-ue]|=128*me},wl=er;function er(g){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(g)?g:new Uint8Array(g||0),this.pos=0,this.type=0,this.length=this.buf.length}er.Varint=0,er.Fixed64=1,er.Bytes=2,er.Fixed32=5;var Xc=4294967296,Td=1/Xc,Md=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function vo(g){return g.type===er.Bytes?g.readVarint()+g.pos:g.pos+1}function Ma(g,l,b){return b?4294967296*l+(g>>>0):4294967296*(l>>>0)+(g>>>0)}function Sd(g,l,b){var T=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));b.realloc(T);for(var A=b.pos-1;A>=g;A--)b.buf[A+T]=b.buf[A]}function im(g,l){for(var b=0;b<g.length;b++)l.writeVarint(g[b])}function rm(g,l){for(var b=0;b<g.length;b++)l.writeSVarint(g[b])}function nm(g,l){for(var b=0;b<g.length;b++)l.writeFloat(g[b])}function om(g,l){for(var b=0;b<g.length;b++)l.writeDouble(g[b])}function sm(g,l){for(var b=0;b<g.length;b++)l.writeBoolean(g[b])}function am(g,l){for(var b=0;b<g.length;b++)l.writeFixed32(g[b])}function lm(g,l){for(var b=0;b<g.length;b++)l.writeSFixed32(g[b])}function hm(g,l){for(var b=0;b<g.length;b++)l.writeFixed64(g[b])}function cm(g,l){for(var b=0;b<g.length;b++)l.writeSFixed64(g[b])}function Oh(g,l){return(g[l]|g[l+1]<<8|g[l+2]<<16)+16777216*g[l+3]}function Sa(g,l,b){g[b]=l,g[b+1]=l>>>8,g[b+2]=l>>>16,g[b+3]=l>>>24}function Ad(g,l){return(g[l]|g[l+1]<<8|g[l+2]<<16)+(g[l+3]<<24)}function um(g,l,b){l.glyphs=[],g===1&&b.readMessage(dm,l)}function dm(g,l,b){if(g===3){const{id:T,bitmap:A,width:I,height:P,left:F,top:N,advance:j}=b.readMessage(fm,{});l.glyphs.push({id:T,bitmap:new Uo({width:I+6,height:P+6},A),metrics:{width:I,height:P,left:F,top:N,advance:j}})}else g===4?l.ascender=b.readSVarint():g===5&&(l.descender=b.readSVarint())}function fm(g,l,b){g===1?l.id=b.readVarint():g===2?l.bitmap=b.readBytes():g===3?l.width=b.readVarint():g===4?l.height=b.readVarint():g===5?l.left=b.readSVarint():g===6?l.top=b.readSVarint():g===7&&(l.advance=b.readVarint())}function Yc(g){let l=0,b=0;for(const P of g)l+=P.w*P.h,b=Math.max(b,P.w);g.sort((P,F)=>F.h-P.h);const T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),b),h:1/0}];let A=0,I=0;for(const P of g)for(let F=T.length-1;F>=0;F--){const N=T[F];if(!(P.w>N.w||P.h>N.h)){if(P.x=N.x,P.y=N.y,I=Math.max(I,P.y+P.h),A=Math.max(A,P.x+P.w),P.w===N.w&&P.h===N.h){const j=T.pop();F<T.length&&(T[F]=j)}else P.h===N.h?(N.x+=P.w,N.w-=P.w):P.w===N.w?(N.y+=P.h,N.h-=P.h):(T.push({x:N.x+P.w,y:N.y,w:N.w-P.w,h:P.h}),N.y+=P.h,N.h-=P.h);break}}return{w:A,h:I,fill:l/(A*I)||0}}er.prototype={destroy:function(){this.buf=null},readFields:function(g,l,b){for(b=b||this.length;this.pos<b;){var T=this.readVarint(),A=T>>3,I=this.pos;this.type=7&T,g(A,l,this),this.pos===I&&this.skip(T)}return l},readMessage:function(g,l){return this.readFields(g,l,this.readVarint()+this.pos)},readFixed32:function(){var g=Oh(this.buf,this.pos);return this.pos+=4,g},readSFixed32:function(){var g=Ad(this.buf,this.pos);return this.pos+=4,g},readFixed64:function(){var g=Oh(this.buf,this.pos)+Oh(this.buf,this.pos+4)*Xc;return this.pos+=8,g},readSFixed64:function(){var g=Oh(this.buf,this.pos)+Ad(this.buf,this.pos+4)*Xc;return this.pos+=8,g},readFloat:function(){var g=wd(this.buf,this.pos,!0,23,4);return this.pos+=4,g},readDouble:function(){var g=wd(this.buf,this.pos,!0,52,8);return this.pos+=8,g},readVarint:function(g){var l,b,T=this.buf;return l=127&(b=T[this.pos++]),b<128?l:(l|=(127&(b=T[this.pos++]))<<7,b<128?l:(l|=(127&(b=T[this.pos++]))<<14,b<128?l:(l|=(127&(b=T[this.pos++]))<<21,b<128?l:function(A,I,P){var F,N,j=P.buf;if(F=(112&(N=j[P.pos++]))>>4,N<128||(F|=(127&(N=j[P.pos++]))<<3,N<128)||(F|=(127&(N=j[P.pos++]))<<10,N<128)||(F|=(127&(N=j[P.pos++]))<<17,N<128)||(F|=(127&(N=j[P.pos++]))<<24,N<128)||(F|=(1&(N=j[P.pos++]))<<31,N<128))return Ma(A,F,I);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(b=T[this.pos]))<<28,g,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var g=this.readVarint();return g%2==1?(g+1)/-2:g/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var g=this.readVarint()+this.pos,l=this.pos;return this.pos=g,g-l>=12&&Md?function(b,T,A){return Md.decode(b.subarray(T,A))}(this.buf,l,g):function(b,T,A){for(var I="",P=T;P<A;){var F,N,j,X=b[P],Y=null,H=X>239?4:X>223?3:X>191?2:1;if(P+H>A)break;H===1?X<128&&(Y=X):H===2?(192&(F=b[P+1]))==128&&(Y=(31&X)<<6|63&F)<=127&&(Y=null):H===3?(N=b[P+2],(192&(F=b[P+1]))==128&&(192&N)==128&&((Y=(15&X)<<12|(63&F)<<6|63&N)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):H===4&&(N=b[P+2],j=b[P+3],(192&(F=b[P+1]))==128&&(192&N)==128&&(192&j)==128&&((Y=(15&X)<<18|(63&F)<<12|(63&N)<<6|63&j)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,H=1):Y>65535&&(Y-=65536,I+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),I+=String.fromCharCode(Y),P+=H}return I}(this.buf,l,g)},readBytes:function(){var g=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,g);return this.pos=g,l},readPackedVarint:function(g,l){if(this.type!==er.Bytes)return g.push(this.readVarint(l));var b=vo(this);for(g=g||[];this.pos<b;)g.push(this.readVarint(l));return g},readPackedSVarint:function(g){if(this.type!==er.Bytes)return g.push(this.readSVarint());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readSVarint());return g},readPackedBoolean:function(g){if(this.type!==er.Bytes)return g.push(this.readBoolean());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readBoolean());return g},readPackedFloat:function(g){if(this.type!==er.Bytes)return g.push(this.readFloat());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readFloat());return g},readPackedDouble:function(g){if(this.type!==er.Bytes)return g.push(this.readDouble());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readDouble());return g},readPackedFixed32:function(g){if(this.type!==er.Bytes)return g.push(this.readFixed32());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readFixed32());return g},readPackedSFixed32:function(g){if(this.type!==er.Bytes)return g.push(this.readSFixed32());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readSFixed32());return g},readPackedFixed64:function(g){if(this.type!==er.Bytes)return g.push(this.readFixed64());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readFixed64());return g},readPackedSFixed64:function(g){if(this.type!==er.Bytes)return g.push(this.readSFixed64());var l=vo(this);for(g=g||[];this.pos<l;)g.push(this.readSFixed64());return g},skip:function(g){var l=7&g;if(l===er.Varint)for(;this.buf[this.pos++]>127;);else if(l===er.Bytes)this.pos=this.readVarint()+this.pos;else if(l===er.Fixed32)this.pos+=4;else{if(l!==er.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(g,l){this.writeVarint(g<<3|l)},realloc:function(g){for(var l=this.length||16;l<this.pos+g;)l*=2;if(l!==this.length){var b=new Uint8Array(l);b.set(this.buf),this.buf=b,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(g){this.realloc(4),Sa(this.buf,g,this.pos),this.pos+=4},writeSFixed32:function(g){this.realloc(4),Sa(this.buf,g,this.pos),this.pos+=4},writeFixed64:function(g){this.realloc(8),Sa(this.buf,-1&g,this.pos),Sa(this.buf,Math.floor(g*Td),this.pos+4),this.pos+=8},writeSFixed64:function(g){this.realloc(8),Sa(this.buf,-1&g,this.pos),Sa(this.buf,Math.floor(g*Td),this.pos+4),this.pos+=8},writeVarint:function(g){(g=+g||0)>268435455||g<0?function(l,b){var T,A;if(l>=0?(T=l%4294967296|0,A=l/4294967296|0):(A=~(-l/4294967296),4294967295^(T=~(-l%4294967296))?T=T+1|0:(T=0,A=A+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");b.realloc(10),function(I,P,F){F.buf[F.pos++]=127&I|128,I>>>=7,F.buf[F.pos++]=127&I|128,I>>>=7,F.buf[F.pos++]=127&I|128,I>>>=7,F.buf[F.pos++]=127&I|128,F.buf[F.pos]=127&(I>>>=7)}(T,0,b),function(I,P){var F=(7&I)<<4;P.buf[P.pos++]|=F|((I>>>=3)?128:0),I&&(P.buf[P.pos++]=127&I|((I>>>=7)?128:0),I&&(P.buf[P.pos++]=127&I|((I>>>=7)?128:0),I&&(P.buf[P.pos++]=127&I|((I>>>=7)?128:0),I&&(P.buf[P.pos++]=127&I|((I>>>=7)?128:0),I&&(P.buf[P.pos++]=127&I)))))}(A,b)}(g,this):(this.realloc(4),this.buf[this.pos++]=127&g|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=g>>>7&127))))},writeSVarint:function(g){this.writeVarint(g<0?2*-g-1:2*g)},writeBoolean:function(g){this.writeVarint(Boolean(g))},writeString:function(g){g=String(g),this.realloc(4*g.length),this.pos++;var l=this.pos;this.pos=function(T,A,I){for(var P,F,N=0;N<A.length;N++){if((P=A.charCodeAt(N))>55295&&P<57344){if(!F){P>56319||N+1===A.length?(T[I++]=239,T[I++]=191,T[I++]=189):F=P;continue}if(P<56320){T[I++]=239,T[I++]=191,T[I++]=189,F=P;continue}P=F-55296<<10|P-56320|65536,F=null}else F&&(T[I++]=239,T[I++]=191,T[I++]=189,F=null);P<128?T[I++]=P:(P<2048?T[I++]=P>>6|192:(P<65536?T[I++]=P>>12|224:(T[I++]=P>>18|240,T[I++]=P>>12&63|128),T[I++]=P>>6&63|128),T[I++]=63&P|128)}return I}(this.buf,g,this.pos);var b=this.pos-l;b>=128&&Sd(l,b,this),this.pos=l-1,this.writeVarint(b),this.pos+=b},writeFloat:function(g){this.realloc(4),Ed(this.buf,g,this.pos,!0,23,4),this.pos+=4},writeDouble:function(g){this.realloc(8),Ed(this.buf,g,this.pos,!0,52,8),this.pos+=8},writeBytes:function(g){var l=g.length;this.writeVarint(l),this.realloc(l);for(var b=0;b<l;b++)this.buf[this.pos++]=g[b]},writeRawMessage:function(g,l){this.pos++;var b=this.pos;g(l,this);var T=this.pos-b;T>=128&&Sd(b,T,this),this.pos=b-1,this.writeVarint(T),this.pos+=T},writeMessage:function(g,l,b){this.writeTag(g,er.Bytes),this.writeRawMessage(l,b)},writePackedVarint:function(g,l){l.length&&this.writeMessage(g,im,l)},writePackedSVarint:function(g,l){l.length&&this.writeMessage(g,rm,l)},writePackedBoolean:function(g,l){l.length&&this.writeMessage(g,sm,l)},writePackedFloat:function(g,l){l.length&&this.writeMessage(g,nm,l)},writePackedDouble:function(g,l){l.length&&this.writeMessage(g,om,l)},writePackedFixed32:function(g,l){l.length&&this.writeMessage(g,am,l)},writePackedSFixed32:function(g,l){l.length&&this.writeMessage(g,lm,l)},writePackedFixed64:function(g,l){l.length&&this.writeMessage(g,hm,l)},writePackedSFixed64:function(g,l){l.length&&this.writeMessage(g,cm,l)},writeBytesField:function(g,l){this.writeTag(g,er.Bytes),this.writeBytes(l)},writeFixed32Field:function(g,l){this.writeTag(g,er.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(g,l){this.writeTag(g,er.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(g,l){this.writeTag(g,er.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(g,l){this.writeTag(g,er.Fixed64),this.writeSFixed64(l)},writeVarintField:function(g,l){this.writeTag(g,er.Varint),this.writeVarint(l)},writeSVarintField:function(g,l){this.writeTag(g,er.Varint),this.writeSVarint(l)},writeStringField:function(g,l){this.writeTag(g,er.Bytes),this.writeString(l)},writeFloatField:function(g,l){this.writeTag(g,er.Fixed32),this.writeFloat(l)},writeDoubleField:function(g,l){this.writeTag(g,er.Fixed64),this.writeDouble(l)},writeBooleanField:function(g,l){this.writeVarintField(g,Boolean(l))}};class Hc{constructor(l,{pixelRatio:b,version:T,stretchX:A,stretchY:I,content:P}){this.paddedRect=l,this.pixelRatio=b,this.stretchX=A,this.stretchY=I,this.content=P,this.version=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Id{constructor(l,b){const T={},A={};this.haveRenderCallbacks=[];const I=[];this.addImages(l,T,I),this.addImages(b,A,I);const{w:P,h:F}=Yc(I),N=new wn({width:P||1,height:F||1});for(const j in l){const X=l[j],Y=T[j].paddedRect;wn.copy(X.data,N,{x:0,y:0},{x:Y.x+1,y:Y.y+1},X.data)}for(const j in b){const X=b[j],Y=A[j].paddedRect,H=Y.x+1,re=Y.y+1,ue=X.data.width,me=X.data.height;wn.copy(X.data,N,{x:0,y:0},{x:H,y:re},X.data),wn.copy(X.data,N,{x:0,y:me-1},{x:H,y:re-1},{width:ue,height:1}),wn.copy(X.data,N,{x:0,y:0},{x:H,y:re+me},{width:ue,height:1}),wn.copy(X.data,N,{x:ue-1,y:0},{x:H-1,y:re},{width:1,height:me}),wn.copy(X.data,N,{x:0,y:0},{x:H+ue,y:re},{width:1,height:me})}this.image=N,this.iconPositions=T,this.patternPositions=A}addImages(l,b,T){for(const A in l){const I=l[A],P={x:0,y:0,w:I.data.width+2,h:I.data.height+2};T.push(P),b[A]=new Hc(P,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(A)}}patchUpdatedImages(l,b){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const T in l.updatedImages)this.patchUpdatedImage(this.iconPositions[T],l.getImage(T),b),this.patchUpdatedImage(this.patternPositions[T],l.getImage(T),b)}patchUpdatedImage(l,b,T){if(!l||!b||l.version===b.version)return;l.version=b.version;const[A,I]=l.tl;T.update(b.data,void 0,{x:A,y:I})}}Ot("ImagePosition",Hc),Ot("ImageAtlas",Id);const En={horizontal:1,vertical:2,horizontalOnly:3};class El{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,b){const T=new El;return T.scale=l||1,T.fontStack=b,T}static forImage(l){const b=new El;return b.imageName=l,b}}class Aa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,b){const T=new Aa;for(let A=0;A<l.sections.length;A++){const I=l.sections[A];I.image?T.addImageSection(I):T.addTextSection(I,b)}return T}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(l){this.text=function(b,T){let A="";for(let I=0;I<b.length;I++){const P=b.charCodeAt(I+1)||null,F=b.charCodeAt(I-1)||null;A+=!T&&(P&&Yt(P)&&!bl[b[I+1]]||F&&Yt(F)&&!bl[b[I-1]])||!bl[b[I]]?b[I]:bl[b[I]]}return A}(this.text,l)}trim(){let l=0;for(let T=0;T<this.text.length&&$h[this.text.charCodeAt(T)];T++)l++;let b=this.text.length;for(let T=this.text.length-1;T>=0&&T>=l&&$h[this.text.charCodeAt(T)];T--)b--;this.text=this.text.substring(l,b),this.sectionIndex=this.sectionIndex.slice(l,b)}substring(l,b){const T=new Aa;return T.text=this.text.substring(l,b),T.sectionIndex=this.sectionIndex.slice(l,b),T.sections=this.sections,T}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,b)=>Math.max(l,this.sections[b].scale),0)}addTextSection(l,b){this.text+=l.text,this.sections.push(El.forText(l.scale,l.fontStack||b));const T=this.sections.length-1;for(let A=0;A<l.text.length;++A)this.sectionIndex.push(T)}addImageSection(l){const b=l.image?l.image.name:"";if(b.length===0)return void Ii("Can't add FormattedSection with an empty image.");const T=this.getNextImageSectionCharCode();T?(this.text+=String.fromCharCode(T),this.sections.push(El.forImage(b)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wc(g,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me){const be=Aa.fromFeature(g,A);let Ie;Y===En.vertical&&be.verticalizePunctuation(H);const{processBidirectionalText:Le,processStyledBidirectionalText:Ne}=Li;if(Le&&be.sections.length===1){Ie=[];const Ye=Le(be.toString(),Kc(be,j,I,l,T,re,ue));for(const ot of Ye){const rt=new Aa;rt.text=ot,rt.sections=be.sections;for(let wt=0;wt<ot.length;wt++)rt.sectionIndex.push(0);Ie.push(rt)}}else if(Ne){Ie=[];const Ye=Ne(be.text,be.sectionIndex,Kc(be,j,I,l,T,re,ue));for(const ot of Ye){const rt=new Aa;rt.text=ot[0],rt.sectionIndex=ot[1],rt.sections=be.sections,Ie.push(rt)}}else Ie=function(Ye,ot){const rt=[],wt=Ye.text;let gt=0;for(const nt of ot)rt.push(Ye.substring(gt,nt)),gt=nt;return gt<wt.length&&rt.push(Ye.substring(gt,wt.length)),rt}(be,Kc(be,j,I,l,T,re,ue));const je=[],qe={positionedLines:je,text:be.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:Y,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ye,ot,rt,wt,gt,nt,_t,Tt,ht,zt,Nt,Ri){let tr=0,zi=0,Fi=0;const pt=Tt==="right"?1:Tt==="left"?0:.5;let Vi=!1;for(const ji of gt){const Di=ji.getSections();for(const or of Di){if(or.imageName)continue;const vr=ot[or.fontStack];if(vr&&(Vi=vr.ascender!==void 0&&vr.descender!==void 0,!Vi))break}if(!Vi)break}let $i=0;for(const ji of gt){ji.trim();const Di=ji.getMaxScale(),or=(Di-1)*Ur,vr={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[$i]=vr;const dr=vr.positionedGlyphs;let Er=0;if(!ji.length()){zi+=nt,++$i;continue}let Vr=0,nn=0;for(let nr=0;nr<ji.length();nr++){const Dr=ji.getSection(nr),Pn=ji.getSectionIndex(nr),$r=ji.getCharCode(nr);let Ki=Dr.scale,Pr=null,sr=null,qr=null,Mr=Ur,Zr=0;const Kr=!(ht===En.horizontal||!Nt&&!st($r)||Nt&&($h[$r]||(xr=$r,y(xr)||S(xr)||D(xr)||Oe(xr)||ft(xr))));if(Dr.imageName){const Jr=wt[Dr.imageName];if(!Jr)continue;qr=Dr.imageName,Ye.iconsInText=Ye.iconsInText||!0,sr=Jr.paddedRect;const Rr=Jr.displaySize;Ki=Ki*Ur/Ri,Pr={width:Rr[0],height:Rr[1],left:1,top:-3,advance:Kr?Rr[1]:Rr[0],localGlyph:!1},Zr=Vi?-Pr.height*Ki:Di*Ur-17-Rr[1]*Ki,Mr=Pr.advance;const jn=(Kr?Rr[0]:Rr[1])*Ki-Ur*Di;jn>0&&jn>Er&&(Er=jn)}else{const Jr=rt[Dr.fontStack];if(!Jr)continue;Jr[$r]&&(sr=Jr[$r]);const Rr=ot[Dr.fontStack];if(!Rr)continue;const jn=Rr.glyphs[$r];if(!jn)continue;if(Pr=jn.metrics,Mr=$r!==8203?Ur:0,Vi){const Ra=Rr.ascender!==void 0?Math.abs(Rr.ascender):0,Cl=Rr.descender!==void 0?Math.abs(Rr.descender):0,Dl=(Ra+Cl)*Ki;Vr<Dl&&(Vr=Dl,nn=(Ra-Cl)/2*Ki),Zr=-Ra*Ki}else Zr=(Di-Ki)*Ur-17}Kr?(Ye.verticalizable=!0,dr.push({glyph:$r,imageName:qr,x:tr,y:zi+Zr,vertical:Kr,scale:Ki,localGlyph:Pr.localGlyph,fontStack:Dr.fontStack,sectionIndex:Pn,metrics:Pr,rect:sr}),tr+=Mr*Ki+zt):(dr.push({glyph:$r,imageName:qr,x:tr,y:zi+Zr,vertical:Kr,scale:Ki,localGlyph:Pr.localGlyph,fontStack:Dr.fontStack,sectionIndex:Pn,metrics:Pr,rect:sr}),tr+=Pr.advance*Ki+zt)}dr.length!==0&&(Fi=Math.max(tr-zt,Fi),Vi?Rd(dr,pt,Er,nn,nt*Di/2):Rd(dr,pt,Er,0,nt/2)),tr=0;const on=nt*Di+Er;vr.lineOffset=Math.max(Er,or),zi+=on,++$i}var xr;const cr=zi,{horizontalAlign:Cr,verticalAlign:Gr}=Jc(_t);(function(ji,Di,or,vr,dr,Er){const Vr=(Di-or)*dr,nn=-Er*vr;for(const on of ji)for(const nr of on.positionedGlyphs)nr.x+=Vr,nr.y+=nn})(Ye.positionedLines,pt,Cr,Gr,Fi,cr),Ye.top+=-Gr*cr,Ye.bottom=Ye.top+cr,Ye.left+=-Cr*Fi,Ye.right=Ye.left+Fi,Ye.hasBaseline=Vi}(qe,l,b,T,Ie,P,F,N,Y,j,H,me),!function(Ye){for(const ot of Ye)if(ot.positionedGlyphs.length!==0)return!1;return!0}(je)&&qe}const $h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kd(g,l,b,T,A,I){if(l.imageName){const P=T[l.imageName];return P?P.displaySize[0]*l.scale*Ur/I+A:0}{const P=b[l.fontStack],F=P&&P.glyphs[g];return F?F.metrics.advance*l.scale+A:0}}function Cd(g,l,b,T){const A=Math.pow(g-l,2);return T?g<l?A/2:2*A:A+Math.abs(b)*b}function mm(g,l,b){let T=0;return g===10&&(T-=1e4),b&&(T+=150),g!==40&&g!==65288||(T+=50),l!==41&&l!==65289||(T+=50),T}function Dd(g,l,b,T,A,I){let P=null,F=Cd(l,b,A,I);for(const N of T){const j=Cd(l-N.x,b,A,I)+N.badness;j<=F&&(P=N,F=j)}return{index:g,x:l,priorBreak:P,badness:F}}function Pd(g){return g?Pd(g.priorBreak).concat(g.index):[]}function Kc(g,l,b,T,A,I,P){if(I!=="point")return[];if(!g)return[];const F=[],N=function(H,re,ue,me,be,Ie){let Le=0;for(let Ne=0;Ne<H.length();Ne++){const je=H.getSection(Ne);Le+=kd(H.getCharCode(Ne),je,me,be,re,Ie)}return Le/Math.max(1,Math.ceil(Le/ue))}(g,l,b,T,A,P),j=g.text.indexOf("\u200B")>=0;let X=0;for(let H=0;H<g.length();H++){const re=g.getSection(H),ue=g.getCharCode(H);if($h[ue]||(X+=kd(ue,re,T,A,l,P)),H<g.length()-1){const me=!((Y=ue)<11904||!(ae(Y)||ie(Y)||Je(Y)||Ce(Y)||Te(Y)||z(Y)||pe(Y)||Z(Y)||Fe(Y)||we(Y)||xe(Y)||dt(Y)||K(Y)||V(Y)||O(Y)||Ee(Y)||Q(Y)||He(Y)||Be(Y)||De(Y)));(pm[ue]||me||re.imageName)&&F.push(Dd(H+1,X,N,F,mm(ue,g.getCharCode(H+1),me&&j),!1))}}var Y;return Pd(Dd(g.length(),X,N,F,0,!0))}function Jc(g){let l=.5,b=.5;switch(g){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":b=1;break;case"top":case"top-right":case"top-left":b=0}return{horizontalAlign:l,verticalAlign:b}}function Rd(g,l,b,T,A){if(!(l||b||T||A))return;const I=g.length-1,P=g[I],F=(P.x+P.metrics.advance*P.scale)*l;for(let N=0;N<=I;N++)g[N].x-=F,g[N].y+=b+T+A}function gm(g,l,b){const{horizontalAlign:T,verticalAlign:A}=Jc(b),I=l[0]-g.displaySize[0]*T,P=l[1]-g.displaySize[1]*A;return{image:g,top:P,bottom:P+g.displaySize[1],left:I,right:I+g.displaySize[0]}}function Bd(g,l,b,T,A,I){const P=g.image;let F;if(P.content){const be=P.content,Ie=P.pixelRatio||1;F=[be[0]/Ie,be[1]/Ie,P.displaySize[0]-be[2]/Ie,P.displaySize[1]-be[3]/Ie]}const N=l.left*I,j=l.right*I;let X,Y,H,re;b==="width"||b==="both"?(re=A[0]+N-T[3],Y=A[0]+j+T[1]):(re=A[0]+(N+j-P.displaySize[0])/2,Y=re+P.displaySize[0]);const ue=l.top*I,me=l.bottom*I;return b==="height"||b==="both"?(X=A[1]+ue-T[0],H=A[1]+me+T[2]):(X=A[1]+(ue+me-P.displaySize[1])/2,H=X+P.displaySize[1]),{image:P,top:X,right:Y,bottom:H,left:re,collisionPadding:F}}class bo extends U{constructor(l,b,T,A,I){super(l,b),this.angle=A,this.z=T,I!==void 0&&(this.segment=I)}clone(){return new bo(this.x,this.y,this.z,this.angle,this.segment)}}function Ld(g,l,b,T,A){if(l.segment===void 0)return!0;let I=l,P=l.segment+1,F=0;for(;F>-b/2;){if(P--,P<0)return!1;F-=g[P].dist(I),I=g[P]}F+=g[P].dist(g[P+1]),P++;const N=[];let j=0;for(;F<b/2;){const X=g[P],Y=g[P+1];if(!Y)return!1;let H=g[P-1].angleTo(X)-X.angleTo(Y);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:F,angleDelta:H}),j+=H;F-N[0].distance>T;)j-=N.shift().angleDelta;if(j>A)return!1;P++,F+=X.dist(Y)}return!0}function zd(g){let l=0;for(let b=0;b<g.length-1;b++)l+=g[b].dist(g[b+1]);return l}function Fd(g,l,b){return g?.6*l*b:0}function Od(g,l){return Math.max(g?g.right-g.left:0,l?l.right-l.left:0)}function _m(g,l,b,T,A,I){const P=Fd(b,A,I),F=Od(b,T)*I;let N=0;const j=zd(g)/2;for(let X=0;X<g.length-1;X++){const Y=g[X],H=g[X+1],re=Y.dist(H);if(N+re>j){const ue=(j-N)/re,me=Gi(Y.x,H.x,ue),be=Gi(Y.y,H.y,ue),Ie=new bo(me,be,0,H.angleTo(Y),X);return!P||Ld(g,Ie,F,P,l)?Ie:void 0}N+=re}}function ym(g,l,b,T,A,I,P,F,N){const j=Fd(T,I,P),X=Od(T,A),Y=X*P,H=g[0].x===0||g[0].x===N||g[0].y===0||g[0].y===N;return l-Y<l/4&&(l=Y+l/4),$d(g,H?l/2*F%l:(X/2+2*I)*P*F%l,l,j,b,Y,H,!1,N)}function $d(g,l,b,T,A,I,P,F,N){const j=I/2,X=zd(g);let Y=0,H=l-b,re=[];for(let ue=0;ue<g.length-1;ue++){const me=g[ue],be=g[ue+1],Ie=me.dist(be),Le=be.angleTo(me);for(;H+b<Y+Ie;){H+=b;const Ne=(H-Y)/Ie,je=Gi(me.x,be.x,Ne),qe=Gi(me.y,be.y,Ne);if(je>=0&&je<N&&qe>=0&&qe<N&&H-j>=0&&H+j<=X){const Ye=new bo(je,qe,0,Le,ue);Ye._round(),T&&!Ld(g,Ye,I,T,A)||re.push(Ye)}}Y+=Ie}return F||re.length||P||(re=$d(g,Y/2,b,T,A,I,P,!0,N)),re}function Nd(g,l,b,T,A){const I=[];for(let P=0;P<g.length;P++){const F=g[P];let N;for(let j=0;j<F.length-1;j++){let X=F[j],Y=F[j+1];X.x<l&&Y.x<l||(X.x<l?X=new U(l,X.y+(l-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x<l&&(Y=new U(l,X.y+(l-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y<b&&Y.y<b||(X.y<b?X=new U(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round():Y.y<b&&(Y=new U(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round()),X.x>=T&&Y.x>=T||(X.x>=T?X=new U(T,X.y+(T-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x>=T&&(Y=new U(T,X.y+(T-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y>=A&&Y.y>=A||(X.y>=A?X=new U(X.x+(A-X.y)/(Y.y-X.y)*(Y.x-X.x),A)._round():Y.y>=A&&(Y=new U(X.x+(A-X.y)/(Y.y-X.y)*(Y.x-X.x),A)._round()),N&&X.equals(N[N.length-1])||(N=[X],I.push(N)),N.push(Y)))))}}return I}Ot("Anchor",bo);const Tl=1e20;function Ud(g,l,b,T,A,I,P,F,N){for(let j=l;j<l+T;j++)Vd(g,b*I+j,I,A,P,F,N);for(let j=b;j<b+A;j++)Vd(g,j*I+l,1,T,P,F,N)}function Vd(g,l,b,T,A,I,P){I[0]=0,P[0]=-Tl,P[1]=Tl,A[0]=g[l];for(let F=1,N=0,j=0;F<T;F++){A[F]=g[l+F*b];const X=F*F;do{const Y=I[N];j=(A[F]-A[Y]+X-Y*Y)/(F-Y)/2}while(j<=P[N]&&--N>-1);N++,I[N]=F,P[N]=j,P[N+1]=Tl}for(let F=0,N=0;F<T;F++){for(;P[N+1]<F;)N++;const j=I[N],X=F-j;g[l+F*b]=A[j]+X*X}}const Qc={none:0,ideographs:1,all:2};class Ia{constructor(l,b,T){this.requestManager=l,this.localGlyphMode=b,this.localFontFamily=T,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,b){const T=[];for(const A in l)for(const I of l[A])T.push({stack:A,id:I});bt(T,({stack:A,id:I},P)=>{let F=this.entries[A];F||(F=this.entries[A]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=F.glyphs[I];if(N!==void 0)return void P(null,{stack:A,id:I,glyph:N});if(N=this._tinySDF(F,A,I),N)return F.glyphs[I]=N,void P(null,{stack:A,id:I,glyph:N});const j=Math.floor(I/256);if(256*j>65535)return void P(new Error("glyphs > 65535 not supported"));if(F.ranges[j])return void P(null,{stack:A,id:I,glyph:N});let X=F.requests[j];X||(X=F.requests[j]=[],Ia.loadGlyphRange(A,j,this.url,this.requestManager,(Y,H)=>{if(H){F.ascender=H.ascender,F.descender=H.descender;for(const re in H.glyphs)this._doesCharSupportLocalGlyph(+re)||(F.glyphs[+re]=H.glyphs[+re]);F.ranges[j]=!0}for(const re of X)re(Y,H);delete F.requests[j]})),X.push((Y,H)=>{Y?P(Y):H&&P(null,{stack:A,id:I,glyph:H.glyphs[I]||null})})},(A,I)=>{if(A)b(A);else if(I){const P={};for(const{stack:F,id:N,glyph:j}of I)P[F]===void 0&&(P[F]={}),P[F].glyphs===void 0&&(P[F].glyphs={}),P[F].glyphs[N]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics},P[F].ascender=this.entries[F].ascender,P[F].descender=this.entries[F].descender;b(null,P)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==Qc.none&&(this.localGlyphMode===Qc.all?!!this.localFontFamily:!!this.localFontFamily&&(we(l)||ke(l)||K(l)||Q(l))||Z(l))}_tinySDF(l,b,T){const A=this.localFontFamily;if(!A||!this._doesCharSupportLocalGlyph(T))return;let I=l.tinySDF;if(!I){let me="400";/bold/i.test(b)?me="900":/medium/i.test(b)?me="500":/light/i.test(b)&&(me="200"),I=l.tinySDF=new Ia.TinySDF({fontFamily:A,fontWeight:me,fontSize:48,buffer:6,radius:16}),I.fontWeight=me}if(this.localGlyphs[I.fontWeight][T])return this.localGlyphs[I.fontWeight][T];const P=String.fromCharCode(T),{data:F,width:N,height:j,glyphWidth:X,glyphHeight:Y,glyphLeft:H,glyphTop:re,glyphAdvance:ue}=I.draw(P);return this.localGlyphs[I.fontWeight][T]={id:T,bitmap:new Uo({width:N,height:j},F),metrics:{width:X/2,height:Y/2,left:H/2,top:re/2-27,advance:ue/2,localGlyph:!0}}}}function jd(g,l,b,T){const A=[],I=g.image,P=I.pixelRatio,F=I.paddedRect.w-2,N=I.paddedRect.h-2,j=g.right-g.left,X=g.bottom-g.top,Y=I.stretchX||[[0,F]],H=I.stretchY||[[0,N]],re=(nt,_t)=>nt+_t[1]-_t[0],ue=Y.reduce(re,0),me=H.reduce(re,0),be=F-ue,Ie=N-me;let Le=0,Ne=ue,je=0,qe=me,Ye=0,ot=be,rt=0,wt=Ie;if(I.content&&T){const nt=I.content;Le=Nh(Y,0,nt[0]),je=Nh(H,0,nt[1]),Ne=Nh(Y,nt[0],nt[2]),qe=Nh(H,nt[1],nt[3]),Ye=nt[0]-Le,rt=nt[1]-je,ot=nt[2]-nt[0]-Ne,wt=nt[3]-nt[1]-qe}const gt=(nt,_t,Tt,ht)=>{const zt=Uh(nt.stretch-Le,Ne,j,g.left),Nt=Vh(nt.fixed-Ye,ot,nt.stretch,ue),Ri=Uh(_t.stretch-je,qe,X,g.top),tr=Vh(_t.fixed-rt,wt,_t.stretch,me),zi=Uh(Tt.stretch-Le,Ne,j,g.left),Fi=Vh(Tt.fixed-Ye,ot,Tt.stretch,ue),pt=Uh(ht.stretch-je,qe,X,g.top),Vi=Vh(ht.fixed-rt,wt,ht.stretch,me),$i=new U(zt,Ri),xr=new U(zi,Ri),cr=new U(zi,pt),Cr=new U(zt,pt),Gr=new U(Nt/P,tr/P),ji=new U(Fi/P,Vi/P),Di=l*Math.PI/180;if(Di){const dr=Math.sin(Di),Er=Math.cos(Di),Vr=[Er,-dr,dr,Er];$i._matMult(Vr),xr._matMult(Vr),Cr._matMult(Vr),cr._matMult(Vr)}const or=nt.stretch+nt.fixed,vr=_t.stretch+_t.fixed;return{tl:$i,tr:xr,bl:Cr,br:cr,tex:{x:I.paddedRect.x+1+or,y:I.paddedRect.y+1+vr,w:Tt.stretch+Tt.fixed-or,h:ht.stretch+ht.fixed-vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gr,pixelOffsetBR:ji,minFontScaleX:ot/P/j,minFontScaleY:wt/P/X,isSDF:b}};if(T&&(I.stretchX||I.stretchY)){const nt=Gd(Y,be,ue),_t=Gd(H,Ie,me);for(let Tt=0;Tt<nt.length-1;Tt++){const ht=nt[Tt],zt=nt[Tt+1];for(let Nt=0;Nt<_t.length-1;Nt++)A.push(gt(ht,_t[Nt],zt,_t[Nt+1]))}}else A.push(gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:F+1},{fixed:0,stretch:N+1}));return A}function Nh(g,l,b){let T=0;for(const A of g)T+=Math.max(l,Math.min(b,A[1]))-Math.max(l,Math.min(b,A[0]));return T}function Gd(g,l,b){const T=[{fixed:-1,stretch:0}];for(const[A,I]of g){const P=T[T.length-1];T.push({fixed:A-P.stretch,stretch:P.stretch}),T.push({fixed:A-P.stretch,stretch:P.stretch+(I-A)})}return T.push({fixed:l+1,stretch:b}),T}function Uh(g,l,b,T){return g/l*b+T}function Vh(g,l,b,T){return g-l*b/T}function xm(g,l,b,T){const A=l+g.positionedLines[T].lineOffset;return T===0?b+A/2:b+(A+(l+g.positionedLines[T-1].lineOffset))/2}Ia.loadGlyphRange=function(g,l,b,T,A){const I=256*l,P=I+255,F=T.transformRequest(T.normalizeGlyphsURL(b).replace("{fontstack}",g).replace("{range}",`${I}-${P}`),Bs.Glyphs);Ko(F,(N,j)=>{if(N)A(N);else if(j){const X={},Y=function(H){return new wl(H).readFields(um,{})}(j);for(const H of Y.glyphs)X[H.id]=H;A(null,{glyphs:X,ascender:Y.ascender,descender:Y.descender})}})},Ia.TinySDF=class{constructor({fontSize:g=24,buffer:l=3,radius:b=8,cutoff:T=.25,fontFamily:A="sans-serif",fontWeight:I="normal",fontStyle:P="normal"}){this.buffer=l,this.cutoff=T,this.radius=b;const F=this.size=g+4*l,N=this._createCanvas(F),j=this.ctx=N.getContext("2d",{willReadFrequently:!0});j.font=`${P} ${I} ${g}px ${A}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Uint16Array(F)}_createCanvas(g){const l=document.createElement("canvas");return l.width=l.height=g,l}draw(g){const{width:l,actualBoundingBoxAscent:b,actualBoundingBoxDescent:T,actualBoundingBoxLeft:A,actualBoundingBoxRight:I}=this.ctx.measureText(g),P=Math.floor(b),F=Math.min(this.size-this.buffer,Math.ceil(I-A)),N=Math.min(this.size-this.buffer,Math.ceil(b)+Math.ceil(T)),j=F+2*this.buffer,X=N+2*this.buffer,Y=j*X,H=new Uint8ClampedArray(Y),re={data:H,width:j,height:X,glyphWidth:F,glyphHeight:N,glyphTop:P,glyphLeft:0,glyphAdvance:l};if(F===0||N===0)return re;const{ctx:ue,buffer:me,gridInner:be,gridOuter:Ie}=this;ue.clearRect(me,me,F,N),ue.fillText(g,me,me+P+1);const Le=ue.getImageData(me,me,F,N);Ie.fill(Tl,0,Y),be.fill(0,0,Y);for(let Ne=0;Ne<N;Ne++)for(let je=0;je<F;je++){const qe=Le.data[4*(Ne*F+je)+3]/255;if(qe===0)continue;const Ye=(Ne+me)*j+je+me;if(qe===1)Ie[Ye]=0,be[Ye]=Tl;else{const ot=.5-qe;Ie[Ye]=ot>0?ot*ot:0,be[Ye]=ot<0?ot*ot:0}}Ud(Ie,0,0,j,X,j,this.f,this.v,this.z),Ud(be,me,me,F,N,j,this.f,this.v,this.z);for(let Ne=0;Ne<Y;Ne++){const je=Math.sqrt(Ie[Ne])-Math.sqrt(be[Ne]);H[Ne]=Math.round(255-255*(je/this.radius+this.cutoff))}return re}};class vm{constructor(l=[],b=bm){if(this.data=l,this.length=this.data.length,this.compare=b,this.length>0)for(let T=(this.length>>1)-1;T>=0;T--)this._down(T)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],b=this.data.pop();return this.length--,this.length>0&&(this.data[0]=b,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:b,compare:T}=this,A=b[l];for(;l>0;){const I=l-1>>1,P=b[I];if(T(A,P)>=0)break;b[l]=P,l=I}b[l]=A}_down(l){const{data:b,compare:T}=this,A=this.length>>1,I=b[l];for(;l<A;){let P=1+(l<<1),F=b[P];const N=P+1;if(N<this.length&&T(b[N],F)<0&&(P=N,F=b[N]),T(F,I)>=0)break;b[l]=F,l=P}b[l]=I}}function bm(g,l){return g<l?-1:g>l?1:0}function wm(g,l=1,b=!1){let T=1/0,A=1/0,I=-1/0,P=-1/0;const F=g[0];for(let re=0;re<F.length;re++){const ue=F[re];(!re||ue.x<T)&&(T=ue.x),(!re||ue.y<A)&&(A=ue.y),(!re||ue.x>I)&&(I=ue.x),(!re||ue.y>P)&&(P=ue.y)}const N=Math.min(I-T,P-A);let j=N/2;const X=new vm([],Em);if(N===0)return new U(T,A);for(let re=T;re<I;re+=N)for(let ue=A;ue<P;ue+=N)X.push(new ka(re+j,ue+j,j,g));let Y=function(re){let ue=0,me=0,be=0;const Ie=re[0];for(let Le=0,Ne=Ie.length,je=Ne-1;Le<Ne;je=Le++){const qe=Ie[Le],Ye=Ie[je],ot=qe.x*Ye.y-Ye.x*qe.y;me+=(qe.x+Ye.x)*ot,be+=(qe.y+Ye.y)*ot,ue+=3*ot}return new ka(me/ue,be/ue,0,re)}(g),H=X.length;for(;X.length;){const re=X.pop();(re.d>Y.d||!Y.d)&&(Y=re,b&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,H)),re.max-Y.d<=l||(j=re.h/2,X.push(new ka(re.p.x-j,re.p.y-j,j,g)),X.push(new ka(re.p.x+j,re.p.y-j,j,g)),X.push(new ka(re.p.x-j,re.p.y+j,j,g)),X.push(new ka(re.p.x+j,re.p.y+j,j,g)),H+=4)}return b&&(console.log(`num probes: ${H}`),console.log(`best distance: ${Y.d}`)),Y.p}function Em(g,l){return l.max-g.max}function ka(g,l,b,T){this.p=new U(g,l),this.h=b,this.d=function(A,I){let P=!1,F=1/0;for(let N=0;N<I.length;N++){const j=I[N];for(let X=0,Y=j.length,H=Y-1;X<Y;H=X++){const re=j[X],ue=j[H];re.y>A.y!=ue.y>A.y&&A.x<(ue.x-re.x)*(A.y-re.y)/(ue.y-re.y)+re.x&&(P=!P),F=Math.min(F,Ju(A,re,ue))}}return(P?1:-1)*Math.sqrt(F)}(this.p,T),this.max=this.d+this.h*Math.SQRT2}const eu=Number.POSITIVE_INFINITY,Tm=Math.sqrt(2);function qd(g,l){return l[1]!==eu?function(b,T,A){let I=0,P=0;switch(T=Math.abs(T),A=Math.abs(A),b){case"top-right":case"top-left":case"top":P=A-7;break;case"bottom-right":case"bottom-left":case"bottom":P=7-A}switch(b){case"top-right":case"bottom-right":case"right":I=-T;break;case"top-left":case"bottom-left":case"left":I=T}return[I,P]}(g,l[0],l[1]):function(b,T){let A=0,I=0;T<0&&(T=0);const P=T/Tm;switch(b){case"top-right":case"top-left":I=P-7;break;case"bottom-right":case"bottom-left":I=7-P;break;case"bottom":I=7-T;break;case"top":I=T-7}switch(b){case"top-right":case"bottom-right":A=-P;break;case"top-left":case"bottom-left":A=P;break;case"left":A=T;break;case"right":A=-T}return[A,I]}(g,l[0])}function Mm(g,l,b,T,A,I,P,F,N,j){g.createArrays(),g.tilePixelRatio=Si/(512*g.overscaling),g.compareText={},g.iconsNeedLinear=!1;const X=g.layers[0].layout,Y=g.layers[0]._unevaluatedLayout._values,H={};if(g.textSizeData.kind==="composite"){const{minZoom:me,maxZoom:be}=g.textSizeData;H.compositeTextSizes=[Y["text-size"].possiblyEvaluate(new di(me),F),Y["text-size"].possiblyEvaluate(new di(be),F)]}if(g.iconSizeData.kind==="composite"){const{minZoom:me,maxZoom:be}=g.iconSizeData;H.compositeIconSizes=[Y["icon-size"].possiblyEvaluate(new di(me),F),Y["icon-size"].possiblyEvaluate(new di(be),F)]}H.layoutTextSize=Y["text-size"].possiblyEvaluate(new di(N+1),F),H.layoutIconSize=Y["icon-size"].possiblyEvaluate(new di(N+1),F),H.textMaxSize=Y["text-size"].possiblyEvaluate(new di(18),F);const re=X.get("text-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",ue=X.get("text-size");for(const me of g.features){const be=X.get("text-font").evaluate(me,{},F).join(","),Ie=ue.evaluate(me,{},F),Le=H.layoutTextSize.evaluate(me,{},F),Ne=(H.layoutIconSize.evaluate(me,{},F),{horizontal:{},vertical:void 0}),je=me.text;let qe,Ye=[0,0];if(je){const wt=je.toString(),gt=X.get("text-letter-spacing").evaluate(me,{},F)*Ur,nt=X.get("text-line-height").evaluate(me,{},F)*Ur,_t=Ke(wt)?gt:0,Tt=X.get("text-anchor").evaluate(me,{},F),ht=X.get("text-variable-anchor");if(!ht){const Fi=X.get("text-radial-offset").evaluate(me,{},F);Ye=Fi?qd(Tt,[Fi*Ur,eu]):X.get("text-offset").evaluate(me,{},F).map(pt=>pt*Ur)}let zt=re?"center":X.get("text-justify").evaluate(me,{},F);const Nt=X.get("symbol-placement"),Ri=Nt==="point",tr=Nt==="point"?X.get("text-max-width").evaluate(me,{},F)*Ur:0,zi=Fi=>{g.allowVerticalPlacement&&it(wt)&&(Ne.vertical=Wc(je,l,b,A,be,tr,nt,Tt,Fi,_t,Ye,En.vertical,!0,Nt,Le,Ie))};if(!re&&ht){const Fi=zt==="auto"?ht.map(Vi=>tu(Vi)):[zt];let pt=!1;for(let Vi=0;Vi<Fi.length;Vi++){const $i=Fi[Vi];if(!Ne.horizontal[$i])if(pt)Ne.horizontal[$i]=Ne.horizontal[0];else{const xr=Wc(je,l,b,A,be,tr,nt,"center",$i,_t,Ye,En.horizontal,!1,Nt,Le,Ie);xr&&(Ne.horizontal[$i]=xr,pt=xr.positionedLines.length===1)}}zi("left")}else{if(zt==="auto"&&(zt=tu(Tt)),Ri||X.get("text-writing-mode").indexOf("horizontal")>=0||!it(wt)){const Fi=Wc(je,l,b,A,be,tr,nt,Tt,zt,_t,Ye,En.horizontal,!1,Nt,Le,Ie);Fi&&(Ne.horizontal[zt]=Fi)}zi(Nt==="point"?"left":zt)}}let ot=!1;if(me.icon&&me.icon.name){const wt=T[me.icon.name];wt&&(qe=gm(A[me.icon.name],X.get("icon-offset").evaluate(me,{},F),X.get("icon-anchor").evaluate(me,{},F)),ot=wt.sdf,g.sdfIcons===void 0?g.sdfIcons=wt.sdf:g.sdfIcons!==wt.sdf&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==g.pixelRatio||X.get("icon-rotate").constantOr(1)!==0)&&(g.iconsNeedLinear=!0))}const rt=Xd(Ne.horizontal)||Ne.vertical;g.iconsInText||(g.iconsInText=!!rt&&rt.iconsInText),(rt||qe)&&Sm(g,me,Ne,qe,T,H,Le,0,Ye,ot,P,F,j)}I&&g.generateCollisionDebugBuffers(N,g.collisionBoxArray)}function tu(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sm(g,l,b,T,A,I,P,F,N,j,X,Y,H){let re=I.textMaxSize.evaluate(l,{},Y);re===void 0&&(re=P);const ue=g.layers[0].layout,me=ue.get("icon-offset").evaluate(l,{},Y),be=Xd(b.horizontal)||b.vertical,Ie=P/24,Le=g.tilePixelRatio*re/24,Ne=g.tilePixelRatio*ue.get("symbol-spacing"),je=ue.get("text-padding")*g.tilePixelRatio,qe=ue.get("icon-padding")*g.tilePixelRatio,Ye=mt(ue.get("text-max-angle")),ot=ue.get("text-rotation-alignment")==="map"&&ue.get("symbol-placement")!=="point",rt=ue.get("icon-rotation-alignment")==="map"&&ue.get("symbol-placement")!=="point",wt=ue.get("symbol-placement"),gt=Ne/2,nt=ue.get("icon-text-fit");let _t;T&&nt!=="none"&&(g.allowVerticalPlacement&&b.vertical&&(_t=Bd(T,b.vertical,nt,ue.get("icon-text-fit-padding"),me,Ie)),be&&(T=Bd(T,be,nt,ue.get("icon-text-fit-padding"),me,Ie)));const Tt=(ht,zt,Nt)=>{if(zt.x<0||zt.x>=Si||zt.y<0||zt.y>=Si)return;const{x:Ri,y:tr,z:zi}=H.projectTilePoint(zt.x,zt.y,Nt),Fi=new bo(Ri,tr,zi,0,void 0);(function(pt,Vi,$i,xr,cr,Cr,Gr,ji,Di,or,vr,dr,Er,Vr,nn,on,nr,Dr,Pn,$r,Ki,Pr,sr,qr,Mr){const Zr=pt.addToLineVertexArray(Vi,xr);let Kr,Jr,Rr,jn,Ra,Cl,Dl,kf=0,Cf=0,Df=0,Pf=0,vu=-1,bu=-1;const lo={};let Rf=fl(""),wu=0,Eu=0;if(Di._unevaluatedLayout.getValue("text-radial-offset")===void 0?[wu,Eu]=Di.layout.get("text-offset").evaluate(Ki,{},Mr).map(pn=>pn*Ur):(wu=Di.layout.get("text-radial-offset").evaluate(Ki,{},Mr)*Ur,Eu=eu),pt.allowVerticalPlacement&&cr.vertical){const pn=cr.vertical;if(nn)Cl=iu(pn),ji&&(Dl=iu(ji));else{const mn=Di.layout.get("text-rotate").evaluate(Ki,{},Mr)+90;Rr=jh(or,$i,Vi,vr,dr,Er,pn,Vr,mn,on),ji&&(jn=jh(or,$i,Vi,vr,dr,Er,ji,Dr,mn))}}if(Cr){const pn=Di.layout.get("icon-rotate").evaluate(Ki,{},Mr),mn=Di.layout.get("icon-text-fit")!=="none",Pl=jd(Cr,pn,sr,mn),Mu=ji?jd(ji,pn,sr,mn):void 0;Jr=jh(or,$i,Vi,vr,dr,Er,Cr,Dr,pn),kf=4*Pl.length;const Bf=pt.iconSizeData;let Ds=null;Bf.kind==="source"?(Ds=[no*Di.layout.get("icon-size").evaluate(Ki,{},Mr)],Ds[0]>jo&&Ii(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Bf.kind==="composite"&&(Ds=[no*Pr.compositeIconSizes[0].evaluate(Ki,{},Mr),no*Pr.compositeIconSizes[1].evaluate(Ki,{},Mr)],(Ds[0]>jo||Ds[1]>jo)&&Ii(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Pl,Ds,$r,Pn,Ki,!1,$i,Vi,Zr.lineStartIndex,Zr.lineLength,-1,qr,Mr),vu=pt.icon.placedSymbolArray.length-1,Mu&&(Cf=4*Mu.length,pt.addSymbols(pt.icon,Mu,Ds,$r,Pn,Ki,En.vertical,$i,Vi,Zr.lineStartIndex,Zr.lineLength,-1,qr,Mr),bu=pt.icon.placedSymbolArray.length-1)}for(const pn in cr.horizontal){const mn=cr.horizontal[pn];Kr||(Rf=fl(mn.text),nn?Ra=iu(mn):Kr=jh(or,$i,Vi,vr,dr,Er,mn,Vr,Di.layout.get("text-rotate").evaluate(Ki,{},Mr),on));const Pl=mn.positionedLines.length===1;if(Df+=Zd(pt,$i,Vi,mn,Gr,Di,nn,Ki,on,Zr,cr.vertical?En.horizontal:En.horizontalOnly,Pl?Object.keys(cr.horizontal):[pn],lo,vu,Pr,qr,Mr),Pl)break}cr.vertical&&(Pf+=Zd(pt,$i,Vi,cr.vertical,Gr,Di,nn,Ki,on,Zr,En.vertical,["vertical"],lo,bu,Pr,qr,Mr));let Yo=-1;const Tu=(pn,mn)=>pn?Math.max(pn,mn):mn;Yo=Tu(Ra,Yo),Yo=Tu(Cl,Yo),Yo=Tu(Dl,Yo);const tg=Yo>-1?1:0;pt.glyphOffsetArray.length>=Go.MAX_GLYPHS&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ki.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,Ki.sortKey),pt.symbolInstances.emplaceBack($i.x,$i.y,$i.z,Vi.x,Vi.y,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical>=0?lo.vertical:-1,vu,bu,Rf,Kr!==void 0?Kr:pt.collisionBoxArray.length,Kr!==void 0?Kr+1:pt.collisionBoxArray.length,Rr!==void 0?Rr:pt.collisionBoxArray.length,Rr!==void 0?Rr+1:pt.collisionBoxArray.length,Jr!==void 0?Jr:pt.collisionBoxArray.length,Jr!==void 0?Jr+1:pt.collisionBoxArray.length,jn||pt.collisionBoxArray.length,jn?jn+1:pt.collisionBoxArray.length,vr,Df,Pf,kf,Cf,tg,0,wu,Eu,Yo)})(g,zt,Fi,ht,b,T,A,_t,g.layers[0],g.collisionBoxArray,l.index,l.sourceLayerIndex,g.index,je,ot,N,0,qe,rt,me,l,I,j,X,Y)};if(wt==="line")for(const ht of Nd(l.geometry,0,0,Si,Si)){const zt=ym(ht,Ne,Ye,b.vertical||be,T,24,Le,g.overscaling,Si);for(const Nt of zt){const Ri=be;Ri&&Am(g,Ri.text,gt,Nt)||Tt(ht,Nt,Y)}}else if(wt==="line-center"){for(const ht of l.geometry)if(ht.length>1){const zt=_m(ht,Ye,b.vertical||be,T,24,Le);zt&&Tt(ht,zt,Y)}}else if(l.type==="Polygon")for(const ht of Vc(l.geometry,0)){const zt=wm(ht,16);Tt(ht[0],new bo(zt.x,zt.y,0,0,void 0),Y)}else if(l.type==="LineString")for(const ht of l.geometry)Tt(ht,new bo(ht[0].x,ht[0].y,0,0,void 0),Y);else if(l.type==="Point")for(const ht of l.geometry)for(const zt of ht)Tt([zt],new bo(zt.x,zt.y,0,0,void 0),Y)}const jo=32640;function Zd(g,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me,be){const Ie=function(je,qe,Ye,ot,rt,wt,gt,nt){const _t=[];if(qe.positionedLines.length===0)return _t;const Tt=ot.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,ht=function(zi){const Fi=zi[0],pt=zi[1],Vi=Fi*pt;return Vi>0?[Fi,-pt]:Vi<0?[-Fi,pt]:Fi===0?[pt,Fi]:[pt,-Fi]}(Ye);let zt=Math.abs(qe.top-qe.bottom);for(const zi of qe.positionedLines)zt-=zi.lineOffset;const Nt=qe.positionedLines.length,Ri=zt/Nt;let tr=qe.top-Ye[1];for(let zi=0;zi<Nt;++zi){const Fi=qe.positionedLines[zi];tr=xm(qe,Ri,tr,zi);for(const pt of Fi.positionedGlyphs){if(!pt.rect)continue;const Vi=pt.rect||{};let $i=4,xr=!0,cr=1,Cr=0;if(pt.imageName){const sr=gt[pt.imageName];if(!sr)continue;if(sr.sdf){Ii("SDF images are not supported in formatted text and will be ignored.");continue}xr=!1,cr=sr.pixelRatio,$i=1/cr}const Gr=(rt||nt)&&pt.vertical,ji=pt.metrics.advance*pt.scale/2,Di=pt.metrics,or=pt.rect;if(or===null)continue;nt&&qe.verticalizable&&(Cr=pt.imageName?ji-pt.metrics.width*pt.scale/2:0);const vr=rt?[pt.x+ji,pt.y]:[0,0];let dr=[0,0],Er=[0,0],Vr=!1;rt||(Gr?(Er=[pt.x+ji+ht[0],pt.y+ht[1]-Cr],Vr=!0):dr=[pt.x+ji+Ye[0],pt.y+Ye[1]-Cr]);const nn=or.w*pt.scale/(cr*(pt.localGlyph?2:1)),on=or.h*pt.scale/(cr*(pt.localGlyph?2:1));let nr,Dr,Pn,$r;if(Gr){const sr=pt.y-tr,qr=new U(-ji,ji-sr),Mr=-Math.PI/2,Zr=new U(...Er);nr=new U(-ji+dr[0],dr[1]),nr._rotateAround(Mr,qr)._add(Zr),nr.x+=-sr+ji,nr.y-=(Di.left-$i)*pt.scale;const Kr=pt.imageName?Di.advance*pt.scale:Ur*pt.scale,Jr=String.fromCharCode(pt.glyph);em(Jr)?nr.x+=(1-$i)*pt.scale:tm(Jr)?nr.x+=Kr-Di.height*pt.scale+(-$i-1)*pt.scale:nr.x+=pt.imageName||Di.width+2*$i===or.w&&Di.height+2*$i===or.h?(Kr-on)/2:(Kr-(Di.height+2*$i)*pt.scale)/2,Dr=new U(nr.x,nr.y-nn),Pn=new U(nr.x+on,nr.y),$r=new U(nr.x+on,nr.y-nn)}else{const sr=(Di.left-$i)*pt.scale-ji+dr[0],qr=(-Di.top-$i)*pt.scale+dr[1],Mr=sr+nn,Zr=qr+on;nr=new U(sr,qr),Dr=new U(Mr,qr),Pn=new U(sr,Zr),$r=new U(Mr,Zr)}if(Tt){let sr;sr=rt?new U(0,0):Vr?new U(ht[0],ht[1]):new U(Ye[0],Ye[1]),nr._rotateAround(Tt,sr),Dr._rotateAround(Tt,sr),Pn._rotateAround(Tt,sr),$r._rotateAround(Tt,sr)}const Ki=new U(0,0),Pr=new U(0,0);_t.push({tl:nr,tr:Dr,bl:Pn,br:$r,tex:Vi,writingMode:qe.writingMode,glyphOffset:vr,sectionIndex:pt.sectionIndex,isSDF:xr,pixelOffsetTL:Ki,pixelOffsetBR:Pr,minFontScaleX:0,minFontScaleY:0})}}return _t}(0,T,N,I,P,F,A,g.allowVerticalPlacement),Le=g.textSizeData;let Ne=null;Le.kind==="source"?(Ne=[no*I.layout.get("text-size").evaluate(F,{},be)],Ne[0]>jo&&Ii(`${g.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Le.kind==="composite"&&(Ne=[no*ue.compositeTextSizes[0].evaluate(F,{},be),no*ue.compositeTextSizes[1].evaluate(F,{},be)],(Ne[0]>jo||Ne[1]>jo)&&Ii(`${g.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),g.addSymbols(g.text,Ie,Ne,N,P,F,X,l,b,j.lineStartIndex,j.lineLength,re,me,be);for(const je of Y)H[je]=g.text.placedSymbolArray.length-1;return 4*Ie.length}function Xd(g){for(const l in g)return g[l];return null}function jh(g,l,b,T,A,I,P,F,N,j){let X=P.top,Y=P.bottom,H=P.left,re=P.right;const ue=P.collisionPadding;if(ue&&(H-=ue[0],X-=ue[1],re+=ue[2],Y+=ue[3]),N){const me=new U(H,X),be=new U(re,X),Ie=new U(H,Y),Le=new U(re,Y),Ne=mt(N);let je=new U(0,0);j&&(je=new U(j[0],j[1])),me._rotateAround(Ne,je),be._rotateAround(Ne,je),Ie._rotateAround(Ne,je),Le._rotateAround(Ne,je),H=Math.min(me.x,be.x,Ie.x,Le.x),re=Math.max(me.x,be.x,Ie.x,Le.x),X=Math.min(me.y,be.y,Ie.y,Le.y),Y=Math.max(me.y,be.y,Ie.y,Le.y)}return g.emplaceBack(l.x,l.y,l.z,b.x,b.y,H,X,re,Y,F,T,A,I),g.length-1}function iu(g){g.collisionPadding&&(g.top-=g.collisionPadding[1],g.bottom+=g.collisionPadding[3]);const l=g.bottom-g.top;return l>0?Math.max(10,l):null}function Am(g,l,b,T){const A=g.compareText;if(l in A){const I=A[l];for(let P=I.length-1;P>=0;P--)if(T.dist(I[P])<b)return!0}else A[l]=[];return A[l].push(T),!1}const Im=As.VectorTileFeature.types,km=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gh(g,l,b,T,A,I,P,F,N,j,X,Y,H,re,ue,me){const be=X?Math.min(jo,Math.round(X[0])):0,Ie=X?Math.min(jo,Math.round(X[1])):0;g.emplaceBack(l,b,Math.round(32*P),Math.round(32*F),N,j,(be<<1)+(Y?1:0),Ie,16*H,16*re,256*ue,256*me,T,A,I,0)}function ru(g,l,b){g.emplaceBack(l.x,l.y,b),g.emplaceBack(l.x,l.y,b),g.emplaceBack(l.x,l.y,b),g.emplaceBack(l.x,l.y,b)}function Cm(g){for(const l of g.sections)if(yt(l.text))return!0;return!1}class nu{constructor(l){this.layoutVertexArray=new _c,this.indexArray=new bn,this.programConfigurations=l,this.segments=new _r,this.dynamicLayoutVertexArray=new ga,this.opacityVertexArray=new yc,this.placedSymbolArray=new Du}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,b,T,A){this.isEmpty()||(T&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Xp.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,b),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Yp.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,km,!0),this.opacityVertexBuffer.itemSize=1),(T||A)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ot("SymbolBuffers",nu);class ou{constructor(l,b,T){this.layoutVertexArray=new l,this.layoutAttributes=b,this.indexArray=new T,this.segments=new _r,this.collisionVertexArray=new bc,this.collisionVertexArrayExt=new ga}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Hp.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,Wp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot("CollisionBuffers",ou);class Go{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(P=>P.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ee([]),this.placementViewportMatrix=ee([]);const b=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zc(this.zoom,b["text-size"]),this.iconSizeData=Zc(this.zoom,b["icon-size"]);const T=this.layers[0].layout,A=T.get("symbol-sort-key"),I=T.get("symbol-z-order");this.canOverlap=T.get("text-allow-overlap")||T.get("icon-allow-overlap")||T.get("text-ignore-placement")||T.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&A.constantOr(1)!==void 0,this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=T.get("text-writing-mode").map(P=>En[P]),this.stateDependentLayerIds=this.layers.filter(P=>P.isStateDependent()).map(P=>P.id),this.sourceID=l.sourceID}createArrays(){this.text=new nu(new Ts(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new nu(new Ts(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new Bu,this.lineVertexArray=new Lu,this.symbolInstances=new Ru}calculateGlyphDependencies(l,b,T,A,I){for(let P=0;P<l.length;P++)if(b[l.charCodeAt(P)]=!0,A&&I){const F=bl[l.charAt(P)];F&&(b[F.charCodeAt(0)]=!0)}}populate(l,b,T,A){const I=this.layers[0],P=I.layout,F=P.get("text-font"),N=P.get("text-field"),j=P.get("icon-image"),X=(N.value.kind!=="constant"||N.value.value instanceof _i&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(F.value.kind!=="constant"||F.value.value.length>0),Y=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,H=P.get("symbol-sort-key");if(this.features=[],!X&&!Y)return;const re=b.iconDependencies,ue=b.glyphDependencies,me=b.availableImages,be=new di(this.zoom);for(const{feature:Ie,id:Le,index:Ne,sourceLayerIndex:je}of l){const qe=I._featureFilter.needGeometry,Ye=Ss(Ie,qe);if(!I._featureFilter.filter(be,Ye,T))continue;let ot,rt;if(qe||(Ye.geometry=xo(Ie,T,A)),X){const gt=I.getValueAndResolveTokens("text-field",Ye,T,me),nt=_i.factory(gt);Cm(nt)&&(this.hasRTLText=!0),(!this.hasRTLText||un()==="unavailable"||this.hasRTLText&&Li.isParsed())&&(ot=Qp(nt,I,Ye))}if(Y){const gt=I.getValueAndResolveTokens("icon-image",Ye,T,me);rt=gt instanceof ln?gt:ln.fromString(gt)}if(!ot&&!rt)continue;const wt=this.sortFeaturesByKey?H.evaluate(Ye,{},T):void 0;if(this.features.push({id:Le,text:ot,icon:rt,index:Ne,sourceLayerIndex:je,geometry:Ye.geometry,properties:Ie.properties,type:Im[Ie.type],sortKey:wt}),rt&&(re[rt.name]=!0),ot){const gt=F.evaluate(Ye,{},T).join(","),nt=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(En.vertical)>=0;for(const _t of ot.sections)if(_t.image)re[_t.image.name]=!0;else{const Tt=it(ot.toString()),ht=_t.fontStack||gt,zt=ue[ht]=ue[ht]||{};this.calculateGlyphDependencies(_t.text,zt,nt,this.allowVerticalPlacement,Tt)}}}P.get("symbol-placement")==="line"&&(this.features=function(Ie){const Le={},Ne={},je=[];let qe=0;function Ye(gt){je.push(Ie[gt]),qe++}function ot(gt,nt,_t){const Tt=Ne[gt];return delete Ne[gt],Ne[nt]=Tt,je[Tt].geometry[0].pop(),je[Tt].geometry[0]=je[Tt].geometry[0].concat(_t[0]),Tt}function rt(gt,nt,_t){const Tt=Le[nt];return delete Le[nt],Le[gt]=Tt,je[Tt].geometry[0].shift(),je[Tt].geometry[0]=_t[0].concat(je[Tt].geometry[0]),Tt}function wt(gt,nt,_t){const Tt=_t?nt[0][nt[0].length-1]:nt[0][0];return`${gt}:${Tt.x}:${Tt.y}`}for(let gt=0;gt<Ie.length;gt++){const nt=Ie[gt],_t=nt.geometry,Tt=nt.text?nt.text.toString():null;if(!Tt){Ye(gt);continue}const ht=wt(Tt,_t),zt=wt(Tt,_t,!0);if(ht in Ne&&zt in Le&&Ne[ht]!==Le[zt]){const Nt=rt(ht,zt,_t),Ri=ot(ht,zt,je[Nt].geometry);delete Le[ht],delete Ne[zt],Ne[wt(Tt,je[Ri].geometry,!0)]=Ri,je[Nt].geometry=null}else ht in Ne?ot(ht,zt,_t):zt in Le?rt(ht,zt,_t):(Ye(gt),Le[ht]=qe-1,Ne[zt]=qe-1)}return je.filter(gt=>gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ie,Le)=>Ie.sortKey-Le.sortKey)}update(l,b,T,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,b,this.layers,T,A),this.icon.programConfigurations.updatePaintArrays(l,b,this.layers,T,A))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,b){const T=this.lineVertexArray.length;if(l.segment!==void 0){let A=l.dist(b[l.segment+1]),I=l.dist(b[l.segment]);const P={};for(let F=l.segment+1;F<b.length;F++)P[F]={x:b[F].x,y:b[F].y,tileUnitDistanceFromAnchor:A},F<b.length-1&&(A+=b[F+1].dist(b[F]));for(let F=l.segment||0;F>=0;F--)P[F]={x:b[F].x,y:b[F].y,tileUnitDistanceFromAnchor:I},F>0&&(I+=b[F-1].dist(b[F]));for(let F=0;F<b.length;F++){const N=P[F];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:T,lineLength:this.lineVertexArray.length-T}}addSymbols(l,b,T,A,I,P,F,N,j,X,Y,H,re,ue){const me=l.indexArray,be=l.layoutVertexArray,Ie=l.segments.prepareSegment(4*b.length,be,me,this.canOverlap?P.sortKey:void 0),Le=this.glyphOffsetArray.length,Ne=Ie.vertexLength,je=this.allowVerticalPlacement&&F===En.vertical?Math.PI/2:0,qe=P.text&&P.text.sections;for(let Ye=0;Ye<b.length;Ye++){const{tl:ot,tr:rt,bl:wt,br:gt,tex:nt,pixelOffsetTL:_t,pixelOffsetBR:Tt,minFontScaleX:ht,minFontScaleY:zt,glyphOffset:Nt,isSDF:Ri,sectionIndex:tr}=b[Ye],zi=Ie.vertexLength,Fi=Nt[1];Gh(be,N.x,N.y,N.z,j.x,j.y,ot.x,Fi+ot.y,nt.x,nt.y,T,Ri,_t.x,_t.y,ht,zt),Gh(be,N.x,N.y,N.z,j.x,j.y,rt.x,Fi+rt.y,nt.x+nt.w,nt.y,T,Ri,Tt.x,_t.y,ht,zt),Gh(be,N.x,N.y,N.z,j.x,j.y,wt.x,Fi+wt.y,nt.x,nt.y+nt.h,T,Ri,_t.x,Tt.y,ht,zt),Gh(be,N.x,N.y,N.z,j.x,j.y,gt.x,Fi+gt.y,nt.x+nt.w,nt.y+nt.h,T,Ri,Tt.x,Tt.y,ht,zt),ru(l.dynamicLayoutVertexArray,N,je),me.emplaceBack(zi,zi+1,zi+2),me.emplaceBack(zi+1,zi+2,zi+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Ye!==b.length-1&&tr===b[Ye+1].sectionIndex||l.programConfigurations.populatePaintArrays(be.length,P,P.index,{},re,ue,qe&&qe[tr])}l.placedSymbolArray.emplaceBack(N.x,N.y,N.z,j.x,j.y,Le,this.glyphOffsetArray.length-Le,Ne,X,Y,j.segment,T?T[0]:0,T?T[1]:0,A[0],A[1],F,0,!1,0,H,0)}_commitLayoutVertex(l,b,T,A,I,P,F){l.emplaceBack(b,T,A,I,P,Math.round(F.x),Math.round(F.y))}_addCollisionDebugVertices(l,b,T,A,I,P,F){const N=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),j=N.vertexLength,X=F.tileAnchorX,Y=F.tileAnchorY;for(let re=0;re<4;re++)T.collisionVertexArray.emplaceBack(0,0,0,0);T.collisionVertexArrayExt.emplaceBack(b,-l.padding,-l.padding),T.collisionVertexArrayExt.emplaceBack(b,l.padding,-l.padding),T.collisionVertexArrayExt.emplaceBack(b,l.padding,l.padding),T.collisionVertexArrayExt.emplaceBack(b,-l.padding,l.padding),this._commitLayoutVertex(T.layoutVertexArray,A,I,P,X,Y,new U(l.x1,l.y1)),this._commitLayoutVertex(T.layoutVertexArray,A,I,P,X,Y,new U(l.x2,l.y1)),this._commitLayoutVertex(T.layoutVertexArray,A,I,P,X,Y,new U(l.x2,l.y2)),this._commitLayoutVertex(T.layoutVertexArray,A,I,P,X,Y,new U(l.x1,l.y2)),N.vertexLength+=4;const H=T.indexArray;H.emplaceBack(j,j+1),H.emplaceBack(j+1,j+2),H.emplaceBack(j+2,j+3),H.emplaceBack(j+3,j),N.primitiveLength+=4}_addTextDebugCollisionBoxes(l,b,T,A,I,P){for(let F=A;F<I;F++){const N=T.get(F),j=this.getSymbolInstanceTextSize(l,P,b,F);this._addCollisionDebugVertices(N,j,this.textCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,P)}}_addIconDebugCollisionBoxes(l,b,T,A,I,P){for(let F=A;F<I;F++){const N=T.get(F),j=this.getSymbolInstanceIconSize(l,b,F);this._addCollisionDebugVertices(N,j,this.iconCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,P)}}generateCollisionDebugBuffers(l,b){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ou(xh,bd.members,$o),this.iconCollisionBox=new ou(xh,bd.members,$o);const T=Ta(this.iconSizeData,l),A=Ta(this.textSizeData,l);for(let I=0;I<this.symbolInstances.length;I++){const P=this.symbolInstances.get(I);this._addTextDebugCollisionBoxes(A,l,b,P.textBoxStartIndex,P.textBoxEndIndex,P),this._addTextDebugCollisionBoxes(A,l,b,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P),this._addIconDebugCollisionBoxes(T,l,b,P.iconBoxStartIndex,P.iconBoxEndIndex,P),this._addIconDebugCollisionBoxes(T,l,b,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P)}}getSymbolInstanceTextSize(l,b,T,A){const I=this.text.placedSymbolArray.get(b.rightJustifiedTextSymbolIndex>=0?b.rightJustifiedTextSymbolIndex:b.centerJustifiedTextSymbolIndex>=0?b.centerJustifiedTextSymbolIndex:b.leftJustifiedTextSymbolIndex>=0?b.leftJustifiedTextSymbolIndex:b.verticalPlacedTextSymbolIndex>=0?b.verticalPlacedTextSymbolIndex:A),P=Fh(this.textSizeData,l,I)/Ur;return this.tilePixelRatio*P}getSymbolInstanceIconSize(l,b,T){const A=this.icon.placedSymbolArray.get(T),I=Fh(this.iconSizeData,l,A);return this.tilePixelRatio*I}_commitDebugCollisionVertexUpdate(l,b,T){l.emplaceBack(b,-T,-T),l.emplaceBack(b,T,-T),l.emplaceBack(b,T,T),l.emplaceBack(b,-T,T)}_updateTextDebugCollisionBoxes(l,b,T,A,I,P){for(let F=A;F<I;F++){const N=T.get(F),j=this.getSymbolInstanceTextSize(l,P,b,F);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,j,N.padding)}}_updateIconDebugCollisionBoxes(l,b,T,A,I){for(let P=A;P<I;P++){const F=T.get(P),N=this.getSymbolInstanceIconSize(l,b,P);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,F.padding)}}updateCollisionDebugBuffers(l,b){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const T=Ta(this.iconSizeData,l),A=Ta(this.textSizeData,l);for(let I=0;I<this.symbolInstances.length;I++){const P=this.symbolInstances.get(I);this._updateTextDebugCollisionBoxes(A,l,b,P.textBoxStartIndex,P.textBoxEndIndex,P),this._updateTextDebugCollisionBoxes(A,l,b,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P),this._updateIconDebugCollisionBoxes(T,l,b,P.iconBoxStartIndex,P.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(T,l,b,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,b,T,A,I,P,F,N,j){const X={};for(let Y=b;Y<T;Y++){const H=l.get(Y);X.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,padding:H.padding,projectedAnchorX:H.projectedAnchorX,projectedAnchorY:H.projectedAnchorY,projectedAnchorZ:H.projectedAnchorZ,tileAnchorX:H.tileAnchorX,tileAnchorY:H.tileAnchorY},X.textFeatureIndex=H.featureIndex;break}for(let Y=A;Y<I;Y++){const H=l.get(Y);X.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,padding:H.padding,projectedAnchorX:H.projectedAnchorX,projectedAnchorY:H.projectedAnchorY,projectedAnchorZ:H.projectedAnchorZ,tileAnchorX:H.tileAnchorX,tileAnchorY:H.tileAnchorY},X.verticalTextFeatureIndex=H.featureIndex;break}for(let Y=P;Y<F;Y++){const H=l.get(Y);X.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,padding:H.padding,projectedAnchorX:H.projectedAnchorX,projectedAnchorY:H.projectedAnchorY,projectedAnchorZ:H.projectedAnchorZ,tileAnchorX:H.tileAnchorX,tileAnchorY:H.tileAnchorY},X.iconFeatureIndex=H.featureIndex;break}for(let Y=N;Y<j;Y++){const H=l.get(Y);X.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,padding:H.padding,projectedAnchorX:H.projectedAnchorX,projectedAnchorY:H.projectedAnchorY,projectedAnchorZ:H.projectedAnchorZ,tileAnchorX:H.tileAnchorX,tileAnchorY:H.tileAnchorY},X.verticalIconFeatureIndex=H.featureIndex;break}return X}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,T.textBoxStartIndex,T.textBoxEndIndex,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T.iconBoxStartIndex,T.iconBoxEndIndex,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,b){const T=l.placedSymbolArray.get(b),A=T.vertexStartIndex+4*T.numGlyphs;for(let I=T.vertexStartIndex;I<A;I+=4)l.indexArray.emplaceBack(I,I+1,I+2),l.indexArray.emplaceBack(I+1,I+2,I+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const b=Math.sin(l),T=Math.cos(l),A=[],I=[],P=[];for(let F=0;F<this.symbolInstances.length;++F){P.push(F);const N=this.symbolInstances.get(F);A.push(0|Math.round(b*N.tileAnchorX+T*N.tileAnchorY)),I.push(N.featureIndex)}return P.sort((F,N)=>A[F]-A[N]||I[N]-I[F]),P}addToSortKeyRanges(l,b){const T=this.sortKeyRanges[this.sortKeyRanges.length-1];T&&T.sortKey===b?T.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:b,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const b of this.symbolInstanceIndexes){const T=this.symbolInstances.get(b);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach((A,I,P)=>{A>=0&&P.indexOf(A)===I&&this.addIndicesForPlacedSymbol(this.text,A)}),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ot("SymbolBucket",Go,{omit:["layers","collisionBoxArray","features","compareText"]}),Go.MAX_GLYPHS=65535,Go.addDynamicAttributes=ru;const Dm=new Or({"symbol-placement":new $t(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $t(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt(tt.layout_symbol["icon-size"]),"icon-text-fit":new $t(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt(tt.layout_symbol["icon-image"]),"icon-rotate":new Qt(tt.layout_symbol["icon-rotate"]),"icon-padding":new $t(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt(tt.layout_symbol["icon-offset"]),"icon-anchor":new Qt(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(tt.layout_symbol["text-rotation-alignment"]),"text-field":new Qt(tt.layout_symbol["text-field"]),"text-font":new Qt(tt.layout_symbol["text-font"]),"text-size":new Qt(tt.layout_symbol["text-size"]),"text-max-width":new Qt(tt.layout_symbol["text-max-width"]),"text-line-height":new Qt(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt(tt.layout_symbol["text-letter-spacing"]),"text-justify":new Qt(tt.layout_symbol["text-justify"]),"text-radial-offset":new Qt(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new Qt(tt.layout_symbol["text-anchor"]),"text-max-angle":new $t(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(tt.layout_symbol["text-writing-mode"]),"text-rotate":new Qt(tt.layout_symbol["text-rotate"]),"text-padding":new $t(tt.layout_symbol["text-padding"]),"text-keep-upright":new $t(tt.layout_symbol["text-keep-upright"]),"text-transform":new Qt(tt.layout_symbol["text-transform"]),"text-offset":new Qt(tt.layout_symbol["text-offset"]),"text-allow-overlap":new $t(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $t(tt.layout_symbol["text-ignore-placement"]),"text-optional":new $t(tt.layout_symbol["text-optional"])});var su={paint:new Or({"icon-opacity":new Qt(tt.paint_symbol["icon-opacity"]),"icon-color":new Qt(tt.paint_symbol["icon-color"]),"icon-halo-color":new Qt(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qt(tt.paint_symbol["text-opacity"]),"text-color":new Qt(tt.paint_symbol["text-color"],{runtimeType:An,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new Qt(tt.paint_symbol["text-halo-color"]),"text-halo-width":new Qt(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt(tt.paint_symbol["text-halo-blur"]),"text-translate":new $t(tt.paint_symbol["text-translate"]),"text-translate-anchor":new $t(tt.paint_symbol["text-translate-anchor"])}),layout:Dm};class Yd{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:Yn,this.defaultValue=l}evaluate(l){if(l.formattedSection){const b=this.defaultValue.property.overrides;if(b&&b.hasOverride(l.formattedSection))return b.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot("FormatSectionOverride",Yd,{omit:["defaultValue"]});class qh extends $n{constructor(l){super(l,su)}recalculate(l,b){super.recalculate(l,b),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const T=this.layout.get("text-writing-mode");if(T){const A=[];for(const I of T)A.indexOf(I)<0&&A.push(I);this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(l,b,T,A){const I=this.layout.get(l).evaluate(b,{},T,A),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||Co(P.value)||!I?I:function(F,N){return N.replace(/{([^{}]+)}/g,(j,X)=>X in F?String(F[X]):"")}(b.properties,I)}createBucket(l){return new Go(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of su.paint.overridableProperties){if(!qh.hasPaintOverride(this.layout,l))continue;const b=this.paint.get(l),T=new Yd(b),A=new Ka(T,b.property.specification);let I=null;I=b.value.kind==="constant"||b.value.kind==="source"?new gs("source",A):new Ja("composite",A,b.value.zoomStops,b.value._interpolationType),this.paint._values[l]=new Wr(b.property,I,b.parameters)}}_handleOverridablePaintPropertyUpdate(l,b,T){return!(!this.layout||b.isDataDriven()||T.isDataDriven())&&qh.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,b){const T=l.get("text-field"),A=su.paint.properties[b];let I=!1;const P=F=>{for(const N of F)if(A.overrides&&A.overrides.hasOverride(N))return void(I=!0)};if(T.value.kind==="constant"&&T.value.value instanceof _i)P(T.value.value.sections);else if(T.value.kind==="source"){const F=j=>{I||(j instanceof Wn&&mr(j.value)===Hn?P(j.value.sections):j instanceof In?P(j.sections):j.eachChild(F))},N=T.value;N._styleExpression&&F(N._styleExpression.expression)}return I}getProgramConfiguration(l){return new _o(this,l)}}var Pm={paint:new Or({"background-color":new $t(tt.paint_background["background-color"]),"background-pattern":new po(tt.paint_background["background-pattern"]),"background-opacity":new $t(tt.paint_background["background-opacity"])})},Rm={paint:new Or({"raster-opacity":new $t(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(tt.paint_raster["raster-saturation"]),"raster-contrast":new $t(tt.paint_raster["raster-contrast"]),"raster-resampling":new $t(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(tt.paint_raster["raster-fade-duration"])})};class Bm extends $n{constructor(l){super(l,{}),this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}var Lm={paint:new Or({"sky-type":new $t(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new $t(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $t(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $t(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $t(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new io(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $t(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $t(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $t(tt.paint_sky["sky-opacity"])})};function au(g,l,b){const T=ye(0,0,1),A=oi(mi());return function(I,P,F){F*=.5;var N=P[0],j=P[1],X=P[2],Y=P[3],H=Math.sin(F),re=Math.cos(F);I[0]=N*re-X*H,I[1]=j*re+Y*H,I[2]=X*re+N*H,I[3]=Y*re-j*H}(A,A,b?-mt(g)+Math.PI:mt(g)),yi(A,A,-mt(l)),ri(T,T,A),It(T,T)}const zm={circle:class extends $n{constructor(g){super(g,op)}createBucket(g){return new Pc(g)}queryRadius(g){const l=g;return ba("circle-radius",this,l)+ba("circle-stroke-width",this,l)+kh(this.paint.get("circle-translate"))}queryIntersectsFeature(g,l,b,T,A,I,P,F){const N=id(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,g.pixelToTileUnitsFactor),j=this.paint.get("circle-radius").evaluate(l,b)+this.paint.get("circle-stroke-width").evaluate(l,b);return rd(g,T,I,P,F,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",N,j)}getProgramIds(){return["circle"]}getProgramConfiguration(g){return new _o(this,g)}},heatmap:class extends $n{createBucket(g){return new od(g)}constructor(g){super(g,hp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(g){g==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Oc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(g){return ba("heatmap-radius",this,g)}queryIntersectsFeature(g,l,b,T,A,I,P,F){const N=this.paint.get("heatmap-radius").evaluate(l,b);return rd(g,T,I,P,F,!0,!0,new U(0,0),N)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(g){return new _o(this,g)}},hillshade:class extends $n{constructor(g){super(g,cp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(g){return new _o(this,g)}},fill:class extends $n{constructor(g){super(g,Ap)}getProgramIds(){const g=this.paint.get("fill-pattern"),l=g&&g.constantOr(1),b=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&b.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),b}getProgramConfiguration(g){return new _o(this,g)}recalculate(g,l){super.recalculate(g,l);const b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(g){return new Lh(g)}queryRadius(){return kh(this.paint.get("fill-translate"))}queryIntersectsFeature(g,l,b,T,A,I){return!g.queryGeometry.isAboveHorizon&&Ku(td(g.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,g.pixelToTileUnitsFactor),T)}isTileClipped(){return!0}},"fill-extrusion":class extends $n{constructor(g){super(g,Op)}createBucket(g){return new qc(g)}queryRadius(){return kh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(g){return new _o(this,g)}queryIntersectsFeature(g,l,b,T,A,I,P,F,N){const j=id(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,g.pixelToTileUnitsFactor),X=this.paint.get("fill-extrusion-height").evaluate(l,b),Y=this.paint.get("fill-extrusion-base").evaluate(l,b),H=[0,0],re=F&&I.elevation,ue=I.elevation?I.elevation.exaggeration():1;if(re){const Ie=g.tile.getBucket(this).centroidVertexArray,Le=N+1;if(Le<Ie.length){const Ne=Ie.get(Le);H[0]=Ne.a_centroid_pos0,H[1]=Ne.a_centroid_pos1}}if(H[0]===0&&H[1]===1)return!1;const me=function(Ie,Le,Ne,je,qe,Ye,ot,rt,wt){return Ye?function(gt,nt,_t,Tt,ht,zt,Nt,Ri,tr){const zi=[],Fi=[],pt=[0,0,0,1];for(const Vi of gt){const $i=[],xr=[];for(const cr of Vi){const Cr=cr.x+Tt.x,Gr=cr.y+Tt.y,ji=$p(Cr,Gr,nt,_t,zt,Nt,Ri,tr);pt[0]=Cr,pt[1]=Gr,pt[2]=ji.base,pt[3]=1,jt(pt,pt,ht),pt[3]=Math.max(pt[3],1e-5);const Di=_d([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);pt[0]=Cr,pt[1]=Gr,pt[2]=ji.top,pt[3]=1,jt(pt,pt,ht),pt[3]=Math.max(pt[3],1e-5);const or=_d([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);$i.push(Di),xr.push(or)}zi.push($i),Fi.push(xr)}return[zi,Fi]}(Ie,Le,Ne,je,qe,Ye,ot,rt,wt):function(gt,nt,_t,Tt,ht){const zt=[],Nt=[],Ri=ht[8]*nt,tr=ht[9]*nt,zi=ht[10]*nt,Fi=ht[11]*nt,pt=ht[8]*_t,Vi=ht[9]*_t,$i=ht[10]*_t,xr=ht[11]*_t;for(const cr of gt){const Cr=[],Gr=[];for(const ji of cr){const Di=ji.x+Tt.x,or=ji.y+Tt.y,vr=ht[0]*Di+ht[4]*or+ht[12],dr=ht[1]*Di+ht[5]*or+ht[13],Er=ht[2]*Di+ht[6]*or+ht[14],Vr=ht[3]*Di+ht[7]*or+ht[15],nn=vr+Ri,on=dr+tr,nr=Er+zi,Dr=Math.max(Vr+Fi,1e-5),Pn=vr+pt,$r=dr+Vi,Ki=Er+$i,Pr=Math.max(Vr+xr,1e-5),sr=new U(nn/Dr,on/Dr);sr.z=nr/Dr,Cr.push(sr);const qr=new U(Pn/Pr,$r/Pr);qr.z=Ki/Pr,Gr.push(qr)}zt.push(Cr),Nt.push(Gr)}return[zt,Nt]}(Ie,Le,Ne,je,qe)}(T,Y,X,j,P,re?F:null,H,ue,I.center.lat),be=g.queryGeometry;return function(Ie,Le,Ne){let je=1/0;Ku(Ne,Le)&&(je=gd(Ne,Le[0]));for(let qe=0;qe<Le.length;qe++){const Ye=Le[qe],ot=Ie[qe];for(let rt=0;rt<Ye.length-1;rt++){const wt=Ye[rt],gt=[wt,Ye[rt+1],ot[rt+1],ot[rt],wt];Wu(Ne,gt)&&(je=Math.min(je,gd(Ne,gt)))}}return je!==1/0&&je}(me[0],me[1],be.isPointQuery()?be.screenBounds:be.screenGeometry)}},line:class extends $n{constructor(g){super(g,yd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(g){if(g==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof as,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(g,l){super.recalculate(g,l),this.paint._values["line-floorwidth"]=xd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,g)}createBucket(g){return new zh(g)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(g){return new _o(this,g)}queryRadius(g){const l=g,b=vd(ba("line-width",this,l),ba("line-gap-width",this,l)),T=ba("line-offset",this,l);return b/2+Math.abs(T)+kh(this.paint.get("line-translate"))}queryIntersectsFeature(g,l,b,T,A,I){if(g.queryGeometry.isAboveHorizon)return!1;const P=td(g.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,g.pixelToTileUnitsFactor),F=g.pixelToTileUnitsFactor/2*vd(this.paint.get("line-width").evaluate(l,b),this.paint.get("line-gap-width").evaluate(l,b)),N=this.paint.get("line-offset").evaluate(l,b);return N&&(T=function(j,X){const Y=[],H=new U(0,0);for(let re=0;re<j.length;re++){const ue=j[re],me=[];for(let be=0;be<ue.length;be++){const Ie=ue[be-1],Le=ue[be],Ne=ue[be+1],je=be===0?H:Le.sub(Ie)._unit()._perp(),qe=be===ue.length-1?H:Ne.sub(Le)._unit()._perp(),Ye=je._add(qe)._unit();Ye._mult(1/(Ye.x*qe.x+Ye.y*qe.y)),me.push(Ye._mult(X)._add(Le))}Y.push(me)}return Y}(T,N*g.pixelToTileUnitsFactor)),function(j,X,Y){for(let H=0;H<X.length;H++){const re=X[H];if(j.length>=3){for(let ue=0;ue<re.length;ue++)if(va(j,re[ue]))return!0}if(tp(j,re,Y))return!0}return!1}(P,T,F)}isTileClipped(){return!0}},symbol:qh,background:class extends $n{constructor(g){super(g,Pm)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $n{constructor(g){super(g,Rm)}getProgramIds(){return["raster"]}},sky:class extends $n{constructor(g){super(g,Lm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(g){g==="sky-gradient"?this._updateColorRamp():g!=="sky-atmosphere-sun"&&g!=="sky-atmosphere-halo-color"&&g!=="sky-atmosphere-color"&&g!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Oc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(g){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=g.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}}getCenter(g,l){const b=this.paint.get("sky-type");if(b==="atmosphere"){const T=this.paint.get("sky-atmosphere-sun"),A=!T,I=g.style.light,P=I.properties.get("position");return A&&I.properties.get("anchor")==="viewport"&&Ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),A?au(P.azimuthal,90-P.polar,l):au(T[0],90-T[1],l)}if(b==="gradient"){const T=this.paint.get("sky-gradient-center");return au(T[0],90-T[1],l)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(g){this._skyboxInvalidated=!1,this._lightPosition=g.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const g=this.paint.get("sky-type");return g==="atmosphere"?["skyboxCapture","skybox"]:g==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:Hd,HTMLCanvasElement:Wd,HTMLVideoElement:Kd,ImageData:Jd,ImageBitmap:Zh}=G;class Xh{constructor(l,b,T,A){this.context=l,this.format=T,this.texture=l.gl.createTexture(),this.update(b,A)}update(l,b,T){const{width:A,height:I}=l,{context:P}=this,{gl:F}=P;if(F.bindTexture(F.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!b||b.premultiply!==!1)),T||this.size&&this.size[0]===A&&this.size[1]===I){const{x:N,y:j}=T||{x:0,y:0};l instanceof Hd||l instanceof Wd||l instanceof Kd||l instanceof Jd||Zh&&l instanceof Zh?F.texSubImage2D(F.TEXTURE_2D,0,N,j,F.RGBA,F.UNSIGNED_BYTE,l):F.texSubImage2D(F.TEXTURE_2D,0,N,j,A,I,F.RGBA,F.UNSIGNED_BYTE,l.data)}else this.size=[A,I],l instanceof Hd||l instanceof Wd||l instanceof Kd||l instanceof Jd||Zh&&l instanceof Zh?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,l):F.texImage2D(F.TEXTURE_2D,0,this.format,A,I,0,this.format,F.UNSIGNED_BYTE,l.data);this.useMipmap=Boolean(b&&b.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&F.generateMipmap(F.TEXTURE_2D)}bind(l,b){const{context:T}=this,{gl:A}=T;A.bindTexture(A.TEXTURE_2D,this.texture),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?l===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_NEAREST:l),this.filter=l),b!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,b),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,b),this.wrap=b)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class lu{constructor(l,b){this.width=l,this.height=b,this.nextRow=0,this.image=new Uo({width:l,height:b}),this.positions={},this.uploaded=!1}getDash(l,b){const T=this.getKey(l,b);return this.positions[T]}trim(){const l=this.width,b=this.height=ci(this.nextRow);this.image.resize({width:l,height:b})}getKey(l,b){return l.join(",")+b}getDashRanges(l,b,T){const A=[];let I=l.length%2==1?-l[l.length-1]*T:0,P=l[0]*T,F=!0;A.push({left:I,right:P,isDash:F,zeroLength:l[0]===0});let N=l[0];for(let j=1;j<l.length;j++){F=!F;const X=l[j];I=N*T,N+=X,P=N*T,A.push({left:I,right:P,isDash:F,zeroLength:X===0})}return A}addRoundDash(l,b,T){const A=b/2;for(let I=-T;I<=T;I++){const P=this.width*(this.nextRow+T+I);let F=0,N=l[F];for(let j=0;j<this.width;j++){j/N.right>1&&(N=l[++F]);const X=Math.abs(j-N.left),Y=Math.abs(j-N.right),H=Math.min(X,Y);let re;const ue=I/T*(A+1);if(N.isDash){const me=A-Math.abs(ue);re=Math.sqrt(H*H+me*me)}else re=A-Math.sqrt(H*H+ue*ue);this.image.data[P+j]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(l,b){for(let N=l.length-1;N>=0;--N){const j=l[N],X=l[N+1];j.zeroLength?l.splice(N,1):X&&X.isDash===j.isDash&&(X.left=j.left,l.splice(N,1))}const T=l[0],A=l[l.length-1];T.isDash===A.isDash&&(T.left=A.left-this.width,A.right=T.right+this.width);const I=this.width*this.nextRow;let P=0,F=l[P];for(let N=0;N<this.width;N++){N/F.right>1&&(F=l[++P]);const j=Math.abs(N-F.left),X=Math.abs(N-F.right),Y=Math.min(j,X);this.image.data[I+N]=Math.max(0,Math.min(255,(F.isDash?Y:-Y)+b+128))}}addDash(l,b){const T=this.getKey(l,b);if(this.positions[T])return this.positions[T];const A=b==="round",I=A?7:0,P=2*I+1;if(this.nextRow+P>this.height)return Ii("LineAtlas out of space"),null;l.length===0&&l.push(1);let F=0;for(let X=0;X<l.length;X++)l[X]<0&&(Ii("Negative value is found in line dasharray, replacing values with 0"),l[X]=0),F+=l[X];if(F!==0){const X=this.width/F,Y=this.getDashRanges(l,this.width,X);A?this.addRoundDash(Y,X,I):this.addRegularDash(Y,b==="square"?.5*X:0)}const N=this.nextRow+I;this.nextRow+=P;const j={tl:[N,I],br:[F,0]};return this.positions[T]=j,j}}Ot("LineAtlas",lu);class Fm{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Om=G.performance;function Qd(g){const l=g?g.url.toString():void 0;return Om.getEntriesByName(l)}class $m{constructor(){this.tasks={},this.taskQueue=[],Ti(["process"],this),this.invoker=new Fm(this.process),this.nextId=0}add(l,b){const T=this.nextId++,A=function({type:I,isSymbolTile:P,zoom:F}){return F=F||0,I==="message"?0:I!=="maybePrepare"||P?I!=="parseTile"||P?I==="parseTile"&&P?300-F:I==="maybePrepare"&&P?400-F:500:200-F:100-F}(b);if(A===0){pr();try{l()}finally{}return{cancel:()=>{}}}return this.tasks[T]={fn:l,metadata:b,priority:A,id:T},this.taskQueue.push(T),this.invoker.trigger(),{cancel:()=>{delete this.tasks[T]}}}process(){pr();try{if(this.taskQueue=this.taskQueue.filter(T=>!!this.tasks[T]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const b=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!b)return;b.fn()}finally{}}pick(){let l=null,b=1/0;for(let A=0;A<this.taskQueue.length;A++){const I=this.tasks[this.taskQueue[A]];I.priority<b&&(b=I.priority,l=A)}if(l===null)return null;const T=this.taskQueue[l];return this.taskQueue.splice(l,1),T}remove(){this.invoker.remove()}}function ef(g,l,b){var T=2*Math.PI*6378137/256/Math.pow(2,b);return[g*T-2*Math.PI*6378137/2,l*T-2*Math.PI*6378137/2]}class Yh{constructor(l,b,T){this.z=l,this.x=b,this.y=T,this.key=Ml(0,l,l,b,T)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,b){const T=function(I,P,F){var N=ef(256*I,256*(P=Math.pow(2,F)-P-1),F),j=ef(256*(I+1),256*(P+1),F);return N[0]+","+N[1]+","+j[0]+","+j[1]}(this.x,this.y,this.z),A=function(I,P,F){let N,j="";for(let X=I;X>0;X--)N=1<<X-1,j+=(P&N?1:0)+(F&N?2:0);return j}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(b==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",A).replace("{bbox-epsg-3857}",T)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hu{constructor(l,b){this.wrap=l,this.canonical=b,this.key=Ml(l,b.z,b.z,b.x,b.y)}}class rn{constructor(l,b,T,A,I){this.overscaledZ=l,this.wrap=b,this.canonical=new Yh(T,+A,+I),this.key=b===0&&l===T?this.canonical.key:Ml(b,l,T,A,I)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const b=this.canonical.z-l;return l>this.canonical.z?new rn(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rn(l,this.wrap,l,this.canonical.x>>b,this.canonical.y>>b)}calculateScaledKey(l,b=!0){if(this.overscaledZ===l&&b)return this.key;if(l>this.canonical.z)return Ml(this.wrap*+b,l,this.canonical.z,this.canonical.x,this.canonical.y);{const T=this.canonical.z-l;return Ml(this.wrap*+b,l,l,this.canonical.x>>T,this.canonical.y>>T)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const b=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>b&&l.canonical.y===this.canonical.y>>b}children(l){if(this.overscaledZ>=l)return[new rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const b=this.canonical.z+1,T=2*this.canonical.x,A=2*this.canonical.y;return[new rn(b,this.wrap,b,T,A),new rn(b,this.wrap,b,T+1,A),new rn(b,this.wrap,b,T,A+1),new rn(b,this.wrap,b,T+1,A+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new rn(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ml(g,l,b,T,A){const I=1<<Math.min(b,22);let P=I*(A%I)+T%I;return g&&b<22&&(P+=I*I*((g<0?-2*g-1:2*g)%(1<<2*(22-b)))),16*(32*P+b)+(l-b)}Ot("CanonicalTileID",Yh),Ot("OverscaledTileID",rn,{omit:["projMatrix"]});class Ca{constructor(l,b,T){this.func=l,this.mask=b,this.range=T}}Ca.ReadOnly=!1,Ca.ReadWrite=!0,Ca.disabled=new Ca(519,Ca.ReadOnly,[0,1]);const cu=7680;class uu{constructor(l,b,T,A,I,P){this.test=l,this.ref=b,this.mask=T,this.fail=A,this.depthFail=I,this.pass=P}}uu.disabled=new uu({func:519,mask:0},0,0,cu,cu,cu);class oo{constructor(l,b,T){this.blendFunction=l,this.blendColor=b,this.mask=T}}oo.Replace=[1,0],oo.disabled=new oo(oo.Replace,Oi.transparent,[!1,!1,!1,!1]),oo.unblended=new oo(oo.Replace,Oi.transparent,[!0,!0,!0,!0]),oo.alphaBlended=new oo([1,771],Oi.transparent,[!0,!0,!0,!0]);const du=1029,fu=2305;class Vn{constructor(l,b,T){this.enable=l,this.mode=b,this.frontFace=T}}Vn.disabled=new Vn(!1,du,fu),Vn.backCCW=new Vn(!0,du,fu),Vn.backCW=new Vn(!0,du,2304),Vn.frontCW=new Vn(!0,1028,2304),Vn.frontCCW=new Vn(!0,1028,fu);class tf{constructor(l){this._stringToNumber={},this._numberToString=[];for(let b=0;b<l.length;b++){const T=l[b];this._stringToNumber[T]=b,this._numberToString[b]=T}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}class rf{constructor(l,b,T,A,I){this.type="Feature",this._vectorTileFeature=l,l._z=b,l._x=T,l._y=A,this.properties=l.properties,this.id=I}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const b in this)b!=="_geometry"&&b!=="_vectorTileFeature"&&(l[b]=this[b]);return l}}class Nm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,b,T){const A=String(b);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][A]=this.stateChanges[l][A]||{},Kt(this.stateChanges[l][A],T),this.deletedStates[l]===null){this.deletedStates[l]={};for(const I in this.state[l])I!==A&&(this.deletedStates[l][I]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][A]===null){this.deletedStates[l][A]={};for(const I in this.state[l][A])T[I]||(this.deletedStates[l][A][I]=null)}else for(const I in T)this.deletedStates[l]&&this.deletedStates[l][A]&&this.deletedStates[l][A][I]===null&&delete this.deletedStates[l][A][I]}removeFeatureState(l,b,T){if(this.deletedStates[l]===null)return;const A=String(b);if(this.deletedStates[l]=this.deletedStates[l]||{},T&&b!==void 0)this.deletedStates[l][A]!==null&&(this.deletedStates[l][A]=this.deletedStates[l][A]||{},this.deletedStates[l][A][T]=null);else if(b!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][A])for(T in this.deletedStates[l][A]={},this.stateChanges[l][A])this.deletedStates[l][A][T]=null;else this.deletedStates[l][A]=null;else this.deletedStates[l]=null}getState(l,b){const T=String(b),A=Kt({},(this.state[l]||{})[T],(this.stateChanges[l]||{})[T]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const I=this.deletedStates[l][b];if(I===null)return{};for(const P in I)delete A[P]}return A}initializeTileState(l,b){l.setFeatureState(this.state,b)}coalesceChanges(l,b){const T={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const I={};for(const P in this.stateChanges[A])this.state[A][P]||(this.state[A][P]={}),Kt(this.state[A][P],this.stateChanges[A][P]),I[P]=this.state[A][P];T[A]=I}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const I={};if(this.deletedStates[A]===null)for(const P in this.state[A])I[P]={},this.state[A][P]={};else for(const P in this.deletedStates[A]){if(this.deletedStates[A][P]===null)this.state[A][P]={};else for(const F of Object.keys(this.deletedStates[A][P]))delete this.state[A][P][F];I[P]=this.state[A][P]}T[A]=T[A]||{},Kt(T[A],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(T).length!==0)for(const A in l)l[A].setFeatureState(T,b)}}class nf{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,b){const T=this.toIdx(l,b);return{min:this.minimums[T],max:this.maximums[T]}}isLeaf(l,b){return this.leaves[this.toIdx(l,b)]}toIdx(l,b){return b*this.size+l}}function of(g,l,b,T){let A=0,I=Number.MAX_VALUE;for(let P=0;P<3;P++)if(Math.abs(T[P])<1e-15){if(b[P]<g[P]||b[P]>l[P])return null}else{const F=1/T[P];let N=(g[P]-b[P])*F,j=(l[P]-b[P])*F;if(N>j){const X=N;N=j,j=X}if(N>A&&(A=N),j<I&&(I=j),A>I)return null}return A}function sf(g,l,b,T,A,I,P,F,N,j,X){const Y=T-g,H=A-l,re=I-b,ue=P-g,me=F-l,be=N-b,Ie=X[1]*be-X[2]*me,Le=X[2]*ue-X[0]*be,Ne=X[0]*me-X[1]*ue,je=Y*Ie+H*Le+re*Ne;if(Math.abs(je)<1e-15)return null;const qe=1/je,Ye=j[0]-g,ot=j[1]-l,rt=j[2]-b,wt=(Ye*Ie+ot*Le+rt*Ne)*qe;if(wt<0||wt>1)return null;const gt=ot*re-rt*H,nt=rt*Y-Ye*re,_t=Ye*H-ot*Y,Tt=(X[0]*gt+X[1]*nt+X[2]*_t)*qe;return Tt<0||wt+Tt>1?null:(ue*gt+me*nt+be*_t)*qe}function af(g,l,b){return(g-l)/(b-l)}function lf(g,l,b,T,A,I,P,F,N){const j=1<<b,X=I-T,Y=P-A,H=(g+1)/j*X+T,re=(l+0)/j*Y+A,ue=(l+1)/j*Y+A;F[0]=(g+0)/j*X+T,F[1]=re,N[0]=H,N[1]=ue}class hf{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const b=function(I){const P=Math.ceil(Math.log2(I.dim/8)),F=[];let N=Math.ceil(Math.pow(2,P));const j=1/N,X=(re,ue,me,be,Ie)=>{const Le=be?1:0,Ne=(re+1)*me-Le,je=ue*me,qe=(ue+1)*me-Le;Ie[0]=re*me,Ie[1]=je,Ie[2]=Ne,Ie[3]=qe};let Y=new nf(N);const H=[];for(let re=0;re<N*N;re++){X(re%N,Math.floor(re/N),j,!1,H);const ue=qo(H[0],H[1],I),me=qo(H[2],H[1],I),be=qo(H[2],H[3],I),Ie=qo(H[0],H[3],I);Y.minimums.push(Math.min(ue,me,be,Ie)),Y.maximums.push(Math.max(ue,me,be,Ie)),Y.leaves.push(1)}for(F.push(Y),N/=2;N>=1;N/=2){const re=F[F.length-1];Y=new nf(N);for(let ue=0;ue<N*N;ue++){X(ue%N,Math.floor(ue/N),2,!0,H);const me=re.getElevation(H[0],H[1]),be=re.getElevation(H[2],H[1]),Ie=re.getElevation(H[2],H[3]),Le=re.getElevation(H[0],H[3]),Ne=re.isLeaf(H[0],H[1]),je=re.isLeaf(H[2],H[1]),qe=re.isLeaf(H[2],H[3]),Ye=re.isLeaf(H[0],H[3]),ot=Math.min(me.min,be.min,Ie.min,Le.min),rt=Math.max(me.max,be.max,Ie.max,Le.max),wt=Ne&&je&&qe&&Ye;Y.maximums.push(rt),Y.minimums.push(ot),Y.leaves.push(rt-ot<=5&&wt?1:0)}F.push(Y)}return F}(this.dem),T=b.length-1,A=b[T];this._addNode(A.minimums[0],A.maximums[0],A.leaves[0]),this._construct(b,0,0,T,0)}raycastRoot(l,b,T,A,I,P,F=1){return of([l,b,-100],[T,A,this.maximums[0]*F],I,P)}raycast(l,b,T,A,I,P,F=1){if(!this.nodeCount)return null;const N=this.raycastRoot(l,b,T,A,I,P,F);if(N==null)return null;const j=[],X=[],Y=[],H=[],re=[{idx:0,t:N,nodex:0,nodey:0,depth:0}];for(;re.length>0;){const{idx:ue,t:me,nodex:be,nodey:Ie,depth:Le}=re.pop();if(this.leaves[ue]){lf(be,Ie,Le,l,b,T,A,Y,H);const je=1<<Le,qe=(be+0)/je,Ye=(be+1)/je,ot=(Ie+0)/je,rt=(Ie+1)/je,wt=qo(qe,ot,this.dem)*F,gt=qo(Ye,ot,this.dem)*F,nt=qo(Ye,rt,this.dem)*F,_t=qo(qe,rt,this.dem)*F,Tt=sf(Y[0],Y[1],wt,H[0],Y[1],gt,H[0],H[1],nt,I,P),ht=sf(H[0],H[1],nt,Y[0],H[1],_t,Y[0],Y[1],wt,I,P),zt=Math.min(Tt!==null?Tt:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(zt!==Number.MAX_VALUE)return zt;{const Nt=Lt([],I,P,me);if(cf(wt,gt,_t,nt,af(Nt[0],Y[0],H[0]),af(Nt[1],Y[1],H[1]))>=Nt[2])return me}continue}let Ne=0;for(let je=0;je<this._siblingOffset.length;je++){lf((be<<1)+this._siblingOffset[je][0],(Ie<<1)+this._siblingOffset[je][1],Le+1,l,b,T,A,Y,H),Y[2]=-100,H[2]=this.maximums[this.childOffsets[ue]+je]*F;const qe=of(Y,H,I,P);if(qe!=null){const Ye=qe;j[je]=Ye;let ot=!1;for(let rt=0;rt<Ne&&!ot;rt++)Ye>=j[X[rt]]&&(X.splice(rt,0,je),ot=!0);ot||(X[Ne]=je),Ne++}}for(let je=0;je<Ne;je++){const qe=X[je];re.push({idx:this.childOffsets[ue]+qe,t:j[qe],nodex:(be<<1)+this._siblingOffset[qe][0],nodey:(Ie<<1)+this._siblingOffset[qe][1],depth:Le+1})}}return null}_addNode(l,b,T){return this.minimums.push(l),this.maximums.push(b),this.leaves.push(T),this.childOffsets.push(0),this.nodeCount++}_construct(l,b,T,A,I){if(l[A].isLeaf(b,T)===1)return;this.childOffsets[I]||(this.childOffsets[I]=this.nodeCount);const P=A-1,F=l[P];let N,j=0;for(let X=0;X<this._siblingOffset.length;X++){const Y=2*b+this._siblingOffset[X][0],H=2*T+this._siblingOffset[X][1],re=F.getElevation(Y,H),ue=F.isLeaf(Y,H),me=this._addNode(re.min,re.max,ue);ue&&(j|=1<<X),N||(N=me)}for(let X=0;X<this._siblingOffset.length;X++)j&1<<X||this._construct(l,2*b+this._siblingOffset[X][0],2*T+this._siblingOffset[X][1],P,N+X)}}function cf(g,l,b,T,A,I){return Gi(Gi(g,b,I),Gi(l,T,I),A)}function qo(g,l,b){const T=b.dim,A=Rt(g*T-.5,0,T-1),I=Rt(l*T-.5,0,T-1),P=Math.floor(A),F=Math.floor(I),N=Math.min(P+1,T-1),j=Math.min(F+1,T-1);return cf(b.get(P,F),b.get(N,F),b.get(P,j),b.get(N,j),A-P,I-F)}const uf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Hh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,b,T,A=!1,I=!1){if(this.uid=l,b.height!==b.width)throw new RangeError("DEM tiles must be square");if(T&&T!=="mapbox"&&T!=="terrarium")return Ii(`"${T}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=b.height;const P=this.dim=b.height-2;if(this.data=new Uint32Array(b.data.buffer),this.encoding=T||"mapbox",this.borderReady=A,!A){for(let F=0;F<P;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(P,F)]=this.data[this._idx(P-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,P)]=this.data[this._idx(F,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],I&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new hf(this)}get(l,b,T=!1){const A=new Uint8Array(this.data.buffer);T&&(l=Rt(l,-1,this.dim),b=Rt(b,-1,this.dim));const I=4*this._idx(l,b);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(A[I],A[I+1],A[I+2])}static getUnpackVector(l){return uf[l]}get unpackVector(){return uf[this.encoding]}_idx(l,b){if(l<-1||l>=this.dim+1||b<-1||b>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(b+1)*this.stride+(l+1)}_unpackMapbox(l,b,T){return(256*l*256+256*b+T)/10-1e4}_unpackTerrarium(l,b,T){return 256*l+b+T/256-32768}static pack(l,b){const T=[0,0,0,0],A=Hh.getUnpackVector(b);let I=Math.floor((l+A[3])/A[2]);return T[2]=I%256,I=Math.floor(I/256),T[1]=I%256,I=Math.floor(I/256),T[0]=I,T}getPixels(){return new wn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,b,T){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let A=b*this.dim,I=b*this.dim+this.dim,P=T*this.dim,F=T*this.dim+this.dim;switch(b){case-1:A=I-1;break;case 1:I=A+1}switch(T){case-1:P=F-1;break;case 1:F=P+1}const N=-b*this.dim,j=-T*this.dim;for(let X=P;X<F;X++)for(let Y=A;Y<I;Y++)this.data[this._idx(Y,X)]=l.data[this._idx(Y+N,X+j)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ot("DEMData",Hh),Ot("DemMinMaxQuadTree",hf,{omit:["dem"]});class Um{constructor(l,b){this.max=l,this.onRemove=b,this.reset()}reset(){for(const l in this.data)for(const b of this.data[l])b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value);return this.data={},this.order=[],this}add(l,b,T){const A=l.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const I={value:b,timeout:void 0};if(T!==void 0&&(I.timeout=setTimeout(()=>{this.remove(l,I)},T)),this.data[A].push(I),this.order.push(A),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const b=this.data[l].shift();return b.timeout&&clearTimeout(b.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),b.value}getByKey(l){const b=this.data[l];return b?b[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,b){if(!this.has(l))return this;const T=l.wrapped().key,A=b===void 0?0:this.data[T].indexOf(b),I=this.data[T][A];return this.data[T].splice(A,1),I.timeout&&clearTimeout(I.timeout),this.data[T].length===0&&delete this.data[T],this.onRemove(I.value),this.order.splice(this.order.indexOf(T),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}filter(l){const b=[];for(const T in this.data)for(const A of this.data[T])l(A.value)||b.push(A);for(const T of b)this.remove(T.value.tileID,T)}}class Is extends Zn{constructor(l,b,T){super(),this.id=l,this._onlySymbols=T,b.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),b.on("error",()=>{this._sourceErrored=!0}),this._source=b,this._tiles={},this._cache=new Um(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Nm}onAdd(l){this.map=l,this._minTileCacheSize=l?l._minTileCacheSize:null,this._maxTileCacheSize=l?l._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const b=this._tiles[l];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,b){return l.isSymbolTile=this._onlySymbols,this._source.loadTile(l,b)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l,()=>{})}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const b in this._tiles){const T=this._tiles[b];T.upload(l),T.prepare(this.map.style.imageManager)}}getIds(){return Pi(this._tiles).map(l=>l.tileID).sort(df).map(l=>l.key)}getRenderableIds(l){const b=[];for(const T in this._tiles)this._isIdRenderable(+T,l)&&b.push(this._tiles[T]);return l?b.sort((T,A)=>{const I=T.tileID,P=A.tileID,F=new U(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),N=new U(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-P.overscaledZ||N.y-F.y||N.x-F.x}).map(T=>T.tileID.key):b.map(T=>T.tileID).sort(df).map(T=>T.key)}hasRenderableParent(l){const b=this.findLoadedParent(l,0);return!!b&&this._isIdRenderable(b.tileID.key)}_isIdRenderable(l,b){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(b||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,b){const T=this._tiles[l];T&&(T.state!=="loading"&&(T.state=b),this._loadTile(T,this._tileLoaded.bind(this,T,l,b)))}_tileLoaded(l,b,T,A){if(A)if(l.state="errored",A.status!==404)this._source.fire(new zs(A,{tile:l}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform);else l.timeAdded=Ge.now(),T==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(b,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new qn("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id}))}_backfillDEM(l){const b=this.getRenderableIds();for(let A=0;A<b.length;A++){const I=b[A];if(l.neighboringTiles&&l.neighboringTiles[I]){const P=this.getTileByID(I);T(l,P),T(P,l)}}function T(A,I){if(!A.dem||A.dem.borderReady)return;A.needsHillshadePrepare=!0,A.needsDEMTextureUpload=!0;let P=I.tileID.canonical.x-A.tileID.canonical.x;const F=I.tileID.canonical.y-A.tileID.canonical.y,N=Math.pow(2,A.tileID.canonical.z),j=I.tileID.key;P===0&&F===0||Math.abs(F)>1||(Math.abs(P)>1&&(Math.abs(P+N)===1?P+=N:Math.abs(P-N)===1&&(P-=N)),I.dem&&A.dem&&(A.dem.backfillBorder(I.dem,P,F),A.neighboringTiles&&A.neighboringTiles[j]&&(A.neighboringTiles[j].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,b,T,A){for(const I in this._tiles){let P=this._tiles[I];if(A[I]||!P.hasData()||P.tileID.overscaledZ<=b||P.tileID.overscaledZ>T)continue;let F=P.tileID;for(;P&&P.tileID.overscaledZ>b+1;){const j=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[j.key],P&&P.hasData()&&(F=j)}let N=F;for(;N.overscaledZ>b;)if(N=N.scaledTo(N.overscaledZ-1),l[N.key]){A[F.key]=F;break}}}findLoadedParent(l,b){if(l.key in this._loadedParentTiles){const T=this._loadedParentTiles[l.key];return T&&T.tileID.overscaledZ>=b?T:null}for(let T=l.overscaledZ-1;T>=b;T--){const A=l.scaledTo(T),I=this._getLoadedTile(A);if(I)return I}}_getLoadedTile(l){const b=this._tiles[l.key];return b&&b.hasData()?b:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,b){b=b||this._source.tileSize;const T=Math.ceil(l.width/b)+1,A=Math.ceil(l.height/b)+1,I=Math.floor(T*A*5),P=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,I):I,F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(F)}handleWrapJump(l){const b=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,b){const T={};for(const A in this._tiles){const I=this._tiles[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+b),T[I.tileID.key]=I}this._tiles=T;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(+A,this._tiles[A])}}update(l,b,T){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!T)return;let A;this.updateCacheSize(l,b),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?A=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new rn(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(A=l.coveringTiles({tileSize:b||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!T,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(A=A.filter(F=>this._source.hasTile(F)))):A=[];const I=this._updateRetainedTiles(A);if(ff(this._source.type)&&A.length!==0){const F={},N={},j=Object.keys(I);for(const Y of j){const H=I[Y],re=this._tiles[Y];if(!re||re.fadeEndTime&&re.fadeEndTime<=Ge.now())continue;const ue=this.findLoadedParent(H,Math.max(H.overscaledZ-Is.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),F[ue.tileID.key]=ue.tileID),N[Y]=H}const X=A[A.length-1].overscaledZ;for(const Y in this._tiles){const H=this._tiles[Y];if(I[Y]||!H.hasData())continue;let re=H.tileID;for(;re.overscaledZ>X;){re=re.scaledTo(re.overscaledZ-1);const ue=this._tiles[re.key];if(ue&&ue.hasData()&&N[re.key]){I[Y]=H.tileID;break}}}for(const Y in F)I[Y]||(this._coveredTiles[Y]=!0,I[Y]=F[Y])}for(const F in I)this._tiles[F].clearFadeHold();const P=function(F,N){const j=[];for(const X in F)X in N||j.push(X);return j}(this._tiles,I);for(const F of P){const N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const b={};if(l.length===0)return b;const T={},A=l.reduce((j,X)=>Math.min(j,X.overscaledZ),1/0),I=l[0].overscaledZ,P=Math.max(I-Is.maxOverzooming,this._source.minzoom),F=Math.max(I+Is.maxUnderzooming,this._source.minzoom),N={};for(const j of l){const X=this._addTile(j);b[j.key]=j,X.hasData()||A<this._source.maxzoom&&(N[j.key]=j)}this._retainLoadedChildren(N,A,F,b);for(const j of l){let X=this._tiles[j.key];if(X.hasData())continue;if(j.canonical.z>=this._source.maxzoom){const H=j.children(this._source.maxzoom)[0],re=this.getTile(H);if(re&&re.hasData()){b[H.key]=H;continue}}else{const H=j.children(this._source.maxzoom);if(b[H[0].key]&&b[H[1].key]&&b[H[2].key]&&b[H[3].key])continue}let Y=X.wasRequested();for(let H=j.overscaledZ-1;H>=P;--H){const re=j.scaledTo(H);if(T[re.key]||(T[re.key]=!0,X=this.getTile(re),!X&&Y&&(X=this._addTile(re)),X&&(b[re.key]=re,Y=X.wasRequested(),X.hasData())))break}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const b=[];let T,A=this._tiles[l].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){T=this._loadedParentTiles[A.key];break}b.push(A.key);const I=A.scaledTo(A.overscaledZ-1);if(T=this._getLoadedTile(I),T)break;A=I}for(const I of b)this._loadedParentTiles[I]=T}}_addTile(l){let b=this._tiles[l.key];if(b)return b;b=this._cache.getAndRemove(l),b&&(this._setTileReloadTimer(l.key,b),b.tileID=l,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,b)));const T=Boolean(b);if(!T){const A=this.map?this.map.painter:null,I=this._source.type==="raster"||this._source.type==="raster-dem";b=new mu(l,this._source.tileSize*l.overscaleFactor(),this.transform.tileZoom,A,I),this._loadTile(b,this._tileLoaded.bind(this,b,l.key,b.state))}return b?(b.uses++,this._tiles[l.key]=b,T||this._source.fire(new qn("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b):null}_setTileReloadTimer(l,b){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const T=b.getExpiryTimeout();T&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},T))}_removeTile(l){const b=this._tiles[l];b&&(b.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(l,b,T){const A=[],I=this.transform;if(!I)return A;for(const P in this._tiles){const F=this._tiles[P];if(T&&F.clearQueryDebugViz(),F.holdingForFade())continue;const N=l.containsTile(F,I,b);N&&A.push(N)}return A}getVisibleCoordinates(l){const b=this.getRenderableIds(l).map(T=>this._tiles[T].tileID);for(const T of b)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped());return b}hasTransition(){if(this._source.hasTransition())return!0;if(ff(this._source.type))for(const l in this._tiles){const b=this._tiles[l];if(b.fadeEndTime!==void 0&&b.fadeEndTime>=Ge.now())return!0}return!1}setFeatureState(l,b,T){this._state.updateState(l=l||"_geojsonTileLayer",b,T)}removeFeatureState(l,b,T){this._state.removeFeatureState(l=l||"_geojsonTileLayer",b,T)}getFeatureState(l,b){return this._state.getState(l=l||"_geojsonTileLayer",b)}setDependencies(l,b,T){const A=this._tiles[l];A&&A.setDependencies(b,T)}reloadTilesForDependencies(l,b){for(const T in this._tiles)this._tiles[T].hasDependency(l,b)&&this._reloadTile(+T,"reloading");this._cache.filter(T=>!T.hasDependency(l,b))}_preloadTiles(l,b){const T=new Map,A=Array.isArray(l)?l:[l],I=this.map.painter.terrain,P=this.usedForTerrain&&I?I.getScaledDemTileSize():this._source.tileSize;for(const j of A){const X=j.coveringTiles({tileSize:P,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Y of X)T.set(Y.key,Y);this.usedForTerrain&&j.updateElevation(!1)}const F=Array.from(T.values()),N=this._source.type==="raster"||this._source.type==="raster-dem";bt(F,(j,X)=>{const Y=new mu(j,this._source.tileSize*j.overscaleFactor(),this.transform.tileZoom,this.map.painter,N);this._loadTile(Y,H=>{this._source.type==="raster-dem"&&Y.dem&&this._backfillDEM(Y),X(H,Y)})},b)}}function df(g,l){const b=Math.abs(2*g.wrap)-+(g.wrap<0),T=Math.abs(2*l.wrap)-+(l.wrap<0);return g.overscaledZ-l.overscaledZ||T-b||l.canonical.y-g.canonical.y||l.canonical.x-g.canonical.x}function ff(g){return g==="raster"||g==="image"||g==="video"}Is.maxOverzooming=10,Is.maxUnderzooming=3;class Wh{constructor(l,b,T){this._demTile=l,this._dem=this._demTile.dem,this._scale=b,this._offset=T}static create(l,b,T){const A=T||l.findDEMTileFor(b);if(!A||!A.dem)return;const I=A.dem,P=A.tileID,F=1<<b.canonical.z-P.canonical.z;return new Wh(A,A.tileSize/Si/F,[(b.canonical.x/F-P.canonical.x)*I.dim,(b.canonical.y/F-P.canonical.y)*I.dim])}tileCoordToPixel(l,b){const T=b*this._scale+this._offset[1],A=Math.floor(l*this._scale+this._offset[0]),I=Math.floor(T);return new U(A,I)}getElevationAt(l,b,T,A){const I=l*this._scale+this._offset[0],P=b*this._scale+this._offset[1],F=Math.floor(I),N=Math.floor(P),j=this._dem;return A=!!A,T?Gi(Gi(j.get(F,N,A),j.get(F,N+1,A),P-N),Gi(j.get(F+1,N,A),j.get(F+1,N+1,A),P-N),I-F):j.get(F,N,A)}getElevationAtPixel(l,b,T){return this._dem.get(l,b,!!T)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*Nn(1,l)*this._dem.stride}}class pf{constructor(l,b){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new xs(Si,16,0),this.featureIndexArray=new Fu,this.promoteId=b}insert(l,b,T,A,I,P=0){const F=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(T,A,I,P);const N=this.grid;for(let j=0;j<b.length;j++){const X=b[j],Y=[1/0,1/0,-1/0,-1/0];for(let H=0;H<X.length;H++){const re=X[H];Y[0]=Math.min(Y[0],re.x),Y[1]=Math.min(Y[1],re.y),Y[2]=Math.max(Y[2],re.x),Y[3]=Math.max(Y[3],re.y)}Y[0]<Si&&Y[1]<Si&&Y[2]>=0&&Y[3]>=0&&N.insert(F,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new As.VectorTile(new wl(this.rawTileData)).layers,this.sourceLayerCoder=new tf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,b,T,A){this.loadVTLayers();const I=l.params||{},P=ca(I.filter),F=l.tileResult,N=l.transform,j=F.bufferedTilespaceBounds,X=this.grid.query(j.min.x,j.min.y,j.max.x,j.max.y,(ue,me,be,Ie)=>ed(F.bufferedTilespaceGeometry,ue,me,be,Ie));X.sort(Vm);let Y=null;N.elevation&&X.length>0&&(Y=Wh.create(N.elevation,this.tileID));const H={};let re;for(let ue=0;ue<X.length;ue++){const me=X[ue];if(me===re)continue;re=me;const be=this.featureIndexArray.get(me);let Ie=null;this.loadMatchingFeature(H,be,P,I.layers,I.availableImages,b,T,A,(Le,Ne,je,qe=0)=>(Ie||(Ie=xo(Le,this.tileID.canonical,l.tileTransform)),Ne.queryIntersectsFeature(F,Le,je,Ie,this.z,l.transform,l.pixelPosMatrix,Y,qe)))}return H}loadMatchingFeature(l,b,T,A,I,P,F,N,j){const{featureIndex:X,bucketIndex:Y,sourceLayerIndex:H,layoutVertexArrayOffset:re}=b,ue=this.bucketLayerIDs[Y];if(A&&!function(Le,Ne){for(let je=0;je<Le.length;je++)if(Ne.indexOf(Le[je])>=0)return!0;return!1}(A,ue))return;const me=this.sourceLayerCoder.decode(H),be=this.vtLayers[me].feature(X);if(T.needGeometry){const Le=Ss(be,!0);if(!T.filter(new di(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!T.filter(new di(this.tileID.overscaledZ),be))return;const Ie=this.getId(be,me);for(let Le=0;Le<ue.length;Le++){const Ne=ue[Le];if(A&&A.indexOf(Ne)<0)continue;const je=P[Ne];if(!je)continue;let qe={};Ie!==void 0&&N&&(qe=N.getState(je.sourceLayer||"_geojsonTileLayer",Ie));const Ye=Kt({},F[Ne]);Ye.paint=mf(Ye.paint,je.paint,be,qe,I),Ye.layout=mf(Ye.layout,je.layout,be,qe,I);const ot=!j||j(be,je,qe,re);if(!ot)continue;const rt=new rf(be,this.z,this.x,this.y,Ie);rt.layer=Ye;let wt=l[Ne];wt===void 0&&(wt=l[Ne]=[]),wt.push({featureIndex:X,feature:rt,intersectionZ:ot})}}lookupSymbolFeatures(l,b,T,A,I,P,F,N){const j={};this.loadVTLayers();const X=ca(I);for(const Y of l)this.loadMatchingFeature(j,{bucketIndex:T,sourceLayerIndex:A,featureIndex:Y,layoutVertexArrayOffset:0},X,P,F,N,b);return j}loadFeature(l){const{featureIndex:b,sourceLayerIndex:T}=l;this.loadVTLayers();const A=this.sourceLayerCoder.decode(T),I=this.vtFeatures[A];if(I[b])return I[b];const P=this.vtLayers[A].feature(b);return I[b]=P,P}hasLayer(l){for(const b of this.bucketLayerIDs)for(const T of b)if(l===T)return!0;return!1}getId(l,b){let T=l.id;return this.promoteId&&(T=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[b]],typeof T=="boolean"&&(T=Number(T))),T}}function mf(g,l,b,T,A){return hi(g,(I,P)=>{const F=l instanceof fo?l.get(P):null;return F&&F.evaluate?F.evaluate(b,T,A):F})}function Vm(g,l){return l-g}Ot("FeatureIndex",pf,{omit:["rawTileData","sourceLayerCoder"]});var jm=lr([{name:"a_pos",type:"Int16",components:2}]);const Dn=32,so=33,Zo=new Uint16Array(8184);for(let g=0;g<2046;g++){let l=g+2,b=0,T=0,A=0,I=0,P=0,F=0;for(1&l?A=I=P=Dn:b=T=F=Dn;(l>>=1)>1;){const j=b+A>>1,X=T+I>>1;1&l?(A=b,I=T,b=P,T=F):(b=A,T=I,A=P,I=F),P=j,F=X}const N=4*g;Zo[N+0]=b,Zo[N+1]=T,Zo[N+2]=A,Zo[N+3]=I}const ao=new Uint16Array(2178),Xo=new Uint8Array(1089),Kh=new Uint16Array(1089);function gf(g){return g===0?-.03125:g===32?.03125:0}var pu=lr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const _f={type:2,extent:Si,loadGeometry:()=>[[new U(0,0),new U(8193,0),new U(8193,8193),new U(0,8193),new U(0,0)]]};class mu{constructor(l,b,T,A,I){this.tileID=l,this.uid=Zt(),this.uses=0,this.tileSize=b,this.tileZoom=T,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=I,this.expiredRequestCount=0,this.state="loading",A&&A.transform&&(this.projection=A.transform.projection)}registerFadeDuration(l){const b=l+this.timeAdded;b<Ge.now()||this.fadeEndTime&&b<this.fadeEndTime||(this.fadeEndTime=b)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Da(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,b,T){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(A,I){const P={};if(!I)return P;for(const F of A){const N=F.layerIds.map(j=>I.getLayer(j)).filter(Boolean);if(N.length!==0){F.layers=N,F.stateDependentLayerIds&&(F.stateDependentLayers=F.stateDependentLayerIds.map(j=>N.filter(X=>X.id===j)[0]));for(const j of N)P[j.id]=F}}return P}(l.buckets,b.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const I=this.buckets[A];if(I instanceof Go){if(this.hasSymbolBuckets=!0,!T)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const I=this.buckets[A];if(I instanceof Go&&I.hasRTLText){this.hasRTLText=!0,Li.isLoading()||Li.isLoaded()||un()!=="deferred"||vn();break}}this.queryPadding=0;for(const A in this.buckets){const I=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,b.style.getLayer(A).queryRadius(I))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas)}else this.collisionBoxArray=new Ac}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(l){return this.buckets[l.id]}upload(l){for(const T in this.buckets){const A=this.buckets[T];A.uploadPending()&&A.upload(l)}const b=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xh(l,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xh(l,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xh(l,this.lineAtlas.image,b.ALPHA),this.lineAtlas.uploaded=!0)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,b,T,A,I,P,F,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:A,pixelPosMatrix:F,transform:P,params:I,tileTransform:this.tileTransform},l,b,T):{}}querySourceFeatures(l,b){const T=this.latestFeatureIndex;if(!T||!T.rawTileData)return;const A=T.loadVTLayers(),I=b?b.sourceLayer:"",P=A._geojsonTileLayer||A[I];if(!P)return;const F=ca(b&&b.filter),{z:N,x:j,y:X}=this.tileID.canonical,Y={z:N,x:j,y:X};for(let H=0;H<P.length;H++){const re=P.feature(H);if(F.needGeometry){const be=Ss(re,!0);if(!F.filter(new di(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!F.filter(new di(this.tileID.overscaledZ),re))continue;const ue=T.getId(re,I),me=new rf(re,N,j,X,ue);me.tile=Y,l.push(me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const b=this.expirationTime;if(l.cacheControl){const T=Br(l.cacheControl);T["max-age"]&&(this.expirationTime=Date.now()+1e3*T["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const T=Date.now();let A=!1;if(this.expirationTime>T)A=!1;else if(b)if(this.expirationTime<b)A=!0;else{const I=this.expirationTime-b;I?this.expirationTime=T+Math.max(I,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0||!b)return;const T=this.latestFeatureIndex.loadVTLayers(),A=b.style.listImages();for(const I in this.buckets){if(!b.style.hasLayer(I))continue;const P=this.buckets[I],F=P.layers[0].sourceLayer||"_geojsonTileLayer",N=T[F],j=l[F];if(!N||!j||Object.keys(j).length===0)continue;if(P.update(j,N,A,this.imageAtlas&&this.imageAtlas.patternPositions||{}),P instanceof zh||P instanceof Lh){const Y=b.style._getSourceCache(P.layers[0].source);b._terrain&&b._terrain.enabled&&Y&&P.programConfigurations.needsUpload&&b._terrain._clearRenderCacheForTile(Y.id,this.tileID)}const X=b&&b.style&&b.style.getLayer(I);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=Ge.now()+l}setDependencies(l,b){const T={};for(const A of b)T[A]=!0;this.dependencies[l]=T}hasDependency(l,b){for(const T of l){const A=this.dependencies[T];if(A){for(const I of b)if(A[I])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,b){if(!b||b.name==="mercator"||this._tileDebugBuffer)return;const T=xo(_f,this.tileID.canonical,this.tileTransform)[0],A=new pa,I=new bh;for(let P=0;P<T.length;P++){const{x:F,y:N}=T[P];A.emplaceBack(F,N),I.emplaceBack(P)}I.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(I),this._tileDebugBuffer=l.createVertexBuffer(A,pu.members),this._tileDebugSegments=_r.simpleSegment(0,0,A.length,I.length)}_makeTileBoundsBuffers(l,b){if(this._tileBoundsBuffer||!b||b.name==="mercator")return;const T=xo(_f,this.tileID.canonical,this.tileTransform)[0];let A,I;if(this.isRaster){const P=function(F,N){const j=Da(F,N),X=Math.pow(2,F.z);for(let be=0;be<so;be++)for(let Ie=0;Ie<so;Ie++){const Le=yo((F.x+(Ie+gf(Ie))/Dn)/X),Ne=Cn((F.y+(be+gf(be))/Dn)/X),je=N.project(Le,Ne),qe=be*so+Ie;ao[2*qe+0]=Math.round((je.x*j.scale-j.x)*Si),ao[2*qe+1]=Math.round((je.y*j.scale-j.y)*Si)}Xo.fill(0),Kh.fill(0);for(let be=2045;be>=0;be--){const Ie=4*be,Le=Zo[Ie+0],Ne=Zo[Ie+1],je=Zo[Ie+2],qe=Zo[Ie+3],Ye=Le+je>>1,ot=Ne+qe>>1,rt=Ye+ot-Ne,wt=ot+Le-Ye,gt=Ne*so+Le,nt=qe*so+je,_t=ot*so+Ye,Tt=Math.hypot((ao[2*gt+0]+ao[2*nt+0])/2-ao[2*_t+0],(ao[2*gt+1]+ao[2*nt+1])/2-ao[2*_t+1])>=16;if(Xo[_t]=Xo[_t]||(Tt?1:0),be<1022){const ht=(Ne+wt>>1)*so+(Le+rt>>1),zt=(qe+wt>>1)*so+(je+rt>>1);Xo[_t]=Xo[_t]||Xo[ht]||Xo[zt]}}const Y=new ma,H=new bn;let re=0;function ue(be,Ie){const Le=Ie*so+be;return Kh[Le]===0&&(Y.emplaceBack(ao[2*Le+0],ao[2*Le+1],be*Si/Dn,Ie*Si/Dn),Kh[Le]=++re),Kh[Le]-1}function me(be,Ie,Le,Ne,je,qe){const Ye=be+Le>>1,ot=Ie+Ne>>1;if(Math.abs(be-je)+Math.abs(Ie-qe)>1&&Xo[ot*so+Ye])me(je,qe,be,Ie,Ye,ot),me(Le,Ne,je,qe,Ye,ot);else{const rt=ue(be,Ie),wt=ue(Le,Ne),gt=ue(je,qe);H.emplaceBack(rt,wt,gt)}}return me(0,0,Dn,Dn,Dn,0),me(Dn,Dn,0,0,0,Dn),{vertices:Y,indices:H}}(this.tileID.canonical,b);A=P.vertices,I=P.indices}else{A=new ma,I=new bn;for(const{x:F,y:N}of T)A.emplaceBack(F,N,0,0);const P=Ch(A.int16,void 0,4);for(let F=0;F<P.length;F+=3)I.emplaceBack(P[F],P[F+1],P[F+2])}this._tileBoundsBuffer=l.createVertexBuffer(A,pu.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(I),this._tileBoundsSegments=_r.simpleSegment(0,0,A.length,I.length)}}const Gm=lr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),qm=lr([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yf}=Gm;function ks(g,l){const b=g.fovAboveCenter,T=g.elevation?g.elevation.getMinElevationBelowMSL()*l:0,A=(g._camera.position[2]*g.worldSize-T)/Math.cos(g._pitch),I=Math.sin(b)*A/Math.sin(Math.max(Math.PI/2-g._pitch-b,.01)),P=Math.sin(g._pitch)*I+A;return Math.min(1.01*P,A*(1/g._horizonShift))}const gu=Si/Math.PI/2,dn=-gu,fn=gu,Zm=[new Un([dn,dn,dn],[fn,fn,fn]),new Un([dn,dn,dn],[0,0,fn]),new Un([0,dn,dn],[fn,0,fn]),new Un([dn,0,dn],[0,fn,fn]),new Un([0,0,dn],[fn,fn,fn])];function Jh(g){if(g.z<=1)return Zm[g.z+2*g.y+g.x];const[l,b]=xf(g),T=[Qh(l[0],l[1]),Qh(l[0],b[1]),Qh(b[0],l[1]),Qh(b[0],b[1])],A=[fn,fn,fn],I=[dn,dn,dn];for(const P of T)A[0]=Math.min(A[0],P[0]),A[1]=Math.min(A[1],P[1]),A[2]=Math.min(A[2],P[2]),I[0]=Math.max(I[0],P[0]),I[1]=Math.max(I[1],P[1]),I[2]=Math.max(I[2],P[2]);return new Un(A,I)}function xf(g){const l=Math.pow(2,g.z),b=g.x/l,T=(g.x+1)/l,A=(g.y+1)/l;return[[Cn(g.y/l),yo(b)],[Cn(A),yo(T)]]}function _u(g,l,b,T){return b=mt(b),T||(T=gu),[g*Math.sin(b)*T,-l*T,g*Math.cos(b)*T]}function Qh(g,l,b){return _u(Math.cos(mt(g)),Math.sin(mt(g)),l,b)}function vf(g){return 16383/Math.max(...At([],g.max,g.min))}function bf(g){const l=ee(new Float64Array(16)),b=1/vf(g);return se(l,l,g.min),he(l,l,[b,b,b]),l}function wf(g,l,b){const T=l/(2*Math.PI),A=function(P){const F=Si/(2*Math.PI);return P/(2*Math.PI)/F}(l);if(!b){const P=Rt(g.center.lat,-85.051129,ro);b=[ya(g.center.lng)*l,xa(P)*l]}const I=ee(new Float64Array(16));return se(I,I,[b[0],b[1],-T]),he(I,I,[A,A,A]),ge(I,I,mt(-g._center.lat)),Re(I,I,mt(-g._center.lng)),I}class yu{constructor(l){const b=this._createGridIndices();this.gridIndexBuffer=l.createIndexBuffer(b,!0),this.gridSegments=_r.simpleSegment(0,0,4225,8192);const T=this._createPoleTriangleIndices();this.poleIndexBuffer=l.createIndexBuffer(T,!0),this.poleSegments=_r.simpleSegment(0,0,66,64);const A=new dl;A.emplaceBack(-1,1,1,0,0,0,0),A.emplaceBack(1,1,1,0,0,1,0),A.emplaceBack(1,-1,1,0,0,1,1),A.emplaceBack(-1,-1,1,0,0,0,1);const I=new bn;I.emplaceBack(0,1,2),I.emplaceBack(2,3,0),this.atmosphereVertexBuffer=l.createVertexBuffer(A,qm.members),this.atmosphereIndexBuffer=l.createIndexBuffer(I),this.atmosphereSegments=_r.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(l,b,T){const A=new dl,I=b/Math.PI/2;A.emplaceBack(0,-I,0,0,0,.5,T?0:1);const P=360/l,F=Math.cos(mt(85)),N=Math.sin(mt(85));for(let X=0;X<=64;X++){const Y=X/64,H=_u(F,N,0*(1-(j=Y))+P*j,I);A.emplaceBack(H[0],H[1],H[2],0,0,Y,T?0:1)}var j;return A}_createPoleTriangleIndices(){const l=new bn;for(let b=0;b<=64;b++)l.emplaceBack(0,b+1,b+2);return l}static createGridVertices(l){const b=Math.pow(2,l.z),T=(N,j,X)=>N*(1-X)+j*X,[A,I]=xf(l),P=new dl,F=function(N){const j=ee(new Float64Array(16)),X=vf(N);var Y,H;return he(j,j,[X,X,X]),se(j,j,((Y=[])[0]=-(H=N.min)[0],Y[1]=-H[1],Y[2]=-H[2],Y)),j}(Jh(l));P.reserve(4096);for(let N=0;N<65;N++){const j=T(A[0],I[0],N/64),X=xa(j),Y=X*b-l.y,H=Math.sin(mt(j)),re=Math.cos(mt(j));for(let ue=0;ue<65;ue++){const me=ue/64,be=T(A[1],I[1],me),Ie=_u(re,H,be);Mt(Ie,Ie,F);const Le=ya(be);P.emplaceBack(Ie[0],Ie[1],Ie[2],Le,X,me,Y)}}return P}_createGridIndices(){const l=new bn,b=(T,A)=>{const I=65*A+T;l.emplaceBack(I+1,I,I+65),l.emplaceBack(I+65,I+65+1,I+1)};for(let T=0;T<64;T++)for(let A=0;A<64;A++)b(A,T);return l}getWirefameBuffer(l){if(!this.wireframeSegments){const b=this._createWireframeGrid();this.wireframeIndexBuffer=l.createIndexBuffer(b),this.wireframeSegments=_r.simpleSegment(0,0,4096,b.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const l=new $o,b=(T,A)=>{const I=65*A+T;l.emplaceBack(I,I+1),l.emplaceBack(I,I+65),l.emplaceBack(I,I+65+1)};for(let T=0;T<64;T++)for(let A=0;A<64;A++)b(A,T);return l}}function Da(g,l){if(!l.isReprojectedInTileSpace)return{scale:1<<g.z,x:g.x,y:g.y,x2:g.x+1,y2:g.y+1,projection:l};const b=Math.pow(2,-g.z),T=g.x*b,A=(g.x+1)*b,I=g.y*b,P=(g.y+1)*b,F=yo(T),N=yo(A),j=Cn(I),X=Cn(P),Y=l.project(F,j),H=l.project(N,j),re=l.project(N,X),ue=l.project(F,X);let me=Math.min(Y.x,H.x,re.x,ue.x),be=Math.min(Y.y,H.y,re.y,ue.y),Ie=Math.max(Y.x,H.x,re.x,ue.x),Le=Math.max(Y.y,H.y,re.y,ue.y);const Ne=b/16;function je(Ye,ot,rt,wt,gt,nt){const _t=(rt+gt)/2,Tt=(wt+nt)/2,ht=l.project(yo(_t),Cn(Tt)),zt=Math.max(0,me-ht.x,be-ht.y,ht.x-Ie,ht.y-Le);me=Math.min(me,ht.x),Ie=Math.max(Ie,ht.x),be=Math.min(be,ht.y),Le=Math.max(Le,ht.y),zt>Ne&&(je(Ye,ht,rt,wt,_t,Tt),je(ht,ot,_t,Tt,gt,nt))}je(Y,H,T,I,A,I),je(H,re,A,I,A,P),je(re,ue,A,P,T,P),je(ue,Y,T,P,T,I),me-=Ne,be-=Ne,Ie+=Ne,Le+=Ne;const qe=1/Math.max(Ie-me,Le-be);return{scale:qe,x:me*qe,y:be*qe,x2:Ie*qe,y2:Le*qe,projection:l}}class Ef{constructor(l){const b={},T=[];for(const F in l){const N=l[F],j=b[F]={};for(const X in N.glyphs){const Y=N.glyphs[+X];if(!Y||Y.bitmap.width===0||Y.bitmap.height===0)continue;const H=Y.metrics.localGlyph?2:1,re={x:0,y:0,w:Y.bitmap.width+2*H,h:Y.bitmap.height+2*H};T.push(re),j[X]=re}}const{w:A,h:I}=Yc(T),P=new Uo({width:A||1,height:I||1});for(const F in l){const N=l[F];for(const j in N.glyphs){const X=N.glyphs[+j];if(!X||X.bitmap.width===0||X.bitmap.height===0)continue;const Y=b[F][j],H=X.metrics.localGlyph?2:1;Uo.copy(X.bitmap,P,{x:0,y:0},{x:Y.x+H,y:Y.y+H},X.bitmap)}}this.image=P,this.positions=b}}Ot("GlyphAtlas",Ef);class Xm{constructor(l){this.tileID=new rn(l.tileID.overscaledZ,l.tileID.wrap,l.tileID.canonical.z,l.tileID.canonical.x,l.tileID.canonical.y),this.tileZoom=l.tileZoom,this.uid=l.uid,this.zoom=l.zoom,this.canonical=l.tileID.canonical,this.pixelRatio=l.pixelRatio,this.tileSize=l.tileSize,this.source=l.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=l.showCollisionBoxes,this.collectResourceTiming=!!l.collectResourceTiming,this.returnDependencies=!!l.returnDependencies,this.promoteId=l.promoteId,this.enableTerrain=!!l.enableTerrain,this.isSymbolTile=l.isSymbolTile,this.tileTransform=Da(l.tileID.canonical,l.projection),this.projection=l.projection}parse(l,b,T,A,I){this.status="parsing",this.data=l,this.collisionBoxArray=new Ac;const P=new tf(Object.keys(l.layers).sort()),F=new pf(this.tileID,this.promoteId);F.bucketLayerIDs=[];const N={},j=new lu(256,256),X={featureIndex:F,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:j,availableImages:T},Y=b.familiesBySource[this.source];for(const qe in Y){const Ye=l.layers[qe];if(!Ye)continue;let ot=!1,rt=!1;for(const nt of Y[qe])nt[0].type==="symbol"?ot=!0:rt=!0;if(this.isSymbolTile===!0&&!ot||this.isSymbolTile===!1&&!rt)continue;Ye.version===1&&Ii(`Vector tile source "${this.source}" layer "${qe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wt=P.encode(qe),gt=[];for(let nt=0;nt<Ye.length;nt++){const _t=Ye.feature(nt),Tt=F.getId(_t,qe);gt.push({feature:_t,id:Tt,index:nt,sourceLayerIndex:wt})}for(const nt of Y[qe]){const _t=nt[0];this.isSymbolTile!==void 0&&_t.type==="symbol"!==this.isSymbolTile||_t.minzoom&&this.zoom<Math.floor(_t.minzoom)||_t.maxzoom&&this.zoom>=_t.maxzoom||_t.visibility!=="none"&&(xu(nt,this.zoom,T),(N[_t.id]=_t.createBucket({index:F.bucketLayerIDs.length,layers:nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:T})).populate(gt,X,this.tileID.canonical,this.tileTransform),F.bucketLayerIDs.push(nt.map(Tt=>Tt.id)))}}let H,re,ue,me;j.trim();const be={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ie=hi(X.glyphDependencies,qe=>Object.keys(qe).map(Number));Object.keys(Ie).length?A.send("getGlyphs",{uid:this.uid,stacks:Ie},(qe,Ye)=>{H||(H=qe,re=Ye,je.call(this))},void 0,!1,be):re={};const Le=Object.keys(X.iconDependencies);Le.length?A.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"icons"},(qe,Ye)=>{H||(H=qe,ue=Ye,je.call(this))},void 0,!1,be):ue={};const Ne=Object.keys(X.patternDependencies);function je(){if(H)return I(H);if(re&&ue&&me){const qe=new Ef(re),Ye=new Id(ue,me);for(const ot in N){const rt=N[ot];rt instanceof Go?(xu(rt.layers,this.zoom,T),Mm(rt,re,qe.positions,ue,Ye.iconPositions,this.showCollisionBoxes,T,this.tileID.canonical,this.tileZoom,this.projection),rt.projection=this.projection.name):rt.hasPattern&&(rt instanceof zh||rt instanceof Lh||rt instanceof qc)&&(xu(rt.layers,this.zoom,T),rt.addFeatures(X,this.tileID.canonical,Ye.patternPositions,T))}this.status="done",I(null,{buckets:Pi(N).filter(ot=>!ot.isEmpty()),featureIndex:F,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qe.image,lineAtlas:j,imageAtlas:Ye,glyphMap:this.returnDependencies?re:null,iconMap:this.returnDependencies?ue:null,glyphPositions:this.returnDependencies?qe.positions:null})}}Ne.length?A.send("getImages",{icons:Ne,source:this.source,tileID:this.tileID,type:"patterns"},(qe,Ye)=>{H||(H=qe,me=Ye,je.call(this))},void 0,!1,be):me={},je.call(this)}}function xu(g,l,b){const T=new di(l);for(const A of g)A.recalculate(T,b)}class Tf{constructor(l){this.entries={},this.scheduler=l}request(l,b,T,A){const I=this.entries[l]=this.entries[l]||{callbacks:[]};if(I.result){const[P,F]=I.result;return this.scheduler?this.scheduler.add(()=>{A(P,F)},b):A(P,F),()=>{}}return I.callbacks.push(A),I.cancel||(I.cancel=T((P,F)=>{I.result=[P,F];for(const N of I.callbacks)this.scheduler?this.scheduler.add(()=>{N(P,F)},b):N(P,F);setTimeout(()=>delete this.entries[l],3e3)})),()=>{I.result||(I.callbacks=I.callbacks.filter(P=>P!==A),I.callbacks.length||(I.cancel(),delete this.entries[l]))}}}function Mf(g,l,b){const T=JSON.stringify(g.request);return g.data&&(this.deduped.entries[T]={result:[null,g.data]}),this.deduped.request(T,{type:"parseTile",isSymbolTile:g.isSymbolTile,zoom:g.tileZoom},A=>{const I=Ko(g.request,(P,F,N,j)=>{P?A(P):F&&A(null,{vectorTile:b?void 0:new As.VectorTile(new wl(F)),rawData:F,cacheControl:N,expires:j})});return()=>{I.cancel(),A()}},l)}const Ym=ee(new Float64Array(16));class Cs{constructor(l,b){this._tr=l,this._worldSize=b}createInversionMatrix(){return Ym}createTileMatrix(l){let b,T,A;const I=l.canonical,P=ee(new Float64Array(16)),F=this._tr.projection;if(F.isReprojectedInTileSpace){const N=Da(I,F);b=1,T=N.x+l.wrap*N.scale,A=N.y,he(P,P,[b/N.scale,b/N.scale,this._tr.pixelsPerMeter/this._worldSize])}else b=this._worldSize/this._tr.zoomScale(I.z),T=(I.x+Math.pow(2,I.z)*l.wrap)*b,A=I.y*b;return se(P,P,[T,A,0]),he(P,P,[b/Si,b/Si,1]),P}pointCoordinate(l,b,T){const A=this._tr.horizonLineFromTop(!1),I=new U(l,Math.max(A,b));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(I,T))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Hm={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xi(this.parallels,this.constants.parallels))return;const g=Math.sin(mt(this.parallels[0])),l=(g+Math.sin(mt(this.parallels[1])))/2,b=1+g*(2*l-g),T=Math.sqrt(b)/l;this.constants={n:l,c:b,r0:T,parallels:this.parallels}},project(g,l){this.initializeConstants();const b=mt(g-this.center[0]),T=mt(l),{n:A,c:I,r0:P}=this.constants,F=Math.sqrt(I-2*A*Math.sin(T))/A;return{x:F*Math.sin(b*A),y:F*Math.cos(b*A)-P,z:0}},unproject(g,l){this.initializeConstants();const{n:b,c:T,r0:A}=this.constants,I=A+l;let P=Math.atan2(g,Math.abs(I))*Math.sign(I);I*b<0&&(P-=Math.PI*Math.sign(g)*Math.sign(I));const F=mt(this.center[0])*b;P=ni(P,-Math.PI-F,Math.PI-F);const N=vt(P/b)+this.center[0],j=Math.asin(Rt((T-(g*g+I*I)*b*b)/(2*b),-1,1)),X=Rt(vt(j),-85.051129,ro);return new Wi(N,X)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)};const Sl=1.340264,Al=-.081106,Il=893e-6,kl=.003796,ec=Math.sqrt(3)/2;var Wm={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(g,l){l=l/180*Math.PI,g=g/180*Math.PI;const b=Math.asin(ec*Math.sin(l)),T=b*b,A=T*T*T;return{x:.5*(g*Math.cos(b)/(ec*(Sl+3*Al*T+A*(7*Il+9*kl*T)))/Math.PI+.5),y:1-.5*(b*(Sl+Al*T+A*(Il+kl*T))/Math.PI+1),z:0}},unproject(g,l){g=(2*g-.5)*Math.PI;let b=l=(2*(1-l)-1)*Math.PI,T=b*b,A=T*T*T;for(let j,X,Y,H=0;H<12&&(X=b*(Sl+Al*T+A*(Il+kl*T))-l,Y=Sl+3*Al*T+A*(7*Il+9*kl*T),j=X/Y,b=Rt(b-j,-Math.PI/3,Math.PI/3),T=b*b,A=T*T*T,!(Math.abs(j)<1e-12));++H);const I=ec*g*(Sl+3*Al*T+A*(7*Il+9*kl*T))/Math.cos(b),P=Math.asin(Math.sin(b)/ec),F=Rt(180*I/Math.PI,-180,180),N=Rt(180*P/Math.PI,-85.051129,ro);return new Wi(F,N)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)},Km={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(g,l)=>({x:.5+g/360,y:.5-l/360,z:0}),unproject(g,l){const b=360*(g-.5),T=Rt(360*(.5-l),-85.051129,ro);return new Wi(b,T)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)};const Pa=Math.PI/2;function tc(g){return Math.tan((Pa+g)/2)}var Jm={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xi(this.parallels,this.constants.parallels))return;const g=mt(this.parallels[0]),l=mt(this.parallels[1]),b=Math.cos(g),T=g===l?Math.sin(g):Math.log(b/Math.cos(l))/Math.log(tc(l)/tc(g)),A=b*Math.pow(tc(g),T)/T;this.constants={n:T,f:A,parallels:this.parallels}},project(g,l){this.initializeConstants(),l=mt(l),g=mt(g-this.center[0]);const b=1e-6,{n:T,f:A}=this.constants;A>0?l<-Pa+b&&(l=-Pa+b):l>Pa-b&&(l=Pa-b);const I=A/Math.pow(tc(l),T),P=I*Math.sin(T*g),F=A-I*Math.cos(T*g);return{x:.5*(P/Math.PI+.5),y:1-.5*(F/Math.PI+.5),z:0}},unproject(g,l){this.initializeConstants(),g=(2*g-.5)*Math.PI,l=(2*(1-l)-.5)*Math.PI;const{n:b,f:T}=this.constants,A=T-l,I=Math.sign(A),P=Math.sign(b)*Math.sqrt(g*g+A*A);let F=Math.atan2(g,Math.abs(A))*I;A*b<0&&(F-=Math.PI*Math.sign(g)*I);const N=Rt(vt(F/b)+this.center[0],-180,180),j=Rt(vt(2*Math.atan(Math.pow(T/P,1/b))-Pa),-85.051129,ro);return new Wi(N,j)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)},Qm={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(g,l)=>({x:ya(g),y:xa(l),z:0}),unproject(g,l){const b=yo(g),T=Cn(l);return new Wi(b,T)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)};const Sf=mt(ro);var eg={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(g,l){const b=(l=mt(l))*l,T=b*b;return{x:.5*((g=mt(g))*(.8707-.131979*b+T*(T*(.003971*b-.001529*T)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+b*(.015085+T*(.028874*b-.044475-.005916*T)))/Math.PI+1),z:0}},unproject(g,l){g=(2*g-.5)*Math.PI;let b=l=(2*(1-l)-1)*Math.PI,T=25,A=0,I=b*b;do{I=b*b;const N=I*I;A=(b*(1.007226+I*(.015085+N*(.028874*I-.044475-.005916*N)))-l)/(1.007226+I*(.045255+N*(.259866*I-.311325-.005916*11*N))),b=Rt(b-A,-Sf,Sf)}while(Math.abs(A)>1e-6&&--T>0);I=b*b;const P=Rt(vt(g/(.8707+I*(I*(I*I*I*(.003971-.001529*I)-.013791)-.131979))),-180,180),F=vt(b);return new Wi(P,F)},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)};const Af=mt(ro),If={albers:Hm,equalEarth:Wm,equirectangular:Km,lambertConformalConic:Jm,mercator:Qm,naturalEarth:eg,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(g,l){l=mt(l),g=mt(g);const b=Math.cos(l),T=2/Math.PI,A=Math.acos(b*Math.cos(g/2)),I=Math.sin(A)/A,P=.5*(g*T+2*b*Math.sin(g/2)/I)||0,F=.5*(l+Math.sin(l)/I)||0;return{x:.5*(P/Math.PI+.5),y:1-.5*(F/Math.PI+1),z:0}},unproject(g,l){let b=g=(2*g-.5)*Math.PI,T=l=(2*(1-l)-1)*Math.PI,A=25;const I=1e-6;let P=0,F=0;do{const N=Math.cos(T),j=Math.sin(T),X=2*j*N,Y=j*j,H=N*N,re=Math.cos(b/2),ue=Math.sin(b/2),me=2*re*ue,be=ue*ue,Ie=1-H*re*re,Le=Ie?1/Ie:0,Ne=Ie?Math.acos(N*re)*Math.sqrt(1/Ie):0,je=.5*(2*Ne*N*ue+2*b/Math.PI)-g,qe=.5*(Ne*j+T)-l,Ye=.5*Le*(H*be+Ne*N*re*Y)+1/Math.PI,ot=Le*(me*X/4-Ne*j*ue),rt=.125*Le*(X*ue-Ne*j*H*me),wt=.5*Le*(Y*re+Ne*be*N)+.5,gt=ot*rt-wt*Ye;P=(qe*ot-je*wt)/gt,F=(je*rt-qe*Ye)/gt,b=Rt(b-P,-Math.PI,Math.PI),T=Rt(T-F,-Af,Af)}while((Math.abs(P)>I||Math.abs(F)>I)&&--A>0);return new Wi(vt(b),vt(T))},projectTilePoint:(g,l)=>({x:g,y:l,z:0}),locationPoint:(g,l)=>g._coordinatePoint(g.locationCoordinate(l),!1),pixelsPerMeter:(g,l)=>Nn(1,g)*l,farthestPixelDistance(g){return ks(g,this.pixelsPerMeter(g.center.lat,g.worldSize))},createTileTransform:(g,l)=>new Cs(g,l)}};x.ARRAY_TYPE=te,x.AUTH_ERR_MSG=Ze,x.Aabb=Un,x.Actor=class{constructor(g,l,b){this.target=g,this.parent=l,this.mapId=b,this.callbacks={},this.cancelCallbacks={},Ti(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pr()?g:G,this.scheduler=new $m}send(g,l,b,T,A=!1,I){const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);b&&(b.metadata=I,this.callbacks[P]=b);const F=Sr(this.globalScope)?void 0:[];return this.target.postMessage({id:P,type:g,hasCallback:!!b,targetMapId:T,mustQueue:A,sourceMapId:this.mapId,data:ws(l,F)},F),{cancel:()=>{b&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:T,sourceMapId:this.mapId})}}}receive(g){const l=g.data,b=l.id;if(b&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const T=this.cancelCallbacks[b];delete this.cancelCallbacks[b],T&&T.cancel()}else if(l.mustQueue||pr()){const T=this.callbacks[b];this.cancelCallbacks[b]=this.scheduler.add(()=>this.processTask(b,l),T&&T.metadata||{type:"message"})}else this.processTask(b,l)}processTask(g,l){if(l.type==="<response>"){const b=this.callbacks[g];delete this.callbacks[g],b&&(l.error?b(to(l.error)):b(null,to(l.data)))}else{const b=Sr(this.globalScope)?void 0:[],T=l.hasCallback?(I,P)=>{delete this.cancelCallbacks[g],this.target.postMessage({id:g,type:"<response>",sourceMapId:this.mapId,error:I?ws(I):null,data:ws(P,b)},b)}:I=>{},A=to(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,A,T);else if(this.parent.getWorkerSource){const I=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,I[0],A.source)[I[1]](A,T)}else T(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},x.CanonicalTileID=Yh,x.Color=Oi,x.ColorMode=oo,x.CullFaceMode=Vn,x.DEMData=Hh,x.DataConstantProperty=$t,x.DedupedRequest=Tf,x.DepthMode=Ca,x.EXTENT=Si,x.Elevation=class{getAtPointOrZero(g,l=0){return this.getAtPoint(g,l)||0}getAtPoint(g,l,b=!0){l==null&&(l=null);const T=this._source();if(!T||g.y<0||g.y>1)return l;const A=T.getSource().maxzoom,I=1<<A,P=Math.floor(g.x),F=g.x-P,N=new rn(A,P,A,Math.floor(F*I),Math.floor(g.y*I)),j=this.findDEMTileFor(N);if(!j||!j.dem)return l;const X=j.dem,Y=1<<j.tileID.canonical.z,H=(F*Y-j.tileID.canonical.x)*X.dim,re=(g.y*Y-j.tileID.canonical.y)*X.dim,ue=Math.floor(H),me=Math.floor(re);return(b?this.exaggeration():1)*Gi(Gi(X.get(ue,me),X.get(ue,me+1),re-me),Gi(X.get(ue+1,me),X.get(ue+1,me+1),re-me),H-ue)}getAtTileOffset(g,l,b){const T=1<<g.canonical.z;return this.getAtPointOrZero(new Ah(g.wrap+(g.canonical.x+l/Si)/T,(g.canonical.y+b/Si)/T))}getAtTileOffsetFunc(g,l){return b=>{const T=this.getAtTileOffset(g,b.x,b.y),A=l.upVector(g.canonical,b.x,b.y);return Bt(A,A,T*l.upVectorScale(g.canonical)),A}}getForTilePoints(g,l,b,T){const A=Wh.create(this,g,T);return!!A&&(l.forEach(I=>{I[2]=this.exaggeration()*A.getElevationAt(I[0],I[1],b)}),!0)}getMinMaxForTile(g){const l=this.findDEMTileFor(g);if(!l||!l.dem)return null;const b=l.dem.tree,T=l.tileID,A=1<<g.canonical.z-T.canonical.z;let I=g.canonical.x/A-T.canonical.x,P=g.canonical.y/A-T.canonical.y,F=0;for(let N=0;N<g.canonical.z-T.canonical.z&&!b.leaves[F];N++){I*=2,P*=2;const j=2*Math.floor(P)+Math.floor(I);F=b.childOffsets[F]+j,I%=1,P%=1}return{min:this.exaggeration()*b.minimums[F],max:this.exaggeration()*b.maximums[F]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(g,l,b){throw new Error("Pure virtual method called.")}pointCoordinate(g){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(g){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},x.ErrorEvent=zs,x.EvaluationParameters=di,x.Event=qn,x.Evented=Zn,x.Frustum=Lc,x.GLOBE_ZOOM_THRESHOLD_MAX=6,x.GlobeSharedBuffers=yu,x.GlyphManager=Ia,x.ImagePosition=Hc,x.LineAtlas=lu,x.LngLat=Wi,x.LngLatBounds=Ms,x.LocalGlyphMode=Qc,x.MAX_MERCATOR_LATITUDE=ro,x.MercatorCoordinate=Ah,x.ONE_EM=Ur,x.OverscaledTileID=rn,x.Properties=Or,x.RGBAImage=wn,x.Ray=class{constructor(g,l){this.pos=g,this.dir=l}intersectsPlane(g,l,b){const T=Vt(l,this.dir);if(Math.abs(T)<1e-6)return!1;const A=((g[0]-this.pos[0])*l[0]+(g[1]-this.pos[1])*l[1]+(g[2]-this.pos[2])*l[2])/T;return b[0]=this.pos[0]+this.dir[0]*A,b[1]=this.pos[1]+this.dir[1]*A,b[2]=this.pos[2]+this.dir[2]*A,!0}closestPointOnSphere(g,l,b){if(function(H,re){var ue=H[0],me=H[1],be=H[2],Ie=re[0],Le=re[1],Ne=re[2];return Math.abs(ue-Ie)<=W*Math.max(1,Math.abs(ue),Math.abs(Ie))&&Math.abs(me-Le)<=W*Math.max(1,Math.abs(me),Math.abs(Le))&&Math.abs(be-Ne)<=W*Math.max(1,Math.abs(be),Math.abs(Ne))}(this.pos,g)||l===0)return b[0]=b[1]=b[2]=0,!1;const[T,A,I]=this.dir,P=this.pos[0]-g[0],F=this.pos[1]-g[1],N=this.pos[2]-g[2],j=T*T+A*A+I*I,X=2*(P*T+F*A+N*I),Y=X*X-4*j*(P*P+F*F+N*N-l*l);if(Y<0){const H=Math.max(-X/2,0),re=P+T*H,ue=F+A*H,me=N+I*H,be=Math.hypot(re,ue,me);return b[0]=re*l/be,b[1]=ue*l/be,b[2]=me*l/be,!1}{const H=(-X-Math.sqrt(Y))/(2*j);if(H<0){const re=Math.hypot(P,F,N);return b[0]=P*l/re,b[1]=F*l/re,b[2]=N*l/re,!1}return b[0]=P+T*H,b[1]=F+A*H,b[2]=N+I*H,!0}}},x.RequestManager=class{constructor(g,l,b){this._transformRequestFn=g,this._customAccessToken=l,this._silenceAuthErrors=!!b,this._createSkuToken()}_createSkuToken(){const g=function(){let l="";for(let b=0;b<10;b++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$e,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=g.token,this._skuTokenExpiresAt=g.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(g,l){return this._transformRequestFn&&this._transformRequestFn(g,l)||{url:g}}normalizeStyleURL(g,l){if(!Qe(g))return g;const b=Ct(g);return b.path=`/styles/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||l)}normalizeGlyphsURL(g,l){if(!Qe(g))return g;const b=Ct(g);return b.path=`/fonts/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||l)}normalizeSourceURL(g,l){if(!Qe(g))return g;const b=Ct(g);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),this._makeAPIURL(b,this._customAccessToken||l)}normalizeSpriteURL(g,l,b,T){const A=Ct(g);return Qe(g)?(A.path=`/styles/v1${A.path}/sprite${l}${b}`,this._makeAPIURL(A,this._customAccessToken||T)):(A.path+=`${l}${b}`,Gt(A))}normalizeTileURL(g,l,b){if(this._isSkuTokenExpired()&&this._createSkuToken(),g&&!Qe(g))return g;const T=Ct(g);T.path=T.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||b&&T.authority!=="raster"&&b===512?"@2x":""}${ne.supported?".webp":"$1"}`),T.authority==="raster"?T.path=`/${J.RASTER_URL_PREFIX}${T.path}`:(T.path=T.path.replace(/^.+\/v4\//,"/"),T.path=`/${J.TILE_URL_VERSION}${T.path}`);const A=this._customAccessToken||function(I){for(const P of I){const F=P.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(T.params)||J.ACCESS_TOKEN;return J.REQUIRE_ACCESS_TOKEN&&A&&this._skuToken&&T.params.push(`sku=${this._skuToken}`),this._makeAPIURL(T,A)}canonicalizeTileURL(g,l){const b=Ct(g);if(!b.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!b.path.match(/\.[\w]+$/))return g;let T="mapbox://";b.path.match(/^\/raster\/v1\//)?T+=`raster/${b.path.replace(`/${J.RASTER_URL_PREFIX}/`,"")}`:T+=`tiles/${b.path.replace(`/${J.TILE_URL_VERSION}/`,"")}`;let A=b.params;return l&&(A=A.filter(I=>!I.match(/^access_token=/))),A.length&&(T+=`?${A.join("&")}`),T}canonicalizeTileset(g,l){const b=!!l&&Qe(l),T=[];for(const A of g.tiles||[])et(A)?T.push(this.canonicalizeTileURL(A,b)):T.push(A);return T}_makeAPIURL(g,l){const b="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",T=Ct(J.API_URL);if(g.protocol=T.protocol,g.authority=T.authority,g.protocol==="http"){const A=g.params.indexOf("secure");A>=0&&g.params.splice(A,1)}if(T.path!=="/"&&(g.path=`${T.path}${g.path}`),!J.REQUIRE_ACCESS_TOKEN)return Gt(g);if(l=l||J.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${b}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${b}`)}return g.params=g.params.filter(A=>A.indexOf("access_token")===-1),g.params.push(`access_token=${l||""}`),Gt(g)}},x.ResourceType=Bs,x.SegmentVector=_r,x.SourceCache=Is,x.StencilMode=uu,x.StructArrayLayout1ui2=bh,x.StructArrayLayout2f1f2i16=vc,x.StructArrayLayout2i4=pa,x.StructArrayLayout2ui4=$o,x.StructArrayLayout3f12=ga,x.StructArrayLayout3ui6=bn,x.StructArrayLayout4i8=ma,x.Texture=Xh,x.Tile=mu,x.Transitionable=en,x.Uniform1f=Mh,x.Uniform1i=class extends mo{constructor(g,l){super(g,l),this.current=0}set(g){this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))}},x.Uniform2f=class extends mo{constructor(g,l){super(g,l),this.current=[0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1]))}},x.Uniform3f=class extends mo{constructor(g,l){super(g,l),this.current=[0,0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2]))}},x.Uniform4f=Vu,x.UniformColor=ju,x.UniformMatrix2f=class extends mo{constructor(g,l){super(g,l),this.current=qf}set(g){for(let l=0;l<4;l++)if(g[l]!==this.current[l]){this.current=g,this.gl.uniformMatrix2fv(this.location,!1,g);break}}},x.UniformMatrix3f=class extends mo{constructor(g,l){super(g,l),this.current=Gf}set(g){for(let l=0;l<9;l++)if(g[l]!==this.current[l]){this.current=g,this.gl.uniformMatrix3fv(this.location,!1,g);break}}},x.UniformMatrix4f=class extends mo{constructor(g,l){super(g,l),this.current=jf}set(g){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(let l=1;l<16;l++)if(g[l]!==this.current[l]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}}},x.UnwrappedTileID=hu,x.ValidationError=Pt,x.VectorTileWorkerSource=class extends Zn{constructor(g,l,b,T,A){super(),this.actor=g,this.layerIndex=l,this.availableImages=b,this.loadVectorData=A||Mf,this.loading={},this.loaded={},this.deduped=new Tf(g.scheduler),this.isSpriteLoaded=T,this.scheduler=g.scheduler}loadTile(g,l){const b=g.uid,T=g&&g.request,A=T&&T.collectResourceTiming,I=this.loading[b]=new Xm(g);I.abort=this.loadVectorData(g,(P,F)=>{const N=!this.loading[b];if(delete this.loading[b],N||P||!F)return I.status="done",N||(this.loaded[b]=I),l(P);const j=F.rawData,X={};F.expires&&(X.expires=F.expires),F.cacheControl&&(X.cacheControl=F.cacheControl),I.vectorTile=F.vectorTile||new As.VectorTile(new wl(j));const Y=()=>{I.parse(I.vectorTile,this.layerIndex,this.availableImages,this.actor,(H,re)=>{if(H||!re)return l(H);const ue={};if(A){const me=Qd(T);me.length>0&&(ue.resourceTiming=JSON.parse(JSON.stringify(me)))}l(null,Kt({rawTileData:j.slice(0)},re,X,ue))})};this.isSpriteLoaded?Y():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Y,{type:"parseTile",isSymbolTile:g.isSymbolTile,zoom:g.tileZoom}):Y()}),this.loaded=this.loaded||{},this.loaded[b]=I})}reloadTile(g,l){const b=this.loaded,T=g.uid,A=this;if(b&&b[T]){const I=b[T];I.showCollisionBoxes=g.showCollisionBoxes,I.enableTerrain=!!g.enableTerrain,I.projection=g.projection;const P=(F,N)=>{const j=I.reloadCallback;j&&(delete I.reloadCallback,I.parse(I.vectorTile,A.layerIndex,this.availableImages,A.actor,j)),l(F,N)};I.status==="parsing"?I.reloadCallback=P:I.status==="done"&&(I.vectorTile?I.parse(I.vectorTile,this.layerIndex,this.availableImages,this.actor,P):P())}}abortTile(g,l){const b=g.uid,T=this.loading[b];T&&(T.abort&&T.abort(),delete this.loading[b]),l()}removeTile(g,l){const b=this.loaded,T=g.uid;b&&b[T]&&delete b[T],l()}},x.WritingMode=En,x.ZoomHistory=C,x.add=ze,x.addDynamicAttributes=ru,x.adjoint=function(g,l){var b=l[0],T=l[1],A=l[2],I=l[3],P=l[4],F=l[5],N=l[6],j=l[7],X=l[8];return g[0]=P*X-F*j,g[1]=A*j-T*X,g[2]=T*F-A*P,g[3]=F*N-I*X,g[4]=b*X-A*N,g[5]=A*I-b*F,g[6]=I*j-P*N,g[7]=T*N-b*j,g[8]=b*P-T*I,g},x.asyncAll=bt,x.bezier=We,x.bindAll=Ti,x.boundsAttributes=pu,x.bufferConvexPolygon=function(g,l){const b=[];for(let T=0;T<g.length;T++){const A=ni(T-1,-1,g.length-1),I=ni(T+1,-1,g.length-1),P=g[T],F=g[I],N=g[A].sub(P).unit(),j=F.sub(P).unit(),X=j.angleWithSep(N.x,N.y),Y=N.add(j).unit().mult(-1*l/Math.sin(X/2));b.push(P.add(Y))}return b},x.cacheEntryPossiblyAdded=function(g){Rs++,Rs>Ba&&(g.getActor().send("enforceCacheSizeLimit",Rl),Rs=0)},x.calculateGlobeMatrix=wf,x.calculateGlobeMercatorMatrix=function(g){const l=g.worldSize,b=Rt(g.center.lat,-85.051129,ro),T=new U(ya(g.center.lng)*l,xa(b)*l),A=Nn(1,g.center.lat)*l,I=g.pixelsPerMeter,P=l/(A/g.pixelsPerMeter),F=ee(new Float64Array(16));return se(F,F,[T.x,T.y,0]),he(F,F,[P,P,I]),F},x.clamp=Rt,x.clearTileCache=function(g){const l=G.caches.delete(zr);g&&l.catch(g).then(()=>g())},x.clipLine=Nd,x.clone=function(g){var l=new te(16);return l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],l[4]=g[4],l[5]=g[5],l[6]=g[6],l[7]=g[7],l[8]=g[8],l[9]=g[9],l[10]=g[10],l[11]=g[11],l[12]=g[12],l[13]=g[13],l[14]=g[14],l[15]=g[15],l},x.clone$1=Ai,x.collisionCircleLayout=Kp,x.config=J,x.conjugate=function(g,l){return g[0]=-l[0],g[1]=-l[1],g[2]=-l[2],g[3]=l[3],g},x.create=function(){var g=new te(16);return te!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g},x.create$1=oe,x.createExpression=ms,x.createLayout=lr,x.createStyleLayer=function(g){return g.type==="custom"?new Bm(g):new zm[g.type](g)},x.cross=Ft,x.degToRad=mt,x.div=function(g,l,b){return g[0]=l[0]/b[0],g[1]=l[1]/b[1],g[2]=l[2]/b[2],g},x.dot=Vt,x.ease=Wt,x.easeCubicInOut=si,x.emitValidationErrors=gh,x.endsWith=ei,x.enforceCacheSizeLimit=function(g){Ho(),Tn&&Tn.then(l=>{l.keys().then(b=>{for(let T=0;T<b.length-g;T++)l.delete(b[T])})})},x.evaluateSizeForFeature=Fh,x.evaluateSizeForZoom=Ta,x.evaluateVariableOffset=qd,x.evented=Hr,x.exactEquals=function(g,l){return g[0]===l[0]&&g[1]===l[1]&&g[2]===l[2]&&g[3]===l[3]},x.exactEquals$1=function(g,l){return g[0]===l[0]&&g[1]===l[1]&&g[2]===l[2]},x.exported=Ge,x.exported$1=ne,x.extend=Kt,x.extend$1=Xn,x.filterObject=Ni,x.fromMat4=function(g,l){return g[0]=l[0],g[1]=l[1],g[2]=l[2],g[3]=l[4],g[4]=l[5],g[5]=l[6],g[6]=l[8],g[7]=l[9],g[8]=l[10],g},x.fromQuat=function(g,l){var b=l[0],T=l[1],A=l[2],I=l[3],P=b+b,F=T+T,N=A+A,j=b*P,X=T*P,Y=T*F,H=A*P,re=A*F,ue=A*N,me=I*P,be=I*F,Ie=I*N;return g[0]=1-Y-ue,g[1]=X+Ie,g[2]=H-be,g[3]=0,g[4]=X-Ie,g[5]=1-j-ue,g[6]=re+me,g[7]=0,g[8]=H+be,g[9]=re-me,g[10]=1-j-Y,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},x.fromRotation=function(g,l){var b=Math.sin(l),T=Math.cos(l);return g[0]=T,g[1]=b,g[2]=0,g[3]=-b,g[4]=T,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},x.fromScaling=function(g,l){return g[0]=l[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=l[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=l[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},x.furthestTileCorner=function(g){const l=Math.round((g+45+360)%360/90)%4;return pi[l]},x.getAABBPointSquareDist=function(g,l,b){let T=0;for(let A=0;A<2;++A){const I=b?b[A]:0;g[A]>I&&(T+=(g[A]-I)*(g[A]-I)),l[A]<I&&(T+=(I-l[A])*(I-l[A]))}return T},x.getAnchorAlignment=Jc,x.getAnchorJustification=tu,x.getBounds=function(g){let l=1/0,b=1/0,T=-1/0,A=-1/0;for(const I of g)l=Math.min(l,I.x),b=Math.min(b,I.y),T=Math.max(T,I.x),A=Math.max(A,I.y);return{min:new U(l,b),max:new U(T,A)}},x.getColumn=function(g,l){return[g[4*l],g[4*l+1],g[4*l+2],g[4*l+3]]},x.getImage=Ll,x.getJSON=function(g,l){return gn(Kt(g,{type:"json"}),l)},x.getMapSessionAPI=Gn,x.getPerformanceMeasurement=Qd,x.getProjection=function(g){const l=If[g.name];if(!l)throw new Error(`Invalid projection name: ${g.name}`);return l.conic?function(b,T){if(T.parallels&&Math.abs(T.parallels[0]+T.parallels[1])<.01){let A=function(I){const P=Math.max(.01,Math.cos(mt(I))),F=1/(2*Math.max(Math.PI*P,1/P));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(N,j){const X=mt(N)*P,Y=Math.sin(mt(j))/P;return{x:X*F+.5,y:-Y*F+.5,z:0}},unproject(N,j){const X=-(j-.5)/F,Y=Rt(vt((N-.5)/F)/P,-180,180),H=Math.asin(Rt(X*P,-1,1)),re=Rt(vt(H),-85.051129,ro);return new Wi(Y,re)}}}(T.parallels[0]);if(T.name==="lambertConformalConic"){const{project:I,unproject:P}=If.mercator;A={wrap:!0,supportsWorldCopies:!0,project:I,unproject:P}}return Kt({},b,T,A)}return Kt({},b,T)}(l,g):l},x.getRTLTextPluginStatus=un,x.getReferrer=za,x.getTilePoint=function(g,{x:l,y:b},T=0){return new U(((l-T)*g.scale-g.x)*Si,(b*g.scale-g.y)*Si)},x.getTileVec3=function(g,l,b=0){return ye(((l.x-b)*g.scale-g.x)*Si,(l.y*g.scale-g.y)*Si,Yu(l.z,l.y))},x.getVideo=function(g,l){const b=G.document.createElement("video");b.muted=!0,b.onloadstart=function(){l(null,b)};for(let T=0;T<g.length;T++){const A=G.document.createElement("source");Bl(g[T])||(b.crossOrigin="Anonymous"),A.src=g[T],b.appendChild(A)}return{cancel:()=>{}}},x.globeBuffersForTileMesh=function(g,l,b,T){const A=g.context,I=g.transform;let P=l.globeGridBuffer,F=l.globePoleBuffer;if(!P){const N=yu.createGridVertices(b.canonical);P=l.globeGridBuffer=A.createVertexBuffer(N,yf,!1)}if(!F){const N=yu.createPoleTriangleVertices(T,I.tileSize*T,b.canonical.y===0);F=l.globePoleBuffer=A.createVertexBuffer(N,yf,!1)}return[P,F]},x.globeDenormalizeECEF=bf,x.globeMatrixForTile=function(g,l){const b=bf(Jh(g)),T=((A=new Float64Array(16))[0]=(I=l)[0],A[1]=I[1],A[2]=I[2],A[3]=I[3],A[4]=I[4],A[5]=I[5],A[6]=I[6],A[7]=I[7],A[8]=I[8],A[9]=I[9],A[10]=I[10],A[11]=I[11],A[12]=I[12],A[13]=I[13],A[14]=I[14],A[15]=I[15],A);var A,I;return ve(T,T,b),T},x.globePoleMatrixForTile=function(g,l,b){const T=ee(new Float64Array(16)),A=Math.pow(2,g.z),I=(g.x-A/2)/A*Math.PI*2,P=b.point,F=b.worldSize/(b.tileSize*A);return se(T,T,[P.x,P.y,-b.worldSize/Math.PI/2]),he(T,T,[F,F,F]),ge(T,T,mt(-b._center.lat)),Re(T,T,mt(-b._center.lng)),Re(T,T,I),l&&he(T,T,[1,-1,1]),T},x.globeTileBounds=Jh,x.globeToMercatorTransition=function(g){return ti(5,6,g)},x.identity=ee,x.identity$1=oi,x.invert=function(g,l){var b=l[0],T=l[1],A=l[2],I=l[3],P=l[4],F=l[5],N=l[6],j=l[7],X=l[8],Y=l[9],H=l[10],re=l[11],ue=l[12],me=l[13],be=l[14],Ie=l[15],Le=b*F-T*P,Ne=b*N-A*P,je=b*j-I*P,qe=T*N-A*F,Ye=T*j-I*F,ot=A*j-I*N,rt=X*me-Y*ue,wt=X*be-H*ue,gt=X*Ie-re*ue,nt=Y*be-H*me,_t=Y*Ie-re*me,Tt=H*Ie-re*be,ht=Le*Tt-Ne*_t+je*nt+qe*gt-Ye*wt+ot*rt;return ht?(g[0]=(F*Tt-N*_t+j*nt)*(ht=1/ht),g[1]=(A*_t-T*Tt-I*nt)*ht,g[2]=(me*ot-be*Ye+Ie*qe)*ht,g[3]=(H*Ye-Y*ot-re*qe)*ht,g[4]=(N*gt-P*Tt-j*wt)*ht,g[5]=(b*Tt-A*gt+I*wt)*ht,g[6]=(be*je-ue*ot-Ie*Ne)*ht,g[7]=(X*ot-H*je+re*Ne)*ht,g[8]=(P*_t-F*gt+j*rt)*ht,g[9]=(T*gt-b*_t-I*rt)*ht,g[10]=(ue*Ye-me*je+Ie*Le)*ht,g[11]=(Y*je-X*Ye-re*Le)*ht,g[12]=(F*wt-P*nt-N*rt)*ht,g[13]=(b*nt-T*wt+A*rt)*ht,g[14]=(me*Ne-ue*qe-be*Le)*ht,g[15]=(X*qe-Y*Ne+H*Le)*ht,g):null},x.isMapAuthenticated=function(g){return Rn.has(g)},x.isMapboxURL=Qe,x.latFromMercatorY=Cn,x.len=Ut,x.length=ce,x.length$1=function(g){return Math.hypot(g[0],g[1],g[2],g[3])},x.loadVectorTile=Mf,x.makeRequest=gn,x.mercatorXfromLng=ya,x.mercatorYfromLat=xa,x.mercatorZfromAltitude=Nn,x.mul=ve,x.mul$1=Et,x.multiply=function(g,l,b){var T=l[0],A=l[1],I=l[2],P=l[3],F=l[4],N=l[5],j=l[6],X=l[7],Y=l[8],H=b[0],re=b[1],ue=b[2],me=b[3],be=b[4],Ie=b[5],Le=b[6],Ne=b[7],je=b[8];return g[0]=H*T+re*P+ue*j,g[1]=H*A+re*F+ue*X,g[2]=H*I+re*N+ue*Y,g[3]=me*T+be*P+Ie*j,g[4]=me*A+be*F+Ie*X,g[5]=me*I+be*N+Ie*Y,g[6]=Le*T+Ne*P+je*j,g[7]=Le*A+Ne*F+je*X,g[8]=Le*I+Ne*N+je*Y,g},x.multiply$1=_e,x.multiply$2=at,x.nextPowerOfTwo=ci,x.normalize=It,x.normalize$1=function(g,l){var b=l[0],T=l[1],A=l[2],I=l[3],P=b*b+T*T+A*A+I*I;return P>0&&(P=1/Math.sqrt(P)),g[0]=b*P,g[1]=T*P,g[2]=A*P,g[3]=I*P,g},x.number=Gi,x.ortho=function(g,l,b,T,A,I,P){var F=1/(l-b),N=1/(T-A),j=1/(I-P);return g[0]=-2*F,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*N,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*j,g[11]=0,g[12]=(l+b)*F,g[13]=(A+T)*N,g[14]=(P+I)*j,g[15]=1,g},x.pbf=wl,x.perspective=function(g,l,b,T,A){var I,P=1/Math.tan(l/2);return g[0]=P/b,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=P,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,A!=null&&A!==1/0?(g[10]=(A+T)*(I=1/(T-A)),g[14]=2*A*T*I):(g[10]=-1,g[14]=-2*T),g},x.pick=function(g,l){const b={};for(let T=0;T<l.length;T++){const A=l[T];A in g&&(b[A]=g[A])}return b},x.plugin=Li,x.pointGeometry=U,x.polygonIntersectsBox=ed,x.polygonIntersectsPolygon=Wu,x.polygonizeBounds=function(g,l,b=0,T=!0){const A=new U(b,b),I=g.sub(A),P=l.add(A),F=[I,new U(P.x,I.y),P,new U(I.x,P.y)];return T&&F.push(I),F},x.posAttributes=jm,x.postMapLoadEvent=qi,x.postTurnstileEvent=Yi,x.potpack=Yc,x.prevPowerOfTwo=function(g){return g<=1?1:Math.pow(2,Math.floor(Math.log(g)/Math.LN2))},x.radToDeg=vt,x.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],x.registerForPluginStateChange=function(g){return g({pluginStatus:ai,pluginURL:Mi}),Hr.on("pluginStateChange",g),g},x.removeAuthState=function(g){Rn.delete(g)},x.renderColorRamp=Oc,x.rotateX=ge,x.rotateX$1=yi,x.rotateY=Re,x.rotateZ=function(g,l,b){var T=Math.sin(b),A=Math.cos(b),I=l[0],P=l[1],F=l[2],N=l[3],j=l[4],X=l[5],Y=l[6],H=l[7];return l!==g&&(g[8]=l[8],g[9]=l[9],g[10]=l[10],g[11]=l[11],g[12]=l[12],g[13]=l[13],g[14]=l[14],g[15]=l[15]),g[0]=I*A+j*T,g[1]=P*A+X*T,g[2]=F*A+Y*T,g[3]=N*A+H*T,g[4]=j*A-I*T,g[5]=X*A-P*T,g[6]=Y*A-F*T,g[7]=H*A-N*T,g},x.rotateZ$1=function(g,l,b){b*=.5;var T=l[0],A=l[1],I=l[2],P=l[3],F=Math.sin(b),N=Math.cos(b);return g[0]=T*N+A*F,g[1]=A*N-T*F,g[2]=I*N+P*F,g[3]=P*N-I*F,g},x.scale=he,x.scale$1=function(g,l,b){return g[0]=l[0]*b,g[1]=l[1]*b,g[2]=l[2]*b,g[3]=l[3]*b,g},x.scale$2=Bt,x.scaleAndAdd=Lt,x.setCacheLimits=function(g,l){Rl=g,Ba=l},x.setColumn=function(g,l,b){g[4*l+0]=b[0],g[4*l+1]=b[1],g[4*l+2]=b[2],g[4*l+3]=b[3]},x.setRTLTextPlugin=function(g,l,b=!1){if(ai===Jt||ai===ui||ai===Zi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mi=Ge.resolveURL(g),ai=Jt,Qi=l,wr(),b||vn()},x.smoothstep=ti,x.spec=tt,x.storeAuthState=function(g,l){l?Rn.add(g):Rn.delete(g)},x.sub=At,x.subtract=Xe,x.symbolSize=Jp,x.tileAABB=function(g,l,b,T,A,I,P,F,N){if(N.name==="globe"){const re=Jh(new hu(I,new Yh(b,T,A)).canonical).getCorners(),ue=Number.MAX_VALUE,me=[-ue,-ue,-ue],be=[ue,ue,ue],Ie=wf(g,l);for(let Le=0;Le<re.length;Le++)Mt(re[Le],re[Le],Ie),X=be,Y=re[Le],(j=be)[0]=Math.min(X[0],Y[0]),j[1]=Math.min(X[1],Y[1]),j[2]=Math.min(X[2],Y[2]),ct(me,me,re[Le]);return new Un(be,me)}var j,X,Y;const H=Da({z:b,x:T,y:A},N);return new Un([(I+H.x/H.scale)*l,l*(H.y/H.scale),P],[(I+H.x2/H.scale)*l,l*(H.y2/H.scale),F])},x.tileTransform=Da,x.transformMat3=function(g,l,b){var T=l[0],A=l[1],I=l[2];return g[0]=T*b[0]+A*b[3]+I*b[6],g[1]=T*b[1]+A*b[4]+I*b[7],g[2]=T*b[2]+A*b[5]+I*b[8],g},x.transformMat4=Mt,x.transformMat4$1=jt,x.transformQuat=ri,x.translate=se,x.transpose=function(g,l){if(g===l){var b=l[1],T=l[2],A=l[5];g[1]=l[3],g[2]=l[6],g[3]=b,g[5]=l[7],g[6]=T,g[7]=A}else g[0]=l[0],g[1]=l[3],g[2]=l[6],g[3]=l[1],g[4]=l[4],g[5]=l[7],g[6]=l[2],g[7]=l[5],g[8]=l[8];return g},x.triggerPluginCompletionEvent=rr,x.uniqueId=Zt,x.validateCustomStyleLayer=function(g){const l=[],b=g.id;return b===void 0&&l.push({message:`layers.${b}: missing required property "id"`}),g.render===void 0&&l.push({message:`layers.${b}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&l.push({message:`layers.${b}: property "renderingMode" must be either "2d" or "3d"`}),l},x.validateFog=pc,x.validateLight=Lo,x.validateStyle=Bo,x.values=Pi,x.vectorTile=As,x.version=L,x.warnOnce=Ii,x.window=G,x.wrap=ni}),M(["./shared"],function(x){function L(le){const J=typeof le;if(J==="number"||J==="boolean"||J==="string"||le==null)return JSON.stringify(le);if(Array.isArray(le)){let Ae="[";for(const Pe of le)Ae+=`${L(Pe)},`;return`${Ae}]`}const ne=Object.keys(le).sort();let fe="{";for(let Ae=0;Ae<ne.length;Ae++)fe+=`${JSON.stringify(ne[Ae])}:${L(le[ne[Ae]])},`;return`${fe}}`}function B(le){let J="";for(const ne of x.refProperties)J+=`/${L(le[ne])}`;return J}class ${constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,ne){for(const Ae of J)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=x.createStyleLayer(Ae)).compileFilter(),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of ne)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const fe=function(Ae,Pe){const Ue={};for(let $e=0;$e<Ae.length;$e++){const Ze=Pe&&Pe[Ae[$e].id]||B(Ae[$e]);Pe&&(Pe[Ae[$e].id]=Ze);let Qe=Ue[Ze];Qe||(Qe=Ue[Ze]=[]),Qe.push(Ae[$e])}const Ve=[];for(const $e in Ue)Ve.push(Ue[$e]);return Ve}(x.values(this._layerConfigs),this.keyCache);for(const Ae of fe){const Pe=Ae.map(et=>this._layers[et.id]),Ue=Pe[0];if(Ue.visibility==="none")continue;const Ve=Ue.source||"";let $e=this.familiesBySource[Ve];$e||($e=this.familiesBySource[Ve]={});const Ze=Ue.sourceLayer||"_geojsonTileLayer";let Qe=$e[Ze];Qe||(Qe=$e[Ze]=[]),Qe.push(Pe)}}}const{ImageBitmap:U}=x.window;class q{loadTile(J,ne){const{uid:fe,encoding:Ae,rawImageData:Pe,padding:Ue,buildQuadTree:Ve}=J,$e=U&&Pe instanceof U?this.getImageData(Pe,Ue):Pe;ne(null,new x.DEMData(fe,$e,Ae,Ue<1,Ve))}getImageData(J,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const fe=this.offscreenCanvasContext.getImageData(-ne,-ne,J.width+2*ne,J.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new x.RGBAImage({width:fe.width,height:fe.height},fe.data)}}var G=function le(J,ne){var fe,Ae=J&&J.type;if(Ae==="FeatureCollection")for(fe=0;fe<J.features.length;fe++)le(J.features[fe],ne);else if(Ae==="GeometryCollection")for(fe=0;fe<J.geometries.length;fe++)le(J.geometries[fe],ne);else if(Ae==="Feature")le(J.geometry,ne);else if(Ae==="Polygon")W(J.coordinates,ne);else if(Ae==="MultiPolygon")for(fe=0;fe<J.coordinates.length;fe++)W(J.coordinates[fe],ne);return J};function W(le,J){if(le.length!==0){te(le[0],J);for(var ne=1;ne<le.length;ne++)te(le[ne],!J)}}function te(le,J){for(var ne=0,fe=0,Ae=0,Pe=le.length,Ue=Pe-1;Ae<Pe;Ue=Ae++){var Ve=(le[Ae][0]-le[Ue][0])*(le[Ue][1]+le[Ae][1]),$e=ne+Ve;fe+=Math.abs(ne)>=Math.abs(Ve)?ne-$e+Ve:Ve-$e+ne,ne=$e}ne+fe>=0!=!!J&&le.reverse()}const oe=x.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ee{constructor(J){this._feature=J,this.extent=x.EXTENT,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ne of this._feature.geometry)J.push([new x.pointGeometry(ne[0],ne[1])]);return J}{const J=[];for(const ne of this._feature.geometry){const fe=[];for(const Ae of ne)fe.push(new x.pointGeometry(Ae[0],Ae[1]));J.push(fe)}return J}}toGeoJSON(J,ne,fe){return oe.call(this,J,ne,fe)}}class _e{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.EXTENT,this.length=J.length,this._features=J}feature(J){return new ee(this._features[J])}}var se=x.vectorTile.VectorTileFeature,he=ge;function ge(le,J){this.options=J||{},this.features=le,this.length=le.length}function Re(le,J){this.id=typeof le.id=="number"?le.id:void 0,this.type=le.type,this.rawGeometry=le.type===1?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=J||4096}ge.prototype.feature=function(le){return new Re(this.features[le],this.options.extent)},Re.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var J=0;J<le.length;J++){for(var ne=le[J],fe=[],Ae=0;Ae<ne.length;Ae++)fe.push(new x.pointGeometry(ne[Ae][0],ne[Ae][1]));this.geometry.push(fe)}return this.geometry},Re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,J=1/0,ne=-1/0,fe=1/0,Ae=-1/0,Pe=0;Pe<le.length;Pe++)for(var Ue=le[Pe],Ve=0;Ve<Ue.length;Ve++){var $e=Ue[Ve];J=Math.min(J,$e.x),ne=Math.max(ne,$e.x),fe=Math.min(fe,$e.y),Ae=Math.max(Ae,$e.y)}return[J,fe,ne,Ae]},Re.prototype.toGeoJSON=se.prototype.toGeoJSON;var ve=Se,de=he;function Se(le){var J=new x.pbf;return function(ne,fe){for(var Ae in ne.layers)fe.writeMessage(3,ce,ne.layers[Ae])}(le,J),J.finish()}function ce(le,J){var ne;J.writeVarintField(15,le.version||1),J.writeStringField(1,le.name||""),J.writeVarintField(5,le.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<le.length;ne++)fe.feature=le.feature(ne),J.writeMessage(2,ye,fe);var Ae=fe.keys;for(ne=0;ne<Ae.length;ne++)J.writeStringField(3,Ae[ne]);var Pe=fe.values;for(ne=0;ne<Pe.length;ne++)J.writeMessage(4,Bt,Pe[ne])}function ye(le,J){var ne=le.feature;ne.id!==void 0&&J.writeVarintField(1,ne.id),J.writeMessage(2,ze,le),J.writeVarintField(3,ne.type),J.writeMessage(4,ct,ne)}function ze(le,J){var ne=le.feature,fe=le.keys,Ae=le.values,Pe=le.keycache,Ue=le.valuecache;for(var Ve in ne.properties){var $e=ne.properties[Ve],Ze=Pe[Ve];if($e!==null){Ze===void 0&&(fe.push(Ve),Pe[Ve]=Ze=fe.length-1),J.writeVarint(Ze);var Qe=typeof $e;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&($e=JSON.stringify($e));var et=Qe+":"+$e,lt=Ue[et];lt===void 0&&(Ae.push($e),Ue[et]=lt=Ae.length-1),J.writeVarint(lt)}}}function Xe(le,J){return(J<<3)+(7&le)}function at(le){return le<<1^le>>31}function ct(le,J){for(var ne=le.loadGeometry(),fe=le.type,Ae=0,Pe=0,Ue=ne.length,Ve=0;Ve<Ue;Ve++){var $e=ne[Ve],Ze=1;fe===1&&(Ze=$e.length),J.writeVarint(Xe(1,Ze));for(var Qe=fe===3?$e.length-1:$e.length,et=0;et<Qe;et++){et===1&&fe!==1&&J.writeVarint(Xe(2,Qe-1));var lt=$e[et].x-Ae,Ct=$e[et].y-Pe;J.writeVarint(at(lt)),J.writeVarint(at(Ct)),Ae+=lt,Pe+=Ct}fe===3&&J.writeVarint(Xe(7,1))}}function Bt(le,J){var ne=typeof le;ne==="string"?J.writeStringField(1,le):ne==="boolean"?J.writeBooleanField(7,le):ne==="number"&&(le%1!=0?J.writeDoubleField(3,le):le<0?J.writeSVarintField(6,le):J.writeVarintField(5,le))}function Lt(le,J,ne,fe,Ae,Pe){if(Ae-fe<=ne)return;const Ue=fe+Ae>>1;It(le,J,Ue,fe,Ae,Pe%2),Lt(le,J,ne,fe,Ue-1,Pe+1),Lt(le,J,ne,Ue+1,Ae,Pe+1)}function It(le,J,ne,fe,Ae,Pe){for(;Ae>fe;){if(Ae-fe>600){const Ze=Ae-fe+1,Qe=ne-fe+1,et=Math.log(Ze),lt=.5*Math.exp(2*et/3),Ct=.5*Math.sqrt(et*lt*(Ze-lt)/Ze)*(Qe-Ze/2<0?-1:1);It(le,J,ne,Math.max(fe,Math.floor(ne-Qe*lt/Ze+Ct)),Math.min(Ae,Math.floor(ne+(Ze-Qe)*lt/Ze+Ct)),Pe)}const Ue=J[2*ne+Pe];let Ve=fe,$e=Ae;for(Vt(le,J,fe,ne),J[2*Ae+Pe]>Ue&&Vt(le,J,fe,Ae);Ve<$e;){for(Vt(le,J,Ve,$e),Ve++,$e--;J[2*Ve+Pe]<Ue;)Ve++;for(;J[2*$e+Pe]>Ue;)$e--}J[2*fe+Pe]===Ue?Vt(le,J,fe,$e):($e++,Vt(le,J,$e,Ae)),$e<=ne&&(fe=$e+1),ne<=$e&&(Ae=$e-1)}}function Vt(le,J,ne,fe){Ft(le,ne,fe),Ft(J,2*ne,2*fe),Ft(J,2*ne+1,2*fe+1)}function Ft(le,J,ne){const fe=le[J];le[J]=le[ne],le[ne]=fe}function Mt(le,J,ne,fe){const Ae=le-ne,Pe=J-fe;return Ae*Ae+Pe*Pe}ve.fromVectorTileJs=Se,ve.fromGeojsonVt=function(le,J){J=J||{};var ne={};for(var fe in le)ne[fe]=new he(le[fe].features,J),ne[fe].name=fe,ne[fe].version=J.version,ne[fe].extent=J.extent;return Se({layers:ne})},ve.GeoJSONWrapper=de;const ri=le=>le[0],St=le=>le[1];class At{constructor(J,ne=ri,fe=St,Ae=64,Pe=Float64Array){this.nodeSize=Ae,this.points=J;const Ue=J.length<65536?Uint16Array:Uint32Array,Ve=this.ids=new Ue(J.length),$e=this.coords=new Pe(2*J.length);for(let Ze=0;Ze<J.length;Ze++)Ve[Ze]=Ze,$e[2*Ze]=ne(J[Ze]),$e[2*Ze+1]=fe(J[Ze]);Lt(Ve,$e,Ae,0,Ve.length-1,0)}range(J,ne,fe,Ae){return function(Pe,Ue,Ve,$e,Ze,Qe,et){const lt=[0,Pe.length-1,0],Ct=[];let Gt,Xt;for(;lt.length;){const Ht=lt.pop(),gi=lt.pop(),Yi=lt.pop();if(gi-Yi<=et){for(let Hi=Yi;Hi<=gi;Hi++)Gt=Ue[2*Hi],Xt=Ue[2*Hi+1],Gt>=Ve&&Gt<=Ze&&Xt>=$e&&Xt<=Qe&&Ct.push(Pe[Hi]);continue}const Ji=Math.floor((Yi+gi)/2);Gt=Ue[2*Ji],Xt=Ue[2*Ji+1],Gt>=Ve&&Gt<=Ze&&Xt>=$e&&Xt<=Qe&&Ct.push(Pe[Ji]);const qi=(Ht+1)%2;(Ht===0?Ve<=Gt:$e<=Xt)&&(lt.push(Yi),lt.push(Ji-1),lt.push(qi)),(Ht===0?Ze>=Gt:Qe>=Xt)&&(lt.push(Ji+1),lt.push(gi),lt.push(qi))}return Ct}(this.ids,this.coords,J,ne,fe,Ae,this.nodeSize)}within(J,ne,fe){return function(Ae,Pe,Ue,Ve,$e,Ze){const Qe=[0,Ae.length-1,0],et=[],lt=$e*$e;for(;Qe.length;){const Ct=Qe.pop(),Gt=Qe.pop(),Xt=Qe.pop();if(Gt-Xt<=Ze){for(let qi=Xt;qi<=Gt;qi++)Mt(Pe[2*qi],Pe[2*qi+1],Ue,Ve)<=lt&&et.push(Ae[qi]);continue}const Ht=Math.floor((Xt+Gt)/2),gi=Pe[2*Ht],Yi=Pe[2*Ht+1];Mt(gi,Yi,Ue,Ve)<=lt&&et.push(Ae[Ht]);const Ji=(Ct+1)%2;(Ct===0?Ue-$e<=gi:Ve-$e<=Yi)&&(Qe.push(Xt),Qe.push(Ht-1),Qe.push(Ji)),(Ct===0?Ue+$e>=gi:Ve+$e>=Yi)&&(Qe.push(Ht+1),Qe.push(Gt),Qe.push(Ji))}return et}(this.ids,this.coords,J,ne,fe,this.nodeSize)}}const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},Ut=Math.fround||(jt=new Float32Array(1),le=>(jt[0]=+le,jt[0]));var jt;class mi{constructor(J){this.options=pi(Object.create(Et),J),this.trees=new Array(this.options.maxZoom+1)}load(J){const{log:ne,minZoom:fe,maxZoom:Ae,nodeSize:Pe}=this.options;ne&&console.time("total time");const Ue=`prepare ${J.length} points`;ne&&console.time(Ue),this.points=J;let Ve=[];for(let $e=0;$e<J.length;$e++)J[$e].geometry&&Ve.push(yi(J[$e],$e));this.trees[Ae+1]=new At(Ve,si,We,Pe,Float32Array),ne&&console.timeEnd(Ue);for(let $e=Ae;$e>=fe;$e--){const Ze=+Date.now();Ve=this._cluster(Ve,$e),this.trees[$e]=new At(Ve,si,We,Pe,Float32Array),ne&&console.log("z%d: %d clusters in %dms",$e,Ve.length,+Date.now()-Ze)}return ne&&console.timeEnd("total time"),this}getClusters(J,ne){let fe=((J[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,J[1]));let Pe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)fe=-180,Pe=180;else if(fe>Pe){const Qe=this.getClusters([fe,Ae,180,Ue],ne),et=this.getClusters([-180,Ae,Pe,Ue],ne);return Qe.concat(et)}const Ve=this.trees[this._limitZoom(ne)],$e=Ve.range(fi(fe),mt(Ue),fi(Pe),mt(Ae)),Ze=[];for(const Qe of $e){const et=Ve.points[Qe];Ze.push(et.numPoints?xi(et):this.points[et.index])}return Ze}getChildren(J){const ne=this._getOriginId(J),fe=this._getOriginZoom(J),Ae="No cluster with the specified id.",Pe=this.trees[fe];if(!Pe)throw new Error(Ae);const Ue=Pe.points[ne];if(!Ue)throw new Error(Ae);const Ve=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),$e=Pe.within(Ue.x,Ue.y,Ve),Ze=[];for(const Qe of $e){const et=Pe.points[Qe];et.parentId===J&&Ze.push(et.numPoints?xi(et):this.points[et.index])}if(Ze.length===0)throw new Error(Ae);return Ze}getLeaves(J,ne,fe){const Ae=[];return this._appendLeaves(Ae,J,ne=ne||10,fe=fe||0,0),Ae}getTile(J,ne,fe){const Ae=this.trees[this._limitZoom(J)],Pe=Math.pow(2,J),{extent:Ue,radius:Ve}=this.options,$e=Ve/Ue,Ze=(fe-$e)/Pe,Qe=(fe+1+$e)/Pe,et={features:[]};return this._addTileFeatures(Ae.range((ne-$e)/Pe,Ze,(ne+1+$e)/Pe,Qe),Ae.points,ne,fe,Pe,et),ne===0&&this._addTileFeatures(Ae.range(1-$e/Pe,Ze,1,Qe),Ae.points,Pe,fe,Pe,et),ne===Pe-1&&this._addTileFeatures(Ae.range(0,Ze,$e/Pe,Qe),Ae.points,-1,fe,Pe,et),et.features.length?et:null}getClusterExpansionZoom(J){let ne=this._getOriginZoom(J)-1;for(;ne<=this.options.maxZoom;){const fe=this.getChildren(J);if(ne++,fe.length!==1)break;J=fe[0].properties.cluster_id}return ne}_appendLeaves(J,ne,fe,Ae,Pe){const Ue=this.getChildren(ne);for(const Ve of Ue){const $e=Ve.properties;if($e&&$e.cluster?Pe+$e.point_count<=Ae?Pe+=$e.point_count:Pe=this._appendLeaves(J,$e.cluster_id,fe,Ae,Pe):Pe<Ae?Pe++:J.push(Ve),J.length===fe)break}return Pe}_addTileFeatures(J,ne,fe,Ae,Pe,Ue){for(const Ve of J){const $e=ne[Ve],Ze=$e.numPoints;let Qe,et,lt;if(Ze)Qe=Bi($e),et=$e.x,lt=$e.y;else{const Xt=this.points[$e.index];Qe=Xt.properties,et=fi(Xt.geometry.coordinates[0]),lt=mt(Xt.geometry.coordinates[1])}const Ct={type:1,geometry:[[Math.round(this.options.extent*(et*Pe-fe)),Math.round(this.options.extent*(lt*Pe-Ae))]],tags:Qe};let Gt;Ze?Gt=$e.id:this.options.generateId?Gt=$e.index:this.points[$e.index].id&&(Gt=this.points[$e.index].id),Gt!==void 0&&(Ct.id=Gt),Ue.features.push(Ct)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(+J,this.options.maxZoom+1))}_cluster(J,ne){const fe=[],{radius:Ae,extent:Pe,reduce:Ue,minPoints:Ve}=this.options,$e=Ae/(Pe*Math.pow(2,ne));for(let Ze=0;Ze<J.length;Ze++){const Qe=J[Ze];if(Qe.zoom<=ne)continue;Qe.zoom=ne;const et=this.trees[ne+1],lt=et.within(Qe.x,Qe.y,$e),Ct=Qe.numPoints||1;let Gt=Ct;for(const Xt of lt){const Ht=et.points[Xt];Ht.zoom>ne&&(Gt+=Ht.numPoints||1)}if(Gt>Ct&&Gt>=Ve){let Xt=Qe.x*Ct,Ht=Qe.y*Ct,gi=Ue&&Ct>1?this._map(Qe,!0):null;const Yi=(Ze<<5)+(ne+1)+this.points.length;for(const Ji of lt){const qi=et.points[Ji];if(qi.zoom<=ne)continue;qi.zoom=ne;const Hi=qi.numPoints||1;Xt+=qi.x*Hi,Ht+=qi.y*Hi,qi.parentId=Yi,Ue&&(gi||(gi=this._map(Qe,!0)),Ue(gi,this._map(qi)))}Qe.parentId=Yi,fe.push(oi(Xt/Gt,Ht/Gt,Yi,Gt,gi))}else if(fe.push(Qe),Gt>1)for(const Xt of lt){const Ht=et.points[Xt];Ht.zoom<=ne||(Ht.zoom=ne,fe.push(Ht))}}return fe}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ne){if(J.numPoints)return ne?pi({},J.properties):J.properties;const fe=this.points[J.index].properties,Ae=this.options.map(fe);return ne&&Ae===fe?pi({},Ae):Ae}}function oi(le,J,ne,fe,Ae){return{x:Ut(le),y:Ut(J),zoom:1/0,id:ne,parentId:-1,numPoints:fe,properties:Ae}}function yi(le,J){const[ne,fe]=le.geometry.coordinates;return{x:Ut(fi(ne)),y:Ut(mt(fe)),zoom:1/0,index:J,parentId:-1}}function xi(le){return{type:"Feature",id:le.id,properties:Bi(le),geometry:{type:"Point",coordinates:[(J=le.x,360*(J-.5)),vt(le.y)]}};var J}function Bi(le){const J=le.numPoints,ne=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J;return pi(pi({},le.properties),{cluster:!0,cluster_id:le.id,point_count:J,point_count_abbreviated:ne})}function fi(le){return le/360+.5}function mt(le){const J=Math.sin(le*Math.PI/180),ne=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ne<0?0:ne>1?1:ne}function vt(le){const J=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function pi(le,J){for(const ne in J)le[ne]=J[ne];return le}function si(le){return le.x}function We(le){return le.y}function Wt(le,J,ne,fe){for(var Ae,Pe=fe,Ue=ne-J>>1,Ve=ne-J,$e=le[J],Ze=le[J+1],Qe=le[ne],et=le[ne+1],lt=J+3;lt<ne;lt+=3){var Ct=Rt(le[lt],le[lt+1],$e,Ze,Qe,et);if(Ct>Pe)Ae=lt,Pe=Ct;else if(Ct===Pe){var Gt=Math.abs(lt-Ue);Gt<Ve&&(Ae=lt,Ve=Gt)}}Pe>fe&&(Ae-J>3&&Wt(le,J,Ae,fe),le[Ae+2]=Pe,ne-Ae>3&&Wt(le,Ae,ne,fe))}function Rt(le,J,ne,fe,Ae,Pe){var Ue=Ae-ne,Ve=Pe-fe;if(Ue!==0||Ve!==0){var $e=((le-ne)*Ue+(J-fe)*Ve)/(Ue*Ue+Ve*Ve);$e>1?(ne=Ae,fe=Pe):$e>0&&(ne+=Ue*$e,fe+=Ve*$e)}return(Ue=le-ne)*Ue+(Ve=J-fe)*Ve}function ti(le,J,ne,fe){var Ae={id:le===void 0?null:le,type:J,geometry:ne,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var Ue=Pe.geometry,Ve=Pe.type;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")ni(Pe,Ue);else if(Ve==="Polygon"||Ve==="MultiLineString")for(var $e=0;$e<Ue.length;$e++)ni(Pe,Ue[$e]);else if(Ve==="MultiPolygon")for($e=0;$e<Ue.length;$e++)for(var Ze=0;Ze<Ue[$e].length;Ze++)ni(Pe,Ue[$e][Ze])}(Ae),Ae}function ni(le,J){for(var ne=0;ne<J.length;ne+=3)le.minX=Math.min(le.minX,J[ne]),le.minY=Math.min(le.minY,J[ne+1]),le.maxX=Math.max(le.maxX,J[ne]),le.maxY=Math.max(le.maxY,J[ne+1])}function bt(le,J,ne,fe){if(J.geometry){var Ae=J.geometry.coordinates,Pe=J.geometry.type,Ue=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),Ve=[],$e=J.id;if(ne.promoteId?$e=J.properties[ne.promoteId]:ne.generateId&&($e=fe||0),Pe==="Point")Pi(Ae,Ve);else if(Pe==="MultiPoint")for(var Ze=0;Ze<Ae.length;Ze++)Pi(Ae[Ze],Ve);else if(Pe==="LineString")Kt(Ae,Ve,Ue,!1);else if(Pe==="MultiLineString"){if(ne.lineMetrics){for(Ze=0;Ze<Ae.length;Ze++)Kt(Ae[Ze],Ve=[],Ue,!1),le.push(ti($e,"LineString",Ve,J.properties));return}qt(Ae,Ve,Ue,!1)}else if(Pe==="Polygon")qt(Ae,Ve,Ue,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(Ze=0;Ze<J.geometry.geometries.length;Ze++)bt(le,{id:$e,geometry:J.geometry.geometries[Ze],properties:J.properties},ne,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ze=0;Ze<Ae.length;Ze++){var Qe=[];qt(Ae[Ze],Qe,Ue,!0),Ve.push(Qe)}}le.push(ti($e,Pe,Ve,J.properties))}}function Pi(le,J){J.push(Zt(le[0])),J.push(kt(le[1])),J.push(0)}function Kt(le,J,ne,fe){for(var Ae,Pe,Ue=0,Ve=0;Ve<le.length;Ve++){var $e=Zt(le[Ve][0]),Ze=kt(le[Ve][1]);J.push($e),J.push(Ze),J.push(0),Ve>0&&(Ue+=fe?(Ae*Ze-$e*Pe)/2:Math.sqrt(Math.pow($e-Ae,2)+Math.pow(Ze-Pe,2))),Ae=$e,Pe=Ze}var Qe=J.length-3;J[2]=1,Wt(J,0,Qe,ne),J[Qe+2]=1,J.size=Math.abs(Ue),J.start=0,J.end=J.size}function qt(le,J,ne,fe){for(var Ae=0;Ae<le.length;Ae++){var Pe=[];Kt(le[Ae],Pe,ne,fe),J.push(Pe)}}function Zt(le){return le/360+.5}function kt(le){var J=Math.sin(le*Math.PI/180),ne=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ne<0?0:ne>1?1:ne}function ci(le,J,ne,fe,Ae,Pe,Ue,Ve){if(fe/=J,Pe>=(ne/=J)&&Ue<fe)return le;if(Ue<ne||Pe>=fe)return null;for(var $e=[],Ze=0;Ze<le.length;Ze++){var Qe=le[Ze],et=Qe.geometry,lt=Qe.type,Ct=Ae===0?Qe.minX:Qe.minY,Gt=Ae===0?Qe.maxX:Qe.maxY;if(Ct>=ne&&Gt<fe)$e.push(Qe);else if(!(Gt<ne||Ct>=fe)){var Xt=[];if(lt==="Point"||lt==="MultiPoint")vi(et,Xt,ne,fe,Ae);else if(lt==="LineString")Ti(et,Xt,ne,fe,Ae,!1,Ve.lineMetrics);else if(lt==="MultiLineString")hi(et,Xt,ne,fe,Ae,!1);else if(lt==="Polygon")hi(et,Xt,ne,fe,Ae,!0);else if(lt==="MultiPolygon")for(var Ht=0;Ht<et.length;Ht++){var gi=[];hi(et[Ht],gi,ne,fe,Ae,!0),gi.length&&Xt.push(gi)}if(Xt.length){if(Ve.lineMetrics&&lt==="LineString"){for(Ht=0;Ht<Xt.length;Ht++)$e.push(ti(Qe.id,lt,Xt[Ht],Qe.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(Xt.length===1?(lt="LineString",Xt=Xt[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=Xt.length===3?"Point":"MultiPoint"),$e.push(ti(Qe.id,lt,Xt,Qe.tags))}}}return $e.length?$e:null}function vi(le,J,ne,fe,Ae){for(var Pe=0;Pe<le.length;Pe+=3){var Ue=le[Pe+Ae];Ue>=ne&&Ue<=fe&&(J.push(le[Pe]),J.push(le[Pe+1]),J.push(le[Pe+2]))}}function Ti(le,J,ne,fe,Ae,Pe,Ue){for(var Ve,$e,Ze=ei(le),Qe=Ae===0?Ai:Xi,et=le.start,lt=0;lt<le.length-3;lt+=3){var Ct=le[lt],Gt=le[lt+1],Xt=le[lt+2],Ht=le[lt+3],gi=le[lt+4],Yi=Ae===0?Ct:Gt,Ji=Ae===0?Ht:gi,qi=!1;Ue&&(Ve=Math.sqrt(Math.pow(Ct-Ht,2)+Math.pow(Gt-gi,2))),Yi<ne?Ji>ne&&($e=Qe(Ze,Ct,Gt,Ht,gi,ne),Ue&&(Ze.start=et+Ve*$e)):Yi>fe?Ji<fe&&($e=Qe(Ze,Ct,Gt,Ht,gi,fe),Ue&&(Ze.start=et+Ve*$e)):Ni(Ze,Ct,Gt,Xt),Ji<ne&&Yi>=ne&&($e=Qe(Ze,Ct,Gt,Ht,gi,ne),qi=!0),Ji>fe&&Yi<=fe&&($e=Qe(Ze,Ct,Gt,Ht,gi,fe),qi=!0),!Pe&&qi&&(Ue&&(Ze.end=et+Ve*$e),J.push(Ze),Ze=ei(le)),Ue&&(et+=Ve)}var Hi=le.length-3;Ct=le[Hi],Gt=le[Hi+1],Xt=le[Hi+2],(Yi=Ae===0?Ct:Gt)>=ne&&Yi<=fe&&Ni(Ze,Ct,Gt,Xt),Hi=Ze.length-3,Pe&&Hi>=3&&(Ze[Hi]!==Ze[0]||Ze[Hi+1]!==Ze[1])&&Ni(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&J.push(Ze)}function ei(le){var J=[];return J.size=le.size,J.start=le.start,J.end=le.end,J}function hi(le,J,ne,fe,Ae,Pe){for(var Ue=0;Ue<le.length;Ue++)Ti(le[Ue],J,ne,fe,Ae,Pe,!1)}function Ni(le,J,ne,fe){le.push(J),le.push(ne),le.push(fe)}function Ai(le,J,ne,fe,Ae,Pe){var Ue=(Pe-J)/(fe-J);return le.push(Pe),le.push(ne+(Ae-ne)*Ue),le.push(1),Ue}function Xi(le,J,ne,fe,Ae,Pe){var Ue=(Pe-ne)/(Ae-ne);return le.push(J+(fe-J)*Ue),le.push(Pe),le.push(1),Ue}function Ii(le,J){for(var ne=[],fe=0;fe<le.length;fe++){var Ae,Pe=le[fe],Ue=Pe.type;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")Ae=fr(Pe.geometry,J);else if(Ue==="MultiLineString"||Ue==="Polygon"){Ae=[];for(var Ve=0;Ve<Pe.geometry.length;Ve++)Ae.push(fr(Pe.geometry[Ve],J))}else if(Ue==="MultiPolygon")for(Ae=[],Ve=0;Ve<Pe.geometry.length;Ve++){for(var $e=[],Ze=0;Ze<Pe.geometry[Ve].length;Ze++)$e.push(fr(Pe.geometry[Ve][Ze],J));Ae.push($e)}ne.push(ti(Pe.id,Ue,Ae,Pe.tags))}return ne}function fr(le,J){var ne=[];ne.size=le.size,le.start!==void 0&&(ne.start=le.start,ne.end=le.end);for(var fe=0;fe<le.length;fe+=3)ne.push(le[fe]+J,le[fe+1],le[fe+2]);return ne}function sn(le,J){if(le.transformed)return le;var ne,fe,Ae,Pe=1<<le.z,Ue=le.x,Ve=le.y;for(ne=0;ne<le.features.length;ne++){var $e=le.features[ne],Ze=$e.geometry,Qe=$e.type;if($e.geometry=[],Qe===1)for(fe=0;fe<Ze.length;fe+=2)$e.geometry.push(pr(Ze[fe],Ze[fe+1],J,Pe,Ue,Ve));else for(fe=0;fe<Ze.length;fe++){var et=[];for(Ae=0;Ae<Ze[fe].length;Ae+=2)et.push(pr(Ze[fe][Ae],Ze[fe][Ae+1],J,Pe,Ue,Ve));$e.geometry.push(et)}}return le.transformed=!0,le}function pr(le,J,ne,fe,Ae,Pe){return[Math.round(ne*(le*fe-Ae)),Math.round(ne*(J*fe-Pe))]}function Br(le,J,ne,fe,Ae){for(var Pe=J===Ae.maxZoom?0:Ae.tolerance/((1<<J)*Ae.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:fe,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ve=0;Ve<le.length;Ve++){Ue.numFeatures++,Lr(Ue,le[Ve],Pe,Ae);var $e=le[Ve].minX,Ze=le[Ve].minY,Qe=le[Ve].maxX,et=le[Ve].maxY;$e<Ue.minX&&(Ue.minX=$e),Ze<Ue.minY&&(Ue.minY=Ze),Qe>Ue.maxX&&(Ue.maxX=Qe),et>Ue.maxY&&(Ue.maxY=et)}return Ue}function Lr(le,J,ne,fe){var Ae=J.geometry,Pe=J.type,Ue=[];if(Pe==="Point"||Pe==="MultiPoint")for(var Ve=0;Ve<Ae.length;Ve+=3)Ue.push(Ae[Ve]),Ue.push(Ae[Ve+1]),le.numPoints++,le.numSimplified++;else if(Pe==="LineString")Tr(Ue,Ae,le,ne,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(Ve=0;Ve<Ae.length;Ve++)Tr(Ue,Ae[Ve],le,ne,Pe==="Polygon",Ve===0);else if(Pe==="MultiPolygon")for(var $e=0;$e<Ae.length;$e++){var Ze=Ae[$e];for(Ve=0;Ve<Ze.length;Ve++)Tr(Ue,Ze[Ve],le,ne,!0,Ve===0)}if(Ue.length){var Qe=J.tags||null;if(Pe==="LineString"&&fe.lineMetrics){for(var et in Qe={},J.tags)Qe[et]=J.tags[et];Qe.mapbox_clip_start=Ae.start/Ae.size,Qe.mapbox_clip_end=Ae.end/Ae.size}var lt={geometry:Ue,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:Qe};J.id!==null&&(lt.id=J.id),le.features.push(lt)}}function Tr(le,J,ne,fe,Ae,Pe){var Ue=fe*fe;if(fe>0&&J.size<(Ae?Ue:fe))ne.numPoints+=J.length/3;else{for(var Ve=[],$e=0;$e<J.length;$e+=3)(fe===0||J[$e+2]>Ue)&&(ne.numSimplified++,Ve.push(J[$e]),Ve.push(J[$e+1])),ne.numPoints++;Ae&&function(Ze,Qe){for(var et=0,lt=0,Ct=Ze.length,Gt=Ct-2;lt<Ct;Gt=lt,lt+=2)et+=(Ze[lt]-Ze[Gt])*(Ze[lt+1]+Ze[Gt+1]);if(et>0===Qe)for(lt=0,Ct=Ze.length;lt<Ct/2;lt+=2){var Xt=Ze[lt],Ht=Ze[lt+1];Ze[lt]=Ze[Ct-2-lt],Ze[lt+1]=Ze[Ct-1-lt],Ze[Ct-2-lt]=Xt,Ze[Ct-1-lt]=Ht}}(Ve,Pe),le.push(Ve)}}function br(le,J){var ne=(J=this.options=function(Ae,Pe){for(var Ue in Pe)Ae[Ue]=Pe[Ue];return Ae}(Object.create(this.options),J)).debug;if(ne&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe=function(Ae,Pe){var Ue=[];if(Ae.type==="FeatureCollection")for(var Ve=0;Ve<Ae.features.length;Ve++)bt(Ue,Ae.features[Ve],Pe,Ve);else bt(Ue,Ae.type==="Feature"?Ae:{geometry:Ae},Pe);return Ue}(le,J);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(fe=function(Ae,Pe){var Ue=Pe.buffer/Pe.extent,Ve=Ae,$e=ci(Ae,1,-1-Ue,Ue,0,-1,2,Pe),Ze=ci(Ae,1,1-Ue,2+Ue,0,-1,2,Pe);return($e||Ze)&&(Ve=ci(Ae,1,-Ue,1+Ue,0,-1,2,Pe)||[],$e&&(Ve=Ii($e,1).concat(Ve)),Ze&&(Ve=Ve.concat(Ii(Ze,-1)))),Ve}(fe,J)).length&&this.splitTile(fe,0,0,0),ne&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Nr(le,J,ne){return 32*((1<<le)*ne+J)+le}function Sr(le,J){const ne=le.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);const fe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!fe)return J(null,null);const Ae=new _e(fe.features);let Pe=ve(Ae);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),J(null,{vectorTile:Ae,rawData:Pe.buffer})}br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},br.prototype.splitTile=function(le,J,ne,fe,Ae,Pe,Ue){for(var Ve=[le,J,ne,fe],$e=this.options,Ze=$e.debug;Ve.length;){fe=Ve.pop(),ne=Ve.pop(),J=Ve.pop(),le=Ve.pop();var Qe=1<<J,et=Nr(J,ne,fe),lt=this.tiles[et];if(!lt&&(Ze>1&&console.time("creation"),lt=this.tiles[et]=Br(le,J,ne,fe,$e),this.tileCoords.push({z:J,x:ne,y:fe}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ne,fe,lt.numFeatures,lt.numPoints,lt.numSimplified),console.timeEnd("creation"));var Ct="z"+J;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(lt.source=le,Ae){if(J===$e.maxZoom||J===Ae)continue;var Gt=1<<Ae-J;if(ne!==Math.floor(Pe/Gt)||fe!==Math.floor(Ue/Gt))continue}else if(J===$e.indexMaxZoom||lt.numPoints<=$e.indexMaxPoints)continue;if(lt.source=null,le.length!==0){Ze>1&&console.time("clipping");var Xt,Ht,gi,Yi,Ji,qi,Hi=.5*$e.buffer/$e.extent,Gn=.5-Hi,Rn=.5+Hi,zr=1+Hi;Xt=Ht=gi=Yi=null,Ji=ci(le,Qe,ne-Hi,ne+Rn,0,lt.minX,lt.maxX,$e),qi=ci(le,Qe,ne+Gn,ne+zr,0,lt.minX,lt.maxX,$e),le=null,Ji&&(Xt=ci(Ji,Qe,fe-Hi,fe+Rn,1,lt.minY,lt.maxY,$e),Ht=ci(Ji,Qe,fe+Gn,fe+zr,1,lt.minY,lt.maxY,$e),Ji=null),qi&&(gi=ci(qi,Qe,fe-Hi,fe+Rn,1,lt.minY,lt.maxY,$e),Yi=ci(qi,Qe,fe+Gn,fe+zr,1,lt.minY,lt.maxY,$e),qi=null),Ze>1&&console.timeEnd("clipping"),Ve.push(Xt||[],J+1,2*ne,2*fe),Ve.push(Ht||[],J+1,2*ne,2*fe+1),Ve.push(gi||[],J+1,2*ne+1,2*fe),Ve.push(Yi||[],J+1,2*ne+1,2*fe+1)}}},br.prototype.getTile=function(le,J,ne){var fe=this.options,Ae=fe.extent,Pe=fe.debug;if(le<0||le>24)return null;var Ue=1<<le,Ve=Nr(le,J=(J%Ue+Ue)%Ue,ne);if(this.tiles[Ve])return sn(this.tiles[Ve],Ae);Pe>1&&console.log("drilling down to z%d-%d-%d",le,J,ne);for(var $e,Ze=le,Qe=J,et=ne;!$e&&Ze>0;)Ze--,Qe=Math.floor(Qe/2),et=Math.floor(et/2),$e=this.tiles[Nr(Ze,Qe,et)];return $e&&$e.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",Ze,Qe,et),Pe>1&&console.time("drilling down"),this.splitTile($e.source,Ze,Qe,et,le,J,ne),Pe>1&&console.timeEnd("drilling down"),this.tiles[Ve]?sn(this.tiles[Ve],Ae):null):null};class Me extends x.VectorTileWorkerSource{constructor(J,ne,fe,Ae,Pe){super(J,ne,fe,Ae,Sr),Pe&&(this.loadGeoJSON=Pe)}loadData(J,ne){const fe=J&&J.request,Ae=fe&&fe.collectResourceTiming;this.loadGeoJSON(J,(Pe,Ue)=>{if(Pe||!Ue)return ne(Pe);if(typeof Ue!="object")return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{G(Ue,!0);try{if(J.filter){const $e=x.createExpression(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));const Ze=Ue.features.filter(Qe=>$e.value.evaluate({zoom:0},Qe));Ue={type:"FeatureCollection",features:Ze}}this._geoJSONIndex=J.cluster?new mi(function({superclusterOptions:$e,clusterProperties:Ze}){if(!Ze||!$e)return $e;const Qe={},et={},lt={accumulated:null,zoom:0},Ct={properties:null},Gt=Object.keys(Ze);for(const Xt of Gt){const[Ht,gi]=Ze[Xt],Yi=x.createExpression(gi),Ji=x.createExpression(typeof Ht=="string"?[Ht,["accumulated"],["get",Xt]]:Ht);Qe[Xt]=Yi.value,et[Xt]=Ji.value}return $e.map=Xt=>{Ct.properties=Xt;const Ht={};for(const gi of Gt)Ht[gi]=Qe[gi].evaluate(lt,Ct);return Ht},$e.reduce=(Xt,Ht)=>{Ct.properties=Ht;for(const gi of Gt)lt.accumulated=Xt[gi],Xt[gi]=et[gi].evaluate(lt,Ct)},$e}(J)).load(Ue.features):function($e,Ze){return new br($e,Ze)}(Ue,J.geojsonVtOptions)}catch($e){return ne($e)}this.loaded={};const Ve={};if(Ae){const $e=x.getPerformanceMeasurement(fe);$e&&(Ve.resourceTiming={},Ve.resourceTiming[J.source]=JSON.parse(JSON.stringify($e)))}ne(null,Ve)}})}reloadTile(J,ne){const fe=this.loaded;return fe&&fe[J.uid]?super.reloadTile(J,ne):this.loadTile(J,ne)}loadGeoJSON(J,ne){if(J.request)x.getJSON(J.request,ne);else{if(typeof J.data!="string")return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(J.data))}catch{return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(fe){ne(fe)}}getClusterChildren(J,ne){try{ne(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(fe){ne(fe)}}getClusterLeaves(J,ne){try{ne(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(fe){ne(fe)}}}class Ge{constructor(J){this.self=J,this.actor=new x.Actor(J,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=x.getProjection({name:"mercator"}),this.workerSourceTypes={vector:x.VectorTileWorkerSource,geojson:Me},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,fe)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=fe},this.self.registerRTLTextPlugin=ne=>{if(x.plugin.isParsed())throw new Error("RTL text plugin already registered.");x.plugin.applyArabicShaping=ne.applyArabicShaping,x.plugin.processBidirectionalText=ne.processBidirectionalText,x.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(J,ne,fe){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],fe()}checkIfReady(J,ne,fe){fe()}setReferrer(J,ne){this.referrer=ne}spriteLoaded(J,ne){this.isSpriteLoaded[J]=ne;for(const fe in this.workerSources[J]){const Ae=this.workerSources[J][fe];for(const Pe in Ae)Ae[Pe]instanceof x.VectorTileWorkerSource&&(Ae[Pe].isSpriteLoaded=ne,Ae[Pe].fire(new x.Event("isSpriteLoaded")))}}setImages(J,ne,fe){this.availableImages[J]=ne;for(const Ae in this.workerSources[J]){const Pe=this.workerSources[J][Ae];for(const Ue in Pe)Pe[Ue].availableImages=ne}fe()}enableTerrain(J,ne,fe){this.terrain=ne,fe()}setProjection(J,ne){this.projections[J]=x.getProjection(ne)}setLayers(J,ne,fe){this.getLayerIndex(J).replace(ne),fe()}updateLayers(J,ne,fe){this.getLayerIndex(J).update(ne.layers,ne.removedIds),fe()}loadTile(J,ne,fe){const Ae=this.enableTerrain?x.extend({enableTerrain:this.terrain},ne):ne;Ae.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ne.type,ne.source).loadTile(Ae,fe)}loadDEMTile(J,ne,fe){const Ae=this.enableTerrain?x.extend({buildQuadTree:this.terrain},ne):ne;this.getDEMWorkerSource(J,ne.source).loadTile(Ae,fe)}reloadTile(J,ne,fe){const Ae=this.enableTerrain?x.extend({enableTerrain:this.terrain},ne):ne;Ae.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ne.type,ne.source).reloadTile(Ae,fe)}abortTile(J,ne,fe){this.getWorkerSource(J,ne.type,ne.source).abortTile(ne,fe)}removeTile(J,ne,fe){this.getWorkerSource(J,ne.type,ne.source).removeTile(ne,fe)}removeSource(J,ne,fe){if(!this.workerSources[J]||!this.workerSources[J][ne.type]||!this.workerSources[J][ne.type][ne.source])return;const Ae=this.workerSources[J][ne.type][ne.source];delete this.workerSources[J][ne.type][ne.source],Ae.removeSource!==void 0?Ae.removeSource(ne,fe):fe()}loadWorkerSource(J,ne,fe){try{this.self.importScripts(ne.url),fe()}catch(Ae){fe(Ae.toString())}}syncRTLPluginState(J,ne,fe){try{x.plugin.setState(ne);const Ae=x.plugin.getPluginURL();if(x.plugin.isLoaded()&&!x.plugin.isParsed()&&Ae!=null){this.self.importScripts(Ae);const Pe=x.plugin.isParsed();fe(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ae}`),Pe)}}catch(Ae){fe(Ae.toString())}}getAvailableImages(J){let ne=this.availableImages[J];return ne||(ne=[]),ne}getLayerIndex(J){let ne=this.layerIndexes[J];return ne||(ne=this.layerIndexes[J]=new $),ne}getWorkerSource(J,ne,fe){return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][ne]||(this.workerSources[J][ne]={}),this.workerSources[J][ne][fe]||(this.workerSources[J][ne][fe]=new this.workerSourceTypes[ne]({send:(Ae,Pe,Ue,Ve,$e,Ze)=>{this.actor.send(Ae,Pe,Ue,J,$e,Ze)},scheduler:this.actor.scheduler},this.getLayerIndex(J),this.getAvailableImages(J),this.isSpriteLoaded[J])),this.workerSources[J][ne][fe]}getDEMWorkerSource(J,ne){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][ne]||(this.demWorkerSources[J][ne]=new q),this.demWorkerSources[J][ne]}enforceCacheSizeLimit(J,ne){x.enforceCacheSizeLimit(ne)}getWorkerPerformanceMetrics(J,ne,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ge(self)),Ge}),M(["./shared"],function(x){var L=B;function B(C){return!function(y){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var D,z,O=new Blob([""],{type:"text/javascript"}),V=URL.createObjectURL(O);try{z=new Worker(V),D=!0}catch{D=!1}return z&&z.terminate(),URL.revokeObjectURL(V),D}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var D=document.createElement("canvas");D.width=D.height=1;var z=D.getContext("2d");if(!z)return!1;var O=z.getImageData(0,0,1,1);return O&&O.width===D.width}()?($[S=y&&y.failIfMajorPerformanceCaveat]===void 0&&($[S]=function(D){var z,O=function(V){var Z=document.createElement("canvas"),K=Object.create(B.webGLContextAttributes);return K.failIfMajorPerformanceCaveat=V,Z.getContext("webgl",K)||Z.getContext("experimental-webgl",K)}(D);if(!O)return!1;try{z=O.createShader(O.VERTEX_SHADER)}catch{return!1}return!(!z||O.isContextLost())&&(O.shaderSource(z,"void main() {}"),O.compileShader(z),O.getShaderParameter(z,O.COMPILE_STATUS)===!0)}(S)),$[S]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}(C)}var $={};function U(C,y){var S=y[0],D=y[1],z=y[2],O=y[3],V=S*O-z*D;return V?(C[0]=O*(V=1/V),C[1]=-D*V,C[2]=-z*V,C[3]=S*V,C):null}function q(C,y){if(Array.isArray(C)){if(!Array.isArray(y)||C.length!==y.length)return!1;for(let S=0;S<C.length;S++)if(!q(C[S],y[S]))return!1;return!0}if(typeof C=="object"&&C!==null&&y!==null){if(typeof y!="object"||Object.keys(C).length!==Object.keys(y).length)return!1;for(const S in C)if(!q(C[S],y[S]))return!1;return!0}return C===y}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const G={create:function(C,y,S){const D=x.window.document.createElement(C);return y!==void 0&&(D.className=y),S&&S.appendChild(D),D},createSVG:function(C,y,S){const D=x.window.document.createElementNS("http://www.w3.org/2000/svg",C);for(const z of Object.keys(y))D.setAttributeNS(null,z,y[z]);return S&&S.appendChild(D),D}},W=x.window.document&&x.window.document.documentElement.style,te=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let oe;G.disableDrag=function(){W&&te&&(oe=W[te],W[te]="none")},G.enableDrag=function(){W&&te&&(W[te]=oe)};const ee=function(C){C.preventDefault(),C.stopPropagation(),x.window.removeEventListener("click",ee,!0)};function _e(C,y,S){const D=C.offsetWidth===y.width?1:C.offsetWidth/y.width;return new x.pointGeometry((S.clientX-y.left)*D,(S.clientY-y.top)*D)}function se(C){const{userImage:y}=C;return!!(y&&y.render&&y.render())&&(C.data.replace(new Uint8Array(y.data.buffer)),!0)}G.suppressClick=function(){x.window.addEventListener("click",ee,!0),x.window.setTimeout(()=>{x.window.removeEventListener("click",ee,!0)},0)},G.mousePos=function(C,y){const S=C.getBoundingClientRect();return _e(C,S,y)},G.touchPos=function(C,y){const S=C.getBoundingClientRect(),D=[];for(let z=0;z<y.length;z++)D.push(_e(C,S,y[z]));return D},G.mouseButton=function(C){return x.window.InstallTrigger!==void 0&&C.button===2&&C.ctrlKey&&x.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:C.button};class he extends x.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new x.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(y){if(this.loaded!==y&&(this.loaded=y,y)){for(const{ids:S,callback:D}of this.requestors)this._notify(S,D);this.requestors=[]}}getImage(y){return this.images[y]}addImage(y,S){this._validate(y,S)&&(this.images[y]=S)}_validate(y,S){let D=!0;return this._validateStretch(S.stretchX,S.data&&S.data.width)||(this.fire(new x.ErrorEvent(new Error(`Image "${y}" has invalid "stretchX" value`))),D=!1),this._validateStretch(S.stretchY,S.data&&S.data.height)||(this.fire(new x.ErrorEvent(new Error(`Image "${y}" has invalid "stretchY" value`))),D=!1),this._validateContent(S.content,S)||(this.fire(new x.ErrorEvent(new Error(`Image "${y}" has invalid "content" value`))),D=!1),D}_validateStretch(y,S){if(!y)return!0;let D=0;for(const z of y){if(z[0]<D||z[1]<z[0]||S<z[1])return!1;D=z[1]}return!0}_validateContent(y,S){return!(y&&(y.length!==4||y[0]<0||S.data.width<y[0]||y[1]<0||S.data.height<y[1]||y[2]<0||S.data.width<y[2]||y[3]<0||S.data.height<y[3]||y[2]<y[0]||y[3]<y[1]))}updateImage(y,S){S.version=this.images[y].version+1,this.images[y]=S,this.updatedImages[y]=!0}removeImage(y){const S=this.images[y];delete this.images[y],delete this.patterns[y],S.userImage&&S.userImage.onRemove&&S.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(y,S){let D=!0;if(!this.isLoaded())for(const z of y)this.images[z]||(D=!1);this.isLoaded()||D?this._notify(y,S):this.requestors.push({ids:y,callback:S})}_notify(y,S){const D={};for(const z of y){this.images[z]||this.fire(new x.Event("styleimagemissing",{id:z}));const O=this.images[z];O?D[z]={data:O.data.clone(),pixelRatio:O.pixelRatio,sdf:O.sdf,version:O.version,stretchX:O.stretchX,stretchY:O.stretchY,content:O.content,hasRenderCallback:Boolean(O.userImage&&O.userImage.render)}:x.warnOnce(`Image "${z}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}S(null,D)}getPixelSize(){const{width:y,height:S}=this.atlasImage;return{width:y,height:S}}getPattern(y){const S=this.patterns[y],D=this.getImage(y);if(!D)return null;if(S&&S.position.version===D.version)return S.position;if(S)S.position.version=D.version;else{const z={w:D.data.width+2,h:D.data.height+2,x:0,y:0},O=new x.ImagePosition(z,D);this.patterns[y]={bin:z,position:O}}return this._updatePatternAtlas(),this.patterns[y].position}bind(y){const S=y.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new x.Texture(y,this.atlasImage,S.RGBA),this.atlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE)}_updatePatternAtlas(){const y=[];for(const O in this.patterns)y.push(this.patterns[O].bin);const{w:S,h:D}=x.potpack(y),z=this.atlasImage;z.resize({width:S||1,height:D||1});for(const O in this.patterns){const{bin:V}=this.patterns[O],Z=V.x+1,K=V.y+1,Q=this.images[O].data,ie=Q.width,ae=Q.height;x.RGBAImage.copy(Q,z,{x:0,y:0},{x:Z,y:K},{width:ie,height:ae}),x.RGBAImage.copy(Q,z,{x:0,y:ae-1},{x:Z,y:K-1},{width:ie,height:1}),x.RGBAImage.copy(Q,z,{x:0,y:0},{x:Z,y:K+ae},{width:ie,height:1}),x.RGBAImage.copy(Q,z,{x:ie-1,y:0},{x:Z-1,y:K},{width:1,height:ae}),x.RGBAImage.copy(Q,z,{x:0,y:0},{x:Z+ie,y:K},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(y){for(const S of y){if(this.callbackDispatchedThisFrame[S])continue;this.callbackDispatchedThisFrame[S]=!0;const D=this.images[S];se(D)&&this.updateImage(S,D)}}}const ge=new x.Properties({anchor:new x.DataConstantProperty(x.spec.light.anchor),position:new class{constructor(){this.specification=x.spec.light.position}possiblyEvaluate(C,y){return function([S,D,z]){const O=x.degToRad(D+90),V=x.degToRad(z);return{x:S*Math.cos(O)*Math.sin(V),y:S*Math.sin(O)*Math.sin(V),z:S*Math.cos(V),azimuthal:D,polar:z}}(C.expression.evaluate(y))}interpolate(C,y,S){return{x:x.number(C.x,y.x,S),y:x.number(C.y,y.y,S),z:x.number(C.z,y.z,S),azimuthal:x.number(C.azimuthal,y.azimuthal,S),polar:x.number(C.polar,y.polar,S)}}},color:new x.DataConstantProperty(x.spec.light.color),intensity:new x.DataConstantProperty(x.spec.light.intensity)}),Re="-transition";class ve extends x.Evented{constructor(y){super(),this._transitionable=new x.Transitionable(ge),this.setLight(y),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(y,S={}){if(!this._validate(x.validateLight,y,S))for(const D in y){const z=y[D];x.endsWith(D,Re)?this._transitionable.setTransition(D.slice(0,-Re.length),z):this._transitionable.setValue(D,z)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,S,D){return(!D||D.validate!==!1)&&x.emitValidationErrors(this,y.call(x.validateStyle,x.extend({value:S,style:{glyphs:!0,sprite:!0},styleSpec:x.spec})))}}const de=new x.Properties({source:new x.DataConstantProperty(x.spec.terrain.source),exaggeration:new x.DataConstantProperty(x.spec.terrain.exaggeration)}),Se="-transition";class ce extends x.Evented{constructor(y,S){super(),this._transitionable=new x.Transitionable(de),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=S}get(){return this._transitionable.serialize()}set(y){for(const S in y){const D=y[S];x.endsWith(S,Se)?this._transitionable.setTransition(S.slice(0,-Se.length),D):this._transitionable.setValue(S,D)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}}function ye(C,y,S,D){const z=x.smoothstep(45,65,S),[O,V]=ze(C,D),Z=x.length(y);let K=1-Math.min(1,Math.exp((Z-O)/(V-O)*-6));return K*=K*K,K=Math.min(1,1.00747*K),K*z*C.alpha}function ze(C,y){const S=.5/Math.tan(.5*y);return[C.range[0]+S,C.range[1]+S]}const Xe=new x.Properties({range:new x.DataConstantProperty(x.spec.fog.range),color:new x.DataConstantProperty(x.spec.fog.color),"horizon-blend":new x.DataConstantProperty(x.spec.fog["horizon-blend"])}),at="-transition";class ct extends x.Evented{constructor(y,S){super(),this._transitionable=new x.Transitionable(Xe),this.set(y),this._transitioning=this._transitionable.untransitioned(),this._transform=S}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(y,S={}){if(!this._validate(x.validateFog,y,S))for(const D in y){const z=y[D];x.endsWith(D,at)?this._transitionable.setTransition(D.slice(0,-at.length),z):this._transitionable.setValue(D,z)}}getOpacity(y){if(!this._transform.projection.supportsFog)return 0;const S=this.properties&&this.properties.get("color")||1;return x.smoothstep(45,65,y)*S.a}getOpacityAtLatLng(y,S){return this._transform.projection.supportsFog?function(D,z,O){const V=x.MercatorCoordinate.fromLngLat(z),Z=O.elevation?O.elevation.getAtPointOrZero(V):0,K=[V.x,V.y,Z];return x.transformMat4(K,K,O.mercatorFogMatrix),ye(D,K,O.pitch,O._fov)}(this.state,y,S):0}getFovAdjustedRange(y){return this._transform.projection.supportsFog?ze(this.state,y):[0,1]}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,S,D){return(!D||D.validate!==!1)&&x.emitValidationErrors(this,y.call(x.validateStyle,x.extend({value:S,style:{glyphs:!0,sprite:!0},styleSpec:x.spec})))}}class Bt{constructor(y,S){this.workerPool=y,this.actors=[],this.currentActor=0,this.id=x.uniqueId();const D=this.workerPool.acquire(this.id);for(let z=0;z<D.length;z++){const O=new Bt.Actor(D[z],S,this.id);O.name=`Worker ${z}`,this.actors.push(O)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(y,S,D){x.asyncAll(this.actors,(z,O)=>{z.send(y,S,O)},D=D||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(y=>{y.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Lt(C,y,S){return y*(x.EXTENT/(C.tileSize*Math.pow(2,S-C.tileID.overscaledZ)))}Bt.Actor=x.Actor;class It{constructor(y,S,D){this.context=y;const z=y.gl;this.buffer=z.createBuffer(),this.dynamicDraw=Boolean(D),this.context.unbindVAO(),y.bindElementBuffer.set(this.buffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||delete S.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(y){const S=this.context.gl;this.context.unbindVAO(),this.bind(),S.bufferSubData(S.ELEMENT_ARRAY_BUFFER,0,y.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ft{constructor(y,S,D,z){this.length=S.length,this.attributes=D,this.itemSize=S.bytesPerElement,this.dynamicDraw=z,this.context=y;const O=y.gl;this.buffer=O.createBuffer(),y.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete S.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(y){const S=this.context.gl;this.bind(),S.bufferSubData(S.ARRAY_BUFFER,0,y.arrayBuffer)}enableAttributes(y,S){for(let D=0;D<this.attributes.length;D++){const z=S.attributes[this.attributes[D].name];z!==void 0&&y.enableVertexAttribArray(z)}}setVertexAttribPointers(y,S,D){for(let z=0;z<this.attributes.length;z++){const O=this.attributes[z],V=S.attributes[O.name];V!==void 0&&y.vertexAttribPointer(V,O.components,y[Vt[O.type]],!1,this.itemSize,O.offset+this.itemSize*(D||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mt{constructor(y){this.gl=y.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(y){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ri extends Mt{getDefault(){return x.Color.transparent}set(y){const S=this.current;(y.r!==S.r||y.g!==S.g||y.b!==S.b||y.a!==S.a||this.dirty)&&(this.gl.clearColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class St extends Mt{getDefault(){return 1}set(y){(y!==this.current||this.dirty)&&(this.gl.clearDepth(y),this.current=y,this.dirty=!1)}}class At extends Mt{getDefault(){return 0}set(y){(y!==this.current||this.dirty)&&(this.gl.clearStencil(y),this.current=y,this.dirty=!1)}}class Et extends Mt{getDefault(){return[!0,!0,!0,!0]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||y[3]!==S[3]||this.dirty)&&(this.gl.colorMask(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class Ut extends Mt{getDefault(){return!0}set(y){(y!==this.current||this.dirty)&&(this.gl.depthMask(y),this.current=y,this.dirty=!1)}}class jt extends Mt{getDefault(){return 255}set(y){(y!==this.current||this.dirty)&&(this.gl.stencilMask(y),this.current=y,this.dirty=!1)}}class mi extends Mt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(y){const S=this.current;(y.func!==S.func||y.ref!==S.ref||y.mask!==S.mask||this.dirty)&&(this.gl.stencilFunc(y.func,y.ref,y.mask),this.current=y,this.dirty=!1)}}class oi extends Mt{getDefault(){const y=this.gl;return[y.KEEP,y.KEEP,y.KEEP]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||this.dirty)&&(this.gl.stencilOp(y[0],y[1],y[2]),this.current=y,this.dirty=!1)}}class yi extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.STENCIL_TEST):S.disable(S.STENCIL_TEST),this.current=y,this.dirty=!1}}class xi extends Mt{getDefault(){return[0,1]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||this.dirty)&&(this.gl.depthRange(y[0],y[1]),this.current=y,this.dirty=!1)}}class Bi extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),this.current=y,this.dirty=!1}}class fi extends Mt{getDefault(){return this.gl.LESS}set(y){(y!==this.current||this.dirty)&&(this.gl.depthFunc(y),this.current=y,this.dirty=!1)}}class mt extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.BLEND):S.disable(S.BLEND),this.current=y,this.dirty=!1}}class vt extends Mt{getDefault(){const y=this.gl;return[y.ONE,y.ZERO]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||this.dirty)&&(this.gl.blendFunc(y[0],y[1]),this.current=y,this.dirty=!1)}}class pi extends Mt{getDefault(){return x.Color.transparent}set(y){const S=this.current;(y.r!==S.r||y.g!==S.g||y.b!==S.b||y.a!==S.a||this.dirty)&&(this.gl.blendColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class si extends Mt{getDefault(){return this.gl.FUNC_ADD}set(y){(y!==this.current||this.dirty)&&(this.gl.blendEquation(y),this.current=y,this.dirty=!1)}}class We extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE),this.current=y,this.dirty=!1}}class Wt extends Mt{getDefault(){return this.gl.BACK}set(y){(y!==this.current||this.dirty)&&(this.gl.cullFace(y),this.current=y,this.dirty=!1)}}class Rt extends Mt{getDefault(){return this.gl.CCW}set(y){(y!==this.current||this.dirty)&&(this.gl.frontFace(y),this.current=y,this.dirty=!1)}}class ti extends Mt{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}}class ni extends Mt{getDefault(){return this.gl.TEXTURE0}set(y){(y!==this.current||this.dirty)&&(this.gl.activeTexture(y),this.current=y,this.dirty=!1)}}class bt extends Mt{getDefault(){const y=this.gl;return[0,0,y.drawingBufferWidth,y.drawingBufferHeight]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||y[3]!==S[3]||this.dirty)&&(this.gl.viewport(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class Pi extends Mt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindFramebuffer(S.FRAMEBUFFER,y),this.current=y,this.dirty=!1}}class Kt extends Mt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindRenderbuffer(S.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class qt extends Mt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindTexture(S.TEXTURE_2D,y),this.current=y,this.dirty=!1}}class Zt extends Mt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindBuffer(S.ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class kt extends Mt{getDefault(){return null}set(y){const S=this.gl;S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class ci extends Mt{constructor(y){super(y),this.vao=y.extVertexArrayObject}getDefault(){return null}set(y){this.vao&&(y!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(y),this.current=y,this.dirty=!1)}}class vi extends Mt{getDefault(){return 4}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_ALIGNMENT,y),this.current=y,this.dirty=!1}}class Ti extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),this.current=y,this.dirty=!1}}class ei extends Mt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,y),this.current=y,this.dirty=!1}}class hi extends Mt{constructor(y,S){super(y),this.context=y,this.parent=S}getDefault(){return null}}class Ni extends hi{setDirty(){this.dirty=!0}set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,y,0),this.current=y,this.dirty=!1}}class Ai extends hi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferRenderbuffer(S.FRAMEBUFFER,this.attachment(),S.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class Xi extends Ai{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ii{constructor(y,S,D,z){this.context=y,this.width=S,this.height=D;const O=this.framebuffer=y.gl.createFramebuffer();this.colorAttachment=new Ni(y,O),z&&(this.depthAttachment=new Ai(y,O))}destroy(){const y=this.context.gl,S=this.colorAttachment.get();if(S&&y.deleteTexture(S),this.depthAttachment){const D=this.depthAttachment.get();D&&y.deleteRenderbuffer(D)}y.deleteFramebuffer(this.framebuffer)}}class fr{constructor(y){this.gl=y,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ri(this),this.clearDepth=new St(this),this.clearStencil=new At(this),this.colorMask=new Et(this),this.depthMask=new Ut(this),this.stencilMask=new jt(this),this.stencilFunc=new mi(this),this.stencilOp=new oi(this),this.stencilTest=new yi(this),this.depthRange=new xi(this),this.depthTest=new Bi(this),this.depthFunc=new fi(this),this.blend=new mt(this),this.blendFunc=new vt(this),this.blendColor=new pi(this),this.blendEquation=new si(this),this.cullFace=new We(this),this.cullFaceSide=new Wt(this),this.frontFace=new Rt(this),this.program=new ti(this),this.activeTexture=new ni(this),this.viewport=new bt(this),this.bindFramebuffer=new Pi(this),this.bindRenderbuffer=new Kt(this),this.bindTexture=new qt(this),this.bindVertexBuffer=new Zt(this),this.bindElementBuffer=new kt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ci(this),this.pixelStoreUnpack=new vi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ti(this),this.pixelStoreUnpackFlipY=new ei(this),this.extTextureFilterAnisotropic=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=y.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=y.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(y.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=y.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=y.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=y.getParameter(y.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(y,S){return new It(this,y,S)}createVertexBuffer(y,S,D){return new Ft(this,y,S,D)}createRenderbuffer(y,S,D){const z=this.gl,O=z.createRenderbuffer();return this.bindRenderbuffer.set(O),z.renderbufferStorage(z.RENDERBUFFER,y,S,D),this.bindRenderbuffer.set(null),O}createFramebuffer(y,S,D){return new Ii(this,y,S,D)}clear({color:y,depth:S,stencil:D}){const z=this.gl;let O=0;y&&(O|=z.COLOR_BUFFER_BIT,this.clearColor.set(y),this.colorMask.set([!0,!0,!0,!0])),S!==void 0&&(O|=z.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(S),this.depthMask.set(!0)),D!==void 0&&(O|=z.STENCIL_BUFFER_BIT,this.clearStencil.set(D),this.stencilMask.set(255)),z.clear(O)}setCullFace(y){y.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(y.mode),this.frontFace.set(y.frontFace))}setDepthMode(y){y.func!==this.gl.ALWAYS||y.mask?(this.depthTest.set(!0),this.depthFunc.set(y.func),this.depthMask.set(y.mask),this.depthRange.set(y.range)):this.depthTest.set(!1)}setStencilMode(y){y.test.func!==this.gl.ALWAYS||y.mask?(this.stencilTest.set(!0),this.stencilMask.set(y.mask),this.stencilOp.set([y.fail,y.depthFail,y.pass]),this.stencilFunc.set({func:y.test.func,ref:y.ref,mask:y.test.mask})):this.stencilTest.set(!1)}setColorMode(y){q(y.blendFunction,x.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(y.blendFunction),this.blendColor.set(y.blendColor)),this.colorMask.set(y.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class sn{constructor(y,S,D,z){this.screenBounds=y,this.cameraPoint=S,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=D,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(O=>z.pointCoordinate3D(O)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(y,S){let D,z;if(y instanceof x.pointGeometry||typeof y[0]=="number"){const O=x.pointGeometry.convert(y);D=[x.pointGeometry.convert(y)],z=S.isPointAboveHorizon(O)}else{const O=x.pointGeometry.convert(y[0]),V=x.pointGeometry.convert(y[1]);D=[O,V],z=x.polygonizeBounds(O,V).every(Z=>S.isPointAboveHorizon(Z))}return new sn(D,S.getCameraPoint(),z,S)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(y){return x.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],y)}bufferedCameraGeometry(y){const S=this.screenBounds[0],D=this.screenBounds.length===1?this.screenBounds[0].add(new x.pointGeometry(1,1)):this.screenBounds[1],z=x.polygonizeBounds(S,D,0,!1);return this.cameraPoint.y>D.y&&(this.cameraPoint.x>S.x&&this.cameraPoint.x<D.x?z.splice(3,0,this.cameraPoint):this.cameraPoint.x>=D.x?z[2]=this.cameraPoint:this.cameraPoint.x<=S.x&&(z[3]=this.cameraPoint)),x.bufferConvexPolygon(z,y)}containsTile(y,S,D){const z=y.queryPadding+1,O=y.tileID.wrap,V=D?this._bufferedCameraMercator(z,S).map(xe=>x.getTilePoint(y.tileTransform,xe,O)):this._bufferedScreenMercator(z,S).map(xe=>x.getTilePoint(y.tileTransform,xe,O)),Z=this.screenGeometryMercator.map(xe=>x.getTileVec3(y.tileTransform,xe,O)),K=Z.map(xe=>new x.pointGeometry(xe[0],xe[1])),Q=S.getFreeCameraOptions().position||new x.MercatorCoordinate(0,0,0),ie=x.getTileVec3(y.tileTransform,Q,O),ae=Z.map(xe=>{const Te=x.sub(xe,xe,ie);return x.normalize(Te,Te),new x.Ray(ie,Te)}),pe=Lt(y,1,S.zoom);if(x.polygonIntersectsBox(V,0,0,x.EXTENT,x.EXTENT))return{queryGeometry:this,tilespaceGeometry:K,tilespaceRays:ae,bufferedTilespaceGeometry:V,bufferedTilespaceBounds:(Ee=x.getBounds(V),Ee.min.x=x.clamp(Ee.min.x,0,x.EXTENT),Ee.min.y=x.clamp(Ee.min.y,0,x.EXTENT),Ee.max.x=x.clamp(Ee.max.x,0,x.EXTENT),Ee.max.y=x.clamp(Ee.max.y,0,x.EXTENT),Ee),tile:y,tileID:y.tileID,pixelToTileUnitsFactor:pe};var Ee}_bufferedScreenMercator(y,S){const D=pr(y);if(this._screenRaycastCache[D])return this._screenRaycastCache[D];{const z=this.bufferedScreenGeometry(y).map(O=>S.pointCoordinate3D(O));return this._screenRaycastCache[D]=z,z}}_bufferedCameraMercator(y,S){const D=pr(y);if(this._cameraRaycastCache[D])return this._cameraRaycastCache[D];{const z=this.bufferedCameraGeometry(y).map(O=>S.pointCoordinate3D(O));return this._cameraRaycastCache[D]=z,z}}}function pr(C){return 100*C|0}function Br(C,y,S){const D=function(z,O){if(z)return S(z);if(O){const V=x.pick(x.extend(O,C),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(V.vectorLayers=O.vector_layers,V.vectorLayerIds=V.vectorLayers.map(Z=>Z.id)),V.tiles=y.canonicalizeTileset(V,C.url),S(null,V)}};return C.url?x.getJSON(y.transformRequest(y.normalizeSourceURL(C.url),x.ResourceType.Source),D):x.exported.frame(()=>D(null,C))}class Lr{constructor(y,S,D){this.bounds=x.LngLatBounds.convert(this.validateBounds(y)),this.minzoom=S||0,this.maxzoom=D||24}validateBounds(y){return Array.isArray(y)&&y.length===4?[Math.max(-180,y[0]),Math.max(-90,y[1]),Math.min(180,y[2]),Math.min(90,y[3])]:[-180,-90,180,90]}contains(y){const S=Math.pow(2,y.z),D=Math.floor(x.mercatorXfromLng(this.bounds.getWest())*S),z=Math.floor(x.mercatorYfromLat(this.bounds.getNorth())*S),O=Math.ceil(x.mercatorXfromLng(this.bounds.getEast())*S),V=Math.ceil(x.mercatorYfromLat(this.bounds.getSouth())*S);return y.x>=D&&y.x<O&&y.y>=z&&y.y<V}}class Tr extends x.Evented{constructor(y,S,D,z){super(),this.id=y,this.dispatcher=D,this.setEventedParent(z),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=x.extend({type:"raster"},S),x.extend(this,x.pick(S,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Br(this._options,this.map._requestManager,(y,S)=>{this._tileJSONRequest=null,this._loaded=!0,y?this.fire(new x.ErrorEvent(y)):S&&(x.extend(this,S),S.bounds&&(this.tileBounds=new Lr(S.bounds,this.minzoom,this.maxzoom)),x.postTurnstileEvent(S.tiles),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(y){this.map=y,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return x.extend({},this._options)}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,S){const D=x.exported.devicePixelRatio>=2,z=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),D,this.tileSize);y.request=x.getImage(this.map._requestManager.transformRequest(z,x.ResourceType.Tile),(O,V,Z,K)=>{if(delete y.request,y.aborted)y.state="unloaded",S(null);else if(O)y.state="errored",S(O);else if(V){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:Z,expires:K});const Q=this.map.painter.context,ie=Q.gl;y.texture=this.map.painter.getTileTexture(V.width),y.texture?y.texture.update(V,{useMipmap:!0}):(y.texture=new x.Texture(Q,V,ie.RGBA,{useMipmap:!0}),y.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Q.extTextureFilterAnisotropic&&ie.texParameterf(ie.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax)),y.state="loaded",x.cacheEntryPossiblyAdded(this.dispatcher),S(null)}})}abortTile(y,S){y.request&&(y.request.cancel(),delete y.request),S()}unloadTile(y,S){y.texture&&this.map.painter.saveTileTexture(y.texture),S()}hasTransition(){return!1}}let br;function Nr(C,y,S,D,z,O,V,Z){const K=[C,S,z,y,D,O,1,1,1],Q=[V,Z,1],ie=x.adjoint([],K),[ae,pe,Ee]=x.transformMat3(Q,Q,x.transpose(ie,ie));return x.multiply(K,[ae,0,0,0,pe,0,0,0,Ee],K)}class Sr extends x.Evented{constructor(y,S,D,z){super(),this.id=y,this.dispatcher=D,this.coordinates=S.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(z),this.options=S}load(y,S){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this.url=this.options.url,x.getImage(this.map._requestManager.transformRequest(this.url,x.ResourceType.Image),(D,z)=>{this._loaded=!0,D?this.fire(new x.ErrorEvent(D)):z&&(this.image=x.exported.getImageData(z),this.width=this.image.width,this.height=this.image.height,y&&(this.coordinates=y),S&&S(),this._finishLoading())})}loaded(){return this._loaded}updateImage(y){return this.image&&y.url?(this.options.url=y.url,this.load(y.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(y){this.map=y,this.load()}setCoordinates(y){this.coordinates=y,delete this._boundsArray;const S=y.map(x.MercatorCoordinate.fromLngLat);return this.tileID=function(D){let z=1/0,O=1/0,V=-1/0,Z=-1/0;for(const ae of D)z=Math.min(z,ae.x),O=Math.min(O,ae.y),V=Math.max(V,ae.x),Z=Math.max(Z,ae.y);const K=Math.max(V-z,Z-O),Q=Math.max(0,Math.floor(-Math.log(K)/Math.LN2)),ie=Math.pow(2,Q);return new x.CanonicalTileID(Q,Math.floor((z+V)/2*ie),Math.floor((O+Z)/2*ie))}(S),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const y=x.tileTransform(this.tileID,this.map.transform.projection),[S,D,z,O]=this.coordinates.map(V=>{const Z=y.projection.project(V[0],V[1]);return x.getTilePoint(y,Z)._round()});return this.perspectiveTransform=function(V,Z,K,Q,ie,ae,pe,Ee,xe,Te){const Fe=Nr(0,0,V,0,0,Z,V,Z),we=Nr(K,Q,ie,ae,pe,Ee,xe,Te);return x.multiply(we,x.adjoint(Fe,Fe),we),[we[6]/we[8]*V/x.EXTENT,we[7]/we[8]*Z/x.EXTENT]}(this.width,this.height,S.x,S.y,D.x,D.y,O.x,O.y,z.x,z.y),this._boundsArray=new x.StructArrayLayout4i8,this._boundsArray.emplaceBack(S.x,S.y,0,0),this._boundsArray.emplaceBack(D.x,D.y,x.EXTENT,0),this._boundsArray.emplaceBack(O.x,O.y,0,x.EXTENT),this._boundsArray.emplaceBack(z.x,z.y,x.EXTENT,x.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,S=y.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,x.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new x.Texture(y,this.image,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE));for(const D in this.tiles){const z=this.tiles[D];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}loadTile(y,S){this.tileID&&this.tileID.equals(y.tileID.canonical)?(this.tiles[String(y.tileID.wrap)]=y,y.buckets={},S(null)):(y.state="errored",S(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Me={vector:class extends x.Evented{constructor(C,y,S,D){if(super(),this.id=C,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,x.extend(this,x.pick(y,["url","scheme","tileSize","promoteId"])),this._options=x.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(D),this._tileWorkers={},this._deduped=new x.DedupedRequest}load(){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Br(this._options,this.map._requestManager,(C,y)=>{this._tileJSONRequest=null,this._loaded=!0,C?this.fire(new x.ErrorEvent(C)):y&&(x.extend(this,y),y.bounds&&(this.tileBounds=new Lr(y.bounds,this.minzoom,this.maxzoom)),x.postTurnstileEvent(y.tiles,this.map._requestManager._customAccessToken),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(C){return!this.tileBounds||this.tileBounds.contains(C.canonical)}onAdd(C){this.map=C,this.load()}setSourceProperty(C){this._tileJSONRequest&&this._tileJSONRequest.cancel(),C();const y=this.map.style._getSourceCaches(this.id);for(const S of y)S.clearTiles();this.load()}setTiles(C){return this.setSourceProperty(()=>{this._options.tiles=C}),this}setUrl(C){return this.setSourceProperty(()=>{this.url=C,this._options.url=C}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return x.extend({},this._options)}loadTile(C,y){const S=this.map._requestManager.normalizeTileURL(C.tileID.canonical.url(this.tiles,this.scheme)),D={request:this.map._requestManager.transformRequest(S,x.ResourceType.Tile),data:void 0,uid:C.uid,tileID:C.tileID,tileZoom:C.tileZoom,zoom:C.tileID.overscaledZ,tileSize:this.tileSize*C.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:x.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:C.isSymbolTile};if(D.request.collectResourceTiming=this._collectResourceTiming,C.actor&&C.state!=="expired")C.state==="loading"?C.reloadCallback=y:C.request=C.actor.send("reloadTile",D,z.bind(this));else if(C.actor=this._tileWorkers[S]=this._tileWorkers[S]||this.dispatcher.getActor(),this.dispatcher.ready)C.request=C.actor.send("loadTile",D,z.bind(this),void 0,!0);else{const O=x.loadVectorTile.call({deduped:this._deduped},D,(V,Z)=>{V||!Z?z.call(this,V):(D.data={cacheControl:Z.cacheControl,expires:Z.expires,rawData:Z.rawData.slice(0)},C.actor&&C.actor.send("loadTile",D,z.bind(this),void 0,!0))},!0);C.request={cancel:O}}function z(O,V){return delete C.request,C.aborted?y(null):O&&O.status!==404?y(O):(V&&V.resourceTiming&&(C.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&C.setExpiryData(V),C.loadVectorData(V,this.map.painter),x.cacheEntryPossiblyAdded(this.dispatcher),y(null),void(C.reloadCallback&&(this.loadTile(C,C.reloadCallback),C.reloadCallback=null)))}}abortTile(C){C.request&&(C.request.cancel(),delete C.request),C.actor&&C.actor.send("abortTile",{uid:C.uid,type:this.type,source:this.id})}unloadTile(C){C.unloadVectorData(),C.actor&&C.actor.send("removeTile",{uid:C.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Tr,"raster-dem":class extends Tr{constructor(C,y,S,D){super(C,y,S,D),this.type="raster-dem",this.maxzoom=22,this._options=x.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}loadTile(C,y){const S=this.map._requestManager.normalizeTileURL(C.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function D(z,O){z&&(C.state="errored",y(z)),O&&(C.dem=O,C.dem.onDeserialize(),C.needsHillshadePrepare=!0,C.needsDEMTextureUpload=!0,C.state="loaded",y(null))}C.request=x.getImage(this.map._requestManager.transformRequest(S,x.ResourceType.Tile),function(z,O,V,Z){if(delete C.request,C.aborted)C.state="unloaded",y(null);else if(z)C.state="errored",y(z);else if(O){this.map._refreshExpiredTiles&&C.setExpiryData({cacheControl:V,expires:Z});const K=x.window.ImageBitmap&&O instanceof x.window.ImageBitmap&&(br==null&&(br=x.window.OffscreenCanvas&&new x.window.OffscreenCanvas(1,1).getContext("2d")&&typeof x.window.createImageBitmap=="function"),br),Q=1-(O.width-x.prevPowerOfTwo(O.width))/2;Q<1||C.neighboringTiles||(C.neighboringTiles=this._getNeighboringTiles(C.tileID));const ie=K?O:x.exported.getImageData(O,Q),ae={uid:C.uid,coord:C.tileID,source:this.id,rawImageData:ie,encoding:this.encoding,padding:Q};C.actor&&C.state!=="expired"||(C.actor=this.dispatcher.getActor(),C.actor.send("loadDEMTile",ae,D.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(C){const y=C.canonical,S=Math.pow(2,y.z),D=(y.x-1+S)%S,z=y.x===0?C.wrap-1:C.wrap,O=(y.x+1+S)%S,V=y.x+1===S?C.wrap+1:C.wrap,Z={};return Z[new x.OverscaledTileID(C.overscaledZ,z,y.z,D,y.y).key]={backfilled:!1},Z[new x.OverscaledTileID(C.overscaledZ,V,y.z,O,y.y).key]={backfilled:!1},y.y>0&&(Z[new x.OverscaledTileID(C.overscaledZ,z,y.z,D,y.y-1).key]={backfilled:!1},Z[new x.OverscaledTileID(C.overscaledZ,C.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},Z[new x.OverscaledTileID(C.overscaledZ,V,y.z,O,y.y-1).key]={backfilled:!1}),y.y+1<S&&(Z[new x.OverscaledTileID(C.overscaledZ,z,y.z,D,y.y+1).key]={backfilled:!1},Z[new x.OverscaledTileID(C.overscaledZ,C.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},Z[new x.OverscaledTileID(C.overscaledZ,V,y.z,O,y.y+1).key]={backfilled:!1}),Z}unloadTile(C){C.demTexture&&this.map.painter.saveTileTexture(C.demTexture),C.fbo&&(C.fbo.destroy(),delete C.fbo),C.dem&&delete C.dem,delete C.neighboringTiles,C.state="unloaded"}},geojson:class extends x.Evented{constructor(C,y,S,D){super(),this.id=C,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(D),this._data=y.data,this._options=x.extend({},y),this._collectResourceTiming=y.collectResourceTiming,y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;const z=x.EXTENT/this.tileSize;this.workerOptions=x.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*z,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*z,extent:x.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?y.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:x.EXTENT,radius:(y.clusterRadius!==void 0?y.clusterRadius:50)*z,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions)}onAdd(C){this.map=C,this.setData(this._data)}setData(C){return this._data=C,this._updateWorkerData(),this}getClusterExpansionZoom(C,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:C,source:this.id},y),this}getClusterChildren(C,y){return this.actor.send("geojson.getClusterChildren",{clusterId:C,source:this.id},y),this}getClusterLeaves(C,y,S,D){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:C,limit:y,offset:S},D),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new x.Event("dataloading",{dataType:"source"})),this._loaded=!1;const C=x.extend({},this.workerOptions),y=this._data;typeof y=="string"?(C.request=this.map._requestManager.transformRequest(x.exported.resolveURL(y),x.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(y),this._pendingLoad=this.actor.send(`${this.type}.loadData`,C,(S,D)=>{if(this._loaded=!0,this._pendingLoad=null,S)this.fire(new x.ErrorEvent(S));else{const z={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&D&&D.resourceTiming&&D.resourceTiming[this.id]&&(z.resourceTiming=D.resourceTiming[this.id]),this.fire(new x.Event("data",z)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(C,y){const S=C.actor?"reloadTile":"loadTile";C.actor=this.actor,C.request=this.actor.send(S,{type:this.type,uid:C.uid,tileID:C.tileID,tileZoom:C.tileZoom,zoom:C.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:x.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(D,z)=>(delete C.request,C.unloadVectorData(),C.aborted?y(null):D?y(D):(C.loadVectorData(z,this.map.painter,S==="reloadTile"),y(null))),void 0,S==="loadTile")}abortTile(C){C.request&&(C.request.cancel(),delete C.request),C.aborted=!0}unloadTile(C){C.unloadVectorData(),this.actor.send("removeTile",{uid:C.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return x.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Sr{constructor(C,y,S,D){super(C,y,S,D),this.roundZoom=!0,this.type="video",this.options=y}load(){this._loaded=!1;const C=this.options;this.urls=[];for(const y of C.urls)this.urls.push(this.map._requestManager.transformRequest(y,x.ResourceType.Source).url);x.getVideo(this.urls,(y,S)=>{this._loaded=!0,y?this.fire(new x.ErrorEvent(y)):S&&(this.video=S,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(C){if(this.video){const y=this.video.seekable;C<y.start(0)||C>y.end(0)?this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${y.start(0)} and ${y.end(0)}-second mark.`))):this.video.currentTime=C}}getVideo(){return this.video}onAdd(C){this.map||(this.map=C,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const C=this.map.painter.context,y=C.gl;this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new x.Texture(C,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=C.createVertexBuffer(this._boundsArray,x.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2));for(const S in this.tiles){const D=this.tiles[S];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Sr,canvas:class extends Sr{constructor(C,y,S,D){super(C,y,S,D),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(z=>!Array.isArray(z)||z.length!==2||z.some(O=>typeof O!="number"))||this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${C}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${C}`,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${C}`,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof x.window.HTMLCanvasElement||this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${C}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${C}`,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof x.window.HTMLCanvasElement?this.options.canvas:x.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new x.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(C){this.map=C,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let C=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,C=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,C=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const y=this.map.painter.context,S=y.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,x.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(C||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new x.Texture(y,this.canvas,S.RGBA,{premultiply:!0});for(const D in this.tiles){const z=this.tiles[D];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const C of[this.canvas.width,this.canvas.height])if(isNaN(C)||C<=0)return!0;return!1}}},Ge=function(C,y,S,D){const z=new Me[y.type](C,y,S,D);if(z.id!==C)throw new Error(`Expected Source id to be ${C} instead of ${z.id}`);return x.bindAll(["load","abort","unload","serialize","prepare"],z),z};function le(C,y){const S=x.identity([]);return x.scale(S,S,[.5*C.width,.5*-C.height,1]),x.translate(S,S,[1,-1,0]),x.multiply$1(S,S,C.calculateProjMatrix(y.toUnwrapped()))}function J(C,y,S,D,z,O,V,Z=!1){const K=C.tilesIn(D,V,Z);K.sort(fe);const Q=[];for(const ae of K)Q.push({wrappedTileID:ae.tile.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(y,S,C._state,ae,z,O,le(C.transform,ae.tile.tileID),Z)});const ie=function(ae){const pe={},Ee={};for(const xe of ae){const Te=xe.queryResults,Fe=xe.wrappedTileID,we=Ee[Fe]=Ee[Fe]||{};for(const De in Te){const Be=Te[De],ke=we[De]=we[De]||{},Ce=pe[De]=pe[De]||[];for(const Oe of Be)ke[Oe.featureIndex]||(ke[Oe.featureIndex]=!0,Ce.push(Oe))}}return pe}(Q);for(const ae in ie)ie[ae].forEach(pe=>{const Ee=pe.feature,xe=C.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=xe});return ie}function ne(C,y){const S=C.getRenderableIds().map(O=>C.getTileByID(O)),D=[],z={};for(let O=0;O<S.length;O++){const V=S[O],Z=V.tileID.canonical.key;z[Z]||(z[Z]=!0,V.querySourceFeatures(D,y))}return D}function fe(C,y){const S=C.tileID,D=y.tileID;return S.overscaledZ-D.overscaledZ||S.canonical.y-D.canonical.y||S.wrap-D.wrap||S.canonical.x-D.canonical.x}function Ae(){return to.workerClass!=null?new to.workerClass:new x.window.Worker(to.workerUrl)}const Pe="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(y){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Ae);return this.active[y]=!0,this.workers.slice()}release(y){delete this.active[y],this.numActive()===0&&(this.workers.forEach(S=>{S.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pe]}numActive(){return Object.keys(this.active).length}}let Ve;function $e(){return Ve||(Ve=new Ue),Ve}function Ze(C,y){const S={};for(const D in C)D!=="ref"&&(S[D]=C[D]);return x.refProperties.forEach(D=>{D in y&&(S[D]=y[D])}),S}function Qe(C){C=C.slice();const y=Object.create(null);for(let S=0;S<C.length;S++)y[C[S].id]=C[S];for(let S=0;S<C.length;S++)"ref"in C[S]&&(C[S]=Ze(C[S],y[C[S].ref]));return C}Ue.workerCount=2;const et={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function lt(C,y,S){S.push({command:et.addSource,args:[C,y[C]]})}function Ct(C,y,S){y.push({command:et.removeSource,args:[C]}),S[C]=!0}function Gt(C,y,S,D){Ct(C,S,D),lt(C,y,S)}function Xt(C,y,S){let D;for(D in C[S])if(C[S].hasOwnProperty(D)&&D!=="data"&&!q(C[S][D],y[S][D]))return!1;for(D in y[S])if(y[S].hasOwnProperty(D)&&D!=="data"&&!q(C[S][D],y[S][D]))return!1;return!0}function Ht(C,y,S,D,z,O){let V;for(V in y=y||{},C=C||{})C.hasOwnProperty(V)&&(q(C[V],y[V])||S.push({command:O,args:[D,V,y[V],z]}));for(V in y)y.hasOwnProperty(V)&&!C.hasOwnProperty(V)&&(q(C[V],y[V])||S.push({command:O,args:[D,V,y[V],z]}))}function gi(C){return C.id}function Yi(C,y){return C[y.id]=y,C}class Ji{constructor(y,S){this.reset(y,S)}reset(y,S){this.points=y||[],this._distances=[0];for(let D=1;D<this.points.length;D++)this._distances[D]=this._distances[D-1]+this.points[D].dist(this.points[D-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(S||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(y){if(this.points.length===1)return this.points[0];y=x.clamp(y,0,1);let S=1,D=this._distances[S];const z=y*this.paddedLength+this.padding;for(;D<z&&S<this._distances.length;)D=this._distances[++S];const O=S-1,V=this._distances[O],Z=D-V,K=Z>0?(z-V)/Z:0;return this.points[O].mult(1-K).add(this.points[S].mult(K))}}class qi{constructor(y,S,D){const z=this.boxCells=[],O=this.circleCells=[];this.xCellCount=Math.ceil(y/D),this.yCellCount=Math.ceil(S/D);for(let V=0;V<this.xCellCount*this.yCellCount;V++)z.push([]),O.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=y,this.height=S,this.xScale=this.xCellCount/y,this.yScale=this.yCellCount/S,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(y,S,D,z,O){this._forEachCell(S,D,z,O,this._insertBoxCell,this.boxUid++),this.boxKeys.push(y),this.bboxes.push(S),this.bboxes.push(D),this.bboxes.push(z),this.bboxes.push(O)}insertCircle(y,S,D,z){this._forEachCell(S-z,D-z,S+z,D+z,this._insertCircleCell,this.circleUid++),this.circleKeys.push(y),this.circles.push(S),this.circles.push(D),this.circles.push(z)}_insertBoxCell(y,S,D,z,O,V){this.boxCells[O].push(V)}_insertCircleCell(y,S,D,z,O,V){this.circleCells[O].push(V)}_query(y,S,D,z,O,V){if(D<0||y>this.width||z<0||S>this.height)return!O&&[];const Z=[];if(y<=0&&S<=0&&this.width<=D&&this.height<=z){if(O)return!0;for(let K=0;K<this.boxKeys.length;K++)Z.push({key:this.boxKeys[K],x1:this.bboxes[4*K],y1:this.bboxes[4*K+1],x2:this.bboxes[4*K+2],y2:this.bboxes[4*K+3]});for(let K=0;K<this.circleKeys.length;K++){const Q=this.circles[3*K],ie=this.circles[3*K+1],ae=this.circles[3*K+2];Z.push({key:this.circleKeys[K],x1:Q-ae,y1:ie-ae,x2:Q+ae,y2:ie+ae})}return V?Z.filter(V):Z}return this._forEachCell(y,S,D,z,this._queryCell,Z,{hitTest:O,seenUids:{box:{},circle:{}}},V),O?Z.length>0:Z}_queryCircle(y,S,D,z,O){const V=y-D,Z=y+D,K=S-D,Q=S+D;if(Z<0||V>this.width||Q<0||K>this.height)return!z&&[];const ie=[];return this._forEachCell(V,K,Z,Q,this._queryCellCircle,ie,{hitTest:z,circle:{x:y,y:S,radius:D},seenUids:{box:{},circle:{}}},O),z?ie.length>0:ie}query(y,S,D,z,O){return this._query(y,S,D,z,!1,O)}hitTest(y,S,D,z,O){return this._query(y,S,D,z,!0,O)}hitTestCircle(y,S,D,z){return this._queryCircle(y,S,D,!0,z)}_queryCell(y,S,D,z,O,V,Z,K){const Q=Z.seenUids,ie=this.boxCells[O];if(ie!==null){const pe=this.bboxes;for(const Ee of ie)if(!Q.box[Ee]){Q.box[Ee]=!0;const xe=4*Ee;if(y<=pe[xe+2]&&S<=pe[xe+3]&&D>=pe[xe+0]&&z>=pe[xe+1]&&(!K||K(this.boxKeys[Ee]))){if(Z.hitTest)return V.push(!0),!0;V.push({key:this.boxKeys[Ee],x1:pe[xe],y1:pe[xe+1],x2:pe[xe+2],y2:pe[xe+3]})}}}const ae=this.circleCells[O];if(ae!==null){const pe=this.circles;for(const Ee of ae)if(!Q.circle[Ee]){Q.circle[Ee]=!0;const xe=3*Ee;if(this._circleAndRectCollide(pe[xe],pe[xe+1],pe[xe+2],y,S,D,z)&&(!K||K(this.circleKeys[Ee]))){if(Z.hitTest)return V.push(!0),!0;{const Te=pe[xe],Fe=pe[xe+1],we=pe[xe+2];V.push({key:this.circleKeys[Ee],x1:Te-we,y1:Fe-we,x2:Te+we,y2:Fe+we})}}}}}_queryCellCircle(y,S,D,z,O,V,Z,K){const Q=Z.circle,ie=Z.seenUids,ae=this.boxCells[O];if(ae!==null){const Ee=this.bboxes;for(const xe of ae)if(!ie.box[xe]){ie.box[xe]=!0;const Te=4*xe;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,Ee[Te+0],Ee[Te+1],Ee[Te+2],Ee[Te+3])&&(!K||K(this.boxKeys[xe])))return V.push(!0),!0}}const pe=this.circleCells[O];if(pe!==null){const Ee=this.circles;for(const xe of pe)if(!ie.circle[xe]){ie.circle[xe]=!0;const Te=3*xe;if(this._circlesCollide(Ee[Te],Ee[Te+1],Ee[Te+2],Q.x,Q.y,Q.radius)&&(!K||K(this.circleKeys[xe])))return V.push(!0),!0}}}_forEachCell(y,S,D,z,O,V,Z,K){const Q=this._convertToXCellCoord(y),ie=this._convertToYCellCoord(S),ae=this._convertToXCellCoord(D),pe=this._convertToYCellCoord(z);for(let Ee=Q;Ee<=ae;Ee++)for(let xe=ie;xe<=pe;xe++)if(O.call(this,y,S,D,z,this.xCellCount*xe+Ee,V,Z,K))return}_convertToXCellCoord(y){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(y*this.xScale)))}_convertToYCellCoord(y){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(y*this.yScale)))}_circlesCollide(y,S,D,z,O,V){const Z=z-y,K=O-S,Q=D+V;return Q*Q>Z*Z+K*K}_circleAndRectCollide(y,S,D,z,O,V,Z){const K=(V-z)/2,Q=Math.abs(y-(z+K));if(Q>K+D)return!1;const ie=(Z-O)/2,ae=Math.abs(S-(O+ie));if(ae>ie+D)return!1;if(Q<=K||ae<=ie)return!0;const pe=Q-K,Ee=ae-ie;return pe*pe+Ee*Ee<=D*D}}const Hi=Math.tan(85*Math.PI/180);function Gn(C,y,S,D,z,O){let V=x.create();if(S){if(z.projection.name==="globe")V=x.calculateGlobeMatrix(z,z.worldSize/z._projectionScaler,[0,0]),x.multiply$1(V,V,x.globeDenormalizeECEF(x.globeTileBounds(y)));else{const Z=U([],O);V[0]=Z[0],V[1]=Z[1],V[4]=Z[2],V[5]=Z[3]}D||x.rotateZ(V,V,z.angle)}else x.multiply$1(V,z.labelPlaneMatrix,C);return V}function Rn(C,y,S,D,z,O){if(S){if(z.projection.name==="globe"){const V=Gn(C,y,S,D,z,O);return x.invert(V,V),x.multiply$1(V,C,V),V}{const V=x.clone(C),Z=x.identity([]);return Z[0]=O[0],Z[1]=O[1],Z[4]=O[2],Z[5]=O[3],x.multiply$1(V,V,Z),D||x.rotateZ(V,V,-z.angle),V}}return z.glCoordMatrix}function zr(C,y,S=0){const D=[C.x,C.y,S,1];S?x.transformMat4$1(D,D,y):Ko(D,D,y);const z=D[3];return{point:new x.pointGeometry(D[0]/z,D[1]/z),signedDistanceFromCamera:z}}function Tn(C,y){return Math.min(.5+C/y*.5,1.5)}function Ps(C,y){const S=C[0]/C[3],D=C[1]/C[3];return S>=-y[0]&&S<=y[0]&&D>=-y[1]&&D<=y[1]}function Rl(C,y,S,D,z,O,V,Z,K,Q){const ie=S.transform,ae=D?C.textSizeData:C.iconSizeData,pe=x.evaluateSizeForZoom(ae,S.transform.zoom),Ee=[256/S.width*2+1,256/S.height*2+1],xe=D?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;xe.clear();const Te=C.lineVertexArray,Fe=D?C.text.placedSymbolArray:C.icon.placedSymbolArray,we=S.transform.width/S.transform.height;let De=!1;for(let Be=0;Be<Fe.length;Be++){const ke=Fe.get(Be);if(ke.writingMode!==x.WritingMode.vertical||De||Be!==0&&Fe.get(Be-1).writingMode===x.WritingMode.horizontal||(De=!0),ke.hidden||ke.writingMode===x.WritingMode.vertical&&!De){gn(ke.numGlyphs,xe);continue}De=!1;const Ce=new x.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),Oe=K?K(Ce):[0,0,0],He=ie.projection.projectTilePoint(Ce.x,Ce.y,Q.canonical),Je=[He.x+Oe[0],He.y+Oe[1],He.z+Oe[2]],xt=[...Je,1];if(x.transformMat4$1(xt,xt,y),!Ps(xt,Ee)){gn(ke.numGlyphs,xe);continue}const ft=Tn(S.transform.cameraToCenterDistance,xt[3]),dt=x.evaluateSizeForFeature(ae,pe,ke),it=V?dt/ft:dt*ft,Ke=zr(new x.pointGeometry(Je[0],Je[1]),z,Je[2]);if(Ke.signedDistanceFromCamera<=0){gn(ke.numGlyphs,xe);continue}let ut={};const st=V?null:K,Yt=La(ke,it,!1,Z,y,z,O,C.glyphOffsetArray,Te,xe,Ke.point,Ce,ut,we,st,ie.projection,Q);De=Yt.useVertical,st&&Yt.needsFlipping&&(ut={}),(Yt.notEnoughRoom||De||Yt.needsFlipping&&La(ke,it,!0,Z,y,z,O,C.glyphOffsetArray,Te,xe,Ke.point,Ce,ut,we,st,ie.projection,Q).notEnoughRoom)&&gn(ke.numGlyphs,xe)}D?C.text.dynamicLayoutVertexBuffer.updateData(xe):C.icon.dynamicLayoutVertexBuffer.updateData(xe)}function Ba(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe){const Te=Z.glyphStartIndex+Z.numGlyphs,Fe=Z.lineStartIndex,we=Z.lineStartIndex+Z.lineLength,De=y.getoffsetX(Z.glyphStartIndex),Be=y.getoffsetX(Te-1),ke=Wo(C*De,S,D,z,O,V,Z.segment,Fe,we,K,Q,ie,ae,pe,!0,Ee,xe);if(!ke)return null;const Ce=Wo(C*Be,S,D,z,O,V,Z.segment,Fe,we,K,Q,ie,ae,pe,!0,Ee,xe);return Ce?{first:ke,last:Ce}:null}function Ho(C,y,S,D){return C.writingMode===x.WritingMode.horizontal&&Math.abs(S.y-y.y)>Math.abs(S.x-y.x)*D?{useVertical:!0}:C.writingMode===x.WritingMode.vertical?y.y<S.y?{needsFlipping:!0}:null:C.flipState!==0&&function(z,O,V){const Z=(O.x-z.x)*V;return Z===0||Math.abs((O.y-z.y)/Z)>Hi}(y,S,D)?C.flipState===1?{needsFlipping:!0}:null:y.x>S.x?{needsFlipping:!0}:null}function La(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe,Te,Fe){const we=y/24,De=C.lineOffsetX*we,Be=C.lineOffsetY*we;let ke;if(C.numGlyphs>1){const Ce=C.glyphStartIndex+C.numGlyphs,Oe=C.lineStartIndex,He=C.lineStartIndex+C.lineLength,Je=Ba(we,Z,De,Be,S,ie,ae,C,K,O,pe,xe,!1,Te,Fe);if(!Je)return{notEnoughRoom:!0};const xt=zr(Je.first.point,V).point,ft=zr(Je.last.point,V).point;if(D&&!S){const dt=Ho(C,xt,ft,Ee);if(C.flipState=dt&&dt.needsFlipping?1:2,dt)return dt}ke=[Je.first];for(let dt=C.glyphStartIndex+1;dt<Ce-1;dt++)ke.push(Wo(we*Z.getoffsetX(dt),De,Be,S,ie,ae,C.segment,Oe,He,K,O,pe,xe,!1,!1,Te,Fe));ke.push(Je.last)}else{if(D&&!S){const Oe=zr(ae,z).point,He=C.lineStartIndex+C.segment+1,Je=new x.pointGeometry(K.getx(He),K.gety(He)),xt=zr(Je,z),ft=Ho(C,Oe,xt.signedDistanceFromCamera>0?xt.point:Bs(ae,Je,Oe,1,z,void 0,Te,Fe.canonical),Ee);if(C.flipState=ft&&ft.needsFlipping?1:2,ft)return ft}const Ce=Wo(we*Z.getoffsetX(C.glyphStartIndex),De,Be,S,ie,ae,C.segment,C.lineStartIndex,C.lineStartIndex+C.lineLength,K,O,pe,xe,!1,!1,Te,Fe);if(!Ce)return{notEnoughRoom:!0};ke=[Ce]}for(const Ce of ke)x.addDynamicAttributes(Q,Ce.point,Ce.angle);return{}}function Rs(C,y,S,D,z){const O=D.projectTilePoint(C.x,C.y,y);if(!z)return zr(O,S,O.z);const V=z(C);return zr(new x.pointGeometry(O.x+V[0],O.y+V[1]),S,O.z+V[2])}function Bs(C,y,S,D,z,O,V,Z){const K=Rs(C.add(C.sub(y)._unit()),Z,z,V,O).point,Q=S.sub(K);return S.add(Q._mult(D/Q.mag()))}function Wo(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe,Te,Fe){const we=D?C-y:C+y;let De=we>0?1:-1,Be=0;D&&(De*=-1,Be=Math.PI),De<0&&(Be+=Math.PI);let ke=De>0?Z+V:Z+V+1,Ce=z,Oe=z,He=0,Je=0;const xt=Math.abs(we),ft=[],dt=[];let it=O;const Ke=()=>{const yt=ke-De;return He===0?O:new x.pointGeometry(Q.getx(yt),Q.gety(yt))},ut=()=>Bs(Ke(),it,Oe,xt-He+1,ie,pe,Te,Fe.canonical);for(;He+Je<=xt;){if(ke+=De,ke<Z||ke>=K)return null;if(Oe=Ce,ft.push(Ce),Ee&&dt.push(it||Ke()),Ce=ae[ke],Ce===void 0){it=new x.pointGeometry(Q.getx(ke),Q.gety(ke));const yt=Rs(it,Fe.canonical,ie,Te,pe);Ce=yt.signedDistanceFromCamera>0?ae[ke]=yt.point:ut()}else it=null;He+=Je,Je=Oe.dist(Ce)}xe&&pe&&(it=it||new x.pointGeometry(Q.getx(ke),Q.gety(ke)),ae[ke]=Ce=ae[ke]===void 0?Ce:ut(),Je=Oe.dist(Ce));const st=(xt-He)/Je,Yt=Ce.sub(Oe),ii=Yt.mult(st)._add(Oe);S&&ii._add(Yt._unit()._perp()._mult(S*De));const bi=Be+Math.atan2(Ce.y-Oe.y,Ce.x-Oe.x);return ft.push(ii),Ee&&(it=it||new x.pointGeometry(Q.getx(ke),Q.gety(ke)),dt.push(function(yt,Jt,ui){const Zi=1-ui;return new x.pointGeometry(yt.x*Zi+Jt.x*ui,yt.y*Zi+Jt.y*ui)}(dt.length>0?dt[dt.length-1]:it,it,st))),{point:ii,angle:bi,path:ft,tilePath:dt}}const za=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gn(C,y){for(let S=0;S<C;S++){const D=y.length;y.resize(D+4),y.float32.set(za,3*D)}}function Ko(C,y,S){const D=y[0],z=y[1];return C[0]=S[0]*D+S[4]*z+S[12],C[1]=S[1]*D+S[5]*z+S[13],C[3]=S[3]*D+S[7]*z+S[15],C}const Mn=100;class ic{constructor(y,S,D=new qi(y.width+200,y.height+200,25),z=new qi(y.width+200,y.height+200,25)){this.transform=y,this.grid=D,this.ignoredGrid=z,this.pitchfactor=Math.cos(y._pitch)*y.cameraToCenterDistance,this.screenRightBoundary=y.width+Mn,this.screenBottomBoundary=y.height+Mn,this.gridRightBoundary=y.width+200,this.gridBottomBoundary=y.height+200,this.fogState=S}placeCollisionBox(y,S,D,z,O,V,Z){let K=S.projectedAnchorX,Q=S.projectedAnchorY,ie=S.projectedAnchorZ;const ae=S.elevation,pe=S.tileID;if(ae&&pe){const ke=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),Ce=ke.upVector(pe.canonical,S.tileAnchorX,S.tileAnchorY),Oe=ke.upVectorScale(pe.canonical);K+=Ce[0]*ae*Oe,Q+=Ce[1]*ae*Oe,ie+=Ce[2]*ae*Oe}const Ee=this.projectAndGetPerspectiveRatio(V,K,Q,ie,S.tileID),xe=O*Ee.perspectiveRatio,Te=(S.x1*y+D.x-S.padding)*xe+Ee.point.x,Fe=(S.y1*y+D.y-S.padding)*xe+Ee.point.y,we=(S.x2*y+D.x+S.padding)*xe+Ee.point.x,De=(S.y2*y+D.y+S.padding)*xe+Ee.point.y,Be=Ee.perspectiveRatio<=.55||Ee.aboveHorizon;return!this.isInsideGrid(Te,Fe,we,De)||!z&&this.grid.hitTest(Te,Fe,we,De,Z)||Be?{box:[],offscreen:!1}:{box:[Te,Fe,we,De],offscreen:this.isOffscreen(Te,Fe,we,De)}}placeCollisionCircles(y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe){const Te=[],Fe=this.transform.elevation,we=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),De=Fe?Fe.getAtTileOffsetFunc(xe,we):st=>[0,0,0],Be=new x.pointGeometry(S.tileAnchorX,S.tileAnchorY),ke=this.transform.projection.projectTilePoint(S.tileAnchorX,S.tileAnchorY,xe.canonical),Ce=De(Be),Oe=[ke.x+Ce[0],ke.y+Ce[1],ke.z+Ce[2]],He=this.projectAndGetPerspectiveRatio(V,Oe[0],Oe[1],Oe[2],xe),{perspectiveRatio:Je}=He,xt=(ie?O/Je:O*Je)/x.ONE_EM,ft=zr(new x.pointGeometry(Oe[0],Oe[1]),Z,Oe[2]).point,dt=He.signedDistanceFromCamera>0?Ba(xt,z,S.lineOffsetX*xt,S.lineOffsetY*xt,!1,ft,Be,S,D,Z,{},Fe&&!ie?De:null,ie&&!!Fe,this.transform.projection,xe):null;let it=!1,Ke=!1,ut=!0;if(dt&&!He.aboveHorizon){const st=.5*pe*Je+Ee,Yt=new x.pointGeometry(-100,-100),ii=new x.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),bi=new Ji,yt=dt.first,Jt=dt.last;let ui=[];for(let ai=yt.path.length-1;ai>=1;ai--)ui.push(yt.path[ai]);for(let ai=1;ai<Jt.path.length;ai++)ui.push(Jt.path[ai]);const Zi=2.5*st;if(K){const ai=ui.map(Fe?(Mi,rr)=>{const wr=De(rr<yt.path.length-1?yt.tilePath[yt.path.length-1-rr]:Jt.tilePath[rr-yt.path.length+2]);return zr(Mi,K,wr[2])}:Mi=>zr(Mi,K));ui=ai.some(Mi=>Mi.signedDistanceFromCamera<=0)?[]:ai.map(Mi=>Mi.point)}let Qi=[];if(ui.length>0){const ai=ui[0].clone(),Mi=ui[0].clone();for(let rr=1;rr<ui.length;rr++)ai.x=Math.min(ai.x,ui[rr].x),ai.y=Math.min(ai.y,ui[rr].y),Mi.x=Math.max(Mi.x,ui[rr].x),Mi.y=Math.max(Mi.y,ui[rr].y);Qi=ai.x>=Yt.x&&Mi.x<=ii.x&&ai.y>=Yt.y&&Mi.y<=ii.y?[ui]:Mi.x<Yt.x||ai.x>ii.x||Mi.y<Yt.y||ai.y>ii.y?[]:x.clipLine([ui],Yt.x,Yt.y,ii.x,ii.y)}for(const ai of Qi){bi.reset(ai,.25*st);let Mi=0;Mi=bi.length<=.5*st?1:Math.ceil(bi.paddedLength/Zi)+1;for(let rr=0;rr<Mi;rr++){const wr=rr/Math.max(Mi-1,1),Hr=bi.lerp(wr),un=Hr.x+Mn,vn=Hr.y+Mn;Te.push(un,vn,st,0);const Li=un-st,di=vn-st,Ci=un+st,hr=vn+st;if(ut=ut&&this.isOffscreen(Li,di,Ci,hr),Ke=Ke||this.isInsideGrid(Li,di,Ci,hr),!y&&this.grid.hitTestCircle(un,vn,st,ae)&&(it=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:it}}}}return{circles:!Q&&it||!Ke?[]:Te,offscreen:ut,collisionDetected:it}}queryRenderedSymbols(y){if(y.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const S=[];let D=1/0,z=1/0,O=-1/0,V=-1/0;for(const ie of y){const ae=new x.pointGeometry(ie.x+Mn,ie.y+Mn);D=Math.min(D,ae.x),z=Math.min(z,ae.y),O=Math.max(O,ae.x),V=Math.max(V,ae.y),S.push(ae)}const Z=this.grid.query(D,z,O,V).concat(this.ignoredGrid.query(D,z,O,V)),K={},Q={};for(const ie of Z){const ae=ie.key;if(K[ae.bucketInstanceId]===void 0&&(K[ae.bucketInstanceId]={}),K[ae.bucketInstanceId][ae.featureIndex])continue;const pe=[new x.pointGeometry(ie.x1,ie.y1),new x.pointGeometry(ie.x2,ie.y1),new x.pointGeometry(ie.x2,ie.y2),new x.pointGeometry(ie.x1,ie.y2)];x.polygonIntersectsPolygon(S,pe)&&(K[ae.bucketInstanceId][ae.featureIndex]=!0,Q[ae.bucketInstanceId]===void 0&&(Q[ae.bucketInstanceId]=[]),Q[ae.bucketInstanceId].push(ae.featureIndex))}return Q}insertCollisionBox(y,S,D,z,O){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:D,featureIndex:z,collisionGroupID:O},y[0],y[1],y[2],y[3])}insertCollisionCircles(y,S,D,z,O){const V=S?this.ignoredGrid:this.grid,Z={bucketInstanceId:D,featureIndex:z,collisionGroupID:O};for(let K=0;K<y.length;K+=4)V.insertCircle(Z,y[K],y[K+1],y[K+2])}projectAndGetPerspectiveRatio(y,S,D,z,O){const V=[S,D,z||0,1];let Z=!1;if(z||this.transform.pitch>0){x.transformMat4$1(V,V,y);let K=!1;this.fogState&&O&&(K=function(Q,ie,ae,pe,Ee,xe){const Te=xe.calculateFogTileMatrix(Ee),Fe=[ie,ae,pe];return x.transformMat4(Fe,Fe,Te),ye(Q,Fe,xe.pitch,xe._fov)}(this.fogState,S,D,z||0,O.toUnwrapped(),this.transform)>.9),Z=V[2]>V[3]||K}else Ko(V,V,y);return{point:new x.pointGeometry((V[0]/V[3]+1)/2*this.transform.width+Mn,(-V[1]/V[3]+1)/2*this.transform.height+Mn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/V[3]*.5,1.5),signedDistanceFromCamera:V[3],aboveHorizon:Z}}isOffscreen(y,S,D,z){return D<Mn||y>=this.screenRightBoundary||z<Mn||S>this.screenBottomBoundary}isInsideGrid(y,S,D,z){return D>=0&&y<this.gridRightBoundary&&z>=0&&S<this.gridBottomBoundary}getViewportMatrix(){const y=x.identity([]);return x.translate(y,y,[-100,-100,0]),y}}class Bl{constructor(y,S,D,z){this.opacity=y?Math.max(0,Math.min(1,y.opacity+(y.placed?S:-S))):z&&D?1:0,this.placed=D}isHidden(){return this.opacity===0&&!this.placed}}class wo{constructor(y,S,D,z,O,V=!1){this.text=new Bl(y?y.text:null,S,D,O),this.icon=new Bl(y?y.icon:null,S,z,O),this.clipped=V}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Eo{constructor(y,S,D,z=!1){this.text=y,this.icon=S,this.skipFade=D,this.clipped=z}}class Jo{constructor(){this.invProjMatrix=x.create(),this.viewportMatrix=x.create(),this.circles=[]}}class Ll{constructor(y,S,D,z,O){this.bucketInstanceId=y,this.featureIndex=S,this.sourceLayerIndex=D,this.bucketIndex=z,this.tileID=O}}class zl{constructor(y){this.crossSourceCollisions=y,this.maxGroupID=0,this.collisionGroups={}}get(y){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[y]){const S=++this.maxGroupID;this.collisionGroups[y]={ID:S,predicate:D=>D.collisionGroupID===S}}return this.collisionGroups[y]}}function Ls(C,y,S,D,z){const{horizontalAlign:O,verticalAlign:V}=x.getAnchorAlignment(C),Z=-(O-.5)*y,K=-(V-.5)*S,Q=x.evaluateVariableOffset(C,D);return new x.pointGeometry(Z+Q[0]*z,K+Q[1]*z)}function qn(C,y,S,D,z){const O=new x.pointGeometry(C,y);return S&&O._rotate(D?z:-z),O}class zs{constructor(y,S,D,z,O){this.transform=y.clone(),this.collisionIndex=new ic(this.transform,O),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new zl(D),this.collisionCircleArrays={},this.prevPlacement=z,z&&(z.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(y,S,D,z){const O=D.getBucket(S),V=D.latestFeatureIndex;if(!O||!V||S.id!==O.layerIds[0])return;const Z=O.layers[0].layout,K=D.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-D.tileID.overscaledZ),ie=D.tileSize/x.EXTENT,ae=D.tileID.toUnwrapped(),pe=this.transform.calculateProjMatrix(ae),Ee=Z.get("text-pitch-alignment")==="map",xe=Z.get("text-rotation-alignment")==="map";S.compileFilter();const Te=S.dynamicFilter(),Fe=S.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(D),De=Gn(pe,D.tileID.canonical,Ee,xe,this.transform,we);let Be=null;if(Ee){const Oe=Rn(pe,D.tileID.canonical,Ee,xe,this.transform,we);Be=x.multiply$1([],this.transform.labelPlaneMatrix,Oe)}let ke=null;Te&&D.latestFeatureIndex&&(ke={unwrappedTileID:ae,dynamicFilter:Te,dynamicFilterNeedsFeature:Fe,featureIndex:D.latestFeatureIndex}),this.retainedQueryData[O.bucketInstanceId]=new Ll(O.bucketInstanceId,V,O.sourceLayerIndex,O.index,D.tileID);const Ce={bucket:O,layout:Z,posMatrix:pe,textLabelPlaneMatrix:De,labelToScreenMatrix:Be,clippingData:ke,scale:Q,textPixelRatio:ie,holdingForFade:D.holdingForFade(),collisionBoxArray:K,partiallyEvaluatedTextSize:x.evaluateSizeForZoom(O.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:x.evaluateSizeForZoom(O.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(O.sourceID)};if(z)for(const Oe of O.sortKeyRanges){const{sortKey:He,symbolInstanceStart:Je,symbolInstanceEnd:xt}=Oe;y.push({sortKey:He,symbolInstanceStart:Je,symbolInstanceEnd:xt,parameters:Ce})}else y.push({symbolInstanceStart:0,symbolInstanceEnd:O.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe,Te,Fe,we,De){const Be=[pe.textOffset0,pe.textOffset1],ke=Ls(y,D,z,Be,O),Ce=this.collisionIndex.placeCollisionBox(O,S,qn(ke.x,ke.y,V,Z,this.transform.angle),ae,K,Q,ie.predicate);if((!Fe||this.collisionIndex.placeCollisionBox(xe.getSymbolInstanceIconSize(De,this.transform.zoom,Ee),Fe,qn(ke.x,ke.y,V,Z,this.transform.angle),ae,K,Q,ie.predicate).box.length!==0)&&Ce.box.length>0){let Oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),this.variableOffsets[pe.crossTileID]={textOffset:Be,width:D,height:z,anchor:y,textScale:O,prevAnchor:Oe},this.markUsedJustification(xe,y,pe,Te),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,Te,pe),this.placedOrientations[pe.crossTileID]=Te),{shift:ke,placedGlyphBoxes:Ce}}}placeLayerBucketPart(y,S,D,z){const{bucket:O,layout:V,posMatrix:Z,textLabelPlaneMatrix:K,labelToScreenMatrix:Q,clippingData:ie,textPixelRatio:ae,holdingForFade:pe,collisionBoxArray:Ee,partiallyEvaluatedTextSize:xe,partiallyEvaluatedIconSize:Te,collisionGroup:Fe}=y.parameters,we=V.get("text-optional"),De=V.get("icon-optional"),Be=V.get("text-allow-overlap"),ke=V.get("icon-allow-overlap"),Ce=V.get("text-rotation-alignment")==="map",Oe=V.get("text-pitch-alignment")==="map",He=V.get("icon-text-fit")!=="none",Je=V.get("symbol-z-order")==="viewport-y",xt=Be&&(ke||!O.hasIconData()||De),ft=ke&&(Be||!O.hasTextData()||we);!O.collisionArrays&&Ee&&O.deserializeCollisionBoxes(Ee),D&&z&&O.updateCollisionDebugBuffers(this.transform.zoom,Ee);const dt=(it,Ke,ut)=>{if(ie){const Li={zoom:this.transform.zoom,pitch:this.transform.pitch};let di=null;if(ie.dynamicFilterNeedsFeature){const Ci=this.retainedQueryData[O.bucketInstanceId];di=ie.featureIndex.loadFeature({featureIndex:it.featureIndex,bucketIndex:Ci.bucketIndex,sourceLayerIndex:Ci.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ie.dynamicFilter)(Li,di,this.retainedQueryData[O.bucketInstanceId].tileID.canonical,new x.pointGeometry(it.tileAnchorX,it.tileAnchorY),this.transform.calculateDistanceTileData(ie.unwrappedTileID)))return this.placements[it.crossTileID]=new Eo(!1,!1,!1,!0),void(S[it.crossTileID]=!0)}if(S[it.crossTileID])return;if(pe)return void(this.placements[it.crossTileID]=new Eo(!1,!1,!1));let st=!1,Yt=!1,ii=!0,bi=null,yt={box:null,offscreen:null},Jt={box:null,offscreen:null},ui=null,Zi=null,Qi=null,ai=0,Mi=0,rr=0;ut.textFeatureIndex?ai=ut.textFeatureIndex:it.useRuntimeCollisionCircles&&(ai=it.featureIndex),ut.verticalTextFeatureIndex&&(Mi=ut.verticalTextFeatureIndex);const wr=Li=>{Li.tileID=this.retainedQueryData[O.bucketInstanceId].tileID,(this.transform.elevation||Li.elevation)&&(Li.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[O.bucketInstanceId].tileID,Li.tileAnchorX,Li.tileAnchorY):0)},Hr=ut.textBox;if(Hr){wr(Hr);const Li=Ci=>{let hr=x.WritingMode.horizontal;if(O.allowVerticalPlacement&&!Ci&&this.prevPlacement){const en=this.prevPlacement.placedOrientations[it.crossTileID];en&&(this.placedOrientations[it.crossTileID]=en,hr=en,this.markUsedOrientation(O,hr,it))}return hr},di=(Ci,hr)=>{if(O.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const en of O.writingModes)if(en===x.WritingMode.vertical?(yt=hr(),Jt=yt):yt=Ci(),yt&&yt.box&&yt.box.length)break}else yt=Ci()};if(V.get("text-variable-anchor")){let Ci=V.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[it.crossTileID]){const ir=this.prevPlacement.variableOffsets[it.crossTileID];Ci.indexOf(ir.anchor)>0&&(Ci=Ci.filter(tn=>tn!==ir.anchor),Ci.unshift(ir.anchor))}const hr=(ir,tn,Es)=>{const Wr=O.getSymbolInstanceTextSize(xe,it,this.transform.zoom,Ke),fo=(ir.x2-ir.x1)*Wr+2*ir.padding,$t=(ir.y2-ir.y1)*Wr+2*ir.padding,Qt=He&&!ke?tn:null;Qt&&wr(Qt);let kr={box:[],offscreen:!1};const po=Be?2*Ci.length:Ci.length;for(let io=0;io<po;++io){const Or=this.attemptAnchorPlacement(Ci[io%Ci.length],ir,fo,$t,Wr,Ce,Oe,ae,Z,Fe,io>=Ci.length,it,Ke,O,Es,Qt,xe,Te);if(Or&&(kr=Or.placedGlyphBoxes,kr&&kr.box&&kr.box.length)){st=!0,bi=Or.shift;break}}return kr};di(()=>hr(Hr,ut.iconBox,x.WritingMode.horizontal),()=>{const ir=ut.verticalTextBox;return ir&&wr(ir),O.allowVerticalPlacement&&!(yt&&yt.box&&yt.box.length)&&it.numVerticalGlyphVertices>0&&ir?hr(ir,ut.verticalIconBox,x.WritingMode.vertical):{box:null,offscreen:null}}),yt&&(st=yt.box,ii=yt.offscreen);const en=Li(yt&&yt.box);if(!st&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[it.crossTileID];ir&&(this.variableOffsets[it.crossTileID]=ir,this.markUsedJustification(O,ir.anchor,it,en))}}else{const Ci=(hr,en)=>{const ir=O.getSymbolInstanceTextSize(xe,it,this.transform.zoom,Ke),tn=this.collisionIndex.placeCollisionBox(ir,hr,new x.pointGeometry(0,0),Be,ae,Z,Fe.predicate);return tn&&tn.box&&tn.box.length&&(this.markUsedOrientation(O,en,it),this.placedOrientations[it.crossTileID]=en),tn};di(()=>Ci(Hr,x.WritingMode.horizontal),()=>{const hr=ut.verticalTextBox;return O.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&hr?(wr(hr),Ci(hr,x.WritingMode.vertical)):{box:null,offscreen:null}}),Li(yt&&yt.box&&yt.box.length)}}if(ui=yt,st=ui&&ui.box&&ui.box.length>0,ii=ui&&ui.offscreen,it.useRuntimeCollisionCircles){const Li=O.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex>=0?it.centerJustifiedTextSymbolIndex:it.verticalPlacedTextSymbolIndex),di=x.evaluateSizeForFeature(O.textSizeData,xe,Li),Ci=V.get("text-padding");Zi=this.collisionIndex.placeCollisionCircles(Be,Li,O.lineVertexArray,O.glyphOffsetArray,di,Z,K,Q,D,Oe,Fe.predicate,it.collisionCircleDiameter*di/x.ONE_EM,Ci,this.retainedQueryData[O.bucketInstanceId].tileID),st=Be||Zi.circles.length>0&&!Zi.collisionDetected,ii=ii&&Zi.offscreen}if(ut.iconFeatureIndex&&(rr=ut.iconFeatureIndex),ut.iconBox){const Li=di=>{wr(di);const Ci=He&&bi?qn(bi.x,bi.y,Ce,Oe,this.transform.angle):new x.pointGeometry(0,0),hr=O.getSymbolInstanceIconSize(Te,this.transform.zoom,Ke);return this.collisionIndex.placeCollisionBox(hr,di,Ci,ke,ae,Z,Fe.predicate)};Jt&&Jt.box&&Jt.box.length&&ut.verticalIconBox?(Qi=Li(ut.verticalIconBox),Yt=Qi.box.length>0):(Qi=Li(ut.iconBox),Yt=Qi.box.length>0),ii=ii&&Qi.offscreen}const un=we||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,vn=De||it.numIconVertices===0;if(un||vn?vn?un||(Yt=Yt&&st):st=Yt&&st:Yt=st=Yt&&st,st&&ui&&ui.box&&this.collisionIndex.insertCollisionBox(ui.box,V.get("text-ignore-placement"),O.bucketInstanceId,Jt&&Jt.box&&Mi?Mi:ai,Fe.ID),Yt&&Qi&&this.collisionIndex.insertCollisionBox(Qi.box,V.get("icon-ignore-placement"),O.bucketInstanceId,rr,Fe.ID),Zi&&(st&&this.collisionIndex.insertCollisionCircles(Zi.circles,V.get("text-ignore-placement"),O.bucketInstanceId,ai,Fe.ID),D)){const Li=O.bucketInstanceId;let di=this.collisionCircleArrays[Li];di===void 0&&(di=this.collisionCircleArrays[Li]=new Jo);for(let Ci=0;Ci<Zi.circles.length;Ci+=4)di.circles.push(Zi.circles[Ci+0]),di.circles.push(Zi.circles[Ci+1]),di.circles.push(Zi.circles[Ci+2]),di.circles.push(Zi.collisionDetected?1:0)}this.placements[it.crossTileID]=new Eo(st||xt,Yt||ft,ii||O.justReloaded),S[it.crossTileID]=!0};if(Je){const it=O.getSortedSymbolIndexes(this.transform.angle);for(let Ke=it.length-1;Ke>=0;--Ke){const ut=it[Ke];dt(O.symbolInstances.get(ut),ut,O.collisionArrays[ut])}}else for(let it=y.symbolInstanceStart;it<y.symbolInstanceEnd;it++)dt(O.symbolInstances.get(it),it,O.collisionArrays[it]);if(D&&O.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[O.bucketInstanceId];x.invert(it.invProjMatrix,Z),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(y,S,D,z){let O;O=z===x.WritingMode.vertical?D.verticalPlacedTextSymbolIndex:{left:D.leftJustifiedTextSymbolIndex,center:D.centerJustifiedTextSymbolIndex,right:D.rightJustifiedTextSymbolIndex}[x.getAnchorJustification(S)];const V=[D.leftJustifiedTextSymbolIndex,D.centerJustifiedTextSymbolIndex,D.rightJustifiedTextSymbolIndex,D.verticalPlacedTextSymbolIndex];for(const Z of V)Z>=0&&(y.text.placedSymbolArray.get(Z).crossTileID=O>=0&&Z!==O?0:D.crossTileID)}markUsedOrientation(y,S,D){const z=S===x.WritingMode.horizontal||S===x.WritingMode.horizontalOnly?S:0,O=S===x.WritingMode.vertical?S:0,V=[D.leftJustifiedTextSymbolIndex,D.centerJustifiedTextSymbolIndex,D.rightJustifiedTextSymbolIndex];for(const Z of V)y.text.placedSymbolArray.get(Z).placedOrientation=z;D.verticalPlacedTextSymbolIndex&&(y.text.placedSymbolArray.get(D.verticalPlacedTextSymbolIndex).placedOrientation=O)}commit(y){this.commitTime=y,this.zoomAtLastRecencyCheck=this.transform.zoom;const S=this.prevPlacement;let D=!1;this.prevZoomAdjustment=S?S.zoomAdjustment(this.transform.zoom):0;const z=S?S.symbolFadeChange(y):1,O=S?S.opacities:{},V=S?S.variableOffsets:{},Z=S?S.placedOrientations:{};for(const K in this.placements){const Q=this.placements[K],ie=O[K];ie?(this.opacities[K]=new wo(ie,z,Q.text,Q.icon,null,Q.clipped),D=D||Q.text!==ie.text.placed||Q.icon!==ie.icon.placed):(this.opacities[K]=new wo(null,z,Q.text,Q.icon,Q.skipFade,Q.clipped),D=D||Q.text||Q.icon)}for(const K in O){const Q=O[K];if(!this.opacities[K]){const ie=new wo(Q,z,!1,!1);ie.isHidden()||(this.opacities[K]=ie,D=D||Q.text.placed||Q.icon.placed)}}for(const K in V)this.variableOffsets[K]||!this.opacities[K]||this.opacities[K].isHidden()||(this.variableOffsets[K]=V[K]);for(const K in Z)this.placedOrientations[K]||!this.opacities[K]||this.opacities[K].isHidden()||(this.placedOrientations[K]=Z[K]);D?this.lastPlacementChangeTime=y:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=S?S.lastPlacementChangeTime:y)}updateLayerOpacities(y,S){const D={};for(const z of S){const O=z.getBucket(y);O&&z.latestFeatureIndex&&y.id===O.layerIds[0]&&this.updateBucketOpacities(O,D,z.collisionBoxArray)}}updateBucketOpacities(y,S,D){y.hasTextData()&&y.text.opacityVertexArray.clear(),y.hasIconData()&&y.icon.opacityVertexArray.clear(),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexArray.clear(),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexArray.clear();const z=y.layers[0].layout,O=!!y.layers[0].dynamicFilter(),V=new wo(null,0,!1,!1,!0),Z=z.get("text-allow-overlap"),K=z.get("icon-allow-overlap"),Q=z.get("text-variable-anchor"),ie=z.get("text-rotation-alignment")==="map",ae=z.get("text-pitch-alignment")==="map",pe=z.get("icon-text-fit")!=="none",Ee=new wo(null,0,Z&&(K||!y.hasIconData()||z.get("icon-optional")),K&&(Z||!y.hasTextData()||z.get("text-optional")),!0);!y.collisionArrays&&D&&(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData())&&y.deserializeCollisionBoxes(D);const xe=(Fe,we,De)=>{for(let Be=0;Be<we/4;Be++)Fe.opacityVertexArray.emplaceBack(De)};let Te=0;for(let Fe=0;Fe<y.symbolInstances.length;Fe++){const we=y.symbolInstances.get(Fe),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:Be,crossTileID:ke}=we;let Ce=this.opacities[ke];S[ke]?Ce=V:Ce||(Ce=Ee,this.opacities[ke]=Ce),S[ke]=!0;const Oe=De>0||Be>0,He=we.numIconVertices>0,Je=this.placedOrientations[we.crossTileID],xt=Je===x.WritingMode.vertical,ft=Je===x.WritingMode.horizontal||Je===x.WritingMode.horizontalOnly;if(!Oe&&!He||Ce.isHidden()||Te++,Oe){const dt=Fs(Ce.text);xe(y.text,De,xt?Yn:dt),xe(y.text,Be,ft?Yn:dt);const it=Ce.text.isHidden();[we.rightJustifiedTextSymbolIndex,we.centerJustifiedTextSymbolIndex,we.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(y.text.placedSymbolArray.get(st).hidden=it||xt?1:0)}),we.verticalPlacedTextSymbolIndex>=0&&(y.text.placedSymbolArray.get(we.verticalPlacedTextSymbolIndex).hidden=it||ft?1:0);const Ke=this.variableOffsets[we.crossTileID];Ke&&this.markUsedJustification(y,Ke.anchor,we,Je);const ut=this.placedOrientations[we.crossTileID];ut&&(this.markUsedJustification(y,"left",we,ut),this.markUsedOrientation(y,ut,we))}if(He){const dt=Fs(Ce.icon);we.placedIconSymbolIndex>=0&&(xe(y.icon,we.numIconVertices,xt?Yn:dt),y.icon.placedSymbolArray.get(we.placedIconSymbolIndex).hidden=Ce.icon.isHidden()),we.verticalPlacedIconSymbolIndex>=0&&(xe(y.icon,we.numVerticalIconVertices,ft?Yn:dt),y.icon.placedSymbolArray.get(we.verticalPlacedIconSymbolIndex).hidden=Ce.icon.isHidden())}if(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData()){const dt=y.collisionArrays[Fe];if(dt){let it=new x.pointGeometry(0,0),Ke=!0;if(dt.textBox||dt.verticalTextBox){if(Q){const st=this.variableOffsets[ke];st?(it=Ls(st.anchor,st.width,st.height,st.textOffset,st.textScale),ie&&it._rotate(ae?this.transform.angle:-this.transform.angle)):Ke=!1}O&&(Ke=!Ce.clipped),dt.textBox&&Zn(y.textCollisionBox.collisionVertexArray,Ce.text.placed,!Ke||xt,it.x,it.y),dt.verticalTextBox&&Zn(y.textCollisionBox.collisionVertexArray,Ce.text.placed,!Ke||ft,it.x,it.y)}const ut=Ke&&Boolean(!ft&&dt.verticalIconBox);dt.iconBox&&Zn(y.iconCollisionBox.collisionVertexArray,Ce.icon.placed,ut,pe?it.x:0,pe?it.y:0),dt.verticalIconBox&&Zn(y.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!ut,pe?it.x:0,pe?it.y:0)}}}if(y.fullyClipped=Te===0,y.sortFeatures(this.transform.angle),this.retainedQueryData[y.bucketInstanceId]&&(this.retainedQueryData[y.bucketInstanceId].featureSortOrder=y.featureSortOrder),y.hasTextData()&&y.text.opacityVertexBuffer&&y.text.opacityVertexBuffer.updateData(y.text.opacityVertexArray),y.hasIconData()&&y.icon.opacityVertexBuffer&&y.icon.opacityVertexBuffer.updateData(y.icon.opacityVertexArray),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexBuffer&&y.iconCollisionBox.collisionVertexBuffer.updateData(y.iconCollisionBox.collisionVertexArray),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexBuffer&&y.textCollisionBox.collisionVertexBuffer.updateData(y.textCollisionBox.collisionVertexArray),y.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[y.bucketInstanceId];y.placementInvProjMatrix=Fe.invProjMatrix,y.placementViewportMatrix=Fe.viewportMatrix,y.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[y.bucketInstanceId]}}symbolFadeChange(y){return this.fadeDuration===0?1:(y-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(y){return Math.max(0,(this.transform.zoom-y)/1.5)}hasTransitions(y){return this.stale||y-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(y,S){const D=this.zoomAtLastRecencyCheck===S?1-this.zoomAdjustment(S):1;return this.zoomAtLastRecencyCheck=S,this.commitTime+this.fadeDuration*D>y}setStale(){this.stale=!0}}function Zn(C,y,S,D,z){C.emplaceBack(y?1:0,S?1:0,D||0,z||0),C.emplaceBack(y?1:0,S?1:0,D||0,z||0),C.emplaceBack(y?1:0,S?1:0,D||0,z||0),C.emplaceBack(y?1:0,S?1:0,D||0,z||0)}const tt=Math.pow(2,25),Pt=Math.pow(2,24),Fl=Math.pow(2,17),Xn=Math.pow(2,16),ur=Math.pow(2,9),Bn=Math.pow(2,8),Sn=Math.pow(2,1);function Fs(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const y=C.placed?1:0,S=Math.floor(127*C.opacity);return S*tt+y*Pt+S*Fl+y*Xn+S*ur+y*Bn+S*Sn+y}const Yn=0;class Dt{constructor(y){this._sortAcrossTiles=y.layout.get("symbol-z-order")!=="viewport-y"&&y.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(y,S,D,z,O){const V=this._bucketParts;for(;this._currentTileIndex<y.length;)if(S.getBucketParts(V,z,y[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,O())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,V.sort((Z,K)=>Z.sortKey-K.sortKey));this._currentPartIndex<V.length;){const Z=V[this._currentPartIndex];if(S.placeLayerBucketPart(Z,this._seenCrossTileIDs,D,Z.symbolInstanceStart===0),this._currentPartIndex++,O())return!0}return!1}}class ki{constructor(y,S,D,z,O,V,Z,K){this.placement=new zs(y,O,V,Z,K),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=D,this._showCollisionBoxes=z,this._done=!1}isDone(){return this._done}continuePlacement(y,S,D){const z=x.exported.now(),O=()=>{const V=x.exported.now()-z;return!this._forceFullPlacement&&V>2};for(;this._currentPlacementIndex>=0;){const V=S[y[this._currentPlacementIndex]],Z=this.placement.collisionIndex.transform.zoom;if(V.type==="symbol"&&(!V.minzoom||V.minzoom<=Z)&&(!V.maxzoom||V.maxzoom>Z)){if(this._inProgressLayer||(this._inProgressLayer=new Dt(V)),this._inProgressLayer.continuePlacement(D[V.source],this.placement,this._showCollisionBoxes,V,O))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(y){return this.placement.commit(y),this.placement}}const wi=512/x.EXTENT/2;class An{constructor(y,S,D){this.tileID=y,this.indexedSymbolInstances={},this.bucketInstanceId=D;for(let z=0;z<S.length;z++){const O=S.get(z),V=O.key;this.indexedSymbolInstances[V]||(this.indexedSymbolInstances[V]=[]),this.indexedSymbolInstances[V].push({crossTileID:O.crossTileID,coord:this.getScaledCoordinates(O,y)})}}getScaledCoordinates(y,S){const D=wi/Math.pow(2,S.canonical.z-this.tileID.canonical.z);return{x:Math.floor((S.canonical.x*x.EXTENT+y.tileAnchorX)*D),y:Math.floor((S.canonical.y*x.EXTENT+y.tileAnchorY)*D)}}findMatches(y,S,D){const z=this.tileID.canonical.z<S.canonical.z?1:Math.pow(2,this.tileID.canonical.z-S.canonical.z);for(let O=0;O<y.length;O++){const V=y.get(O);if(V.crossTileID)continue;const Z=this.indexedSymbolInstances[V.key];if(!Z)continue;const K=this.getScaledCoordinates(V,S);for(const Q of Z)if(Math.abs(Q.coord.x-K.x)<=z&&Math.abs(Q.coord.y-K.y)<=z&&!D[Q.crossTileID]){D[Q.crossTileID]=!0,V.crossTileID=Q.crossTileID;break}}}}class To{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ei{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(y){const S=Math.round((y-this.lng)/360);if(S!==0)for(const D in this.indexes){const z=this.indexes[D],O={};for(const V in z){const Z=z[V];Z.tileID=Z.tileID.unwrapTo(Z.tileID.wrap+S),O[Z.tileID.key]=Z}this.indexes[D]=O}this.lng=y}addBucket(y,S,D){if(this.indexes[y.overscaledZ]&&this.indexes[y.overscaledZ][y.key]){if(this.indexes[y.overscaledZ][y.key].bucketInstanceId===S.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(y.overscaledZ,this.indexes[y.overscaledZ][y.key])}for(let O=0;O<S.symbolInstances.length;O++)S.symbolInstances.get(O).crossTileID=0;this.usedCrossTileIDs[y.overscaledZ]||(this.usedCrossTileIDs[y.overscaledZ]={});const z=this.usedCrossTileIDs[y.overscaledZ];for(const O in this.indexes){const V=this.indexes[O];if(Number(O)>y.overscaledZ)for(const Z in V){const K=V[Z];K.tileID.isChildOf(y)&&K.findMatches(S.symbolInstances,y,z)}else{const Z=V[y.scaledTo(Number(O)).key];Z&&Z.findMatches(S.symbolInstances,y,z)}}for(let O=0;O<S.symbolInstances.length;O++){const V=S.symbolInstances.get(O);V.crossTileID||(V.crossTileID=D.generate(),z[V.crossTileID]=!0)}return this.indexes[y.overscaledZ]===void 0&&(this.indexes[y.overscaledZ]={}),this.indexes[y.overscaledZ][y.key]=new An(y,S.symbolInstances,S.bucketInstanceId),!0}removeBucketCrossTileIDs(y,S){for(const D in S.indexedSymbolInstances)for(const z of S.indexedSymbolInstances[D])delete this.usedCrossTileIDs[y][z.crossTileID]}removeStaleBuckets(y){let S=!1;for(const D in this.indexes){const z=this.indexes[D];for(const O in z)y[z[O].bucketInstanceId]||(this.removeBucketCrossTileIDs(D,z[O]),delete z[O],S=!0)}return S}}class Qo{constructor(){this.layerIndexes={},this.crossTileIDs=new To,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(y,S,D,z){let O=this.layerIndexes[y.id];O===void 0&&(O=this.layerIndexes[y.id]=new Ei);let V=!1;const Z={};z.name!=="globe"&&O.handleWrapJump(D);for(const K of S){const Q=K.getBucket(y);Q&&y.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),O.addBucket(K.tileID,Q,this.crossTileIDs)&&(V=!0),Z[Q.bucketInstanceId]=!0)}return O.removeStaleBuckets(Z)&&(V=!0),V}pruneUnusedLayers(y){const S={};y.forEach(D=>{S[D]=!0});for(const D in this.layerIndexes)S[D]||delete this.layerIndexes[D]}}const Hn=(C,y)=>x.emitValidationErrors(C,y&&y.filter(S=>S.identifier!=="source.canvas")),es=x.pick(et,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),an=x.pick(et,["setCenter","setZoom","setBearing","setPitch"]),ar=function(){const C={},y=x.spec.$version;for(const S in x.spec.$root){const D=x.spec.$root[S];if(D.required){let z=null;z=S==="version"?y:D.type==="array"?[]:{},z!=null&&(C[S]=z)}}return C}(),rc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Xr extends x.Evented{constructor(y,S={}){super(),this.map=y,this.dispatcher=new Bt($e(),this),this.imageManager=new he,this.imageManager.setEventedParent(this),this.glyphManager=new x.GlyphManager(y._requestManager,S.localFontFamily?x.LocalGlyphMode.all:S.localIdeographFontFamily?x.LocalGlyphMode.ideographs:x.LocalGlyphMode.none,S.localFontFamily||S.localIdeographFontFamily),this.lineAtlas=new x.LineAtlas(256,512),this.crossTileSymbolIndex=new Qo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new x.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",x.getReferrer());const D=this;this._rtlTextPluginCallback=Xr.registerForPluginStateChange(z=>{D.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:z.pluginStatus,pluginURL:z.pluginURL},(O,V)=>{if(x.triggerPluginCompletionEvent(O),V&&V.every(Z=>Z))for(const Z in D._sourceCaches){const K=D._sourceCaches[Z],Q=K.getSource().type;Q!=="vector"&&Q!=="geojson"||K.reload()}})}),this.on("data",z=>{if(z.dataType!=="source"||z.sourceDataType!=="metadata")return;const O=this.getSource(z.sourceId);if(O&&O.vectorLayerIds)for(const V in this._layers){const Z=this._layers[V];Z.source===O.id&&this._validateLayer(Z)}})}loadURL(y,S={}){this.fire(new x.Event("dataloading",{dataType:"style"}));const D=typeof S.validate=="boolean"?S.validate:!x.isMapboxURL(y);y=this.map._requestManager.normalizeStyleURL(y,S.accessToken);const z=this.map._requestManager.transformRequest(y,x.ResourceType.Style);this._request=x.getJSON(z,(O,V)=>{this._request=null,O?this.fire(new x.ErrorEvent(O)):V&&this._load(V,D)})}loadJSON(y,S={}){this.fire(new x.Event("dataloading",{dataType:"style"})),this._request=x.exported.frame(()=>{this._request=null,this._load(y,S.validate!==!1)})}loadEmpty(){this.fire(new x.Event("dataloading",{dataType:"style"})),this._load(ar,!1)}_updateLayerCount(y,S){const D=S?1:-1;y.is3D()&&(this._num3DLayers+=D),y.type==="circle"&&(this._numCircleLayers+=D),y.type==="symbol"&&(this._numSymbolLayers+=D)}_load(y,S){if(S&&Hn(this,x.validateStyle(y)))return;this._loaded=!0,this.stylesheet=y,this.updateProjection();for(const z in y.sources)this.addSource(z,y.sources[z],{validate:!1});this._changed=!1,y.sprite?this._loadSprite(y.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(y.glyphs);const D=Qe(this.stylesheet.layers);this._order=D.map(z=>z.id),this._layers={},this._serializedLayers={};for(let z of D)z=x.createStyleLayer(z),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize(),this._updateLayerCount(z,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ve(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new x.Event("data",{dataType:"style"})),this.fire(new x.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(y){y?this.stylesheet.projection=y:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const y=this.map.transform.projection,S=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),D=this.map.transform.projection;if(this._loaded&&(D.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),S){if(D.isReprojectedInTileSpace||y.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const z in this._sourceCaches)this._sourceCaches[z].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(y){this._spriteRequest=function(S,D,z){let O,V,Z;const K=x.exported.devicePixelRatio>1?"@2x":"";let Q=x.getJSON(D.transformRequest(D.normalizeSpriteURL(S,K,".json"),x.ResourceType.SpriteJSON),(pe,Ee)=>{Q=null,Z||(Z=pe,O=Ee,ae())}),ie=x.getImage(D.transformRequest(D.normalizeSpriteURL(S,K,".png"),x.ResourceType.SpriteImage),(pe,Ee)=>{ie=null,Z||(Z=pe,V=Ee,ae())});function ae(){if(Z)z(Z);else if(O&&V){const pe=x.exported.getImageData(V),Ee={};for(const xe in O){const{width:Te,height:Fe,x:we,y:De,sdf:Be,pixelRatio:ke,stretchX:Ce,stretchY:Oe,content:He}=O[xe],Je=new x.RGBAImage({width:Te,height:Fe});x.RGBAImage.copy(pe,Je,{x:we,y:De},{x:0,y:0},{width:Te,height:Fe}),Ee[xe]={data:Je,pixelRatio:ke,sdf:Be,stretchX:Ce,stretchY:Oe,content:He}}z(null,Ee)}}return{cancel(){Q&&(Q.cancel(),Q=null),ie&&(ie.cancel(),ie=null)}}}(y,this.map._requestManager,(S,D)=>{if(this._spriteRequest=null,S)this.fire(new x.ErrorEvent(S));else if(D)for(const z in D)this.imageManager.addImage(z,D[z]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new x.Event("data",{dataType:"style"}))})}_validateLayer(y){const S=this.getSource(y.source);if(!S)return;const D=y.sourceLayer;D&&(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(D)===-1)&&this.fire(new x.ErrorEvent(new Error(`Source layer "${D}" does not exist on source "${S.id}" as specified by style layer "${y.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const y in this._sourceCaches)if(!this._sourceCaches[y].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(y){const S=[];for(const D of y){const z=this._layers[D];z.type!=="custom"&&S.push(z.serialize())}return S}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const y in this._sourceCaches)if(this._sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(y){return!!this.terrain&&rc[y.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(y){if(!this._loaded)return;const S=this._changed;if(this._changed){const z=Object.keys(this._updatedLayers),O=Object.keys(this._removedLayers);(z.length||O.length)&&this._updateWorkerLayers(z,O);for(const V in this._updatedSources){const Z=this._updatedSources[V];Z==="reload"?this._reloadSource(V):Z==="clear"&&this._clearSource(V)}this._updateTilesForChangedImages();for(const V in this._updatedPaintProps)this._layers[V].updateTransitions(y);this.light.updateTransitions(y),this.fog&&this.fog.updateTransitions(y),this._resetUpdates()}const D={};for(const z in this._sourceCaches){const O=this._sourceCaches[z];D[z]=O.used,O.used=!1}for(const z of this._order){const O=this._layers[z];if(O.recalculate(y,this._availableImages),!O.isHidden(y.zoom)){const Z=this._getLayerSourceCache(O);Z&&(Z.used=!0)}const V=this.map.painter;if(V){const Z=O.getProgramIds();if(!Z)continue;const K=O.getProgramConfiguration(y.zoom);for(const Q of Z)V.useProgram(Q,K)}}for(const z in D){const O=this._sourceCaches[z];D[z]!==O.used&&O.getSource().fire(new x.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light.recalculate(y),this.terrain&&this.terrain.recalculate(y),this.fog&&this.fog.recalculate(y),this.z=y.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),S&&this.fire(new x.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const y=Object.keys(this._changedImages);if(y.length){for(const S in this._sourceCaches)this._sourceCaches[S].reloadTilesForDependencies(["icons","patterns"],y);this._changedImages={}}}_updateWorkerLayers(y,S){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(y),removedIds:S})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(y){if(this._checkLoaded(),Hn(this,x.validateStyle(y)))return!1;(y=x.clone$1(y)).layers=Qe(y.layers);const S=function(z,O){if(!z)return[{command:et.setStyle,args:[O]}];let V=[];try{if(!q(z.version,O.version))return[{command:et.setStyle,args:[O]}];q(z.center,O.center)||V.push({command:et.setCenter,args:[O.center]}),q(z.zoom,O.zoom)||V.push({command:et.setZoom,args:[O.zoom]}),q(z.bearing,O.bearing)||V.push({command:et.setBearing,args:[O.bearing]}),q(z.pitch,O.pitch)||V.push({command:et.setPitch,args:[O.pitch]}),q(z.sprite,O.sprite)||V.push({command:et.setSprite,args:[O.sprite]}),q(z.glyphs,O.glyphs)||V.push({command:et.setGlyphs,args:[O.glyphs]}),q(z.transition,O.transition)||V.push({command:et.setTransition,args:[O.transition]}),q(z.light,O.light)||V.push({command:et.setLight,args:[O.light]}),q(z.fog,O.fog)||V.push({command:et.setFog,args:[O.fog]}),q(z.projection,O.projection)||V.push({command:et.setProjection,args:[O.projection]});const Z={},K=[];(function(ae,pe,Ee,xe){let Te;for(Te in pe=pe||{},ae=ae||{})ae.hasOwnProperty(Te)&&(pe.hasOwnProperty(Te)||Ct(Te,Ee,xe));for(Te in pe)pe.hasOwnProperty(Te)&&(ae.hasOwnProperty(Te)?q(ae[Te],pe[Te])||(ae[Te].type==="geojson"&&pe[Te].type==="geojson"&&Xt(ae,pe,Te)?Ee.push({command:et.setGeoJSONSourceData,args:[Te,pe[Te].data]}):Gt(Te,pe,Ee,xe)):lt(Te,pe,Ee))})(z.sources,O.sources,K,Z);const Q=[];z.layers&&z.layers.forEach(ae=>{Z[ae.source]?V.push({command:et.removeLayer,args:[ae.id]}):Q.push(ae)});let ie=z.terrain;ie&&Z[ie.source]&&(V.push({command:et.setTerrain,args:[void 0]}),ie=void 0),V=V.concat(K),q(ie,O.terrain)||V.push({command:et.setTerrain,args:[O.terrain]}),function(ae,pe,Ee){pe=pe||[];const xe=(ae=ae||[]).map(gi),Te=pe.map(gi),Fe=ae.reduce(Yi,{}),we=pe.reduce(Yi,{}),De=xe.slice(),Be=Object.create(null);let ke,Ce,Oe,He,Je,xt,ft;for(ke=0,Ce=0;ke<xe.length;ke++)Oe=xe[ke],we.hasOwnProperty(Oe)?Ce++:(Ee.push({command:et.removeLayer,args:[Oe]}),De.splice(De.indexOf(Oe,Ce),1));for(ke=0,Ce=0;ke<Te.length;ke++)Oe=Te[Te.length-1-ke],De[De.length-1-ke]!==Oe&&(Fe.hasOwnProperty(Oe)?(Ee.push({command:et.removeLayer,args:[Oe]}),De.splice(De.lastIndexOf(Oe,De.length-Ce),1)):Ce++,xt=De[De.length-ke],Ee.push({command:et.addLayer,args:[we[Oe],xt]}),De.splice(De.length-ke,0,Oe),Be[Oe]=!0);for(ke=0;ke<Te.length;ke++)if(Oe=Te[ke],He=Fe[Oe],Je=we[Oe],!Be[Oe]&&!q(He,Je))if(q(He.source,Je.source)&&q(He["source-layer"],Je["source-layer"])&&q(He.type,Je.type)){for(ft in Ht(He.layout,Je.layout,Ee,Oe,null,et.setLayoutProperty),Ht(He.paint,Je.paint,Ee,Oe,null,et.setPaintProperty),q(He.filter,Je.filter)||Ee.push({command:et.setFilter,args:[Oe,Je.filter]}),q(He.minzoom,Je.minzoom)&&q(He.maxzoom,Je.maxzoom)||Ee.push({command:et.setLayerZoomRange,args:[Oe,Je.minzoom,Je.maxzoom]}),He)He.hasOwnProperty(ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?Ht(He[ft],Je[ft],Ee,Oe,ft.slice(6),et.setPaintProperty):q(He[ft],Je[ft])||Ee.push({command:et.setLayerProperty,args:[Oe,ft,Je[ft]]}));for(ft in Je)Je.hasOwnProperty(ft)&&!He.hasOwnProperty(ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?Ht(He[ft],Je[ft],Ee,Oe,ft.slice(6),et.setPaintProperty):q(He[ft],Je[ft])||Ee.push({command:et.setLayerProperty,args:[Oe,ft,Je[ft]]}))}else Ee.push({command:et.removeLayer,args:[Oe]}),xt=De[De.lastIndexOf(Oe)+1],Ee.push({command:et.addLayer,args:[Je,xt]})}(Q,O.layers,V)}catch(Z){console.warn("Unable to compute style diff:",Z),V=[{command:et.setStyle,args:[O]}]}return V}(this.serialize(),y).filter(z=>!(z.command in an));if(S.length===0)return!1;const D=S.filter(z=>!(z.command in es));if(D.length>0)throw new Error(`Unimplemented: ${D.map(z=>z.command).join(", ")}.`);return S.forEach(z=>{z.command!=="setTransition"&&this[z.command].apply(this,z.args)}),this.stylesheet=y,this.updateProjection(),!0}addImage(y,S){if(this.getImage(y))return this.fire(new x.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(y,S),this._afterImageUpdated(y)}updateImage(y,S){this.imageManager.updateImage(y,S)}getImage(y){return this.imageManager.getImage(y)}removeImage(y){if(!this.getImage(y))return this.fire(new x.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(y),this._afterImageUpdated(y)}_afterImageUpdated(y){this._availableImages=this.imageManager.listImages(),this._changedImages[y]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new x.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(y,S,D={}){if(this._checkLoaded(),this.getSource(y)!==void 0)throw new Error("There is already a source with this ID");if(!S.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(S).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(S.type)>=0&&this._validate(x.validateStyle.source,`sources.${y}`,S,null,D))return;this.map&&this.map._collectResourceTiming&&(S.collectResourceTiming=!0);const z=Ge(y,S,this.dispatcher,this);z.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:z.serialize(),sourceId:y}));const O=V=>{const Z=(V?"symbol:":"other:")+y,K=this._sourceCaches[Z]=new x.SourceCache(Z,z,V);(V?this._symbolSourceCaches:this._otherSourceCaches)[y]=K,K.style=this,K.onAdd(this.map)};O(!1),S.type!=="vector"&&S.type!=="geojson"||O(!0),z.onAdd&&z.onAdd(this.map),this._changed=!0}removeSource(y){this._checkLoaded();const S=this.getSource(y);if(S===void 0)throw new Error("There is no source with this ID");for(const z in this._layers)if(this._layers[z].source===y)return this.fire(new x.ErrorEvent(new Error(`Source "${y}" cannot be removed while layer "${z}" is using it.`)));if(this.terrain&&this.terrain.get().source===y)return this.fire(new x.ErrorEvent(new Error(`Source "${y}" cannot be removed while terrain is using it.`)));const D=this._getSourceCaches(y);for(const z of D)delete this._sourceCaches[z.id],delete this._updatedSources[z.id],z.fire(new x.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:z.getSource().id})),z.setEventedParent(null),z.clearTiles();delete this._otherSourceCaches[y],delete this._symbolSourceCaches[y],S.setEventedParent(null),S.onRemove&&S.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(y,S){this._checkLoaded(),this.getSource(y).setData(S),this._changed=!0}getSource(y){const S=this._getSourceCache(y);return S&&S.getSource()}addLayer(y,S,D={}){this._checkLoaded();const z=y.id;if(this.getLayer(z))return void this.fire(new x.ErrorEvent(new Error(`Layer with id "${z}" already exists on this map`)));let O;if(y.type==="custom"){if(Hn(this,x.validateCustomStyleLayer(y)))return;O=x.createStyleLayer(y)}else{if(typeof y.source=="object"&&(this.addSource(z,y.source),y=x.clone$1(y),y=x.extend(y,{source:z})),this._validate(x.validateStyle.layer,`layers.${z}`,y,{arrayIndex:-1},D))return;O=x.createStyleLayer(y),this._validateLayer(O),O.setEventedParent(this,{layer:{id:z}}),this._serializedLayers[O.id]=O.serialize(),this._updateLayerCount(O,!0)}const V=S?this._order.indexOf(S):this._order.length;if(S&&V===-1)return void this.fire(new x.ErrorEvent(new Error(`Layer with id "${S}" does not exist on this map.`)));this._order.splice(V,0,z),this._layerOrderChanged=!0,this._layers[z]=O;const Z=this._getLayerSourceCache(O);if(this._removedLayers[z]&&O.source&&Z&&O.type!=="custom"){const K=this._removedLayers[z];delete this._removedLayers[z],K.type!==O.type?this._updatedSources[O.source]="clear":(this._updatedSources[O.source]="reload",Z.pause())}this._updateLayer(O),O.onAdd&&O.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(y,S){if(this._checkLoaded(),this._changed=!0,!this._layers[y])return void this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be moved.`)));if(y===S)return;const D=this._order.indexOf(y);this._order.splice(D,1);const z=S?this._order.indexOf(S):this._order.length;S&&z===-1?this.fire(new x.ErrorEvent(new Error(`Layer with id "${S}" does not exist on this map.`))):(this._order.splice(z,0,y),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(y){this._checkLoaded();const S=this._layers[y];if(!S)return void this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be removed.`)));S.setEventedParent(null),this._updateLayerCount(S,!1);const D=this._order.indexOf(y);this._order.splice(D,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[y]=S,delete this._layers[y],delete this._serializedLayers[y],delete this._updatedLayers[y],delete this._updatedPaintProps[y],S.onRemove&&S.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(y){return this._layers[y]}hasLayer(y){return y in this._layers}hasLayerType(y){for(const S in this._layers)if(this._layers[S].type===y)return!0;return!1}setLayerZoomRange(y,S,D){this._checkLoaded();const z=this.getLayer(y);z?z.minzoom===S&&z.maxzoom===D||(S!=null&&(z.minzoom=S),D!=null&&(z.maxzoom=D),this._updateLayer(z)):this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(y,S,D={}){this._checkLoaded();const z=this.getLayer(y);if(z){if(!q(z.filter,S))return S==null?(z.filter=void 0,void this._updateLayer(z)):void(this._validate(x.validateStyle.filter,`layers.${z.id}.filter`,S,{layerType:z.type},D)||(z.filter=x.clone$1(S),this._updateLayer(z)))}else this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be filtered.`)))}getFilter(y){return x.clone$1(this.getLayer(y).filter)}setLayoutProperty(y,S,D,z={}){this._checkLoaded();const O=this.getLayer(y);O?q(O.getLayoutProperty(S),D)||(O.setLayoutProperty(S,D,z),this._updateLayer(O)):this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(y,S){const D=this.getLayer(y);if(D)return D.getLayoutProperty(S);this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style.`)))}setPaintProperty(y,S,D,z={}){this._checkLoaded();const O=this.getLayer(y);O?q(O.getPaintProperty(S),D)||(O.setPaintProperty(S,D,z)&&this._updateLayer(O),this._changed=!0,this._updatedPaintProps[y]=!0):this.fire(new x.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(y,S){return this.getLayer(y).getPaintProperty(S)}setFeatureState(y,S){this._checkLoaded();const D=y.source,z=y.sourceLayer,O=this.getSource(D);if(O===void 0)return void this.fire(new x.ErrorEvent(new Error(`The source '${D}' does not exist in the map's style.`)));const V=O.type;if(V==="geojson"&&z)return void this.fire(new x.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(V==="vector"&&!z)return void this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));y.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided.")));const Z=this._getSourceCaches(D);for(const K of Z)K.setFeatureState(z,y.id,S)}removeFeatureState(y,S){this._checkLoaded();const D=y.source,z=this.getSource(D);if(z===void 0)return void this.fire(new x.ErrorEvent(new Error(`The source '${D}' does not exist in the map's style.`)));const O=z.type,V=O==="vector"?y.sourceLayer:void 0;if(O==="vector"&&!V)return void this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(S&&typeof y.id!="string"&&typeof y.id!="number")return void this.fire(new x.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const Z=this._getSourceCaches(D);for(const K of Z)K.removeFeatureState(V,y.id,S)}getFeatureState(y){this._checkLoaded();const S=y.source,D=y.sourceLayer,z=this.getSource(S);if(z!==void 0){if(z.type!=="vector"||D)return y.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(S)[0].getFeatureState(D,y.id);this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new x.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)))}getTransition(){return x.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const y={};for(const S in this._sourceCaches){const D=this._sourceCaches[S].getSource();y[D.id]||(y[D.id]=D.serialize())}return x.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:y,layers:this._serializeLayers(this._order)},S=>S!==void 0)}_updateLayer(y){this._updatedLayers[y.id]=!0;const S=this._getLayerSourceCache(y);y.source&&!this._updatedSources[y.source]&&S&&S.getSource().type!=="raster"&&(this._updatedSources[y.source]="reload",S.pause()),this._changed=!0,y.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(y){const S=V=>this._layers[V].type==="fill-extrusion",D={},z=[];for(let V=this._order.length-1;V>=0;V--){const Z=this._order[V];if(S(Z)){D[Z]=V;for(const K of y){const Q=K[Z];if(Q)for(const ie of Q)z.push(ie)}}}z.sort((V,Z)=>Z.intersectionZ-V.intersectionZ);const O=[];for(let V=this._order.length-1;V>=0;V--){const Z=this._order[V];if(S(Z))for(let K=z.length-1;K>=0;K--){const Q=z[K].feature;if(D[Q.layer.id]<V)break;O.push(Q),z.pop()}else for(const K of y){const Q=K[Z];if(Q)for(const ie of Q)O.push(ie.feature)}}return O}queryRenderedFeatures(y,S,D){S&&S.filter&&this._validate(x.validateStyle.filter,"queryRenderedFeatures.filter",S.filter,null,S);const z={};if(S&&S.layers){if(!Array.isArray(S.layers))return this.fire(new x.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const K of S.layers){const Q=this._layers[K];if(!Q)return this.fire(new x.ErrorEvent(new Error(`The layer '${K}' does not exist in the map's style and cannot be queried for features.`))),[];z[Q.source]=!0}}const O=[];S.availableImages=this._availableImages;const V=S&&S.layers?S.layers.some(K=>{const Q=this.getLayer(K);return Q&&Q.is3D()}):this.has3DLayers(),Z=sn.createFromScreenPoints(y,D);for(const K in this._sourceCaches){const Q=this._sourceCaches[K].getSource().id;S.layers&&!z[Q]||O.push(J(this._sourceCaches[K],this._layers,this._serializedLayers,Z,S,D,V,!!this.map._showQueryGeometry))}return this.placement&&O.push(function(K,Q,ie,ae,pe,Ee,xe){const Te={},Fe=Ee.queryRenderedSymbols(ae),we=[];for(const De of Object.keys(Fe).map(Number))we.push(xe[De]);we.sort(fe);for(const De of we){const Be=De.featureIndex.lookupSymbolFeatures(Fe[De.bucketInstanceId],Q,De.bucketIndex,De.sourceLayerIndex,pe.filter,pe.layers,pe.availableImages,K);for(const ke in Be){const Ce=Te[ke]=Te[ke]||[],Oe=Be[ke];Oe.sort((He,Je)=>{const xt=De.featureSortOrder;if(xt){const ft=xt.indexOf(He.featureIndex);return xt.indexOf(Je.featureIndex)-ft}return Je.featureIndex-He.featureIndex});for(const He of Oe)Ce.push(He)}}for(const De in Te)Te[De].forEach(Be=>{const ke=Be.feature,Ce=ie(K[De]).getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Ce});return Te}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),Z.screenGeometry,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(O)}querySourceFeatures(y,S){S&&S.filter&&this._validate(x.validateStyle.filter,"querySourceFeatures.filter",S.filter,null,S);const D=this._getSourceCaches(y);let z=[];for(const O of D)z=z.concat(ne(O,S));return z}addSourceType(y,S,D){return Xr.getSourceType(y)?D(new Error(`A source type called "${y}" already exists.`)):(Xr.setSourceType(y,S),S.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:y,url:S.workerSourceURL},D):D(null,null))}getLight(){return this.light.getLight()}setLight(y,S={}){this._checkLoaded();const D=this.light.getLight();let z=!1;for(const V in y)if(!q(y[V],D[V])){z=!0;break}if(!z)return;const O={now:x.exported.now(),transition:x.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(y,S),this.light.updateTransitions(O)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(y,S=1){if(this._checkLoaded(),!y)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(S===1){if(typeof y.source=="object"){const D="terrain-dem-src";this.addSource(D,y.source),y=x.clone$1(y),y=x.extend(y,{source:D})}if(this._validate(x.validateStyle.terrain,"terrain",y))return}if(!this.terrain||this.terrain&&S!==this.terrain.drapeRenderMode)this._createTerrain(y,S);else{const D=this.terrain,z=D.get();for(const O in y)if(!q(y[O],z[O])){D.set(y),this.stylesheet.terrain=y;const V={now:x.exported.now(),transition:x.extend({duration:0},this.stylesheet.transition)};D.updateTransitions(V);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(y){const S=this.fog=new ct(y,this.map.transform);this.stylesheet.fog=y;const D={now:x.exported.now(),transition:x.extend({duration:0},this.stylesheet.transition)};S.updateTransitions(D)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const y of this.map._markers)y._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(y){if(this._checkLoaded(),!y)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const S=this.fog,D=S.get();for(const z in y)if(!q(y[z],D[z])){S.set(y),this.stylesheet.fog=y;const O={now:x.exported.now(),transition:x.extend({duration:0},this.stylesheet.transition)};S.updateTransitions(O);break}}else this._createFog(y);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const y=this._order.filter(D=>this.isLayerDraped(this._layers[D])),S=this._order.filter(D=>!this.isLayerDraped(this._layers[D]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...y),this._drapedFirstOrder.push(...S)}_createTerrain(y,S){const D=this.terrain=new ce(y,S);this.stylesheet.terrain=y,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const z={now:x.exported.now(),transition:x.extend({duration:0},this.stylesheet.transition)};D.updateTransitions(z)}_force3DLayerUpdate(){for(const y in this._layers){const S=this._layers[y];S.type==="fill-extrusion"&&this._updateLayer(S)}}_forceSymbolLayerUpdate(){for(const y in this._layers){const S=this._layers[y];S.type==="symbol"&&this._updateLayer(S)}}_validate(y,S,D,z,O={}){return(!O||O.validate!==!1)&&Hn(this,y.call(x.validateStyle,x.extend({key:S,style:this.serialize(),value:D,styleSpec:x.spec},z)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),x.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles(),this._sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(y){const S=this._getSourceCaches(y);for(const D of S)D.clearTiles()}_reloadSource(y){const S=this._getSourceCaches(y);for(const D of S)D.resume(),D.reload()}_updateSources(y){for(const S in this._sourceCaches)this._sourceCaches[S].update(y)}_generateCollisionBoxes(){for(const y in this._sourceCaches){const S=this._sourceCaches[y];S.resume(),S.reload()}}_updatePlacement(y,S,D,z,O=!1){let V=!1,Z=!1;const K={};for(const Q of this._order){const ie=this._layers[Q];if(ie.type!=="symbol")continue;if(!K[ie.source]){const pe=this._getLayerSourceCache(ie);if(!pe)continue;K[ie.source]=pe.getRenderableIds(!0).map(Ee=>pe.getTileByID(Ee)).sort((Ee,xe)=>xe.tileID.overscaledZ-Ee.tileID.overscaledZ||(Ee.tileID.isLessThan(xe.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(ie,K[ie.source],y.center.lng,y.projection);V=V||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),O=O||this._layerOrderChanged||D===0,this._layerOrderChanged&&this.fire(new x.Event("neworder")),(O||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.exported.now(),y.zoom))&&(this.pauseablePlacement=new ki(y,this._order,O,S,D,z,this.placement,this.fog&&y.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,K),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.exported.now()),Z=!0),V&&this.pauseablePlacement.placement.setStale()),Z||V)for(const Q of this._order){const ie=this._layers[Q];ie.type==="symbol"&&this.placement.updateLayerOpacities(ie,K[ie.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.exported.now())}_releaseSymbolFadeTiles(){for(const y in this._sourceCaches)this._sourceCaches[y].releaseSymbolFadeTiles()}getImages(y,S,D){this.imageManager.getImages(S.icons,D),this._updateTilesForChangedImages();const z=O=>{O&&O.setDependencies(S.tileID.key,S.type,S.icons)};z(this._otherSourceCaches[S.source]),z(this._symbolSourceCaches[S.source])}getGlyphs(y,S,D){this.glyphManager.getGlyphs(S.stacks,D)}getResource(y,S,D){return x.makeRequest(S,D)}_getSourceCache(y){return this._otherSourceCaches[y]}_getLayerSourceCache(y){return y.type==="symbol"?this._symbolSourceCaches[y.source]:this._otherSourceCaches[y.source]}_getSourceCaches(y){const S=[];return this._otherSourceCaches[y]&&S.push(this._otherSourceCaches[y]),this._symbolSourceCaches[y]&&S.push(this._symbolSourceCaches[y]),S}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xr.getSourceType=function(C){return Me[C]},Xr.setSourceType=function(C,y){Me[C]=y},Xr.registerForPluginStateChange=x.registerForPluginStateChange;var Os=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Mo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let So={},Ao={};So=_i("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Ao=_i(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Oi=_i(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),$s=Os;var Fa={background:_i(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:_i(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:_i("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:_i(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:_i(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:_i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:_i(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:_i(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:_i(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Mo),skyboxGradient:_i(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Mo),skyboxCapture:_i(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:_i(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:_i(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function _i(C,y,S){const D=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,z=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,O=y.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),V=C.match(z),Z=y.match(z),K=Os.match(z);let Q=Z?Z.concat(V):V;S||(So.staticUniforms&&(Q=So.staticUniforms.concat(Q)),Ao.staticUniforms&&(Q=Ao.staticUniforms.concat(Q))),Q&&(Q=Q.concat(K));const ie={};return{fragmentSource:C=C.replace(D,(ae,pe,Ee,xe,Te)=>(ie[Te]=!0,pe==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
varying ${Ee} ${xe} ${Te};
#else
uniform ${Ee} ${xe} u_${Te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Te}
    ${Ee} ${xe} ${Te} = u_${Te};
#endif
`)),vertexSource:y=y.replace(D,(ae,pe,Ee,xe,Te)=>{const Fe=xe==="float"?"vec2":"vec4",we=Te.match(/color/)?"color":Fe;return ie[Te]?pe==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
attribute ${Ee} ${Fe} a_${Te};
varying ${Ee} ${xe} ${Te};
#else
uniform ${Ee} ${xe} u_${Te};
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = a_${Te};
#else
    ${Ee} ${xe} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${Te} = unpack_mix_${we}(a_${Te}, u_${Te}_t);
#else
    ${Ee} ${xe} ${Te} = u_${Te};
#endif
`:pe==="define"?`
#ifndef HAS_UNIFORM_u_${Te}
uniform lowp float u_${Te}_t;
attribute ${Ee} ${Fe} a_${Te};
#else
uniform ${Ee} ${xe} u_${Te};
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_${Te}
    ${Ee} ${xe} ${Te} = a_${Te};
#else
    ${Ee} ${xe} ${Te} = u_${Te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Te}
    ${Ee} ${xe} ${Te} = unpack_mix_${we}(a_${Te}, u_${Te}_t);
#else
    ${Ee} ${xe} ${Te} = u_${Te};
#endif
`}),staticAttributes:O,staticUniforms:Q}}class ln{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(y,S,D,z,O,V,Z,K){this.context=y;let Q=this.boundPaintVertexBuffers.length!==z.length;for(let ie=0;!Q&&ie<z.length;ie++)this.boundPaintVertexBuffers[ie]!==z[ie]&&(Q=!0);y.extVertexArrayObject&&this.vao&&this.boundProgram===S&&this.boundLayoutVertexBuffer===D&&!Q&&this.boundIndexBuffer===O&&this.boundVertexOffset===V&&this.boundDynamicVertexBuffer===Z&&this.boundDynamicVertexBuffer2===K?(y.bindVertexArrayOES.set(this.vao),Z&&Z.bind(),O&&O.dynamicDraw&&O.bind(),K&&K.bind()):this.freshBind(S,D,z,O,V,Z,K)}freshBind(y,S,D,z,O,V,Z){let K;const Q=y.numAttributes,ie=this.context,ae=ie.gl;if(ie.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ie.extVertexArrayObject.createVertexArrayOES(),ie.bindVertexArrayOES.set(this.vao),K=0,this.boundProgram=y,this.boundLayoutVertexBuffer=S,this.boundPaintVertexBuffers=D,this.boundIndexBuffer=z,this.boundVertexOffset=O,this.boundDynamicVertexBuffer=V,this.boundDynamicVertexBuffer2=Z;else{K=ie.currentNumAttributes||0;for(let pe=Q;pe<K;pe++)ae.disableVertexAttribArray(pe)}S.enableAttributes(ae,y);for(const pe of D)pe.enableAttributes(ae,y);V&&V.enableAttributes(ae,y),Z&&Z.enableAttributes(ae,y),S.bind(),S.setVertexAttribPointers(ae,y,O);for(const pe of D)pe.bind(),pe.setVertexAttribPointers(ae,y,O);V&&(V.bind(),V.setVertexAttribPointers(ae,y,O)),z&&z.bind(),Z&&(Z.bind(),Z.setVertexAttribPointers(ae,y,O)),ie.currentNumAttributes=Q}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ol(C,y){const S=Math.pow(2,y.canonical.z),D=y.canonical.y;return[new x.MercatorCoordinate(0,D/S).toLngLat().lat,new x.MercatorCoordinate(0,(D+1)/S).toLngLat().lat]}function Ns(C,y,S,D,z,O,V){const Z=C.context,K=Z.gl,Q=S.fbo;if(!Q)return;C.prepareDrawTile(y);const ie=C.useProgram("hillshade");Z.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,Q.colorAttachment.get());const ae=((Te,Fe,we,De)=>{const Be=we.paint.get("hillshade-shadow-color"),ke=we.paint.get("hillshade-highlight-color"),Ce=we.paint.get("hillshade-accent-color");let Oe=we.paint.get("hillshade-illumination-direction")*(Math.PI/180);we.paint.get("hillshade-illumination-anchor")==="viewport"&&(Oe-=Te.transform.angle);const He=!Te.options.moving;return{u_matrix:De||Te.transform.calculateProjMatrix(Fe.tileID.toUnwrapped(),He),u_image:0,u_latrange:Ol(0,Fe.tileID),u_light:[we.paint.get("hillshade-exaggeration"),Oe],u_shadow:Be,u_highlight:ke,u_accent:Ce}})(C,S,D,C.terrain?y.projMatrix:null);C.prepareDrawProgram(Z,ie,y.toUnwrapped());const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:Ee,tileBoundsSegments:xe}=C.getTileBoundsBuffers(S);ie.draw(Z,K.TRIANGLES,z,O,V,x.CullFaceMode.disabled,ae,D.id,pe,Ee,xe)}function mr(C,y,S){if(!y.needsDEMTextureUpload)return;const D=C.context,z=D.gl;D.pixelStoreUnpackPremultiplyAlpha.set(!1),y.demTexture=y.demTexture||C.getTileTexture(S.stride);const O=S.getPixels();y.demTexture?y.demTexture.update(O,{premultiply:!1}):y.demTexture=new x.Texture(D,O,z.RGBA,{premultiply:!1}),y.needsDEMTextureUpload=!1}function ts(C,y,S,D,z,O){const V=C.context,Z=V.gl;if(!y.dem)return;const K=y.dem;if(V.activeTexture.set(Z.TEXTURE1),mr(C,y,K),!y.demTexture)return;y.demTexture.bind(Z.NEAREST,Z.CLAMP_TO_EDGE);const Q=K.dim;V.activeTexture.set(Z.TEXTURE0);let ie=y.fbo;if(!ie){const xe=new x.Texture(V,{width:Q,height:Q,data:null},Z.RGBA);xe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ie=y.fbo=V.createFramebuffer(Q,Q,!0),ie.colorAttachment.set(xe.texture)}V.bindFramebuffer.set(ie.framebuffer),V.viewport.set([0,0,Q,Q]);const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:pe,tileBoundsSegments:Ee}=C.getMercatorTileBoundsBuffers();C.useProgram("hillshadePrepare").draw(V,Z.TRIANGLES,D,z,O,x.CullFaceMode.disabled,((xe,Te)=>{const Fe=Te.stride,we=x.create();return x.ortho(we,0,x.EXTENT,-x.EXTENT,0,0,1),x.translate(we,we,[0,-x.EXTENT,0]),{u_matrix:we,u_image:1,u_dimension:[Fe,Fe],u_zoom:xe.overscaledZ,u_unpack:Te.unpackVector}})(y.tileID,K),S.id,ae,pe,Ee),y.needsHillshadePrepare=!1}const Wn=(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_image0:new x.Uniform1i(C,y.u_image0),u_skirt_height:new x.Uniform1f(C,y.u_skirt_height)}),Ar=(C,y)=>({u_matrix:C,u_image0:0,u_skirt_height:y}),Us=(C,y,S,D,z)=>({u_proj_matrix:Float32Array.from(C),u_globe_matrix:y,u_merc_matrix:S,u_zoom_transition:D,u_merc_center:z,u_image0:0});function hn(C,y){return C!=null&&y!=null&&!(!C.hasData()||!y.hasData())&&C.demTexture!=null&&y.demTexture!=null&&C.tileID.key!==y.tileID.key}const In=new class{constructor(){this.operations={}}newMorphing(C,y,S,D,z){if(C in this.operations){const O=this.operations[C];O.to.tileID.key!==S.tileID.key&&(O.queued=S)}else this.operations[C]={startTime:D,phase:0,duration:z,from:y,to:S,queued:null}}getMorphValuesForProxy(C){if(!(C in this.operations))return null;const y=this.operations[C];return{from:y.from,to:y.to,phase:y.phase}}update(C){for(const y in this.operations){const S=this.operations[y];for(S.phase=(C-S.startTime)/S.duration;S.phase>=1||!this._validOp(S);)if(!this._nextOp(S,C)){delete this.operations[y];break}}}_nextOp(C,y){return!!C.queued&&(C.from=C.to,C.to=C.queued,C.queued=null,C.phase=0,C.startTime=y,!0)}_validOp(C){return C.from.hasData()&&C.to.hasData()}},ho={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function nc(C,y){const S=1<<C.z;return!y&&(C.x===0||C.x===S-1)||C.y===0||C.y===S-1}const kn=C=>({u_matrix:C});function $l(C,y,S,D,z){if(z>0){const O=x.exported.now(),V=(O-C.timeAdded)/z,Z=y?(O-y.timeAdded)/z:-1,K=S.getSource(),Q=D.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ie=!y||Math.abs(y.tileID.overscaledZ-Q)>Math.abs(C.tileID.overscaledZ-Q),ae=ie&&C.refreshedUponExpiration?1:x.clamp(ie?V:1-Z,0,1);return C.refreshedUponExpiration&&V>=1&&(C.refreshedUponExpiration=!1),y?{opacity:1,mix:1-ae}:{opacity:ae,mix:0}}return{opacity:1,mix:0}}class Nl extends x.SourceCache{constructor(y){const S={type:"raster-dem",maxzoom:y.transform.maxZoom},D=new Bt($e(),null),z=Ge("mock-dem",S,D,y.style);super("mock-dem",z,!1),z.setEventedParent(this),this._sourceLoaded=!0}_loadTile(y,S){y.state="loaded",S(null)}}class Qr extends x.SourceCache{constructor(y){const S=Ge("proxy",{type:"geojson",maxzoom:y.transform.maxZoom},new Bt($e(),null),y.style);super("proxy",S,!1),S.setEventedParent(this),this.map=this.getSource().map=y,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(y,S,D){if(y.freezeTileCoverage)return;this.transform=y;const z=y.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((O,V)=>{if(O[V.key]="",!this._tiles[V.key]){const Z=new x.Tile(V,this._source.tileSize*V.overscaleFactor(),y.tileZoom);Z.state="loaded",this._tiles[V.key]=Z}return O},{});for(const O in this._tiles)O in z||(this.freeFBO(O),this._tiles[O].unloadVectorData(),delete this._tiles[O])}freeFBO(y){const S=this.proxyCachedFBO[y];if(S!==void 0){const D=Object.values(S);this.renderCachePool.push(...D),delete this.proxyCachedFBO[y]}}deallocRenderCache(){this.renderCache.forEach(y=>y.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class is extends x.OverscaledTileID{constructor(y,S,D){super(y.overscaledZ,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y),this.proxyTileKey=S,this.projMatrix=D}}class Kn extends x.Elevation{constructor(y,S){super(),this.painter=y,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[D,z,O]=function(K){const Q=new x.StructArrayLayout4i8,ie=new x.StructArrayLayout3ui6,ae=131;Q.reserve(17161),ie.reserve(33800);const pe=x.EXTENT/128,Ee=x.EXTENT+pe/2,xe=Ee+pe;for(let Fe=-pe;Fe<xe;Fe+=pe)for(let we=-pe;we<xe;we+=pe){const De=we<0||we>Ee||Fe<0||Fe>Ee?24575:0,Be=x.clamp(Math.round(we),0,x.EXTENT),ke=x.clamp(Math.round(Fe),0,x.EXTENT);Q.emplaceBack(Be+De,ke,Be,ke)}const Te=(Fe,we)=>{const De=we*ae+Fe;ie.emplaceBack(De+1,De,De+ae),ie.emplaceBack(De+ae,De+ae+1,De+1)};for(let Fe=1;Fe<129;Fe++)for(let we=1;we<129;we++)Te(we,Fe);return[0,129].forEach(Fe=>{for(let we=0;we<130;we++)Te(we,Fe),Te(Fe,we)}),[Q,ie,32768]}(),V=y.context;this.gridBuffer=V.createVertexBuffer(D,x.boundsAttributes.members),this.gridIndexBuffer=V.createIndexBuffer(z),this.gridSegments=x.SegmentVector.simpleSegment(0,0,D.length,z.length),this.gridNoSkirtSegments=x.SegmentVector.simpleSegment(0,0,D.length,O),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qr(S.map),this.orthoMatrix=x.create(),x.ortho(this.orthoMatrix,0,x.EXTENT,0,x.EXTENT,0,1);const Z=V.gl;this._overlapStencilMode=new x.StencilMode({func:Z.GEQUAL,mask:255},0,255,Z.KEEP,Z.KEEP,Z.REPLACE),this._previousZoom=y.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=S,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nl(S.map)}set style(y){y.on("data",this._onStyleDataEvent.bind(this)),y.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=y,this._checkRenderCacheEfficiency()}update(y,S,D){if(y&&y.terrain){this._style!==y&&(this.style=y),this.enabled=!0;const z=y.terrain.properties;this.sourceCache=y.terrain.drapeRenderMode===0?this._mockSourceCache:y._getSourceCache(z.get("source")),this._exaggeration=z.get("exaggeration");const O=()=>{this.sourceCache.used&&x.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(S,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),S.updateElevation(!D),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(S),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(y){this._findCoveringTileCache[y]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const y=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||y.efficiency!==100&&x.warnOnce(`Terrain render cache efficiency is not optimal (${y.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${y.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(y){y.coord&&y.dataType==="source"?this._clearRenderCacheForTile(y.sourceCacheId,y.coord):y.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const y in this._style._sourceCaches)this._style._sourceCaches[y].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(y=>y.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const y=2*this.proxySourceCache.getSource().tileSize;return[y,y]}set useVertexMorphing(y){this._useVertexMorphing=y}updateTileBinding(y){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const S=this.proxySourceCache,D=this.painter.transform;this._initializing&&(this._initializing=D._centerAltitude===0&&this.getAtPointOrZero(x.MercatorCoordinate.fromLngLat(D.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const z=this.proxyCoords=S.getIds().map(K=>{const Q=S.getTileByID(K).tileID;return Q.projMatrix=D.calculateProjMatrix(Q.toUnwrapped()),Q});(function(K,Q){const ie=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),ae=new x.pointGeometry(ie.x,ie.y);K.sort((pe,Ee)=>{if(Ee.overscaledZ-pe.overscaledZ)return Ee.overscaledZ-pe.overscaledZ;const xe=new x.pointGeometry(pe.canonical.x+(1<<pe.canonical.z)*pe.wrap,pe.canonical.y),Te=new x.pointGeometry(Ee.canonical.x+(1<<Ee.canonical.z)*Ee.wrap,Ee.canonical.y),Fe=ae.mult(1<<pe.canonical.z);return Fe.x-=.5,Fe.y-=.5,Fe.distSqr(xe)-Fe.distSqr(Te)})})(z,this.painter),this._previousZoom=D.zoom;const O=this.proxyToSource||{};this.proxyToSource={},z.forEach(K=>{this.proxyToSource[K.key]={}}),this.terrainTileForTile={};const V=this._style._sourceCaches;for(const K in V){const Q=V[K];if(!Q.used||(Q!==this.sourceCache&&this.resetTileLookupCache(Q.id),this._setupProxiedCoordsForOrtho(Q,y[K],O),Q.usedForTerrain))continue;const ie=y[K];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(ie)}this.proxiedCoords[S.id]=z.map(K=>new is(K,K.key,this.orthoMatrix)),this._assignTerrainTiles(z),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(O),this.renderingToTexture=!1,this._updateTimestamp=x.exported.now();const Z={};this._visibleDemTiles=[];for(const K of this.proxyCoords){const Q=this.terrainTileForTile[K.key];if(!Q)continue;const ie=Q.tileID.key;ie in Z||(this._visibleDemTiles.push(Q),Z[ie]=ie)}}_assignTerrainTiles(y){this._initializing||y.forEach(S=>{if(this.terrainTileForTile[S.key])return;const D=this._findTileCoveringTileID(S,this.sourceCache);D&&(this.terrainTileForTile[S.key]=D)})}_prepareDEMTextures(){const y=this.painter.context,S=y.gl;for(const D in this.terrainTileForTile){const z=this.terrainTileForTile[D],O=z.dem;!O||z.demTexture&&!z.needsDEMTextureUpload||(y.activeTexture.set(S.TEXTURE1),mr(this.painter,z,O))}}_prepareDemTileUniforms(y,S,D,z){if(!S||S.demTexture==null)return!1;const O=y.tileID.canonical,V=Math.pow(2,S.tileID.canonical.z-O.z),Z=z||"";return D[`u_dem_tl${Z}`]=[O.x*V%1,O.y*V%1],D[`u_dem_scale${Z}`]=V,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const y=this.painter.context,S=y.gl;if(!this._emptyDepthBufferTexture){const D={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new x.Texture(y,D,S.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let y=0;const S=this._visibleDemTiles.reduce((D,z)=>{if(!z.dem)return D;const O=z.dem.tree.minimums[0];return O>0&&y++,D+O},0);return y?S/y:0}_updateEmptyDEMTexture(){const y=this.painter.context,S=y.gl;y.activeTexture.set(S.TEXTURE2);const D=this._getLoadedAreaMinimum(),z={width:1,height:1,data:new Uint8Array(x.DEMData.pack(D,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let O=this._emptyDEMTexture;return O?O.update(z,{premultiply:!1}):O=this._emptyDEMTexture=new x.Texture(y,z,S.RGBA,{premultiply:!1}),O}setupElevationDraw(y,S,D){const z=this.painter.context,O=z.gl,V=(Z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:x.DEMData.getUnpackVector(Z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var Z;V.u_dem_size=this.sourceCache.getSource().tileSize,V.u_exaggeration=this.exaggeration();const K=this.painter.transform,Q=K.projection.createTileTransform(K,K.worldSize),ie=y.tileID.canonical;V.u_tile_tl_up=Q.upVector(ie,0,0),V.u_tile_tr_up=Q.upVector(ie,x.EXTENT,0),V.u_tile_br_up=Q.upVector(ie,x.EXTENT,x.EXTENT),V.u_tile_bl_up=Q.upVector(ie,0,x.EXTENT),V.u_tile_up_scale=Q.upVectorScale(ie);let ae=null,pe=null,Ee=1;if(D&&D.morphing&&this._useVertexMorphing){const xe=D.morphing.srcDemTile,Te=D.morphing.dstDemTile;Ee=D.morphing.phase,xe&&Te&&(this._prepareDemTileUniforms(y,xe,V,"_prev")&&(pe=xe),this._prepareDemTileUniforms(y,Te,V)&&(ae=Te))}if(pe&&ae?(z.activeTexture.set(O.TEXTURE2),ae.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE,O.NEAREST),z.activeTexture.set(O.TEXTURE4),pe.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE,O.NEAREST),V.u_dem_lerp=Ee):(ae=this.terrainTileForTile[y.tileID.key],z.activeTexture.set(O.TEXTURE2),(this._prepareDemTileUniforms(y,ae,V)?ae.demTexture:this.emptyDEMTexture).bind(O.NEAREST,O.CLAMP_TO_EDGE)),z.activeTexture.set(O.TEXTURE3),D&&D.useDepthForOcclusion?(this._depthTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE),V.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE),V.u_depth_size_inv=[1,1]),D&&D.useMeterToDem&&ae){const xe=(1<<ae.tileID.canonical.z)*x.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;V.u_meter_to_dem=xe}D&&D.labelPlaneMatrixInv&&(V.u_label_plane_matrix_inv=D.labelPlaneMatrixInv),S.setTerrainUniformValues(z,V)}renderToBackBuffer(y){const S=this.painter,D=this.painter.context;y.length!==0&&(D.bindFramebuffer.set(null),D.viewport.set([0,0,S.width,S.height]),this.renderingToTexture=!1,function(z,O,V,Z,K){if(z.transform.projection.name==="globe")(function(Q,ie,ae,pe,Ee){const xe=Q.context,Te=xe.gl;let Fe,we;const De=Q.options.showTerrainWireframe?2:0,Be=(dt,it)=>{if(we===dt)return;const Ke=[];it&&Ke.push(ho[De]),Ke.push(ho[dt]),Ke.push("PROJECTION_GLOBE_VIEW"),Fe=Q.useProgram("globeRaster",null,Ke),we=dt},ke=Q.colorModeForRenderPass(),Ce=new x.DepthMode(Te.LEQUAL,x.DepthMode.ReadWrite,Q.depthRangeFor3D);In.update(Ee);const Oe=Q.transform,He=x.calculateGlobeMatrix(Oe,Oe.worldSize),Je=x.calculateGlobeMercatorMatrix(Oe),xt=[x.mercatorXfromLng(Oe.center.lng),x.mercatorYfromLat(Oe.center.lat)],ft=Q.globeSharedBuffers;(De?[!1,!0]:[!1]).forEach(dt=>{we=-1;const it=dt?Te.LINES:Te.TRIANGLES;for(const Ke of pe){const ut=ae.getTile(Ke),st=Math.pow(2,Ke.canonical.z),[Yt,ii]=x.globeBuffersForTileMesh(Q,ut,Ke,st),bi=x.StencilMode.disabled,yt=ie.prevTerrainTileForTile[Ke.key],Jt=ie.terrainTileForTile[Ke.key];hn(yt,Jt)&&In.newMorphing(Ke.key,yt,Jt,Ee,250),xe.activeTexture.set(Te.TEXTURE0),ut.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE);const ui=In.getMorphValuesForProxy(Ke.key),Zi=ui?1:0,Qi={};ui&&x.extend$1(Qi,{morphing:{srcDemTile:ui.from,dstDemTile:ui.to,phase:x.easeCubicInOut(ui.phase)}});const ai=x.globeMatrixForTile(Ke.canonical,He),Mi=Us(Oe.projMatrix,ai,Je,x.globeToMercatorTransition(Oe.zoom),xt);if(Be(Zi,dt),ie.setupElevationDraw(ut,Fe,Qi),Q.prepareDrawProgram(xe,Fe,Ke.toUnwrapped()),ft){const[rr,wr]=dt?ft.getWirefameBuffer(Q.context):[ft.gridIndexBuffer,ft.gridSegments];Fe.draw(xe,it,Ce,bi,ke,x.CullFaceMode.backCCW,Mi,"globe_raster",Yt,rr,wr)}if(!dt){const rr=[Ke.canonical.y===0?x.globePoleMatrixForTile(Ke.canonical,!1,Oe):null,Ke.canonical.y===st-1?x.globePoleMatrixForTile(Ke.canonical,!0,Oe):null];for(const wr of rr){if(!wr)continue;const Hr=Us(Oe.projMatrix,wr,wr,0,xt);ft&&Fe.draw(xe,it,Ce,bi,ke,x.CullFaceMode.disabled,Hr,"globe_pole_raster",ii,ft.poleIndexBuffer,ft.poleSegments)}}}})})(z,O,V,Z,K);else{const Q=z.context,ie=Q.gl;let ae,pe;const Ee=z.options.showTerrainWireframe?2:0,xe=(Be,ke)=>{if(pe===Be)return;const Ce=[ho[Be]];ke&&Ce.push(ho[Ee]),ae=z.useProgram("terrainRaster",null,Ce),pe=Be},Te=z.colorModeForRenderPass(),Fe=new x.DepthMode(ie.LEQUAL,x.DepthMode.ReadWrite,z.depthRangeFor3D);In.update(K);const we=z.transform,De=6*Math.pow(1.5,22-we.zoom)*O.exaggeration();(Ee?[!1,!0]:[!1]).forEach(Be=>{pe=-1;const ke=Be?ie.LINES:ie.TRIANGLES,[Ce,Oe]=Be?O.getWirefameBuffer():[O.gridIndexBuffer,O.gridSegments];for(const He of Z){const Je=V.getTile(He),xt=x.StencilMode.disabled,ft=O.prevTerrainTileForTile[He.key],dt=O.terrainTileForTile[He.key];hn(ft,dt)&&In.newMorphing(He.key,ft,dt,K,250),Q.activeTexture.set(ie.TEXTURE0),Je.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST);const it=In.getMorphValuesForProxy(He.key),Ke=it?1:0;let ut;it&&(ut={morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:x.easeCubicInOut(it.phase)}});const st=Ar(He.projMatrix,nc(He.canonical,we.renderWorldCopies)?De/10:De);xe(Ke,Be),O.setupElevationDraw(Je,ae,ut),z.prepareDrawProgram(Q,ae,He.toUnwrapped()),ae.draw(Q,ke,Fe,xt,Te,x.CullFaceMode.backCCW,st,"terrain_raster",O.gridBuffer,Ce,Oe)}})}}(S,this,this.proxySourceCache,y,this._updateTimestamp),this.renderingToTexture=!0,y.splice(0,y.length))}renderBatch(y){if(this._drapedRenderBatches.length===0)return y+1;this.renderingToTexture=!0;const S=this.painter,D=this.painter.context,z=this.proxySourceCache,O=this.proxiedCoords[z.id],V=this._drapedRenderBatches.shift(),Z=[],K=S.style.order;let Q=0;for(const ie of O){const ae=z.getTileByID(ie.proxyTileKey),pe=z.proxyCachedFBO[ie.key]?z.proxyCachedFBO[ie.key][y]:void 0,Ee=pe!==void 0?z.renderCache[pe]:this.pool[Q++],xe=pe!==void 0;if(ae.texture=Ee.tex,xe&&!Ee.dirty){Z.push(ae.tileID);continue}let Te;D.bindFramebuffer.set(Ee.fb.framebuffer),this.renderedToTile=!1,Ee.dirty&&(D.clear({color:x.Color.transparent,stencil:0}),Ee.dirty=!1);for(let Fe=V.start;Fe<=V.end;++Fe){const we=S.style._layers[K[Fe]];if(we.isHidden(S.transform.zoom))continue;const De=S.style._getLayerSourceCache(we),Be=De?this.proxyToSource[ie.key][De.id]:[ie];if(!Be)continue;const ke=Be;D.viewport.set([0,0,Ee.fb.width,Ee.fb.height]),Te!==(De?De.id:null)&&(this._setupStencil(Ee,Be,we,De),Te=De?De.id:null),S.renderLayer(S,De,we,ke)}this.renderedToTile?(Ee.dirty=!0,Z.push(ae.tileID)):xe||--Q,Q===5&&(Q=0,this.renderToBackBuffer(Z))}return this.renderToBackBuffer(Z),this.renderingToTexture=!1,D.bindFramebuffer.set(null),D.viewport.set([0,0,S.width,S.height]),V.end+1}postRender(){}renderCacheEfficiency(y){const S=y.order.length;if(S===0)return{efficiency:100};let D,z=0,O=0,V=!1;for(let Z=0;Z<S;++Z){const K=y._layers[y.order[Z]];this._style.isLayerDraped(K)?(V&&++z,++O):V||(V=!0,D=K.id)}return O===0?{efficiency:100}:{efficiency:100*(1-z/O),firstUndrapedLayer:D}}getMinElevationBelowMSL(){let y=0;return this._visibleDemTiles.filter(S=>S.dem).forEach(S=>{y=Math.min(y,S.dem.tree.minimums[0])}),y===0?y:(y-30)*this._exaggeration}raycast(y,S,D){if(!this._visibleDemTiles)return null;const z=this._visibleDemTiles.filter(O=>O.dem).map(O=>{const V=O.tileID,Z=Math.pow(2,V.overscaledZ),{x:K,y:Q}=V.canonical,ie=K/Z,ae=(K+1)/Z,pe=Q/Z,Ee=(Q+1)/Z;return{minx:ie,miny:pe,maxx:ae,maxy:Ee,t:O.dem.tree.raycastRoot(ie,pe,ae,Ee,y,S,D),tile:O}});z.sort((O,V)=>(O.t!==null?O.t:Number.MAX_VALUE)-(V.t!==null?V.t:Number.MAX_VALUE));for(const O of z){if(O.t==null)return null;const V=O.tile.dem.tree.raycast(O.minx,O.miny,O.maxx,O.maxy,y,S,D);if(V!=null)return V}return null}_createFBO(){const y=this.painter.context,S=y.gl,D=this.drapeBufferSize;y.activeTexture.set(S.TEXTURE0);const z=new x.Texture(y,{width:D[0],height:D[1],data:null},S.RGBA);z.bind(S.LINEAR,S.CLAMP_TO_EDGE);const O=y.createFramebuffer(D[0],D[1],!1);return O.colorAttachment.set(z.texture),O.depthAttachment=new Xi(y,O.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=y.createRenderbuffer(y.gl.DEPTH_STENCIL,D[0],D[1]),this._stencilRef=0,O.depthAttachment.set(this._sharedDepthStencil),y.clear({stencil:0})):O.depthAttachment.set(this._sharedDepthStencil),y.extTextureFilterAnisotropic&&!y.extTextureFilterAnisotropicForceOff&&S.texParameterf(S.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax),{fb:O,tex:z,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y].hasTransition())return!0;return this._style.order.some(y=>{const S=this._style._layers[y],D=S.isHidden(this.painter.transform.zoom),z=S.getCrossfadeParameters(),O=!!z&&z.t!==1,V=S.hasTransition();return S.type!=="custom"&&!D&&(O||V)})}_clearRasterFadeFromRenderCache(){let y=!1;for(const S in this._style._sourceCaches)if(this._style._sourceCaches[S]._source instanceof Tr){y=!0;break}if(y)for(let S=0;S<this._style.order.length;++S){const D=this._style._layers[this._style.order[S]],z=D.isHidden(this.painter.transform.zoom),O=this._style._getLayerSourceCache(D);if(D.type!=="raster"||z||!O)continue;const V=D.paint.get("raster-fade-duration");for(const Z of this.proxyCoords){const K=this.proxyToSource[Z.key][O.id];if(K)for(const Q of K){const ie=$l(O.getTile(Q),O.findLoadedParent(Q,0),O,this.painter.transform,V);(ie.opacity!==1||ie.mix!==0)&&this._clearRenderCacheForTile(O.id,Q)}}}}_setupDrapedRenderBatches(){const y=this._style.order,S=y.length;if(S===0)return;const D=[];let z,O=0,V=this._style._layers[y[O]];for(;!this._style.isLayerDraped(V)&&V.isHidden(this.painter.transform.zoom)&&++O<S;)V=this._style._layers[y[O]];for(;O<S;++O){const Z=this._style._layers[y[O]];Z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Z)?z===void 0&&(z=O):z!==void 0&&(D.push({start:z,end:O-1}),z=void 0))}z!==void 0&&D.push({start:z,end:O-1}),this._drapedRenderBatches=D}_setupRenderCache(y){const S=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,S.renderCache.length>S.renderCachePool.length){const V=Object.values(S.proxyCachedFBO);S.proxyCachedFBO={};for(let Z=0;Z<V.length;++Z){const K=Object.values(V[Z]);S.renderCachePool.push(...K)}}return}this._clearRasterFadeFromRenderCache();const D=this.proxyCoords,z=this._tilesDirty;for(let V=D.length-1;V>=0;V--){const Z=D[V];if(S.getTileByID(Z.key),S.proxyCachedFBO[Z.key]!==void 0){const K=y[Z.key],Q=this.proxyToSource[Z.key];let ie=0;for(const ae in Q){const pe=Q[ae],Ee=K[ae];if(!Ee||Ee.length!==pe.length||pe.some((xe,Te)=>xe!==Ee[Te]||z[ae]&&z[ae].hasOwnProperty(xe.key))){ie=-1;break}++ie}for(const ae in S.proxyCachedFBO[Z.key])S.renderCache[S.proxyCachedFBO[Z.key][ae]].dirty=ie<0||ie!==Object.values(K).length}}const O=[...this._drapedRenderBatches];O.sort((V,Z)=>Z.end-Z.start-(V.end-V.start));for(const V of O)for(const Z of D){if(S.proxyCachedFBO[Z.key])continue;let K=S.renderCachePool.pop();K===void 0&&S.renderCache.length<50&&(K=S.renderCache.length,S.renderCache.push(this._createFBO())),K!==void 0&&(S.proxyCachedFBO[Z.key]={},S.proxyCachedFBO[Z.key][V.start]=K,S.renderCache[K].dirty=!0)}this._tilesDirty={}}_setupStencil(y,S,D,z){if(!z||!this._sourceTilesOverlap[z.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const O=this.painter.context,V=O.gl;if(S.length<=1)return void(this._overlapStencilType=!1);let Z;if(D.isTileClipped())Z=S.length,this._overlapStencilMode.test={func:V.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(S[0].overscaledZ>S[S.length-1].overscaledZ))return void(this._overlapStencilType=!1);Z=1,this._overlapStencilMode.test={func:V.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Z>255&&(O.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Z,this._overlapStencilMode.ref=this._stencilRef,D.isTileClipped()&&this._renderTileClippingMasks(S,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(y){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[y.key]),this._overlapStencilMode):x.StencilMode.disabled}_renderTileClippingMasks(y,S){const D=this.painter,z=this.painter.context,O=z.gl;D._tileClippingMaskIDs={},z.setColorMode(x.ColorMode.disabled),z.setDepthMode(x.DepthMode.disabled);const V=D.useProgram("clippingMask");for(const Z of y){const K=D._tileClippingMaskIDs[Z.key]=--S;V.draw(z,O.TRIANGLES,x.DepthMode.disabled,new x.StencilMode({func:O.ALWAYS,mask:0},K,255,O.KEEP,O.KEEP,O.REPLACE),x.ColorMode.disabled,x.CullFaceMode.disabled,kn(Z.projMatrix),"$clipping",D.tileExtentBuffer,D.quadTriangleIndexBuffer,D.tileExtentSegments)}}pointCoordinate(y){const S=this.painter.transform;if(y.x<0||y.x>S.width||y.y<0||y.y>S.height)return null;const D=[y.x,y.y,1,1];x.transformMat4$1(D,D,S.pixelMatrixInverse),x.scale$1(D,D,1/D[3]),D[0]/=S.worldSize,D[1]/=S.worldSize;const z=S._camera.position,O=x.mercatorZfromAltitude(1,S.center.lat),V=[z[0],z[1],z[2]/O,0],Z=x.subtract([],D.slice(0,3),V);x.normalize(Z,Z);const K=this.raycast(V,Z,this._exaggeration);return K!==null&&K?(x.scaleAndAdd(V,V,Z,K),V[3]=V[2],V[2]*=O,V):null}drawDepth(){const y=this.painter,S=y.context,D=this.proxySourceCache,z=Math.ceil(y.width),O=Math.ceil(y.height);if(!this._depthFBO||this._depthFBO.width===z&&this._depthFBO.height===O||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const V=S.gl,Z=S.createFramebuffer(z,O,!0);S.activeTexture.set(V.TEXTURE0);const K=new x.Texture(S,{width:z,height:O,data:null},V.RGBA);K.bind(V.NEAREST,V.CLAMP_TO_EDGE),Z.colorAttachment.set(K.texture);const Q=S.createRenderbuffer(S.gl.DEPTH_COMPONENT16,z,O);Z.depthAttachment.set(Q),this._depthFBO=Z,this._depthTexture=K}S.bindFramebuffer.set(this._depthFBO.framebuffer),S.viewport.set([0,0,z,O]),function(V,Z,K,Q){if(V.transform.projection.name==="globe")return;const ie=V.context,ae=ie.gl;ie.clear({depth:1});const pe=V.useProgram("terrainDepth"),Ee=new x.DepthMode(ae.LESS,x.DepthMode.ReadWrite,V.depthRangeFor3D);for(const xe of Q){const Te=K.getTile(xe),Fe=Ar(xe.projMatrix,0);Z.setupElevationDraw(Te,pe),pe.draw(ie,ae.TRIANGLES,Ee,x.StencilMode.disabled,x.ColorMode.unblended,x.CullFaceMode.backCCW,Fe,"terrain_depth",Z.gridBuffer,Z.gridIndexBuffer,Z.gridNoSkirtSegments)}}(y,this,D,this.proxyCoords)}_setupProxiedCoordsForOrtho(y,S,D){if(y.getSource()instanceof Sr)return this._setupProxiedCoordsForImageSource(y,S,D);this._findCoveringTileCache[y.id]=this._findCoveringTileCache[y.id]||{};const z=this.proxiedCoords[y.id]=[],O=this.proxyCoords;for(let Z=0;Z<O.length;Z++){const K=O[Z],Q=this._findTileCoveringTileID(K,y);if(Q){const ie=this._createProxiedId(K,Q,D[K.key]&&D[K.key][y.id]);z.push(ie),this.proxyToSource[K.key][y.id]=[ie]}}let V=!1;for(let Z=0;Z<S.length;Z++){const K=y.getTile(S[Z]);if(!K||!K.hasData())continue;const Q=this._findTileCoveringTileID(K.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==K.tileID.canonical.z){const ie=this.proxyToSource[Q.tileID.key][y.id],ae=this._createProxiedId(Q.tileID,K,D[Q.tileID.key]&&D[Q.tileID.key][y.id]);ie?ie.splice(ie.length-1,0,ae):this.proxyToSource[Q.tileID.key][y.id]=[ae],z.push(ae),V=!0}}this._sourceTilesOverlap[y.id]=V}_setupProxiedCoordsForImageSource(y,S,D){if(!y.getSource().loaded())return;const z=this.proxiedCoords[y.id]=[],O=this.proxyCoords,V=y.getSource(),Z=new x.pointGeometry(V.tileID.x,V.tileID.y)._div(1<<V.tileID.z),K=V.coordinates.map(x.MercatorCoordinate.fromLngLat).reduce((ie,ae)=>(ie.min.x=Math.min(ie.min.x,ae.x-Z.x),ie.min.y=Math.min(ie.min.y,ae.y-Z.y),ie.max.x=Math.max(ie.max.x,ae.x-Z.x),ie.max.y=Math.max(ie.max.y,ae.y-Z.y),ie),{min:new x.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new x.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(ie,ae)=>{const pe=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),Ee=ie.canonical.y/(1<<ie.canonical.z),xe=x.EXTENT/(1<<ie.canonical.z),Te=ae.wrap+ae.canonical.x/(1<<ae.canonical.z),Fe=ae.canonical.y/(1<<ae.canonical.z);return pe+xe<Te+K.min.x||pe>Te+K.max.x||Ee+xe<Fe+K.min.y||Ee>Fe+K.max.y};for(let ie=0;ie<O.length;ie++){const ae=O[ie];for(let pe=0;pe<S.length;pe++){const Ee=y.getTile(S[pe]);if(!Ee||!Ee.hasData()||Q(ae,Ee.tileID))continue;const xe=this._createProxiedId(ae,Ee,D[ae.key]&&D[ae.key][y.id]),Te=this.proxyToSource[ae.key][y.id];Te?Te.push(xe):this.proxyToSource[ae.key][y.id]=[xe],z.push(xe)}}}_createProxiedId(y,S,D){let z=this.orthoMatrix;if(D){const O=D.find(V=>V.key===S.tileID.key);if(O)return O}if(S.tileID.key!==y.key){const O=y.canonical.z-S.tileID.canonical.z;let V,Z,K;z=x.create();const Q=S.tileID.wrap-y.wrap<<y.overscaledZ;O>0?(V=x.EXTENT>>O,Z=V*((S.tileID.canonical.x<<O)-y.canonical.x+Q),K=V*((S.tileID.canonical.y<<O)-y.canonical.y)):(V=x.EXTENT<<-O,Z=x.EXTENT*(S.tileID.canonical.x-(y.canonical.x+Q<<-O)),K=x.EXTENT*(S.tileID.canonical.y-(y.canonical.y<<-O))),x.ortho(z,0,V,0,V,0,1),x.translate(z,z,[Z,K,0])}return new is(S.tileID,y.key,z)}_findTileCoveringTileID(y,S){let D=S.getTile(y);if(D&&D.hasData())return D;const z=this._findCoveringTileCache[S.id],O=z[y.key];if(D=O?S.getTileByID(O):null,D&&D.hasData()||O===null)return D;let V=D?D.tileID:y,Z=V.overscaledZ;const K=S.getSource().minzoom,Q=[];if(!O){const ae=S.getSource().maxzoom;if(y.canonical.z>=ae){const pe=y.canonical.z-ae;S.getSource().reparseOverscaled?(Z=Math.max(y.canonical.z+2,S.transform.tileZoom),V=new x.OverscaledTileID(Z,y.wrap,ae,y.canonical.x>>pe,y.canonical.y>>pe)):pe!==0&&(Z=ae,V=new x.OverscaledTileID(Z,y.wrap,ae,y.canonical.x>>pe,y.canonical.y>>pe))}V.key!==y.key&&(Q.push(V.key),D=S.getTile(V))}const ie=ae=>{Q.forEach(pe=>{z[pe]=ae}),Q.length=0};for(Z-=1;Z>=K&&(!D||!D.hasData());Z--){D&&ie(D.tileID.key);const ae=V.calculateScaledKey(Z);if(D=S.getTileByID(ae),D&&D.hasData())break;const pe=z[ae];if(pe===null)break;pe===void 0?Q.push(ae):D=S.getTileByID(pe)}return ie(D?D.tileID.key:null),D&&D.hasData()?D:null}findDEMTileFor(y){return this.enabled?this._findTileCoveringTileID(y,this.sourceCache):null}prepareDrawTile(y){this.renderedToTile=!0}_clearRenderCacheForTile(y,S){let D=this._tilesDirty[y];D||(D=this._tilesDirty[y]={}),D[S.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const y=function(S){let D,z,O;const V=new x.StructArrayLayout2ui4,Z=131;for(z=1;z<129;z++){for(D=1;D<129;D++)O=z*Z+D,V.emplaceBack(O,O+1),V.emplaceBack(O,O+Z),V.emplaceBack(O+1,O+Z),z===128&&V.emplaceBack(O+Z,O+Z+1);V.emplaceBack(O+1,O+1+Z)}return V}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(y),this.wireframeSegments=x.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,y.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Vs(C){const y=[];for(let S=0;S<C.length;S++){if(C[S]===null)continue;const D=C[S].split(" ");y.push(D.pop())}return y}class rs{static cacheKey(y,S,D){let z=`${y}${D?D.cacheKey:""}`;for(const O of S)z+=`/${O}`;return z}constructor(y,S,D,z,O,V){const Z=y.gl;this.program=Z.createProgram();const K=Vs(D.staticAttributes),Q=z?z.getBinderAttributes():[],ie=K.concat(Q),ae=D.staticUniforms?Vs(D.staticUniforms):[],pe=z?z.getBinderUniforms():[],Ee=ae.concat(pe),xe=[];for(const Ce of Ee)xe.indexOf(Ce)<0&&xe.push(Ce);let Te=z?z.defines():[];Te=Te.concat(V.map(Ce=>`#define ${Ce}`));const Fe=Te.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,$s,Oi.fragmentSource,Ao.fragmentSource,D.fragmentSource).join(`
`),we=Te.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,$s,Oi.vertexSource,Ao.vertexSource,So.vertexSource,D.vertexSource).join(`
`),De=Z.createShader(Z.FRAGMENT_SHADER);if(Z.isContextLost())return void(this.failedToCreate=!0);Z.shaderSource(De,Fe),Z.compileShader(De),Z.attachShader(this.program,De);const Be=Z.createShader(Z.VERTEX_SHADER);if(Z.isContextLost())return void(this.failedToCreate=!0);Z.shaderSource(Be,we),Z.compileShader(Be),Z.attachShader(this.program,Be),this.attributes={};const ke={};this.numAttributes=ie.length;for(let Ce=0;Ce<this.numAttributes;Ce++)ie[Ce]&&(Z.bindAttribLocation(this.program,Ce,ie[Ce]),this.attributes[ie[Ce]]=Ce);Z.linkProgram(this.program),Z.deleteShader(Be),Z.deleteShader(De);for(let Ce=0;Ce<xe.length;Ce++){const Oe=xe[Ce];if(Oe&&!ke[Oe]){const He=Z.getUniformLocation(this.program,Oe);He&&(ke[Oe]=He)}}this.fixedUniforms=O(y,ke),this.binderUniforms=z?z.getUniforms(y,ke):[],V.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Ce,Oe)=>({u_dem:new x.Uniform1i(Ce,Oe.u_dem),u_dem_prev:new x.Uniform1i(Ce,Oe.u_dem_prev),u_dem_unpack:new x.Uniform4f(Ce,Oe.u_dem_unpack),u_dem_tl:new x.Uniform2f(Ce,Oe.u_dem_tl),u_dem_scale:new x.Uniform1f(Ce,Oe.u_dem_scale),u_dem_tl_prev:new x.Uniform2f(Ce,Oe.u_dem_tl_prev),u_dem_scale_prev:new x.Uniform1f(Ce,Oe.u_dem_scale_prev),u_dem_size:new x.Uniform1f(Ce,Oe.u_dem_size),u_dem_lerp:new x.Uniform1f(Ce,Oe.u_dem_lerp),u_exaggeration:new x.Uniform1f(Ce,Oe.u_exaggeration),u_depth:new x.Uniform1i(Ce,Oe.u_depth),u_depth_size_inv:new x.Uniform2f(Ce,Oe.u_depth_size_inv),u_meter_to_dem:new x.Uniform1f(Ce,Oe.u_meter_to_dem),u_label_plane_matrix_inv:new x.UniformMatrix4f(Ce,Oe.u_label_plane_matrix_inv),u_tile_tl_up:new x.Uniform3f(Ce,Oe.u_tile_tl_up),u_tile_tr_up:new x.Uniform3f(Ce,Oe.u_tile_tr_up),u_tile_br_up:new x.Uniform3f(Ce,Oe.u_tile_br_up),u_tile_bl_up:new x.Uniform3f(Ce,Oe.u_tile_bl_up),u_tile_up_scale:new x.Uniform1f(Ce,Oe.u_tile_up_scale)}))(y,ke)),V.indexOf("FOG")!==-1&&(this.fogUniforms=((Ce,Oe)=>({u_fog_matrix:new x.UniformMatrix4f(Ce,Oe.u_fog_matrix),u_fog_range:new x.Uniform2f(Ce,Oe.u_fog_range),u_fog_color:new x.Uniform4f(Ce,Oe.u_fog_color),u_fog_horizon_blend:new x.Uniform1f(Ce,Oe.u_fog_horizon_blend),u_fog_temporal_offset:new x.Uniform1f(Ce,Oe.u_fog_temporal_offset)}))(y,ke))}setTerrainUniformValues(y,S){if(!this.terrainUniforms)return;const D=this.terrainUniforms;if(!this.failedToCreate){y.program.set(this.program);for(const z in S)D[z].set(S[z])}}setFogUniformValues(y,S){if(!this.fogUniforms)return;const D=this.fogUniforms;if(!this.failedToCreate){y.program.set(this.program);for(const z in S)D[z].location&&D[z].set(S[z])}}draw(y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe,Te,Fe){const we=y.gl;if(this.failedToCreate)return;y.program.set(this.program),y.setDepthMode(D),y.setStencilMode(z),y.setColorMode(O),y.setCullFace(V);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(Z[Be]);xe&&xe.setUniforms(y,this.binderUniforms,pe,{zoom:Ee});const De={[we.LINES]:2,[we.TRIANGLES]:3,[we.LINE_STRIP]:1}[S];for(const Be of ae.get()){const ke=Be.vaos||(Be.vaos={});(ke[K]||(ke[K]=new ln)).bind(y,this,Q,xe?xe.getPaintVertexBuffers():[],ie,Be.vertexOffset,Te,Fe),we.drawElements(S,Be.primitiveLength*De,we.UNSIGNED_SHORT,Be.primitiveOffset*De*2)}}}function Ul(C,y,S){const D=1/Lt(S,1,y.transform.tileZoom),z=Math.pow(2,S.tileID.overscaledZ),O=S.tileSize*Math.pow(2,y.transform.tileZoom)/z,V=O*(S.tileID.canonical.x+S.tileID.wrap*z),Z=O*S.tileID.canonical.y;return{u_image:0,u_texsize:S.imageAtlasTexture.size,u_scale:[D,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[V>>16,Z>>16],u_pixel_coord_lower:[65535&V,65535&Z]}}const Vl=(C,y,S,D)=>{const z=y.style.light,O=z.properties.get("position"),V=[O.x,O.y,O.z],Z=x.create$1();z.properties.get("anchor")==="viewport"&&(x.fromRotation(Z,-y.transform.angle),x.transformMat3(V,V,Z));const K=z.properties.get("color");return{u_matrix:C,u_lightpos:V,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+S,u_opacity:D}},Oa=(C,y,S,D,z,O,V)=>x.extend(Vl(C,y,S,D),Ul(O,y,V),{u_height_factor:-Math.pow(2,z.overscaledZ)/V.tileSize/8}),jl=C=>({u_matrix:C}),$a=(C,y,S,D)=>x.extend(jl(C),Ul(S,y,D)),oc=(C,y)=>({u_matrix:C,u_world:y}),Gl=(C,y,S,D,z)=>x.extend($a(C,y,S,D),{u_world:z}),sc=(C,y,S,D)=>{const z=C.transform;let O;return O=D.paint.get("circle-pitch-alignment")==="map"?z.calculatePixelsToTileUnitsMatrix(S):new Float32Array([z.pixelsToGLUnits[0],0,0,z.pixelsToGLUnits[1]]),{u_camera_to_center_distance:z.cameraToCenterDistance,u_matrix:C.translatePosMatrix(y.projMatrix,S,D.paint.get("circle-translate"),D.paint.get("circle-translate-anchor")),u_device_pixel_ratio:x.exported.devicePixelRatio,u_extrude_scale:O}},Na=C=>{const y=[];return C.paint.get("circle-pitch-alignment")==="map"&&y.push("PITCH_WITH_MAP"),C.paint.get("circle-pitch-scale")==="map"&&y.push("SCALE_WITH_MAP"),y},ql=(C,y,S)=>{const D=x.EXTENT/S.tileSize;return{u_matrix:C,u_camera_to_center_distance:y.cameraToCenterDistance,u_extrude_scale:[y.pixelsToGLUnits[0]/D,y.pixelsToGLUnits[1]/D]}},Ua=(C,y,S=1)=>({u_matrix:C,u_color:y,u_overlay:0,u_overlay_scale:S}),Zl=(C,y,S,D)=>({u_matrix:C,u_extrude_scale:Lt(y,1,S),u_intensity:D}),Xl=(C,y,S,D,z,O)=>{const V=C.transform,Z=V.calculatePixelsToTileUnitsMatrix(y),K={u_matrix:ns(C,y,S,z),u_pixels_to_tile_units:Z,u_device_pixel_ratio:x.exported.devicePixelRatio,u_units_to_pixels:[1/V.pixelsToGLUnits[0],1/V.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:O,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(os(S)){const Q=Io(y,C.transform);K.u_texsize=y.lineAtlasTexture.size,K.u_scale=[Q,D.fromScale,D.toScale],K.u_mix=D.t}return K},co=(C,y,S,D,z)=>{const O=C.transform,V=Io(y,O);return{u_matrix:ns(C,y,S,z),u_texsize:y.imageAtlasTexture.size,u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(y),u_device_pixel_ratio:x.exported.devicePixelRatio,u_image:0,u_scale:[V,D.fromScale,D.toScale],u_fade:D.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Io(C,y){return 1/Lt(C,1,y.tileZoom)}function ns(C,y,S,D){return C.translatePosMatrix(D||y.tileID.projMatrix,y,S.paint.get("line-translate"),S.paint.get("line-translate-anchor"))}function os(C){const y=C.paint.get("line-dasharray").value;return y.value||y.kind!=="constant"}const js=(C,y,S,D,z,O)=>{return{u_matrix:C,u_tl_parent:y,u_scale_parent:S,u_fade_t:D.mix,u_opacity:D.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:(Z=z.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(V=z.paint.get("raster-contrast"),V>0?1/(1-V):1+V),u_spin_weights:Gs(z.paint.get("raster-hue-rotate")),u_perspective_transform:O};var V,Z};function Gs(C){C*=Math.PI/180;const y=Math.sin(C),S=Math.cos(C);return[(2*S+1)/3,(-Math.sqrt(3)*y-S+1)/3,(Math.sqrt(3)*y-S+1)/3]}const qs=(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee)=>{const xe=z.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:y?y.uSizeT:0,u_size:y?y.uSize:0,u_camera_to_center_distance:xe.cameraToCenterDistance,u_pitch:xe.pitch/360*2*Math.PI,u_rotate_symbol:+S,u_aspect_ratio:xe.width/xe.height,u_fade_change:z.options.fadeDuration?z.symbolFadeChange:1,u_matrix:O,u_label_plane_matrix:V,u_coord_matrix:Z,u_is_text:+K,u_pitch_with_map:+D,u_texsize:Q,u_tile_id:ie,u_zoom_transition:ae,u_inv_rot_matrix:pe,u_merc_center:Ee,u_texture:0}},ss=(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee,xe)=>{const{cameraToCenterDistance:Te,_pitch:Fe}=z.transform;return x.extend(qs(C,y,S,D,z,O,V,Z,K,Q,ae,pe,Ee,xe),{u_gamma_scale:D?Te*Math.cos(z.terrain?0:Fe):1,u_device_pixel_ratio:x.exported.devicePixelRatio,u_is_halo:+ie})},as=(C,y,S,D,z,O,V,Z,K,Q,ie,ae,pe,Ee)=>x.extend(ss(C,y,S,D,z,O,V,Z,!0,K,!0,ie,ae,pe,Ee),{u_texsize_icon:Q,u_texture_icon:1}),Gi=(C,y,S)=>({u_matrix:C,u_opacity:y,u_color:S}),Zs=(C,y,S,D,z,O)=>x.extend(function(V,Z,K,Q){const ie=K.imageManager.getPattern(V.from.toString()),ae=K.imageManager.getPattern(V.to.toString()),{width:pe,height:Ee}=K.imageManager.getPixelSize(),xe=Math.pow(2,Q.tileID.overscaledZ),Te=Q.tileSize*Math.pow(2,K.transform.tileZoom)/xe,Fe=Te*(Q.tileID.canonical.x+Q.tileID.wrap*xe),we=Te*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ie.tl,u_pattern_br_a:ie.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[pe,Ee],u_mix:Z.t,u_pattern_size_a:ie.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:Z.fromScale,u_scale_b:Z.toScale,u_tile_units_to_pixels:1/Lt(Q,1,K.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,we>>16],u_pixel_coord_lower:[65535&Fe,65535&we]}}(D,O,S,z),{u_matrix:C,u_opacity:y}),Yl={fillExtrusion:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_lightpos:new x.Uniform3f(C,y.u_lightpos),u_lightintensity:new x.Uniform1f(C,y.u_lightintensity),u_lightcolor:new x.Uniform3f(C,y.u_lightcolor),u_vertical_gradient:new x.Uniform1f(C,y.u_vertical_gradient),u_opacity:new x.Uniform1f(C,y.u_opacity)}),fillExtrusionPattern:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_lightpos:new x.Uniform3f(C,y.u_lightpos),u_lightintensity:new x.Uniform1f(C,y.u_lightintensity),u_lightcolor:new x.Uniform3f(C,y.u_lightcolor),u_vertical_gradient:new x.Uniform1f(C,y.u_vertical_gradient),u_height_factor:new x.Uniform1f(C,y.u_height_factor),u_image:new x.Uniform1i(C,y.u_image),u_texsize:new x.Uniform2f(C,y.u_texsize),u_pixel_coord_upper:new x.Uniform2f(C,y.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(C,y.u_pixel_coord_lower),u_scale:new x.Uniform3f(C,y.u_scale),u_fade:new x.Uniform1f(C,y.u_fade),u_opacity:new x.Uniform1f(C,y.u_opacity)}),fill:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix)}),fillPattern:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_image:new x.Uniform1i(C,y.u_image),u_texsize:new x.Uniform2f(C,y.u_texsize),u_pixel_coord_upper:new x.Uniform2f(C,y.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(C,y.u_pixel_coord_lower),u_scale:new x.Uniform3f(C,y.u_scale),u_fade:new x.Uniform1f(C,y.u_fade)}),fillOutline:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_world:new x.Uniform2f(C,y.u_world)}),fillOutlinePattern:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_world:new x.Uniform2f(C,y.u_world),u_image:new x.Uniform1i(C,y.u_image),u_texsize:new x.Uniform2f(C,y.u_texsize),u_pixel_coord_upper:new x.Uniform2f(C,y.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(C,y.u_pixel_coord_lower),u_scale:new x.Uniform3f(C,y.u_scale),u_fade:new x.Uniform1f(C,y.u_fade)}),circle:(C,y)=>({u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_extrude_scale:new x.UniformMatrix2f(C,y.u_extrude_scale),u_device_pixel_ratio:new x.Uniform1f(C,y.u_device_pixel_ratio),u_matrix:new x.UniformMatrix4f(C,y.u_matrix)}),collisionBox:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_extrude_scale:new x.Uniform2f(C,y.u_extrude_scale)}),collisionCircle:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_inv_matrix:new x.UniformMatrix4f(C,y.u_inv_matrix),u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_viewport_size:new x.Uniform2f(C,y.u_viewport_size)}),debug:(C,y)=>({u_color:new x.UniformColor(C,y.u_color),u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_overlay:new x.Uniform1i(C,y.u_overlay),u_overlay_scale:new x.Uniform1f(C,y.u_overlay_scale)}),clippingMask:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix)}),heatmap:(C,y)=>({u_extrude_scale:new x.Uniform1f(C,y.u_extrude_scale),u_intensity:new x.Uniform1f(C,y.u_intensity),u_matrix:new x.UniformMatrix4f(C,y.u_matrix)}),heatmapTexture:(C,y)=>({u_image:new x.Uniform1i(C,y.u_image),u_color_ramp:new x.Uniform1i(C,y.u_color_ramp),u_opacity:new x.Uniform1f(C,y.u_opacity)}),hillshade:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_image:new x.Uniform1i(C,y.u_image),u_latrange:new x.Uniform2f(C,y.u_latrange),u_light:new x.Uniform2f(C,y.u_light),u_shadow:new x.UniformColor(C,y.u_shadow),u_highlight:new x.UniformColor(C,y.u_highlight),u_accent:new x.UniformColor(C,y.u_accent)}),hillshadePrepare:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_image:new x.Uniform1i(C,y.u_image),u_dimension:new x.Uniform2f(C,y.u_dimension),u_zoom:new x.Uniform1f(C,y.u_zoom),u_unpack:new x.Uniform4f(C,y.u_unpack)}),line:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_pixels_to_tile_units:new x.UniformMatrix2f(C,y.u_pixels_to_tile_units),u_device_pixel_ratio:new x.Uniform1f(C,y.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(C,y.u_units_to_pixels),u_dash_image:new x.Uniform1i(C,y.u_dash_image),u_gradient_image:new x.Uniform1i(C,y.u_gradient_image),u_image_height:new x.Uniform1f(C,y.u_image_height),u_texsize:new x.Uniform2f(C,y.u_texsize),u_scale:new x.Uniform3f(C,y.u_scale),u_mix:new x.Uniform1f(C,y.u_mix),u_alpha_discard_threshold:new x.Uniform1f(C,y.u_alpha_discard_threshold)}),linePattern:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_texsize:new x.Uniform2f(C,y.u_texsize),u_pixels_to_tile_units:new x.UniformMatrix2f(C,y.u_pixels_to_tile_units),u_device_pixel_ratio:new x.Uniform1f(C,y.u_device_pixel_ratio),u_image:new x.Uniform1i(C,y.u_image),u_units_to_pixels:new x.Uniform2f(C,y.u_units_to_pixels),u_scale:new x.Uniform3f(C,y.u_scale),u_fade:new x.Uniform1f(C,y.u_fade),u_alpha_discard_threshold:new x.Uniform1f(C,y.u_alpha_discard_threshold)}),raster:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_tl_parent:new x.Uniform2f(C,y.u_tl_parent),u_scale_parent:new x.Uniform1f(C,y.u_scale_parent),u_fade_t:new x.Uniform1f(C,y.u_fade_t),u_opacity:new x.Uniform1f(C,y.u_opacity),u_image0:new x.Uniform1i(C,y.u_image0),u_image1:new x.Uniform1i(C,y.u_image1),u_brightness_low:new x.Uniform1f(C,y.u_brightness_low),u_brightness_high:new x.Uniform1f(C,y.u_brightness_high),u_saturation_factor:new x.Uniform1f(C,y.u_saturation_factor),u_contrast_factor:new x.Uniform1f(C,y.u_contrast_factor),u_spin_weights:new x.Uniform3f(C,y.u_spin_weights),u_perspective_transform:new x.Uniform2f(C,y.u_perspective_transform)}),symbolIcon:(C,y)=>({u_is_size_zoom_constant:new x.Uniform1i(C,y.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(C,y.u_is_size_feature_constant),u_size_t:new x.Uniform1f(C,y.u_size_t),u_size:new x.Uniform1f(C,y.u_size),u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_pitch:new x.Uniform1f(C,y.u_pitch),u_rotate_symbol:new x.Uniform1i(C,y.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(C,y.u_aspect_ratio),u_fade_change:new x.Uniform1f(C,y.u_fade_change),u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(C,y.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(C,y.u_coord_matrix),u_is_text:new x.Uniform1i(C,y.u_is_text),u_pitch_with_map:new x.Uniform1i(C,y.u_pitch_with_map),u_texsize:new x.Uniform2f(C,y.u_texsize),u_tile_id:new x.Uniform3f(C,y.u_tile_id),u_zoom_transition:new x.Uniform1f(C,y.u_zoom_transition),u_inv_rot_matrix:new x.UniformMatrix4f(C,y.u_inv_rot_matrix),u_merc_center:new x.Uniform2f(C,y.u_merc_center),u_texture:new x.Uniform1i(C,y.u_texture)}),symbolSDF:(C,y)=>({u_is_size_zoom_constant:new x.Uniform1i(C,y.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(C,y.u_is_size_feature_constant),u_size_t:new x.Uniform1f(C,y.u_size_t),u_size:new x.Uniform1f(C,y.u_size),u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_pitch:new x.Uniform1f(C,y.u_pitch),u_rotate_symbol:new x.Uniform1i(C,y.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(C,y.u_aspect_ratio),u_fade_change:new x.Uniform1f(C,y.u_fade_change),u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(C,y.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(C,y.u_coord_matrix),u_is_text:new x.Uniform1i(C,y.u_is_text),u_pitch_with_map:new x.Uniform1i(C,y.u_pitch_with_map),u_texsize:new x.Uniform2f(C,y.u_texsize),u_texture:new x.Uniform1i(C,y.u_texture),u_gamma_scale:new x.Uniform1f(C,y.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(C,y.u_device_pixel_ratio),u_tile_id:new x.Uniform3f(C,y.u_tile_id),u_zoom_transition:new x.Uniform1f(C,y.u_zoom_transition),u_inv_rot_matrix:new x.UniformMatrix4f(C,y.u_inv_rot_matrix),u_merc_center:new x.Uniform2f(C,y.u_merc_center),u_is_halo:new x.Uniform1i(C,y.u_is_halo)}),symbolTextAndIcon:(C,y)=>({u_is_size_zoom_constant:new x.Uniform1i(C,y.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(C,y.u_is_size_feature_constant),u_size_t:new x.Uniform1f(C,y.u_size_t),u_size:new x.Uniform1f(C,y.u_size),u_camera_to_center_distance:new x.Uniform1f(C,y.u_camera_to_center_distance),u_pitch:new x.Uniform1f(C,y.u_pitch),u_rotate_symbol:new x.Uniform1i(C,y.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(C,y.u_aspect_ratio),u_fade_change:new x.Uniform1f(C,y.u_fade_change),u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(C,y.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(C,y.u_coord_matrix),u_is_text:new x.Uniform1i(C,y.u_is_text),u_pitch_with_map:new x.Uniform1i(C,y.u_pitch_with_map),u_texsize:new x.Uniform2f(C,y.u_texsize),u_texsize_icon:new x.Uniform2f(C,y.u_texsize_icon),u_texture:new x.Uniform1i(C,y.u_texture),u_texture_icon:new x.Uniform1i(C,y.u_texture_icon),u_gamma_scale:new x.Uniform1f(C,y.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(C,y.u_device_pixel_ratio),u_is_halo:new x.Uniform1i(C,y.u_is_halo)}),background:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_opacity:new x.Uniform1f(C,y.u_opacity),u_color:new x.UniformColor(C,y.u_color)}),backgroundPattern:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_opacity:new x.Uniform1f(C,y.u_opacity),u_image:new x.Uniform1i(C,y.u_image),u_pattern_tl_a:new x.Uniform2f(C,y.u_pattern_tl_a),u_pattern_br_a:new x.Uniform2f(C,y.u_pattern_br_a),u_pattern_tl_b:new x.Uniform2f(C,y.u_pattern_tl_b),u_pattern_br_b:new x.Uniform2f(C,y.u_pattern_br_b),u_texsize:new x.Uniform2f(C,y.u_texsize),u_mix:new x.Uniform1f(C,y.u_mix),u_pattern_size_a:new x.Uniform2f(C,y.u_pattern_size_a),u_pattern_size_b:new x.Uniform2f(C,y.u_pattern_size_b),u_scale_a:new x.Uniform1f(C,y.u_scale_a),u_scale_b:new x.Uniform1f(C,y.u_scale_b),u_pixel_coord_upper:new x.Uniform2f(C,y.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(C,y.u_pixel_coord_lower),u_tile_units_to_pixels:new x.Uniform1f(C,y.u_tile_units_to_pixels)}),terrainRaster:Wn,terrainDepth:Wn,skybox:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_sun_direction:new x.Uniform3f(C,y.u_sun_direction),u_cubemap:new x.Uniform1i(C,y.u_cubemap),u_opacity:new x.Uniform1f(C,y.u_opacity),u_temporal_offset:new x.Uniform1f(C,y.u_temporal_offset)}),skyboxGradient:(C,y)=>({u_matrix:new x.UniformMatrix4f(C,y.u_matrix),u_color_ramp:new x.Uniform1i(C,y.u_color_ramp),u_center_direction:new x.Uniform3f(C,y.u_center_direction),u_radius:new x.Uniform1f(C,y.u_radius),u_opacity:new x.Uniform1f(C,y.u_opacity),u_temporal_offset:new x.Uniform1f(C,y.u_temporal_offset)}),skyboxCapture:(C,y)=>({u_matrix_3f:new x.UniformMatrix3f(C,y.u_matrix_3f),u_sun_direction:new x.Uniform3f(C,y.u_sun_direction),u_sun_intensity:new x.Uniform1f(C,y.u_sun_intensity),u_color_tint_r:new x.Uniform4f(C,y.u_color_tint_r),u_color_tint_m:new x.Uniform4f(C,y.u_color_tint_m),u_luminance:new x.Uniform1f(C,y.u_luminance)}),globeRaster:(C,y)=>({u_proj_matrix:new x.UniformMatrix4f(C,y.u_proj_matrix),u_globe_matrix:new x.UniformMatrix4f(C,y.u_globe_matrix),u_merc_matrix:new x.UniformMatrix4f(C,y.u_merc_matrix),u_zoom_transition:new x.Uniform1f(C,y.u_zoom_transition),u_merc_center:new x.Uniform2f(C,y.u_merc_center),u_image0:new x.Uniform1i(C,y.u_image0)}),globeAtmosphere:(C,y)=>({u_center:new x.Uniform2f(C,y.u_center),u_radius:new x.Uniform1f(C,y.u_radius),u_screen_size:new x.Uniform2f(C,y.u_screen_size),u_pixel_ratio:new x.Uniform1f(C,y.u_pixel_ratio),u_opacity:new x.Uniform1f(C,y.u_opacity),u_fadeout_range:new x.Uniform1f(C,y.u_fadeout_range),u_start_color:new x.Uniform3f(C,y.u_start_color),u_end_color:new x.Uniform3f(C,y.u_end_color)})};let ls;function Va(C,y,S,D,z,O,V){const Z=C.context,K=Z.gl,Q=C.useProgram("collisionBox"),ie=[];let ae=0,pe=0;for(let Be=0;Be<D.length;Be++){const ke=D[Be],Ce=y.getTile(ke),Oe=Ce.getBucket(S);if(!Oe)continue;let He=ke.projMatrix;z[0]===0&&z[1]===0||(He=C.translatePosMatrix(ke.projMatrix,Ce,z,O));const Je=V?Oe.textCollisionBox:Oe.iconCollisionBox,xt=Oe.collisionCircleArray;if(xt.length>0){const ft=x.create(),dt=He;x.mul(ft,Oe.placementInvProjMatrix,C.transform.glCoordMatrix),x.mul(ft,ft,Oe.placementViewportMatrix),ie.push({circleArray:xt,circleOffset:pe,transform:dt,invTransform:ft}),ae+=xt.length/4,pe=ae}Je&&(C.terrain&&C.terrain.setupElevationDraw(Ce,Q),Q.draw(Z,K.LINES,x.DepthMode.disabled,x.StencilMode.disabled,C.colorModeForRenderPass(),x.CullFaceMode.disabled,ql(He,C.transform,Ce),S.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,null,C.transform.zoom,null,Je.collisionVertexBuffer,Je.collisionVertexBufferExt))}if(!V||!ie.length)return;const Ee=C.useProgram("collisionCircle"),xe=new x.StructArrayLayout2f1f2i16;xe.resize(4*ae),xe._trim();let Te=0;for(const Be of ie)for(let ke=0;ke<Be.circleArray.length/4;ke++){const Ce=4*ke,Oe=Be.circleArray[Ce+0],He=Be.circleArray[Ce+1],Je=Be.circleArray[Ce+2],xt=Be.circleArray[Ce+3];xe.emplace(Te++,Oe,He,Je,xt,0),xe.emplace(Te++,Oe,He,Je,xt,1),xe.emplace(Te++,Oe,He,Je,xt,2),xe.emplace(Te++,Oe,He,Je,xt,3)}(!ls||ls.length<2*ae)&&(ls=function(Be){const ke=2*Be,Ce=new x.StructArrayLayout3ui6;Ce.resize(ke),Ce._trim();for(let Oe=0;Oe<ke;Oe++){const He=6*Oe;Ce.uint16[He+0]=4*Oe+0,Ce.uint16[He+1]=4*Oe+1,Ce.uint16[He+2]=4*Oe+2,Ce.uint16[He+3]=4*Oe+2,Ce.uint16[He+4]=4*Oe+3,Ce.uint16[He+5]=4*Oe+0}return Ce}(ae));const Fe=Z.createIndexBuffer(ls,!0),we=Z.createVertexBuffer(xe,x.collisionCircleLayout.members,!0);for(const Be of ie){const ke={u_matrix:Be.transform,u_inv_matrix:Be.invTransform,u_camera_to_center_distance:(De=C.transform).cameraToCenterDistance,u_viewport_size:[De.width,De.height]};Ee.draw(Z,K.TRIANGLES,x.DepthMode.disabled,x.StencilMode.disabled,C.colorModeForRenderPass(),x.CullFaceMode.disabled,ke,S.id,we,Fe,x.SegmentVector.simpleSegment(0,2*Be.circleOffset,Be.circleArray.length,Be.circleArray.length/2),null,C.transform.zoom,null,null,null)}var De;we.destroy(),Fe.destroy()}const Xs=x.identity(new Float32Array(16));function Hl(C,y,S,D,z,O){const{horizontalAlign:V,verticalAlign:Z}=x.getAnchorAlignment(C),K=-(V-.5)*y,Q=-(Z-.5)*S,ie=x.evaluateVariableOffset(C,D);return new x.pointGeometry((K/z+ie[0])*O,(Q/z+ie[1])*O)}function ac(C,y,S,D,z,O,V,Z,K,Q,ie,ae){const pe=C.text.placedSymbolArray,Ee=C.text.dynamicLayoutVertexArray,xe=C.icon.dynamicLayoutVertexArray,Te={},Fe=Z.projMatrix,we=O.elevation,De=we?we.getAtTileOffsetFunc(Z,ae):Be=>[0,0,0];Ee.clear();for(let Be=0;Be<pe.length;Be++){const ke=pe.get(Be),Ce=C.allowVerticalPlacement&&!ke.placedOrientation,Oe=ke.hidden||!ke.crossTileID||Ce?null:D[ke.crossTileID];if(Oe){const He=new x.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),Je=De(He),xt=zr(He,S?Fe:V,Je[2]),ft=Tn(O.cameraToCenterDistance,xt.signedDistanceFromCamera);let dt=z.evaluateSizeForFeature(C.textSizeData,Q,ke)*ft/x.ONE_EM;S&&(dt*=C.tilePixelRatio/K);const{width:it,height:Ke,anchor:ut,textOffset:st,textScale:Yt}=Oe,ii=Hl(ut,it,Ke,st,Yt,dt),bi=S?zr(He.add(ii),V,Je[2]).point:xt.point.add(y?ii.rotate(-O.angle):ii),yt=C.allowVerticalPlacement&&ke.placedOrientation===x.WritingMode.vertical?Math.PI/2:0;for(let Jt=0;Jt<ke.numGlyphs;Jt++)x.addDynamicAttributes(Ee,bi,yt);ie&&ke.associatedIconIndex>=0&&(Te[ke.associatedIconIndex]={shiftedAnchor:bi,angle:yt})}else gn(ke.numGlyphs,Ee)}if(ie){xe.clear();const Be=C.icon.placedSymbolArray;for(let ke=0;ke<Be.length;ke++){const Ce=Be.get(ke);if(Ce.hidden)gn(Ce.numGlyphs,xe);else{const Oe=Te[ke];if(Oe)for(let He=0;He<Ce.numGlyphs;He++)x.addDynamicAttributes(xe,Oe.shiftedAnchor,Oe.angle);else gn(Ce.numGlyphs,xe)}}C.icon.dynamicLayoutVertexBuffer.updateData(xe)}C.text.dynamicLayoutVertexBuffer.updateData(Ee)}function lc(C,y,S){return S.iconsInText&&y?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function Ys(C,y,S,D,z,O,V,Z,K,Q,ie,ae){const pe=C.context,Ee=pe.gl,xe=C.transform,Te=xe.projection.createTileTransform(xe,xe.worldSize),Fe=Z==="map",we=K==="map",De=Fe&&S.layout.get("symbol-placement")!=="point",Be=Fe&&!we&&!De,ke=S.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ce=!1;const Oe=C.depthModeForSublayer(0,x.DepthMode.ReadOnly),He=[x.mercatorXfromLng(xe.center.lng),x.mercatorYfromLat(xe.center.lat)],Je=S.layout.get("text-variable-anchor"),xt=xe.projection.name==="globe",ft=xt?x.globeToMercatorTransition(xe.zoom):0,dt=[],it=[];C.terrain&&we&&it.push("PITCH_WITH_MAP_TERRAIN"),xt&&it.push("PROJECTION_GLOBE_VIEW"),De&&it.push("PROJECTED_POS_ON_VIEWPORT");for(const Ke of D){const ut=y.getTile(Ke),st=ut.getBucket(S);if(!st||st.projection!==xe.projection.name)continue;const Yt=z?st.text:st.icon;if(!Yt||st.fullyClipped||!Yt.segments.get().length)continue;const ii=Yt.programConfigurations.get(S.id),bi=z||st.sdfIcons,yt=z?st.textSizeData:st.iconSizeData,Jt=we||xe.pitch!==0,ui=C.useProgram(lc(bi,z,st),ii,it),Zi=x.evaluateSizeForZoom(yt,xe.zoom),Qi=[Ke.canonical.x,Ke.canonical.y,1<<Ke.canonical.z];let ai,Mi,rr,wr,Hr=[0,0],un=null;if(z){if(Mi=ut.glyphAtlasTexture,rr=Ee.LINEAR,ai=ut.glyphAtlasTexture.size,st.iconsInText){Hr=ut.imageAtlasTexture.size,un=ut.imageAtlasTexture;const kr=yt.kind==="composite"||yt.kind==="camera";wr=Jt||C.options.rotating||C.options.zooming||kr?Ee.LINEAR:Ee.NEAREST}}else{const kr=S.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;Mi=ut.imageAtlasTexture,rr=bi||C.options.rotating||C.options.zooming||kr||Jt?Ee.LINEAR:Ee.NEAREST,ai=ut.imageAtlasTexture.size}const vn=C.transform.calculatePixelsToTileUnitsMatrix(ut),Li=Gn(Ke.projMatrix,ut.tileID.canonical,we,Fe,C.transform,vn),di=C.terrain&&we&&De?x.invert(new Float32Array(16),Li):Xs,Ci=Rn(Ke.projMatrix,ut.tileID.canonical,we,Fe,C.transform,vn),hr=Je&&st.hasTextData(),en=S.layout.get("icon-text-fit")!=="none"&&hr&&st.hasIconData();if(De){const kr=xe.elevation,po=kr?kr.getAtTileOffsetFunc(Ke,Te):io=>[0,0,0];Rl(st,Ke.projMatrix,C,z,Li,Ci,we,Q,po,Ke)}const ir=C.translatePosMatrix(Ke.projMatrix,ut,O,V),tn=De||z&&Je||en?Xs:Li,Es=C.translatePosMatrix(Ci,ut,O,V,!0),Wr=bi&&S.paint.get(z?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fo;const $t=Te.createInversionMatrix(Ke.toUnwrapped());fo=bi?st.iconsInText?as(yt.kind,Zi,Be,we,C,ir,tn,Es,ai,Hr,Qi,ft,$t,He):ss(yt.kind,Zi,Be,we,C,ir,tn,Es,z,ai,!0,Qi,ft,$t,He):qs(yt.kind,Zi,Be,we,C,ir,tn,Es,z,ai,Qi,ft,$t,He);const Qt={program:ui,buffers:Yt,uniformValues:fo,atlasTexture:Mi,atlasTextureIcon:un,atlasInterpolation:rr,atlasInterpolationIcon:wr,isSDF:bi,hasHalo:Wr,tile:ut,labelPlaneMatrixInv:di};if(ke&&st.canOverlap){Ce=!0;const kr=Yt.segments.get();for(const po of kr)dt.push({segments:new x.SegmentVector([po]),sortKey:po.sortKey,state:Qt})}else dt.push({segments:Yt.segments,sortKey:0,state:Qt})}Ce&&dt.sort((Ke,ut)=>Ke.sortKey-ut.sortKey);for(const Ke of dt){const ut=Ke.state;if(C.terrain&&C.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:!xt,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}),pe.activeTexture.set(Ee.TEXTURE0),ut.atlasTexture.bind(ut.atlasInterpolation,Ee.CLAMP_TO_EDGE),ut.atlasTextureIcon&&(pe.activeTexture.set(Ee.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,Ee.CLAMP_TO_EDGE)),ut.isSDF){const st=ut.uniformValues;ut.hasHalo&&(st.u_is_halo=1,Hs(ut.buffers,Ke.segments,S,C,ut.program,Oe,ie,ae,st)),st.u_is_halo=0}Hs(ut.buffers,Ke.segments,S,C,ut.program,Oe,ie,ae,ut.uniformValues)}}function Hs(C,y,S,D,z,O,V,Z,K){const Q=D.context;z.draw(Q,Q.gl.TRIANGLES,O,V,Z,x.CullFaceMode.disabled,K,S.id,C.layoutVertexBuffer,C.indexBuffer,y,S.paint,D.transform.zoom,C.programConfigurations.get(S.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function Ws(C,y,S,D,z,O,V){const Z=C.context.gl,K=S.paint.get("fill-pattern"),Q=K&&K.constantOr(1),ie=S.getCrossfadeParameters();let ae,pe,Ee,xe,Te;V?(pe=Q&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=Z.LINES):(pe=Q?"fillPattern":"fill",ae=Z.TRIANGLES);for(const Fe of D){const we=y.getTile(Fe);if(Q&&!we.patternsLoaded())continue;const De=we.getBucket(S);if(!De)continue;C.prepareDrawTile(Fe);const Be=De.programConfigurations.get(S.id),ke=C.useProgram(pe,Be);Q&&(C.context.activeTexture.set(Z.TEXTURE0),we.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Be.updatePaintBuffers(ie));const Ce=K.constantOr(null);if(Ce&&we.imageAtlas){const He=we.imageAtlas,Je=He.patternPositions[Ce.to.toString()],xt=He.patternPositions[Ce.from.toString()];Je&&xt&&Be.setConstantPatternPositions(Je,xt)}const Oe=C.translatePosMatrix(Fe.projMatrix,we,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));if(V){xe=De.indexBuffer2,Te=De.segments2;const He=C.terrain&&C.terrain.renderingToTexture?C.terrain.drapeBufferSize:[Z.drawingBufferWidth,Z.drawingBufferHeight];Ee=pe==="fillOutlinePattern"&&Q?Gl(Oe,C,ie,we,He):oc(Oe,He)}else xe=De.indexBuffer,Te=De.segments,Ee=Q?$a(Oe,C,ie,we):jl(Oe);C.prepareDrawProgram(C.context,ke,Fe.toUnwrapped()),ke.draw(C.context,ae,z,C.stencilModeForClipping(Fe),O,x.CullFaceMode.disabled,Ee,S.id,De.layoutVertexBuffer,xe,Te,S.paint,C.transform.zoom,Be)}}function hs(C,y,S,D,z,O,V){const Z=C.context,K=Z.gl,Q=S.paint.get("fill-extrusion-pattern"),ie=Q.constantOr(1),ae=S.getCrossfadeParameters(),pe=S.paint.get("fill-extrusion-opacity");for(const Ee of D){const xe=y.getTile(Ee),Te=xe.getBucket(S);if(!Te)continue;const Fe=Te.programConfigurations.get(S.id),we=C.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Fe);if(C.terrain){const Oe=C.terrain;if(!Te.enableTerrain)continue;if(Oe.setupElevationDraw(xe,we,{useMeterToDem:!0}),Wl(Z,y,Ee,Te,S,Oe),!Te.centroidVertexBuffer){const He=we.attributes.a_centroid_pos;He!==void 0&&K.vertexAttrib2f(He,0,0)}}ie&&(C.context.activeTexture.set(K.TEXTURE0),xe.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Fe.updatePaintBuffers(ae));const De=Q.constantOr(null);if(De&&xe.imageAtlas){const Oe=xe.imageAtlas,He=Oe.patternPositions[De.to.toString()],Je=Oe.patternPositions[De.from.toString()];He&&Je&&Fe.setConstantPatternPositions(He,Je)}const Be=C.translatePosMatrix(Ee.projMatrix,xe,S.paint.get("fill-extrusion-translate"),S.paint.get("fill-extrusion-translate-anchor")),ke=S.paint.get("fill-extrusion-vertical-gradient"),Ce=ie?Oa(Be,C,ke,pe,Ee,ae,xe):Vl(Be,C,ke,pe);C.prepareDrawProgram(Z,we,Ee.toUnwrapped()),we.draw(Z,Z.gl.TRIANGLES,z,O,V,x.CullFaceMode.backCCW,Ce,S.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,S.paint,C.transform.zoom,Fe,C.terrain?Te.centroidVertexBuffer:null)}}function Wl(C,y,S,D,z,O){const V=[we=>{let De=we.canonical.x-1,Be=we.wrap;return De<0&&(De=(1<<we.canonical.z)-1,Be--),new x.OverscaledTileID(we.overscaledZ,Be,we.canonical.z,De,we.canonical.y)},we=>{let De=we.canonical.x+1,Be=we.wrap;return De===1<<we.canonical.z&&(De=0,Be++),new x.OverscaledTileID(we.overscaledZ,Be,we.canonical.z,De,we.canonical.y)},we=>new x.OverscaledTileID(we.overscaledZ,we.wrap,we.canonical.z,we.canonical.x,(we.canonical.y===0?1<<we.canonical.z:we.canonical.y)-1),we=>new x.OverscaledTileID(we.overscaledZ,we.wrap,we.canonical.z,we.canonical.x,we.canonical.y===(1<<we.canonical.z)-1?0:we.canonical.y+1)],Z=we=>{const De=y.getSource().maxzoom,Be=He=>{const Je=y.getTileByID(He);if(Je&&Je.hasData())return Je.getBucket(z)};let ke,Ce,Oe;return(we.overscaledZ===we.canonical.z||we.overscaledZ>=De)&&(ke=Be(we.key)),we.overscaledZ>=De&&(Ce=Be(we.calculateScaledKey(we.overscaledZ+1))),we.overscaledZ>De&&(Oe=Be(we.calculateScaledKey(we.overscaledZ-1))),ke||Ce||Oe},K=[0,0,0],Q=(we,De)=>(K[0]=Math.min(we.min.y,De.min.y),K[1]=Math.max(we.max.y,De.max.y),K[2]=x.EXTENT-De.min.x>we.max.x?De.min.x-x.EXTENT:we.max.x,K),ie=(we,De)=>(K[0]=Math.min(we.min.x,De.min.x),K[1]=Math.max(we.max.x,De.max.x),K[2]=x.EXTENT-De.min.y>we.max.y?De.min.y-x.EXTENT:we.max.y,K),ae=[(we,De)=>Q(we,De),(we,De)=>Q(De,we),(we,De)=>ie(we,De),(we,De)=>ie(De,we)],pe=new x.pointGeometry(0,0);let Ee,xe,Te;const Fe=(we,De,Be,ke,Ce)=>{const Oe=[[ke?Be:we,ke?we:Be,0],[ke?Be:De,ke?De:Be,0]],He=Ce<0?x.EXTENT+Ce:Ce,Je=[ke?He:(we+De)/2,ke?(we+De)/2:He,0];return Be===0&&Ce<0||Be!==0&&Ce>0?O.getForTilePoints(Te,[Je],!0,xe):Oe.push(Je),O.getForTilePoints(S,Oe,!0,Ee),Math.max(Oe[0][2],Oe[1][2],Je[2])/O.exaggeration()};for(let we=0;we<4;we++){const De=D.borders[we];if(De.length===0&&(D.borderDone[we]=!0),D.borderDone[we])continue;const Be=Te=V[we](S),ke=Z(Be);if(!ke||!ke.enableTerrain||(xe=O.findDEMTileFor(Be),!xe||!xe.dem))continue;if(!Ee){const Je=O.findDEMTileFor(S);if(!Je||!Je.dem)return;Ee=Je}const Ce=(we<2?1:5)-we,Oe=ke.borders[Ce];let He=0;for(let Je=0;Je<De.length;Je++){const xt=D.featuresOnBorder[De[Je]],ft=xt.borders[we];let dt;for(;He<Oe.length&&(dt=ke.featuresOnBorder[Oe[He]],!(dt.borders[Ce][1]>ft[0]+3));)ke.borderDone[Ce]||ke.encodeCentroid(void 0,dt,!1),He++;if(dt&&He<Oe.length){const it=He;let Ke=0;for(;!(dt.borders[Ce][0]>ft[1]-3)&&(Ke++,++He!==Oe.length);)dt=ke.featuresOnBorder[Oe[He]];if(dt=ke.featuresOnBorder[Oe[it]],xt.intersectsCount()>1||dt.intersectsCount()>1||Ke!==1){Ke!==1&&(He=it),D.encodeCentroid(void 0,xt,!1),ke.borderDone[Ce]||ke.encodeCentroid(void 0,dt,!1);continue}const ut=ae[we](xt,dt),st=we%2?x.EXTENT-1:0;pe.x=Fe(ut[0],Math.min(x.EXTENT-1,ut[1]),st,we<2,ut[2]),pe.y=0,D.encodeCentroid(pe,xt,!1),ke.borderDone[Ce]||ke.encodeCentroid(pe,dt,!1)}else D.encodeCentroid(void 0,xt,!1)}D.borderDone[we]=D.needsCentroidUpdate=!0,ke.borderDone[Ce]||(ke.borderDone[Ce]=ke.needsCentroidUpdate=!0)}(D.needsCentroidUpdate||!D.centroidVertexBuffer&&D.centroidVertexArray.length!==0)&&D.uploadCentroid(C)}const Kl=new x.Color(1,0,0,1),hc=new x.Color(0,1,0,1),cs=new x.Color(0,0,1,1),us=new x.Color(1,0,1,1),Jl=new x.Color(0,1,1,1);function Yr(C,y,S,D){uo(C,0,y+S/2,C.transform.width,S,D)}function Ks(C,y,S,D){uo(C,y-S/2,0,S,C.transform.height,D)}function uo(C,y,S,D,z,O){const V=C.context,Z=V.gl;Z.enable(Z.SCISSOR_TEST),Z.scissor(y*x.exported.devicePixelRatio,S*x.exported.devicePixelRatio,D*x.exported.devicePixelRatio,z*x.exported.devicePixelRatio),V.clear({color:O}),Z.disable(Z.SCISSOR_TEST)}function Js(C,y,S){const D=C.context,z=D.gl,O=S.projMatrix,V=C.useProgram("debug"),Z=y.getTileByID(S.key);C.terrain&&C.terrain.setupElevationDraw(Z,V);const K=x.DepthMode.disabled,Q=x.StencilMode.disabled,ie=C.colorModeForRenderPass(),ae="$debug";D.activeTexture.set(z.TEXTURE0),C.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Z._makeDebugTileBoundsBuffers(C.context,C.transform.projection);const pe=Z._tileDebugBuffer||C.debugBuffer,Ee=Z._tileDebugIndexBuffer||C.debugIndexBuffer,xe=Z._tileDebugSegments||C.debugSegments;V.draw(D,z.LINE_STRIP,K,Q,ie,x.CullFaceMode.disabled,Ua(O,x.Color.red),ae,pe,Ee,xe);const Te=Z.latestRawTileData,Fe=Math.floor((Te&&Te.byteLength||0)/1024),we=y.getTile(S).tileSize,De=512/Math.min(we,512)*(S.overscaledZ/C.transform.zoom)*.5;let Be=S.canonical.toString();S.overscaledZ!==S.canonical.z&&(Be+=` => ${S.overscaledZ}`),function(ke,Ce){ke.initDebugOverlayCanvas();const Oe=ke.debugOverlayCanvas,He=ke.context.gl,Je=ke.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Oe.width,Oe.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ce,5,5),Je.strokeText(Ce,5,5),ke.debugOverlayTexture.update(Oe),ke.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(C,`${Be} ${Fe}kb`),V.draw(D,z.TRIANGLES,K,Q,x.ColorMode.alphaBlended,x.CullFaceMode.disabled,Ua(O,x.Color.transparent,De),ae,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments)}const ja=x.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ga}=ja;function _n(C,y,S,D){C.emplaceBack(y,S,D)}class Qs{constructor(y){this.vertexArray=new x.StructArrayLayout3f12,this.indices=new x.StructArrayLayout3ui6,_n(this.vertexArray,-1,-1,1),_n(this.vertexArray,1,-1,1),_n(this.vertexArray,-1,1,1),_n(this.vertexArray,1,1,1),_n(this.vertexArray,-1,-1,-1),_n(this.vertexArray,1,-1,-1),_n(this.vertexArray,-1,1,-1),_n(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=y.createVertexBuffer(this.vertexArray,Ga),this.indexBuffer=y.createIndexBuffer(this.indices),this.segment=x.SegmentVector.simpleSegment(0,0,36,12)}}function Jn(C,y,S,D,z,O){const V=C.gl,Z=y.paint.get("sky-atmosphere-color"),K=y.paint.get("sky-atmosphere-halo-color"),Q=y.paint.get("sky-atmosphere-sun-intensity"),ie=((ae,pe,Ee,xe,Te)=>({u_matrix_3f:ae,u_sun_direction:pe,u_sun_intensity:Ee,u_color_tint_r:[xe.r,xe.g,xe.b,xe.a],u_color_tint_m:[Te.r,Te.g,Te.b,Te.a],u_luminance:5e-5}))(x.fromMat4([],D),z,Q,Z,K);V.framebufferTexture2D(V.FRAMEBUFFER,V.COLOR_ATTACHMENT0,V.TEXTURE_CUBE_MAP_POSITIVE_X+O,y.skyboxTexture,0),S.draw(C,V.TRIANGLES,x.DepthMode.disabled,x.StencilMode.disabled,x.ColorMode.unblended,x.CullFaceMode.frontCW,ie,"skyboxCapture",y.skyboxGeometry.vertexBuffer,y.skyboxGeometry.indexBuffer,y.skyboxGeometry.segment)}const ds={symbol:function(C,y,S,D,z){if(C.renderPass!=="translucent")return;const O=x.StencilMode.disabled,V=C.colorModeForRenderPass();S.layout.get("text-variable-anchor")&&function(Z,K,Q,ie,ae,pe,Ee){const xe=K.transform,Te=ae==="map",Fe=pe==="map",we=xe.projection.createTileTransform(xe,xe.worldSize);for(const De of Z){const Be=ie.getTile(De),ke=Be.getBucket(Q);if(!ke||ke.projection!==xe.projection.name||!ke.text||!ke.text.segments.get().length)continue;const Ce=x.evaluateSizeForZoom(ke.textSizeData,xe.zoom),Oe=K.transform.calculatePixelsToTileUnitsMatrix(Be),He=Gn(De.projMatrix,Be.tileID.canonical,Fe,Te,K.transform,Oe),Je=Q.layout.get("icon-text-fit")!=="none"&&ke.hasIconData();if(Ce){const xt=Math.pow(2,xe.zoom-Be.tileID.overscaledZ);ac(ke,Te,Fe,Ee,x.symbolSize,xe,He,De,xt,Ce,Je,we)}}}(D,C,S,y,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Ys(C,y,S,D,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),O,V),S.paint.get("text-opacity").constantOr(1)!==0&&Ys(C,y,S,D,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),O,V),y.map.showCollisionBoxes&&(Va(C,y,S,D,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),Va(C,y,S,D,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))},circle:function(C,y,S,D){if(C.renderPass!=="translucent")return;const z=S.paint.get("circle-opacity"),O=S.paint.get("circle-stroke-width"),V=S.paint.get("circle-stroke-opacity"),Z=S.layout.get("circle-sort-key").constantOr(1)!==void 0;if(z.constantOr(1)===0&&(O.constantOr(1)===0||V.constantOr(1)===0))return;const K=C.context,Q=K.gl,ie=C.depthModeForSublayer(0,x.DepthMode.ReadOnly),ae=x.StencilMode.disabled,pe=C.colorModeForRenderPass(),Ee=[];for(let Te=0;Te<D.length;Te++){const Fe=D[Te],we=y.getTile(Fe),De=we.getBucket(S);if(!De)continue;const Be=De.programConfigurations.get(S.id),ke=Na(S),Ce={programConfiguration:Be,program:C.useProgram("circle",Be,ke),layoutVertexBuffer:De.layoutVertexBuffer,indexBuffer:De.indexBuffer,uniformValues:sc(C,Fe,we,S),tile:we};if(Z){const Oe=De.segments.get();for(const He of Oe)Ee.push({segments:new x.SegmentVector([He]),sortKey:He.sortKey,state:Ce})}else Ee.push({segments:De.segments,sortKey:0,state:Ce})}Z&&Ee.sort((Te,Fe)=>Te.sortKey-Fe.sortKey);const xe={useDepthForOcclusion:C.transform.projection.name!=="globe"};for(const Te of Ee){const{programConfiguration:Fe,program:we,layoutVertexBuffer:De,indexBuffer:Be,uniformValues:ke,tile:Ce}=Te.state,Oe=Te.segments;C.terrain&&C.terrain.setupElevationDraw(Ce,we,xe),C.prepareDrawProgram(K,we,Ce.tileID.toUnwrapped()),we.draw(K,Q.TRIANGLES,ie,ae,pe,x.CullFaceMode.disabled,ke,S.id,De,Be,Oe,S.paint,C.transform.zoom,Fe)}},heatmap:function(C,y,S,D){if(S.paint.get("heatmap-opacity")!==0)if(C.renderPass==="offscreen"){const z=C.context,O=z.gl,V=x.StencilMode.disabled,Z=new x.ColorMode([O.ONE,O.ONE],x.Color.transparent,[!0,!0,!0,!0]);(function(K,Q,ie){const ae=K.gl;K.activeTexture.set(ae.TEXTURE1),K.viewport.set([0,0,Q.width/4,Q.height/4]);let pe=ie.heatmapFbo;if(pe)ae.bindTexture(ae.TEXTURE_2D,pe.colorAttachment.get()),K.bindFramebuffer.set(pe.framebuffer);else{const Ee=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Ee),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),pe=ie.heatmapFbo=K.createFramebuffer(Q.width/4,Q.height/4,!1),function(xe,Te,Fe,we){const De=xe.gl;De.texImage2D(De.TEXTURE_2D,0,De.RGBA,Te.width/4,Te.height/4,0,De.RGBA,xe.extRenderToTextureHalfFloat?xe.extTextureHalfFloat.HALF_FLOAT_OES:De.UNSIGNED_BYTE,null),we.colorAttachment.set(Fe)}(K,Q,Ee,pe)}})(z,C,S),z.clear({color:x.Color.transparent});for(let K=0;K<D.length;K++){const Q=D[K];if(y.hasRenderableParent(Q))continue;const ie=y.getTile(Q),ae=ie.getBucket(S);if(!ae)continue;const pe=ae.programConfigurations.get(S.id),Ee=C.useProgram("heatmap",pe),{zoom:xe}=C.transform;C.terrain&&C.terrain.setupElevationDraw(ie,Ee),C.prepareDrawProgram(z,Ee,Q.toUnwrapped()),Ee.draw(z,O.TRIANGLES,x.DepthMode.disabled,V,Z,x.CullFaceMode.disabled,Zl(Q.projMatrix,ie,xe,S.paint.get("heatmap-intensity")),S.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,S.paint,C.transform.zoom,pe)}z.viewport.set([0,0,C.width,C.height])}else C.renderPass==="translucent"&&(C.context.setColorMode(C.colorModeForRenderPass()),function(z,O){const V=z.context,Z=V.gl,K=O.heatmapFbo;if(!K)return;V.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,K.colorAttachment.get()),V.activeTexture.set(Z.TEXTURE1);let Q=O.colorRampTexture;Q||(Q=O.colorRampTexture=new x.Texture(V,O.colorRamp,Z.RGBA)),Q.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),z.useProgram("heatmapTexture").draw(V,Z.TRIANGLES,x.DepthMode.disabled,x.StencilMode.disabled,z.colorModeForRenderPass(),x.CullFaceMode.disabled,((ie,ae,pe,Ee)=>({u_image:0,u_color_ramp:1,u_opacity:ae.paint.get("heatmap-opacity")}))(0,O),O.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments,O.paint,z.transform.zoom)}(C,S))},line:function(C,y,S,D){if(C.renderPass!=="translucent")return;const z=S.paint.get("line-opacity"),O=S.paint.get("line-width");if(z.constantOr(1)===0||O.constantOr(1)===0)return;const V=C.depthModeForSublayer(0,x.DepthMode.ReadOnly),Z=C.colorModeForRenderPass(),K=S.paint.get("line-dasharray"),Q=K.constantOr(1),ie=S.layout.get("line-cap"),ae=S.paint.get("line-pattern"),pe=ae.constantOr(1),Ee=S.paint.get("line-gradient"),xe=S.getCrossfadeParameters(),Te=pe?"linePattern":"line",Fe=C.context,we=Fe.gl,De=(ke=>{const Ce=[];os(ke)&&Ce.push("RENDER_LINE_DASH"),ke.paint.get("line-gradient")&&Ce.push("RENDER_LINE_GRADIENT");const Oe=ke.paint.get("line-pattern").constantOr(1),He=ke.paint.get("line-opacity").constantOr(1)!==1;return!Oe&&He&&Ce.push("RENDER_LINE_ALPHA_DISCARD"),Ce})(S);let Be=De.includes("RENDER_LINE_ALPHA_DISCARD");C.terrain&&C.terrain.clipOrMaskOverlapStencilType()&&(Be=!1);for(const ke of D){const Ce=y.getTile(ke);if(pe&&!Ce.patternsLoaded())continue;const Oe=Ce.getBucket(S);if(!Oe)continue;C.prepareDrawTile(ke);const He=Oe.programConfigurations.get(S.id),Je=C.useProgram(Te,He,De),xt=ae.constantOr(null);if(xt&&Ce.imageAtlas){const st=Ce.imageAtlas,Yt=st.patternPositions[xt.to.toString()],ii=st.patternPositions[xt.from.toString()];Yt&&ii&&He.setConstantPatternPositions(Yt,ii)}const ft=K.constantOr(null),dt=ie.constantOr(null);if(!pe&&ft&&dt&&Ce.lineAtlas){const st=Ce.lineAtlas,Yt=st.getDash(ft.to,dt),ii=st.getDash(ft.from,dt);Yt&&ii&&He.setConstantPatternPositions(Yt,ii)}const it=C.terrain?ke.projMatrix:null,Ke=pe?co(C,Ce,S,xe,it):Xl(C,Ce,S,xe,it,Oe.lineClipsArray.length);if(Ee){const st=Oe.gradients[S.id];let Yt=st.texture;if(S.gradientVersion!==st.version){let ii=256;if(S.stepInterpolant){const bi=y.getSource().maxzoom,yt=ke.canonical.z===bi?Math.ceil(1<<C.transform.maxZoom-ke.canonical.z):1;ii=x.clamp(x.nextPowerOfTwo(Oe.maxLineLength/x.EXTENT*1024*yt),256,Fe.maxTextureSize)}st.gradient=x.renderColorRamp({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:ii,image:st.gradient||void 0,clips:Oe.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new x.Texture(Fe,st.gradient,we.RGBA),st.version=S.gradientVersion,Yt=st.texture}Fe.activeTexture.set(we.TEXTURE1),Yt.bind(S.stepInterpolant?we.NEAREST:we.LINEAR,we.CLAMP_TO_EDGE)}Q&&(Fe.activeTexture.set(we.TEXTURE0),Ce.lineAtlasTexture.bind(we.LINEAR,we.REPEAT),He.updatePaintBuffers(xe)),pe&&(Fe.activeTexture.set(we.TEXTURE0),Ce.imageAtlasTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE),He.updatePaintBuffers(xe)),C.prepareDrawProgram(Fe,Je,ke.toUnwrapped());const ut=st=>{Je.draw(Fe,we.TRIANGLES,V,st,Z,x.CullFaceMode.disabled,Ke,S.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,S.paint,C.transform.zoom,He,Oe.layoutVertexBuffer2)};if(Be){const st=C.stencilModeForClipping(ke).ref;st===0&&C.terrain&&Fe.clear({stencil:0});const Yt={func:we.EQUAL,mask:255};Ke.u_alpha_discard_threshold=.8,ut(new x.StencilMode(Yt,st,255,we.KEEP,we.KEEP,we.INVERT)),Ke.u_alpha_discard_threshold=0,ut(new x.StencilMode(Yt,st,255,we.KEEP,we.KEEP,we.KEEP))}else ut(C.stencilModeForClipping(ke))}Be&&(C.resetStencilClippingMasks(),C.terrain&&Fe.clear({stencil:0}))},fill:function(C,y,S,D){const z=S.paint.get("fill-color"),O=S.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const V=C.colorModeForRenderPass(),Z=S.paint.get("fill-pattern"),K=C.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&z.constantOr(x.Color.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===K){const Q=C.depthModeForSublayer(1,C.renderPass==="opaque"?x.DepthMode.ReadWrite:x.DepthMode.ReadOnly);Ws(C,y,S,D,Q,V,!1)}if(C.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Q=C.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,x.DepthMode.ReadOnly);Ws(C,y,S,D,Q,V,!0)}},"fill-extrusion":function(C,y,S,D){const z=S.paint.get("fill-extrusion-opacity");if(z!==0&&C.renderPass==="translucent"){const O=new x.DepthMode(C.context.gl.LEQUAL,x.DepthMode.ReadWrite,C.depthRangeFor3D);if(z!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))hs(C,y,S,D,O,x.StencilMode.disabled,x.ColorMode.disabled),hs(C,y,S,D,O,C.stencilModeFor3D(),C.colorModeForRenderPass()),C.resetStencilClippingMasks();else{const V=C.colorModeForRenderPass();hs(C,y,S,D,O,x.StencilMode.disabled,V)}}},hillshade:function(C,y,S,D){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const z=C.context,O=C.depthModeForSublayer(0,x.DepthMode.ReadOnly),V=C.colorModeForRenderPass(),Z=C.terrain&&C.terrain.renderingToTexture,[K,Q]=C.renderPass!=="translucent"||Z?[{},D]:C.stencilConfigForOverlap(D);for(const ie of Q){const ae=y.getTile(ie);if(ae.needsHillshadePrepare&&C.renderPass==="offscreen")ts(C,ae,S,O,x.StencilMode.disabled,V);else if(C.renderPass==="translucent"){const pe=Z&&C.terrain?C.terrain.stencilModeForRTTOverlap(ie):K[ie.overscaledZ];Ns(C,ie,ae,S,O,pe,V)}}z.viewport.set([0,0,C.width,C.height]),C.resetStencilClippingMasks()},raster:function(C,y,S,D,z,O){if(C.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!D.length)return;const V=C.context,Z=V.gl,K=y.getSource(),Q=C.useProgram("raster"),ie=C.colorModeForRenderPass(),ae=C.terrain&&C.terrain.renderingToTexture,[pe,Ee]=K instanceof Sr||ae?[{},D]:C.stencilConfigForOverlap(D),xe=Ee[Ee.length-1].overscaledZ,Te=!C.options.moving;for(const Fe of Ee){const we=ae?x.DepthMode.disabled:C.depthModeForSublayer(Fe.overscaledZ-xe,S.paint.get("raster-opacity")===1?x.DepthMode.ReadWrite:x.DepthMode.ReadOnly,Z.LESS),De=Fe.toUnwrapped(),Be=y.getTile(Fe);if(ae&&(!Be||!Be.hasData()))continue;const ke=ae?Fe.projMatrix:C.transform.calculateProjMatrix(De,Te),Ce=C.terrain&&ae?C.terrain.stencilModeForRTTOverlap(Fe):pe[Fe.overscaledZ],Oe=O?0:S.paint.get("raster-fade-duration");Be.registerFadeDuration(Oe);const He=y.findLoadedParent(Fe,0),Je=$l(Be,He,y,C.transform,Oe);let xt,ft;C.terrain&&C.terrain.prepareDrawTile(Fe);const dt=S.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;V.activeTexture.set(Z.TEXTURE0),Be.texture.bind(dt,Z.CLAMP_TO_EDGE),V.activeTexture.set(Z.TEXTURE1),He?(He.texture.bind(dt,Z.CLAMP_TO_EDGE),xt=Math.pow(2,He.tileID.overscaledZ-Be.tileID.overscaledZ),ft=[Be.tileID.canonical.x*xt%1,Be.tileID.canonical.y*xt%1]):Be.texture.bind(dt,Z.CLAMP_TO_EDGE);const it=js(ke,ft||[0,0],xt||1,Je,S,K instanceof Sr?K.perspectiveTransform:[0,0]);if(C.prepareDrawProgram(V,Q,De),K instanceof Sr)Q.draw(V,Z.TRIANGLES,we,x.StencilMode.disabled,ie,x.CullFaceMode.disabled,it,S.id,K.boundsBuffer,C.quadTriangleIndexBuffer,K.boundsSegments);else{const{tileBoundsBuffer:Ke,tileBoundsIndexBuffer:ut,tileBoundsSegments:st}=C.getTileBoundsBuffers(Be);Q.draw(V,Z.TRIANGLES,we,Ce,ie,x.CullFaceMode.disabled,it,S.id,Ke,ut,st)}}C.resetStencilClippingMasks()},background:function(C,y,S,D){const z=S.paint.get("background-color"),O=S.paint.get("background-opacity");if(O===0)return;const V=C.context,Z=V.gl,K=C.transform,Q=K.tileSize,ie=S.paint.get("background-pattern");if(C.isPatternMissing(ie))return;const ae=!ie&&z.a===1&&O===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==ae)return;const pe=x.StencilMode.disabled,Ee=C.depthModeForSublayer(0,ae==="opaque"?x.DepthMode.ReadWrite:x.DepthMode.ReadOnly),xe=C.colorModeForRenderPass(),Te=C.useProgram(ie?"backgroundPattern":"background");let Fe,we=D;we||(Fe=C.getBackgroundTiles(),we=Object.values(Fe).map(Be=>Be.tileID)),ie&&(V.activeTexture.set(Z.TEXTURE0),C.imageManager.bind(C.context));const De=S.getCrossfadeParameters();for(const Be of we){const ke=Be.toUnwrapped(),Ce=D?Be.projMatrix:C.transform.calculateProjMatrix(ke);C.prepareDrawTile(Be);const Oe=y?y.getTile(Be):Fe?Fe[Be.key]:new x.Tile(Be,Q,K.zoom,C),He=ie?Zs(Ce,O,C,ie,{tileID:Be,tileSize:Q},De):Gi(Ce,O,z);C.prepareDrawProgram(V,Te,ke);const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:xt,tileBoundsSegments:ft}=C.getTileBoundsBuffers(Oe);Te.draw(V,Z.TRIANGLES,Ee,pe,xe,x.CullFaceMode.disabled,He,S.id,Je,xt,ft)}},sky:function(C,y,S){const D=C.transform,z=D.projection.name==="mercator"||D.projection.name==="globe"?1:x.smoothstep(7,8,D.zoom),O=S.paint.get("sky-opacity")*z;if(O===0)return;const V=C.context,Z=S.paint.get("sky-type"),K=new x.DepthMode(V.gl.LEQUAL,x.DepthMode.ReadOnly,[0,1]),Q=C.frameCounter/1e3%1;Z==="atmosphere"?C.renderPass==="offscreen"?S.needsSkyboxCapture(C)&&(function(ie,ae,pe,Ee){const xe=ie.context,Te=xe.gl;let Fe=ae.skyboxFbo;if(!Fe){Fe=ae.skyboxFbo=xe.createFramebuffer(32,32,!1),ae.skyboxGeometry=new Qs(xe),ae.skyboxTexture=xe.gl.createTexture(),Te.bindTexture(Te.TEXTURE_CUBE_MAP,ae.skyboxTexture),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_MAG_FILTER,Te.LINEAR);for(let ke=0;ke<6;++ke)Te.texImage2D(Te.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,Te.RGBA,32,32,0,Te.RGBA,Te.UNSIGNED_BYTE,null)}xe.bindFramebuffer.set(Fe.framebuffer),xe.viewport.set([0,0,32,32]);const we=ae.getCenter(ie,!0),De=ie.useProgram("skyboxCapture"),Be=new Float64Array(16);x.identity(Be),x.rotateY(Be,Be,.5*-Math.PI),Jn(xe,ae,De,Be,we,0),x.identity(Be),x.rotateY(Be,Be,.5*Math.PI),Jn(xe,ae,De,Be,we,1),x.identity(Be),x.rotateX(Be,Be,.5*-Math.PI),Jn(xe,ae,De,Be,we,2),x.identity(Be),x.rotateX(Be,Be,.5*Math.PI),Jn(xe,ae,De,Be,we,3),x.identity(Be),Jn(xe,ae,De,Be,we,4),x.identity(Be),x.rotateY(Be,Be,Math.PI),Jn(xe,ae,De,Be,we,5),xe.viewport.set([0,0,ie.width,ie.height])}(C,S),S.markSkyboxValid(C)):C.renderPass==="sky"&&function(ie,ae,pe,Ee,xe){const Te=ie.context,Fe=Te.gl,we=ie.transform,De=ie.useProgram("skybox");Te.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,ae.skyboxTexture);const Be=((ke,Ce,Oe,He,Je)=>({u_matrix:ke,u_sun_direction:Ce,u_cubemap:0,u_opacity:He,u_temporal_offset:Je}))(we.skyboxMatrix,ae.getCenter(ie,!1),0,Ee,xe);ie.prepareDrawProgram(Te,De),De.draw(Te,Fe.TRIANGLES,pe,x.StencilMode.disabled,ie.colorModeForRenderPass(),x.CullFaceMode.backCW,Be,"skybox",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(C,S,K,O,Q):Z==="gradient"&&C.renderPass==="sky"&&function(ie,ae,pe,Ee,xe){const Te=ie.context,Fe=Te.gl,we=ie.transform,De=ie.useProgram("skyboxGradient");ae.skyboxGeometry||(ae.skyboxGeometry=new Qs(Te)),Te.activeTexture.set(Fe.TEXTURE0);let Be=ae.colorRampTexture;Be||(Be=ae.colorRampTexture=new x.Texture(Te,ae.colorRamp,Fe.RGBA)),Be.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE);const ke=((Ce,Oe,He,Je,xt)=>({u_matrix:Ce,u_color_ramp:0,u_center_direction:Oe,u_radius:x.degToRad(He),u_opacity:Je,u_temporal_offset:xt}))(we.skyboxMatrix,ae.getCenter(ie,!1),ae.paint.get("sky-gradient-radius"),Ee,xe);ie.prepareDrawProgram(Te,De),De.draw(Te,Fe.TRIANGLES,pe,x.StencilMode.disabled,ie.colorModeForRenderPass(),x.CullFaceMode.backCW,ke,"skyboxGradient",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(C,S,K,O,Q)},debug:function(C,y,S){for(let D=0;D<S.length;D++)Js(C,y,S[D])},custom:function(C,y,S){const D=C.context,z=S.implementation;if(C.transform.projection.unsupportedLayers&&C.transform.projection.unsupportedLayers.includes("custom"))x.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(C.renderPass==="offscreen"){const O=z.prerender;O&&(C.setCustomLayerDefaults(),D.setColorMode(C.colorModeForRenderPass()),O.call(z,D.gl,C.transform.customLayerMatrix()),D.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),D.setColorMode(C.colorModeForRenderPass()),D.setStencilMode(x.StencilMode.disabled);const O=z.renderingMode==="3d"?new x.DepthMode(C.context.gl.LEQUAL,x.DepthMode.ReadWrite,C.depthRangeFor3D):C.depthModeForSublayer(0,x.DepthMode.ReadOnly);D.setDepthMode(O),z.render(D.gl,C.transform.customLayerMatrix()),D.setDirty(),C.setBaseState(),D.bindFramebuffer.set(null)}}};class Ql{constructor(y,S){this.context=new fr(y),this.transform=S,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=x.SourceCache.maxUnderzooming+x.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qo,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(y,S){const D=!!y&&!!y.terrain&&this.transform.projection.supportsTerrain;if(!(D||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Kn(this,y));const z=this._terrain;this.transform.elevation=D?z:null,z.update(y,this.transform,S)}_updateFog(y){const S=y.fog;if(!S||S.getOpacity(this.transform.pitch)<1||S.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[D,z]=S.getFovAdjustedRange(this.transform._fov);if(D>z)return void(this.transform.fogCullDistSq=null);const O=D+.78*(z-D);this.transform.fogCullDistSq=O*O}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(y,S){if(this.width=y*x.exported.devicePixelRatio,this.height=S*x.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const D of this.style.order)this.style._layers[D].resize()}setup(){const y=this.context,S=new x.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(x.EXTENT,0),S.emplaceBack(0,x.EXTENT),S.emplaceBack(x.EXTENT,x.EXTENT),this.tileExtentBuffer=y.createVertexBuffer(S,x.posAttributes.members),this.tileExtentSegments=x.SegmentVector.simpleSegment(0,0,4,2);const D=new x.StructArrayLayout2i4;D.emplaceBack(0,0),D.emplaceBack(x.EXTENT,0),D.emplaceBack(0,x.EXTENT),D.emplaceBack(x.EXTENT,x.EXTENT),this.debugBuffer=y.createVertexBuffer(D,x.posAttributes.members),this.debugSegments=x.SegmentVector.simpleSegment(0,0,4,5);const z=new x.StructArrayLayout2i4;z.emplaceBack(-1,-1),z.emplaceBack(1,-1),z.emplaceBack(-1,1),z.emplaceBack(1,1),this.viewportBuffer=y.createVertexBuffer(z,x.posAttributes.members),this.viewportSegments=x.SegmentVector.simpleSegment(0,0,4,2);const O=new x.StructArrayLayout4i8;O.emplaceBack(0,0,0,0),O.emplaceBack(x.EXTENT,0,x.EXTENT,0),O.emplaceBack(0,x.EXTENT,0,x.EXTENT),O.emplaceBack(x.EXTENT,x.EXTENT,x.EXTENT,x.EXTENT),this.mercatorBoundsBuffer=y.createVertexBuffer(O,x.boundsAttributes.members),this.mercatorBoundsSegments=x.SegmentVector.simpleSegment(0,0,4,2);const V=new x.StructArrayLayout3ui6;V.emplaceBack(0,1,2),V.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=y.createIndexBuffer(V);const Z=new x.StructArrayLayout1ui2;for(const Q of[0,1,3,2,0])Z.emplaceBack(Q);this.debugIndexBuffer=y.createIndexBuffer(Z),this.emptyTexture=new x.Texture(y,{width:1,height:1,data:new Uint8Array([0,0,0,0])},y.gl.RGBA),this.identityMat=x.create();const K=this.context.gl;this.stencilClearMode=new x.StencilMode({func:K.ALWAYS,mask:0},0,255,K.ZERO,K.ZERO,K.ZERO),this.loadTimeStamps.push(x.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(y){return y._makeTileBoundsBuffers(this.context,this.transform.projection),y._tileBoundsBuffer?{tileBoundsBuffer:y._tileBoundsBuffer,tileBoundsIndexBuffer:y._tileBoundsIndexBuffer,tileBoundsSegments:y._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const y=this.context,S=y.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(y,S.TRIANGLES,x.DepthMode.disabled,this.stencilClearMode,x.ColorMode.disabled,x.CullFaceMode.disabled,kn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(y,S,D){if(!S||this.currentStencilSource===S.id||!y.isTileClipped()||!D||D.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Z=!1;for(const K of D)if(this._tileClippingMaskIDs[K.key]===void 0){Z=!0;break}if(!Z)return}this.currentStencilSource=S.id;const z=this.context,O=z.gl;this.nextStencilID+D.length>256&&this.clearStencil(),z.setColorMode(x.ColorMode.disabled),z.setDepthMode(x.DepthMode.disabled);const V=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Z of D){const K=S.getTile(Z),Q=this._tileClippingMaskIDs[Z.key]=this.nextStencilID++,{tileBoundsBuffer:ie,tileBoundsIndexBuffer:ae,tileBoundsSegments:pe}=this.getTileBoundsBuffers(K);V.draw(z,O.TRIANGLES,x.DepthMode.disabled,new x.StencilMode({func:O.ALWAYS,mask:0},Q,255,O.KEEP,O.KEEP,O.REPLACE),x.ColorMode.disabled,x.CullFaceMode.disabled,kn(Z.projMatrix),"$clipping",ie,ae,pe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const y=this.nextStencilID++,S=this.context.gl;return new x.StencilMode({func:S.NOTEQUAL,mask:255},y,255,S.KEEP,S.KEEP,S.REPLACE)}stencilModeForClipping(y){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(y);const S=this.context.gl;return new x.StencilMode({func:S.EQUAL,mask:255},this._tileClippingMaskIDs[y.key],0,S.KEEP,S.KEEP,S.REPLACE)}stencilConfigForOverlap(y){const S=this.context.gl,D=y.sort((V,Z)=>Z.overscaledZ-V.overscaledZ),z=D[D.length-1].overscaledZ,O=D[0].overscaledZ-z+1;if(O>1){this.currentStencilSource=void 0,this.nextStencilID+O>256&&this.clearStencil();const V={};for(let Z=0;Z<O;Z++)V[Z+z]=new x.StencilMode({func:S.GEQUAL,mask:255},Z+this.nextStencilID,255,S.KEEP,S.KEEP,S.REPLACE);return this.nextStencilID+=O,[V,D]}return[{[z]:x.StencilMode.disabled},D]}colorModeForRenderPass(){const y=this.context.gl;return this._showOverdrawInspector?new x.ColorMode([y.CONSTANT_COLOR,y.ONE],new x.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?x.ColorMode.unblended:x.ColorMode.alphaBlended}depthModeForSublayer(y,S,D){if(!this.opaquePassEnabledForLayer())return x.DepthMode.disabled;const z=1-((1+this.currentLayer)*this.numSublayers+y)*this.depthEpsilon;return new x.DepthMode(D||this.context.gl.LEQUAL,S,[z,z])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(y,S){this.style=y,this.options=S,this.lineAtlas=y.lineAtlas,this.imageManager=y.imageManager,this.glyphManager=y.glyphManager,this.symbolFadeChange=y.placement.symbolFadeChange(x.exported.now()),this.imageManager.beginFrame();const D=this.style.order,z=this.style._sourceCaches;for(const Q in z){const ie=z[Q];ie.used&&ie.prepare(this.context)}const O={},V={},Z={};for(const Q in z){const ie=z[Q];O[Q]=ie.getVisibleCoordinates(),V[Q]=O[Q].slice().reverse(),Z[Q]=ie.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Q=0;Q<D.length;Q++)if(this.style._layers[D[Q]].is3D()){this.opaquePassCutoff=Q;break}if(this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new x.GlobeSharedBuffers(this.context)),!x.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Q of D){const ie=this.style._layers[Q],ae=y._getLayerSourceCache(ie);if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;const pe=ae?V[ae.id]:void 0;(ie.type==="custom"||ie.isSky()||pe&&pe.length)&&this.renderLayer(this,ae,ie,pe)}this.depthRangeFor3D=[0,1-(y.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let K=x.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(K=this.style.fog.properties.get("color")),this.context.clear({color:S.showOverdrawInspector?x.Color.black:K,depth:1}),this.clearStencil(),this._showOverdrawInspector=S.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const Q=this.style._layers[D[this.currentLayer]],ie=y._getLayerSourceCache(Q);if(Q.isSky())continue;const ae=ie?V[ie.id]:void 0;this._renderTileClippingMasks(Q,ie,ae),this.renderLayer(this,ie,Q,ae)}if(this.renderPass="sky",(x.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const Q=this.style._layers[D[this.currentLayer]],ie=y._getLayerSourceCache(Q);Q.isSky()&&this.renderLayer(this,ie,Q,ie?V[ie.id]:void 0)}for(this.transform.projection.name==="globe"&&function(Q){const ie=Q.context,ae=ie.gl,pe=Q.transform,Ee=new x.DepthMode(ae.LEQUAL,x.DepthMode.ReadOnly,[0,1]),xe=Q.useProgram("globeAtmosphere"),Te=pe._camera.getWorldToCamera(pe.worldSize,1),Fe=pe._camera.getCameraToClipPerspective(pe._fov,pe.width/pe.height,pe._nearZ,pe._farZ),we=x.mul([],Te,x.calculateGlobeMatrix(pe,pe.worldSize)),De=x.mul([],pe.labelPlaneMatrix,Fe),Be=x.transformMat4([],[0,0,0],we),ke=x.add([],Be,[pe.worldSize/Math.PI/2,0,0]),Ce=x.transformMat4([],Be,De),Oe=x.transformMat4([],ke,De),He=x.length(x.sub([],Oe,Ce)),Je=1-x.globeToMercatorTransition(pe.zoom),xt={u_center:Ce,u_radius:He,u_screen_size:[pe.width,pe.height],u_pixel_ratio:x.exported.devicePixelRatio,u_opacity:Je,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};Q.prepareDrawProgram(ie,xe);const ft=Q.globeSharedBuffers;ft&&xe.draw(ie,ae.TRIANGLES,Ee,x.StencilMode.disabled,x.ColorMode.alphaBlended,x.CullFaceMode.backCW,xt,"skybox",ft.atmosphereVertexBuffer,ft.atmosphereIndexBuffer,ft.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<D.length;){const Q=this.style._layers[D[this.currentLayer]],ie=y._getLayerSourceCache(Q);if(Q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Q)){if(Q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ae=ie?(Q.type==="symbol"?Z:V)[ie.id]:void 0;this._renderTileClippingMasks(Q,ie,ie?O[ie.id]:void 0),this.renderLayer(this,ie,Q,ae),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let Q=null;x.values(this.style._layers).forEach(ie=>{const ae=y._getLayerSourceCache(ie);ae&&!ie.isHidden(this.transform.zoom)&&(!Q||Q.getSource().maxzoom<ae.getSource().maxzoom)&&(Q=ae)}),Q&&this.options.showTileBoundaries&&ds.debug(this,Q,Q.getVisibleCoordinates())}this.options.showPadding&&function(Q){const ie=Q.transform.padding;Yr(Q,Q.transform.height-(ie.top||0),3,Kl),Yr(Q,ie.bottom||0,3,hc),Ks(Q,ie.left||0,3,cs),Ks(Q,Q.transform.width-(ie.right||0),3,us);const ae=Q.transform.centerPoint;(function(pe,Ee,xe,Te){uo(pe,Ee-1,xe-10,2,20,Te),uo(pe,Ee-10,xe-1,20,2,Te)})(Q,ae.x,Q.transform.height-ae.y,Jl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(x.window.performance.now()),this.saveCanvasCopy())}renderLayer(y,S,D,z){D.isHidden(this.transform.zoom)||(D.type==="background"||D.type==="sky"||D.type==="custom"||z&&z.length)&&(this.id=D.id,this.gpuTimingStart(D),y.transform.projection.unsupportedLayers&&y.transform.projection.unsupportedLayers.includes(D.type)||ds[D.type](y,S,D,z,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(y){if(!this.options.gpuTiming)return;const S=this.context.extTimerQuery;let D=this.gpuTimers[y.id];D||(D=this.gpuTimers[y.id]={calls:0,cpuTime:0,query:S.createQueryEXT()}),D.calls++,S.beginQueryEXT(S.TIME_ELAPSED_EXT,D.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const y=this.context.extTimerQuery;y.endQueryEXT(y.TIME_ELAPSED_EXT)}collectGpuTimers(){const y=this.gpuTimers;return this.gpuTimers={},y}queryGpuTimers(y){const S={};for(const D in y){const z=y[D],O=this.context.extTimerQuery,V=O.getQueryObjectEXT(z.query,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(z.query),S[D]=V}return S}translatePosMatrix(y,S,D,z,O){if(!D[0]&&!D[1])return y;const V=O?z==="map"?this.transform.angle:0:z==="viewport"?-this.transform.angle:0;if(V){const Q=Math.sin(V),ie=Math.cos(V);D=[D[0]*ie-D[1]*Q,D[0]*Q+D[1]*ie]}const Z=[O?D[0]:Lt(S,D[0],this.transform.zoom),O?D[1]:Lt(S,D[1],this.transform.zoom),0],K=new Float32Array(16);return x.translate(K,y,Z),K}saveTileTexture(y){const S=this._tileTextures[y.size[0]];S?S.push(y):this._tileTextures[y.size[0]]=[y]}getTileTexture(y){const S=this._tileTextures[y];return S&&S.length>0?S.pop():null}isPatternMissing(y){if(!y)return!1;if(!y.from||!y.to)return!0;const S=this.imageManager.getPattern(y.from.toString()),D=this.imageManager.getPattern(y.to.toString());return!S||!D}currentGlobalDefines(){const y=this.terrain&&this.terrain.renderingToTexture,S=this.style&&this.style.fog,D=[];return this.terrain&&!this.terrain.renderingToTexture&&D.push("TERRAIN"),S&&!y&&S.getOpacity(this.transform.pitch)!==0&&D.push("FOG"),y&&D.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&D.push("OVERDRAW_INSPECTOR"),D}useProgram(y,S,D){this.cache=this.cache||{};const z=D||[],O=this.currentGlobalDefines().concat(z),V=rs.cacheKey(y,O,S);return this.cache[V]||(this.cache[V]=new rs(this.context,y,Fa[y],S,Yl[y],O)),this.cache[V]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const y=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(y.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=x.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new x.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(y){this.terrain&&this.terrain.prepareDrawTile(y)}prepareDrawProgram(y,S,D){if(this.terrain&&this.terrain.renderingToTexture)return;const z=this.style.fog;if(z){const O=z.getOpacity(this.transform.pitch);O!==0&&S.setFogUniformValues(y,((V,Z,K,Q)=>{const ie=Z.properties.get("color"),ae=V.frameCounter/1e3%1,pe=[ie.r/ie.a,ie.g/ie.a,ie.b/ie.a,Q];return{u_fog_matrix:K?V.transform.calculateFogTileMatrix(K):V.identityMat,u_fog_range:Z.getFovAdjustedRange(V.transform._fov),u_fog_color:pe,u_fog_horizon_blend:Z.properties.get("horizon-blend"),u_fog_temporal_offset:ae}})(this,z,D,O))}}setTileLoadedFlag(y){this.tileLoaded=y}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const y=this.context.gl,S=y.createTexture();return y.bindTexture(y.TEXTURE_2D,S),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,y.drawingBufferWidth,y.drawingBufferHeight,0),S}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const y=this.style&&this.style.fog;return!!y&&y.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const y=this._backgroundTiles,S=this._backgroundTiles={},D=this.transform.coveringTiles({tileSize:512});for(const z of D)S[z.key]=y[z.key]||new x.Tile(z,512,this.transform.tileZoom,this);return S}clearBackgroundTiles(){this._backgroundTiles={}}}class ea{constructor(y=0,S=0,D=0,z=0){if(isNaN(y)||y<0||isNaN(S)||S<0||isNaN(D)||D<0||isNaN(z)||z<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=y,this.bottom=S,this.left=D,this.right=z}interpolate(y,S,D){return S.top!=null&&y.top!=null&&(this.top=x.number(y.top,S.top,D)),S.bottom!=null&&y.bottom!=null&&(this.bottom=x.number(y.bottom,S.bottom,D)),S.left!=null&&y.left!=null&&(this.left=x.number(y.left,S.left,D)),S.right!=null&&y.right!=null&&(this.right=x.number(y.right,S.right,D)),this}getCenter(y,S){const D=x.clamp((this.left+y-this.right)/2,0,y),z=x.clamp((this.top+S-this.bottom)/2,0,S);return new x.pointGeometry(D,z)}equals(y){return this.top===y.top&&this.bottom===y.bottom&&this.left===y.left&&this.right===y.right}clone(){return new ea(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qn(C,y){const S=x.getColumn(C,3);x.fromQuat(C,y),x.setColumn(C,3,S)}function eh(C,y){x.setColumn(C,3,[y[0],y[1],y[2],1])}function qa(C,y){const S=x.identity$1([]);return x.rotateZ$1(S,S,-y),x.rotateX$1(S,S,-C),S}function Za(C,y){const S=[C[0],C[1],0],D=[y[0],y[1],0];if(x.length(S)>=1e-15){const V=x.normalize([],S);x.scale$2(D,V,x.dot(D,V)),y[0]=D[0],y[1]=D[1]}const z=x.cross([],y,C);if(x.len(z)<1e-15)return null;const O=Math.atan2(-z[1],z[0]);return qa(Math.atan2(Math.sqrt(C[0]*C[0]+C[1]*C[1]),-C[2]),O)}class th{constructor(y,S){this.position=y,this.orientation=S}get position(){return this._position}set position(y){this._position=this._renderWorldCopies?function(S){if(!S)return;const D=Array.isArray(S)?new x.MercatorCoordinate(S[0],S[1],S[2]):S;return D.x=x.wrap(D.x,0,1),D}(y):y}lookAtPoint(y,S){if(this.orientation=null,!this.position)return;const D=this._elevation?this._elevation.getAtPointOrZero(x.MercatorCoordinate.fromLngLat(y)):0,z=this.position,O=x.MercatorCoordinate.fromLngLat(y,D),V=[O.x-z.x,O.y-z.y,O.z-z.z];S||(S=[0,0,1]),S[2]=Math.abs(S[2]),this.orientation=Za(V,S)}setPitchBearing(y,S){this.orientation=qa(x.degToRad(y),x.degToRad(-S))}}class Xa{constructor(y,S){this._transform=x.identity([]),this._orientation=x.identity$1([]),S&&(this._orientation=S,Qn(this._transform,this._orientation)),y&&eh(this._transform,y)}get mercatorPosition(){const y=this.position;return new x.MercatorCoordinate(y[0],y[1],y[2])}get position(){const y=x.getColumn(this._transform,3);return[y[0],y[1],y[2]]}set position(y){eh(this._transform,y)}get orientation(){return this._orientation}set orientation(y){this._orientation=y,Qn(this._transform,this._orientation)}getPitchBearing(){const y=this.forward(),S=this.right();return{bearing:Math.atan2(-S[1],S[0]),pitch:Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2])}}setPitchBearing(y,S){this._orientation=qa(y,S),Qn(this._transform,this._orientation)}forward(){const y=x.getColumn(this._transform,2);return[-y[0],-y[1],-y[2]]}up(){const y=x.getColumn(this._transform,1);return[-y[0],-y[1],-y[2]]}right(){const y=x.getColumn(this._transform,0);return[y[0],y[1],y[2]]}getCameraToWorld(y,S){const D=new Float64Array(16);return x.invert(D,this.getWorldToCamera(y,S)),D}getWorldToCameraPosition(y,S,D){const z=this.position;x.scale$2(z,z,-y);const O=new Float64Array(16);return x.fromScaling(O,[D,D,D]),x.translate(O,O,z),O[10]*=S,O}getWorldToCamera(y,S){const D=new Float64Array(16),z=new Float64Array(4),O=this.position;return x.conjugate(z,this._orientation),x.scale$2(O,O,-y),x.fromQuat(D,z),x.translate(D,D,O),D[1]*=-1,D[5]*=-1,D[9]*=-1,D[13]*=-1,D[8]*=S,D[9]*=S,D[10]*=S,D[11]*=S,D}getCameraToClipPerspective(y,S,D,z){const O=new Float64Array(16);return x.perspective(O,y,S,D,z),O}getDistanceToElevation(y){const S=y===0?0:x.mercatorZfromAltitude(y,this.position[1]),D=this.forward();return(S-this.position[2])/D[2]}clone(){return new Xa([...this.position],[...this.orientation])}}function ih(C,y){const S=ia(C),D=function(O,V,Z,K,Q){const ie=new x.LngLat(Z.lng-180*yn,Z.lat),ae=new x.LngLat(Z.lng+180*yn,Z.lat),pe=O.project(ie.lng,ie.lat),Ee=O.project(ae.lng,ae.lat),xe=-Math.atan2(Ee.y-pe.y,Ee.x-pe.x),Te=x.MercatorCoordinate.fromLngLat(Z);Te.y=x.clamp(Te.y,-.999975,.999975);const Fe=Te.toLngLat(),we=O.project(Fe.lng,Fe.lat),De=x.MercatorCoordinate.fromLngLat(Fe);De.x+=yn;const Be=De.toLngLat(),ke=O.project(Be.lng,Be.lat),Ce=Ha(ke.x-we.x,ke.y-we.y,xe),Oe=x.MercatorCoordinate.fromLngLat(Fe);Oe.y+=yn;const He=Oe.toLngLat(),Je=O.project(He.lng,He.lat),xt=Ha(Je.x-we.x,Je.y-we.y,xe),ft=Math.abs(Ce.x)/Math.abs(xt.y),dt=x.identity([]);x.rotateZ(dt,dt,-xe*(1-(Q?0:K)));const it=x.identity([]);return x.scale(it,it,[1,1-(1-ft)*K,1]),it[4]=-xt.x/xt.y*K,x.rotateZ(it,it,xe),x.multiply$1(it,dt,it),it}(C.projection,0,C.center,S,y),z=ta(C);return x.scale(D,D,[z,z,1]),D}function ta(C){const y=C.projection,S=ia(C),D=Ya(y,C.center),z=Ya(y,x.LngLat.convert(y.center));return Math.pow(2,D*S+(1-S)*z)}function ia(C){const y=C.projection.range;if(!y)return 0;const S=Math.max(C.width,C.height),D=Math.log(S/1024)/Math.LN2;return x.smoothstep(y[0]+D,y[1]+D,C.zoom)}const yn=1/4e4;function Ya(C,y){const S=x.clamp(y.lat,-x.MAX_MERCATOR_LATITUDE,x.MAX_MERCATOR_LATITUDE),D=new x.LngLat(y.lng-180*yn,S),z=new x.LngLat(y.lng+180*yn,S),O=C.project(D.lng,S),V=C.project(z.lng,S),Z=x.MercatorCoordinate.fromLngLat(D),K=x.MercatorCoordinate.fromLngLat(z),Q=V.x-O.x,ie=V.y-O.y,ae=K.x-Z.x,pe=K.y-Z.y,Ee=Math.sqrt((ae*ae+pe*pe)/(Q*Q+ie*ie));return Math.log(Ee)/Math.LN2}function Ha(C,y,S){const D=Math.cos(S),z=Math.sin(S);return{x:C*D-y*z,y:C*z+y*D}}class fs{constructor(y,S,D,z,O){this.tileSize=512,this._renderWorldCopies=O===void 0||O,this._minZoom=y||0,this._maxZoom=S||22,this._minPitch=D==null?0:D,this._maxPitch=z==null?60:z,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new x.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ea,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const y=new fs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return y.setProjection(this.getProjection()),y._elevation=this._elevation,y._centerAltitude=this._centerAltitude,y.tileSize=this.tileSize,y.setMaxBounds(this.getMaxBounds()),y.width=this.width,y.height=this.height,y.cameraElevationReference=this.cameraElevationReference,y._center=this._center,y._setZoom(this.zoom),y._cameraZoom=this._cameraZoom,y.angle=this.angle,y._fov=this._fov,y._pitch=this._pitch,y._nearZ=this._nearZ,y._farZ=this._farZ,y._averageElevation=this._averageElevation,y._unmodified=this._unmodified,y._edgeInsets=this._edgeInsets.clone(),y._camera=this._camera.clone(),y._calcMatrices(),y.freezeTileCoverage=this.freezeTileCoverage,y}get elevation(){return this._elevation}set elevation(y){this._elevation!==y&&(this._elevation=y,y?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(y){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),y&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return x.pick(this.projection,["name","center","parallels"])}setProjection(y){y==null&&(y={name:"mercator"}),this.projectionOptions=y;const S=this.projection?this.getProjection():void 0;return this.projection=x.getProjection(y),!q(S,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(y){this._minZoom!==y&&(this._minZoom=y,this.zoom=Math.max(this.zoom,y))}get maxZoom(){return this._maxZoom}set maxZoom(y){this._maxZoom!==y&&(this._maxZoom=y,this.zoom=Math.min(this.zoom,y))}get minPitch(){return this._minPitch}set minPitch(y){this._minPitch!==y&&(this._minPitch=y,this.pitch=Math.max(this.pitch,y))}get maxPitch(){return this._maxPitch}set maxPitch(y){this._maxPitch!==y&&(this._maxPitch=y,this.pitch=Math.min(this.pitch,y))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(y){y===void 0?y=!0:y===null&&(y=!1),this._renderWorldCopies=y}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const y=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(y))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new x.pointGeometry(this.width,this.height)}get bearing(){return x.wrap(this.rotation,-180,180)}set bearing(y){this.rotation=y}get rotation(){return-this.angle/Math.PI*180}set rotation(y){const S=-y*Math.PI/180;var D;this.angle!==S&&(this._unmodified=!1,this.angle=S,this._calcMatrices(),this.rotationMatrix=(D=new x.ARRAY_TYPE(4),x.ARRAY_TYPE!=Float32Array&&(D[1]=0,D[2]=0),D[0]=1,D[3]=1,D),function(z,O,V){var Z=O[0],K=O[1],Q=O[2],ie=O[3],ae=Math.sin(V),pe=Math.cos(V);z[0]=Z*pe+Q*ae,z[1]=K*pe+ie*ae,z[2]=Z*-ae+Q*pe,z[3]=K*-ae+ie*pe}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(y){const S=x.clamp(y,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==S&&(this._unmodified=!1,this._pitch=S,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(y){y=Math.max(.01,Math.min(60,y)),this._fov!==y&&(this._unmodified=!1,this._fov=y/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(y){this._averageElevation=y,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(y){const S=Math.min(Math.max(y,this.minZoom),this.maxZoom);this._zoom!==S&&(this._unmodified=!1,this._setZoom(S),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(y){this._zoom=y,this.scale=this.zoomScale(y),this.tileZoom=Math.floor(y),this.zoomFraction=y-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const y=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return y===-1?(this._cameraZoom=null,!1):(this._centerAltitude=y,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const y=this._elevation,S=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],D=this.horizonLineFromTop();let z=0,O=0;for(let V=0;V<S.length;V++){const Z=new x.pointGeometry(S[V][0]*this.width,D+S[V][1]*(this.height-D)),K=y.pointCoordinate(Z);if(!K)continue;const Q=1/Math.hypot(K[0]-this._camera.position[0],K[1]-this._camera.position[1]);z+=K[3]*Q,O+=Q}return O===0?NaN:z/O}get center(){return this._center}set center(y){y.lat===this._center.lat&&y.lng===this._center.lng||(this._unmodified=!1,this._center=y,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const y=this._cameraZoom,S=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),D=this.pixelsPerMeter/this.worldSize*S,z=this._mercatorZfromZoom(y),O=this._mercatorZfromZoom(this._maxZoom),V=Math.max(z-D,O);this._setZoom(this._zoomFromMercatorZ(V))}get padding(){return this._edgeInsets.toJSON()}set padding(y){this._edgeInsets.equals(y)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,y,1),this._calcMatrices())}computeZoomRelativeTo(y){const S=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,y.toAltitude()));let D;D=y.z<this._camera.position[2]?[S.x,S.y,S.z]:[y.x,y.y,y.z];const z=x.length(x.sub([],this._camera.position,D));return x.clamp(this._zoomFromMercatorZ(z),this._minZoom,this._maxZoom)}setFreeCameraOptions(y){if(!this.height||!y.position&&!y.orientation)return;this._updateCameraState();let S=!1;if(y.orientation&&!x.exactEquals(y.orientation,this._camera.orientation)&&(S=this._setCameraOrientation(y.orientation)),y.position){const D=[y.position.x,y.position.y,y.position.z];x.exactEquals$1(D,this._camera.position)||(this._setCameraPosition(D),S=!0)}S&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const y=this._camera.position,S=new th;return S.position=new x.MercatorCoordinate(y[0],y[1],y[2]),S.orientation=this._camera.orientation,S._elevation=this.elevation,S._renderWorldCopies=this.renderWorldCopies,S}_setCameraOrientation(y){if(!x.length$1(y))return!1;x.normalize$1(y,y);const S=x.transformQuat([],[0,0,-1],y),D=x.transformQuat([],[0,-1,0],y);if(D[2]<0)return!1;const z=Za(S,D);return!!z&&(this._camera.orientation=z,!0)}_setCameraPosition(y){const S=this.zoomScale(this.minZoom)*this.tileSize,D=this.zoomScale(this.maxZoom)*this.tileSize,z=this.cameraToCenterDistance;y[2]=x.clamp(y[2],z/D,z/S),this._camera.position=y}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(y){return this._edgeInsets.equals(y)}interpolatePadding(y,S,D){this._unmodified=!1,this._edgeInsets.interpolate(y,S,D),this._constrain(),this._calcMatrices()}coveringZoomLevel(y){const S=(y.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/y.tileSize));return Math.max(0,S)}getVisibleUnwrappedCoordinates(y){const S=[new x.UnwrappedTileID(0,y)];if(this.renderWorldCopies){const D=this.pointCoordinate(new x.pointGeometry(0,0)),z=this.pointCoordinate(new x.pointGeometry(this.width,0)),O=this.pointCoordinate(new x.pointGeometry(this.width,this.height)),V=this.pointCoordinate(new x.pointGeometry(0,this.height)),Z=Math.floor(Math.min(D.x,z.x,O.x,V.x)),K=Math.floor(Math.max(D.x,z.x,O.x,V.x)),Q=1;for(let ie=Z-Q;ie<=K+Q;ie++)ie!==0&&S.push(new x.UnwrappedTileID(ie,y))}return S}coveringTiles(y){let S=this.coveringZoomLevel(y);const D=S,z=this.elevation&&!y.isTerrainDEM,O=this.projection.name==="mercator";if(y.minzoom!==void 0&&S<y.minzoom)return[];y.maxzoom!==void 0&&S>y.maxzoom&&(S=y.maxzoom);const V=this.locationCoordinate(this.center),Z=1<<S,K=[Z*V.x,Z*V.y,0],Q=x.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,S,this.projection.name!=="globe"),ie=this.pointCoordinate(this.getCameraPoint()),ae=Z*x.mercatorZfromAltitude(1,this.center.lat),pe=this._camera.position[2]/x.mercatorZfromAltitude(1,this.center.lat),Ee=[Z*ie.x,Z*ie.y,pe],xe=this.cameraToCenterDistance/y.tileSize*(y.roundZoom?1:.502),Te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?S:0,Fe=y.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,we=y.isTerrainDEM?-Fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?ta(this):1,Be=Ke=>{const st=new x.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),Yt=new x.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),ii=Ke.toLngLat(),bi=st.toLngLat(),yt=Yt.toLngLat(),Jt=this.locationCoordinate(ii),ui=this.locationCoordinate(bi),Zi=this.locationCoordinate(yt),Qi=Math.hypot(ui.x-Jt.x,ui.y-Jt.y),ai=Math.hypot(Zi.x-Jt.x,Zi.y-Jt.y);return Math.sqrt(Qi*ai)*De/25e-6},ke=Ke=>{const ut=Fe,st=we;return{aabb:x.tileAABB(this,Z,0,0,0,Ke,st,ut,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:ut,wrap:Ke,fullyVisible:!1}},Ce=[];let Oe=[];const He=S,Je=y.reparseOverscaled?D:S,xt=Ke=>Ke*Ke,ft=xt((pe-this._centerAltitude)*ae),dt=Ke=>{if(!this._elevation||!Ke.tileID||!O)return;const ut=this._elevation.getMinMaxForTile(Ke.tileID),st=Ke.aabb;ut?(st.min[2]=ut.min,st.max[2]=ut.max,st.center[2]=(st.min[2]+st.max[2])/2):(Ke.shouldSplit=it(Ke),Ke.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},it=Ke=>{if(Ke.zoom<Te)return!0;if(Ke.zoom===He)return!1;if(Ke.shouldSplit!=null)return Ke.shouldSplit;const ut=Ke.aabb.distanceX(Ee),st=Ke.aabb.distanceY(Ee);let Yt=ft;z&&(Yt=xt(Ke.aabb.distanceZ(Ee)*ae));let ii=1;if(this.projection.isReprojectedInTileSpace&&D<=5){const yt=Math.pow(2,Ke.zoom),Jt=Be(new x.MercatorCoordinate((Ke.x+.5)/yt,(Ke.y+.5)/yt));ii=Jt>.85?1:Jt}const bi=ut*ut+st*st+Yt;return bi<xt((1<<He-Ke.zoom)*xe*ii*((yt,Jt)=>{if(Jt*xt(.707)<yt)return 1;const ui=Math.sqrt(Jt/yt);return ui/(1.4144271570014144+(Math.pow(1.1,ui-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Yt,ft),bi))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)Ce.push(ke(-Ke)),Ce.push(ke(Ke));for(Ce.push(ke(0));Ce.length>0;){const Ke=Ce.pop(),ut=Ke.x,st=Ke.y;let Yt=Ke.fullyVisible;if(!Yt){const ii=Ke.aabb.intersects(Q);if(ii===0)continue;Yt=ii===2}if(Ke.zoom!==He&&it(Ke))for(let ii=0;ii<4;ii++){const bi=(ut<<1)+ii%2,yt=(st<<1)+(ii>>1),Jt={aabb:O?Ke.aabb.quadrant(ii):x.tileAABB(this,Z,Ke.zoom+1,bi,yt,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:bi,y:yt,wrap:Ke.wrap,fullyVisible:Yt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};z&&(Jt.tileID=new x.OverscaledTileID(Ke.zoom+1===He?Je:Ke.zoom+1,Ke.wrap,Ke.zoom+1,bi,yt),dt(Jt)),Ce.push(Jt)}else{const ii=Ke.zoom===He?Je:Ke.zoom;if(y.minzoom&&y.minzoom>ii)continue;const bi=K[0]-(.5+ut+(Ke.wrap<<Ke.zoom))*(1<<S-Ke.zoom),yt=K[1]-.5-st,Jt=Ke.tileID?Ke.tileID:new x.OverscaledTileID(ii,Ke.wrap,Ke.zoom,ut,st);Oe.push({tileID:Jt,distanceSq:bi*bi+yt*yt})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,ut=this.horizonLineFromTop();Oe=Oe.filter(st=>{const Yt=[0,0,0,1],ii=[x.EXTENT,x.EXTENT,0,1],bi=this.calculateFogTileMatrix(st.tileID.toUnwrapped());x.transformMat4$1(Yt,Yt,bi),x.transformMat4$1(ii,ii,bi);const yt=x.getAABBPointSquareDist(Yt,ii);if(yt===0)return!0;let Jt=!1;const ui=this._elevation;if(ui&&yt>Ke&&ut!==0){const Zi=this.calculateProjMatrix(st.tileID.toUnwrapped());let Qi;y.isTerrainDEM||(Qi=ui.getMinMaxForTile(st.tileID)),Qi||(Qi={min:we,max:Fe});const ai=x.furthestTileCorner(this.rotation),Mi=[ai[0]*x.EXTENT,ai[1]*x.EXTENT,Qi.max];x.transformMat4(Mi,Mi,Zi),Jt=(1-Mi[1])*this.height*.5<ut}return yt<Ke||Jt})}return Oe.sort((Ke,ut)=>Ke.distanceSq-ut.distanceSq).map(Ke=>Ke.tileID)}resize(y,S){this.width=y,this.height=S,this.pixelsToGLUnits=[2/y,-2/S],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(y){return Math.pow(2,y)}scaleZoom(y){return Math.log(y)/Math.LN2}project(y){const S=x.clamp(y.lat,-x.MAX_MERCATOR_LATITUDE,x.MAX_MERCATOR_LATITUDE),D=this.projection.project(y.lng,S);return new x.pointGeometry(D.x*this.worldSize,D.y*this.worldSize)}unproject(y){return this.projection.unproject(y.x/this.worldSize,y.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(y,S){const D=this.pointCoordinate(S),z=this.pointCoordinate(this.centerPoint),O=this.locationCoordinate(y);this.setLocation(new x.MercatorCoordinate(O.x-(D.x-z.x),O.y-(D.y-z.y)))}setLocation(y){this.center=this.coordinateLocation(y),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(y){return this.projection.locationPoint(this,y)}locationPoint3D(y){return this._coordinatePoint(this.locationCoordinate(y),!0)}pointLocation(y){return this.coordinateLocation(this.pointCoordinate(y))}pointLocation3D(y){return this.coordinateLocation(this.pointCoordinate3D(y))}locationCoordinate(y,S){const D=S?x.mercatorZfromAltitude(S,y.lat):void 0,z=this.projection.project(y.lng,y.lat);return new x.MercatorCoordinate(z.x,z.y,D)}coordinateLocation(y){return this.projection.unproject(y.x,y.y)}pointRayIntersection(y,S){const D=S!=null?S:this._centerAltitude,z=[y.x,y.y,0,1],O=[y.x,y.y,1,1];x.transformMat4$1(z,z,this.pixelMatrixInverse),x.transformMat4$1(O,O,this.pixelMatrixInverse);const V=O[3];x.scale$1(z,z,1/z[3]),x.scale$1(O,O,1/V);const Z=z[2],K=O[2];return{p0:z,p1:O,t:Z===K?0:(D-Z)/(K-Z)}}screenPointToMercatorRay(y){const S=[y.x,y.y,0,1],D=[y.x,y.y,1,1];return x.transformMat4$1(S,S,this.pixelMatrixInverse),x.transformMat4$1(D,D,this.pixelMatrixInverse),x.scale$1(S,S,1/S[3]),x.scale$1(D,D,1/D[3]),S[2]=x.mercatorZfromAltitude(S[2],this._center.lat)*this.worldSize,D[2]=x.mercatorZfromAltitude(D[2],this._center.lat)*this.worldSize,x.scale$1(S,S,1/this.worldSize),x.scale$1(D,D,1/this.worldSize),new x.Ray([S[0],S[1],S[2]],x.normalize([],x.sub([],D,S)))}rayIntersectionCoordinate(y){const{p0:S,p1:D,t:z}=y,O=x.mercatorZfromAltitude(S[2],this._center.lat),V=x.mercatorZfromAltitude(D[2],this._center.lat);return new x.MercatorCoordinate(x.number(S[0],D[0],z)/this.worldSize,x.number(S[1],D[1],z)/this.worldSize,x.number(O,V,z))}pointCoordinate(y,S=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(y.x,y.y,S)}pointCoordinate3D(y){if(!this.elevation)return this.pointCoordinate(y);const S=this.elevation;let D=this.elevation.pointCoordinate(y);if(D)return new x.MercatorCoordinate(D[0],D[1],D[2]);let z=0,O=this.horizonLineFromTop();if(y.y>O)return this.pointCoordinate(y);const V=.02*O,Z=y.clone();for(let K=0;K<10&&O-z>V;K++){Z.y=x.number(z,O,.66);const Q=S.pointCoordinate(Z);Q?(O=Z.y,D=Q):z=Z.y}return D?new x.MercatorCoordinate(D[0],D[1],D[2]):this.pointCoordinate(y)}isPointAboveHorizon(y){if(this.elevation)return!this.elevation.pointCoordinate(y);{const S=this.horizonLineFromTop();return y.y<S}}_coordinatePoint(y,S){const D=S&&this.elevation?this.elevation.getAtPointOrZero(y,this._centerAltitude):this._centerAltitude,z=[y.x*this.worldSize,y.y*this.worldSize,D+y.toAltitude(),1];return x.transformMat4$1(z,z,this.pixelMatrix),z[3]>0?new x.pointGeometry(z[0]/z[3],z[1]/z[3]):new x.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(y,S){const D=new x.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),z=new x.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),O=new x.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),V=new x.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let Z=this.pointCoordinate(D,y),K=this.pointCoordinate(z,y);const Q=this.pointCoordinate(O,S),ie=this.pointCoordinate(V,S),ae=(pe,Ee)=>(Ee.y-pe.y)/(Ee.x-pe.x);return Z.y>1&&K.y>=0?Z=new x.MercatorCoordinate((1-ie.y)/ae(ie,Z)+ie.x,1):Z.y<0&&K.y<=1&&(Z=new x.MercatorCoordinate(-ie.y/ae(ie,Z)+ie.x,0)),K.y>1&&Z.y>=0?K=new x.MercatorCoordinate((1-Q.y)/ae(Q,K)+Q.x,1):K.y<0&&Z.y<=1&&(K=new x.MercatorCoordinate(-Q.y/ae(Q,K)+Q.x,0)),new x.LngLatBounds().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(Q))}_getBounds3D(){const y=this.elevation;if(!y.visibleDemTiles.length)return this._getBounds(0,0);const S=y.visibleDemTiles.reduce((D,z)=>{if(z.dem){const O=z.dem.tree;D.min=Math.min(D.min,O.minimums[0]),D.max=Math.max(D.max,O.maximums[0])}return D},{min:Number.MAX_VALUE,max:0});return this._getBounds(S.min*y.exaggeration(),S.max*y.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(y=!0){const S=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,D=this.height/2-S*(1-this._horizonShift);return y?Math.max(0,D):D}getMaxBounds(){return this.maxBounds}setMaxBounds(y){this.maxBounds=y,this.minLat=-x.MAX_MERCATOR_LATITUDE,this.maxLat=x.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,y&&(this.minLat=y.getSouth(),this.maxLat=y.getNorth(),this.minLng=y.getWest(),this.maxLng=y.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=x.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=x.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=x.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=x.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(y,S){return this.projection.createTileTransform(this,S).createTileMatrix(y)}calculateDistanceTileData(y){const S=y.key,D=this._distanceTileDataCache;if(D[S])return D[S];const z=y.canonical,O=1/this.height,V=this.cameraWorldSize/this.zoomScale(z.z),Z=(z.x+Math.pow(2,z.z)*y.wrap)*V,K=z.y*V,Q=this.point,ie=this.angle,ae=Math.sin(-ie),pe=-Math.cos(-ie);return D[S]={bearing:[ae,pe],center:[(Q.x-Z)*O,(Q.y-K)*O],scale:V/x.EXTENT*O},D[S]}calculateFogTileMatrix(y){const S=y.key,D=this._fogTileMatrixCache;if(D[S])return D[S];const z=this.calculatePosMatrix(y,this.cameraWorldSize);return x.multiply$1(z,this.worldToFogMatrix,z),D[S]=new Float32Array(z),D[S]}calculateProjMatrix(y,S=!1){const D=y.key,z=S?this._alignedProjMatrixCache:this._projMatrixCache;if(z[D])return z[D];const O=this.calculatePosMatrix(y,this.worldSize);return x.multiply$1(O,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:S?this.alignedProjMatrix:this.projMatrix,O),z[D]=new Float32Array(O),z[D]}calculatePixelsToTileUnitsMatrix(y){const S=y.tileID.key,D=this._pixelsToTileUnitsCache;if(D[S])return D[S];const z=function(O,V){const{scale:Z}=O.tileTransform,K=Z*x.EXTENT/(O.tileSize*Math.pow(2,V.zoom-O.tileID.overscaledZ+O.tileID.canonical.z));return Q=new Float32Array(4),pe=(ie=V.inverseAdjustmentMatrix)[1],Ee=ie[2],xe=ie[3],Fe=(ae=[K,K])[1],Q[0]=ie[0]*(Te=ae[0]),Q[1]=pe*Te,Q[2]=Ee*Fe,Q[3]=xe*Fe,Q;var Q,ie,ae,pe,Ee,xe,Te,Fe}(y,this);return D[S]=z,D[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const y=this._elevation;this._updateCameraState();const S=x.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,D=this._computeCameraPosition(S),z=this._camera.forward(),O=x.mercatorZfromAltitude(1,this._center.lat);D[2]/=O,z[2]/=O,x.normalize(z,z);const V=y.raycast(D,z,y.exaggeration());if(V){const Z=x.scaleAndAdd([],D,z,V),K=new x.MercatorCoordinate(Z[0],Z[1],x.mercatorZfromAltitude(Z[2],x.latFromMercatorY(Z[1]))),Q=(K.z+x.length([K.x-D[0],K.y-D[1],K.z-D[2]*O]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=K.toAltitude(),this._center=this.coordinateLocation(K),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const y=this._elevation;this._updateCameraState();const S=x.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,D=this._computeCameraPosition(S),z=y.getAtPointOrZero(new x.MercatorCoordinate(...D)),O=this._minimumHeightOverTerrain()*Math.cos(x.degToRad(this._maxPitch)),V=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*z;if(V<O){const Z=this.locationCoordinate(this._center,this._centerAltitude),K=[Z.x-D[0],Z.y-D[1],Z.z-D[2]],Q=x.length(K);K[2]-=(O-V)/this._projectionScaler;const ie=x.length(K);if(ie===0)return;x.scale$2(K,K,Q/ie*this._projectionScaler),this._camera.position=[Z.x-K[0],Z.y-K[1],Z.z*this._projectionScaler-K[2]],this._camera.orientation=Za(K,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const ae=this.center;return ae.lat=x.clamp(ae.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(ae.lng=x.clamp(ae.lng,this.minLng,this.maxLng)),this.center=ae,void(this._constraining=!1)}const y=this._unmodified,{x:S,y:D}=this.point;let z=0,O=S,V=D;const Z=this.width/2,K=this.height/2,Q=this.worldMinY*this.scale,ie=this.worldMaxY*this.scale;if(D-K<Q&&(V=Q+K),D+K>ie&&(V=ie-K),ie-Q<this.height&&(z=Math.max(z,this.height/(ie-Q)),V=(ie+Q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ae=this.worldMinX*this.scale,pe=this.worldMaxX*this.scale,Ee=this.worldSize/2-(ae+pe)/2;O=(S+Ee+this.worldSize)%this.worldSize-Ee,O-Z<ae&&(O=ae+Z),O+Z>pe&&(O=pe-Z),pe-ae<this.width&&(z=Math.max(z,this.width/(pe-ae)),O=(pe+ae)/2)}O===S&&V===D||(this.center=this.unproject(new x.pointGeometry(O,V))),z&&(this.zoom+=this.scaleZoom(z)),this._constrainCameraAltitude(),this._unmodified=y,this._constraining=!1}_minZoomForBounds(){let y=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(y=Math.max(y,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),y}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const y=this._fov/2,S=this.centerOffset,D=this.pixelsPerMeter;this._projectionScaler=D/(x.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(y)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const z=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?D:1),O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);O[8]=2*-S.x/this.width,O[9]=2*S.y/this.height;let V=x.mul([],O,z);if(this.projection.isReprojectedInTileSpace){const ke=this.locationCoordinate(this.center),Ce=x.identity([]);x.translate(Ce,Ce,[ke.x*this.worldSize,ke.y*this.worldSize,0]),x.multiply$1(Ce,Ce,ih(this)),x.translate(Ce,Ce,[-ke.x*this.worldSize,-ke.y*this.worldSize,0]),x.multiply$1(V,V,Ce),this.inverseAdjustmentMatrix=function(Oe){const He=ih(Oe,!0);return U([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=x.scale([],V,[this.worldSize,this.worldSize,this.worldSize/D,1]),this.projMatrix=V,this.invProjMatrix=x.invert(new Float64Array(16),this.projMatrix);const Z=new Float32Array(16);x.identity(Z),x.scale(Z,Z,[1,-1,1]),x.rotateX(Z,Z,this._pitch),x.rotateZ(Z,Z,this.angle);const K=x.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-S.x/this.width,K[9]=2*(S.y+Q)/this.height,this.skyboxMatrix=x.multiply$1(Z,K,Z);const ie=this.point,ae=ie.x,pe=ie.y,Ee=this.width%2/2,xe=this.height%2/2,Te=Math.cos(this.angle),Fe=Math.sin(this.angle),we=ae-Math.round(ae)+Te*Ee+Fe*xe,De=pe-Math.round(pe)+Te*xe+Fe*Ee,Be=new Float64Array(V);if(x.translate(Be,Be,[we>.5?we-1:we,De>.5?De-1:De,0]),this.alignedProjMatrix=Be,V=x.create(),x.scale(V,V,[this.width/2,-this.height/2,1]),x.translate(V,V,[1,-1,0]),this.labelPlaneMatrix=V,V=x.create(),x.scale(V,V,[1,-1,1]),x.translate(V,V,[-1,-1,0]),x.scale(V,V,[2/this.width,2/this.height,1]),this.glCoordMatrix=V,this.pixelMatrix=x.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},V=x.invert(new Float64Array(16),this.pixelMatrix),!V)throw new Error("failed to invert matrix");this.pixelMatrixInverse=V,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const y=this.cameraWorldSize,S=this.cameraPixelsPerMeter,D=this._camera.position,z=1/this.height,O=[y,y,S];x.scale$2(O,O,z),x.scale$2(D,D,-1),x.multiply$2(D,D,O);const V=x.create();x.translate(V,V,D),x.scale(V,V,O),this.mercatorFogMatrix=V,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(y,S,z)}_computeCameraPosition(y){const S=(y=y||this.pixelsPerMeter)/this.pixelsPerMeter,D=this._camera.forward(),z=this.point,O=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*S-y/this.worldSize*this._centerAltitude;return[z.x/this.worldSize-D[0]*O,z.y/this.worldSize-D[1]*O,y/this.worldSize*this._centerAltitude-D[2]*O]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(y){const S=this._maxCameraBoundsDistance()*Math.cos(this._pitch),D=y[2];let z=1;D>0&&(z=Math.min((S-this._camera.position[2])/D,1)),this._camera.position=x.scaleAndAdd([],this._camera.position,y,z),this._updateStateFromCamera()}_updateStateFromCamera(){const y=this._camera.position,S=this._camera.forward(),{pitch:D,bearing:z}=this._camera.getPitchBearing(),O=x.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,V=this._mercatorZfromZoom(this._maxZoom)*Math.cos(x.degToRad(this._maxPitch)),Z=Math.max((y[2]-O)/Math.cos(D),V),K=this._zoomFromMercatorZ(Z);x.scaleAndAdd(y,y,S,Z),this._pitch=x.clamp(D,x.degToRad(this.minPitch),x.degToRad(this.maxPitch)),this.angle=x.wrap(z,-Math.PI,Math.PI),this._setZoom(x.clamp(K,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new x.MercatorCoordinate(y[0],y[1],y[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(y){return Math.pow(2,y)*this.tileSize}_mercatorZfromZoom(y){return this.cameraToCenterDistance/this._worldSizeFromZoom(y)}_minimumHeightOverTerrain(){const y=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(y)}_zoomFromMercatorZ(y){return this.scaleZoom(this.cameraToCenterDistance/(y*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(x.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(y,S){const D=Math.min(y.x,S.x),z=Math.max(y.x,S.x),O=Math.min(y.y,S.y),V=Math.max(y.y,S.y);if(O<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Z=[new x.pointGeometry(D,O),new x.pointGeometry(z,V),new x.pointGeometry(D,V),new x.pointGeometry(z,O)],K=this.renderWorldCopies?-3:0,Q=this.renderWorldCopies?4:1;for(const ie of Z){const ae=this.pointRayIntersection(ie);if(ae.t<0)return!0;const pe=this.rayIntersectionCoordinate(ae);if(pe.x<K||pe.y<0||pe.x>Q||pe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+x.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new x.pointGeometry(0,0),new x.pointGeometry(this.width,this.height))}zoomDeltaToMovement(y,S){const D=x.length(x.sub([],this._camera.position,y)),z=this._zoomFromMercatorZ(D)+S;return D-this._mercatorZfromZoom(z)}getCameraPoint(){const y=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new x.pointGeometry(0,y))}}function eo(C,y){let S=!1,D=null;const z=()=>{D=null,S&&(C(),D=setTimeout(z,y),S=!1)};return()=>(S=!0,D||z(),D)}class rh{constructor(y){this._hashName=y&&encodeURIComponent(y),x.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=eo(this._updateHashUnthrottled.bind(this),300)}addTo(y){return this._map=y,x.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return x.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(y){const S=this._map.getCenter(),D=Math.round(100*this._map.getZoom())/100,z=Math.ceil((D*Math.LN2+Math.log(512/360/.5))/Math.LN10),O=Math.pow(10,z),V=Math.round(S.lng*O)/O,Z=Math.round(S.lat*O)/O,K=this._map.getBearing(),Q=this._map.getPitch();let ie="";if(ie+=y?`/${V}/${Z}/${D}`:`${D}/${Z}/${V}`,(K||Q)&&(ie+="/"+Math.round(10*K)/10),Q&&(ie+=`/${Math.round(Q)}`),this._hashName){const ae=this._hashName;let pe=!1;const Ee=x.window.location.hash.slice(1).split("&").map(xe=>{const Te=xe.split("=")[0];return Te===ae?(pe=!0,`${Te}=${ie}`):xe}).filter(xe=>xe);return pe||Ee.push(`${ae}=${ie}`),`#${Ee.join("&")}`}return`#${ie}`}_getCurrentHash(){const y=x.window.location.hash.replace("#","");if(this._hashName){let S;return y.split("&").map(D=>D.split("=")).forEach(D=>{D[0]===this._hashName&&(S=D)}),(S&&S[1]||"").split("/")}return y.split("/")}_onHashChange(){const y=this._getCurrentHash();if(y.length>=3&&!y.some(S=>isNaN(S))){const S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:S,pitch:+(y[4]||0)}),!0}return!1}_updateHashUnthrottled(){const y=x.window.location.href.replace(/(#.+)?$/,this.getHashString());x.window.history.replaceState(x.window.history.state,null,y)}}const Ln={linearity:.3,easing:x.bezier(0,0,.3,1)},ko=x.extend({deceleration:2500,maxSpeed:1400},Ln),nh=x.extend({deceleration:20,maxSpeed:1400},Ln),Wa=x.extend({deceleration:1e3,maxSpeed:360},Ln),Ui=x.extend({deceleration:1e3,maxSpeed:90},Ln);class ra{constructor(y){this._map=y,this.clear()}clear(){this._inertiaBuffer=[]}record(y){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.exported.now(),settings:y})}_drainInertiaBuffer(){const y=this._inertiaBuffer,S=x.exported.now();for(;y.length>0&&S-y[0].time>160;)y.shift()}_onMoveEnd(y){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const S={zoom:0,bearing:0,pitch:0,pan:new x.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:O}of this._inertiaBuffer)S.zoom+=O.zoomDelta||0,S.bearing+=O.bearingDelta||0,S.pitch+=O.pitchDelta||0,O.panDelta&&S.pan._add(O.panDelta),O.around&&(S.around=O.around),O.pinchAround&&(S.pinchAround=O.pinchAround);const D=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,z={};if(S.pan.mag()){const O=ps(S.pan.mag(),D,x.extend({},ko,y||{}));z.offset=S.pan.mult(O.amount/S.pan.mag()),z.center=this._map.transform.center,na(z,O)}if(S.zoom){const O=ps(S.zoom,D,nh);z.zoom=this._map.transform.zoom+O.amount,na(z,O)}if(S.bearing){const O=ps(S.bearing,D,Wa);z.bearing=this._map.transform.bearing+x.clamp(O.amount,-179,179),na(z,O)}if(S.pitch){const O=ps(S.pitch,D,Ui);z.pitch=this._map.transform.pitch+O.amount,na(z,O)}if(z.zoom||z.bearing){const O=S.pinchAround===void 0?S.around:S.pinchAround;z.around=O?this._map.unproject(O):this._map.getCenter()}return this.clear(),x.extend(z,{noMoveStart:!0})}}function na(C,y){(!C.duration||C.duration<y.duration)&&(C.duration=y.duration,C.easing=y.easing)}function ps(C,y,S){const{maxSpeed:D,linearity:z,deceleration:O}=S,V=x.clamp(C*z/(y/1e3),-D,D),Z=Math.abs(V)/(O*z);return{easing:S.easing,duration:1e3*Z,amount:V*(Z/2)}}class Fr extends x.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,D,z={}){const O=G.mousePos(S.getCanvasContainer(),D),V=S.unproject(O);super(y,x.extend({point:O,lngLat:V,originalEvent:D},z)),this._defaultPrevented=!1,this.target=S}}class oa extends x.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,D){const z=y==="touchend"?D.changedTouches:D.touches,O=G.touchPos(S.getCanvasContainer(),z),V=O.map(K=>S.unproject(K)),Z=O.reduce((K,Q,ie,ae)=>K.add(Q.div(ae.length)),new x.pointGeometry(0,0));super(y,{points:O,point:Z,lngLats:V,lngLat:S.unproject(Z),originalEvent:D}),this._defaultPrevented=!1}}class cc extends x.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,D){super(y,{originalEvent:D}),this._defaultPrevented=!1}}class oh{constructor(y,S){this._map=y,this._clickTolerance=S.clickTolerance}reset(){delete this._mousedownPos}wheel(y){return this._firePreventable(new cc(y.type,this._map,y))}mousedown(y,S){return this._mousedownPos=S,this._firePreventable(new Fr(y.type,this._map,y))}mouseup(y){this._map.fire(new Fr(y.type,this._map,y))}preclick(y){const S=x.extend({},y);S.type="preclick",this._map.fire(new Fr(S.type,this._map,S))}click(y,S){this._mousedownPos&&this._mousedownPos.dist(S)>=this._clickTolerance||(this.preclick(y),this._map.fire(new Fr(y.type,this._map,y)))}dblclick(y){return this._firePreventable(new Fr(y.type,this._map,y))}mouseover(y){this._map.fire(new Fr(y.type,this._map,y))}mouseout(y){this._map.fire(new Fr(y.type,this._map,y))}touchstart(y){return this._firePreventable(new oa(y.type,this._map,y))}touchmove(y){this._map.fire(new oa(y.type,this._map,y))}touchend(y){this._map.fire(new oa(y.type,this._map,y))}touchcancel(y){this._map.fire(new oa(y.type,this._map,y))}_firePreventable(y){if(this._map.fire(y),y.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uc{constructor(y){this._map=y}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(y){this._map.fire(new Fr(y.type,this._map,y))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(y){this._delayContextMenu?this._contextMenuEvent=y:this._map.fire(new Fr(y.type,this._map,y)),this._map.listens("contextmenu")&&y.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ka{constructor(y,S){this._map=y,this._el=y.getCanvasContainer(),this._container=y.getContainer(),this._clickTolerance=S.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(y,S){this.isEnabled()&&y.shiftKey&&y.button===0&&(G.disableDrag(),this._startPos=this._lastPos=S,this._active=!0)}mousemoveWindow(y,S){if(!this._active)return;const D=S;if(this._lastPos.equals(D)||!this._box&&D.dist(this._startPos)<this._clickTolerance)return;const z=this._startPos;this._lastPos=D,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",y));const O=Math.min(z.x,D.x),V=Math.max(z.x,D.x),Z=Math.min(z.y,D.y),K=Math.max(z.y,D.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${Z}px)`,this._box.style.width=V-O+"px",this._box.style.height=K-Z+"px")})}mouseupWindow(y,S){if(!this._active||y.button!==0)return;const D=this._startPos,z=S;if(this.reset(),G.suppressClick(),D.x!==z.x||D.y!==z.y)return this._map.fire(new x.Event("boxzoomend",{originalEvent:y})),{cameraAnimation:O=>O.fitScreenCoordinates(D,z,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",y)}keydown(y){this._active&&y.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",y))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(y,S){return this._map.fire(new x.Event(y,{originalEvent:S}))}}function Co(C,y){const S={};for(let D=0;D<C.length;D++)S[C[D].identifier]=y[D];return S}class ms{constructor(y){this.reset(),this.numTouches=y.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(y,S,D){(this.centroid||D.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=y.timeStamp),D.length===this.numTouches&&(this.centroid=function(z){const O=new x.pointGeometry(0,0);for(const V of z)O._add(V);return O.div(z.length)}(S),this.touches=Co(D,S)))}touchmove(y,S,D){if(this.aborted||!this.centroid)return;const z=Co(D,S);for(const O in this.touches){const V=this.touches[O],Z=z[O];(!Z||Z.dist(V)>30)&&(this.aborted=!0)}}touchend(y,S,D){if((!this.centroid||y.timeStamp-this.startTime>500)&&(this.aborted=!0),D.length===0){const z=!this.aborted&&this.centroid;if(this.reset(),z)return z}}}class gs{constructor(y){this.singleTap=new ms(y),this.numTaps=y.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(y,S,D){this.singleTap.touchstart(y,S,D)}touchmove(y,S,D){this.singleTap.touchmove(y,S,D)}touchend(y,S,D){const z=this.singleTap.touchend(y,S,D);if(z){const O=y.timeStamp-this.lastTime<500,V=!this.lastTap||this.lastTap.dist(z)<30;if(O&&V||this.reset(),this.count++,this.lastTime=y.timeStamp,this.lastTap=z,this.count===this.numTaps)return this.reset(),z}}}class Ja{constructor(){this._zoomIn=new gs({numTouches:1,numTaps:2}),this._zoomOut=new gs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(y,S,D){this._zoomIn.touchstart(y,S,D),this._zoomOut.touchstart(y,S,D)}touchmove(y,S,D){this._zoomIn.touchmove(y,S,D),this._zoomOut.touchmove(y,S,D)}touchend(y,S,D){const z=this._zoomIn.touchend(y,S,D),O=this._zoomOut.touchend(y,S,D);return z?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:V=>V.easeTo({duration:300,zoom:V.getZoom()+1,around:V.unproject(z)},{originalEvent:y})}):O?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:V=>V.easeTo({duration:300,zoom:V.getZoom()-1,around:V.unproject(O)},{originalEvent:y})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const sh={0:1,2:2};class Do{constructor(y){this.reset(),this._clickTolerance=y.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(y,S){return!1}_move(y,S){return{}}mousedown(y,S){if(this._lastPoint)return;const D=G.mouseButton(y);this._correctButton(y,D)&&(this._lastPoint=S,this._eventButton=D)}mousemoveWindow(y,S){const D=this._lastPoint;if(D){if(y.preventDefault(),function(z,O){const V=sh[O];return z.buttons===void 0||(z.buttons&V)!==V}(y,this._eventButton))this.reset();else if(this._moved||!(S.dist(D)<this._clickTolerance))return this._moved=!0,this._lastPoint=S,this._move(D,S)}}mouseupWindow(y){this._lastPoint&&G.mouseButton(y)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sa extends Do{mousedown(y,S){super.mousedown(y,S),this._lastPoint&&(this._active=!0)}_correctButton(y,S){return S===0&&!y.ctrlKey}_move(y,S){return{around:S,panDelta:S.sub(y)}}}class cn extends Do{_correctButton(y,S){return S===0&&y.ctrlKey||S===2}_move(y,S){const D=.8*(S.x-y.x);if(D)return this._active=!0,{bearingDelta:D}}contextmenu(y){y.preventDefault()}}class Qa extends Do{_correctButton(y,S){return S===0&&y.ctrlKey||S===2}_move(y,S){const D=-.5*(S.y-y.y);if(D)return this._active=!0,{pitchDelta:D}}contextmenu(y){y.preventDefault()}}class ah{constructor(y,S){this._map=y,this._el=y.getCanvasContainer(),this._minTouches=1,this._clickTolerance=S.clickTolerance||1,this.reset(),x.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new x.pointGeometry(0,0)}touchstart(y,S,D){return this._calculateTransform(y,S,D)}touchmove(y,S,D){if(this._active&&!(D.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(D.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return y.preventDefault(),this._calculateTransform(y,S,D)}}touchend(y,S,D){this._calculateTransform(y,S,D),this._active&&D.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(y,S,D){D.length>0&&(this._active=!0);const z=Co(D,S),O=new x.pointGeometry(0,0),V=new x.pointGeometry(0,0);let Z=0;for(const Q in z){const ie=z[Q],ae=this._touches[Q];ae&&(O._add(ie),V._add(ie.sub(ae)),Z++,z[Q]=ie)}if(this._touches=z,Z<this._minTouches||!V.mag())return;const K=V.div(Z);return this._sum._add(K),this._sum.mag()<this._clickTolerance?void 0:{around:O.div(Z),panDelta:K}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(y){}_move(y,S,D){return{}}touchstart(y,S,D){this._firstTwoTouches||D.length<2||(this._firstTwoTouches=[D[0].identifier,D[1].identifier],this._start([S[0],S[1]]))}touchmove(y,S,D){if(!this._firstTwoTouches)return;y.preventDefault();const[z,O]=this._firstTwoTouches,V=zn(D,S,z),Z=zn(D,S,O);if(!V||!Z)return;const K=this._aroundCenter?null:V.add(Z).div(2);return this._move([V,Z],K,y)}touchend(y,S,D){if(!this._firstTwoTouches)return;const[z,O]=this._firstTwoTouches,V=zn(D,S,z),Z=zn(D,S,O);V&&Z||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(y){this._enabled=!0,this._aroundCenter=!!y&&y.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zn(C,y,S){for(let D=0;D<C.length;D++)if(C[D].identifier===S)return y[D]}function el(C,y){return Math.log(C/y)/Math.LN2}class la extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(y){this._startDistance=this._distance=y[0].dist(y[1])}_move(y,S){const D=this._distance;if(this._distance=y[0].dist(y[1]),this._active||!(Math.abs(el(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:el(this._distance,D),pinchAround:S}}}function ha(C,y){return 180*C.angleWith(y)/Math.PI}class ca extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(y){this._startVector=this._vector=y[0].sub(y[1]),this._minDiameter=y[0].dist(y[1])}_move(y,S){const D=this._vector;if(this._vector=y[0].sub(y[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ha(this._vector,D),pinchAround:S}}_isBelowThreshold(y){this._minDiameter=Math.min(this._minDiameter,y.mag());const S=25/(Math.PI*this._minDiameter)*360,D=ha(y,this._startVector);return Math.abs(D)<S}}function ua(C){return Math.abs(C.y)>Math.abs(C.x)}class lh extends aa{constructor(y){super(),this._map=y}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(y){this._lastPoints=y,ua(y[0].sub(y[1]))&&(this._valid=!1)}_move(y,S,D){const z=y[0].sub(this._lastPoints[0]),O=y[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&D.touches.length<3)&&(this._valid=this.gestureBeginsVertically(z,O,D.timeStamp),this._valid))return this._lastPoints=y,this._active=!0,{pitchDelta:(z.y+O.y)/2*-.5}}gestureBeginsVertically(y,S,D){if(this._valid!==void 0)return this._valid;const z=y.mag()>=2,O=S.mag()>=2;if(!z&&!O)return;if(!z||!O)return this._firstMove===void 0&&(this._firstMove=D),D-this._firstMove<100&&void 0;const V=y.y>0==S.y>0;return ua(y)&&ua(S)&&V}}const Po={panStep:100,bearingStep:15,pitchStep:10};class dc{constructor(){const y=Po;this._panStep=y.panStep,this._bearingStep=y.bearingStep,this._pitchStep=y.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(y){if(y.altKey||y.ctrlKey||y.metaKey)return;let S=0,D=0,z=0,O=0,V=0;switch(y.keyCode){case 61:case 107:case 171:case 187:S=1;break;case 189:case 109:case 173:S=-1;break;case 37:y.shiftKey?D=-1:(y.preventDefault(),O=-1);break;case 39:y.shiftKey?D=1:(y.preventDefault(),O=1);break;case 38:y.shiftKey?z=1:(y.preventDefault(),V=-1);break;case 40:y.shiftKey?z=-1:(y.preventDefault(),V=1);break;default:return}return this._rotationDisabled&&(D=0,z=0),{cameraAnimation:Z=>{const K=Z.getZoom();Z.easeTo({duration:300,easeId:"keyboardHandler",easing:fc,zoom:S?Math.round(K)+S*(y.shiftKey?2:1):K,bearing:Z.getBearing()+D*this._bearingStep,pitch:Z.getPitch()+z*this._pitchStep,offset:[-O*this._panStep,-V*this._panStep],center:Z.getCenter()},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fc(C){return C*(2-C)}const tl=4.000244140625;class da{constructor(y,S){this._map=y,this._el=y.getCanvasContainer(),this._handler=S,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,x.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(y){this._defaultZoomRate=y}setWheelZoomRate(y){this._wheelZoomRate=y}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(y){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!y&&y.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(y){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(y.ctrlKey||y.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let S=y.deltaMode===x.window.WheelEvent.DOM_DELTA_LINE?40*y.deltaY:y.deltaY;const D=x.exported.now(),z=D-(this._lastWheelEventTime||0);this._lastWheelEventTime=D,S!==0&&S%tl==0?this._type="wheel":S!==0&&Math.abs(S)<4?this._type="trackpad":z>400?(this._type=null,this._lastValue=S,this._timeout=setTimeout(this._onTimeout,40,y)):this._type||(this._type=Math.abs(z*S)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,S+=this._lastValue)),y.shiftKey&&S&&(S/=4),this._type&&(this._lastWheelEvent=y,this._delta-=S,this._active||this._start(y)),y.preventDefault()}_onTimeout(y){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)}_start(y){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const S=G.mousePos(this._el,y);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:S,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const y=this._map.transform,S=()=>y._terrainEnabled()&&this._aroundCoord?y.computeZoomRelativeTo(this._aroundCoord):y.zoom;if(this._delta!==0){const K=this._type==="wheel"&&Math.abs(this._delta)>tl?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*K)));this._delta<0&&Q!==0&&(Q=1/Q);const ie=S(),ae=Math.pow(2,ie),pe=typeof this._targetZoom=="number"?y.zoomScale(this._targetZoom):ae;this._targetZoom=Math.min(y.maxZoom,Math.max(y.minZoom,y.scaleZoom(pe*Q))),this._type==="wheel"&&(this._startZoom=S(),this._easing=this._smoothOutEasing(200)),this._delta=0}const D=typeof this._targetZoom=="number"?this._targetZoom:S(),z=this._startZoom,O=this._easing;let V,Z=!1;if(this._type==="wheel"&&z&&O){const K=Math.min((x.exported.now()-this._lastWheelEventTime)/200,1),Q=O(K);V=x.number(z,D,Q),K<1?this._frameId||(this._frameId=!0):Z=!0}else V=D,Z=!0;return this._active=!0,Z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Z,zoomDelta:V-S(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(y){let S=x.ease;if(this._prevEase){const D=this._prevEase,z=(x.exported.now()-D.start)/D.duration,O=D.easing(z+.01)-D.easing(z),V=.27/Math.sqrt(O*O+1e-4)*.01,Z=Math.sqrt(.0729-V*V);S=x.bezier(V,Z,.25,1)}return this._prevEase={start:x.exported.now(),duration:y,easing:S},S}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(x.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!x.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class il{constructor(y,S){this._clickZoom=y,this._tapZoom=S}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(y,S){return y.preventDefault(),{cameraAnimation:D=>{D.easeTo({duration:300,zoom:D.getZoom()+(y.shiftKey?-1:1),around:D.unproject(S)},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ch{constructor(){this._tap=new gs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(y,S,D){this._swipePoint||(this._tapTime&&y.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?D.length>0&&(this._swipePoint=S[0],this._swipeTouch=D[0].identifier):this._tap.touchstart(y,S,D))}touchmove(y,S,D){if(this._tapTime){if(this._swipePoint){if(D[0].identifier!==this._swipeTouch)return;const z=S[0],O=z.y-this._swipePoint.y;return this._swipePoint=z,y.preventDefault(),this._active=!0,{zoomDelta:O/128}}}else this._tap.touchmove(y,S,D)}touchend(y,S,D){this._tapTime?this._swipePoint&&D.length===0&&this.reset():this._tap.touchend(y,S,D)&&(this._tapTime=y.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fa{constructor(y,S,D){this._el=y,this._mousePan=S,this._touchPan=D}enable(y){this._inertiaOptions=y||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rl{constructor(y,S,D){this._pitchWithRotate=y.pitchWithRotate,this._mouseRotate=S,this._mousePitch=D}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uh{constructor(y,S,D,z){this._el=y,this._touchZoom=S,this._touchRotate=D,this._tapDragZoom=z,this._rotationDisabled=!1,this._enabled=!0}enable(y){this._touchZoom.enable(y),this._rotationDisabled||this._touchRotate.enable(y),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _s=C=>C.zoom||C.drag||C.pitch||C.rotate;class dh extends x.Event{}class fh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(y,S){const D=x.sub([],S,y);this.radius=x.length(D[2]<0?x.div([],D,this.constants):[D[0],D[1],0])}projectRay(y){x.div(y,y,this.constants),x.normalize(y,y),x.mul$1(y,y,this.constants);const S=x.scale$2([],y,this.radius);if(S[2]>0){const D=x.scale$2([],[0,0,1],x.dot(S,[0,0,1])),z=x.scale$2([],x.normalize([],[S[0],S[1],0]),this.radius),O=x.add([],S,x.scale$2([],x.sub([],x.add([],z,D),S),2));S[0]=O[0],S[1]=O[1]}return S}}function ys(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta}class Ro{constructor(y,S){this._map=y,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ra(y),this._bearingSnap=S.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(S),x.bindAll(["handleEvent","handleWindowEvent"],this);const D=this._el;this._listeners=[[D,"touchstart",{passive:!0}],[D,"touchmove",{passive:!1}],[D,"touchend",void 0],[D,"touchcancel",void 0],[D,"mousedown",void 0],[D,"mousemove",void 0],[D,"mouseup",void 0],[x.window.document,"mousemove",{capture:!0}],[x.window.document,"mouseup",void 0],[D,"mouseover",void 0],[D,"mouseout",void 0],[D,"dblclick",void 0],[D,"click",void 0],[D,"keydown",{capture:!1}],[D,"keyup",void 0],[D,"wheel",{passive:!1}],[D,"contextmenu",void 0],[x.window,"blur",void 0]];for(const[z,O,V]of this._listeners)z.addEventListener(O,z===x.window.document?this.handleWindowEvent:this.handleEvent,V)}destroy(){for(const[y,S,D]of this._listeners)y.removeEventListener(S,y===x.window.document?this.handleWindowEvent:this.handleEvent,D)}_addDefaultHandlers(y){const S=this._map,D=S.getCanvasContainer();this._add("mapEvent",new oh(S,y));const z=S.boxZoom=new Ka(S,y);this._add("boxZoom",z);const O=new Ja,V=new hh;S.doubleClickZoom=new il(V,O),this._add("tapZoom",O),this._add("clickZoom",V);const Z=new ch;this._add("tapDragZoom",Z);const K=S.touchPitch=new lh(S);this._add("touchPitch",K);const Q=new cn(y),ie=new Qa(y);S.dragRotate=new rl(y,Q,ie),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate"]);const ae=new sa(y),pe=new ah(S,y);S.dragPan=new fa(D,ae,pe),this._add("mousePan",ae),this._add("touchPan",pe,["touchZoom","touchRotate"]);const Ee=new ca,xe=new la;S.touchZoomRotate=new uh(D,xe,Ee,Z),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",xe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new uc(S));const Te=S.scrollZoom=new da(S,this);this._add("scrollZoom",Te,["mousePan"]);const Fe=S.keyboard=new dc;this._add("keyboard",Fe);for(const we of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])y.interactive&&y[we]&&S[we].enable(y[we])}_add(y,S,D){this._handlers.push({handlerName:y,handler:S,allowed:D}),this._handlersById[y]=S}stop(y){if(!this._updatingCamera){for(const{handler:S}of this._handlers)S.reset();this._inertia.clear(),this._fireEvents({},{},y),this._changes=[]}}isActive(){for(const{handler:y}of this._handlers)if(y.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(_s(this._eventsInProgress))||this.isZooming()}_blockedByActive(y,S,D){for(const z in y)if(z!==D&&(!S||S.indexOf(z)<0))return!0;return!1}handleWindowEvent(y){this.handleEvent(y,`${y.type}Window`)}_getMapTouches(y){const S=[];for(const D of y)this._el.contains(D.target)&&S.push(D);return S}handleEvent(y,S){this._updatingCamera=!0;const D=y.type==="renderFrame",z=D?void 0:y,O={needsRenderFrame:!1},V={},Z={},K=y.touches?this._getMapTouches(y.touches):void 0,Q=K?G.touchPos(this._el,K):D?void 0:G.mousePos(this._el,y);for(const{handlerName:pe,handler:Ee,allowed:xe}of this._handlers){if(!Ee.isEnabled())continue;let Te;this._blockedByActive(Z,xe,pe)?Ee.reset():Ee[S||y.type]&&(Te=Ee[S||y.type](y,Q,K),this.mergeHandlerResult(O,V,Te,pe,z),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()),(Te||Ee.isActive())&&(Z[pe]=Ee)}const ie={};for(const pe in this._previousActiveHandlers)Z[pe]||(ie[pe]=z);this._previousActiveHandlers=Z,(Object.keys(ie).length||ys(O))&&(this._changes.push([O,V,ie]),this._triggerRenderFrame()),(Object.keys(Z).length||ys(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ae}=O;ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ae(this._map))}mergeHandlerResult(y,S,D,z,O){if(!D)return;x.extend(y,D);const V={handlerName:z,originalEvent:D.originalEvent||O};D.zoomDelta!==void 0&&(S.zoom=V),D.panDelta!==void 0&&(S.drag=V),D.pitchDelta!==void 0&&(S.pitch=V),D.bearingDelta!==void 0&&(S.rotate=V)}_applyChanges(){const y={},S={},D={};for(const[z,O,V]of this._changes)z.panDelta&&(y.panDelta=(y.panDelta||new x.pointGeometry(0,0))._add(z.panDelta)),z.zoomDelta&&(y.zoomDelta=(y.zoomDelta||0)+z.zoomDelta),z.bearingDelta&&(y.bearingDelta=(y.bearingDelta||0)+z.bearingDelta),z.pitchDelta&&(y.pitchDelta=(y.pitchDelta||0)+z.pitchDelta),z.around!==void 0&&(y.around=z.around),z.aroundCoord!==void 0&&(y.aroundCoord=z.aroundCoord),z.pinchAround!==void 0&&(y.pinchAround=z.pinchAround),z.noInertia&&(y.noInertia=z.noInertia),x.extend(S,O),x.extend(D,V);this._updateMapTransform(y,S,D),this._changes=[]}_updateMapTransform(y,S,D){const z=this._map,O=z.transform,V=De=>[De.x,De.y,De.z];if((De=>{const Be=this._eventsInProgress.drag;return Be&&!this._handlersById[Be.handlerName].isActive()})()&&!ys(y)){const De=O.zoom;O.cameraElevationReference="sea",O.recenterOnTerrain(),O.cameraElevationReference="ground",De!==O.zoom&&this._map._update(!0)}if(!ys(y))return this._fireEvents(S,D,!0);let{panDelta:Z,zoomDelta:K,bearingDelta:Q,pitchDelta:ie,around:ae,aroundCoord:pe,pinchAround:Ee}=y;Ee!==void 0&&(ae=Ee),(De=>S.drag&&!this._eventsInProgress.drag)()&&ae&&(this._dragOrigin=V(O.pointCoordinate3D(ae)),this._trackingEllipsoid.setup(O._camera.position,this._dragOrigin)),O.cameraElevationReference="sea",z._stop(!0),ae=ae||z.transform.centerPoint,Q&&(O.bearing+=Q),ie&&(O.pitch+=ie),O._updateCameraState();const xe=[0,0,0];if(Z){const De=O.pointCoordinate(ae),Be=O.pointCoordinate(ae.sub(Z));De&&Be&&(xe[0]=Be.x-De.x,xe[1]=Be.y-De.y)}const Te=O.zoom,Fe=[0,0,0];if(K){const De=V(pe||O.pointCoordinate3D(ae)),Be={dir:x.normalize([],x.sub([],De,O._camera.position))};if(Be.dir[2]<0){const ke=O.zoomDeltaToMovement(De,K);x.scale$2(Fe,Be.dir,ke)}}const we=x.add(xe,xe,Fe);O._translateCameraConstrained(we),K&&Math.abs(O.zoom-Te)>1e-4&&O.recenterOnTerrain(),O.cameraElevationReference="ground",this._map._update(),y.noInertia||this._inertia.record(y),this._fireEvents(S,D,!0)}_fireEvents(y,S,D){const z=_s(this._eventsInProgress),O=_s(y),V={};for(const ie in y){const{originalEvent:ae}=y[ie];this._eventsInProgress[ie]||(V[`${ie}start`]=ae),this._eventsInProgress[ie]=y[ie]}!z&&O&&this._fireEvent("movestart",O.originalEvent);for(const ie in V)this._fireEvent(ie,V[ie]);O&&this._fireEvent("move",O.originalEvent);for(const ie in y){const{originalEvent:ae}=y[ie];this._fireEvent(ie,ae)}const Z={};let K;for(const ie in this._eventsInProgress){const{handlerName:ae,originalEvent:pe}=this._eventsInProgress[ie];this._handlersById[ae].isActive()||(delete this._eventsInProgress[ie],K=S[ae]||pe,Z[`${ie}end`]=K)}for(const ie in Z)this._fireEvent(ie,Z[ie]);const Q=_s(this._eventsInProgress);if(D&&(z||O)&&!Q){this._updatingCamera=!0;const ie=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=pe=>pe!==0&&-this._bearingSnap<pe&&pe<this._bearingSnap;ie?(ae(ie.bearing||this._map.getBearing())&&(ie.bearing=0),this._map.easeTo(ie,{originalEvent:K})):(this._map.fire(new x.Event("moveend",{originalEvent:K})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(y,S){this._map.fire(new x.Event(y,S?{originalEvent:S}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(y=>{delete this._frameId,this.handleEvent(new dh("renderFrame",{timeStamp:y})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ph extends x.Evented{constructor(y,S){super(),this._moving=!1,this._zooming=!1,this.transform=y,this._bearingSnap=S.bearingSnap,x.bindAll(["_renderFrameCallback"],this)}getCenter(){return new x.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(y,S){return this.jumpTo({center:y},S)}panBy(y,S,D){return y=x.pointGeometry.convert(y).mult(-1),this.panTo(this.transform.center,x.extend({offset:y},S),D)}panTo(y,S,D){return this.easeTo(x.extend({center:y},S),D)}getZoom(){return this.transform.zoom}setZoom(y,S){return this.jumpTo({zoom:y},S),this}zoomTo(y,S,D){return this.easeTo(x.extend({zoom:y},S),D)}zoomIn(y,S){return this.zoomTo(this.getZoom()+1,y,S),this}zoomOut(y,S){return this.zoomTo(this.getZoom()-1,y,S),this}getBearing(){return this.transform.bearing}setBearing(y,S){return this.jumpTo({bearing:y},S),this}getPadding(){return this.transform.padding}setPadding(y,S){return this.jumpTo({padding:y},S),this}rotateTo(y,S,D){return this.easeTo(x.extend({bearing:y},S),D)}resetNorth(y,S){return this.rotateTo(0,x.extend({duration:1e3},y),S),this}resetNorthPitch(y,S){return this.easeTo(x.extend({bearing:0,pitch:0,duration:1e3},y),S),this}snapToNorth(y,S){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(y,S):this}getPitch(){return this.transform.pitch}setPitch(y,S){return this.jumpTo({pitch:y},S),this}cameraForBounds(y,S){y=x.LngLatBounds.convert(y);const D=S&&S.bearing||0;return this._cameraForBoxAndBearing(y.getNorthWest(),y.getSouthEast(),D,S)}_extendCameraOptions(y){const S={top:0,bottom:0,right:0,left:0};if(typeof(y=x.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const D=y.padding;y.padding={top:D,bottom:D,right:D,left:D}}return y.padding=x.extend(S,y.padding),y}_cameraForBoxAndBearing(y,S,D,z){const O=this._extendCameraOptions(z),V=this.transform,Z=V.padding,K=V.project(x.LngLat.convert(y)),Q=V.project(x.LngLat.convert(S)),ie=K.rotate(-x.degToRad(D)),ae=Q.rotate(-x.degToRad(D)),pe=new x.pointGeometry(Math.max(ie.x,ae.x),Math.max(ie.y,ae.y)),Ee=new x.pointGeometry(Math.min(ie.x,ae.x),Math.min(ie.y,ae.y)),xe=pe.sub(Ee),Te=(V.width-(Z.left+Z.right+O.padding.left+O.padding.right))/xe.x,Fe=(V.height-(Z.top+Z.bottom+O.padding.top+O.padding.bottom))/xe.y;if(Fe<0||Te<0)return void x.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const we=Math.min(V.scaleZoom(V.scale*Math.min(Te,Fe)),O.maxZoom),De=typeof O.offset.x=="number"?new x.pointGeometry(O.offset.x,O.offset.y):x.pointGeometry.convert(O.offset),Be=new x.pointGeometry((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(D*Math.PI/180),ke=De.add(Be).mult(V.scale/V.zoomScale(we));return{center:V.unproject(K.add(Q).div(2).sub(ke)),zoom:we,bearing:D}}_cameraForBox(y,S,D,z,O){const V=this._extendCameraOptions(O);D=D||0,z=z||0,y=x.LngLat.convert(y),S=x.LngLat.convert(S);const Z=this.transform.clone();Z.padding=V.padding;const K=this.getFreeCameraOptions(),Q=new x.LngLat(.5*(y.lng+S.lng),.5*(y.lat+S.lat)),ie=.5*(D+z);if(Z._camera.position[2]<x.mercatorZfromAltitude(ie,Q.lat))return void x.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");K.lookAtPoint(Q),Z.setFreeCameraOptions(K);const ae=x.MercatorCoordinate.fromLngLat(y),pe=x.MercatorCoordinate.fromLngLat(S),Ee=Z.pointRayIntersection(Z.centerPoint,ie),xe=[(Te=Z.rayIntersectionCoordinate(Ee)).x,Te.y,Te.z];var Te;const Fe=Z.screenPointToMercatorRay(Z.centerPoint),we=Z.projection.name!=="globe";let De,Be=0;do{const ke=Math.floor(Z.zoom),Ce=1<<ke,Oe=Math.min(Ce*ae.x,Ce*pe.x),He=Math.min(Ce*ae.y,Ce*pe.y),Je=Math.max(Ce*ae.x,Ce*pe.x),xt=Math.max(Ce*ae.y,Ce*pe.y),ft=new x.Aabb([Oe,He,D],[Je,xt,z]),dt=x.Frustum.fromInvProjectionMatrix(Z.invProjMatrix,Z.worldSize,ke,we);if(ft.intersects(dt)!==2){De&&(Z._camera.position=x.scaleAndAdd([],Z._camera.position,Fe.dir,-De),Z._updateStateFromCamera());break}const it=x.sub([],Z._camera.position,xe);De=.5*x.length(it),Z._camera.position=x.scaleAndAdd([],Z._camera.position,Fe.dir,De);try{Z._updateStateFromCamera()}catch{return void x.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Be<10);return{center:Z.center,zoom:Z.zoom,bearing:Z.bearing,pitch:Z.pitch}}fitBounds(y,S,D){return this._fitInternal(this.cameraForBounds(y,S),S,D)}_raycastElevationBox(y,S){const D=this.transform.elevation;if(!D)return;const z=new x.pointGeometry(y.x,S.y),O=new x.pointGeometry(S.x,y.y),V=D.pointCoordinate(y);if(!V)return;const Z=D.pointCoordinate(S);if(!Z)return;const K=D.pointCoordinate(z);if(!K)return;const Q=D.pointCoordinate(O);if(!Q)return;const ie=new x.MercatorCoordinate(V[0],V[1]).toLngLat(),ae=new x.MercatorCoordinate(Z[0],Z[1]).toLngLat(),pe=new x.MercatorCoordinate(K[0],K[1]).toLngLat(),Ee=new x.MercatorCoordinate(Q[0],Q[1]).toLngLat(),xe=Math.min(ie.lng,Math.min(ae.lng,Math.min(pe.lng,Ee.lng))),Te=Math.min(ie.lat,Math.min(ae.lat,Math.min(pe.lat,Ee.lat))),Fe=Math.max(ie.lng,Math.max(ae.lng,Math.max(pe.lng,Ee.lng))),we=Math.max(ie.lat,Math.max(ae.lat,Math.max(pe.lat,Ee.lat))),De=Math.min(V[3],Math.min(Z[3],Math.min(K[3],Q[3]))),Be=Math.max(V[3],Math.max(Z[3],Math.max(K[3],Q[3])));return{minLngLat:new x.LngLat(xe,Te),maxLngLat:new x.LngLat(Fe,we),minAltitude:De,maxAltitude:Be}}fitScreenCoordinates(y,S,D,z,O){let V,Z,K,Q;const ie=x.pointGeometry.convert(y),ae=x.pointGeometry.convert(S),pe=this._raycastElevationBox(ie,ae);if(pe)V=pe.minLngLat,Z=pe.maxLngLat,K=pe.minAltitude,Q=pe.maxAltitude;else{if(this.transform.anyCornerOffEdge(ie,ae))return this;V=this.transform.pointLocation(ie),Z=this.transform.pointLocation(ae)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(x.pointGeometry.convert(y)),this.transform.pointLocation(x.pointGeometry.convert(S)),D,z):this._cameraForBox(V,Z,K,Q,z),z,O)}_fitInternal(y,S,D){return y?(delete(S=x.extend(y,S)).padding,S.linear?this.easeTo(S,D):this.flyTo(S,D)):this}jumpTo(y,S){this.stop();const D=y.preloadOnly?this.transform.clone():this.transform;let z=!1,O=!1,V=!1;return"zoom"in y&&D.zoom!==+y.zoom&&(z=!0,D.zoom=+y.zoom),y.center!==void 0&&(D.center=x.LngLat.convert(y.center)),"bearing"in y&&D.bearing!==+y.bearing&&(O=!0,D.bearing=+y.bearing),"pitch"in y&&D.pitch!==+y.pitch&&(V=!0,D.pitch=+y.pitch),y.padding==null||D.isPaddingEqual(y.padding)||(D.padding=y.padding),y.preloadOnly?(this._preloadTiles(D),this):(this.fire(new x.Event("movestart",S)).fire(new x.Event("move",S)),z&&this.fire(new x.Event("zoomstart",S)).fire(new x.Event("zoom",S)).fire(new x.Event("zoomend",S)),O&&this.fire(new x.Event("rotatestart",S)).fire(new x.Event("rotate",S)).fire(new x.Event("rotateend",S)),V&&this.fire(new x.Event("pitchstart",S)).fire(new x.Event("pitch",S)).fire(new x.Event("pitchend",S)),this.fire(new x.Event("moveend",S)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||x.warnOnce(nl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(y,S){const D=this.transform;if(!D.projection.supportsFreeCamera)return void x.warnOnce(nl);this.stop();const z=D.zoom,O=D.pitch,V=D.bearing;D.setFreeCameraOptions(y);const Z=z!==D.zoom,K=O!==D.pitch,Q=V!==D.bearing;return this.fire(new x.Event("movestart",S)).fire(new x.Event("move",S)),Z&&this.fire(new x.Event("zoomstart",S)).fire(new x.Event("zoom",S)).fire(new x.Event("zoomend",S)),Q&&this.fire(new x.Event("rotatestart",S)).fire(new x.Event("rotate",S)).fire(new x.Event("rotateend",S)),K&&this.fire(new x.Event("pitchstart",S)).fire(new x.Event("pitch",S)).fire(new x.Event("pitchend",S)),this.fire(new x.Event("moveend",S)),this}easeTo(y,S){this._stop(!1,y.easeId),((y=x.extend({offset:[0,0],duration:500,easing:x.ease},y)).animate===!1||!y.essential&&x.exported.prefersReducedMotion)&&(y.duration=0);const D=this.transform,z=this.getZoom(),O=this.getBearing(),V=this.getPitch(),Z=this.getPadding(),K="zoom"in y?+y.zoom:z,Q="bearing"in y?this._normalizeBearing(y.bearing,O):O,ie="pitch"in y?+y.pitch:V,ae="padding"in y?y.padding:D.padding,pe=x.pointGeometry.convert(y.offset);let Ee=D.centerPoint.add(pe);const xe=D.projection.name==="globe"?D.pointCoordinate(Ee).toLngLat():D.pointLocation(Ee),Te=x.LngLat.convert(y.center||xe);this._normalizeCenter(Te);const Fe=D.project(xe),we=D.project(Te).sub(Fe),De=D.zoomScale(K-z);let Be,ke;y.around&&(Be=x.LngLat.convert(y.around),ke=D.locationPoint(Be));const Ce=this._zooming||K!==z,Oe=this._rotating||O!==Q,He=this._pitching||ie!==V,Je=!D.isPaddingEqual(ae),xt=dt=>it=>{if(Ce&&(dt.zoom=x.number(z,K,it)),Oe&&(dt.bearing=x.number(O,Q,it)),He&&(dt.pitch=x.number(V,ie,it)),Je&&(dt.interpolatePadding(Z,ae,it),Ee=dt.centerPoint.add(pe)),Be)dt.setLocationAtPoint(Be,ke);else{const Ke=dt.zoomScale(dt.zoom-z),ut=K>z?Math.min(2,De):Math.max(.5,De),st=Math.pow(ut,1-it),Yt=dt.unproject(Fe.add(we.mult(it*st)).mult(Ke));dt.setLocationAtPoint(dt.renderWorldCopies?Yt.wrap():Yt,Ee)}return y.preloadOnly||this._fireMoveEvents(S),dt};if(y.preloadOnly){const dt=this._emulate(xt,y.duration,D);return this._preloadTiles(dt),this}const ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ce,this._rotating=Oe,this._pitching=He,this._padding=Je,this._easeId=y.easeId,this._prepareEase(S,y.noMoveStart,ft),this._ease(xt(D),dt=>{D.recenterOnTerrain(),this._afterEase(S,dt)},y),this}_prepareEase(y,S,D={}){this._moving=!0,this.transform.cameraElevationReference="sea",S||D.moving||this.fire(new x.Event("movestart",y)),this._zooming&&!D.zooming&&this.fire(new x.Event("zoomstart",y)),this._rotating&&!D.rotating&&this.fire(new x.Event("rotatestart",y)),this._pitching&&!D.pitching&&this.fire(new x.Event("pitchstart",y))}_fireMoveEvents(y){this.fire(new x.Event("move",y)),this._zooming&&this.fire(new x.Event("zoom",y)),this._rotating&&this.fire(new x.Event("rotate",y)),this._pitching&&this.fire(new x.Event("pitch",y))}_afterEase(y,S){if(this._easeId&&S&&this._easeId===S)return;delete this._easeId,this.transform.cameraElevationReference="ground";const D=this._zooming,z=this._rotating,O=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,D&&this.fire(new x.Event("zoomend",y)),z&&this.fire(new x.Event("rotateend",y)),O&&this.fire(new x.Event("pitchend",y)),this.fire(new x.Event("moveend",y))}flyTo(y,S){if(!y.essential&&x.exported.prefersReducedMotion){const yt=x.pick(y,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,S)}this.stop(),y=x.extend({offset:[0,0],speed:1.2,curve:1.42,easing:x.ease},y);const D=this.transform,z=this.getZoom(),O=this.getBearing(),V=this.getPitch(),Z=this.getPadding(),K="zoom"in y?x.clamp(+y.zoom,D.minZoom,D.maxZoom):z,Q="bearing"in y?this._normalizeBearing(y.bearing,O):O,ie="pitch"in y?+y.pitch:V,ae="padding"in y?y.padding:D.padding,pe=D.zoomScale(K-z),Ee=x.pointGeometry.convert(y.offset);let xe=D.centerPoint.add(Ee);const Te=D.pointLocation(xe),Fe=x.LngLat.convert(y.center||Te);this._normalizeCenter(Fe);const we=D.project(Te),De=D.project(Fe).sub(we);let Be=y.curve;const ke=Math.max(D.width,D.height),Ce=ke/pe,Oe=De.mag();if("minZoom"in y){const yt=x.clamp(Math.min(y.minZoom,z,K),D.minZoom,D.maxZoom),Jt=ke/D.zoomScale(yt-z);Be=Math.sqrt(Jt/Oe*2)}const He=Be*Be;function Je(yt){const Jt=(Ce*Ce-ke*ke+(yt?-1:1)*He*He*Oe*Oe)/(2*(yt?Ce:ke)*He*Oe);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function xt(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function ft(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const dt=Je(0);let it=function(yt){return ft(dt)/ft(dt+Be*yt)},Ke=function(yt){return ke*((ft(dt)*(xt(Jt=dt+Be*yt)/ft(Jt))-xt(dt))/He)/Oe;var Jt},ut=(Je(1)-dt)/Be;if(Math.abs(Oe)<1e-6||!isFinite(ut)){if(Math.abs(ke-Ce)<1e-6)return this.easeTo(y,S);const yt=Ce<ke?-1:1;ut=Math.abs(Math.log(Ce/ke))/Be,Ke=function(){return 0},it=function(Jt){return Math.exp(yt*Be*Jt)}}y.duration="duration"in y?+y.duration:1e3*ut/("screenSpeed"in y?+y.screenSpeed/Be:+y.speed),y.maxDuration&&y.duration>y.maxDuration&&(y.duration=0);const st=O!==Q,Yt=ie!==V,ii=!D.isPaddingEqual(ae),bi=yt=>Jt=>{const ui=Jt*ut,Zi=1/it(ui);yt.zoom=Jt===1?K:z+yt.scaleZoom(Zi),st&&(yt.bearing=x.number(O,Q,Jt)),Yt&&(yt.pitch=x.number(V,ie,Jt)),ii&&(yt.interpolatePadding(Z,ae,Jt),xe=yt.centerPoint.add(Ee));const Qi=Jt===1?Fe:yt.unproject(we.add(De.mult(Ke(ui))).mult(Zi));return yt.setLocationAtPoint(yt.renderWorldCopies?Qi.wrap():Qi,xe),yt._updateCenterElevation(),y.preloadOnly||this._fireMoveEvents(S),yt};if(y.preloadOnly){const yt=this._emulate(bi,y.duration,D);return this._preloadTiles(yt),this}return this._zooming=!0,this._rotating=st,this._pitching=Yt,this._padding=ii,this._prepareEase(S,!1),this._ease(bi(D),()=>this._afterEase(S),y),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(y,S){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const D=this._onEaseEnd;delete this._onEaseEnd,D.call(this,S)}if(!y){const D=this.handlers;D&&D.stop(!1)}return this}_ease(y,S,D){D.animate===!1||D.duration===0?(y(1),S()):(this._easeStart=x.exported.now(),this._easeOptions=D,this._onEaseFrame=y,this._onEaseEnd=S,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const y=Math.min((x.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(y,S){y=x.wrap(y,-180,180);const D=Math.abs(y-S);return Math.abs(y-360-S)<D&&(y-=360),Math.abs(y+360-S)<D&&(y+=360),y}_normalizeCenter(y){const S=this.transform;if(!S.renderWorldCopies||S.maxBounds)return;const D=y.lng-S.center.lng;y.lng+=D>180?-360:D<-180?360:0}_emulate(y,S,D){const z=Math.ceil(15*S/1e3),O=[],V=y(D.clone());for(let Z=0;Z<=z;Z++){const K=V(Z/z);O.push(K.clone())}return O}}class ol{constructor(y={}){this.options=y,x.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(y){const S=this.options&&this.options.compact;return this._map=y,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),G.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),S&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),S===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(y,S){const D=this._map._getUIString(`AttributionControl.${S}`);y.setAttribute("aria-label",D),y.removeAttribute("title"),y.firstElementChild&&y.firstElementChild.setAttribute("title",D)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let y=this._editLink;y||(y=this._editLink=this._container.querySelector(".mapbox-improve-map"));const S=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||x.config.ACCESS_TOKEN}];if(y){const D=S.reduce((z,O,V)=>(O.value&&(z+=`${O.key}=${O.value}${V<S.length-1?"&":""}`),z),"?");y.href=`${x.config.FEEDBACK_URL}/${D}${this._map._hash?this._map._hash.getHashString(!0):""}`,y.rel="noopener nofollow",this._setElementTitle(y,"MapFeedback")}}_updateData(y){!y||y.sourceDataType!=="metadata"&&y.sourceDataType!=="visibility"&&y.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let y=[];if(this._map.style.stylesheet){const z=this._map.style.stylesheet;this.styleOwner=z.owner,this.styleId=z.id}const S=this._map.style._sourceCaches;for(const z in S){const O=S[z];if(O.used){const V=O.getSource();V.attribution&&y.indexOf(V.attribution)<0&&y.push(V.attribution)}}y.sort((z,O)=>z.length-O.length),y=y.filter((z,O)=>{for(let V=O+1;V<y.length;V++)if(y[V].indexOf(z)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?y=[...this.options.customAttribution,...y]:y.unshift(this.options.customAttribution));const D=y.join(" | ");D!==this._attribHTML&&(this._attribHTML=D,y.length?(this._innerContainer.innerHTML=D,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class sl{constructor(){x.bindAll(["_updateLogo"],this),x.bindAll(["_updateCompact"],this)}onAdd(y){this._map=y,this._container=G.create("div","mapboxgl-ctrl");const S=G.create("a","mapboxgl-ctrl-logo");return S.target="_blank",S.rel="noopener nofollow",S.href="https://www.mapbox.com/",S.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),S.setAttribute("rel","noopener nofollow"),this._container.appendChild(S),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(y){y&&y.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const y=this._map.style._sourceCaches;if(Object.entries(y).length===0)return!0;for(const S in y){const D=y[S].getSource();if(D.hasOwnProperty("mapbox_logo")&&!D.mapbox_logo)return!1}return!0}_updateCompact(){const y=this._container.children;if(y.length){const S=y[0];this._map.getCanvasContainer().offsetWidth<250?S.classList.add("mapboxgl-compact"):S.classList.remove("mapboxgl-compact")}}}class al{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(y){const S=++this._id;return this._queue.push({callback:y,id:S,cancelled:!1}),S}remove(y){const S=this._currentlyRunning,D=S?this._queue.concat(S):this._queue;for(const z of D)if(z.id===y)return void(z.cancelled=!0)}run(y=0){const S=this._currentlyRunning=this._queue;this._queue=[];for(const D of S)if(!D.cancelled&&(D.callback(y),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ll(C,y,S){if(C=new x.LngLat(C.lng,C.lat),y){const D=new x.LngLat(C.lng-360,C.lat),z=new x.LngLat(C.lng+360,C.lat),O=360*Math.ceil(Math.abs(C.lng-S.center.lng)/360),V=S.locationPoint(C).distSqr(y),Z=y.x<0||y.y<0||y.x>S.width||y.y>S.height;S.locationPoint(D).distSqr(y)<V&&(Z||Math.abs(D.lng-S.center.lng)<O)?C=D:S.locationPoint(z).distSqr(y)<V&&(Z||Math.abs(z.lng-S.center.lng)<O)&&(C=z)}for(;Math.abs(C.lng-S.center.lng)>180;){const D=S.locationPoint(C);if(D.x>=0&&D.y>=0&&D.x<=S.width&&D.y<=S.height)break;C.lng>S.center.lng?C.lng-=360:C.lng+=360}return C}const Ir={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class hl extends x.Evented{constructor(y,S){if(super(),(y instanceof x.window.HTMLElement||S)&&(y=x.extend({element:y},S)),x.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=y&&y.anchor||"center",this._color=y&&y.color||"#3FB1CE",this._scale=y&&y.scale||1,this._draggable=y&&y.draggable||!1,this._clickTolerance=y&&y.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=y&&y.rotation||0,this._rotationAlignment=y&&y.rotationAlignment||"auto",this._pitchAlignment=y&&y.pitchAlignment&&y.pitchAlignment!=="auto"?y.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),y&&y.element)this._element=y.element,this._offset=x.pointGeometry.convert(y&&y.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const z=41,O=27,V=G.createSVG("svg",{display:"block",height:z*this._scale+"px",width:O*this._scale+"px",viewBox:`0 0 ${O} ${z}`},this._element),Z=G.createSVG("radialGradient",{id:"shadowGradient"},G.createSVG("defs",{},V));G.createSVG("stop",{offset:"10%","stop-opacity":.4},Z),G.createSVG("stop",{offset:"100%","stop-opacity":.05},Z),G.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},V),G.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},V),G.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},V),G.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},V),this._offset=x.pointGeometry.convert(y&&y.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",z=>{z.preventDefault()}),this._element.addEventListener("mousedown",z=>{z.preventDefault()});const D=this._element.classList;for(const z in Ir)D.remove(`mapboxgl-marker-anchor-${z}`);D.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(y){return y===this._map||(this.remove(),this._map=y,y.getCanvasContainer().appendChild(this._element),y.on("move",this._updateMoving),y.on("moveend",this._update),y.on("remove",this._clearFadeTimer),y._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=x.LngLat.convert(y),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(y){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),y){if(!("offset"in y.options)){const z=Math.sqrt(Math.pow(13.5,2)/2);y.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[z,-1*(38.1-13.5+z)],"bottom-right":[-z,-1*(38.1-13.5+z)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=y,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(y){const S=y.code,D=y.charCode||y.keyCode;S!=="Space"&&S!=="Enter"&&D!==32&&D!==13||this.togglePopup()}_onMapClick(y){const S=y.originalEvent.target,D=this._element;this._popup&&(S===D||D.contains(S))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const y=this._popup;return y?(y.isOpen()?(y.remove(),this._element.setAttribute("aria-expanded","false")):(y.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const y=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(y))return void this._clearFadeTimer();const S=this._map.unproject(y);let D=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const O=this._map.getFreeCameraOptions();if(O.position){const V=O.position.toLngLat();D=V.distanceTo(S)<.9*V.distanceTo(this._lngLat)}}const z=(1-this._map._queryFogOpacity(S))*(D?.2:1);this._element.style.opacity=`${z}`,this._popup&&this._popup._setOpacity(`${z}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(y){const S=this._map.transform;return!!y&&y.x>=0&&y.x<S.width&&y.y>=0&&y.y<S.height}_updateDOM(){const y=this._pos||new x.pointGeometry(0,0),S=this._calculatePitch(),D=this._calculateRotation();this._element.style.transform=`${Ir[this._anchor]} translate(${y.x}px, ${y.y}px) rotateX(${S}deg) rotateZ(${D}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(y){x.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),y===!0?this._updateFrameId=x.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const y=this._map.transform,S=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&S._rotate(y.angle),this._pitchAlignment==="map"&&(S.y*=Math.cos(y._pitch)),S}getOffset(){return this._offset}setOffset(y){return this._offset=x.pointGeometry.convert(y),this._update(),this}_onMove(y){if(!this._isDragging){const S=this._clickTolerance||this._map._clickTolerance;this._isDragging=y.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=y.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new x.Event("dragstart"))),this.fire(new x.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new x.Event("dragend")),this._state="inactive"}_addDragHandler(y){this._element.contains(y.originalEvent.target)&&(y.preventDefault(),this._positionDelta=y.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=y.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(y){return this._draggable=!!y,this._map&&(y?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(y){return this._rotation=y||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(y){return this._rotationAlignment=y||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(y){return this._pitchAlignment=y&&y!=="auto"?y:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Fn{constructor(y){this.jumpTo(y)}getValue(y){if(y<=this._startTime)return this._start;if(y>=this._endTime)return this._end;const S=x.easeCubicInOut((y-this._startTime)/(this._endTime-this._startTime));return this._start*(1-S)+this._end*S}isEasing(y){return y>=this._startTime&&y<=this._endTime}jumpTo(y){this._startTime=-1/0,this._endTime=-1/0,this._start=y,this._end=y}easeTo(y,S,D){this._start=this.getValue(S),this._end=y,this._startTime=S,this._endTime=S+D}}const mh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:xn,HTMLElement:Bo,ImageBitmap:Lo}=x.window,pc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function cl(C){C.parentNode&&C.parentNode.removeChild(C)}const mc={showCompass:!0,showZoom:!0,visualizePitch:!1};class gh{constructor(y,S,D=!1){this._clickTolerance=10,this.element=S,this.mouseRotate=new cn({clickTolerance:y.dragRotate._mouseRotate._clickTolerance}),this.map=y,D&&(this.mousePitch=new Qa({clickTolerance:y.dragRotate._mousePitch._clickTolerance})),x.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener("mousedown",this.mousedown),S.addEventListener("touchstart",this.touchstart,{passive:!1}),S.addEventListener("touchmove",this.touchmove),S.addEventListener("touchend",this.touchend),S.addEventListener("touchcancel",this.reset)}down(y,S){this.mouseRotate.mousedown(y,S),this.mousePitch&&this.mousePitch.mousedown(y,S),G.disableDrag()}move(y,S){const D=this.map,z=this.mouseRotate.mousemoveWindow(y,S);if(z&&z.bearingDelta&&D.setBearing(D.getBearing()+z.bearingDelta),this.mousePitch){const O=this.mousePitch.mousemoveWindow(y,S);O&&O.pitchDelta&&D.setPitch(D.getPitch()+O.pitchDelta)}}off(){const y=this.element;y.removeEventListener("mousedown",this.mousedown),y.removeEventListener("touchstart",this.touchstart,{passive:!1}),y.removeEventListener("touchmove",this.touchmove),y.removeEventListener("touchend",this.touchend),y.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),x.window.removeEventListener("mousemove",this.mousemove),x.window.removeEventListener("mouseup",this.mouseup)}mousedown(y){this.down(x.extend({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),G.mousePos(this.element,y)),x.window.addEventListener("mousemove",this.mousemove),x.window.addEventListener("mouseup",this.mouseup)}mousemove(y){this.move(y,G.mousePos(this.element,y))}mouseup(y){this.mouseRotate.mouseupWindow(y),this.mousePitch&&this.mousePitch.mouseupWindow(y),this.offTemp()}touchstart(y){y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,y.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>y.preventDefault()},this._startPos))}touchmove(y){y.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,y.targetTouches)[0],this.move({preventDefault:()=>y.preventDefault()},this._lastPos))}touchend(y){y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const xs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let jr,vs=0,zo=!1;const bs={maxWidth:100,unit:"metric"};function Ot(C,y,S){const D=S&&S.maxWidth||100,z=C._containerHeight/2,O=C.unproject([0,z]),V=C.unproject([D,z]),Z=O.distanceTo(V);if(S&&S.unit==="imperial"){const K=3.2808*Z;K>5280?Fo(y,D,K/5280,C._getUIString("ScaleControl.Miles"),C):Fo(y,D,K,C._getUIString("ScaleControl.Feet"),C)}else S&&S.unit==="nautical"?Fo(y,D,Z/1852,C._getUIString("ScaleControl.NauticalMiles"),C):Z>=1e3?Fo(y,D,Z/1e3,C._getUIString("ScaleControl.Kilometers"),C):Fo(y,D,Z,C._getUIString("ScaleControl.Meters"),C)}function Fo(C,y,S,D,z){const O=function(Z){const K=Math.pow(10,`${Math.floor(Z)}`.length-1);let Q=Z/K;return Q=Q>=10?10:Q>=5?5:Q>=3?3:Q>=2?2:Q>=1?1:function(ie){const ae=Math.pow(10,Math.ceil(-Math.log(ie)/Math.LN10));return Math.round(ie*ae)/ae}(Q),K*Q}(S),V=O/S;z._requestDomTask(()=>{C.style.width=y*V+"px",C.innerHTML=`${O}&nbsp;${D}`})}const _h={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ws=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),to={version:x.version,supported:L,setRTLTextPlugin:x.setRTLTextPlugin,getRTLTextPluginStatus:x.getRTLTextPluginStatus,Map:class extends ph{constructor(C){if((C=x.extend({},pc,C)).minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fs(C.minZoom,C.maxZoom,C.minPitch,C.maxPitch,C.renderWorldCopies),C),this._interactive=C.interactive,this._minTileCacheSize=C.minTileCacheSize,this._maxTileCacheSize=C.maxTileCacheSize,this._failIfMajorPerformanceCaveat=C.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=C.preserveDrawingBuffer,this._antialias=C.antialias,this._trackResize=C.trackResize,this._bearingSnap=C.bearingSnap,this._refreshExpiredTiles=C.refreshExpiredTiles,this._fadeDuration=C.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=C.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=C.collectResourceTiming,this._optimizeForTerrain=C.optimizeForTerrain,this._renderTaskQueue=new al,this._domRenderTaskQueue=new al,this._controls=[],this._markers=[],this._mapId=x.uniqueId(),this._locale=x.extend({},mh,C.locale),this._clickTolerance=C.clickTolerance,this._cooperativeGestures=C.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Fn(0),this._requestManager=new x.RequestManager(C.transformRequest,C.accessToken,C.testMode),this._silenceAuthErrors=!!C.testMode,typeof C.container=="string"){if(this._container=x.window.document.getElementById(C.container),!this._container)throw new Error(`Container '${C.container}' not found.`)}else{if(!(C.container instanceof Bo))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(this._container.childNodes.length>0&&x.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),C.maxBounds&&this.setMaxBounds(C.maxBounds),x.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),x.window!==void 0&&(x.window.addEventListener("online",this._onWindowOnline,!1),x.window.addEventListener("resize",this._onWindowResize,!1),x.window.addEventListener("orientationchange",this._onWindowResize,!1),x.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ro(this,C),this._localFontFamily=C.localFontFamily,this._localIdeographFontFamily=C.localIdeographFontFamily,C.style&&this.setStyle(C.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),C.projection&&this.setProjection(C.projection),this._hash=C.hash&&new rh(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,x.extend({},C.fitBoundsOptions,{duration:0})))),this.resize(),C.attributionControl&&this.addControl(new ol({customAttribution:C.customAttribution})),this._logoControl=new sl,this.addControl(this._logoControl,C.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",y=>{this._update(y.dataType==="style"),this.fire(new x.Event(`${y.dataType}data`,y))}),this.on("dataloading",y=>{this.fire(new x.Event(`${y.dataType}dataloading`,y))})}_getMapId(){return this._mapId}addControl(C,y){if(y===void 0&&(y=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const S=C.onAdd(this);this._controls.push(C);const D=this._controlPositions[y];return y.indexOf("bottom")!==-1?D.insertBefore(S,D.firstChild):D.appendChild(S),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const y=this._controls.indexOf(C);return y>-1&&this._controls.splice(y,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(C){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const y=!this._moving;return y&&this.fire(new x.Event("movestart",C)).fire(new x.Event("move",C)),this.fire(new x.Event("resize",C)),y&&this.fire(new x.Event("moveend",C)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(C){return this.transform.setMaxBounds(x.LngLatBounds.convert(C)),this._update()}setMinZoom(C){if((C=C==null?-2:C)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C?this.setZoom(C):this.fire(new x.Event("zoomstart")).fire(new x.Event("zoom")).fire(new x.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C==null?22:C)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C?this.setZoom(C):this.fire(new x.Event("zoomstart")).fire(new x.Event("zoom")).fire(new x.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C==null?0:C)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C?this.setPitch(C):this.fire(new x.Event("pitchstart")).fire(new x.Event("pitch")).fire(new x.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C==null?85:C)>85)throw new Error("maxPitch must be less than or equal to 85");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C?this.setPitch(C):this.fire(new x.Event("pitchstart")).fire(new x.Event("pitch")).fire(new x.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.renderWorldCopies=C,this._update()}getProjection(){return this.transform.getProjection()}setProjection(C){return this._lazyInitEmptyStyle(),typeof C=="string"&&(C={name:C}),this._runtimeProjection=C,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(C){return this.transform.locationPoint3D(x.LngLat.convert(C))}unproject(C){return this.transform.pointLocation3D(x.pointGeometry.convert(C))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(C,y,S){if(C==="mouseenter"||C==="mouseover"){let D=!1;const z=V=>{const Z=y.filter(Q=>this.getLayer(Q)),K=Z.length?this.queryRenderedFeatures(V.point,{layers:Z}):[];K.length?D||(D=!0,S.call(this,new Fr(C,this,V.originalEvent,{features:K}))):D=!1},O=()=>{D=!1};return{layers:new Set(y),listener:S,delegates:{mousemove:z,mouseout:O}}}if(C==="mouseleave"||C==="mouseout"){let D=!1;const z=V=>{const Z=y.filter(K=>this.getLayer(K));(Z.length?this.queryRenderedFeatures(V.point,{layers:Z}):[]).length?D=!0:D&&(D=!1,S.call(this,new Fr(C,this,V.originalEvent)))},O=V=>{D&&(D=!1,S.call(this,new Fr(C,this,V.originalEvent)))};return{layers:new Set(y),listener:S,delegates:{mousemove:z,mouseout:O}}}{const D=z=>{const O=y.filter(Z=>this.getLayer(Z)),V=O.length?this.queryRenderedFeatures(z.point,{layers:O}):[];V.length&&(z.features=V,S.call(this,z),delete z.features)};return{layers:new Set(y),listener:S,delegates:{[C]:D}}}}on(C,y,S){if(S===void 0)return super.on(C,y);Array.isArray(y)||(y=[y]);const D=this._createDelegatedListener(C,y,S);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(D);for(const z in D.delegates)this.on(z,D.delegates[z]);return this}once(C,y,S){if(S===void 0)return super.once(C,y);Array.isArray(y)||(y=[y]);const D=this._createDelegatedListener(C,y,S);for(const z in D.delegates)this.once(z,D.delegates[z]);return this}off(C,y,S){if(S===void 0)return super.off(C,y);y=new Set(Array.isArray(y)?y:[y]);const D=(O,V)=>{if(O.size!==V.size)return!1;for(const Z of O)if(!V.has(Z))return!1;return!0},z=this._delegatedListeners?this._delegatedListeners[C]:void 0;return z&&(O=>{for(let V=0;V<O.length;V++){const Z=O[V];if(Z.listener===S&&D(Z.layers,y)){for(const K in Z.delegates)this.off(K,Z.delegates[K]);return O.splice(V,1),this}}})(z),this}queryRenderedFeatures(C,y){return this.style?(y!==void 0||C===void 0||C instanceof x.pointGeometry||Array.isArray(C)||(y=C,C=void 0),this.style.queryRenderedFeatures(C=C||[[0,0],[this.transform.width,this.transform.height]],y=y||{},this.transform)):[]}querySourceFeatures(C,y){return this.style.querySourceFeatures(C,y)}queryTerrainElevation(C,y){const S=this.transform.elevation;return S?(y=x.extend({},{exaggerated:!0},y),S.getAtPoint(x.MercatorCoordinate.fromLngLat(C),null,y.exaggerated)):null}setStyle(C,y){return(y=x.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&y.localFontFamily===this._localFontFamily&&this.style&&C?(this._diffStyle(C,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._localFontFamily=y.localFontFamily,this._updateStyle(C,y))}_getUIString(C){const y=this._locale[C];if(y==null)throw new Error(`Missing UI string '${C}'`);return y}_updateStyle(C,y){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),C&&(this.style=new Xr(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C):this.style.loadJSON(C)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,y){if(typeof C=="string"){const S=this._requestManager.normalizeStyleURL(C),D=this._requestManager.transformRequest(S,x.ResourceType.Style);x.getJSON(D,(z,O)=>{z?this.fire(new x.ErrorEvent(z)):O&&this._updateDiff(O,y)})}else typeof C=="object"&&this._updateDiff(C,y)}_updateDiff(C,y){try{this.style.setState(C)&&this._update(!0)}catch(S){x.warnOnce(`Unable to perform style diff: ${S.message||S.error||S}.  Rebuilding the style from scratch.`),this._updateStyle(C,y)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():x.warnOnce("There is no style added to the map.")}addSource(C,y){return this._lazyInitEmptyStyle(),this.style.addSource(C,y),this._update(!0)}isSourceLoaded(C){const y=this.style&&this.style._getSourceCaches(C);if(y.length!==0)return y.every(S=>S.loaded());this.fire(new x.ErrorEvent(new Error(`There is no source with ID '${C}'`)))}areTilesLoaded(){const C=this.style&&this.style._sourceCaches;for(const y in C){const S=C[y]._tiles;for(const D in S){const z=S[D];if(z.state!=="loaded"&&z.state!=="errored")return!1}}return!0}addSourceType(C,y,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(C,y,S)}removeSource(C){return this.style.removeSource(C),this._updateTerrain(),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,y,{pixelRatio:S=1,sdf:D=!1,stretchX:z,stretchY:O,content:V}={}){if(this._lazyInitEmptyStyle(),y instanceof xn||Lo&&y instanceof Lo){const{width:Z,height:K,data:Q}=x.exported.getImageData(y);this.style.addImage(C,{data:new x.RGBAImage({width:Z,height:K},Q),pixelRatio:S,stretchX:z,stretchY:O,content:V,sdf:D,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Z,height:K,data:Q}=y,ie=y;this.style.addImage(C,{data:new x.RGBAImage({width:Z,height:K},new Uint8Array(Q)),pixelRatio:S,stretchX:z,stretchY:O,content:V,sdf:D,version:0,userImage:ie}),ie.onAdd&&ie.onAdd(this,C)}}}updateImage(C,y){const S=this.style.getImage(C);if(!S)return this.fire(new x.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const D=y instanceof xn||Lo&&y instanceof Lo?x.exported.getImageData(y):y,{width:z,height:O,data:V}=D;return z===void 0||O===void 0?this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):z!==S.data.width||O!==S.data.height?this.fire(new x.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(V,!(y instanceof xn||Lo&&y instanceof Lo)),void this.style.updateImage(C,S))}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new x.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C,y){x.getImage(this._requestManager.transformRequest(C,x.ResourceType.Image),(S,D)=>{y(S,D instanceof xn?x.exported.getImageData(D):D)})}listImages(){return this.style.listImages()}addLayer(C,y){return this._lazyInitEmptyStyle(),this.style.addLayer(C,y),this._update(!0)}moveLayer(C,y){return this.style.moveLayer(C,y),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}setLayerZoomRange(C,y,S){return this.style.setLayerZoomRange(C,y,S),this._update(!0)}setFilter(C,y,S={}){return this.style.setFilter(C,y,S),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,y,S,D={}){return this.style.setPaintProperty(C,y,S,D),this._update(!0)}getPaintProperty(C,y){return this.style.getPaintProperty(C,y)}setLayoutProperty(C,y,S,D={}){return this.style.setLayoutProperty(C,y,S,D),this._update(!0)}getLayoutProperty(C,y){return this.style.getLayoutProperty(C,y)}setLight(C,y={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,y),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(C){return this._lazyInitEmptyStyle(),!C&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(C),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=x.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(C){return this._lazyInitEmptyStyle(),this.style.setFog(C),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(C){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(x.LngLat.convert(C),this.transform):0}setFeatureState(C,y){return this.style.setFeatureState(C,y),this._update()}removeFeatureState(C,y){return this.style.removeFeatureState(C,y),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}_updateContainerDimensions(){if(!this._container)return;const C=this._container.getBoundingClientRect().width||400,y=this._container.getBoundingClientRect().height||300;let S,D=this._container;for(;D&&!S;){const z=x.window.getComputedStyle(D).transform;z&&z!=="none"&&(S=z.match(/matrix.*\((.+)\)/)[1].split(", ")),D=D.parentElement}S?(this._containerWidth=S[0]&&S[0]!=="0"?Math.abs(C/S[0]):C,this._containerHeight=S[3]&&S[3]!=="0"?Math.abs(y/S[3]):y):(this._containerWidth=C,this._containerHeight=y)}_detectMissingCSS(){x.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&x.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const C=this._container;C.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",C)).style.visibility="hidden",this._detectMissingCSS();const y=this._canvasContainer=G.create("div","mapboxgl-canvas-container",C);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const S=this._controlContainer=G.create("div","mapboxgl-control-container",C),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(z=>{D[z]=G.create("div",`mapboxgl-ctrl-${z}`,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,y){const S=x.exported.devicePixelRatio||1;this._canvas.width=S*Math.ceil(C),this._canvas.height=S*Math.ceil(y),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${y}px`}_addMarker(C){this._markers.push(C)}_removeMarker(C){const y=this._markers.indexOf(C);y!==-1&&this._markers.splice(y,1)}_setupPainter(){const C=x.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",C)||this._canvas.getContext("experimental-webgl",C);y?(x.storeAuthState(y,!0),this.painter=new Ql(y,this.transform),this.on("data",S=>{S.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),x.exported$1.testSupport(y)):this.fire(new x.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(C){C.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new x.Event("webglcontextlost",{originalEvent:C}))}_contextRestored(C){this._setupPainter(),this.resize(),this._update(),this.fire(new x.Event("webglcontextrestored",{originalEvent:C}))}_onMapScroll(C){if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_requestDomTask(C){!this.loaded()||this.loaded()&&!this.isMoving()?C():this._domRenderTaskQueue.add(C)}_render(C){let y;const S=this.painter.context.extTimerQuery,D=x.exported.now();this.listens("gpu-timing-frame")&&(y=S.createQueryEXT(),S.beginQueryEXT(S.TIME_ELAPSED_EXT,y));let z=this._updateAverageElevation(D);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._domRenderTaskQueue.run(C),this._removed)return;this._updateProjection();let O=!1;const V=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const K=this.transform.zoom,Q=this.transform.pitch,ie=x.exported.now();this.style.zoomHistory.update(K,ie);const ae=new x.EvaluationParameters(K,{now:ie,fadeDuration:V,pitch:Q,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=ae.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(O=!0,this._crossFadingFactor=pe),this.style.update(ae)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,V,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:V,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new x.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new x.Event("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const K=x.exported.now()-D;S.endQueryEXT(S.TIME_ELAPSED_EXT,y),setTimeout(()=>{const Q=S.getQueryObjectEXT(y,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(y),this.fire(new x.Event("gpu-timing-frame",{cpuTime:K,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){const K=this.painter.collectGpuTimers();setTimeout(()=>{const Q=this.painter.queryGpuTimers(K);this.fire(new x.Event("gpu-timing-layer",{layerTimes:Q}))},50)}const Z=this._sourcesDirty||this._styleDirty||this._placementDirty||z;if(Z||this._repaint)this.triggerRepaint();else{const K=!this.isMoving()&&this.loaded();if(K&&(z=this._updateAverageElevation(D,!0)),z)this.triggerRepaint();else if(this._triggerFrame(!1),K&&(this.fire(new x.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Q=this._calculateSpeedIndex();this.fire(new x.Event("speedindexcompleted",{speedIndex:Q})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||Z||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const C of this._markers)C._update()}_updateAverageElevation(C,y=!1){const S=D=>(this.transform.averageElevation=D,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&S(0);if((y||C-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(C)){const D=this.transform.averageElevation;let z=this.transform.sampleAverageElevation();isNaN(z)?z=0:this._averageElevationLastSampledAt=C;const O=Math.abs(D-z);if(O>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(z),S(z);this._averageElevation.easeTo(z,C,300)}else if(O>1e-4)return this._averageElevation.jumpTo(z),S(z)}return!!this._averageElevation.isEasing(C)&&S(this._averageElevation.getValue(C))}_authenticate(){x.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,C=>{if(C&&(C.message===x.AUTH_ERR_MSG||C.status===401)){const y=this.painter.context.gl;x.storeAuthState(y,!1),this._logoControl instanceof sl&&this._logoControl._updateLogo(),y&&y.clear(y.DEPTH_BUFFER_BIT|y.COLOR_BUFFER_BIT|y.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new x.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),x.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const C=this.painter.canvasCopy(),y=this.painter.getCanvasCopiesAndTimestamps();y.timeStamps.push(performance.now());const S=this.painter.context.gl,D=S.createFramebuffer();function z(O){S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,O,0);const V=new Uint8Array(S.drawingBufferWidth*S.drawingBufferHeight*4);return S.readPixels(0,0,S.drawingBufferWidth,S.drawingBufferHeight,S.RGBA,S.UNSIGNED_BYTE,V),V}return S.bindFramebuffer(S.FRAMEBUFFER,D),this._canvasPixelComparison(z(C),y.canvasCopies.map(z),y.timeStamps)}_canvasPixelComparison(C,y,S){let D=S[1]-S[0];const z=C.length/4;for(let O=0;O<y.length;O++){const V=y[O];let Z=0;for(let K=0;K<V.length;K+=4)V[K]===C[K]&&V[K+1]===C[K+1]&&V[K+2]===C[K+2]&&V[K+3]===C[K+3]&&(Z+=1);D+=(S[O+2]-S[O+1])*(1-Z/z)}return D}remove(){this._hash&&this._hash.remove();for(const y of this._controls)y.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),x.window!==void 0&&(x.window.removeEventListener("resize",this._onWindowResize,!1),x.window.removeEventListener("orientationchange",this._onWindowResize,!1),x.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),x.window.removeEventListener("online",this._onWindowOnline,!1));const C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),cl(this._canvasContainer),cl(this._controlContainer),cl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),x.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new x.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(C){this._renderNextFrame=this._renderNextFrame||C,this.style&&!this._frame&&(this._frame=x.exported.frame(y=>{const S=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,S&&this._render(y)}))}_preloadTiles(C){const y=this.style&&Object.values(this.style._sourceCaches)||[];return x.asyncAll(y,(S,D)=>S._preloadTiles(C,D),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(C){this._trackResize&&this.resize({originalEvent:C})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(C){this._showTerrainWireframe!==C&&(this._showTerrainWireframe=C,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(C){this._speedIndexTiming!==C&&(this._speedIndexTiming=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}_setCacheLimits(C,y){x.setCacheLimits(C,y)}get version(){return x.version}},NavigationControl:class{constructor(C){this.options=x.extend({},mc,C),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",y=>y.preventDefault()),this.options.showZoom&&(x.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",y=>this._map.zoomIn({},{originalEvent:y})),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",y=>this._map.zoomOut({},{originalEvent:y})),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(x.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",y=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:y}):this._map.resetNorth({},{originalEvent:y})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const C=this._map.getZoom(),y=C===this._map.getMaxZoom(),S=C===this._map.getMinZoom();this._zoomInButton.disabled=y,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",y.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())}_rotateCompassArrow(){const C=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=C)})}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,y){const S=G.create("button",C,this._container);return S.type="button",S.addEventListener("click",y),S}_setButtonTitle(C,y){const S=this._map._getUIString(`NavigationControl.${y}`);C.setAttribute("aria-label",S),C.firstElementChild&&C.firstElementChild.setAttribute("title",S)}},GeolocateControl:class extends x.Evented{constructor(C){super(),this.options=x.extend({},xs,C),x.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=eo(this._updateMarkerRotation,20)}onAdd(C){var y;return this._map=C,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,jr!==void 0?y(jr):x.window.navigator.permissions!==void 0?x.window.navigator.permissions.query({name:"geolocation"}).then(S=>{jr=S.state!=="denied",y(jr)}):(jr=!!x.window.navigator.geolocation,y(jr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(x.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,vs=0,zo=!1}_isOutOfMapMaxBounds(C){const y=this._map.getMaxBounds(),S=C.coords;return y&&(S.longitude<y.getWest()||S.longitude>y.getEast()||S.latitude<y.getSouth()||S.latitude>y.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(C){if(this._map){if(this._isOutOfMapMaxBounds(C))return this._setErrorState(),this.fire(new x.Event("outofmaxbounds",C)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=C,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(C),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(C),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new x.Event("geolocate",C)),this._finish()}}_updateCamera(C){const y=new x.LngLat(C.coords.longitude,C.coords.latitude),S=C.coords.accuracy,D=this._map.getBearing(),z=x.extend({bearing:D},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(S),z,{geolocateSource:!0})}_updateMarker(C){if(C){const y=new x.LngLat(C.coords.longitude,C.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=C.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const C=this._map._containerHeight/2,y=this._map.unproject([0,C]),S=this._map.unproject([100,C]),D=y.distanceTo(S)/100,z=Math.ceil(2*this._accuracy/D);this._circleElement.style.width=`${z}px`,this._circleElement.style.height=`${z}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(C){if(this._map){if(this.options.trackUserLocation)if(C.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(C.code===3&&zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new x.Event("error",C)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(C){if(this._container.addEventListener("contextmenu",y=>y.preventDefault()),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",C===!1){x.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y)}else{const y=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location"),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",y=>{y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||y.originalEvent&&y.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new x.Event("trackuserlocationend")))})}_onDeviceOrientation(C){this._userLocationDotMarker&&(C.webkitCompassHeading?this._heading=C.webkitCompassHeading:C.absolute===!0&&(this._heading=-1*C.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return x.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new x.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":vs--,zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new x.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new x.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),vs++,vs>1?(C={maximumAge:6e5,timeout:0},zo=!0):(C=this.options.positionOptions,zo=!1),this._geolocationWatchID=x.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else x.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const C=()=>{x.window.addEventListener("ondeviceorientationabsolute"in x.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};x.window.DeviceMotionEvent!==void 0&&typeof x.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(y=>{y==="granted"&&C()}).catch(console.error):C()}_clearWatch(){x.window.navigator.geolocation.clearWatch(this._geolocationWatchID),x.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),x.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ol,ScaleControl:class{constructor(C){this.options=x.extend({},bs,C),x.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ot(this._map,this._container,this.options)}onAdd(C){return this._map=C,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(C){this.options.unit=C,Ot(this._map,this._container,this.options)}},FullscreenControl:class{constructor(C){this._fullscreen=!1,C&&C.container&&(C.container instanceof x.window.HTMLElement?this._container=C.container:x.warnOnce("Full screen control 'container' must be a DOM element.")),x.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in x.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in x.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",x.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,x.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!x.window.document.fullscreenEnabled&&!x.window.document.webkitFullscreenEnabled)}_setupUI(){const C=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",C).setAttribute("aria-hidden",!0),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),x.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",C)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(x.window.document.fullscreenElement||x.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?x.window.document.exitFullscreen?x.window.document.exitFullscreen():x.window.document.webkitCancelFullScreen&&x.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends x.Evented{constructor(C){super(),this.options=x.extend(Object.create(_h),C),x.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(C&&C.className?C.className.trim().split(/\s+/):[])}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new x.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new x.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=x.LngLat.convert(C),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(x.window.document.createTextNode(C))}setHTML(C){const y=x.window.document.createDocumentFragment(),S=x.window.document.createElement("body");let D;for(S.innerHTML=C;D=S.firstChild,D;)y.appendChild(D);return this.setDOMContent(y)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._classList.add(C),this._container&&this._updateClassList(),this}removeClassName(C){return this._classList.delete(C),this._container&&this._updateClassList(),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){let y;return this._classList.delete(C)?y=!1:(this._classList.add(C),y=!0),this._container&&this._updateClassList(),y}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(C){this._update(C.point)}_onMouseMove(C){this._update(C.point)}_onDrag(C){this._update(C.point)}_getAnchor(C){if(this.options.anchor)return this.options.anchor;const y=this._pos,S=this._container.offsetWidth,D=this._container.offsetHeight;let z;return z=y.y+C.bottom.y<D?["top"]:y.y>this._map.transform.height-D?["bottom"]:[],y.x<S/2?z.push("left"):y.x>this._map.transform.width-S/2&&z.push("right"),z.length===0?"bottom":z.join("-")}_updateClassList(){const C=[...this._classList];C.push("mapboxgl-popup"),this._anchor&&C.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&C.push("mapboxgl-popup-track-pointer"),this._container.className=C.join(" ")}_update(C){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||C){const y=this._pos=this._trackPointer&&C?C:this._map.project(this._lngLat),S=function(O){if(O||(O=new x.pointGeometry(0,0)),typeof O=="number"){const V=Math.round(Math.sqrt(.5*Math.pow(O,2)));return{center:new x.pointGeometry(0,0),top:new x.pointGeometry(0,O),"top-left":new x.pointGeometry(V,V),"top-right":new x.pointGeometry(-V,V),bottom:new x.pointGeometry(0,-O),"bottom-left":new x.pointGeometry(V,-V),"bottom-right":new x.pointGeometry(-V,-V),left:new x.pointGeometry(O,0),right:new x.pointGeometry(-O,0)}}if(O instanceof x.pointGeometry||Array.isArray(O)){const V=x.pointGeometry.convert(O);return{center:V,top:V,"top-left":V,"top-right":V,bottom:V,"bottom-left":V,"bottom-right":V,left:V,right:V}}return{center:x.pointGeometry.convert(O.center||[0,0]),top:x.pointGeometry.convert(O.top||[0,0]),"top-left":x.pointGeometry.convert(O["top-left"]||[0,0]),"top-right":x.pointGeometry.convert(O["top-right"]||[0,0]),bottom:x.pointGeometry.convert(O.bottom||[0,0]),"bottom-left":x.pointGeometry.convert(O["bottom-left"]||[0,0]),"bottom-right":x.pointGeometry.convert(O["bottom-right"]||[0,0]),left:x.pointGeometry.convert(O.left||[0,0]),right:x.pointGeometry.convert(O.right||[0,0])}}(this.options.offset),D=this._anchor=this._getAnchor(S),z=y.add(S[D]).round();this._map._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${Ir[D]} translate(${z.x}px,${z.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(ws);C&&C.focus()}_onClose(){this.remove()}_setOpacity(C){this._content&&(this._content.style.opacity=C),this._tip&&(this._tip.style.opacity=C)}},Marker:hl,Style:Xr,LngLat:x.LngLat,LngLatBounds:x.LngLatBounds,Point:x.pointGeometry,MercatorCoordinate:x.MercatorCoordinate,FreeCameraOptions:th,Evented:x.Evented,config:x.config,prewarm:function(){$e().acquire(Pe)},clearPrewarmedResources:function(){const C=Ve;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(Pe),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return x.config.ACCESS_TOKEN},set accessToken(C){x.config.ACCESS_TOKEN=C},get baseApiUrl(){return x.config.API_URL},set baseApiUrl(C){x.config.API_URL=C},get workerCount(){return Ue.workerCount},set workerCount(C){Ue.workerCount=C},get maxParallelImageRequests(){return x.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(C){x.config.MAX_PARALLEL_IMAGE_REQUESTS=C},clearStorage(C){x.clearTileCache(C)},workerUrl:"",workerClass:null,setNow:x.exported.setNow,restoreNow:x.exported.restoreNow};return to});var k=w;return k})})(mapboxGl);var mapboxgl=mapboxGl.exports,d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(d){var h=tile2lon(d[0]+1,d[2]),p=tile2lon(d[0],d[2]),m=tile2lat(d[1]+1,d[2]),w=tile2lat(d[1],d[2]);return[p,m,h,w]}function tileToGeoJSON(d){var h=tileToBBOX(d),p={type:"Polygon",coordinates:[[[h[0],h[3]],[h[0],h[1]],[h[2],h[1]],[h[2],h[3]],[h[0],h[3]]]]};return p}function tile2lon(d,h){return d/Math.pow(2,h)*360-180}function tile2lat(d,h){var p=Math.PI-2*Math.PI*d/Math.pow(2,h);return r2d*Math.atan(.5*(Math.exp(p)-Math.exp(-p)))}function pointToTile(d,h,p){var m=pointToTileFraction(d,h,p);return m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m}function getChildren(d){return[[d[0]*2,d[1]*2,d[2]+1],[d[0]*2+1,d[1]*2,d[2]+1],[d[0]*2+1,d[1]*2+1,d[2]+1],[d[0]*2,d[1]*2+1,d[2]+1]]}function getParent(d){return[d[0]>>1,d[1]>>1,d[2]-1]}function getSiblings(d){return getChildren(getParent(d))}function hasSiblings(d,h){for(var p=getSiblings(d),m=0;m<p.length;m++)if(!hasTile(h,p[m]))return!1;return!0}function hasTile(d,h){for(var p=0;p<d.length;p++)if(tilesEqual(d[p],h))return!0;return!1}function tilesEqual(d,h){return d[0]===h[0]&&d[1]===h[1]&&d[2]===h[2]}function tileToQuadkey(d){for(var h="",p=d[2];p>0;p--){var m=0,w=1<<p-1;(d[0]&w)!==0&&m++,(d[1]&w)!==0&&(m+=2),h+=m.toString()}return h}function quadkeyToTile(d){for(var h=0,p=0,m=d.length,w=m;w>0;w--){var M=1<<w-1,k=+d[m-w];k===1&&(h|=M),k===2&&(p|=M),k===3&&(h|=M,p|=M)}return[h,p,m]}function bboxToTile(d){var h=pointToTile(d[0],d[1],32),p=pointToTile(d[2],d[3],32),m=[h[0],h[1],p[0],p[1]],w=getBboxZoom(m);if(w===0)return[0,0,0];var M=m[0]>>>32-w,k=m[1]>>>32-w;return[M,k,w]}function getBboxZoom(d){for(var h=28,p=0;p<h;p++){var m=1<<32-(p+1);if((d[0]&m)!==(d[2]&m)||(d[1]&m)!==(d[3]&m))return p}return h}function pointToTileFraction(d,h,p){var m=Math.sin(h*d2r),w=Math.pow(2,p),M=w*(d/360+.5),k=w*(.5-.25*Math.log((1+m)/(1-m))/Math.PI);return M=M%w,M<0&&(M=M+w),[M,k,p]}var tilebelt={tileToGeoJSON,tileToBBOX,getChildren,getParent,getSiblings,hasTile,hasSiblings,tilesEqual,tileToQuadkey,quadkeyToTile,pointToTile,bboxToTile,pointToTileFraction};function feature(d,h,p){p===void 0&&(p={});var m={type:"Feature"};return(p.id===0||p.id)&&(m.id=p.id),p.bbox&&(m.bbox=p.bbox),m.properties=h||{},m.geometry=d,m}function polygon(d,h,p){p===void 0&&(p={});for(var m=0,w=d;m<w.length;m++){var M=w[m];if(M.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var k=0;k<M[M.length-1].length;k++)if(M[M.length-1][k]!==M[0][k])throw new Error("First and last Position are not equivalent.")}var x={type:"Polygon",coordinates:d};return feature(x,h,p)}function bboxPolygon(d,h){h===void 0&&(h={});var p=Number(d[0]),m=Number(d[1]),w=Number(d[2]),M=Number(d[3]);if(d.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var k=[p,m],x=[p,M],L=[w,M],B=[w,m];return polygon([[k,B,L,x,k]],h.properties,{bbox:d,id:h.id})}const bitMethods={getBit(d){return this.data[getSlot(d)]&1<<getShift(d)?1:0},setBit(d){this.data[getSlot(d)]|=1<<getShift(d)},clearBit(d){this.data[getSlot(d)]&=~(1<<getShift(d))},toggleBit(d){this.data[getSlot(d)]^=1<<getShift(d)},getBitXY(d,h){return d>=this.width||h>=this.height?0:this.getBit(h*this.width+d)},setBitXY(d,h){this.setBit(h*this.width+d)},clearBitXY(d,h){this.clearBit(h*this.width+d)},toggleBitXY(d,h){this.toggleBit(h*this.width+d)}};function getSlot(d){return d>>3}function getShift(d){return 7-(d&7)}function setBitMethods(d){for(const h in bitMethods)d.prototype[h]=bitMethods[h]}function checkProcessable(d,h={}){let{bitDepth:p,alpha:m,colorModel:w,components:M,channels:k}=h;if(typeof d!="string"||d.length===0)throw new TypeError("processName must be a string");if(p&&(Array.isArray(p)||(p=[p]),!p.includes(this.bitDepth)))throw new TypeError(`The process: ${d} can only be applied if bit depth is in: ${p}`);if(m&&(Array.isArray(m)||(m=[m]),!m.includes(this.alpha)))throw new TypeError(`The process: ${d} can only be applied if alpha is in: ${m}`);if(w&&(Array.isArray(w)||(w=[w]),!w.includes(this.colorModel)))throw new TypeError(`The process: ${d} can only be applied if color model is in: ${w}`);if(M&&(Array.isArray(M)||(M=[M]),!M.includes(this.components))){let x=`The process: ${d} can only be applied if the number of components is in: ${M}`;throw M.length===1&&M[0]===1?new TypeError(`${x}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(x)}if(k&&(Array.isArray(k)||(k=[k]),!k.includes(this.channels)))throw new TypeError(`The process: ${d} can only be applied if the number of channels is in: ${k}`)}function createBlob(d,h){d=d||[],h=h||{},typeof h=="string"&&(h={type:h});try{return new Blob(d,h)}catch(M){if(M.name!=="TypeError")throw M;for(var p=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,m=new p,w=0;w<d.length;w+=1)m.append(d[w]);return m.getBlob(h.type)}}function dataURLToBlob(d){var h=d.match(/data:([^;]+)/)[1],p=d.replace(/^[^,]+,/,""),m=binaryStringToArrayBuffer(atob(p));return createBlob([m],{type:h})}function canvasToBlob(d,h,p){return typeof d.toBlob=="function"?new Promise(function(m){d.toBlob(m,h,p)}):Promise.resolve(dataURLToBlob(d.toDataURL(h,p)))}function binaryStringToArrayBuffer(d){for(var h=d.length,p=new ArrayBuffer(h),m=new Uint8Array(p),w=-1;++w<h;)m[w]=d.charCodeAt(w);return p}var utf8$1={exports:{}};/*! https://mths.be/utf8js v2.1.2 by @mathias */(function(d,h){(function(p){var m=h,w=d&&d.exports==m&&d,M=typeof commonjsGlobal=="object"&&commonjsGlobal;(M.global===M||M.window===M)&&(p=M);var k=String.fromCharCode;function x(ve){for(var de=[],Se=0,ce=ve.length,ye,ze;Se<ce;)ye=ve.charCodeAt(Se++),ye>=55296&&ye<=56319&&Se<ce?(ze=ve.charCodeAt(Se++),(ze&64512)==56320?de.push(((ye&1023)<<10)+(ze&1023)+65536):(de.push(ye),Se--)):de.push(ye);return de}function L(ve){for(var de=ve.length,Se=-1,ce,ye="";++Se<de;)ce=ve[Se],ce>65535&&(ce-=65536,ye+=k(ce>>>10&1023|55296),ce=56320|ce&1023),ye+=k(ce);return ye}function B(ve){if(ve>=55296&&ve<=57343)throw Error("Lone surrogate U+"+ve.toString(16).toUpperCase()+" is not a scalar value")}function $(ve,de){return k(ve>>de&63|128)}function U(ve){if((ve&4294967168)==0)return k(ve);var de="";return(ve&4294965248)==0?de=k(ve>>6&31|192):(ve&4294901760)==0?(B(ve),de=k(ve>>12&15|224),de+=$(ve,6)):(ve&4292870144)==0&&(de=k(ve>>18&7|240),de+=$(ve,12),de+=$(ve,6)),de+=k(ve&63|128),de}function q(ve){for(var de=x(ve),Se=de.length,ce=-1,ye,ze="";++ce<Se;)ye=de[ce],ze+=U(ye);return ze}function G(){if(ee>=oe)throw Error("Invalid byte index");var ve=te[ee]&255;if(ee++,(ve&192)==128)return ve&63;throw Error("Invalid continuation byte")}function W(){var ve,de,Se,ce,ye;if(ee>oe)throw Error("Invalid byte index");if(ee==oe)return!1;if(ve=te[ee]&255,ee++,(ve&128)==0)return ve;if((ve&224)==192){if(de=G(),ye=(ve&31)<<6|de,ye>=128)return ye;throw Error("Invalid continuation byte")}if((ve&240)==224){if(de=G(),Se=G(),ye=(ve&15)<<12|de<<6|Se,ye>=2048)return B(ye),ye;throw Error("Invalid continuation byte")}if((ve&248)==240&&(de=G(),Se=G(),ce=G(),ye=(ve&7)<<18|de<<12|Se<<6|ce,ye>=65536&&ye<=1114111))return ye;throw Error("Invalid UTF-8 detected")}var te,oe,ee;function _e(ve){te=x(ve),oe=te.length,ee=0;for(var de=[],Se;(Se=W())!==!1;)de.push(Se);return L(de)}var se={version:"2.1.2",encode:q,decode:_e};if(m&&!m.nodeType)if(w)w.exports=se;else{var he={},ge=he.hasOwnProperty;for(var Re in se)ge.call(se,Re)&&(m[Re]=se[Re])}else p.utf8=se})(commonjsGlobal)})(utf8$1,utf8$1.exports);const utf8=utf8$1.exports,defaultByteLength$3=1024*8,charArray$1=[];class IOBuffer$6{constructor(h,p){p=p||{};var m=!1;h===void 0&&(h=defaultByteLength$3),typeof h=="number"?h=new ArrayBuffer(h):(m=!0,this._lastWrittenByte=h.byteLength);const w=p.offset?p.offset>>>0:0;let M=h.byteLength-w,k=w;h.buffer&&(h.byteLength!==h.buffer.byteLength&&(k=h.byteOffset+w),h=h.buffer),m?this._lastWrittenByte=M:this._lastWrittenByte=0,this.buffer=h,this.length=M,this.byteLength=M,this.byteOffset=k,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,k,M),this._mark=0,this._marks=[]}available(h){return h===void 0&&(h=1),this.offset+h<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(h){return h===void 0&&(h=1),this.offset+=h,this}seek(h){return this.offset=h,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const h=this._marks.pop();if(h===void 0)throw new Error("Mark stack empty");return this.seek(h),this}rewind(){return this.offset=0,this}ensureAvailable(h){if(h===void 0&&(h=1),!this.available(h)){const m=(this.offset+h)*2,w=new Uint8Array(m);w.set(new Uint8Array(this.buffer)),this.buffer=w.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(h){h===void 0&&(h=1);for(var p=new Uint8Array(h),m=0;m<h;m++)p[m]=this.readByte();return p}readInt16(){var h=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,h}readUint16(){var h=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,h}readInt32(){var h=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,h}readUint32(){var h=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat32(){var h=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat64(){var h=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,h}readChar(){return String.fromCharCode(this.readInt8())}readChars(h){h===void 0&&(h=1),charArray$1.length=h;for(var p=0;p<h;p++)charArray$1[p]=this.readChar();return charArray$1.join("")}readUtf8(h){h===void 0&&(h=1);const p=this.readChars(h);return utf8.decode(p)}writeBoolean(h){return this.writeUint8(h?255:0),this}writeInt8(h){return this.ensureAvailable(1),this._data.setInt8(this.offset++,h),this._updateLastWrittenByte(),this}writeUint8(h){return this.ensureAvailable(1),this._data.setUint8(this.offset++,h),this._updateLastWrittenByte(),this}writeByte(h){return this.writeUint8(h)}writeBytes(h){this.ensureAvailable(h.length);for(var p=0;p<h.length;p++)this._data.setUint8(this.offset++,h[p]);return this._updateLastWrittenByte(),this}writeInt16(h){return this.ensureAvailable(2),this._data.setInt16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(h){return this.ensureAvailable(2),this._data.setUint16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(h){return this.ensureAvailable(4),this._data.setInt32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(h){return this.ensureAvailable(4),this._data.setUint32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(h){return this.ensureAvailable(4),this._data.setFloat32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(h){return this.ensureAvailable(8),this._data.setFloat64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(h){return this.writeUint8(h.charCodeAt(0))}writeChars(h){for(var p=0;p<h.length;p++)this.writeUint8(h.charCodeAt(p));return this}writeUtf8(h){const p=utf8.encode(h);return this.writeChars(p)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return typeof Buffer!="undefined"?Buffer.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}var IOBuffer_1$1=IOBuffer$6,constants$7={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const IOBuffer$5=IOBuffer_1$1,constants$6=constants$7,tableLeft=[];for(var i$5=0;i$5<=8;i$5++)tableLeft.push(255<<i$5);var encode$5=function(d){if(d.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!d.height||!d.width)throw new Error("ImageData width and height are required");if(d.components!==1)throw new Error("Only 1 component is supported");if(d.channels!==1)throw new Error("Only 1 channel is supported");var h=new IOBuffer$5;h.skip(14),writeBitmapV5Header(h,d),writeColorTable(h,d);const p=h.offset;return writePixelArray(h,d),h.rewind(),writeBitmapFileHeader(h,p),h.getBuffer()};function writePixelArray(d,h){const p=Math.floor((h.bitDepth*h.width+31)/32)*4,m=Math.ceil(h.bitDepth*h.width/8),w=p-m,M=h.bitDepth*h.width%8,k=M===0?0:8-M,x=p*h.height;var L,B;const $=new IOBuffer$5(h.data);let U=0,q=0,G=8;d.mark(),B=$.readUint8();for(var W=h.height-1;W>=0;W--){const oe=W===0;d.reset(),d.skip(W*p);for(var te=0;te<m;te++){const ee=te===m-1;q<=k&&ee?(d.writeByte(B<<q),(k===0||k===q)&&!oe&&(L=B,B=$.readByte())):q===0?(L=B,B=$.readUint8(),d.writeByte(L)):(L=B,B=$.readUint8(),d.writeByte(L<<q&tableLeft[q]|B>>G)),ee?(U+=M||8,d.skip(w),q=U%8,G=8-q):U+=8}}p>m&&(d.reset(),d.skip(x-1),d.writeUint8(0))}function writeColorTable(d,h){h.bitDepth>8||d.writeUint32(0).writeUint32(16777215)}function writeBitmapFileHeader(d,h){d.writeChars("BM"),d.writeInt32(d._lastWrittenByte),d.writeUint16(0),d.writeUint16(0),d.writeUint32(h)}function writeBitmapV5Header(d,h){d.writeUint32(124).writeInt32(h.width).writeInt32(h.height).writeUint16(1).writeUint16(h.bitDepth).writeUint32(constants$6.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(h.width*h.height*h.bitDepth).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,h.bitDepth)).writeUint32(Math.pow(2,h.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$6.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$6.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}var encode$4=encode$5;(function(d){if(d.TextEncoder&&d.TextDecoder)return!1;function h(m="utf-8"){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${m}') is invalid.`)}Object.defineProperty(h.prototype,"encoding",{value:"utf-8"}),h.prototype.encode=function(m,w={stream:!1}){if(w.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let M=0;const k=m.length;let x=0,L=Math.max(32,k+(k>>1)+7),B=new Uint8Array(L>>3<<3);for(;M<k;){let $=m.charCodeAt(M++);if($>=55296&&$<=56319){if(M<k){const U=m.charCodeAt(M);(U&64512)===56320&&(++M,$=(($&1023)<<10)+(U&1023)+65536)}if($>=55296&&$<=56319)continue}if(x+4>B.length){L+=8,L*=1+M/m.length*2,L=L>>3<<3;const U=new Uint8Array(L);U.set(B),B=U}if(($&4294967168)===0){B[x++]=$;continue}else if(($&4294965248)===0)B[x++]=$>>6&31|192;else if(($&4294901760)===0)B[x++]=$>>12&15|224,B[x++]=$>>6&63|128;else if(($&4292870144)===0)B[x++]=$>>18&7|240,B[x++]=$>>12&63|128,B[x++]=$>>6&63|128;else continue;B[x++]=$&63|128}return B.slice(0,x)};function p(m="utf-8",w={fatal:!1}){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${m}') is invalid.`);if(w.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(p.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(p.prototype,"fatal",{value:!1}),Object.defineProperty(p.prototype,"ignoreBOM",{value:!1}),p.prototype.decode=function(m,w={stream:!1}){if(w.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const M=new Uint8Array(m);let k=0;const x=M.length,L=[];for(;k<x;){const B=M[k++];if(B===0)break;if((B&128)===0)L.push(B);else if((B&224)===192){const $=M[k++]&63;L.push((B&31)<<6|$)}else if((B&240)===224){const $=M[k++]&63,U=M[k++]&63;L.push((B&31)<<12|$<<6|U)}else if((B&248)===240){const $=M[k++]&63,U=M[k++]&63,q=M[k++]&63;let G=(B&7)<<18|$<<12|U<<6|q;G>65535&&(G-=65536,L.push(G>>>10&1023|55296),G=56320|G&1023),L.push(G)}}return String.fromCharCode.apply(null,L)},d.TextEncoder=h,d.TextDecoder=p})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder$2=new TextDecoder("utf-8");function decode$6(d){return decoder$2.decode(d)}const encoder$2=new TextEncoder;function encode$3(d){return encoder$2.encode(d)}const defaultByteLength$2=1024*8;class IOBuffer$4{constructor(h=defaultByteLength$2,p={}){let m=!1;typeof h=="number"?h=new ArrayBuffer(h):(m=!0,this.lastWrittenByte=h.byteLength);const w=p.offset?p.offset>>>0:0,M=h.byteLength-w;let k=w;(ArrayBuffer.isView(h)||h instanceof IOBuffer$4)&&(h.byteLength!==h.buffer.byteLength&&(k=h.byteOffset+w),h=h.buffer),m?this.lastWrittenByte=M:this.lastWrittenByte=0,this.buffer=h,this.length=M,this.byteLength=M,this.byteOffset=k,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,k,M),this._mark=0,this._marks=[]}available(h=1){return this.offset+h<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(h=1){return this.offset+=h,this}seek(h){return this.offset=h,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const h=this._marks.pop();if(h===void 0)throw new Error("Mark stack empty");return this.seek(h),this}rewind(){return this.offset=0,this}ensureAvailable(h=1){if(!this.available(h)){const m=(this.offset+h)*2,w=new Uint8Array(m);w.set(new Uint8Array(this.buffer)),this.buffer=w.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(h=1){const p=new Uint8Array(h);for(let m=0;m<h;m++)p[m]=this.readByte();return p}readInt16(){const h=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,h}readUint16(){const h=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,h}readInt32(){const h=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,h}readUint32(){const h=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat32(){const h=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat64(){const h=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,h}readBigInt64(){const h=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,h}readBigUint64(){const h=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,h}readChar(){return String.fromCharCode(this.readInt8())}readChars(h=1){let p="";for(let m=0;m<h;m++)p+=this.readChar();return p}readUtf8(h=1){return decode$6(this.readBytes(h))}writeBoolean(h){return this.writeUint8(h?255:0),this}writeInt8(h){return this.ensureAvailable(1),this._data.setInt8(this.offset++,h),this._updateLastWrittenByte(),this}writeUint8(h){return this.ensureAvailable(1),this._data.setUint8(this.offset++,h),this._updateLastWrittenByte(),this}writeByte(h){return this.writeUint8(h)}writeBytes(h){this.ensureAvailable(h.length);for(let p=0;p<h.length;p++)this._data.setUint8(this.offset++,h[p]);return this._updateLastWrittenByte(),this}writeInt16(h){return this.ensureAvailable(2),this._data.setInt16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(h){return this.ensureAvailable(2),this._data.setUint16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(h){return this.ensureAvailable(4),this._data.setInt32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(h){return this.ensureAvailable(4),this._data.setUint32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(h){return this.ensureAvailable(4),this._data.setFloat32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(h){return this.ensureAvailable(8),this._data.setFloat64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(h){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(h){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(h){return this.writeUint8(h.charCodeAt(0))}writeChars(h){for(let p=0;p<h.length;p++)this.writeUint8(h.charCodeAt(p));return this}writeUtf8(h){return this.writeBytes(encode$3(h))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(d){let h=d.length;for(;--h>=0;)d[h]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(d,h,p,m,w){this.static_tree=d,this.extra_bits=h,this.extra_base=p,this.elems=m,this.max_length=w,this.has_stree=d&&d.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(d,h){this.dyn_tree=d,this.max_code=0,this.stat_desc=h}const d_code=d=>d<256?_dist_code[d]:_dist_code[256+(d>>>7)],put_short=(d,h)=>{d.pending_buf[d.pending++]=h&255,d.pending_buf[d.pending++]=h>>>8&255},send_bits=(d,h,p)=>{d.bi_valid>Buf_size-p?(d.bi_buf|=h<<d.bi_valid&65535,put_short(d,d.bi_buf),d.bi_buf=h>>Buf_size-d.bi_valid,d.bi_valid+=p-Buf_size):(d.bi_buf|=h<<d.bi_valid&65535,d.bi_valid+=p)},send_code=(d,h,p)=>{send_bits(d,p[h*2],p[h*2+1])},bi_reverse=(d,h)=>{let p=0;do p|=d&1,d>>>=1,p<<=1;while(--h>0);return p>>>1},bi_flush=d=>{d.bi_valid===16?(put_short(d,d.bi_buf),d.bi_buf=0,d.bi_valid=0):d.bi_valid>=8&&(d.pending_buf[d.pending++]=d.bi_buf&255,d.bi_buf>>=8,d.bi_valid-=8)},gen_bitlen=(d,h)=>{const p=h.dyn_tree,m=h.max_code,w=h.stat_desc.static_tree,M=h.stat_desc.has_stree,k=h.stat_desc.extra_bits,x=h.stat_desc.extra_base,L=h.stat_desc.max_length;let B,$,U,q,G,W,te=0;for(q=0;q<=MAX_BITS$1;q++)d.bl_count[q]=0;for(p[d.heap[d.heap_max]*2+1]=0,B=d.heap_max+1;B<HEAP_SIZE$1;B++)$=d.heap[B],q=p[p[$*2+1]*2+1]+1,q>L&&(q=L,te++),p[$*2+1]=q,!($>m)&&(d.bl_count[q]++,G=0,$>=x&&(G=k[$-x]),W=p[$*2],d.opt_len+=W*(q+G),M&&(d.static_len+=W*(w[$*2+1]+G)));if(te!==0){do{for(q=L-1;d.bl_count[q]===0;)q--;d.bl_count[q]--,d.bl_count[q+1]+=2,d.bl_count[L]--,te-=2}while(te>0);for(q=L;q!==0;q--)for($=d.bl_count[q];$!==0;)U=d.heap[--B],!(U>m)&&(p[U*2+1]!==q&&(d.opt_len+=(q-p[U*2+1])*p[U*2],p[U*2+1]=q),$--)}},gen_codes=(d,h,p)=>{const m=new Array(MAX_BITS$1+1);let w=0,M,k;for(M=1;M<=MAX_BITS$1;M++)m[M]=w=w+p[M-1]<<1;for(k=0;k<=h;k++){let x=d[k*2+1];x!==0&&(d[k*2]=bi_reverse(m[x]++,x))}},tr_static_init=()=>{let d,h,p,m,w;const M=new Array(MAX_BITS$1+1);for(p=0,m=0;m<LENGTH_CODES$1-1;m++)for(base_length[m]=p,d=0;d<1<<extra_lbits[m];d++)_length_code[p++]=m;for(_length_code[p-1]=m,w=0,m=0;m<16;m++)for(base_dist[m]=w,d=0;d<1<<extra_dbits[m];d++)_dist_code[w++]=m;for(w>>=7;m<D_CODES$1;m++)for(base_dist[m]=w<<7,d=0;d<1<<extra_dbits[m]-7;d++)_dist_code[256+w++]=m;for(h=0;h<=MAX_BITS$1;h++)M[h]=0;for(d=0;d<=143;)static_ltree[d*2+1]=8,d++,M[8]++;for(;d<=255;)static_ltree[d*2+1]=9,d++,M[9]++;for(;d<=279;)static_ltree[d*2+1]=7,d++,M[7]++;for(;d<=287;)static_ltree[d*2+1]=8,d++,M[8]++;for(gen_codes(static_ltree,L_CODES$1+1,M),d=0;d<D_CODES$1;d++)static_dtree[d*2+1]=5,static_dtree[d*2]=bi_reverse(d,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=d=>{let h;for(h=0;h<L_CODES$1;h++)d.dyn_ltree[h*2]=0;for(h=0;h<D_CODES$1;h++)d.dyn_dtree[h*2]=0;for(h=0;h<BL_CODES$1;h++)d.bl_tree[h*2]=0;d.dyn_ltree[END_BLOCK*2]=1,d.opt_len=d.static_len=0,d.last_lit=d.matches=0},bi_windup=d=>{d.bi_valid>8?put_short(d,d.bi_buf):d.bi_valid>0&&(d.pending_buf[d.pending++]=d.bi_buf),d.bi_buf=0,d.bi_valid=0},copy_block=(d,h,p,m)=>{bi_windup(d),m&&(put_short(d,p),put_short(d,~p)),d.pending_buf.set(d.window.subarray(h,h+p),d.pending),d.pending+=p},smaller=(d,h,p,m)=>{const w=h*2,M=p*2;return d[w]<d[M]||d[w]===d[M]&&m[h]<=m[p]},pqdownheap=(d,h,p)=>{const m=d.heap[p];let w=p<<1;for(;w<=d.heap_len&&(w<d.heap_len&&smaller(h,d.heap[w+1],d.heap[w],d.depth)&&w++,!smaller(h,m,d.heap[w],d.depth));)d.heap[p]=d.heap[w],p=w,w<<=1;d.heap[p]=m},compress_block=(d,h,p)=>{let m,w,M=0,k,x;if(d.last_lit!==0)do m=d.pending_buf[d.d_buf+M*2]<<8|d.pending_buf[d.d_buf+M*2+1],w=d.pending_buf[d.l_buf+M],M++,m===0?send_code(d,w,h):(k=_length_code[w],send_code(d,k+LITERALS$1+1,h),x=extra_lbits[k],x!==0&&(w-=base_length[k],send_bits(d,w,x)),m--,k=d_code(m),send_code(d,k,p),x=extra_dbits[k],x!==0&&(m-=base_dist[k],send_bits(d,m,x)));while(M<d.last_lit);send_code(d,END_BLOCK,h)},build_tree=(d,h)=>{const p=h.dyn_tree,m=h.stat_desc.static_tree,w=h.stat_desc.has_stree,M=h.stat_desc.elems;let k,x,L=-1,B;for(d.heap_len=0,d.heap_max=HEAP_SIZE$1,k=0;k<M;k++)p[k*2]!==0?(d.heap[++d.heap_len]=L=k,d.depth[k]=0):p[k*2+1]=0;for(;d.heap_len<2;)B=d.heap[++d.heap_len]=L<2?++L:0,p[B*2]=1,d.depth[B]=0,d.opt_len--,w&&(d.static_len-=m[B*2+1]);for(h.max_code=L,k=d.heap_len>>1;k>=1;k--)pqdownheap(d,p,k);B=M;do k=d.heap[1],d.heap[1]=d.heap[d.heap_len--],pqdownheap(d,p,1),x=d.heap[1],d.heap[--d.heap_max]=k,d.heap[--d.heap_max]=x,p[B*2]=p[k*2]+p[x*2],d.depth[B]=(d.depth[k]>=d.depth[x]?d.depth[k]:d.depth[x])+1,p[k*2+1]=p[x*2+1]=B,d.heap[1]=B++,pqdownheap(d,p,1);while(d.heap_len>=2);d.heap[--d.heap_max]=d.heap[1],gen_bitlen(d,h),gen_codes(p,L,d.bl_count)},scan_tree=(d,h,p)=>{let m,w=-1,M,k=h[0*2+1],x=0,L=7,B=4;for(k===0&&(L=138,B=3),h[(p+1)*2+1]=65535,m=0;m<=p;m++)M=k,k=h[(m+1)*2+1],!(++x<L&&M===k)&&(x<B?d.bl_tree[M*2]+=x:M!==0?(M!==w&&d.bl_tree[M*2]++,d.bl_tree[REP_3_6*2]++):x<=10?d.bl_tree[REPZ_3_10*2]++:d.bl_tree[REPZ_11_138*2]++,x=0,w=M,k===0?(L=138,B=3):M===k?(L=6,B=3):(L=7,B=4))},send_tree=(d,h,p)=>{let m,w=-1,M,k=h[0*2+1],x=0,L=7,B=4;for(k===0&&(L=138,B=3),m=0;m<=p;m++)if(M=k,k=h[(m+1)*2+1],!(++x<L&&M===k)){if(x<B)do send_code(d,M,d.bl_tree);while(--x!==0);else M!==0?(M!==w&&(send_code(d,M,d.bl_tree),x--),send_code(d,REP_3_6,d.bl_tree),send_bits(d,x-3,2)):x<=10?(send_code(d,REPZ_3_10,d.bl_tree),send_bits(d,x-3,3)):(send_code(d,REPZ_11_138,d.bl_tree),send_bits(d,x-11,7));x=0,w=M,k===0?(L=138,B=3):M===k?(L=6,B=3):(L=7,B=4)}},build_bl_tree=d=>{let h;for(scan_tree(d,d.dyn_ltree,d.l_desc.max_code),scan_tree(d,d.dyn_dtree,d.d_desc.max_code),build_tree(d,d.bl_desc),h=BL_CODES$1-1;h>=3&&d.bl_tree[bl_order[h]*2+1]===0;h--);return d.opt_len+=3*(h+1)+5+5+4,h},send_all_trees=(d,h,p,m)=>{let w;for(send_bits(d,h-257,5),send_bits(d,p-1,5),send_bits(d,m-4,4),w=0;w<m;w++)send_bits(d,d.bl_tree[bl_order[w]*2+1],3);send_tree(d,d.dyn_ltree,h-1),send_tree(d,d.dyn_dtree,p-1)},detect_data_type=d=>{let h=4093624447,p;for(p=0;p<=31;p++,h>>>=1)if(h&1&&d.dyn_ltree[p*2]!==0)return Z_BINARY;if(d.dyn_ltree[9*2]!==0||d.dyn_ltree[10*2]!==0||d.dyn_ltree[13*2]!==0)return Z_TEXT;for(p=32;p<LITERALS$1;p++)if(d.dyn_ltree[p*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=d=>{static_init_done||(tr_static_init(),static_init_done=!0),d.l_desc=new TreeDesc(d.dyn_ltree,static_l_desc),d.d_desc=new TreeDesc(d.dyn_dtree,static_d_desc),d.bl_desc=new TreeDesc(d.bl_tree,static_bl_desc),d.bi_buf=0,d.bi_valid=0,init_block(d)},_tr_stored_block$1=(d,h,p,m)=>{send_bits(d,(STORED_BLOCK<<1)+(m?1:0),3),copy_block(d,h,p,!0)},_tr_align$1=d=>{send_bits(d,STATIC_TREES<<1,3),send_code(d,END_BLOCK,static_ltree),bi_flush(d)},_tr_flush_block$1=(d,h,p,m)=>{let w,M,k=0;d.level>0?(d.strm.data_type===Z_UNKNOWN$1&&(d.strm.data_type=detect_data_type(d)),build_tree(d,d.l_desc),build_tree(d,d.d_desc),k=build_bl_tree(d),w=d.opt_len+3+7>>>3,M=d.static_len+3+7>>>3,M<=w&&(w=M)):w=M=p+5,p+4<=w&&h!==-1?_tr_stored_block$1(d,h,p,m):d.strategy===Z_FIXED$1||M===w?(send_bits(d,(STATIC_TREES<<1)+(m?1:0),3),compress_block(d,static_ltree,static_dtree)):(send_bits(d,(DYN_TREES<<1)+(m?1:0),3),send_all_trees(d,d.l_desc.max_code+1,d.d_desc.max_code+1,k+1),compress_block(d,d.dyn_ltree,d.dyn_dtree)),init_block(d),m&&bi_windup(d)},_tr_tally$1=(d,h,p)=>(d.pending_buf[d.d_buf+d.last_lit*2]=h>>>8&255,d.pending_buf[d.d_buf+d.last_lit*2+1]=h&255,d.pending_buf[d.l_buf+d.last_lit]=p&255,d.last_lit++,h===0?d.dyn_ltree[p*2]++:(d.matches++,h--,d.dyn_ltree[(_length_code[p]+LITERALS$1+1)*2]++,d.dyn_dtree[d_code(h)*2]++),d.last_lit===d.lit_bufsize-1);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(d,h,p,m)=>{let w=d&65535|0,M=d>>>16&65535|0,k=0;for(;p!==0;){k=p>2e3?2e3:p,p-=k;do w=w+h[m++]|0,M=M+w|0;while(--k);w%=65521,M%=65521}return w|M<<16|0};var adler32_1=adler32;const makeTable=()=>{let d,h=[];for(var p=0;p<256;p++){d=p;for(var m=0;m<8;m++)d=d&1?3988292384^d>>>1:d>>>1;h[p]=d}return h},crcTable$1=new Uint32Array(makeTable()),crc32=(d,h,p,m)=>{const w=crcTable$1,M=m+p;d^=-1;for(let k=m;k<M;k++)d=d>>>8^w[(d^h[k])&255];return d^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(d,h)=>(d.msg=messages[h],h),rank=d=>(d<<1)-(d>4?9:0),zero=d=>{let h=d.length;for(;--h>=0;)d[h]=0};let HASH_ZLIB=(d,h,p)=>(h<<d.hash_shift^p)&d.hash_mask,HASH=HASH_ZLIB;const flush_pending=d=>{const h=d.state;let p=h.pending;p>d.avail_out&&(p=d.avail_out),p!==0&&(d.output.set(h.pending_buf.subarray(h.pending_out,h.pending_out+p),d.next_out),d.next_out+=p,h.pending_out+=p,d.total_out+=p,d.avail_out-=p,h.pending-=p,h.pending===0&&(h.pending_out=0))},flush_block_only=(d,h)=>{_tr_flush_block(d,d.block_start>=0?d.block_start:-1,d.strstart-d.block_start,h),d.block_start=d.strstart,flush_pending(d.strm)},put_byte=(d,h)=>{d.pending_buf[d.pending++]=h},putShortMSB=(d,h)=>{d.pending_buf[d.pending++]=h>>>8&255,d.pending_buf[d.pending++]=h&255},read_buf=(d,h,p,m)=>{let w=d.avail_in;return w>m&&(w=m),w===0?0:(d.avail_in-=w,h.set(d.input.subarray(d.next_in,d.next_in+w),p),d.state.wrap===1?d.adler=adler32_1(d.adler,h,w,p):d.state.wrap===2&&(d.adler=crc32_1(d.adler,h,w,p)),d.next_in+=w,d.total_in+=w,w)},longest_match=(d,h)=>{let p=d.max_chain_length,m=d.strstart,w,M,k=d.prev_length,x=d.nice_match;const L=d.strstart>d.w_size-MIN_LOOKAHEAD?d.strstart-(d.w_size-MIN_LOOKAHEAD):0,B=d.window,$=d.w_mask,U=d.prev,q=d.strstart+MAX_MATCH;let G=B[m+k-1],W=B[m+k];d.prev_length>=d.good_match&&(p>>=2),x>d.lookahead&&(x=d.lookahead);do if(w=h,!(B[w+k]!==W||B[w+k-1]!==G||B[w]!==B[m]||B[++w]!==B[m+1])){m+=2,w++;do;while(B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&B[++m]===B[++w]&&m<q);if(M=MAX_MATCH-(q-m),m=q-MAX_MATCH,M>k){if(d.match_start=h,k=M,M>=x)break;G=B[m+k-1],W=B[m+k]}}while((h=U[h&$])>L&&--p!==0);return k<=d.lookahead?k:d.lookahead},fill_window=d=>{const h=d.w_size;let p,m,w,M,k;do{if(M=d.window_size-d.lookahead-d.strstart,d.strstart>=h+(h-MIN_LOOKAHEAD)){d.window.set(d.window.subarray(h,h+h),0),d.match_start-=h,d.strstart-=h,d.block_start-=h,m=d.hash_size,p=m;do w=d.head[--p],d.head[p]=w>=h?w-h:0;while(--m);m=h,p=m;do w=d.prev[--p],d.prev[p]=w>=h?w-h:0;while(--m);M+=h}if(d.strm.avail_in===0)break;if(m=read_buf(d.strm,d.window,d.strstart+d.lookahead,M),d.lookahead+=m,d.lookahead+d.insert>=MIN_MATCH)for(k=d.strstart-d.insert,d.ins_h=d.window[k],d.ins_h=HASH(d,d.ins_h,d.window[k+1]);d.insert&&(d.ins_h=HASH(d,d.ins_h,d.window[k+MIN_MATCH-1]),d.prev[k&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=k,k++,d.insert--,!(d.lookahead+d.insert<MIN_MATCH)););}while(d.lookahead<MIN_LOOKAHEAD&&d.strm.avail_in!==0)},deflate_stored=(d,h)=>{let p=65535;for(p>d.pending_buf_size-5&&(p=d.pending_buf_size-5);;){if(d.lookahead<=1){if(fill_window(d),d.lookahead===0&&h===Z_NO_FLUSH$2)return BS_NEED_MORE;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;const m=d.block_start+p;if((d.strstart===0||d.strstart>=m)&&(d.lookahead=d.strstart-m,d.strstart=m,flush_block_only(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-MIN_LOOKAHEAD&&(flush_block_only(d,!1),d.strm.avail_out===0))return BS_NEED_MORE}return d.insert=0,h===Z_FINISH$3?(flush_block_only(d,!0),d.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(d.strstart>d.block_start&&(flush_block_only(d,!1),d.strm.avail_out===0),BS_NEED_MORE)},deflate_fast=(d,h)=>{let p,m;for(;;){if(d.lookahead<MIN_LOOKAHEAD){if(fill_window(d),d.lookahead<MIN_LOOKAHEAD&&h===Z_NO_FLUSH$2)return BS_NEED_MORE;if(d.lookahead===0)break}if(p=0,d.lookahead>=MIN_MATCH&&(d.ins_h=HASH(d,d.ins_h,d.window[d.strstart+MIN_MATCH-1]),p=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),p!==0&&d.strstart-p<=d.w_size-MIN_LOOKAHEAD&&(d.match_length=longest_match(d,p)),d.match_length>=MIN_MATCH)if(m=_tr_tally(d,d.strstart-d.match_start,d.match_length-MIN_MATCH),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=MIN_MATCH){d.match_length--;do d.strstart++,d.ins_h=HASH(d,d.ins_h,d.window[d.strstart+MIN_MATCH-1]),p=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart;while(--d.match_length!==0);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=HASH(d,d.ins_h,d.window[d.strstart+1]);else m=_tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(m&&(flush_block_only(d,!1),d.strm.avail_out===0))return BS_NEED_MORE}return d.insert=d.strstart<MIN_MATCH-1?d.strstart:MIN_MATCH-1,h===Z_FINISH$3?(flush_block_only(d,!0),d.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):d.last_lit&&(flush_block_only(d,!1),d.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(d,h)=>{let p,m,w;for(;;){if(d.lookahead<MIN_LOOKAHEAD){if(fill_window(d),d.lookahead<MIN_LOOKAHEAD&&h===Z_NO_FLUSH$2)return BS_NEED_MORE;if(d.lookahead===0)break}if(p=0,d.lookahead>=MIN_MATCH&&(d.ins_h=HASH(d,d.ins_h,d.window[d.strstart+MIN_MATCH-1]),p=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=MIN_MATCH-1,p!==0&&d.prev_length<d.max_lazy_match&&d.strstart-p<=d.w_size-MIN_LOOKAHEAD&&(d.match_length=longest_match(d,p),d.match_length<=5&&(d.strategy===Z_FILTERED||d.match_length===MIN_MATCH&&d.strstart-d.match_start>4096)&&(d.match_length=MIN_MATCH-1)),d.prev_length>=MIN_MATCH&&d.match_length<=d.prev_length){w=d.strstart+d.lookahead-MIN_MATCH,m=_tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-MIN_MATCH),d.lookahead-=d.prev_length-1,d.prev_length-=2;do++d.strstart<=w&&(d.ins_h=HASH(d,d.ins_h,d.window[d.strstart+MIN_MATCH-1]),p=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart);while(--d.prev_length!==0);if(d.match_available=0,d.match_length=MIN_MATCH-1,d.strstart++,m&&(flush_block_only(d,!1),d.strm.avail_out===0))return BS_NEED_MORE}else if(d.match_available){if(m=_tr_tally(d,0,d.window[d.strstart-1]),m&&flush_block_only(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return BS_NEED_MORE}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(m=_tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<MIN_MATCH-1?d.strstart:MIN_MATCH-1,h===Z_FINISH$3?(flush_block_only(d,!0),d.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):d.last_lit&&(flush_block_only(d,!1),d.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(d,h)=>{let p,m,w,M;const k=d.window;for(;;){if(d.lookahead<=MAX_MATCH){if(fill_window(d),d.lookahead<=MAX_MATCH&&h===Z_NO_FLUSH$2)return BS_NEED_MORE;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=MIN_MATCH&&d.strstart>0&&(w=d.strstart-1,m=k[w],m===k[++w]&&m===k[++w]&&m===k[++w])){M=d.strstart+MAX_MATCH;do;while(m===k[++w]&&m===k[++w]&&m===k[++w]&&m===k[++w]&&m===k[++w]&&m===k[++w]&&m===k[++w]&&m===k[++w]&&w<M);d.match_length=MAX_MATCH-(M-w),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=MIN_MATCH?(p=_tr_tally(d,1,d.match_length-MIN_MATCH),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=_tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(flush_block_only(d,!1),d.strm.avail_out===0))return BS_NEED_MORE}return d.insert=0,h===Z_FINISH$3?(flush_block_only(d,!0),d.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):d.last_lit&&(flush_block_only(d,!1),d.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(d,h)=>{let p;for(;;){if(d.lookahead===0&&(fill_window(d),d.lookahead===0)){if(h===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(d.match_length=0,p=_tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(flush_block_only(d,!1),d.strm.avail_out===0))return BS_NEED_MORE}return d.insert=0,h===Z_FINISH$3?(flush_block_only(d,!0),d.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):d.last_lit&&(flush_block_only(d,!1),d.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(d,h,p,m,w){this.good_length=d,this.max_lazy=h,this.nice_length=p,this.max_chain=m,this.func=w}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=d=>{d.window_size=2*d.w_size,zero(d.head),d.max_lazy_match=configuration_table[d.level].max_lazy,d.good_match=configuration_table[d.level].good_length,d.nice_match=configuration_table[d.level].nice_length,d.max_chain_length=configuration_table[d.level].max_chain,d.strstart=0,d.block_start=0,d.lookahead=0,d.insert=0,d.match_length=d.prev_length=MIN_MATCH-1,d.match_available=0,d.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=d=>{if(!d||!d.state)return err(d,Z_STREAM_ERROR$2);d.total_in=d.total_out=0,d.data_type=Z_UNKNOWN;const h=d.state;return h.pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?INIT_STATE:BUSY_STATE,d.adler=h.wrap===2?0:1,h.last_flush=Z_NO_FLUSH$2,_tr_init(h),Z_OK$3},deflateReset=d=>{const h=deflateResetKeep(d);return h===Z_OK$3&&lm_init(d.state),h},deflateSetHeader=(d,h)=>!d||!d.state||d.state.wrap!==2?Z_STREAM_ERROR$2:(d.state.gzhead=h,Z_OK$3),deflateInit2=(d,h,p,m,w,M)=>{if(!d)return Z_STREAM_ERROR$2;let k=1;if(h===Z_DEFAULT_COMPRESSION$1&&(h=6),m<0?(k=0,m=-m):m>15&&(k=2,m-=16),w<1||w>MAX_MEM_LEVEL||p!==Z_DEFLATED$2||m<8||m>15||h<0||h>9||M<0||M>Z_FIXED)return err(d,Z_STREAM_ERROR$2);m===8&&(m=9);const x=new DeflateState;return d.state=x,x.strm=d,x.wrap=k,x.gzhead=null,x.w_bits=m,x.w_size=1<<x.w_bits,x.w_mask=x.w_size-1,x.hash_bits=w+7,x.hash_size=1<<x.hash_bits,x.hash_mask=x.hash_size-1,x.hash_shift=~~((x.hash_bits+MIN_MATCH-1)/MIN_MATCH),x.window=new Uint8Array(x.w_size*2),x.head=new Uint16Array(x.hash_size),x.prev=new Uint16Array(x.w_size),x.lit_bufsize=1<<w+6,x.pending_buf_size=x.lit_bufsize*4,x.pending_buf=new Uint8Array(x.pending_buf_size),x.d_buf=1*x.lit_bufsize,x.l_buf=(1+2)*x.lit_bufsize,x.level=h,x.strategy=M,x.method=p,deflateReset(d)},deflateInit=(d,h)=>deflateInit2(d,h,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(d,h)=>{let p,m;if(!d||!d.state||h>Z_BLOCK$1||h<0)return d?err(d,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const w=d.state;if(!d.output||!d.input&&d.avail_in!==0||w.status===FINISH_STATE&&h!==Z_FINISH$3)return err(d,d.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);w.strm=d;const M=w.last_flush;if(w.last_flush=h,w.status===INIT_STATE)if(w.wrap===2)d.adler=0,put_byte(w,31),put_byte(w,139),put_byte(w,8),w.gzhead?(put_byte(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),put_byte(w,w.gzhead.time&255),put_byte(w,w.gzhead.time>>8&255),put_byte(w,w.gzhead.time>>16&255),put_byte(w,w.gzhead.time>>24&255),put_byte(w,w.level===9?2:w.strategy>=Z_HUFFMAN_ONLY||w.level<2?4:0),put_byte(w,w.gzhead.os&255),w.gzhead.extra&&w.gzhead.extra.length&&(put_byte(w,w.gzhead.extra.length&255),put_byte(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=EXTRA_STATE):(put_byte(w,0),put_byte(w,0),put_byte(w,0),put_byte(w,0),put_byte(w,0),put_byte(w,w.level===9?2:w.strategy>=Z_HUFFMAN_ONLY||w.level<2?4:0),put_byte(w,OS_CODE),w.status=BUSY_STATE);else{let k=Z_DEFLATED$2+(w.w_bits-8<<4)<<8,x=-1;w.strategy>=Z_HUFFMAN_ONLY||w.level<2?x=0:w.level<6?x=1:w.level===6?x=2:x=3,k|=x<<6,w.strstart!==0&&(k|=PRESET_DICT),k+=31-k%31,w.status=BUSY_STATE,putShortMSB(w,k),w.strstart!==0&&(putShortMSB(w,d.adler>>>16),putShortMSB(w,d.adler&65535)),d.adler=1}if(w.status===EXTRA_STATE)if(w.gzhead.extra){for(p=w.pending;w.gzindex<(w.gzhead.extra.length&65535)&&!(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),flush_pending(d),p=w.pending,w.pending===w.pending_buf_size));)put_byte(w,w.gzhead.extra[w.gzindex]&255),w.gzindex++;w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=NAME_STATE)}else w.status=NAME_STATE;if(w.status===NAME_STATE)if(w.gzhead.name){p=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),flush_pending(d),p=w.pending,w.pending===w.pending_buf_size)){m=1;break}w.gzindex<w.gzhead.name.length?m=w.gzhead.name.charCodeAt(w.gzindex++)&255:m=0,put_byte(w,m)}while(m!==0);w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),m===0&&(w.gzindex=0,w.status=COMMENT_STATE)}else w.status=COMMENT_STATE;if(w.status===COMMENT_STATE)if(w.gzhead.comment){p=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),flush_pending(d),p=w.pending,w.pending===w.pending_buf_size)){m=1;break}w.gzindex<w.gzhead.comment.length?m=w.gzhead.comment.charCodeAt(w.gzindex++)&255:m=0,put_byte(w,m)}while(m!==0);w.gzhead.hcrc&&w.pending>p&&(d.adler=crc32_1(d.adler,w.pending_buf,w.pending-p,p)),m===0&&(w.status=HCRC_STATE)}else w.status=HCRC_STATE;if(w.status===HCRC_STATE&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&flush_pending(d),w.pending+2<=w.pending_buf_size&&(put_byte(w,d.adler&255),put_byte(w,d.adler>>8&255),d.adler=0,w.status=BUSY_STATE)):w.status=BUSY_STATE),w.pending!==0){if(flush_pending(d),d.avail_out===0)return w.last_flush=-1,Z_OK$3}else if(d.avail_in===0&&rank(h)<=rank(M)&&h!==Z_FINISH$3)return err(d,Z_BUF_ERROR$1);if(w.status===FINISH_STATE&&d.avail_in!==0)return err(d,Z_BUF_ERROR$1);if(d.avail_in!==0||w.lookahead!==0||h!==Z_NO_FLUSH$2&&w.status!==FINISH_STATE){let k=w.strategy===Z_HUFFMAN_ONLY?deflate_huff(w,h):w.strategy===Z_RLE?deflate_rle(w,h):configuration_table[w.level].func(w,h);if((k===BS_FINISH_STARTED||k===BS_FINISH_DONE)&&(w.status=FINISH_STATE),k===BS_NEED_MORE||k===BS_FINISH_STARTED)return d.avail_out===0&&(w.last_flush=-1),Z_OK$3;if(k===BS_BLOCK_DONE&&(h===Z_PARTIAL_FLUSH?_tr_align(w):h!==Z_BLOCK$1&&(_tr_stored_block(w,0,0,!1),h===Z_FULL_FLUSH$1&&(zero(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),flush_pending(d),d.avail_out===0))return w.last_flush=-1,Z_OK$3}return h!==Z_FINISH$3?Z_OK$3:w.wrap<=0?Z_STREAM_END$3:(w.wrap===2?(put_byte(w,d.adler&255),put_byte(w,d.adler>>8&255),put_byte(w,d.adler>>16&255),put_byte(w,d.adler>>24&255),put_byte(w,d.total_in&255),put_byte(w,d.total_in>>8&255),put_byte(w,d.total_in>>16&255),put_byte(w,d.total_in>>24&255)):(putShortMSB(w,d.adler>>>16),putShortMSB(w,d.adler&65535)),flush_pending(d),w.wrap>0&&(w.wrap=-w.wrap),w.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=d=>{if(!d||!d.state)return Z_STREAM_ERROR$2;const h=d.state.status;return h!==INIT_STATE&&h!==EXTRA_STATE&&h!==NAME_STATE&&h!==COMMENT_STATE&&h!==HCRC_STATE&&h!==BUSY_STATE&&h!==FINISH_STATE?err(d,Z_STREAM_ERROR$2):(d.state=null,h===BUSY_STATE?err(d,Z_DATA_ERROR$2):Z_OK$3)},deflateSetDictionary=(d,h)=>{let p=h.length;if(!d||!d.state)return Z_STREAM_ERROR$2;const m=d.state,w=m.wrap;if(w===2||w===1&&m.status!==INIT_STATE||m.lookahead)return Z_STREAM_ERROR$2;if(w===1&&(d.adler=adler32_1(d.adler,h,p,0)),m.wrap=0,p>=m.w_size){w===0&&(zero(m.head),m.strstart=0,m.block_start=0,m.insert=0);let L=new Uint8Array(m.w_size);L.set(h.subarray(p-m.w_size,p),0),h=L,p=m.w_size}const M=d.avail_in,k=d.next_in,x=d.input;for(d.avail_in=p,d.next_in=0,d.input=h,fill_window(m);m.lookahead>=MIN_MATCH;){let L=m.strstart,B=m.lookahead-(MIN_MATCH-1);do m.ins_h=HASH(m,m.ins_h,m.window[L+MIN_MATCH-1]),m.prev[L&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=L,L++;while(--B);m.strstart=L,m.lookahead=MIN_MATCH-1,fill_window(m)}return m.strstart+=m.lookahead,m.block_start=m.strstart,m.insert=m.lookahead,m.lookahead=0,m.match_length=m.prev_length=MIN_MATCH-1,m.match_available=0,d.next_in=k,d.input=x,d.avail_in=M,m.wrap=w,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(d,h)=>Object.prototype.hasOwnProperty.call(d,h);var assign=function(d){const h=Array.prototype.slice.call(arguments,1);for(;h.length;){const p=h.shift();if(!!p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(const m in p)_has(p,m)&&(d[m]=p[m])}}return d},flattenChunks=d=>{let h=0;for(let m=0,w=d.length;m<w;m++)h+=d[m].length;const p=new Uint8Array(h);for(let m=0,w=0,M=d.length;m<M;m++){let k=d[m];p.set(k,w),w+=k.length}return p},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let d=0;d<256;d++)_utf8len[d]=d>=252?6:d>=248?5:d>=240?4:d>=224?3:d>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=d=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(d);let h,p,m,w,M,k=d.length,x=0;for(w=0;w<k;w++)p=d.charCodeAt(w),(p&64512)===55296&&w+1<k&&(m=d.charCodeAt(w+1),(m&64512)===56320&&(p=65536+(p-55296<<10)+(m-56320),w++)),x+=p<128?1:p<2048?2:p<65536?3:4;for(h=new Uint8Array(x),M=0,w=0;M<x;w++)p=d.charCodeAt(w),(p&64512)===55296&&w+1<k&&(m=d.charCodeAt(w+1),(m&64512)===56320&&(p=65536+(p-55296<<10)+(m-56320),w++)),p<128?h[M++]=p:p<2048?(h[M++]=192|p>>>6,h[M++]=128|p&63):p<65536?(h[M++]=224|p>>>12,h[M++]=128|p>>>6&63,h[M++]=128|p&63):(h[M++]=240|p>>>18,h[M++]=128|p>>>12&63,h[M++]=128|p>>>6&63,h[M++]=128|p&63);return h};const buf2binstring=(d,h)=>{if(h<65534&&d.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,d.length===h?d:d.subarray(0,h));let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[m]);return p};var buf2string=(d,h)=>{const p=h||d.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(d.subarray(0,h));let m,w;const M=new Array(p*2);for(w=0,m=0;m<p;){let k=d[m++];if(k<128){M[w++]=k;continue}let x=_utf8len[k];if(x>4){M[w++]=65533,m+=x-1;continue}for(k&=x===2?31:x===3?15:7;x>1&&m<p;)k=k<<6|d[m++]&63,x--;if(x>1){M[w++]=65533;continue}k<65536?M[w++]=k:(k-=65536,M[w++]=55296|k>>10&1023,M[w++]=56320|k&1023)}return buf2binstring(M,w)},utf8border=(d,h)=>{h=h||d.length,h>d.length&&(h=d.length);let p=h-1;for(;p>=0&&(d[p]&192)===128;)p--;return p<0||p===0?h:p+_utf8len[d[p]]>h?p:h},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(d){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},d||{});let h=this.options;h.raw&&h.windowBits>0?h.windowBits=-h.windowBits:h.gzip&&h.windowBits>0&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let p=deflate_1$2.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(p!==Z_OK$2)throw new Error(messages[p]);if(h.header&&deflate_1$2.deflateSetHeader(this.strm,h.header),h.dictionary){let m;if(typeof h.dictionary=="string"?m=strings.string2buf(h.dictionary):toString$1$1.call(h.dictionary)==="[object ArrayBuffer]"?m=new Uint8Array(h.dictionary):m=h.dictionary,p=deflate_1$2.deflateSetDictionary(this.strm,m),p!==Z_OK$2)throw new Error(messages[p]);this._dict_set=!0}}Deflate$1.prototype.push=function(d,h){const p=this.strm,m=this.options.chunkSize;let w,M;if(this.ended)return!1;for(h===~~h?M=h:M=h===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof d=="string"?p.input=strings.string2buf(d):toString$1$1.call(d)==="[object ArrayBuffer]"?p.input=new Uint8Array(d):p.input=d,p.next_in=0,p.avail_in=p.input.length;;){if(p.avail_out===0&&(p.output=new Uint8Array(m),p.next_out=0,p.avail_out=m),(M===Z_SYNC_FLUSH||M===Z_FULL_FLUSH)&&p.avail_out<=6){this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;continue}if(w=deflate_1$2.deflate(p,M),w===Z_STREAM_END$2)return p.next_out>0&&this.onData(p.output.subarray(0,p.next_out)),w=deflate_1$2.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===Z_OK$2;if(p.avail_out===0){this.onData(p.output);continue}if(M>0&&p.next_out>0){this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;continue}if(p.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(d){this.chunks.push(d)};Deflate$1.prototype.onEnd=function(d){d===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg};function deflate$1(d,h){const p=new Deflate$1(h);if(p.push(d,!0),p.err)throw p.msg||messages[p.err];return p.result}function deflateRaw$1(d,h){return h=h||{},h.raw=!0,deflate$1(d,h)}function gzip$1(d,h){return h=h||{},h.gzip=!0,deflate$1(d,h)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$1,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1=30,TYPE$1=12;var inffast=function(h,p){let m,w,M,k,x,L,B,$,U,q,G,W,te,oe,ee,_e,se,he,ge,Re,ve,de,Se,ce;const ye=h.state;m=h.next_in,Se=h.input,w=m+(h.avail_in-5),M=h.next_out,ce=h.output,k=M-(p-h.avail_out),x=M+(h.avail_out-257),L=ye.dmax,B=ye.wsize,$=ye.whave,U=ye.wnext,q=ye.window,G=ye.hold,W=ye.bits,te=ye.lencode,oe=ye.distcode,ee=(1<<ye.lenbits)-1,_e=(1<<ye.distbits)-1;e:do{W<15&&(G+=Se[m++]<<W,W+=8,G+=Se[m++]<<W,W+=8),se=te[G&ee];t:for(;;){if(he=se>>>24,G>>>=he,W-=he,he=se>>>16&255,he===0)ce[M++]=se&65535;else if(he&16){ge=se&65535,he&=15,he&&(W<he&&(G+=Se[m++]<<W,W+=8),ge+=G&(1<<he)-1,G>>>=he,W-=he),W<15&&(G+=Se[m++]<<W,W+=8,G+=Se[m++]<<W,W+=8),se=oe[G&_e];i:for(;;){if(he=se>>>24,G>>>=he,W-=he,he=se>>>16&255,he&16){if(Re=se&65535,he&=15,W<he&&(G+=Se[m++]<<W,W+=8,W<he&&(G+=Se[m++]<<W,W+=8)),Re+=G&(1<<he)-1,Re>L){h.msg="invalid distance too far back",ye.mode=BAD$1;break e}if(G>>>=he,W-=he,he=M-k,Re>he){if(he=Re-he,he>$&&ye.sane){h.msg="invalid distance too far back",ye.mode=BAD$1;break e}if(ve=0,de=q,U===0){if(ve+=B-he,he<ge){ge-=he;do ce[M++]=q[ve++];while(--he);ve=M-Re,de=ce}}else if(U<he){if(ve+=B+U-he,he-=U,he<ge){ge-=he;do ce[M++]=q[ve++];while(--he);if(ve=0,U<ge){he=U,ge-=he;do ce[M++]=q[ve++];while(--he);ve=M-Re,de=ce}}}else if(ve+=U-he,he<ge){ge-=he;do ce[M++]=q[ve++];while(--he);ve=M-Re,de=ce}for(;ge>2;)ce[M++]=de[ve++],ce[M++]=de[ve++],ce[M++]=de[ve++],ge-=3;ge&&(ce[M++]=de[ve++],ge>1&&(ce[M++]=de[ve++]))}else{ve=M-Re;do ce[M++]=ce[ve++],ce[M++]=ce[ve++],ce[M++]=ce[ve++],ge-=3;while(ge>2);ge&&(ce[M++]=ce[ve++],ge>1&&(ce[M++]=ce[ve++]))}}else if((he&64)===0){se=oe[(se&65535)+(G&(1<<he)-1)];continue i}else{h.msg="invalid distance code",ye.mode=BAD$1;break e}break}}else if((he&64)===0){se=te[(se&65535)+(G&(1<<he)-1)];continue t}else if(he&32){ye.mode=TYPE$1;break e}else{h.msg="invalid literal/length code",ye.mode=BAD$1;break e}break}}while(m<w&&M<x);ge=W>>3,m-=ge,W-=ge<<3,G&=(1<<W)-1,h.next_in=m,h.next_out=M,h.avail_in=m<w?5+(w-m):5-(m-w),h.avail_out=M<x?257+(x-M):257-(M-x),ye.hold=G,ye.bits=W};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(d,h,p,m,w,M,k,x)=>{const L=x.bits;let B=0,$=0,U=0,q=0,G=0,W=0,te=0,oe=0,ee=0,_e=0,se,he,ge,Re,ve,de=null,Se=0,ce;const ye=new Uint16Array(MAXBITS+1),ze=new Uint16Array(MAXBITS+1);let Xe=null,at=0,ct,Bt,Lt;for(B=0;B<=MAXBITS;B++)ye[B]=0;for($=0;$<m;$++)ye[h[p+$]]++;for(G=L,q=MAXBITS;q>=1&&ye[q]===0;q--);if(G>q&&(G=q),q===0)return w[M++]=1<<24|64<<16|0,w[M++]=1<<24|64<<16|0,x.bits=1,0;for(U=1;U<q&&ye[U]===0;U++);for(G<U&&(G=U),oe=1,B=1;B<=MAXBITS;B++)if(oe<<=1,oe-=ye[B],oe<0)return-1;if(oe>0&&(d===CODES$1||q!==1))return-1;for(ze[1]=0,B=1;B<MAXBITS;B++)ze[B+1]=ze[B]+ye[B];for($=0;$<m;$++)h[p+$]!==0&&(k[ze[h[p+$]]++]=$);if(d===CODES$1?(de=Xe=k,ce=19):d===LENS$1?(de=lbase,Se-=257,Xe=lext,at-=257,ce=256):(de=dbase,Xe=dext,ce=-1),_e=0,$=0,B=U,ve=M,W=G,te=0,ge=-1,ee=1<<G,Re=ee-1,d===LENS$1&&ee>ENOUGH_LENS$1||d===DISTS$1&&ee>ENOUGH_DISTS$1)return 1;for(;;){ct=B-te,k[$]<ce?(Bt=0,Lt=k[$]):k[$]>ce?(Bt=Xe[at+k[$]],Lt=de[Se+k[$]]):(Bt=32+64,Lt=0),se=1<<B-te,he=1<<W,U=he;do he-=se,w[ve+(_e>>te)+he]=ct<<24|Bt<<16|Lt|0;while(he!==0);for(se=1<<B-1;_e&se;)se>>=1;if(se!==0?(_e&=se-1,_e+=se):_e=0,$++,--ye[B]===0){if(B===q)break;B=h[p+k[$]]}if(B>G&&(_e&Re)!==ge){for(te===0&&(te=G),ve+=U,W=B-te,oe=1<<W;W+te<q&&(oe-=ye[W+te],!(oe<=0));)W++,oe<<=1;if(ee+=1<<W,d===LENS$1&&ee>ENOUGH_LENS$1||d===DISTS$1&&ee>ENOUGH_DISTS$1)return 1;ge=_e&Re,w[ge]=G<<24|W<<16|ve-M|0}}return _e!==0&&(w[ve+_e]=B-te<<24|64<<16|0),x.bits=G,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=d=>(d>>>24&255)+(d>>>8&65280)+((d&65280)<<8)+((d&255)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=d=>{if(!d||!d.state)return Z_STREAM_ERROR$1;const h=d.state;return d.total_in=d.total_out=h.total=0,d.msg="",h.wrap&&(d.adler=h.wrap&1),h.mode=HEAD,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new Int32Array(ENOUGH_LENS),h.distcode=h.distdyn=new Int32Array(ENOUGH_DISTS),h.sane=1,h.back=-1,Z_OK$1},inflateReset=d=>{if(!d||!d.state)return Z_STREAM_ERROR$1;const h=d.state;return h.wsize=0,h.whave=0,h.wnext=0,inflateResetKeep(d)},inflateReset2=(d,h)=>{let p;if(!d||!d.state)return Z_STREAM_ERROR$1;const m=d.state;return h<0?(p=0,h=-h):(p=(h>>4)+1,h<48&&(h&=15)),h&&(h<8||h>15)?Z_STREAM_ERROR$1:(m.window!==null&&m.wbits!==h&&(m.window=null),m.wrap=p,m.wbits=h,inflateReset(d))},inflateInit2=(d,h)=>{if(!d)return Z_STREAM_ERROR$1;const p=new InflateState;d.state=p,p.window=null;const m=inflateReset2(d,h);return m!==Z_OK$1&&(d.state=null),m},inflateInit=d=>inflateInit2(d,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=d=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let h=0;for(;h<144;)d.lens[h++]=8;for(;h<256;)d.lens[h++]=9;for(;h<280;)d.lens[h++]=7;for(;h<288;)d.lens[h++]=8;for(inftrees(LENS,d.lens,0,288,lenfix,0,d.work,{bits:9}),h=0;h<32;)d.lens[h++]=5;inftrees(DISTS,d.lens,0,32,distfix,0,d.work,{bits:5}),virgin=!1}d.lencode=lenfix,d.lenbits=9,d.distcode=distfix,d.distbits=5},updatewindow=(d,h,p,m)=>{let w;const M=d.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new Uint8Array(M.wsize)),m>=M.wsize?(M.window.set(h.subarray(p-M.wsize,p),0),M.wnext=0,M.whave=M.wsize):(w=M.wsize-M.wnext,w>m&&(w=m),M.window.set(h.subarray(p-m,p-m+w),M.wnext),m-=w,m?(M.window.set(h.subarray(p-m,p),0),M.wnext=m,M.whave=M.wsize):(M.wnext+=w,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=w))),0},inflate$2=(d,h)=>{let p,m,w,M,k,x,L,B,$,U,q,G,W,te,oe=0,ee,_e,se,he,ge,Re,ve,de;const Se=new Uint8Array(4);let ce,ye;const ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!d||!d.state||!d.output||!d.input&&d.avail_in!==0)return Z_STREAM_ERROR$1;p=d.state,p.mode===TYPE&&(p.mode=TYPEDO),k=d.next_out,w=d.output,L=d.avail_out,M=d.next_in,m=d.input,x=d.avail_in,B=p.hold,$=p.bits,U=x,q=L,de=Z_OK$1;e:for(;;)switch(p.mode){case HEAD:if(p.wrap===0){p.mode=TYPEDO;break}for(;$<16;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(p.wrap&2&&B===35615){p.check=0,Se[0]=B&255,Se[1]=B>>>8&255,p.check=crc32_1(p.check,Se,2,0),B=0,$=0,p.mode=FLAGS;break}if(p.flags=0,p.head&&(p.head.done=!1),!(p.wrap&1)||(((B&255)<<8)+(B>>8))%31){d.msg="incorrect header check",p.mode=BAD;break}if((B&15)!==Z_DEFLATED){d.msg="unknown compression method",p.mode=BAD;break}if(B>>>=4,$-=4,ve=(B&15)+8,p.wbits===0)p.wbits=ve;else if(ve>p.wbits){d.msg="invalid window size",p.mode=BAD;break}p.dmax=1<<p.wbits,d.adler=p.check=1,p.mode=B&512?DICTID:TYPE,B=0,$=0;break;case FLAGS:for(;$<16;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(p.flags=B,(p.flags&255)!==Z_DEFLATED){d.msg="unknown compression method",p.mode=BAD;break}if(p.flags&57344){d.msg="unknown header flags set",p.mode=BAD;break}p.head&&(p.head.text=B>>8&1),p.flags&512&&(Se[0]=B&255,Se[1]=B>>>8&255,p.check=crc32_1(p.check,Se,2,0)),B=0,$=0,p.mode=TIME;case TIME:for(;$<32;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.head&&(p.head.time=B),p.flags&512&&(Se[0]=B&255,Se[1]=B>>>8&255,Se[2]=B>>>16&255,Se[3]=B>>>24&255,p.check=crc32_1(p.check,Se,4,0)),B=0,$=0,p.mode=OS;case OS:for(;$<16;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.head&&(p.head.xflags=B&255,p.head.os=B>>8),p.flags&512&&(Se[0]=B&255,Se[1]=B>>>8&255,p.check=crc32_1(p.check,Se,2,0)),B=0,$=0,p.mode=EXLEN;case EXLEN:if(p.flags&1024){for(;$<16;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.length=B,p.head&&(p.head.extra_len=B),p.flags&512&&(Se[0]=B&255,Se[1]=B>>>8&255,p.check=crc32_1(p.check,Se,2,0)),B=0,$=0}else p.head&&(p.head.extra=null);p.mode=EXTRA;case EXTRA:if(p.flags&1024&&(G=p.length,G>x&&(G=x),G&&(p.head&&(ve=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Uint8Array(p.head.extra_len)),p.head.extra.set(m.subarray(M,M+G),ve)),p.flags&512&&(p.check=crc32_1(p.check,m,G,M)),x-=G,M+=G,p.length-=G),p.length))break e;p.length=0,p.mode=NAME;case NAME:if(p.flags&2048){if(x===0)break e;G=0;do ve=m[M+G++],p.head&&ve&&p.length<65536&&(p.head.name+=String.fromCharCode(ve));while(ve&&G<x);if(p.flags&512&&(p.check=crc32_1(p.check,m,G,M)),x-=G,M+=G,ve)break e}else p.head&&(p.head.name=null);p.length=0,p.mode=COMMENT;case COMMENT:if(p.flags&4096){if(x===0)break e;G=0;do ve=m[M+G++],p.head&&ve&&p.length<65536&&(p.head.comment+=String.fromCharCode(ve));while(ve&&G<x);if(p.flags&512&&(p.check=crc32_1(p.check,m,G,M)),x-=G,M+=G,ve)break e}else p.head&&(p.head.comment=null);p.mode=HCRC;case HCRC:if(p.flags&512){for(;$<16;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(B!==(p.check&65535)){d.msg="header crc mismatch",p.mode=BAD;break}B=0,$=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),d.adler=p.check=0,p.mode=TYPE;break;case DICTID:for(;$<32;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}d.adler=p.check=zswap32(B),B=0,$=0,p.mode=DICT;case DICT:if(p.havedict===0)return d.next_out=k,d.avail_out=L,d.next_in=M,d.avail_in=x,p.hold=B,p.bits=$,Z_NEED_DICT$1;d.adler=p.check=1,p.mode=TYPE;case TYPE:if(h===Z_BLOCK||h===Z_TREES)break e;case TYPEDO:if(p.last){B>>>=$&7,$-=$&7,p.mode=CHECK;break}for(;$<3;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}switch(p.last=B&1,B>>>=1,$-=1,B&3){case 0:p.mode=STORED;break;case 1:if(fixedtables(p),p.mode=LEN_,h===Z_TREES){B>>>=2,$-=2;break e}break;case 2:p.mode=TABLE;break;case 3:d.msg="invalid block type",p.mode=BAD}B>>>=2,$-=2;break;case STORED:for(B>>>=$&7,$-=$&7;$<32;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if((B&65535)!==(B>>>16^65535)){d.msg="invalid stored block lengths",p.mode=BAD;break}if(p.length=B&65535,B=0,$=0,p.mode=COPY_,h===Z_TREES)break e;case COPY_:p.mode=COPY;case COPY:if(G=p.length,G){if(G>x&&(G=x),G>L&&(G=L),G===0)break e;w.set(m.subarray(M,M+G),k),x-=G,M+=G,L-=G,k+=G,p.length-=G;break}p.mode=TYPE;break;case TABLE:for(;$<14;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(p.nlen=(B&31)+257,B>>>=5,$-=5,p.ndist=(B&31)+1,B>>>=5,$-=5,p.ncode=(B&15)+4,B>>>=4,$-=4,p.nlen>286||p.ndist>30){d.msg="too many length or distance symbols",p.mode=BAD;break}p.have=0,p.mode=LENLENS;case LENLENS:for(;p.have<p.ncode;){for(;$<3;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.lens[ze[p.have++]]=B&7,B>>>=3,$-=3}for(;p.have<19;)p.lens[ze[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,ce={bits:p.lenbits},de=inftrees(CODES,p.lens,0,19,p.lencode,0,p.work,ce),p.lenbits=ce.bits,de){d.msg="invalid code lengths set",p.mode=BAD;break}p.have=0,p.mode=CODELENS;case CODELENS:for(;p.have<p.nlen+p.ndist;){for(;oe=p.lencode[B&(1<<p.lenbits)-1],ee=oe>>>24,_e=oe>>>16&255,se=oe&65535,!(ee<=$);){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(se<16)B>>>=ee,$-=ee,p.lens[p.have++]=se;else{if(se===16){for(ye=ee+2;$<ye;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(B>>>=ee,$-=ee,p.have===0){d.msg="invalid bit length repeat",p.mode=BAD;break}ve=p.lens[p.have-1],G=3+(B&3),B>>>=2,$-=2}else if(se===17){for(ye=ee+3;$<ye;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}B>>>=ee,$-=ee,ve=0,G=3+(B&7),B>>>=3,$-=3}else{for(ye=ee+7;$<ye;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}B>>>=ee,$-=ee,ve=0,G=11+(B&127),B>>>=7,$-=7}if(p.have+G>p.nlen+p.ndist){d.msg="invalid bit length repeat",p.mode=BAD;break}for(;G--;)p.lens[p.have++]=ve}}if(p.mode===BAD)break;if(p.lens[256]===0){d.msg="invalid code -- missing end-of-block",p.mode=BAD;break}if(p.lenbits=9,ce={bits:p.lenbits},de=inftrees(LENS,p.lens,0,p.nlen,p.lencode,0,p.work,ce),p.lenbits=ce.bits,de){d.msg="invalid literal/lengths set",p.mode=BAD;break}if(p.distbits=6,p.distcode=p.distdyn,ce={bits:p.distbits},de=inftrees(DISTS,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,ce),p.distbits=ce.bits,de){d.msg="invalid distances set",p.mode=BAD;break}if(p.mode=LEN_,h===Z_TREES)break e;case LEN_:p.mode=LEN;case LEN:if(x>=6&&L>=258){d.next_out=k,d.avail_out=L,d.next_in=M,d.avail_in=x,p.hold=B,p.bits=$,inffast(d,q),k=d.next_out,w=d.output,L=d.avail_out,M=d.next_in,m=d.input,x=d.avail_in,B=p.hold,$=p.bits,p.mode===TYPE&&(p.back=-1);break}for(p.back=0;oe=p.lencode[B&(1<<p.lenbits)-1],ee=oe>>>24,_e=oe>>>16&255,se=oe&65535,!(ee<=$);){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(_e&&(_e&240)===0){for(he=ee,ge=_e,Re=se;oe=p.lencode[Re+((B&(1<<he+ge)-1)>>he)],ee=oe>>>24,_e=oe>>>16&255,se=oe&65535,!(he+ee<=$);){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}B>>>=he,$-=he,p.back+=he}if(B>>>=ee,$-=ee,p.back+=ee,p.length=se,_e===0){p.mode=LIT;break}if(_e&32){p.back=-1,p.mode=TYPE;break}if(_e&64){d.msg="invalid literal/length code",p.mode=BAD;break}p.extra=_e&15,p.mode=LENEXT;case LENEXT:if(p.extra){for(ye=p.extra;$<ye;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.length+=B&(1<<p.extra)-1,B>>>=p.extra,$-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=DIST;case DIST:for(;oe=p.distcode[B&(1<<p.distbits)-1],ee=oe>>>24,_e=oe>>>16&255,se=oe&65535,!(ee<=$);){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if((_e&240)===0){for(he=ee,ge=_e,Re=se;oe=p.distcode[Re+((B&(1<<he+ge)-1)>>he)],ee=oe>>>24,_e=oe>>>16&255,se=oe&65535,!(he+ee<=$);){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}B>>>=he,$-=he,p.back+=he}if(B>>>=ee,$-=ee,p.back+=ee,_e&64){d.msg="invalid distance code",p.mode=BAD;break}p.offset=se,p.extra=_e&15,p.mode=DISTEXT;case DISTEXT:if(p.extra){for(ye=p.extra;$<ye;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}p.offset+=B&(1<<p.extra)-1,B>>>=p.extra,$-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){d.msg="invalid distance too far back",p.mode=BAD;break}p.mode=MATCH;case MATCH:if(L===0)break e;if(G=q-L,p.offset>G){if(G=p.offset-G,G>p.whave&&p.sane){d.msg="invalid distance too far back",p.mode=BAD;break}G>p.wnext?(G-=p.wnext,W=p.wsize-G):W=p.wnext-G,G>p.length&&(G=p.length),te=p.window}else te=w,W=k-p.offset,G=p.length;G>L&&(G=L),L-=G,p.length-=G;do w[k++]=te[W++];while(--G);p.length===0&&(p.mode=LEN);break;case LIT:if(L===0)break e;w[k++]=p.length,L--,p.mode=LEN;break;case CHECK:if(p.wrap){for(;$<32;){if(x===0)break e;x--,B|=m[M++]<<$,$+=8}if(q-=L,d.total_out+=q,p.total+=q,q&&(d.adler=p.check=p.flags?crc32_1(p.check,w,q,k-q):adler32_1(p.check,w,q,k-q)),q=L,(p.flags?B:zswap32(B))!==p.check){d.msg="incorrect data check",p.mode=BAD;break}B=0,$=0}p.mode=LENGTH;case LENGTH:if(p.wrap&&p.flags){for(;$<32;){if(x===0)break e;x--,B+=m[M++]<<$,$+=8}if(B!==(p.total&4294967295)){d.msg="incorrect length check",p.mode=BAD;break}B=0,$=0}p.mode=DONE;case DONE:de=Z_STREAM_END$1;break e;case BAD:de=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return d.next_out=k,d.avail_out=L,d.next_in=M,d.avail_in=x,p.hold=B,p.bits=$,(p.wsize||q!==d.avail_out&&p.mode<BAD&&(p.mode<CHECK||h!==Z_FINISH$1))&&updatewindow(d,d.output,d.next_out,q-d.avail_out),U-=d.avail_in,q-=d.avail_out,d.total_in+=U,d.total_out+=q,p.total+=q,p.wrap&&q&&(d.adler=p.check=p.flags?crc32_1(p.check,w,q,d.next_out-q):adler32_1(p.check,w,q,d.next_out-q)),d.data_type=p.bits+(p.last?64:0)+(p.mode===TYPE?128:0)+(p.mode===LEN_||p.mode===COPY_?256:0),(U===0&&q===0||h===Z_FINISH$1)&&de===Z_OK$1&&(de=Z_BUF_ERROR),de},inflateEnd=d=>{if(!d||!d.state)return Z_STREAM_ERROR$1;let h=d.state;return h.window&&(h.window=null),d.state=null,Z_OK$1},inflateGetHeader=(d,h)=>{if(!d||!d.state)return Z_STREAM_ERROR$1;const p=d.state;return(p.wrap&2)===0?Z_STREAM_ERROR$1:(p.head=h,h.done=!1,Z_OK$1)},inflateSetDictionary=(d,h)=>{const p=h.length;let m,w,M;return!d||!d.state||(m=d.state,m.wrap!==0&&m.mode!==DICT)?Z_STREAM_ERROR$1:m.mode===DICT&&(w=1,w=adler32_1(w,h,p,0),w!==m.check)?Z_DATA_ERROR$1:(M=updatewindow(d,h,p,p),M?(m.mode=MEM,Z_MEM_ERROR$1):(m.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$3=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(d){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},d||{});const h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),h.windowBits>=0&&h.windowBits<16&&!(d&&d.windowBits)&&(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&(h.windowBits&15)===0&&(h.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let p=inflate_1$2.inflateInit2(this.strm,h.windowBits);if(p!==Z_OK)throw new Error(messages[p]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),h.dictionary&&(typeof h.dictionary=="string"?h.dictionary=strings.string2buf(h.dictionary):toString$3.call(h.dictionary)==="[object ArrayBuffer]"&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(p=inflate_1$2.inflateSetDictionary(this.strm,h.dictionary),p!==Z_OK)))throw new Error(messages[p])}Inflate$1.prototype.push=function(d,h){const p=this.strm,m=this.options.chunkSize,w=this.options.dictionary;let M,k,x;if(this.ended)return!1;for(h===~~h?k=h:k=h===!0?Z_FINISH:Z_NO_FLUSH,toString$3.call(d)==="[object ArrayBuffer]"?p.input=new Uint8Array(d):p.input=d,p.next_in=0,p.avail_in=p.input.length;;){for(p.avail_out===0&&(p.output=new Uint8Array(m),p.next_out=0,p.avail_out=m),M=inflate_1$2.inflate(p,k),M===Z_NEED_DICT&&w&&(M=inflate_1$2.inflateSetDictionary(p,w),M===Z_OK?M=inflate_1$2.inflate(p,k):M===Z_DATA_ERROR&&(M=Z_NEED_DICT));p.avail_in>0&&M===Z_STREAM_END&&p.state.wrap>0&&d[p.next_in]!==0;)inflate_1$2.inflateReset(p),M=inflate_1$2.inflate(p,k);switch(M){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(M),this.ended=!0,!1}if(x=p.avail_out,p.next_out&&(p.avail_out===0||M===Z_STREAM_END))if(this.options.to==="string"){let L=strings.utf8border(p.output,p.next_out),B=p.next_out-L,$=strings.buf2string(p.output,L);p.next_out=B,p.avail_out=m-B,B&&p.output.set(p.output.subarray(L,L+B),0),this.onData($)}else this.onData(p.output.length===p.next_out?p.output:p.output.subarray(0,p.next_out));if(!(M===Z_OK&&x===0)){if(M===Z_STREAM_END)return M=inflate_1$2.inflateEnd(this.strm),this.onEnd(M),this.ended=!0,!0;if(p.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(d){this.chunks.push(d)};Inflate$1.prototype.onEnd=function(d){d===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg};function inflate$1(d,h){const p=new Inflate$1(h);if(p.push(d),p.err)throw p.msg||messages[p.err];return p.result}function inflateRaw$1(d,h){return h=h||{},h.raw=!0,inflate$1(d,h)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$5=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$5};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let d=0;d<256;d++){let h=d;for(let p=0;p<8;p++)h&1?h=3988292384^h>>>1:h=h>>>1;crcTable[d]=h}const initialCrc=4294967295;function updateCrc(d,h,p){let m=d;for(let w=0;w<p;w++)m=crcTable[(m^h[w])&255]^m>>>8;return m}function crc(d,h){return(updateCrc(initialCrc,d,h)^initialCrc)>>>0}var ColorType;(function(d){d[d.UNKNOWN=-1]="UNKNOWN",d[d.GREYSCALE=0]="GREYSCALE",d[d.TRUECOLOUR=2]="TRUECOLOUR",d[d.INDEXED_COLOUR=3]="INDEXED_COLOUR",d[d.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",d[d.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(d){d[d.UNKNOWN=-1]="UNKNOWN",d[d.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(d){d[d.UNKNOWN=-1]="UNKNOWN",d[d.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(d){d[d.UNKNOWN=-1]="UNKNOWN",d[d.NO_INTERLACE=0]="NO_INTERLACE",d[d.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(h,p={}){super(h);const{checkCrc:m=!1}=p;this._checkCrc=m,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let h=0;h<pngSignature.length;h++)if(this.readUint8()!==pngSignature[h])throw new Error(`wrong PNG signature. Byte at ${h} should be ${pngSignature[h]}.`)}decodeChunk(){const h=this.readUint32(),p=this.readChars(4),m=this.offset;switch(p){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(h);break;case"IDAT":this.decodeIDAT(h);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(h);break;case"iCCP":this.decodeiCCP(h);break;case"tEXt":this.decodetEXt(h);break;case"pHYs":this.decodepHYs();break;default:this.skip(h);break}if(this.offset-m!==h)throw new Error(`Length mismatch while decoding chunk ${p}`);if(this._checkCrc){const w=this.readUint32(),M=h+4,k=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-M-4,M),M);if(k!==w)throw new Error(`CRC mismatch for chunk ${p}. Expected ${w}, found ${k}`)}else this.skip(4)}decodeIHDR(){const h=this._png;h.width=this.readUint32(),h.height=this.readUint32(),h.depth=checkBitDepth(this.readUint8());const p=this.readUint8();this._colorType=p;let m;switch(p){case ColorType.GREYSCALE:m=1;break;case ColorType.TRUECOLOUR:m=3;break;case ColorType.INDEXED_COLOUR:m=1;break;case ColorType.GREYSCALE_ALPHA:m=2;break;case ColorType.TRUECOLOUR_ALPHA:m=4;break;default:throw new Error(`Unknown color type: ${p}`)}if(this._png.channels=m,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(h){if(h%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${h}`);const p=h/3;this._hasPalette=!0;const m=[];this._palette=m;for(let w=0;w<p;w++)m.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(h){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,h)),this.skip(h)}decodetRNS(h){if(this._colorType===3){if(h>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${h} vs ${this._palette.length})`);let p=0;for(;p<h;p++){const m=this.readByte();this._palette[p].push(m)}for(;p<this._palette.length;p++)this._palette[p].push(255)}}decodeiCCP(h){let p="",m;for(;(m=this.readChar())!==NULL;)p+=m;const w=this.readUint8();if(w!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${w}`);const M=this.readBytes(h-p.length-2);this._png.iccEmbeddedProfile={name:p,profile:inflate_1(M)}}decodetEXt(h){let p="",m;for(;(m=this.readChar())!==NULL;)p+=m;this._png.text[p]=this.readChars(h-p.length-1)}decodepHYs(){const h=this.readUint32(),p=this.readUint32(),m=this.readByte();this._png.resolution={x:h,y:p,unit:m}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const h=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(h);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(h){const p=this._png.height,m=this._png.channels*this._png.depth/8,w=this._png.width*m,M=new Uint8Array(this._png.height*w);let k=empty,x=0,L,B;for(let $=0;$<p;$++){switch(L=h.subarray(x+1,x+1+w),B=M.subarray($*w,($+1)*w),h[x]){case 0:unfilterNone(L,B,w);break;case 1:unfilterSub(L,B,w,m);break;case 2:unfilterUp(L,B,k,w);break;case 3:unfilterAverage(L,B,k,w,m);break;case 4:unfilterPaeth(L,B,k,w,m);break;default:throw new Error(`Unsupported filter: ${h[x]}`)}k=B,x+=w+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const $=new Uint16Array(M.buffer);if(osIsLittleEndian)for(let U=0;U<$.length;U++)$[U]=swap16($[U]);this._png.data=$}else this._png.data=M}}function unfilterNone(d,h,p){for(let m=0;m<p;m++)h[m]=d[m]}function unfilterSub(d,h,p,m){let w=0;for(;w<m;w++)h[w]=d[w];for(;w<p;w++)h[w]=d[w]+h[w-m]&255}function unfilterUp(d,h,p,m){let w=0;if(p.length===0)for(;w<m;w++)h[w]=d[w];else for(;w<m;w++)h[w]=d[w]+p[w]&255}function unfilterAverage(d,h,p,m,w){let M=0;if(p.length===0){for(;M<w;M++)h[M]=d[M];for(;M<m;M++)h[M]=d[M]+(h[M-w]>>1)&255}else{for(;M<w;M++)h[M]=d[M]+(p[M]>>1)&255;for(;M<m;M++)h[M]=d[M]+(h[M-w]+p[M]>>1)&255}}function unfilterPaeth(d,h,p,m,w){let M=0;if(p.length===0){for(;M<w;M++)h[M]=d[M];for(;M<m;M++)h[M]=d[M]+h[M-w]&255}else{for(;M<w;M++)h[M]=d[M]+p[M]&255;for(;M<m;M++)h[M]=d[M]+paethPredictor(h[M-w],p[M],p[M-w])&255}}function paethPredictor(d,h,p){const m=d+h-p,w=Math.abs(m-d),M=Math.abs(m-h),k=Math.abs(m-p);return w<=M&&w<=k?d:M<=k?h:p}function swap16(d){return(d&255)<<8|d>>8&255}function checkBitDepth(d){if(d!==1&&d!==2&&d!==4&&d!==8&&d!==16)throw new Error(`invalid bit depth: ${d}`);return d}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(h,p={}){super();this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,p.zlib),this._png=this._checkData(h),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(h){this.writeUint32(h.length),this.writeChars("IDAT"),this.writeBytes(h),this.writeCrc(h.length+4)}encodeData(){const{width:h,height:p,channels:m,depth:w,data:M}=this._png,k=m*h,x=new IOBuffer$4().setBigEndian();let L=0;for(let U=0;U<p;U++)if(x.writeByte(0),w===8)L=writeDataBytes(M,x,k,L);else if(w===16)L=writeDataUint16(M,x,k,L);else throw new Error("unreachable");const B=x.toArray(),$=deflate_1(B,this._zlibOptions);this.encodeIDAT($)}_checkData(h){const{colorType:p,channels:m,depth:w}=getColorType(h),M={width:checkInteger(h.width,"width"),height:checkInteger(h.height,"height"),channels:m,data:h.data,depth:w,text:{}};this._colorType=p;const k=M.width*M.height*m;if(M.data.length!==k)throw new RangeError(`wrong data size. Found ${M.data.length}, expected ${k}`);return M}writeCrc(h){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-h,h),h))}}function checkInteger(d,h){if(Number.isInteger(d)&&d>0)return d;throw new TypeError(`${h} must be a positive integer`)}function getColorType(d){const{channels:h=4,depth:p=8}=d;if(h!==4&&h!==3&&h!==2&&h!==1)throw new RangeError(`unsupported number of channels: ${h}`);if(p!==8&&p!==16)throw new RangeError(`unsupported bit depth: ${p}`);const m={channels:h,depth:p,colorType:ColorType.UNKNOWN};switch(h){case 4:m.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:m.colorType=ColorType.TRUECOLOUR;break;case 1:m.colorType=ColorType.GREYSCALE;break;case 2:m.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return m}function writeDataBytes(d,h,p,m){for(let w=0;w<p;w++)h.writeByte(d[m++]);return m}function writeDataUint16(d,h,p,m){for(let w=0;w<p;w++)h.writeUint16(d[m++]);return m}var ResolutionUnitSpecifier;(function(d){d[d.UNKNOWN=0]="UNKNOWN",d[d.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(d,h){return new PngDecoder(d,h).decode()}function encodePng$1(d,h){return new PngEncoder(d,h).encode()}var encoder$1={exports:{}};(function(d){function h(m){var w=Math.floor,M=new Array(64),k=new Array(64),x=new Array(64),L=new Array(64),B,$,U,q,G=new Array(65535),W=new Array(65535),te=new Array(64),oe=new Array(64),ee=[],_e=0,se=7,he=new Array(64),ge=new Array(64),Re=new Array(64),ve=new Array(256),de=new Array(2048),Se,ce=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ye=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ze=[0,1,2,3,4,5,6,7,8,9,10,11],Xe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],at=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ct=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Bt=[0,1,2,3,4,5,6,7,8,9,10,11],Lt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],It=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Vt(We){for(var Wt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Rt=0;Rt<64;Rt++){var ti=w((Wt[Rt]*We+50)/100);ti<1?ti=1:ti>255&&(ti=255),M[ce[Rt]]=ti}for(var ni=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],bt=0;bt<64;bt++){var Pi=w((ni[bt]*We+50)/100);Pi<1?Pi=1:Pi>255&&(Pi=255),k[ce[bt]]=Pi}for(var Kt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],qt=0,Zt=0;Zt<8;Zt++)for(var kt=0;kt<8;kt++)x[qt]=1/(M[ce[qt]]*Kt[Zt]*Kt[kt]*8),L[qt]=1/(k[ce[qt]]*Kt[Zt]*Kt[kt]*8),qt++}function Ft(We,Wt){for(var Rt=0,ti=0,ni=new Array,bt=1;bt<=16;bt++){for(var Pi=1;Pi<=We[bt];Pi++)ni[Wt[ti]]=[],ni[Wt[ti]][0]=Rt,ni[Wt[ti]][1]=bt,ti++,Rt++;Rt*=2}return ni}function Mt(){B=Ft(ye,ze),$=Ft(ct,Bt),U=Ft(Xe,at),q=Ft(Lt,It)}function ri(){for(var We=1,Wt=2,Rt=1;Rt<=15;Rt++){for(var ti=We;ti<Wt;ti++)W[32767+ti]=Rt,G[32767+ti]=[],G[32767+ti][1]=Rt,G[32767+ti][0]=ti;for(var ni=-(Wt-1);ni<=-We;ni++)W[32767+ni]=Rt,G[32767+ni]=[],G[32767+ni][1]=Rt,G[32767+ni][0]=Wt-1+ni;We<<=1,Wt<<=1}}function St(){for(var We=0;We<256;We++)de[We]=19595*We,de[We+256>>0]=38470*We,de[We+512>>0]=7471*We+32768,de[We+768>>0]=-11059*We,de[We+1024>>0]=-21709*We,de[We+1280>>0]=32768*We+8421375,de[We+1536>>0]=-27439*We,de[We+1792>>0]=-5329*We}function At(We){for(var Wt=We[0],Rt=We[1]-1;Rt>=0;)Wt&1<<Rt&&(_e|=1<<se),Rt--,se--,se<0&&(_e==255?(Et(255),Et(0)):Et(_e),se=7,_e=0)}function Et(We){ee.push(We)}function Ut(We){Et(We>>8&255),Et(We&255)}function jt(We,Wt){var Rt,ti,ni,bt,Pi,Kt,qt,Zt,kt=0,ci,vi=8,Ti=64;for(ci=0;ci<vi;++ci){Rt=We[kt],ti=We[kt+1],ni=We[kt+2],bt=We[kt+3],Pi=We[kt+4],Kt=We[kt+5],qt=We[kt+6],Zt=We[kt+7];var ei=Rt+Zt,hi=Rt-Zt,Ni=ti+qt,Ai=ti-qt,Xi=ni+Kt,Ii=ni-Kt,fr=bt+Pi,sn=bt-Pi,pr=ei+fr,Br=ei-fr,Lr=Ni+Xi,Tr=Ni-Xi;We[kt]=pr+Lr,We[kt+4]=pr-Lr;var br=(Tr+Br)*.707106781;We[kt+2]=Br+br,We[kt+6]=Br-br,pr=sn+Ii,Lr=Ii+Ai,Tr=Ai+hi;var Nr=(pr-Tr)*.382683433,Sr=.5411961*pr+Nr,Me=1.306562965*Tr+Nr,Ge=Lr*.707106781,le=hi+Ge,J=hi-Ge;We[kt+5]=J+Sr,We[kt+3]=J-Sr,We[kt+1]=le+Me,We[kt+7]=le-Me,kt+=8}for(kt=0,ci=0;ci<vi;++ci){Rt=We[kt],ti=We[kt+8],ni=We[kt+16],bt=We[kt+24],Pi=We[kt+32],Kt=We[kt+40],qt=We[kt+48],Zt=We[kt+56];var ne=Rt+Zt,fe=Rt-Zt,Ae=ti+qt,Pe=ti-qt,Ue=ni+Kt,Ve=ni-Kt,$e=bt+Pi,Ze=bt-Pi,Qe=ne+$e,et=ne-$e,lt=Ae+Ue,Ct=Ae-Ue;We[kt]=Qe+lt,We[kt+32]=Qe-lt;var Gt=(Ct+et)*.707106781;We[kt+16]=et+Gt,We[kt+48]=et-Gt,Qe=Ze+Ve,lt=Ve+Pe,Ct=Pe+fe;var Xt=(Qe-Ct)*.382683433,Ht=.5411961*Qe+Xt,gi=1.306562965*Ct+Xt,Yi=lt*.707106781,Ji=fe+Yi,qi=fe-Yi;We[kt+40]=qi+Ht,We[kt+24]=qi-Ht,We[kt+8]=Ji+gi,We[kt+56]=Ji-gi,kt++}var Hi;for(ci=0;ci<Ti;++ci)Hi=We[ci]*Wt[ci],te[ci]=Hi>0?Hi+.5|0:Hi-.5|0;return te}function mi(){Ut(65504),Ut(16),Et(74),Et(70),Et(73),Et(70),Et(0),Et(1),Et(1),Et(0),Ut(1),Ut(1),Et(0),Et(0)}function oi(We){if(!!We){Ut(65505),We[0]===69&&We[1]===120&&We[2]===105&&We[3]===102?Ut(We.length+2):(Ut(We.length+5+2),Et(69),Et(120),Et(105),Et(102),Et(0));for(var Wt=0;Wt<We.length;Wt++)Et(We[Wt])}}function yi(We,Wt){Ut(65472),Ut(17),Et(8),Ut(Wt),Ut(We),Et(3),Et(1),Et(17),Et(0),Et(2),Et(17),Et(1),Et(3),Et(17),Et(1)}function xi(){Ut(65499),Ut(132),Et(0);for(var We=0;We<64;We++)Et(M[We]);Et(1);for(var Wt=0;Wt<64;Wt++)Et(k[Wt])}function Bi(){Ut(65476),Ut(418),Et(0);for(var We=0;We<16;We++)Et(ye[We+1]);for(var Wt=0;Wt<=11;Wt++)Et(ze[Wt]);Et(16);for(var Rt=0;Rt<16;Rt++)Et(Xe[Rt+1]);for(var ti=0;ti<=161;ti++)Et(at[ti]);Et(1);for(var ni=0;ni<16;ni++)Et(ct[ni+1]);for(var bt=0;bt<=11;bt++)Et(Bt[bt]);Et(17);for(var Pi=0;Pi<16;Pi++)Et(Lt[Pi+1]);for(var Kt=0;Kt<=161;Kt++)Et(It[Kt])}function fi(){Ut(65498),Ut(12),Et(3),Et(1),Et(0),Et(2),Et(17),Et(3),Et(17),Et(0),Et(63),Et(0)}function mt(We,Wt,Rt,ti,ni){for(var bt=ni[0],Pi=ni[240],Kt,qt=16,Zt=63,kt=64,ci=jt(We,Wt),vi=0;vi<kt;++vi)oe[ce[vi]]=ci[vi];var Ti=oe[0]-Rt;Rt=oe[0],Ti==0?At(ti[0]):(Kt=32767+Ti,At(ti[W[Kt]]),At(G[Kt]));for(var ei=63;ei>0&&oe[ei]==0;ei--);if(ei==0)return At(bt),Rt;for(var hi=1,Ni;hi<=ei;){for(var Ai=hi;oe[hi]==0&&hi<=ei;++hi);var Xi=hi-Ai;if(Xi>=qt){Ni=Xi>>4;for(var Ii=1;Ii<=Ni;++Ii)At(Pi);Xi=Xi&15}Kt=32767+oe[hi],At(ni[(Xi<<4)+W[Kt]]),At(G[Kt]),hi++}return ei!=Zt&&At(bt),Rt}function vt(){for(var We=String.fromCharCode,Wt=0;Wt<256;Wt++)ve[Wt]=We(Wt)}this.encode=function(We,Wt){new Date().getTime(),Wt&&pi(Wt),ee=new Array,_e=0,se=7,Ut(65496),mi(),oi(We.exifBuffer),xi(),yi(We.width,We.height),Bi(),fi();var Rt=0,ti=0,ni=0;_e=0,se=7,this.encode.displayName="_encode_";for(var bt=We.data,Pi=We.width,Kt=We.height,qt=Pi*4,Zt,kt=0,ci,vi,Ti,ei,hi,Ni,Ai,Xi;kt<Kt;){for(Zt=0;Zt<qt;){for(ei=qt*kt+Zt,hi=ei,Ni=-1,Ai=0,Xi=0;Xi<64;Xi++)Ai=Xi>>3,Ni=(Xi&7)*4,hi=ei+Ai*qt+Ni,kt+Ai>=Kt&&(hi-=qt*(kt+1+Ai-Kt)),Zt+Ni>=qt&&(hi-=Zt+Ni-qt+4),ci=bt[hi++],vi=bt[hi++],Ti=bt[hi++],he[Xi]=(de[ci]+de[vi+256>>0]+de[Ti+512>>0]>>16)-128,ge[Xi]=(de[ci+768>>0]+de[vi+1024>>0]+de[Ti+1280>>0]>>16)-128,Re[Xi]=(de[ci+1280>>0]+de[vi+1536>>0]+de[Ti+1792>>0]>>16)-128;Rt=mt(he,x,Rt,B,U),ti=mt(ge,L,ti,$,q),ni=mt(Re,L,ni,$,q),Zt+=32}kt+=8}if(se>=0){var Ii=[];Ii[1]=se+1,Ii[0]=(1<<se+1)-1,At(Ii)}return Ut(65497),Buffer.from(ee)};function pi(We){if(We<=0&&(We=1),We>100&&(We=100),Se!=We){var Wt=0;We<50?Wt=Math.floor(5e3/We):Wt=Math.floor(200-We*2),Vt(Wt),Se=We}}function si(){var We=new Date().getTime();m||(m=50),vt(),Mt(),ri(),St(),pi(m),new Date().getTime()-We}si()}d.exports=p;function p(m,w){typeof w=="undefined"&&(w=50);var M=new h(w),k=M.encode(m,w);return{data:k,width:m.width,height:m.height}}})(encoder$1);var decoder$1={exports:{}};(function(d){var h=function(){var w=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),M=4017,k=799,x=3406,L=2276,B=1567,$=3784,U=5793,q=2896;function G(){}function W(ge,Re){for(var ve=0,de=[],Se,ce,ye=16;ye>0&&!ge[ye-1];)ye--;de.push({children:[],index:0});var ze=de[0],Xe;for(Se=0;Se<ye;Se++){for(ce=0;ce<ge[Se];ce++){for(ze=de.pop(),ze.children[ze.index]=Re[ve];ze.index>0;){if(de.length===0)throw new Error("Could not recreate Huffman Table");ze=de.pop()}for(ze.index++,de.push(ze);de.length<=Se;)de.push(Xe={children:[],index:0}),ze.children[ze.index]=Xe.children,ze=Xe;ve++}Se+1<ye&&(de.push(Xe={children:[],index:0}),ze.children[ze.index]=Xe.children,ze=Xe)}return de[0].children}function te(ge,Re,ve,de,Se,ce,ye,ze,Xe,at){ve.precision,ve.samplesPerLine,ve.scanLines;var ct=ve.mcusPerLine,Bt=ve.progressive;ve.maxH,ve.maxV;var Lt=Re,It=0,Vt=0;function Ft(){if(Vt>0)return Vt--,It>>Vt&1;if(It=ge[Re++],It==255){var qt=ge[Re++];if(qt)throw new Error("unexpected marker: "+(It<<8|qt).toString(16))}return Vt=7,It>>>7}function Mt(qt){for(var Zt=qt,kt;(kt=Ft())!==null;){if(Zt=Zt[kt],typeof Zt=="number")return Zt;if(typeof Zt!="object")throw new Error("invalid huffman sequence")}return null}function ri(qt){for(var Zt=0;qt>0;){var kt=Ft();if(kt===null)return;Zt=Zt<<1|kt,qt--}return Zt}function St(qt){var Zt=ri(qt);return Zt>=1<<qt-1?Zt:Zt+(-1<<qt)+1}function At(qt,Zt){var kt=Mt(qt.huffmanTableDC),ci=kt===0?0:St(kt);Zt[0]=qt.pred+=ci;for(var vi=1;vi<64;){var Ti=Mt(qt.huffmanTableAC),ei=Ti&15,hi=Ti>>4;if(ei===0){if(hi<15)break;vi+=16;continue}vi+=hi;var Ni=w[vi];Zt[Ni]=St(ei),vi++}}function Et(qt,Zt){var kt=Mt(qt.huffmanTableDC),ci=kt===0?0:St(kt)<<Xe;Zt[0]=qt.pred+=ci}function Ut(qt,Zt){Zt[0]|=Ft()<<Xe}var jt=0;function mi(qt,Zt){if(jt>0){jt--;return}for(var kt=ce,ci=ye;kt<=ci;){var vi=Mt(qt.huffmanTableAC),Ti=vi&15,ei=vi>>4;if(Ti===0){if(ei<15){jt=ri(ei)+(1<<ei)-1;break}kt+=16;continue}kt+=ei;var hi=w[kt];Zt[hi]=St(Ti)*(1<<Xe),kt++}}var oi=0,yi;function xi(qt,Zt){for(var kt=ce,ci=ye,vi=0;kt<=ci;){var Ti=w[kt],ei=Zt[Ti]<0?-1:1;switch(oi){case 0:var hi=Mt(qt.huffmanTableAC),Ni=hi&15,vi=hi>>4;if(Ni===0)vi<15?(jt=ri(vi)+(1<<vi),oi=4):(vi=16,oi=1);else{if(Ni!==1)throw new Error("invalid ACn encoding");yi=St(Ni),oi=vi?2:3}continue;case 1:case 2:Zt[Ti]?Zt[Ti]+=(Ft()<<Xe)*ei:(vi--,vi===0&&(oi=oi==2?3:0));break;case 3:Zt[Ti]?Zt[Ti]+=(Ft()<<Xe)*ei:(Zt[Ti]=yi<<Xe,oi=0);break;case 4:Zt[Ti]&&(Zt[Ti]+=(Ft()<<Xe)*ei);break}kt++}oi===4&&(jt--,jt===0&&(oi=0))}function Bi(qt,Zt,kt,ci,vi){var Ti=kt/ct|0,ei=kt%ct,hi=Ti*qt.v+ci,Ni=ei*qt.h+vi;qt.blocks[hi]===void 0&&at.tolerantDecoding||Zt(qt,qt.blocks[hi][Ni])}function fi(qt,Zt,kt){var ci=kt/qt.blocksPerLine|0,vi=kt%qt.blocksPerLine;qt.blocks[ci]===void 0&&at.tolerantDecoding||Zt(qt,qt.blocks[ci][vi])}var mt=de.length,vt,pi,si,We,Wt,Rt;Bt?ce===0?Rt=ze===0?Et:Ut:Rt=ze===0?mi:xi:Rt=At;var ti=0,ni,bt;mt==1?bt=de[0].blocksPerLine*de[0].blocksPerColumn:bt=ct*ve.mcusPerColumn,Se||(Se=bt);for(var Pi,Kt;ti<bt;){for(pi=0;pi<mt;pi++)de[pi].pred=0;if(jt=0,mt==1)for(vt=de[0],Wt=0;Wt<Se;Wt++)fi(vt,Rt,ti),ti++;else for(Wt=0;Wt<Se;Wt++){for(pi=0;pi<mt;pi++)for(vt=de[pi],Pi=vt.h,Kt=vt.v,si=0;si<Kt;si++)for(We=0;We<Pi;We++)Bi(vt,Rt,ti,si,We);if(ti++,ti===bt)break}if(ti===bt)do{if(ge[Re]===255&&ge[Re+1]!==0)break;Re+=1}while(Re<ge.length-2);if(Vt=0,ni=ge[Re]<<8|ge[Re+1],ni<65280)throw new Error("marker was not found");if(ni>=65488&&ni<=65495)Re+=2;else break}return Re-Lt}function oe(ge,Re){var ve=[],de=Re.blocksPerLine,Se=Re.blocksPerColumn,ce=de<<3,ye=new Int32Array(64),ze=new Uint8Array(64);function Xe(ri,St,At){var Et=Re.quantizationTable,Ut,jt,mi,oi,yi,xi,Bi,fi,mt,vt=At,pi;for(pi=0;pi<64;pi++)vt[pi]=ri[pi]*Et[pi];for(pi=0;pi<8;++pi){var si=8*pi;if(vt[1+si]==0&&vt[2+si]==0&&vt[3+si]==0&&vt[4+si]==0&&vt[5+si]==0&&vt[6+si]==0&&vt[7+si]==0){mt=U*vt[0+si]+512>>10,vt[0+si]=mt,vt[1+si]=mt,vt[2+si]=mt,vt[3+si]=mt,vt[4+si]=mt,vt[5+si]=mt,vt[6+si]=mt,vt[7+si]=mt;continue}Ut=U*vt[0+si]+128>>8,jt=U*vt[4+si]+128>>8,mi=vt[2+si],oi=vt[6+si],yi=q*(vt[1+si]-vt[7+si])+128>>8,fi=q*(vt[1+si]+vt[7+si])+128>>8,xi=vt[3+si]<<4,Bi=vt[5+si]<<4,mt=Ut-jt+1>>1,Ut=Ut+jt+1>>1,jt=mt,mt=mi*$+oi*B+128>>8,mi=mi*B-oi*$+128>>8,oi=mt,mt=yi-Bi+1>>1,yi=yi+Bi+1>>1,Bi=mt,mt=fi+xi+1>>1,xi=fi-xi+1>>1,fi=mt,mt=Ut-oi+1>>1,Ut=Ut+oi+1>>1,oi=mt,mt=jt-mi+1>>1,jt=jt+mi+1>>1,mi=mt,mt=yi*L+fi*x+2048>>12,yi=yi*x-fi*L+2048>>12,fi=mt,mt=xi*k+Bi*M+2048>>12,xi=xi*M-Bi*k+2048>>12,Bi=mt,vt[0+si]=Ut+fi,vt[7+si]=Ut-fi,vt[1+si]=jt+Bi,vt[6+si]=jt-Bi,vt[2+si]=mi+xi,vt[5+si]=mi-xi,vt[3+si]=oi+yi,vt[4+si]=oi-yi}for(pi=0;pi<8;++pi){var We=pi;if(vt[8+We]==0&&vt[16+We]==0&&vt[24+We]==0&&vt[32+We]==0&&vt[40+We]==0&&vt[48+We]==0&&vt[56+We]==0){mt=U*At[pi+0]+8192>>14,vt[0+We]=mt,vt[8+We]=mt,vt[16+We]=mt,vt[24+We]=mt,vt[32+We]=mt,vt[40+We]=mt,vt[48+We]=mt,vt[56+We]=mt;continue}Ut=U*vt[0+We]+2048>>12,jt=U*vt[32+We]+2048>>12,mi=vt[16+We],oi=vt[48+We],yi=q*(vt[8+We]-vt[56+We])+2048>>12,fi=q*(vt[8+We]+vt[56+We])+2048>>12,xi=vt[24+We],Bi=vt[40+We],mt=Ut-jt+1>>1,Ut=Ut+jt+1>>1,jt=mt,mt=mi*$+oi*B+2048>>12,mi=mi*B-oi*$+2048>>12,oi=mt,mt=yi-Bi+1>>1,yi=yi+Bi+1>>1,Bi=mt,mt=fi+xi+1>>1,xi=fi-xi+1>>1,fi=mt,mt=Ut-oi+1>>1,Ut=Ut+oi+1>>1,oi=mt,mt=jt-mi+1>>1,jt=jt+mi+1>>1,mi=mt,mt=yi*L+fi*x+2048>>12,yi=yi*x-fi*L+2048>>12,fi=mt,mt=xi*k+Bi*M+2048>>12,xi=xi*M-Bi*k+2048>>12,Bi=mt,vt[0+We]=Ut+fi,vt[56+We]=Ut-fi,vt[8+We]=jt+Bi,vt[48+We]=jt-Bi,vt[16+We]=mi+xi,vt[40+We]=mi-xi,vt[24+We]=oi+yi,vt[32+We]=oi-yi}for(pi=0;pi<64;++pi){var Wt=128+(vt[pi]+8>>4);St[pi]=Wt<0?0:Wt>255?255:Wt}}he(ce*Se*8);for(var at,ct,Bt=0;Bt<Se;Bt++){var Lt=Bt<<3;for(at=0;at<8;at++)ve.push(new Uint8Array(ce));for(var It=0;It<de;It++){Xe(Re.blocks[Bt][It],ze,ye);var Vt=0,Ft=It<<3;for(ct=0;ct<8;ct++){var Mt=ve[Lt+ct];for(at=0;at<8;at++)Mt[Ft+at]=ze[Vt++]}}}return ve}function ee(ge){return ge<0?0:ge>255?255:ge}G.prototype={load:function(Re){var ve=new XMLHttpRequest;ve.open("GET",Re,!0),ve.responseType="arraybuffer",ve.onload=function(){var de=new Uint8Array(ve.response||ve.mozResponseArrayBuffer);this.parse(de),this.onload&&this.onload()}.bind(this),ve.send(null)},parse:function(Re){var ve=this.opts.maxResolutionInMP*1e3*1e3,de=0;Re.length;function Se(){var ei=Re[de]<<8|Re[de+1];return de+=2,ei}function ce(){var ei=Se(),hi=Re.subarray(de,de+ei-2);return de+=hi.length,hi}function ye(ei){var hi=0,Ni=0,Ai,Xi;for(Xi in ei.components)ei.components.hasOwnProperty(Xi)&&(Ai=ei.components[Xi],hi<Ai.h&&(hi=Ai.h),Ni<Ai.v&&(Ni=Ai.v));var Ii=Math.ceil(ei.samplesPerLine/8/hi),fr=Math.ceil(ei.scanLines/8/Ni);for(Xi in ei.components)if(ei.components.hasOwnProperty(Xi)){Ai=ei.components[Xi];var sn=Math.ceil(Math.ceil(ei.samplesPerLine/8)*Ai.h/hi),pr=Math.ceil(Math.ceil(ei.scanLines/8)*Ai.v/Ni),Br=Ii*Ai.h,Lr=fr*Ai.v,Tr=Lr*Br,br=[];he(Tr*256);for(var Nr=0;Nr<Lr;Nr++){for(var Sr=[],Me=0;Me<Br;Me++)Sr.push(new Int32Array(64));br.push(Sr)}Ai.blocksPerLine=sn,Ai.blocksPerColumn=pr,Ai.blocks=br}ei.maxH=hi,ei.maxV=Ni,ei.mcusPerLine=Ii,ei.mcusPerColumn=fr}var ze=null,Xe=null,at,ct,Bt=[],Lt=[],It=[],Vt=[],Ft=Se(),Mt=-1;if(this.comments=[],Ft!=65496)throw new Error("SOI not found");for(Ft=Se();Ft!=65497;){var ri,St;switch(Ft){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var At=ce();if(Ft===65534){var Et=String.fromCharCode.apply(null,At);this.comments.push(Et)}Ft===65504&&At[0]===74&&At[1]===70&&At[2]===73&&At[3]===70&&At[4]===0&&(ze={version:{major:At[5],minor:At[6]},densityUnits:At[7],xDensity:At[8]<<8|At[9],yDensity:At[10]<<8|At[11],thumbWidth:At[12],thumbHeight:At[13],thumbData:At.subarray(14,14+3*At[12]*At[13])}),Ft===65505&&At[0]===69&&At[1]===120&&At[2]===105&&At[3]===102&&At[4]===0&&(this.exifBuffer=At.subarray(5,At.length)),Ft===65518&&At[0]===65&&At[1]===100&&At[2]===111&&At[3]===98&&At[4]===101&&At[5]===0&&(Xe={version:At[6],flags0:At[7]<<8|At[8],flags1:At[9]<<8|At[10],transformCode:At[11]});break;case 65499:for(var Ut=Se(),jt=Ut+de-2;de<jt;){var mi=Re[de++];he(256);var oi=new Int32Array(64);if(mi>>4===0)for(St=0;St<64;St++){var yi=w[St];oi[yi]=Re[de++]}else if(mi>>4===1)for(St=0;St<64;St++){var yi=w[St];oi[yi]=Se()}else throw new Error("DQT: invalid table spec");Bt[mi&15]=oi}break;case 65472:case 65473:case 65474:Se(),at={},at.extended=Ft===65473,at.progressive=Ft===65474,at.precision=Re[de++],at.scanLines=Se(),at.samplesPerLine=Se(),at.components={},at.componentsOrder=[];var xi=at.scanLines*at.samplesPerLine;if(xi>ve){var Bi=Math.ceil((xi-ve)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Bi}MP`)}var fi=Re[de++],mt;for(ri=0;ri<fi;ri++){mt=Re[de];var vt=Re[de+1]>>4,pi=Re[de+1]&15,si=Re[de+2];at.componentsOrder.push(mt),at.components[mt]={h:vt,v:pi,quantizationIdx:si},de+=3}ye(at),Lt.push(at);break;case 65476:var We=Se();for(ri=2;ri<We;){var Wt=Re[de++],Rt=new Uint8Array(16),ti=0;for(St=0;St<16;St++,de++)ti+=Rt[St]=Re[de];he(16+ti);var ni=new Uint8Array(ti);for(St=0;St<ti;St++,de++)ni[St]=Re[de];ri+=17+ti,(Wt>>4===0?Vt:It)[Wt&15]=W(Rt,ni)}break;case 65501:Se(),ct=Se();break;case 65500:Se(),Se();break;case 65498:Se();var bt=Re[de++],Pi=[],Kt;for(ri=0;ri<bt;ri++){Kt=at.components[Re[de++]];var qt=Re[de++];Kt.huffmanTableDC=Vt[qt>>4],Kt.huffmanTableAC=It[qt&15],Pi.push(Kt)}var Zt=Re[de++],kt=Re[de++],ci=Re[de++],vi=te(Re,de,at,Pi,ct,Zt,kt,ci>>4,ci&15,this.opts);de+=vi;break;case 65535:Re[de]!==255&&de--;break;default:if(Re[de-3]==255&&Re[de-2]>=192&&Re[de-2]<=254){de-=3;break}else if(Ft===224||Ft==225){if(Mt!==-1)throw new Error(`first unknown JPEG marker at offset ${Mt.toString(16)}, second unknown JPEG marker ${Ft.toString(16)} at offset ${(de-1).toString(16)}`);Mt=de-1;const ei=Se();if(Re[de+ei-2]===255){de+=ei-2;break}}throw new Error("unknown JPEG marker "+Ft.toString(16))}Ft=Se()}if(Lt.length!=1)throw new Error("only single frame JPEGs supported");for(var ri=0;ri<Lt.length;ri++){var Ti=Lt[ri].components;for(var St in Ti)Ti[St].quantizationTable=Bt[Ti[St].quantizationIdx],delete Ti[St].quantizationIdx}this.width=at.samplesPerLine,this.height=at.scanLines,this.jfif=ze,this.adobe=Xe,this.components=[];for(var ri=0;ri<at.componentsOrder.length;ri++){var Kt=at.components[at.componentsOrder[ri]];this.components.push({lines:oe(at,Kt),scaleX:Kt.h/at.maxH,scaleY:Kt.v/at.maxV})}},getData:function(Re,ve){var de=this.width/Re,Se=this.height/ve,ce,ye,ze,Xe,at,ct,Bt,Lt,It,Vt,Ft=0,Mt,ri,St,At,Et,Ut,jt,mi,oi,yi,xi,Bi=Re*ve*this.components.length;he(Bi);var fi=new Uint8Array(Bi);switch(this.components.length){case 1:for(ce=this.components[0],Vt=0;Vt<ve;Vt++)for(at=ce.lines[0|Vt*ce.scaleY*Se],It=0;It<Re;It++)Mt=at[0|It*ce.scaleX*de],fi[Ft++]=Mt;break;case 2:for(ce=this.components[0],ye=this.components[1],Vt=0;Vt<ve;Vt++)for(at=ce.lines[0|Vt*ce.scaleY*Se],ct=ye.lines[0|Vt*ye.scaleY*Se],It=0;It<Re;It++)Mt=at[0|It*ce.scaleX*de],fi[Ft++]=Mt,Mt=ct[0|It*ye.scaleX*de],fi[Ft++]=Mt;break;case 3:for(xi=!0,this.adobe&&this.adobe.transformCode?xi=!0:typeof this.opts.colorTransform!="undefined"&&(xi=!!this.opts.colorTransform),ce=this.components[0],ye=this.components[1],ze=this.components[2],Vt=0;Vt<ve;Vt++)for(at=ce.lines[0|Vt*ce.scaleY*Se],ct=ye.lines[0|Vt*ye.scaleY*Se],Bt=ze.lines[0|Vt*ze.scaleY*Se],It=0;It<Re;It++)xi?(Mt=at[0|It*ce.scaleX*de],ri=ct[0|It*ye.scaleX*de],St=Bt[0|It*ze.scaleX*de],mi=ee(Mt+1.402*(St-128)),oi=ee(Mt-.3441363*(ri-128)-.71413636*(St-128)),yi=ee(Mt+1.772*(ri-128))):(mi=at[0|It*ce.scaleX*de],oi=ct[0|It*ye.scaleX*de],yi=Bt[0|It*ze.scaleX*de]),fi[Ft++]=mi,fi[Ft++]=oi,fi[Ft++]=yi;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(xi=!1,this.adobe&&this.adobe.transformCode?xi=!0:typeof this.opts.colorTransform!="undefined"&&(xi=!!this.opts.colorTransform),ce=this.components[0],ye=this.components[1],ze=this.components[2],Xe=this.components[3],Vt=0;Vt<ve;Vt++)for(at=ce.lines[0|Vt*ce.scaleY*Se],ct=ye.lines[0|Vt*ye.scaleY*Se],Bt=ze.lines[0|Vt*ze.scaleY*Se],Lt=Xe.lines[0|Vt*Xe.scaleY*Se],It=0;It<Re;It++)xi?(Mt=at[0|It*ce.scaleX*de],ri=ct[0|It*ye.scaleX*de],St=Bt[0|It*ze.scaleX*de],At=Lt[0|It*Xe.scaleX*de],Et=255-ee(Mt+1.402*(St-128)),Ut=255-ee(Mt-.3441363*(ri-128)-.71413636*(St-128)),jt=255-ee(Mt+1.772*(ri-128))):(Et=at[0|It*ce.scaleX*de],Ut=ct[0|It*ye.scaleX*de],jt=Bt[0|It*ze.scaleX*de],At=Lt[0|It*Xe.scaleX*de]),fi[Ft++]=255-Et,fi[Ft++]=255-Ut,fi[Ft++]=255-jt,fi[Ft++]=255-At;break;default:throw new Error("Unsupported color mode")}return fi},copyToImageData:function(Re,ve){var de=Re.width,Se=Re.height,ce=Re.data,ye=this.getData(de,Se),ze=0,Xe=0,at,ct,Bt,Lt,It,Vt,Ft,Mt,ri;switch(this.components.length){case 1:for(ct=0;ct<Se;ct++)for(at=0;at<de;at++)Bt=ye[ze++],ce[Xe++]=Bt,ce[Xe++]=Bt,ce[Xe++]=Bt,ve&&(ce[Xe++]=255);break;case 3:for(ct=0;ct<Se;ct++)for(at=0;at<de;at++)Ft=ye[ze++],Mt=ye[ze++],ri=ye[ze++],ce[Xe++]=Ft,ce[Xe++]=Mt,ce[Xe++]=ri,ve&&(ce[Xe++]=255);break;case 4:for(ct=0;ct<Se;ct++)for(at=0;at<de;at++)It=ye[ze++],Vt=ye[ze++],Bt=ye[ze++],Lt=ye[ze++],Ft=255-ee(It*(1-Lt/255)+Lt),Mt=255-ee(Vt*(1-Lt/255)+Lt),ri=255-ee(Bt*(1-Lt/255)+Lt),ce[Xe++]=Ft,ce[Xe++]=Mt,ce[Xe++]=ri,ve&&(ce[Xe++]=255);break;default:throw new Error("Unsupported color mode")}}};var _e=0,se=0;function he(ge=0){var Re=_e+ge;if(Re>se){var ve=Math.ceil((Re-se)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ve}MB`)}_e=Re}return G.resetMaxMemoryUsage=function(ge){_e=0,se=ge},G.getBytesAllocated=function(){return _e},G.requestMemoryAllocation=he,G}();d.exports=p;function p(m,w={}){var M={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},k=Su(Su({},M),w),x=new Uint8Array(m),L=new h;L.opts=k,h.resetMaxMemoryUsage(k.maxMemoryUsageInMB*1024*1024),L.parse(x);var B=k.formatAsRGBA?4:3,$=L.width*L.height*B;try{h.requestMemoryAllocation($);var U={width:L.width,height:L.height,exifBuffer:L.exifBuffer,data:k.useTArray?new Uint8Array($):Buffer.alloc($)};L.comments.length>0&&(U.comments=L.comments)}catch(q){throw q instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+$):q}return L.copyToImageData(U,k.formatAsRGBA),U}})(decoder$1);var encode$2=encoder$1.exports,decode$5=decoder$1.exports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let d=0;d<chars.length;d++)lookup[chars.charCodeAt(d)]=d;function encode$1(d){let h,p=d.length,m="";for(h=0;h<p;h+=3)m+=chars[d[h]>>2],m+=chars[(d[h]&3)<<4|d[h+1]>>4],m+=chars[(d[h+1]&15)<<2|d[h+2]>>6],m+=chars[d[h+2]&63];return p%3===2?m=`${m.substring(0,m.length-1)}=`:p%3===1&&(m=`${m.substring(0,m.length-2)}==`),m}function decode$4(d){let h=d.length*.75,p=d.length,m=0,w,M,k,x;d[d.length-1]==="="&&(h--,d[d.length-2]==="="&&h--);const L=new Uint8Array(h);for(let B=0;B<p;B+=4)w=lookup[d.charCodeAt(B)],M=lookup[d.charCodeAt(B+1)],k=lookup[d.charCodeAt(B+2)],x=lookup[d.charCodeAt(B+3)],L[m++]=w<<2|M>>4,L[m++]=(M&15)<<4|k>>2,L[m++]=(k&3)<<6|x&63;return L}function toBase64URL(d,h){const p=encode$1(d);return`data:${h};base64,${p}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(d,h){let p=self.document.createElement("canvas");return p.width=d,p.height=h,p}function fetchBinary(d,{withCredentials:h=!1}={}){return new Promise(function(p,m){let w=new self.XMLHttpRequest;w.open("GET",d,!0),w.responseType="arraybuffer",w.withCredentials=h,w.onload=function(M){this.status!==200?m(M):p(this.response)},w.onerror=m,w.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(d){return d.includes("/")||(d=`image/${d}`),d}function encodeJpeg(d,h={}){const p={width:d.width,height:d.height,data:d.getRGBAData()};return jpegJs.encode(p,h.quality).data}function encodePng(d,h){const p={width:d.width,height:d.height,channels:d.channels,depth:d.bitDepth,data:d.data};return(p.depth===1||p.depth===32)&&(p.depth=8,p.channels=4,p.data=d.getRGBAData()),encodePng$1(p,h)}const exportMethods={save(d,h={}){const{useCanvas:p=!1,encoder:m=void 0}=h;let{format:w}=h;if(!w){const M=/\.(?<format>[a-zA-Z]+)$/.exec(d);M&&(w=M.groups.format.toLowerCase())}if(!w)throw new Error("file format not provided");return new Promise((M,k)=>{let x,L;switch(w.toLowerCase()){case"png":{p?x=this.getCanvas().pngStream():L=encodePng(this,m);break}case"jpg":case"jpeg":p?x=this.getCanvas().jpegStream():L=encodeJpeg(this,m);break;case"bmp":L=encode$4(this,m);break;default:throw new RangeError(`invalid output format: ${w}`)}if(x){let B=createWriteStream();B.on("finish",M),B.on("error",k),x.pipe(B)}else L&&writeFile()})},toDataURL(d="image/png",h={}){typeof d=="object"&&(h=d,d="image/png");const{useCanvas:p=!1,encoder:m=void 0}=h;d=getType(d);function w(M,k){const x=M(k,m);return toBase64URL(x,d)}return d==="image/bmp"?w(encode$4,this):d==="image/png"&&!p?w(encodePng,this):d==="image/jpeg"&&!p?w(encodeJpeg,this):this.getCanvas().toDataURL(d)},toBuffer(d={}){const{format:h="png",encoder:p=void 0}=d;switch(h.toLowerCase()){case"png":return encodePng(this,p);case"jpeg":case"jpg":return encodeJpeg(this,p);case"bmp":return encode$4(this,p);default:throw new RangeError(`invalid output format: ${h}`)}},toBase64(d="image/png",h={}){if(h.async)return this.toDataURL(d,h).then(function(p){return p.substring(p.indexOf(",")+1)});{const p=this.toDataURL(d,h);return p.substring(p.indexOf(",")+1)}},toBlob(d="image/png",h=.8){return canvasToBlob(this.getCanvas(),d,h)},getCanvas(){const d=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let h=createCanvas(this.width,this.height);return h.getContext("2d").putImageData(d,0,0),h}};function setExportMethods(d){for(const h in exportMethods)d.prototype[h]=exportMethods[h]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"};var require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(d,h){var p=Object.prototype.hasOwnProperty;d.exports=h=function(w,M){return p.call(M,w)},h.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwn=hasOwn$1.exports;let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(d,h,p={}){let{inPlace:m=!1,returnThis:w=!0,partialArgs:M=[]}=p;return m?Image$1.prototype[d]=function(...k){this.computed=null;let x=h.apply(this,[...M,...k]);return w?this:x}:Image$1.prototype[d]=function(...k){return h.apply(this,[...M,...k])},Image$1}function extendProperty(d,h,p={}){let{partialArgs:m=[]}=p;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(d,this.computed))return this.computed[d];let w=h.apply(this,m);return this.computed[d]=w,w},Object.defineProperty(Image$1.prototype,d,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK";var ColorModel=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",GREY:GREY$1,RGB:RGB$1,HSL,HSV,CMYK:CMYK$1});function getRGBAData(d={}){const{clamped:h}=d;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const p=this.width*this.height*4;let m=h?new Uint8ClampedArray(p):new Uint8Array(p);return this.bitDepth===1?fillDataFromBinary(this,m):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,m):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,m))):this.components===1?fillDataFromGrey(this,m):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,m)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,m)):fillAlpha(this,m),m}function fillDataFromBinary(d,h){for(let p=0;p<d.size;p++){const m=d.getBit(p);h[p*4]=m*255,h[p*4+1]=m*255,h[p*4+2]=m*255}}function fillDataFromGrey32(d,h){const p=d.min[0],w=d.max[0]-p;for(let M=0;M<d.size;M++){const k=Math.floor(255*(d.data[M]-p)/w);h[M*4]=k,h[M*4+1]=k,h[M*4+2]=k}}function fillDataFromRGB32(d,h){const p=Math.min(...d.min),w=Math.max(...d.max)-p;for(let M=0;M<d.size;M++){const k=Math.floor(255*(d.data[M*3]-p)/w),x=Math.floor(255*(d.data[M*3+1]-p)/w),L=Math.floor(255*(d.data[M*3+2]-p)/w);h[M*4]=k,h[M*4+1]=x,h[M*4+2]=L}}function fillDataFromGrey(d,h){for(let p=0;p<d.size;p++)h[p*4]=d.data[p*d.channels]>>>d.bitDepth-8,h[p*4+1]=d.data[p*d.channels]>>>d.bitDepth-8,h[p*4+2]=d.data[p*d.channels]>>>d.bitDepth-8}function fillDataFromRGB(d,h){for(let p=0;p<d.size;p++)h[p*4]=d.data[p*d.channels]>>>d.bitDepth-8,h[p*4+1]=d.data[p*d.channels+1]>>>d.bitDepth-8,h[p*4+2]=d.data[p*d.channels+2]>>>d.bitDepth-8}function copyAlpha(d,h){for(let p=0;p<d.size;p++)h[p*4+3]=d.data[p*d.channels+d.components]>>d.bitDepth-8}function fillAlpha(d,h){for(let p=0;p<d.size;p++)h[p*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(d){const h=kinds[d];if(!h)throw new RangeError(`invalid image kind: ${d}`);return h}const validBitDepth=[1,8,16,32];function verifyKindDefinition(d){const{components:h,alpha:p,bitDepth:m,colorModel:w}=d;if(!Number.isInteger(h)||h<=0)throw new RangeError(`invalid components: ${h}. Must be a positive integer`);if(p!==0&&p!==1&&typeof p!="boolean")throw new TypeError(`invalid alpha: ${p}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(m))throw new RangeError(`invalid bitDepth: ${m}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[w])throw new RangeError(`invalid colorModel: ${w}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(d,h,p){let m=h*d;return p===1&&(m=Math.ceil(m/8)),m}function createPixelArray(d,h,p,m,w,M){const k=m*d;let x;switch(w){case 1:x=new Uint8Array(Math.ceil(k/8));break;case 8:x=new Uint8Array(k);break;case 16:x=new Uint16Array(k);break;case 32:x=new Float32Array(k);break;default:throw new Error(`Cannot create pixel array for bit depth ${w}`)}if(p)for(let L=h;L<x.length;L+=m)x[L]=M;return x}const defaultByteLength$1=1024*8,charArray=[];class IOBuffer$3{constructor(h,p){p=p||{},h===void 0&&(h=defaultByteLength$1),typeof h=="number"&&(h=new ArrayBuffer(h));let m=h.byteLength;const w=p.offset?p.offset>>>0:0;h.buffer&&(m=h.byteLength-w,h.byteLength!==h.buffer.byteLength?h=h.buffer.slice(h.byteOffset+w,h.byteOffset+h.byteLength):w?h=h.buffer.slice(w):h=h.buffer),this.buffer=h,this.length=m,this.byteLength=m,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=m||defaultByteLength$1,this._mark=0}available(h){return h===void 0&&(h=1),this.offset+h<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(h){h===void 0&&(h=1),this.offset+=h}seek(h){this.offset=h}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(h){if(h===void 0&&(h=1),!this.available(h)){const p=this._increment+this._increment;this._increment=p;const m=this.length+p,w=new Uint8Array(m);w.set(new Uint8Array(this.buffer)),this.buffer=w.buffer,this.length=m,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(h){h===void 0&&(h=1);for(var p=new Uint8Array(h),m=0;m<h;m++)p[m]=this.readByte();return p}readInt16(){var h=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,h}readUint16(){var h=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,h}readInt32(){var h=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,h}readUint32(){var h=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat32(){var h=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat64(){var h=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,h}readChar(){return String.fromCharCode(this.readInt8())}readChars(h){h===void 0&&(h=1),charArray.length=h;for(var p=0;p<h;p++)charArray[p]=this.readChar();return charArray.join("")}writeBoolean(h){this.writeUint8(h?255:0)}writeInt8(h){this.ensureAvailable(1),this._data.setInt8(this.offset++,h)}writeUint8(h){this.ensureAvailable(1),this._data.setUint8(this.offset++,h)}writeByte(h){this.writeUint8(h)}writeBytes(h){this.ensureAvailable(h.length);for(var p=0;p<h.length;p++)this._data.setUint8(this.offset++,h[p])}writeInt16(h){this.ensureAvailable(2),this._data.setInt16(this.offset,h,this.littleEndian),this.offset+=2}writeUint16(h){this.ensureAvailable(2),this._data.setUint16(this.offset,h,this.littleEndian),this.offset+=2}writeInt32(h){this.ensureAvailable(4),this._data.setInt32(this.offset,h,this.littleEndian),this.offset+=4}writeUint32(h){this.ensureAvailable(4),this._data.setUint32(this.offset,h,this.littleEndian),this.offset+=4}writeFloat32(h){this.ensureAvailable(4),this._data.setFloat32(this.offset,h,this.littleEndian),this.offset+=4}writeFloat64(h){this.ensureAvailable(8),this._data.setFloat64(this.offset,h,this.littleEndian),this.offset+=8}writeChar(h){this.writeUint8(h.charCodeAt(0))}writeChars(h){for(var p=0;p<h.length;p++)this.writeUint8(h.charCodeAt(p))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1=IOBuffer$3,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$4 in tagsById$5)tagsByName$5[tagsById$5[i$4]]=i$4;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$3 in tagsById$4)tagsByName$4[tagsById$4[i$3]]=i$3;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i$2 in tagsById$3)tagsByName$3[tagsById$3[i$2]]=i$2;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$2{constructor(h){if(!h)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=h,this._map=null}get(h){if(typeof h=="number")return this.fields.get(h);if(typeof h=="string")return this.fields.get(tags$1[this.kind].tagsByName[h]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const p=tags$1[this.kind].tagsById;for(var h of this.fields.keys())p[h]&&(this._map[p[h]]=this.fields.get(h))}return this._map}}var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var h=new Date,p=dateTimeRegex$1.exec(this.dateTime);return h.setFullYear(p[1],p[2]-1,p[3]),h.setHours(p[4],p[5],p[6]),h}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray$1(d){return typeof d=="number"?[d]:d}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(d,h){return types$1.get(d)[0]*h};ifdValue.readData=function(d,h,p){return types$1.get(h)[1](d,p)};function readByte$1(d,h){if(h===1)return d.readUint8();for(var p=new Uint8Array(h),m=0;m<h;m++)p[m]=d.readUint8();return p}function readASCII$1(d,h){for(var p=[],m="",w=0;w<h;w++){var M=String.fromCharCode(d.readUint8());M==="\0"?(p.push(m),m=""):m+=M}return p.length===1?p[0]:p}function readShort$1(d,h){if(h===1)return d.readUint16();for(var p=new Uint16Array(h),m=0;m<h;m++)p[m]=d.readUint16();return p}function readLong$1(d,h){if(h===1)return d.readUint32();for(var p=new Uint32Array(h),m=0;m<h;m++)p[m]=d.readUint32();return p}function readRational$1(d,h){if(h===1)return d.readUint32()/d.readUint32();for(var p=new Array(h),m=0;m<h;m++)p[m]=d.readUint32()/d.readUint32();return p}function readSByte$1(d,h){if(h===1)return d.readInt8();for(var p=new Int8Array(h),m=0;m<h;m++)p[m]=d.readInt8();return p}function readSShort$1(d,h){if(h===1)return d.readInt16();for(var p=new Int16Array(h),m=0;m<h;m++)p[m]=d.readInt16();return p}function readSLong$1(d,h){if(h===1)return d.readInt32();for(var p=new Int32Array(h),m=0;m<h;m++)p[m]=d.readInt32();return p}function readSRational$1(d,h){if(h===1)return d.readInt32()/d.readInt32();for(var p=new Array(h),m=0;m<h;m++)p[m]=d.readInt32()/d.readInt32();return p}function readFloat$1(d,h){if(h===1)return d.readFloat32();for(var p=new Float32Array(h),m=0;m<h;m++)p[m]=d.readFloat32();return p}function readDouble$1(d,h){if(h===1)return d.readFloat64();for(var p=new Float64Array(h),m=0;m<h;m++)p[m]=d.readFloat64();return p}const IOBuffer$2=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$2 extends IOBuffer$2{constructor(h,p){super(h,p);this._nextIFD=0}decode(h){h=Object.assign({},defaultOptions$d,h);const p=[];for(this.decodeHeader();this._nextIFD;)if(p.push(this.decodeIFD(h)),h.onlyFirst)return p[0];return p}decodeHeader(){let h=this.readUint16();if(h===18761)this.setLittleEndian();else if(h===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+h.toString(16));if(h=this.readUint16(),h!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(h){this.seek(this._nextIFD);var p;h.kind?p=new IFD$1(h.kind):p=new TiffIFD;const m=this.readUint16();for(var w=0;w<m;w++)this.decodeIFDEntry(p);return h.ignoreImageData||this.decodeImageData(p),this._nextIFD=this.readUint32(),p}decodeIFDEntry(h){const p=this.offset,m=this.readUint16(),w=this.readUint16(),M=this.readUint32();if(w<1||w>12){this.skip(4);return}IFDValue.getByteLength(w,M)>4&&this.seek(this.readUint32());const x=IFDValue.readData(this,w,M);if(h.fields.set(m,x),m===34665||m===34853){let L=this.offset,B;m===34665?B="exif":m===34853&&(B="gps"),this._nextIFD=x,h[B]=this.decodeIFD({kind:B,ignoreImageData:!0}),this.offset=L}this.seek(p),this.skip(12)}decodeImageData(h){const p=h.orientation;switch(p&&p!==1&&unsupported$1("orientation",p),h.type){case 1:case 2:this.readStripData(h);break;default:unsupported$1("image type",h.type);break}}readStripData(h){const p=h.width,m=h.height,w=validateBitDepth(h.bitsPerSample),M=h.sampleFormat;let k=p*m;const x=getDataArray$1(k,1,w,M),L=h.compression,$=h.rowsPerStrip*p,U=h.stripOffsets,q=h.stripByteCounts;for(var G=0,W=0;W<U.length;W++){var te=this.getStripData(L,U[W],q[W]),oe=k>$?$:k;k-=oe,w===8?G=fill8bit$1(x,te,G,oe):w===16?G=fill16bit$1(x,te,G,oe,this.isLittleEndian()):w===32&&M===3?G=fillFloat32$1(x,te,G,oe,this.isLittleEndian()):unsupported$1("bitDepth",w)}h.data=x}getStripData(h,p,m){switch(h){case 1:return new DataView(this.buffer,p,m);case 2:case 32773:return unsupported$1("Compression",h);default:throw new Error("invalid compression: "+h)}}}var tiffDecoder=TIFFDecoder$2;function getDataArray$1(d,h,p,m){return p===8?new Uint8Array(d*h):p===16?new Uint16Array(d*h):p===32&&m===3?new Float32Array(d*h):unsupported$1("bit depth / sample format",p+" / "+m)}function fill8bit$1(d,h,p,m){for(var w=0;w<m;w++)d[p++]=h.getUint8(w);return p}function fill16bit$1(d,h,p,m,w){for(var M=0;M<m*2;M+=2)d[p++]=h.getUint16(M,w);return p}function fillFloat32$1(d,h,p,m,w){for(var M=0;M<m*4;M+=4)d[p++]=h.getFloat32(M,w);return p}function unsupported$1(d,h){throw new Error("Unsupported "+d+": "+h)}function validateBitDepth(d){if(d.length){const p=d;d=p[0];for(var h=0;h<p.length;h++)p[h]!==d&&unsupported$1("bit depth",p)}return d}const TIFFDecoder$1=tiffDecoder;var decode$3=function(h,p){return new TIFFDecoder$1(h,p).decode(p)};src$4.decode=decode$3;const IOBuffer$1=IOBuffer_1,tiff=src$4;function decode$2(d){const h=new IOBuffer$1(d),p={};if(h.setBigEndian(),h.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(h.readUint16()===65505){h.readUint16();const M=h.readBytes(6);if(M[0]===69&&M[1]===120&&M[2]===105&&M[3]===102&&M[4]===0&&M[5]===0){const k=tiff.decode(h,{onlyFirst:!0,ignoreImageData:!0,offset:h.offset});p.exif=k}}return p}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=d=>[...d].map(h=>h.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(d,h=0){let p=d[h],m=1,w=0;for(;++w<8;)m*=256,p+=d[h+w]*m;return p}const fileType=d=>{if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const h=d instanceof Uint8Array?d:new Uint8Array(d);if(!(h&&h.length>1))return null;const p=(w,M)=>{M=Object.assign({offset:0},M);for(let k=0;k<w.length;k++)if(M.mask){if(w[k]!==(M.mask[k]&h[k+M.offset]))return!1}else if(w[k]!==h[k+M.offset])return!1;return!0},m=(w,M)=>p(toBytes(w),M);if(p([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(p([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(p([71,73,70]))return{ext:"gif",mime:"image/gif"};if(p([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(p([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((p([73,73,42,0])||p([77,77,0,42]))&&p([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(p([73,73,42,0])||p([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(p([66,77]))return{ext:"bmp",mime:"image/bmp"};if(p([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(p([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(p([80,75,3,4])){if(p([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(p(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(m("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(m("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(m("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const w=(L,B=0)=>L.findIndex(($,U,q)=>U>=B&&q[U]===80&&q[U+1]===75&&q[U+2]===3&&q[U+3]===4);let M=0,k=!1,x=null;do{const L=M+30;if(k||(k=p(oxmlContentTypes,{offset:L})||p(oxmlRels,{offset:L})),x||(m("word/",{offset:L})?x={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:m("ppt/",{offset:L})?x={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:m("xl/",{offset:L})&&(x={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),k&&x)return x;M=w(h,L)}while(M>=0);if(x)return x}if(p([80,75])&&(h[2]===3||h[2]===5||h[2]===7)&&(h[3]===4||h[3]===6||h[3]===8))return{ext:"zip",mime:"application/zip"};if(p([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(p([82,97,114,33,26,7])&&(h[6]===0||h[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(p([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(p([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(p([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(p([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(p([51,103,112,53])||p([0,0,0])&&p([102,116,121,112],{offset:4})&&(p([109,112,52,49],{offset:8})||p([109,112,52,50],{offset:8})||p([105,115,111,109],{offset:8})||p([105,115,111,50],{offset:8})||p([109,109,112,52],{offset:8})||p([77,52,86],{offset:8})||p([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(p([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(p([26,69,223,163])){const w=h.subarray(4,4100),M=w.findIndex((k,x,L)=>L[x]===66&&L[x+1]===130);if(M!==-1){const k=M+3,x=L=>[...L].every((B,$)=>w[k+$]===B.charCodeAt(0));if(x("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(x("webm"))return{ext:"webm",mime:"video/webm"}}}if(p([0,0,0,20,102,116,121,112,113,116,32,32])||p([102,114,101,101],{offset:4})||p([102,116,121,112,113,116,32,32],{offset:4})||p([109,100,97,116],{offset:4})||p([109,111,111,118],{offset:4})||p([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(p([82,73,70,70])){if(p([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(p([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(p([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(p([48,38,178,117,142,102,207,17,166,217])){let w=30;do{const M=readUInt64LE(h,w+16);if(p([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:w})){if(p([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:w+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(p([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:w+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}w+=M}while(w+24<=h.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(p([0,0,1,186])||p([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(p([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let w=0;w<2&&w<h.length-16;w++){if(p([73,68,51],{offset:w})||p([255,226],{offset:w,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(p([255,228],{offset:w,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(p([255,248],{offset:w,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(p([255,240],{offset:w,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(p([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(p([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(p([79,103,103,83]))return p([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:p([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:p([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:p([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:p([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(p([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(p([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(p([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(p([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(p([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(p([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((h[0]===67||h[0]===70)&&p([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(p([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(p([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(p([119,79,70,70])&&(p([0,1,0,0],{offset:4})||p([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(p([119,79,70,50])&&(p([0,1,0,0],{offset:4})||p([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(p([76,80],{offset:34})&&(p([0,0,1],{offset:8})||p([1,0,2],{offset:8})||p([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(p([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(p([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(p([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(p([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(p([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(p([37,33]))return{ext:"ps",mime:"application/postscript"};if(p([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(p([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(p([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(p([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(p([77,83,67,70])||p([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(p([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(p([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(p([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(p([31,160])||p([31,157]))return{ext:"Z",mime:"application/x-compress"};if(p([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(p([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(p([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(p([71],{offset:4})&&(p([71],{offset:192})||p([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(p([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(p([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(p([0,0,0,12,106,80,32,32,13,10,135,10])){if(p([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(p([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(p([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(p([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(p([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(m("<?xml "))return{ext:"xml",mime:"application/xml"};if(p([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(p([102,116,121,112],{offset:4})){if(p([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(p([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(p([104,101,105,99],{offset:8})||p([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(p([104,101,118,99],{offset:8})||p([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return p([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:p([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:p([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:p([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:p([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:p([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:p([212,195,178,161])||p([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const d=new stream.PassThrough,h=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{d.fileType=fileType(h)}catch(p){reject(p)}readableStream.unshift(h),stream.pipeline?resolve(stream.pipeline(readableStream,d,()=>{})):resolve(readableStream.pipe(d))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=d=>{const h=fileType(d);return imageExts.has(h&&h.ext)?h:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageType$1=imageType$2.exports;(function(d){if(d.TextEncoder&&d.TextDecoder)return!1;function h(m="utf-8"){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${m}') is invalid.`)}Object.defineProperty(h.prototype,"encoding",{value:"utf-8"}),h.prototype.encode=function(m,w={stream:!1}){if(w.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let M=0;const k=m.length;let x=0,L=Math.max(32,k+(k>>1)+7),B=new Uint8Array(L>>3<<3);for(;M<k;){let $=m.charCodeAt(M++);if($>=55296&&$<=56319){if(M<k){const U=m.charCodeAt(M);(U&64512)===56320&&(++M,$=(($&1023)<<10)+(U&1023)+65536)}if($>=55296&&$<=56319)continue}if(x+4>B.length){L+=8,L*=1+M/m.length*2,L=L>>3<<3;const U=new Uint8Array(L);U.set(B),B=U}if(($&4294967168)===0){B[x++]=$;continue}else if(($&4294965248)===0)B[x++]=$>>6&31|192;else if(($&4294901760)===0)B[x++]=$>>12&15|224,B[x++]=$>>6&63|128;else if(($&4292870144)===0)B[x++]=$>>18&7|240,B[x++]=$>>12&63|128,B[x++]=$>>6&63|128;else continue;B[x++]=$&63|128}return B.slice(0,x)};function p(m="utf-8",w={fatal:!1}){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${m}') is invalid.`);if(w.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(p.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(p.prototype,"fatal",{value:!1}),Object.defineProperty(p.prototype,"ignoreBOM",{value:!1}),p.prototype.decode=function(m,w={stream:!1}){if(w.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const M=new Uint8Array(m);let k=0;const x=M.length,L=[];for(;k<x;){const B=M[k++];if(B===0)break;if((B&128)===0)L.push(B);else if((B&224)===192){const $=M[k++]&63;L.push((B&31)<<6|$)}else if((B&240)===224){const $=M[k++]&63,U=M[k++]&63;L.push((B&31)<<12|$<<6|U)}else if((B&248)===240){const $=M[k++]&63,U=M[k++]&63,q=M[k++]&63;let G=(B&7)<<18|$<<12|U<<6|q;G>65535&&(G-=65536,L.push(G>>>10&1023|55296),G=56320|G&1023),L.push(G)}}return String.fromCharCode.apply(null,L)},d.TextEncoder=h,d.TextDecoder=p})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder=new TextDecoder("utf-8");function decode(d){return decoder.decode(d)}const encoder=new TextEncoder;function encode(d){return encoder.encode(d)}const defaultByteLength=1024*8;class IOBuffer{constructor(h=defaultByteLength,p={}){let m=!1;typeof h=="number"?h=new ArrayBuffer(h):(m=!0,this.lastWrittenByte=h.byteLength);const w=p.offset?p.offset>>>0:0,M=h.byteLength-w;let k=w;(ArrayBuffer.isView(h)||h instanceof IOBuffer)&&(h.byteLength!==h.buffer.byteLength&&(k=h.byteOffset+w),h=h.buffer),m?this.lastWrittenByte=M:this.lastWrittenByte=0,this.buffer=h,this.length=M,this.byteLength=M,this.byteOffset=k,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,k,M),this._mark=0,this._marks=[]}available(h=1){return this.offset+h<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(h=1){return this.offset+=h,this}seek(h){return this.offset=h,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const h=this._marks.pop();if(h===void 0)throw new Error("Mark stack empty");return this.seek(h),this}rewind(){return this.offset=0,this}ensureAvailable(h=1){if(!this.available(h)){const m=(this.offset+h)*2,w=new Uint8Array(m);w.set(new Uint8Array(this.buffer)),this.buffer=w.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(h=1){const p=new Uint8Array(h);for(let m=0;m<h;m++)p[m]=this.readByte();return p}readInt16(){const h=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,h}readUint16(){const h=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,h}readInt32(){const h=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,h}readUint32(){const h=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat32(){const h=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,h}readFloat64(){const h=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,h}readBigInt64(){const h=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,h}readBigUint64(){const h=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,h}readChar(){return String.fromCharCode(this.readInt8())}readChars(h=1){let p="";for(let m=0;m<h;m++)p+=this.readChar();return p}readUtf8(h=1){return decode(this.readBytes(h))}writeBoolean(h){return this.writeUint8(h?255:0),this}writeInt8(h){return this.ensureAvailable(1),this._data.setInt8(this.offset++,h),this._updateLastWrittenByte(),this}writeUint8(h){return this.ensureAvailable(1),this._data.setUint8(this.offset++,h),this._updateLastWrittenByte(),this}writeByte(h){return this.writeUint8(h)}writeBytes(h){this.ensureAvailable(h.length);for(let p=0;p<h.length;p++)this._data.setUint8(this.offset++,h[p]);return this._updateLastWrittenByte(),this}writeInt16(h){return this.ensureAvailable(2),this._data.setInt16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(h){return this.ensureAvailable(2),this._data.setUint16(this.offset,h,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(h){return this.ensureAvailable(4),this._data.setInt32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(h){return this.ensureAvailable(4),this._data.setUint32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(h){return this.ensureAvailable(4),this._data.setFloat32(this.offset,h,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(h){return this.ensureAvailable(8),this._data.setFloat64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(h){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(h){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,h,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(h){return this.writeUint8(h.charCodeAt(0))}writeChars(h){for(let p=0;p<h.length;p++)this.writeUint8(h.charCodeAt(p));return this}writeUtf8(h){return this.writeBytes(encode(h))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function guessStripByteCounts(d){if(d.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const h=d.rowsPerStrip*d.width*d.samplesPerPixel*(d.bitsPerSample/8);return new Array(d.stripOffsets.length).fill(h)}function applyHorizontalDifferencing8Bit(d,h,p){let m=0;for(;m<d.length;){for(let w=p;w<h*p;w+=p)for(let M=0;M<p;M++)d[m+w+M]=d[m+w+M]+d[m+w-(p-M)]&255;m+=h*p}}function applyHorizontalDifferencing16Bit(d,h,p){let m=0;for(;m<d.length;){for(let w=p;w<h*p;w+=p)for(let M=0;M<p;M++)d[m+w+M]=d[m+w+M]+d[m+w-(p-M)]&65535;m+=h*p}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let d in tagsById$2)tagsByName$2[tagsById$2[d]]=Number(d);var exif=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById:tagsById$2,tagsByName:tagsByName$2});const tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let d in tagsById$1)tagsByName$1[tagsById$1[d]]=Number(d);var gps=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById:tagsById$1,tagsByName:tagsByName$1});const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let d in tagsById)tagsByName[tagsById[d]]=Number(d);var standard=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById,tagsByName});const tags={standard,exif,gps};class IFD{constructor(h){if(!h)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=h,this._hasMap=!1,this._map={}}get(h){if(typeof h=="number")return this.fields.get(h);if(typeof h=="string")return this.fields.get(tags[this.kind].tagsByName[h]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const h=tags[this.kind].tagsById;for(let p of this.fields.keys())h[p]&&(this._map[h[p]]=this.fields.get(p));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(d,h){const p=types.get(d);if(!p)throw new Error(`type not found: ${d}`);return p[0]*h}function readData(d,h,p){const m=types.get(h);if(!m)throw new Error(`type not found: ${h}`);return m[1](d,p)}function readByte(d,h){if(h===1)return d.readUint8();let p=new Uint8Array(h);for(let m=0;m<h;m++)p[m]=d.readUint8();return p}function readASCII(d,h){let p=[],m="";for(let w=0;w<h;w++){let M=String.fromCharCode(d.readUint8());M==="\0"?(p.push(m),m=""):m+=M}return p.length===1?p[0]:p}function readShort(d,h){if(h===1)return d.readUint16();let p=new Uint16Array(h);for(let m=0;m<h;m++)p[m]=d.readUint16();return p}function readLong(d,h){if(h===1)return d.readUint32();let p=new Uint32Array(h);for(let m=0;m<h;m++)p[m]=d.readUint32();return p}function readRational(d,h){if(h===1)return d.readUint32()/d.readUint32();let p=new Array(h);for(let m=0;m<h;m++)p[m]=d.readUint32()/d.readUint32();return p}function readSByte(d,h){if(h===1)return d.readInt8();let p=new Int8Array(h);for(let m=0;m<h;m++)p[m]=d.readInt8();return p}function readSShort(d,h){if(h===1)return d.readInt16();let p=new Int16Array(h);for(let m=0;m<h;m++)p[m]=d.readInt16();return p}function readSLong(d,h){if(h===1)return d.readInt32();let p=new Int32Array(h);for(let m=0;m<h;m++)p[m]=d.readInt32();return p}function readSRational(d,h){if(h===1)return d.readInt32()/d.readInt32();let p=new Array(h);for(let m=0;m<h;m++)p[m]=d.readInt32()/d.readInt32();return p}function readFloat(d,h){if(h===1)return d.readFloat32();let p=new Float32Array(h);for(let m=0;m<h;m++)p[m]=d.readFloat32();return p}function readDouble(d,h){if(h===1)return d.readFloat64();let p=new Float64Array(h);for(let m=0;m<h;m++)p[m]=d.readFloat64();return p}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let h=0;h<256;h++)stringTable.push([h]);const d=[];for(let h=256;h<4096;h++)stringTable.push(d)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(h){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(h.buffer,h.byteOffset,h.byteLength),this.outData=new IOBuffer(h.byteLength),this.initializeTable()}decode(){let h=0,p=0;for(;(h=this.getNextCode())!==EOI_CODE;)if(h===CLEAR_CODE){if(this.initializeTable(),h=this.getNextCode(),h===EOI_CODE)break;this.writeString(this.stringFromCode(h)),p=h}else if(this.isInTable(h))this.writeString(this.stringFromCode(h)),this.addStringToTable(this.stringFromCode(p).concat(this.stringFromCode(h)[0])),p=h;else{const w=this.stringFromCode(p).concat(this.stringFromCode(p)[0]);this.writeString(w),this.addStringToTable(w),p=h}const m=this.outData.toArray();return new DataView(m.buffer,m.byteOffset,m.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(h){this.outData.writeBytes(h)}stringFromCode(h){return stringTable[h]}isInTable(h){return h<this.tableLength}addStringToTable(h){if(stringTable[this.tableLength++]=h,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const h=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:h}}function decompressLzw(d){return new LzwDecoder(d).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let h=new Date,p=dateTimeRegex.exec(this.dateTime);if(p===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return h.setFullYear(Number(p[1]),Number(p[2])-1,Number(p[3])),h.setHours(Number(p[4]),Number(p[5]),Number(p[6])),h}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const h=this.get("BitsPerSample");return h&&typeof h!="number"?h[0]:h}get alpha(){const h=this.extraSamples;return h?h[0]!==0:!1}get associatedAlpha(){const h=this.extraSamples;return h?h[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const h=2**this.bitsPerSample,p=this.get("ColorMap");if(!p)return;if(p.length!==3*h)throw new Error(`ColorMap size must be ${h}`);const m=[];for(let w=0;w<h;w++)m.push([p[w],p[w+h],p[w+2*h]]);return m}}function alwaysArray(d){return typeof d=="number"?[d]:d}function decompressZlib(d){const h=new Uint8Array(d.buffer,d.byteOffset,d.byteLength),p=inflate_1(h);return new DataView(p.buffer,p.byteOffset,p.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(h){super(h);this._nextIFD=0}get isMultiPage(){let h=0;for(this.decodeHeader();this._nextIFD;)if(h++,this.decodeIFD({ignoreImageData:!0},!0),h===2)return!0;if(h===1)return!1;throw unsupported("ifdCount",h)}get pageCount(){let h=0;for(this.decodeHeader();this._nextIFD;)h++,this.decodeIFD({ignoreImageData:!0},!0);if(h>0)return h;throw unsupported("ifdCount",h)}decode(h={}){h=Object.assign({},defaultOptions$c,h);const p=[];for(this.decodeHeader();this._nextIFD;)if(p.push(this.decodeIFD(h,!0)),h.onlyFirst)return[p[0]];return p}decodeHeader(){const h=this.readUint16();if(h===18761)this.setLittleEndian();else if(h===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${h.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(h,p){this.seek(this._nextIFD);let m;if(p)m=new TiffIfd;else{if(!h.kind)throw new Error("kind is missing");m=new IFD(h.kind)}const w=this.readUint16();for(let M=0;M<w;M++)this.decodeIFDEntry(m);if(!h.ignoreImageData){if(!(m instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(m)}return this._nextIFD=this.readUint32(),m}decodeIFDEntry(h){const p=this.offset,m=this.readUint16(),w=this.readUint16(),M=this.readUint32();if(w<1||w>12){this.skip(4);return}getByteLength(w,M)>4&&this.seek(this.readUint32());const x=readData(this,w,M);if(h.fields.set(m,x),m===34665||m===34853){let L=this.offset,B="exif";m===34665?B="exif":m===34853&&(B="gps"),this._nextIFD=x,h[B]=this.decodeIFD({kind:B,ignoreImageData:!0},!1),this.offset=L}this.seek(p),this.skip(12)}decodeImageData(h){const p=h.orientation;if(p&&p!==1)throw unsupported("orientation",p);switch(h.type){case 0:case 1:case 2:case 3:this.readStripData(h);break;default:throw unsupported("image type",h.type)}if(this.applyPredictor(h),this.convertAlpha(h),h.type===0){const m=h.bitsPerSample,w=Math.pow(2,m)-1;for(let M=0;M<h.data.length;M++)h.data[M]=w-h.data[M]}}readStripData(h){const p=h.width,m=h.height,w=h.bitsPerSample,M=h.sampleFormat,k=p*m*h.samplesPerPixel,x=getDataArray(k,w,M),B=h.rowsPerStrip*p*h.samplesPerPixel,$=h.stripOffsets,U=h.stripByteCounts||guessStripByteCounts(h);let q=k,G=0;for(let W=0;W<$.length;W++){let te=new DataView(this.buffer,this.byteOffset+$[W],U[W]),oe=q>B?B:q;q-=oe;let ee=te;switch(h.compression){case 1:break;case 5:{ee=decompressLzw(te);break}case 8:{ee=decompressZlib(te);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",h.compression)}G=this.fillUncompressed(w,M,x,ee,G,oe)}h.data=x}fillUncompressed(h,p,m,w,M,k){if(h===8)return fill8bit(m,w,M,k);if(h===16)return fill16bit(m,w,M,k,this.isLittleEndian());if(h===32&&p===3)return fillFloat32(m,w,M,k,this.isLittleEndian());throw unsupported("bitDepth",h)}applyPredictor(h){const p=h.bitsPerSample;switch(h.predictor){case 1:break;case 2:{if(p===8)applyHorizontalDifferencing8Bit(h.data,h.width,h.components);else if(p===16)applyHorizontalDifferencing16Bit(h.data,h.width,h.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${p}`);break}default:throw new Error(`invalid predictor: ${h.predictor}`)}}convertAlpha(h){if(h.alpha&&h.associatedAlpha){const{data:p,components:m,maxSampleValue:w}=h;for(let M=0;M<p.length;M+=m){const k=p[M+m-1];for(let x=0;x<m-1;x++)p[M+x]=Math.round(p[M+x]*w/k)}}}}function getDataArray(d,h,p){if(h===8)return new Uint8Array(d);if(h===16)return new Uint16Array(d);if(h===32&&p===3)return new Float32Array(d);throw unsupported("bit depth / sample format",`${h} / ${p}`)}function fill8bit(d,h,p,m){for(let w=0;w<m;w++)d[p++]=h.getUint8(w);return p}function fill16bit(d,h,p,m,w){for(let M=0;M<m*2;M+=2)d[p++]=h.getUint16(M,w);return p}function fillFloat32(d,h,p,m,w){for(let M=0;M<m*4;M+=4)d[p++]=h.getFloat32(M,w);return p}function unsupported(d,h){return new Error(`Unsupported ${d}: ${h}`)}function decodeTIFF(d,h){return new TIFFDecoder(d).decode(h)}function matchAndCrop(d={}){let{algorithm:h="matchToPrevious",ignoreBorder:p=[0,0]}=d;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let m=h==="matchToPrevious",w=this[0],M=[];M[0]={position:[0,0],image:this[0]};let k=[0,0];for(let q=1;q<this.length;q++){let G=w.getBestMatch(this[q],{border:p});M[q]={position:[G[0]+k[0],G[1]+k[1]],image:this[q]},m&&(k[0]+=G[0],k[1]+=G[1],w=this[q])}let x=0,L=0,B=0,$=0;for(let q=0;q<M.length;q++){let G=M[q];G.position[0]>x&&(x=G.position[0]),G.position[0]<L&&(L=G.position[0]),G.position[1]>B&&(B=G.position[1]),G.position[1]<$&&($=G.position[1])}L=0-L,$=0-$;for(let q=0;q<M.length;q++){let G=M[q];G.crop=G.image.crop({x:x-G.position[0],y:B-G.position[1],width:w.width-L-x,height:w.height-$-B})}let U=[];for(let q=0;q<M.length;q++)U[q]=M[q].crop;return new Stack(U)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let d=this[0].min;for(let h=1;h<this.length;h++)for(let p=0;p<d.length;p++)d[p]=Math.min(d[p],this[h].min[p]);return d}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let d=this[0].max;for(let h=1;h<this.length;h++)for(let p=0;p<d.length;p++)d[p]=Math.max(d[p],this[h].max[p]);return d}function median$2(d){let h=d.reduce((k,x)=>k+x);if(h===0)throw new Error("unreachable");let p=0,m=0,w=h/2,M;for(;;){if(d[p]>0){if(M!==void 0)return(M+p)/2;if(m+=d[p],m>w)return p;m===w&&(M=p)}p++}}function mean$2(d){let h=0,p=0;for(let m=0;m<d.length;m++)h+=d[m],p+=d[m]*m;return h===0?0:p/h}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let d=this.getHistograms({maxSlots:this[0].maxValue+1}),h=new Array(d.length);for(let p=0;p<d.length;p++){let m=d[p];h[p]=median$2(m)}return h}function histogram(d){this.checkProcessable("min",{bitDepth:[8,16]});let h=this[0].getHistogram(d);for(let p=1;p<this.length;p++){let m=this[p].getHistogram(d);for(let w=0;w<h.length;w++)h[w]+=m[w]}return h}function histograms(d){this.checkProcessable("min",{bitDepth:[8,16]});let h=this[0].getHistograms(d),p=h[0].length;for(let m=1;m<this.length;m++){let w=this[m].getHistograms(d);for(let M=0;M<h.length;M++)for(let k=0;k<p;k++)h[M][k]+=w[M][k]}return h}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let d=new Uint32Array(this[0].data.length);for(let m=0;m<this.length;m++){let w=this[m];for(let M=0;M<this[0].data.length;M++)d[M]+=w.data[M]}let h=Image$1.createFrom(this[0]),p=h.data;for(let m=0;m<this[0].data.length;m++)p[m]=d[m]/this.length;return h}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let d=Image$1.createFrom(this[0]);d.data.fill(0);for(const h of this)for(let p=0;p<d.data.length;p++)d.data[p]=Math.max(h.data[p],d.data[p]);return d}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let d=Image$1.createFrom(this[0]);d.data.fill(d.maxValue);for(const h of this)for(let p=0;p<d.data.length;p++)d.data[p]=Math.min(h.data[p],d.data[p]);return d}function extend$5(d){d.extendMethod("matchAndCrop",matchAndCrop),d.extendMethod("getMin",min$2),d.extendMethod("getMax",max$2),d.extendMethod("getMedian",median$1),d.extendMethod("getHistogram",histogram),d.extendMethod("getHistograms",histograms),d.extendMethod("getAverage",averageImage),d.extendMethod("getAverageImage",averageImage),d.extendMethod("getMaxImage",maxImage),d.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(h){if(Array.isArray(h)){super(h.length);for(let p=0;p<h.length;p++)this[p]=h[p]}else typeof h=="number"?super(h):super();this.computed=null}static load(h){return Promise.all(h.map(Image$1.load)).then(p=>new Stack(p))}static extendMethod(h,p,m={}){let{inPlace:w=!1,returnThis:M=!0,partialArgs:k=[]}=m;return w?Stack.prototype[h]=function(...x){this.computed=null;let L=p.apply(this,[...k,...x]);return M?this:L}:Stack.prototype[h]=function(...x){return p.apply(this,[...k,...x])},Stack}static extendProperty(h,p,m={}){let{partialArgs:w=[]}=m;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(h,this.computed))return this.computed[h];let M=p.apply(this,w);return this.computed[h]=M,M},Object.defineProperty(Stack.prototype,h,computedPropertyDescriptor),Stack}checkProcessable(h,p={}){if(typeof h!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${h} can not be applied on an empty stack`);this[0].checkProcessable(h,p);for(let m=1;m<this.length;m++){if((p.sameSize===void 0||p.sameSize)&&this[0].width!==this[m].width)throw new TypeError(`The process: ${h} can not be applied if width is not identical in all images`);if((p.sameSize===void 0||p.sameSize)&&this[0].height!==this[m].height)throw new TypeError(`The process: ${h} can not be applied if height is not identical in all images`);if((p.sameAlpha===void 0||p.sameAlpha)&&this[0].alpha!==this[m].alpha)throw new TypeError(`The process: ${h} can not be applied if alpha is not identical in all images`);if((p.sameBitDepth===void 0||p.sameBitDepth)&&this[0].bitDepth!==this[m].bitDepth)throw new TypeError(`The process: ${h} can not be applied if bitDepth is not identical in all images`);if((p.sameColorModel===void 0||p.sameColorModel)&&this[0].colorModel!==this[m].colorModel)throw new TypeError(`The process: ${h} can not be applied if colorModel is not identical in all images`);if((p.sameNumberChannels===void 0||p.sameNumberChannels)&&this[0].channels!==this[m].channels)throw new TypeError(`The process: ${h} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(d,h){if(typeof d!="function")throw new TypeError(`${d} is not a function`);let p=new Stack(this.length);for(let m=0;m<this.length;m++)p[m]=d.call(h,this[m],m,this);return p});extend$5(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(d,h){if(typeof d=="string")return loadURL(d,h);if(d instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(d)));if(d.buffer)return Promise.resolve(loadBinary(d));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(d,h){const p=imageType$1(d);if(p)switch(p.mime){case"image/png":return loadPNG(d);case"image/jpeg":return loadJPEG(d);case"image/tiff":return loadTIFF(d);default:return loadGeneric(m(p.mime))}return loadGeneric(m("application/octet-stream"));function m(w){return h||toBase64URL(d,w)}}function loadURL(d,h){const p=d.slice(0,64).match(isDataURL);let m;return p!==null?m=Promise.resolve(decode$4(d.slice(p[0].length))):m=fetchBinary(d,h),m.then(w=>{const M=new Uint8Array(w);return loadBinary(M,p?d:void 0)})}function loadPNG(d){const h=decodePng(d);let p=h.channels,m,w=0;return p===2||p===4?(m=p-1,w=1):m=p,h.palette?loadPNGFromPalette(h):new Image$1(h.width,h.height,h.data,{components:m,alpha:w,bitDepth:h.depth})}function loadPNGFromPalette(d){const h=d.width*d.height,p=d.palette[0].length,m=new Uint8Array(h*p),w=8/d.depth,M=d.depth<8?w:1,k=parseInt("1".repeat(d.depth),2),x=p===4;let L=0;for(let B=0;B<h;B++){const $=Math.floor(B/M);let U=d.data[$];d.depth<8&&(U=U>>>d.depth*(w-1-B%w)&k);const q=d.palette[U];m[L++]=q[0],m[L++]=q[1],m[L++]=q[2],x&&(m[L++]=q[3])}return new Image$1(d.width,d.height,m,{components:3,alpha:x,bitDepth:8})}function loadJPEG(d){const h=decode$1(d);let p;h.exif&&(p=getMetadata(h.exif));const m=jpegJs.decode(d,{useTArray:!0,maxMemoryUsageInMB:1024});let w=new Image$1(m.width,m.height,m.data,{meta:p});if(p&&p.tiff.tags.Orientation){const M=p.tiff.tags.Orientation;M>2&&(w=w.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[M])),[2,4,5,7].includes(M)&&(w=w.flipX())}return w}function loadTIFF(d){let h=decodeTIFF(d);return h.length===1?getImageFromIFD(h[0]):new Stack(h.map(getImageFromIFD))}function getMetadata(d){const h={tiff:{fields:d.fields,tags:d.map}};return d.exif&&(h.exif=d.exif),d.gps&&(h.gps=d.gps),h}function getImageFromIFD(d){if(d.type===3){const h=new Uint16Array(3*d.width*d.height),p=d.palette;let m=0;for(let w=0;w<d.data.length;w++){const M=d.data[w],k=p[M];h[m++]=k[0],h[m++]=k[1],h[m++]=k[2]}return new Image$1(d.width,d.height,h,{components:3,alpha:d.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(d)})}else return new Image$1(d.width,d.height,d.data,{components:d.type===2?3:1,alpha:d.alpha,colorModel:d.type===2?RGB$1:GREY$1,bitDepth:d.bitsPerSample.length?d.bitsPerSample[0]:d.bitsPerSample,meta:getMetadata(d)})}function loadGeneric(d,h){return h=h||{},new Promise(function(p,m){let w=new DOMImage;w.onload=function(){let M=w.width,k=w.height,L=createCanvas(M,k).getContext("2d");L.drawImage(w,0,0,M,k);let B=L.getImageData(0,0,M,k).data;p(new Image$1(M,k,B,h))},w.onerror=function(){m(new Error(`Could not load ${d}`))},w.src=d})}const valueMethods={getValueXY(d,h,p){return this.data[(h*this.width+d)*this.channels+p]},setValueXY(d,h,p,m){return this.data[(h*this.width+d)*this.channels+p]=m,this.computed=null,this},getValue(d,h){return this.data[d*this.channels+h]},setValue(d,h,p){return this.data[d*this.channels+h]=p,this.computed=null,this},getPixelXY(d,h){return this.getPixel(h*this.width+d)},setPixelXY(d,h,p){return this.setPixel(h*this.width+d,p)},getPixel(d){const h=new Array(this.channels),p=d*this.channels;for(let m=0;m<this.channels;m++)h[m]=this.data[p+m];return h},setPixel(d,h){const p=d*this.channels;for(let m=0;m<h.length;m++)this.data[p+m]=h[m];return this.computed=null,this}};function setValueMethods(d){for(const h in valueMethods)d.prototype[h]=valueMethods[h]}function getImageParameters(d){return{width:d.width,height:d.height,components:d.components,alpha:d.alpha,colorModel:d.colorModel,bitDepth:d.bitDepth}}function getOutputImage(d,h,p,m={}){const{out:w}=h;if(w===void 0)return m.copy?d.clone():Image$1.createFrom(d,p);{if(!Image$1.isImage(w))throw new TypeError("out must be an Image object");const M=Object.assign(getImageParameters(d),p);for(const k in M)if(w[k]!==M[k])throw new RangeError(`cannot use out. Its ${k} must be "${M[k]}" (found "${w[k]}")`);return w}}function getOutputImageOrInPlace(d,h,p){if(h.inPlace!==void 0&&typeof h.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(h.inPlace){if(h.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return d}return getOutputImage(d,h,null,p)}function abs(d={}){this.checkProcessable("abs",{bitDepth:[32]});const h=getOutputImageOrInPlace(this,d);return absolute(this,h),h}function absolute(d,h){for(let p=0;p<d.data.length;p++)h.data[p]=Math.abs(d.data[p])}function copyAlphaChannel(d,h){if(d.alpha===1&&h.alpha===1)for(let p=0;p<d.size;p++)h.data[p*h.channels+h.components]=d.data[p*d.channels+d.components]}function invert(d={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const h=getOutputImageOrInPlace(this,d);return this.bitDepth===1?invertBinary(this,h):(invertColor(this,h),this!==h&&copyAlphaChannel(this,h)),h}function invertBinary(d,h){for(let p=0;p<d.data.length;p++)h.data[p]=~d.data[p]}function invertColor(d,h){for(let p=0;p<d.data.length;p+=d.channels)for(let m=0;m<d.components;m++)h.data[p+m]=d.maxValue-d.data[p+m]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let d=0;d<this.height;d++){let h=d*this.width*this.channels;for(let p=0;p<Math.floor(this.width/2);p++){let m=p*this.channels+h,w=(this.width-p-1)*this.channels+h;for(let M=0;M<this.channels;M++){let k=this.data[m+M];this.data[m+M]=this.data[w+M],this.data[w+M]=k}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let d=0;d<Math.floor(this.height/2);d++)for(let h=0;h<this.width;h++){let p=h*this.channels+d*this.width*this.channels,m=h*this.channels+(this.height-1-d)*this.channels*this.width;for(let w=0;w<this.channels;w++){let M=this.data[p+w];this.data[p+w]=this.data[m+w],this.data[m+w]=M}}return this}function blurFilter(d={}){const{radius:h=1}=d;if(h<1)throw new Error("radius must be greater than 1");const p=2*h+1,m=new Array(p);for(let w=0;w<p;w++){m[w]=new Array(p);for(let M=0;M<p;M++)m[w][M]=1/(p*p)}return this.convolution(m)}var medianQuickselect_min={exports:{}};(function(d){(function(){function h(w){for(var M=0,k=w.length-1,x=void 0,L=void 0,B=void 0,$=m(M,k);;){if(k<=M)return w[$];if(k==M+1)return w[M]>w[k]&&p(w,M,k),w[$];for(x=m(M,k),w[x]>w[k]&&p(w,x,k),w[M]>w[k]&&p(w,M,k),w[x]>w[M]&&p(w,x,M),p(w,x,M+1),L=M+1,B=k;;){do L++;while(w[M]>w[L]);do B--;while(w[B]>w[M]);if(B<L)break;p(w,L,B)}p(w,M,B),B<=$&&(M=L),B>=$&&(k=B-1)}}var p=function(M,k,x){var L;return L=[M[x],M[k]],M[k]=L[0],M[x]=L[1],L},m=function(M,k){return~~((M+k)/2)};d.exports?d.exports=h:window.median=h})()})(medianQuickselect_min);var quickSelectMedian=medianQuickselect_min.exports;function validateArrayOfChannels(d,h={}){let{channels:p,allowAlpha:m,defaultAlpha:w}=h;return typeof m!="boolean"&&(m=!0),typeof p=="undefined"?allChannels(d,w):validateChannels(d,p,m)}function allChannels(d,h){let p=h?d.channels:d.components,m=new Array(p);for(let w=0;w<p;w++)m[w]=w;return m}function validateChannels(d,h,p){Array.isArray(h)||(h=[h]);for(let m=0;m<h.length;m++)h[m]=validateChannel(d,h[m],p);return h}function validateChannel(d,h,p=!0){if(h===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${d.channels}`);if(typeof h=="string"){switch(d.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(h))switch(h){case"r":h=0;break;case"g":h=1;break;case"b":h=2;break}break;case HSL:if("hsl".includes(h))switch(h){case"h":h=0;break;case"s":h=1;break;case"l":h=2;break}break;case HSV:if("hsv".includes(h))switch(h){case"h":h=0;break;case"s":h=1;break;case"v":h=2;break}break;case CMYK$1:if("cmyk".includes(h))switch(h){case"c":h=0;break;case"m":h=1;break;case"y":h=2;break;case"k":h=3;break}break;default:throw new Error(`Unexpected color model: ${d.colorModel}`)}if(h==="a"){if(!d.alpha)throw new Error("validateChannel : the image does not contain alpha channel");h=d.components}if(typeof h=="string")throw new Error(`validateChannel : undefined channel: ${h}`)}if(h>=d.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${d.channels}`);if(!p&&h>=d.components)throw new RangeError("validateChannel : alpha channel may not be selected");return h}function medianFilter(d={}){let{radius:h=1,border:p="copy",channels:m}=d;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),h<1)throw new Error("radius must be greater than 0");m=validateArrayOfChannels(this,m);let w=h,M=h,k=Image$1.createFrom(this),x=(w*2+1)*(M*2+1),L=new Array(x);for(let B=0;B<m.length;B++){let $=m[B];for(let U=M;U<this.height-M;U++)for(let q=w;q<this.width-w;q++){let G=0;for(let te=-M;te<=M;te++)for(let oe=-w;oe<=w;oe++){let ee=((U+te)*this.width+q+oe)*this.channels+$;L[G++]=this.data[ee]}let W=(U*this.width+q)*this.channels+$;k.data[W]=quickSelectMedian(L)}}if(this.alpha&&!m.includes(this.channels))for(let B=this.components;B<this.data.length;B=B+this.channels)k.data[B]=this.data[B];return k.setBorder({size:[w,M],algorithm:p}),k}function gaussianFilter(d={}){let{radius:h=1,sigma:p,channels:m,border:w="copy"}=d;this.checkProcessable("gaussian",{bitDepth:[8,16]});const M=getKernel(h,p);return this.convolution([M,M],{border:w,channels:m,algorithm:"separable"})}function getKernel(d,h){const p=d*2+1,m=new Array(p),w=h||((p-1)*.5-1)*.3+.8,M=-.5/(w*w);let k=0;for(let x=0;x<p;x++){const L=x-d,B=Math.exp(M*L*L);m[x]=B,k+=B}for(let x=0;x<p;x++)m[x]/=k;return m}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(d){(function(){var h;h=d;var p={release:"0.3.0",date:"2013-03"};h.toString=function(){return"version "+p.release+", released "+p.date};for(var m=0,w=null,M=null,k={init:function(B){if(B!==0&&(B&B-1)===0)m=B,k._initArray(),k._makeBitReversalTable(),k._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(B,$){k.fft(B,$,1)},ifft1d:function(B,$){var U=1/m;k.fft(B,$,-1);for(var q=0;q<m;q++)B[q]*=U,$[q]*=U},bt1d:function(B,$){k.fft(B,$,-1)},fft2d:function(B,$){for(var U=[],q=[],G=0,W=0;W<m;W++){G=W*m;for(var te=0;te<m;te++)U[te]=B[te+G],q[te]=$[te+G];k.fft1d(U,q);for(var oe=0;oe<m;oe++)B[oe+G]=U[oe],$[oe+G]=q[oe]}for(var ee=0;ee<m;ee++){for(var _e=0;_e<m;_e++)G=ee+_e*m,U[_e]=B[G],q[_e]=$[G];k.fft1d(U,q);for(var se=0;se<m;se++)G=ee+se*m,B[G]=U[se],$[G]=q[se]}},ifft2d:function(B,$){for(var U=[],q=[],G=0,W=0;W<m;W++){G=W*m;for(var te=0;te<m;te++)U[te]=B[te+G],q[te]=$[te+G];k.ifft1d(U,q);for(var oe=0;oe<m;oe++)B[oe+G]=U[oe],$[oe+G]=q[oe]}for(var ee=0;ee<m;ee++){for(var _e=0;_e<m;_e++)G=ee+_e*m,U[_e]=B[G],q[_e]=$[G];k.ifft1d(U,q);for(var se=0;se<m;se++)G=ee+se*m,B[G]=U[se],$[G]=q[se]}},fft:function(B,$,U){for(var q,G,W,te,oe,ee,_e,se,he,ge=m>>2,Re=0;Re<m;Re++)te=w[Re],Re<te&&(oe=B[Re],B[Re]=B[te],B[te]=oe,oe=$[Re],$[Re]=$[te],$[te]=oe);for(var ve=1;ve<m;ve<<=1){G=0,q=m/(ve<<1);for(var de=0;de<ve;de++){ee=M[G+ge],_e=U*M[G];for(var Se=de;Se<m;Se+=ve<<1)W=Se+ve,se=ee*B[W]+_e*$[W],he=ee*$[W]-_e*B[W],B[W]=B[Se]-se,B[Se]+=se,$[W]=$[Se]-he,$[Se]+=he;G+=q}}},_initArray:function(){typeof Uint32Array!="undefined"?w=new Uint32Array(m):w=[],typeof Float64Array!="undefined"?M=new Float64Array(m*1.25):M=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var B=0,$=0,U=0;for(w[0]=0;++B<m;){for(U=m>>1;U<=$;)$-=U,U>>=1;$+=U,w[B]=$}},_makeCosSinTable:function(){var B=m>>1,$=m>>2,U=m>>3,q=B+$,G=Math.sin(Math.PI/m),W=2*G*G,te=Math.sqrt(W*(2-W)),oe=M[$]=1,ee=M[0]=0;G=2*W;for(var _e=1;_e<U;_e++)oe-=W,W+=G*oe,ee+=te,te-=G*ee,M[_e]=ee,M[$-_e]=oe;U!==0&&(M[U]=Math.sqrt(.5));for(var se=0;se<$;se++)M[B-se]=M[se];for(var he=0;he<q;he++)M[he+B]=-M[he]}},x=["init","fft1d","ifft1d","fft2d","ifft2d"],L=0;L<x.length;L++)h[x[L]]=k[x[L]];return h.bt=k.bt1d,h.fft=k.fft1d,h.ifft=k.ifft1d,h}).call(commonjsGlobal)})(fftlib);var FFT=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(d,h,p){var m=new Array(h*p),w=h/2,M=(p-1)*2;FFT.init(w);for(var k={re:new Array(w),im:new Array(w)},x=0;x<p;x++){for(var L=w-1;L>=0;L--)k.re[L]=d[L*2*p+x],k.im[L]=d[(L*2+1)*p+x];FFT.bt(k.re,k.im);for(var L=w-1;L>=0;L--)m[L*2*p+x]=k.re[L],m[(L*2+1)*p+x]=k.im[L]}var B=new Array(w*M);FFT.init(M);for(var $={re:new Array(M),im:new Array(M)},U=M*w,L=0;L<h;L+=2){$.re[0]=m[L*p],$.im[0]=m[(L+1)*p];for(var x=1;x<p;x++)$.re[x]=m[L*p+x],$.im[x]=m[(L+1)*p+x],$.re[M-x]=m[L*p+x],$.im[M-x]=-m[(L+1)*p+x];FFT.bt($.re,$.im);for(var q=L/2*M,x=M-1;x>=0;x--)B[q+x]=$.re[x]/U}return B},fft2DArray:function(d,h,p,m){Object.assign({},{inplace:!0});var w=p/2+1,M=h*2,k=new Array(M*w);FFT.init(p);for(var x={re:new Array(p),im:new Array(p)},L={re:new Array(p),im:new Array(p)},B={re:new Array(p),im:new Array(p)},$,U,q,G,W,te=0;te<h/2;te++){$=te*2*p,x.re=d.slice($,$+p),$=(te*2+1)*p,x.im=d.slice($,$+p),FFT.fft1d(x.re,x.im),this.reconstructTwoRealFFT(x,L,B),U=te*4*w,q=(te*4+1)*w,G=(te*4+2)*w,W=(te*4+3)*w;for(var oe=w-1;oe>=0;oe--)k[U+oe]=L.re[oe],k[q+oe]=L.im[oe],k[G+oe]=B.re[oe],k[W+oe]=B.im[oe]}L=null,B=null;var ee=new Array(M*w);FFT.init(h);for(var _e={re:new Array(h),im:new Array(h)},se=w-1;se>=0;se--){for(var te=h-1;te>=0;te--)_e.re[te]=k[te*2*w+se],_e.im[te]=k[(te*2+1)*w+se],isNaN(_e.re[te])&&(_e.re[te]=0),isNaN(_e.im[te])&&(_e.im[te]=0);FFT.fft1d(_e.re,_e.im);for(var te=h-1;te>=0;te--)ee[te*2*w+se]=_e.re[te],ee[(te*2+1)*w+se]=_e.im[te]}return ee},reconstructTwoRealFFT:function(d,h,p){var m=d.re.length;h.re[0]=d.re[0],h.im[0]=0,p.re[0]=d.im[0],p.im[0]=0;for(var w,M,k,x,L,B=m/2;B>0;B--)L=m-B,w=.5*(d.re[B]-d.re[L]),M=.5*(d.re[B]+d.re[L]),k=.5*(d.im[B]-d.im[L]),x=.5*(d.im[B]+d.im[L]),h.re[B]=M,h.im[B]=k,h.re[L]=M,h.im[L]=-k,p.re[B]=x,p.im[B]=-w,p.re[L]=x,p.im[L]=w},convolute2DI:function(d,h,p,m){for(var w,M,k=0;k<p/2;k++)for(var x=0;x<m;x++)w=d[k*2*m+x]*h[k*2*m+x]-d[(k*2+1)*m+x]*h[(k*2+1)*m+x],M=d[k*2*m+x]*h[(k*2+1)*m+x]+d[(k*2+1)*m+x]*h[k*2*m+x],d[k*2*m+x]=w,d[(k*2+1)*m+x]=M},convolute:function(d,h,p,m,w){for(var M=new Array(m*p),k=0;k<p*m;k++)M[k]=d[k];M=this.fft2DArray(M,p,m);for(var x=h.length,L=h[0].length,B=new Array(m*p),k=0;k<m*p;k++)B[k]=0;for(var $,U,q=Math.floor((x-1)/2),G=Math.floor((L-1)/2),W=0;W<x;W++){$=(W-q+p)%p;for(var te=0;te<L;te++)U=(te-G+m)%m,B[$*m+U]=h[W][te]}B=this.fft2DArray(B,p,m);var oe=p*2,ee=m/2+1;return this.convolute2DI(M,B,oe,ee),this.ifft2DArray(M,oe,ee)},toRadix2:function(d,h,p){var m,w,M,k,x=p,L=h;if(!(p!==0&&(p&p-1)===0)){for(x=0;p>>++x!=0;);x=1<<x}if(!(h!==0&&(h&h-1)===0)){for(L=0;h>>++L!=0;);L=1<<L}if(L==h&&x==p)return{data:d,rows:h,cols:p};var B=new Array(L*x),$=Math.floor((L-h)/2)-h,U=Math.floor((x-p)/2)-p;for(m=0;m<L;m++)for(M=m*x,k=(m-$)%h*p,w=0;w<x;w++)B[M+w]=d[k+(w-U)%p];return{data:B,rows:L,cols:x}},crop:function(d,h,p,m,w,M){if(h==m&&p==w)return d;Object.assign({},M);var k=new Array(w*m),x=Math.floor((h-m)/2),L=Math.floor((p-w)/2),B,$,U,q;for(U=0;U<m;U++)for(B=U*w,$=(U+x)*p,q=0;q<w;q++)k[B+q]=d[$+(q+L)];return k}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(d,h,p){var m=matrix2Array(d),w=m.data,M=Object.assign({normalize:!1,divisor:1,rows:m.rows,cols:m.cols},p),k,x;if(M.rows&&M.cols)k=M.rows,x=M.cols;else throw new Error("Invalid number of rows or columns "+k+" "+x);var L=M.divisor,B,$,U=h.length,q=h[0].length;if(M.normalize)for(L=0,B=0;B<U;B++)for($=0;$<q;$++)L+=h[B][$];if(L===0)throw new RangeError("convolution: The divisor is equal to zero");var G=FFTUtils.toRadix2(w,k,x),W=FFTUtils.convolute(G.data,h,G.rows,G.cols);if(W=FFTUtils.crop(W,G.rows,G.cols,k,x),L!=0&&L!=1)for(B=0;B<W.length;B++)W[B]/=L;return W}function convolutionDirect(d,h,p){var m=matrix2Array(d),w=m.data,M=Object.assign({normalize:!1,divisor:1,rows:m.rows,cols:m.cols},p),k,x;if(M.rows&&M.cols)k=M.rows,x=M.cols;else throw new Error("Invalid number of rows or columns "+k+" "+x);var L=M.divisor,B=h.length,$=h[0].length,U,q,G,W,te,oe,ee,_e,se;if(M.normalize)for(L=0,U=0;U<B;U++)for(q=0;q<$;q++)L+=h[U][q];if(L===0)throw new RangeError("convolution: The divisor is equal to zero");var he=new Array(k*x),ge=Math.floor(B/2),Re=Math.floor($/2);for(W=0;W<k;W++)for(G=0;G<x;G++){for(oe=0,q=0;q<B;q++)for(U=0;U<$;U++)ee=h[B-q-1][$-U-1],_e=(W+q-ge+k)%k,se=(G+U-Re+x)%x,te=_e*x+se,oe+=w[te]*ee;te=W*x+G,he[te]=oe/L}return he}function LoG(d,h,p){var m=1e3;p&&p.factor&&(m=p.factor);var w=new Array(h),M,k,x,L;m*=-1;var B=(h-1)/2,$=2*d*d;for(M=0;M<h;M++)for(w[M]=new Array(h),L=(M-B)*(M-B),k=0;k<h;k++)x=-((k-B)*(k-B)+L)/$,w[M][k]=Math.round(m*(1+x)*Math.exp(x));return w}function matrix2Array(d){var h=d,p,m;if(typeof d[0]!="number"){p=d.length,m=d[0].length,h=new Array(p*m);for(var w=0;w<p;w++)for(var M=0;M<m;M++)h[w*m+M]=d[w][M]}else{var k=Math.sqrt(d.length);Number.isInteger(k)&&(p=k,m=k)}return{data:h,rows:p,cols:m}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(d){return!(typeof d!="number"||d!==d||d===1/0||d===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(d){return typeof d=="number"&&isFinite$1(d)&&Math.floor(d)===d};function validateKernel(d){let h,p;if(Array.isArray(d))if(Array.isArray(d[0])){if((d.length&1)===0||(d[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");h=Math.floor(d.length/2),p=Math.floor(d[0].length/2)}else{let m=Math.sqrt(d.length);if(isInteger(m))p=h=Math.floor(Math.sqrt(d.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let w=new Array(m);for(let M=0;M<m;M++){w[M]=new Array(m);for(let k=0;k<m;k++)w[M][k]=d[M*m+k]}d=w}else throw new Error(`validateKernel: Invalid Kernel: ${d}`);return{kernel:d,kWidth:p,kHeight:h}}function clamp(d,h){return Math.round(Math.min(Math.max(d,0),h.maxValue))}function directConvolution(d,h,p){if(p===void 0){const M=d.length+h.length-1;p=new Array(M)}fill(p);for(var m=0;m<d.length;m++)for(var w=0;w<h.length;w++)p[m+w]+=d[m]*h[w];return p}function fill(d){for(var h=0;h<d.length;h++)d[h]=0}function convolutionSeparable(d,h,p,m){const w=new Array(d.length);let M,k,x,L;L=h[1],x=(L.length-1)/2,k=new Array(p+L.length-1),M=new Array(p);for(let B=0;B<m;B++){for(let $=0;$<p;$++)M[$]=d[B*p+$];directConvolution(M,L,k);for(let $=0;$<p;$++)w[B*p+$]=k[x+$]}L=h[0],x=(L.length-1)/2,k=new Array(m+L.length-1),M=new Array(m);for(let B=0;B<p;B++){for(let $=0;$<m;$++)M[$]=w[$*p+B];directConvolution(M,L,k);for(let $=0;$<m;$++)w[$*p+B]=k[x+$]}return w}const toString$2=Object.prototype.toString;function isAnyArray(d){return toString$2.call(d).endsWith("Array]")}function max$1(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(d))throw new TypeError("input must be an array");if(d.length===0)throw new TypeError("input must not be empty");var p=h.fromIndex,m=p===void 0?0:p,w=h.toIndex,M=w===void 0?d.length:w;if(m<0||m>=d.length||!Number.isInteger(m))throw new Error("fromIndex must be a positive integer smaller than length");if(M<=m||M>d.length||!Number.isInteger(M))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var k=d[m],x=m+1;x<M;x++)d[x]>k&&(k=d[x]);return k}function min$1(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(d))throw new TypeError("input must be an array");if(d.length===0)throw new TypeError("input must not be empty");var p=h.fromIndex,m=p===void 0?0:p,w=h.toIndex,M=w===void 0?d.length:w;if(m<0||m>=d.length||!Number.isInteger(m))throw new Error("fromIndex must be a positive integer smaller than length");if(M<=m||M>d.length||!Number.isInteger(M))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var k=d[m],x=m+1;x<M;x++)d[x]<k&&(k=d[x]);return k}function rescale(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(d)){if(d.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var p;if(h.output!==void 0){if(!isAnyArray(h.output))throw new TypeError("output option must be an array if specified");p=h.output}else p=new Array(d.length);var m=min$1(d),w=max$1(d);if(m===w)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var M=h.min,k=M===void 0?h.autoMinMax?m:0:M,x=h.max,L=x===void 0?h.autoMinMax?w:1:x;if(k>=L)throw new RangeError("min option must be smaller than max option");for(var B=(L-k)/(w-m),$=0;$<d.length;$++)p[$]=(d[$]-m)*B+k;return p}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(d,h={}){const{maxRows:p=15,maxColumns:m=10,maxNumSize:w=8}=h;return`${d.constructor.name} {
${indent}[
${indentData}${inspectData(d,p,m,w)}
${indent}]
${indent}rows: ${d.rows}
${indent}columns: ${d.columns}
}`}function inspectData(d,h,p,m){const{rows:w,columns:M}=d,k=Math.min(w,h),x=Math.min(M,p),L=[];for(let B=0;B<k;B++){let $=[];for(let U=0;U<x;U++)$.push(formatNumber(d.get(B,U),m));L.push(`${$.join(" ")}`)}return x!==M&&(L[L.length-1]+=` ... ${M-p} more columns`),k!==w&&L.push(`... ${w-h} more rows`),L.join(`
${indentData}`)}function formatNumber(d,h){const p=String(d);if(p.length<=h)return p.padEnd(h," ");const m=d.toPrecision(h-2);if(m.length<=h)return m;const w=d.toExponential(h-2),M=w.indexOf("e"),k=w.slice(M);return w.slice(0,h-k.length)+k}function installMathOperations(d,h){d.prototype.add=function(m){return typeof m=="number"?this.addS(m):this.addM(m)},d.prototype.addS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)+m);return this},d.prototype.addM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)+m.get(w,M));return this},d.add=function(m,w){return new h(m).add(w)},d.prototype.sub=function(m){return typeof m=="number"?this.subS(m):this.subM(m)},d.prototype.subS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)-m);return this},d.prototype.subM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)-m.get(w,M));return this},d.sub=function(m,w){return new h(m).sub(w)},d.prototype.subtract=d.prototype.sub,d.prototype.subtractS=d.prototype.subS,d.prototype.subtractM=d.prototype.subM,d.subtract=d.sub,d.prototype.mul=function(m){return typeof m=="number"?this.mulS(m):this.mulM(m)},d.prototype.mulS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)*m);return this},d.prototype.mulM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)*m.get(w,M));return this},d.mul=function(m,w){return new h(m).mul(w)},d.prototype.multiply=d.prototype.mul,d.prototype.multiplyS=d.prototype.mulS,d.prototype.multiplyM=d.prototype.mulM,d.multiply=d.mul,d.prototype.div=function(m){return typeof m=="number"?this.divS(m):this.divM(m)},d.prototype.divS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)/m);return this},d.prototype.divM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)/m.get(w,M));return this},d.div=function(m,w){return new h(m).div(w)},d.prototype.divide=d.prototype.div,d.prototype.divideS=d.prototype.divS,d.prototype.divideM=d.prototype.divM,d.divide=d.div,d.prototype.mod=function(m){return typeof m=="number"?this.modS(m):this.modM(m)},d.prototype.modS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)%m);return this},d.prototype.modM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)%m.get(w,M));return this},d.mod=function(m,w){return new h(m).mod(w)},d.prototype.modulus=d.prototype.mod,d.prototype.modulusS=d.prototype.modS,d.prototype.modulusM=d.prototype.modM,d.modulus=d.mod,d.prototype.and=function(m){return typeof m=="number"?this.andS(m):this.andM(m)},d.prototype.andS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)&m);return this},d.prototype.andM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)&m.get(w,M));return this},d.and=function(m,w){return new h(m).and(w)},d.prototype.or=function(m){return typeof m=="number"?this.orS(m):this.orM(m)},d.prototype.orS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)|m);return this},d.prototype.orM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)|m.get(w,M));return this},d.or=function(m,w){return new h(m).or(w)},d.prototype.xor=function(m){return typeof m=="number"?this.xorS(m):this.xorM(m)},d.prototype.xorS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)^m);return this},d.prototype.xorM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)^m.get(w,M));return this},d.xor=function(m,w){return new h(m).xor(w)},d.prototype.leftShift=function(m){return typeof m=="number"?this.leftShiftS(m):this.leftShiftM(m)},d.prototype.leftShiftS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)<<m);return this},d.prototype.leftShiftM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)<<m.get(w,M));return this},d.leftShift=function(m,w){return new h(m).leftShift(w)},d.prototype.signPropagatingRightShift=function(m){return typeof m=="number"?this.signPropagatingRightShiftS(m):this.signPropagatingRightShiftM(m)},d.prototype.signPropagatingRightShiftS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)>>m);return this},d.prototype.signPropagatingRightShiftM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)>>m.get(w,M));return this},d.signPropagatingRightShift=function(m,w){return new h(m).signPropagatingRightShift(w)},d.prototype.rightShift=function(m){return typeof m=="number"?this.rightShiftS(m):this.rightShiftM(m)},d.prototype.rightShiftS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)>>>m);return this},d.prototype.rightShiftM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,this.get(w,M)>>>m.get(w,M));return this},d.rightShift=function(m,w){return new h(m).rightShift(w)},d.prototype.zeroFillRightShift=d.prototype.rightShift,d.prototype.zeroFillRightShiftS=d.prototype.rightShiftS,d.prototype.zeroFillRightShiftM=d.prototype.rightShiftM,d.zeroFillRightShift=d.rightShift,d.prototype.not=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,~this.get(m,w));return this},d.not=function(m){return new h(m).not()},d.prototype.abs=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.abs(this.get(m,w)));return this},d.abs=function(m){return new h(m).abs()},d.prototype.acos=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.acos(this.get(m,w)));return this},d.acos=function(m){return new h(m).acos()},d.prototype.acosh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.acosh(this.get(m,w)));return this},d.acosh=function(m){return new h(m).acosh()},d.prototype.asin=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.asin(this.get(m,w)));return this},d.asin=function(m){return new h(m).asin()},d.prototype.asinh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.asinh(this.get(m,w)));return this},d.asinh=function(m){return new h(m).asinh()},d.prototype.atan=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.atan(this.get(m,w)));return this},d.atan=function(m){return new h(m).atan()},d.prototype.atanh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.atanh(this.get(m,w)));return this},d.atanh=function(m){return new h(m).atanh()},d.prototype.cbrt=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.cbrt(this.get(m,w)));return this},d.cbrt=function(m){return new h(m).cbrt()},d.prototype.ceil=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.ceil(this.get(m,w)));return this},d.ceil=function(m){return new h(m).ceil()},d.prototype.clz32=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.clz32(this.get(m,w)));return this},d.clz32=function(m){return new h(m).clz32()},d.prototype.cos=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.cos(this.get(m,w)));return this},d.cos=function(m){return new h(m).cos()},d.prototype.cosh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.cosh(this.get(m,w)));return this},d.cosh=function(m){return new h(m).cosh()},d.prototype.exp=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.exp(this.get(m,w)));return this},d.exp=function(m){return new h(m).exp()},d.prototype.expm1=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.expm1(this.get(m,w)));return this},d.expm1=function(m){return new h(m).expm1()},d.prototype.floor=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.floor(this.get(m,w)));return this},d.floor=function(m){return new h(m).floor()},d.prototype.fround=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.fround(this.get(m,w)));return this},d.fround=function(m){return new h(m).fround()},d.prototype.log=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.log(this.get(m,w)));return this},d.log=function(m){return new h(m).log()},d.prototype.log1p=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.log1p(this.get(m,w)));return this},d.log1p=function(m){return new h(m).log1p()},d.prototype.log10=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.log10(this.get(m,w)));return this},d.log10=function(m){return new h(m).log10()},d.prototype.log2=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.log2(this.get(m,w)));return this},d.log2=function(m){return new h(m).log2()},d.prototype.round=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.round(this.get(m,w)));return this},d.round=function(m){return new h(m).round()},d.prototype.sign=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.sign(this.get(m,w)));return this},d.sign=function(m){return new h(m).sign()},d.prototype.sin=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.sin(this.get(m,w)));return this},d.sin=function(m){return new h(m).sin()},d.prototype.sinh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.sinh(this.get(m,w)));return this},d.sinh=function(m){return new h(m).sinh()},d.prototype.sqrt=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.sqrt(this.get(m,w)));return this},d.sqrt=function(m){return new h(m).sqrt()},d.prototype.tan=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.tan(this.get(m,w)));return this},d.tan=function(m){return new h(m).tan()},d.prototype.tanh=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.tanh(this.get(m,w)));return this},d.tanh=function(m){return new h(m).tanh()},d.prototype.trunc=function(){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.set(m,w,Math.trunc(this.get(m,w)));return this},d.trunc=function(m){return new h(m).trunc()},d.pow=function(m,w){return new h(m).pow(w)},d.prototype.pow=function(m){return typeof m=="number"?this.powS(m):this.powM(m)},d.prototype.powS=function(m){for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,Math.pow(this.get(w,M),m));return this},d.prototype.powM=function(m){if(m=h.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let w=0;w<this.rows;w++)for(let M=0;M<this.columns;M++)this.set(w,M,Math.pow(this.get(w,M),m.get(w,M)));return this}}function checkRowIndex(d,h,p){let m=p?d.rows:d.rows-1;if(h<0||h>m)throw new RangeError("Row index out of range")}function checkColumnIndex(d,h,p){let m=p?d.columns:d.columns-1;if(h<0||h>m)throw new RangeError("Column index out of range")}function checkRowVector(d,h){if(h.to1DArray&&(h=h.to1DArray()),h.length!==d.columns)throw new RangeError("vector size must be the same as the number of columns");return h}function checkColumnVector(d,h){if(h.to1DArray&&(h=h.to1DArray()),h.length!==d.rows)throw new RangeError("vector size must be the same as the number of rows");return h}function checkIndices(d,h,p){return{row:checkRowIndices(d,h),column:checkColumnIndices(d,p)}}function checkRowIndices(d,h){if(typeof h!="object")throw new TypeError("unexpected type for row indices");if(h.some(m=>m<0||m>=d.rows))throw new RangeError("row indices are out of range");return Array.isArray(h)||(h=Array.from(h)),h}function checkColumnIndices(d,h){if(typeof h!="object")throw new TypeError("unexpected type for column indices");if(h.some(m=>m<0||m>=d.columns))throw new RangeError("column indices are out of range");return Array.isArray(h)||(h=Array.from(h)),h}function checkRange(d,h,p,m,w){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",h),checkNumber("endRow",p),checkNumber("startColumn",m),checkNumber("endColumn",w),h>p||m>w||h<0||h>=d.rows||p<0||p>=d.rows||m<0||m>=d.columns||w<0||w>=d.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$1(d,h=0){let p=[];for(let m=0;m<d;m++)p.push(h);return p}function checkNumber(d,h){if(typeof h!="number")throw new TypeError(`${d} must be a number`)}function checkNonEmpty(d){if(d.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(d){let h=newArray$1(d.rows);for(let p=0;p<d.rows;++p)for(let m=0;m<d.columns;++m)h[p]+=d.get(p,m);return h}function sumByColumn(d){let h=newArray$1(d.columns);for(let p=0;p<d.rows;++p)for(let m=0;m<d.columns;++m)h[m]+=d.get(p,m);return h}function sumAll(d){let h=0;for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)h+=d.get(p,m);return h}function productByRow(d){let h=newArray$1(d.rows,1);for(let p=0;p<d.rows;++p)for(let m=0;m<d.columns;++m)h[p]*=d.get(p,m);return h}function productByColumn(d){let h=newArray$1(d.columns,1);for(let p=0;p<d.rows;++p)for(let m=0;m<d.columns;++m)h[m]*=d.get(p,m);return h}function productAll(d){let h=1;for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)h*=d.get(p,m);return h}function varianceByRow(d,h,p){const m=d.rows,w=d.columns,M=[];for(let k=0;k<m;k++){let x=0,L=0,B=0;for(let $=0;$<w;$++)B=d.get(k,$)-p[k],x+=B,L+=B*B;h?M.push((L-x*x/w)/(w-1)):M.push((L-x*x/w)/w)}return M}function varianceByColumn(d,h,p){const m=d.rows,w=d.columns,M=[];for(let k=0;k<w;k++){let x=0,L=0,B=0;for(let $=0;$<m;$++)B=d.get($,k)-p[k],x+=B,L+=B*B;h?M.push((L-x*x/m)/(m-1)):M.push((L-x*x/m)/m)}return M}function varianceAll(d,h,p){const m=d.rows,w=d.columns,M=m*w;let k=0,x=0,L=0;for(let B=0;B<m;B++)for(let $=0;$<w;$++)L=d.get(B,$)-p,k+=L,x+=L*L;return h?(x-k*k/M)/(M-1):(x-k*k/M)/M}function centerByRow(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)-h[p])}function centerByColumn(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)-h[m])}function centerAll(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)-h)}function getScaleByRow(d){const h=[];for(let p=0;p<d.rows;p++){let m=0;for(let w=0;w<d.columns;w++)m+=Math.pow(d.get(p,w),2)/(d.columns-1);h.push(Math.sqrt(m))}return h}function scaleByRow(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)/h[p])}function getScaleByColumn(d){const h=[];for(let p=0;p<d.columns;p++){let m=0;for(let w=0;w<d.rows;w++)m+=Math.pow(d.get(w,p),2)/(d.rows-1);h.push(Math.sqrt(m))}return h}function scaleByColumn(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)/h[m])}function getScaleAll(d){const h=d.size-1;let p=0;for(let m=0;m<d.columns;m++)for(let w=0;w<d.rows;w++)p+=Math.pow(d.get(w,m),2)/h;return Math.sqrt(p)}function scaleAll(d,h){for(let p=0;p<d.rows;p++)for(let m=0;m<d.columns;m++)d.set(p,m,d.get(p,m)/h)}class AbstractMatrix{static from1DArray(h,p,m){if(h*p!==m.length)throw new RangeError("data length does not match given dimensions");let M=new Matrix$2(h,p);for(let k=0;k<h;k++)for(let x=0;x<p;x++)M.set(k,x,m[k*p+x]);return M}static rowVector(h){let p=new Matrix$2(1,h.length);for(let m=0;m<h.length;m++)p.set(0,m,h[m]);return p}static columnVector(h){let p=new Matrix$2(h.length,1);for(let m=0;m<h.length;m++)p.set(m,0,h[m]);return p}static zeros(h,p){return new Matrix$2(h,p)}static ones(h,p){return new Matrix$2(h,p).fill(1)}static rand(h,p,m={}){if(typeof m!="object")throw new TypeError("options must be an object");const{random:w=Math.random}=m;let M=new Matrix$2(h,p);for(let k=0;k<h;k++)for(let x=0;x<p;x++)M.set(k,x,w());return M}static randInt(h,p,m={}){if(typeof m!="object")throw new TypeError("options must be an object");const{min:w=0,max:M=1e3,random:k=Math.random}=m;if(!Number.isInteger(w))throw new TypeError("min must be an integer");if(!Number.isInteger(M))throw new TypeError("max must be an integer");if(w>=M)throw new RangeError("min must be smaller than max");let x=M-w,L=new Matrix$2(h,p);for(let B=0;B<h;B++)for(let $=0;$<p;$++){let U=w+Math.round(k()*x);L.set(B,$,U)}return L}static eye(h,p,m){p===void 0&&(p=h),m===void 0&&(m=1);let w=Math.min(h,p),M=this.zeros(h,p);for(let k=0;k<w;k++)M.set(k,k,m);return M}static diag(h,p,m){let w=h.length;p===void 0&&(p=w),m===void 0&&(m=p);let M=Math.min(w,p,m),k=this.zeros(p,m);for(let x=0;x<M;x++)k.set(x,x,h[x]);return k}static min(h,p){h=this.checkMatrix(h),p=this.checkMatrix(p);let m=h.rows,w=h.columns,M=new Matrix$2(m,w);for(let k=0;k<m;k++)for(let x=0;x<w;x++)M.set(k,x,Math.min(h.get(k,x),p.get(k,x)));return M}static max(h,p){h=this.checkMatrix(h),p=this.checkMatrix(p);let m=h.rows,w=h.columns,M=new this(m,w);for(let k=0;k<m;k++)for(let x=0;x<w;x++)M.set(k,x,Math.max(h.get(k,x),p.get(k,x)));return M}static checkMatrix(h){return AbstractMatrix.isMatrix(h)?h:new Matrix$2(h)}static isMatrix(h){return h!=null&&h.klass==="Matrix"}get size(){return this.rows*this.columns}apply(h){if(typeof h!="function")throw new TypeError("callback must be a function");for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)h.call(this,p,m);return this}to1DArray(){let h=[];for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)h.push(this.get(p,m));return h}to2DArray(){let h=[];for(let p=0;p<this.rows;p++){h.push([]);for(let m=0;m<this.columns;m++)h[p].push(this.get(p,m))}return h}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let h=0;h<this.rows;h++)for(let p=0;p<=h;p++)if(this.get(h,p)!==this.get(p,h))return!1;return!0}return!1}isEchelonForm(){let h=0,p=0,m=-1,w=!0,M=!1;for(;h<this.rows&&w;){for(p=0,M=!1;p<this.columns&&M===!1;)this.get(h,p)===0?p++:this.get(h,p)===1&&p>m?(M=!0,m=p):(w=!1,M=!0);h++}return w}isReducedEchelonForm(){let h=0,p=0,m=-1,w=!0,M=!1;for(;h<this.rows&&w;){for(p=0,M=!1;p<this.columns&&M===!1;)this.get(h,p)===0?p++:this.get(h,p)===1&&p>m?(M=!0,m=p):(w=!1,M=!0);for(let k=p+1;k<this.rows;k++)this.get(h,k)!==0&&(w=!1);h++}return w}echelonForm(){let h=this.clone(),p=0,m=0;for(;p<h.rows&&m<h.columns;){let w=p;for(let M=p;M<h.rows;M++)h.get(M,m)>h.get(w,m)&&(w=M);if(h.get(w,m)===0)m++;else{h.swapRows(p,w);let M=h.get(p,m);for(let k=m;k<h.columns;k++)h.set(p,k,h.get(p,k)/M);for(let k=p+1;k<h.rows;k++){let x=h.get(k,m)/h.get(p,m);h.set(k,m,0);for(let L=m+1;L<h.columns;L++)h.set(k,L,h.get(k,L)-h.get(p,L)*x)}p++,m++}}return h}reducedEchelonForm(){let h=this.echelonForm(),p=h.columns,m=h.rows,w=m-1;for(;w>=0;)if(h.maxRow(w)===0)w--;else{let M=0,k=!1;for(;M<m&&k===!1;)h.get(w,M)===1?k=!0:M++;for(let x=0;x<w;x++){let L=h.get(x,M);for(let B=M;B<p;B++){let $=h.get(x,B)-L*h.get(w,B);h.set(x,B,$)}}w--}return h}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(h={}){if(typeof h!="object")throw new TypeError("options must be an object");const{rows:p=1,columns:m=1}=h;if(!Number.isInteger(p)||p<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(m)||m<=0)throw new TypeError("columns must be a positive integer");let w=new Matrix$2(this.rows*p,this.columns*m);for(let M=0;M<p;M++)for(let k=0;k<m;k++)w.setSubMatrix(this,this.rows*M,this.columns*k);return w}fill(h){for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,h);return this}neg(){return this.mulS(-1)}getRow(h){checkRowIndex(this,h);let p=[];for(let m=0;m<this.columns;m++)p.push(this.get(h,m));return p}getRowVector(h){return Matrix$2.rowVector(this.getRow(h))}setRow(h,p){checkRowIndex(this,h),p=checkRowVector(this,p);for(let m=0;m<this.columns;m++)this.set(h,m,p[m]);return this}swapRows(h,p){checkRowIndex(this,h),checkRowIndex(this,p);for(let m=0;m<this.columns;m++){let w=this.get(h,m);this.set(h,m,this.get(p,m)),this.set(p,m,w)}return this}getColumn(h){checkColumnIndex(this,h);let p=[];for(let m=0;m<this.rows;m++)p.push(this.get(m,h));return p}getColumnVector(h){return Matrix$2.columnVector(this.getColumn(h))}setColumn(h,p){checkColumnIndex(this,h),p=checkColumnVector(this,p);for(let m=0;m<this.rows;m++)this.set(m,h,p[m]);return this}swapColumns(h,p){checkColumnIndex(this,h),checkColumnIndex(this,p);for(let m=0;m<this.rows;m++){let w=this.get(m,h);this.set(m,h,this.get(m,p)),this.set(m,p,w)}return this}addRowVector(h){h=checkRowVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)+h[m]);return this}subRowVector(h){h=checkRowVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)-h[m]);return this}mulRowVector(h){h=checkRowVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)*h[m]);return this}divRowVector(h){h=checkRowVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)/h[m]);return this}addColumnVector(h){h=checkColumnVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)+h[p]);return this}subColumnVector(h){h=checkColumnVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)-h[p]);return this}mulColumnVector(h){h=checkColumnVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)*h[p]);return this}divColumnVector(h){h=checkColumnVector(this,h);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.set(p,m,this.get(p,m)/h[p]);return this}mulRow(h,p){checkRowIndex(this,h);for(let m=0;m<this.columns;m++)this.set(h,m,this.get(h,m)*p);return this}mulColumn(h,p){checkColumnIndex(this,h);for(let m=0;m<this.rows;m++)this.set(m,h,this.get(m,h)*p);return this}max(){if(this.isEmpty())return NaN;let h=this.get(0,0);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.get(p,m)>h&&(h=this.get(p,m));return h}maxIndex(){checkNonEmpty(this);let h=this.get(0,0),p=[0,0];for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.get(m,w)>h&&(h=this.get(m,w),p[0]=m,p[1]=w);return p}min(){if(this.isEmpty())return NaN;let h=this.get(0,0);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)this.get(p,m)<h&&(h=this.get(p,m));return h}minIndex(){checkNonEmpty(this);let h=this.get(0,0),p=[0,0];for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)this.get(m,w)<h&&(h=this.get(m,w),p[0]=m,p[1]=w);return p}maxRow(h){if(checkRowIndex(this,h),this.isEmpty())return NaN;let p=this.get(h,0);for(let m=1;m<this.columns;m++)this.get(h,m)>p&&(p=this.get(h,m));return p}maxRowIndex(h){checkRowIndex(this,h),checkNonEmpty(this);let p=this.get(h,0),m=[h,0];for(let w=1;w<this.columns;w++)this.get(h,w)>p&&(p=this.get(h,w),m[1]=w);return m}minRow(h){if(checkRowIndex(this,h),this.isEmpty())return NaN;let p=this.get(h,0);for(let m=1;m<this.columns;m++)this.get(h,m)<p&&(p=this.get(h,m));return p}minRowIndex(h){checkRowIndex(this,h),checkNonEmpty(this);let p=this.get(h,0),m=[h,0];for(let w=1;w<this.columns;w++)this.get(h,w)<p&&(p=this.get(h,w),m[1]=w);return m}maxColumn(h){if(checkColumnIndex(this,h),this.isEmpty())return NaN;let p=this.get(0,h);for(let m=1;m<this.rows;m++)this.get(m,h)>p&&(p=this.get(m,h));return p}maxColumnIndex(h){checkColumnIndex(this,h),checkNonEmpty(this);let p=this.get(0,h),m=[0,h];for(let w=1;w<this.rows;w++)this.get(w,h)>p&&(p=this.get(w,h),m[0]=w);return m}minColumn(h){if(checkColumnIndex(this,h),this.isEmpty())return NaN;let p=this.get(0,h);for(let m=1;m<this.rows;m++)this.get(m,h)<p&&(p=this.get(m,h));return p}minColumnIndex(h){checkColumnIndex(this,h),checkNonEmpty(this);let p=this.get(0,h),m=[0,h];for(let w=1;w<this.rows;w++)this.get(w,h)<p&&(p=this.get(w,h),m[0]=w);return m}diag(){let h=Math.min(this.rows,this.columns),p=[];for(let m=0;m<h;m++)p.push(this.get(m,m));return p}norm(h="frobenius"){let p=0;if(h==="max")return this.max();if(h==="frobenius"){for(let m=0;m<this.rows;m++)for(let w=0;w<this.columns;w++)p=p+this.get(m,w)*this.get(m,w);return Math.sqrt(p)}else throw new RangeError(`unknown norm type: ${h}`)}cumulativeSum(){let h=0;for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)h+=this.get(p,m),this.set(p,m,h);return this}dot(h){AbstractMatrix.isMatrix(h)&&(h=h.to1DArray());let p=this.to1DArray();if(p.length!==h.length)throw new RangeError("vectors do not have the same size");let m=0;for(let w=0;w<p.length;w++)m+=p[w]*h[w];return m}mmul(h){h=Matrix$2.checkMatrix(h);let p=this.rows,m=this.columns,w=h.columns,M=new Matrix$2(p,w),k=new Float64Array(m);for(let x=0;x<w;x++){for(let L=0;L<m;L++)k[L]=h.get(L,x);for(let L=0;L<p;L++){let B=0;for(let $=0;$<m;$++)B+=this.get(L,$)*k[$];M.set(L,x,B)}}return M}strassen2x2(h){h=Matrix$2.checkMatrix(h);let p=new Matrix$2(2,2);const m=this.get(0,0),w=h.get(0,0),M=this.get(0,1),k=h.get(0,1),x=this.get(1,0),L=h.get(1,0),B=this.get(1,1),$=h.get(1,1),U=(m+B)*(w+$),q=(x+B)*w,G=m*(k-$),W=B*(L-w),te=(m+M)*$,oe=(x-m)*(w+k),ee=(M-B)*(L+$),_e=U+W-te+ee,se=G+te,he=q+W,ge=U-q+G+oe;return p.set(0,0,_e),p.set(0,1,se),p.set(1,0,he),p.set(1,1,ge),p}strassen3x3(h){h=Matrix$2.checkMatrix(h);let p=new Matrix$2(3,3);const m=this.get(0,0),w=this.get(0,1),M=this.get(0,2),k=this.get(1,0),x=this.get(1,1),L=this.get(1,2),B=this.get(2,0),$=this.get(2,1),U=this.get(2,2),q=h.get(0,0),G=h.get(0,1),W=h.get(0,2),te=h.get(1,0),oe=h.get(1,1),ee=h.get(1,2),_e=h.get(2,0),se=h.get(2,1),he=h.get(2,2),ge=(m+w+M-k-x-$-U)*oe,Re=(m-k)*(-G+oe),ve=x*(-q+G+te-oe-ee-_e+he),de=(-m+k+x)*(q-G+oe),Se=(k+x)*(-q+G),ce=m*q,ye=(-m+B+$)*(q-W+ee),ze=(-m+B)*(W-ee),Xe=(B+$)*(-q+W),at=(m+w+M-x-L-B-$)*ee,ct=$*(-q+W+te-oe-ee-_e+se),Bt=(-M+$+U)*(oe+_e-se),Lt=(M-U)*(oe-se),It=M*_e,Vt=($+U)*(-_e+se),Ft=(-M+x+L)*(ee+_e-he),Mt=(M-L)*(ee-he),ri=(x+L)*(-_e+he),St=w*te,At=L*se,Et=k*W,Ut=B*G,jt=U*he,mi=ce+It+St,oi=ge+de+Se+ce+Bt+It+Vt,yi=ce+ye+Xe+at+It+Ft+ri,xi=Re+ve+de+ce+It+Ft+Mt,Bi=Re+de+Se+ce+At,fi=It+Ft+Mt+ri+Et,mt=ce+ye+ze+ct+Bt+Lt+It,vt=Bt+Lt+It+Vt+Ut,pi=ce+ye+ze+Xe+jt;return p.set(0,0,mi),p.set(0,1,oi),p.set(0,2,yi),p.set(1,0,xi),p.set(1,1,Bi),p.set(1,2,fi),p.set(2,0,mt),p.set(2,1,vt),p.set(2,2,pi),p}mmulStrassen(h){h=Matrix$2.checkMatrix(h);let p=this.clone(),m=p.rows,w=p.columns,M=h.rows,k=h.columns;w!==M&&console.warn(`Multiplying ${m} x ${w} and ${M} x ${k} matrix: dimensions do not match.`);function x(U,q,G){let W=U.rows,te=U.columns;if(W===q&&te===G)return U;{let oe=AbstractMatrix.zeros(q,G);return oe=oe.setSubMatrix(U,0,0),oe}}let L=Math.max(m,M),B=Math.max(w,k);p=x(p,L,B),h=x(h,L,B);function $(U,q,G,W){if(G<=512||W<=512)return U.mmul(q);G%2===1&&W%2===1?(U=x(U,G+1,W+1),q=x(q,G+1,W+1)):G%2===1?(U=x(U,G+1,W),q=x(q,G+1,W)):W%2===1&&(U=x(U,G,W+1),q=x(q,G,W+1));let te=parseInt(U.rows/2,10),oe=parseInt(U.columns/2,10),ee=U.subMatrix(0,te-1,0,oe-1),_e=q.subMatrix(0,te-1,0,oe-1),se=U.subMatrix(0,te-1,oe,U.columns-1),he=q.subMatrix(0,te-1,oe,q.columns-1),ge=U.subMatrix(te,U.rows-1,0,oe-1),Re=q.subMatrix(te,q.rows-1,0,oe-1),ve=U.subMatrix(te,U.rows-1,oe,U.columns-1),de=q.subMatrix(te,q.rows-1,oe,q.columns-1),Se=$(AbstractMatrix.add(ee,ve),AbstractMatrix.add(_e,de),te,oe),ce=$(AbstractMatrix.add(ge,ve),_e,te,oe),ye=$(ee,AbstractMatrix.sub(he,de),te,oe),ze=$(ve,AbstractMatrix.sub(Re,_e),te,oe),Xe=$(AbstractMatrix.add(ee,se),de,te,oe),at=$(AbstractMatrix.sub(ge,ee),AbstractMatrix.add(_e,he),te,oe),ct=$(AbstractMatrix.sub(se,ve),AbstractMatrix.add(Re,de),te,oe),Bt=AbstractMatrix.add(Se,ze);Bt.sub(Xe),Bt.add(ct);let Lt=AbstractMatrix.add(ye,Xe),It=AbstractMatrix.add(ce,ze),Vt=AbstractMatrix.sub(Se,ce);Vt.add(ye),Vt.add(at);let Ft=AbstractMatrix.zeros(2*Bt.rows,2*Bt.columns);return Ft=Ft.setSubMatrix(Bt,0,0),Ft=Ft.setSubMatrix(Lt,Bt.rows,0),Ft=Ft.setSubMatrix(It,0,Bt.columns),Ft=Ft.setSubMatrix(Vt,Bt.rows,Bt.columns),Ft.subMatrix(0,G-1,0,W-1)}return $(p,h,L,B)}scaleRows(h={}){if(typeof h!="object")throw new TypeError("options must be an object");const{min:p=0,max:m=1}=h;if(!Number.isFinite(p))throw new TypeError("min must be a number");if(!Number.isFinite(m))throw new TypeError("max must be a number");if(p>=m)throw new RangeError("min must be smaller than max");let w=new Matrix$2(this.rows,this.columns);for(let M=0;M<this.rows;M++){const k=this.getRow(M);k.length>0&&rescale(k,{min:p,max:m,output:k}),w.setRow(M,k)}return w}scaleColumns(h={}){if(typeof h!="object")throw new TypeError("options must be an object");const{min:p=0,max:m=1}=h;if(!Number.isFinite(p))throw new TypeError("min must be a number");if(!Number.isFinite(m))throw new TypeError("max must be a number");if(p>=m)throw new RangeError("min must be smaller than max");let w=new Matrix$2(this.rows,this.columns);for(let M=0;M<this.columns;M++){const k=this.getColumn(M);k.length&&rescale(k,{min:p,max:m,output:k}),w.setColumn(M,k)}return w}flipRows(){const h=Math.ceil(this.columns/2);for(let p=0;p<this.rows;p++)for(let m=0;m<h;m++){let w=this.get(p,m),M=this.get(p,this.columns-1-m);this.set(p,m,M),this.set(p,this.columns-1-m,w)}return this}flipColumns(){const h=Math.ceil(this.rows/2);for(let p=0;p<this.columns;p++)for(let m=0;m<h;m++){let w=this.get(m,p),M=this.get(this.rows-1-m,p);this.set(m,p,M),this.set(this.rows-1-m,p,w)}return this}kroneckerProduct(h){h=Matrix$2.checkMatrix(h);let p=this.rows,m=this.columns,w=h.rows,M=h.columns,k=new Matrix$2(p*w,m*M);for(let x=0;x<p;x++)for(let L=0;L<m;L++)for(let B=0;B<w;B++)for(let $=0;$<M;$++)k.set(w*x+B,M*L+$,this.get(x,L)*h.get(B,$));return k}kroneckerSum(h){if(h=Matrix$2.checkMatrix(h),!this.isSquare()||!h.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let p=this.rows,m=h.rows,w=this.kroneckerProduct(Matrix$2.eye(m,m)),M=Matrix$2.eye(p,p).kroneckerProduct(h);return w.add(M)}transpose(){let h=new Matrix$2(this.columns,this.rows);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)h.set(m,p,this.get(p,m));return h}sortRows(h=compareNumbers){for(let p=0;p<this.rows;p++)this.setRow(p,this.getRow(p).sort(h));return this}sortColumns(h=compareNumbers){for(let p=0;p<this.columns;p++)this.setColumn(p,this.getColumn(p).sort(h));return this}subMatrix(h,p,m,w){checkRange(this,h,p,m,w);let M=new Matrix$2(p-h+1,w-m+1);for(let k=h;k<=p;k++)for(let x=m;x<=w;x++)M.set(k-h,x-m,this.get(k,x));return M}subMatrixRow(h,p,m){if(p===void 0&&(p=0),m===void 0&&(m=this.columns-1),p>m||p<0||p>=this.columns||m<0||m>=this.columns)throw new RangeError("Argument out of range");let w=new Matrix$2(h.length,m-p+1);for(let M=0;M<h.length;M++)for(let k=p;k<=m;k++){if(h[M]<0||h[M]>=this.rows)throw new RangeError(`Row index out of range: ${h[M]}`);w.set(M,k-p,this.get(h[M],k))}return w}subMatrixColumn(h,p,m){if(p===void 0&&(p=0),m===void 0&&(m=this.rows-1),p>m||p<0||p>=this.rows||m<0||m>=this.rows)throw new RangeError("Argument out of range");let w=new Matrix$2(m-p+1,h.length);for(let M=0;M<h.length;M++)for(let k=p;k<=m;k++){if(h[M]<0||h[M]>=this.columns)throw new RangeError(`Column index out of range: ${h[M]}`);w.set(k-p,M,this.get(k,h[M]))}return w}setSubMatrix(h,p,m){if(h=Matrix$2.checkMatrix(h),h.isEmpty())return this;let w=p+h.rows-1,M=m+h.columns-1;checkRange(this,p,w,m,M);for(let k=0;k<h.rows;k++)for(let x=0;x<h.columns;x++)this.set(p+k,m+x,h.get(k,x));return this}selection(h,p){let m=checkIndices(this,h,p),w=new Matrix$2(h.length,p.length);for(let M=0;M<m.row.length;M++){let k=m.row[M];for(let x=0;x<m.column.length;x++){let L=m.column[x];w.set(M,x,this.get(k,L))}}return w}trace(){let h=Math.min(this.rows,this.columns),p=0;for(let m=0;m<h;m++)p+=this.get(m,m);return p}clone(){let h=new Matrix$2(this.rows,this.columns);for(let p=0;p<this.rows;p++)for(let m=0;m<this.columns;m++)h.set(p,m,this.get(p,m));return h}sum(h){switch(h){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${h}`)}}product(h){switch(h){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${h}`)}}mean(h){const p=this.sum(h);switch(h){case"row":{for(let m=0;m<this.rows;m++)p[m]/=this.columns;return p}case"column":{for(let m=0;m<this.columns;m++)p[m]/=this.rows;return p}case void 0:return p/this.size;default:throw new Error(`invalid option: ${h}`)}}variance(h,p={}){if(typeof h=="object"&&(p=h,h=void 0),typeof p!="object")throw new TypeError("options must be an object");const{unbiased:m=!0,mean:w=this.mean(h)}=p;if(typeof m!="boolean")throw new TypeError("unbiased must be a boolean");switch(h){case"row":{if(!Array.isArray(w))throw new TypeError("mean must be an array");return varianceByRow(this,m,w)}case"column":{if(!Array.isArray(w))throw new TypeError("mean must be an array");return varianceByColumn(this,m,w)}case void 0:{if(typeof w!="number")throw new TypeError("mean must be a number");return varianceAll(this,m,w)}default:throw new Error(`invalid option: ${h}`)}}standardDeviation(h,p){typeof h=="object"&&(p=h,h=void 0);const m=this.variance(h,p);if(h===void 0)return Math.sqrt(m);for(let w=0;w<m.length;w++)m[w]=Math.sqrt(m[w]);return m}center(h,p={}){if(typeof h=="object"&&(p=h,h=void 0),typeof p!="object")throw new TypeError("options must be an object");const{center:m=this.mean(h)}=p;switch(h){case"row":{if(!Array.isArray(m))throw new TypeError("center must be an array");return centerByRow(this,m),this}case"column":{if(!Array.isArray(m))throw new TypeError("center must be an array");return centerByColumn(this,m),this}case void 0:{if(typeof m!="number")throw new TypeError("center must be a number");return centerAll(this,m),this}default:throw new Error(`invalid option: ${h}`)}}scale(h,p={}){if(typeof h=="object"&&(p=h,h=void 0),typeof p!="object")throw new TypeError("options must be an object");let m=p.scale;switch(h){case"row":{if(m===void 0)m=getScaleByRow(this);else if(!Array.isArray(m))throw new TypeError("scale must be an array");return scaleByRow(this,m),this}case"column":{if(m===void 0)m=getScaleByColumn(this);else if(!Array.isArray(m))throw new TypeError("scale must be an array");return scaleByColumn(this,m),this}case void 0:{if(m===void 0)m=getScaleAll(this);else if(typeof m!="number")throw new TypeError("scale must be a number");return scaleAll(this,m),this}default:throw new Error(`invalid option: ${h}`)}}toString(h){return inspectMatrixWithOptions(this,h)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol!="undefined"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(d,h){return d-h}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix$2 extends AbstractMatrix{constructor(h,p){super();if(Matrix$2.isMatrix(h))return h.clone();if(Number.isInteger(h)&&h>=0)if(this.data=[],Number.isInteger(p)&&p>=0)for(let m=0;m<h;m++)this.data.push(new Float64Array(p));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(h)){const m=h;if(h=m.length,p=h?m[0].length:0,typeof p!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let w=0;w<h;w++){if(m[w].length!==p)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(m[w]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=h,this.columns=p}set(h,p,m){return this.data[h][p]=m,this}get(h,p){return this.data[h][p]}removeRow(h){return checkRowIndex(this,h),this.data.splice(h,1),this.rows-=1,this}addRow(h,p){return p===void 0&&(p=h,h=this.rows),checkRowIndex(this,h,!0),p=Float64Array.from(checkRowVector(this,p)),this.data.splice(h,0,p),this.rows+=1,this}removeColumn(h){checkColumnIndex(this,h);for(let p=0;p<this.rows;p++){const m=new Float64Array(this.columns-1);for(let w=0;w<h;w++)m[w]=this.data[p][w];for(let w=h+1;w<this.columns;w++)m[w-1]=this.data[p][w];this.data[p]=m}return this.columns-=1,this}addColumn(h,p){typeof p=="undefined"&&(p=h,h=this.columns),checkColumnIndex(this,h,!0),p=checkColumnVector(this,p);for(let m=0;m<this.rows;m++){const w=new Float64Array(this.columns+1);let M=0;for(;M<h;M++)w[M]=this.data[m][M];for(w[M++]=p[m];M<this.columns+1;M++)w[M]=this.data[m][M-1];this.data[m]=w}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(h,p,m){super();this.matrix=h,this.rows=p,this.columns=m}}class MatrixColumnView extends BaseView{constructor(h,p){checkColumnIndex(h,p);super(h,h.rows,1);this.column=p}set(h,p,m){return this.matrix.set(h,this.column,m),this}get(h){return this.matrix.get(h,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(h,p){p=checkColumnIndices(h,p);super(h,h.rows,p.length);this.columnIndices=p}set(h,p,m){return this.matrix.set(h,this.columnIndices[p],m),this}get(h,p){return this.matrix.get(h,this.columnIndices[p])}}class MatrixFlipColumnView extends BaseView{constructor(h){super(h,h.rows,h.columns)}set(h,p,m){return this.matrix.set(h,this.columns-p-1,m),this}get(h,p){return this.matrix.get(h,this.columns-p-1)}}class MatrixFlipRowView extends BaseView{constructor(h){super(h,h.rows,h.columns)}set(h,p,m){return this.matrix.set(this.rows-h-1,p,m),this}get(h,p){return this.matrix.get(this.rows-h-1,p)}}class MatrixRowView extends BaseView{constructor(h,p){checkRowIndex(h,p);super(h,1,h.columns);this.row=p}set(h,p,m){return this.matrix.set(this.row,p,m),this}get(h,p){return this.matrix.get(this.row,p)}}class MatrixRowSelectionView extends BaseView{constructor(h,p){p=checkRowIndices(h,p);super(h,p.length,h.columns);this.rowIndices=p}set(h,p,m){return this.matrix.set(this.rowIndices[h],p,m),this}get(h,p){return this.matrix.get(this.rowIndices[h],p)}}class MatrixSelectionView extends BaseView{constructor(h,p,m){let w=checkIndices(h,p,m);super(h,w.row.length,w.column.length);this.rowIndices=w.row,this.columnIndices=w.column}set(h,p,m){return this.matrix.set(this.rowIndices[h],this.columnIndices[p],m),this}get(h,p){return this.matrix.get(this.rowIndices[h],this.columnIndices[p])}}class MatrixSubView extends BaseView{constructor(h,p,m,w,M){checkRange(h,p,m,w,M);super(h,m-p+1,M-w+1);this.startRow=p,this.startColumn=w}set(h,p,m){return this.matrix.set(this.startRow+h,this.startColumn+p,m),this}get(h,p){return this.matrix.get(this.startRow+h,this.startColumn+p)}}class MatrixTransposeView$1 extends BaseView{constructor(h){super(h,h.columns,h.rows)}set(h,p,m){return this.matrix.set(p,h,m),this}get(h,p){return this.matrix.get(p,h)}}class WrapperMatrix1D extends AbstractMatrix{constructor(h,p={}){const{rows:m=1}=p;if(h.length%m!==0)throw new Error("the data length is not divisible by the number of rows");super();this.rows=m,this.columns=h.length/m,this.data=h}set(h,p,m){let w=this._calculateIndex(h,p);return this.data[w]=m,this}get(h,p){let m=this._calculateIndex(h,p);return this.data[m]}_calculateIndex(h,p){return h*this.columns+p}}class WrapperMatrix2D extends AbstractMatrix{constructor(h){super();this.data=h,this.rows=h.length,this.columns=h[0].length}set(h,p,m){return this.data[h][p]=m,this}get(h,p){return this.data[h][p]}}function wrap(d,h){if(Array.isArray(d))return d[0]&&Array.isArray(d[0])?new WrapperMatrix2D(d):new WrapperMatrix1D(d,h);throw new Error("the argument is not an array")}class LuDecomposition{constructor(h){h=WrapperMatrix2D.checkMatrix(h);let p=h.clone(),m=p.rows,w=p.columns,M=new Float64Array(m),k=1,x,L,B,$,U,q,G,W,te;for(x=0;x<m;x++)M[x]=x;for(W=new Float64Array(m),L=0;L<w;L++){for(x=0;x<m;x++)W[x]=p.get(x,L);for(x=0;x<m;x++){for(te=Math.min(x,L),U=0,B=0;B<te;B++)U+=p.get(x,B)*W[B];W[x]-=U,p.set(x,L,W[x])}for($=L,x=L+1;x<m;x++)Math.abs(W[x])>Math.abs(W[$])&&($=x);if($!==L){for(B=0;B<w;B++)q=p.get($,B),p.set($,B,p.get(L,B)),p.set(L,B,q);G=M[$],M[$]=M[L],M[L]=G,k=-k}if(L<m&&p.get(L,L)!==0)for(x=L+1;x<m;x++)p.set(x,L,p.get(x,L)/p.get(L,L))}this.LU=p,this.pivotVector=M,this.pivotSign=k}isSingular(){let h=this.LU,p=h.columns;for(let m=0;m<p;m++)if(h.get(m,m)===0)return!0;return!1}solve(h){h=Matrix$2.checkMatrix(h);let p=this.LU;if(p.rows!==h.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let w=h.columns,M=h.subMatrixRow(this.pivotVector,0,w-1),k=p.columns,x,L,B;for(B=0;B<k;B++)for(x=B+1;x<k;x++)for(L=0;L<w;L++)M.set(x,L,M.get(x,L)-M.get(B,L)*p.get(x,B));for(B=k-1;B>=0;B--){for(L=0;L<w;L++)M.set(B,L,M.get(B,L)/p.get(B,B));for(x=0;x<B;x++)for(L=0;L<w;L++)M.set(x,L,M.get(x,L)-M.get(B,L)*p.get(x,B))}return M}get determinant(){let h=this.LU;if(!h.isSquare())throw new Error("Matrix must be square");let p=this.pivotSign,m=h.columns;for(let w=0;w<m;w++)p*=h.get(w,w);return p}get lowerTriangularMatrix(){let h=this.LU,p=h.rows,m=h.columns,w=new Matrix$2(p,m);for(let M=0;M<p;M++)for(let k=0;k<m;k++)M>k?w.set(M,k,h.get(M,k)):M===k?w.set(M,k,1):w.set(M,k,0);return w}get upperTriangularMatrix(){let h=this.LU,p=h.rows,m=h.columns,w=new Matrix$2(p,m);for(let M=0;M<p;M++)for(let k=0;k<m;k++)M<=k?w.set(M,k,h.get(M,k)):w.set(M,k,0);return w}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(d,h){let p=0;return Math.abs(d)>Math.abs(h)?(p=h/d,Math.abs(d)*Math.sqrt(1+p*p)):h!==0?(p=d/h,Math.abs(h)*Math.sqrt(1+p*p)):0}class QrDecomposition{constructor(h){h=WrapperMatrix2D.checkMatrix(h);let p=h.clone(),m=h.rows,w=h.columns,M=new Float64Array(w),k,x,L,B;for(L=0;L<w;L++){let $=0;for(k=L;k<m;k++)$=hypotenuse$1($,p.get(k,L));if($!==0){for(p.get(L,L)<0&&($=-$),k=L;k<m;k++)p.set(k,L,p.get(k,L)/$);for(p.set(L,L,p.get(L,L)+1),x=L+1;x<w;x++){for(B=0,k=L;k<m;k++)B+=p.get(k,L)*p.get(k,x);for(B=-B/p.get(L,L),k=L;k<m;k++)p.set(k,x,p.get(k,x)+B*p.get(k,L))}}M[L]=-$}this.QR=p,this.Rdiag=M}solve(h){h=Matrix$2.checkMatrix(h);let p=this.QR,m=p.rows;if(h.rows!==m)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let w=h.columns,M=h.clone(),k=p.columns,x,L,B,$;for(B=0;B<k;B++)for(L=0;L<w;L++){for($=0,x=B;x<m;x++)$+=p.get(x,B)*M.get(x,L);for($=-$/p.get(B,B),x=B;x<m;x++)M.set(x,L,M.get(x,L)+$*p.get(x,B))}for(B=k-1;B>=0;B--){for(L=0;L<w;L++)M.set(B,L,M.get(B,L)/this.Rdiag[B]);for(x=0;x<B;x++)for(L=0;L<w;L++)M.set(x,L,M.get(x,L)-M.get(B,L)*p.get(x,B))}return M.subMatrix(0,k-1,0,w-1)}isFullRank(){let h=this.QR.columns;for(let p=0;p<h;p++)if(this.Rdiag[p]===0)return!1;return!0}get upperTriangularMatrix(){let h=this.QR,p=h.columns,m=new Matrix$2(p,p),w,M;for(w=0;w<p;w++)for(M=0;M<p;M++)w<M?m.set(w,M,h.get(w,M)):w===M?m.set(w,M,this.Rdiag[w]):m.set(w,M,0);return m}get orthogonalMatrix(){let h=this.QR,p=h.rows,m=h.columns,w=new Matrix$2(p,m),M,k,x,L;for(x=m-1;x>=0;x--){for(M=0;M<p;M++)w.set(M,x,0);for(w.set(x,x,1),k=x;k<m;k++)if(h.get(x,x)!==0){for(L=0,M=x;M<p;M++)L+=h.get(M,x)*w.get(M,k);for(L=-L/h.get(x,x),M=x;M<p;M++)w.set(M,k,w.get(M,k)+L*h.get(M,x))}}return w}}class SingularValueDecomposition{constructor(h,p={}){if(h=WrapperMatrix2D.checkMatrix(h),h.isEmpty())throw new Error("Matrix must be non-empty");let m=h.rows,w=h.columns;const{computeLeftSingularVectors:M=!0,computeRightSingularVectors:k=!0,autoTranspose:x=!1}=p;let L=Boolean(M),B=Boolean(k),$=!1,U;if(m<w)if(!x)U=h.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{U=h.transpose(),m=U.rows,w=U.columns,$=!0;let ce=L;L=B,B=ce}else U=h.clone();let q=Math.min(m,w),G=Math.min(m+1,w),W=new Float64Array(G),te=new Matrix$2(m,q),oe=new Matrix$2(w,w),ee=new Float64Array(w),_e=new Float64Array(m),se=new Float64Array(G);for(let ce=0;ce<G;ce++)se[ce]=ce;let he=Math.min(m-1,w),ge=Math.max(0,Math.min(w-2,m)),Re=Math.max(he,ge);for(let ce=0;ce<Re;ce++){if(ce<he){W[ce]=0;for(let ye=ce;ye<m;ye++)W[ce]=hypotenuse$1(W[ce],U.get(ye,ce));if(W[ce]!==0){U.get(ce,ce)<0&&(W[ce]=-W[ce]);for(let ye=ce;ye<m;ye++)U.set(ye,ce,U.get(ye,ce)/W[ce]);U.set(ce,ce,U.get(ce,ce)+1)}W[ce]=-W[ce]}for(let ye=ce+1;ye<w;ye++){if(ce<he&&W[ce]!==0){let ze=0;for(let Xe=ce;Xe<m;Xe++)ze+=U.get(Xe,ce)*U.get(Xe,ye);ze=-ze/U.get(ce,ce);for(let Xe=ce;Xe<m;Xe++)U.set(Xe,ye,U.get(Xe,ye)+ze*U.get(Xe,ce))}ee[ye]=U.get(ce,ye)}if(L&&ce<he)for(let ye=ce;ye<m;ye++)te.set(ye,ce,U.get(ye,ce));if(ce<ge){ee[ce]=0;for(let ye=ce+1;ye<w;ye++)ee[ce]=hypotenuse$1(ee[ce],ee[ye]);if(ee[ce]!==0){ee[ce+1]<0&&(ee[ce]=0-ee[ce]);for(let ye=ce+1;ye<w;ye++)ee[ye]/=ee[ce];ee[ce+1]+=1}if(ee[ce]=-ee[ce],ce+1<m&&ee[ce]!==0){for(let ye=ce+1;ye<m;ye++)_e[ye]=0;for(let ye=ce+1;ye<m;ye++)for(let ze=ce+1;ze<w;ze++)_e[ye]+=ee[ze]*U.get(ye,ze);for(let ye=ce+1;ye<w;ye++){let ze=-ee[ye]/ee[ce+1];for(let Xe=ce+1;Xe<m;Xe++)U.set(Xe,ye,U.get(Xe,ye)+ze*_e[Xe])}}if(B)for(let ye=ce+1;ye<w;ye++)oe.set(ye,ce,ee[ye])}}let ve=Math.min(w,m+1);if(he<w&&(W[he]=U.get(he,he)),m<ve&&(W[ve-1]=0),ge+1<ve&&(ee[ge]=U.get(ge,ve-1)),ee[ve-1]=0,L){for(let ce=he;ce<q;ce++){for(let ye=0;ye<m;ye++)te.set(ye,ce,0);te.set(ce,ce,1)}for(let ce=he-1;ce>=0;ce--)if(W[ce]!==0){for(let ye=ce+1;ye<q;ye++){let ze=0;for(let Xe=ce;Xe<m;Xe++)ze+=te.get(Xe,ce)*te.get(Xe,ye);ze=-ze/te.get(ce,ce);for(let Xe=ce;Xe<m;Xe++)te.set(Xe,ye,te.get(Xe,ye)+ze*te.get(Xe,ce))}for(let ye=ce;ye<m;ye++)te.set(ye,ce,-te.get(ye,ce));te.set(ce,ce,1+te.get(ce,ce));for(let ye=0;ye<ce-1;ye++)te.set(ye,ce,0)}else{for(let ye=0;ye<m;ye++)te.set(ye,ce,0);te.set(ce,ce,1)}}if(B)for(let ce=w-1;ce>=0;ce--){if(ce<ge&&ee[ce]!==0)for(let ye=ce+1;ye<w;ye++){let ze=0;for(let Xe=ce+1;Xe<w;Xe++)ze+=oe.get(Xe,ce)*oe.get(Xe,ye);ze=-ze/oe.get(ce+1,ce);for(let Xe=ce+1;Xe<w;Xe++)oe.set(Xe,ye,oe.get(Xe,ye)+ze*oe.get(Xe,ce))}for(let ye=0;ye<w;ye++)oe.set(ye,ce,0);oe.set(ce,ce,1)}let de=ve-1,Se=Number.EPSILON;for(;ve>0;){let ce,ye;for(ce=ve-2;ce>=-1&&ce!==-1;ce--){const ze=Number.MIN_VALUE+Se*Math.abs(W[ce]+Math.abs(W[ce+1]));if(Math.abs(ee[ce])<=ze||Number.isNaN(ee[ce])){ee[ce]=0;break}}if(ce===ve-2)ye=4;else{let ze;for(ze=ve-1;ze>=ce&&ze!==ce;ze--){let Xe=(ze!==ve?Math.abs(ee[ze]):0)+(ze!==ce+1?Math.abs(ee[ze-1]):0);if(Math.abs(W[ze])<=Se*Xe){W[ze]=0;break}}ze===ce?ye=3:ze===ve-1?ye=1:(ye=2,ce=ze)}switch(ce++,ye){case 1:{let ze=ee[ve-2];ee[ve-2]=0;for(let Xe=ve-2;Xe>=ce;Xe--){let at=hypotenuse$1(W[Xe],ze),ct=W[Xe]/at,Bt=ze/at;if(W[Xe]=at,Xe!==ce&&(ze=-Bt*ee[Xe-1],ee[Xe-1]=ct*ee[Xe-1]),B)for(let Lt=0;Lt<w;Lt++)at=ct*oe.get(Lt,Xe)+Bt*oe.get(Lt,ve-1),oe.set(Lt,ve-1,-Bt*oe.get(Lt,Xe)+ct*oe.get(Lt,ve-1)),oe.set(Lt,Xe,at)}break}case 2:{let ze=ee[ce-1];ee[ce-1]=0;for(let Xe=ce;Xe<ve;Xe++){let at=hypotenuse$1(W[Xe],ze),ct=W[Xe]/at,Bt=ze/at;if(W[Xe]=at,ze=-Bt*ee[Xe],ee[Xe]=ct*ee[Xe],L)for(let Lt=0;Lt<m;Lt++)at=ct*te.get(Lt,Xe)+Bt*te.get(Lt,ce-1),te.set(Lt,ce-1,-Bt*te.get(Lt,Xe)+ct*te.get(Lt,ce-1)),te.set(Lt,Xe,at)}break}case 3:{const ze=Math.max(Math.abs(W[ve-1]),Math.abs(W[ve-2]),Math.abs(ee[ve-2]),Math.abs(W[ce]),Math.abs(ee[ce])),Xe=W[ve-1]/ze,at=W[ve-2]/ze,ct=ee[ve-2]/ze,Bt=W[ce]/ze,Lt=ee[ce]/ze,It=((at+Xe)*(at-Xe)+ct*ct)/2,Vt=Xe*ct*(Xe*ct);let Ft=0;(It!==0||Vt!==0)&&(It<0?Ft=0-Math.sqrt(It*It+Vt):Ft=Math.sqrt(It*It+Vt),Ft=Vt/(It+Ft));let Mt=(Bt+Xe)*(Bt-Xe)+Ft,ri=Bt*Lt;for(let St=ce;St<ve-1;St++){let At=hypotenuse$1(Mt,ri);At===0&&(At=Number.MIN_VALUE);let Et=Mt/At,Ut=ri/At;if(St!==ce&&(ee[St-1]=At),Mt=Et*W[St]+Ut*ee[St],ee[St]=Et*ee[St]-Ut*W[St],ri=Ut*W[St+1],W[St+1]=Et*W[St+1],B)for(let jt=0;jt<w;jt++)At=Et*oe.get(jt,St)+Ut*oe.get(jt,St+1),oe.set(jt,St+1,-Ut*oe.get(jt,St)+Et*oe.get(jt,St+1)),oe.set(jt,St,At);if(At=hypotenuse$1(Mt,ri),At===0&&(At=Number.MIN_VALUE),Et=Mt/At,Ut=ri/At,W[St]=At,Mt=Et*ee[St]+Ut*W[St+1],W[St+1]=-Ut*ee[St]+Et*W[St+1],ri=Ut*ee[St+1],ee[St+1]=Et*ee[St+1],L&&St<m-1)for(let jt=0;jt<m;jt++)At=Et*te.get(jt,St)+Ut*te.get(jt,St+1),te.set(jt,St+1,-Ut*te.get(jt,St)+Et*te.get(jt,St+1)),te.set(jt,St,At)}ee[ve-2]=Mt;break}case 4:{if(W[ce]<=0&&(W[ce]=W[ce]<0?-W[ce]:0,B))for(let ze=0;ze<=de;ze++)oe.set(ze,ce,-oe.get(ze,ce));for(;ce<de&&!(W[ce]>=W[ce+1]);){let ze=W[ce];if(W[ce]=W[ce+1],W[ce+1]=ze,B&&ce<w-1)for(let Xe=0;Xe<w;Xe++)ze=oe.get(Xe,ce+1),oe.set(Xe,ce+1,oe.get(Xe,ce)),oe.set(Xe,ce,ze);if(L&&ce<m-1)for(let Xe=0;Xe<m;Xe++)ze=te.get(Xe,ce+1),te.set(Xe,ce+1,te.get(Xe,ce)),te.set(Xe,ce,ze);ce++}ve--;break}}}if($){let ce=oe;oe=te,te=ce}this.m=m,this.n=w,this.s=W,this.U=te,this.V=oe}solve(h){let p=h,m=this.threshold,w=this.s.length,M=Matrix$2.zeros(w,w);for(let q=0;q<w;q++)Math.abs(this.s[q])<=m?M.set(q,q,0):M.set(q,q,1/this.s[q]);let k=this.U,x=this.rightSingularVectors,L=x.mmul(M),B=x.rows,$=k.rows,U=Matrix$2.zeros(B,$);for(let q=0;q<B;q++)for(let G=0;G<$;G++){let W=0;for(let te=0;te<w;te++)W+=L.get(q,te)*k.get(G,te);U.set(q,G,W)}return U.mmul(p)}solveForDiagonal(h){return this.solve(Matrix$2.diag(h))}inverse(){let h=this.V,p=this.threshold,m=h.rows,w=h.columns,M=new Matrix$2(m,this.s.length);for(let $=0;$<m;$++)for(let U=0;U<w;U++)Math.abs(this.s[U])>p&&M.set($,U,h.get($,U)/this.s[U]);let k=this.U,x=k.rows,L=k.columns,B=new Matrix$2(m,x);for(let $=0;$<m;$++)for(let U=0;U<x;U++){let q=0;for(let G=0;G<L;G++)q+=M.get($,G)*k.get(U,G);B.set($,U,q)}return B}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let h=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,p=0,m=this.s;for(let w=0,M=m.length;w<M;w++)m[w]>h&&p++;return p}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(d,h=!1){return d=WrapperMatrix2D.checkMatrix(d),h?new SingularValueDecomposition(d).inverse():solve(d,Matrix$2.eye(d.rows))}function solve(d,h,p=!1){return d=WrapperMatrix2D.checkMatrix(d),h=WrapperMatrix2D.checkMatrix(h),p?new SingularValueDecomposition(d).solve(h):d.isSquare()?new LuDecomposition(d).solve(h):new QrDecomposition(d).solve(h)}function determinant(d){if(d=Matrix$2.checkMatrix(d),d.isSquare()){if(d.columns===0)return 1;let h,p,m,w;if(d.columns===2)return h=d.get(0,0),p=d.get(0,1),m=d.get(1,0),w=d.get(1,1),h*w-p*m;if(d.columns===3){let M,k,x;return M=new MatrixSelectionView(d,[1,2],[1,2]),k=new MatrixSelectionView(d,[1,2],[0,2]),x=new MatrixSelectionView(d,[1,2],[0,1]),h=d.get(0,0),p=d.get(0,1),m=d.get(0,2),h*determinant(M)-p*determinant(k)+m*determinant(x)}else return new LuDecomposition(d).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(d,h){let p=[];for(let m=0;m<d;m++)m!==h&&p.push(m);return p}function dependenciesOneRow(d,h,p,m=1e-9,w=1e-9){if(d>w)return new Array(h.rows+1).fill(0);{let M=h.addRow(p,[0]);for(let k=0;k<M.rows;k++)Math.abs(M.get(k,0))<m&&M.set(k,0,0);return M.to1DArray()}}function linearDependencies(d,h={}){const{thresholdValue:p=1e-9,thresholdError:m=1e-9}=h;d=Matrix$2.checkMatrix(d);let w=d.rows,M=new Matrix$2(w,w);for(let k=0;k<w;k++){let x=Matrix$2.columnVector(d.getRow(k)),L=d.subMatrixRow(xrange(w,k)).transpose(),$=new SingularValueDecomposition(L).solve(x),U=Matrix$2.sub(x,L.mmul($)).abs().max();M.setRow(k,dependenciesOneRow(U,$,k,p,m))}return M}function pseudoInverse(d,h=Number.EPSILON){if(d=Matrix$2.checkMatrix(d),d.isEmpty())return d.transpose();let p=new SingularValueDecomposition(d,{autoTranspose:!0}),m=p.leftSingularVectors,w=p.rightSingularVectors,M=p.diagonal;for(let k=0;k<M.length;k++)Math.abs(M[k])>h?M[k]=1/M[k]:M[k]=0;return w.mmul(Matrix$2.diag(M).mmul(m.transpose()))}function covariance(d,h=d,p={}){d=new Matrix$2(d);let m=!1;if(typeof h=="object"&&!Matrix$2.isMatrix(h)&&!Array.isArray(h)?(p=h,h=d,m=!0):h=new Matrix$2(h),d.rows!==h.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:w=!0}=p;w&&(d=d.center("column"),m||(h=h.center("column")));const M=d.transpose().mmul(h);for(let k=0;k<M.rows;k++)for(let x=0;x<M.columns;x++)M.set(k,x,M.get(k,x)*(1/(d.rows-1)));return M}function correlation(d,h=d,p={}){d=new Matrix$2(d);let m=!1;if(typeof h=="object"&&!Matrix$2.isMatrix(h)&&!Array.isArray(h)?(p=h,h=d,m=!0):h=new Matrix$2(h),d.rows!==h.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:w=!0,scale:M=!0}=p;w&&(d.center("column"),m||h.center("column")),M&&(d.scale("column"),m||h.scale("column"));const k=d.standardDeviation("column",{unbiased:!0}),x=m?k:h.standardDeviation("column",{unbiased:!0}),L=d.transpose().mmul(h);for(let B=0;B<L.rows;B++)for(let $=0;$<L.columns;$++)L.set(B,$,L.get(B,$)*(1/(k[B]*x[$]))*(1/(d.rows-1)));return L}class EigenvalueDecomposition{constructor(h,p={}){const{assumeSymmetric:m=!1}=p;if(h=WrapperMatrix2D.checkMatrix(h),!h.isSquare())throw new Error("Matrix is not a square matrix");if(h.isEmpty())throw new Error("Matrix must be non-empty");let w=h.columns,M=new Matrix$2(w,w),k=new Float64Array(w),x=new Float64Array(w),L=h,B,$,U=!1;if(m?U=!0:U=h.isSymmetric(),U){for(B=0;B<w;B++)for($=0;$<w;$++)M.set(B,$,L.get(B,$));tred2(w,x,k,M),tql2(w,x,k,M)}else{let q=new Matrix$2(w,w),G=new Float64Array(w);for($=0;$<w;$++)for(B=0;B<w;B++)q.set(B,$,L.get(B,$));orthes(w,q,G,M),hqr2(w,x,k,M,q)}this.n=w,this.e=x,this.d=k,this.V=M}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let h=this.n,p=this.e,m=this.d,w=new Matrix$2(h,h),M,k;for(M=0;M<h;M++){for(k=0;k<h;k++)w.set(M,k,0);w.set(M,M,m[M]),p[M]>0?w.set(M,M+1,p[M]):p[M]<0&&w.set(M,M-1,p[M])}return w}}function tred2(d,h,p,m){let w,M,k,x,L,B,$,U;for(L=0;L<d;L++)p[L]=m.get(d-1,L);for(x=d-1;x>0;x--){for(U=0,k=0,B=0;B<x;B++)U=U+Math.abs(p[B]);if(U===0)for(h[x]=p[x-1],L=0;L<x;L++)p[L]=m.get(x-1,L),m.set(x,L,0),m.set(L,x,0);else{for(B=0;B<x;B++)p[B]/=U,k+=p[B]*p[B];for(w=p[x-1],M=Math.sqrt(k),w>0&&(M=-M),h[x]=U*M,k=k-w*M,p[x-1]=w-M,L=0;L<x;L++)h[L]=0;for(L=0;L<x;L++){for(w=p[L],m.set(L,x,w),M=h[L]+m.get(L,L)*w,B=L+1;B<=x-1;B++)M+=m.get(B,L)*p[B],h[B]+=m.get(B,L)*w;h[L]=M}for(w=0,L=0;L<x;L++)h[L]/=k,w+=h[L]*p[L];for($=w/(k+k),L=0;L<x;L++)h[L]-=$*p[L];for(L=0;L<x;L++){for(w=p[L],M=h[L],B=L;B<=x-1;B++)m.set(B,L,m.get(B,L)-(w*h[B]+M*p[B]));p[L]=m.get(x-1,L),m.set(x,L,0)}}p[x]=k}for(x=0;x<d-1;x++){if(m.set(d-1,x,m.get(x,x)),m.set(x,x,1),k=p[x+1],k!==0){for(B=0;B<=x;B++)p[B]=m.get(B,x+1)/k;for(L=0;L<=x;L++){for(M=0,B=0;B<=x;B++)M+=m.get(B,x+1)*m.get(B,L);for(B=0;B<=x;B++)m.set(B,L,m.get(B,L)-M*p[B])}}for(B=0;B<=x;B++)m.set(B,x+1,0)}for(L=0;L<d;L++)p[L]=m.get(d-1,L),m.set(d-1,L,0);m.set(d-1,d-1,1),h[0]=0}function tql2(d,h,p,m){let w,M,k,x,L,B,$,U,q,G,W,te,oe,ee,_e,se;for(k=1;k<d;k++)h[k-1]=h[k];h[d-1]=0;let he=0,ge=0,Re=Number.EPSILON;for(B=0;B<d;B++){for(ge=Math.max(ge,Math.abs(p[B])+Math.abs(h[B])),$=B;$<d&&!(Math.abs(h[$])<=Re*ge);)$++;if($>B)do{for(w=p[B],U=(p[B+1]-w)/(2*h[B]),q=hypotenuse$1(U,1),U<0&&(q=-q),p[B]=h[B]/(U+q),p[B+1]=h[B]*(U+q),G=p[B+1],M=w-p[B],k=B+2;k<d;k++)p[k]-=M;for(he=he+M,U=p[$],W=1,te=W,oe=W,ee=h[B+1],_e=0,se=0,k=$-1;k>=B;k--)for(oe=te,te=W,se=_e,w=W*h[k],M=W*U,q=hypotenuse$1(U,h[k]),h[k+1]=_e*q,_e=h[k]/q,W=U/q,U=W*p[k]-_e*w,p[k+1]=M+_e*(W*w+_e*p[k]),L=0;L<d;L++)M=m.get(L,k+1),m.set(L,k+1,_e*m.get(L,k)+W*M),m.set(L,k,W*m.get(L,k)-_e*M);U=-_e*se*oe*ee*h[B]/G,h[B]=_e*U,p[B]=W*U}while(Math.abs(h[B])>Re*ge);p[B]=p[B]+he,h[B]=0}for(k=0;k<d-1;k++){for(L=k,U=p[k],x=k+1;x<d;x++)p[x]<U&&(L=x,U=p[x]);if(L!==k)for(p[L]=p[k],p[k]=U,x=0;x<d;x++)U=m.get(x,k),m.set(x,k,m.get(x,L)),m.set(x,L,U)}}function orthes(d,h,p,m){let w=0,M=d-1,k,x,L,B,$,U,q;for(U=w+1;U<=M-1;U++){for(q=0,B=U;B<=M;B++)q=q+Math.abs(h.get(B,U-1));if(q!==0){for(L=0,B=M;B>=U;B--)p[B]=h.get(B,U-1)/q,L+=p[B]*p[B];for(x=Math.sqrt(L),p[U]>0&&(x=-x),L=L-p[U]*x,p[U]=p[U]-x,$=U;$<d;$++){for(k=0,B=M;B>=U;B--)k+=p[B]*h.get(B,$);for(k=k/L,B=U;B<=M;B++)h.set(B,$,h.get(B,$)-k*p[B])}for(B=0;B<=M;B++){for(k=0,$=M;$>=U;$--)k+=p[$]*h.get(B,$);for(k=k/L,$=U;$<=M;$++)h.set(B,$,h.get(B,$)-k*p[$])}p[U]=q*p[U],h.set(U,U-1,q*x)}}for(B=0;B<d;B++)for($=0;$<d;$++)m.set(B,$,B===$?1:0);for(U=M-1;U>=w+1;U--)if(h.get(U,U-1)!==0){for(B=U+1;B<=M;B++)p[B]=h.get(B,U-1);for($=U;$<=M;$++){for(x=0,B=U;B<=M;B++)x+=p[B]*m.get(B,$);for(x=x/p[U]/h.get(U,U-1),B=U;B<=M;B++)m.set(B,$,m.get(B,$)+x*p[B])}}}function hqr2(d,h,p,m,w){let M=d-1,k=0,x=d-1,L=Number.EPSILON,B=0,$=0,U=0,q=0,G=0,W=0,te=0,oe=0,ee,_e,se,he,ge,Re,ve,de,Se,ce,ye,ze,Xe,at,ct;for(ee=0;ee<d;ee++)for((ee<k||ee>x)&&(p[ee]=w.get(ee,ee),h[ee]=0),_e=Math.max(ee-1,0);_e<d;_e++)$=$+Math.abs(w.get(ee,_e));for(;M>=k;){for(he=M;he>k&&(W=Math.abs(w.get(he-1,he-1))+Math.abs(w.get(he,he)),W===0&&(W=$),!(Math.abs(w.get(he,he-1))<L*W));)he--;if(he===M)w.set(M,M,w.get(M,M)+B),p[M]=w.get(M,M),h[M]=0,M--,oe=0;else if(he===M-1){if(ve=w.get(M,M-1)*w.get(M-1,M),U=(w.get(M-1,M-1)-w.get(M,M))/2,q=U*U+ve,te=Math.sqrt(Math.abs(q)),w.set(M,M,w.get(M,M)+B),w.set(M-1,M-1,w.get(M-1,M-1)+B),de=w.get(M,M),q>=0){for(te=U>=0?U+te:U-te,p[M-1]=de+te,p[M]=p[M-1],te!==0&&(p[M]=de-ve/te),h[M-1]=0,h[M]=0,de=w.get(M,M-1),W=Math.abs(de)+Math.abs(te),U=de/W,q=te/W,G=Math.sqrt(U*U+q*q),U=U/G,q=q/G,_e=M-1;_e<d;_e++)te=w.get(M-1,_e),w.set(M-1,_e,q*te+U*w.get(M,_e)),w.set(M,_e,q*w.get(M,_e)-U*te);for(ee=0;ee<=M;ee++)te=w.get(ee,M-1),w.set(ee,M-1,q*te+U*w.get(ee,M)),w.set(ee,M,q*w.get(ee,M)-U*te);for(ee=k;ee<=x;ee++)te=m.get(ee,M-1),m.set(ee,M-1,q*te+U*m.get(ee,M)),m.set(ee,M,q*m.get(ee,M)-U*te)}else p[M-1]=de+U,p[M]=de+U,h[M-1]=te,h[M]=-te;M=M-2,oe=0}else{if(de=w.get(M,M),Se=0,ve=0,he<M&&(Se=w.get(M-1,M-1),ve=w.get(M,M-1)*w.get(M-1,M)),oe===10){for(B+=de,ee=k;ee<=M;ee++)w.set(ee,ee,w.get(ee,ee)-de);W=Math.abs(w.get(M,M-1))+Math.abs(w.get(M-1,M-2)),de=Se=.75*W,ve=-.4375*W*W}if(oe===30&&(W=(Se-de)/2,W=W*W+ve,W>0)){for(W=Math.sqrt(W),Se<de&&(W=-W),W=de-ve/((Se-de)/2+W),ee=k;ee<=M;ee++)w.set(ee,ee,w.get(ee,ee)-W);B+=W,de=Se=ve=.964}for(oe=oe+1,ge=M-2;ge>=he&&(te=w.get(ge,ge),G=de-te,W=Se-te,U=(G*W-ve)/w.get(ge+1,ge)+w.get(ge,ge+1),q=w.get(ge+1,ge+1)-te-G-W,G=w.get(ge+2,ge+1),W=Math.abs(U)+Math.abs(q)+Math.abs(G),U=U/W,q=q/W,G=G/W,!(ge===he||Math.abs(w.get(ge,ge-1))*(Math.abs(q)+Math.abs(G))<L*(Math.abs(U)*(Math.abs(w.get(ge-1,ge-1))+Math.abs(te)+Math.abs(w.get(ge+1,ge+1))))));)ge--;for(ee=ge+2;ee<=M;ee++)w.set(ee,ee-2,0),ee>ge+2&&w.set(ee,ee-3,0);for(se=ge;se<=M-1&&(at=se!==M-1,se!==ge&&(U=w.get(se,se-1),q=w.get(se+1,se-1),G=at?w.get(se+2,se-1):0,de=Math.abs(U)+Math.abs(q)+Math.abs(G),de!==0&&(U=U/de,q=q/de,G=G/de)),de!==0);se++)if(W=Math.sqrt(U*U+q*q+G*G),U<0&&(W=-W),W!==0){for(se!==ge?w.set(se,se-1,-W*de):he!==ge&&w.set(se,se-1,-w.get(se,se-1)),U=U+W,de=U/W,Se=q/W,te=G/W,q=q/U,G=G/U,_e=se;_e<d;_e++)U=w.get(se,_e)+q*w.get(se+1,_e),at&&(U=U+G*w.get(se+2,_e),w.set(se+2,_e,w.get(se+2,_e)-U*te)),w.set(se,_e,w.get(se,_e)-U*de),w.set(se+1,_e,w.get(se+1,_e)-U*Se);for(ee=0;ee<=Math.min(M,se+3);ee++)U=de*w.get(ee,se)+Se*w.get(ee,se+1),at&&(U=U+te*w.get(ee,se+2),w.set(ee,se+2,w.get(ee,se+2)-U*G)),w.set(ee,se,w.get(ee,se)-U),w.set(ee,se+1,w.get(ee,se+1)-U*q);for(ee=k;ee<=x;ee++)U=de*m.get(ee,se)+Se*m.get(ee,se+1),at&&(U=U+te*m.get(ee,se+2),m.set(ee,se+2,m.get(ee,se+2)-U*G)),m.set(ee,se,m.get(ee,se)-U),m.set(ee,se+1,m.get(ee,se+1)-U*q)}}}if($!==0){for(M=d-1;M>=0;M--)if(U=p[M],q=h[M],q===0)for(he=M,w.set(M,M,1),ee=M-1;ee>=0;ee--){for(ve=w.get(ee,ee)-U,G=0,_e=he;_e<=M;_e++)G=G+w.get(ee,_e)*w.get(_e,M);if(h[ee]<0)te=ve,W=G;else if(he=ee,h[ee]===0?w.set(ee,M,ve!==0?-G/ve:-G/(L*$)):(de=w.get(ee,ee+1),Se=w.get(ee+1,ee),q=(p[ee]-U)*(p[ee]-U)+h[ee]*h[ee],Re=(de*W-te*G)/q,w.set(ee,M,Re),w.set(ee+1,M,Math.abs(de)>Math.abs(te)?(-G-ve*Re)/de:(-W-Se*Re)/te)),Re=Math.abs(w.get(ee,M)),L*Re*Re>1)for(_e=ee;_e<=M;_e++)w.set(_e,M,w.get(_e,M)/Re)}else if(q<0)for(he=M-1,Math.abs(w.get(M,M-1))>Math.abs(w.get(M-1,M))?(w.set(M-1,M-1,q/w.get(M,M-1)),w.set(M-1,M,-(w.get(M,M)-U)/w.get(M,M-1))):(ct=cdiv(0,-w.get(M-1,M),w.get(M-1,M-1)-U,q),w.set(M-1,M-1,ct[0]),w.set(M-1,M,ct[1])),w.set(M,M-1,0),w.set(M,M,1),ee=M-2;ee>=0;ee--){for(ce=0,ye=0,_e=he;_e<=M;_e++)ce=ce+w.get(ee,_e)*w.get(_e,M-1),ye=ye+w.get(ee,_e)*w.get(_e,M);if(ve=w.get(ee,ee)-U,h[ee]<0)te=ve,G=ce,W=ye;else if(he=ee,h[ee]===0?(ct=cdiv(-ce,-ye,ve,q),w.set(ee,M-1,ct[0]),w.set(ee,M,ct[1])):(de=w.get(ee,ee+1),Se=w.get(ee+1,ee),ze=(p[ee]-U)*(p[ee]-U)+h[ee]*h[ee]-q*q,Xe=(p[ee]-U)*2*q,ze===0&&Xe===0&&(ze=L*$*(Math.abs(ve)+Math.abs(q)+Math.abs(de)+Math.abs(Se)+Math.abs(te))),ct=cdiv(de*G-te*ce+q*ye,de*W-te*ye-q*ce,ze,Xe),w.set(ee,M-1,ct[0]),w.set(ee,M,ct[1]),Math.abs(de)>Math.abs(te)+Math.abs(q)?(w.set(ee+1,M-1,(-ce-ve*w.get(ee,M-1)+q*w.get(ee,M))/de),w.set(ee+1,M,(-ye-ve*w.get(ee,M)-q*w.get(ee,M-1))/de)):(ct=cdiv(-G-Se*w.get(ee,M-1),-W-Se*w.get(ee,M),te,q),w.set(ee+1,M-1,ct[0]),w.set(ee+1,M,ct[1]))),Re=Math.max(Math.abs(w.get(ee,M-1)),Math.abs(w.get(ee,M))),L*Re*Re>1)for(_e=ee;_e<=M;_e++)w.set(_e,M-1,w.get(_e,M-1)/Re),w.set(_e,M,w.get(_e,M)/Re)}for(ee=0;ee<d;ee++)if(ee<k||ee>x)for(_e=ee;_e<d;_e++)m.set(ee,_e,w.get(ee,_e));for(_e=d-1;_e>=k;_e--)for(ee=k;ee<=x;ee++){for(te=0,se=k;se<=Math.min(_e,x);se++)te=te+m.get(ee,se)*w.get(se,_e);m.set(ee,_e,te)}}}function cdiv(d,h,p,m){let w,M;return Math.abs(p)>Math.abs(m)?(w=m/p,M=p+w*m,[(d+w*h)/M,(h-w*d)/M]):(w=p/m,M=m+w*p,[(w*d+h)/M,(w*h-d)/M])}class CholeskyDecomposition{constructor(h){if(h=WrapperMatrix2D.checkMatrix(h),!h.isSymmetric())throw new Error("Matrix is not symmetric");let p=h,m=p.rows,w=new Matrix$2(m,m),M=!0,k,x,L;for(x=0;x<m;x++){let B=0;for(L=0;L<x;L++){let $=0;for(k=0;k<L;k++)$+=w.get(L,k)*w.get(x,k);$=(p.get(x,L)-$)/w.get(L,L),w.set(x,L,$),B=B+$*$}for(B=p.get(x,x)-B,M&=B>0,w.set(x,x,Math.sqrt(Math.max(B,0))),L=x+1;L<m;L++)w.set(x,L,0)}this.L=w,this.positiveDefinite=Boolean(M)}isPositiveDefinite(){return this.positiveDefinite}solve(h){h=WrapperMatrix2D.checkMatrix(h);let p=this.L,m=p.rows;if(h.rows!==m)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let w=h.columns,M=h.clone(),k,x,L;for(L=0;L<m;L++)for(x=0;x<w;x++){for(k=0;k<L;k++)M.set(L,x,M.get(L,x)-M.get(k,x)*p.get(L,k));M.set(L,x,M.get(L,x)/p.get(L,L))}for(L=m-1;L>=0;L--)for(x=0;x<w;x++){for(k=L+1;k<m;k++)M.set(L,x,M.get(L,x)-M.get(k,x)*p.get(k,L));M.set(L,x,M.get(L,x)/p.get(L,L))}return M}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(h,p={}){h=WrapperMatrix2D.checkMatrix(h);let{Y:m}=p;const{scaleScores:w=!1,maxIterations:M=1e3,terminationCriteria:k=1e-10}=p;let x;if(m){if(Array.isArray(m)&&typeof m[0]=="number"?m=Matrix$2.columnVector(m):m=WrapperMatrix2D.checkMatrix(m),m.rows!==h.rows)throw new Error("Y should have the same number of rows as X");x=m.getColumnVector(0)}else x=h.getColumnVector(0);let L=1,B,$,U,q;for(let G=0;G<M&&L>k;G++)U=h.transpose().mmul(x).div(x.transpose().mmul(x).get(0,0)),U=U.div(U.norm()),B=h.mmul(U).div(U.transpose().mmul(U).get(0,0)),G>0&&(L=B.clone().sub(q).pow(2).sum()),q=B.clone(),m?($=m.transpose().mmul(B).div(B.transpose().mmul(B).get(0,0)),$=$.div($.norm()),x=m.mmul($).div($.transpose().mmul($).get(0,0))):x=B;if(m){let G=h.transpose().mmul(B).div(B.transpose().mmul(B).get(0,0));G=G.div(G.norm());let W=h.clone().sub(B.clone().mmul(G.transpose())),te=x.transpose().mmul(B).div(B.transpose().mmul(B).get(0,0)),oe=m.clone().sub(B.clone().mulS(te.get(0,0)).mmul($.transpose()));this.t=B,this.p=G.transpose(),this.w=U.transpose(),this.q=$,this.u=x,this.s=B.transpose().mmul(B),this.xResidual=W,this.yResidual=oe,this.betas=te}else this.w=U.transpose(),this.s=B.transpose().mmul(B).sqrt(),w?this.t=B.clone().div(this.s.get(0,0)):this.t=B,this.xResidual=h.sub(B.mmul(U.transpose()))}}var src$1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",AbstractMatrix,default:Matrix$2,Matrix:Matrix$2,wrap,WrapperMatrix1D,WrapperMatrix2D,solve,inverse,determinant,linearDependencies,pseudoInverse,covariance,correlation,SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition,LU:LuDecomposition,QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView,MatrixColumnSelectionView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowView,MatrixRowSelectionView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1});function getSeparatedKernel(d){const h=new SingularValueDecomposition(d,{autoTranspose:!0});if(h.rank!==1)return null;const p=Math.sqrt(h.s[0]),m=h.U.to2DArray().map(M=>M[0]*p),w=h.V.to2DArray().map(M=>M[0]*p);return[m,w]}function convolution(d,h={}){let{channels:p,bitDepth:m,normalize:w=!1,divisor:M=1,border:k="copy",algorithm:x="auto"}=h,L={};m&&(L.bitDepth=m);let B=Image$1.createFrom(this,L);if(p=validateArrayOfChannels(this,p),x!=="separable")({kernel:d}=validateKernel(d));else if(!Array.isArray(d)||d.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(x==="auto"){let he=getSeparatedKernel(d);he!==null?(x="separable",d=he):(d.length>9||d[0].length>9)&&this.width<=4096&&this.height<=4096?x="fft":x="direct"}let $,U;x==="separable"?($=Math.floor(d[0].length/2),U=Math.floor(d[1].length/2)):($=Math.floor(d.length/2),U=Math.floor(d[0].length/2));let q=B.isClamped,G=new Array(this.height*this.width),W,te,oe,ee,_e,se;for(ee=0;ee<p.length;ee++){for(_e=p[ee],oe=0;oe<this.height;oe++)for(te=0;te<this.width;te++)W=oe*this.width+te,G[W]=this.data[W*this.channels+_e];if(x==="direct")se=src$2.direct(G,d,{rows:this.height,cols:this.width,normalize:w,divisor:M});else if(x==="separable"){if(se=convolutionSeparable(G,d,this.width,this.height),w){M=0;for(let he=0;he<d[0].length;he++)for(let ge=0;ge<d[1].length;ge++)M+=d[0][he]*d[1][ge]}if(M!==1)for(let he=0;he<se.length;he++)se[he]/=M}else se=src$2.fft(G,d,{rows:this.height,cols:this.width,normalize:w,divisor:M});for(oe=0;oe<this.height;oe++)for(te=0;te<this.width;te++)W=oe*this.width+te,q?B.data[W*this.channels+_e]=clamp(se[W],B):B.data[W*this.channels+_e]=se[W]}if(this.alpha&&!p.includes(this.channels))for(te=this.components;te<this.data.length;te=te+this.channels)B.data[te]=this.data[te];return k!=="periodic"&&B.setBorder({size:[U,$],algorithm:k}),B}function gradientFilter(d={}){let{direction:h="xy",border:p="copy",kernelX:m,kernelY:w,channels:M,bitDepth:k=this.bitDepth}=d;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),h){case"x":if(!m)throw new Error("kernelX option is missing");return convolution.call(this,m,{channels:M,border:p,bitDepth:k});case"y":if(!w)throw new Error("kernelY option is missing");return convolution.call(this,w,{channels:M,border:p,bitDepth:k});case"xy":{if(!m)throw new Error("kernelX option is missing");if(!w)throw new Error("kernelY option is missing");const x=convolution.call(this,m,{channels:M,border:p,bitDepth:32}),L=convolution.call(this,w,{channels:M,border:p,bitDepth:32});return x.hypotenuse(L,{bitDepth:k,channels:M})}default:throw new Error(`Unknown parameter direction: ${h}`)}}function sobelFilter(d){return gradientFilter.call(this,Object.assign({},d,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(d){return gradientFilter.call(this,Object.assign({},d,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(d,h){d=d||0;for(var p=new Array(d),m=0;m<d;m++)p[m]=h;return p}function level(d={}){let{algorithm:h="range",channels:p,min:m=this.min,max:w=this.max}=d;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),p=validateArrayOfChannels(this,{channels:p}),p.length!==this.channel&&(Array.isArray(m)&&m.length===this.channels&&(m=m.filter((M,k)=>p.includes(k))),Array.isArray(w)&&w.length===this.channels&&(w=w.filter((M,k)=>p.includes(k)))),h){case"range":m<0&&(m=0),w>this.maxValue&&(w=this.maxValue),Array.isArray(m)||(m=newArray_1(p.length,m)),Array.isArray(w)||(w=newArray_1(p.length,w)),processImage(this,m,w,p);break;default:throw new Error(`level: algorithm not implement: ${h}`)}return this}function processImage(d,h,p,m){let w=1e-5,M=new Array(m.length);for(let k=0;k<m.length;k++)h[k]===0&&p[k]===d.maxValue||p[k]===h[k]?M[k]=0:M[k]=(d.maxValue+1-w)/(p[k]-h[k]),h[k]+=(.5-w/2)/M[k];for(let k=0;k<m.length;k++){let x=m[k];if(M[k]!==0)for(let L=0;L<d.data.length;L+=d.channels)d.data[L+x]=Math.min(Math.max(0,(d.data[L+x]-h[k])*M[k]+.5|0),d.maxValue)}}var toString$1=Object.prototype.toString,isArrayType=function d(h){return toString$1.call(h).substr(-6,5)==="Array"};function checkNumberArray(d){if(isNaN(d)){if(d instanceof Image$1)return d.data;if(!isArrayType(d))throw new Error("checkNumberArray: the value should be either a number, array or Image");return d}else{if(d<=0)throw new Error("checkNumberArray: the value must be greater than 0");return d}}function add(d,h={}){let{channels:p}=h;if(this.checkProcessable("add",{bitDepth:[8,16]}),p=validateArrayOfChannels(this,{channels:p}),d=checkNumberArray(d),isNaN(d)){if(this.data.length!==d.length)throw new Error("add: the data size is different");for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.max(0,Math.min(this.maxValue,this.data[M+w]+d[M+w]>>0))}}else for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.min(this.maxValue,this.data[M+w]+d>>0)}return this}function subtract(d,h={}){let{channels:p}=h;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),p=validateArrayOfChannels(this,{channels:p}),d=checkNumberArray(d),isNaN(d)){if(this.data.length!==d.length)throw new Error("subtract: the data size is different");for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.max(0,Math.min(this.maxValue,this.data[M+w]-d[M+w]>>0))}}else for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.max(0,this.data[M+w]-d>>0)}return this}function subtractImage(d,h={}){let{channels:p,absolute:m=!1}=h;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==d.width||this.height!==d.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==d.alpha||this.bitDepth!==d.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==d.channels)throw new Error("subtractImage: both images must have the same number of channels");let w=this.clone();p=validateArrayOfChannels(this,{channels:p});for(let M=0;M<p.length;M++){let k=p[M];for(let x=k;x<this.data.length;x+=this.channels){let L=this.data[x]-d.data[x];m?w.data[x]=Math.abs(L):w.data[x]=Math.max(L,0)}}return w}function hypotenuse(d,h={}){let{bitDepth:p=this.bitDepth,channels:m}=h;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==d.width||this.height!==d.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==d.alpha||this.bitDepth!==d.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==d.channels)throw new Error("hypotenuse: both images must have the same number of channels");let w=Image$1.createFrom(this,{bitDepth:p});m=validateArrayOfChannels(this,{channels:m});let M=w.isClamped;for(let k=0;k<m.length;k++){let x=m[k];for(let L=x;L<this.data.length;L+=this.channels){let B=Math.hypot(this.data[L],d.data[L]);M?w.data[L]=Math.min(Math.max(Math.round(B),0),w.maxValue):w.data[L]=B}}return w}function multiply(d,h={}){let{channels:p}=h;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),d<=0)throw new Error("multiply: the value must be greater than 0");if(p=validateArrayOfChannels(this,{channels:p}),d=checkNumberArray(d),isNaN(d)){if(this.data.length!==d.length)throw new Error("multiply: the data size is different");for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.max(0,Math.min(this.maxValue,this.data[M+w]*d[M+w]>>0))}}else for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.min(this.maxValue,this.data[M+w]*d>>0)}return this}function divide(d,h={}){let{channels:p}=h;if(this.checkProcessable("divide",{bitDepth:[8,16]}),p=validateArrayOfChannels(this,{channels:p}),d=checkNumberArray(d),isNaN(d)){if(this.data.length!==d.length)throw new Error("divide: the: the data size is different");for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.max(0,Math.min(this.maxValue,this.data[M+w]/d[M+w]>>0))}}else for(let m=0;m<p.length;m++){let w=p[m];for(let M=0;M<this.data.length;M+=this.channels)this.data[M+w]=Math.min(this.maxValue,this.data[M+w]/d>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(h){if(typeof h=="number")return this._predict(h);if(isAnyArray(h)){const p=[];for(let m=0;m<h.length;m++)p.push(this._predict(h[m]));return p}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(h,p){if(!isAnyArray(h)||!isAnyArray(p)||h.length!==p.length)throw new Error("x and y must be arrays of the same length");const m=h.length,w=new Array(m);for(let G=0;G<m;G++)w[G]=this._predict(h[G]);let M=0,k=0,x=0,L=0,B=0,$=0,U=0;for(let G=0;G<m;G++)M+=w[G],k+=p[G],B+=w[G]*w[G],$+=p[G]*p[G],U+=w[G]*p[G],p[G]!==0&&(x+=(p[G]-w[G])*(p[G]-w[G])/p[G]),L+=(p[G]-w[G])*(p[G]-w[G]);const q=(m*U-M*k)/Math.sqrt((m*B-M*M)*(m*$-k*k));return{r:q,r2:q*q,chi2:x,rmsd:Math.sqrt(L/m)}}}var require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(d,h){let p=0;for(let m=0;m<d.length;m++)p+=(d[m]-h[m])*(d[m]-h[m]);return p}function euclidean$2(d,h){return Math.sqrt(squaredEuclidean$4(d,h))}var euclidean$3=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",squaredEuclidean:squaredEuclidean$4,euclidean:euclidean$2}),require$$0=getAugmentedNamespace(euclidean$3);const{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};class GaussianKernel$1{constructor(h){h=Object.assign({},defaultOptions$b,h),this.sigma=h.sigma,this.divisor=2*h.sigma*h.sigma}compute(h,p){const m=squaredEuclidean$3(h,p);return Math.exp(-m/this.divisor)}}var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};class PolynomialKernel$1{constructor(h){h=Object.assign({},defaultOptions$a,h),this.degree=h.degree,this.constant=h.constant,this.scale=h.scale}compute(h,p){for(var m=0,w=0;w<h.length;w++)m+=h[w]*p[w];return Math.pow(this.scale*m+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};class SigmoidKernel$1{constructor(h){h=Object.assign({},defaultOptions$9,h),this.alpha=h.alpha,this.constant=h.constant}compute(h,p){for(var m=0,w=0;w<h.length;w++)m+=h[w]*p[w];return Math.tanh(this.alpha*m+this.constant)}}var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};class ANOVAKernel$1{constructor(h){h=Object.assign({},defaultOptions$8,h),this.sigma=h.sigma,this.degree=h.degree}compute(h,p){for(var m=0,w=Math.min(h.length,p.length),M=1;M<=w;++M)m+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(h[M-1],M)-Math.pow(p[M-1],M),2)),this.degree);return m}}var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};class CauchyKernel$1{constructor(h){h=Object.assign({},defaultOptions$7,h),this.sigma=h.sigma}compute(h,p){return 1/(1+squaredEuclidean$2(h,p)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};class ExponentialKernel$1{constructor(h){h=Object.assign({},defaultOptions$6,h),this.sigma=h.sigma,this.divisor=2*h.sigma*h.sigma}compute(h,p){const m=euclidean$1(h,p);return Math.exp(-m/this.divisor)}}var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(h,p){for(var m=Math.min(h.length,p.length),w=0,M=0;M<m;++M)w+=Math.min(h[M],p[M]);return w}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};class LaplacianKernel$1{constructor(h){h=Object.assign({},defaultOptions$5,h),this.sigma=h.sigma}compute(h,p){const m=euclidean(h,p);return Math.exp(-m/this.sigma)}}var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};class MultiquadraticKernel$1{constructor(h){h=Object.assign({},defaultOptions$4,h),this.constant=h.constant}compute(h,p){return Math.sqrt(squaredEuclidean$1(h,p)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(h){h=Object.assign({},defaultOptions$3,h),this.constant=h.constant}compute(h,p){const m=squaredEuclidean(h,p);return 1-m/(m+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(h,p){if(this.kernelType=h,h!=="linear")if(typeof h=="string"){h=h.toLowerCase();var m=kernelType[h];if(m)this.kernelFunction=new m(p);else throw new Error(`unsupported kernel type: ${h}`)}else if(typeof h=="object"&&typeof h.compute=="function")this.kernelFunction=h;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(h,p){if(h=Matrix$1.checkMatrix(h),p===void 0?p=h:p=Matrix$1.checkMatrix(p),this.kernelType==="linear")return h.mmul(new MatrixTransposeView(p));const m=new Matrix$1(h.rows,p.rows);if(h===p)for(let w=0;w<h.rows;w++)for(let M=w;M<h.rows;M++){const k=this.kernelFunction.compute(h.getRow(w),h.getRow(M));m.set(w,M,k),m.set(M,w,k)}else for(let w=0;w<h.rows;w++)for(let M=0;M<p.rows;M++)m.set(w,M,this.kernelFunction.compute(h.getRow(w),p.getRow(M)));return m}}var kernel=Kernel;const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(h,p,m){super();if(h===!0)this.alpha=p.alpha,this.inputs=p.inputs,this.kernelType=p.kernelType,this.kernelOptions=p.kernelOptions,this.kernel=new kernel(p.kernelType,p.kernelOptions);else{h=Matrix$2.checkMatrix(h),m=Object.assign({},defaultOptions$2,m);const w=new kernel(m.kernelType,m.kernelOptions),M=w.compute(h),k=h.rows;M.add(Matrix$2.eye(k,k).mul(m.lambda)),this.alpha=solve(M,p),this.inputs=h,this.kernelType=m.kernelType,this.kernelOptions=m.kernelOptions,this.kernel=w}}_predict(h){return this.kernel.compute([h],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(h){if(h.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,h)}}function background$1(d,h,p){const m=new KernelRidgeRegression(d,h,p),w=new Array(this.size);for(let x=0;x<this.width;x++)for(let L=0;L<this.height;L++)w[L*this.width+x]=[x,L];const M=m.predict(w),k=Image$1.createFrom(this);for(let x=0;x<this.size;x++)k.data[x]=Math.min(this.maxValue,Math.max(0,M[x][0]));return k}function dilate(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let m=!0;e:for(const M of h)for(const k of M)if(k!==1){m=!1;break e}let w=this;for(let M=0;M<p;M++)if(this.bitDepth===1)if(m){const k=w.clone();w=dilateOnceBinaryOnlyOnes(w,k,h.length,h[0].length)}else{const k=Image$1.createFrom(w);w=dilateOnceBinary(w,k,h)}else if(m){const k=Image$1.createFrom(w);w=dilateOnceGreyOnlyOnes(w,k,h.length,h[0].length)}else{const k=Image$1.createFrom(w);w=dilateOnceGrey(w,k,h)}return w}function dilateOnceGrey(d,h,p){const m=p.length,w=p[0].length;let M=(m-1)/2,k=(w-1)/2;for(let x=0;x<d.height;x++)for(let L=0;L<d.width;L++){let B=0;for(let $=0;$<w;$++)for(let U=0;U<m;U++){if(p[U][$]!==1)continue;let q=U-M+L,G=$-k+x;if(q<0||G<0||q>=d.width||G>=d.height)continue;const W=d.getValueXY(q,G,0);W>B&&(B=W)}h.setValueXY(L,x,0,B)}return h}function dilateOnceGreyOnlyOnes(d,h,p,m){const w=(p-1)/2,M=(m-1)/2,k=[];for(let x=0;x<d.width;x++)k.push(0);for(let x=0;x<d.height;x++){for(let L=0;L<d.width;L++){let B=0;for(let $=Math.max(0,x-M);$<Math.min(d.height,x+M+1);$++){const U=d.getValueXY(L,$,0);U>B&&(B=U)}k[L]=B}for(let L=0;L<d.width;L++){let B=0;for(let $=Math.max(0,L-w);$<Math.min(d.width,L+w+1);$++)k[$]>B&&(B=k[$]);h.setValueXY(L,x,0,B)}}return h}function dilateOnceBinary(d,h,p){const m=p.length,w=p[0].length;let M=(m-1)/2,k=(w-1)/2;for(let x=0;x<d.height;x++)for(let L=0;L<d.width;L++){let B=0;e:for(let $=0;$<w;$++)for(let U=0;U<m;U++){if(p[U][$]!==1)continue;let q=U-M+L,G=$-k+x;if(G<0||q<0||q>=d.width||G>=d.height)continue;if(d.getBitXY(q,G)===1){B=1;break e}}B===1&&h.setBitXY(L,x)}return h}function dilateOnceBinaryOnlyOnes(d,h,p,m){const w=(p-1)/2,M=(m-1)/2,k=[];for(let x=0;x<d.width;x++)k.push(1);for(let x=0;x<d.height;x++){for(let L=0;L<d.width;L++){k[L]=0;for(let B=Math.max(0,x-M);B<Math.min(d.height,x+M+1);B++)if(d.getBitXY(L,B)===1){k[L]=1;break}}for(let L=0;L<d.width;L++)if(h.getBitXY(L,x)!==1){for(let B=Math.max(0,L-w);B<Math.min(d.width,L+w+1);B++)if(k[B]===1){h.setBitXY(L,x);break}}}return h}function erode(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let m=!0;e:for(const M of h)for(const k of M)if(k!==1){m=!1;break e}let w=this;for(let M=0;M<p;M++)if(this.bitDepth===1)if(m){const k=w.clone();w=erodeOnceBinaryOnlyOnes(w,k,h.length,h[0].length)}else{const k=Image$1.createFrom(w);w=erodeOnceBinary(w,k,h)}else if(m){const k=Image$1.createFrom(w);w=erodeOnceGreyOnlyOnes(w,k,h.length,h[0].length)}else{const k=Image$1.createFrom(w);w=erodeOnceGrey(w,k,h)}return w}function erodeOnceGrey(d,h,p){const m=p.length,w=p[0].length;let M=(m-1)/2,k=(w-1)/2;for(let x=0;x<d.height;x++)for(let L=0;L<d.width;L++){let B=d.maxValue;for(let $=0;$<w;$++)for(let U=0;U<m;U++){if(p[U][$]!==1)continue;let q=U-M+L,G=$-k+x;if(q<0||G<0||q>=d.width||G>=d.height)continue;const W=d.getValueXY(q,G,0);W<B&&(B=W)}h.setValueXY(L,x,0,B)}return h}function erodeOnceGreyOnlyOnes(d,h,p,m){const w=(p-1)/2,M=(m-1)/2,k=[];for(let x=0;x<d.width;x++)k.push(0);for(let x=0;x<d.height;x++){for(let L=0;L<d.width;L++){let B=d.maxValue;for(let $=Math.max(0,x-M);$<Math.min(d.height,x+M+1);$++){const U=d.getValueXY(L,$,0);U<B&&(B=U)}k[L]=B}for(let L=0;L<d.width;L++){let B=d.maxValue;for(let $=Math.max(0,L-w);$<Math.min(d.width,L+w+1);$++)k[$]<B&&(B=k[$]);h.setValueXY(L,x,0,B)}}return h}function erodeOnceBinary(d,h,p){const m=p.length,w=p[0].length;let M=(m-1)/2,k=(w-1)/2;for(let x=0;x<d.height;x++)for(let L=0;L<d.width;L++){let B=1;e:for(let $=0;$<w;$++)for(let U=0;U<m;U++){if(p[U][$]!==1)continue;let q=U-M+L,G=$-k+x;if(G<0||q<0||q>=d.width||G>=d.height)continue;if(d.getBitXY(q,G)===0){B=0;break e}}B===1&&h.setBitXY(L,x)}return h}function erodeOnceBinaryOnlyOnes(d,h,p,m){const w=(p-1)/2,M=(m-1)/2,k=[];for(let x=0;x<d.width;x++)k.push(0);for(let x=0;x<d.height;x++){for(let L=0;L<d.width;L++){k[L]=1;for(let B=Math.max(0,x-M);B<Math.min(d.height,x+M+1);B++)if(d.getBitXY(L,B)===0){k[L]=0;break}}for(let L=0;L<d.width;L++)if(h.getBitXY(L,x)!==0){for(let B=Math.max(0,L-w);B<Math.min(d.width,L+w+1);B++)if(k[B]===0){h.clearBitXY(L,x);break}}}return h}function open(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let m=this;for(let w=0;w<p;w++)m=m.erode({kernel:h}),m=m.dilate({kernel:h});return m}function close(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let m=this;for(let w=0;w<p;w++)m=m.dilate({kernel:h}).erode({kernel:h});return m}function topHat(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),h.length%2===0||h[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let m=this;for(let w=0;w<p;w++)m=m.open({kernel:h}).subtractImage(m,{absolute:!0});return m}function blackHat(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let m=this;for(let w=0;w<p;w++)m=m.close({kernel:h}).subtractImage(m,{absolute:!0});return m}function morphologicalGradient(d={}){let{kernel:h=[[1,1,1],[1,1,1],[1,1,1]],iterations:p=1}=d;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),h.columns%2===0||h.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let m=this;for(let w=0;w<p;w++){let M=m.dilate({kernel:h}),k=m.erode({kernel:h});m=M.subtractImage(k,{absolute:!0})}return m}function order4Points(d){let h=0,p=0,m=0,w=0,M=d[0][0],k=0;for(let B=1;B<d.length;B++)d[B][0]<M&&(M=d[B][0],k=B);let x=d[(k+1)%d.length][0],L=(k+1)%d.length;for(let B=1;B<d.length;B++)d[B][0]<x&&B!==k&&(x=d[B][0],L=B);return d[L][1]<d[k][1]?(h=d[L],w=d[k],k!==(L+1)%4?(p=d[(L+1)%4],m=d[(L+2)%4]):(p=d[(L+2)%4],m=d[(L+3)%4])):(w=d[L],h=d[k],L!==(k+1)%4?(p=d[(k+1)%4],m=d[(k+2)%4]):(p=d[(k+2)%4],m=d[(k+3)%4])),[h,p,m,w]}function distance2Points(d,h){return Math.sqrt(Math.pow(d[0]-h[0],2)+Math.pow(d[1]-h[1],2))}function crossVect(d,h){return[d[1]*h[2]-d[2]*h[1],d[2]*h[0]-d[0]*h[2],d[0]*h[1]-d[1]*h[0]]}function dotVect(d,h){return d[0]*h[0]+d[1]*h[1]+d[2]*h[2]}function computeWidthAndHeigth(d,h,p,m,w,M){let k=Math.max(distance2Points(d,h),distance2Points(m,p)),x=Math.max(distance2Points(d,m),distance2Points(h,p)),L=0,B=0,$=Math.ceil(w/2),U=Math.ceil(M/2),q=k/x,G=[d[0],d[1],1],W=[h[0],h[1],1],te=[m[0],m[1],1],oe=[p[0],p[1],1],ee=dotVect(crossVect(G,oe),te)/dotVect(crossVect(W,oe),te),_e=dotVect(crossVect(G,oe),W)/dotVect(crossVect(te,oe),W),se=[ee*W[0]-G[0],ee*W[1]-G[1],ee*W[2]-G[2]],he=[_e*te[0]-G[0],_e*te[1]-G[1],_e*te[2]-G[2]],ge=se[0],Re=se[1],ve=se[2],de=he[0],Se=he[1],ce=he[2],ye=1/(ve*ce)*(ge*de-(ge*ce+ve*de)*$+ve*ce*$*$+(Re*Se-(Re*ce+ve*Se)*U+ve*ce*U*U));ye>=0?ye=Math.sqrt(ye):ye=Math.sqrt(-ye);let ze=new Matrix$2([[ye,0,$],[0,ye,U],[0,0,1]]),Xe=ze.transpose(),at=inverse(Xe),ct=inverse(ze),Bt=Matrix$2.rowVector(se),Lt=Matrix$2.rowVector(he),It=Math.sqrt(dotVect(Bt.mmul(at).mmul(ct).to1DArray(),se)/dotVect(Lt.mmul(at).mmul(ct).to1DArray(),he));return It===0||q===0?(L=Math.ceil(k),B=Math.ceil(x)):It<q?(L=Math.ceil(k),B=Math.ceil(L/It)):(B=Math.ceil(x),L=Math.ceil(It*B)),[L,B]}function projectionPoint(d,h,p,m,w,M,k,x,L,B,$,U){let[q,G]=[(p*d+m*h+w)/(L*d+B*h+1),(M*d+k*h+x)/(L*d+B*h+1)];return $.getValueXY(Math.floor(q),Math.floor(G),U)}function warpingFourPoints(d,h={}){let{calculateRatio:p=!0}=h;if(d.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${d.length} elements`);let[m,w,M,k]=d,x=[m,w,M,k],[L,B,$,U]=order4Points(x),q,G;p?[q,G]=computeWidthAndHeigth(L,B,$,U,this.width,this.height):(q=Math.ceil(Math.max(distance2Points(L,B),distance2Points(U,$))),G=Math.ceil(Math.max(distance2Points(L,U),distance2Points(B,$))));let W=Image$1.createFrom(this,{width:q,height:G}),[te,oe]=L,[ee,_e]=B,[se,he]=$,[ge,Re]=U,[ve,de]=[0,0],[Se,ce]=[0,q-1],[ye,ze]=[G-1,q-1],[Xe,at]=[G-1,0],ct=new Matrix$2([[ve,de,1,0,0,0,-ve*te,-de*te],[Se,ce,1,0,0,0,-Se*ee,-ce*ee],[ye,ze,1,0,0,0,-ye*se,-de*se],[Xe,at,1,0,0,0,-Xe*ge,-at*ge],[0,0,0,ve,de,1,-ve*oe,-de*oe],[0,0,0,Se,ce,1,-Se*_e,-ce*_e],[0,0,0,ye,ze,1,-ye*he,-ze*he],[0,0,0,Xe,at,1,-Xe*Re,-at*Re]]),Bt=Matrix$2.columnVector([te,ee,se,ge,oe,_e,he,Re]),It=new SingularValueDecomposition(ct).solve(Bt),[Vt,Ft,Mt,ri,St,At,Et,Ut]=It.to1DArray(),jt=new Matrix$2(G,q);for(let mi=0;mi<this.channels;mi++){for(let oi=0;oi<G;oi++)for(let yi=0;yi<q;yi++)jt.set(oi,yi,projectionPoint(oi,yi,Vt,Ft,Mt,ri,St,At,Et,Ut,this,mi));W.setMatrix(jt,{channel:mi})}return W}function crop(d={}){let{x:h=0,y:p=0,width:m=this.width-h,height:w=this.height-p}=d;if(this.checkProcessable("max",{bitDepth:[8,16]}),h=Math.round(h),p=Math.round(p),m=Math.round(m),w=Math.round(w),h>this.width-1||p>this.height-1)throw new RangeError(`crop: origin (x:${h}, y:${p}) out of range (${this.width-1}; ${this.height-1})`);if(m<=0||w<=0)throw new RangeError(`crop: width and height (width:${m}; height:${w}) must be positive numbers`);if(h<0||p<0)throw new RangeError(`crop: x and y (x:${h}, y:${p}) must be positive numbers`);if(m>this.width-h||w>this.height-p)throw new RangeError(`crop: (x: ${h}, y:${p}, width:${m}, height:${w}) size is out of range`);let M=Image$1.createFrom(this,{width:m,height:w,position:[h,p]}),k=m*this.channels,x=p+w,L=0,B=h*this.channels;for(let $=p;$<x;$++){let U=$*this.width*this.channels+B,q=U+k;for(;U<q;U++)M.data[L++]=this.data[U]}return M}function cropAlpha(d={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:h=this.maxValue}=d;let p=findLeft(this,h,this.components);if(p===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let m=findTop(this,h,this.components,p),w=findBottom(this,h,this.components,p),M=findRight(this,h,this.components,p,m,w);return this.crop({x:p,y:m,width:M-p+1,height:w-m+1})}function findLeft(d,h,p){for(let m=0;m<d.width;m++)for(let w=0;w<d.height;w++)if(d.getValueXY(m,w,p)>=h)return m;return-1}function findTop(d,h,p,m){for(let w=0;w<d.height;w++)for(let M=m;M<d.width;M++)if(d.getValueXY(M,w,p)>=h)return w;return-1}function findBottom(d,h,p,m){for(let w=d.height-1;w>=0;w--)for(let M=m;M<d.width;M++)if(d.getValueXY(M,w,p)>=h)return w;return-1}function findRight(d,h,p,m,w,M){for(let k=d.width-1;k>=m;k--)for(let x=w;x<=M;x++)if(d.getValueXY(k,x,p)>=h)return k;return-1}function getFactor(d){if(typeof d=="string"){const h=d[d.length-1];d=parseFloat(d),h==="%"&&(d/=100)}return d}function getThreshold$1(d,h){if(!h)throw Error("getThreshold : the maxValue should be specified");if(typeof d=="string"){if(d[d.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(d)/100*h}else{if(typeof d=="number")return d<1?d*h:d;throw Error("getThreshold : the value is not valid")}}function factorDimensions(d,h,p){d=getFactor(d);let m=Math.round(d*h),w=Math.round(d*p);return m<=0&&(m=1),w<=0&&(w=1),{width:m,height:w}}function checkRow(d,h){if(h<0||h>=d.height)throw new RangeError(`row must be included between 0 and ${d.height-1}. Current value: ${h}`)}function checkColumn(d,h){if(h<0||h>=d.width)throw new RangeError(`column must be included between 0 and ${d.width-1}. Current value: ${h}`)}function checkChannel(d,h){if(h<0||h>=d.channels)throw new RangeError(`channel must be included between 0 and ${d.channels-1}. Current value: ${h}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(d){if(typeof d!="string")throw new TypeError("interpolation must be a string");if(d=d.toLowerCase(),!validInterpolations[d])throw new RangeError(`invalid interpolation algorithm: ${d}`);return validInterpolations[d]}function nearestNeighbor(d,h,p){const m=this.width/h,w=this.height/p;if(this.bitDepth>1)for(let M=0;M<h;M++){const k=Math.floor((M+.5)*m);for(let x=0;x<p;x++){const L=Math.floor((x+.5)*w);for(let B=0;B<this.channels;B++)d.setValueXY(M,x,B,this.getValueXY(k,L,B))}}else for(let M=0;M<h;M++){const k=Math.floor((M+.5)*m);for(let x=0;x<p;x++){const L=Math.floor((x+.5)*w);this.getBitXY(k,L)&&d.setBitXY(M,x)}}}function resize(d={}){const{factor:h=1,interpolation:p=validInterpolations.nearestneighbor,preserveAspectRatio:m=!0}=d,w=checkInterpolation(p);let M=d.width,k=d.height;if(M||(k&&m?M=Math.round(k*(this.width/this.height)):M=this.width),k||(m?k=Math.round(M*(this.height/this.width)):k=this.height),{width:M,height:k}=factorDimensions(h,M,k),M===this.width&&k===this.height){const $=this.clone();return $.position=[0,0],$}let x=Math.round((this.width-M)/2),L=Math.round((this.height-k)/2);const B=Image$1.createFrom(this,{width:M,height:k,position:[x,L]});switch(w){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,B,M,k);break;default:throw new Error(`unsupported resize interpolation: ${w}`)}return B}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let d=Image$1.createFrom(this,{colorModel:HSV}),h=0,p=this.data;for(let m=0;m<p.length;m+=this.channels){let w=p[m],M=p[m+1],k=p[m+2],x=Math.min(w,M,k),L=Math.max(w,M,k),B=L-x,$=0,U=L===0?0:B/L,q=L;if(L!==x){switch(L){case w:$=(M-k)/B+(M<k?6:0);break;case M:$=(k-w)/B+2;break;case k:$=(w-M)/B+4;break;default:throw new Error("unreachable")}$/=6}d.data[h++]=$*this.maxValue,d.data[h++]=U*this.maxValue,d.data[h++]=q,this.alpha&&(d.data[h++]=p[m+3])}return d}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let d=Image$1.createFrom(this,{colorModel:HSL}),h=Math.floor(this.maxValue/2),p=0,m=this.data;for(let w=0;w<m.length;w+=this.channels){let M=m[w],k=m[w+1],x=m[w+2],L=Math.max(M,k,x),B=Math.min(M,k,x),$=0,U=0,q=(L+B)/2;if(L!==B){let G=L-B;switch(U=q>h?G/(2-L-B):G/(L+B),L){case M:$=(k-x)/G+(k<x?6:0);break;case k:$=(x-M)/G+2;break;case x:$=(M-k)/G+4;break;default:throw new Error("unreachable")}$/=6}d.data[p++]=$*this.maxValue,d.data[p++]=U*this.maxValue,d.data[p++]=q,this.alpha&&(d.data[p++]=m[w+3])}return d}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let d=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),h=0,p=this.data;for(let m=0;m<p.length;m+=this.channels){let w=p[m],M=p[m+1],k=p[m+2],x=Math.min(this.maxValue-w,this.maxValue-M,this.maxValue-k),L=(this.maxValue-w-x)/(1-x/this.maxValue),B=(this.maxValue-M-x)/(1-x/this.maxValue),$=(this.maxValue-k-x)/(1-x/this.maxValue);d.data[h++]=Math.round(L),d.data[h++]=Math.round(B),d.data[h++]=Math.round($),d.data[h++]=Math.round(x),this.alpha&&(d.data[h++]=p[m+3])}return d}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(d,h,p){return d*6966+h*23436+p*2366>>15},luma601(d,h,p){return d*9798+h*19235+p*3735>>15},maximum(d,h,p){return Math.max(d,h,p)},minimum(d,h,p){return Math.min(d,h,p)},average(d,h,p){return(d+h+p)/3>>0},minmax(d,h,p){return(Math.max(d,h,p)+Math.min(d,h,p))/2},red(d){return d},green(d,h){return h},blue(d,h,p){return p},cyan(d,h,p,m){let w=methods$1.black(d,h,p,m);return(m.maxValue-d-w)/(1-w/m.maxValue)>>0},magenta(d,h,p,m){let w=methods$1.black(d,h,p,m);return(m.maxValue-h-w)/(1-w/m.maxValue)>>0},yellow(d,h,p,m){let w=methods$1.black(d,h,p,m);return(m.maxValue-p-w)/(1-w/m.maxValue)>>0},black(d,h,p,m){return Math.min(m.maxValue-d,m.maxValue-h,m.maxValue-p)},hue(d,h,p,m){let w=methods$1.min(d,h,p),M=methods$1.max(d,h,p);if(M===w)return 0;let k=0,x=M-w;switch(M){case d:k=(h-p)/x+(h<p?6:0);break;case h:k=(p-d)/x+2;break;case p:k=(d-h)/x+4;break;default:throw new Error("unreachable")}return k/6*m.maxValue>>0},saturation(d,h,p,m){let w=methods$1.min(d,h,p),M=methods$1.max(d,h,p),k=M-w;return M===0?0:k/M*m.maxValue},lightness(d,h,p){let m=methods$1.min(d,h,p);return(methods$1.max(d,h,p)+m)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});const names$1={};Object.keys(methods$1).forEach(d=>{names$1[d]=d});function grey(d={}){let{algorithm:h="luma709",keepAlpha:p=!1,mergeAlpha:m=!0}=d;if(typeof h!="string"&&typeof h!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(h="red"),p&=this.alpha,m&=this.alpha,p&&(m=!1);let w=getOutputImage(this,d,{components:1,alpha:p,colorModel:GREY$1}),M;if(typeof h=="function")M=h;else if(M=methods$1[h.toLowerCase()],!M)throw new Error(`unsupported grey algorithm: ${h}`);let k=0;for(let x=0;x<this.data.length;x+=this.channels)m?w.data[k++]=clamp(M(this.data[x],this.data[x+1],this.data[x+2],this)*this.data[x+this.components]/this.maxValue,this):(w.data[k++]=clamp(M(this.data[x],this.data[x+1],this.data[x+2],this),this),w.alpha&&(w.data[k++]=this.data[x+this.components]));return w}function huang(d){let h=0;for(let $=0;$<d.length;$++)if(d[$]!==0){h=$;break}let p=d.length-1;for(let $=d.length-1;$>=h;$--)if(d[$]!==0){p=$;break}let m=1/(p-h),w=new Array(d.length),M=0,k=0;for(let $=h;$<d.length;$++)M+=$*d[$],k+=d[$],w[$]=M/k;let x=new Array(d.length);M=k=0;for(let $=p;$>0;$--)M+=$*d[$],k+=d[$],x[$-1]=M/k;let L=-1,B=Number.MAX_VALUE;for(let $=0;$<d.length;$++){let U=0,q;for(let G=0;G<=$;G++)q=1/(1+m*Math.abs(G-w[$])),q<1e-6||q>.999999||(U+=d[G]*(-q*Math.log(q)-(1-q)*Math.log(1-q)));for(let G=$+1;G<d.length;G++)q=1/(1+m*Math.abs(G-x[$])),q<1e-6||q>.999999||(U+=d[G]*(-q*Math.log(q)-(1-q)*Math.log(1-q)));U<B&&(B=U,L=$)}return L}function intermodes(d){let h=d.slice(),p=0;for(;!bimodalTest$1(h);){let w=0,M=0,k=h[0];for(let x=0;x<d.length-1;x++)w=M,M=k,k=h[x+1],h[x]=(w+M+k)/3;if(h[d.length-1]=(M+k)/3,p++,p>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let m=0;for(let w=1;w<d.length-1;w++)h[w-1]<h[w]&&h[w+1]<h[w]&&(m+=w);return Math.floor(m/2)}function bimodalTest$1(d){let h=!1,p=0;for(let m=1;m<d.length-1;m++)if(d[m-1]<d[m]&&d[m+1]<d[m]&&(p++,p>2))return!1;return p===2&&(h=!0),h}function isodata(d){let h,p,m,w,M=0;for(let k=1;k<d.length;k++)if(d[k]>0){M=k+1;break}for(;;){h=0,m=0;for(let k=0;k<M;k++)m=m+d[k],h=h+d[k]*k;w=0,p=0;for(let k=M+1;k<d.length;k++)p+=d[k],w+=d[k]*k;if(m>0&&p>0&&(h/=m,w/=p,M===Math.round((h+w)/2)))break;if(M++,M>d.length-2)throw new Error("Threshold not found")}return M}function li(d,h){let p,m,w,M,k,x,L,B,$,U,q,G;q=.5,U=0;for(let W=0;W<d.length;W++)U+=W*d[W];U/=h,L=U;do{x=L,p=x+.5|0,m=0,M=0;for(let W=0;W<=p;W++)m+=W*d[W],M+=d[W];B=M===0?0:m/M,w=0,k=0;for(let W=p+1;W<d.length;W++)w+=W*d[W],k+=d[W];$=k===0?0:w/k,G=(B-$)/(Math.log(B)-Math.log($)),G<-Number.EPSILON?L=G-.5|0:L=G+.5|0}while(Math.abs(L-x)>q);return p}function maxEntropy(d,h){let p=new Array(d.length);for(let q=0;q<d.length;q++)p[q]=d[q]/h;let m=new Array(d.length),w=new Array(d.length);m[0]=p[0],w[0]=1-m[0];for(let q=1;q<d.length;q++)m[q]=m[q-1]+p[q],w[q]=1-m[q];let M=0;for(let q=0;q<d.length;q++)if(Math.abs(m[q])>=Number.EPSILON){M=q;break}let k=d.length-1;for(let q=d.length-1;q>=M;q--)if(Math.abs(w[q])>=Number.EPSILON){k=q;break}let x=-1,L,B=Number.MIN_VALUE,$,U;for(let q=M;q<=k;q++){$=0;for(let G=0;G<=q;G++)d[G]!==0&&($-=p[G]/m[q]*Math.log(p[G]/m[q]));U=0;for(let G=q+1;G<d.length;G++)d[G]!==0&&(U-=p[G]/w[q]*Math.log(p[G]/w[q]));L=$+U,B<L&&(B=L,x=q)}return x}function mean$1(d,h){let p=0;for(let m=0;m<d.length;m++)p+=m*d[m];return Math.floor(p/h)}function minError(d,h){let p,m=-2,w,M,k,x,L,B,$,U,q,G,W,te=0;for(let oe=0;oe<d.length;oe++)te+=oe*d[oe];for(te/=h,p=te;p!==m;){let oe=sumA(d,p),ee=sumA(d,d.length-1),_e=sumB(d,p),se=sumB(d,d.length-1),he=sumC(d,p),ge=sumC(d,d.length-1);if(w=_e/oe,M=(se-_e)/(ee-oe),k=oe/ee,x=(ee-oe)/ee,L=he/oe-w*w,B=(ge-he)/(ee-oe)-M*M,$=1/L-1/B,U=w/L-M/B,q=w*w/L-M*M/B+Math.log10(L*(x*x)/(B*(k*k))),G=U*U-$*q,G<0)return p;m=p,W=(U+Math.sqrt(G))/$,isNaN(W)?p=m:p=Math.floor(W)}return p}function sumA(d,h){let p=0;for(let m=0;m<=h;m++)p+=d[m];return p}function sumB(d,h){let p=0;for(let m=0;m<=h;m++)p+=m*d[m];return p}function sumC(d,h){let p=0;for(let m=0;m<=h;m++)p+=m*m*d[m];return p}function minimum(d){if(d.length<2)return 0;let h=0,p=-1,m=-1,w=new Array(d.length);for(let M=0;M<d.length;M++)w[M]=d[M],d[M]>0&&(m=M);for(;!bimodalTest(w);)if(w=smoothed(w),h++,h>1e4)return p;return p=minimumBetweenPeeks(w,m),p}function smoothed(d){let h=new Array(d.length);for(let p=1;p<d.length-1;p++)h[p]=(d[p-1]+d[p]+d[p+1])/3;return h[0]=(d[0]+d[1])/3,h[d.length-1]=(d[d.length-2]+d[d.length-1])/3,h}function minimumBetweenPeeks(d,h){let p;for(let m=1;m<h;m++)if(d[m-1]>d[m]&&d[m+1]>=d[m]){p=m;break}return p}function bimodalTest(d){let h=d.length,p=!1,m=0;for(let w=1;w<h-1;w++)if(d[w-1]<d[w]&&d[w+1]<d[w]&&(m++,m>2))return!1;return m===2&&(p=!0),p}function moments(d,h){let p=1,m=0,w=0,M=0,k=0,x,L,B,$,U,q,G=-1,W=d.length,te=new Array(W);for(let oe=0;oe<W;oe++)te[oe]=d[oe]/h;for(let oe=0;oe<W;oe++)m+=oe*te[oe],w+=oe*oe*te[oe],M+=oe*oe*oe*te[oe];L=p*w-m*m,B=(-w*w+m*M)/L,$=(p*-M+w*m)/L,U=.5*(-$-Math.sqrt($*$-4*B)),q=.5*(-$+Math.sqrt($*$-4*B)),x=(q-m)/(q-U);for(let oe=0;oe<W;oe++)if(k+=te[oe],k>x){G=oe;break}return G}function otsu(d,h){let p=0,m=0,w=0,M=0,k=0;for(let x=0;x<d.length;x++)k+=x*d[x];for(let x=0;x<d.length;x++){m=m+d[x];const L=h-m;if(m===0||L===0)continue;p=p+x*d[x];const B=(k-p)/L,$=m*L*(p/m-B)*(p/m-B);$>=w&&(M=x,w=$)}return M}function percentile(d){let h=-1,p=.5,m=new Array(d.length),w=partialSum(d,d.length-1),M=1;for(let k=0;k<d.length;k++)m[k]=Math.abs(partialSum(d,k)/w-p),m[k]<M&&(M=m[k],h=k);return h}function partialSum(d,h){let p=0;for(let m=0;m<=h;m++)p+=d[m];return p}function renyiEntropy(d,h){let p,m,w,M=new Array(d.length),k=new Array(d.length),x=new Array(d.length),L=0,B=0,$=0,U=0,q=0,G=0,te=1/(1-.5),ee=1/(1-2);for(let ge=0;ge<d.length;ge++)M[ge]=d[ge]/h;k[0]=M[0],x[0]=1-k[0];for(let ge=1;ge<d.length;ge++)k[ge]=k[ge-1]+M[ge],x[ge]=1-k[ge];m=0;for(let ge=0;ge<d.length;ge++)if(Math.abs(k[ge])>=Number.EPSILON){m=ge;break}w=d.length-1;for(let ge=d.length-1;ge>=m;ge--)if(Math.abs(x[ge])>=Number.EPSILON){w=ge;break}for(let ge=m;ge<=w;ge++){let Re=0,ve=0,de=0;for(let ct=0;ct<=ge;ct++)d[ct]!==0&&(Re-=M[ct]/k[ge]*Math.log(M[ct]/k[ge])),ve+=Math.sqrt(M[ct]/k[ge]),de+=M[ct]*M[ct]/(k[ge]*k[ge]);let Se=0,ce=0,ye=0;for(let ct=ge+1;ct<d.length;ct++)d[ct]!==0&&(Se-=M[ct]/x[ge]*Math.log(M[ct]/x[ge])),ce+=Math.sqrt(M[ct]/x[ge]),ye+=M[ct]*M[ct]/(x[ge]*x[ge]);let ze=Re+Se,Xe=te*(ve*ce>0?Math.log(ve*ce):0),at=ee*(de*ye>0?Math.log(de*ye):0);ze>U&&(U=ze,L=ge),Xe>q&&(q=Xe,B=ge),at>G&&(G=at,$=ge)}let _e=[L,B,$];_e.sort((ge,Re)=>ge-Re);let se;Math.abs(_e[0]-_e[1])<=5?Math.abs(_e[1]-_e[2])<=5?se=[1,2,1]:se=[0,1,3]:Math.abs(_e[1]-_e[2])<=5?se=[3,1,0]:se=[1,2,1];let he=k[_e[2]]-k[_e[0]];return p=Math.round(_e[0]*(k[_e[0]]+.25*he*se[0])+.25*_e[1]*he*se[1]+_e[2]*(x[_e[2]]+.25*he*se[2])),p}function shanbhag(d,h){let p=new Array(d.length);for(let G=0;G<d.length;G++)p[G]=d[G]/h;let m=new Array(d.length),w=new Array(d.length);m[0]=p[0],w[0]=1-m[0];for(let G=1;G<d.length;G++)m[G]=m[G-1]+p[G],w[G]=1-m[G];let M=0;for(let G=0;G<d.length;G++)if(Math.abs(m[G])>=Number.EPSILON){M=G;break}let k=d.length-1;for(let G=d.length-1;G>=M;G--)if(Math.abs(w[G])>=Number.EPSILON){k=G;break}let x=-1,L=Number.MAX_VALUE,B,$,U,q;for(let G=M;G<=k;G++){U=0,B=.5/m[G];for(let W=1;W<=G;W++)U-=p[W]*Math.log(1-B*m[W-1]);U*=B,q=0,B=.5/w[G];for(let W=G+1;W<d.length;W++)q-=p[W]*Math.log(1-B*w[W]);q*=B,$=Math.abs(U-q),$<L&&(L=$,x=G)}return x}function triangle$1(d){let h=0,p=0,m=0,w=0;for(let U=0;U<d.length;U++)if(d[U]>0){h=U;break}h>0&&h--;for(let U=d.length-1;U>0;U--)if(d[U]>0){w=U;break}w<d.length-1&&w++;for(let U=0;U<d.length;U++)d[U]>p&&(m=U,p=d[U]);let M=!1;if(m-h<w-m){M=!0;let U=0,q=d.length-1;for(;U<q;){let G=d[U];d[U]=d[q],d[q]=G,U++,q--}h=d.length-1-w,m=d.length-1-m}if(h===m)return h;let k,x,L;k=d[m],x=h-m,L=Math.sqrt(k*k+x*x),k/=L,x/=L,L=k*h+x*d[h];let B=h,$=0;for(let U=h+1;U<=m;U++){let q=k*U+x*d[U]-L;q>$&&(B=U,$=q)}if(B--,M){let U=0,q=d.length-1;for(;U<q;){let G=d[U];d[U]=d[q],d[q]=G,U++,q--}return d.length-1-B}else return B}function yen(d,h){let p=new Array(d.length);for(let B=0;B<d.length;B++)p[B]=d[B]/h;let m=new Array(d.length);m[0]=p[0];for(let B=1;B<d.length;B++)m[B]=m[B-1]+p[B];let w=new Array(d.length);w[0]=p[0]*p[0];for(let B=1;B<d.length;B++)w[B]=w[B-1]+p[B]*p[B];let M=new Array(d.length);M[d.length-1]=0;for(let B=d.length-2;B>=0;B--)M[B]=M[B+1]+p[B+1]*p[B+1];let k=-1,x=Number.MIN_VALUE,L;for(let B=0;B<d.length;B++)L=-1*(w[B]*M[B]>0?Math.log(w[B]*M[B]):0)+2*(m[B]*(1-m[B])>0?Math.log(m[B]*(1-m[B])):0),L>x&&(x=L,k=B);return k}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(d=>{names[d]=d});function getThreshold(d={}){let{algorithm:h=names.otsu}=d;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let p=methods[h.toLowerCase()];if(p){let m=this.getHistogram();return p(m,this.size)}else throw new Error(`unknown thresholding algorithm: ${h}`)}const THRESHOLD="threshold";function mask(d={}){let{algorithm:h=THRESHOLD,threshold:p=.5,useAlpha:m=!0,invert:w=!1}=d;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),h===THRESHOLD?p=getThreshold$1(p,this.maxValue):p=getThreshold.call(this,d);let M=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),k=0;if(this.alpha&&m)for(let x=0;x<this.data.length;x+=this.channels){let L=this.data[x]+(this.maxValue-this.data[x])*(this.maxValue-this.data[x+1])/this.maxValue;(w&&L<=p||!w&&L>=p)&&M.setBit(k),k++}else for(let x=0;x<this.data.length;x+=this.channels)(w&&this.data[x]<=p||!w&&this.data[x]>=p)&&M.setBit(k),k++;return M}function copyImage(d,h,p,m){let w=d.width,M=d.height,k=h.width,x=d.channels;for(let L=0;L<w;L++)for(let B=0;B<M;B++)for(let $=0;$<x;$++){let U=(B*w+L)*x+$,q=((m+B)*k+p+L)*x+$;h.data[q]=d.data[U]}}function pad(d={}){let{size:h=0,algorithm:p="copy",color:m}=d;if(this.checkProcessable("pad",{bitDepth:[8,16]}),p==="set"){if(m.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let L=0;L<m.length;L++)m[L]===0&&(m[L]=.001)}else m=newArray_1(this.channels,null);Array.isArray(h)||(h=[h,h]);let w=this.width+h[0]*2,M=this.height+h[1]*2,k=this.channels,x=Image$1.createFrom(this,{width:w,height:M});copyImage(this,x,h[0],h[1]);for(let L=h[0];L<w-h[0];L++)for(let B=0;B<k;B++){let $=m[B]||x.data[(h[1]*w+L)*k+B];for(let U=0;U<h[1];U++)x.data[(U*w+L)*k+B]=$;$=m[B]||x.data[((M-h[1]-1)*w+L)*k+B];for(let U=M-h[1];U<M;U++)x.data[(U*w+L)*k+B]=$}for(let L=0;L<M;L++)for(let B=0;B<k;B++){let $=m[B]||x.data[(L*w+h[0])*k+B];for(let U=0;U<h[0];U++)x.data[(L*w+U)*k+B]=$;$=m[B]||x.data[(L*w+w-h[0]-1)*k+B];for(let U=w-h[0];U<w;U++)x.data[(L*w+U)*k+B]=$}return x}function colorDepth(d=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(d))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===d)return this.clone();let h=Image$1.createFrom(this,{bitDepth:d});switch(d){case 8:if(this.bitDepth===1)for(let p=0;p<this.size;p++)this.getBit(p)&&(h.data[p]=255);else for(let p=0;p<this.data.length;p++)h.data[p]=this.data[p]>>8;break;case 16:if(this.bitDepth===1)for(let p=0;p<this.size;p++)this.getBit(p)&&(h.data[p]=65535);else for(let p=0;p<this.data.length;p++)h.data[p]=this.data[p]<<8|this.data[p];break;default:throw new Error("colorDepth conversion unexpected case")}return h}function rotateFree(d,h={}){const{interpolation:p=validInterpolations.nearestneighbor,width:m=this.width,height:w=this.height}=h;if(typeof d!="number")throw new TypeError("degrees must be a number");const M=checkInterpolation(p),k=d*Math.PI/180,x=Math.floor(Math.abs(m*Math.cos(k))+Math.abs(w*Math.sin(k))),L=Math.floor(Math.abs(w*Math.cos(k))+Math.abs(m*Math.sin(k))),B=Image$1.createFrom(this,{width:x,height:L}),$=Math.cos(-k),U=Math.sin(-k);let q=x/2,G=L/2;x%2===0?(q=q-.5,L%2===0?G=G-.5:G=Math.floor(G)):(q=Math.floor(q),L%2===0?G=G-.5:G=Math.floor(G));const W=Math.floor(m/2-q),te=Math.floor(w/2-G);switch(M){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,B,W,te,q,G,$,U);case validInterpolations.bilinear:return rotateBilinear(this,B,W,te,q,G,$,U);default:throw new Error(`unsupported rotate interpolation: ${M}`)}}function rotateNearestNeighbor(d,h,p,m,w,M,k,x){for(let L=0;L<h.width;L+=1)for(let B=0;B<h.height;B+=1)for(let $=0;$<d.channels;$++){let U=Math.round((L-w)*k-(B-M)*x+w)+p,q=Math.round((B-M)*k+(L-w)*x+M)+m;U<0||U>=d.width||q<0||q>=d.height?d.alpha===1&&$===d.channels-1?h.setValueXY(L,B,$,0):h.setValueXY(L,B,$,d.maxValue):h.setValueXY(L,B,$,d.getValueXY(U,q,$))}return h}function rotateBilinear(d,h,p,m,w,M,k,x){let L=d.width*d.channels;for(let B=0;B<h.height;B++)for(let $=0;$<h.width;$++){let U=($-w)*k-(B-M)*x+w+p,q=(B-M)*k+($-w)*x+M+m,G=U|0,W=q|0,te=U-G,oe=q-W;for(let ee=0;ee<d.channels;ee++)if(U<0||U>=d.width||q<0||q>=d.height)d.alpha===1&&ee===d.channels-1?h.setValueXY($,B,ee,0):h.setValueXY($,B,ee,d.maxValue);else{let _e=(W*d.width+G)*d.channels+ee,se=d.data[_e],he=d.data[_e+d.channels],ge=d.data[_e+L],Re=d.data[_e+L+d.channels],ve=se+te*(he-se)+oe*(ge-se)+te*oe*(se-he-ge+Re)|0;h.setValueXY($,B,ee,ve)}}return h}function rotate$1(d,h){if(typeof d!="number")throw new TypeError("angle must be a number");switch(d<0&&(d=Math.ceil(-d/360)*360+d),d%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,d,h)}}function rotateLeft(){const d=Image$1.createFrom(this,{width:this.height,height:this.width}),h=d.height-1;for(let p=0;p<this.height;p++)for(let m=0;m<this.width;m++)for(let w=0;w<this.channels;w++)d.setValueXY(p,h-m,w,this.getValueXY(m,p,w));return d}function rotateRight(){const d=Image$1.createFrom(this,{width:this.height,height:this.width}),h=d.width-1;for(let p=0;p<this.height;p++)for(let m=0;m<this.width;m++)for(let w=0;w<this.channels;w++)d.setValueXY(h-p,m,w,this.getValueXY(m,p,w));return d}function rotate180(){const d=Image$1.createFrom(this),h=d.width-1,p=d.height-1;for(let m=0;m<this.height;m++)for(let w=0;w<this.width;w++)for(let M=0;M<this.channels;M++)d.setValueXY(h-w,p-m,M,this.getValueXY(w,m,M));return d}function insert(d,h={}){const p=getImageParameters(d);this.checkProcessable("insert",p);let{x:m=0,y:w=0}=h;const M=getOutputImageOrInPlace(this,h,{copy:!0}),k=Math.min(M.height,w+d.height),x=Math.min(M.width,m+d.width);if(M.bitDepth===1)for(let L=w;L<k;L++)for(let B=m;B<x;B++)d.getBitXY(B-m,L-w)?M.setBitXY(B,L):M.clearBitXY(B,L);else for(let L=w;L<k;L++)for(let B=m;B<x;B++)M.setPixelXY(B,L,d.getPixelXY(B-m,L-w));return M}function setBorder(d={}){let{size:h=0,algorithm:p="copy",color:m}=d;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),p==="set"){if(m.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let x=0;x<m.length;x++)m[x]===0&&(m[x]=.001)}else m=newArray_1(this.channels,null);Array.isArray(h)||(h=[h,h]);let w=h[0],M=h[1],k=this.channels;for(let x=w;x<this.width-w;x++)for(let L=0;L<k;L++){let B=m[L]||this.data[(x+this.width*M)*k+L];for(let $=0;$<M;$++)this.data[($*this.width+x)*k+L]=B;B=m[L]||this.data[(x+this.width*(this.height-M-1))*k+L];for(let $=this.height-M;$<this.height;$++)this.data[($*this.width+x)*k+L]=B}for(let x=0;x<this.height;x++)for(let L=0;L<k;L++){let B=m[L]||this.data[(x*this.width+w)*k+L];for(let $=0;$<w;$++)this.data[(x*this.width+$)*k+L]=B;B=m[L]||this.data[(x*this.width+this.width-w-1)*k+L];for(let $=this.width-w;$<this.width;$++)this.data[(x*this.width+$)*k+L]=B}return this}function split(d={}){let{preserveAlpha:h=!0}=d;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let p=new Stack,m=this.data;if(this.alpha&&h)for(let w=0;w<this.components;w++){let M=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),k=0;for(let x=0;x<m.length;x+=this.channels)M.data[k++]=m[x+w],M.data[k++]=m[x+this.components];p.push(M)}else for(let w=0;w<this.channels;w++){let M=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),k=0;for(let x=0;x<m.length;x+=this.channels)M.data[k++]=m[x+w];p.push(M)}return p}function getChannel(d,h={}){let{keepAlpha:p=!1,mergeAlpha:m=!1}=h;p&=this.alpha,m&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),d=validateChannel(this,d);let w=Image$1.createFrom(this,{components:1,alpha:p,colorModel:GREY$1}),M=0;for(let k=0;k<this.data.length;k+=this.channels)m?w.data[M++]=this.data[k+d]*this.data[k+this.components]/this.maxValue:(w.data[M++]=this.data[k+d],p&&(w.data[M++]=this.data[k+this.components]));return w}function combineChannels(d=defaultCombineMethod,h={}){let{mergeAlpha:p=!1,keepAlpha:m=!1}=h;p&=this.alpha,m&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let w=Image$1.createFrom(this,{components:1,alpha:m,colorModel:GREY$1}),M=0;for(let k=0;k<this.size;k++){let x=d(this.getPixel(k));p?w.data[M++]=x*this.data[k*this.channels+this.components]/this.maxValue:(w.data[M++]=x,m&&(w.data[M++]=this.data[k*this.channels+this.components]))}return w}function defaultCombineMethod(d){return(d[0]+d[1]+d[2])/3}function setChannel(d,h){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),h.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),h.width!==this.width||h.height!==this.height)throw new Error("Images must have exactly the same width and height");d=validateChannel(this,d);let p=d;for(let m=0;m<h.data.length;m++)this.data[p]=h.data[m],p+=this.channels;return this}function getSimilarity(d,h={}){let{shift:p=[0,0],average:m,channels:w,defaultAlpha:M,normalize:k,border:x=[0,0]}=h;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(x)||(x=[x,x]),w=validateArrayOfChannels(this,{channels:w,defaultAlpha:M}),this.bitDepth!==d.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==d.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==d.colorModel)throw new Error("Both images must have the same colorModel");typeof m=="undefined"&&(m=!0);let L=Math.max(x[0],-p[0]),B=Math.min(this.width-x[0],this.width-p[0]),$=Math.max(x[1],-p[1]),U=Math.min(this.height-x[1],this.height-p[1]),q=newArray_1(w.length,0);for(let G=0;G<w.length;G++){let W=w[G],te=k?this.sum[W]:Math.max(this.sum[W],d.sum[W]),oe=k?d.sum[W]:Math.max(this.sum[W],d.sum[W]);if(te!==0&&oe!==0)for(let ee=L;ee<B;ee++)for(let _e=$;_e<U;_e++){let se=ee*this.multiplierX+_e*this.multiplierY+W,he=se+p[0]*this.multiplierX+p[1]*this.multiplierY;q[G]+=Math.min(this.data[se]/te,d.data[he]/oe)}}return m?q.reduce((G,W)=>G+W)/q.length:q}function getPixelsGrid(d={}){let{sampling:h=[10,10],painted:p=!1,mask:m}=d;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(h)||(h=[h,h]);const w=h[0],M=h[1],k=[],x=[],L=this.width/w,B=this.height/M;let $=Math.floor(L/2);for(let q=0;q<w;q++){let G=Math.floor(B/2);for(let W=0;W<M;W++){let te=Math.round($),oe=Math.round(G);(!m||m.getBitXY(te,oe))&&(k.push([te,oe]),x.push(this.getPixelXY(te,oe))),G+=B}$+=L}const U={xyS:k,zS:x};return p&&(U.painted=this.rgba8().paintPoints(k)),U}function Matrix(d,h,p){const m=new Array(d);for(let w=0;w<d;w++)m[w]=new Array(h);if(p)for(let w=0;w<d;w++)for(let M=0;M<h;M++)m[w][M]=p;return m.width=d,m.height=h,Object.setPrototypeOf(m,Matrix.prototype),m}Matrix.prototype.localMin=function(d,h){let p=this[d][h],m=[d,h];for(let w=Math.max(0,d-1);w<Math.min(this.length,d+2);w++)for(let M=Math.max(0,h-1);M<Math.min(this[0].length,h+2);M++)this[w][M]<p&&(p=this[w][M],m=[w,M]);return{position:m,value:p}};Matrix.prototype.localMax=function(d,h){let p=this[d][h],m=[d,h];for(let w=Math.max(0,d-1);w<Math.min(this.length,d+2);w++)for(let M=Math.max(0,h-1);M<Math.min(this[0].length,h+2);M++)this[w][M]>p&&(p=this[w][M],m=[w,M]);return{position:m,value:p}};Matrix.prototype.localSearch=function(d,h,p){let m=[];for(let w=Math.max(0,d-1);w<Math.min(this.length,d+2);w++)for(let M=Math.max(0,h-1);M<Math.min(this[0].length,h+2);M++)this[w][M]===p&&m.push([w,M]);return m};function getBestMatch(d,h={}){let{border:p}=h;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==d.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==d.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==d.colorModel)throw new Error("Both images must have the same colorModel");let m=new Matrix(d.width,d.height,-1/0),w=Math.floor(d.width/2),M=Math.floor(d.height/2),k=w,x=M,L=!1;for(;!L;){let B=m.localSearch(w,M,-1/0);for(let U=0;U<B.length;U++){let q=B[U],G=this.getSimilarity(d,{border:p,shift:[k-q[0],x-q[1]]});m[q[0]][q[1]]=G}let $=m.localMax(w,M);$.position[0]!==w||$.position[1]!==M?(w=$.position[0],M=$.position[1]):L=!0}return[w-k,M-x]}function getRow(d,h=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,d),checkChannel(this,h);let p=new Array(this.width),m=0,w=d*this.width*this.channels+h,M=w+this.width*this.channels;for(let k=w;k<M;k+=this.channels)p[m++]=this.data[k];return p}function getColumn(d,h=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,d),checkChannel(this,h);let p=new Array(this.height),m=0,w=this.width*this.channels;for(let M=h+d*this.channels;M<this.data.length;M+=w)p[m++]=this.data[M];return p}function getMatrix(d={}){let{channel:h}=d;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),h===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");h=0}let p=new Matrix$2(this.height,this.width);for(let m=0;m<this.height;m++)for(let w=0;w<this.width;w++)p.set(m,w,this.getValueXY(w,m,h));return p}function setMatrix(d,h={}){d=new Matrix$2(d);let{channel:p}=h;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),p===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");p=0}if(this.width!==d.columns||this.height!==d.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let m=0;m<this.height;m++)for(let w=0;w<this.width;w++)this.setValueXY(w,m,p,d.get(m,w))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let d=new Array(this.size),h=0;for(let p=0;p<this.data.length;p+=this.channels){let m=new Array(this.components);for(let w=0;w<this.components;w++)m[w]=this.data[p+w];d[h++]=m}return d}function getIntersection(d){let h=this,p=h.getClosestCommonParent(d),m=h.getRelativePosition(p,{defaultFurther:!0}),w=getRelativePositionForAllPixels(h,m),M=d.getRelativePosition(p,{defaultFurther:!0}),k=getRelativePositionForAllPixels(d,M),x=getCommonSurface(w,k),L={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let B=0;B<x.length;B++){let $=x[B],U=[$[0]-m[0],$[1]-m[1]],q=[$[0]-M[0],$[1]-M[1]],G=h.getBitXY(U[0],U[1]),W=d.getBitXY(q[0],q[1]);G===1&&W===1&&L.commonWhitePixels.push($)}for(let B=0;B<w.length;B++){let $,U;B!==0&&($=Math.floor(B/h.width),U=B%h.width),h.getBitXY($,U)===1&&L.whitePixelsMask1.push(w[B])}for(let B=0;B<k.length;B++){let $=0,U=0;B!==0&&($=Math.floor(B/d.width),U=B%d.width),d.getBitXY($,U)===1&&L.whitePixelsMask2.push(k[B])}return L}function getRelativePositionForAllPixels(d,h){let p=[];for(let m=0;m<d.height;m++)for(let w=0;w<d.width;w++){let M=[m,w];p.push([M[0]+h[0],M[1]+h[1]])}return p}function getCommonSurface(d,h){let p=0,m=0,w=[];for(;p<d.length&&m<h.length;)d[p][0]===h[m][0]&&d[p][1]===h[m][1]?(w.push(d[p]),p++,m++):d[p][0]<h[m][0]||d[p][0]===h[m][0]&&d[p][1]<h[m][1]?p++:m++;return w}function getClosestCommonParent(d){let h=getDepth(this),p=getDepth(d),m;if(h>=p?m=getFurthestParent(this,h):m=getFurthestParent(d,p),h===0||p===0)return m;let w=this,M=d;for(;h!==p;)if(h>p){if(w=w.parent,w===null)return m;h=h-1}else{if(M=M.parent,M===null)return m;p=p-1}for(;w!==M&&w!==null&&M!==null;)if(w=w.parent,M=M.parent,w===null||M===null)return m;return w!==M?m:w}function getDepth(d){let h=0,p=d;for(;p.parent!=null;)p=p.parent,h++;return h}function getFurthestParent(d,h){let p=d;for(;h>0;)p=p.parent,h=h-1;return p}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(d,h){d.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),h=Object.assign({},defaultOptions$1,h);const p=d.width,m=d.height,w=d.maxValue,M={sigma:h.gaussianBlur,radius:3},k=d.gaussianFilter(M),x=k.convolution(Gy,convOptions),L=k.convolution(Gx,convOptions),B=L.hypotenuse(x),$=d.constructor,U=new $(p,m,{kind:"GREY",bitDepth:32}),q=new $(p,m,{kind:"GREY",bitDepth:32}),G=new $(p,m,{kind:"GREY"});for(var W=1;W<p-1;W++)for(var te=1;te<m-1;te++){var oe=(Math.round(Math.atan2(L.getValueXY(W,te,0),x.getValueXY(W,te,0))*(5/Math.PI))+5)%5;oe===0&&(B.getValueXY(W,te,0)<=B.getValueXY(W,te-1,0)||B.getValueXY(W,te,0)<=B.getValueXY(W,te+1,0))||oe===1&&(B.getValueXY(W,te,0)<=B.getValueXY(W-1,te+1,0)||B.getValueXY(W,te,0)<=B.getValueXY(W+1,te-1,0))||oe===2&&(B.getValueXY(W,te,0)<=B.getValueXY(W-1,te,0)||B.getValueXY(W,te,0)<=B.getValueXY(W+1,te,0))||oe===3&&(B.getValueXY(W,te,0)<=B.getValueXY(W-1,te-1,0)||B.getValueXY(W,te,0)<=B.getValueXY(W+1,te+1,0))||U.setValueXY(W,te,0,B.getValueXY(W,te,0))}for(W=0;W<p*m;++W){var ee=U.data[W],_e=0;ee>h.highThreshold&&(_e++,G.data[W]=w),ee>h.lowThreshold&&_e++,q.data[W]=_e}var se=[];for(W=1;W<p-1;++W)for(te=1;te<m-1;++te){if(q.getValueXY(W,te,0)!==1)continue;e:for(var he=W-1;he<W+2;++he)for(var ge=te-1;ge<te+2;++ge)if(q.getValueXY(he,ge,0)===2){se.push([W,te]),G.setValueXY(W,te,0,w);break e}}for(;se.length>0;){var Re=[];for(W=0;W<se.length;++W)for(te=-1;te<2;++te)for(he=-1;he<2;++he)if(!(te===0&&he===0)){var ve=se[W][0]+te,de=se[W][1]+he;q.getValueXY(ve,de,0)===1&&G.getValueXY(ve,de,0)===0&&(Re.push([ve,de]),G.setValueXY(ve,de,0,w))}se=Re}return G}function cannyEdge(d){return cannyEdgeDetector(this,d)}function extract(d,h={}){let{position:p}=h;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!p&&(p=d.getRelativePosition(this),!p))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let m=Image$1.createFrom(this,{width:d.width,height:d.height,alpha:1,position:p,parent:this});for(let w=0;w<d.width;w++)for(let M=0;M<d.height;M++){for(let k=0;k<this.channels;k++){let x=this.getValueXY(w+p[0],M+p[1],k);m.setValueXY(w,M,k,x)}d.getBitXY(w,M)||m.setValueXY(w,M,this.components,0)}return m}else{let m=Image$1.createFrom(this,{width:d.width,height:d.height,position:p,parent:this});for(let w=0;w<d.height;w++)for(let M=0;M<d.width;M++)d.getBitXY(M,w)&&this.getBitXY(M+p[0],w+p[1])&&m.setBitXY(M,w);return m}}var fastList={exports:{}};(function(d,h){(function(){function p(w,M,k){this.next=k,k&&(k.prev=this),this.prev=M,M&&(M.next=this),this.data=w}function m(){if(!(this instanceof m))return new m;this._head=null,this._tail=null,this.length=0}m.prototype={push:function(w){this._tail=new p(w,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var w=this._tail;return this._tail=w.prev,w.prev&&(w.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),w.data}},unshift:function(w){this._head=new p(w,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var w=this._head;return this._head=w.next,w.next&&(w.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),w.data}},item:function(w){w<0&&(w=this.length+w);for(var M=this._head;w-- >0&&M;)M=M.next;return M?M.data:void 0},slice:function(w,M){if(w||(w=0),M||(M=this.length),M<0&&(M=this.length+M),w<0&&(w=this.length+w),M===w)return[];if(M<w)throw new Error("invalid offset: "+w+","+M+" (length="+this.length+")");for(var k=M-w,x=new Array(k),L=0,B=this._head;w-- >0&&B;)B=B.next;for(;L<k&&B;)x[L++]=B.data,B=B.next;return x},drop:function(){m.call(this)},forEach:function(w,M){for(var k=this._head,x=0,L=this.length;x<L&&k;)w.call(M||this,k.data,x,this),k=k.next,x++},map:function(w,M){var k=new m;return this.forEach(function(x,L,B){k.push(w.call(M||B,x,L,B))}),k},filter:function(w,M){var k=new m;return this.forEach(function(x,L,B){w.call(M||B,x,L,B)&&k.push(x)}),k},reduce:function(w,M,k){var x=0,L=this._head,B=this.length;for(M||(x=1,M=L&&L.data,L=L&&L.next);x<B&&L;)M=w.call(k||this,M,L.data,this),x++,L=L.next;return M}},d.exports=m})()})(fastList);var LinkedList=fastList.exports;function floodFill(d={}){const{x:h=0,y:p=0,inPlace:m=!0}=d,w=m?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(h,p))return w;const k=new LinkedList;for(k.push(new Node(h,p));k.length>0;){const x=k.shift();w.setBitXY(x.x,x.y);for(let L=x.x+1;L<this.width&&(!w.getBitXY(L,x.y)&&!this.getBitXY(L,x.y));L++)w.setBitXY(L,x.y),x.y+1<this.height&&!this.getBitXY(L,x.y+1)&&k.push(new Node(L,x.y+1)),x.y-1>=0&&!this.getBitXY(L,x.y-1)&&k.push(new Node(L,x.y-1));for(let L=x.x-1;L>=0&&(!w.getBitXY(L,x.y)&&!this.getBitXY(L,x.y));L++)w.setBitXY(L,x.y),x.y+1<this.height&&!this.getBitXY(L,x.y+1)&&k.push(new Node(L,x.y+1)),x.y-1>=0&&!this.getBitXY(L,x.y-1)&&k.push(new Node(L,x.y-1))}return w}function Node(d,h){this.x=d,this.y=h}function _extends(){return _extends=Object.assign||function(d){for(var h=1;h<arguments.length;h++){var p=arguments[h];for(var m in p)Object.prototype.hasOwnProperty.call(p,m)&&(d[m]=p[m])}return d},_extends.apply(this,arguments)}function hsv2rgb(d,h,p){h=h/100,p=p/100;var m=[],w=p*h,M=d/60,k=w*(1-Math.abs(M%2-1)),x=p-w;return M>=0&&M<1?m=[w,k,0]:M>=1&&M<2?m=[k,w,0]:M>=2&&M<3?m=[0,w,k]:d>=3&&M<4?m=[0,k,w]:d>=4&&M<5?m=[k,0,w]:d>=5&&M<=6?m=[w,0,k]:m=[0,0,0],{r:Math.round(255*(m[0]+x)),g:Math.round(255*(m[1]+x)),b:Math.round(255*(m[2]+x))}}function hsl2hsv(d,h,p){return h*=(p<50?p:100-p)/100,{h:d,s:2*h/(p+h)*100,v:p+h}}function hsl2rgb$1(d,h,p){var m=hsl2hsv(d,h,p);return hsv2rgb(m.h,m.s,m.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(d){return named(d)||hex3(d)||hex6(d)||rgb(d)||rgba$1(d)||hsl(d)||hsla(d)}function named(d){var h=colors[d.toLowerCase()];if(!!h)return{r:h[0],g:h[1],b:h[2],a:100}}function rgb(d){var h=d.match(/rgb\(([^)]+)\)/);if(h){var p=h[1].split(/ *, */).map(Number);return{r:p[0],g:p[1],b:p[2],a:100}}}function rgba$1(d){var h=d.match(/rgba\(([^)]+)\)/);if(h){var p=h[1].split(/ *, */).map(Number);return{r:p[0],g:p[1],b:p[2],a:p[3]*100}}}function hex6(d){if(d[0]==="#"&&d.length===7)return{r:parseInt(d.slice(1,3),16),g:parseInt(d.slice(3,5),16),b:parseInt(d.slice(5,7),16),a:100}}function hex3(d){if(d[0]==="#"&&d.length===4)return{r:parseInt(d[1]+d[1],16),g:parseInt(d[2]+d[2],16),b:parseInt(d[3]+d[3],16),a:100}}function hsl(d){var h=d.match(/hsl\(([^)]+)\)/);if(h){var p=h[1].split(/ *, */),m=parseInt(p[0],10),w=parseInt(p[1],10),M=parseInt(p[2],10),k=hsl2rgb$1(m,w,M);return _extends({},k,{a:100})}}function hsla(d){var h=d.match(/hsla\(([^)]+)\)/);if(h){var p=h[1].split(/ *, */),m=parseInt(p[0],10),w=parseInt(p[1],10),M=parseInt(p[2],10),k=parseInt(parseFloat(p[3])*100,10),x=hsl2rgb$1(m,w,M);return _extends({},x,{a:k})}}function css2array(d){let h=parse(d);return[h.r,h.g,h.b,Math.round(h.a*255/100)]}function hue2rgb(d,h,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(h-d)*6*p:p<1/2?h:p<2/3?d+(h-d)*(2/3-p)*6:d}function hsl2rgb(d,h,p){let m,w,M,k,x,L;return h/=100,p/=100,h===0?k=x=L=p*255:(p<=.5?w=p*(h+1):w=p+h-p*h,m=p*2-w,M=d/360,k=hue2rgb(m,w,M+1/3),x=hue2rgb(m,w,M),L=hue2rgb(m,w,M-1/3)),{r:k,g:x,b:L}}function getDistinctColors(d){let h=new Array(d),p=0;for(let m=0;m<360;m+=360/d){p++;let w=hsl2rgb(m,100,30+p%4*15);h[p-1]=[Math.round(w.r*255),Math.round(w.g*255),Math.round(w.b*255)]}return h}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(d){let{color:h,colors:p,randomColors:m,numberColors:w=50}=d;if(h&&!Array.isArray(h)&&(h=css2array(h)),h)return[h];if(p)return p=p.map(function(M){return Array.isArray(M)?M:css2array(M)}),p;if(m){p=new Array(w);for(let M=0;M<w;M++)p[M]=getRandomColor()}return getDistinctColors(w)}function paintLabels(d,h,p={}){let{color:m="blue",colors:w,font:M="12px Helvetica",rotate:k=0}=p;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(d))throw Error("paintLabels: labels must be an array");if(!Array.isArray(h))throw Error("paintLabels: positions must be an array");if(m&&!Array.isArray(m)&&(m=css2array(m)),w?w=w.map(function(B){return Array.isArray(B)?B:css2array(B)}):w=[m],d.length!==h.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(M)||(M=[M]),Array.isArray(k)||(k=[k]);let L=this.getCanvas().getContext("2d");for(let B=0;B<d.length;B++){L.save();let $=w[B%w.length];L.fillStyle=`rgba(${$[0]},${$[1]},${$[2]},${$[3]/this.maxValue})`,L.font=M[B%M.length];let U=h[B];L.translate(U[0],U[1]),L.rotate(k[B%k.length]/180*Math.PI),L.fillText(d[B],0,0),L.restore()}return this.data=Uint8Array.from(L.getImageData(0,0,this.width,this.height).data),this}function paintMasks(d,h={}){let{alpha:p=255,labels:m=[],labelsPosition:w=[],labelColor:M="blue",labelFont:k="12px Helvetica"}=h;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let x=getColors(Object.assign({},h,{numberColors:d.length}));Array.isArray(d)||(d=[d]);for(let L=0;L<d.length;L++){let B=d[L],$=x[L%x.length];for(let U=0;U<B.width;U++)for(let q=0;q<B.height;q++)if(B.getBitXY(U,q))for(let G=0;G<Math.min(this.components,$.length);G++)if(p===255)this.setValueXY(U+B.position[0],q+B.position[1],G,$[G]);else{let W=this.getValueXY(U+B.position[0],q+B.position[1],G);W=Math.round((W*(255-p)+$[G]*p)/255),this.setValueXY(U+B.position[0],q+B.position[1],G,W)}}if(Array.isArray(m)&&m.length>0){let B=this.getCanvas().getContext("2d");B.fillStyle=M,B.font=k;for(let $=0;$<Math.min(d.length,m.length);$++){let U=w[$]?w[$]:d[$].position;B.fillText(m[$],U[0],U[1])}this.data=Uint8Array.from(B.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(d,h){let p=new Array(d);for(let m=0;m<d;m++)p[m]=new Array(h).fill(0);return p}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(h={}){let{kind:p="cross",shape:m,size:w,width:M,height:k,filled:x=!0}=h;if(w&&(M=w,k=w),m)switch(m.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(M,k,{filled:x});break;case"circle":case"ellipse":this.matrix=ellipse(M,k,{filled:x});break;case"triangle":this.matrix=triangle(M,k,{filled:x});break;default:throw new Error(`Shape: unexpected shape: ${m}`)}else if(p)switch(p.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${p}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let h=this.matrix,p=[];for(let m=0;m<h.length;m++)for(let w=0;w<h[0].length;w++)h[m][w]&&p.push([w-this.halfWidth,m-this.halfHeight]);return p}getMask(){let h=new Image$1(this.width,this.height,{kind:BINARY});for(let p=0;p<this.matrix.length;p++)for(let m=0;m<this.matrix[0].length;m++)this.matrix[p][m]&&h.setBitXY(m,p);return h}}function rectangle(d,h,p){const m=zerosMatrix(h,d);if(p.filled)for(let w=0;w<h;w++)for(let M=0;M<d;M++)m[w][M]=1;else{for(let w of[0,h-1])for(let M=0;M<d;M++)m[w][M]=1;for(let w=0;w<h;w++)for(let M of[0,d-1])m[w][M]=1}return m}function ellipse(d,h,p){const m=zerosMatrix(h,d);let w=1-h%2,M=1-d%2,k=Math.floor((d-1)/2),x=Math.floor((h-1)/2),L=k*k,B=x*x;if(p.filled)for(let $=0;$<=x;$++){let U=Math.floor(Math.sqrt(L-L*$*$/B));for(let q=k-U;q<=k;q++)m[x-$][q]=1,m[x+$+w][q]=1,m[x-$][d-q-1]=1,m[x+$+w][d-q-1]=1}else{for(let $=0;$<=x;$++){let U=Math.floor(Math.sqrt(L-L*$*$/B)),q=k-U;m[x-$][q]=1,m[x+$+w][q]=1,m[x-$][d-q-1]=1,m[x+$+w][d-q-1]=1}for(let $=0;$<=k;$++){let U=Math.floor(Math.sqrt(B-B*$*$/L)),q=x-U;m[q][k-$]=1,m[q][k+$+M]=1,m[h-q-1][k-$]=1,m[h-q-1][k+$+M]=1}}return m}function triangle(d,h,p){if(!p.filled)throw new Error("Non filled triangle is not implemented");const m=zerosMatrix(h,d);for(let w=0;w<h;w++){let M=Math.floor((1-w/h)*d/2);for(let k=M;k<d-M;k++)m[w][k]=1}return m}function paintPoints(d,h={}){let{shape:p}=h;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let m=getColors(Object.assign({},h,{numberColors:d.length})),w=new Shape(p).getPoints(),M=Math.min(this.channels,m[0].length);for(let k=0;k<d.length;k++){let x=m[k%m.length],L=d[k][0],B=d[k][1];for(let $=0;$<w.length;$++){let U=w[$][0],q=w[$][1];if(L+U>=0&&B+q>=0&&L+U<this.width&&B+q<this.height){let G=(L+U+(B+q)*this.width)*this.channels;for(let W=0;W<M;W++)this.data[G+W]=x[W]}}}return this}function paintPolyline(d,h={}){let{color:p=[this.maxValue,0,0],closed:m=!1}=h;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let w=Math.min(this.channels,p.length);for(let M=0;M<d.length-1+m;M++){let k=d[M],x=d[(M+1)%d.length],L=x[0]-k[0],B=x[1]-k[1],$=Math.max(Math.abs(L),Math.abs(B)),U=L/$,q=B/$,G=k[0],W=k[1];for(let te=0;te<=$;te++){let oe=Math.round(G),ee=Math.round(W);if(oe>=0&&ee>=0&&oe<this.width&&ee<this.height)if(this.bitDepth===1)this.setBitXY(oe,ee);else{let _e=(oe+ee*this.width)*this.channels;for(let se=0;se<w;se++)this.data[_e+se]=p[se]}G=G+U,W=W+q}}return this}function paintPolylines(d,h={}){let p=Object.assign({},h);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let m=getColors(Object.assign({},h,{numberColors:d.length}));for(let w=0;w<d.length;w++)p.color=m[w%m.length],this.paintPolyline(d[w],p);return this}function paintPolygon(d,h={}){let{color:p=[this.maxValue,0,0],filled:m=!1}=h;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),h.closed=!0;let w=deleteDouble(d);if(m===!1)return this.paintPolyline(d,h);{let M=Array(this.height);for(let k=0;k<this.height;k++){M[k]=[];for(let x=0;x<this.width;x++)M[k].push(0)}for(let k=0;k<w.length;k++){const x=lineBetweenTwoPoints(w[k],w[(k+1)%w.length]);for(let L=0;L<this.height;L++)for(let B=0;B<this.width;B++)isAtTheRightOfTheLine(B,L,x,this.height)&&(M[L][B]=M[L][B]===0?1:0)}for(let k=0;k<this.height;k++)for(let x=0;x<this.width;x++)if(M[k][x]===1)if(this.bitDepth===1)this.setBitXY(x,k);else{let L=Math.min(this.channels,p.length),B=(x+k*this.width)*this.channels;for(let $=0;$<L;$++)this.data[B+$]=p[$]}return this.paintPolyline(d,h)}}function deleteDouble(d){let h=[];for(let p=0;p<d.length;p++)if(!(d[p][0]===d[(p+1)%d.length][0]&&d[p][1]===d[(p+1)%d.length][1])){if(d[p][0]===d[(p-1+d.length)%d.length][0]&&d[p][1]===d[(p-1+d.length)%d.length][1])continue;if(d[(p+1)%d.length][0]===d[(p-1+d.length)%d.length][0]&&d[(p-1+d.length)%d.length][1]===d[(p+1)%d.length][1])continue;h.push(d[p])}return h}function lineBetweenTwoPoints(d,h){if(d[0]===h[0])return{a:0,b:d[0],vertical:!0};{const p=(h[1]-d[1])/(h[0]-d[0]),m=d[1]-p*d[0];return{a:p,b:m,vertical:!1}}}function isAtTheRightOfTheLine(d,h,p,m){if(p.vertical===!0)return p.b<=d;if(p.a===0)return!1;{const w=(h-p.b)/p.a;return w<d&&w>=0&&w<=m}}function paintPolygons(d,h={}){let p=Object.assign({},h);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let m=getColors(Object.assign({},h,{numberColors:d.length}));for(let w=0;w<d.length;w++)p.color=m[w%m.length],this.paintPolygon(d[w],p);return this}function getHistogram(d={}){let{maxSlots:h=256,channel:p,useAlpha:m=!0}=d;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),p===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");p=0}return getChannelHistogram.call(this,p,{useAlpha:m,maxSlots:h})}function getHistograms(d={}){const{maxSlots:h=256,useAlpha:p=!0}=d;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let m=new Array(p?this.components:this.channels);for(let w=0;w<m.length;w++)m[w]=getChannelHistogram.call(this,w,{useAlpha:p,maxSlots:h});return m}function getChannelHistogram(d,h){let{useAlpha:p,maxSlots:m}=h;if(this.bitDepth===1){let L=[0,0];for(let B=0;B<this.height;B++)for(let $=0;$<this.width;$++){let U=this.getBitXY(B,$);U===0?L[0]+=1:U===1&&(L[1]+=1)}return L}let w=Math.log2(m);if(!isInteger(w))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let M=0;this.bitDepth>w&&(M=this.bitDepth-w);let k=this.data,x=newArray_1(Math.pow(2,Math.min(this.bitDepth,w)),0);if(p&&this.alpha){let L=this.channels-d-1;for(let B=d;B<k.length;B+=this.channels)x[k[B]>>M]+=k[B+L]/this.maxValue}else for(let L=d;L<k.length;L+=this.channels)x[k[L]>>M]++;return x}function getColorHistogram(d={}){let{useAlpha:h=!0,nbSlots:p=512}=d;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let m=Math.log(p)/Math.log(8);if(m!==Math.floor(m))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let w=this.bitDepth-m,M=this.data,k=newArray_1(Math.pow(8,m),0),x=Math.pow(2,m*2),L=Math.pow(2,m);for(let B=0;B<M.length;B+=this.channels){let $=(M[B]>>w)*x+(M[B+1]>>w)*L+(M[B+2]>>w);h&&this.alpha?k[$]+=M[B+this.channels-1]/this.maxValue:k[$]++}return k}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let d=newArray_1(this.channels,1/0);for(let h=0;h<this.data.length;h+=this.channels)for(let p=0;p<this.channels;p++)this.data[h+p]<d[p]&&(d[p]=this.data[h+p]);return d}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let d=newArray_1(this.channels,-1/0);for(let h=0;h<this.data.length;h+=this.channels)for(let p=0;p<this.channels;p++)this.data[h+p]>d[p]&&(d[p]=this.data[h+p]);return d}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let d=newArray_1(this.channels,0);for(let h=0;h<this.data.length;h+=this.channels)for(let p=0;p<this.channels;p++)d[p]+=this.data[h+p];return d}function getMoment(d=0,h=0){this.checkProcessable("getMoment",{bitDepth:[1]});let p=0;for(let m=0;m<this.width;m++)for(let w=0;w<this.height;w++)this.getBitXY(m,w)===1&&(p+=m**d*w**h);return p}function localMaxima(d={}){let{mask:h,region:p=3,removeClosePoints:m=0,invert:w=!1,maxEquals:M=2}=d,k=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),p*=4;let x=w?0:1,L=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],B=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],$=p<=8?1:2,U=[];for(let q=$;q<k.height-$;q++)for(let G=$;G<k.width-$;G++){if(h&&h.getBitXY(G,q)!==x)continue;let W=0,te=0,oe=k.data[G+q*k.width];for(let ee=0;ee<p;ee++)w?k.data[G+L[ee]+(q+B[ee])*k.width]>oe&&W++:k.data[G+L[ee]+(q+B[ee])*k.width]<oe&&W++,k.data[G+L[ee]+(q+B[ee])*k.width]===oe&&te++;W+te===p&&te<=M&&U.push([G,q])}if(m>0)for(let q=0;q<U.length;q++)for(let G=q+1;G<U.length;G++)Math.sqrt(Math.pow(U[q][0]-U[G][0],2)+Math.pow(U[q][1]-U[G][1],2))<m&&(U[q][0]=U[q][0]+U[G][0]>>1,U[q][1]=U[q][1]+U[G][1]>>1,U.splice(G,1),G--);return U}function mean(){let d=this.getHistograms({maxSlots:this.maxValue+1}),h=new Array(d.length);for(let p=0;p<d.length;p++){let m=d[p];h[p]=mean$2(m)}return h}function median(){let d=this.getHistograms({maxSlots:this.maxValue+1}),h=new Array(d.length);for(let p=0;p<d.length;p++){let m=d[p];h[p]=median$2(m)}return h}function points(){this.checkProcessable("points",{bitDepth:[1]});const d=[];for(let h=0;h<this.width;h++)for(let p=0;p<this.height;p++)this.getBitXY(h,p)===1&&d.push([h,p]);return d}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const d=[];for(let h=0;h<this.height;h++)for(let p=0;p<this.width;p++)if(this.getBitXY(p,h)===1)for(d.push([p,h]),this.getBitXY(p+1,h)!==1?(d.push([p+1,h]),d.push([p+1,h+1]),this.getBitXY(p,h+1)!==1&&d.push([p,h+1])):this.getBitXY(p,h+1)!==1&&(d.push([p,h+1]),d.push([p+1,h+1]));p<this.width-2&&this.getBitXY(p+1,h)===1&&this.getBitXY(p+2,h)===1;)p++;return d}function getRelativePosition(d,h={}){if(this===d)return[0,0];let p=[0,0],m=this;for(;m;){if(m===d)return p;m.position&&(p[0]+=m.position[0],p[1]+=m.position[1]),m=m.parent}return h.defaultFurther?p:!1}function countAlphaPixels(d={}){let{alpha:h=1}=d;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let p=0;if(h!==void 0){for(let m=this.components;m<this.data.length;m+=this.channels)this.data[m]===h&&p++;return p}else return this.size}function monotoneChainConvexHull$1(d,h={}){h.sorted||d.sort(byXThenY);const p=d.length,m=new Array(p*2);for(var w=0,M=0;M<p;M++){const x=d[M];for(;w>=2&&cw(m[w-2],m[w-1],x)<=0;)w--;m[w++]=x}const k=w+1;for(M=p-2;M>=0;M--){const x=d[M];for(;w>=k&&cw(m[w-2],m[w-1],x)<=0;)w--;m[w++]=x}return m.slice(0,w-1)}function cw(d,h,p){return(h[1]-d[1])*(p[0]-d[0])-(h[0]-d[0])*(p[1]-d[1])}function byXThenY(d,h){return d[0]===h[0]?d[1]-h[1]:d[0]-h[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(d){for(let h=0;h<d.length;h++)d[h][0]=Math.round(d[h][0]),d[h][1]=Math.round(d[h][1]);return d}function difference(d,h){return[d[0]-h[0],d[1]-h[1]]}function normalize(d){let h=Math.sqrt(d[0]**2+d[1]**2);return[d[0]/h,d[1]/h]}function rotate(d,h,p){p===void 0&&(p=new Array(h.length));let m=Math.cos(d),w=Math.sin(d);for(let M=0;M<p.length;++M)p[M]=[m*h[M][0]-w*h[M][1],w*h[M][0]+m*h[M][1]];return p}function perimeter(d){let h=0;for(let p=0;p<d.length;p++){let m=d[p][0],w=d[p][1],M=d[p===d.length-1?0:p+1][0],k=d[p===d.length-1?0:p+1][1];h+=Math.sqrt((M-m)**2+(k-w)**2)}return h}function surface(d){let h=0;for(let p=0;p<d.length;p++){let m=d[p][0],w=d[p===d.length-1?0:p+1][1],M=d[p===d.length-1?0:p+1][0],k=d[p][1];h+=m*w*.5,h-=M*k*.5}return Math.abs(h)}function minMax(d){let h=1/0,p=1/0,m=-1/0,w=-1/0;for(let M=0;M<d.length;M++)d[M][0]<h&&(h=d[M][0]),d[M][0]>m&&(m=d[M][0]),d[M][1]<p&&(p=d[M][1]),d[M][1]>w&&(w=d[M][1]);return[[h,p],[m,w]]}function moveToZeroZero(d,h){h===void 0&&(h=new Array(d.length).fill(0).map(()=>[]));let p=minMax(d),m=p[0][0],w=p[0][1];for(let M=0;M<d.length;M++)h[M][0]=d[M][0]-m,h[M][1]=d[M][1]-w;return h}function minimalBoundingRectangle(d={}){const{originalPoints:h=monotoneChainConvexHull.call(this)}=d;if(h.length===0)return[];if(h.length===1)return[h[0],h[0],h[0],h[0]];const p=new Array(h.length);let m=1/0,w=0,M;for(let k=0;k<p.length;k++){let x=getAngle$1(h[k],h[(k+1)%p.length]);rotate(-x,h,p);let L=p[k][0],B=p[k][1],$=p[(k+1)%p.length][0],U=p[(k+1)%p.length][1],q=!0,G=0,W=0,te=0;for(let se=0;se<p.length;se++){let he=p[se][0],ge=p[se][1],Re=(he-L)/($-L);q===!0?(q=!1,G=Re,W=Re):(Re<G&&(G=Re),Re>W&&(W=Re));let ve=(-($-L)*ge+$*B-U*L)/($-L);Math.abs(ve)>Math.abs(te)&&(te=ve)}let oe=[L+G*($-L),B],ee=[L+W*($-L),B],_e=Math.abs(te*(G-W)*($-L));_e<m&&(w=x,m=_e,M=[oe,ee,[ee[0],ee[1]-te],[oe[0],oe[1]-te]])}return rotate(w,M,M),M}function getAngle$1(d,h){let p=difference(h,d),m=normalize(p),w=Math.acos(m[0]);return m[1]<0?-w:w}function extend$4(d){let h={inPlace:!0};d.extendMethod("invert",invert),d.extendMethod("abs",abs),d.extendMethod("level",level,h),d.extendMethod("add",add,h),d.extendMethod("subtract",subtract,h),d.extendMethod("subtractImage",subtractImage),d.extendMethod("multiply",multiply,h),d.extendMethod("divide",divide,h),d.extendMethod("hypotenuse",hypotenuse),d.extendMethod("background",background$1),d.extendMethod("flipX",flipX),d.extendMethod("flipY",flipY),d.extendMethod("blurFilter",blurFilter),d.extendMethod("medianFilter",medianFilter),d.extendMethod("gaussianFilter",gaussianFilter),d.extendMethod("sobelFilter",sobelFilter),d.extendMethod("gradientFilter",gradientFilter),d.extendMethod("scharrFilter",scharrFilter),d.extendMethod("dilate",dilate),d.extendMethod("erode",erode),d.extendMethod("open",open),d.extendMethod("close",close),d.extendMethod("topHat",topHat),d.extendMethod("blackHat",blackHat),d.extendMethod("morphologicalGradient",morphologicalGradient),d.extendMethod("warpingFourPoints",warpingFourPoints),d.extendMethod("crop",crop),d.extendMethod("cropAlpha",cropAlpha),d.extendMethod("resize",resize).extendMethod("scale",resize),d.extendMethod("hsv",hsv),d.extendMethod("hsl",hsl$1),d.extendMethod("cmyk",cmyk),d.extendMethod("rgba8",rgba8),d.extendMethod("grey",grey).extendMethod("gray",grey),d.extendMethod("mask",mask),d.extendMethod("pad",pad),d.extendMethod("colorDepth",colorDepth),d.extendMethod("setBorder",setBorder,h),d.extendMethod("rotate",rotate$1),d.extendMethod("rotateLeft",rotateLeft),d.extendMethod("rotateRight",rotateRight),d.extendMethod("insert",insert),d.extendMethod("getRow",getRow),d.extendMethod("getColumn",getColumn),d.extendMethod("getMatrix",getMatrix),d.extendMethod("setMatrix",setMatrix),d.extendMethod("getPixelsArray",getPixelsArray),d.extendMethod("getIntersection",getIntersection),d.extendMethod("getClosestCommonParent",getClosestCommonParent),d.extendMethod("getThreshold",getThreshold),d.extendMethod("split",split),d.extendMethod("getChannel",getChannel),d.extendMethod("combineChannels",combineChannels),d.extendMethod("setChannel",setChannel),d.extendMethod("getSimilarity",getSimilarity),d.extendMethod("getPixelsGrid",getPixelsGrid),d.extendMethod("getBestMatch",getBestMatch),d.extendMethod("cannyEdge",cannyEdge),d.extendMethod("convolution",convolution),d.extendMethod("extract",extract),d.extendMethod("floodFill",floodFill),d.extendMethod("paintLabels",paintLabels,h),d.extendMethod("paintMasks",paintMasks,h),d.extendMethod("paintPoints",paintPoints,h),d.extendMethod("paintPolyline",paintPolyline,h),d.extendMethod("paintPolylines",paintPolylines,h),d.extendMethod("paintPolygon",paintPolygon,h),d.extendMethod("paintPolygons",paintPolygons,h),d.extendMethod("countAlphaPixels",countAlphaPixels),d.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),d.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),d.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),d.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),d.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),d.extendMethod("getMin",min).extendProperty("min",min),d.extendMethod("getMax",max).extendProperty("max",max),d.extendMethod("getSum",sum).extendProperty("sum",sum),d.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),d.extendMethod("getLocalMaxima",localMaxima),d.extendMethod("getMedian",median).extendProperty("median",median),d.extendMethod("getMean",mean).extendProperty("mean",mean),d.extendMethod("getPoints",points).extendProperty("points",points),d.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),d.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(d,h){(function(p,m){d.exports=m()})(commonjsGlobal,function(){function p(Me){return typeof Me=="string"||Me instanceof String}var m=Number.isFinite||window.isFinite;function w(Me){return m(Me)}function M(Me){return Me}function k(Me){var Ge={};return Me.filter(function(le){return Ge.hasOwnProperty(le)?!1:Ge[le]=!0})}function x(Me,Ge){if(Ge.length!==Me.length)return!1;for(var le=0;le<Me.length;le++)if(Ge[le].compareArray&&!Ge[le].compareArray(Me[le])||Ge[le]!==Me[le])return!1;return!0}function L(Me,Ge){Object.keys(Ge).forEach(function(le){Me[le]=Ge[le]})}function B(){for(var Me=1,Ge=0,le=0;le<arguments.length;le++){var J=arguments[le];Ge=Ge+q(J),Me*=J}return Ge!==0?U(Me,Ge):Me}function $(Me,Ge){if(Ge===0)throw new Error("Divide by zero");var le=Math.pow(10,q(Ge)),J=le/(le*Ge);return B(Me,J)}function U(Me,Ge){return Math.round(Me*Math.pow(10,Ge))/Math.pow(10,Ge)}function q(Me){if(!isFinite(Me))return 0;for(var Ge=0;Me%1!==0;)Me*=10,Ge++;return Ge}function G(){var Me;if(!this)return Me=Object.create(G.prototype),G.apply(Me,arguments),Me;Me=Error.apply(this,arguments),this.name="QtyError",this.message=Me.message,this.stack=Me.stack}G.prototype=Object.create(Error.prototype,{constructor:{value:G}});function W(Me,Ge){throw new G("Incompatible units: "+Me+" and "+Ge)}var te={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},oe=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],ee="<1>",_e=[ee];function se(Me,Ge){var le=Ge[1],J=Ge[3]||[],ne=Ge[4]||[];if(!w(le))throw new G(Me+": Invalid unit definition. 'scalar' must be a number");J.forEach(function(fe){if(te[fe]===void 0)throw new G(Me+": Invalid unit definition. Unit "+fe+" in 'numerator' is not recognized")}),ne.forEach(function(fe){if(te[fe]===void 0)throw new G(Me+": Invalid unit definition. Unit "+fe+" in 'denominator' is not recognized")})}var he={},ge={},Re={},ve={},de={};for(var Se in te)if(te.hasOwnProperty(Se)){var ce=te[Se];if(ce[2]==="prefix"){he[Se]=ce[1];for(var ye=0;ye<ce[0].length;ye++)ge[ce[0][ye]]=Se}else{se(Se,ce),Re[Se]={scalar:ce[1],numerator:ce[3],denominator:ce[4]};for(var ze=0;ze<ce[0].length;ze++)ve[ce[0][ze]]=Se}de[Se]=ce[0][0]}function Xe(Me){var Ge,le=[],J=Object.keys(te);if(typeof Me=="undefined")for(Ge=0;Ge<J.length;Ge++)["","prefix"].indexOf(te[J[Ge]][2])===-1&&le.push(J[Ge].substr(1,J[Ge].length-2));else{if(this.getKinds().indexOf(Me)===-1)throw new G("Kind not recognized");for(Ge=0;Ge<J.length;Ge++)te[J[Ge]][2]===Me&&le.push(J[Ge].substr(1,J[Ge].length-2))}return le.sort(function(ne,fe){return ne.toLowerCase()<fe.toLowerCase()?-1:ne.toLowerCase()>fe.toLowerCase()?1:0})}function at(Me){if(!ve[Me])throw new G("Unit not recognized");return te[ve[Me]][0]}var ct=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Bt(){if(this.signature)return this.signature;for(var Me=Lt.call(this),Ge=0;Ge<Me.length;Ge++)Me[Ge]*=Math.pow(20,Ge);return Me.reduce(function(le,J){return le+J},0)}function Lt(){if(!this.isBase())return Lt.call(this.toBase());for(var Me=new Array(ct.length),Ge=0;Ge<Me.length;Ge++)Me[Ge]=0;for(var le,J,ne=0;ne<this.numerator.length;ne++)(le=te[this.numerator[ne]])&&(J=ct.indexOf(le[2]),J>=0&&(Me[J]=Me[J]+1));for(var fe=0;fe<this.denominator.length;fe++)(le=te[this.denominator[fe]])&&(J=ct.indexOf(le[2]),J>=0&&(Me[J]=Me[J]-1));return Me}var It="[+-]",Vt="\\d+",Ft=It+"?"+Vt,Mt="\\."+Vt,ri="(?:"+Vt+"(?:"+Mt+")?)|(?:"+Mt+")",St="[Ee]"+Ft,At="(?:"+ri+")(?:"+St+")?",Et=It+"?\\s*"+At,Ut="("+Et+")?\\s*([^/]*)(?:/(.+))?",jt=new RegExp("^"+Ut+"$"),mi="\\^|\\*{2}",oi="[01234]",yi=new RegExp("([^ \\*\\d]+?)(?:"+mi+")?(-?"+oi+"(?![a-zA-Z]))"),xi=new RegExp("([^ \\*\\d]+?)(?:"+mi+")?("+oi+"(?![a-zA-Z]))");function Bi(Me){p(Me)||(Me=Me.toString()),Me=Me.trim();var Ge=jt.exec(Me);if(!Ge)throw new G(Me+": Quantity not recognized");var le=Ge[1];le?(le=le.replace(/\s/g,""),this.scalar=parseFloat(le)):this.scalar=1;for(var J=Ge[2],ne=Ge[3],fe,Ae,Pe;Ge=yi.exec(J);){if(fe=parseFloat(Ge[2]),isNaN(fe))throw new G("Unit exponent is not a number");if(fe===0&&!si.test(Ge[1]))throw new G("Unit not recognized");Ae=Ge[1]+" ",Pe="";for(var Ue=0;Ue<Math.abs(fe);Ue++)Pe+=Ae;fe>=0?J=J.replace(Ge[0],Pe):(ne=ne?ne+Pe:Pe,J=J.replace(Ge[0],""))}for(;Ge=xi.exec(ne);){if(fe=parseFloat(Ge[2]),isNaN(fe))throw new G("Unit exponent is not a number");if(fe===0&&!si.test(Ge[1]))throw new G("Unit not recognized");Ae=Ge[1]+" ",Pe="";for(var Ve=0;Ve<fe;Ve++)Pe+=Ae;ne=ne.replace(Ge[0],Pe)}J&&(this.numerator=Rt(J.trim())),ne&&(this.denominator=Rt(ne.trim()))}var fi=Object.keys(ge).sort(function(Me,Ge){return Ge.length-Me.length}).join("|"),mt=Object.keys(ve).sort(function(Me,Ge){return Ge.length-Me.length}).join("|"),vt="\\b|$",pi="("+fi+")??("+mt+")(?:"+vt+")",si=new RegExp("^\\s*("+pi+"[\\s\\*]*)+$"),We=new RegExp(pi,"g"),Wt={};function Rt(Me){var Ge=Wt[Me];if(Ge)return Ge;var le,J=[];if(!si.test(Me))throw new G("Unit not recognized");for(;le=We.exec(Me);)J.push(le.slice(1));return J=J.map(function(ne){return ge[ne[0]]?[ge[ne[0]],ve[ne[1]]]:[ve[ne[1]]]}),J=J.reduce(function(ne,fe){return ne.concat(fe)},[]),J=J.filter(function(ne){return ne}),Wt[Me]=J,J}function ti(Me){if(!p(Me))throw new G("Argument should be a string");try{return this(Me)}catch{return null}}function ni(Me){return Me instanceof bt}function bt(Me,Ge){if(Pi.apply(null,arguments),!ni(this))return new bt(Me,Ge);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=_e,this.denominator=_e,Kt(Me)?(this.scalar=Me.scalar,this.numerator=Me.numerator&&Me.numerator.length!==0?Me.numerator:_e,this.denominator=Me.denominator&&Me.denominator.length!==0?Me.denominator:_e):Ge?(Bi.call(this,Ge),this.scalar=Me):Bi.call(this,Me),this.denominator.join("*").indexOf("temp")>=0)throw new G("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new G("Cannot multiply by temperatures");if(!x(this.denominator,_e))throw new G("Cannot divide with temperatures")}if(this.initValue=Me,qt.call(this),this.isTemperature()&&this.baseScalar<0)throw new G("Temperatures must not be less than absolute zero")}bt.prototype={constructor:bt};function Pi(Me,Ge){if(Ge){if(!(w(Me)&&p(Ge)))throw new G("Only number accepted as initialization value when units are explicitly provided")}else if(!(p(Me)||w(Me)||ni(Me)||Kt(Me)))throw new G("Only string, number or quantity accepted as single initialization value")}function Kt(Me){return Me&&typeof Me=="object"&&Me.hasOwnProperty("scalar")}function qt(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Bt.call(this);else{var Me=this.toBase();this.baseScalar=Me.scalar,this.signature=Me.signature}}var Zt={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber","0":"unitless","1":"length","2":"area","3":"volume","20":"time","400":"temperature","7941":"yank","7942":"power","7959":"pressure","7961":"force","7962":"energy","7979":"viscosity","7981":"momentum","7982":"angular_momentum","7997":"density","7998":"area_density","8000":"mass","152020":"radiation_exposure","159999":"magnetism","160000":"current","160020":"charge","312058":"conductance","312078":"capacitance","3199980":"activity","3199997":"molar_concentration","3200000":"substance","63999998":"illuminance","64000000":"luminous_power","1280000000":"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function kt(){return k(Object.keys(Zt).map(function(Me){return Zt[Me]}))}bt.prototype.kind=function(){return Zt[this.signature.toString()]},L(bt.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&x(this.denominator,_e)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function ci(Me,Ge){var le=Me.units(),J=Ge.to(le),ne=bt(ei(le));return bt({scalar:Me.scalar-J.scalar,numerator:ne.numerator,denominator:ne.denominator})}function vi(Me,Ge){var le=Ge.to(ei(Me.units()));return bt({scalar:Me.scalar-le.scalar,numerator:Me.numerator,denominator:Me.denominator})}function Ti(Me,Ge){var le=Ge.to(ei(Me.units()));return bt({scalar:Me.scalar+le.scalar,numerator:Me.numerator,denominator:Me.denominator})}function ei(Me){if(Me==="tempK")return"degK";if(Me==="tempC")return"degC";if(Me==="tempF")return"degF";if(Me==="tempR")return"degR";throw new G("Unknown type for temp conversion from: "+Me)}function hi(Me,Ge){var le=Ni(Me),J=Ge.units(),ne;if(J==="degK")ne=le.scalar;else if(J==="degC")ne=le.scalar;else if(J==="degF")ne=le.scalar*9/5;else if(J==="degR")ne=le.scalar*9/5;else throw new G("Unknown type for degree conversion to: "+J);return bt({scalar:ne,numerator:Ge.numerator,denominator:Ge.denominator})}function Ni(Me){var Ge=Me.units(),le;if(Ge.match(/(deg)[CFRK]/))le=Me.baseScalar;else if(Ge==="tempK")le=Me.scalar;else if(Ge==="tempC")le=Me.scalar;else if(Ge==="tempF")le=Me.scalar*5/9;else if(Ge==="tempR")le=Me.scalar*5/9;else throw new G("Unknown type for temp conversion from: "+Ge);return bt({scalar:le,numerator:["<kelvin>"],denominator:_e})}function Ai(Me,Ge){var le=Ge.units(),J;if(le==="tempK")J=Me.baseScalar;else if(le==="tempC")J=Me.baseScalar-273.15;else if(le==="tempF")J=Me.baseScalar*9/5-459.67;else if(le==="tempR")J=Me.baseScalar*9/5;else throw new G("Unknown type for temp conversion to: "+le);return bt({scalar:J,numerator:Ge.numerator,denominator:Ge.denominator})}function Xi(Me){var Ge=Me.units(),le;if(Ge.match(/(deg)[CFRK]/))le=Me.baseScalar;else if(Ge==="tempK")le=Me.scalar;else if(Ge==="tempC")le=Me.scalar+273.15;else if(Ge==="tempF")le=(Me.scalar+459.67)*5/9;else if(Ge==="tempR")le=Me.scalar*5/9;else throw new G("Unknown type for temp conversion from: "+Ge);return bt({scalar:le,numerator:["<temp-K>"],denominator:_e})}L(bt.prototype,{to:function(Me){var Ge,le;if(Me==null)return this;if(!p(Me))return this.to(Me.units());if(Ge=this._conversionCache[Me],Ge)return Ge;if(le=bt(Me),le.units()===this.units())return this;if(!this.isCompatible(le))this.isInverse(le)?le=this.inverse().to(Me):W(this.units(),le.units());else if(le.isTemperature())le=Ai(this,le);else if(le.isDegrees())le=hi(this,le);else{var J=$(this.baseScalar,le.baseScalar);le=bt({scalar:J,numerator:le.numerator,denominator:le.denominator})}return this._conversionCache[Me]=le,le},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Xi(this);var Me=fr[this.units()];return Me||(Me=sn(this.numerator,this.denominator),fr[this.units()]=Me),Me.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new G("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(Me){if(p(Me)&&(Me=bt(Me)),w(Me)&&(Me=bt(Me+" "+this.units())),this.isUnitless()?Me.isUnitless()||W(this.units(),Me.units()):Me=Me.to(this.units()),Me.scalar===0)throw new G("Divide by zero");var Ge=B(Math.round(this.scalar/Me.scalar),Me.scalar);return bt(Ge+this.units())}});function Ii(Me,Ge){var le=bt(Me),J=bt(Ge);if(le.eq(J))return M;var ne;return le.isTemperature()?ne=function(fe){return le.mul(fe).to(J).scalar}:ne=function(fe){return fe*le.baseScalar/J.baseScalar},function(Ae){var Pe,Ue,Ve;if(Array.isArray(Ae)){for(Ue=Ae.length,Ve=[],Pe=0;Pe<Ue;Pe++)Ve.push(ne(Ae[Pe]));return Ve}else return ne(Ae)}}var fr={};function sn(Me,Ge){for(var le=[],J=[],ne=1,fe,Ae=0;Ae<Me.length;Ae++)fe=Me[Ae],he[fe]?ne=B(ne,he[fe]):Re[fe]&&(ne*=Re[fe].scalar,Re[fe].numerator&&le.push(Re[fe].numerator),Re[fe].denominator&&J.push(Re[fe].denominator));for(var Pe=0;Pe<Ge.length;Pe++)fe=Ge[Pe],he[fe]?ne/=he[fe]:Re[fe]&&(ne/=Re[fe].scalar,Re[fe].numerator&&J.push(Re[fe].numerator),Re[fe].denominator&&le.push(Re[fe].denominator));return le=le.reduce(function(Ue,Ve){return Ue.concat(Ve)},[]),J=J.reduce(function(Ue,Ve){return Ue.concat(Ve)},[]),bt({scalar:ne,numerator:le,denominator:J})}bt.parse=ti,bt.getUnits=Xe,bt.getAliases=at,bt.mulSafe=B,bt.divSafe=$,bt.getKinds=kt,bt.swiftConverter=Ii,bt.Error=G,L(bt.prototype,{add:function(Me){if(p(Me)&&(Me=bt(Me)),this.isCompatible(Me)||W(this.units(),Me.units()),this.isTemperature()&&Me.isTemperature())throw new G("Cannot add two temperatures");return this.isTemperature()?Ti(this,Me):Me.isTemperature()?Ti(Me,this):bt({scalar:this.scalar+Me.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(Me){if(p(Me)&&(Me=bt(Me)),this.isCompatible(Me)||W(this.units(),Me.units()),this.isTemperature()&&Me.isTemperature())return ci(this,Me);if(this.isTemperature())return vi(this,Me);if(Me.isTemperature())throw new G("Cannot subtract a temperature from a differential degree unit");return bt({scalar:this.scalar-Me.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(Me){if(w(Me))return bt({scalar:B(this.scalar,Me),numerator:this.numerator,denominator:this.denominator});if(p(Me)&&(Me=bt(Me)),(this.isTemperature()||Me.isTemperature())&&!(this.isUnitless()||Me.isUnitless()))throw new G("Cannot multiply by temperatures");var Ge=this,le=Me;Ge.isCompatible(le)&&Ge.signature!==400&&(le=le.to(Ge));var J=pr(Ge.numerator,Ge.denominator,le.numerator,le.denominator);return bt({scalar:B(Ge.scalar,le.scalar,J[2]),numerator:J[0],denominator:J[1]})},div:function(Me){if(w(Me)){if(Me===0)throw new G("Divide by zero");return bt({scalar:this.scalar/Me,numerator:this.numerator,denominator:this.denominator})}else p(Me)&&(Me=bt(Me));if(Me.scalar===0)throw new G("Divide by zero");if(Me.isTemperature())throw new G("Cannot divide with temperatures");if(this.isTemperature()&&!Me.isUnitless())throw new G("Cannot divide with temperatures");var Ge=this,le=Me;Ge.isCompatible(le)&&Ge.signature!==400&&(le=le.to(Ge));var J=pr(Ge.numerator,Ge.denominator,le.denominator,le.numerator);return bt({scalar:B(Ge.scalar,J[2])/le.scalar,numerator:J[0],denominator:J[1]})},inverse:function(){if(this.isTemperature())throw new G("Cannot divide with temperatures");if(this.scalar===0)throw new G("Divide by zero");return bt({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function pr(Me,Ge,le,J){function ne(et){return et!==ee}Me=Me.filter(ne),le=le.filter(ne),Ge=Ge.filter(ne),J=J.filter(ne);var fe={};function Ae(et,lt){for(var Ct,Gt,Xt,Ht=0;Ht<et.length;Ht++)if(he[et[Ht]]?(Ct=et[Ht+1],Gt=et[Ht],Xt=he[Gt],Ht++):(Ct=et[Ht],Gt=null,Xt=1),Ct&&Ct!==ee)if(fe[Ct]){fe[Ct][0]+=lt;var gi=fe[Ct][2]?he[fe[Ct][2]]:1;fe[Ct][lt===1?3:4]*=$(Xt,gi)}else fe[Ct]=[lt,Ct,Gt,1,1]}Ae(Me,1),Ae(Ge,-1),Ae(le,1),Ae(J,-1);var Pe=[],Ue=[],Ve=1;for(var $e in fe)if(fe.hasOwnProperty($e)){var Ze=fe[$e],Qe;if(Ze[0]>0)for(Qe=0;Qe<Ze[0];Qe++)Pe.push(Ze[2]===null?Ze[1]:[Ze[2],Ze[1]]);else if(Ze[0]<0)for(Qe=0;Qe<-Ze[0];Qe++)Ue.push(Ze[2]===null?Ze[1]:[Ze[2],Ze[1]]);Ve*=$(Ze[3],Ze[4])}return Pe.length===0&&(Pe=_e),Ue.length===0&&(Ue=_e),Pe=Pe.reduce(function(et,lt){return et.concat(lt)},[]),Ue=Ue.reduce(function(et,lt){return et.concat(lt)},[]),[Pe,Ue,Ve]}L(bt.prototype,{eq:function(Me){return this.compareTo(Me)===0},lt:function(Me){return this.compareTo(Me)===-1},lte:function(Me){return this.eq(Me)||this.lt(Me)},gt:function(Me){return this.compareTo(Me)===1},gte:function(Me){return this.eq(Me)||this.gt(Me)},compareTo:function(Me){if(p(Me))return this.compareTo(bt(Me));if(this.isCompatible(Me)||W(this.units(),Me.units()),this.baseScalar<Me.baseScalar)return-1;if(this.baseScalar===Me.baseScalar)return 0;if(this.baseScalar>Me.baseScalar)return 1},same:function(Me){return this.scalar===Me.scalar&&this.units()===Me.units()}}),L(bt.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(Me){return x(Me,_e)})},isCompatible:function(Me){return p(Me)?this.isCompatible(bt(Me)):ni(Me)&&Me.signature!==void 0?this.signature===Me.signature:!1},isInverse:function(Me){return this.inverse().isCompatible(Me)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(Me){Me!==ee&&oe.indexOf(Me)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Br(){}Br.prototype.get=function(Me){return arguments.length>1&&(Me=Array.apply(null,arguments)),Me.reduce(function(Ge,le,J){if(Ge){var ne=Ge[le];return J===Me.length-1?ne?ne.data:void 0:ne}},this)},Br.prototype.set=function(Me,Ge){return arguments.length>2&&(Me=Array.prototype.slice.call(arguments,0,-1),Ge=arguments[arguments.length-1]),Me.reduce(function(le,J,ne){var fe=le[J];return fe===void 0&&(fe=le[J]={}),ne===Me.length-1?(fe.data=Ge,Ge):fe},this)};function Lr(Me,Ge){return(Me+" "+Ge).trim()}bt.formatter=Lr,L(bt.prototype,{units:function(){if(this._units!==void 0)return this._units;var Me=x(this.numerator,_e),Ge=x(this.denominator,_e);if(Me&&Ge)return this._units="",this._units;var le=br(this.numerator),J=br(this.denominator);return this._units=le+(Ge?"":"/"+J),this._units},toString:function(Me,Ge){var le;if(w(Me))le=this.units(),Ge=Me;else if(p(Me))le=Me;else if(ni(Me))return this.toPrec(Me).toString(Ge);var J=this.to(le),ne=Ge!==void 0?U(J.scalar,Ge):J.scalar;return J=(ne+" "+J.units()).trim(),J},format:function(Me,Ge){arguments.length===1&&typeof Me=="function"&&(Ge=Me,Me=void 0),Ge=Ge||bt.formatter;var le=this.to(Me);return Ge.call(this,le.scalar,le.units())}});var Tr=new Br;function br(Me){var Ge=Tr.get(Me);if(Ge)return Ge;var le=x(Me,_e);return le?Ge="1":Ge=Sr(Nr(Me)).join("*"),Tr.set(Me,Ge),Ge}function Nr(Me){for(var Ge=[],le,J,ne=0;ne<Me.length;ne++)le=Me[ne],J=Me[ne+1],he[le]?(Ge.push(de[le]+de[J]),ne++):Ge.push(de[le]);return Ge}function Sr(Me){var Ge=Me.reduce(function(le,J){var ne=le[J];return ne||le.push(ne=le[J]=[J,0]),ne[1]++,le},[]);return Ge.map(function(le){return le[0]+(le[1]>1?le[1]:"")})}return bt.version="1.7.6",bt})})(quantities);var Qty=quantities.exports;function deepValue(d,h=""){let p=h.split(".");for(let m of p){if(d[m]===void 0)return;d=d[m]}return d}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(d,h,p){var m=d*h,w=SPLITTER*d,M=w-d,k=w-M,x=d-k,L=SPLITTER*h,B=L-h,$=L-B,U=h-$,q=m-k*$,G=q-x*$,W=G-k*U,te=x*U-W;return p?(p[0]=te,p[1]=m,p):[te,m]}var robustSum=linearExpansionSum;function scalarScalar$1(d,h){var p=d+h,m=p-d,w=p-m,M=h-m,k=d-w,x=k+M;return x?[x,p]:[p]}function linearExpansionSum(d,h){var p=d.length|0,m=h.length|0;if(p===1&&m===1)return scalarScalar$1(d[0],h[0]);var w=p+m,M=new Array(w),k=0,x=0,L=0,B=Math.abs,$=d[x],U=B($),q=h[L],G=B(q),W,te;U<G?(te=$,x+=1,x<p&&($=d[x],U=B($))):(te=q,L+=1,L<m&&(q=h[L],G=B(q))),x<p&&U<G||L>=m?(W=$,x+=1,x<p&&($=d[x],U=B($))):(W=q,L+=1,L<m&&(q=h[L],G=B(q)));for(var oe=W+te,ee=oe-W,_e=te-ee,se=_e,he=oe,ge,Re,ve,de,Se;x<p&&L<m;)U<G?(W=$,x+=1,x<p&&($=d[x],U=B($))):(W=q,L+=1,L<m&&(q=h[L],G=B(q))),te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge;for(;x<p;)W=$,te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge,x+=1,x<p&&($=d[x]);for(;L<m;)W=q,te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge,L+=1,L<m&&(q=h[L]);return se&&(M[k++]=se),he&&(M[k++]=he),k||(M[k++]=0),M.length=k,M}var twoSum$1=fastTwoSum;function fastTwoSum(d,h,p){var m=d+h,w=m-d,M=m-w,k=h-w,x=d-M;return p?(p[0]=x+k,p[1]=m,p):[x+k,m]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(d,h){var p=d.length;if(p===1){var m=twoProduct(d[0],h);return m[0]?m:[m[1]]}var w=new Array(2*p),M=[.1,.1],k=[.1,.1],x=0;twoProduct(d[0],h,M),M[0]&&(w[x++]=M[0]);for(var L=1;L<p;++L){twoProduct(d[L],h,k);var B=M[1];twoSum(B,k[0],M),M[0]&&(w[x++]=M[0]);var $=k[1],U=M[1],q=$+U,G=q-$,W=U-G;M[1]=q,W&&(w[x++]=W)}return M[1]&&(w[x++]=M[1]),x===0&&(w[x++]=0),w.length=x,w}var robustDiff=robustSubtract;function scalarScalar(d,h){var p=d+h,m=p-d,w=p-m,M=h-m,k=d-w,x=k+M;return x?[x,p]:[p]}function robustSubtract(d,h){var p=d.length|0,m=h.length|0;if(p===1&&m===1)return scalarScalar(d[0],-h[0]);var w=p+m,M=new Array(w),k=0,x=0,L=0,B=Math.abs,$=d[x],U=B($),q=-h[L],G=B(q),W,te;U<G?(te=$,x+=1,x<p&&($=d[x],U=B($))):(te=q,L+=1,L<m&&(q=-h[L],G=B(q))),x<p&&U<G||L>=m?(W=$,x+=1,x<p&&($=d[x],U=B($))):(W=q,L+=1,L<m&&(q=-h[L],G=B(q)));for(var oe=W+te,ee=oe-W,_e=te-ee,se=_e,he=oe,ge,Re,ve,de,Se;x<p&&L<m;)U<G?(W=$,x+=1,x<p&&($=d[x],U=B($))):(W=q,L+=1,L<m&&(q=-h[L],G=B(q))),te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge;for(;x<p;)W=$,te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge,x+=1,x<p&&($=d[x]);for(;L<m;)W=q,te=se,oe=W+te,ee=oe-W,_e=te-ee,_e&&(M[k++]=_e),ge=he+oe,Re=ge-he,ve=ge-Re,de=oe-Re,Se=he-ve,se=Se+de,he=ge,L+=1,L<m&&(q=-h[L]);return se&&(M[k++]=se),he&&(M[k++]=he),k||(M[k++]=0),M.length=k,M}(function(d){var h=twoProduct_1,p=robustSum,m=robustScale,w=robustDiff,M=5,k=11102230246251565e-32,x=(3+16*k)*k,L=(7+56*k)*k;function B(se,he,ge,Re){return function(de,Se,ce){var ye=se(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),se(he(de[1],Se[0]),he(-Se[1],de[0]))),ze=se(he(de[1],ce[0]),he(-ce[1],de[0])),Xe=Re(ye,ze);return Xe[Xe.length-1]}}function $(se,he,ge,Re){return function(de,Se,ce,ye){var ze=se(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),Se[2]),se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),-ce[2]),ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),ye[2]))),se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ye[2])))),Xe=se(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-ce[2]),ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),ye[2]))),se(ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),de[2]),se(ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ce[2])))),at=Re(ze,Xe);return at[at.length-1]}}function U(se,he,ge,Re){return function(de,Se,ce,ye,ze){var Xe=se(se(se(ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),ce[2]),se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),-ye[2]),ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),ze[2]))),Se[3]),se(ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),Se[2]),se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),-ye[2]),ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),ze[2]))),-ce[3]),ge(se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),Se[2]),se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),-ce[2]),ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),ze[2]))),ye[3]))),se(ge(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),Se[2]),se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),-ce[2]),ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),ye[2]))),-ze[3]),se(ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),Se[2]),se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),-ye[2]),ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),ze[2]))),de[3]),ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-ye[2]),ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),ze[2]))),-Se[3])))),se(se(ge(se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ze[2]))),ye[3]),se(ge(se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ye[2]))),-ze[3]),ge(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),Se[2]),se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),-ce[2]),ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),ye[2]))),de[3]))),se(ge(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-ce[2]),ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),ye[2]))),-Se[3]),se(ge(se(ge(se(he(Se[1],ye[0]),he(-ye[1],Se[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ye[2]))),ce[3]),ge(se(ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),de[2]),se(ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ce[2]))),-ye[3]))))),at=se(se(se(ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),ce[2]),se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),-ye[2]),ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),ze[2]))),de[3]),ge(se(ge(se(he(ye[1],ze[0]),he(-ze[1],ye[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-ye[2]),ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),ze[2]))),-ce[3])),se(ge(se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-ce[2]),ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),ze[2]))),ye[3]),ge(se(ge(se(he(ce[1],ye[0]),he(-ye[1],ce[0])),de[2]),se(ge(se(he(de[1],ye[0]),he(-ye[1],de[0])),-ce[2]),ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),ye[2]))),-ze[3]))),se(se(ge(se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),Se[2]),se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),-ce[2]),ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),ze[2]))),de[3]),ge(se(ge(se(he(ce[1],ze[0]),he(-ze[1],ce[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-ce[2]),ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),ze[2]))),-Se[3])),se(ge(se(ge(se(he(Se[1],ze[0]),he(-ze[1],Se[0])),de[2]),se(ge(se(he(de[1],ze[0]),he(-ze[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ze[2]))),ce[3]),ge(se(ge(se(he(Se[1],ce[0]),he(-ce[1],Se[0])),de[2]),se(ge(se(he(de[1],ce[0]),he(-ce[1],de[0])),-Se[2]),ge(se(he(de[1],Se[0]),he(-Se[1],de[0])),ce[2]))),-ze[3])))),ct=Re(Xe,at);return ct[ct.length-1]}}function q(se){var he=se===3?B:se===4?$:U;return he(p,h,m,w)}var G=q(3),W=q(4),te=[function(){return 0},function(){return 0},function(he,ge){return ge[0]-he[0]},function(he,ge,Re){var ve=(he[1]-Re[1])*(ge[0]-Re[0]),de=(he[0]-Re[0])*(ge[1]-Re[1]),Se=ve-de,ce;if(ve>0){if(de<=0)return Se;ce=ve+de}else if(ve<0){if(de>=0)return Se;ce=-(ve+de)}else return Se;var ye=x*ce;return Se>=ye||Se<=-ye?Se:G(he,ge,Re)},function(he,ge,Re,ve){var de=he[0]-ve[0],Se=ge[0]-ve[0],ce=Re[0]-ve[0],ye=he[1]-ve[1],ze=ge[1]-ve[1],Xe=Re[1]-ve[1],at=he[2]-ve[2],ct=ge[2]-ve[2],Bt=Re[2]-ve[2],Lt=Se*Xe,It=ce*ze,Vt=ce*ye,Ft=de*Xe,Mt=de*ze,ri=Se*ye,St=at*(Lt-It)+ct*(Vt-Ft)+Bt*(Mt-ri),At=(Math.abs(Lt)+Math.abs(It))*Math.abs(at)+(Math.abs(Vt)+Math.abs(Ft))*Math.abs(ct)+(Math.abs(Mt)+Math.abs(ri))*Math.abs(Bt),Et=L*At;return St>Et||-St>Et?St:W(he,ge,Re,ve)}];function oe(se){var he=te[se.length];return he||(he=te[se.length]=q(se.length)),he.apply(void 0,se)}function ee(se,he,ge,Re,ve,de,Se){return function(ye,ze,Xe,at,ct){switch(arguments.length){case 0:case 1:return 0;case 2:return Re(ye,ze);case 3:return ve(ye,ze,Xe);case 4:return de(ye,ze,Xe,at);case 5:return Se(ye,ze,Xe,at,ct)}for(var Bt=new Array(arguments.length),Lt=0;Lt<arguments.length;++Lt)Bt[Lt]=arguments[Lt];return se(Bt)}}function _e(){for(;te.length<=M;)te.push(q(te.length));d.exports=ee.apply(void 0,[oe].concat(te));for(var se=0;se<=M;++se)d.exports[se]=te[se]}_e()})(orientation);var robustPnp=robustPointInPolygon,orient=orientation.exports;function robustPointInPolygon(d,h){for(var p=h[0],m=h[1],w=d.length,M=1,k=w,x=0,L=w-1;x<k;L=x++){var B=d[x],$=d[L],U=B[1],q=$[1];if(q<U){if(q<m&&m<U){var G=orient(B,$,h);if(G===0)return 0;M^=0<G|0}else if(m===U){var W=d[(x+1)%w],te=W[1];if(U<te){var G=orient(B,$,h);if(G===0)return 0;M^=0<G|0}}}else if(U<q){if(U<m&&m<q){var G=orient(B,$,h);if(G===0)return 0;M^=G<0|0}else if(m===U){var W=d[(x+1)%w],te=W[1];if(te<U){var G=orient(B,$,h);if(G===0)return 0;M^=G<0|0}}}else if(m===U){var oe=Math.min(B[0],$[0]),ee=Math.max(B[0],$[0]);if(x===0){for(;L>0;){var _e=(L+w-1)%w,se=d[_e];if(se[1]!==m)break;var he=se[0];oe=Math.min(oe,he),ee=Math.max(ee,he),L=_e}if(L===0)return oe<=p&&p<=ee?0:1;k=L+1}for(var ge=d[(L+w-1)%w][1];x+1<k;){var se=d[x+1];if(se[1]!==m)break;var he=se[0];oe=Math.min(oe,he),ee=Math.max(ee,he),x+=1}if(oe<=p&&p<=ee)return 0;var Re=d[(x+1)%w][1];p<oe&&ge<m!=Re<m&&(M^=1)}}return 2*M-1}var robustPointInPolygon$1=robustPnp;function feretDiameters(d={}){const{originalPoints:h=monotoneChainConvexHull.call(this)}=d;if(h.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(h.length===1)return{min:1,max:1,minLine:[h[0],h[0]],maxLine:[h[0],h[0]],aspectRatio:1};const p=new Array(h.length);let m=1/0,w=0,M=[];for(let B=0;B<h.length;B++){let $=getAngle(h[B],h[(B+1)%h.length]);rotate(-$,h,p);let U=0,q=[];for(let G=0;G<h.length;G++){let W=Math.abs(p[B][1]-p[G][1]);W>U&&(U=W,q=[],q.push([p[G][0],p[B][1]],[p[G][0],p[G][1]]))}U<m&&(m=U,w=$,M=q)}rotate(w,M,M);let k=0,x=[],L=0;for(let B=0;B<h.length-1;B++)for(let $=B+1;$<h.length;$++){let U=(h[B][0]-h[$][0])**2+(h[B][1]-h[$][1])**2;U>L&&(L=U,k=Math.sqrt(U),x=[h[B],h[$]])}return{min:m,minLine:M,max:k,maxLine:x,aspectRatio:m/k}}function getAngle(d,h){let p=difference(h,d),m=normalize(p),w=Math.acos(m[0]);return m[1]<0?-w:w}class Roi{constructor(h,p){this.map=h,this.id=p,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(h={}){const{scale:p=1,kind:m=""}=h;let w;switch(m){case"contour":w=this.contourMask;break;case"box":w=this.boxMask;break;case"filled":w=this.filledMask;break;case"center":w=this.centerMask;break;case"mbr":w=this.mbrFilledMask;break;case"hull":w=this.convexHullFilledMask;break;case"hullContour":w=this.convexHullMask;break;case"mbrContour":w=this.mbrMask;break;case"feret":w=this.feretMask;break;default:w=this.mask}return p<1&&(w=w.resize({factor:p}),w.parent=this.mask.parent,w.position[0]+=this.minX,w.position[1]+=this.minY),w}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let h=this.borderIDs,p=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let m=this.internalIDs;for(let w=0;w<h.length;w++)m.includes(h[w])||(this.computed.externalIDs.push(h[w]),this.computed.externalLengths.push(p[w]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let h=getBorders(this);this.computed.borderIDs=h.ids,this.computed.borderLengths=h.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let h=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let p=0;p<this.width;p++)for(let m=0;m<this.height;m++)this.map.data[p+this.minX+(m+this.minY)*this.map.width]===this.id&&(p>0&&p<this.width-1&&m>0&&m<this.height-1?(this.map.data[p-1+this.minX+(m+this.minY)*this.map.width]!==this.id||this.map.data[p+1+this.minX+(m+this.minY)*this.map.width]!==this.id||this.map.data[p+this.minX+(m-1+this.minY)*this.map.width]!==this.id||this.map.data[p+this.minX+(m+1+this.minY)*this.map.width]!==this.id)&&h.setBitXY(p,m):h.setBitXY(p,m));this.computed.contourMask=h}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let h=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let p=0;p<this.width;p++)h.setBitXY(p,0),h.setBitXY(p,this.height-1);for(let p=0;p<this.height;p++)h.setBitXY(0,p),h.setBitXY(this.width-1,p);this.computed.boxMask=h}return this.computed.boxMask}get mask(){if(!this.computed.mask){let h=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let p=0;p<this.width;p++)for(let m=0;m<this.height;m++)this.map.data[p+this.minX+(m+this.minY)*this.map.width]===this.id&&h.setBitXY(p,m);this.computed.mask=h}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let h=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let p=0;p<this.width;p++)for(let m=0;m<this.height;m++){let w=p+this.minX+(m+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[w])&&h.setBitXY(p,m)}this.computed.filledMask=h}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let h=new Shape({kind:"smallCross"}).getMask();h.parent=this.map.parent,h.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=h}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const h=[];for(let m=0;m<this.width;m++)for(let w=0;w<this.height;w++)this.map.data[m+this.minX+(w+this.minY)*this.map.width]===this.id&&(m>0&&m<this.width-1&&w>0&&w<this.height-1?(this.map.data[m-1+this.minX+(w+this.minY)*this.map.width]!==this.id||this.map.data[m+1+this.minX+(w+this.minY)*this.map.width]!==this.id||this.map.data[m+this.minX+(w-1+this.minY)*this.map.width]!==this.id||this.map.data[m+this.minX+(w+1+this.minY)*this.map.width]!==this.id)&&(h.push([m,w]),h.push([m+1,w]),h.push([m,w+1]),h.push([m+1,w+1])):(h.push([m,w]),h.push([m+1,w]),h.push([m,w+1]),h.push([m+1,w+1])));const p=monotoneChainConvexHull$1(h);this.computed.convexHull={polyline:p,surface:surface(p),perimeter:perimeter(p)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const h=this.convexHull,p=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});p.paintPolyline(h.polyline,{closed:!0}),this.computed.convexHullMask=p}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const h=this.convexHull,p=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let m=0;m<this.width;m++)for(let w=0;w<this.height;w++)robustPointInPolygon$1(h.polyline,[m,w])!==1&&p.setBitXY(m,w);this.computed.convexHullFilledMask=p}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let h=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(h.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:h};else{let p=h[0],m=h[1],w=h[2],M=Math.sqrt((p[0]-m[0])**2+(p[1]-m[1])**2),k=Math.sqrt((w[0]-m[0])**2+(w[1]-m[1])**2);this.computed.mbr={width:M,height:k,elongation:1-M/k,aspectRatio:M/k,surface:M*k,perimeter:(M+k)*2,rectangle:h}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let h=this.perimeterInfo,p=2-Math.sqrt(2);return h.one+h.two*2+h.three*3+h.four*4-p*(h.two+h.three*2+h.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const h=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});h.paintPolyline(this.feretDiameters.minLine),h.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=h}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let h=round(this.mbr.rectangle);if(h.length>0){const p=minMax(h),m=new Image$1(p[1][0]-p[0][0]+1,p[1][1]-p[0][1]+1,{kind:BINARY,position:[this.minX+p[0][0],this.minY+p[0][1]],parent:this.map.parent});h=moveToZeroZero(h),m.paintPolyline(h,{closed:!0}),this.computed.mbrMask=m}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const h=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),p=this.mask.minimalBoundingRectangle();for(let m=0;m<this.width;m++)for(let w=0;w<this.height;w++)robustPointInPolygon$1(p,[m,w])!==1&&h.setBitXY(m,w);this.computed.mbrFilledMask=h}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let h=[];for(let p=0;p<this.height;p++)for(let m=0;m<this.width;m++){let w=(p+this.minY)*this.map.width+m+this.minX;this.map.data[w]===this.id&&h.push([m,p])}this.computed.points=h}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let h=0,p;const m=this.points;for(let w=0;w<m.length;w++)for(let M=w+1;M<m.length;M++){let k=Math.pow(m[w][0]-m[M][0],2)+Math.pow(m[w][1]-m[M][1],2);k>=h&&(h=k,p=[m[w],m[M]])}this.computed.maxLengthPoints=p}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let h=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=h}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let h=this.maxLengthPoints,p=-Math.atan2(h[0][1]-h[1][1],h[0][0]-h[1][0])*180/Math.PI;this.computed.angle=p}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(d){let h=d.map,p=h.data,m=new Set,w=new Map,M=new Set,k=[1,0,-1,0],x=[0,1,0,-1];for(let $=d.minX;$<=d.maxX;$++)for(let U=d.minY;U<=d.maxY;U++){let q=$+U*h.width;if(p[q]===d.id)for(let G=0;G<4;G++){let W=$+k[G],te=U+x[G];if(W>=0&&te>=0&&W<h.width&&te<h.height){let oe=W+te*h.width;if(p[oe]!==d.id&&!M.has(oe)){M.add(oe),m.add(p[oe]);let ee=w.get(p[oe]);ee?w.set(p[oe],++ee):w.set(p[oe],1)}}}}let L=Array.from(m),B=L.map(function($){return w.get($)});return{ids:L,lengths:B}}function getBoxIDs(d){let h=new Set,p=d.map,m=p.data;for(let w of[0,d.height-1])for(let M=0;M<d.width;M++){let k=(w+d.minY)*p.width+M+d.minX;if(M-d.minX>0&&m[k]===d.id&&m[k-1]!==d.id){let x=m[k-1];h.add(x)}if(p.width-M-d.minX>1&&m[k]===d.id&&m[k+1]!==d.id){let x=m[k+1];h.add(x)}}for(let w of[0,d.width-1])for(let M=0;M<d.height;M++){let k=(M+d.minY)*p.width+w+d.minX;if(M-d.minY>0&&m[k]===d.id&&m[k-p.width]!==d.id){let x=m[k-p.width];h.add(x)}if(p.height-M-d.minY>1&&m[k]===d.id&&m[k+p.width]!==d.id){let x=m[k+p.width];h.add(x)}}return Array.from(h)}function getBox(d){let h=0,p=d.map,m=p.data,w=[0];d.height>1&&(w[1]=d.height-1);for(let k of w)for(let x=1;x<d.width-1;x++){let L=(k+d.minY)*p.width+x+d.minX;m[L]===d.id&&h++}let M=[0];d.width>1&&(M[1]=d.width-1);for(let k of M)for(let x=0;x<d.height;x++){let L=(x+d.minY)*p.width+k+d.minX;m[L]===d.id&&h++}return h}function getBorder(d){let h=0,p=d.map,m=p.data;for(let w=1;w<d.width-1;w++)for(let M=1;M<d.height-1;M++){let k=(M+d.minY)*p.width+w+d.minX;m[k]===d.id&&(m[k-1]!==d.id||m[k+1]!==d.id||m[k-p.width]!==d.id||m[k+p.width]!==d.id)&&h++}return h+d.box}function getPerimeterInfo(d){let h=d.map,p=h.data,m=0,w=0,M=0,k=0;for(let x=0;x<d.width;x++)for(let L=0;L<d.height;L++){let B=(L+d.minY)*h.width+x+d.minX;if(p[B]===d.id){let $=0;switch((x===0||d.externalIDs.includes(p[B-1]))&&$++,(x===d.width-1||d.externalIDs.includes(p[B+1]))&&$++,(L===0||d.externalIDs.includes(p[B-h.width]))&&$++,(L===d.height-1||d.externalIDs.includes(p[B+h.width]))&&$++,$){case 1:m++;break;case 2:w++;break;case 3:M++;break;case 4:k++;break}}}return{one:m,two:w,three:M,four:k}}function getExternal(d){let h=0,p=d.map,m=p.data;for(let w=1;w<d.width-1;w++)for(let M=1;M<d.height-1;M++){let k=(M+d.minY)*p.width+w+d.minX;m[k]===d.id&&(d.externalIDs.includes(m[k-1])||d.externalIDs.includes(m[k+1])||d.externalIDs.includes(m[k-p.width])||d.externalIDs.includes(m[k+p.width]))&&h++}return h+d.box}function getHolesInfo(d){let h=0,p=d.map.width,m=d.map.data;for(let w=1;w<d.width-1;w++)for(let M=1;M<d.height-1;M++){let k=(M+d.minY)*p+w+d.minX;d.internalIDs.includes(m[k])&&m[k]!==d.id&&h++}return{number:d.internalIDs.length-1,surface:h}}function getInternalIDs(d){let h=[d.id],p=d.map,m=p.data;if(d.height>2)for(let M=0;M<d.width;M++){let k=d.minY*p.width+M+d.minX;if(h.includes(m[k])){let x=m[k+p.width];!h.includes(x)&&!d.boxIDs.includes(x)&&h.push(x)}}let w=new Array(4);for(let M=1;M<d.width-1;M++)for(let k=1;k<d.height-1;k++){let x=(k+d.minY)*p.width+M+d.minX;if(h.includes(m[x])){w[0]=m[x-1],w[1]=m[x+1],w[2]=m[x-p.width],w[3]=m[x+p.width];for(let L=0;L<4;L++){let B=w[L];!h.includes(B)&&!d.boxIDs.includes(B)&&h.push(B)}}}return h}class RoiLayer{constructor(h,p){this.roiMap=h,this.options=p,this.roi=this.createRoi()}createRoi(){let h=this.roiMap.data,p={};this.roiMap.positive=0,this.roiMap.negative=0;for(let x=0;x<h.length;x++)h[x]&&!p[h[x]]&&(p[h[x]]=!0,h[x]>0?this.roiMap.positive++:this.roiMap.negative++);let m={};for(let x in p)m[x]=new Roi(this.roiMap,x*1);let w=this.roiMap.width,M=this.roiMap.height;for(let x=0;x<M;x++)for(let L=0;L<w;L++){let B=x*w+L;if(h[B]!==0){const $=h[B],U=m[$];L<U.minX&&(U.minX=L),L>U.maxX&&(U.maxX=L),x<U.minY&&(U.minY=x),x>U.maxY&&(U.maxY=x),U.meanX+=L,U.meanY+=x,U.surface++}}let k=[];for(let x in p)m[x].meanX/=m[x].surface,m[x].meanY/=m[x].surface,k.push(m[x]);return k}}function commonBorderLength(d){let h=d.data,p=[1,0,-1,0],m=[0,1,0,-1],w=d.minMax,M=-w.min,k=w.max+M,x=[];for(let B=0;B<=k;B++)x.push(Object.create(null));for(let B=0;B<d.width;B++)for(let $=0;$<d.height;$++){let U=B+$*d.width,q=h[U];if(q!==0){let G=Object.create(null),W=!1;for(let te=0;te<4;te++){let oe=B+p[te],ee=$+m[te];if(oe>=0&&ee>=0&&oe<d.width&&ee<d.height){let _e=h[oe+ee*d.width];q!==_e&&(W=!0,_e!==0&&G[_e]===void 0&&(G[_e]=!0,x[_e+M][q]?x[_e+M][q]++:x[_e+M][q]=1))}else W=!0}W&&(x[q+M][q]?x[q+M][q]++:x[q+M][q]=1)}}let L={};for(let B=0;B<x.length;B++)Object.keys(x[B]).length>0&&(L[B-M]=x[B]);return L}function mergeRoi(d={}){const{algorithm:h="commonBorderLength",minCommonBorderLength:p=5,maxCommonBorderLength:m=100,minCommonBorderRatio:w=.3,maxCommonBorderRatio:M=1}=d;let k=function(oe,ee,_e){return oe[_e]>=p&&oe[_e]<=m};typeof h=="function"&&(k=h),h.toLowerCase()==="commonborderratio"&&(k=function(oe,ee,_e){let se=Math.min(oe[_e]/oe[ee],1);return se>=w&&se<=M});const x=this,L=x.commonBorderLength;let B={},$={};for(let oe of Object.keys(L)){let ee=L[oe],_e=Object.keys(ee);for(let se of _e)if(se!==oe&&k(ee,oe,se)){let he=se;$[se]&&(he=$[se]);let ge=oe;if($[oe]&&(ge=$[oe]),Number(he)!==ge){let Re=Math.min(he,ge),ve=Math.max(he,ge);if(B[Re]||(B[Re]={}),B[Re][ve]=!0,$[ve]=Re,B[ve]){for(let de of Object.keys(B[ve]))B[Re][de]=!0,$[de]=Re;delete B[ve]}}}}let U=x.minMax,q=-U.min,G=U.max+q,W=new Array(G+1).fill(0);for(let oe of Object.keys($))W[Number(oe)+q]=$[oe];let te=x.data;for(let oe=0;oe<te.length;oe++){let ee=te[oe];if(ee!==0){let _e=W[ee+q];_e!==0&&(te[oe]=_e)}}return x.computed={},x}class RoiMap{constructor(h,p){this.parent=h,this.width=h.width,this.height=h.height,this.data=p,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let h=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER;for(let m=0;m<this.data.length;m++)this.data[m]<h&&(h=this.data[m]),this.data[m]>p&&(p=this.data[m]);return{min:h,max:p}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(h={}){return mergeRoi.call(this,h)}mergeRois(h){const p=h[0],m=h.slice(1);for(let w=0;w<this.data.length;w++)m.includes(this.data[w])&&(this.data[w]=p)}rowsInfo(){let h=new Array(this.height),p=0;for(let m=0;m<this.data.length;m+=this.width){let w={row:p,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};h[p++]=w;let M={},k={},x=[],L=this.data[m],B=0;for(let $=m;$<m+this.width;$++){let U=this.data[$];L!==U&&(L=U,x.push(B),B=0),B++,U>0?(w.positivePixel++,M[U]||(M[U]=!0)):U<0?(w.negativePixel++,k[U]||(k[U]=!0)):w.zeroPixel++}x.push(B),w.medianChange=x.sort(($,U)=>$-U)[Math.floor(x.length/2)],w.positiveRoiIDs=Object.keys(M),w.negativeRoiIDs=Object.keys(k),w.positiveRoi=w.positiveRoiIDs.length,w.negativeRoi=w.negativeRoiIDs.length}return h}colsInfo(){let h=new Array(this.width),p=0;for(let m=0;m<this.width;m++){let w={col:p,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};h[p++]=w;let M={},k={},x=[],L=this.data[m],B=0;for(let $=m;$<m+this.data.length;$+=this.width){let U=this.data[$];L!==U&&(L=U,x.push(B),B=0),B++,U>0?(w.positivePixel++,M[U]||(M[U]=!0)):U<0?(w.negativePixel++,k[U]||(k[U]=!0)):w.zeroPixel++}x.push(B),w.medianChange=x.sort(($,U)=>$-U)[Math.floor(x.length/2)],w.positiveRoiIDs=Object.keys(M),w.negativeRoiIDs=Object.keys(k),w.positiveRoi=w.positiveRoiIDs.length,w.negativeRoi=w.negativeRoiIDs.length}return h}}function fromMask(d,h={}){const{allowCorners:p=!1}=h,m=65535;let w=new Int16Array(d.size),M=0,k=0,x=new Uint16Array(m+1),L=new Uint16Array(m+1);for(let $=0;$<d.width;$++)for(let U=0;U<d.height;U++)w[U*d.width+$]===0&&B($,U);function B($,U){let q=0,G=0,W=d.getBitXY($,U),te=W?++M:--k;if(M>32767||k<-32768)throw new Error("Too many regions of interest");for(x[0]=$,L[0]=U;q<=G;){let oe=x[q&m],ee=L[q&m];if(w[ee*d.width+oe]=te,oe>0&&w[ee*d.width+oe-1]===0&&d.getBitXY(oe-1,ee)===W&&(G++,x[G&m]=oe-1,L[G&m]=ee,w[ee*d.width+oe-1]=-32768),ee>0&&w[(ee-1)*d.width+oe]===0&&d.getBitXY(oe,ee-1)===W&&(G++,x[G&m]=oe,L[G&m]=ee-1,w[(ee-1)*d.width+oe]=-32768),oe<d.width-1&&w[ee*d.width+oe+1]===0&&d.getBitXY(oe+1,ee)===W&&(G++,x[G&m]=oe+1,L[G&m]=ee,w[ee*d.width+oe+1]=-32768),ee<d.height-1&&w[(ee+1)*d.width+oe]===0&&d.getBitXY(oe,ee+1)===W&&(G++,x[G&m]=oe,L[G&m]=ee+1,w[(ee+1)*d.width+oe]=-32768),p&&(oe>0&&ee>0&&w[(ee-1)*d.width+oe-1]===0&&d.getBitXY(oe-1,ee-1)===W&&(G++,x[G&m]=oe-1,L[G&m]=ee-1,w[(ee-1)*d.width+oe-1]=-32768),oe<d.width-1&&ee>0&&w[(ee-1)*d.width+oe+1]===0&&d.getBitXY(oe+1,ee-1)===W&&(G++,x[G&m]=oe+1,L[G&m]=ee-1,w[(ee-1)*d.width+oe+1]=-32768),oe>0&&ee<d.height-1&&w[(ee+1)*d.width+oe-1]===0&&d.getBitXY(oe-1,ee+1)===W&&(G++,x[G&m]=oe-1,L[G&m]=ee+1,w[(ee+1)*d.width+oe-1]=-32768),oe<d.width-1&&ee<d.height-1&&w[(ee+1)*d.width+oe+1]===0&&d.getBitXY(oe+1,ee+1)===W&&(G++,x[G&m]=oe+1,L[G&m]=ee+1,w[(ee+1)*d.width+oe+1]=-32768)),q++,G-q>m)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(d,w)}class DisjointSet{constructor(){this.nodes=new Map}add(h){var p=this.nodes.get(h);return p||(p=new DisjointSetNode(h),this.nodes.set(h,p)),p}union(h,p){const m=this.find(h),w=this.find(p);m!==w&&(m.rank<w.rank?m.parent=w:m.rank>w.rank?w.parent=m:(w.parent=m,m.rank++))}find(h){for(var p=h;p.parent!==null;)p=p.parent;for(var m=h;m.parent!==null;){var w=m;m=m.parent,w.parent=p}return p}connected(h,p){return this.find(h)===this.find(p)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(d){this.value=d,this.parent=null,this.rank=0}var DisjointSet$1=DisjointSet_1;const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(d,h={}){const{allowCorners:p=!1}=h;let m=4;p&&(m=8);let w,M,k;if(m===8)w=direction8X,M=direction8Y,k=neighbours8;else if(m===4)w=direction4X,M=direction4Y,k=neighbours4;else throw new RangeError(`unsupported neighbours count: ${m}`);const x=d.size,L=d.width,B=d.height,$=new Array(x),U=new Uint32Array(x),q=new DisjointSet$1;let G=1;for(let W=0;W<B;W++)for(let te=0;te<L;te++){const oe=te+W*L;if(d.getBit(oe)){let ee=null;for(let _e=0;_e<k.length;_e++){const se=te+w[_e],he=W+M[_e];if(se>=0&&he>=0&&se<L&&he<B){const ge=se+he*L;let Re=$[ge];Re?(k[_e]=Re,(!ee||k[_e].value<ee.value)&&(ee=k[_e])):k[_e]=null}}if(!ee)$[oe]=q.add(G++);else{$[oe]=ee;for(let _e=0;_e<k.length;_e++)k[_e]&&k[_e]!==ee&&q.union(ee,k[_e])}}}for(let W=0;W<B;W++)for(let te=0;te<L;te++){const oe=te+W*L;d.getBit(oe)&&(U[oe]=q.find($[oe]).value)}return new RoiMap(d,U)}function fromMaxima(d={}){let{allowCorner:h=!0,onlyTop:p=!1,invert:m=!1}=d,w=this;w.checkProcessable("fromMaxima",{components:[1]});const M=1,k=2;let x=0,L=0,B=new Int16Array(w.size),$=new Int8Array(w.size),U=new Float32Array(w.size),q=1048575,G=new Uint16Array(q+1),W=new Uint16Array(q+1),te=0,oe=0,ee=new Uint16Array(q+1),_e=new Uint16Array(q+1),se=0,he=0;for(ge(w);te<oe;){let de=G[te&q],Se=W[te&q];ve(de,Se,k),te++}return new RoiMap(w,B);function ge({maxima:de=!0}){for(let Se=1;Se<w.height-1;Se++)for(let ce=1;ce<w.width-1;ce++){let ye=ce+Se*w.width;if($[ye]===0){let ze=de?w.data[ye]:-w.data[ce+Se*w.width];if(w.data[Se*w.width+ce-1]>ze||w.data[Se*w.width+ce+1]>ze||w.data[(Se-1)*w.width+ce]>ze||w.data[(Se+1)*w.width+ce]>ze||h&&(w.data[(Se-1)*w.width+ce-1]>ze||w.data[(Se-1)*w.width+ce+1]>ze||w.data[(Se+1)*w.width+ce-1]>ze||w.data[(Se+1)*w.width+ce+1]>ze))continue;B[ye]=de?++x:--L,Re(ce,Se)||(de?--x:++L)}}}function Re(de,Se){let ce=oe;se=0,he=1,ee[0]=de,_e[0]=Se;let ye=!0;for(;se<he;){let ze=ee[se&q],Xe=_e[se&q];ye&=ve(ze,Xe,M),se++}if(!ye){for(let ze=0;ze<he;ze++){let Xe=ee[ze&q],ct=_e[ze&q]*w.width+Xe;B[ct]=0}oe=ce}return ye}function ve(de,Se,ce){let ye=B[Se*w.width+de],ze=w.data[Se*w.width+de];for(let Xe=Se-1;Xe<=Se+1;Xe++)for(let at=de-1;at<=de+1;at++){let ct=Xe*w.width+at;if($[ct]===0)switch($[ct]=1,U[ct]=w.data[ct]-ze,ce){case M:if(U[ct]===0){if(at===0||Xe===0||at===w.width-1||Xe===w.height-1)return!1;B[ct]=ye,ee[he&q]=at,_e[he&q]=Xe,he++}else{if(U[ct]>0)return!1;p||(B[ct]=ye,G[oe&q]=at,W[oe&q]=Xe,oe++)}break;case k:U[ct]<=0&&(B[ct]=ye,G[oe&q]=at,W[oe&q]=Xe,oe++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(d,h={}){let p=new Shape(h),m=new Int16Array(this.size),w=0,M=p.getPoints();for(let k=0;k<d.length;k++){w++;let x=d[k][0],L=d[k][1];for(let B=0;B<M.length;B++){let $=M[B][0],U=M[B][1];x+$>=0&&L+U>=0&&x+$<this.width&&L+U<this.height&&(m[x+$+(L+U)*this.width]=w)}}return new RoiMap(this,m)}var priorityQueue={exports:{}};(function(d,h){(function(p){d.exports=p()})(function(){return function p(m,w,M){function k(B,$){if(!w[B]){if(!m[B]){var U=typeof commonjsRequire=="function"&&commonjsRequire;if(!$&&U)return U(B,!0);if(x)return x(B,!0);var q=new Error("Cannot find module '"+B+"'");throw q.code="MODULE_NOT_FOUND",q}var G=w[B]={exports:{}};m[B][0].call(G.exports,function(W){var te=m[B][1][W];return k(te||W)},G,G.exports,p,m,w,M)}return w[B].exports}for(var x=typeof commonjsRequire=="function"&&commonjsRequire,L=0;L<M.length;L++)k(M[L]);return k}({1:[function(p,m,w){var M,k,x,L,B,$=function(q,G){for(var W in G)U.call(G,W)&&(q[W]=G[W]);function te(){this.constructor=q}return te.prototype=G.prototype,q.prototype=new te,q.__super__=G.prototype,q},U={}.hasOwnProperty;M=p("./PriorityQueue/AbstractPriorityQueue"),k=p("./PriorityQueue/ArrayStrategy"),L=p("./PriorityQueue/BinaryHeapStrategy"),x=p("./PriorityQueue/BHeapStrategy"),B=function(q){$(G,q);function G(W){W||(W={}),W.strategy||(W.strategy=L),W.comparator||(W.comparator=function(te,oe){return(te||0)-(oe||0)}),G.__super__.constructor.call(this,W)}return G}(M),B.ArrayStrategy=k,B.BinaryHeapStrategy=L,B.BHeapStrategy=x,m.exports=B},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(p,m,w){m.exports=function(){function M(k){var x;if((k!=null?k.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((k!=null?k.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new k.strategy(k),this.length=(k!=null&&(x=k.initialValues)!=null?x.length:void 0)||0}return M.prototype.queue=function(k){this.length++,this.priv.queue(k)},M.prototype.dequeue=function(k){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},M.prototype.peek=function(k){if(!this.length)throw"Empty queue";return this.priv.peek()},M.prototype.clear=function(){return this.length=0,this.priv.clear()},M}()},{}],3:[function(p,m,w){var M;M=function(k,x,L){var B,$,U;for($=0,B=k.length;$<B;)U=$+B>>>1,L(k[U],x)>=0?$=U+1:B=U;return $},m.exports=function(){function k(x){var L;this.options=x,this.comparator=this.options.comparator,this.data=((L=this.options.initialValues)!=null?L.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return k.prototype.queue=function(x){var L;L=M(this.data,x,this.comparator),this.data.splice(L,0,x)},k.prototype.dequeue=function(){return this.data.pop()},k.prototype.peek=function(){return this.data[this.data.length-1]},k.prototype.clear=function(){this.data.length=0},k}()},{}],4:[function(p,m,w){m.exports=function(){function M(k){var x,L,B,$,U,q,G,W;for(this.comparator=(k!=null?k.comparator:void 0)||function(te,oe){return te-oe},this.pageSize=(k!=null?k.pageSize:void 0)||512,this.length=0,G=0;1<<G<this.pageSize;)G+=1;if(1<<G!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=G,this._emptyMemoryPageTemplate=x=[],L=0,U=this.pageSize;0<=U?L<U:L>U;0<=U?++L:--L)x.push(null);if(this._memory=[],this._mask=this.pageSize-1,k.initialValues)for(q=k.initialValues,B=0,$=q.length;B<$;B++)W=q[B],this.queue(W)}return M.prototype.queue=function(k){this.length+=1,this._write(this.length,k),this._bubbleUp(this.length,k)},M.prototype.dequeue=function(){var k,x;return k=this._read(1),x=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,x),this._bubbleDown(1,x)),k},M.prototype.peek=function(){return this._read(1)},M.prototype.clear=function(){this.length=0,this._memory.length=0},M.prototype._write=function(k,x){var L;for(L=k>>this._shift;L>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[L][k&this._mask]=x},M.prototype._read=function(k){return this._memory[k>>this._shift][k&this._mask]},M.prototype._bubbleUp=function(k,x){var L,B,$,U;for(L=this.comparator;k>1&&(B=k&this._mask,k<this.pageSize||B>3?$=k&~this._mask|B>>1:B<2?($=k-this.pageSize>>this._shift,$+=$&~(this._mask>>1),$|=this.pageSize>>1):$=k-2,U=this._read($),!(L(U,x)<0));)this._write($,x),this._write(k,U),k=$},M.prototype._bubbleDown=function(k,x){var L,B,$,U,q;for(q=this.comparator;k<this.length;)if(k>this._mask&&!(k&this._mask-1)?L=B=k+2:k&this.pageSize>>1?(L=(k&~this._mask)>>1,L|=k&this._mask>>1,L=L+1<<this._shift,B=L+1):(L=k+(k&this._mask),B=L+1),L!==B&&B<=this.length)if($=this._read(L),U=this._read(B),q($,x)<0&&q($,U)<=0)this._write(L,x),this._write(k,$),k=L;else if(q(U,x)<0)this._write(B,x),this._write(k,U),k=B;else break;else if(L<=this.length)if($=this._read(L),q($,x)<0)this._write(L,x),this._write(k,$),k=L;else break;else break},M}()},{}],5:[function(p,m,w){m.exports=function(){function M(k){var x;this.comparator=(k!=null?k.comparator:void 0)||function(L,B){return L-B},this.length=0,this.data=((x=k.initialValues)!=null?x.slice(0):void 0)||[],this._heapify()}return M.prototype._heapify=function(){var k,x,L;if(this.data.length>0)for(k=x=1,L=this.data.length;1<=L?x<L:x>L;k=1<=L?++x:--x)this._bubbleUp(k)},M.prototype.queue=function(k){this.data.push(k),this._bubbleUp(this.data.length-1)},M.prototype.dequeue=function(){var k,x;return x=this.data[0],k=this.data.pop(),this.data.length>0&&(this.data[0]=k,this._bubbleDown(0)),x},M.prototype.peek=function(){return this.data[0]},M.prototype.clear=function(){this.length=0,this.data.length=0},M.prototype._bubbleUp=function(k){for(var x,L;k>0&&(x=k-1>>>1,this.comparator(this.data[k],this.data[x])<0);)L=this.data[x],this.data[x]=this.data[k],this.data[k]=L,k=x},M.prototype._bubbleDown=function(k){var x,L,B,$,U;for(x=this.data.length-1;L=(k<<1)+1,$=L+1,B=k,L<=x&&this.comparator(this.data[L],this.data[B])<0&&(B=L),$<=x&&this.comparator(this.data[$],this.data[B])<0&&(B=$),B!==k;)U=this.data[B],this.data[B]=this.data[k],this.data[k]=U,k=B},M}()},{}]},{},[1])(1)})})(priorityQueue);var PriorityQueue=priorityQueue.exports;const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(d={}){let{points:h,mask:p,image:m,fillMaxValue:w=this.maxValue,invert:M=!1}=d,k=m||this;k.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),M=!M,h||(h=k.getLocalMaxima({invert:M,mask:p}));let x=M?0:1,L=new Int16Array(k.size),B=k.width,$=k.height,U=new PriorityQueue({comparator:(q,G)=>q[2]-G[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let q=0;q<h.length;q++){let G=h[q][0]+h[q][1]*B;L[G]=q+1;let W=k.data[G];(M&&W<=w||!M&&W>=w)&&U.queue([h[q][0],h[q][1],W])}for(;U.length>0;){let q=U.dequeue(),G=q[0]+q[1]*B;for(let W=0;W<4;W++){let te=q[0]+dxs[W],oe=q[1]+dys[W];if(te>=0&&oe>=0&&te<B&&oe<$){let ee=te+oe*B;if(!p||p.getBit(ee)===x){let _e=k.data[ee];(M&&_e<=w||!M&&_e>=w)&&L[ee]===0&&(L[ee]=L[G],U.queue([q[0]+dxs[W],q[1]+dys[W],_e]))}}}}return new RoiMap(k,L)}class RoiManager{constructor(h,p={}){this._image=h,this._options=p,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(h={}){let p=Object.assign({},this._options,h),m=fromMaxima.call(this._image,h);this._layers[p.label]=new RoiLayer(m,p)}fromPoints(h,p={}){let m=Object.assign({},this._options,p),w=fromPoints.call(this._image,h,p);return this._layers[m.label]=new RoiLayer(w,m),this}putMap(h,p={}){let m=new RoiMap(this._image,h),w=Object.assign({},this._options,p);return this._layers[w.label]=new RoiLayer(m,w),this}fromWaterShed(h={}){let p=Object.assign({},this._options,h),m=fromWaterShed.call(this._image,h);this._layers[p.label]=new RoiLayer(m,p)}fromMask(h,p={}){let m=Object.assign({},this._options,p),w=fromMask.call(this._image,h,p);return this._layers[m.label]=new RoiLayer(w,m),this}fromMaskConnectedComponentLabelingAlgorithm(h,p={}){let m=Object.assign({},this._options,p),w=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,h,p);return this._layers[m.label]=new RoiLayer(w,m),this}getMap(h={}){let p=Object.assign({},this._options,h);return this._assertLayerWithLabel(p.label),this._layers[p.label].roiMap}rowsInfo(h={}){return this.getMap(h).rowsInfo()}colsInfo(h={}){return this.getMap(h).rowsInfo()}getRoiIds(h={}){let p=this.getRois(h);if(p){let m=new Array(p.length);for(let w=0;w<p.length;w++)m[w]=p[w].id;return m}throw new Error("ROIs not found")}getRois(h={}){let{label:p=this._options.label,positive:m=!0,negative:w=!0,minSurface:M=0,maxSurface:k=Number.POSITIVE_INFINITY,minWidth:x=0,maxWidth:L=Number.POSITIVE_INFINITY,minHeight:B=0,maxHeight:$=Number.POSITIVE_INFINITY,minRatio:U=0,maxRatio:q=Number.POSITIVE_INFINITY}=h;if(!this._layers[p])throw new Error(`this Roi layer (${p}) does not exist`);const G=this._layers[p].roi,W=[];for(const te of G)(te.id<0&&w||te.id>0&&m)&&te.surface>=M&&te.surface<=k&&te.width>=x&&te.width<=L&&te.height>=B&&te.height<=$&&te.ratio>=U&&te.ratio<=q&&W.push(te);return W}getRoi(h,p={}){const{label:m=this._options.label}=p;if(!this._layers[m])throw new Error(`this Roi layer (${m}) does not exist`);const w=this._layers[m].roi.find(M=>M.id===h);if(!w)throw new Error(`found no Roi with id ${h}`);return w}getMasks(h={}){let p=this.getRois(h),m=new Array(p.length);for(let w=0;w<p.length;w++)m[w]=p[w].getMask(h);return m}getAnalysisMasks(h={}){const{analysisProperty:p}=h;let m=`${p}Mask`,w=this.getRois(h);return w.length===0||!w[0][m]?[]:w.map(M=>M[m])}getData(h={}){let p=Object.assign({},this._options,h);return this._assertLayerWithLabel(p.label),this._layers[p.label].roiMap.data}paint(h={}){let{labelProperty:p,analysisProperty:m}=h;this._painted||(this._painted=this._image.rgba8());let w=this.getMasks(h);if(p){const M=this.getRois(h);h.labels=M.map(B=>deepValue(B,p));const k=Math.max(...h.labels);let x=!1,L=!1;if(p.includes("surface")?x=!0:/(?:perimeter|min|max|external|width|height|length)/.test(p)&&(L=!0),isFinite(k)){let B="";if(h.unit!=="pixel"&&h.pixelSize&&(L||x)){B=x?`${h.unit}^2`:h.unit;let $=x?"m^2":"m",U=x?h.pixelSize**2:h.pixelSize;const q=Qty.swiftConverter($,B);h.labels=h.labels.map(G=>q(U*G))}k>50?h.labels=h.labels.map($=>Math.round($)+B):k>10?h.labels=h.labels.map($=>$.toFixed(1)+B):h.labels=h.labels.map($=>$.toFixed(2)+B)}h.labelsPosition=M.map(B=>[B.meanX,B.meanY])}if(this._painted.paintMasks(w,h),m){let M=this.getAnalysisMasks(h);this._painted.paintMasks(M,{color:h.analysisColor,alpha:h.analysisAlpha})}return this._painted}getMask(h={}){let p=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),m=this.getMasks(h);for(let w=0;w<m.length;w++){let M=m[w];for(let k=0;k<M.width;k++)for(let x=0;x<M.height;x++)M.getBitXY(k,x)&&p.setBitXY(k+M.position[0],x+M.position[1])}return p}resetPainted(h={}){const{image:p}=h;p?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(h={}){const p=this.getMap(h);return p.mergeRoi(h),this.putMap(p.data,h),this}mergeRois(h,p={}){if(!Array.isArray(h)||h.some(w=>!Number.isInteger(w)))throw new Error("Roi ids must be an array of integers");if(h.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(h).size!==h.length)throw new Error("Roi ids must be all different");h.forEach(w=>this.getRoi(w));const m=this.getMap(p);return m.mergeRois(h),this.putMap(m.data,p),this}findCorrespondingRoi(h,p={}){let m=this.getRois(p),w=[];for(let M=0;M<m.length;M++){let k=m[M],x=k.minX,L=k.minY,B=k.points,$=Math.sign(k.id),U=correspondingRoisInformation(x,L,B,h,$);w.push(U)}return w}_assertLayerWithLabel(h){if(!this._layers[h])throw new Error(`no layer with label ${h}`)}}function correspondingRoisInformation(d,h,p,m,w){let M={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let k=0;k<p.length;k++){let x=p[k],L=x[0],B=x[1],$=L+d+(B+h)*m.width,U=m.data[$];(U>0||U<0)&&(M.id.includes(U)?M.surface[M.id.indexOf(U)]+=1:(M.id.push(U),M.surface.push(1)))}for(let k=0;k<M.id.length;k++)Math.sign(M.id[k])===w?M.same+=M.surface[k]:M.opposite+=M.surface[k],M.roiSurfaceCovered[k]=M.surface[k]/p.length;return M.total=M.opposite+M.same,M}const objectToString$1=Object.prototype.toString;class Image$1{constructor(h,p,m,w){if(arguments.length===1?(w=h,{width:h,height:p,data:m}=w):m&&!m.length&&(w=m,{data:m}=w),h===void 0&&(h=1),p===void 0&&(p=1),w===void 0&&(w={}),typeof w!="object"||w===null)throw new TypeError("options must be an object");if(!Number.isInteger(h)||h<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(p)||p<=0)throw new RangeError("height must be a positive integer");const{kind:M=RGBA}=w;if(typeof M!="string")throw new TypeError("kind must be a string");const k=getKind(M),x=Object.assign({},w);for(const te in k)x[te]===void 0&&(x[te]=k[te]);verifyKindDefinition(x);const{components:L,bitDepth:B,colorModel:$}=x,U=x.alpha+0,q=h*p,G=L+U,W=B===32?Number.MAX_VALUE:2**B-1;if(m===void 0)m=createPixelArray(q,L,U,G,B,W);else{const te=getTheoreticalPixelArraySize(q,G,B);if(m.length!==te)throw new RangeError(`incorrect data size: ${m.length}. Should be ${te}`)}this.width=h,this.height=p,this.data=m,this.size=q,this.components=L,this.alpha=U,this.bitDepth=B,this.maxValue=W,this.colorModel=$,this.channels=G,this.meta=w.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:w.parent||null}),this.position=w.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(h){return objectToString$1.call(h)==="[object IJSImage]"}static fromCanvas(h){const m=h.getContext("2d").getImageData(0,0,h.width,h.height);return new Image$1(m.width,m.height,m.data)}static createFrom(h,p){const m=getImageParameters(h);return Object.assign(m,{parent:h,position:[0,0]},p),new Image$1(m)}getRoiManager(h){return new RoiManager(this,h)}clone(){const h=this.data.slice();return new Image$1(this.width,this.height,h,this)}apply(h){for(let p=0;p<this.height;p++)for(let m=0;m<this.width;m++){let w=(p*this.width+m)*this.channels;h.call(this,w)}}}setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$4(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function d(){this._listeners={}}d.prototype.on=function(p,m){if(this._listeners[p])throw new RangeError("there is already a listener for "+p);if(typeof m!="function")throw new TypeError("callback argument must be a function");this._listeners[p]=m},d.prototype._send=function(p,m,w){w===void 0?w=[]:Array.isArray(w)||(w=[w]),self.postMessage({id:p,data:m},w)},d.prototype._trigger=function(p,m){if(!this._listeners[p])throw new Error("event "+p+" is not defined");this._listeners[p].apply(null,m)};var h=new d;self.onmessage=function(p){switch(p.data.action){case"exec":p.data.args.unshift(function(m,w){h._send(p.data.id,m,w)}),h._trigger(p.data.event,p.data.args);break;case"ping":h._send(p.data.id,"pong");break;default:throw new Error("unexpected action: "+p.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function d(h,p){var m=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(p)+`);
`,"(",h,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(m)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(d,h){if(typeof d!="string"&&typeof d!="function")throw new TypeError("func argument must be a function");if(h===void 0&&(h={}),typeof h!="object"||h===null)throw new TypeError("options argument must be an object");this._workerCode=d.toString(),h.maxWorkers===void 0||h.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):h.maxWorkers>0?this._numWorkers=Math.min(h.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=h.timeout||0,this._terminateOnError=!!h.terminateOnError;var p=h.deps;typeof p=="string"&&(p=[p]),Array.isArray(p)||(p=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(p)}WorkerManager.prototype._init=function(d){for(var h=workerTemplate.newWorkerURL(this._workerCode,d),p=0;p<this._numWorkers;p++){var m=new Worker(h);m.onmessage=this._onmessage.bind(this,m),m.onerror=this._onerror.bind(this,m),m.running=!1,m.id=p,this._workers.set(m,null)}URL.revokeObjectURL(h)};WorkerManager.prototype._onerror=function(d,h){if(!this._terminated){this._working--,d.running=!1;var p=this._workers.get(d);p&&p[1](h.message),this._workers.set(d,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(d,h){if(!this._terminated){this._working--,d.running=!1;var p=this._workers.get(d);p&&p[0](h.data.data),this._workers.set(d,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var d of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!d.running)for(var h=0;h<this._waiting.length;h++){var p=this._waiting[h];if(!(typeof p[4]=="number"&&p[4]!==d.id)){this._waiting.splice(h,1),d.postMessage({action:"exec",event:p[0],args:p[1]},p[2]),d.running=!0,d.time=Date.now(),this._workers.set(d,p[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var d of this._workers)d[0].terminate(),d[1]&&d[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(d,h){if(this._terminated)throw new Error("Cannot post (terminated)");var p=[];for(var m of this._workers.keys())p.push(this.post(d,h,[],m.id));return Promise.all(p)};WorkerManager.prototype.post=function(d,h,p,m){h===void 0&&(h=[]),p===void 0&&(p=[]),Array.isArray(h)||(h=[h]),Array.isArray(p)||(p=[p]);var w=this;return new Promise(function(M,k){if(w._terminated)throw new Error("Cannot post (terminated)");w._waiting.push([d,h,p,[M,k],m]),w._exec()})};var src=WorkerManager;const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(d,h,p){h=Object.assign({},defaultOptions,h);const m=this.manager;return Array.isArray(d)?Promise.all(d.map(function(w){const M=runOnce(m,w,h);return typeof p=="function"&&M.then(p),M})):runOnce(m,d,h)}function runOnce(d,h,p){return d.post("data",[h,p]).then(function(m){for(let w in m)m[w]=new Image$1(m[w]);return m})}function work(){worker.on("data",function(d,h,p){h=new IJS(h);const m={},w=[],M=h.grey(),k=M.sobelFilter();G("sobel",k);const x=k.level().mask({threshold:p.threshold});G("mask",x);const L=k.getRoiManager();L.fromMask(x);const B=L.getMask(p.roi);G("realMask",B);const $=M.getPixelsGrid({sampling:p.sampling,mask:B}),U=h.getBackground($.xyS,$.zS,p.regression);G("background",U);const q=h.subtract(U);m.result=q,w.push(q.data.buffer),d(m,w);function G(W,te){p.include.includes(W)&&(m[W]=te,w.push(te.data.buffer))}})}const background={run,work};function extend$3(d){d.extendMethod("background",background)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(h){if(typeof h!="string")throw new TypeError("worker URL must be a string");this._url=h,this._deps[0]=h}static extendMethod(h,p){let m,w,M={};function k(...x){return m||(this.checkUrl(),w=this.url,m=new src(p.work,{deps:w}),M.manager=m),p.run.call(M,...x)}k.reset=function(){m&&(m.terminate(),m=new src(p.work,{deps:w}),M.manager=m)},Worker$1.prototype[h]=k}}extend$3(Worker$1);new Worker$1;var K0=.9996,E=.00669438,E2=Math.pow(E,2),E3=Math.pow(E,3),E_P2=E/(1-E),M1=1-E/4-3*E2/64-5*E3/256,M2=3*E/8+3*E2/32+45*E3/1024,M3=15*E2/256+45*E3/1024,M4=35*E3/3072,R$1=6378137,ZONE_LETTERS="CDEFGHJKLMNPQRSTUVWXX";function fromLatLon(d,h,p){if(d>84||d<-80)throw new RangeError("latitude out of range (must be between 80 deg S and 84 deg N)");if(h>180||h<-180)throw new RangeError("longitude out of range (must be between 180 deg W and 180 deg E)");var m=toRadians(d),w=Math.sin(m),M=Math.cos(m),k=Math.tan(m),x=Math.pow(k,2),L=Math.pow(k,4),B;p===void 0?B=latLonToZoneNumber(d,h):B=p;var $=latitudeToZoneLetter(d),U=toRadians(h),q=zoneNumberToCentralLongitude(B),G=toRadians(q),W=R$1/Math.sqrt(1-E*w*w),te=E_P2*M*M,oe=M*modAngle(U-G),ee=Math.pow(oe,2),_e=Math.pow(oe,3),se=Math.pow(oe,4),he=Math.pow(oe,5),ge=Math.pow(oe,6),Re=R$1*(M1*m-M2*Math.sin(2*m)+M3*Math.sin(4*m)-M4*Math.sin(6*m)),ve=K0*W*(oe+_e/6*(1-x+te)+he/120*(5-18*x+L+72*te-58*E_P2))+5e5,de=K0*(Re+W*k*(ee/2+se/24*(5-x+9*te+4*te*te)+ge/720*(61-58*x+L+600*te-330*E_P2)));return d<0&&(de+=1e7),{easting:ve,northing:de,zoneNum:B,zoneLetter:$}}function latitudeToZoneLetter(d){return-80<=d&&d<=84?ZONE_LETTERS[Math.floor((d+80)/8)]:null}function latLonToZoneNumber(d,h){if(56<=d&&d<64&&3<=h&&h<12)return 32;if(72<=d&&d<=84&&h>=0){if(h<9)return 31;if(h<21)return 33;if(h<33)return 35;if(h<42)return 37}return Math.floor((h+180)/6)+1}function zoneNumberToCentralLongitude(d){return(d-1)*6-180+3}function toRadians(d){return d*Math.PI/180}function modAngle(d){return(d+Math.PI)%(2*Math.PI)-Math.PI}function getTileInfo(d,h,p){let m={},w=Math.floor(p.getZoom()),M=40075016686e-3*Math.abs(Math.cos(h))/Math.pow(2,w),k=M/512,x=tilebelt.pointToTile(d,h,w);m.z=w,m.x=x[0],m.y=x[1],m.pointLng=d,m.pointLat=h,m.tileWidthInMeters=M,m.metersPerPixel=k,m.mapboxTileName=m.z+"-"+m.x+"-"+m.y,m.tile=[m.x,m.y,m.z],m.bbox=tilebelt.tileToBBOX(m.tile),m.polygon_bb=getTileGeoJsonBB(m.bbox);const L=new mapboxgl.LngLatBounds(m.bbox);m.bboxCT=L.getCenter(),m.bboxSW=L.getSouthWest(),m.bboxNE=L.getNorthEast(),m.bboxNW=L.getNorthWest(),m.bboxSE=L.getSouthEast(),m.originCoordinates=m.bboxNW;let B=converLatLngTotUtm(m.originCoordinates.lat,m.originCoordinates.lng);return m.projected=new mapboxgl.LngLat(m.originCoordinates.lng,m.originCoordinates.lat),m.epsg=getEpsg(m.originCoordinates.lat,m.originCoordinates.lng),m.OriginEasting=B.easting,m.OriginNorthing=B.northing,m.zoneLetter=B.zoneLetter,m.zoneNum=B.zoneNum,m.originLng=m.originCoordinates.lng,m.originLat=m.originCoordinates.lat,m.maxPngValue=65535,m.rgbFileName="terrain-rgb-"+m.mapboxTileName+".png",m.thirtyTwoFileName="thirtytwo-"+m.mapboxTileName+".png",m.tileInfoFileName="tile-info-"+m.mapboxTileName+".json",m.geoJsonFileName="geojson-"+m.mapboxTileName+".json",B=converLatLngTotUtm(m.pointLat,m.pointLng),m.pointNorthing=B.northing,m.pointEasting=B.easting,B=converLatLngTotUtm(m.bboxCT.lat,m.bboxCT.lng),m.ctNorthing=B.northing,m.ctEasting=B.easting,B=converLatLngTotUtm(m.bboxSW.lat,m.bboxSW.lng),m.swNorthing=B.northing,m.swEasting=B.easting,B=converLatLngTotUtm(m.bboxNE.lat,m.bboxNE.lng),m.neNorthing=B.northing,m.neEasting=B.easting,B=converLatLngTotUtm(m.bboxNW.lat,m.bboxNW.lng),m.nwNorthing=B.northing,m.nwEasting=B.easting,B=converLatLngTotUtm(m.bboxSE.lat,m.bboxSE.lng),m.seNorthing=B.northing,m.seEasting=B.easting,m}function getEpsg(d,h){let p=Math.round((183+h)/6),m=0;return d>0?m=32600+p:m=32700+p,m}function converLatLngTotUtm(d,h){return fromLatLon(d,h)}function convertGeoJsonCoordinatesToUTM(d){return d.forEach(h=>{let p=h.geometry.coordinates;traverseArray(p)}),d}function traverseArray(d){let h=0,p,m;d.forEach((w,M)=>{if(Array.isArray(w))traverseArray(w);else{if(h===0&&(p=w),h===1){m=w;let k=converLatLngTotUtm(m,p);d[0]=k.northing,d[1]=k.easting}h=h+1,h===2&&(h=0)}})}function getTileGeoJsonBB(d){let h=bboxPolygon(d);return{type:"Feature",geometry:{type:h.geometry.type,coordinates:h.geometry.coordinates}}}function getFeaturesFromBB(d,h){return h.swPt=d.project(h.bboxSW),h.nePt=d.project(h.bboxNE),h.nwPt=d.project(h.bboxNW),h.sePt=d.project(h.bboxSE),d.queryRenderedFeatures([h.swPt,h.nePt])}async function loadImageFromArray(d){return await Image$1.load(d)}function getHeightFromRgb(d,h,p){return-1e4+(d*256*256+h*256+p)*.1}function getHeightArray(d){let h=[],p=d.getPixelsArray();for(const m of p){let w=m[0],M=m[1],k=m[2],x=getHeightFromRgb(w,M,k);x=parseFloat(x),h.push(x)}return h}async function downloadTerrainRgb(d){return await(await fetch(d)).arrayBuffer()}async function unrealRemoteControl(d){const h={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)};return await(await fetch("http://localhost:30010/remote/object/call",h)).json()}async function getMapboxTerrainRgb(d,h,p){let m,w=await fileUtils.fileExists(d,h.rgbFileName),M;return w===!1?m=await downloadTerrainRgb(p):m=await fileUtils.readFileFromDisk(d,h.rgbFileName),idbKeyval.set("rgbImageArrayBuffer",m),M=await loadImageFromArray(m),M}function convertImage(d,h,p,m,w){return new Image$1(d,h,p,{kind:w,bitDepth:m})}function createHeightMapImage(d,h,p){let m={},w=getHeightArray(d);idbKeyval.set("decodedHeightArray",w);let M=convertImage(d.width,d.height,w,h,p);return m.minElevation=M.min[0],m.maxElevation=M.max[0],m.image=M,m.decodedHeightArray=w,m}var mapUtils={converLatLngTotUtm,getTileInfo,getFeaturesFromBB,getMapboxTerrainRgb,createHeightMapImage,loadImageFromArray,unrealRemoteControl,convertGeoJsonCoordinatesToUTM};function mitt(d){return{all:d=d||new Map,on:function(h,p){var m=d.get(h);m?m.push(p):d.set(h,[p])},off:function(h,p){var m=d.get(h);m&&(p?m.splice(m.indexOf(p)>>>0,1):d.set(h,[]))},emit:function(h,p){var m=d.get(h);m&&m.slice().map(function(w){w(p)}),(m=d.get("*"))&&m.slice().map(function(w){w(h,p)})}}}var emitter=mitt(),immutable=extend$2,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$2(){for(var d={},h=0;h<arguments.length;h++){var p=arguments[h];for(var m in p)hasOwnProperty.call(p,m)&&(d[m]=p[m])}return d}var fuzzy$1={exports:{}};(function(d,h){(function(){var p={};d.exports=p,p.simpleFilter=function(m,w){return w.filter(function(M){return p.test(m,M)})},p.test=function(m,w){return p.match(m,w)!==null},p.match=function(m,w,M){M=M||{};var k=0,x=[],L=w.length,B=0,$=0,U=M.pre||"",q=M.post||"",G=M.caseSensitive&&w||w.toLowerCase(),W;m=M.caseSensitive&&m||m.toLowerCase();for(var te=0;te<L;te++)W=w[te],G[te]===m[k]?(W=U+W+q,k+=1,$+=1+$):$=0,B+=$,x[x.length]=W;return k===m.length?(B=G===m?1/0:B,{rendered:x.join(""),score:B}):null},p.filter=function(m,w,M){return!w||w.length===0?[]:typeof m!="string"?w:(M=M||{},w.reduce(function(k,x,L,B){var $=x;M.extract&&($=M.extract(x));var U=p.match(m,$,M);return U!=null&&(k[k.length]={string:U.rendered,score:U.score,index:L,original:x}),k},[]).sort(function(k,x){var L=x.score-k.score;return L||k.index-x.index}))}})()})(fuzzy$1);var List$1=function(d){return this.component=d,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,d.el.parentNode.insertBefore(this.wrapper,d.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(d){this.items.push(d)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var d=0;d<this.items.length;d++)this.drawItem(this.items[d],this.active===d);this.show()};List$1.prototype.drawItem=function(d,h){var p=document.createElement("li"),m=document.createElement("a");h&&(p.className+=" active"),m.innerHTML=d.string,p.appendChild(m),this.element.appendChild(p),p.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),p.addEventListener("mouseup",function(){this.handleMouseUp.call(this,d)}.bind(this))};List$1.prototype.handleMouseUp=function(d){this.selectingListItem=!1,this.component.value(d.original),this.clear(),this.draw()};List$1.prototype.move=function(d){this.active=d,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(d){var h=document.createElement("li");h.innerHTML=d,this.element.appendChild(h),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzy$1.exports,List=list,Suggestions$1=function(d,h,p){return p=p||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},p),this.el=d,this.data=h||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(m){this.handleKeyUp(m.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(m){this.handleKeyDown(m)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(m){this.handlePaste(m)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(d){d===40||d===38||d===27||d===13||d===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(d){switch(d.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&d.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(d){if(d.clipboardData)this.handleInputChange(d.clipboardData.getData("Text"));else{var h=this;setTimeout(function(){h.handleInputChange(d.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(d){if(this.query=this.normalize(d),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(h){for(var p=0;p<h.length&&(this.list.add(h[p]),p!==this.options.limit-1);p++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(d){this.data=d,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(d){return d=d.toLowerCase(),d};Suggestions$1.prototype.match=function(d,h){return d.indexOf(h)>-1};Suggestions$1.prototype.value=function(d){if(this.selected=d,this.el.value=this.getItemValue(d),document.createEvent){var h=document.createEvent("HTMLEvents");h.initEvent("change",!0,!1),this.el.dispatchEvent(h)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(d){var h={pre:"<strong>",post:"</strong>",extract:function(m){return this.getItemValue(m)}.bind(this)},p;this.options.filter?(p=fuzzy.filter(this.query,this.data,h),p=p.map(function(m){return{original:m.original,string:this.render(m.original,m.string)}}.bind(this))):p=this.data.map(function(m){var w=this.render(m);return{original:m,string:w}}.bind(this)),d(p)};Suggestions$1.prototype.getItemValue=function(d){return d};Suggestions$1.prototype.render=function(d,h){if(h)return h;for(var p=d.original?this.getItemValue(d.original):this.getItemValue(d),m=this.normalize(p),w=m.lastIndexOf(this.query);w>-1;){var M=w+this.query.length;p=p.slice(0,w)+"<strong>"+p.slice(w,M)+"</strong>"+p.slice(M),w=m.slice(0,w).lastIndexOf(this.query)}return p};Suggestions$1.prototype.renderError=function(d){this.list.drawError(d)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window!="undefined"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$1(d,h,p){var m,w,M,k,x,L,B=0,$=!1,U=!1,q=!0;if(typeof d!="function")throw new TypeError(FUNC_ERROR_TEXT);h=toNumber(h)||0,isObject(p)&&($=!!p.leading,U="maxWait"in p,M=U?nativeMax(toNumber(p.maxWait)||0,h):M,q="trailing"in p?!!p.trailing:q);function G(Re){var ve=m,de=w;return m=w=void 0,B=Re,k=d.apply(de,ve),k}function W(Re){return B=Re,x=setTimeout(ee,h),$?G(Re):k}function te(Re){var ve=Re-L,de=Re-B,Se=h-ve;return U?nativeMin(Se,M-de):Se}function oe(Re){var ve=Re-L,de=Re-B;return L===void 0||ve>=h||ve<0||U&&de>=M}function ee(){var Re=now();if(oe(Re))return _e(Re);x=setTimeout(ee,te(Re))}function _e(Re){return x=void 0,q&&m?G(Re):(m=w=void 0,k)}function se(){x!==void 0&&clearTimeout(x),B=0,m=L=w=x=void 0}function he(){return x===void 0?k:_e(now())}function ge(){var Re=now(),ve=oe(Re);if(m=arguments,w=this,L=Re,ve){if(x===void 0)return W(L);if(U)return x=setTimeout(ee,h),G(L)}return x===void 0&&(x=setTimeout(ee,h)),k}return ge.cancel=se,ge.flush=he,ge}function isObject(d){var h=typeof d;return!!d&&(h=="object"||h=="function")}function isObjectLike(d){return!!d&&typeof d=="object"}function isSymbol(d){return typeof d=="symbol"||isObjectLike(d)&&objectToString.call(d)==symbolTag}function toNumber(d){if(typeof d=="number")return d;if(isSymbol(d))return NAN;if(isObject(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=isObject(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=d.replace(reTrim,"");var p=reIsBinary.test(d);return p||reIsOctal.test(d)?freeParseInt(d.slice(2),p?2:8):reIsBadHex.test(d)?NAN:+d}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function d(h,p,m){return Function.prototype.apply.call(h,p,m)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:ReflectOwnKeys=function(h){return Object.getOwnPropertyNames(h)};function ProcessEmitWarning(d){console&&console.warn&&console.warn(d)}var NumberIsNaN=Number.isNaN||function d(h){return h!==h};function EventEmitter$2(){EventEmitter$2.init.call(this)}events$1.exports=EventEmitter$2;events$1.exports.once=once;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(d){if(typeof d!="number"||d<0||NumberIsNaN(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");defaultMaxListeners=d}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function d(h){if(typeof h!="number"||h<0||NumberIsNaN(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this};function _getMaxListeners(d){return d._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:d._maxListeners}EventEmitter$2.prototype.getMaxListeners=function d(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function d(h){for(var p=[],m=1;m<arguments.length;m++)p.push(arguments[m]);var w=h==="error",M=this._events;if(M!==void 0)w=w&&M.error===void 0;else if(!w)return!1;if(w){var k;if(p.length>0&&(k=p[0]),k instanceof Error)throw k;var x=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw x.context=k,x}var L=M[h];if(L===void 0)return!1;if(typeof L=="function")ReflectApply(L,this,p);else for(var B=L.length,$=arrayClone(L,B),m=0;m<B;++m)ReflectApply($[m],this,p);return!0};function _addListener(d,h,p,m){var w,M,k;if(checkListener(p),M=d._events,M===void 0?(M=d._events=Object.create(null),d._eventsCount=0):(M.newListener!==void 0&&(d.emit("newListener",h,p.listener?p.listener:p),M=d._events),k=M[h]),k===void 0)k=M[h]=p,++d._eventsCount;else if(typeof k=="function"?k=M[h]=m?[p,k]:[k,p]:m?k.unshift(p):k.push(p),w=_getMaxListeners(d),w>0&&k.length>w&&!k.warned){k.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.emitter=d,x.type=h,x.count=k.length,ProcessEmitWarning(x)}return d}EventEmitter$2.prototype.addListener=function d(h,p){return _addListener(this,h,p,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function d(h,p){return _addListener(this,h,p,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(d,h,p){var m={fired:!1,wrapFn:void 0,target:d,type:h,listener:p},w=onceWrapper.bind(m);return w.listener=p,m.wrapFn=w,w}EventEmitter$2.prototype.once=function d(h,p){return checkListener(p),this.on(h,_onceWrap(this,h,p)),this};EventEmitter$2.prototype.prependOnceListener=function d(h,p){return checkListener(p),this.prependListener(h,_onceWrap(this,h,p)),this};EventEmitter$2.prototype.removeListener=function d(h,p){var m,w,M,k,x;if(checkListener(p),w=this._events,w===void 0)return this;if(m=w[h],m===void 0)return this;if(m===p||m.listener===p)--this._eventsCount===0?this._events=Object.create(null):(delete w[h],w.removeListener&&this.emit("removeListener",h,m.listener||p));else if(typeof m!="function"){for(M=-1,k=m.length-1;k>=0;k--)if(m[k]===p||m[k].listener===p){x=m[k].listener,M=k;break}if(M<0)return this;M===0?m.shift():spliceOne(m,M),m.length===1&&(w[h]=m[0]),w.removeListener!==void 0&&this.emit("removeListener",h,x||p)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function d(h){var p,m,w;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[h]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[h]),this;if(arguments.length===0){var M=Object.keys(m),k;for(w=0;w<M.length;++w)k=M[w],k!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(p=m[h],typeof p=="function")this.removeListener(h,p);else if(p!==void 0)for(w=p.length-1;w>=0;w--)this.removeListener(h,p[w]);return this};function _listeners(d,h,p){var m=d._events;if(m===void 0)return[];var w=m[h];return w===void 0?[]:typeof w=="function"?p?[w.listener||w]:[w]:p?unwrapListeners(w):arrayClone(w,w.length)}EventEmitter$2.prototype.listeners=function d(h){return _listeners(this,h,!0)};EventEmitter$2.prototype.rawListeners=function d(h){return _listeners(this,h,!1)};EventEmitter$2.listenerCount=function(d,h){return typeof d.listenerCount=="function"?d.listenerCount(h):listenerCount.call(d,h)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(d){var h=this._events;if(h!==void 0){var p=h[d];if(typeof p=="function")return 1;if(p!==void 0)return p.length}return 0}EventEmitter$2.prototype.eventNames=function d(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(d,h){for(var p=new Array(h),m=0;m<h;++m)p[m]=d[m];return p}function spliceOne(d,h){for(;h+1<d.length;h++)d[h]=d[h+1];d.pop()}function unwrapListeners(d){for(var h=new Array(d.length),p=0;p<h.length;++p)h[p]=d[p].listener||d[p];return h}function once(d,h){return new Promise(function(p,m){function w(k){d.removeListener(h,M),m(k)}function M(){typeof d.removeListener=="function"&&d.removeListener("error",w),p([].slice.call(arguments))}eventTargetAgnosticAddListener(d,h,M,{once:!0}),h!=="error"&&addErrorHandlerIfEventEmitter(d,w,{once:!0})})}function addErrorHandlerIfEventEmitter(d,h,p){typeof d.on=="function"&&eventTargetAgnosticAddListener(d,"error",h,p)}function eventTargetAgnosticAddListener(d,h,p,m){if(typeof d.on=="function")m.once?d.once(h,p):d.on(h,p);else if(typeof d.addEventListener=="function")d.addEventListener(h,function w(M){m.once&&d.removeEventListener(h,w),p(M)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam(d){var h=d.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return h?{key:h[1],value:h[2]}:null}function parseLink(d){var h=d.match(/<?([^>]*)>(.*)/);if(!h)return null;var p=h[1],m=h[2].split(";"),w=null,M=m.reduce(function(k,x){var L=parseParam(x);return L?L.key==="rel"?(w||(w=L.value),k):(k[L.key]=L.value,k):k},{});return w?{url:p,rel:w,params:M}:null}function parseLinkHeader$1(d){return d?d.split(/,\s*</).reduce(function(h,p){var m=parseLink(p);if(!m)return h;var w=m.rel.split(/\s+/);return w.forEach(function(M){h[M]||(h[M]={url:m.url,params:m.params})}),h},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(d,h){this.request=d,this.headers=h.headers,this.rawBody=h.body,this.statusCode=h.statusCode;try{this.body=JSON.parse(h.body||"{}")}catch{this.body=h.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function d(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function d(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$3=constants$4;function MapiError$1(d){var h=d.type||constants$3.ERROR_HTTP,p;if(d.body)try{p=JSON.parse(d.body)}catch{p=d.body}else p=null;var m=d.message||null;m||(typeof p=="string"?m=p:p&&typeof p.message=="string"?m=p.message:h===constants$3.ERROR_REQUEST_ABORTED&&(m="Request aborted")),this.message=m,this.type=h,this.statusCode=d.statusCode||null,this.request=d.request,this.body=p}var mapiError=MapiError$1;function parseSingleHeader(d){var h=d.indexOf(":"),p=d.substring(0,h).trim().toLowerCase(),m=d.substring(h+1).trim();return{name:p,value:m}}function parseHeaders$1(d){var h={};return d&&d.trim().split(/[\r|\n]+/).forEach(function(p){var m=parseSingleHeader(p);h[m.name]=m.value}),h}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants$2=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(d){var h=requestsUnderway[d.id];!h||(h.abort(),delete requestsUnderway[d.id])}function createResponse(d,h){return new MapiResponse(d,{body:h.response,headers:parseHeaders(h.getAllResponseHeaders()),statusCode:h.status})}function normalizeBrowserProgressEvent(d){var h=d.total,p=d.loaded,m=100*p/h;return{total:h,transferred:p,percent:m}}function sendRequestXhr(d,h){return new Promise(function(p,m){h.onprogress=function(k){d.emitter.emit(constants$2.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(k))};var w=d.file;w&&(h.upload.onprogress=function(k){d.emitter.emit(constants$2.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(k))}),h.onerror=function(k){m(k)},h.onabort=function(){var k=new MapiError({request:d,type:constants$2.ERROR_REQUEST_ABORTED});m(k)},h.onload=function(){if(delete requestsUnderway[d.id],h.status<200||h.status>=400){var k=new MapiError({request:d,body:h.response,statusCode:h.status});m(k);return}p(h)};var M=d.body;typeof M=="string"?h.send(M):M?h.send(JSON.stringify(M)):w?h.send(w):h.send(),requestsUnderway[d.id]=h}).then(function(p){return createResponse(d,p)})}function createRequestXhr(d,h){var p=d.url(h),m=new window.XMLHttpRequest;return m.open(d.method,p),Object.keys(d.headers).forEach(function(w){m.setRequestHeader(w,d.headers[w])}),m}function browserSend(d){return Promise.resolve().then(function(){var h=createRequestXhr(d,d.client.accessToken);return sendRequestXhr(d,h)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(d,h){(function(p){var m=h,w=d&&d.exports==m&&d,M=typeof commonjsGlobal=="object"&&commonjsGlobal;(M.global===M||M.window===M)&&(p=M);var k=function(W){this.message=W};k.prototype=new Error,k.prototype.name="InvalidCharacterError";var x=function(W){throw new k(W)},L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=/[\t\n\f\r ]/g,$=function(W){W=String(W).replace(B,"");var te=W.length;te%4==0&&(W=W.replace(/==?$/,""),te=W.length),(te%4==1||/[^+a-zA-Z0-9/]/.test(W))&&x("Invalid character: the string to be decoded is not correctly encoded.");for(var oe=0,ee,_e,se="",he=-1;++he<te;)_e=L.indexOf(W.charAt(he)),ee=oe%4?ee*64+_e:_e,oe++%4&&(se+=String.fromCharCode(255&ee>>(-2*oe&6)));return se},U=function(W){W=String(W),/[^\0-\xFF]/.test(W)&&x("The string to be encoded contains characters outside of the Latin1 range.");for(var te=W.length%3,oe="",ee=-1,_e,se,he,ge,Re=W.length-te;++ee<Re;)_e=W.charCodeAt(ee)<<16,se=W.charCodeAt(++ee)<<8,he=W.charCodeAt(++ee),ge=_e+se+he,oe+=L.charAt(ge>>18&63)+L.charAt(ge>>12&63)+L.charAt(ge>>6&63)+L.charAt(ge&63);return te==2?(_e=W.charCodeAt(ee)<<8,se=W.charCodeAt(++ee),ge=_e+se,oe+=L.charAt(ge>>10)+L.charAt(ge>>4&63)+L.charAt(ge<<2&63)+"="):te==1&&(ge=W.charCodeAt(ee),oe+=L.charAt(ge>>2)+L.charAt(ge<<4&63)+"=="),oe},q={encode:U,decode:$,version:"0.1.0"};if(m&&!m.nodeType)if(w)w.exports=q;else for(var G in q)q.hasOwnProperty(G)&&(m[G]=q[G]);else p.base64=q})(commonjsGlobal)})(base64$1,base64$1.exports);var base64=base64$1.exports,tokenCache={};function parseToken$2(d){if(tokenCache[d])return tokenCache[d];var h=d.split("."),p=h[0],m=h[1];if(!m)throw new Error("Invalid token");var w=parsePaylod(m),M={usage:p,user:w.u};return has(w,"a")&&(M.authorization=w.a),has(w,"exp")&&(M.expires=w.exp*1e3),has(w,"iat")&&(M.created=w.iat*1e3),has(w,"scopes")&&(M.scopes=w.scopes),has(w,"client")&&(M.client=w.client),has(w,"ll")&&(M.lastLogin=w.ll),has(w,"iu")&&(M.impersonator=w.iu),tokenCache[d]=M,M}function parsePaylod(d){try{return JSON.parse(base64.decode(d))}catch{throw new Error("Invalid token")}}function has(d,h){return Object.prototype.hasOwnProperty.call(d,h)}var parseMapboxToken=parseToken$2,eventemitter3={exports:{}};(function(d){var h=Object.prototype.hasOwnProperty,p="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(p=!1));function w(L,B,$){this.fn=L,this.context=B,this.once=$||!1}function M(L,B,$,U,q){if(typeof $!="function")throw new TypeError("The listener must be a function");var G=new w($,U||L,q),W=p?p+B:B;return L._events[W]?L._events[W].fn?L._events[W]=[L._events[W],G]:L._events[W].push(G):(L._events[W]=G,L._eventsCount++),L}function k(L,B){--L._eventsCount===0?L._events=new m:delete L._events[B]}function x(){this._events=new m,this._eventsCount=0}x.prototype.eventNames=function(){var B=[],$,U;if(this._eventsCount===0)return B;for(U in $=this._events)h.call($,U)&&B.push(p?U.slice(1):U);return Object.getOwnPropertySymbols?B.concat(Object.getOwnPropertySymbols($)):B},x.prototype.listeners=function(B){var $=p?p+B:B,U=this._events[$];if(!U)return[];if(U.fn)return[U.fn];for(var q=0,G=U.length,W=new Array(G);q<G;q++)W[q]=U[q].fn;return W},x.prototype.listenerCount=function(B){var $=p?p+B:B,U=this._events[$];return U?U.fn?1:U.length:0},x.prototype.emit=function(B,$,U,q,G,W){var te=p?p+B:B;if(!this._events[te])return!1;var oe=this._events[te],ee=arguments.length,_e,se;if(oe.fn){switch(oe.once&&this.removeListener(B,oe.fn,void 0,!0),ee){case 1:return oe.fn.call(oe.context),!0;case 2:return oe.fn.call(oe.context,$),!0;case 3:return oe.fn.call(oe.context,$,U),!0;case 4:return oe.fn.call(oe.context,$,U,q),!0;case 5:return oe.fn.call(oe.context,$,U,q,G),!0;case 6:return oe.fn.call(oe.context,$,U,q,G,W),!0}for(se=1,_e=new Array(ee-1);se<ee;se++)_e[se-1]=arguments[se];oe.fn.apply(oe.context,_e)}else{var he=oe.length,ge;for(se=0;se<he;se++)switch(oe[se].once&&this.removeListener(B,oe[se].fn,void 0,!0),ee){case 1:oe[se].fn.call(oe[se].context);break;case 2:oe[se].fn.call(oe[se].context,$);break;case 3:oe[se].fn.call(oe[se].context,$,U);break;case 4:oe[se].fn.call(oe[se].context,$,U,q);break;default:if(!_e)for(ge=1,_e=new Array(ee-1);ge<ee;ge++)_e[ge-1]=arguments[ge];oe[se].fn.apply(oe[se].context,_e)}}return!0},x.prototype.on=function(B,$,U){return M(this,B,$,U,!1)},x.prototype.once=function(B,$,U){return M(this,B,$,U,!0)},x.prototype.removeListener=function(B,$,U,q){var G=p?p+B:B;if(!this._events[G])return this;if(!$)return k(this,G),this;var W=this._events[G];if(W.fn)W.fn===$&&(!q||W.once)&&(!U||W.context===U)&&k(this,G);else{for(var te=0,oe=[],ee=W.length;te<ee;te++)(W[te].fn!==$||q&&!W[te].once||U&&W[te].context!==U)&&oe.push(W[te]);oe.length?this._events[G]=oe.length===1?oe[0]:oe:k(this,G)}return this},x.prototype.removeAllListeners=function(B){var $;return B?($=p?p+B:B,this._events[$]&&k(this,$)):(this._events=new m,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=p,x.EventEmitter=x,d.exports=x})(eventemitter3);function encodeArray(d){return d.map(encodeURIComponent).join(",")}function encodeValue(d){return Array.isArray(d)?encodeArray(d):encodeURIComponent(String(d))}function appendQueryParam(d,h,p){if(p===!1||p===null)return d;var m=/\?/.test(d)?"&":"?",w=encodeURIComponent(h);return p!==void 0&&p!==""&&p!==!0&&(w+="="+encodeValue(p)),""+d+m+w}function appendQueryObject(d,h){if(!h)return d;var p=d;return Object.keys(h).forEach(function(m){var w=h[m];w!==void 0&&(Array.isArray(w)&&(w=w.filter(function(M){return M!=null}).join(",")),p=appendQueryParam(p,m,w))}),p}function prependOrigin(d,h){if(!h||d.slice(0,4)==="http")return d;var p=d[0]==="/"?"":"/";return""+h.replace(/\/$/,"")+p+d}function interpolateRouteParams(d,h){return h?d.replace(/\/:([a-zA-Z0-9]+)/g,function(p,m){var w=h[m];if(w===void 0)throw new Error("Unspecified route parameter "+m);var M=encodeValue(w);return"/"+M}):d}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},parseToken$1=parseMapboxToken,xtend$3=immutable,EventEmitter$1=eventemitter3.exports,urlUtils=urlUtils$1,constants$1=constants$4,requestId=1;function MapiRequest$1(d,h){if(!d)throw new Error("MapiRequest requires a client");if(!h||!h.path||!h.method)throw new Error("MapiRequest requires an options object with path and method properties");var p={};h.body&&(p["content-type"]="application/json");var m=xtend$3(p,h.headers),w=Object.keys(m).reduce(function(M,k){return M[k.toLowerCase()]=m[k],M},{});this.id=requestId++,this._options=h,this.emitter=new EventEmitter$1,this.client=d,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=h.path,this.method=h.method,this.origin=h.origin||d.origin,this.query=h.query||{},this.params=h.params||{},this.body=h.body||null,this.file=h.file||null,this.encoding=h.encoding||"utf8",this.sendFileAs=h.sendFileAs||null,this.headers=w}MapiRequest$1.prototype.url=function d(h){var p=urlUtils.prependOrigin(this.path,this.origin);p=urlUtils.appendQueryObject(p,this.query);var m=this.params,w=h==null?this.client.accessToken:h;if(w){p=urlUtils.appendQueryParam(p,"access_token",w);var M=parseToken$1(w).user;m=xtend$3({ownerId:M},m)}return p=urlUtils.interpolateRouteParams(p,m),p};MapiRequest$1.prototype.send=function d(){var h=this;if(h.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return h.sent=!0,h.client.sendRequest(h).then(function(p){return h.response=p,h.emitter.emit(constants$1.EVENT_RESPONSE,p),p},function(p){throw h.error=p,h.emitter.emit(constants$1.EVENT_ERROR,p),p})};MapiRequest$1.prototype.abort=function d(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function d(h){var p=this;function m(k){function x(){delete p._nextPageRequest;var L=k.nextPage();L&&(p._nextPageRequest=L,M(L))}h(null,k,x)}function w(k){h(k,null,function(){})}function M(k){k.send().then(m,w)}M(this)};MapiRequest$1.prototype.clone=function d(){return this._extend()};MapiRequest$1.prototype._extend=function d(h){var p=xtend$3(this._options,h);return new MapiRequest$1(this.client,p)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants=constants$4;function MapiClient$2(d){if(!d||!d.accessToken)throw new Error("Cannot create a client without an access token");parseToken(d.accessToken),this.accessToken=d.accessToken,this.origin=d.origin||constants.API_ORIGIN}MapiClient$2.prototype.createRequest=function d(h){return new MapiRequest(this,h)};var mapiClient=MapiClient$2,browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(d){MapiClient$1.call(this,d)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(d){return new BrowserClient(d)}var browserClient=createBrowserClient,client=browserClient,mapboxSdk=client,toString=Object.prototype.toString,isPlainObj=function(d){var h;return toString.call(d)==="[object Object]"&&(h=Object.getPrototypeOf(d),h===null||h===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$2=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$3={};v$3.assert=function(d,h){return h=h||{},function(p){var m=validate(d,p);if(!!m){var w=processMessage(m,h);throw h.apiName&&(w=h.apiName+": "+w),new Error(w)}}};v$3.shape=function d(h){var p=objectEntries(h);return function(w){var M=validate(v$3.plainObject,w);if(M)return M;for(var k,x,L=[],B=0;B<p.length;B++)k=p[B].key,x=p[B].value,M=validate(x,w[k]),M&&L.push([k].concat(M));return L.length<2?L[0]:function($){L=L.map(function(G){var W=G[0],te=processMessage(G,$).split(`
`).join(NEWLINE_INDENT);return"- "+W+": "+te});var U=$.path.join("."),q=U===DEFAULT_ERROR_PATH?"":" of "+U;return"The following properties"+q+" have invalid values:"+NEWLINE_INDENT+L.join(NEWLINE_INDENT)}}};v$3.strictShape=function d(h){var p=v$3.shape(h);return function(w){var M=p(w);if(M)return M;var k=Object.keys(w).reduce(function(x,L){return h[L]===void 0&&x.push(L),x},[]);if(k.length!==0)return function(){return"The following keys are invalid: "+k.join(", ")}}};v$3.arrayOf=function d(h){return createArrayValidator(h)};v$3.tuple=function d(){var h=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(h)};function createArrayValidator(d){var h=Array.isArray(d),p=function(m){return h?d[m]:d};return function(w){var M=validate(v$3.plainArray,w);if(M)return M;if(h&&w.length!==d.length)return"an array with "+d.length+" items";for(var k=0;k<w.length;k++)if(M=validate(p(k),w[k]),M)return[k].concat(M)}}v$3.required=function d(h){function p(m){return m==null?function(w){return formatErrorMessage(w,isArrayCulprit(w.path)?"cannot be undefined/null.":"is required.")}:h.apply(this,arguments)}return p.__required=!0,p};v$3.oneOfType=function d(){var h=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(m){var w=h.map(function(M){return validate(M,m)}).filter(Boolean);if(w.length===h.length)return w.every(function(M){return M.length===1&&typeof M[0]=="string"})?orList(w.map(function(M){return M[0]})):w.reduce(function(M,k){return k.length>M.length?k:M})}};v$3.equal=function d(h){return function(m){if(m!==h)return JSON.stringify(h)}};v$3.oneOf=function d(){var h=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),p=h.map(function(m){return v$3.equal(m)});return v$3.oneOfType.apply(this,p)};v$3.range=function d(h){var p=h[0],m=h[1];return function(M){var k=validate(v$3.number,M);if(k||M<p||M>m)return"number between "+p+" & "+m+" (inclusive)"}};v$3.any=function d(){};v$3.boolean=function d(h){if(typeof h!="boolean")return"boolean"};v$3.number=function d(h){if(typeof h!="number")return"number"};v$3.plainArray=function d(h){if(!Array.isArray(h))return"array"};v$3.plainObject=function d(h){if(!isPlainObject(h))return"object"};v$3.string=function d(h){if(typeof h!="string")return"string"};v$3.func=function d(h){if(typeof h!="function")return"function"};function validate(d,h){if(!(h==null&&!d.hasOwnProperty("__required"))){var p=d(h);if(p)return Array.isArray(p)?p:[p]}}function processMessage(d,h){var p=d.length,m=d[p-1],w=d.slice(0,p-1);return w.length===0&&(w=[DEFAULT_ERROR_PATH]),h=xtend$2(h,{path:w}),typeof m=="function"?m(h):formatErrorMessage(h,prettifyResult(m))}function orList(d){return d.length<2?d[0]:d.length===2?d.join(" or "):d.slice(0,-1).join(", ")+", or "+d.slice(-1)}function prettifyResult(d){return"must be "+addArticle(d)+"."}function addArticle(d){return/^an? /.test(d)?d:/^[aeiou]/i.test(d)?"an "+d:/^[a-z]/i.test(d)?"a "+d:d}function formatErrorMessage(d,h){var p=isArrayCulprit(d.path),m=d.path.join(".")+" "+h,w=p?"Item at position ":"";return w+m}function isArrayCulprit(d){return typeof d[d.length-1]=="number"||typeof d[0]=="number"}function objectEntries(d){return Object.keys(d||{}).map(function(h){return{key:h,value:d[h]}})}v$3.validate=validate;v$3.processMessage=processMessage;var lib$1=v$3,xtend$1=immutable,v$2=lib$1;function file(d){if(typeof window!="undefined")return d instanceof commonjsGlobal.Blob||d instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof d=="string"||d.pipe!==void 0))return"Filename or Readable stream"}function assertShape(d,h){return v$2.assert(v$2.strictShape(d),h)}function date(d){var h="date";if(typeof d=="boolean")return h;try{var p=new Date(d);if(p.getTime&&isNaN(p.getTime()))return h}catch{return h}}function coordinates(d){return v$2.tuple(v$2.number,v$2.number)(d)}var validator=xtend$1(v$2,{file,date,coordinates,assertShape});function pick$1(d,h){var p=function(m,w){return h.indexOf(m)!==-1&&w!==void 0};return typeof h=="function"&&(p=h),Object.keys(d).filter(function(m){return p(m,d[m])}).reduce(function(m,w){return m[w]=d[w],m},{})}var pick_1=pick$1;function objectMap$1(d,h){return Object.keys(d).reduce(function(p,m){return p[m]=h(m,d[m]),p},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(d){return objectMap(d,function(h,p){return typeof p=="boolean"?JSON.stringify(p):p})}var stringifyBooleans$1=stringifyBoolean,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(d){return function(h){var p;MapiClient.prototype.isPrototypeOf(h)?p=h:p=createClient(h);var m=Object.create(d);return m.client=p,m}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v$1=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(d){v$1.assertShape({query:v$1.required(v$1.string),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),proximity:v$1.oneOf(v$1.coordinates,"ip"),types:v$1.arrayOf(v$1.oneOf(featureTypes)),autocomplete:v$1.boolean,bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),routing:v$1.boolean,fuzzyMatch:v$1.boolean,worldview:v$1.string})(d),d.mode=d.mode||"mapbox.places";var h=stringifyBooleans(xtend({country:d.countries},pick(d,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(d,["mode","query"]),query:h})};Geocoding.reverseGeocode=function(d){v$1.assertShape({query:v$1.required(v$1.coordinates),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),types:v$1.arrayOf(v$1.oneOf(featureTypes)),bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),reverseMode:v$1.oneOf("distance","score"),routing:v$1.boolean,worldview:v$1.string})(d),d.mode=d.mode||"mapbox.places";var h=stringifyBooleans(xtend({country:d.countries},pick(d,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(d,["mode","query"]),query:h})};var geocoding=createServiceFactory(Geocoding),crypto=self.crypto||self.msCrypto,url="-_",i$1=36;for(;i$1--;)url+=i$1.toString(36);i$1=36;for(;i$1---10;)url+=i$1.toString(36).toUpperCase();var index_browser=function(d){var h="",p=crypto.getRandomValues(new Uint8Array(d||21));for(i$1=d||21;i$1--;)h+=url[p[i$1]&63];return h},nanoid=index_browser;function MapboxEventManager$1(d){this.origin=d.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=d.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=d,this.send=this.send.bind(this),this.countries=d.countries?d.countries.split(","):null,this.types=d.types?d.types.split(","):null,this.bbox=d.bbox?d.bbox:null,this.language=d.language?d.language.split(","):null,this.limit=d.limit?+d.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(d),this.eventQueue=new Array,this.flushInterval=d.flushInterval||1e3,this.maxQueueSize=d.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(d,h){var p=this.getSelectedIndex(d,h),m=this.getEventPayload("search.select",h);if(m.resultIndex=p,m.resultPlaceName=d.place_name,m.resultId=d.id,!(p===this.lastSentIndex&&m.queryString===this.lastSentInput||p==-1)&&(this.lastSentIndex=p,this.lastSentInput=m.queryString,!!m.queryString))return this.push(m)},start:function(d){var h=this.getEventPayload("search.start",d);if(!!h.queryString)return this.push(h)},keyevent:function(d,h){if(!!d.key&&!(d.metaKey||[9,27,37,39,13,38,40].indexOf(d.keyCode)!==-1)){var p=this.getEventPayload("search.keystroke",h);if(p.lastAction=d.key,!!p.queryString)return this.push(p)}},send:function(d,h){if(!this.enableEventLogging)return h?h():void 0;var p=this.getRequestOptions(d);this.request(p,function(m){if(m)return this.handleError(m,h);if(h)return h()}.bind(this))},getRequestOptions:function(d){Array.isArray(d)||(d=[d]);var h={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)};return h},getEventPayload:function(d,h){var p;h.options.proximity?p=[h.options.proximity.longitude,h.options.proximity.latitude]:p=null;var m=h._map?h._map.getZoom():void 0,w={event:d,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:h.options.autocomplete,fuzzyMatch:h.options.fuzzyMatch,proximity:p,limit:h.options.limit,routing:h.options.routing,worldview:h.options.worldview,mapZoom:m,keyboardLocale:this.locale};return d==="search.select"?w.queryString=h.inputString:d!="search.select"&&h._inputEl?w.queryString=h._inputEl.value:w.queryString=h.inputString,w},request:function(d,h){var p=new XMLHttpRequest;p.onreadystatechange=function(){if(this.readyState==4)return this.status==204?h(null):h(this.statusText)},p.open(d.method,d.host+"/"+d.path,!0);for(var m in d.headers){var w=d.headers[m];p.setRequestHeader(m,w)}p.send(d.body)},handleError:function(d,h){if(h)return h(d)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(d,h){if(!!h._typeahead){var p=h._typeahead.data,m=d.id,w=p.map(function(k){return k.id}),M=w.indexOf(m);return M}},shouldEnableLogging:function(d){return!(d.enableEventLogging===!1||d.origin&&d.origin.indexOf("api.mapbox.com")==-1||d.localGeocoder||d.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(d,h){this.eventQueue.push(d),(this.eventQueue.length>=this.maxQueueSize||h)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},localization$1={placeholder},subtag$1={exports:{}};(function(d){(function(h,p,m){d.exports?d.exports=m():h[p]=m()})(commonjsGlobal,"subtag",function(){var h="",p=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function m(L){return L.match(p)||[]}function w(L){return m(L).filter(function(B,$){return B&&$})}function M(L){return L=m(L),{language:L[1]||h,extlang:L[2]||h,script:L[3]||h,region:L[4]||h}}function k(L,B,$){Object.defineProperty(L,B,{value:$,enumerable:!0})}function x(L,B,$){function U(q){return m(q)[L]||h}k(U,"pattern",B),k(M,$,U)}return x(1,/^[a-zA-Z]{2,3}$/,"language"),x(2,/^[a-zA-Z]{3}$/,"extlang"),x(3,/^[a-zA-Z]{4}$/,"script"),x(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),k(M,"split",w),M})})(subtag$1);var Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter=events$1.exports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding,MapboxEventManager=events,localization=localization$1,subtag=subtag$1.exports;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function MapboxGeocoder(d){this._eventEmitter=new EventEmitter,this.options=extend({},this.options,d),this.inputString="",this.fresh=!0,this.lastSelected=null}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(d){return d.place_name},render:function(d){var h=d.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+h[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+h.splice(1,h.length).join(",")+"</div></div>"}},addTo:function(d){function h(p,m){if(!document.body.contains(m))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const w=p.onAdd();m.appendChild(w)}if(d._controlContainer)d.addControl(this);else if(d instanceof HTMLElement)h(this,d);else if(typeof d=="string"){const p=document.querySelectorAll(d);if(p.length===0)throw new Error("Element ",d,"not found.");if(p.length>1)throw new Error("Geocoder can only be added to a single html element");h(this,p[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(d){if(d&&typeof d!="string"&&(this._map=d),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var h=this.container=document.createElement("div");h.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var p=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(M){this.eventManager.keyevent(M,this)}.bind(this));var m=document.createElement("div");m.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var w=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(w),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),m.appendChild(this._clearEl),m.appendChild(this._loadingEl),h.appendChild(p),h.appendChild(this._inputEl),h.appendChild(m),this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),h},createIcon:function(d,h){var p=document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+d),p.setAttribute("viewBox","0 0 18 18"),p.setAttribute("xml:space","preserve"),p.setAttribute("width",18),p.setAttribute("height",18),"innerHTML"in p)p.innerHTML=h;else{var m=document.createElement("div");m.innerHTML="<svg>"+h.valueOf().toString()+"</svg>";var w=m.firstChild,M=w.firstChild;p.appendChild(M)}return p},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(d){var h=(d.clipboardData||window.clipboardData).getData("text");h.length>=this.options.minLength&&this._geocode(h)},_onKeyDown:function(d){var h=27,p=9;if(d.keyCode===h&&this.options.clearAndBlurOnEsc)return this._clear(d),this._inputEl.blur();var m=d.target&&d.target.shadowRoot?d.target.shadowRoot.activeElement:d.target,w=m?m.value:"";if(!w)return this.fresh=!0,d.keyCode!==p&&this.clear(d),this._clearEl.style.display="none";d.metaKey||[p,h,37,39,13,38,40].indexOf(d.keyCode)!==-1||m.value.length>=this.options.minLength&&this._geocode(m.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(d){this.options.clearOnBlur&&this._clearOnBlur(d),this.options.collapsed&&this._collapse()},_onChange:function(){var d=this._typeahead.selected;if(d&&JSON.stringify(d)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var h;if(d.properties&&exceptions[d.properties.short_code])h=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[d.properties.short_code].bbox,h);else if(d.bbox){var p=d.bbox;h=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[p[0],p[1]],[p[2],p[3]]],h)}else{var m={zoom:this.options.zoom};h=extend({},m,this.options.flyTo),d.center?h.center=d.center:d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&(h.center=d.geometry.coordinates),this._map&&this._map.flyTo(h)}}this.options.marker&&this._mapboxgl&&this._handleMarker(d),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(d),this._eventEmitter.emit("result",{result:d}),this.eventManager.select(d,this)}},_requestType:function(d,h){var p;const m=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return d.localGeocoderOnly?p=GEOCODE_REQUEST_TYPE.LOCAL:d.reverseGeocode&&m.test(h)?p=GEOCODE_REQUEST_TYPE.REVERSE:p=GEOCODE_REQUEST_TYPE.FORWARD,p},_setupConfig:function(d,h){const p=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],m=/[\s,]+/;var w=this,M=p.reduce(function(x,L){if(w.options[L]===void 0||w.options[L]===null)return x;["countries","types","language"].indexOf(L)>-1?x[L]=w.options[L].split(m):x[L]=w.options[L];const B=typeof w.options[L].longitude=="number"&&typeof w.options[L].latitude=="number";if(L==="proximity"&&B){const $=w.options[L].longitude,U=w.options[L].latitude;x[L]=[$,U]}return x},{});switch(d){case GEOCODE_REQUEST_TYPE.REVERSE:{var k=h.split(m).map(function(x){return parseFloat(x,10)}).reverse();M.types&&M.types[0],M=extend(M,{query:k,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(x){x in M&&delete M[x]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(h)&&(h=h.replace(/,/g," ")),M=extend(M,{query:h});break}return M},_geocode:function(d){this.inputString=d,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:d});const h=this._requestType(this.options,d),p=this._setupConfig(h,d);var m;switch(h){case GEOCODE_REQUEST_TYPE.LOCAL:m=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:m=this.geocoderService.forwardGeocode(p).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:m=this.geocoderService.reverseGeocode(p).send();break}var w=this.options.localGeocoder?this.options.localGeocoder(d)||[]:[],M=[],k=null;return m.catch(function(x){k=x}.bind(this)).then(function(x){this._loadingEl.style.display="none";var L={};return x?x.statusCode=="200"&&(L=x.body,L.request=x.request,L.headers=x.headers):L={type:"FeatureCollection",features:[]},L.config=p,this.fresh&&(this.eventManager.start(this),this.fresh=!1),L.features=L.features?w.concat(L.features):w,this.options.externalGeocoder?(M=this.options.externalGeocoder(d,L.features)||[],M.then(function(B){return L.features=L.features?B.concat(L.features):B,L},function(){return L})):L}.bind(this)).then(function(x){if(k)throw k;this.options.filter&&x.features.length&&(x.features=x.features.filter(this.options.filter)),x.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",x),this._typeahead.update(x.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",x))}.bind(this)).catch(function(x){this._loadingEl.style.display="none",w.length&&this.options.localGeocoder||M.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(w)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:w}),this._eventEmitter.emit("error",{error:x})}.bind(this)),m},_clear:function(d){d&&d.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(d){this._clear(d),this._inputEl.focus()},_clearOnBlur:function(d){var h=this;d.relatedTarget&&h._clear(d)},_onQueryResult:function(d){var h=d.body;if(!!h.features.length){var p=h.features[0];this._typeahead.selected=p,this._inputEl.value=p.place_name,this._onChange()}},_updateProximity:function(){if(!!this._map)if(this._map.getZoom()>9){var d=this._map.getCenter().wrap();this.setProximity({longitude:d.lng,latitude:d.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(d){return this._geocode(d).then(this._onQueryResult),this},_renderError:function(){var d="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(d)},_renderNoResults:function(){var d="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(d)},_renderMessage:function(d){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(d)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var d=this.options.language.split(",")[0],h=subtag.language(d),p=localization.placeholder[h];if(p)return p}return"Search"},setInput:function(d){return this._inputEl.value=d,this._typeahead.selected=null,this._typeahead.clear(),d.length>=this.options.minLength&&this._geocode(d),this},setProximity:function(d){return this.options.proximity=d,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(d){return d&&typeof d=="function"&&(this._typeahead.render=d),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(d){var h=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=d||this.options.language||h,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(d){return this.options.zoom=d,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(d){return this.options.flyTo=d,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(d){return this.placeholder=d||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(d){return this.options.bbox=d,this},getCountries:function(){return this.options.countries},setCountries:function(d){return this.options.countries=d,this},getTypes:function(){return this.options.types},setTypes:function(d){return this.options.types=d,this},getMinLength:function(){return this.options.minLength},setMinLength:function(d){return this.options.minLength=d,this._typeahead&&(this._typeahead.options.minLength=d),this},getLimit:function(){return this.options.limit},setLimit:function(d){return this.options.limit=d,this._typeahead&&(this._typeahead.options.limit=d),this},getFilter:function(){return this.options.filter},setFilter:function(d){return this.options.filter=d,this},setOrigin:function(d){return this.options.origin=d,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(d){return this.options.autocomplete=d,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(d){return this.options.fuzzyMatch=d,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(d){return this.options.routing=d,this},getRouting:function(){return this.options.routing},setWorldview:function(d){return this.options.worldview=d,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(d){if(!!this._map){this._removeMarker();var h={color:"#4668F2"},p=extend({},h,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(p),d.center?this.mapMarker.setLngLat(d.center).addTo(this._map):d.geometry&&d.geometry.type&&d.geometry.type==="Point"&&d.geometry.coordinates&&this.mapMarker.setLngLat(d.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(d,h){return this._eventEmitter.on(d,h),this},off:function(d,h){return this._eventEmitter.removeListener(d,h),this.eventManager.remove(),this}};var lib=MapboxGeocoder,mapboxMapViewer_vue_vue_type_style_index_0_lang="";let geocoder;const _sfc_main$4={name:"mapbox-map-viewer",setup(){return{dirHandle:ref(""),style_url:ref(""),access_token:ref(""),mapbox_raster_png_dem:ref(""),mapbox_api_url:ref(""),mapbox_rgb_image_url:ref(""),map:ref(""),threedview:ref(!1),layers:ref(["hillshading","bounding_box","undersea-features-lines","undersea-features-points","undersea-features-points-label","10m-bathymetry-81bsvj"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Undersea Lines",value:"undersea-features-lines"},{label:"Undersea Points",value:"undersea-features-points"},{label:"Undersea Labels",value:"undersea-features-points-label"},{label:"Depth",value:"10m-bathymetry-81bsvj"},{label:"Satellite",value:"satellite"},{label:"3D",value:"3d"}]}},mounted(){},methods:{async changeLayers(d){for(const h of this.layer_type)d.includes(h.value)?h.value!=="3d"?this.map.setLayoutProperty(h.value,"visibility","visible"):this.map.setTerrain({source:"mapbox-3d",exaggeration:1.5}):h.value!=="3d"?this.map.setLayoutProperty(h.value,"visibility","none"):this.map.setTerrain(null)},loadMapSourcesLayers(d){d.addSource("mapbox_terrain_dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),d.addSource("satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:512}),d.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}}),d.addLayer({id:"hillshading",source:"mapbox_terrain_dem",type:"hillshade"}),d.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),d.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),d.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),d.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),d.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),d.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),d.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),d.addSource("mapbox-3d",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),d.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon")},async loadMapboxMap(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.mapbox_api_url=await idbKeyval.get("mapbox_api_url"),this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem");let d=this,h=new mapboxgl.Map({container:"map",trackResize:!0,style:d.style_url,center:[-121.7598,46.876],zoom:9,doubleClickZoom:!0,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=h;const p=function(k){const x=k.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!x)return null;function L(q,G){return{center:[q,G],geometry:{type:"Point",coordinates:[q,G]},place_name:"Lat: "+G+" Lng: "+q,place_type:["coordinate"],properties:{},type:"Feature"}}const B=Number(x[1]),$=Number(x[2]),U=[];return(B<-90||B>90)&&U.push(L(B,$)),($<-90||$>90)&&U.push(L($,B)),U.length===0&&(U.push(L(B,$)),U.push(L($,B))),U};geocoder=new lib({accessToken:this.access_token,mapboxgl,localGeocoder:p,zoom:10,placeholder:"Try: -40, 170 or  Name",reverseGeocode:!0}),h.addControl(geocoder),h.addControl(new mapboxgl.FullscreenControl({})),h.addControl(new mapboxgl.NavigationControl);const m=100,w=25;function M(k){return k*(2-k)}h.on("style.load",()=>{const k=()=>{h.isStyleLoaded()?d.loadMapSourcesLayers(h):setTimeout(k,200)};k()}),h.on("load",function(){h.getCanvas().focus(),h.getCanvas().addEventListener("keydown",k=>{k.preventDefault(),k.which===87?h.panBy([0,-m],{easing:M}):k.which===83?h.panBy([0,m],{easing:M}):k.which===65?h.easeTo({bearing:h.getBearing()-w,easing:M}):k.which===68&&h.easeTo({bearing:h.getBearing()+w,easing:M})},!0)}),h.on("error",k=>{console.error(k)}),h.on("click",async function(k){let x=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(x,!0)===!1){console.error(`User did not grant permission to '${x.name}'`);return}let L=k.lngLat.lng,B=k.lngLat.lat;console.log(B+","+L);let $=mapUtils.getTileInfo(L,B,h);idbKeyval.set("tile_info",$),await d.geoCodeReverse($),h.getSource("bounding_box_source").setData($.polygon_bb),h.setPaintProperty("bounding_box","fill-opacity",.45),d.mapbox_rgb_image_url=d.mapbox_api_url+d.mapbox_raster_png_dem+`/${$.z}/${$.x}/${$.y}@2x.pngraw?access_token=`+d.access_token;let U=await mapUtils.getMapboxTerrainRgb(x,$,d.mapbox_rgb_image_url),q=await U.toBuffer();await idbKeyval.set("rgb_image_buffer",q),await fileUtils.writeFileToDisk(x,$.rgbFileName,q);let G=mapUtils.createHeightMapImage(U,32,"GREY");if(await fileUtils.fileExists(x,$.thirtyTwoFileName)===!1){let te=await G.image.toBuffer();await fileUtils.writeFileToDisk(x,$.thirtyTwoFileName,te)}emitter.emit("updatePreviewImage",{dir_handle:x,tile_info:$,preview_image_info:G,map:h})}),h.on("mousemove",k=>{h.getCanvas().style.cursor="pointer";const x=h.queryRenderedFeatures(k.point);for(const L of x)if(Object.keys(L.type).length>0&&Object.keys(L.properties).length>0){let B=L.properties;L.layer,B.DEPTH}})},resizeMap(){this.map.resize()},async geoCodeReverse(d){geocoding({accessToken:mapboxgl.accessToken}).reverseGeocode({query:[d.pointLng,d.pointLat]}).send().then(function(p){if(p&&p.body&&p.body.features){d.address=p.body.features[0].place_name;let m=p.body.features[0].context;for(let w of m){let M=w.id;switch(M.substring(0,M.indexOf("."))){case"neighborhood":d.neighborhood=w.text;break;case"postcode":d.postcode=w.text;break;case"locality":d.locality=w.text;break;case"place":d.place=w.text;break;case"district":d.district=w.text;break;case"region":d.region=w.text;break;case"country":d.country=w.text;break}}}})}}},_hoisted_1$4={id:"map"},_hoisted_2$4={class:"row no-wrap q-pa-md"},_hoisted_3$3={class:"column"},_hoisted_4$3=createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1);function _sfc_render$3(d,h,p,m,w,M){const k=resolveComponent("q-option-group"),x=resolveComponent("q-menu"),L=resolveComponent("q-btn"),B=resolveComponent("q-toolbar");return openBlock(),createElementBlock("div",_hoisted_1$4,[createVNode(B,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(L,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(x,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("div",_hoisted_3$3,[_hoisted_4$3,createVNode(k,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:m.layer_type,type:"toggle",modelValue:m.layers,"onUpdate:modelValue":[h[0]||(h[0]=$=>m.layers=$),M.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1})]),_:1})])}var MapboxMapViewer=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]);let gdalWorker=new Worker("gdalWorker.js");const _sfc_main$3={name:"SideNav",setup(){const d=useQuasar();return{alert:ref(!1),isDisabled:ref(!0),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"4033x4033",value:4033},{label:"2017x2017",value:2017},{label:"1009x1009",value:1009},{label:"512x512-Downloaded-Size",value:512},{label:"505x505",value:505}],url:ref("thirtytwo-9-82-180.png"),tile_info:ref(""),dirHandle:ref(""),preview_image_info:ref(""),rgb_image:ref(""),map:null,data:null,bbinfoalert:ref(!1),exportType:ref("unreal"),landscapeName:ref(""),qt:d,otherOptionsModel:ref(["zrange"]),alertMsg:ref(""),otherOptions:[{label:"Zrange-sea level=0",value:"zrange"}],exportOptions:[{label:"Unreal",value:"unreal"},{label:"Normalize",value:"normalize"},{label:"None",value:"none"}]}},async mounted(){(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(this.isDisabled=!1),emitter.on("updatePreviewImage",d=>{this.data=d,this.updatePreviewImage()}),gdalWorker.onmessage=async d=>{await this.saveImage(d.data)}},methods:{adjustedZscale(){let d=this.getUnrealZScale(this.preview_image_info.maxElevation),h=32767;return this.otherOptionsModel.includes("zrange")?(this.tile_info.startZRange=h,this.tile_info.zscale=(h/d).toFixed(3)):(this.tile_info.startZRange=0,this.tile_info.zscale=d.toFixed(3)),this.tile_info.zscale},otherOptionsModelChange(d){this.otherOptionsModel=d,this.adjustedZscale()},showBBInfo(){this.tile_info?this.bbinfoalert=!0:this.alert=!0},async sendToUnreal(){let d=this.tile_info.sixteenFileName,h=await idbKeyval.get("dirHandle");if(fileUtils.verifyPermission(h,!0)===!1){console.error(`User did not grant permission to '${h.name}'`);return}if(await fileUtils.fileExists(h,d))if(this.tile_info){console.log("sending"),this.qt.loading.show(),this.tile_info.landscapeName=this.landscapeName;let m="Mapbox_BP";m="Mapbox_BP_C_2";let w={objectPath:"/Game/Maps/MapboxBridgeExample.MapboxBridgeExample:PersistentLevel."+m,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:this.tile_info.landscapeName,LandscapeSize:this.tile_info.resolution.toString(),TileHeightmapFileName:this.tile_info.sixteenFileName,TileGeojsonFileName:this.tile_info.geoJsonFileName,TileInfoFileName:this.tile_info.tileInfoFileName,OriginLng:this.tile_info.originLng.toString(),OriginLat:this.tile_info.originLat.toString(),Epsg:this.tile_info.epsg.toString(),OriginNorthing:this.tile_info.OriginNorthing.toString(),OriginEasting:this.tile_info.OriginEasting.toString(),PointNorthing:this.tile_info.pointNorthing.toString(),PointEasting:this.tile_info.pointEasting.toString()}},M=await mapUtils.unrealRemoteControl(w);console.log(M),this.qt.loading.hide()}else this.alert=!0;else this.alertMsg="Please download heightmap first",this.alert=!0},async saveImage(d){let h=await idbKeyval.get("dirHandle"),p=new Blob([d],{type:"image/png"});await fileUtils.writeFileToDisk(h,this.tile_info.sixteenFileName,p),this.qt.loading.hide()},updateStats(){this.preview_image_info.maxElevation!==""?(this.tile_info.MaxElevation=this.preview_image_info.maxElevation,this.tile_info.MinElevation=this.preview_image_info.minElevation,this.tile_info.minmax=this.tile_info.MinElevation.toFixed(3)+" / "+this.tile_info.MaxElevation.toFixed(3),this.tile_info.elevation_range=(this.tile_info.MaxElevation-this.tile_info.MinElevation).toFixed(3),this.tile_info.tileWidthInMeters=this.tile_info.tileWidthInMeters.toFixed(3),this.tile_info.metersPerPixel=this.tile_info.metersPerPixel.toFixed(3),this.tile_info.zscale=this.adjustedZscale()):this.tile_info.minmax=""},getUnrealZScale(d){return d*100*.001953125},async writeFiles(d){let h=await idbKeyval.get("dirHandle");await fileUtils.writeFileToDisk(h,this.tile_info.sixteenFileName,d);let p=mapUtils.getFeaturesFromBB(this.map,this.tile_info),m=JSON.stringify(p),w=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(h,m),await fileUtils.writeFileToDisk(h,this.tile_info.tileInfoFileName,w)},async updatePreviewImage(){this.preview_image_info=await this.data.preview_image_info,this.tile_info=this.data.tile_info,this.map=this.data.map;let d=await this.preview_image_info.image.toBlob();const h=URL.createObjectURL(d);this.url=h,this.updateStats(this.tile_info)},async createSixteenHeightMap(){if(this.tile_info.resolution=this.unrealLandscape.value,this.tile_info.geoJsonFileName="geojson-"+this.tile_info.mapboxTileName+".json",this.tile_info.tileInfoFileName="tile-info-"+this.tile_info.mapboxTileName+".json",this.tile_info.sixteenFileName="sixteen-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".png",this.tile_info){this.qt.loading.show();let d=await idbKeyval.get("dirHandle");if(fileUtils.verifyPermission(d,!0)===!1){console.error(`User did not grant permission to '${d.name}'`);return}if(fileUtils.fileExists(d,this.tile_info.thirtytwoFile)){let p=await idbKeyval.get("rgb_image_buffer"),m=await mapUtils.loadImageFromArray(p),w=mapUtils.createHeightMapImage(m,16,"GREY"),M=w.image,k=parseInt(w.minElevation).toString(),x=parseInt(w.maxElevation).toString(),L=await M.toBuffer();this.tile_info.resampleSize=this.unrealLandscape.value.toString(),this.tile_info.resizeMethod="lanczos";let B=1*this.tile_info.resampleSize*this.tile_info.metersPerPixel,$=1*this.tile_info.resampleSize*this.tile_info.metersPerPixel;this.tile_info.xTransform=(this.tile_info.originLng+B).toFixed(4),this.tile_info.yTransform=(this.tile_info.originLat-$).toFixed(4),this.tile_info.exportType=this.exportType;let U=mapUtils.converLatLngTotUtm(this.tile_info.originLat,this.tile_info.originLng);switch(this.tile_info.OriginNorthing=U.northing,this.tile_info.OriginEasting=U.easting,this.tile_info.exportType){case"unreal":let oe=["-ot","UInt16","-of","PNG","-scale",k,x,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod],ee=new File([L],"heightmap.png",{type:"image/png",lastModified:Date.now()}),_e=new DataTransfer;_e.items.add(ee);let se=_e.files,he={};he.files=se,he.translateOptions=oe,gdalWorker.postMessage(he);break;case"normalize":M=M.level(),await fileUtils.writeFileToDisk(d,this.tile_info.sixteenFileName,M.toBuffer()),this.qt.loading.hide();break;case"none":await fileUtils.writeFileToDisk(d,this.tile_info.sixteenFileName,M.toBuffer()),this.qt.loading.hide();break}let q=mapUtils.getFeaturesFromBB(this.map,this.tile_info),G=mapUtils.convertGeoJsonCoordinatesToUTM(q),W=JSON.stringify(G),te=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(d,this.tile_info.geoJsonFileName,W),await fileUtils.writeFileToDisk(d,this.tile_info.tileInfoFileName,te)}else this.alertMsg="Please download file first",this.alert=!0}else this.alert=!0}}},_hoisted_1$3=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$3={class:"row justify-start q-pa-none q-ma-none"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_7$1=createTextVNode("Export Type:"),_hoisted_8$1={class:"row justify-around q-pt-none q-mt-sm"},_hoisted_9={class:"row justify-betweenq-pt-none q-mt-xs"},_hoisted_10=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Coordinates for Unreal LandscapeGen Plugin")],-1),_hoisted_11=createBaseVNode("div",{class:"text-h6"},"Max Latitude:",-1),_hoisted_12=createBaseVNode("div",{class:"text-h6"},"Max Longitude:",-1),_hoisted_13=createBaseVNode("div",{class:"text-h6"}," Min Latitude:",-1),_hoisted_14=createBaseVNode("div",{class:"text-h6"}," Min Longitude:",-1),_hoisted_15=createBaseVNode("div",{class:"text-h6"},"Zoom:",-1),_hoisted_16=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lat:",-1),_hoisted_17=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lng:",-1),_hoisted_18=createBaseVNode("div",{class:"text-h6"},"Mouse Point Northing:",-1),_hoisted_19=createBaseVNode("div",{class:"text-h6"},"Mouse Point Easting:",-1),_hoisted_20=createBaseVNode("div",{class:"text-h6"},"Center Northing:",-1),_hoisted_21=createBaseVNode("div",{class:"text-h6"},"Center Easting:",-1),_hoisted_22=createBaseVNode("div",{class:"text-h6"},"swNorthing:",-1),_hoisted_23=createBaseVNode("div",{class:"text-h6"},"swEasting:",-1),_hoisted_24=createBaseVNode("div",{class:"text-h6"},"neNorthing:",-1),_hoisted_25=createBaseVNode("div",{class:"text-h6"},"neEasting:",-1),_hoisted_26=createBaseVNode("div",{class:"text-h6"},"nwNorthing:",-1),_hoisted_27=createBaseVNode("div",{class:"text-h6"},"nwEasting:",-1),_hoisted_28=createBaseVNode("div",{class:"text-h6"},"seNorthing:",-1),_hoisted_29=createBaseVNode("div",{class:"text-h6"},"seEasting:",-1),_hoisted_30=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$2(d,h,p,m,w,M){const k=resolveComponent("q-img"),x=resolveComponent("q-field"),L=resolveComponent("q-item-label"),B=resolveComponent("q-option-group"),$=resolveComponent("q-select"),U=resolveComponent("q-input"),q=resolveComponent("q-btn"),G=resolveComponent("q-card-section"),W=resolveComponent("q-card-actions"),te=resolveComponent("q-card"),oe=resolveComponent("q-dialog"),ee=resolveDirective("close-popup");return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$3,createVNode(k,{src:m.url,height:"150px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$2,[createVNode(x,{dense:"",class:"text-weight-bolder q-pt-none q-mt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(this.tile_info.minmax),1)]),_:1}),createVNode(x,{class:"q-pt-none q-mt-xs",dense:"",label:"Tile width in meters","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$1,toDisplayString(this.tile_info.tileWidthInMeters),1)]),_:1}),createVNode(x,{class:"q-pt-none q-mt-xs",dense:"",label:"Unreal Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_6$1,toDisplayString(this.tile_info.zscale),1)]),_:1}),createVNode(L,{class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_7$1]),_:1}),createVNode(B,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:m.exportOptions,type:"radio",modelValue:m.exportType,"onUpdate:modelValue":h[0]||(h[0]=_e=>m.exportType=_e)},null,8,["options","modelValue"]),createVNode(B,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:m.otherOptions,"onUpdate:modelValue":[M.otherOptionsModelChange,h[1]||(h[1]=_e=>m.otherOptionsModel=_e)],type:"checkbox",modelValue:m.otherOptionsModel},null,8,["options","onUpdate:modelValue","modelValue"]),createVNode($,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:m.unrealLandscape,"onUpdate:modelValue":h[2]||(h[2]=_e=>m.unrealLandscape=_e),options:m.landscapeSize},null,8,["modelValue","options"])])]),createVNode(x,{class:"q-pt-none q-mt-xs",dense:"",label:"Landscape Name (Optional)",hint:"Enter Unique Landscape Name"},{default:withCtx(()=>[createVNode(U,{modelValue:m.landscapeName,"onUpdate:modelValue":h[3]||(h[3]=_e=>m.landscapeName=_e)},null,8,["modelValue"])]),_:1}),createBaseVNode("div",_hoisted_8$1,[createVNode(q,{onClick:M.showBBInfo,dense:"",color:"orange","no-caps":"",label:"Show Bounding Box Info"},null,8,["onClick"])]),createBaseVNode("div",_hoisted_9,[createVNode(q,{onClick:M.createSixteenHeightMap,dense:"",color:"primary","no-caps":"",label:"Download HeightMap"},null,8,["onClick"]),createVNode(q,{onClick:M.sendToUnreal,disabled:m.isDisabled,dense:"",color:"green",class:"q-ml-xs","no-caps":"",label:"Send To Unreal"},null,8,["onClick","disabled"])]),createVNode(oe,{modelValue:m.bbinfoalert,"onUpdate:modelValue":h[4]||(h[4]=_e=>m.bbinfoalert=_e)},{default:withCtx(()=>[createVNode(te,null,{default:withCtx(()=>[createVNode(G,null,{default:withCtx(()=>[_hoisted_10]),_:1}),createVNode(G,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_11,createTextVNode(" "+toDisplayString(m.tile_info.bbox[3])+" ",1),_hoisted_12,createTextVNode(" "+toDisplayString(this.tile_info.bbox[0])+" ",1),_hoisted_13,createTextVNode(" "+toDisplayString(m.tile_info.bbox[1])+" ",1),_hoisted_14,createTextVNode(" "+toDisplayString(m.tile_info.bbox[2])+" ",1),_hoisted_15,createTextVNode(" "+toDisplayString(m.tile_info.z)+" ",1),_hoisted_16,createTextVNode(" "+toDisplayString(m.tile_info.pointLat)+" ",1),_hoisted_17,createTextVNode(" "+toDisplayString(m.tile_info.pointLng)+" ",1),_hoisted_18,createTextVNode(" "+toDisplayString(m.tile_info.pointNorthing)+" ",1),_hoisted_19,createTextVNode(" "+toDisplayString(m.tile_info.pointEasting)+" ",1),_hoisted_20,createTextVNode(" "+toDisplayString(m.tile_info.ctNorthing)+" ",1),_hoisted_21,createTextVNode(" "+toDisplayString(m.tile_info.ctEasting)+" ",1),_hoisted_22,createTextVNode(" "+toDisplayString(m.tile_info.swNorthing)+" ",1),_hoisted_23,createTextVNode(" "+toDisplayString(m.tile_info.swEasting)+" ",1),_hoisted_24,createTextVNode(" "+toDisplayString(m.tile_info.neNorthing)+" ",1),_hoisted_25,createTextVNode(" "+toDisplayString(m.tile_info.neEasting)+" ",1),_hoisted_26,createTextVNode(" "+toDisplayString(m.tile_info.nwNorthing)+" ",1),_hoisted_27,createTextVNode(" "+toDisplayString(m.tile_info.nwEasting)+" ",1),_hoisted_28,createTextVNode(" "+toDisplayString(m.tile_info.seNorthing)+" ",1),_hoisted_29,createTextVNode(" "+toDisplayString(m.tile_info.seEasting),1)]),_:1}),createVNode(W,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(q,{flat:"",label:"OK",color:"primary"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(oe,{modelValue:m.alert,"onUpdate:modelValue":h[5]||(h[5]=_e=>m.alert=_e)},{default:withCtx(()=>[createVNode(te,null,{default:withCtx(()=>[createVNode(G,null,{default:withCtx(()=>[_hoisted_30]),_:1}),createVNode(G,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(m.alertMsg),1)]),_:1}),createVNode(W,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(q,{flat:"",label:"OK",color:"primary"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var SideNav=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]);const _sfc_main$2={props:{},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$2=createBaseVNode("div",null,[createBaseVNode("div",{class:"text-weight-bold"},"Help Section")],-1),_hoisted_2$2=createBaseVNode("div",{class:""},"TODO:",-1);function _sfc_render$1(d,h,p,m,w,M){const k=resolveComponent("q-space"),x=resolveComponent("q-btn"),L=resolveComponent("q-card-section"),B=resolveComponent("q-separator"),$=resolveComponent("q-card-actions"),U=resolveComponent("q-card"),q=resolveComponent("q-dialog"),G=resolveDirective("close-popup");return openBlock(),createBlock(q,{class:"dialog-plugin",ref:"dialog",onHide:M.onDialogHide},{default:withCtx(()=>[createVNode(U,{style:{width:"600px",height:"600px"}},{default:withCtx(()=>[createVNode(L,{class:"row items-center no-wrap",style:{height:"50px"}},{default:withCtx(()=>[_hoisted_1$2,createVNode(k),withDirectives(createVNode(x,{flat:"",round:"",icon:"close"},null,512),[[G]])]),_:1}),createVNode(B),_hoisted_2$2,createVNode($,{class:"absolute-bottom",align:"right"},{default:withCtx(()=>[createVNode(x,{color:"primary",label:"OK",onClick:M.onOKClick},null,8,["onClick"]),createVNode(x,{color:"primary",label:"Cancel",onClick:M.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var Help=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);try{self["workbox:window:6.4.1"]&&_()}catch(d){}function n(d,h){return new Promise(function(p){var m=new MessageChannel;m.port1.onmessage=function(w){p(w.data)},d.postMessage(h,[m.port2])})}function t(d,h){for(var p=0;p<h.length;p++){var m=h[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(d,m.key,m)}}function r(d,h){(h==null||h>d.length)&&(h=d.length);for(var p=0,m=new Array(h);p<h;p++)m[p]=d[p];return m}function e(d,h){var p;if(typeof Symbol=="undefined"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=function(w,M){if(w){if(typeof w=="string")return r(w,M);var k=Object.prototype.toString.call(w).slice(8,-1);return k==="Object"&&w.constructor&&(k=w.constructor.name),k==="Map"||k==="Set"?Array.from(w):k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?r(w,M):void 0}}(d))||h&&d&&typeof d.length=="number"){p&&(d=p);var m=0;return function(){return m>=d.length?{done:!0}:{done:!1,value:d[m++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(p=d[Symbol.iterator]()).next.bind(p)}try{self["workbox:core:6.4.1"]&&_()}catch(d){}var i=function(){var d=this;this.promise=new Promise(function(h,p){d.resolve=h,d.reject=p})};function o(d,h){var p=location.href;return new URL(d,p).href===new URL(h,p).href}var u=function(d,h){this.type=d,Object.assign(this,h)};function a(d,h,p){return p?h?h(d):d:(d&&d.then||(d=Promise.resolve(d)),h?d.then(h):d)}function c(){}var f={type:"SKIP_WAITING"};function s(d,h){if(!h)return d&&d.then?d.then(c):Promise.resolve()}var v=function(d){var h,p;function m(x,L){var B,$;return L===void 0&&(L={}),(B=d.call(this)||this).nn={},B.tn=0,B.rn=new i,B.en=new i,B.on=new i,B.un=0,B.an=new Set,B.cn=function(){var U=B.fn,q=U.installing;B.tn>0||!o(q.scriptURL,B.sn.toString())||performance.now()>B.un+6e4?(B.vn=q,U.removeEventListener("updatefound",B.cn)):(B.hn=q,B.an.add(q),B.rn.resolve(q)),++B.tn,q.addEventListener("statechange",B.ln)},B.ln=function(U){var q=B.fn,G=U.target,W=G.state,te=G===B.vn,oe={sw:G,isExternal:te,originalEvent:U};!te&&B.mn&&(oe.isUpdate=!0),B.dispatchEvent(new u(W,oe)),W==="installed"?B.wn=self.setTimeout(function(){W==="installed"&&q.waiting===G&&B.dispatchEvent(new u("waiting",oe))},200):W==="activating"&&(clearTimeout(B.wn),te||B.en.resolve(G))},B.dn=function(U){var q=B.hn,G=q!==navigator.serviceWorker.controller;B.dispatchEvent(new u("controlling",{isExternal:G,originalEvent:U,sw:q,isUpdate:B.mn})),G||B.on.resolve(q)},B.gn=($=function(U){var q=U.data,G=U.ports,W=U.source;return a(B.getSW(),function(){B.an.has(W)&&B.dispatchEvent(new u("message",{data:q,originalEvent:U,ports:G,sw:W}))})},function(){for(var U=[],q=0;q<arguments.length;q++)U[q]=arguments[q];try{return Promise.resolve($.apply(this,U))}catch(G){return Promise.reject(G)}}),B.sn=x,B.nn=L,navigator.serviceWorker.addEventListener("message",B.gn),B}p=d,(h=m).prototype=Object.create(p.prototype),h.prototype.constructor=h,h.__proto__=p;var w,M,k=m.prototype;return k.register=function(x){var L=(x===void 0?{}:x).immediate,B=L!==void 0&&L;try{var $=this;return function(U,q){var G=U();return G&&G.then?G.then(q):q(G)}(function(){if(!B&&document.readyState!=="complete")return s(new Promise(function(U){return window.addEventListener("load",U)}))},function(){return $.mn=Boolean(navigator.serviceWorker.controller),$.yn=$.pn(),a($.bn(),function(U){$.fn=U,$.yn&&($.hn=$.yn,$.en.resolve($.yn),$.on.resolve($.yn),$.yn.addEventListener("statechange",$.ln,{once:!0}));var q=$.fn.waiting;return q&&o(q.scriptURL,$.sn.toString())&&($.hn=q,Promise.resolve().then(function(){$.dispatchEvent(new u("waiting",{sw:q,wasWaitingBeforeRegister:!0}))}).then(function(){})),$.hn&&($.rn.resolve($.hn),$.an.add($.hn)),$.fn.addEventListener("updatefound",$.cn),navigator.serviceWorker.addEventListener("controllerchange",$.dn),$.fn})})}catch(U){return Promise.reject(U)}},k.update=function(){try{return this.fn?s(this.fn.update()):void 0}catch(x){return Promise.reject(x)}},k.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},k.messageSW=function(x){try{return a(this.getSW(),function(L){return n(L,x)})}catch(L){return Promise.reject(L)}},k.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,f)},k.pn=function(){var x=navigator.serviceWorker.controller;return x&&o(x.scriptURL,this.sn.toString())?x:void 0},k.bn=function(){try{var x=this;return function(L,B){try{var $=L()}catch(U){return B(U)}return $&&$.then?$.then(void 0,B):$}(function(){return a(navigator.serviceWorker.register(x.sn,x.nn),function(L){return x.un=performance.now(),L})},function(L){throw L})}catch(L){return Promise.reject(L)}},w=m,(M=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(w.prototype,M),m}(function(){function d(){this.Pn=new Map}var h=d.prototype;return h.addEventListener=function(p,m){this.Sn(p).add(m)},h.removeEventListener=function(p,m){this.Sn(p).delete(m)},h.dispatchEvent=function(p){p.target=this;for(var m,w=e(this.Sn(p.type));!(m=w()).done;)(0,m.value)(p)},h.Sn=function(p){return this.Pn.has(p)||this.Pn.set(p,new Set),this.Pn.get(p)},d}());function registerSW(d={}){const{immediate:h=!1,onNeedRefresh:p,onOfflineReady:m,onRegistered:w,onRegisterError:M}=d;let k;const x=async(L=!0)=>{};return"serviceWorker"in navigator&&(k=new v("/sw.js",{scope:"/",type:"classic"}),k.addEventListener("activated",L=>{L.isUpdate?window.location.reload():m==null||m()}),k.register({immediate:h}).then(L=>{w==null||w(L)}).catch(L=>{M==null||M(L)})),x}function useRegisterSW(d={}){const{immediate:h=!0,onNeedRefresh:p,onOfflineReady:m,onRegistered:w,onRegisterError:M}=d,k=ref(!1),x=ref(!1);return{updateServiceWorker:registerSW({immediate:h,onNeedRefresh(){k.value=!0,p==null||p()},onOfflineReady(){x.value=!0,m==null||m()},onRegistered:w,onRegisterError:M}),offlineReady:x,needRefresh:k}}var ReloadPrompt_vue_vue_type_style_index_0_lang="";const _hoisted_1$1={key:0,class:"pwa-toast",role:"alert"},_hoisted_2$1={class:"message"},_hoisted_3$1={key:0},_hoisted_4$1={key:1},_sfc_main$1=defineComponent({setup(d){const{offlineReady:h,needRefresh:p,updateServiceWorker:m}=useRegisterSW({onRegistered(M){console.log(`SW Registered: ${M}`)}}),w=async()=>{h.value=!1,p.value=!1};return(M,k)=>unref(h)||unref(p)?(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[unref(h)?(openBlock(),createElementBlock("span",_hoisted_3$1," App ready to work offline ")):(openBlock(),createElementBlock("span",_hoisted_4$1," New content available, click on reload button to update. "))]),unref(p)?(openBlock(),createElementBlock("button",{key:0,onClick:k[0]||(k[0]=x=>unref(m)())}," Reload ")):createCommentVNode("",!0),createBaseVNode("button",{onClick:w}," Close ")])):createCommentVNode("",!0)}}),_sfc_main={setup(){const d=useQuasar();return{showDialog(){d.dialog({component:Help,componentProps:{text:"something"}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),dirHandle:ref(""),dirName:ref(""),style_url:ref(""),access_token:ref(""),mapbox_api_url:ref(""),mapbox_raster_png_dem:ref(""),showPwaBtn:!0,isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){await idbKeyval.get("pwa-installed")&&(this.showPwaBtn=!1),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap(),window.addEventListener("appinstalled",this.pwaInstalled)},methods:{pwaInstalled(){idbKeyval.set("pwa-installed",!0),this.showPwaBtn=!1},async installPWA(){console.log(window.installEvent),window.installEvent.prompt(),window.installEvent=null},resizeMap(){this.$refs.mapBoxViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.$refs.mapBoxViewer.loadMapboxMap()})},isRequiredSettings(){return this.access_token&&this.style_url&&this.dirName?!0:(this.redirectToSettings(),!1)},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let d;try{d=await fileUtils.getDirHandle()}catch(h){if(h.name==="AbortError")return;console.error("An error occured trying to open the file.",h)}!d||(idbKeyval.set("dirHandle",d),this.dirName=d.name)},saveUserSettings(){idbKeyval.set("access_token",this.access_token),idbKeyval.set("style_url",this.style_url),idbKeyval.set("mapbox_api_url",this.mapbox_api_url),idbKeyval.set("mapbox_raster_png_dem",this.mapbox_raster_png_dem),idbKeyval.set("create_folder",this.createFolder),this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken||"",this.style_url=await idbKeyval.get("style_url")||"mapbox://styles/mapbox/streets-v11",this.mapbox_api_url=await idbKeyval.get("mapbox_api_url")||"https://api.mapbox.com/v4/",this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem")||"mapbox.mapbox-terrain-dem-v1";let d=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.dirHandle=d,this.dirName=d.name}},components:{MapboxMapViewer,SideNav,Help,ReloadPrompt:_sfc_main$1}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2=createTextVNode(" See: "),_hoisted_3=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_4=createTextVNode(" See: "),_hoisted_5=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_6={class:"q-pa-none row items-start"},_hoisted_7={class:"col q-pa-none"},_hoisted_8=createBaseVNode("br",null,null,-1);function _sfc_render(d,h,p,m,w,M){const k=resolveComponent("q-header"),x=resolveComponent("ReloadPrompt"),L=resolveComponent("side-nav"),B=resolveComponent("q-card"),$=resolveComponent("q-drawer"),U=resolveComponent("q-btn"),q=resolveComponent("q-tab"),G=resolveComponent("q-tabs"),W=resolveComponent("q-separator"),te=resolveComponent("mapbox-map-viewer"),oe=resolveComponent("q-tab-panel"),ee=resolveComponent("q-icon"),_e=resolveComponent("q-input"),se=resolveComponent("q-tab-panels"),he=resolveComponent("q-page"),ge=resolveComponent("q-page-container"),Re=resolveComponent("q-layout");return openBlock(),createBlock(Re,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(k,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(x),createVNode($,{dense:"","show-if-above":"",modelValue:m.drawerLeft,"onUpdate:modelValue":h[0]||(h[0]=ve=>m.drawerLeft=ve),side:"left",onHide:M.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(B,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(L)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(ge,null,{default:withCtx(()=>[createVNode(he,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(B,{class:"col"},{default:withCtx(()=>[createVNode(G,{dense:"",modelValue:m.selectedTab,"onUpdate:modelValue":h[3]||(h[3]=ve=>m.selectedTab=ve),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(U,{dense:"",flat:"",onClick:M.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(q,{dense:"",name:"map",label:"Map"}),createVNode(q,{dense:"",name:"settings",label:"Settings"}),withDirectives(createVNode(U,{style:{color:"white"},label:"Install as App",class:"q-mr-lg bg-positive",onClick:h[1]||(h[1]=ve=>M.installPWA())},null,512),[[vShow,m.showPwaBtn]]),createVNode(U,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:m.showDialog},null,8,["onClick"]),createVNode(U,{dense:"",flat:"",round:"",onClick:h[2]||(h[2]=ve=>d.$q.dark.toggle()),icon:d.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(W),createVNode(se,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:m.selectedTab,"onUpdate:modelValue":h[12]||(h[12]=ve=>m.selectedTab=ve),animated:""},{default:withCtx(()=>[createVNode(oe,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(te,{class:"col",ref:"mapBoxViewer"},null,512)]),_:1}),createVNode(oe,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[_hoisted_2,_hoisted_3,createVNode(_e,{dense:"",modelValue:m.access_token,"onUpdate:modelValue":h[5]||(h[5]=ve=>m.access_token=ve),label:"Mapbox Access Token *",filled:"",type:m.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[ve=>ve&&ve.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(ee,{dense:"",name:m.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:h[4]||(h[4]=ve=>m.isPwd=!m.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),_hoisted_4,_hoisted_5,createVNode(_e,{dense:"",class:"q-pb-lg",modelValue:m.style_url,"onUpdate:modelValue":h[6]||(h[6]=ve=>m.style_url=ve),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[ve=>ve&&ve.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(_e,{dense:"",class:"q-pb-lg",modelValue:m.mapbox_api_url,"onUpdate:modelValue":h[7]||(h[7]=ve=>m.mapbox_api_url=ve),label:"Mapbox base api url *",filled:"","lazy-rules":"",hint:"",rules:[ve=>ve&&ve.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(_e,{dense:"",class:"q-pb-lg",modelValue:m.mapbox_raster_png_dem,"onUpdate:modelValue":h[8]||(h[8]=ve=>m.mapbox_raster_png_dem=ve),label:"Mapbox Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[ve=>ve&&ve.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[createVNode(_e,{dense:"",class:"q-pb-none",modelValue:m.dirName,"onUpdate:modelValue":h[9]||(h[9]=ve=>m.dirName=ve),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[ve=>ve&&ve.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(U,{class:"q-pb-none",dense:"",onClick:h[10]||(h[10]=ve=>M.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_8,createVNode(U,{class:"q-pt-none",dense:"",onClick:h[11]||(h[11]=ve=>M.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}var MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
