var g0=Object.defineProperty;var Yf=Object.getOwnPropertySymbols;var _0=Object.prototype.hasOwnProperty,y0=Object.prototype.propertyIsEnumerable;var Kf=(p,l,g)=>l in p?g0(p,l,{enumerable:!0,configurable:!0,writable:!0,value:g}):p[l]=g,ul=(p,l)=>{for(var g in l||(l={}))_0.call(l,g)&&Kf(p,g,l[g]);if(Yf)for(var g of Yf(l))y0.call(l,g)&&Kf(p,g,l[g]);return p};import{g as commonjsGlobal,h as getAugmentedNamespace,i as commonjsRequire,j as ref,r as resolveComponent,o as openBlock,k as createElementBlock,l as createVNode,w as withCtx,m as resolveDirective,n as createBaseVNode,t as toDisplayString,p as withDirectives,F as Fragment,q as createTextVNode,c as createBlock,d as defineComponent,u as unref,s as createCommentVNode,v as useQuasar,N as Notify,x as vShow}from"./vendor.8cb234a5.js";import{_ as _export_sfc}from"./index.67b36510.js";class Store{constructor(l="unreal-mapbox",g="keyval"){this.storeName=g,this._dbp=new Promise((m,x)=>{const E=indexedDB.open(l,1);E.onerror=()=>x(E.error),E.onsuccess=()=>m(E.result),E.onupgradeneeded=()=>{E.result.createObjectStore(g)}})}_withIDBStore(l,g){return this._dbp.then(m=>new Promise((x,E)=>{const S=m.transaction(this.storeName,l);S.oncomplete=()=>x(),S.onabort=S.onerror=()=>E(S.error),g(S.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(p,l=getDefaultStore()){let g;return l._withIDBStore("readonly",m=>{g=m.get(p)}).then(()=>g.result)}function set(p,l,g=getDefaultStore()){return g._withIDBStore("readwrite",m=>{m.put(l,p)})}function del(p,l=getDefaultStore()){return l._withIDBStore("readwrite",g=>{g.delete(p)})}function clear(p=getDefaultStore()){return p._withIDBStore("readwrite",l=>{l.clear()})}function keys(p=getDefaultStore()){const l=[];return p._withIDBStore("readonly",g=>{(g.openKeyCursor||g.openCursor).call(g).onsuccess=function(){!this.result||(l.push(this.result.key),this.result.continue())}}).then(()=>l)}var idbKeyval={keys,clear,del,set,get};const bitMethods={getBit(p){return this.data[getSlot(p)]&1<<getShift(p)?1:0},setBit(p){this.data[getSlot(p)]|=1<<getShift(p)},clearBit(p){this.data[getSlot(p)]&=~(1<<getShift(p))},toggleBit(p){this.data[getSlot(p)]^=1<<getShift(p)},getBitXY(p,l){return p>=this.width||l>=this.height?0:this.getBit(l*this.width+p)},setBitXY(p,l){this.setBit(l*this.width+p)},clearBitXY(p,l){this.clearBit(l*this.width+p)},toggleBitXY(p,l){this.toggleBit(l*this.width+p)}};function getSlot(p){return p>>3}function getShift(p){return 7-(p&7)}function setBitMethods(p){for(const l in bitMethods)p.prototype[l]=bitMethods[l]}function checkProcessable(p,l={}){let{bitDepth:g,alpha:m,colorModel:x,components:E,channels:S}=l;if(typeof p!="string"||p.length===0)throw new TypeError("processName must be a string");if(g&&(Array.isArray(g)||(g=[g]),!g.includes(this.bitDepth)))throw new TypeError(`The process: ${p} can only be applied if bit depth is in: ${g}`);if(m&&(Array.isArray(m)||(m=[m]),!m.includes(this.alpha)))throw new TypeError(`The process: ${p} can only be applied if alpha is in: ${m}`);if(x&&(Array.isArray(x)||(x=[x]),!x.includes(this.colorModel)))throw new TypeError(`The process: ${p} can only be applied if color model is in: ${x}`);if(E&&(Array.isArray(E)||(E=[E]),!E.includes(this.components))){let h=`The process: ${p} can only be applied if the number of components is in: ${E}`;throw E.length===1&&E[0]===1?new TypeError(`${h}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(h)}if(S&&(Array.isArray(S)||(S=[S]),!S.includes(this.channels)))throw new TypeError(`The process: ${p} can only be applied if the number of channels is in: ${S}`)}function createBlob(p,l){p=p||[],l=l||{},typeof l=="string"&&(l={type:l});try{return new Blob(p,l)}catch(E){if(E.name!=="TypeError")throw E;for(var g=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,m=new g,x=0;x<p.length;x+=1)m.append(p[x]);return m.getBlob(l.type)}}function dataURLToBlob(p){var l=p.match(/data:([^;]+)/)[1],g=p.replace(/^[^,]+,/,""),m=binaryStringToArrayBuffer(atob(g));return createBlob([m],{type:l})}function canvasToBlob(p,l,g){return typeof p.toBlob=="function"?new Promise(function(m){p.toBlob(m,l,g)}):Promise.resolve(dataURLToBlob(p.toDataURL(l,g)))}function binaryStringToArrayBuffer(p){for(var l=p.length,g=new ArrayBuffer(l),m=new Uint8Array(g),x=-1;++x<l;)m[x]=p.charCodeAt(x);return g}var utf8$1={exports:{}};/*! https://mths.be/utf8js v2.1.2 by @mathias */(function(p,l){(function(g){var m=l,x=p&&p.exports==m&&p,E=typeof commonjsGlobal=="object"&&commonjsGlobal;(E.global===E||E.window===E)&&(g=E);var S=String.fromCharCode;function h(Y){for(var X=[],J=0,q=Y.length,te,ne;J<q;)te=Y.charCodeAt(J++),te>=55296&&te<=56319&&J<q?(ne=Y.charCodeAt(J++),(ne&64512)==56320?X.push(((te&1023)<<10)+(ne&1023)+65536):(X.push(te),J--)):X.push(te);return X}function I(Y){for(var X=Y.length,J=-1,q,te="";++J<X;)q=Y[J],q>65535&&(q-=65536,te+=S(q>>>10&1023|55296),q=56320|q&1023),te+=S(q);return te}function T(Y){if(Y>=55296&&Y<=57343)throw Error("Lone surrogate U+"+Y.toString(16).toUpperCase()+" is not a scalar value")}function A(Y,X){return S(Y>>X&63|128)}function k(Y){if((Y&4294967168)==0)return S(Y);var X="";return(Y&4294965248)==0?X=S(Y>>6&31|192):(Y&4294901760)==0?(T(Y),X=S(Y>>12&15|224),X+=A(Y,6)):(Y&4292870144)==0&&(X=S(Y>>18&7|240),X+=A(Y,12),X+=A(Y,6)),X+=S(Y&63|128),X}function P(Y){for(var X=h(Y),J=X.length,q=-1,te,ne="";++q<J;)te=X[q],ne+=k(te);return ne}function D(){if(B>=N)throw Error("Invalid byte index");var Y=F[B]&255;if(B++,(Y&192)==128)return Y&63;throw Error("Invalid continuation byte")}function M(){var Y,X,J,q,te;if(B>N)throw Error("Invalid byte index");if(B==N)return!1;if(Y=F[B]&255,B++,(Y&128)==0)return Y;if((Y&224)==192){if(X=D(),te=(Y&31)<<6|X,te>=128)return te;throw Error("Invalid continuation byte")}if((Y&240)==224){if(X=D(),J=D(),te=(Y&15)<<12|X<<6|J,te>=2048)return T(te),te;throw Error("Invalid continuation byte")}if((Y&248)==240&&(X=D(),J=D(),q=D(),te=(Y&7)<<18|X<<12|J<<6|q,te>=65536&&te<=1114111))return te;throw Error("Invalid UTF-8 detected")}var F,N,B;function U(Y){F=h(Y),N=F.length,B=0;for(var X=[],J;(J=M())!==!1;)X.push(J);return I(X)}var O={version:"2.1.2",encode:P,decode:U};if(m&&!m.nodeType)if(x)x.exports=O;else{var V={},Z=V.hasOwnProperty;for(var W in O)Z.call(O,W)&&(m[W]=O[W])}else g.utf8=O})(commonjsGlobal)})(utf8$1,utf8$1.exports);const utf8=utf8$1.exports,defaultByteLength$3=1024*8,charArray$1=[];class IOBuffer$6{constructor(l,g){g=g||{};var m=!1;l===void 0&&(l=defaultByteLength$3),typeof l=="number"?l=new ArrayBuffer(l):(m=!0,this._lastWrittenByte=l.byteLength);const x=g.offset?g.offset>>>0:0;let E=l.byteLength-x,S=x;l.buffer&&(l.byteLength!==l.buffer.byteLength&&(S=l.byteOffset+x),l=l.buffer),m?this._lastWrittenByte=E:this._lastWrittenByte=0,this.buffer=l,this.length=E,this.byteLength=E,this.byteOffset=S,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,S,E),this._mark=0,this._marks=[]}available(l){return l===void 0&&(l=1),this.offset+l<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(l){return l===void 0&&(l=1),this.offset+=l,this}seek(l){return this.offset=l,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const l=this._marks.pop();if(l===void 0)throw new Error("Mark stack empty");return this.seek(l),this}rewind(){return this.offset=0,this}ensureAvailable(l){if(l===void 0&&(l=1),!this.available(l)){const m=(this.offset+l)*2,x=new Uint8Array(m);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(l){l===void 0&&(l=1);for(var g=new Uint8Array(l),m=0;m<l;m++)g[m]=this.readByte();return g}readInt16(){var l=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,l}readUint16(){var l=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,l}readInt32(){var l=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,l}readUint32(){var l=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat32(){var l=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat64(){var l=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,l}readChar(){return String.fromCharCode(this.readInt8())}readChars(l){l===void 0&&(l=1),charArray$1.length=l;for(var g=0;g<l;g++)charArray$1[g]=this.readChar();return charArray$1.join("")}readUtf8(l){l===void 0&&(l=1);const g=this.readChars(l);return utf8.decode(g)}writeBoolean(l){return this.writeUint8(l?255:0),this}writeInt8(l){return this.ensureAvailable(1),this._data.setInt8(this.offset++,l),this._updateLastWrittenByte(),this}writeUint8(l){return this.ensureAvailable(1),this._data.setUint8(this.offset++,l),this._updateLastWrittenByte(),this}writeByte(l){return this.writeUint8(l)}writeBytes(l){this.ensureAvailable(l.length);for(var g=0;g<l.length;g++)this._data.setUint8(this.offset++,l[g]);return this._updateLastWrittenByte(),this}writeInt16(l){return this.ensureAvailable(2),this._data.setInt16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(l){return this.ensureAvailable(2),this._data.setUint16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(l){return this.ensureAvailable(4),this._data.setInt32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(l){return this.ensureAvailable(4),this._data.setUint32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(l){return this.ensureAvailable(4),this._data.setFloat32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(l){return this.ensureAvailable(8),this._data.setFloat64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(l){return this.writeUint8(l.charCodeAt(0))}writeChars(l){for(var g=0;g<l.length;g++)this.writeUint8(l.charCodeAt(g));return this}writeUtf8(l){const g=utf8.encode(l);return this.writeChars(g)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return typeof Buffer!="undefined"?Buffer.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}var IOBuffer_1$1=IOBuffer$6,constants$7={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const IOBuffer$5=IOBuffer_1$1,constants$6=constants$7,tableLeft=[];for(var i$5=0;i$5<=8;i$5++)tableLeft.push(255<<i$5);var encode$5=function(p){if(p.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!p.height||!p.width)throw new Error("ImageData width and height are required");if(p.components!==1)throw new Error("Only 1 component is supported");if(p.channels!==1)throw new Error("Only 1 channel is supported");var l=new IOBuffer$5;l.skip(14),writeBitmapV5Header(l,p),writeColorTable(l,p);const g=l.offset;return writePixelArray(l,p),l.rewind(),writeBitmapFileHeader(l,g),l.getBuffer()};function writePixelArray(p,l){const g=Math.floor((l.bitDepth*l.width+31)/32)*4,m=Math.ceil(l.bitDepth*l.width/8),x=g-m,E=l.bitDepth*l.width%8,S=E===0?0:8-E,h=g*l.height;var I,T;const A=new IOBuffer$5(l.data);let k=0,P=0,D=8;p.mark(),T=A.readUint8();for(var M=l.height-1;M>=0;M--){const N=M===0;p.reset(),p.skip(M*g);for(var F=0;F<m;F++){const B=F===m-1;P<=S&&B?(p.writeByte(T<<P),(S===0||S===P)&&!N&&(I=T,T=A.readByte())):P===0?(I=T,T=A.readUint8(),p.writeByte(I)):(I=T,T=A.readUint8(),p.writeByte(I<<P&tableLeft[P]|T>>D)),B?(k+=E||8,p.skip(x),P=k%8,D=8-P):k+=8}}g>m&&(p.reset(),p.skip(h-1),p.writeUint8(0))}function writeColorTable(p,l){l.bitDepth>8||p.writeUint32(0).writeUint32(16777215)}function writeBitmapFileHeader(p,l){p.writeChars("BM"),p.writeInt32(p._lastWrittenByte),p.writeUint16(0),p.writeUint16(0),p.writeUint32(l)}function writeBitmapV5Header(p,l){p.writeUint32(124).writeInt32(l.width).writeInt32(l.height).writeUint16(1).writeUint16(l.bitDepth).writeUint32(constants$6.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(l.width*l.height*l.bitDepth).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,l.bitDepth)).writeUint32(Math.pow(2,l.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$6.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$6.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}var encode$4=encode$5;(function(p){if(p.TextEncoder&&p.TextDecoder)return!1;function l(m="utf-8"){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${m}') is invalid.`)}Object.defineProperty(l.prototype,"encoding",{value:"utf-8"}),l.prototype.encode=function(m,x={stream:!1}){if(x.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let E=0;const S=m.length;let h=0,I=Math.max(32,S+(S>>1)+7),T=new Uint8Array(I>>3<<3);for(;E<S;){let A=m.charCodeAt(E++);if(A>=55296&&A<=56319){if(E<S){const k=m.charCodeAt(E);(k&64512)==56320&&(++E,A=((A&1023)<<10)+(k&1023)+65536)}if(A>=55296&&A<=56319)continue}if(h+4>T.length){I+=8,I*=1+E/m.length*2,I=I>>3<<3;const k=new Uint8Array(I);k.set(T),T=k}if((A&4294967168)==0){T[h++]=A;continue}else if((A&4294965248)==0)T[h++]=A>>6&31|192;else if((A&4294901760)==0)T[h++]=A>>12&15|224,T[h++]=A>>6&63|128;else if((A&4292870144)==0)T[h++]=A>>18&7|240,T[h++]=A>>12&63|128,T[h++]=A>>6&63|128;else continue;T[h++]=A&63|128}return T.slice(0,h)};function g(m="utf-8",x={fatal:!1}){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${m}') is invalid.`);if(x.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(g.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(g.prototype,"fatal",{value:!1}),Object.defineProperty(g.prototype,"ignoreBOM",{value:!1}),g.prototype.decode=function(m,x={stream:!1}){if(x.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const E=new Uint8Array(m);let S=0;const h=E.length,I=[];for(;S<h;){const T=E[S++];if(T===0)break;if((T&128)==0)I.push(T);else if((T&224)==192){const A=E[S++]&63;I.push((T&31)<<6|A)}else if((T&240)==224){const A=E[S++]&63,k=E[S++]&63;I.push((T&31)<<12|A<<6|k)}else if((T&248)==240){const A=E[S++]&63,k=E[S++]&63,P=E[S++]&63;let D=(T&7)<<18|A<<12|k<<6|P;D>65535&&(D-=65536,I.push(D>>>10&1023|55296),D=56320|D&1023),I.push(D)}}return String.fromCharCode.apply(null,I)},p.TextEncoder=l,p.TextDecoder=g})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder$2=new TextDecoder("utf-8");function decode$6(p){return decoder$2.decode(p)}const encoder$2=new TextEncoder;function encode$3(p){return encoder$2.encode(p)}const defaultByteLength$2=1024*8;class IOBuffer$4{constructor(l=defaultByteLength$2,g={}){let m=!1;typeof l=="number"?l=new ArrayBuffer(l):(m=!0,this.lastWrittenByte=l.byteLength);const x=g.offset?g.offset>>>0:0,E=l.byteLength-x;let S=x;(ArrayBuffer.isView(l)||l instanceof IOBuffer$4)&&(l.byteLength!==l.buffer.byteLength&&(S=l.byteOffset+x),l=l.buffer),m?this.lastWrittenByte=E:this.lastWrittenByte=0,this.buffer=l,this.length=E,this.byteLength=E,this.byteOffset=S,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,S,E),this._mark=0,this._marks=[]}available(l=1){return this.offset+l<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(l=1){return this.offset+=l,this}seek(l){return this.offset=l,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const l=this._marks.pop();if(l===void 0)throw new Error("Mark stack empty");return this.seek(l),this}rewind(){return this.offset=0,this}ensureAvailable(l=1){if(!this.available(l)){const m=(this.offset+l)*2,x=new Uint8Array(m);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(l=1){const g=new Uint8Array(l);for(let m=0;m<l;m++)g[m]=this.readByte();return g}readInt16(){const l=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,l}readUint16(){const l=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,l}readInt32(){const l=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,l}readUint32(){const l=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat32(){const l=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat64(){const l=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,l}readChar(){return String.fromCharCode(this.readInt8())}readChars(l=1){let g="";for(let m=0;m<l;m++)g+=this.readChar();return g}readUtf8(l=1){return decode$6(this.readBytes(l))}writeBoolean(l){return this.writeUint8(l?255:0),this}writeInt8(l){return this.ensureAvailable(1),this._data.setInt8(this.offset++,l),this._updateLastWrittenByte(),this}writeUint8(l){return this.ensureAvailable(1),this._data.setUint8(this.offset++,l),this._updateLastWrittenByte(),this}writeByte(l){return this.writeUint8(l)}writeBytes(l){this.ensureAvailable(l.length);for(let g=0;g<l.length;g++)this._data.setUint8(this.offset++,l[g]);return this._updateLastWrittenByte(),this}writeInt16(l){return this.ensureAvailable(2),this._data.setInt16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(l){return this.ensureAvailable(2),this._data.setUint16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(l){return this.ensureAvailable(4),this._data.setInt32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(l){return this.ensureAvailable(4),this._data.setUint32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(l){return this.ensureAvailable(4),this._data.setFloat32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(l){return this.ensureAvailable(8),this._data.setFloat64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(l){return this.writeUint8(l.charCodeAt(0))}writeChars(l){for(let g=0;g<l.length;g++)this.writeUint8(l.charCodeAt(g));return this}writeUtf8(l){return this.writeBytes(encode$3(l))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(p){let l=p.length;for(;--l>=0;)p[l]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(p,l,g,m,x){this.static_tree=p,this.extra_bits=l,this.extra_base=g,this.elems=m,this.max_length=x,this.has_stree=p&&p.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(p,l){this.dyn_tree=p,this.max_code=0,this.stat_desc=l}const d_code=p=>p<256?_dist_code[p]:_dist_code[256+(p>>>7)],put_short=(p,l)=>{p.pending_buf[p.pending++]=l&255,p.pending_buf[p.pending++]=l>>>8&255},send_bits=(p,l,g)=>{p.bi_valid>Buf_size-g?(p.bi_buf|=l<<p.bi_valid&65535,put_short(p,p.bi_buf),p.bi_buf=l>>Buf_size-p.bi_valid,p.bi_valid+=g-Buf_size):(p.bi_buf|=l<<p.bi_valid&65535,p.bi_valid+=g)},send_code=(p,l,g)=>{send_bits(p,g[l*2],g[l*2+1])},bi_reverse=(p,l)=>{let g=0;do g|=p&1,p>>>=1,g<<=1;while(--l>0);return g>>>1},bi_flush=p=>{p.bi_valid===16?(put_short(p,p.bi_buf),p.bi_buf=0,p.bi_valid=0):p.bi_valid>=8&&(p.pending_buf[p.pending++]=p.bi_buf&255,p.bi_buf>>=8,p.bi_valid-=8)},gen_bitlen=(p,l)=>{const g=l.dyn_tree,m=l.max_code,x=l.stat_desc.static_tree,E=l.stat_desc.has_stree,S=l.stat_desc.extra_bits,h=l.stat_desc.extra_base,I=l.stat_desc.max_length;let T,A,k,P,D,M,F=0;for(P=0;P<=MAX_BITS$1;P++)p.bl_count[P]=0;for(g[p.heap[p.heap_max]*2+1]=0,T=p.heap_max+1;T<HEAP_SIZE$1;T++)A=p.heap[T],P=g[g[A*2+1]*2+1]+1,P>I&&(P=I,F++),g[A*2+1]=P,!(A>m)&&(p.bl_count[P]++,D=0,A>=h&&(D=S[A-h]),M=g[A*2],p.opt_len+=M*(P+D),E&&(p.static_len+=M*(x[A*2+1]+D)));if(F!==0){do{for(P=I-1;p.bl_count[P]===0;)P--;p.bl_count[P]--,p.bl_count[P+1]+=2,p.bl_count[I]--,F-=2}while(F>0);for(P=I;P!==0;P--)for(A=p.bl_count[P];A!==0;)k=p.heap[--T],!(k>m)&&(g[k*2+1]!==P&&(p.opt_len+=(P-g[k*2+1])*g[k*2],g[k*2+1]=P),A--)}},gen_codes=(p,l,g)=>{const m=new Array(MAX_BITS$1+1);let x=0,E,S;for(E=1;E<=MAX_BITS$1;E++)m[E]=x=x+g[E-1]<<1;for(S=0;S<=l;S++){let h=p[S*2+1];h!==0&&(p[S*2]=bi_reverse(m[h]++,h))}},tr_static_init=()=>{let p,l,g,m,x;const E=new Array(MAX_BITS$1+1);for(g=0,m=0;m<LENGTH_CODES$1-1;m++)for(base_length[m]=g,p=0;p<1<<extra_lbits[m];p++)_length_code[g++]=m;for(_length_code[g-1]=m,x=0,m=0;m<16;m++)for(base_dist[m]=x,p=0;p<1<<extra_dbits[m];p++)_dist_code[x++]=m;for(x>>=7;m<D_CODES$1;m++)for(base_dist[m]=x<<7,p=0;p<1<<extra_dbits[m]-7;p++)_dist_code[256+x++]=m;for(l=0;l<=MAX_BITS$1;l++)E[l]=0;for(p=0;p<=143;)static_ltree[p*2+1]=8,p++,E[8]++;for(;p<=255;)static_ltree[p*2+1]=9,p++,E[9]++;for(;p<=279;)static_ltree[p*2+1]=7,p++,E[7]++;for(;p<=287;)static_ltree[p*2+1]=8,p++,E[8]++;for(gen_codes(static_ltree,L_CODES$1+1,E),p=0;p<D_CODES$1;p++)static_dtree[p*2+1]=5,static_dtree[p*2]=bi_reverse(p,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=p=>{let l;for(l=0;l<L_CODES$1;l++)p.dyn_ltree[l*2]=0;for(l=0;l<D_CODES$1;l++)p.dyn_dtree[l*2]=0;for(l=0;l<BL_CODES$1;l++)p.bl_tree[l*2]=0;p.dyn_ltree[END_BLOCK*2]=1,p.opt_len=p.static_len=0,p.last_lit=p.matches=0},bi_windup=p=>{p.bi_valid>8?put_short(p,p.bi_buf):p.bi_valid>0&&(p.pending_buf[p.pending++]=p.bi_buf),p.bi_buf=0,p.bi_valid=0},copy_block=(p,l,g,m)=>{bi_windup(p),m&&(put_short(p,g),put_short(p,~g)),p.pending_buf.set(p.window.subarray(l,l+g),p.pending),p.pending+=g},smaller=(p,l,g,m)=>{const x=l*2,E=g*2;return p[x]<p[E]||p[x]===p[E]&&m[l]<=m[g]},pqdownheap=(p,l,g)=>{const m=p.heap[g];let x=g<<1;for(;x<=p.heap_len&&(x<p.heap_len&&smaller(l,p.heap[x+1],p.heap[x],p.depth)&&x++,!smaller(l,m,p.heap[x],p.depth));)p.heap[g]=p.heap[x],g=x,x<<=1;p.heap[g]=m},compress_block=(p,l,g)=>{let m,x,E=0,S,h;if(p.last_lit!==0)do m=p.pending_buf[p.d_buf+E*2]<<8|p.pending_buf[p.d_buf+E*2+1],x=p.pending_buf[p.l_buf+E],E++,m===0?send_code(p,x,l):(S=_length_code[x],send_code(p,S+LITERALS$1+1,l),h=extra_lbits[S],h!==0&&(x-=base_length[S],send_bits(p,x,h)),m--,S=d_code(m),send_code(p,S,g),h=extra_dbits[S],h!==0&&(m-=base_dist[S],send_bits(p,m,h)));while(E<p.last_lit);send_code(p,END_BLOCK,l)},build_tree=(p,l)=>{const g=l.dyn_tree,m=l.stat_desc.static_tree,x=l.stat_desc.has_stree,E=l.stat_desc.elems;let S,h,I=-1,T;for(p.heap_len=0,p.heap_max=HEAP_SIZE$1,S=0;S<E;S++)g[S*2]!==0?(p.heap[++p.heap_len]=I=S,p.depth[S]=0):g[S*2+1]=0;for(;p.heap_len<2;)T=p.heap[++p.heap_len]=I<2?++I:0,g[T*2]=1,p.depth[T]=0,p.opt_len--,x&&(p.static_len-=m[T*2+1]);for(l.max_code=I,S=p.heap_len>>1;S>=1;S--)pqdownheap(p,g,S);T=E;do S=p.heap[1],p.heap[1]=p.heap[p.heap_len--],pqdownheap(p,g,1),h=p.heap[1],p.heap[--p.heap_max]=S,p.heap[--p.heap_max]=h,g[T*2]=g[S*2]+g[h*2],p.depth[T]=(p.depth[S]>=p.depth[h]?p.depth[S]:p.depth[h])+1,g[S*2+1]=g[h*2+1]=T,p.heap[1]=T++,pqdownheap(p,g,1);while(p.heap_len>=2);p.heap[--p.heap_max]=p.heap[1],gen_bitlen(p,l),gen_codes(g,I,p.bl_count)},scan_tree=(p,l,g)=>{let m,x=-1,E,S=l[0*2+1],h=0,I=7,T=4;for(S===0&&(I=138,T=3),l[(g+1)*2+1]=65535,m=0;m<=g;m++)E=S,S=l[(m+1)*2+1],!(++h<I&&E===S)&&(h<T?p.bl_tree[E*2]+=h:E!==0?(E!==x&&p.bl_tree[E*2]++,p.bl_tree[REP_3_6*2]++):h<=10?p.bl_tree[REPZ_3_10*2]++:p.bl_tree[REPZ_11_138*2]++,h=0,x=E,S===0?(I=138,T=3):E===S?(I=6,T=3):(I=7,T=4))},send_tree=(p,l,g)=>{let m,x=-1,E,S=l[0*2+1],h=0,I=7,T=4;for(S===0&&(I=138,T=3),m=0;m<=g;m++)if(E=S,S=l[(m+1)*2+1],!(++h<I&&E===S)){if(h<T)do send_code(p,E,p.bl_tree);while(--h!=0);else E!==0?(E!==x&&(send_code(p,E,p.bl_tree),h--),send_code(p,REP_3_6,p.bl_tree),send_bits(p,h-3,2)):h<=10?(send_code(p,REPZ_3_10,p.bl_tree),send_bits(p,h-3,3)):(send_code(p,REPZ_11_138,p.bl_tree),send_bits(p,h-11,7));h=0,x=E,S===0?(I=138,T=3):E===S?(I=6,T=3):(I=7,T=4)}},build_bl_tree=p=>{let l;for(scan_tree(p,p.dyn_ltree,p.l_desc.max_code),scan_tree(p,p.dyn_dtree,p.d_desc.max_code),build_tree(p,p.bl_desc),l=BL_CODES$1-1;l>=3&&p.bl_tree[bl_order[l]*2+1]===0;l--);return p.opt_len+=3*(l+1)+5+5+4,l},send_all_trees=(p,l,g,m)=>{let x;for(send_bits(p,l-257,5),send_bits(p,g-1,5),send_bits(p,m-4,4),x=0;x<m;x++)send_bits(p,p.bl_tree[bl_order[x]*2+1],3);send_tree(p,p.dyn_ltree,l-1),send_tree(p,p.dyn_dtree,g-1)},detect_data_type=p=>{let l=4093624447,g;for(g=0;g<=31;g++,l>>>=1)if(l&1&&p.dyn_ltree[g*2]!==0)return Z_BINARY;if(p.dyn_ltree[9*2]!==0||p.dyn_ltree[10*2]!==0||p.dyn_ltree[13*2]!==0)return Z_TEXT;for(g=32;g<LITERALS$1;g++)if(p.dyn_ltree[g*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=p=>{static_init_done||(tr_static_init(),static_init_done=!0),p.l_desc=new TreeDesc(p.dyn_ltree,static_l_desc),p.d_desc=new TreeDesc(p.dyn_dtree,static_d_desc),p.bl_desc=new TreeDesc(p.bl_tree,static_bl_desc),p.bi_buf=0,p.bi_valid=0,init_block(p)},_tr_stored_block$1=(p,l,g,m)=>{send_bits(p,(STORED_BLOCK<<1)+(m?1:0),3),copy_block(p,l,g,!0)},_tr_align$1=p=>{send_bits(p,STATIC_TREES<<1,3),send_code(p,END_BLOCK,static_ltree),bi_flush(p)},_tr_flush_block$1=(p,l,g,m)=>{let x,E,S=0;p.level>0?(p.strm.data_type===Z_UNKNOWN$1&&(p.strm.data_type=detect_data_type(p)),build_tree(p,p.l_desc),build_tree(p,p.d_desc),S=build_bl_tree(p),x=p.opt_len+3+7>>>3,E=p.static_len+3+7>>>3,E<=x&&(x=E)):x=E=g+5,g+4<=x&&l!==-1?_tr_stored_block$1(p,l,g,m):p.strategy===Z_FIXED$1||E===x?(send_bits(p,(STATIC_TREES<<1)+(m?1:0),3),compress_block(p,static_ltree,static_dtree)):(send_bits(p,(DYN_TREES<<1)+(m?1:0),3),send_all_trees(p,p.l_desc.max_code+1,p.d_desc.max_code+1,S+1),compress_block(p,p.dyn_ltree,p.dyn_dtree)),init_block(p),m&&bi_windup(p)},_tr_tally$1=(p,l,g)=>(p.pending_buf[p.d_buf+p.last_lit*2]=l>>>8&255,p.pending_buf[p.d_buf+p.last_lit*2+1]=l&255,p.pending_buf[p.l_buf+p.last_lit]=g&255,p.last_lit++,l===0?p.dyn_ltree[g*2]++:(p.matches++,l--,p.dyn_ltree[(_length_code[g]+LITERALS$1+1)*2]++,p.dyn_dtree[d_code(l)*2]++),p.last_lit===p.lit_bufsize-1);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(p,l,g,m)=>{let x=p&65535|0,E=p>>>16&65535|0,S=0;for(;g!==0;){S=g>2e3?2e3:g,g-=S;do x=x+l[m++]|0,E=E+x|0;while(--S);x%=65521,E%=65521}return x|E<<16|0};var adler32_1=adler32;const makeTable=()=>{let p,l=[];for(var g=0;g<256;g++){p=g;for(var m=0;m<8;m++)p=p&1?3988292384^p>>>1:p>>>1;l[g]=p}return l},crcTable$1=new Uint32Array(makeTable()),crc32=(p,l,g,m)=>{const x=crcTable$1,E=m+g;p^=-1;for(let S=m;S<E;S++)p=p>>>8^x[(p^l[S])&255];return p^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(p,l)=>(p.msg=messages[l],l),rank=p=>(p<<1)-(p>4?9:0),zero=p=>{let l=p.length;for(;--l>=0;)p[l]=0};let HASH_ZLIB=(p,l,g)=>(l<<p.hash_shift^g)&p.hash_mask,HASH=HASH_ZLIB;const flush_pending=p=>{const l=p.state;let g=l.pending;g>p.avail_out&&(g=p.avail_out),g!==0&&(p.output.set(l.pending_buf.subarray(l.pending_out,l.pending_out+g),p.next_out),p.next_out+=g,l.pending_out+=g,p.total_out+=g,p.avail_out-=g,l.pending-=g,l.pending===0&&(l.pending_out=0))},flush_block_only=(p,l)=>{_tr_flush_block(p,p.block_start>=0?p.block_start:-1,p.strstart-p.block_start,l),p.block_start=p.strstart,flush_pending(p.strm)},put_byte=(p,l)=>{p.pending_buf[p.pending++]=l},putShortMSB=(p,l)=>{p.pending_buf[p.pending++]=l>>>8&255,p.pending_buf[p.pending++]=l&255},read_buf=(p,l,g,m)=>{let x=p.avail_in;return x>m&&(x=m),x===0?0:(p.avail_in-=x,l.set(p.input.subarray(p.next_in,p.next_in+x),g),p.state.wrap===1?p.adler=adler32_1(p.adler,l,x,g):p.state.wrap===2&&(p.adler=crc32_1(p.adler,l,x,g)),p.next_in+=x,p.total_in+=x,x)},longest_match=(p,l)=>{let g=p.max_chain_length,m=p.strstart,x,E,S=p.prev_length,h=p.nice_match;const I=p.strstart>p.w_size-MIN_LOOKAHEAD?p.strstart-(p.w_size-MIN_LOOKAHEAD):0,T=p.window,A=p.w_mask,k=p.prev,P=p.strstart+MAX_MATCH;let D=T[m+S-1],M=T[m+S];p.prev_length>=p.good_match&&(g>>=2),h>p.lookahead&&(h=p.lookahead);do if(x=l,!(T[x+S]!==M||T[x+S-1]!==D||T[x]!==T[m]||T[++x]!==T[m+1])){m+=2,x++;do;while(T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&T[++m]===T[++x]&&m<P);if(E=MAX_MATCH-(P-m),m=P-MAX_MATCH,E>S){if(p.match_start=l,S=E,E>=h)break;D=T[m+S-1],M=T[m+S]}}while((l=k[l&A])>I&&--g!=0);return S<=p.lookahead?S:p.lookahead},fill_window=p=>{const l=p.w_size;let g,m,x,E,S;do{if(E=p.window_size-p.lookahead-p.strstart,p.strstart>=l+(l-MIN_LOOKAHEAD)){p.window.set(p.window.subarray(l,l+l),0),p.match_start-=l,p.strstart-=l,p.block_start-=l,m=p.hash_size,g=m;do x=p.head[--g],p.head[g]=x>=l?x-l:0;while(--m);m=l,g=m;do x=p.prev[--g],p.prev[g]=x>=l?x-l:0;while(--m);E+=l}if(p.strm.avail_in===0)break;if(m=read_buf(p.strm,p.window,p.strstart+p.lookahead,E),p.lookahead+=m,p.lookahead+p.insert>=MIN_MATCH)for(S=p.strstart-p.insert,p.ins_h=p.window[S],p.ins_h=HASH(p,p.ins_h,p.window[S+1]);p.insert&&(p.ins_h=HASH(p,p.ins_h,p.window[S+MIN_MATCH-1]),p.prev[S&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=S,S++,p.insert--,!(p.lookahead+p.insert<MIN_MATCH)););}while(p.lookahead<MIN_LOOKAHEAD&&p.strm.avail_in!==0)},deflate_stored=(p,l)=>{let g=65535;for(g>p.pending_buf_size-5&&(g=p.pending_buf_size-5);;){if(p.lookahead<=1){if(fill_window(p),p.lookahead===0&&l===Z_NO_FLUSH$2)return BS_NEED_MORE;if(p.lookahead===0)break}p.strstart+=p.lookahead,p.lookahead=0;const m=p.block_start+g;if((p.strstart===0||p.strstart>=m)&&(p.lookahead=p.strstart-m,p.strstart=m,flush_block_only(p,!1),p.strm.avail_out===0)||p.strstart-p.block_start>=p.w_size-MIN_LOOKAHEAD&&(flush_block_only(p,!1),p.strm.avail_out===0))return BS_NEED_MORE}return p.insert=0,l===Z_FINISH$3?(flush_block_only(p,!0),p.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(p.strstart>p.block_start&&(flush_block_only(p,!1),p.strm.avail_out===0),BS_NEED_MORE)},deflate_fast=(p,l)=>{let g,m;for(;;){if(p.lookahead<MIN_LOOKAHEAD){if(fill_window(p),p.lookahead<MIN_LOOKAHEAD&&l===Z_NO_FLUSH$2)return BS_NEED_MORE;if(p.lookahead===0)break}if(g=0,p.lookahead>=MIN_MATCH&&(p.ins_h=HASH(p,p.ins_h,p.window[p.strstart+MIN_MATCH-1]),g=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),g!==0&&p.strstart-g<=p.w_size-MIN_LOOKAHEAD&&(p.match_length=longest_match(p,g)),p.match_length>=MIN_MATCH)if(m=_tr_tally(p,p.strstart-p.match_start,p.match_length-MIN_MATCH),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=MIN_MATCH){p.match_length--;do p.strstart++,p.ins_h=HASH(p,p.ins_h,p.window[p.strstart+MIN_MATCH-1]),g=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart;while(--p.match_length!=0);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=HASH(p,p.ins_h,p.window[p.strstart+1]);else m=_tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(m&&(flush_block_only(p,!1),p.strm.avail_out===0))return BS_NEED_MORE}return p.insert=p.strstart<MIN_MATCH-1?p.strstart:MIN_MATCH-1,l===Z_FINISH$3?(flush_block_only(p,!0),p.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):p.last_lit&&(flush_block_only(p,!1),p.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(p,l)=>{let g,m,x;for(;;){if(p.lookahead<MIN_LOOKAHEAD){if(fill_window(p),p.lookahead<MIN_LOOKAHEAD&&l===Z_NO_FLUSH$2)return BS_NEED_MORE;if(p.lookahead===0)break}if(g=0,p.lookahead>=MIN_MATCH&&(p.ins_h=HASH(p,p.ins_h,p.window[p.strstart+MIN_MATCH-1]),g=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=MIN_MATCH-1,g!==0&&p.prev_length<p.max_lazy_match&&p.strstart-g<=p.w_size-MIN_LOOKAHEAD&&(p.match_length=longest_match(p,g),p.match_length<=5&&(p.strategy===Z_FILTERED||p.match_length===MIN_MATCH&&p.strstart-p.match_start>4096)&&(p.match_length=MIN_MATCH-1)),p.prev_length>=MIN_MATCH&&p.match_length<=p.prev_length){x=p.strstart+p.lookahead-MIN_MATCH,m=_tr_tally(p,p.strstart-1-p.prev_match,p.prev_length-MIN_MATCH),p.lookahead-=p.prev_length-1,p.prev_length-=2;do++p.strstart<=x&&(p.ins_h=HASH(p,p.ins_h,p.window[p.strstart+MIN_MATCH-1]),g=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart);while(--p.prev_length!=0);if(p.match_available=0,p.match_length=MIN_MATCH-1,p.strstart++,m&&(flush_block_only(p,!1),p.strm.avail_out===0))return BS_NEED_MORE}else if(p.match_available){if(m=_tr_tally(p,0,p.window[p.strstart-1]),m&&flush_block_only(p,!1),p.strstart++,p.lookahead--,p.strm.avail_out===0)return BS_NEED_MORE}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(m=_tr_tally(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<MIN_MATCH-1?p.strstart:MIN_MATCH-1,l===Z_FINISH$3?(flush_block_only(p,!0),p.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):p.last_lit&&(flush_block_only(p,!1),p.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(p,l)=>{let g,m,x,E;const S=p.window;for(;;){if(p.lookahead<=MAX_MATCH){if(fill_window(p),p.lookahead<=MAX_MATCH&&l===Z_NO_FLUSH$2)return BS_NEED_MORE;if(p.lookahead===0)break}if(p.match_length=0,p.lookahead>=MIN_MATCH&&p.strstart>0&&(x=p.strstart-1,m=S[x],m===S[++x]&&m===S[++x]&&m===S[++x])){E=p.strstart+MAX_MATCH;do;while(m===S[++x]&&m===S[++x]&&m===S[++x]&&m===S[++x]&&m===S[++x]&&m===S[++x]&&m===S[++x]&&m===S[++x]&&x<E);p.match_length=MAX_MATCH-(E-x),p.match_length>p.lookahead&&(p.match_length=p.lookahead)}if(p.match_length>=MIN_MATCH?(g=_tr_tally(p,1,p.match_length-MIN_MATCH),p.lookahead-=p.match_length,p.strstart+=p.match_length,p.match_length=0):(g=_tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++),g&&(flush_block_only(p,!1),p.strm.avail_out===0))return BS_NEED_MORE}return p.insert=0,l===Z_FINISH$3?(flush_block_only(p,!0),p.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):p.last_lit&&(flush_block_only(p,!1),p.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(p,l)=>{let g;for(;;){if(p.lookahead===0&&(fill_window(p),p.lookahead===0)){if(l===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(p.match_length=0,g=_tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++,g&&(flush_block_only(p,!1),p.strm.avail_out===0))return BS_NEED_MORE}return p.insert=0,l===Z_FINISH$3?(flush_block_only(p,!0),p.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):p.last_lit&&(flush_block_only(p,!1),p.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(p,l,g,m,x){this.good_length=p,this.max_lazy=l,this.nice_length=g,this.max_chain=m,this.func=x}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=p=>{p.window_size=2*p.w_size,zero(p.head),p.max_lazy_match=configuration_table[p.level].max_lazy,p.good_match=configuration_table[p.level].good_length,p.nice_match=configuration_table[p.level].nice_length,p.max_chain_length=configuration_table[p.level].max_chain,p.strstart=0,p.block_start=0,p.lookahead=0,p.insert=0,p.match_length=p.prev_length=MIN_MATCH-1,p.match_available=0,p.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=p=>{if(!p||!p.state)return err(p,Z_STREAM_ERROR$2);p.total_in=p.total_out=0,p.data_type=Z_UNKNOWN;const l=p.state;return l.pending=0,l.pending_out=0,l.wrap<0&&(l.wrap=-l.wrap),l.status=l.wrap?INIT_STATE:BUSY_STATE,p.adler=l.wrap===2?0:1,l.last_flush=Z_NO_FLUSH$2,_tr_init(l),Z_OK$3},deflateReset=p=>{const l=deflateResetKeep(p);return l===Z_OK$3&&lm_init(p.state),l},deflateSetHeader=(p,l)=>!p||!p.state||p.state.wrap!==2?Z_STREAM_ERROR$2:(p.state.gzhead=l,Z_OK$3),deflateInit2=(p,l,g,m,x,E)=>{if(!p)return Z_STREAM_ERROR$2;let S=1;if(l===Z_DEFAULT_COMPRESSION$1&&(l=6),m<0?(S=0,m=-m):m>15&&(S=2,m-=16),x<1||x>MAX_MEM_LEVEL||g!==Z_DEFLATED$2||m<8||m>15||l<0||l>9||E<0||E>Z_FIXED)return err(p,Z_STREAM_ERROR$2);m===8&&(m=9);const h=new DeflateState;return p.state=h,h.strm=p,h.wrap=S,h.gzhead=null,h.w_bits=m,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=x+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+MIN_MATCH-1)/MIN_MATCH),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<x+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=(1+2)*h.lit_bufsize,h.level=l,h.strategy=E,h.method=g,deflateReset(p)},deflateInit=(p,l)=>deflateInit2(p,l,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(p,l)=>{let g,m;if(!p||!p.state||l>Z_BLOCK$1||l<0)return p?err(p,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const x=p.state;if(!p.output||!p.input&&p.avail_in!==0||x.status===FINISH_STATE&&l!==Z_FINISH$3)return err(p,p.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);x.strm=p;const E=x.last_flush;if(x.last_flush=l,x.status===INIT_STATE)if(x.wrap===2)p.adler=0,put_byte(x,31),put_byte(x,139),put_byte(x,8),x.gzhead?(put_byte(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),put_byte(x,x.gzhead.time&255),put_byte(x,x.gzhead.time>>8&255),put_byte(x,x.gzhead.time>>16&255),put_byte(x,x.gzhead.time>>24&255),put_byte(x,x.level===9?2:x.strategy>=Z_HUFFMAN_ONLY||x.level<2?4:0),put_byte(x,x.gzhead.os&255),x.gzhead.extra&&x.gzhead.extra.length&&(put_byte(x,x.gzhead.extra.length&255),put_byte(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=EXTRA_STATE):(put_byte(x,0),put_byte(x,0),put_byte(x,0),put_byte(x,0),put_byte(x,0),put_byte(x,x.level===9?2:x.strategy>=Z_HUFFMAN_ONLY||x.level<2?4:0),put_byte(x,OS_CODE),x.status=BUSY_STATE);else{let S=Z_DEFLATED$2+(x.w_bits-8<<4)<<8,h=-1;x.strategy>=Z_HUFFMAN_ONLY||x.level<2?h=0:x.level<6?h=1:x.level===6?h=2:h=3,S|=h<<6,x.strstart!==0&&(S|=PRESET_DICT),S+=31-S%31,x.status=BUSY_STATE,putShortMSB(x,S),x.strstart!==0&&(putShortMSB(x,p.adler>>>16),putShortMSB(x,p.adler&65535)),p.adler=1}if(x.status===EXTRA_STATE)if(x.gzhead.extra){for(g=x.pending;x.gzindex<(x.gzhead.extra.length&65535)&&!(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),flush_pending(p),g=x.pending,x.pending===x.pending_buf_size));)put_byte(x,x.gzhead.extra[x.gzindex]&255),x.gzindex++;x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=NAME_STATE)}else x.status=NAME_STATE;if(x.status===NAME_STATE)if(x.gzhead.name){g=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),flush_pending(p),g=x.pending,x.pending===x.pending_buf_size)){m=1;break}x.gzindex<x.gzhead.name.length?m=x.gzhead.name.charCodeAt(x.gzindex++)&255:m=0,put_byte(x,m)}while(m!==0);x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),m===0&&(x.gzindex=0,x.status=COMMENT_STATE)}else x.status=COMMENT_STATE;if(x.status===COMMENT_STATE)if(x.gzhead.comment){g=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),flush_pending(p),g=x.pending,x.pending===x.pending_buf_size)){m=1;break}x.gzindex<x.gzhead.comment.length?m=x.gzhead.comment.charCodeAt(x.gzindex++)&255:m=0,put_byte(x,m)}while(m!==0);x.gzhead.hcrc&&x.pending>g&&(p.adler=crc32_1(p.adler,x.pending_buf,x.pending-g,g)),m===0&&(x.status=HCRC_STATE)}else x.status=HCRC_STATE;if(x.status===HCRC_STATE&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&flush_pending(p),x.pending+2<=x.pending_buf_size&&(put_byte(x,p.adler&255),put_byte(x,p.adler>>8&255),p.adler=0,x.status=BUSY_STATE)):x.status=BUSY_STATE),x.pending!==0){if(flush_pending(p),p.avail_out===0)return x.last_flush=-1,Z_OK$3}else if(p.avail_in===0&&rank(l)<=rank(E)&&l!==Z_FINISH$3)return err(p,Z_BUF_ERROR$1);if(x.status===FINISH_STATE&&p.avail_in!==0)return err(p,Z_BUF_ERROR$1);if(p.avail_in!==0||x.lookahead!==0||l!==Z_NO_FLUSH$2&&x.status!==FINISH_STATE){let S=x.strategy===Z_HUFFMAN_ONLY?deflate_huff(x,l):x.strategy===Z_RLE?deflate_rle(x,l):configuration_table[x.level].func(x,l);if((S===BS_FINISH_STARTED||S===BS_FINISH_DONE)&&(x.status=FINISH_STATE),S===BS_NEED_MORE||S===BS_FINISH_STARTED)return p.avail_out===0&&(x.last_flush=-1),Z_OK$3;if(S===BS_BLOCK_DONE&&(l===Z_PARTIAL_FLUSH?_tr_align(x):l!==Z_BLOCK$1&&(_tr_stored_block(x,0,0,!1),l===Z_FULL_FLUSH$1&&(zero(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),flush_pending(p),p.avail_out===0))return x.last_flush=-1,Z_OK$3}return l!==Z_FINISH$3?Z_OK$3:x.wrap<=0?Z_STREAM_END$3:(x.wrap===2?(put_byte(x,p.adler&255),put_byte(x,p.adler>>8&255),put_byte(x,p.adler>>16&255),put_byte(x,p.adler>>24&255),put_byte(x,p.total_in&255),put_byte(x,p.total_in>>8&255),put_byte(x,p.total_in>>16&255),put_byte(x,p.total_in>>24&255)):(putShortMSB(x,p.adler>>>16),putShortMSB(x,p.adler&65535)),flush_pending(p),x.wrap>0&&(x.wrap=-x.wrap),x.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=p=>{if(!p||!p.state)return Z_STREAM_ERROR$2;const l=p.state.status;return l!==INIT_STATE&&l!==EXTRA_STATE&&l!==NAME_STATE&&l!==COMMENT_STATE&&l!==HCRC_STATE&&l!==BUSY_STATE&&l!==FINISH_STATE?err(p,Z_STREAM_ERROR$2):(p.state=null,l===BUSY_STATE?err(p,Z_DATA_ERROR$2):Z_OK$3)},deflateSetDictionary=(p,l)=>{let g=l.length;if(!p||!p.state)return Z_STREAM_ERROR$2;const m=p.state,x=m.wrap;if(x===2||x===1&&m.status!==INIT_STATE||m.lookahead)return Z_STREAM_ERROR$2;if(x===1&&(p.adler=adler32_1(p.adler,l,g,0)),m.wrap=0,g>=m.w_size){x===0&&(zero(m.head),m.strstart=0,m.block_start=0,m.insert=0);let I=new Uint8Array(m.w_size);I.set(l.subarray(g-m.w_size,g),0),l=I,g=m.w_size}const E=p.avail_in,S=p.next_in,h=p.input;for(p.avail_in=g,p.next_in=0,p.input=l,fill_window(m);m.lookahead>=MIN_MATCH;){let I=m.strstart,T=m.lookahead-(MIN_MATCH-1);do m.ins_h=HASH(m,m.ins_h,m.window[I+MIN_MATCH-1]),m.prev[I&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=I,I++;while(--T);m.strstart=I,m.lookahead=MIN_MATCH-1,fill_window(m)}return m.strstart+=m.lookahead,m.block_start=m.strstart,m.insert=m.lookahead,m.lookahead=0,m.match_length=m.prev_length=MIN_MATCH-1,m.match_available=0,p.next_in=S,p.input=h,p.avail_in=E,m.wrap=x,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(p,l)=>Object.prototype.hasOwnProperty.call(p,l);var assign=function(p){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const g=l.shift();if(!!g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(const m in g)_has(g,m)&&(p[m]=g[m])}}return p},flattenChunks=p=>{let l=0;for(let m=0,x=p.length;m<x;m++)l+=p[m].length;const g=new Uint8Array(l);for(let m=0,x=0,E=p.length;m<E;m++){let S=p[m];g.set(S,x),x+=S.length}return g},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let p=0;p<256;p++)_utf8len[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=p=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(p);let l,g,m,x,E,S=p.length,h=0;for(x=0;x<S;x++)g=p.charCodeAt(x),(g&64512)==55296&&x+1<S&&(m=p.charCodeAt(x+1),(m&64512)==56320&&(g=65536+(g-55296<<10)+(m-56320),x++)),h+=g<128?1:g<2048?2:g<65536?3:4;for(l=new Uint8Array(h),E=0,x=0;E<h;x++)g=p.charCodeAt(x),(g&64512)==55296&&x+1<S&&(m=p.charCodeAt(x+1),(m&64512)==56320&&(g=65536+(g-55296<<10)+(m-56320),x++)),g<128?l[E++]=g:g<2048?(l[E++]=192|g>>>6,l[E++]=128|g&63):g<65536?(l[E++]=224|g>>>12,l[E++]=128|g>>>6&63,l[E++]=128|g&63):(l[E++]=240|g>>>18,l[E++]=128|g>>>12&63,l[E++]=128|g>>>6&63,l[E++]=128|g&63);return l};const buf2binstring=(p,l)=>{if(l<65534&&p.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,p.length===l?p:p.subarray(0,l));let g="";for(let m=0;m<l;m++)g+=String.fromCharCode(p[m]);return g};var buf2string=(p,l)=>{const g=l||p.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(p.subarray(0,l));let m,x;const E=new Array(g*2);for(x=0,m=0;m<g;){let S=p[m++];if(S<128){E[x++]=S;continue}let h=_utf8len[S];if(h>4){E[x++]=65533,m+=h-1;continue}for(S&=h===2?31:h===3?15:7;h>1&&m<g;)S=S<<6|p[m++]&63,h--;if(h>1){E[x++]=65533;continue}S<65536?E[x++]=S:(S-=65536,E[x++]=55296|S>>10&1023,E[x++]=56320|S&1023)}return buf2binstring(E,x)},utf8border=(p,l)=>{l=l||p.length,l>p.length&&(l=p.length);let g=l-1;for(;g>=0&&(p[g]&192)==128;)g--;return g<0||g===0?l:g+_utf8len[p[g]]>l?g:l},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(p){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},p||{});let l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let g=deflate_1$2.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(g!==Z_OK$2)throw new Error(messages[g]);if(l.header&&deflate_1$2.deflateSetHeader(this.strm,l.header),l.dictionary){let m;if(typeof l.dictionary=="string"?m=strings.string2buf(l.dictionary):toString$1$1.call(l.dictionary)==="[object ArrayBuffer]"?m=new Uint8Array(l.dictionary):m=l.dictionary,g=deflate_1$2.deflateSetDictionary(this.strm,m),g!==Z_OK$2)throw new Error(messages[g]);this._dict_set=!0}}Deflate$1.prototype.push=function(p,l){const g=this.strm,m=this.options.chunkSize;let x,E;if(this.ended)return!1;for(l===~~l?E=l:E=l===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof p=="string"?g.input=strings.string2buf(p):toString$1$1.call(p)==="[object ArrayBuffer]"?g.input=new Uint8Array(p):g.input=p,g.next_in=0,g.avail_in=g.input.length;;){if(g.avail_out===0&&(g.output=new Uint8Array(m),g.next_out=0,g.avail_out=m),(E===Z_SYNC_FLUSH||E===Z_FULL_FLUSH)&&g.avail_out<=6){this.onData(g.output.subarray(0,g.next_out)),g.avail_out=0;continue}if(x=deflate_1$2.deflate(g,E),x===Z_STREAM_END$2)return g.next_out>0&&this.onData(g.output.subarray(0,g.next_out)),x=deflate_1$2.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===Z_OK$2;if(g.avail_out===0){this.onData(g.output);continue}if(E>0&&g.next_out>0){this.onData(g.output.subarray(0,g.next_out)),g.avail_out=0;continue}if(g.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(p){this.chunks.push(p)};Deflate$1.prototype.onEnd=function(p){p===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};function deflate$1(p,l){const g=new Deflate$1(l);if(g.push(p,!0),g.err)throw g.msg||messages[g.err];return g.result}function deflateRaw$1(p,l){return l=l||{},l.raw=!0,deflate$1(p,l)}function gzip$1(p,l){return l=l||{},l.gzip=!0,deflate$1(p,l)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$1,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1=30,TYPE$1=12;var inffast=function(l,g){let m,x,E,S,h,I,T,A,k,P,D,M,F,N,B,U,O,V,Z,W,Y,X,J,q;const te=l.state;m=l.next_in,J=l.input,x=m+(l.avail_in-5),E=l.next_out,q=l.output,S=E-(g-l.avail_out),h=E+(l.avail_out-257),I=te.dmax,T=te.wsize,A=te.whave,k=te.wnext,P=te.window,D=te.hold,M=te.bits,F=te.lencode,N=te.distcode,B=(1<<te.lenbits)-1,U=(1<<te.distbits)-1;e:do{M<15&&(D+=J[m++]<<M,M+=8,D+=J[m++]<<M,M+=8),O=F[D&B];t:for(;;){if(V=O>>>24,D>>>=V,M-=V,V=O>>>16&255,V===0)q[E++]=O&65535;else if(V&16){Z=O&65535,V&=15,V&&(M<V&&(D+=J[m++]<<M,M+=8),Z+=D&(1<<V)-1,D>>>=V,M-=V),M<15&&(D+=J[m++]<<M,M+=8,D+=J[m++]<<M,M+=8),O=N[D&U];i:for(;;){if(V=O>>>24,D>>>=V,M-=V,V=O>>>16&255,V&16){if(W=O&65535,V&=15,M<V&&(D+=J[m++]<<M,M+=8,M<V&&(D+=J[m++]<<M,M+=8)),W+=D&(1<<V)-1,W>I){l.msg="invalid distance too far back",te.mode=BAD$1;break e}if(D>>>=V,M-=V,V=E-S,W>V){if(V=W-V,V>A&&te.sane){l.msg="invalid distance too far back",te.mode=BAD$1;break e}if(Y=0,X=P,k===0){if(Y+=T-V,V<Z){Z-=V;do q[E++]=P[Y++];while(--V);Y=E-W,X=q}}else if(k<V){if(Y+=T+k-V,V-=k,V<Z){Z-=V;do q[E++]=P[Y++];while(--V);if(Y=0,k<Z){V=k,Z-=V;do q[E++]=P[Y++];while(--V);Y=E-W,X=q}}}else if(Y+=k-V,V<Z){Z-=V;do q[E++]=P[Y++];while(--V);Y=E-W,X=q}for(;Z>2;)q[E++]=X[Y++],q[E++]=X[Y++],q[E++]=X[Y++],Z-=3;Z&&(q[E++]=X[Y++],Z>1&&(q[E++]=X[Y++]))}else{Y=E-W;do q[E++]=q[Y++],q[E++]=q[Y++],q[E++]=q[Y++],Z-=3;while(Z>2);Z&&(q[E++]=q[Y++],Z>1&&(q[E++]=q[Y++]))}}else if((V&64)==0){O=N[(O&65535)+(D&(1<<V)-1)];continue i}else{l.msg="invalid distance code",te.mode=BAD$1;break e}break}}else if((V&64)==0){O=F[(O&65535)+(D&(1<<V)-1)];continue t}else if(V&32){te.mode=TYPE$1;break e}else{l.msg="invalid literal/length code",te.mode=BAD$1;break e}break}}while(m<x&&E<h);Z=M>>3,m-=Z,M-=Z<<3,D&=(1<<M)-1,l.next_in=m,l.next_out=E,l.avail_in=m<x?5+(x-m):5-(m-x),l.avail_out=E<h?257+(h-E):257-(E-h),te.hold=D,te.bits=M};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(p,l,g,m,x,E,S,h)=>{const I=h.bits;let T=0,A=0,k=0,P=0,D=0,M=0,F=0,N=0,B=0,U=0,O,V,Z,W,Y,X=null,J=0,q;const te=new Uint16Array(MAXBITS+1),ne=new Uint16Array(MAXBITS+1);let de=null,oe=0,we,Ae,ye;for(T=0;T<=MAXBITS;T++)te[T]=0;for(A=0;A<m;A++)te[l[g+A]]++;for(D=I,P=MAXBITS;P>=1&&te[P]===0;P--);if(D>P&&(D=P),P===0)return x[E++]=1<<24|64<<16|0,x[E++]=1<<24|64<<16|0,h.bits=1,0;for(k=1;k<P&&te[k]===0;k++);for(D<k&&(D=k),N=1,T=1;T<=MAXBITS;T++)if(N<<=1,N-=te[T],N<0)return-1;if(N>0&&(p===CODES$1||P!==1))return-1;for(ne[1]=0,T=1;T<MAXBITS;T++)ne[T+1]=ne[T]+te[T];for(A=0;A<m;A++)l[g+A]!==0&&(S[ne[l[g+A]]++]=A);if(p===CODES$1?(X=de=S,q=19):p===LENS$1?(X=lbase,J-=257,de=lext,oe-=257,q=256):(X=dbase,de=dext,q=-1),U=0,A=0,T=k,Y=E,M=D,F=0,Z=-1,B=1<<D,W=B-1,p===LENS$1&&B>ENOUGH_LENS$1||p===DISTS$1&&B>ENOUGH_DISTS$1)return 1;for(;;){we=T-F,S[A]<q?(Ae=0,ye=S[A]):S[A]>q?(Ae=de[oe+S[A]],ye=X[J+S[A]]):(Ae=32+64,ye=0),O=1<<T-F,V=1<<M,k=V;do V-=O,x[Y+(U>>F)+V]=we<<24|Ae<<16|ye|0;while(V!==0);for(O=1<<T-1;U&O;)O>>=1;if(O!==0?(U&=O-1,U+=O):U=0,A++,--te[T]==0){if(T===P)break;T=l[g+S[A]]}if(T>D&&(U&W)!==Z){for(F===0&&(F=D),Y+=k,M=T-F,N=1<<M;M+F<P&&(N-=te[M+F],!(N<=0));)M++,N<<=1;if(B+=1<<M,p===LENS$1&&B>ENOUGH_LENS$1||p===DISTS$1&&B>ENOUGH_DISTS$1)return 1;Z=U&W,x[Z]=D<<24|M<<16|Y-E|0}}return U!==0&&(x[Y+U]=T-F<<24|64<<16|0),h.bits=D,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=p=>(p>>>24&255)+(p>>>8&65280)+((p&65280)<<8)+((p&255)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=p=>{if(!p||!p.state)return Z_STREAM_ERROR$1;const l=p.state;return p.total_in=p.total_out=l.total=0,p.msg="",l.wrap&&(p.adler=l.wrap&1),l.mode=HEAD,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Int32Array(ENOUGH_LENS),l.distcode=l.distdyn=new Int32Array(ENOUGH_DISTS),l.sane=1,l.back=-1,Z_OK$1},inflateReset=p=>{if(!p||!p.state)return Z_STREAM_ERROR$1;const l=p.state;return l.wsize=0,l.whave=0,l.wnext=0,inflateResetKeep(p)},inflateReset2=(p,l)=>{let g;if(!p||!p.state)return Z_STREAM_ERROR$1;const m=p.state;return l<0?(g=0,l=-l):(g=(l>>4)+1,l<48&&(l&=15)),l&&(l<8||l>15)?Z_STREAM_ERROR$1:(m.window!==null&&m.wbits!==l&&(m.window=null),m.wrap=g,m.wbits=l,inflateReset(p))},inflateInit2=(p,l)=>{if(!p)return Z_STREAM_ERROR$1;const g=new InflateState;p.state=g,g.window=null;const m=inflateReset2(p,l);return m!==Z_OK$1&&(p.state=null),m},inflateInit=p=>inflateInit2(p,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=p=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let l=0;for(;l<144;)p.lens[l++]=8;for(;l<256;)p.lens[l++]=9;for(;l<280;)p.lens[l++]=7;for(;l<288;)p.lens[l++]=8;for(inftrees(LENS,p.lens,0,288,lenfix,0,p.work,{bits:9}),l=0;l<32;)p.lens[l++]=5;inftrees(DISTS,p.lens,0,32,distfix,0,p.work,{bits:5}),virgin=!1}p.lencode=lenfix,p.lenbits=9,p.distcode=distfix,p.distbits=5},updatewindow=(p,l,g,m)=>{let x;const E=p.state;return E.window===null&&(E.wsize=1<<E.wbits,E.wnext=0,E.whave=0,E.window=new Uint8Array(E.wsize)),m>=E.wsize?(E.window.set(l.subarray(g-E.wsize,g),0),E.wnext=0,E.whave=E.wsize):(x=E.wsize-E.wnext,x>m&&(x=m),E.window.set(l.subarray(g-m,g-m+x),E.wnext),m-=x,m?(E.window.set(l.subarray(g-m,g),0),E.wnext=m,E.whave=E.wsize):(E.wnext+=x,E.wnext===E.wsize&&(E.wnext=0),E.whave<E.wsize&&(E.whave+=x))),0},inflate$2=(p,l)=>{let g,m,x,E,S,h,I,T,A,k,P,D,M,F,N=0,B,U,O,V,Z,W,Y,X;const J=new Uint8Array(4);let q,te;const ne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!p||!p.state||!p.output||!p.input&&p.avail_in!==0)return Z_STREAM_ERROR$1;g=p.state,g.mode===TYPE&&(g.mode=TYPEDO),S=p.next_out,x=p.output,I=p.avail_out,E=p.next_in,m=p.input,h=p.avail_in,T=g.hold,A=g.bits,k=h,P=I,X=Z_OK$1;e:for(;;)switch(g.mode){case HEAD:if(g.wrap===0){g.mode=TYPEDO;break}for(;A<16;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(g.wrap&2&&T===35615){g.check=0,J[0]=T&255,J[1]=T>>>8&255,g.check=crc32_1(g.check,J,2,0),T=0,A=0,g.mode=FLAGS;break}if(g.flags=0,g.head&&(g.head.done=!1),!(g.wrap&1)||(((T&255)<<8)+(T>>8))%31){p.msg="incorrect header check",g.mode=BAD;break}if((T&15)!==Z_DEFLATED){p.msg="unknown compression method",g.mode=BAD;break}if(T>>>=4,A-=4,Y=(T&15)+8,g.wbits===0)g.wbits=Y;else if(Y>g.wbits){p.msg="invalid window size",g.mode=BAD;break}g.dmax=1<<g.wbits,p.adler=g.check=1,g.mode=T&512?DICTID:TYPE,T=0,A=0;break;case FLAGS:for(;A<16;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(g.flags=T,(g.flags&255)!==Z_DEFLATED){p.msg="unknown compression method",g.mode=BAD;break}if(g.flags&57344){p.msg="unknown header flags set",g.mode=BAD;break}g.head&&(g.head.text=T>>8&1),g.flags&512&&(J[0]=T&255,J[1]=T>>>8&255,g.check=crc32_1(g.check,J,2,0)),T=0,A=0,g.mode=TIME;case TIME:for(;A<32;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.head&&(g.head.time=T),g.flags&512&&(J[0]=T&255,J[1]=T>>>8&255,J[2]=T>>>16&255,J[3]=T>>>24&255,g.check=crc32_1(g.check,J,4,0)),T=0,A=0,g.mode=OS;case OS:for(;A<16;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.head&&(g.head.xflags=T&255,g.head.os=T>>8),g.flags&512&&(J[0]=T&255,J[1]=T>>>8&255,g.check=crc32_1(g.check,J,2,0)),T=0,A=0,g.mode=EXLEN;case EXLEN:if(g.flags&1024){for(;A<16;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.length=T,g.head&&(g.head.extra_len=T),g.flags&512&&(J[0]=T&255,J[1]=T>>>8&255,g.check=crc32_1(g.check,J,2,0)),T=0,A=0}else g.head&&(g.head.extra=null);g.mode=EXTRA;case EXTRA:if(g.flags&1024&&(D=g.length,D>h&&(D=h),D&&(g.head&&(Y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Uint8Array(g.head.extra_len)),g.head.extra.set(m.subarray(E,E+D),Y)),g.flags&512&&(g.check=crc32_1(g.check,m,D,E)),h-=D,E+=D,g.length-=D),g.length))break e;g.length=0,g.mode=NAME;case NAME:if(g.flags&2048){if(h===0)break e;D=0;do Y=m[E+D++],g.head&&Y&&g.length<65536&&(g.head.name+=String.fromCharCode(Y));while(Y&&D<h);if(g.flags&512&&(g.check=crc32_1(g.check,m,D,E)),h-=D,E+=D,Y)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=COMMENT;case COMMENT:if(g.flags&4096){if(h===0)break e;D=0;do Y=m[E+D++],g.head&&Y&&g.length<65536&&(g.head.comment+=String.fromCharCode(Y));while(Y&&D<h);if(g.flags&512&&(g.check=crc32_1(g.check,m,D,E)),h-=D,E+=D,Y)break e}else g.head&&(g.head.comment=null);g.mode=HCRC;case HCRC:if(g.flags&512){for(;A<16;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(T!==(g.check&65535)){p.msg="header crc mismatch",g.mode=BAD;break}T=0,A=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),p.adler=g.check=0,g.mode=TYPE;break;case DICTID:for(;A<32;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}p.adler=g.check=zswap32(T),T=0,A=0,g.mode=DICT;case DICT:if(g.havedict===0)return p.next_out=S,p.avail_out=I,p.next_in=E,p.avail_in=h,g.hold=T,g.bits=A,Z_NEED_DICT$1;p.adler=g.check=1,g.mode=TYPE;case TYPE:if(l===Z_BLOCK||l===Z_TREES)break e;case TYPEDO:if(g.last){T>>>=A&7,A-=A&7,g.mode=CHECK;break}for(;A<3;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}switch(g.last=T&1,T>>>=1,A-=1,T&3){case 0:g.mode=STORED;break;case 1:if(fixedtables(g),g.mode=LEN_,l===Z_TREES){T>>>=2,A-=2;break e}break;case 2:g.mode=TABLE;break;case 3:p.msg="invalid block type",g.mode=BAD}T>>>=2,A-=2;break;case STORED:for(T>>>=A&7,A-=A&7;A<32;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if((T&65535)!=(T>>>16^65535)){p.msg="invalid stored block lengths",g.mode=BAD;break}if(g.length=T&65535,T=0,A=0,g.mode=COPY_,l===Z_TREES)break e;case COPY_:g.mode=COPY;case COPY:if(D=g.length,D){if(D>h&&(D=h),D>I&&(D=I),D===0)break e;x.set(m.subarray(E,E+D),S),h-=D,E+=D,I-=D,S+=D,g.length-=D;break}g.mode=TYPE;break;case TABLE:for(;A<14;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(g.nlen=(T&31)+257,T>>>=5,A-=5,g.ndist=(T&31)+1,T>>>=5,A-=5,g.ncode=(T&15)+4,T>>>=4,A-=4,g.nlen>286||g.ndist>30){p.msg="too many length or distance symbols",g.mode=BAD;break}g.have=0,g.mode=LENLENS;case LENLENS:for(;g.have<g.ncode;){for(;A<3;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.lens[ne[g.have++]]=T&7,T>>>=3,A-=3}for(;g.have<19;)g.lens[ne[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,q={bits:g.lenbits},X=inftrees(CODES,g.lens,0,19,g.lencode,0,g.work,q),g.lenbits=q.bits,X){p.msg="invalid code lengths set",g.mode=BAD;break}g.have=0,g.mode=CODELENS;case CODELENS:for(;g.have<g.nlen+g.ndist;){for(;N=g.lencode[T&(1<<g.lenbits)-1],B=N>>>24,U=N>>>16&255,O=N&65535,!(B<=A);){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(O<16)T>>>=B,A-=B,g.lens[g.have++]=O;else{if(O===16){for(te=B+2;A<te;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(T>>>=B,A-=B,g.have===0){p.msg="invalid bit length repeat",g.mode=BAD;break}Y=g.lens[g.have-1],D=3+(T&3),T>>>=2,A-=2}else if(O===17){for(te=B+3;A<te;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}T>>>=B,A-=B,Y=0,D=3+(T&7),T>>>=3,A-=3}else{for(te=B+7;A<te;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}T>>>=B,A-=B,Y=0,D=11+(T&127),T>>>=7,A-=7}if(g.have+D>g.nlen+g.ndist){p.msg="invalid bit length repeat",g.mode=BAD;break}for(;D--;)g.lens[g.have++]=Y}}if(g.mode===BAD)break;if(g.lens[256]===0){p.msg="invalid code -- missing end-of-block",g.mode=BAD;break}if(g.lenbits=9,q={bits:g.lenbits},X=inftrees(LENS,g.lens,0,g.nlen,g.lencode,0,g.work,q),g.lenbits=q.bits,X){p.msg="invalid literal/lengths set",g.mode=BAD;break}if(g.distbits=6,g.distcode=g.distdyn,q={bits:g.distbits},X=inftrees(DISTS,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,q),g.distbits=q.bits,X){p.msg="invalid distances set",g.mode=BAD;break}if(g.mode=LEN_,l===Z_TREES)break e;case LEN_:g.mode=LEN;case LEN:if(h>=6&&I>=258){p.next_out=S,p.avail_out=I,p.next_in=E,p.avail_in=h,g.hold=T,g.bits=A,inffast(p,P),S=p.next_out,x=p.output,I=p.avail_out,E=p.next_in,m=p.input,h=p.avail_in,T=g.hold,A=g.bits,g.mode===TYPE&&(g.back=-1);break}for(g.back=0;N=g.lencode[T&(1<<g.lenbits)-1],B=N>>>24,U=N>>>16&255,O=N&65535,!(B<=A);){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(U&&(U&240)==0){for(V=B,Z=U,W=O;N=g.lencode[W+((T&(1<<V+Z)-1)>>V)],B=N>>>24,U=N>>>16&255,O=N&65535,!(V+B<=A);){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}T>>>=V,A-=V,g.back+=V}if(T>>>=B,A-=B,g.back+=B,g.length=O,U===0){g.mode=LIT;break}if(U&32){g.back=-1,g.mode=TYPE;break}if(U&64){p.msg="invalid literal/length code",g.mode=BAD;break}g.extra=U&15,g.mode=LENEXT;case LENEXT:if(g.extra){for(te=g.extra;A<te;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.length+=T&(1<<g.extra)-1,T>>>=g.extra,A-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=DIST;case DIST:for(;N=g.distcode[T&(1<<g.distbits)-1],B=N>>>24,U=N>>>16&255,O=N&65535,!(B<=A);){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if((U&240)==0){for(V=B,Z=U,W=O;N=g.distcode[W+((T&(1<<V+Z)-1)>>V)],B=N>>>24,U=N>>>16&255,O=N&65535,!(V+B<=A);){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}T>>>=V,A-=V,g.back+=V}if(T>>>=B,A-=B,g.back+=B,U&64){p.msg="invalid distance code",g.mode=BAD;break}g.offset=O,g.extra=U&15,g.mode=DISTEXT;case DISTEXT:if(g.extra){for(te=g.extra;A<te;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}g.offset+=T&(1<<g.extra)-1,T>>>=g.extra,A-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){p.msg="invalid distance too far back",g.mode=BAD;break}g.mode=MATCH;case MATCH:if(I===0)break e;if(D=P-I,g.offset>D){if(D=g.offset-D,D>g.whave&&g.sane){p.msg="invalid distance too far back",g.mode=BAD;break}D>g.wnext?(D-=g.wnext,M=g.wsize-D):M=g.wnext-D,D>g.length&&(D=g.length),F=g.window}else F=x,M=S-g.offset,D=g.length;D>I&&(D=I),I-=D,g.length-=D;do x[S++]=F[M++];while(--D);g.length===0&&(g.mode=LEN);break;case LIT:if(I===0)break e;x[S++]=g.length,I--,g.mode=LEN;break;case CHECK:if(g.wrap){for(;A<32;){if(h===0)break e;h--,T|=m[E++]<<A,A+=8}if(P-=I,p.total_out+=P,g.total+=P,P&&(p.adler=g.check=g.flags?crc32_1(g.check,x,P,S-P):adler32_1(g.check,x,P,S-P)),P=I,(g.flags?T:zswap32(T))!==g.check){p.msg="incorrect data check",g.mode=BAD;break}T=0,A=0}g.mode=LENGTH;case LENGTH:if(g.wrap&&g.flags){for(;A<32;){if(h===0)break e;h--,T+=m[E++]<<A,A+=8}if(T!==(g.total&4294967295)){p.msg="incorrect length check",g.mode=BAD;break}T=0,A=0}g.mode=DONE;case DONE:X=Z_STREAM_END$1;break e;case BAD:X=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return p.next_out=S,p.avail_out=I,p.next_in=E,p.avail_in=h,g.hold=T,g.bits=A,(g.wsize||P!==p.avail_out&&g.mode<BAD&&(g.mode<CHECK||l!==Z_FINISH$1))&&updatewindow(p,p.output,p.next_out,P-p.avail_out),k-=p.avail_in,P-=p.avail_out,p.total_in+=k,p.total_out+=P,g.total+=P,g.wrap&&P&&(p.adler=g.check=g.flags?crc32_1(g.check,x,P,p.next_out-P):adler32_1(g.check,x,P,p.next_out-P)),p.data_type=g.bits+(g.last?64:0)+(g.mode===TYPE?128:0)+(g.mode===LEN_||g.mode===COPY_?256:0),(k===0&&P===0||l===Z_FINISH$1)&&X===Z_OK$1&&(X=Z_BUF_ERROR),X},inflateEnd=p=>{if(!p||!p.state)return Z_STREAM_ERROR$1;let l=p.state;return l.window&&(l.window=null),p.state=null,Z_OK$1},inflateGetHeader=(p,l)=>{if(!p||!p.state)return Z_STREAM_ERROR$1;const g=p.state;return(g.wrap&2)==0?Z_STREAM_ERROR$1:(g.head=l,l.done=!1,Z_OK$1)},inflateSetDictionary=(p,l)=>{const g=l.length;let m,x,E;return!p||!p.state||(m=p.state,m.wrap!==0&&m.mode!==DICT)?Z_STREAM_ERROR$1:m.mode===DICT&&(x=1,x=adler32_1(x,l,g,0),x!==m.check)?Z_DATA_ERROR$1:(E=updatewindow(p,l,g,g),E?(m.mode=MEM,Z_MEM_ERROR$1):(m.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$3=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(p){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},p||{});const l=this.options;l.raw&&l.windowBits>=0&&l.windowBits<16&&(l.windowBits=-l.windowBits,l.windowBits===0&&(l.windowBits=-15)),l.windowBits>=0&&l.windowBits<16&&!(p&&p.windowBits)&&(l.windowBits+=32),l.windowBits>15&&l.windowBits<48&&(l.windowBits&15)==0&&(l.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let g=inflate_1$2.inflateInit2(this.strm,l.windowBits);if(g!==Z_OK)throw new Error(messages[g]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),l.dictionary&&(typeof l.dictionary=="string"?l.dictionary=strings.string2buf(l.dictionary):toString$3.call(l.dictionary)==="[object ArrayBuffer]"&&(l.dictionary=new Uint8Array(l.dictionary)),l.raw&&(g=inflate_1$2.inflateSetDictionary(this.strm,l.dictionary),g!==Z_OK)))throw new Error(messages[g])}Inflate$1.prototype.push=function(p,l){const g=this.strm,m=this.options.chunkSize,x=this.options.dictionary;let E,S,h;if(this.ended)return!1;for(l===~~l?S=l:S=l===!0?Z_FINISH:Z_NO_FLUSH,toString$3.call(p)==="[object ArrayBuffer]"?g.input=new Uint8Array(p):g.input=p,g.next_in=0,g.avail_in=g.input.length;;){for(g.avail_out===0&&(g.output=new Uint8Array(m),g.next_out=0,g.avail_out=m),E=inflate_1$2.inflate(g,S),E===Z_NEED_DICT&&x&&(E=inflate_1$2.inflateSetDictionary(g,x),E===Z_OK?E=inflate_1$2.inflate(g,S):E===Z_DATA_ERROR&&(E=Z_NEED_DICT));g.avail_in>0&&E===Z_STREAM_END&&g.state.wrap>0&&p[g.next_in]!==0;)inflate_1$2.inflateReset(g),E=inflate_1$2.inflate(g,S);switch(E){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(E),this.ended=!0,!1}if(h=g.avail_out,g.next_out&&(g.avail_out===0||E===Z_STREAM_END))if(this.options.to==="string"){let I=strings.utf8border(g.output,g.next_out),T=g.next_out-I,A=strings.buf2string(g.output,I);g.next_out=T,g.avail_out=m-T,T&&g.output.set(g.output.subarray(I,I+T),0),this.onData(A)}else this.onData(g.output.length===g.next_out?g.output:g.output.subarray(0,g.next_out));if(!(E===Z_OK&&h===0)){if(E===Z_STREAM_END)return E=inflate_1$2.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,!0;if(g.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(p){this.chunks.push(p)};Inflate$1.prototype.onEnd=function(p){p===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};function inflate$1(p,l){const g=new Inflate$1(l);if(g.push(p),g.err)throw g.msg||messages[g.err];return g.result}function inflateRaw$1(p,l){return l=l||{},l.raw=!0,inflate$1(p,l)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$5=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$5};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let p=0;p<256;p++){let l=p;for(let g=0;g<8;g++)l&1?l=3988292384^l>>>1:l=l>>>1;crcTable[p]=l}const initialCrc=4294967295;function updateCrc(p,l,g){let m=p;for(let x=0;x<g;x++)m=crcTable[(m^l[x])&255]^m>>>8;return m}function crc(p,l){return(updateCrc(initialCrc,p,l)^initialCrc)>>>0}var ColorType;(function(p){p[p.UNKNOWN=-1]="UNKNOWN",p[p.GREYSCALE=0]="GREYSCALE",p[p.TRUECOLOUR=2]="TRUECOLOUR",p[p.INDEXED_COLOUR=3]="INDEXED_COLOUR",p[p.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",p[p.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(p){p[p.UNKNOWN=-1]="UNKNOWN",p[p.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(p){p[p.UNKNOWN=-1]="UNKNOWN",p[p.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(p){p[p.UNKNOWN=-1]="UNKNOWN",p[p.NO_INTERLACE=0]="NO_INTERLACE",p[p.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(l,g={}){super(l);const{checkCrc:m=!1}=g;this._checkCrc=m,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let l=0;l<pngSignature.length;l++)if(this.readUint8()!==pngSignature[l])throw new Error(`wrong PNG signature. Byte at ${l} should be ${pngSignature[l]}.`)}decodeChunk(){const l=this.readUint32(),g=this.readChars(4),m=this.offset;switch(g){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(l);break;case"IDAT":this.decodeIDAT(l);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(l);break;case"iCCP":this.decodeiCCP(l);break;case"tEXt":this.decodetEXt(l);break;case"pHYs":this.decodepHYs();break;default:this.skip(l);break}if(this.offset-m!==l)throw new Error(`Length mismatch while decoding chunk ${g}`);if(this._checkCrc){const x=this.readUint32(),E=l+4,S=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-E-4,E),E);if(S!==x)throw new Error(`CRC mismatch for chunk ${g}. Expected ${x}, found ${S}`)}else this.skip(4)}decodeIHDR(){const l=this._png;l.width=this.readUint32(),l.height=this.readUint32(),l.depth=checkBitDepth(this.readUint8());const g=this.readUint8();this._colorType=g;let m;switch(g){case ColorType.GREYSCALE:m=1;break;case ColorType.TRUECOLOUR:m=3;break;case ColorType.INDEXED_COLOUR:m=1;break;case ColorType.GREYSCALE_ALPHA:m=2;break;case ColorType.TRUECOLOUR_ALPHA:m=4;break;default:throw new Error(`Unknown color type: ${g}`)}if(this._png.channels=m,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(l){if(l%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${l}`);const g=l/3;this._hasPalette=!0;const m=[];this._palette=m;for(let x=0;x<g;x++)m.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(l){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,l)),this.skip(l)}decodetRNS(l){if(this._colorType===3){if(l>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${l} vs ${this._palette.length})`);let g=0;for(;g<l;g++){const m=this.readByte();this._palette[g].push(m)}for(;g<this._palette.length;g++)this._palette[g].push(255)}}decodeiCCP(l){let g="",m;for(;(m=this.readChar())!==NULL;)g+=m;const x=this.readUint8();if(x!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${x}`);const E=this.readBytes(l-g.length-2);this._png.iccEmbeddedProfile={name:g,profile:inflate_1(E)}}decodetEXt(l){let g="",m;for(;(m=this.readChar())!==NULL;)g+=m;this._png.text[g]=this.readChars(l-g.length-1)}decodepHYs(){const l=this.readUint32(),g=this.readUint32(),m=this.readByte();this._png.resolution={x:l,y:g,unit:m}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const l=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(l);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(l){const g=this._png.height,m=this._png.channels*this._png.depth/8,x=this._png.width*m,E=new Uint8Array(this._png.height*x);let S=empty,h=0,I,T;for(let A=0;A<g;A++){switch(I=l.subarray(h+1,h+1+x),T=E.subarray(A*x,(A+1)*x),l[h]){case 0:unfilterNone(I,T,x);break;case 1:unfilterSub(I,T,x,m);break;case 2:unfilterUp(I,T,S,x);break;case 3:unfilterAverage(I,T,S,x,m);break;case 4:unfilterPaeth(I,T,S,x,m);break;default:throw new Error(`Unsupported filter: ${l[h]}`)}S=T,h+=x+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const A=new Uint16Array(E.buffer);if(osIsLittleEndian)for(let k=0;k<A.length;k++)A[k]=swap16(A[k]);this._png.data=A}else this._png.data=E}}function unfilterNone(p,l,g){for(let m=0;m<g;m++)l[m]=p[m]}function unfilterSub(p,l,g,m){let x=0;for(;x<m;x++)l[x]=p[x];for(;x<g;x++)l[x]=p[x]+l[x-m]&255}function unfilterUp(p,l,g,m){let x=0;if(g.length===0)for(;x<m;x++)l[x]=p[x];else for(;x<m;x++)l[x]=p[x]+g[x]&255}function unfilterAverage(p,l,g,m,x){let E=0;if(g.length===0){for(;E<x;E++)l[E]=p[E];for(;E<m;E++)l[E]=p[E]+(l[E-x]>>1)&255}else{for(;E<x;E++)l[E]=p[E]+(g[E]>>1)&255;for(;E<m;E++)l[E]=p[E]+(l[E-x]+g[E]>>1)&255}}function unfilterPaeth(p,l,g,m,x){let E=0;if(g.length===0){for(;E<x;E++)l[E]=p[E];for(;E<m;E++)l[E]=p[E]+l[E-x]&255}else{for(;E<x;E++)l[E]=p[E]+g[E]&255;for(;E<m;E++)l[E]=p[E]+paethPredictor(l[E-x],g[E],g[E-x])&255}}function paethPredictor(p,l,g){const m=p+l-g,x=Math.abs(m-p),E=Math.abs(m-l),S=Math.abs(m-g);return x<=E&&x<=S?p:E<=S?l:g}function swap16(p){return(p&255)<<8|p>>8&255}function checkBitDepth(p){if(p!==1&&p!==2&&p!==4&&p!==8&&p!==16)throw new Error(`invalid bit depth: ${p}`);return p}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(l,g={}){super();this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,g.zlib),this._png=this._checkData(l),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(l){this.writeUint32(l.length),this.writeChars("IDAT"),this.writeBytes(l),this.writeCrc(l.length+4)}encodeData(){const{width:l,height:g,channels:m,depth:x,data:E}=this._png,S=m*l,h=new IOBuffer$4().setBigEndian();let I=0;for(let k=0;k<g;k++)if(h.writeByte(0),x===8)I=writeDataBytes(E,h,S,I);else if(x===16)I=writeDataUint16(E,h,S,I);else throw new Error("unreachable");const T=h.toArray(),A=deflate_1(T,this._zlibOptions);this.encodeIDAT(A)}_checkData(l){const{colorType:g,channels:m,depth:x}=getColorType(l),E={width:checkInteger(l.width,"width"),height:checkInteger(l.height,"height"),channels:m,data:l.data,depth:x,text:{}};this._colorType=g;const S=E.width*E.height*m;if(E.data.length!==S)throw new RangeError(`wrong data size. Found ${E.data.length}, expected ${S}`);return E}writeCrc(l){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-l,l),l))}}function checkInteger(p,l){if(Number.isInteger(p)&&p>0)return p;throw new TypeError(`${l} must be a positive integer`)}function getColorType(p){const{channels:l=4,depth:g=8}=p;if(l!==4&&l!==3&&l!==2&&l!==1)throw new RangeError(`unsupported number of channels: ${l}`);if(g!==8&&g!==16)throw new RangeError(`unsupported bit depth: ${g}`);const m={channels:l,depth:g,colorType:ColorType.UNKNOWN};switch(l){case 4:m.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:m.colorType=ColorType.TRUECOLOUR;break;case 1:m.colorType=ColorType.GREYSCALE;break;case 2:m.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return m}function writeDataBytes(p,l,g,m){for(let x=0;x<g;x++)l.writeByte(p[m++]);return m}function writeDataUint16(p,l,g,m){for(let x=0;x<g;x++)l.writeUint16(p[m++]);return m}var ResolutionUnitSpecifier;(function(p){p[p.UNKNOWN=0]="UNKNOWN",p[p.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(p,l){return new PngDecoder(p,l).decode()}function encodePng$1(p,l){return new PngEncoder(p,l).encode()}var encoder$1={exports:{}};(function(p){function l(m){var x=Math.floor,E=new Array(64),S=new Array(64),h=new Array(64),I=new Array(64),T,A,k,P,D=new Array(65535),M=new Array(65535),F=new Array(64),N=new Array(64),B=[],U=0,O=7,V=new Array(64),Z=new Array(64),W=new Array(64),Y=new Array(256),X=new Array(2048),J,q=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],te=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ne=[0,1,2,3,4,5,6,7,8,9,10,11],de=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],oe=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],we=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ae=[0,1,2,3,4,5,6,7,8,9,10,11],ye=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],me=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function xe(ve){for(var _e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],pe=0;pe<64;pe++){var fe=x((_e[pe]*ve+50)/100);fe<1?fe=1:fe>255&&(fe=255),E[q[pe]]=fe}for(var ue=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ce=0;ce<64;ce++){var Ee=x((ue[ce]*ve+50)/100);Ee<1?Ee=1:Ee>255&&(Ee=255),S[q[ce]]=Ee}for(var Ye=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ft=0,_t=0;_t<8;_t++)for(var It=0;It<8;It++)h[ft]=1/(E[q[ft]]*Ye[_t]*Ye[It]*8),I[ft]=1/(S[q[ft]]*Ye[_t]*Ye[It]*8),ft++}function Le(ve,_e){for(var pe=0,fe=0,ue=new Array,ce=1;ce<=16;ce++){for(var Ee=1;Ee<=ve[ce];Ee++)ue[_e[fe]]=[],ue[_e[fe]][0]=pe,ue[_e[fe]][1]=ce,fe++,pe++;pe*=2}return ue}function Ze(){T=Le(te,ne),A=Le(we,Ae),k=Le(de,oe),P=Le(ye,me)}function Xe(){for(var ve=1,_e=2,pe=1;pe<=15;pe++){for(var fe=ve;fe<_e;fe++)M[32767+fe]=pe,D[32767+fe]=[],D[32767+fe][1]=pe,D[32767+fe][0]=fe;for(var ue=-(_e-1);ue<=-ve;ue++)M[32767+ue]=pe,D[32767+ue]=[],D[32767+ue][1]=pe,D[32767+ue][0]=_e-1+ue;ve<<=1,_e<<=1}}function je(){for(var ve=0;ve<256;ve++)X[ve]=19595*ve,X[ve+256>>0]=38470*ve,X[ve+512>>0]=7471*ve+32768,X[ve+768>>0]=-11059*ve,X[ve+1024>>0]=-21709*ve,X[ve+1280>>0]=32768*ve+8421375,X[ve+1536>>0]=-27439*ve,X[ve+1792>>0]=-5329*ve}function Ie(ve){for(var _e=ve[0],pe=ve[1]-1;pe>=0;)_e&1<<pe&&(U|=1<<O),pe--,O--,O<0&&(U==255?(Pe(255),Pe(0)):Pe(U),O=7,U=0)}function Pe(ve){B.push(ve)}function De(ve){Pe(ve>>8&255),Pe(ve&255)}function ze(ve,_e){var pe,fe,ue,ce,Ee,Ye,ft,_t,It=0,$t,Yt=8,ii=64;for($t=0;$t<Yt;++$t){pe=ve[It],fe=ve[It+1],ue=ve[It+2],ce=ve[It+3],Ee=ve[It+4],Ye=ve[It+5],ft=ve[It+6],_t=ve[It+7];var zt=pe+_t,qt=pe-_t,Vt=fe+ft,fi=fe-ft,hi=ue+Ye,Me=ue-Ye,bt=ce+Ee,At=ce-Ee,Bt=zt+bt,pt=zt-bt,Rt=Vt+hi,Ve=Vt-hi;ve[It]=Bt+Rt,ve[It+4]=Bt-Rt;var jt=(Ve+pt)*.707106781;ve[It+2]=pt+jt,ve[It+6]=pt-jt,Bt=At+Me,Rt=Me+fi,Ve=fi+qt;var mi=(Bt-Ve)*.382683433,ie=.5411961*Bt+mi,ke=1.306562965*Ve+mi,Ke=Rt*.707106781,re=qt+Ke,le=qt-Ke;ve[It+5]=le+ie,ve[It+3]=le-ie,ve[It+1]=re+ke,ve[It+7]=re-ke,It+=8}for(It=0,$t=0;$t<Yt;++$t){pe=ve[It],fe=ve[It+8],ue=ve[It+16],ce=ve[It+24],Ee=ve[It+32],Ye=ve[It+40],ft=ve[It+48],_t=ve[It+56];var Se=pe+_t,Ne=pe-_t,We=fe+ft,nt=fe-ft,vt=ue+Ye,Dt=ue-Ye,wt=ce+Ee,Tt=ce-Ee,Nt=Se+wt,ri=Se-wt,Ht=We+vt,_i=We-vt;ve[It]=Nt+Ht,ve[It+32]=Nt-Ht;var ai=(_i+ri)*.707106781;ve[It+16]=ri+ai,ve[It+48]=ri-ai,Nt=Tt+Dt,Ht=Dt+nt,_i=nt+Ne;var Ct=(Nt-_i)*.382683433,Ut=.5411961*Nt+Ct,Mi=1.306562965*_i+Ct,ki=Ht*.707106781,Si=Ne+ki,Bi=Ne-ki;ve[It+40]=Bi+Ut,ve[It+24]=Bi-Ut,ve[It+8]=Si+Mi,ve[It+56]=Si-Mi,It++}var zi;for($t=0;$t<ii;++$t)zi=ve[$t]*_e[$t],F[$t]=zi>0?zi+.5|0:zi-.5|0;return F}function it(){De(65504),De(16),Pe(74),Pe(70),Pe(73),Pe(70),Pe(0),Pe(1),Pe(1),Pe(0),De(1),De(1),Pe(0),Pe(0)}function tt(ve){if(!!ve){De(65505),ve[0]===69&&ve[1]===120&&ve[2]===105&&ve[3]===102?De(ve.length+2):(De(ve.length+5+2),Pe(69),Pe(120),Pe(105),Pe(102),Pe(0));for(var _e=0;_e<ve.length;_e++)Pe(ve[_e])}}function ot(ve,_e){De(65472),De(17),Pe(8),De(_e),De(ve),Pe(3),Pe(1),Pe(17),Pe(0),Pe(2),Pe(17),Pe(1),Pe(3),Pe(17),Pe(1)}function lt(){De(65499),De(132),Pe(0);for(var ve=0;ve<64;ve++)Pe(E[ve]);Pe(1);for(var _e=0;_e<64;_e++)Pe(S[_e])}function St(){De(65476),De(418),Pe(0);for(var ve=0;ve<16;ve++)Pe(te[ve+1]);for(var _e=0;_e<=11;_e++)Pe(ne[_e]);Pe(16);for(var pe=0;pe<16;pe++)Pe(de[pe+1]);for(var fe=0;fe<=161;fe++)Pe(oe[fe]);Pe(1);for(var ue=0;ue<16;ue++)Pe(we[ue+1]);for(var ce=0;ce<=11;ce++)Pe(Ae[ce]);Pe(17);for(var Ee=0;Ee<16;Ee++)Pe(ye[Ee+1]);for(var Ye=0;Ye<=161;Ye++)Pe(me[Ye])}function et(){De(65498),De(12),Pe(3),Pe(1),Pe(0),Pe(2),Pe(17),Pe(3),Pe(17),Pe(0),Pe(63),Pe(0)}function Je(ve,_e,pe,fe,ue){for(var ce=ue[0],Ee=ue[240],Ye,ft=16,_t=63,It=64,$t=ze(ve,_e),Yt=0;Yt<It;++Yt)N[q[Yt]]=$t[Yt];var ii=N[0]-pe;pe=N[0],ii==0?Ie(fe[0]):(Ye=32767+ii,Ie(fe[M[Ye]]),Ie(D[Ye]));for(var zt=63;zt>0&&N[zt]==0;zt--);if(zt==0)return Ie(ce),pe;for(var qt=1,Vt;qt<=zt;){for(var fi=qt;N[qt]==0&&qt<=zt;++qt);var hi=qt-fi;if(hi>=ft){Vt=hi>>4;for(var Me=1;Me<=Vt;++Me)Ie(Ee);hi=hi&15}Ye=32767+N[qt],Ie(ue[(hi<<4)+M[Ye]]),Ie(D[Ye]),qt++}return zt!=_t&&Ie(ce),pe}function Be(){for(var ve=String.fromCharCode,_e=0;_e<256;_e++)Y[_e]=ve(_e)}this.encode=function(ve,_e){new Date().getTime(),_e&&Ge(_e),B=new Array,U=0,O=7,De(65496),it(),tt(ve.exifBuffer),lt(),ot(ve.width,ve.height),St(),et();var pe=0,fe=0,ue=0;U=0,O=7,this.encode.displayName="_encode_";for(var ce=ve.data,Ee=ve.width,Ye=ve.height,ft=Ee*4,_t,It=0,$t,Yt,ii,zt,qt,Vt,fi,hi;It<Ye;){for(_t=0;_t<ft;){for(zt=ft*It+_t,qt=zt,Vt=-1,fi=0,hi=0;hi<64;hi++)fi=hi>>3,Vt=(hi&7)*4,qt=zt+fi*ft+Vt,It+fi>=Ye&&(qt-=ft*(It+1+fi-Ye)),_t+Vt>=ft&&(qt-=_t+Vt-ft+4),$t=ce[qt++],Yt=ce[qt++],ii=ce[qt++],V[hi]=(X[$t]+X[Yt+256>>0]+X[ii+512>>0]>>16)-128,Z[hi]=(X[$t+768>>0]+X[Yt+1024>>0]+X[ii+1280>>0]>>16)-128,W[hi]=(X[$t+1280>>0]+X[Yt+1536>>0]+X[ii+1792>>0]>>16)-128;pe=Je(V,h,pe,T,k),fe=Je(Z,I,fe,A,P),ue=Je(W,I,ue,A,P),_t+=32}It+=8}if(O>=0){var Me=[];Me[1]=O+1,Me[0]=(1<<O+1)-1,Ie(Me)}return De(65497),Buffer.from(B)};function Ge(ve){if(ve<=0&&(ve=1),ve>100&&(ve=100),J!=ve){var _e=0;ve<50?_e=Math.floor(5e3/ve):_e=Math.floor(200-ve*2),xe(_e),J=ve}}function He(){var ve=new Date().getTime();m||(m=50),Be(),Ze(),Xe(),je(),Ge(m),new Date().getTime()-ve}He()}p.exports=g;function g(m,x){typeof x=="undefined"&&(x=50);var E=new l(x),S=E.encode(m,x);return{data:S,width:m.width,height:m.height}}})(encoder$1);var decoder$1={exports:{}};(function(p){var l=function(){var x=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),E=4017,S=799,h=3406,I=2276,T=1567,A=3784,k=5793,P=2896;function D(){}function M(Z,W){for(var Y=0,X=[],J,q,te=16;te>0&&!Z[te-1];)te--;X.push({children:[],index:0});var ne=X[0],de;for(J=0;J<te;J++){for(q=0;q<Z[J];q++){for(ne=X.pop(),ne.children[ne.index]=W[Y];ne.index>0;){if(X.length===0)throw new Error("Could not recreate Huffman Table");ne=X.pop()}for(ne.index++,X.push(ne);X.length<=J;)X.push(de={children:[],index:0}),ne.children[ne.index]=de.children,ne=de;Y++}J+1<te&&(X.push(de={children:[],index:0}),ne.children[ne.index]=de.children,ne=de)}return X[0].children}function F(Z,W,Y,X,J,q,te,ne,de,oe){Y.precision,Y.samplesPerLine,Y.scanLines;var we=Y.mcusPerLine,Ae=Y.progressive;Y.maxH,Y.maxV;var ye=W,me=0,xe=0;function Le(){if(xe>0)return xe--,me>>xe&1;if(me=Z[W++],me==255){var ft=Z[W++];if(ft)throw new Error("unexpected marker: "+(me<<8|ft).toString(16))}return xe=7,me>>>7}function Ze(ft){for(var _t=ft,It;(It=Le())!==null;){if(_t=_t[It],typeof _t=="number")return _t;if(typeof _t!="object")throw new Error("invalid huffman sequence")}return null}function Xe(ft){for(var _t=0;ft>0;){var It=Le();if(It===null)return;_t=_t<<1|It,ft--}return _t}function je(ft){var _t=Xe(ft);return _t>=1<<ft-1?_t:_t+(-1<<ft)+1}function Ie(ft,_t){var It=Ze(ft.huffmanTableDC),$t=It===0?0:je(It);_t[0]=ft.pred+=$t;for(var Yt=1;Yt<64;){var ii=Ze(ft.huffmanTableAC),zt=ii&15,qt=ii>>4;if(zt===0){if(qt<15)break;Yt+=16;continue}Yt+=qt;var Vt=x[Yt];_t[Vt]=je(zt),Yt++}}function Pe(ft,_t){var It=Ze(ft.huffmanTableDC),$t=It===0?0:je(It)<<de;_t[0]=ft.pred+=$t}function De(ft,_t){_t[0]|=Le()<<de}var ze=0;function it(ft,_t){if(ze>0){ze--;return}for(var It=q,$t=te;It<=$t;){var Yt=Ze(ft.huffmanTableAC),ii=Yt&15,zt=Yt>>4;if(ii===0){if(zt<15){ze=Xe(zt)+(1<<zt)-1;break}It+=16;continue}It+=zt;var qt=x[It];_t[qt]=je(ii)*(1<<de),It++}}var tt=0,ot;function lt(ft,_t){for(var It=q,$t=te,Yt=0;It<=$t;){var ii=x[It],zt=_t[ii]<0?-1:1;switch(tt){case 0:var qt=Ze(ft.huffmanTableAC),Vt=qt&15,Yt=qt>>4;if(Vt===0)Yt<15?(ze=Xe(Yt)+(1<<Yt),tt=4):(Yt=16,tt=1);else{if(Vt!==1)throw new Error("invalid ACn encoding");ot=je(Vt),tt=Yt?2:3}continue;case 1:case 2:_t[ii]?_t[ii]+=(Le()<<de)*zt:(Yt--,Yt===0&&(tt=tt==2?3:0));break;case 3:_t[ii]?_t[ii]+=(Le()<<de)*zt:(_t[ii]=ot<<de,tt=0);break;case 4:_t[ii]&&(_t[ii]+=(Le()<<de)*zt);break}It++}tt===4&&(ze--,ze===0&&(tt=0))}function St(ft,_t,It,$t,Yt){var ii=It/we|0,zt=It%we,qt=ii*ft.v+$t,Vt=zt*ft.h+Yt;ft.blocks[qt]===void 0&&oe.tolerantDecoding||_t(ft,ft.blocks[qt][Vt])}function et(ft,_t,It){var $t=It/ft.blocksPerLine|0,Yt=It%ft.blocksPerLine;ft.blocks[$t]===void 0&&oe.tolerantDecoding||_t(ft,ft.blocks[$t][Yt])}var Je=X.length,Be,Ge,He,ve,_e,pe;Ae?q===0?pe=ne===0?Pe:De:pe=ne===0?it:lt:pe=Ie;var fe=0,ue,ce;Je==1?ce=X[0].blocksPerLine*X[0].blocksPerColumn:ce=we*Y.mcusPerColumn,J||(J=ce);for(var Ee,Ye;fe<ce;){for(Ge=0;Ge<Je;Ge++)X[Ge].pred=0;if(ze=0,Je==1)for(Be=X[0],_e=0;_e<J;_e++)et(Be,pe,fe),fe++;else for(_e=0;_e<J;_e++){for(Ge=0;Ge<Je;Ge++)for(Be=X[Ge],Ee=Be.h,Ye=Be.v,He=0;He<Ye;He++)for(ve=0;ve<Ee;ve++)St(Be,pe,fe,He,ve);if(fe++,fe===ce)break}if(fe===ce)do{if(Z[W]===255&&Z[W+1]!==0)break;W+=1}while(W<Z.length-2);if(xe=0,ue=Z[W]<<8|Z[W+1],ue<65280)throw new Error("marker was not found");if(ue>=65488&&ue<=65495)W+=2;else break}return W-ye}function N(Z,W){var Y=[],X=W.blocksPerLine,J=W.blocksPerColumn,q=X<<3,te=new Int32Array(64),ne=new Uint8Array(64);function de(Xe,je,Ie){var Pe=W.quantizationTable,De,ze,it,tt,ot,lt,St,et,Je,Be=Ie,Ge;for(Ge=0;Ge<64;Ge++)Be[Ge]=Xe[Ge]*Pe[Ge];for(Ge=0;Ge<8;++Ge){var He=8*Ge;if(Be[1+He]==0&&Be[2+He]==0&&Be[3+He]==0&&Be[4+He]==0&&Be[5+He]==0&&Be[6+He]==0&&Be[7+He]==0){Je=k*Be[0+He]+512>>10,Be[0+He]=Je,Be[1+He]=Je,Be[2+He]=Je,Be[3+He]=Je,Be[4+He]=Je,Be[5+He]=Je,Be[6+He]=Je,Be[7+He]=Je;continue}De=k*Be[0+He]+128>>8,ze=k*Be[4+He]+128>>8,it=Be[2+He],tt=Be[6+He],ot=P*(Be[1+He]-Be[7+He])+128>>8,et=P*(Be[1+He]+Be[7+He])+128>>8,lt=Be[3+He]<<4,St=Be[5+He]<<4,Je=De-ze+1>>1,De=De+ze+1>>1,ze=Je,Je=it*A+tt*T+128>>8,it=it*T-tt*A+128>>8,tt=Je,Je=ot-St+1>>1,ot=ot+St+1>>1,St=Je,Je=et+lt+1>>1,lt=et-lt+1>>1,et=Je,Je=De-tt+1>>1,De=De+tt+1>>1,tt=Je,Je=ze-it+1>>1,ze=ze+it+1>>1,it=Je,Je=ot*I+et*h+2048>>12,ot=ot*h-et*I+2048>>12,et=Je,Je=lt*S+St*E+2048>>12,lt=lt*E-St*S+2048>>12,St=Je,Be[0+He]=De+et,Be[7+He]=De-et,Be[1+He]=ze+St,Be[6+He]=ze-St,Be[2+He]=it+lt,Be[5+He]=it-lt,Be[3+He]=tt+ot,Be[4+He]=tt-ot}for(Ge=0;Ge<8;++Ge){var ve=Ge;if(Be[1*8+ve]==0&&Be[2*8+ve]==0&&Be[3*8+ve]==0&&Be[4*8+ve]==0&&Be[5*8+ve]==0&&Be[6*8+ve]==0&&Be[7*8+ve]==0){Je=k*Ie[Ge+0]+8192>>14,Be[0*8+ve]=Je,Be[1*8+ve]=Je,Be[2*8+ve]=Je,Be[3*8+ve]=Je,Be[4*8+ve]=Je,Be[5*8+ve]=Je,Be[6*8+ve]=Je,Be[7*8+ve]=Je;continue}De=k*Be[0*8+ve]+2048>>12,ze=k*Be[4*8+ve]+2048>>12,it=Be[2*8+ve],tt=Be[6*8+ve],ot=P*(Be[1*8+ve]-Be[7*8+ve])+2048>>12,et=P*(Be[1*8+ve]+Be[7*8+ve])+2048>>12,lt=Be[3*8+ve],St=Be[5*8+ve],Je=De-ze+1>>1,De=De+ze+1>>1,ze=Je,Je=it*A+tt*T+2048>>12,it=it*T-tt*A+2048>>12,tt=Je,Je=ot-St+1>>1,ot=ot+St+1>>1,St=Je,Je=et+lt+1>>1,lt=et-lt+1>>1,et=Je,Je=De-tt+1>>1,De=De+tt+1>>1,tt=Je,Je=ze-it+1>>1,ze=ze+it+1>>1,it=Je,Je=ot*I+et*h+2048>>12,ot=ot*h-et*I+2048>>12,et=Je,Je=lt*S+St*E+2048>>12,lt=lt*E-St*S+2048>>12,St=Je,Be[0*8+ve]=De+et,Be[7*8+ve]=De-et,Be[1*8+ve]=ze+St,Be[6*8+ve]=ze-St,Be[2*8+ve]=it+lt,Be[5*8+ve]=it-lt,Be[3*8+ve]=tt+ot,Be[4*8+ve]=tt-ot}for(Ge=0;Ge<64;++Ge){var _e=128+(Be[Ge]+8>>4);je[Ge]=_e<0?0:_e>255?255:_e}}V(q*J*8);for(var oe,we,Ae=0;Ae<J;Ae++){var ye=Ae<<3;for(oe=0;oe<8;oe++)Y.push(new Uint8Array(q));for(var me=0;me<X;me++){de(W.blocks[Ae][me],ne,te);var xe=0,Le=me<<3;for(we=0;we<8;we++){var Ze=Y[ye+we];for(oe=0;oe<8;oe++)Ze[Le+oe]=ne[xe++]}}}return Y}function B(Z){return Z<0?0:Z>255?255:Z}D.prototype={load:function(W){var Y=new XMLHttpRequest;Y.open("GET",W,!0),Y.responseType="arraybuffer",Y.onload=function(){var X=new Uint8Array(Y.response||Y.mozResponseArrayBuffer);this.parse(X),this.onload&&this.onload()}.bind(this),Y.send(null)},parse:function(W){var Y=this.opts.maxResolutionInMP*1e3*1e3,X=0;W.length;function J(){var zt=W[X]<<8|W[X+1];return X+=2,zt}function q(){var zt=J(),qt=W.subarray(X,X+zt-2);return X+=qt.length,qt}function te(zt){var qt=0,Vt=0,fi,hi;for(hi in zt.components)zt.components.hasOwnProperty(hi)&&(fi=zt.components[hi],qt<fi.h&&(qt=fi.h),Vt<fi.v&&(Vt=fi.v));var Me=Math.ceil(zt.samplesPerLine/8/qt),bt=Math.ceil(zt.scanLines/8/Vt);for(hi in zt.components)if(zt.components.hasOwnProperty(hi)){fi=zt.components[hi];var At=Math.ceil(Math.ceil(zt.samplesPerLine/8)*fi.h/qt),Bt=Math.ceil(Math.ceil(zt.scanLines/8)*fi.v/Vt),pt=Me*fi.h,Rt=bt*fi.v,Ve=Rt*pt,jt=[];V(Ve*256);for(var mi=0;mi<Rt;mi++){for(var ie=[],ke=0;ke<pt;ke++)ie.push(new Int32Array(64));jt.push(ie)}fi.blocksPerLine=At,fi.blocksPerColumn=Bt,fi.blocks=jt}zt.maxH=qt,zt.maxV=Vt,zt.mcusPerLine=Me,zt.mcusPerColumn=bt}var ne=null,de=null,oe,we,Ae=[],ye=[],me=[],xe=[],Le=J(),Ze=-1;if(this.comments=[],Le!=65496)throw new Error("SOI not found");for(Le=J();Le!=65497;){var Xe,je;switch(Le){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Ie=q();if(Le===65534){var Pe=String.fromCharCode.apply(null,Ie);this.comments.push(Pe)}Le===65504&&Ie[0]===74&&Ie[1]===70&&Ie[2]===73&&Ie[3]===70&&Ie[4]===0&&(ne={version:{major:Ie[5],minor:Ie[6]},densityUnits:Ie[7],xDensity:Ie[8]<<8|Ie[9],yDensity:Ie[10]<<8|Ie[11],thumbWidth:Ie[12],thumbHeight:Ie[13],thumbData:Ie.subarray(14,14+3*Ie[12]*Ie[13])}),Le===65505&&Ie[0]===69&&Ie[1]===120&&Ie[2]===105&&Ie[3]===102&&Ie[4]===0&&(this.exifBuffer=Ie.subarray(5,Ie.length)),Le===65518&&Ie[0]===65&&Ie[1]===100&&Ie[2]===111&&Ie[3]===98&&Ie[4]===101&&Ie[5]===0&&(de={version:Ie[6],flags0:Ie[7]<<8|Ie[8],flags1:Ie[9]<<8|Ie[10],transformCode:Ie[11]});break;case 65499:for(var De=J(),ze=De+X-2;X<ze;){var it=W[X++];V(64*4);var tt=new Int32Array(64);if(it>>4==0)for(je=0;je<64;je++){var ot=x[je];tt[ot]=W[X++]}else if(it>>4==1)for(je=0;je<64;je++){var ot=x[je];tt[ot]=J()}else throw new Error("DQT: invalid table spec");Ae[it&15]=tt}break;case 65472:case 65473:case 65474:J(),oe={},oe.extended=Le===65473,oe.progressive=Le===65474,oe.precision=W[X++],oe.scanLines=J(),oe.samplesPerLine=J(),oe.components={},oe.componentsOrder=[];var lt=oe.scanLines*oe.samplesPerLine;if(lt>Y){var St=Math.ceil((lt-Y)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${St}MP`)}var et=W[X++],Je;for(Xe=0;Xe<et;Xe++){Je=W[X];var Be=W[X+1]>>4,Ge=W[X+1]&15,He=W[X+2];oe.componentsOrder.push(Je),oe.components[Je]={h:Be,v:Ge,quantizationIdx:He},X+=3}te(oe),ye.push(oe);break;case 65476:var ve=J();for(Xe=2;Xe<ve;){var _e=W[X++],pe=new Uint8Array(16),fe=0;for(je=0;je<16;je++,X++)fe+=pe[je]=W[X];V(16+fe);var ue=new Uint8Array(fe);for(je=0;je<fe;je++,X++)ue[je]=W[X];Xe+=17+fe,(_e>>4==0?xe:me)[_e&15]=M(pe,ue)}break;case 65501:J(),we=J();break;case 65500:J(),J();break;case 65498:J();var ce=W[X++],Ee=[],Ye;for(Xe=0;Xe<ce;Xe++){Ye=oe.components[W[X++]];var ft=W[X++];Ye.huffmanTableDC=xe[ft>>4],Ye.huffmanTableAC=me[ft&15],Ee.push(Ye)}var _t=W[X++],It=W[X++],$t=W[X++],Yt=F(W,X,oe,Ee,we,_t,It,$t>>4,$t&15,this.opts);X+=Yt;break;case 65535:W[X]!==255&&X--;break;default:if(W[X-3]==255&&W[X-2]>=192&&W[X-2]<=254){X-=3;break}else if(Le===224||Le==225){if(Ze!==-1)throw new Error(`first unknown JPEG marker at offset ${Ze.toString(16)}, second unknown JPEG marker ${Le.toString(16)} at offset ${(X-1).toString(16)}`);Ze=X-1;const zt=J();if(W[X+zt-2]===255){X+=zt-2;break}}throw new Error("unknown JPEG marker "+Le.toString(16))}Le=J()}if(ye.length!=1)throw new Error("only single frame JPEGs supported");for(var Xe=0;Xe<ye.length;Xe++){var ii=ye[Xe].components;for(var je in ii)ii[je].quantizationTable=Ae[ii[je].quantizationIdx],delete ii[je].quantizationIdx}this.width=oe.samplesPerLine,this.height=oe.scanLines,this.jfif=ne,this.adobe=de,this.components=[];for(var Xe=0;Xe<oe.componentsOrder.length;Xe++){var Ye=oe.components[oe.componentsOrder[Xe]];this.components.push({lines:N(oe,Ye),scaleX:Ye.h/oe.maxH,scaleY:Ye.v/oe.maxV})}},getData:function(W,Y){var X=this.width/W,J=this.height/Y,q,te,ne,de,oe,we,Ae,ye,me,xe,Le=0,Ze,Xe,je,Ie,Pe,De,ze,it,tt,ot,lt,St=W*Y*this.components.length;V(St);var et=new Uint8Array(St);switch(this.components.length){case 1:for(q=this.components[0],xe=0;xe<Y;xe++)for(oe=q.lines[0|xe*q.scaleY*J],me=0;me<W;me++)Ze=oe[0|me*q.scaleX*X],et[Le++]=Ze;break;case 2:for(q=this.components[0],te=this.components[1],xe=0;xe<Y;xe++)for(oe=q.lines[0|xe*q.scaleY*J],we=te.lines[0|xe*te.scaleY*J],me=0;me<W;me++)Ze=oe[0|me*q.scaleX*X],et[Le++]=Ze,Ze=we[0|me*te.scaleX*X],et[Le++]=Ze;break;case 3:for(lt=!0,this.adobe&&this.adobe.transformCode?lt=!0:typeof this.opts.colorTransform!="undefined"&&(lt=!!this.opts.colorTransform),q=this.components[0],te=this.components[1],ne=this.components[2],xe=0;xe<Y;xe++)for(oe=q.lines[0|xe*q.scaleY*J],we=te.lines[0|xe*te.scaleY*J],Ae=ne.lines[0|xe*ne.scaleY*J],me=0;me<W;me++)lt?(Ze=oe[0|me*q.scaleX*X],Xe=we[0|me*te.scaleX*X],je=Ae[0|me*ne.scaleX*X],it=B(Ze+1.402*(je-128)),tt=B(Ze-.3441363*(Xe-128)-.71413636*(je-128)),ot=B(Ze+1.772*(Xe-128))):(it=oe[0|me*q.scaleX*X],tt=we[0|me*te.scaleX*X],ot=Ae[0|me*ne.scaleX*X]),et[Le++]=it,et[Le++]=tt,et[Le++]=ot;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(lt=!1,this.adobe&&this.adobe.transformCode?lt=!0:typeof this.opts.colorTransform!="undefined"&&(lt=!!this.opts.colorTransform),q=this.components[0],te=this.components[1],ne=this.components[2],de=this.components[3],xe=0;xe<Y;xe++)for(oe=q.lines[0|xe*q.scaleY*J],we=te.lines[0|xe*te.scaleY*J],Ae=ne.lines[0|xe*ne.scaleY*J],ye=de.lines[0|xe*de.scaleY*J],me=0;me<W;me++)lt?(Ze=oe[0|me*q.scaleX*X],Xe=we[0|me*te.scaleX*X],je=Ae[0|me*ne.scaleX*X],Ie=ye[0|me*de.scaleX*X],Pe=255-B(Ze+1.402*(je-128)),De=255-B(Ze-.3441363*(Xe-128)-.71413636*(je-128)),ze=255-B(Ze+1.772*(Xe-128))):(Pe=oe[0|me*q.scaleX*X],De=we[0|me*te.scaleX*X],ze=Ae[0|me*ne.scaleX*X],Ie=ye[0|me*de.scaleX*X]),et[Le++]=255-Pe,et[Le++]=255-De,et[Le++]=255-ze,et[Le++]=255-Ie;break;default:throw new Error("Unsupported color mode")}return et},copyToImageData:function(W,Y){var X=W.width,J=W.height,q=W.data,te=this.getData(X,J),ne=0,de=0,oe,we,Ae,ye,me,xe,Le,Ze,Xe;switch(this.components.length){case 1:for(we=0;we<J;we++)for(oe=0;oe<X;oe++)Ae=te[ne++],q[de++]=Ae,q[de++]=Ae,q[de++]=Ae,Y&&(q[de++]=255);break;case 3:for(we=0;we<J;we++)for(oe=0;oe<X;oe++)Le=te[ne++],Ze=te[ne++],Xe=te[ne++],q[de++]=Le,q[de++]=Ze,q[de++]=Xe,Y&&(q[de++]=255);break;case 4:for(we=0;we<J;we++)for(oe=0;oe<X;oe++)me=te[ne++],xe=te[ne++],Ae=te[ne++],ye=te[ne++],Le=255-B(me*(1-ye/255)+ye),Ze=255-B(xe*(1-ye/255)+ye),Xe=255-B(Ae*(1-ye/255)+ye),q[de++]=Le,q[de++]=Ze,q[de++]=Xe,Y&&(q[de++]=255);break;default:throw new Error("Unsupported color mode")}}};var U=0,O=0;function V(Z=0){var W=U+Z;if(W>O){var Y=Math.ceil((W-O)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${Y}MB`)}U=W}return D.resetMaxMemoryUsage=function(Z){U=0,O=Z},D.getBytesAllocated=function(){return U},D.requestMemoryAllocation=V,D}();p.exports=g;function g(m,x={}){var E={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},S=ul(ul({},E),x),h=new Uint8Array(m),I=new l;I.opts=S,l.resetMaxMemoryUsage(S.maxMemoryUsageInMB*1024*1024),I.parse(h);var T=S.formatAsRGBA?4:3,A=I.width*I.height*T;try{l.requestMemoryAllocation(A);var k={width:I.width,height:I.height,exifBuffer:I.exifBuffer,data:S.useTArray?new Uint8Array(A):Buffer.alloc(A)};I.comments.length>0&&(k.comments=I.comments)}catch(P){throw P instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+A):P}return I.copyToImageData(k,S.formatAsRGBA),k}})(decoder$1);var encode$2=encoder$1.exports,decode$5=decoder$1.exports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let p=0;p<chars.length;p++)lookup[chars.charCodeAt(p)]=p;function encode$1(p){let l,g=p.length,m="";for(l=0;l<g;l+=3)m+=chars[p[l]>>2],m+=chars[(p[l]&3)<<4|p[l+1]>>4],m+=chars[(p[l+1]&15)<<2|p[l+2]>>6],m+=chars[p[l+2]&63];return g%3==2?m=`${m.substring(0,m.length-1)}=`:g%3==1&&(m=`${m.substring(0,m.length-2)}==`),m}function decode$4(p){let l=p.length*.75,g=p.length,m=0,x,E,S,h;p[p.length-1]==="="&&(l--,p[p.length-2]==="="&&l--);const I=new Uint8Array(l);for(let T=0;T<g;T+=4)x=lookup[p.charCodeAt(T)],E=lookup[p.charCodeAt(T+1)],S=lookup[p.charCodeAt(T+2)],h=lookup[p.charCodeAt(T+3)],I[m++]=x<<2|E>>4,I[m++]=(E&15)<<4|S>>2,I[m++]=(S&3)<<6|h&63;return I}function toBase64URL(p,l){const g=encode$1(p);return`data:${l};base64,${g}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(p,l){let g=self.document.createElement("canvas");return g.width=p,g.height=l,g}function fetchBinary(p,{withCredentials:l=!1}={}){return new Promise(function(g,m){let x=new self.XMLHttpRequest;x.open("GET",p,!0),x.responseType="arraybuffer",x.withCredentials=l,x.onload=function(E){this.status!==200?m(E):g(this.response)},x.onerror=m,x.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(p){return p.includes("/")||(p=`image/${p}`),p}function encodeJpeg(p,l={}){const g={width:p.width,height:p.height,data:p.getRGBAData()};return jpegJs.encode(g,l.quality).data}function encodePng(p,l){const g={width:p.width,height:p.height,channels:p.channels,depth:p.bitDepth,data:p.data};return(g.depth===1||g.depth===32)&&(g.depth=8,g.channels=4,g.data=p.getRGBAData()),encodePng$1(g,l)}const exportMethods={save(p,l={}){const{useCanvas:g=!1,encoder:m=void 0}=l;let{format:x}=l;if(!x){const E=/\.(?<format>[a-zA-Z]+)$/.exec(p);E&&(x=E.groups.format.toLowerCase())}if(!x)throw new Error("file format not provided");return new Promise((E,S)=>{let h,I;switch(x.toLowerCase()){case"png":{g?h=this.getCanvas().pngStream():I=encodePng(this,m);break}case"jpg":case"jpeg":g?h=this.getCanvas().jpegStream():I=encodeJpeg(this,m);break;case"bmp":I=encode$4(this,m);break;default:throw new RangeError(`invalid output format: ${x}`)}if(h){let T=createWriteStream();T.on("finish",E),T.on("error",S),h.pipe(T)}else I&&writeFile()})},toDataURL(p="image/png",l={}){typeof p=="object"&&(l=p,p="image/png");const{useCanvas:g=!1,encoder:m=void 0}=l;p=getType(p);function x(E,S){const h=E(S,m);return toBase64URL(h,p)}return p==="image/bmp"?x(encode$4,this):p==="image/png"&&!g?x(encodePng,this):p==="image/jpeg"&&!g?x(encodeJpeg,this):this.getCanvas().toDataURL(p)},toBuffer(p={}){const{format:l="png",encoder:g=void 0}=p;switch(l.toLowerCase()){case"png":return encodePng(this,g);case"jpeg":case"jpg":return encodeJpeg(this,g);case"bmp":return encode$4(this,g);default:throw new RangeError(`invalid output format: ${l}`)}},toBase64(p="image/png",l={}){if(l.async)return this.toDataURL(p,l).then(function(g){return g.substring(g.indexOf(",")+1)});{const g=this.toDataURL(p,l);return g.substring(g.indexOf(",")+1)}},toBlob(p="image/png",l=.8){return canvasToBlob(this.getCanvas(),p,l)},getCanvas(){const p=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let l=createCanvas(this.width,this.height);return l.getContext("2d").putImageData(p,0,0),l}};function setExportMethods(p){for(const l in exportMethods)p.prototype[l]=exportMethods[l]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"};var require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(p,l){var g=Object.prototype.hasOwnProperty;p.exports=l=function(x,E){return g.call(E,x)},l.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwn=hasOwn$1.exports;let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(p,l,g={}){let{inPlace:m=!1,returnThis:x=!0,partialArgs:E=[]}=g;return m?Image$1.prototype[p]=function(...S){this.computed=null;let h=l.apply(this,[...E,...S]);return x?this:h}:Image$1.prototype[p]=function(...S){return l.apply(this,[...E,...S])},Image$1}function extendProperty(p,l,g={}){let{partialArgs:m=[]}=g;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(p,this.computed))return this.computed[p];let x=l.apply(this,m);return this.computed[p]=x,x},Object.defineProperty(Image$1.prototype,p,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK";var ColorModel=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",GREY:GREY$1,RGB:RGB$1,HSL,HSV,CMYK:CMYK$1});function getRGBAData(p={}){const{clamped:l}=p;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const g=this.width*this.height*4;let m=l?new Uint8ClampedArray(g):new Uint8Array(g);return this.bitDepth===1?fillDataFromBinary(this,m):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,m):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,m))):this.components===1?fillDataFromGrey(this,m):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,m)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,m)):fillAlpha(this,m),m}function fillDataFromBinary(p,l){for(let g=0;g<p.size;g++){const m=p.getBit(g);l[g*4]=m*255,l[g*4+1]=m*255,l[g*4+2]=m*255}}function fillDataFromGrey32(p,l){const g=p.min[0],x=p.max[0]-g;for(let E=0;E<p.size;E++){const S=Math.floor(255*(p.data[E]-g)/x);l[E*4]=S,l[E*4+1]=S,l[E*4+2]=S}}function fillDataFromRGB32(p,l){const g=Math.min(...p.min),x=Math.max(...p.max)-g;for(let E=0;E<p.size;E++){const S=Math.floor(255*(p.data[E*3]-g)/x),h=Math.floor(255*(p.data[E*3+1]-g)/x),I=Math.floor(255*(p.data[E*3+2]-g)/x);l[E*4]=S,l[E*4+1]=h,l[E*4+2]=I}}function fillDataFromGrey(p,l){for(let g=0;g<p.size;g++)l[g*4]=p.data[g*p.channels]>>>p.bitDepth-8,l[g*4+1]=p.data[g*p.channels]>>>p.bitDepth-8,l[g*4+2]=p.data[g*p.channels]>>>p.bitDepth-8}function fillDataFromRGB(p,l){for(let g=0;g<p.size;g++)l[g*4]=p.data[g*p.channels]>>>p.bitDepth-8,l[g*4+1]=p.data[g*p.channels+1]>>>p.bitDepth-8,l[g*4+2]=p.data[g*p.channels+2]>>>p.bitDepth-8}function copyAlpha(p,l){for(let g=0;g<p.size;g++)l[g*4+3]=p.data[g*p.channels+p.components]>>p.bitDepth-8}function fillAlpha(p,l){for(let g=0;g<p.size;g++)l[g*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(p){const l=kinds[p];if(!l)throw new RangeError(`invalid image kind: ${p}`);return l}const validBitDepth=[1,8,16,32];function verifyKindDefinition(p){const{components:l,alpha:g,bitDepth:m,colorModel:x}=p;if(!Number.isInteger(l)||l<=0)throw new RangeError(`invalid components: ${l}. Must be a positive integer`);if(g!==0&&g!==1&&typeof g!="boolean")throw new TypeError(`invalid alpha: ${g}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(m))throw new RangeError(`invalid bitDepth: ${m}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[x])throw new RangeError(`invalid colorModel: ${x}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(p,l,g){let m=l*p;return g===1&&(m=Math.ceil(m/8)),m}function createPixelArray(p,l,g,m,x,E){const S=m*p;let h;switch(x){case 1:h=new Uint8Array(Math.ceil(S/8));break;case 8:h=new Uint8Array(S);break;case 16:h=new Uint16Array(S);break;case 32:h=new Float32Array(S);break;default:throw new Error(`Cannot create pixel array for bit depth ${x}`)}if(g)for(let I=l;I<h.length;I+=m)h[I]=E;return h}const defaultByteLength$1=1024*8,charArray=[];class IOBuffer$3{constructor(l,g){g=g||{},l===void 0&&(l=defaultByteLength$1),typeof l=="number"&&(l=new ArrayBuffer(l));let m=l.byteLength;const x=g.offset?g.offset>>>0:0;l.buffer&&(m=l.byteLength-x,l.byteLength!==l.buffer.byteLength?l=l.buffer.slice(l.byteOffset+x,l.byteOffset+l.byteLength):x?l=l.buffer.slice(x):l=l.buffer),this.buffer=l,this.length=m,this.byteLength=m,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=m||defaultByteLength$1,this._mark=0}available(l){return l===void 0&&(l=1),this.offset+l<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(l){l===void 0&&(l=1),this.offset+=l}seek(l){this.offset=l}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(l){if(l===void 0&&(l=1),!this.available(l)){const g=this._increment+this._increment;this._increment=g;const m=this.length+g,x=new Uint8Array(m);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=m,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(l){l===void 0&&(l=1);for(var g=new Uint8Array(l),m=0;m<l;m++)g[m]=this.readByte();return g}readInt16(){var l=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,l}readUint16(){var l=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,l}readInt32(){var l=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,l}readUint32(){var l=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat32(){var l=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat64(){var l=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,l}readChar(){return String.fromCharCode(this.readInt8())}readChars(l){l===void 0&&(l=1),charArray.length=l;for(var g=0;g<l;g++)charArray[g]=this.readChar();return charArray.join("")}writeBoolean(l){this.writeUint8(l?255:0)}writeInt8(l){this.ensureAvailable(1),this._data.setInt8(this.offset++,l)}writeUint8(l){this.ensureAvailable(1),this._data.setUint8(this.offset++,l)}writeByte(l){this.writeUint8(l)}writeBytes(l){this.ensureAvailable(l.length);for(var g=0;g<l.length;g++)this._data.setUint8(this.offset++,l[g])}writeInt16(l){this.ensureAvailable(2),this._data.setInt16(this.offset,l,this.littleEndian),this.offset+=2}writeUint16(l){this.ensureAvailable(2),this._data.setUint16(this.offset,l,this.littleEndian),this.offset+=2}writeInt32(l){this.ensureAvailable(4),this._data.setInt32(this.offset,l,this.littleEndian),this.offset+=4}writeUint32(l){this.ensureAvailable(4),this._data.setUint32(this.offset,l,this.littleEndian),this.offset+=4}writeFloat32(l){this.ensureAvailable(4),this._data.setFloat32(this.offset,l,this.littleEndian),this.offset+=4}writeFloat64(l){this.ensureAvailable(8),this._data.setFloat64(this.offset,l,this.littleEndian),this.offset+=8}writeChar(l){this.writeUint8(l.charCodeAt(0))}writeChars(l){for(var g=0;g<l.length;g++)this.writeUint8(l.charCodeAt(g))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1=IOBuffer$3,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$4 in tagsById$5)tagsByName$5[tagsById$5[i$4]]=i$4;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$3 in tagsById$4)tagsByName$4[tagsById$4[i$3]]=i$3;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i$2 in tagsById$3)tagsByName$3[tagsById$3[i$2]]=i$2;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$2{constructor(l){if(!l)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=l,this._map=null}get(l){if(typeof l=="number")return this.fields.get(l);if(typeof l=="string")return this.fields.get(tags$1[this.kind].tagsByName[l]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const g=tags$1[this.kind].tagsById;for(var l of this.fields.keys())g[l]&&(this._map[g[l]]=this.fields.get(l))}return this._map}}var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var l=new Date,g=dateTimeRegex$1.exec(this.dateTime);return l.setFullYear(g[1],g[2]-1,g[3]),l.setHours(g[4],g[5],g[6]),l}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray$1(p){return typeof p=="number"?[p]:p}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(p,l){return types$1.get(p)[0]*l};ifdValue.readData=function(p,l,g){return types$1.get(l)[1](p,g)};function readByte$1(p,l){if(l===1)return p.readUint8();for(var g=new Uint8Array(l),m=0;m<l;m++)g[m]=p.readUint8();return g}function readASCII$1(p,l){for(var g=[],m="",x=0;x<l;x++){var E=String.fromCharCode(p.readUint8());E==="\0"?(g.push(m),m=""):m+=E}return g.length===1?g[0]:g}function readShort$1(p,l){if(l===1)return p.readUint16();for(var g=new Uint16Array(l),m=0;m<l;m++)g[m]=p.readUint16();return g}function readLong$1(p,l){if(l===1)return p.readUint32();for(var g=new Uint32Array(l),m=0;m<l;m++)g[m]=p.readUint32();return g}function readRational$1(p,l){if(l===1)return p.readUint32()/p.readUint32();for(var g=new Array(l),m=0;m<l;m++)g[m]=p.readUint32()/p.readUint32();return g}function readSByte$1(p,l){if(l===1)return p.readInt8();for(var g=new Int8Array(l),m=0;m<l;m++)g[m]=p.readInt8();return g}function readSShort$1(p,l){if(l===1)return p.readInt16();for(var g=new Int16Array(l),m=0;m<l;m++)g[m]=p.readInt16();return g}function readSLong$1(p,l){if(l===1)return p.readInt32();for(var g=new Int32Array(l),m=0;m<l;m++)g[m]=p.readInt32();return g}function readSRational$1(p,l){if(l===1)return p.readInt32()/p.readInt32();for(var g=new Array(l),m=0;m<l;m++)g[m]=p.readInt32()/p.readInt32();return g}function readFloat$1(p,l){if(l===1)return p.readFloat32();for(var g=new Float32Array(l),m=0;m<l;m++)g[m]=p.readFloat32();return g}function readDouble$1(p,l){if(l===1)return p.readFloat64();for(var g=new Float64Array(l),m=0;m<l;m++)g[m]=p.readFloat64();return g}const IOBuffer$2=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$2 extends IOBuffer$2{constructor(l,g){super(l,g);this._nextIFD=0}decode(l){l=Object.assign({},defaultOptions$d,l);const g=[];for(this.decodeHeader();this._nextIFD;)if(g.push(this.decodeIFD(l)),l.onlyFirst)return g[0];return g}decodeHeader(){let l=this.readUint16();if(l===18761)this.setLittleEndian();else if(l===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+l.toString(16));if(l=this.readUint16(),l!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(l){this.seek(this._nextIFD);var g;l.kind?g=new IFD$1(l.kind):g=new TiffIFD;const m=this.readUint16();for(var x=0;x<m;x++)this.decodeIFDEntry(g);return l.ignoreImageData||this.decodeImageData(g),this._nextIFD=this.readUint32(),g}decodeIFDEntry(l){const g=this.offset,m=this.readUint16(),x=this.readUint16(),E=this.readUint32();if(x<1||x>12){this.skip(4);return}IFDValue.getByteLength(x,E)>4&&this.seek(this.readUint32());const h=IFDValue.readData(this,x,E);if(l.fields.set(m,h),m===34665||m===34853){let I=this.offset,T;m===34665?T="exif":m===34853&&(T="gps"),this._nextIFD=h,l[T]=this.decodeIFD({kind:T,ignoreImageData:!0}),this.offset=I}this.seek(g),this.skip(12)}decodeImageData(l){const g=l.orientation;switch(g&&g!==1&&unsupported$1("orientation",g),l.type){case 1:case 2:this.readStripData(l);break;default:unsupported$1("image type",l.type);break}}readStripData(l){const g=l.width,m=l.height,x=validateBitDepth(l.bitsPerSample),E=l.sampleFormat;let S=g*m;const h=getDataArray$1(S,1,x,E),I=l.compression,A=l.rowsPerStrip*g,k=l.stripOffsets,P=l.stripByteCounts;for(var D=0,M=0;M<k.length;M++){var F=this.getStripData(I,k[M],P[M]),N=S>A?A:S;S-=N,x===8?D=fill8bit$1(h,F,D,N):x===16?D=fill16bit$1(h,F,D,N,this.isLittleEndian()):x===32&&E===3?D=fillFloat32$1(h,F,D,N,this.isLittleEndian()):unsupported$1("bitDepth",x)}l.data=h}getStripData(l,g,m){switch(l){case 1:return new DataView(this.buffer,g,m);case 2:case 32773:return unsupported$1("Compression",l);default:throw new Error("invalid compression: "+l)}}}var tiffDecoder=TIFFDecoder$2;function getDataArray$1(p,l,g,m){return g===8?new Uint8Array(p*l):g===16?new Uint16Array(p*l):g===32&&m===3?new Float32Array(p*l):unsupported$1("bit depth / sample format",g+" / "+m)}function fill8bit$1(p,l,g,m){for(var x=0;x<m;x++)p[g++]=l.getUint8(x);return g}function fill16bit$1(p,l,g,m,x){for(var E=0;E<m*2;E+=2)p[g++]=l.getUint16(E,x);return g}function fillFloat32$1(p,l,g,m,x){for(var E=0;E<m*4;E+=4)p[g++]=l.getFloat32(E,x);return g}function unsupported$1(p,l){throw new Error("Unsupported "+p+": "+l)}function validateBitDepth(p){if(p.length){const g=p;p=g[0];for(var l=0;l<g.length;l++)g[l]!==p&&unsupported$1("bit depth",g)}return p}const TIFFDecoder$1=tiffDecoder;var decode$3=function(l,g){return new TIFFDecoder$1(l,g).decode(g)};src$4.decode=decode$3;const IOBuffer$1=IOBuffer_1,tiff=src$4;function decode$2(p){const l=new IOBuffer$1(p),g={};if(l.setBigEndian(),l.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(l.readUint16()===65505){l.readUint16();const E=l.readBytes(6);if(E[0]===69&&E[1]===120&&E[2]===105&&E[3]===102&&E[4]===0&&E[5]===0){const S=tiff.decode(l,{onlyFirst:!0,ignoreImageData:!0,offset:l.offset});g.exif=S}}return g}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=p=>[...p].map(l=>l.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(p,l=0){let g=p[l],m=1,x=0;for(;++x<8;)m*=256,g+=p[l+x]*m;return g}const fileType=p=>{if(!(p instanceof Uint8Array||p instanceof ArrayBuffer||Buffer.isBuffer(p)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof p}\``);const l=p instanceof Uint8Array?p:new Uint8Array(p);if(!(l&&l.length>1))return null;const g=(x,E)=>{E=Object.assign({offset:0},E);for(let S=0;S<x.length;S++)if(E.mask){if(x[S]!==(E.mask[S]&l[S+E.offset]))return!1}else if(x[S]!==l[S+E.offset])return!1;return!0},m=(x,E)=>g(toBytes(x),E);if(g([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(g([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(g([71,73,70]))return{ext:"gif",mime:"image/gif"};if(g([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(g([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((g([73,73,42,0])||g([77,77,0,42]))&&g([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(g([73,73,42,0])||g([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(g([66,77]))return{ext:"bmp",mime:"image/bmp"};if(g([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(g([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(g([80,75,3,4])){if(g([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(g(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(m("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(m("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(m("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const x=(I,T=0)=>I.findIndex((A,k,P)=>k>=T&&P[k]===80&&P[k+1]===75&&P[k+2]===3&&P[k+3]===4);let E=0,S=!1,h=null;do{const I=E+30;if(S||(S=g(oxmlContentTypes,{offset:I})||g(oxmlRels,{offset:I})),h||(m("word/",{offset:I})?h={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:m("ppt/",{offset:I})?h={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:m("xl/",{offset:I})&&(h={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),S&&h)return h;E=x(l,I)}while(E>=0);if(h)return h}if(g([80,75])&&(l[2]===3||l[2]===5||l[2]===7)&&(l[3]===4||l[3]===6||l[3]===8))return{ext:"zip",mime:"application/zip"};if(g([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(g([82,97,114,33,26,7])&&(l[6]===0||l[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(g([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(g([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(g([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(g([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(g([51,103,112,53])||g([0,0,0])&&g([102,116,121,112],{offset:4})&&(g([109,112,52,49],{offset:8})||g([109,112,52,50],{offset:8})||g([105,115,111,109],{offset:8})||g([105,115,111,50],{offset:8})||g([109,109,112,52],{offset:8})||g([77,52,86],{offset:8})||g([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(g([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(g([26,69,223,163])){const x=l.subarray(4,4+4096),E=x.findIndex((S,h,I)=>I[h]===66&&I[h+1]===130);if(E!==-1){const S=E+3,h=I=>[...I].every((T,A)=>x[S+A]===T.charCodeAt(0));if(h("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(h("webm"))return{ext:"webm",mime:"video/webm"}}}if(g([0,0,0,20,102,116,121,112,113,116,32,32])||g([102,114,101,101],{offset:4})||g([102,116,121,112,113,116,32,32],{offset:4})||g([109,100,97,116],{offset:4})||g([109,111,111,118],{offset:4})||g([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(g([82,73,70,70])){if(g([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(g([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(g([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(g([48,38,178,117,142,102,207,17,166,217])){let x=30;do{const E=readUInt64LE(l,x+16);if(g([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:x})){if(g([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:x+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(g([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:x+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}x+=E}while(x+24<=l.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(g([0,0,1,186])||g([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(g([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let x=0;x<2&&x<l.length-16;x++){if(g([73,68,51],{offset:x})||g([255,226],{offset:x,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(g([255,228],{offset:x,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(g([255,248],{offset:x,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(g([255,240],{offset:x,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(g([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(g([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(g([79,103,103,83]))return g([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:g([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:g([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:g([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:g([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(g([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(g([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(g([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(g([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(g([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(g([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((l[0]===67||l[0]===70)&&g([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(g([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(g([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(g([119,79,70,70])&&(g([0,1,0,0],{offset:4})||g([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(g([119,79,70,50])&&(g([0,1,0,0],{offset:4})||g([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(g([76,80],{offset:34})&&(g([0,0,1],{offset:8})||g([1,0,2],{offset:8})||g([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(g([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(g([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(g([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(g([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(g([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(g([37,33]))return{ext:"ps",mime:"application/postscript"};if(g([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(g([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(g([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(g([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(g([77,83,67,70])||g([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(g([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(g([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(g([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(g([31,160])||g([31,157]))return{ext:"Z",mime:"application/x-compress"};if(g([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(g([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(g([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(g([71],{offset:4})&&(g([71],{offset:192})||g([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(g([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(g([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(g([0,0,0,12,106,80,32,32,13,10,135,10])){if(g([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(g([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(g([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(g([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(g([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(m("<?xml "))return{ext:"xml",mime:"application/xml"};if(g([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(g([102,116,121,112],{offset:4})){if(g([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(g([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(g([104,101,105,99],{offset:8})||g([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(g([104,101,118,99],{offset:8})||g([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return g([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:g([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:g([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:g([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:g([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:g([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:g([212,195,178,161])||g([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const p=new stream.PassThrough,l=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{p.fileType=fileType(l)}catch(g){reject(g)}readableStream.unshift(l),stream.pipeline?resolve(stream.pipeline(readableStream,p,()=>{})):resolve(readableStream.pipe(p))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=p=>{const l=fileType(p);return imageExts.has(l&&l.ext)?l:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageType$1=imageType$2.exports;(function(p){if(p.TextEncoder&&p.TextDecoder)return!1;function l(m="utf-8"){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${m}') is invalid.`)}Object.defineProperty(l.prototype,"encoding",{value:"utf-8"}),l.prototype.encode=function(m,x={stream:!1}){if(x.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let E=0;const S=m.length;let h=0,I=Math.max(32,S+(S>>1)+7),T=new Uint8Array(I>>3<<3);for(;E<S;){let A=m.charCodeAt(E++);if(A>=55296&&A<=56319){if(E<S){const k=m.charCodeAt(E);(k&64512)==56320&&(++E,A=((A&1023)<<10)+(k&1023)+65536)}if(A>=55296&&A<=56319)continue}if(h+4>T.length){I+=8,I*=1+E/m.length*2,I=I>>3<<3;const k=new Uint8Array(I);k.set(T),T=k}if((A&4294967168)==0){T[h++]=A;continue}else if((A&4294965248)==0)T[h++]=A>>6&31|192;else if((A&4294901760)==0)T[h++]=A>>12&15|224,T[h++]=A>>6&63|128;else if((A&4292870144)==0)T[h++]=A>>18&7|240,T[h++]=A>>12&63|128,T[h++]=A>>6&63|128;else continue;T[h++]=A&63|128}return T.slice(0,h)};function g(m="utf-8",x={fatal:!1}){if(m!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${m}') is invalid.`);if(x.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(g.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(g.prototype,"fatal",{value:!1}),Object.defineProperty(g.prototype,"ignoreBOM",{value:!1}),g.prototype.decode=function(m,x={stream:!1}){if(x.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const E=new Uint8Array(m);let S=0;const h=E.length,I=[];for(;S<h;){const T=E[S++];if(T===0)break;if((T&128)==0)I.push(T);else if((T&224)==192){const A=E[S++]&63;I.push((T&31)<<6|A)}else if((T&240)==224){const A=E[S++]&63,k=E[S++]&63;I.push((T&31)<<12|A<<6|k)}else if((T&248)==240){const A=E[S++]&63,k=E[S++]&63,P=E[S++]&63;let D=(T&7)<<18|A<<12|k<<6|P;D>65535&&(D-=65536,I.push(D>>>10&1023|55296),D=56320|D&1023),I.push(D)}}return String.fromCharCode.apply(null,I)},p.TextEncoder=l,p.TextDecoder=g})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder=new TextDecoder("utf-8");function decode(p){return decoder.decode(p)}const encoder=new TextEncoder;function encode(p){return encoder.encode(p)}const defaultByteLength=1024*8;class IOBuffer{constructor(l=defaultByteLength,g={}){let m=!1;typeof l=="number"?l=new ArrayBuffer(l):(m=!0,this.lastWrittenByte=l.byteLength);const x=g.offset?g.offset>>>0:0,E=l.byteLength-x;let S=x;(ArrayBuffer.isView(l)||l instanceof IOBuffer)&&(l.byteLength!==l.buffer.byteLength&&(S=l.byteOffset+x),l=l.buffer),m?this.lastWrittenByte=E:this.lastWrittenByte=0,this.buffer=l,this.length=E,this.byteLength=E,this.byteOffset=S,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,S,E),this._mark=0,this._marks=[]}available(l=1){return this.offset+l<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(l=1){return this.offset+=l,this}seek(l){return this.offset=l,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const l=this._marks.pop();if(l===void 0)throw new Error("Mark stack empty");return this.seek(l),this}rewind(){return this.offset=0,this}ensureAvailable(l=1){if(!this.available(l)){const m=(this.offset+l)*2,x=new Uint8Array(m);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=this.byteLength=m,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(l=1){const g=new Uint8Array(l);for(let m=0;m<l;m++)g[m]=this.readByte();return g}readInt16(){const l=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,l}readUint16(){const l=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,l}readInt32(){const l=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,l}readUint32(){const l=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat32(){const l=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat64(){const l=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,l}readChar(){return String.fromCharCode(this.readInt8())}readChars(l=1){let g="";for(let m=0;m<l;m++)g+=this.readChar();return g}readUtf8(l=1){return decode(this.readBytes(l))}writeBoolean(l){return this.writeUint8(l?255:0),this}writeInt8(l){return this.ensureAvailable(1),this._data.setInt8(this.offset++,l),this._updateLastWrittenByte(),this}writeUint8(l){return this.ensureAvailable(1),this._data.setUint8(this.offset++,l),this._updateLastWrittenByte(),this}writeByte(l){return this.writeUint8(l)}writeBytes(l){this.ensureAvailable(l.length);for(let g=0;g<l.length;g++)this._data.setUint8(this.offset++,l[g]);return this._updateLastWrittenByte(),this}writeInt16(l){return this.ensureAvailable(2),this._data.setInt16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(l){return this.ensureAvailable(2),this._data.setUint16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(l){return this.ensureAvailable(4),this._data.setInt32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(l){return this.ensureAvailable(4),this._data.setUint32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(l){return this.ensureAvailable(4),this._data.setFloat32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(l){return this.ensureAvailable(8),this._data.setFloat64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(l){return this.writeUint8(l.charCodeAt(0))}writeChars(l){for(let g=0;g<l.length;g++)this.writeUint8(l.charCodeAt(g));return this}writeUtf8(l){return this.writeBytes(encode(l))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function guessStripByteCounts(p){if(p.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const l=p.rowsPerStrip*p.width*p.samplesPerPixel*(p.bitsPerSample/8);return new Array(p.stripOffsets.length).fill(l)}function applyHorizontalDifferencing8Bit(p,l,g){let m=0;for(;m<p.length;){for(let x=g;x<l*g;x+=g)for(let E=0;E<g;E++)p[m+x+E]=p[m+x+E]+p[m+x-(g-E)]&255;m+=l*g}}function applyHorizontalDifferencing16Bit(p,l,g){let m=0;for(;m<p.length;){for(let x=g;x<l*g;x+=g)for(let E=0;E<g;E++)p[m+x+E]=p[m+x+E]+p[m+x-(g-E)]&65535;m+=l*g}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let p in tagsById$2)tagsByName$2[tagsById$2[p]]=Number(p);var exif=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById:tagsById$2,tagsByName:tagsByName$2});const tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let p in tagsById$1)tagsByName$1[tagsById$1[p]]=Number(p);var gps=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById:tagsById$1,tagsByName:tagsByName$1});const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let p in tagsById)tagsByName[tagsById[p]]=Number(p);var standard=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",tagsById,tagsByName});const tags={standard,exif,gps};class IFD{constructor(l){if(!l)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=l,this._hasMap=!1,this._map={}}get(l){if(typeof l=="number")return this.fields.get(l);if(typeof l=="string")return this.fields.get(tags[this.kind].tagsByName[l]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const l=tags[this.kind].tagsById;for(let g of this.fields.keys())l[g]&&(this._map[l[g]]=this.fields.get(g));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(p,l){const g=types.get(p);if(!g)throw new Error(`type not found: ${p}`);return g[0]*l}function readData(p,l,g){const m=types.get(l);if(!m)throw new Error(`type not found: ${l}`);return m[1](p,g)}function readByte(p,l){if(l===1)return p.readUint8();let g=new Uint8Array(l);for(let m=0;m<l;m++)g[m]=p.readUint8();return g}function readASCII(p,l){let g=[],m="";for(let x=0;x<l;x++){let E=String.fromCharCode(p.readUint8());E==="\0"?(g.push(m),m=""):m+=E}return g.length===1?g[0]:g}function readShort(p,l){if(l===1)return p.readUint16();let g=new Uint16Array(l);for(let m=0;m<l;m++)g[m]=p.readUint16();return g}function readLong(p,l){if(l===1)return p.readUint32();let g=new Uint32Array(l);for(let m=0;m<l;m++)g[m]=p.readUint32();return g}function readRational(p,l){if(l===1)return p.readUint32()/p.readUint32();let g=new Array(l);for(let m=0;m<l;m++)g[m]=p.readUint32()/p.readUint32();return g}function readSByte(p,l){if(l===1)return p.readInt8();let g=new Int8Array(l);for(let m=0;m<l;m++)g[m]=p.readInt8();return g}function readSShort(p,l){if(l===1)return p.readInt16();let g=new Int16Array(l);for(let m=0;m<l;m++)g[m]=p.readInt16();return g}function readSLong(p,l){if(l===1)return p.readInt32();let g=new Int32Array(l);for(let m=0;m<l;m++)g[m]=p.readInt32();return g}function readSRational(p,l){if(l===1)return p.readInt32()/p.readInt32();let g=new Array(l);for(let m=0;m<l;m++)g[m]=p.readInt32()/p.readInt32();return g}function readFloat(p,l){if(l===1)return p.readFloat32();let g=new Float32Array(l);for(let m=0;m<l;m++)g[m]=p.readFloat32();return g}function readDouble(p,l){if(l===1)return p.readFloat64();let g=new Float64Array(l);for(let m=0;m<l;m++)g[m]=p.readFloat64();return g}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let l=0;l<256;l++)stringTable.push([l]);const p=[];for(let l=256;l<4096;l++)stringTable.push(p)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(l){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(l.buffer,l.byteOffset,l.byteLength),this.outData=new IOBuffer(l.byteLength),this.initializeTable()}decode(){let l=0,g=0;for(;(l=this.getNextCode())!==EOI_CODE;)if(l===CLEAR_CODE){if(this.initializeTable(),l=this.getNextCode(),l===EOI_CODE)break;this.writeString(this.stringFromCode(l)),g=l}else if(this.isInTable(l))this.writeString(this.stringFromCode(l)),this.addStringToTable(this.stringFromCode(g).concat(this.stringFromCode(l)[0])),g=l;else{const x=this.stringFromCode(g).concat(this.stringFromCode(g)[0]);this.writeString(x),this.addStringToTable(x),g=l}const m=this.outData.toArray();return new DataView(m.buffer,m.byteOffset,m.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(l){this.outData.writeBytes(l)}stringFromCode(l){return stringTable[l]}isInTable(l){return l<this.tableLength}addStringToTable(l){if(stringTable[this.tableLength++]=l,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const l=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:l}}function decompressLzw(p){return new LzwDecoder(p).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let l=new Date,g=dateTimeRegex.exec(this.dateTime);if(g===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return l.setFullYear(Number(g[1]),Number(g[2])-1,Number(g[3])),l.setHours(Number(g[4]),Number(g[5]),Number(g[6])),l}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const l=this.get("BitsPerSample");return l&&typeof l!="number"?l[0]:l}get alpha(){const l=this.extraSamples;return l?l[0]!==0:!1}get associatedAlpha(){const l=this.extraSamples;return l?l[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const l=2**this.bitsPerSample,g=this.get("ColorMap");if(!g)return;if(g.length!==3*l)throw new Error(`ColorMap size must be ${l}`);const m=[];for(let x=0;x<l;x++)m.push([g[x],g[x+l],g[x+2*l]]);return m}}function alwaysArray(p){return typeof p=="number"?[p]:p}function decompressZlib(p){const l=new Uint8Array(p.buffer,p.byteOffset,p.byteLength),g=inflate_1(l);return new DataView(g.buffer,g.byteOffset,g.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(l){super(l);this._nextIFD=0}get isMultiPage(){let l=0;for(this.decodeHeader();this._nextIFD;)if(l++,this.decodeIFD({ignoreImageData:!0},!0),l===2)return!0;if(l===1)return!1;throw unsupported("ifdCount",l)}get pageCount(){let l=0;for(this.decodeHeader();this._nextIFD;)l++,this.decodeIFD({ignoreImageData:!0},!0);if(l>0)return l;throw unsupported("ifdCount",l)}decode(l={}){l=Object.assign({},defaultOptions$c,l);const g=[];for(this.decodeHeader();this._nextIFD;)if(g.push(this.decodeIFD(l,!0)),l.onlyFirst)return[g[0]];return g}decodeHeader(){const l=this.readUint16();if(l===18761)this.setLittleEndian();else if(l===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${l.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(l,g){this.seek(this._nextIFD);let m;if(g)m=new TiffIfd;else{if(!l.kind)throw new Error("kind is missing");m=new IFD(l.kind)}const x=this.readUint16();for(let E=0;E<x;E++)this.decodeIFDEntry(m);if(!l.ignoreImageData){if(!(m instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(m)}return this._nextIFD=this.readUint32(),m}decodeIFDEntry(l){const g=this.offset,m=this.readUint16(),x=this.readUint16(),E=this.readUint32();if(x<1||x>12){this.skip(4);return}getByteLength(x,E)>4&&this.seek(this.readUint32());const h=readData(this,x,E);if(l.fields.set(m,h),m===34665||m===34853){let I=this.offset,T="exif";m===34665?T="exif":m===34853&&(T="gps"),this._nextIFD=h,l[T]=this.decodeIFD({kind:T,ignoreImageData:!0},!1),this.offset=I}this.seek(g),this.skip(12)}decodeImageData(l){const g=l.orientation;if(g&&g!==1)throw unsupported("orientation",g);switch(l.type){case 0:case 1:case 2:case 3:this.readStripData(l);break;default:throw unsupported("image type",l.type)}if(this.applyPredictor(l),this.convertAlpha(l),l.type===0){const m=l.bitsPerSample,x=Math.pow(2,m)-1;for(let E=0;E<l.data.length;E++)l.data[E]=x-l.data[E]}}readStripData(l){const g=l.width,m=l.height,x=l.bitsPerSample,E=l.sampleFormat,S=g*m*l.samplesPerPixel,h=getDataArray(S,x,E),T=l.rowsPerStrip*g*l.samplesPerPixel,A=l.stripOffsets,k=l.stripByteCounts||guessStripByteCounts(l);let P=S,D=0;for(let M=0;M<A.length;M++){let F=new DataView(this.buffer,this.byteOffset+A[M],k[M]),N=P>T?T:P;P-=N;let B=F;switch(l.compression){case 1:break;case 5:{B=decompressLzw(F);break}case 8:{B=decompressZlib(F);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",l.compression)}D=this.fillUncompressed(x,E,h,B,D,N)}l.data=h}fillUncompressed(l,g,m,x,E,S){if(l===8)return fill8bit(m,x,E,S);if(l===16)return fill16bit(m,x,E,S,this.isLittleEndian());if(l===32&&g===3)return fillFloat32(m,x,E,S,this.isLittleEndian());throw unsupported("bitDepth",l)}applyPredictor(l){const g=l.bitsPerSample;switch(l.predictor){case 1:break;case 2:{if(g===8)applyHorizontalDifferencing8Bit(l.data,l.width,l.components);else if(g===16)applyHorizontalDifferencing16Bit(l.data,l.width,l.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${g}`);break}default:throw new Error(`invalid predictor: ${l.predictor}`)}}convertAlpha(l){if(l.alpha&&l.associatedAlpha){const{data:g,components:m,maxSampleValue:x}=l;for(let E=0;E<g.length;E+=m){const S=g[E+m-1];for(let h=0;h<m-1;h++)g[E+h]=Math.round(g[E+h]*x/S)}}}}function getDataArray(p,l,g){if(l===8)return new Uint8Array(p);if(l===16)return new Uint16Array(p);if(l===32&&g===3)return new Float32Array(p);throw unsupported("bit depth / sample format",`${l} / ${g}`)}function fill8bit(p,l,g,m){for(let x=0;x<m;x++)p[g++]=l.getUint8(x);return g}function fill16bit(p,l,g,m,x){for(let E=0;E<m*2;E+=2)p[g++]=l.getUint16(E,x);return g}function fillFloat32(p,l,g,m,x){for(let E=0;E<m*4;E+=4)p[g++]=l.getFloat32(E,x);return g}function unsupported(p,l){return new Error(`Unsupported ${p}: ${l}`)}function decodeTIFF(p,l){return new TIFFDecoder(p).decode(l)}function matchAndCrop(p={}){let{algorithm:l="matchToPrevious",ignoreBorder:g=[0,0]}=p;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let m=l==="matchToPrevious",x=this[0],E=[];E[0]={position:[0,0],image:this[0]};let S=[0,0];for(let P=1;P<this.length;P++){let D=x.getBestMatch(this[P],{border:g});E[P]={position:[D[0]+S[0],D[1]+S[1]],image:this[P]},m&&(S[0]+=D[0],S[1]+=D[1],x=this[P])}let h=0,I=0,T=0,A=0;for(let P=0;P<E.length;P++){let D=E[P];D.position[0]>h&&(h=D.position[0]),D.position[0]<I&&(I=D.position[0]),D.position[1]>T&&(T=D.position[1]),D.position[1]<A&&(A=D.position[1])}I=0-I,A=0-A;for(let P=0;P<E.length;P++){let D=E[P];D.crop=D.image.crop({x:h-D.position[0],y:T-D.position[1],width:x.width-I-h,height:x.height-A-T})}let k=[];for(let P=0;P<E.length;P++)k[P]=E[P].crop;return new Stack(k)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let p=this[0].min;for(let l=1;l<this.length;l++)for(let g=0;g<p.length;g++)p[g]=Math.min(p[g],this[l].min[g]);return p}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let p=this[0].max;for(let l=1;l<this.length;l++)for(let g=0;g<p.length;g++)p[g]=Math.max(p[g],this[l].max[g]);return p}function median$2(p){let l=p.reduce((S,h)=>S+h);if(l===0)throw new Error("unreachable");let g=0,m=0,x=l/2,E;for(;;){if(p[g]>0){if(E!==void 0)return(E+g)/2;if(m+=p[g],m>x)return g;m===x&&(E=g)}g++}}function mean$2(p){let l=0,g=0;for(let m=0;m<p.length;m++)l+=p[m],g+=p[m]*m;return l===0?0:g/l}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let p=this.getHistograms({maxSlots:this[0].maxValue+1}),l=new Array(p.length);for(let g=0;g<p.length;g++){let m=p[g];l[g]=median$2(m)}return l}function histogram(p){this.checkProcessable("min",{bitDepth:[8,16]});let l=this[0].getHistogram(p);for(let g=1;g<this.length;g++){let m=this[g].getHistogram(p);for(let x=0;x<l.length;x++)l[x]+=m[x]}return l}function histograms(p){this.checkProcessable("min",{bitDepth:[8,16]});let l=this[0].getHistograms(p),g=l[0].length;for(let m=1;m<this.length;m++){let x=this[m].getHistograms(p);for(let E=0;E<l.length;E++)for(let S=0;S<g;S++)l[E][S]+=x[E][S]}return l}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let p=new Uint32Array(this[0].data.length);for(let m=0;m<this.length;m++){let x=this[m];for(let E=0;E<this[0].data.length;E++)p[E]+=x.data[E]}let l=Image$1.createFrom(this[0]),g=l.data;for(let m=0;m<this[0].data.length;m++)g[m]=p[m]/this.length;return l}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let p=Image$1.createFrom(this[0]);p.data.fill(0);for(const l of this)for(let g=0;g<p.data.length;g++)p.data[g]=Math.max(l.data[g],p.data[g]);return p}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let p=Image$1.createFrom(this[0]);p.data.fill(p.maxValue);for(const l of this)for(let g=0;g<p.data.length;g++)p.data[g]=Math.min(l.data[g],p.data[g]);return p}function extend$5(p){p.extendMethod("matchAndCrop",matchAndCrop),p.extendMethod("getMin",min$2),p.extendMethod("getMax",max$2),p.extendMethod("getMedian",median$1),p.extendMethod("getHistogram",histogram),p.extendMethod("getHistograms",histograms),p.extendMethod("getAverage",averageImage),p.extendMethod("getAverageImage",averageImage),p.extendMethod("getMaxImage",maxImage),p.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(l){if(Array.isArray(l)){super(l.length);for(let g=0;g<l.length;g++)this[g]=l[g]}else typeof l=="number"?super(l):super();this.computed=null}static load(l){return Promise.all(l.map(Image$1.load)).then(g=>new Stack(g))}static extendMethod(l,g,m={}){let{inPlace:x=!1,returnThis:E=!0,partialArgs:S=[]}=m;return x?Stack.prototype[l]=function(...h){this.computed=null;let I=g.apply(this,[...S,...h]);return E?this:I}:Stack.prototype[l]=function(...h){return g.apply(this,[...S,...h])},Stack}static extendProperty(l,g,m={}){let{partialArgs:x=[]}=m;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(l,this.computed))return this.computed[l];let E=g.apply(this,x);return this.computed[l]=E,E},Object.defineProperty(Stack.prototype,l,computedPropertyDescriptor),Stack}checkProcessable(l,g={}){if(typeof l!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${l} can not be applied on an empty stack`);this[0].checkProcessable(l,g);for(let m=1;m<this.length;m++){if((g.sameSize===void 0||g.sameSize)&&this[0].width!==this[m].width)throw new TypeError(`The process: ${l} can not be applied if width is not identical in all images`);if((g.sameSize===void 0||g.sameSize)&&this[0].height!==this[m].height)throw new TypeError(`The process: ${l} can not be applied if height is not identical in all images`);if((g.sameAlpha===void 0||g.sameAlpha)&&this[0].alpha!==this[m].alpha)throw new TypeError(`The process: ${l} can not be applied if alpha is not identical in all images`);if((g.sameBitDepth===void 0||g.sameBitDepth)&&this[0].bitDepth!==this[m].bitDepth)throw new TypeError(`The process: ${l} can not be applied if bitDepth is not identical in all images`);if((g.sameColorModel===void 0||g.sameColorModel)&&this[0].colorModel!==this[m].colorModel)throw new TypeError(`The process: ${l} can not be applied if colorModel is not identical in all images`);if((g.sameNumberChannels===void 0||g.sameNumberChannels)&&this[0].channels!==this[m].channels)throw new TypeError(`The process: ${l} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(p,l){if(typeof p!="function")throw new TypeError(`${p} is not a function`);let g=new Stack(this.length);for(let m=0;m<this.length;m++)g[m]=p.call(l,this[m],m,this);return g});extend$5(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(p,l){if(typeof p=="string")return loadURL(p,l);if(p instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(p)));if(p.buffer)return Promise.resolve(loadBinary(p));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(p,l){const g=imageType$1(p);if(g)switch(g.mime){case"image/png":return loadPNG(p);case"image/jpeg":return loadJPEG(p);case"image/tiff":return loadTIFF(p);default:return loadGeneric(m(g.mime))}return loadGeneric(m("application/octet-stream"));function m(x){return l||toBase64URL(p,x)}}function loadURL(p,l){const g=p.slice(0,64).match(isDataURL);let m;return g!==null?m=Promise.resolve(decode$4(p.slice(g[0].length))):m=fetchBinary(p,l),m.then(x=>{const E=new Uint8Array(x);return loadBinary(E,g?p:void 0)})}function loadPNG(p){const l=decodePng(p);let g=l.channels,m,x=0;return g===2||g===4?(m=g-1,x=1):m=g,l.palette?loadPNGFromPalette(l):new Image$1(l.width,l.height,l.data,{components:m,alpha:x,bitDepth:l.depth})}function loadPNGFromPalette(p){const l=p.width*p.height,g=p.palette[0].length,m=new Uint8Array(l*g),x=8/p.depth,E=p.depth<8?x:1,S=parseInt("1".repeat(p.depth),2),h=g===4;let I=0;for(let T=0;T<l;T++){const A=Math.floor(T/E);let k=p.data[A];p.depth<8&&(k=k>>>p.depth*(x-1-T%x)&S);const P=p.palette[k];m[I++]=P[0],m[I++]=P[1],m[I++]=P[2],h&&(m[I++]=P[3])}return new Image$1(p.width,p.height,m,{components:3,alpha:h,bitDepth:8})}function loadJPEG(p){const l=decode$1(p);let g;l.exif&&(g=getMetadata(l.exif));const m=jpegJs.decode(p,{useTArray:!0,maxMemoryUsageInMB:1024});let x=new Image$1(m.width,m.height,m.data,{meta:g});if(g&&g.tiff.tags.Orientation){const E=g.tiff.tags.Orientation;E>2&&(x=x.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[E])),[2,4,5,7].includes(E)&&(x=x.flipX())}return x}function loadTIFF(p){let l=decodeTIFF(p);return l.length===1?getImageFromIFD(l[0]):new Stack(l.map(getImageFromIFD))}function getMetadata(p){const l={tiff:{fields:p.fields,tags:p.map}};return p.exif&&(l.exif=p.exif),p.gps&&(l.gps=p.gps),l}function getImageFromIFD(p){if(p.type===3){const l=new Uint16Array(3*p.width*p.height),g=p.palette;let m=0;for(let x=0;x<p.data.length;x++){const E=p.data[x],S=g[E];l[m++]=S[0],l[m++]=S[1],l[m++]=S[2]}return new Image$1(p.width,p.height,l,{components:3,alpha:p.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(p)})}else return new Image$1(p.width,p.height,p.data,{components:p.type===2?3:1,alpha:p.alpha,colorModel:p.type===2?RGB$1:GREY$1,bitDepth:p.bitsPerSample.length?p.bitsPerSample[0]:p.bitsPerSample,meta:getMetadata(p)})}function loadGeneric(p,l){return l=l||{},new Promise(function(g,m){let x=new DOMImage;x.onload=function(){let E=x.width,S=x.height,I=createCanvas(E,S).getContext("2d");I.drawImage(x,0,0,E,S);let T=I.getImageData(0,0,E,S).data;g(new Image$1(E,S,T,l))},x.onerror=function(){m(new Error(`Could not load ${p}`))},x.src=p})}const valueMethods={getValueXY(p,l,g){return this.data[(l*this.width+p)*this.channels+g]},setValueXY(p,l,g,m){return this.data[(l*this.width+p)*this.channels+g]=m,this.computed=null,this},getValue(p,l){return this.data[p*this.channels+l]},setValue(p,l,g){return this.data[p*this.channels+l]=g,this.computed=null,this},getPixelXY(p,l){return this.getPixel(l*this.width+p)},setPixelXY(p,l,g){return this.setPixel(l*this.width+p,g)},getPixel(p){const l=new Array(this.channels),g=p*this.channels;for(let m=0;m<this.channels;m++)l[m]=this.data[g+m];return l},setPixel(p,l){const g=p*this.channels;for(let m=0;m<l.length;m++)this.data[g+m]=l[m];return this.computed=null,this}};function setValueMethods(p){for(const l in valueMethods)p.prototype[l]=valueMethods[l]}function getImageParameters(p){return{width:p.width,height:p.height,components:p.components,alpha:p.alpha,colorModel:p.colorModel,bitDepth:p.bitDepth}}function getOutputImage(p,l,g,m={}){const{out:x}=l;if(x===void 0)return m.copy?p.clone():Image$1.createFrom(p,g);{if(!Image$1.isImage(x))throw new TypeError("out must be an Image object");const E=Object.assign(getImageParameters(p),g);for(const S in E)if(x[S]!==E[S])throw new RangeError(`cannot use out. Its ${S} must be "${E[S]}" (found "${x[S]}")`);return x}}function getOutputImageOrInPlace(p,l,g){if(l.inPlace!==void 0&&typeof l.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(l.inPlace){if(l.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return p}return getOutputImage(p,l,null,g)}function abs(p={}){this.checkProcessable("abs",{bitDepth:[32]});const l=getOutputImageOrInPlace(this,p);return absolute(this,l),l}function absolute(p,l){for(let g=0;g<p.data.length;g++)l.data[g]=Math.abs(p.data[g])}function copyAlphaChannel(p,l){if(p.alpha===1&&l.alpha===1)for(let g=0;g<p.size;g++)l.data[g*l.channels+l.components]=p.data[g*p.channels+p.components]}function invert(p={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const l=getOutputImageOrInPlace(this,p);return this.bitDepth===1?invertBinary(this,l):(invertColor(this,l),this!==l&&copyAlphaChannel(this,l)),l}function invertBinary(p,l){for(let g=0;g<p.data.length;g++)l.data[g]=~p.data[g]}function invertColor(p,l){for(let g=0;g<p.data.length;g+=p.channels)for(let m=0;m<p.components;m++)l.data[g+m]=p.maxValue-p.data[g+m]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let p=0;p<this.height;p++){let l=p*this.width*this.channels;for(let g=0;g<Math.floor(this.width/2);g++){let m=g*this.channels+l,x=(this.width-g-1)*this.channels+l;for(let E=0;E<this.channels;E++){let S=this.data[m+E];this.data[m+E]=this.data[x+E],this.data[x+E]=S}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let p=0;p<Math.floor(this.height/2);p++)for(let l=0;l<this.width;l++){let g=l*this.channels+p*this.width*this.channels,m=l*this.channels+(this.height-1-p)*this.channels*this.width;for(let x=0;x<this.channels;x++){let E=this.data[g+x];this.data[g+x]=this.data[m+x],this.data[m+x]=E}}return this}function blurFilter(p={}){const{radius:l=1}=p;if(l<1)throw new Error("radius must be greater than 1");const g=2*l+1,m=new Array(g);for(let x=0;x<g;x++){m[x]=new Array(g);for(let E=0;E<g;E++)m[x][E]=1/(g*g)}return this.convolution(m)}var medianQuickselect_min={exports:{}};(function(p){(function(){function l(x){for(var E=0,S=x.length-1,h=void 0,I=void 0,T=void 0,A=m(E,S);;){if(S<=E)return x[A];if(S==E+1)return x[E]>x[S]&&g(x,E,S),x[A];for(h=m(E,S),x[h]>x[S]&&g(x,h,S),x[E]>x[S]&&g(x,E,S),x[h]>x[E]&&g(x,h,E),g(x,h,E+1),I=E+1,T=S;;){do I++;while(x[E]>x[I]);do T--;while(x[T]>x[E]);if(T<I)break;g(x,I,T)}g(x,E,T),T<=A&&(E=I),T>=A&&(S=T-1)}}var g=function(E,S,h){var I;return I=[E[h],E[S]],E[S]=I[0],E[h]=I[1],I},m=function(E,S){return~~((E+S)/2)};p.exports?p.exports=l:window.median=l})()})(medianQuickselect_min);var quickSelectMedian=medianQuickselect_min.exports;function validateArrayOfChannels(p,l={}){let{channels:g,allowAlpha:m,defaultAlpha:x}=l;return typeof m!="boolean"&&(m=!0),typeof g=="undefined"?allChannels(p,x):validateChannels(p,g,m)}function allChannels(p,l){let g=l?p.channels:p.components,m=new Array(g);for(let x=0;x<g;x++)m[x]=x;return m}function validateChannels(p,l,g){Array.isArray(l)||(l=[l]);for(let m=0;m<l.length;m++)l[m]=validateChannel(p,l[m],g);return l}function validateChannel(p,l,g=!0){if(l===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${p.channels}`);if(typeof l=="string"){switch(p.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(l))switch(l){case"r":l=0;break;case"g":l=1;break;case"b":l=2;break}break;case HSL:if("hsl".includes(l))switch(l){case"h":l=0;break;case"s":l=1;break;case"l":l=2;break}break;case HSV:if("hsv".includes(l))switch(l){case"h":l=0;break;case"s":l=1;break;case"v":l=2;break}break;case CMYK$1:if("cmyk".includes(l))switch(l){case"c":l=0;break;case"m":l=1;break;case"y":l=2;break;case"k":l=3;break}break;default:throw new Error(`Unexpected color model: ${p.colorModel}`)}if(l==="a"){if(!p.alpha)throw new Error("validateChannel : the image does not contain alpha channel");l=p.components}if(typeof l=="string")throw new Error(`validateChannel : undefined channel: ${l}`)}if(l>=p.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${p.channels}`);if(!g&&l>=p.components)throw new RangeError("validateChannel : alpha channel may not be selected");return l}function medianFilter(p={}){let{radius:l=1,border:g="copy",channels:m}=p;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),l<1)throw new Error("radius must be greater than 0");m=validateArrayOfChannels(this,m);let x=l,E=l,S=Image$1.createFrom(this),h=(x*2+1)*(E*2+1),I=new Array(h);for(let T=0;T<m.length;T++){let A=m[T];for(let k=E;k<this.height-E;k++)for(let P=x;P<this.width-x;P++){let D=0;for(let F=-E;F<=E;F++)for(let N=-x;N<=x;N++){let B=((k+F)*this.width+P+N)*this.channels+A;I[D++]=this.data[B]}let M=(k*this.width+P)*this.channels+A;S.data[M]=quickSelectMedian(I)}}if(this.alpha&&!m.includes(this.channels))for(let T=this.components;T<this.data.length;T=T+this.channels)S.data[T]=this.data[T];return S.setBorder({size:[x,E],algorithm:g}),S}function gaussianFilter(p={}){let{radius:l=1,sigma:g,channels:m,border:x="copy"}=p;this.checkProcessable("gaussian",{bitDepth:[8,16]});const E=getKernel(l,g);return this.convolution([E,E],{border:x,channels:m,algorithm:"separable"})}function getKernel(p,l){const g=p*2+1,m=new Array(g),x=l||((g-1)*.5-1)*.3+.8,E=-.5/(x*x);let S=0;for(let h=0;h<g;h++){const I=h-p,T=Math.exp(E*I*I);m[h]=T,S+=T}for(let h=0;h<g;h++)m[h]/=S;return m}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(p){(function(){var l;l=p;var g={release:"0.3.0",date:"2013-03"};l.toString=function(){return"version "+g.release+", released "+g.date};for(var m=0,x=null,E=null,S={init:function(T){if(T!==0&&(T&T-1)==0)m=T,S._initArray(),S._makeBitReversalTable(),S._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(T,A){S.fft(T,A,1)},ifft1d:function(T,A){var k=1/m;S.fft(T,A,-1);for(var P=0;P<m;P++)T[P]*=k,A[P]*=k},bt1d:function(T,A){S.fft(T,A,-1)},fft2d:function(T,A){for(var k=[],P=[],D=0,M=0;M<m;M++){D=M*m;for(var F=0;F<m;F++)k[F]=T[F+D],P[F]=A[F+D];S.fft1d(k,P);for(var N=0;N<m;N++)T[N+D]=k[N],A[N+D]=P[N]}for(var B=0;B<m;B++){for(var U=0;U<m;U++)D=B+U*m,k[U]=T[D],P[U]=A[D];S.fft1d(k,P);for(var O=0;O<m;O++)D=B+O*m,T[D]=k[O],A[D]=P[O]}},ifft2d:function(T,A){for(var k=[],P=[],D=0,M=0;M<m;M++){D=M*m;for(var F=0;F<m;F++)k[F]=T[F+D],P[F]=A[F+D];S.ifft1d(k,P);for(var N=0;N<m;N++)T[N+D]=k[N],A[N+D]=P[N]}for(var B=0;B<m;B++){for(var U=0;U<m;U++)D=B+U*m,k[U]=T[D],P[U]=A[D];S.ifft1d(k,P);for(var O=0;O<m;O++)D=B+O*m,T[D]=k[O],A[D]=P[O]}},fft:function(T,A,k){for(var P,D,M,F,N,B,U,O,V,Z=m>>2,W=0;W<m;W++)F=x[W],W<F&&(N=T[W],T[W]=T[F],T[F]=N,N=A[W],A[W]=A[F],A[F]=N);for(var Y=1;Y<m;Y<<=1){D=0,P=m/(Y<<1);for(var X=0;X<Y;X++){B=E[D+Z],U=k*E[D];for(var J=X;J<m;J+=Y<<1)M=J+Y,O=B*T[M]+U*A[M],V=B*A[M]-U*T[M],T[M]=T[J]-O,T[J]+=O,A[M]=A[J]-V,A[J]+=V;D+=P}}},_initArray:function(){typeof Uint32Array!="undefined"?x=new Uint32Array(m):x=[],typeof Float64Array!="undefined"?E=new Float64Array(m*1.25):E=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var T=0,A=0,k=0;for(x[0]=0;++T<m;){for(k=m>>1;k<=A;)A-=k,k>>=1;A+=k,x[T]=A}},_makeCosSinTable:function(){var T=m>>1,A=m>>2,k=m>>3,P=T+A,D=Math.sin(Math.PI/m),M=2*D*D,F=Math.sqrt(M*(2-M)),N=E[A]=1,B=E[0]=0;D=2*M;for(var U=1;U<k;U++)N-=M,M+=D*N,B+=F,F-=D*B,E[U]=B,E[A-U]=N;k!==0&&(E[k]=Math.sqrt(.5));for(var O=0;O<A;O++)E[T-O]=E[O];for(var V=0;V<P;V++)E[V+T]=-E[V]}},h=["init","fft1d","ifft1d","fft2d","ifft2d"],I=0;I<h.length;I++)l[h[I]]=S[h[I]];return l.bt=S.bt1d,l.fft=S.fft1d,l.ifft=S.ifft1d,l}).call(commonjsGlobal)})(fftlib);var FFT=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(p,l,g){var m=new Array(l*g),x=l/2,E=(g-1)*2;FFT.init(x);for(var S={re:new Array(x),im:new Array(x)},h=0;h<g;h++){for(var I=x-1;I>=0;I--)S.re[I]=p[I*2*g+h],S.im[I]=p[(I*2+1)*g+h];FFT.bt(S.re,S.im);for(var I=x-1;I>=0;I--)m[I*2*g+h]=S.re[I],m[(I*2+1)*g+h]=S.im[I]}var T=new Array(x*E);FFT.init(E);for(var A={re:new Array(E),im:new Array(E)},k=E*x,I=0;I<l;I+=2){A.re[0]=m[I*g],A.im[0]=m[(I+1)*g];for(var h=1;h<g;h++)A.re[h]=m[I*g+h],A.im[h]=m[(I+1)*g+h],A.re[E-h]=m[I*g+h],A.im[E-h]=-m[(I+1)*g+h];FFT.bt(A.re,A.im);for(var P=I/2*E,h=E-1;h>=0;h--)T[P+h]=A.re[h]/k}return T},fft2DArray:function(p,l,g,m){Object.assign({},{inplace:!0});var x=g/2+1,E=l*2,S=new Array(E*x);FFT.init(g);for(var h={re:new Array(g),im:new Array(g)},I={re:new Array(g),im:new Array(g)},T={re:new Array(g),im:new Array(g)},A,k,P,D,M,F=0;F<l/2;F++){A=F*2*g,h.re=p.slice(A,A+g),A=(F*2+1)*g,h.im=p.slice(A,A+g),FFT.fft1d(h.re,h.im),this.reconstructTwoRealFFT(h,I,T),k=F*4*x,P=(F*4+1)*x,D=(F*4+2)*x,M=(F*4+3)*x;for(var N=x-1;N>=0;N--)S[k+N]=I.re[N],S[P+N]=I.im[N],S[D+N]=T.re[N],S[M+N]=T.im[N]}I=null,T=null;var B=new Array(E*x);FFT.init(l);for(var U={re:new Array(l),im:new Array(l)},O=x-1;O>=0;O--){for(var F=l-1;F>=0;F--)U.re[F]=S[F*2*x+O],U.im[F]=S[(F*2+1)*x+O],isNaN(U.re[F])&&(U.re[F]=0),isNaN(U.im[F])&&(U.im[F]=0);FFT.fft1d(U.re,U.im);for(var F=l-1;F>=0;F--)B[F*2*x+O]=U.re[F],B[(F*2+1)*x+O]=U.im[F]}return B},reconstructTwoRealFFT:function(p,l,g){var m=p.re.length;l.re[0]=p.re[0],l.im[0]=0,g.re[0]=p.im[0],g.im[0]=0;for(var x,E,S,h,I,T=m/2;T>0;T--)I=m-T,x=.5*(p.re[T]-p.re[I]),E=.5*(p.re[T]+p.re[I]),S=.5*(p.im[T]-p.im[I]),h=.5*(p.im[T]+p.im[I]),l.re[T]=E,l.im[T]=S,l.re[I]=E,l.im[I]=-S,g.re[T]=h,g.im[T]=-x,g.re[I]=h,g.im[I]=x},convolute2DI:function(p,l,g,m){for(var x,E,S=0;S<g/2;S++)for(var h=0;h<m;h++)x=p[S*2*m+h]*l[S*2*m+h]-p[(S*2+1)*m+h]*l[(S*2+1)*m+h],E=p[S*2*m+h]*l[(S*2+1)*m+h]+p[(S*2+1)*m+h]*l[S*2*m+h],p[S*2*m+h]=x,p[(S*2+1)*m+h]=E},convolute:function(p,l,g,m,x){for(var E=new Array(m*g),S=0;S<g*m;S++)E[S]=p[S];E=this.fft2DArray(E,g,m);for(var h=l.length,I=l[0].length,T=new Array(m*g),S=0;S<m*g;S++)T[S]=0;for(var A,k,P=Math.floor((h-1)/2),D=Math.floor((I-1)/2),M=0;M<h;M++){A=(M-P+g)%g;for(var F=0;F<I;F++)k=(F-D+m)%m,T[A*m+k]=l[M][F]}T=this.fft2DArray(T,g,m);var N=g*2,B=m/2+1;return this.convolute2DI(E,T,N,B),this.ifft2DArray(E,N,B)},toRadix2:function(p,l,g){var m,x,E,S,h=g,I=l;if(!(g!==0&&(g&g-1)==0)){for(h=0;g>>++h!=0;);h=1<<h}if(!(l!==0&&(l&l-1)==0)){for(I=0;l>>++I!=0;);I=1<<I}if(I==l&&h==g)return{data:p,rows:l,cols:g};var T=new Array(I*h),A=Math.floor((I-l)/2)-l,k=Math.floor((h-g)/2)-g;for(m=0;m<I;m++)for(E=m*h,S=(m-A)%l*g,x=0;x<h;x++)T[E+x]=p[S+(x-k)%g];return{data:T,rows:I,cols:h}},crop:function(p,l,g,m,x,E){if(l==m&&g==x)return p;Object.assign({},E);var S=new Array(x*m),h=Math.floor((l-m)/2),I=Math.floor((g-x)/2),T,A,k,P;for(k=0;k<m;k++)for(T=k*x,A=(k+h)*g,P=0;P<x;P++)S[T+P]=p[A+(P+I)];return S}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(p,l,g){var m=matrix2Array(p),x=m.data,E=Object.assign({normalize:!1,divisor:1,rows:m.rows,cols:m.cols},g),S,h;if(E.rows&&E.cols)S=E.rows,h=E.cols;else throw new Error("Invalid number of rows or columns "+S+" "+h);var I=E.divisor,T,A,k=l.length,P=l[0].length;if(E.normalize)for(I=0,T=0;T<k;T++)for(A=0;A<P;A++)I+=l[T][A];if(I===0)throw new RangeError("convolution: The divisor is equal to zero");var D=FFTUtils.toRadix2(x,S,h),M=FFTUtils.convolute(D.data,l,D.rows,D.cols);if(M=FFTUtils.crop(M,D.rows,D.cols,S,h),I!=0&&I!=1)for(T=0;T<M.length;T++)M[T]/=I;return M}function convolutionDirect(p,l,g){var m=matrix2Array(p),x=m.data,E=Object.assign({normalize:!1,divisor:1,rows:m.rows,cols:m.cols},g),S,h;if(E.rows&&E.cols)S=E.rows,h=E.cols;else throw new Error("Invalid number of rows or columns "+S+" "+h);var I=E.divisor,T=l.length,A=l[0].length,k,P,D,M,F,N,B,U,O;if(E.normalize)for(I=0,k=0;k<T;k++)for(P=0;P<A;P++)I+=l[k][P];if(I===0)throw new RangeError("convolution: The divisor is equal to zero");var V=new Array(S*h),Z=Math.floor(T/2),W=Math.floor(A/2);for(M=0;M<S;M++)for(D=0;D<h;D++){for(N=0,P=0;P<T;P++)for(k=0;k<A;k++)B=l[T-P-1][A-k-1],U=(M+P-Z+S)%S,O=(D+k-W+h)%h,F=U*h+O,N+=x[F]*B;F=M*h+D,V[F]=N/I}return V}function LoG(p,l,g){var m=1e3;g&&g.factor&&(m=g.factor);var x=new Array(l),E,S,h,I;m*=-1;var T=(l-1)/2,A=2*p*p;for(E=0;E<l;E++)for(x[E]=new Array(l),I=(E-T)*(E-T),S=0;S<l;S++)h=-((S-T)*(S-T)+I)/A,x[E][S]=Math.round(m*(1+h)*Math.exp(h));return x}function matrix2Array(p){var l=p,g,m;if(typeof p[0]!="number"){g=p.length,m=p[0].length,l=new Array(g*m);for(var x=0;x<g;x++)for(var E=0;E<m;E++)l[x*m+E]=p[x][E]}else{var S=Math.sqrt(p.length);Number.isInteger(S)&&(g=S,m=S)}return{data:l,rows:g,cols:m}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(p){return!(typeof p!="number"||p!==p||p===1/0||p===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(p){return typeof p=="number"&&isFinite$1(p)&&Math.floor(p)===p};function validateKernel(p){let l,g;if(Array.isArray(p))if(Array.isArray(p[0])){if((p.length&1)==0||(p[0].length&1)==0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");l=Math.floor(p.length/2),g=Math.floor(p[0].length/2)}else{let m=Math.sqrt(p.length);if(isInteger(m))g=l=Math.floor(Math.sqrt(p.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let x=new Array(m);for(let E=0;E<m;E++){x[E]=new Array(m);for(let S=0;S<m;S++)x[E][S]=p[E*m+S]}p=x}else throw new Error(`validateKernel: Invalid Kernel: ${p}`);return{kernel:p,kWidth:g,kHeight:l}}function clamp(p,l){return Math.round(Math.min(Math.max(p,0),l.maxValue))}function directConvolution(p,l,g){if(g===void 0){const E=p.length+l.length-1;g=new Array(E)}fill(g);for(var m=0;m<p.length;m++)for(var x=0;x<l.length;x++)g[m+x]+=p[m]*l[x];return g}function fill(p){for(var l=0;l<p.length;l++)p[l]=0}function convolutionSeparable(p,l,g,m){const x=new Array(p.length);let E,S,h,I;I=l[1],h=(I.length-1)/2,S=new Array(g+I.length-1),E=new Array(g);for(let T=0;T<m;T++){for(let A=0;A<g;A++)E[A]=p[T*g+A];directConvolution(E,I,S);for(let A=0;A<g;A++)x[T*g+A]=S[h+A]}I=l[0],h=(I.length-1)/2,S=new Array(m+I.length-1),E=new Array(m);for(let T=0;T<g;T++){for(let A=0;A<m;A++)E[A]=x[A*g+T];directConvolution(E,I,S);for(let A=0;A<m;A++)x[A*g+T]=S[h+A]}return x}const toString$2=Object.prototype.toString;function isAnyArray(p){return toString$2.call(p).endsWith("Array]")}function max$1(p){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(p))throw new TypeError("input must be an array");if(p.length===0)throw new TypeError("input must not be empty");var g=l.fromIndex,m=g===void 0?0:g,x=l.toIndex,E=x===void 0?p.length:x;if(m<0||m>=p.length||!Number.isInteger(m))throw new Error("fromIndex must be a positive integer smaller than length");if(E<=m||E>p.length||!Number.isInteger(E))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var S=p[m],h=m+1;h<E;h++)p[h]>S&&(S=p[h]);return S}function min$1(p){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(p))throw new TypeError("input must be an array");if(p.length===0)throw new TypeError("input must not be empty");var g=l.fromIndex,m=g===void 0?0:g,x=l.toIndex,E=x===void 0?p.length:x;if(m<0||m>=p.length||!Number.isInteger(m))throw new Error("fromIndex must be a positive integer smaller than length");if(E<=m||E>p.length||!Number.isInteger(E))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var S=p[m],h=m+1;h<E;h++)p[h]<S&&(S=p[h]);return S}function rescale(p){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(p)){if(p.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var g;if(l.output!==void 0){if(!isAnyArray(l.output))throw new TypeError("output option must be an array if specified");g=l.output}else g=new Array(p.length);var m=min$1(p),x=max$1(p);if(m===x)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var E=l.min,S=E===void 0?l.autoMinMax?m:0:E,h=l.max,I=h===void 0?l.autoMinMax?x:1:h;if(S>=I)throw new RangeError("min option must be smaller than max option");for(var T=(I-S)/(x-m),A=0;A<p.length;A++)g[A]=(p[A]-m)*T+S;return g}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(p,l={}){const{maxRows:g=15,maxColumns:m=10,maxNumSize:x=8}=l;return`${p.constructor.name} {
${indent}[
${indentData}${inspectData(p,g,m,x)}
${indent}]
${indent}rows: ${p.rows}
${indent}columns: ${p.columns}
}`}function inspectData(p,l,g,m){const{rows:x,columns:E}=p,S=Math.min(x,l),h=Math.min(E,g),I=[];for(let T=0;T<S;T++){let A=[];for(let k=0;k<h;k++)A.push(formatNumber(p.get(T,k),m));I.push(`${A.join(" ")}`)}return h!==E&&(I[I.length-1]+=` ... ${E-g} more columns`),S!==x&&I.push(`... ${x-l} more rows`),I.join(`
${indentData}`)}function formatNumber(p,l){const g=String(p);if(g.length<=l)return g.padEnd(l," ");const m=p.toPrecision(l-2);if(m.length<=l)return m;const x=p.toExponential(l-2),E=x.indexOf("e"),S=x.slice(E);return x.slice(0,l-S.length)+S}function installMathOperations(p,l){p.prototype.add=function(m){return typeof m=="number"?this.addS(m):this.addM(m)},p.prototype.addS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)+m);return this},p.prototype.addM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)+m.get(x,E));return this},p.add=function(m,x){return new l(m).add(x)},p.prototype.sub=function(m){return typeof m=="number"?this.subS(m):this.subM(m)},p.prototype.subS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)-m);return this},p.prototype.subM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)-m.get(x,E));return this},p.sub=function(m,x){return new l(m).sub(x)},p.prototype.subtract=p.prototype.sub,p.prototype.subtractS=p.prototype.subS,p.prototype.subtractM=p.prototype.subM,p.subtract=p.sub,p.prototype.mul=function(m){return typeof m=="number"?this.mulS(m):this.mulM(m)},p.prototype.mulS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)*m);return this},p.prototype.mulM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)*m.get(x,E));return this},p.mul=function(m,x){return new l(m).mul(x)},p.prototype.multiply=p.prototype.mul,p.prototype.multiplyS=p.prototype.mulS,p.prototype.multiplyM=p.prototype.mulM,p.multiply=p.mul,p.prototype.div=function(m){return typeof m=="number"?this.divS(m):this.divM(m)},p.prototype.divS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)/m);return this},p.prototype.divM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)/m.get(x,E));return this},p.div=function(m,x){return new l(m).div(x)},p.prototype.divide=p.prototype.div,p.prototype.divideS=p.prototype.divS,p.prototype.divideM=p.prototype.divM,p.divide=p.div,p.prototype.mod=function(m){return typeof m=="number"?this.modS(m):this.modM(m)},p.prototype.modS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)%m);return this},p.prototype.modM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)%m.get(x,E));return this},p.mod=function(m,x){return new l(m).mod(x)},p.prototype.modulus=p.prototype.mod,p.prototype.modulusS=p.prototype.modS,p.prototype.modulusM=p.prototype.modM,p.modulus=p.mod,p.prototype.and=function(m){return typeof m=="number"?this.andS(m):this.andM(m)},p.prototype.andS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)&m);return this},p.prototype.andM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)&m.get(x,E));return this},p.and=function(m,x){return new l(m).and(x)},p.prototype.or=function(m){return typeof m=="number"?this.orS(m):this.orM(m)},p.prototype.orS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)|m);return this},p.prototype.orM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)|m.get(x,E));return this},p.or=function(m,x){return new l(m).or(x)},p.prototype.xor=function(m){return typeof m=="number"?this.xorS(m):this.xorM(m)},p.prototype.xorS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)^m);return this},p.prototype.xorM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)^m.get(x,E));return this},p.xor=function(m,x){return new l(m).xor(x)},p.prototype.leftShift=function(m){return typeof m=="number"?this.leftShiftS(m):this.leftShiftM(m)},p.prototype.leftShiftS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)<<m);return this},p.prototype.leftShiftM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)<<m.get(x,E));return this},p.leftShift=function(m,x){return new l(m).leftShift(x)},p.prototype.signPropagatingRightShift=function(m){return typeof m=="number"?this.signPropagatingRightShiftS(m):this.signPropagatingRightShiftM(m)},p.prototype.signPropagatingRightShiftS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)>>m);return this},p.prototype.signPropagatingRightShiftM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)>>m.get(x,E));return this},p.signPropagatingRightShift=function(m,x){return new l(m).signPropagatingRightShift(x)},p.prototype.rightShift=function(m){return typeof m=="number"?this.rightShiftS(m):this.rightShiftM(m)},p.prototype.rightShiftS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)>>>m);return this},p.prototype.rightShiftM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,this.get(x,E)>>>m.get(x,E));return this},p.rightShift=function(m,x){return new l(m).rightShift(x)},p.prototype.zeroFillRightShift=p.prototype.rightShift,p.prototype.zeroFillRightShiftS=p.prototype.rightShiftS,p.prototype.zeroFillRightShiftM=p.prototype.rightShiftM,p.zeroFillRightShift=p.rightShift,p.prototype.not=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,~this.get(m,x));return this},p.not=function(m){return new l(m).not()},p.prototype.abs=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.abs(this.get(m,x)));return this},p.abs=function(m){return new l(m).abs()},p.prototype.acos=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.acos(this.get(m,x)));return this},p.acos=function(m){return new l(m).acos()},p.prototype.acosh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.acosh(this.get(m,x)));return this},p.acosh=function(m){return new l(m).acosh()},p.prototype.asin=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.asin(this.get(m,x)));return this},p.asin=function(m){return new l(m).asin()},p.prototype.asinh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.asinh(this.get(m,x)));return this},p.asinh=function(m){return new l(m).asinh()},p.prototype.atan=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.atan(this.get(m,x)));return this},p.atan=function(m){return new l(m).atan()},p.prototype.atanh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.atanh(this.get(m,x)));return this},p.atanh=function(m){return new l(m).atanh()},p.prototype.cbrt=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.cbrt(this.get(m,x)));return this},p.cbrt=function(m){return new l(m).cbrt()},p.prototype.ceil=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.ceil(this.get(m,x)));return this},p.ceil=function(m){return new l(m).ceil()},p.prototype.clz32=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.clz32(this.get(m,x)));return this},p.clz32=function(m){return new l(m).clz32()},p.prototype.cos=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.cos(this.get(m,x)));return this},p.cos=function(m){return new l(m).cos()},p.prototype.cosh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.cosh(this.get(m,x)));return this},p.cosh=function(m){return new l(m).cosh()},p.prototype.exp=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.exp(this.get(m,x)));return this},p.exp=function(m){return new l(m).exp()},p.prototype.expm1=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.expm1(this.get(m,x)));return this},p.expm1=function(m){return new l(m).expm1()},p.prototype.floor=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.floor(this.get(m,x)));return this},p.floor=function(m){return new l(m).floor()},p.prototype.fround=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.fround(this.get(m,x)));return this},p.fround=function(m){return new l(m).fround()},p.prototype.log=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.log(this.get(m,x)));return this},p.log=function(m){return new l(m).log()},p.prototype.log1p=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.log1p(this.get(m,x)));return this},p.log1p=function(m){return new l(m).log1p()},p.prototype.log10=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.log10(this.get(m,x)));return this},p.log10=function(m){return new l(m).log10()},p.prototype.log2=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.log2(this.get(m,x)));return this},p.log2=function(m){return new l(m).log2()},p.prototype.round=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.round(this.get(m,x)));return this},p.round=function(m){return new l(m).round()},p.prototype.sign=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.sign(this.get(m,x)));return this},p.sign=function(m){return new l(m).sign()},p.prototype.sin=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.sin(this.get(m,x)));return this},p.sin=function(m){return new l(m).sin()},p.prototype.sinh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.sinh(this.get(m,x)));return this},p.sinh=function(m){return new l(m).sinh()},p.prototype.sqrt=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.sqrt(this.get(m,x)));return this},p.sqrt=function(m){return new l(m).sqrt()},p.prototype.tan=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.tan(this.get(m,x)));return this},p.tan=function(m){return new l(m).tan()},p.prototype.tanh=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.tanh(this.get(m,x)));return this},p.tanh=function(m){return new l(m).tanh()},p.prototype.trunc=function(){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.set(m,x,Math.trunc(this.get(m,x)));return this},p.trunc=function(m){return new l(m).trunc()},p.pow=function(m,x){return new l(m).pow(x)},p.prototype.pow=function(m){return typeof m=="number"?this.powS(m):this.powM(m)},p.prototype.powS=function(m){for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,Math.pow(this.get(x,E),m));return this},p.prototype.powM=function(m){if(m=l.checkMatrix(m),this.rows!==m.rows||this.columns!==m.columns)throw new RangeError("Matrices dimensions must be equal");for(let x=0;x<this.rows;x++)for(let E=0;E<this.columns;E++)this.set(x,E,Math.pow(this.get(x,E),m.get(x,E)));return this}}function checkRowIndex(p,l,g){let m=g?p.rows:p.rows-1;if(l<0||l>m)throw new RangeError("Row index out of range")}function checkColumnIndex(p,l,g){let m=g?p.columns:p.columns-1;if(l<0||l>m)throw new RangeError("Column index out of range")}function checkRowVector(p,l){if(l.to1DArray&&(l=l.to1DArray()),l.length!==p.columns)throw new RangeError("vector size must be the same as the number of columns");return l}function checkColumnVector(p,l){if(l.to1DArray&&(l=l.to1DArray()),l.length!==p.rows)throw new RangeError("vector size must be the same as the number of rows");return l}function checkIndices(p,l,g){return{row:checkRowIndices(p,l),column:checkColumnIndices(p,g)}}function checkRowIndices(p,l){if(typeof l!="object")throw new TypeError("unexpected type for row indices");if(l.some(m=>m<0||m>=p.rows))throw new RangeError("row indices are out of range");return Array.isArray(l)||(l=Array.from(l)),l}function checkColumnIndices(p,l){if(typeof l!="object")throw new TypeError("unexpected type for column indices");if(l.some(m=>m<0||m>=p.columns))throw new RangeError("column indices are out of range");return Array.isArray(l)||(l=Array.from(l)),l}function checkRange(p,l,g,m,x){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",l),checkNumber("endRow",g),checkNumber("startColumn",m),checkNumber("endColumn",x),l>g||m>x||l<0||l>=p.rows||g<0||g>=p.rows||m<0||m>=p.columns||x<0||x>=p.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$1(p,l=0){let g=[];for(let m=0;m<p;m++)g.push(l);return g}function checkNumber(p,l){if(typeof l!="number")throw new TypeError(`${p} must be a number`)}function checkNonEmpty(p){if(p.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(p){let l=newArray$1(p.rows);for(let g=0;g<p.rows;++g)for(let m=0;m<p.columns;++m)l[g]+=p.get(g,m);return l}function sumByColumn(p){let l=newArray$1(p.columns);for(let g=0;g<p.rows;++g)for(let m=0;m<p.columns;++m)l[m]+=p.get(g,m);return l}function sumAll(p){let l=0;for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)l+=p.get(g,m);return l}function productByRow(p){let l=newArray$1(p.rows,1);for(let g=0;g<p.rows;++g)for(let m=0;m<p.columns;++m)l[g]*=p.get(g,m);return l}function productByColumn(p){let l=newArray$1(p.columns,1);for(let g=0;g<p.rows;++g)for(let m=0;m<p.columns;++m)l[m]*=p.get(g,m);return l}function productAll(p){let l=1;for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)l*=p.get(g,m);return l}function varianceByRow(p,l,g){const m=p.rows,x=p.columns,E=[];for(let S=0;S<m;S++){let h=0,I=0,T=0;for(let A=0;A<x;A++)T=p.get(S,A)-g[S],h+=T,I+=T*T;l?E.push((I-h*h/x)/(x-1)):E.push((I-h*h/x)/x)}return E}function varianceByColumn(p,l,g){const m=p.rows,x=p.columns,E=[];for(let S=0;S<x;S++){let h=0,I=0,T=0;for(let A=0;A<m;A++)T=p.get(A,S)-g[S],h+=T,I+=T*T;l?E.push((I-h*h/m)/(m-1)):E.push((I-h*h/m)/m)}return E}function varianceAll(p,l,g){const m=p.rows,x=p.columns,E=m*x;let S=0,h=0,I=0;for(let T=0;T<m;T++)for(let A=0;A<x;A++)I=p.get(T,A)-g,S+=I,h+=I*I;return l?(h-S*S/E)/(E-1):(h-S*S/E)/E}function centerByRow(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)-l[g])}function centerByColumn(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)-l[m])}function centerAll(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)-l)}function getScaleByRow(p){const l=[];for(let g=0;g<p.rows;g++){let m=0;for(let x=0;x<p.columns;x++)m+=Math.pow(p.get(g,x),2)/(p.columns-1);l.push(Math.sqrt(m))}return l}function scaleByRow(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)/l[g])}function getScaleByColumn(p){const l=[];for(let g=0;g<p.columns;g++){let m=0;for(let x=0;x<p.rows;x++)m+=Math.pow(p.get(x,g),2)/(p.rows-1);l.push(Math.sqrt(m))}return l}function scaleByColumn(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)/l[m])}function getScaleAll(p){const l=p.size-1;let g=0;for(let m=0;m<p.columns;m++)for(let x=0;x<p.rows;x++)g+=Math.pow(p.get(x,m),2)/l;return Math.sqrt(g)}function scaleAll(p,l){for(let g=0;g<p.rows;g++)for(let m=0;m<p.columns;m++)p.set(g,m,p.get(g,m)/l)}class AbstractMatrix{static from1DArray(l,g,m){if(l*g!==m.length)throw new RangeError("data length does not match given dimensions");let E=new Matrix$2(l,g);for(let S=0;S<l;S++)for(let h=0;h<g;h++)E.set(S,h,m[S*g+h]);return E}static rowVector(l){let g=new Matrix$2(1,l.length);for(let m=0;m<l.length;m++)g.set(0,m,l[m]);return g}static columnVector(l){let g=new Matrix$2(l.length,1);for(let m=0;m<l.length;m++)g.set(m,0,l[m]);return g}static zeros(l,g){return new Matrix$2(l,g)}static ones(l,g){return new Matrix$2(l,g).fill(1)}static rand(l,g,m={}){if(typeof m!="object")throw new TypeError("options must be an object");const{random:x=Math.random}=m;let E=new Matrix$2(l,g);for(let S=0;S<l;S++)for(let h=0;h<g;h++)E.set(S,h,x());return E}static randInt(l,g,m={}){if(typeof m!="object")throw new TypeError("options must be an object");const{min:x=0,max:E=1e3,random:S=Math.random}=m;if(!Number.isInteger(x))throw new TypeError("min must be an integer");if(!Number.isInteger(E))throw new TypeError("max must be an integer");if(x>=E)throw new RangeError("min must be smaller than max");let h=E-x,I=new Matrix$2(l,g);for(let T=0;T<l;T++)for(let A=0;A<g;A++){let k=x+Math.round(S()*h);I.set(T,A,k)}return I}static eye(l,g,m){g===void 0&&(g=l),m===void 0&&(m=1);let x=Math.min(l,g),E=this.zeros(l,g);for(let S=0;S<x;S++)E.set(S,S,m);return E}static diag(l,g,m){let x=l.length;g===void 0&&(g=x),m===void 0&&(m=g);let E=Math.min(x,g,m),S=this.zeros(g,m);for(let h=0;h<E;h++)S.set(h,h,l[h]);return S}static min(l,g){l=this.checkMatrix(l),g=this.checkMatrix(g);let m=l.rows,x=l.columns,E=new Matrix$2(m,x);for(let S=0;S<m;S++)for(let h=0;h<x;h++)E.set(S,h,Math.min(l.get(S,h),g.get(S,h)));return E}static max(l,g){l=this.checkMatrix(l),g=this.checkMatrix(g);let m=l.rows,x=l.columns,E=new this(m,x);for(let S=0;S<m;S++)for(let h=0;h<x;h++)E.set(S,h,Math.max(l.get(S,h),g.get(S,h)));return E}static checkMatrix(l){return AbstractMatrix.isMatrix(l)?l:new Matrix$2(l)}static isMatrix(l){return l!=null&&l.klass==="Matrix"}get size(){return this.rows*this.columns}apply(l){if(typeof l!="function")throw new TypeError("callback must be a function");for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)l.call(this,g,m);return this}to1DArray(){let l=[];for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)l.push(this.get(g,m));return l}to2DArray(){let l=[];for(let g=0;g<this.rows;g++){l.push([]);for(let m=0;m<this.columns;m++)l[g].push(this.get(g,m))}return l}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let l=0;l<this.rows;l++)for(let g=0;g<=l;g++)if(this.get(l,g)!==this.get(g,l))return!1;return!0}return!1}isEchelonForm(){let l=0,g=0,m=-1,x=!0,E=!1;for(;l<this.rows&&x;){for(g=0,E=!1;g<this.columns&&E===!1;)this.get(l,g)===0?g++:this.get(l,g)===1&&g>m?(E=!0,m=g):(x=!1,E=!0);l++}return x}isReducedEchelonForm(){let l=0,g=0,m=-1,x=!0,E=!1;for(;l<this.rows&&x;){for(g=0,E=!1;g<this.columns&&E===!1;)this.get(l,g)===0?g++:this.get(l,g)===1&&g>m?(E=!0,m=g):(x=!1,E=!0);for(let S=g+1;S<this.rows;S++)this.get(l,S)!==0&&(x=!1);l++}return x}echelonForm(){let l=this.clone(),g=0,m=0;for(;g<l.rows&&m<l.columns;){let x=g;for(let E=g;E<l.rows;E++)l.get(E,m)>l.get(x,m)&&(x=E);if(l.get(x,m)===0)m++;else{l.swapRows(g,x);let E=l.get(g,m);for(let S=m;S<l.columns;S++)l.set(g,S,l.get(g,S)/E);for(let S=g+1;S<l.rows;S++){let h=l.get(S,m)/l.get(g,m);l.set(S,m,0);for(let I=m+1;I<l.columns;I++)l.set(S,I,l.get(S,I)-l.get(g,I)*h)}g++,m++}}return l}reducedEchelonForm(){let l=this.echelonForm(),g=l.columns,m=l.rows,x=m-1;for(;x>=0;)if(l.maxRow(x)===0)x--;else{let E=0,S=!1;for(;E<m&&S===!1;)l.get(x,E)===1?S=!0:E++;for(let h=0;h<x;h++){let I=l.get(h,E);for(let T=E;T<g;T++){let A=l.get(h,T)-I*l.get(x,T);l.set(h,T,A)}}x--}return l}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(l={}){if(typeof l!="object")throw new TypeError("options must be an object");const{rows:g=1,columns:m=1}=l;if(!Number.isInteger(g)||g<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(m)||m<=0)throw new TypeError("columns must be a positive integer");let x=new Matrix$2(this.rows*g,this.columns*m);for(let E=0;E<g;E++)for(let S=0;S<m;S++)x.setSubMatrix(this,this.rows*E,this.columns*S);return x}fill(l){for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,l);return this}neg(){return this.mulS(-1)}getRow(l){checkRowIndex(this,l);let g=[];for(let m=0;m<this.columns;m++)g.push(this.get(l,m));return g}getRowVector(l){return Matrix$2.rowVector(this.getRow(l))}setRow(l,g){checkRowIndex(this,l),g=checkRowVector(this,g);for(let m=0;m<this.columns;m++)this.set(l,m,g[m]);return this}swapRows(l,g){checkRowIndex(this,l),checkRowIndex(this,g);for(let m=0;m<this.columns;m++){let x=this.get(l,m);this.set(l,m,this.get(g,m)),this.set(g,m,x)}return this}getColumn(l){checkColumnIndex(this,l);let g=[];for(let m=0;m<this.rows;m++)g.push(this.get(m,l));return g}getColumnVector(l){return Matrix$2.columnVector(this.getColumn(l))}setColumn(l,g){checkColumnIndex(this,l),g=checkColumnVector(this,g);for(let m=0;m<this.rows;m++)this.set(m,l,g[m]);return this}swapColumns(l,g){checkColumnIndex(this,l),checkColumnIndex(this,g);for(let m=0;m<this.rows;m++){let x=this.get(m,l);this.set(m,l,this.get(m,g)),this.set(m,g,x)}return this}addRowVector(l){l=checkRowVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)+l[m]);return this}subRowVector(l){l=checkRowVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)-l[m]);return this}mulRowVector(l){l=checkRowVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)*l[m]);return this}divRowVector(l){l=checkRowVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)/l[m]);return this}addColumnVector(l){l=checkColumnVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)+l[g]);return this}subColumnVector(l){l=checkColumnVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)-l[g]);return this}mulColumnVector(l){l=checkColumnVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)*l[g]);return this}divColumnVector(l){l=checkColumnVector(this,l);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.set(g,m,this.get(g,m)/l[g]);return this}mulRow(l,g){checkRowIndex(this,l);for(let m=0;m<this.columns;m++)this.set(l,m,this.get(l,m)*g);return this}mulColumn(l,g){checkColumnIndex(this,l);for(let m=0;m<this.rows;m++)this.set(m,l,this.get(m,l)*g);return this}max(){if(this.isEmpty())return NaN;let l=this.get(0,0);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.get(g,m)>l&&(l=this.get(g,m));return l}maxIndex(){checkNonEmpty(this);let l=this.get(0,0),g=[0,0];for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.get(m,x)>l&&(l=this.get(m,x),g[0]=m,g[1]=x);return g}min(){if(this.isEmpty())return NaN;let l=this.get(0,0);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)this.get(g,m)<l&&(l=this.get(g,m));return l}minIndex(){checkNonEmpty(this);let l=this.get(0,0),g=[0,0];for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)this.get(m,x)<l&&(l=this.get(m,x),g[0]=m,g[1]=x);return g}maxRow(l){if(checkRowIndex(this,l),this.isEmpty())return NaN;let g=this.get(l,0);for(let m=1;m<this.columns;m++)this.get(l,m)>g&&(g=this.get(l,m));return g}maxRowIndex(l){checkRowIndex(this,l),checkNonEmpty(this);let g=this.get(l,0),m=[l,0];for(let x=1;x<this.columns;x++)this.get(l,x)>g&&(g=this.get(l,x),m[1]=x);return m}minRow(l){if(checkRowIndex(this,l),this.isEmpty())return NaN;let g=this.get(l,0);for(let m=1;m<this.columns;m++)this.get(l,m)<g&&(g=this.get(l,m));return g}minRowIndex(l){checkRowIndex(this,l),checkNonEmpty(this);let g=this.get(l,0),m=[l,0];for(let x=1;x<this.columns;x++)this.get(l,x)<g&&(g=this.get(l,x),m[1]=x);return m}maxColumn(l){if(checkColumnIndex(this,l),this.isEmpty())return NaN;let g=this.get(0,l);for(let m=1;m<this.rows;m++)this.get(m,l)>g&&(g=this.get(m,l));return g}maxColumnIndex(l){checkColumnIndex(this,l),checkNonEmpty(this);let g=this.get(0,l),m=[0,l];for(let x=1;x<this.rows;x++)this.get(x,l)>g&&(g=this.get(x,l),m[0]=x);return m}minColumn(l){if(checkColumnIndex(this,l),this.isEmpty())return NaN;let g=this.get(0,l);for(let m=1;m<this.rows;m++)this.get(m,l)<g&&(g=this.get(m,l));return g}minColumnIndex(l){checkColumnIndex(this,l),checkNonEmpty(this);let g=this.get(0,l),m=[0,l];for(let x=1;x<this.rows;x++)this.get(x,l)<g&&(g=this.get(x,l),m[0]=x);return m}diag(){let l=Math.min(this.rows,this.columns),g=[];for(let m=0;m<l;m++)g.push(this.get(m,m));return g}norm(l="frobenius"){let g=0;if(l==="max")return this.max();if(l==="frobenius"){for(let m=0;m<this.rows;m++)for(let x=0;x<this.columns;x++)g=g+this.get(m,x)*this.get(m,x);return Math.sqrt(g)}else throw new RangeError(`unknown norm type: ${l}`)}cumulativeSum(){let l=0;for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)l+=this.get(g,m),this.set(g,m,l);return this}dot(l){AbstractMatrix.isMatrix(l)&&(l=l.to1DArray());let g=this.to1DArray();if(g.length!==l.length)throw new RangeError("vectors do not have the same size");let m=0;for(let x=0;x<g.length;x++)m+=g[x]*l[x];return m}mmul(l){l=Matrix$2.checkMatrix(l);let g=this.rows,m=this.columns,x=l.columns,E=new Matrix$2(g,x),S=new Float64Array(m);for(let h=0;h<x;h++){for(let I=0;I<m;I++)S[I]=l.get(I,h);for(let I=0;I<g;I++){let T=0;for(let A=0;A<m;A++)T+=this.get(I,A)*S[A];E.set(I,h,T)}}return E}strassen2x2(l){l=Matrix$2.checkMatrix(l);let g=new Matrix$2(2,2);const m=this.get(0,0),x=l.get(0,0),E=this.get(0,1),S=l.get(0,1),h=this.get(1,0),I=l.get(1,0),T=this.get(1,1),A=l.get(1,1),k=(m+T)*(x+A),P=(h+T)*x,D=m*(S-A),M=T*(I-x),F=(m+E)*A,N=(h-m)*(x+S),B=(E-T)*(I+A),U=k+M-F+B,O=D+F,V=P+M,Z=k-P+D+N;return g.set(0,0,U),g.set(0,1,O),g.set(1,0,V),g.set(1,1,Z),g}strassen3x3(l){l=Matrix$2.checkMatrix(l);let g=new Matrix$2(3,3);const m=this.get(0,0),x=this.get(0,1),E=this.get(0,2),S=this.get(1,0),h=this.get(1,1),I=this.get(1,2),T=this.get(2,0),A=this.get(2,1),k=this.get(2,2),P=l.get(0,0),D=l.get(0,1),M=l.get(0,2),F=l.get(1,0),N=l.get(1,1),B=l.get(1,2),U=l.get(2,0),O=l.get(2,1),V=l.get(2,2),Z=(m+x+E-S-h-A-k)*N,W=(m-S)*(-D+N),Y=h*(-P+D+F-N-B-U+V),X=(-m+S+h)*(P-D+N),J=(S+h)*(-P+D),q=m*P,te=(-m+T+A)*(P-M+B),ne=(-m+T)*(M-B),de=(T+A)*(-P+M),oe=(m+x+E-h-I-T-A)*B,we=A*(-P+M+F-N-B-U+O),Ae=(-E+A+k)*(N+U-O),ye=(E-k)*(N-O),me=E*U,xe=(A+k)*(-U+O),Le=(-E+h+I)*(B+U-V),Ze=(E-I)*(B-V),Xe=(h+I)*(-U+V),je=x*F,Ie=I*O,Pe=S*M,De=T*D,ze=k*V,it=q+me+je,tt=Z+X+J+q+Ae+me+xe,ot=q+te+de+oe+me+Le+Xe,lt=W+Y+X+q+me+Le+Ze,St=W+X+J+q+Ie,et=me+Le+Ze+Xe+Pe,Je=q+te+ne+we+Ae+ye+me,Be=Ae+ye+me+xe+De,Ge=q+te+ne+de+ze;return g.set(0,0,it),g.set(0,1,tt),g.set(0,2,ot),g.set(1,0,lt),g.set(1,1,St),g.set(1,2,et),g.set(2,0,Je),g.set(2,1,Be),g.set(2,2,Ge),g}mmulStrassen(l){l=Matrix$2.checkMatrix(l);let g=this.clone(),m=g.rows,x=g.columns,E=l.rows,S=l.columns;x!==E&&console.warn(`Multiplying ${m} x ${x} and ${E} x ${S} matrix: dimensions do not match.`);function h(k,P,D){let M=k.rows,F=k.columns;if(M===P&&F===D)return k;{let N=AbstractMatrix.zeros(P,D);return N=N.setSubMatrix(k,0,0),N}}let I=Math.max(m,E),T=Math.max(x,S);g=h(g,I,T),l=h(l,I,T);function A(k,P,D,M){if(D<=512||M<=512)return k.mmul(P);D%2==1&&M%2==1?(k=h(k,D+1,M+1),P=h(P,D+1,M+1)):D%2==1?(k=h(k,D+1,M),P=h(P,D+1,M)):M%2==1&&(k=h(k,D,M+1),P=h(P,D,M+1));let F=parseInt(k.rows/2,10),N=parseInt(k.columns/2,10),B=k.subMatrix(0,F-1,0,N-1),U=P.subMatrix(0,F-1,0,N-1),O=k.subMatrix(0,F-1,N,k.columns-1),V=P.subMatrix(0,F-1,N,P.columns-1),Z=k.subMatrix(F,k.rows-1,0,N-1),W=P.subMatrix(F,P.rows-1,0,N-1),Y=k.subMatrix(F,k.rows-1,N,k.columns-1),X=P.subMatrix(F,P.rows-1,N,P.columns-1),J=A(AbstractMatrix.add(B,Y),AbstractMatrix.add(U,X),F,N),q=A(AbstractMatrix.add(Z,Y),U,F,N),te=A(B,AbstractMatrix.sub(V,X),F,N),ne=A(Y,AbstractMatrix.sub(W,U),F,N),de=A(AbstractMatrix.add(B,O),X,F,N),oe=A(AbstractMatrix.sub(Z,B),AbstractMatrix.add(U,V),F,N),we=A(AbstractMatrix.sub(O,Y),AbstractMatrix.add(W,X),F,N),Ae=AbstractMatrix.add(J,ne);Ae.sub(de),Ae.add(we);let ye=AbstractMatrix.add(te,de),me=AbstractMatrix.add(q,ne),xe=AbstractMatrix.sub(J,q);xe.add(te),xe.add(oe);let Le=AbstractMatrix.zeros(2*Ae.rows,2*Ae.columns);return Le=Le.setSubMatrix(Ae,0,0),Le=Le.setSubMatrix(ye,Ae.rows,0),Le=Le.setSubMatrix(me,0,Ae.columns),Le=Le.setSubMatrix(xe,Ae.rows,Ae.columns),Le.subMatrix(0,D-1,0,M-1)}return A(g,l,I,T)}scaleRows(l={}){if(typeof l!="object")throw new TypeError("options must be an object");const{min:g=0,max:m=1}=l;if(!Number.isFinite(g))throw new TypeError("min must be a number");if(!Number.isFinite(m))throw new TypeError("max must be a number");if(g>=m)throw new RangeError("min must be smaller than max");let x=new Matrix$2(this.rows,this.columns);for(let E=0;E<this.rows;E++){const S=this.getRow(E);S.length>0&&rescale(S,{min:g,max:m,output:S}),x.setRow(E,S)}return x}scaleColumns(l={}){if(typeof l!="object")throw new TypeError("options must be an object");const{min:g=0,max:m=1}=l;if(!Number.isFinite(g))throw new TypeError("min must be a number");if(!Number.isFinite(m))throw new TypeError("max must be a number");if(g>=m)throw new RangeError("min must be smaller than max");let x=new Matrix$2(this.rows,this.columns);for(let E=0;E<this.columns;E++){const S=this.getColumn(E);S.length&&rescale(S,{min:g,max:m,output:S}),x.setColumn(E,S)}return x}flipRows(){const l=Math.ceil(this.columns/2);for(let g=0;g<this.rows;g++)for(let m=0;m<l;m++){let x=this.get(g,m),E=this.get(g,this.columns-1-m);this.set(g,m,E),this.set(g,this.columns-1-m,x)}return this}flipColumns(){const l=Math.ceil(this.rows/2);for(let g=0;g<this.columns;g++)for(let m=0;m<l;m++){let x=this.get(m,g),E=this.get(this.rows-1-m,g);this.set(m,g,E),this.set(this.rows-1-m,g,x)}return this}kroneckerProduct(l){l=Matrix$2.checkMatrix(l);let g=this.rows,m=this.columns,x=l.rows,E=l.columns,S=new Matrix$2(g*x,m*E);for(let h=0;h<g;h++)for(let I=0;I<m;I++)for(let T=0;T<x;T++)for(let A=0;A<E;A++)S.set(x*h+T,E*I+A,this.get(h,I)*l.get(T,A));return S}kroneckerSum(l){if(l=Matrix$2.checkMatrix(l),!this.isSquare()||!l.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let g=this.rows,m=l.rows,x=this.kroneckerProduct(Matrix$2.eye(m,m)),E=Matrix$2.eye(g,g).kroneckerProduct(l);return x.add(E)}transpose(){let l=new Matrix$2(this.columns,this.rows);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)l.set(m,g,this.get(g,m));return l}sortRows(l=compareNumbers){for(let g=0;g<this.rows;g++)this.setRow(g,this.getRow(g).sort(l));return this}sortColumns(l=compareNumbers){for(let g=0;g<this.columns;g++)this.setColumn(g,this.getColumn(g).sort(l));return this}subMatrix(l,g,m,x){checkRange(this,l,g,m,x);let E=new Matrix$2(g-l+1,x-m+1);for(let S=l;S<=g;S++)for(let h=m;h<=x;h++)E.set(S-l,h-m,this.get(S,h));return E}subMatrixRow(l,g,m){if(g===void 0&&(g=0),m===void 0&&(m=this.columns-1),g>m||g<0||g>=this.columns||m<0||m>=this.columns)throw new RangeError("Argument out of range");let x=new Matrix$2(l.length,m-g+1);for(let E=0;E<l.length;E++)for(let S=g;S<=m;S++){if(l[E]<0||l[E]>=this.rows)throw new RangeError(`Row index out of range: ${l[E]}`);x.set(E,S-g,this.get(l[E],S))}return x}subMatrixColumn(l,g,m){if(g===void 0&&(g=0),m===void 0&&(m=this.rows-1),g>m||g<0||g>=this.rows||m<0||m>=this.rows)throw new RangeError("Argument out of range");let x=new Matrix$2(m-g+1,l.length);for(let E=0;E<l.length;E++)for(let S=g;S<=m;S++){if(l[E]<0||l[E]>=this.columns)throw new RangeError(`Column index out of range: ${l[E]}`);x.set(S-g,E,this.get(S,l[E]))}return x}setSubMatrix(l,g,m){if(l=Matrix$2.checkMatrix(l),l.isEmpty())return this;let x=g+l.rows-1,E=m+l.columns-1;checkRange(this,g,x,m,E);for(let S=0;S<l.rows;S++)for(let h=0;h<l.columns;h++)this.set(g+S,m+h,l.get(S,h));return this}selection(l,g){let m=checkIndices(this,l,g),x=new Matrix$2(l.length,g.length);for(let E=0;E<m.row.length;E++){let S=m.row[E];for(let h=0;h<m.column.length;h++){let I=m.column[h];x.set(E,h,this.get(S,I))}}return x}trace(){let l=Math.min(this.rows,this.columns),g=0;for(let m=0;m<l;m++)g+=this.get(m,m);return g}clone(){let l=new Matrix$2(this.rows,this.columns);for(let g=0;g<this.rows;g++)for(let m=0;m<this.columns;m++)l.set(g,m,this.get(g,m));return l}sum(l){switch(l){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${l}`)}}product(l){switch(l){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${l}`)}}mean(l){const g=this.sum(l);switch(l){case"row":{for(let m=0;m<this.rows;m++)g[m]/=this.columns;return g}case"column":{for(let m=0;m<this.columns;m++)g[m]/=this.rows;return g}case void 0:return g/this.size;default:throw new Error(`invalid option: ${l}`)}}variance(l,g={}){if(typeof l=="object"&&(g=l,l=void 0),typeof g!="object")throw new TypeError("options must be an object");const{unbiased:m=!0,mean:x=this.mean(l)}=g;if(typeof m!="boolean")throw new TypeError("unbiased must be a boolean");switch(l){case"row":{if(!Array.isArray(x))throw new TypeError("mean must be an array");return varianceByRow(this,m,x)}case"column":{if(!Array.isArray(x))throw new TypeError("mean must be an array");return varianceByColumn(this,m,x)}case void 0:{if(typeof x!="number")throw new TypeError("mean must be a number");return varianceAll(this,m,x)}default:throw new Error(`invalid option: ${l}`)}}standardDeviation(l,g){typeof l=="object"&&(g=l,l=void 0);const m=this.variance(l,g);if(l===void 0)return Math.sqrt(m);for(let x=0;x<m.length;x++)m[x]=Math.sqrt(m[x]);return m}center(l,g={}){if(typeof l=="object"&&(g=l,l=void 0),typeof g!="object")throw new TypeError("options must be an object");const{center:m=this.mean(l)}=g;switch(l){case"row":{if(!Array.isArray(m))throw new TypeError("center must be an array");return centerByRow(this,m),this}case"column":{if(!Array.isArray(m))throw new TypeError("center must be an array");return centerByColumn(this,m),this}case void 0:{if(typeof m!="number")throw new TypeError("center must be a number");return centerAll(this,m),this}default:throw new Error(`invalid option: ${l}`)}}scale(l,g={}){if(typeof l=="object"&&(g=l,l=void 0),typeof g!="object")throw new TypeError("options must be an object");let m=g.scale;switch(l){case"row":{if(m===void 0)m=getScaleByRow(this);else if(!Array.isArray(m))throw new TypeError("scale must be an array");return scaleByRow(this,m),this}case"column":{if(m===void 0)m=getScaleByColumn(this);else if(!Array.isArray(m))throw new TypeError("scale must be an array");return scaleByColumn(this,m),this}case void 0:{if(m===void 0)m=getScaleAll(this);else if(typeof m!="number")throw new TypeError("scale must be a number");return scaleAll(this,m),this}default:throw new Error(`invalid option: ${l}`)}}toString(l){return inspectMatrixWithOptions(this,l)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol!="undefined"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(p,l){return p-l}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix$2 extends AbstractMatrix{constructor(l,g){super();if(Matrix$2.isMatrix(l))return l.clone();if(Number.isInteger(l)&&l>=0)if(this.data=[],Number.isInteger(g)&&g>=0)for(let m=0;m<l;m++)this.data.push(new Float64Array(g));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(l)){const m=l;if(l=m.length,g=l?m[0].length:0,typeof g!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let x=0;x<l;x++){if(m[x].length!==g)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(m[x]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=l,this.columns=g}set(l,g,m){return this.data[l][g]=m,this}get(l,g){return this.data[l][g]}removeRow(l){return checkRowIndex(this,l),this.data.splice(l,1),this.rows-=1,this}addRow(l,g){return g===void 0&&(g=l,l=this.rows),checkRowIndex(this,l,!0),g=Float64Array.from(checkRowVector(this,g)),this.data.splice(l,0,g),this.rows+=1,this}removeColumn(l){checkColumnIndex(this,l);for(let g=0;g<this.rows;g++){const m=new Float64Array(this.columns-1);for(let x=0;x<l;x++)m[x]=this.data[g][x];for(let x=l+1;x<this.columns;x++)m[x-1]=this.data[g][x];this.data[g]=m}return this.columns-=1,this}addColumn(l,g){typeof g=="undefined"&&(g=l,l=this.columns),checkColumnIndex(this,l,!0),g=checkColumnVector(this,g);for(let m=0;m<this.rows;m++){const x=new Float64Array(this.columns+1);let E=0;for(;E<l;E++)x[E]=this.data[m][E];for(x[E++]=g[m];E<this.columns+1;E++)x[E]=this.data[m][E-1];this.data[m]=x}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(l,g,m){super();this.matrix=l,this.rows=g,this.columns=m}}class MatrixColumnView extends BaseView{constructor(l,g){checkColumnIndex(l,g);super(l,l.rows,1);this.column=g}set(l,g,m){return this.matrix.set(l,this.column,m),this}get(l){return this.matrix.get(l,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(l,g){g=checkColumnIndices(l,g);super(l,l.rows,g.length);this.columnIndices=g}set(l,g,m){return this.matrix.set(l,this.columnIndices[g],m),this}get(l,g){return this.matrix.get(l,this.columnIndices[g])}}class MatrixFlipColumnView extends BaseView{constructor(l){super(l,l.rows,l.columns)}set(l,g,m){return this.matrix.set(l,this.columns-g-1,m),this}get(l,g){return this.matrix.get(l,this.columns-g-1)}}class MatrixFlipRowView extends BaseView{constructor(l){super(l,l.rows,l.columns)}set(l,g,m){return this.matrix.set(this.rows-l-1,g,m),this}get(l,g){return this.matrix.get(this.rows-l-1,g)}}class MatrixRowView extends BaseView{constructor(l,g){checkRowIndex(l,g);super(l,1,l.columns);this.row=g}set(l,g,m){return this.matrix.set(this.row,g,m),this}get(l,g){return this.matrix.get(this.row,g)}}class MatrixRowSelectionView extends BaseView{constructor(l,g){g=checkRowIndices(l,g);super(l,g.length,l.columns);this.rowIndices=g}set(l,g,m){return this.matrix.set(this.rowIndices[l],g,m),this}get(l,g){return this.matrix.get(this.rowIndices[l],g)}}class MatrixSelectionView extends BaseView{constructor(l,g,m){let x=checkIndices(l,g,m);super(l,x.row.length,x.column.length);this.rowIndices=x.row,this.columnIndices=x.column}set(l,g,m){return this.matrix.set(this.rowIndices[l],this.columnIndices[g],m),this}get(l,g){return this.matrix.get(this.rowIndices[l],this.columnIndices[g])}}class MatrixSubView extends BaseView{constructor(l,g,m,x,E){checkRange(l,g,m,x,E);super(l,m-g+1,E-x+1);this.startRow=g,this.startColumn=x}set(l,g,m){return this.matrix.set(this.startRow+l,this.startColumn+g,m),this}get(l,g){return this.matrix.get(this.startRow+l,this.startColumn+g)}}class MatrixTransposeView$1 extends BaseView{constructor(l){super(l,l.columns,l.rows)}set(l,g,m){return this.matrix.set(g,l,m),this}get(l,g){return this.matrix.get(g,l)}}class WrapperMatrix1D extends AbstractMatrix{constructor(l,g={}){const{rows:m=1}=g;if(l.length%m!=0)throw new Error("the data length is not divisible by the number of rows");super();this.rows=m,this.columns=l.length/m,this.data=l}set(l,g,m){let x=this._calculateIndex(l,g);return this.data[x]=m,this}get(l,g){let m=this._calculateIndex(l,g);return this.data[m]}_calculateIndex(l,g){return l*this.columns+g}}class WrapperMatrix2D extends AbstractMatrix{constructor(l){super();this.data=l,this.rows=l.length,this.columns=l[0].length}set(l,g,m){return this.data[l][g]=m,this}get(l,g){return this.data[l][g]}}function wrap(p,l){if(Array.isArray(p))return p[0]&&Array.isArray(p[0])?new WrapperMatrix2D(p):new WrapperMatrix1D(p,l);throw new Error("the argument is not an array")}class LuDecomposition{constructor(l){l=WrapperMatrix2D.checkMatrix(l);let g=l.clone(),m=g.rows,x=g.columns,E=new Float64Array(m),S=1,h,I,T,A,k,P,D,M,F;for(h=0;h<m;h++)E[h]=h;for(M=new Float64Array(m),I=0;I<x;I++){for(h=0;h<m;h++)M[h]=g.get(h,I);for(h=0;h<m;h++){for(F=Math.min(h,I),k=0,T=0;T<F;T++)k+=g.get(h,T)*M[T];M[h]-=k,g.set(h,I,M[h])}for(A=I,h=I+1;h<m;h++)Math.abs(M[h])>Math.abs(M[A])&&(A=h);if(A!==I){for(T=0;T<x;T++)P=g.get(A,T),g.set(A,T,g.get(I,T)),g.set(I,T,P);D=E[A],E[A]=E[I],E[I]=D,S=-S}if(I<m&&g.get(I,I)!==0)for(h=I+1;h<m;h++)g.set(h,I,g.get(h,I)/g.get(I,I))}this.LU=g,this.pivotVector=E,this.pivotSign=S}isSingular(){let l=this.LU,g=l.columns;for(let m=0;m<g;m++)if(l.get(m,m)===0)return!0;return!1}solve(l){l=Matrix$2.checkMatrix(l);let g=this.LU;if(g.rows!==l.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let x=l.columns,E=l.subMatrixRow(this.pivotVector,0,x-1),S=g.columns,h,I,T;for(T=0;T<S;T++)for(h=T+1;h<S;h++)for(I=0;I<x;I++)E.set(h,I,E.get(h,I)-E.get(T,I)*g.get(h,T));for(T=S-1;T>=0;T--){for(I=0;I<x;I++)E.set(T,I,E.get(T,I)/g.get(T,T));for(h=0;h<T;h++)for(I=0;I<x;I++)E.set(h,I,E.get(h,I)-E.get(T,I)*g.get(h,T))}return E}get determinant(){let l=this.LU;if(!l.isSquare())throw new Error("Matrix must be square");let g=this.pivotSign,m=l.columns;for(let x=0;x<m;x++)g*=l.get(x,x);return g}get lowerTriangularMatrix(){let l=this.LU,g=l.rows,m=l.columns,x=new Matrix$2(g,m);for(let E=0;E<g;E++)for(let S=0;S<m;S++)E>S?x.set(E,S,l.get(E,S)):E===S?x.set(E,S,1):x.set(E,S,0);return x}get upperTriangularMatrix(){let l=this.LU,g=l.rows,m=l.columns,x=new Matrix$2(g,m);for(let E=0;E<g;E++)for(let S=0;S<m;S++)E<=S?x.set(E,S,l.get(E,S)):x.set(E,S,0);return x}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(p,l){let g=0;return Math.abs(p)>Math.abs(l)?(g=l/p,Math.abs(p)*Math.sqrt(1+g*g)):l!==0?(g=p/l,Math.abs(l)*Math.sqrt(1+g*g)):0}class QrDecomposition{constructor(l){l=WrapperMatrix2D.checkMatrix(l);let g=l.clone(),m=l.rows,x=l.columns,E=new Float64Array(x),S,h,I,T;for(I=0;I<x;I++){let A=0;for(S=I;S<m;S++)A=hypotenuse$1(A,g.get(S,I));if(A!==0){for(g.get(I,I)<0&&(A=-A),S=I;S<m;S++)g.set(S,I,g.get(S,I)/A);for(g.set(I,I,g.get(I,I)+1),h=I+1;h<x;h++){for(T=0,S=I;S<m;S++)T+=g.get(S,I)*g.get(S,h);for(T=-T/g.get(I,I),S=I;S<m;S++)g.set(S,h,g.get(S,h)+T*g.get(S,I))}}E[I]=-A}this.QR=g,this.Rdiag=E}solve(l){l=Matrix$2.checkMatrix(l);let g=this.QR,m=g.rows;if(l.rows!==m)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let x=l.columns,E=l.clone(),S=g.columns,h,I,T,A;for(T=0;T<S;T++)for(I=0;I<x;I++){for(A=0,h=T;h<m;h++)A+=g.get(h,T)*E.get(h,I);for(A=-A/g.get(T,T),h=T;h<m;h++)E.set(h,I,E.get(h,I)+A*g.get(h,T))}for(T=S-1;T>=0;T--){for(I=0;I<x;I++)E.set(T,I,E.get(T,I)/this.Rdiag[T]);for(h=0;h<T;h++)for(I=0;I<x;I++)E.set(h,I,E.get(h,I)-E.get(T,I)*g.get(h,T))}return E.subMatrix(0,S-1,0,x-1)}isFullRank(){let l=this.QR.columns;for(let g=0;g<l;g++)if(this.Rdiag[g]===0)return!1;return!0}get upperTriangularMatrix(){let l=this.QR,g=l.columns,m=new Matrix$2(g,g),x,E;for(x=0;x<g;x++)for(E=0;E<g;E++)x<E?m.set(x,E,l.get(x,E)):x===E?m.set(x,E,this.Rdiag[x]):m.set(x,E,0);return m}get orthogonalMatrix(){let l=this.QR,g=l.rows,m=l.columns,x=new Matrix$2(g,m),E,S,h,I;for(h=m-1;h>=0;h--){for(E=0;E<g;E++)x.set(E,h,0);for(x.set(h,h,1),S=h;S<m;S++)if(l.get(h,h)!==0){for(I=0,E=h;E<g;E++)I+=l.get(E,h)*x.get(E,S);for(I=-I/l.get(h,h),E=h;E<g;E++)x.set(E,S,x.get(E,S)+I*l.get(E,h))}}return x}}class SingularValueDecomposition{constructor(l,g={}){if(l=WrapperMatrix2D.checkMatrix(l),l.isEmpty())throw new Error("Matrix must be non-empty");let m=l.rows,x=l.columns;const{computeLeftSingularVectors:E=!0,computeRightSingularVectors:S=!0,autoTranspose:h=!1}=g;let I=Boolean(E),T=Boolean(S),A=!1,k;if(m<x)if(!h)k=l.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{k=l.transpose(),m=k.rows,x=k.columns,A=!0;let q=I;I=T,T=q}else k=l.clone();let P=Math.min(m,x),D=Math.min(m+1,x),M=new Float64Array(D),F=new Matrix$2(m,P),N=new Matrix$2(x,x),B=new Float64Array(x),U=new Float64Array(m),O=new Float64Array(D);for(let q=0;q<D;q++)O[q]=q;let V=Math.min(m-1,x),Z=Math.max(0,Math.min(x-2,m)),W=Math.max(V,Z);for(let q=0;q<W;q++){if(q<V){M[q]=0;for(let te=q;te<m;te++)M[q]=hypotenuse$1(M[q],k.get(te,q));if(M[q]!==0){k.get(q,q)<0&&(M[q]=-M[q]);for(let te=q;te<m;te++)k.set(te,q,k.get(te,q)/M[q]);k.set(q,q,k.get(q,q)+1)}M[q]=-M[q]}for(let te=q+1;te<x;te++){if(q<V&&M[q]!==0){let ne=0;for(let de=q;de<m;de++)ne+=k.get(de,q)*k.get(de,te);ne=-ne/k.get(q,q);for(let de=q;de<m;de++)k.set(de,te,k.get(de,te)+ne*k.get(de,q))}B[te]=k.get(q,te)}if(I&&q<V)for(let te=q;te<m;te++)F.set(te,q,k.get(te,q));if(q<Z){B[q]=0;for(let te=q+1;te<x;te++)B[q]=hypotenuse$1(B[q],B[te]);if(B[q]!==0){B[q+1]<0&&(B[q]=0-B[q]);for(let te=q+1;te<x;te++)B[te]/=B[q];B[q+1]+=1}if(B[q]=-B[q],q+1<m&&B[q]!==0){for(let te=q+1;te<m;te++)U[te]=0;for(let te=q+1;te<m;te++)for(let ne=q+1;ne<x;ne++)U[te]+=B[ne]*k.get(te,ne);for(let te=q+1;te<x;te++){let ne=-B[te]/B[q+1];for(let de=q+1;de<m;de++)k.set(de,te,k.get(de,te)+ne*U[de])}}if(T)for(let te=q+1;te<x;te++)N.set(te,q,B[te])}}let Y=Math.min(x,m+1);if(V<x&&(M[V]=k.get(V,V)),m<Y&&(M[Y-1]=0),Z+1<Y&&(B[Z]=k.get(Z,Y-1)),B[Y-1]=0,I){for(let q=V;q<P;q++){for(let te=0;te<m;te++)F.set(te,q,0);F.set(q,q,1)}for(let q=V-1;q>=0;q--)if(M[q]!==0){for(let te=q+1;te<P;te++){let ne=0;for(let de=q;de<m;de++)ne+=F.get(de,q)*F.get(de,te);ne=-ne/F.get(q,q);for(let de=q;de<m;de++)F.set(de,te,F.get(de,te)+ne*F.get(de,q))}for(let te=q;te<m;te++)F.set(te,q,-F.get(te,q));F.set(q,q,1+F.get(q,q));for(let te=0;te<q-1;te++)F.set(te,q,0)}else{for(let te=0;te<m;te++)F.set(te,q,0);F.set(q,q,1)}}if(T)for(let q=x-1;q>=0;q--){if(q<Z&&B[q]!==0)for(let te=q+1;te<x;te++){let ne=0;for(let de=q+1;de<x;de++)ne+=N.get(de,q)*N.get(de,te);ne=-ne/N.get(q+1,q);for(let de=q+1;de<x;de++)N.set(de,te,N.get(de,te)+ne*N.get(de,q))}for(let te=0;te<x;te++)N.set(te,q,0);N.set(q,q,1)}let X=Y-1,J=Number.EPSILON;for(;Y>0;){let q,te;for(q=Y-2;q>=-1&&q!==-1;q--){const ne=Number.MIN_VALUE+J*Math.abs(M[q]+Math.abs(M[q+1]));if(Math.abs(B[q])<=ne||Number.isNaN(B[q])){B[q]=0;break}}if(q===Y-2)te=4;else{let ne;for(ne=Y-1;ne>=q&&ne!==q;ne--){let de=(ne!==Y?Math.abs(B[ne]):0)+(ne!==q+1?Math.abs(B[ne-1]):0);if(Math.abs(M[ne])<=J*de){M[ne]=0;break}}ne===q?te=3:ne===Y-1?te=1:(te=2,q=ne)}switch(q++,te){case 1:{let ne=B[Y-2];B[Y-2]=0;for(let de=Y-2;de>=q;de--){let oe=hypotenuse$1(M[de],ne),we=M[de]/oe,Ae=ne/oe;if(M[de]=oe,de!==q&&(ne=-Ae*B[de-1],B[de-1]=we*B[de-1]),T)for(let ye=0;ye<x;ye++)oe=we*N.get(ye,de)+Ae*N.get(ye,Y-1),N.set(ye,Y-1,-Ae*N.get(ye,de)+we*N.get(ye,Y-1)),N.set(ye,de,oe)}break}case 2:{let ne=B[q-1];B[q-1]=0;for(let de=q;de<Y;de++){let oe=hypotenuse$1(M[de],ne),we=M[de]/oe,Ae=ne/oe;if(M[de]=oe,ne=-Ae*B[de],B[de]=we*B[de],I)for(let ye=0;ye<m;ye++)oe=we*F.get(ye,de)+Ae*F.get(ye,q-1),F.set(ye,q-1,-Ae*F.get(ye,de)+we*F.get(ye,q-1)),F.set(ye,de,oe)}break}case 3:{const ne=Math.max(Math.abs(M[Y-1]),Math.abs(M[Y-2]),Math.abs(B[Y-2]),Math.abs(M[q]),Math.abs(B[q])),de=M[Y-1]/ne,oe=M[Y-2]/ne,we=B[Y-2]/ne,Ae=M[q]/ne,ye=B[q]/ne,me=((oe+de)*(oe-de)+we*we)/2,xe=de*we*(de*we);let Le=0;(me!==0||xe!==0)&&(me<0?Le=0-Math.sqrt(me*me+xe):Le=Math.sqrt(me*me+xe),Le=xe/(me+Le));let Ze=(Ae+de)*(Ae-de)+Le,Xe=Ae*ye;for(let je=q;je<Y-1;je++){let Ie=hypotenuse$1(Ze,Xe);Ie===0&&(Ie=Number.MIN_VALUE);let Pe=Ze/Ie,De=Xe/Ie;if(je!==q&&(B[je-1]=Ie),Ze=Pe*M[je]+De*B[je],B[je]=Pe*B[je]-De*M[je],Xe=De*M[je+1],M[je+1]=Pe*M[je+1],T)for(let ze=0;ze<x;ze++)Ie=Pe*N.get(ze,je)+De*N.get(ze,je+1),N.set(ze,je+1,-De*N.get(ze,je)+Pe*N.get(ze,je+1)),N.set(ze,je,Ie);if(Ie=hypotenuse$1(Ze,Xe),Ie===0&&(Ie=Number.MIN_VALUE),Pe=Ze/Ie,De=Xe/Ie,M[je]=Ie,Ze=Pe*B[je]+De*M[je+1],M[je+1]=-De*B[je]+Pe*M[je+1],Xe=De*B[je+1],B[je+1]=Pe*B[je+1],I&&je<m-1)for(let ze=0;ze<m;ze++)Ie=Pe*F.get(ze,je)+De*F.get(ze,je+1),F.set(ze,je+1,-De*F.get(ze,je)+Pe*F.get(ze,je+1)),F.set(ze,je,Ie)}B[Y-2]=Ze;break}case 4:{if(M[q]<=0&&(M[q]=M[q]<0?-M[q]:0,T))for(let ne=0;ne<=X;ne++)N.set(ne,q,-N.get(ne,q));for(;q<X&&!(M[q]>=M[q+1]);){let ne=M[q];if(M[q]=M[q+1],M[q+1]=ne,T&&q<x-1)for(let de=0;de<x;de++)ne=N.get(de,q+1),N.set(de,q+1,N.get(de,q)),N.set(de,q,ne);if(I&&q<m-1)for(let de=0;de<m;de++)ne=F.get(de,q+1),F.set(de,q+1,F.get(de,q)),F.set(de,q,ne);q++}Y--;break}}}if(A){let q=N;N=F,F=q}this.m=m,this.n=x,this.s=M,this.U=F,this.V=N}solve(l){let g=l,m=this.threshold,x=this.s.length,E=Matrix$2.zeros(x,x);for(let P=0;P<x;P++)Math.abs(this.s[P])<=m?E.set(P,P,0):E.set(P,P,1/this.s[P]);let S=this.U,h=this.rightSingularVectors,I=h.mmul(E),T=h.rows,A=S.rows,k=Matrix$2.zeros(T,A);for(let P=0;P<T;P++)for(let D=0;D<A;D++){let M=0;for(let F=0;F<x;F++)M+=I.get(P,F)*S.get(D,F);k.set(P,D,M)}return k.mmul(g)}solveForDiagonal(l){return this.solve(Matrix$2.diag(l))}inverse(){let l=this.V,g=this.threshold,m=l.rows,x=l.columns,E=new Matrix$2(m,this.s.length);for(let A=0;A<m;A++)for(let k=0;k<x;k++)Math.abs(this.s[k])>g&&E.set(A,k,l.get(A,k)/this.s[k]);let S=this.U,h=S.rows,I=S.columns,T=new Matrix$2(m,h);for(let A=0;A<m;A++)for(let k=0;k<h;k++){let P=0;for(let D=0;D<I;D++)P+=E.get(A,D)*S.get(k,D);T.set(A,k,P)}return T}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let l=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,g=0,m=this.s;for(let x=0,E=m.length;x<E;x++)m[x]>l&&g++;return g}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(p,l=!1){return p=WrapperMatrix2D.checkMatrix(p),l?new SingularValueDecomposition(p).inverse():solve(p,Matrix$2.eye(p.rows))}function solve(p,l,g=!1){return p=WrapperMatrix2D.checkMatrix(p),l=WrapperMatrix2D.checkMatrix(l),g?new SingularValueDecomposition(p).solve(l):p.isSquare()?new LuDecomposition(p).solve(l):new QrDecomposition(p).solve(l)}function determinant(p){if(p=Matrix$2.checkMatrix(p),p.isSquare()){if(p.columns===0)return 1;let l,g,m,x;if(p.columns===2)return l=p.get(0,0),g=p.get(0,1),m=p.get(1,0),x=p.get(1,1),l*x-g*m;if(p.columns===3){let E,S,h;return E=new MatrixSelectionView(p,[1,2],[1,2]),S=new MatrixSelectionView(p,[1,2],[0,2]),h=new MatrixSelectionView(p,[1,2],[0,1]),l=p.get(0,0),g=p.get(0,1),m=p.get(0,2),l*determinant(E)-g*determinant(S)+m*determinant(h)}else return new LuDecomposition(p).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(p,l){let g=[];for(let m=0;m<p;m++)m!==l&&g.push(m);return g}function dependenciesOneRow(p,l,g,m=1e-9,x=1e-9){if(p>x)return new Array(l.rows+1).fill(0);{let E=l.addRow(g,[0]);for(let S=0;S<E.rows;S++)Math.abs(E.get(S,0))<m&&E.set(S,0,0);return E.to1DArray()}}function linearDependencies(p,l={}){const{thresholdValue:g=1e-9,thresholdError:m=1e-9}=l;p=Matrix$2.checkMatrix(p);let x=p.rows,E=new Matrix$2(x,x);for(let S=0;S<x;S++){let h=Matrix$2.columnVector(p.getRow(S)),I=p.subMatrixRow(xrange(x,S)).transpose(),A=new SingularValueDecomposition(I).solve(h),k=Matrix$2.sub(h,I.mmul(A)).abs().max();E.setRow(S,dependenciesOneRow(k,A,S,g,m))}return E}function pseudoInverse(p,l=Number.EPSILON){if(p=Matrix$2.checkMatrix(p),p.isEmpty())return p.transpose();let g=new SingularValueDecomposition(p,{autoTranspose:!0}),m=g.leftSingularVectors,x=g.rightSingularVectors,E=g.diagonal;for(let S=0;S<E.length;S++)Math.abs(E[S])>l?E[S]=1/E[S]:E[S]=0;return x.mmul(Matrix$2.diag(E).mmul(m.transpose()))}function covariance(p,l=p,g={}){p=new Matrix$2(p);let m=!1;if(typeof l=="object"&&!Matrix$2.isMatrix(l)&&!Array.isArray(l)?(g=l,l=p,m=!0):l=new Matrix$2(l),p.rows!==l.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:x=!0}=g;x&&(p=p.center("column"),m||(l=l.center("column")));const E=p.transpose().mmul(l);for(let S=0;S<E.rows;S++)for(let h=0;h<E.columns;h++)E.set(S,h,E.get(S,h)*(1/(p.rows-1)));return E}function correlation(p,l=p,g={}){p=new Matrix$2(p);let m=!1;if(typeof l=="object"&&!Matrix$2.isMatrix(l)&&!Array.isArray(l)?(g=l,l=p,m=!0):l=new Matrix$2(l),p.rows!==l.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:x=!0,scale:E=!0}=g;x&&(p.center("column"),m||l.center("column")),E&&(p.scale("column"),m||l.scale("column"));const S=p.standardDeviation("column",{unbiased:!0}),h=m?S:l.standardDeviation("column",{unbiased:!0}),I=p.transpose().mmul(l);for(let T=0;T<I.rows;T++)for(let A=0;A<I.columns;A++)I.set(T,A,I.get(T,A)*(1/(S[T]*h[A]))*(1/(p.rows-1)));return I}class EigenvalueDecomposition{constructor(l,g={}){const{assumeSymmetric:m=!1}=g;if(l=WrapperMatrix2D.checkMatrix(l),!l.isSquare())throw new Error("Matrix is not a square matrix");if(l.isEmpty())throw new Error("Matrix must be non-empty");let x=l.columns,E=new Matrix$2(x,x),S=new Float64Array(x),h=new Float64Array(x),I=l,T,A,k=!1;if(m?k=!0:k=l.isSymmetric(),k){for(T=0;T<x;T++)for(A=0;A<x;A++)E.set(T,A,I.get(T,A));tred2(x,h,S,E),tql2(x,h,S,E)}else{let P=new Matrix$2(x,x),D=new Float64Array(x);for(A=0;A<x;A++)for(T=0;T<x;T++)P.set(T,A,I.get(T,A));orthes(x,P,D,E),hqr2(x,h,S,E,P)}this.n=x,this.e=h,this.d=S,this.V=E}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let l=this.n,g=this.e,m=this.d,x=new Matrix$2(l,l),E,S;for(E=0;E<l;E++){for(S=0;S<l;S++)x.set(E,S,0);x.set(E,E,m[E]),g[E]>0?x.set(E,E+1,g[E]):g[E]<0&&x.set(E,E-1,g[E])}return x}}function tred2(p,l,g,m){let x,E,S,h,I,T,A,k;for(I=0;I<p;I++)g[I]=m.get(p-1,I);for(h=p-1;h>0;h--){for(k=0,S=0,T=0;T<h;T++)k=k+Math.abs(g[T]);if(k===0)for(l[h]=g[h-1],I=0;I<h;I++)g[I]=m.get(h-1,I),m.set(h,I,0),m.set(I,h,0);else{for(T=0;T<h;T++)g[T]/=k,S+=g[T]*g[T];for(x=g[h-1],E=Math.sqrt(S),x>0&&(E=-E),l[h]=k*E,S=S-x*E,g[h-1]=x-E,I=0;I<h;I++)l[I]=0;for(I=0;I<h;I++){for(x=g[I],m.set(I,h,x),E=l[I]+m.get(I,I)*x,T=I+1;T<=h-1;T++)E+=m.get(T,I)*g[T],l[T]+=m.get(T,I)*x;l[I]=E}for(x=0,I=0;I<h;I++)l[I]/=S,x+=l[I]*g[I];for(A=x/(S+S),I=0;I<h;I++)l[I]-=A*g[I];for(I=0;I<h;I++){for(x=g[I],E=l[I],T=I;T<=h-1;T++)m.set(T,I,m.get(T,I)-(x*l[T]+E*g[T]));g[I]=m.get(h-1,I),m.set(h,I,0)}}g[h]=S}for(h=0;h<p-1;h++){if(m.set(p-1,h,m.get(h,h)),m.set(h,h,1),S=g[h+1],S!==0){for(T=0;T<=h;T++)g[T]=m.get(T,h+1)/S;for(I=0;I<=h;I++){for(E=0,T=0;T<=h;T++)E+=m.get(T,h+1)*m.get(T,I);for(T=0;T<=h;T++)m.set(T,I,m.get(T,I)-E*g[T])}}for(T=0;T<=h;T++)m.set(T,h+1,0)}for(I=0;I<p;I++)g[I]=m.get(p-1,I),m.set(p-1,I,0);m.set(p-1,p-1,1),l[0]=0}function tql2(p,l,g,m){let x,E,S,h,I,T,A,k,P,D,M,F,N,B,U,O;for(S=1;S<p;S++)l[S-1]=l[S];l[p-1]=0;let V=0,Z=0,W=Number.EPSILON;for(T=0;T<p;T++){for(Z=Math.max(Z,Math.abs(g[T])+Math.abs(l[T])),A=T;A<p&&!(Math.abs(l[A])<=W*Z);)A++;if(A>T)do{for(x=g[T],k=(g[T+1]-x)/(2*l[T]),P=hypotenuse$1(k,1),k<0&&(P=-P),g[T]=l[T]/(k+P),g[T+1]=l[T]*(k+P),D=g[T+1],E=x-g[T],S=T+2;S<p;S++)g[S]-=E;for(V=V+E,k=g[A],M=1,F=M,N=M,B=l[T+1],U=0,O=0,S=A-1;S>=T;S--)for(N=F,F=M,O=U,x=M*l[S],E=M*k,P=hypotenuse$1(k,l[S]),l[S+1]=U*P,U=l[S]/P,M=k/P,k=M*g[S]-U*x,g[S+1]=E+U*(M*x+U*g[S]),I=0;I<p;I++)E=m.get(I,S+1),m.set(I,S+1,U*m.get(I,S)+M*E),m.set(I,S,M*m.get(I,S)-U*E);k=-U*O*N*B*l[T]/D,l[T]=U*k,g[T]=M*k}while(Math.abs(l[T])>W*Z);g[T]=g[T]+V,l[T]=0}for(S=0;S<p-1;S++){for(I=S,k=g[S],h=S+1;h<p;h++)g[h]<k&&(I=h,k=g[h]);if(I!==S)for(g[I]=g[S],g[S]=k,h=0;h<p;h++)k=m.get(h,S),m.set(h,S,m.get(h,I)),m.set(h,I,k)}}function orthes(p,l,g,m){let x=0,E=p-1,S,h,I,T,A,k,P;for(k=x+1;k<=E-1;k++){for(P=0,T=k;T<=E;T++)P=P+Math.abs(l.get(T,k-1));if(P!==0){for(I=0,T=E;T>=k;T--)g[T]=l.get(T,k-1)/P,I+=g[T]*g[T];for(h=Math.sqrt(I),g[k]>0&&(h=-h),I=I-g[k]*h,g[k]=g[k]-h,A=k;A<p;A++){for(S=0,T=E;T>=k;T--)S+=g[T]*l.get(T,A);for(S=S/I,T=k;T<=E;T++)l.set(T,A,l.get(T,A)-S*g[T])}for(T=0;T<=E;T++){for(S=0,A=E;A>=k;A--)S+=g[A]*l.get(T,A);for(S=S/I,A=k;A<=E;A++)l.set(T,A,l.get(T,A)-S*g[A])}g[k]=P*g[k],l.set(k,k-1,P*h)}}for(T=0;T<p;T++)for(A=0;A<p;A++)m.set(T,A,T===A?1:0);for(k=E-1;k>=x+1;k--)if(l.get(k,k-1)!==0){for(T=k+1;T<=E;T++)g[T]=l.get(T,k-1);for(A=k;A<=E;A++){for(h=0,T=k;T<=E;T++)h+=g[T]*m.get(T,A);for(h=h/g[k]/l.get(k,k-1),T=k;T<=E;T++)m.set(T,A,m.get(T,A)+h*g[T])}}}function hqr2(p,l,g,m,x){let E=p-1,S=0,h=p-1,I=Number.EPSILON,T=0,A=0,k=0,P=0,D=0,M=0,F=0,N=0,B,U,O,V,Z,W,Y,X,J,q,te,ne,de,oe,we;for(B=0;B<p;B++)for((B<S||B>h)&&(g[B]=x.get(B,B),l[B]=0),U=Math.max(B-1,0);U<p;U++)A=A+Math.abs(x.get(B,U));for(;E>=S;){for(V=E;V>S&&(M=Math.abs(x.get(V-1,V-1))+Math.abs(x.get(V,V)),M===0&&(M=A),!(Math.abs(x.get(V,V-1))<I*M));)V--;if(V===E)x.set(E,E,x.get(E,E)+T),g[E]=x.get(E,E),l[E]=0,E--,N=0;else if(V===E-1){if(Y=x.get(E,E-1)*x.get(E-1,E),k=(x.get(E-1,E-1)-x.get(E,E))/2,P=k*k+Y,F=Math.sqrt(Math.abs(P)),x.set(E,E,x.get(E,E)+T),x.set(E-1,E-1,x.get(E-1,E-1)+T),X=x.get(E,E),P>=0){for(F=k>=0?k+F:k-F,g[E-1]=X+F,g[E]=g[E-1],F!==0&&(g[E]=X-Y/F),l[E-1]=0,l[E]=0,X=x.get(E,E-1),M=Math.abs(X)+Math.abs(F),k=X/M,P=F/M,D=Math.sqrt(k*k+P*P),k=k/D,P=P/D,U=E-1;U<p;U++)F=x.get(E-1,U),x.set(E-1,U,P*F+k*x.get(E,U)),x.set(E,U,P*x.get(E,U)-k*F);for(B=0;B<=E;B++)F=x.get(B,E-1),x.set(B,E-1,P*F+k*x.get(B,E)),x.set(B,E,P*x.get(B,E)-k*F);for(B=S;B<=h;B++)F=m.get(B,E-1),m.set(B,E-1,P*F+k*m.get(B,E)),m.set(B,E,P*m.get(B,E)-k*F)}else g[E-1]=X+k,g[E]=X+k,l[E-1]=F,l[E]=-F;E=E-2,N=0}else{if(X=x.get(E,E),J=0,Y=0,V<E&&(J=x.get(E-1,E-1),Y=x.get(E,E-1)*x.get(E-1,E)),N===10){for(T+=X,B=S;B<=E;B++)x.set(B,B,x.get(B,B)-X);M=Math.abs(x.get(E,E-1))+Math.abs(x.get(E-1,E-2)),X=J=.75*M,Y=-.4375*M*M}if(N===30&&(M=(J-X)/2,M=M*M+Y,M>0)){for(M=Math.sqrt(M),J<X&&(M=-M),M=X-Y/((J-X)/2+M),B=S;B<=E;B++)x.set(B,B,x.get(B,B)-M);T+=M,X=J=Y=.964}for(N=N+1,Z=E-2;Z>=V&&(F=x.get(Z,Z),D=X-F,M=J-F,k=(D*M-Y)/x.get(Z+1,Z)+x.get(Z,Z+1),P=x.get(Z+1,Z+1)-F-D-M,D=x.get(Z+2,Z+1),M=Math.abs(k)+Math.abs(P)+Math.abs(D),k=k/M,P=P/M,D=D/M,!(Z===V||Math.abs(x.get(Z,Z-1))*(Math.abs(P)+Math.abs(D))<I*(Math.abs(k)*(Math.abs(x.get(Z-1,Z-1))+Math.abs(F)+Math.abs(x.get(Z+1,Z+1))))));)Z--;for(B=Z+2;B<=E;B++)x.set(B,B-2,0),B>Z+2&&x.set(B,B-3,0);for(O=Z;O<=E-1&&(oe=O!==E-1,O!==Z&&(k=x.get(O,O-1),P=x.get(O+1,O-1),D=oe?x.get(O+2,O-1):0,X=Math.abs(k)+Math.abs(P)+Math.abs(D),X!==0&&(k=k/X,P=P/X,D=D/X)),X!==0);O++)if(M=Math.sqrt(k*k+P*P+D*D),k<0&&(M=-M),M!==0){for(O!==Z?x.set(O,O-1,-M*X):V!==Z&&x.set(O,O-1,-x.get(O,O-1)),k=k+M,X=k/M,J=P/M,F=D/M,P=P/k,D=D/k,U=O;U<p;U++)k=x.get(O,U)+P*x.get(O+1,U),oe&&(k=k+D*x.get(O+2,U),x.set(O+2,U,x.get(O+2,U)-k*F)),x.set(O,U,x.get(O,U)-k*X),x.set(O+1,U,x.get(O+1,U)-k*J);for(B=0;B<=Math.min(E,O+3);B++)k=X*x.get(B,O)+J*x.get(B,O+1),oe&&(k=k+F*x.get(B,O+2),x.set(B,O+2,x.get(B,O+2)-k*D)),x.set(B,O,x.get(B,O)-k),x.set(B,O+1,x.get(B,O+1)-k*P);for(B=S;B<=h;B++)k=X*m.get(B,O)+J*m.get(B,O+1),oe&&(k=k+F*m.get(B,O+2),m.set(B,O+2,m.get(B,O+2)-k*D)),m.set(B,O,m.get(B,O)-k),m.set(B,O+1,m.get(B,O+1)-k*P)}}}if(A!==0){for(E=p-1;E>=0;E--)if(k=g[E],P=l[E],P===0)for(V=E,x.set(E,E,1),B=E-1;B>=0;B--){for(Y=x.get(B,B)-k,D=0,U=V;U<=E;U++)D=D+x.get(B,U)*x.get(U,E);if(l[B]<0)F=Y,M=D;else if(V=B,l[B]===0?x.set(B,E,Y!==0?-D/Y:-D/(I*A)):(X=x.get(B,B+1),J=x.get(B+1,B),P=(g[B]-k)*(g[B]-k)+l[B]*l[B],W=(X*M-F*D)/P,x.set(B,E,W),x.set(B+1,E,Math.abs(X)>Math.abs(F)?(-D-Y*W)/X:(-M-J*W)/F)),W=Math.abs(x.get(B,E)),I*W*W>1)for(U=B;U<=E;U++)x.set(U,E,x.get(U,E)/W)}else if(P<0)for(V=E-1,Math.abs(x.get(E,E-1))>Math.abs(x.get(E-1,E))?(x.set(E-1,E-1,P/x.get(E,E-1)),x.set(E-1,E,-(x.get(E,E)-k)/x.get(E,E-1))):(we=cdiv(0,-x.get(E-1,E),x.get(E-1,E-1)-k,P),x.set(E-1,E-1,we[0]),x.set(E-1,E,we[1])),x.set(E,E-1,0),x.set(E,E,1),B=E-2;B>=0;B--){for(q=0,te=0,U=V;U<=E;U++)q=q+x.get(B,U)*x.get(U,E-1),te=te+x.get(B,U)*x.get(U,E);if(Y=x.get(B,B)-k,l[B]<0)F=Y,D=q,M=te;else if(V=B,l[B]===0?(we=cdiv(-q,-te,Y,P),x.set(B,E-1,we[0]),x.set(B,E,we[1])):(X=x.get(B,B+1),J=x.get(B+1,B),ne=(g[B]-k)*(g[B]-k)+l[B]*l[B]-P*P,de=(g[B]-k)*2*P,ne===0&&de===0&&(ne=I*A*(Math.abs(Y)+Math.abs(P)+Math.abs(X)+Math.abs(J)+Math.abs(F))),we=cdiv(X*D-F*q+P*te,X*M-F*te-P*q,ne,de),x.set(B,E-1,we[0]),x.set(B,E,we[1]),Math.abs(X)>Math.abs(F)+Math.abs(P)?(x.set(B+1,E-1,(-q-Y*x.get(B,E-1)+P*x.get(B,E))/X),x.set(B+1,E,(-te-Y*x.get(B,E)-P*x.get(B,E-1))/X)):(we=cdiv(-D-J*x.get(B,E-1),-M-J*x.get(B,E),F,P),x.set(B+1,E-1,we[0]),x.set(B+1,E,we[1]))),W=Math.max(Math.abs(x.get(B,E-1)),Math.abs(x.get(B,E))),I*W*W>1)for(U=B;U<=E;U++)x.set(U,E-1,x.get(U,E-1)/W),x.set(U,E,x.get(U,E)/W)}for(B=0;B<p;B++)if(B<S||B>h)for(U=B;U<p;U++)m.set(B,U,x.get(B,U));for(U=p-1;U>=S;U--)for(B=S;B<=h;B++){for(F=0,O=S;O<=Math.min(U,h);O++)F=F+m.get(B,O)*x.get(O,U);m.set(B,U,F)}}}function cdiv(p,l,g,m){let x,E;return Math.abs(g)>Math.abs(m)?(x=m/g,E=g+x*m,[(p+x*l)/E,(l-x*p)/E]):(x=g/m,E=m+x*g,[(x*p+l)/E,(x*l-p)/E])}class CholeskyDecomposition{constructor(l){if(l=WrapperMatrix2D.checkMatrix(l),!l.isSymmetric())throw new Error("Matrix is not symmetric");let g=l,m=g.rows,x=new Matrix$2(m,m),E=!0,S,h,I;for(h=0;h<m;h++){let T=0;for(I=0;I<h;I++){let A=0;for(S=0;S<I;S++)A+=x.get(I,S)*x.get(h,S);A=(g.get(h,I)-A)/x.get(I,I),x.set(h,I,A),T=T+A*A}for(T=g.get(h,h)-T,E&=T>0,x.set(h,h,Math.sqrt(Math.max(T,0))),I=h+1;I<m;I++)x.set(h,I,0)}this.L=x,this.positiveDefinite=Boolean(E)}isPositiveDefinite(){return this.positiveDefinite}solve(l){l=WrapperMatrix2D.checkMatrix(l);let g=this.L,m=g.rows;if(l.rows!==m)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let x=l.columns,E=l.clone(),S,h,I;for(I=0;I<m;I++)for(h=0;h<x;h++){for(S=0;S<I;S++)E.set(I,h,E.get(I,h)-E.get(S,h)*g.get(I,S));E.set(I,h,E.get(I,h)/g.get(I,I))}for(I=m-1;I>=0;I--)for(h=0;h<x;h++){for(S=I+1;S<m;S++)E.set(I,h,E.get(I,h)-E.get(S,h)*g.get(S,I));E.set(I,h,E.get(I,h)/g.get(I,I))}return E}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(l,g={}){l=WrapperMatrix2D.checkMatrix(l);let{Y:m}=g;const{scaleScores:x=!1,maxIterations:E=1e3,terminationCriteria:S=1e-10}=g;let h;if(m){if(Array.isArray(m)&&typeof m[0]=="number"?m=Matrix$2.columnVector(m):m=WrapperMatrix2D.checkMatrix(m),m.rows!==l.rows)throw new Error("Y should have the same number of rows as X");h=m.getColumnVector(0)}else h=l.getColumnVector(0);let I=1,T,A,k,P;for(let D=0;D<E&&I>S;D++)k=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),k=k.div(k.norm()),T=l.mmul(k).div(k.transpose().mmul(k).get(0,0)),D>0&&(I=T.clone().sub(P).pow(2).sum()),P=T.clone(),m?(A=m.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0)),A=A.div(A.norm()),h=m.mmul(A).div(A.transpose().mmul(A).get(0,0))):h=T;if(m){let D=l.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0));D=D.div(D.norm());let M=l.clone().sub(T.clone().mmul(D.transpose())),F=h.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0)),N=m.clone().sub(T.clone().mulS(F.get(0,0)).mmul(A.transpose()));this.t=T,this.p=D.transpose(),this.w=k.transpose(),this.q=A,this.u=h,this.s=T.transpose().mmul(T),this.xResidual=M,this.yResidual=N,this.betas=F}else this.w=k.transpose(),this.s=T.transpose().mmul(T).sqrt(),x?this.t=T.clone().div(this.s.get(0,0)):this.t=T,this.xResidual=l.sub(T.mmul(k.transpose()))}}var src$1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",AbstractMatrix,default:Matrix$2,Matrix:Matrix$2,wrap,WrapperMatrix1D,WrapperMatrix2D,solve,inverse,determinant,linearDependencies,pseudoInverse,covariance,correlation,SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition,LU:LuDecomposition,QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView,MatrixColumnSelectionView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowView,MatrixRowSelectionView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1});function getSeparatedKernel(p){const l=new SingularValueDecomposition(p,{autoTranspose:!0});if(l.rank!==1)return null;const g=Math.sqrt(l.s[0]),m=l.U.to2DArray().map(E=>E[0]*g),x=l.V.to2DArray().map(E=>E[0]*g);return[m,x]}function convolution(p,l={}){let{channels:g,bitDepth:m,normalize:x=!1,divisor:E=1,border:S="copy",algorithm:h="auto"}=l,I={};m&&(I.bitDepth=m);let T=Image$1.createFrom(this,I);if(g=validateArrayOfChannels(this,g),h!=="separable")({kernel:p}=validateKernel(p));else if(!Array.isArray(p)||p.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(h==="auto"){let V=getSeparatedKernel(p);V!==null?(h="separable",p=V):(p.length>9||p[0].length>9)&&this.width<=4096&&this.height<=4096?h="fft":h="direct"}let A,k;h==="separable"?(A=Math.floor(p[0].length/2),k=Math.floor(p[1].length/2)):(A=Math.floor(p.length/2),k=Math.floor(p[0].length/2));let P=T.isClamped,D=new Array(this.height*this.width),M,F,N,B,U,O;for(B=0;B<g.length;B++){for(U=g[B],N=0;N<this.height;N++)for(F=0;F<this.width;F++)M=N*this.width+F,D[M]=this.data[M*this.channels+U];if(h==="direct")O=src$2.direct(D,p,{rows:this.height,cols:this.width,normalize:x,divisor:E});else if(h==="separable"){if(O=convolutionSeparable(D,p,this.width,this.height),x){E=0;for(let V=0;V<p[0].length;V++)for(let Z=0;Z<p[1].length;Z++)E+=p[0][V]*p[1][Z]}if(E!==1)for(let V=0;V<O.length;V++)O[V]/=E}else O=src$2.fft(D,p,{rows:this.height,cols:this.width,normalize:x,divisor:E});for(N=0;N<this.height;N++)for(F=0;F<this.width;F++)M=N*this.width+F,P?T.data[M*this.channels+U]=clamp(O[M],T):T.data[M*this.channels+U]=O[M]}if(this.alpha&&!g.includes(this.channels))for(F=this.components;F<this.data.length;F=F+this.channels)T.data[F]=this.data[F];return S!=="periodic"&&T.setBorder({size:[k,A],algorithm:S}),T}function gradientFilter(p={}){let{direction:l="xy",border:g="copy",kernelX:m,kernelY:x,channels:E,bitDepth:S=this.bitDepth}=p;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),l){case"x":if(!m)throw new Error("kernelX option is missing");return convolution.call(this,m,{channels:E,border:g,bitDepth:S});case"y":if(!x)throw new Error("kernelY option is missing");return convolution.call(this,x,{channels:E,border:g,bitDepth:S});case"xy":{if(!m)throw new Error("kernelX option is missing");if(!x)throw new Error("kernelY option is missing");const h=convolution.call(this,m,{channels:E,border:g,bitDepth:32}),I=convolution.call(this,x,{channels:E,border:g,bitDepth:32});return h.hypotenuse(I,{bitDepth:S,channels:E})}default:throw new Error(`Unknown parameter direction: ${l}`)}}function sobelFilter(p){return gradientFilter.call(this,Object.assign({},p,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(p){return gradientFilter.call(this,Object.assign({},p,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(p,l){p=p||0;for(var g=new Array(p),m=0;m<p;m++)g[m]=l;return g}function level(p={}){let{algorithm:l="range",channels:g,min:m=this.min,max:x=this.max}=p;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),g=validateArrayOfChannels(this,{channels:g}),g.length!==this.channel&&(Array.isArray(m)&&m.length===this.channels&&(m=m.filter((E,S)=>g.includes(S))),Array.isArray(x)&&x.length===this.channels&&(x=x.filter((E,S)=>g.includes(S)))),l){case"range":m<0&&(m=0),x>this.maxValue&&(x=this.maxValue),Array.isArray(m)||(m=newArray_1(g.length,m)),Array.isArray(x)||(x=newArray_1(g.length,x)),processImage(this,m,x,g);break;default:throw new Error(`level: algorithm not implement: ${l}`)}return this}function processImage(p,l,g,m){let x=1e-5,E=new Array(m.length);for(let S=0;S<m.length;S++)l[S]===0&&g[S]===p.maxValue||g[S]===l[S]?E[S]=0:E[S]=(p.maxValue+1-x)/(g[S]-l[S]),l[S]+=(.5-x/2)/E[S];for(let S=0;S<m.length;S++){let h=m[S];if(E[S]!==0)for(let I=0;I<p.data.length;I+=p.channels)p.data[I+h]=Math.min(Math.max(0,(p.data[I+h]-l[S])*E[S]+.5|0),p.maxValue)}}var toString$1=Object.prototype.toString,isArrayType=function p(l){return toString$1.call(l).substr(-6,5)==="Array"};function checkNumberArray(p){if(isNaN(p)){if(p instanceof Image$1)return p.data;if(!isArrayType(p))throw new Error("checkNumberArray: the value should be either a number, array or Image");return p}else{if(p<=0)throw new Error("checkNumberArray: the value must be greater than 0");return p}}function add(p,l={}){let{channels:g}=l;if(this.checkProcessable("add",{bitDepth:[8,16]}),g=validateArrayOfChannels(this,{channels:g}),p=checkNumberArray(p),isNaN(p)){if(this.data.length!==p.length)throw new Error("add: the data size is different");for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.max(0,Math.min(this.maxValue,this.data[E+x]+p[E+x]>>0))}}else for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.min(this.maxValue,this.data[E+x]+p>>0)}return this}function subtract(p,l={}){let{channels:g}=l;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),g=validateArrayOfChannels(this,{channels:g}),p=checkNumberArray(p),isNaN(p)){if(this.data.length!==p.length)throw new Error("subtract: the data size is different");for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.max(0,Math.min(this.maxValue,this.data[E+x]-p[E+x]>>0))}}else for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.max(0,this.data[E+x]-p>>0)}return this}function subtractImage(p,l={}){let{channels:g,absolute:m=!1}=l;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==p.width||this.height!==p.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==p.alpha||this.bitDepth!==p.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==p.channels)throw new Error("subtractImage: both images must have the same number of channels");let x=this.clone();g=validateArrayOfChannels(this,{channels:g});for(let E=0;E<g.length;E++){let S=g[E];for(let h=S;h<this.data.length;h+=this.channels){let I=this.data[h]-p.data[h];m?x.data[h]=Math.abs(I):x.data[h]=Math.max(I,0)}}return x}function hypotenuse(p,l={}){let{bitDepth:g=this.bitDepth,channels:m}=l;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==p.width||this.height!==p.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==p.alpha||this.bitDepth!==p.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==p.channels)throw new Error("hypotenuse: both images must have the same number of channels");let x=Image$1.createFrom(this,{bitDepth:g});m=validateArrayOfChannels(this,{channels:m});let E=x.isClamped;for(let S=0;S<m.length;S++){let h=m[S];for(let I=h;I<this.data.length;I+=this.channels){let T=Math.hypot(this.data[I],p.data[I]);E?x.data[I]=Math.min(Math.max(Math.round(T),0),x.maxValue):x.data[I]=T}}return x}function multiply(p,l={}){let{channels:g}=l;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),p<=0)throw new Error("multiply: the value must be greater than 0");if(g=validateArrayOfChannels(this,{channels:g}),p=checkNumberArray(p),isNaN(p)){if(this.data.length!==p.length)throw new Error("multiply: the data size is different");for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.max(0,Math.min(this.maxValue,this.data[E+x]*p[E+x]>>0))}}else for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.min(this.maxValue,this.data[E+x]*p>>0)}return this}function divide(p,l={}){let{channels:g}=l;if(this.checkProcessable("divide",{bitDepth:[8,16]}),g=validateArrayOfChannels(this,{channels:g}),p=checkNumberArray(p),isNaN(p)){if(this.data.length!==p.length)throw new Error("divide: the: the data size is different");for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.max(0,Math.min(this.maxValue,this.data[E+x]/p[E+x]>>0))}}else for(let m=0;m<g.length;m++){let x=g[m];for(let E=0;E<this.data.length;E+=this.channels)this.data[E+x]=Math.min(this.maxValue,this.data[E+x]/p>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(l){if(typeof l=="number")return this._predict(l);if(isAnyArray(l)){const g=[];for(let m=0;m<l.length;m++)g.push(this._predict(l[m]));return g}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(l,g){if(!isAnyArray(l)||!isAnyArray(g)||l.length!==g.length)throw new Error("x and y must be arrays of the same length");const m=l.length,x=new Array(m);for(let D=0;D<m;D++)x[D]=this._predict(l[D]);let E=0,S=0,h=0,I=0,T=0,A=0,k=0;for(let D=0;D<m;D++)E+=x[D],S+=g[D],T+=x[D]*x[D],A+=g[D]*g[D],k+=x[D]*g[D],g[D]!==0&&(h+=(g[D]-x[D])*(g[D]-x[D])/g[D]),I+=(g[D]-x[D])*(g[D]-x[D]);const P=(m*k-E*S)/Math.sqrt((m*T-E*E)*(m*A-S*S));return{r:P,r2:P*P,chi2:h,rmsd:Math.sqrt(I/m)}}}var require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(p,l){let g=0;for(let m=0;m<p.length;m++)g+=(p[m]-l[m])*(p[m]-l[m]);return g}function euclidean$2(p,l){return Math.sqrt(squaredEuclidean$4(p,l))}var euclidean$3=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",squaredEuclidean:squaredEuclidean$4,euclidean:euclidean$2}),require$$0=getAugmentedNamespace(euclidean$3);const{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};class GaussianKernel$1{constructor(l){l=Object.assign({},defaultOptions$b,l),this.sigma=l.sigma,this.divisor=2*l.sigma*l.sigma}compute(l,g){const m=squaredEuclidean$3(l,g);return Math.exp(-m/this.divisor)}}var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};class PolynomialKernel$1{constructor(l){l=Object.assign({},defaultOptions$a,l),this.degree=l.degree,this.constant=l.constant,this.scale=l.scale}compute(l,g){for(var m=0,x=0;x<l.length;x++)m+=l[x]*g[x];return Math.pow(this.scale*m+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};class SigmoidKernel$1{constructor(l){l=Object.assign({},defaultOptions$9,l),this.alpha=l.alpha,this.constant=l.constant}compute(l,g){for(var m=0,x=0;x<l.length;x++)m+=l[x]*g[x];return Math.tanh(this.alpha*m+this.constant)}}var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};class ANOVAKernel$1{constructor(l){l=Object.assign({},defaultOptions$8,l),this.sigma=l.sigma,this.degree=l.degree}compute(l,g){for(var m=0,x=Math.min(l.length,g.length),E=1;E<=x;++E)m+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(l[E-1],E)-Math.pow(g[E-1],E),2)),this.degree);return m}}var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};class CauchyKernel$1{constructor(l){l=Object.assign({},defaultOptions$7,l),this.sigma=l.sigma}compute(l,g){return 1/(1+squaredEuclidean$2(l,g)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};class ExponentialKernel$1{constructor(l){l=Object.assign({},defaultOptions$6,l),this.sigma=l.sigma,this.divisor=2*l.sigma*l.sigma}compute(l,g){const m=euclidean$1(l,g);return Math.exp(-m/this.divisor)}}var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(l,g){for(var m=Math.min(l.length,g.length),x=0,E=0;E<m;++E)x+=Math.min(l[E],g[E]);return x}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};class LaplacianKernel$1{constructor(l){l=Object.assign({},defaultOptions$5,l),this.sigma=l.sigma}compute(l,g){const m=euclidean(l,g);return Math.exp(-m/this.sigma)}}var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};class MultiquadraticKernel$1{constructor(l){l=Object.assign({},defaultOptions$4,l),this.constant=l.constant}compute(l,g){return Math.sqrt(squaredEuclidean$1(l,g)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(l){l=Object.assign({},defaultOptions$3,l),this.constant=l.constant}compute(l,g){const m=squaredEuclidean(l,g);return 1-m/(m+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(l,g){if(this.kernelType=l,l!=="linear")if(typeof l=="string"){l=l.toLowerCase();var m=kernelType[l];if(m)this.kernelFunction=new m(g);else throw new Error(`unsupported kernel type: ${l}`)}else if(typeof l=="object"&&typeof l.compute=="function")this.kernelFunction=l;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(l,g){if(l=Matrix$1.checkMatrix(l),g===void 0?g=l:g=Matrix$1.checkMatrix(g),this.kernelType==="linear")return l.mmul(new MatrixTransposeView(g));const m=new Matrix$1(l.rows,g.rows);if(l===g)for(let x=0;x<l.rows;x++)for(let E=x;E<l.rows;E++){const S=this.kernelFunction.compute(l.getRow(x),l.getRow(E));m.set(x,E,S),m.set(E,x,S)}else for(let x=0;x<l.rows;x++)for(let E=0;E<g.rows;E++)m.set(x,E,this.kernelFunction.compute(l.getRow(x),g.getRow(E)));return m}}var kernel=Kernel;const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(l,g,m){super();if(l===!0)this.alpha=g.alpha,this.inputs=g.inputs,this.kernelType=g.kernelType,this.kernelOptions=g.kernelOptions,this.kernel=new kernel(g.kernelType,g.kernelOptions);else{l=Matrix$2.checkMatrix(l),m=Object.assign({},defaultOptions$2,m);const x=new kernel(m.kernelType,m.kernelOptions),E=x.compute(l),S=l.rows;E.add(Matrix$2.eye(S,S).mul(m.lambda)),this.alpha=solve(E,g),this.inputs=l,this.kernelType=m.kernelType,this.kernelOptions=m.kernelOptions,this.kernel=x}}_predict(l){return this.kernel.compute([l],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(l){if(l.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,l)}}function background$1(p,l,g){const m=new KernelRidgeRegression(p,l,g),x=new Array(this.size);for(let h=0;h<this.width;h++)for(let I=0;I<this.height;I++)x[I*this.width+h]=[h,I];const E=m.predict(x),S=Image$1.createFrom(this);for(let h=0;h<this.size;h++)S.data[h]=Math.min(this.maxValue,Math.max(0,E[h][0]));return S}function dilate(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let m=!0;e:for(const E of l)for(const S of E)if(S!==1){m=!1;break e}let x=this;for(let E=0;E<g;E++)if(this.bitDepth===1)if(m){const S=x.clone();x=dilateOnceBinaryOnlyOnes(x,S,l.length,l[0].length)}else{const S=Image$1.createFrom(x);x=dilateOnceBinary(x,S,l)}else if(m){const S=Image$1.createFrom(x);x=dilateOnceGreyOnlyOnes(x,S,l.length,l[0].length)}else{const S=Image$1.createFrom(x);x=dilateOnceGrey(x,S,l)}return x}function dilateOnceGrey(p,l,g){const m=g.length,x=g[0].length;let E=(m-1)/2,S=(x-1)/2;for(let h=0;h<p.height;h++)for(let I=0;I<p.width;I++){let T=0;for(let A=0;A<x;A++)for(let k=0;k<m;k++){if(g[k][A]!==1)continue;let P=k-E+I,D=A-S+h;if(P<0||D<0||P>=p.width||D>=p.height)continue;const M=p.getValueXY(P,D,0);M>T&&(T=M)}l.setValueXY(I,h,0,T)}return l}function dilateOnceGreyOnlyOnes(p,l,g,m){const x=(g-1)/2,E=(m-1)/2,S=[];for(let h=0;h<p.width;h++)S.push(0);for(let h=0;h<p.height;h++){for(let I=0;I<p.width;I++){let T=0;for(let A=Math.max(0,h-E);A<Math.min(p.height,h+E+1);A++){const k=p.getValueXY(I,A,0);k>T&&(T=k)}S[I]=T}for(let I=0;I<p.width;I++){let T=0;for(let A=Math.max(0,I-x);A<Math.min(p.width,I+x+1);A++)S[A]>T&&(T=S[A]);l.setValueXY(I,h,0,T)}}return l}function dilateOnceBinary(p,l,g){const m=g.length,x=g[0].length;let E=(m-1)/2,S=(x-1)/2;for(let h=0;h<p.height;h++)for(let I=0;I<p.width;I++){let T=0;e:for(let A=0;A<x;A++)for(let k=0;k<m;k++){if(g[k][A]!==1)continue;let P=k-E+I,D=A-S+h;if(D<0||P<0||P>=p.width||D>=p.height)continue;if(p.getBitXY(P,D)===1){T=1;break e}}T===1&&l.setBitXY(I,h)}return l}function dilateOnceBinaryOnlyOnes(p,l,g,m){const x=(g-1)/2,E=(m-1)/2,S=[];for(let h=0;h<p.width;h++)S.push(1);for(let h=0;h<p.height;h++){for(let I=0;I<p.width;I++){S[I]=0;for(let T=Math.max(0,h-E);T<Math.min(p.height,h+E+1);T++)if(p.getBitXY(I,T)===1){S[I]=1;break}}for(let I=0;I<p.width;I++)if(l.getBitXY(I,h)!==1){for(let T=Math.max(0,I-x);T<Math.min(p.width,I+x+1);T++)if(S[T]===1){l.setBitXY(I,h);break}}}return l}function erode(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let m=!0;e:for(const E of l)for(const S of E)if(S!==1){m=!1;break e}let x=this;for(let E=0;E<g;E++)if(this.bitDepth===1)if(m){const S=x.clone();x=erodeOnceBinaryOnlyOnes(x,S,l.length,l[0].length)}else{const S=Image$1.createFrom(x);x=erodeOnceBinary(x,S,l)}else if(m){const S=Image$1.createFrom(x);x=erodeOnceGreyOnlyOnes(x,S,l.length,l[0].length)}else{const S=Image$1.createFrom(x);x=erodeOnceGrey(x,S,l)}return x}function erodeOnceGrey(p,l,g){const m=g.length,x=g[0].length;let E=(m-1)/2,S=(x-1)/2;for(let h=0;h<p.height;h++)for(let I=0;I<p.width;I++){let T=p.maxValue;for(let A=0;A<x;A++)for(let k=0;k<m;k++){if(g[k][A]!==1)continue;let P=k-E+I,D=A-S+h;if(P<0||D<0||P>=p.width||D>=p.height)continue;const M=p.getValueXY(P,D,0);M<T&&(T=M)}l.setValueXY(I,h,0,T)}return l}function erodeOnceGreyOnlyOnes(p,l,g,m){const x=(g-1)/2,E=(m-1)/2,S=[];for(let h=0;h<p.width;h++)S.push(0);for(let h=0;h<p.height;h++){for(let I=0;I<p.width;I++){let T=p.maxValue;for(let A=Math.max(0,h-E);A<Math.min(p.height,h+E+1);A++){const k=p.getValueXY(I,A,0);k<T&&(T=k)}S[I]=T}for(let I=0;I<p.width;I++){let T=p.maxValue;for(let A=Math.max(0,I-x);A<Math.min(p.width,I+x+1);A++)S[A]<T&&(T=S[A]);l.setValueXY(I,h,0,T)}}return l}function erodeOnceBinary(p,l,g){const m=g.length,x=g[0].length;let E=(m-1)/2,S=(x-1)/2;for(let h=0;h<p.height;h++)for(let I=0;I<p.width;I++){let T=1;e:for(let A=0;A<x;A++)for(let k=0;k<m;k++){if(g[k][A]!==1)continue;let P=k-E+I,D=A-S+h;if(D<0||P<0||P>=p.width||D>=p.height)continue;if(p.getBitXY(P,D)===0){T=0;break e}}T===1&&l.setBitXY(I,h)}return l}function erodeOnceBinaryOnlyOnes(p,l,g,m){const x=(g-1)/2,E=(m-1)/2,S=[];for(let h=0;h<p.width;h++)S.push(0);for(let h=0;h<p.height;h++){for(let I=0;I<p.width;I++){S[I]=1;for(let T=Math.max(0,h-E);T<Math.min(p.height,h+E+1);T++)if(p.getBitXY(I,T)===0){S[I]=0;break}}for(let I=0;I<p.width;I++)if(l.getBitXY(I,h)!==0){for(let T=Math.max(0,I-x);T<Math.min(p.width,I+x+1);T++)if(S[T]===0){l.clearBitXY(I,h);break}}}return l}function open(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let m=this;for(let x=0;x<g;x++)m=m.erode({kernel:l}),m=m.dilate({kernel:l});return m}function close(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let m=this;for(let x=0;x<g;x++)m=m.dilate({kernel:l}).erode({kernel:l});return m}function topHat(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),l.length%2==0||l[0].length%2==0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let m=this;for(let x=0;x<g;x++)m=m.open({kernel:l}).subtractImage(m,{absolute:!0});return m}function blackHat(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let m=this;for(let x=0;x<g;x++)m=m.close({kernel:l}).subtractImage(m,{absolute:!0});return m}function morphologicalGradient(p={}){let{kernel:l=[[1,1,1],[1,1,1],[1,1,1]],iterations:g=1}=p;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),l.columns%2==0||l.rows%2==0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let m=this;for(let x=0;x<g;x++){let E=m.dilate({kernel:l}),S=m.erode({kernel:l});m=E.subtractImage(S,{absolute:!0})}return m}function order4Points(p){let l=0,g=0,m=0,x=0,E=p[0][0],S=0;for(let T=1;T<p.length;T++)p[T][0]<E&&(E=p[T][0],S=T);let h=p[(S+1)%p.length][0],I=(S+1)%p.length;for(let T=1;T<p.length;T++)p[T][0]<h&&T!==S&&(h=p[T][0],I=T);return p[I][1]<p[S][1]?(l=p[I],x=p[S],S!==(I+1)%4?(g=p[(I+1)%4],m=p[(I+2)%4]):(g=p[(I+2)%4],m=p[(I+3)%4])):(x=p[I],l=p[S],I!==(S+1)%4?(g=p[(S+1)%4],m=p[(S+2)%4]):(g=p[(S+2)%4],m=p[(S+3)%4])),[l,g,m,x]}function distance2Points(p,l){return Math.sqrt(Math.pow(p[0]-l[0],2)+Math.pow(p[1]-l[1],2))}function crossVect(p,l){return[p[1]*l[2]-p[2]*l[1],p[2]*l[0]-p[0]*l[2],p[0]*l[1]-p[1]*l[0]]}function dotVect(p,l){return p[0]*l[0]+p[1]*l[1]+p[2]*l[2]}function computeWidthAndHeigth(p,l,g,m,x,E){let S=Math.max(distance2Points(p,l),distance2Points(m,g)),h=Math.max(distance2Points(p,m),distance2Points(l,g)),I=0,T=0,A=Math.ceil(x/2),k=Math.ceil(E/2),P=S/h,D=[p[0],p[1],1],M=[l[0],l[1],1],F=[m[0],m[1],1],N=[g[0],g[1],1],B=dotVect(crossVect(D,N),F)/dotVect(crossVect(M,N),F),U=dotVect(crossVect(D,N),M)/dotVect(crossVect(F,N),M),O=[B*M[0]-D[0],B*M[1]-D[1],B*M[2]-D[2]],V=[U*F[0]-D[0],U*F[1]-D[1],U*F[2]-D[2]],Z=O[0],W=O[1],Y=O[2],X=V[0],J=V[1],q=V[2],te=1/(Y*q)*(Z*X-(Z*q+Y*X)*A+Y*q*A*A+(W*J-(W*q+Y*J)*k+Y*q*k*k));te>=0?te=Math.sqrt(te):te=Math.sqrt(-te);let ne=new Matrix$2([[te,0,A],[0,te,k],[0,0,1]]),de=ne.transpose(),oe=inverse(de),we=inverse(ne),Ae=Matrix$2.rowVector(O),ye=Matrix$2.rowVector(V),me=Math.sqrt(dotVect(Ae.mmul(oe).mmul(we).to1DArray(),O)/dotVect(ye.mmul(oe).mmul(we).to1DArray(),V));return me===0||P===0?(I=Math.ceil(S),T=Math.ceil(h)):me<P?(I=Math.ceil(S),T=Math.ceil(I/me)):(T=Math.ceil(h),I=Math.ceil(me*T)),[I,T]}function projectionPoint(p,l,g,m,x,E,S,h,I,T,A,k){let[P,D]=[(g*p+m*l+x)/(I*p+T*l+1),(E*p+S*l+h)/(I*p+T*l+1)];return A.getValueXY(Math.floor(P),Math.floor(D),k)}function warpingFourPoints(p,l={}){let{calculateRatio:g=!0}=l;if(p.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${p.length} elements`);let[m,x,E,S]=p,h=[m,x,E,S],[I,T,A,k]=order4Points(h),P,D;g?[P,D]=computeWidthAndHeigth(I,T,A,k,this.width,this.height):(P=Math.ceil(Math.max(distance2Points(I,T),distance2Points(k,A))),D=Math.ceil(Math.max(distance2Points(I,k),distance2Points(T,A))));let M=Image$1.createFrom(this,{width:P,height:D}),[F,N]=I,[B,U]=T,[O,V]=A,[Z,W]=k,[Y,X]=[0,0],[J,q]=[0,P-1],[te,ne]=[D-1,P-1],[de,oe]=[D-1,0],we=new Matrix$2([[Y,X,1,0,0,0,-Y*F,-X*F],[J,q,1,0,0,0,-J*B,-q*B],[te,ne,1,0,0,0,-te*O,-X*O],[de,oe,1,0,0,0,-de*Z,-oe*Z],[0,0,0,Y,X,1,-Y*N,-X*N],[0,0,0,J,q,1,-J*U,-q*U],[0,0,0,te,ne,1,-te*V,-ne*V],[0,0,0,de,oe,1,-de*W,-oe*W]]),Ae=Matrix$2.columnVector([F,B,O,Z,N,U,V,W]),me=new SingularValueDecomposition(we).solve(Ae),[xe,Le,Ze,Xe,je,Ie,Pe,De]=me.to1DArray(),ze=new Matrix$2(D,P);for(let it=0;it<this.channels;it++){for(let tt=0;tt<D;tt++)for(let ot=0;ot<P;ot++)ze.set(tt,ot,projectionPoint(tt,ot,xe,Le,Ze,Xe,je,Ie,Pe,De,this,it));M.setMatrix(ze,{channel:it})}return M}function crop(p={}){let{x:l=0,y:g=0,width:m=this.width-l,height:x=this.height-g}=p;if(this.checkProcessable("max",{bitDepth:[8,16]}),l=Math.round(l),g=Math.round(g),m=Math.round(m),x=Math.round(x),l>this.width-1||g>this.height-1)throw new RangeError(`crop: origin (x:${l}, y:${g}) out of range (${this.width-1}; ${this.height-1})`);if(m<=0||x<=0)throw new RangeError(`crop: width and height (width:${m}; height:${x}) must be positive numbers`);if(l<0||g<0)throw new RangeError(`crop: x and y (x:${l}, y:${g}) must be positive numbers`);if(m>this.width-l||x>this.height-g)throw new RangeError(`crop: (x: ${l}, y:${g}, width:${m}, height:${x}) size is out of range`);let E=Image$1.createFrom(this,{width:m,height:x,position:[l,g]}),S=m*this.channels,h=g+x,I=0,T=l*this.channels;for(let A=g;A<h;A++){let k=A*this.width*this.channels+T,P=k+S;for(;k<P;k++)E.data[I++]=this.data[k]}return E}function cropAlpha(p={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:l=this.maxValue}=p;let g=findLeft(this,l,this.components);if(g===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let m=findTop(this,l,this.components,g),x=findBottom(this,l,this.components,g),E=findRight(this,l,this.components,g,m,x);return this.crop({x:g,y:m,width:E-g+1,height:x-m+1})}function findLeft(p,l,g){for(let m=0;m<p.width;m++)for(let x=0;x<p.height;x++)if(p.getValueXY(m,x,g)>=l)return m;return-1}function findTop(p,l,g,m){for(let x=0;x<p.height;x++)for(let E=m;E<p.width;E++)if(p.getValueXY(E,x,g)>=l)return x;return-1}function findBottom(p,l,g,m){for(let x=p.height-1;x>=0;x--)for(let E=m;E<p.width;E++)if(p.getValueXY(E,x,g)>=l)return x;return-1}function findRight(p,l,g,m,x,E){for(let S=p.width-1;S>=m;S--)for(let h=x;h<=E;h++)if(p.getValueXY(S,h,g)>=l)return S;return-1}function getFactor(p){if(typeof p=="string"){const l=p[p.length-1];p=parseFloat(p),l==="%"&&(p/=100)}return p}function getThreshold$1(p,l){if(!l)throw Error("getThreshold : the maxValue should be specified");if(typeof p=="string"){if(p[p.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(p)/100*l}else{if(typeof p=="number")return p<1?p*l:p;throw Error("getThreshold : the value is not valid")}}function factorDimensions(p,l,g){p=getFactor(p);let m=Math.round(p*l),x=Math.round(p*g);return m<=0&&(m=1),x<=0&&(x=1),{width:m,height:x}}function checkRow(p,l){if(l<0||l>=p.height)throw new RangeError(`row must be included between 0 and ${p.height-1}. Current value: ${l}`)}function checkColumn(p,l){if(l<0||l>=p.width)throw new RangeError(`column must be included between 0 and ${p.width-1}. Current value: ${l}`)}function checkChannel(p,l){if(l<0||l>=p.channels)throw new RangeError(`channel must be included between 0 and ${p.channels-1}. Current value: ${l}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(p){if(typeof p!="string")throw new TypeError("interpolation must be a string");if(p=p.toLowerCase(),!validInterpolations[p])throw new RangeError(`invalid interpolation algorithm: ${p}`);return validInterpolations[p]}function nearestNeighbor(p,l,g){const m=this.width/l,x=this.height/g;if(this.bitDepth>1)for(let E=0;E<l;E++){const S=Math.floor((E+.5)*m);for(let h=0;h<g;h++){const I=Math.floor((h+.5)*x);for(let T=0;T<this.channels;T++)p.setValueXY(E,h,T,this.getValueXY(S,I,T))}}else for(let E=0;E<l;E++){const S=Math.floor((E+.5)*m);for(let h=0;h<g;h++){const I=Math.floor((h+.5)*x);this.getBitXY(S,I)&&p.setBitXY(E,h)}}}function resize(p={}){const{factor:l=1,interpolation:g=validInterpolations.nearestneighbor,preserveAspectRatio:m=!0}=p,x=checkInterpolation(g);let E=p.width,S=p.height;if(E||(S&&m?E=Math.round(S*(this.width/this.height)):E=this.width),S||(m?S=Math.round(E*(this.height/this.width)):S=this.height),{width:E,height:S}=factorDimensions(l,E,S),E===this.width&&S===this.height){const A=this.clone();return A.position=[0,0],A}let h=Math.round((this.width-E)/2),I=Math.round((this.height-S)/2);const T=Image$1.createFrom(this,{width:E,height:S,position:[h,I]});switch(x){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,T,E,S);break;default:throw new Error(`unsupported resize interpolation: ${x}`)}return T}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let p=Image$1.createFrom(this,{colorModel:HSV}),l=0,g=this.data;for(let m=0;m<g.length;m+=this.channels){let x=g[m],E=g[m+1],S=g[m+2],h=Math.min(x,E,S),I=Math.max(x,E,S),T=I-h,A=0,k=I===0?0:T/I,P=I;if(I!==h){switch(I){case x:A=(E-S)/T+(E<S?6:0);break;case E:A=(S-x)/T+2;break;case S:A=(x-E)/T+4;break;default:throw new Error("unreachable")}A/=6}p.data[l++]=A*this.maxValue,p.data[l++]=k*this.maxValue,p.data[l++]=P,this.alpha&&(p.data[l++]=g[m+3])}return p}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let p=Image$1.createFrom(this,{colorModel:HSL}),l=Math.floor(this.maxValue/2),g=0,m=this.data;for(let x=0;x<m.length;x+=this.channels){let E=m[x],S=m[x+1],h=m[x+2],I=Math.max(E,S,h),T=Math.min(E,S,h),A=0,k=0,P=(I+T)/2;if(I!==T){let D=I-T;switch(k=P>l?D/(2-I-T):D/(I+T),I){case E:A=(S-h)/D+(S<h?6:0);break;case S:A=(h-E)/D+2;break;case h:A=(E-S)/D+4;break;default:throw new Error("unreachable")}A/=6}p.data[g++]=A*this.maxValue,p.data[g++]=k*this.maxValue,p.data[g++]=P,this.alpha&&(p.data[g++]=m[x+3])}return p}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let p=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),l=0,g=this.data;for(let m=0;m<g.length;m+=this.channels){let x=g[m],E=g[m+1],S=g[m+2],h=Math.min(this.maxValue-x,this.maxValue-E,this.maxValue-S),I=(this.maxValue-x-h)/(1-h/this.maxValue),T=(this.maxValue-E-h)/(1-h/this.maxValue),A=(this.maxValue-S-h)/(1-h/this.maxValue);p.data[l++]=Math.round(I),p.data[l++]=Math.round(T),p.data[l++]=Math.round(A),p.data[l++]=Math.round(h),this.alpha&&(p.data[l++]=g[m+3])}return p}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(p,l,g){return p*6966+l*23436+g*2366>>15},luma601(p,l,g){return p*9798+l*19235+g*3735>>15},maximum(p,l,g){return Math.max(p,l,g)},minimum(p,l,g){return Math.min(p,l,g)},average(p,l,g){return(p+l+g)/3>>0},minmax(p,l,g){return(Math.max(p,l,g)+Math.min(p,l,g))/2},red(p){return p},green(p,l){return l},blue(p,l,g){return g},cyan(p,l,g,m){let x=methods$1.black(p,l,g,m);return(m.maxValue-p-x)/(1-x/m.maxValue)>>0},magenta(p,l,g,m){let x=methods$1.black(p,l,g,m);return(m.maxValue-l-x)/(1-x/m.maxValue)>>0},yellow(p,l,g,m){let x=methods$1.black(p,l,g,m);return(m.maxValue-g-x)/(1-x/m.maxValue)>>0},black(p,l,g,m){return Math.min(m.maxValue-p,m.maxValue-l,m.maxValue-g)},hue(p,l,g,m){let x=methods$1.min(p,l,g),E=methods$1.max(p,l,g);if(E===x)return 0;let S=0,h=E-x;switch(E){case p:S=(l-g)/h+(l<g?6:0);break;case l:S=(g-p)/h+2;break;case g:S=(p-l)/h+4;break;default:throw new Error("unreachable")}return S/6*m.maxValue>>0},saturation(p,l,g,m){let x=methods$1.min(p,l,g),E=methods$1.max(p,l,g),S=E-x;return E===0?0:S/E*m.maxValue},lightness(p,l,g){let m=methods$1.min(p,l,g);return(methods$1.max(p,l,g)+m)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});const names$1={};Object.keys(methods$1).forEach(p=>{names$1[p]=p});function grey(p={}){let{algorithm:l="luma709",keepAlpha:g=!1,mergeAlpha:m=!0}=p;if(typeof l!="string"&&typeof l!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(l="red"),g&=this.alpha,m&=this.alpha,g&&(m=!1);let x=getOutputImage(this,p,{components:1,alpha:g,colorModel:GREY$1}),E;if(typeof l=="function")E=l;else if(E=methods$1[l.toLowerCase()],!E)throw new Error(`unsupported grey algorithm: ${l}`);let S=0;for(let h=0;h<this.data.length;h+=this.channels)m?x.data[S++]=clamp(E(this.data[h],this.data[h+1],this.data[h+2],this)*this.data[h+this.components]/this.maxValue,this):(x.data[S++]=clamp(E(this.data[h],this.data[h+1],this.data[h+2],this),this),x.alpha&&(x.data[S++]=this.data[h+this.components]));return x}function huang(p){let l=0;for(let A=0;A<p.length;A++)if(p[A]!==0){l=A;break}let g=p.length-1;for(let A=p.length-1;A>=l;A--)if(p[A]!==0){g=A;break}let m=1/(g-l),x=new Array(p.length),E=0,S=0;for(let A=l;A<p.length;A++)E+=A*p[A],S+=p[A],x[A]=E/S;let h=new Array(p.length);E=S=0;for(let A=g;A>0;A--)E+=A*p[A],S+=p[A],h[A-1]=E/S;let I=-1,T=Number.MAX_VALUE;for(let A=0;A<p.length;A++){let k=0,P;for(let D=0;D<=A;D++)P=1/(1+m*Math.abs(D-x[A])),P<1e-6||P>.999999||(k+=p[D]*(-P*Math.log(P)-(1-P)*Math.log(1-P)));for(let D=A+1;D<p.length;D++)P=1/(1+m*Math.abs(D-h[A])),P<1e-6||P>.999999||(k+=p[D]*(-P*Math.log(P)-(1-P)*Math.log(1-P)));k<T&&(T=k,I=A)}return I}function intermodes(p){let l=p.slice(),g=0;for(;!bimodalTest$1(l);){let x=0,E=0,S=l[0];for(let h=0;h<p.length-1;h++)x=E,E=S,S=l[h+1],l[h]=(x+E+S)/3;if(l[p.length-1]=(E+S)/3,g++,g>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let m=0;for(let x=1;x<p.length-1;x++)l[x-1]<l[x]&&l[x+1]<l[x]&&(m+=x);return Math.floor(m/2)}function bimodalTest$1(p){let l=!1,g=0;for(let m=1;m<p.length-1;m++)if(p[m-1]<p[m]&&p[m+1]<p[m]&&(g++,g>2))return!1;return g===2&&(l=!0),l}function isodata(p){let l,g,m,x,E=0;for(let S=1;S<p.length;S++)if(p[S]>0){E=S+1;break}for(;;){l=0,m=0;for(let S=0;S<E;S++)m=m+p[S],l=l+p[S]*S;x=0,g=0;for(let S=E+1;S<p.length;S++)g+=p[S],x+=p[S]*S;if(m>0&&g>0&&(l/=m,x/=g,E===Math.round((l+x)/2)))break;if(E++,E>p.length-2)throw new Error("Threshold not found")}return E}function li(p,l){let g,m,x,E,S,h,I,T,A,k,P,D;P=.5,k=0;for(let M=0;M<p.length;M++)k+=M*p[M];k/=l,I=k;do{h=I,g=h+.5|0,m=0,E=0;for(let M=0;M<=g;M++)m+=M*p[M],E+=p[M];T=E===0?0:m/E,x=0,S=0;for(let M=g+1;M<p.length;M++)x+=M*p[M],S+=p[M];A=S===0?0:x/S,D=(T-A)/(Math.log(T)-Math.log(A)),D<-Number.EPSILON?I=D-.5|0:I=D+.5|0}while(Math.abs(I-h)>P);return g}function maxEntropy(p,l){let g=new Array(p.length);for(let P=0;P<p.length;P++)g[P]=p[P]/l;let m=new Array(p.length),x=new Array(p.length);m[0]=g[0],x[0]=1-m[0];for(let P=1;P<p.length;P++)m[P]=m[P-1]+g[P],x[P]=1-m[P];let E=0;for(let P=0;P<p.length;P++)if(Math.abs(m[P])>=Number.EPSILON){E=P;break}let S=p.length-1;for(let P=p.length-1;P>=E;P--)if(Math.abs(x[P])>=Number.EPSILON){S=P;break}let h=-1,I,T=Number.MIN_VALUE,A,k;for(let P=E;P<=S;P++){A=0;for(let D=0;D<=P;D++)p[D]!==0&&(A-=g[D]/m[P]*Math.log(g[D]/m[P]));k=0;for(let D=P+1;D<p.length;D++)p[D]!==0&&(k-=g[D]/x[P]*Math.log(g[D]/x[P]));I=A+k,T<I&&(T=I,h=P)}return h}function mean$1(p,l){let g=0;for(let m=0;m<p.length;m++)g+=m*p[m];return Math.floor(g/l)}function minError(p,l){let g,m=-2,x,E,S,h,I,T,A,k,P,D,M,F=0;for(let N=0;N<p.length;N++)F+=N*p[N];for(F/=l,g=F;g!==m;){let N=sumA(p,g),B=sumA(p,p.length-1),U=sumB(p,g),O=sumB(p,p.length-1),V=sumC(p,g),Z=sumC(p,p.length-1);if(x=U/N,E=(O-U)/(B-N),S=N/B,h=(B-N)/B,I=V/N-x*x,T=(Z-V)/(B-N)-E*E,A=1/I-1/T,k=x/I-E/T,P=x*x/I-E*E/T+Math.log10(I*(h*h)/(T*(S*S))),D=k*k-A*P,D<0)return g;m=g,M=(k+Math.sqrt(D))/A,isNaN(M)?g=m:g=Math.floor(M)}return g}function sumA(p,l){let g=0;for(let m=0;m<=l;m++)g+=p[m];return g}function sumB(p,l){let g=0;for(let m=0;m<=l;m++)g+=m*p[m];return g}function sumC(p,l){let g=0;for(let m=0;m<=l;m++)g+=m*m*p[m];return g}function minimum(p){if(p.length<2)return 0;let l=0,g=-1,m=-1,x=new Array(p.length);for(let E=0;E<p.length;E++)x[E]=p[E],p[E]>0&&(m=E);for(;!bimodalTest(x);)if(x=smoothed(x),l++,l>1e4)return g;return g=minimumBetweenPeeks(x,m),g}function smoothed(p){let l=new Array(p.length);for(let g=1;g<p.length-1;g++)l[g]=(p[g-1]+p[g]+p[g+1])/3;return l[0]=(p[0]+p[1])/3,l[p.length-1]=(p[p.length-2]+p[p.length-1])/3,l}function minimumBetweenPeeks(p,l){let g;for(let m=1;m<l;m++)if(p[m-1]>p[m]&&p[m+1]>=p[m]){g=m;break}return g}function bimodalTest(p){let l=p.length,g=!1,m=0;for(let x=1;x<l-1;x++)if(p[x-1]<p[x]&&p[x+1]<p[x]&&(m++,m>2))return!1;return m===2&&(g=!0),g}function moments(p,l){let g=1,m=0,x=0,E=0,S=0,h,I,T,A,k,P,D=-1,M=p.length,F=new Array(M);for(let N=0;N<M;N++)F[N]=p[N]/l;for(let N=0;N<M;N++)m+=N*F[N],x+=N*N*F[N],E+=N*N*N*F[N];I=g*x-m*m,T=(-x*x+m*E)/I,A=(g*-E+x*m)/I,k=.5*(-A-Math.sqrt(A*A-4*T)),P=.5*(-A+Math.sqrt(A*A-4*T)),h=(P-m)/(P-k);for(let N=0;N<M;N++)if(S+=F[N],S>h){D=N;break}return D}function otsu(p,l){let g=0,m=0,x=0,E=0,S=0;for(let h=0;h<p.length;h++)S+=h*p[h];for(let h=0;h<p.length;h++){m=m+p[h];const I=l-m;if(m===0||I===0)continue;g=g+h*p[h];const T=(S-g)/I,A=m*I*(g/m-T)*(g/m-T);A>=x&&(E=h,x=A)}return E}function percentile(p){let l=-1,g=.5,m=new Array(p.length),x=partialSum(p,p.length-1),E=1;for(let S=0;S<p.length;S++)m[S]=Math.abs(partialSum(p,S)/x-g),m[S]<E&&(E=m[S],l=S);return l}function partialSum(p,l){let g=0;for(let m=0;m<=l;m++)g+=p[m];return g}function renyiEntropy(p,l){let g,m,x,E=new Array(p.length),S=new Array(p.length),h=new Array(p.length),I=0,T=0,A=0,k=0,P=0,D=0,F=1/(1-.5),B=1/(1-2);for(let Z=0;Z<p.length;Z++)E[Z]=p[Z]/l;S[0]=E[0],h[0]=1-S[0];for(let Z=1;Z<p.length;Z++)S[Z]=S[Z-1]+E[Z],h[Z]=1-S[Z];m=0;for(let Z=0;Z<p.length;Z++)if(Math.abs(S[Z])>=Number.EPSILON){m=Z;break}x=p.length-1;for(let Z=p.length-1;Z>=m;Z--)if(Math.abs(h[Z])>=Number.EPSILON){x=Z;break}for(let Z=m;Z<=x;Z++){let W=0,Y=0,X=0;for(let we=0;we<=Z;we++)p[we]!==0&&(W-=E[we]/S[Z]*Math.log(E[we]/S[Z])),Y+=Math.sqrt(E[we]/S[Z]),X+=E[we]*E[we]/(S[Z]*S[Z]);let J=0,q=0,te=0;for(let we=Z+1;we<p.length;we++)p[we]!==0&&(J-=E[we]/h[Z]*Math.log(E[we]/h[Z])),q+=Math.sqrt(E[we]/h[Z]),te+=E[we]*E[we]/(h[Z]*h[Z]);let ne=W+J,de=F*(Y*q>0?Math.log(Y*q):0),oe=B*(X*te>0?Math.log(X*te):0);ne>k&&(k=ne,I=Z),de>P&&(P=de,T=Z),oe>D&&(D=oe,A=Z)}let U=[I,T,A];U.sort((Z,W)=>Z-W);let O;Math.abs(U[0]-U[1])<=5?Math.abs(U[1]-U[2])<=5?O=[1,2,1]:O=[0,1,3]:Math.abs(U[1]-U[2])<=5?O=[3,1,0]:O=[1,2,1];let V=S[U[2]]-S[U[0]];return g=Math.round(U[0]*(S[U[0]]+.25*V*O[0])+.25*U[1]*V*O[1]+U[2]*(h[U[2]]+.25*V*O[2])),g}function shanbhag(p,l){let g=new Array(p.length);for(let D=0;D<p.length;D++)g[D]=p[D]/l;let m=new Array(p.length),x=new Array(p.length);m[0]=g[0],x[0]=1-m[0];for(let D=1;D<p.length;D++)m[D]=m[D-1]+g[D],x[D]=1-m[D];let E=0;for(let D=0;D<p.length;D++)if(Math.abs(m[D])>=Number.EPSILON){E=D;break}let S=p.length-1;for(let D=p.length-1;D>=E;D--)if(Math.abs(x[D])>=Number.EPSILON){S=D;break}let h=-1,I=Number.MAX_VALUE,T,A,k,P;for(let D=E;D<=S;D++){k=0,T=.5/m[D];for(let M=1;M<=D;M++)k-=g[M]*Math.log(1-T*m[M-1]);k*=T,P=0,T=.5/x[D];for(let M=D+1;M<p.length;M++)P-=g[M]*Math.log(1-T*x[M]);P*=T,A=Math.abs(k-P),A<I&&(I=A,h=D)}return h}function triangle$1(p){let l=0,g=0,m=0,x=0;for(let k=0;k<p.length;k++)if(p[k]>0){l=k;break}l>0&&l--;for(let k=p.length-1;k>0;k--)if(p[k]>0){x=k;break}x<p.length-1&&x++;for(let k=0;k<p.length;k++)p[k]>g&&(m=k,g=p[k]);let E=!1;if(m-l<x-m){E=!0;let k=0,P=p.length-1;for(;k<P;){let D=p[k];p[k]=p[P],p[P]=D,k++,P--}l=p.length-1-x,m=p.length-1-m}if(l===m)return l;let S,h,I;S=p[m],h=l-m,I=Math.sqrt(S*S+h*h),S/=I,h/=I,I=S*l+h*p[l];let T=l,A=0;for(let k=l+1;k<=m;k++){let P=S*k+h*p[k]-I;P>A&&(T=k,A=P)}if(T--,E){let k=0,P=p.length-1;for(;k<P;){let D=p[k];p[k]=p[P],p[P]=D,k++,P--}return p.length-1-T}else return T}function yen(p,l){let g=new Array(p.length);for(let T=0;T<p.length;T++)g[T]=p[T]/l;let m=new Array(p.length);m[0]=g[0];for(let T=1;T<p.length;T++)m[T]=m[T-1]+g[T];let x=new Array(p.length);x[0]=g[0]*g[0];for(let T=1;T<p.length;T++)x[T]=x[T-1]+g[T]*g[T];let E=new Array(p.length);E[p.length-1]=0;for(let T=p.length-2;T>=0;T--)E[T]=E[T+1]+g[T+1]*g[T+1];let S=-1,h=Number.MIN_VALUE,I;for(let T=0;T<p.length;T++)I=-1*(x[T]*E[T]>0?Math.log(x[T]*E[T]):0)+2*(m[T]*(1-m[T])>0?Math.log(m[T]*(1-m[T])):0),I>h&&(h=I,S=T);return S}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(p=>{names[p]=p});function getThreshold(p={}){let{algorithm:l=names.otsu}=p;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let g=methods[l.toLowerCase()];if(g){let m=this.getHistogram();return g(m,this.size)}else throw new Error(`unknown thresholding algorithm: ${l}`)}const THRESHOLD="threshold";function mask(p={}){let{algorithm:l=THRESHOLD,threshold:g=.5,useAlpha:m=!0,invert:x=!1}=p;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),l===THRESHOLD?g=getThreshold$1(g,this.maxValue):g=getThreshold.call(this,p);let E=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),S=0;if(this.alpha&&m)for(let h=0;h<this.data.length;h+=this.channels){let I=this.data[h]+(this.maxValue-this.data[h])*(this.maxValue-this.data[h+1])/this.maxValue;(x&&I<=g||!x&&I>=g)&&E.setBit(S),S++}else for(let h=0;h<this.data.length;h+=this.channels)(x&&this.data[h]<=g||!x&&this.data[h]>=g)&&E.setBit(S),S++;return E}function copyImage(p,l,g,m){let x=p.width,E=p.height,S=l.width,h=p.channels;for(let I=0;I<x;I++)for(let T=0;T<E;T++)for(let A=0;A<h;A++){let k=(T*x+I)*h+A,P=((m+T)*S+g+I)*h+A;l.data[P]=p.data[k]}}function pad(p={}){let{size:l=0,algorithm:g="copy",color:m}=p;if(this.checkProcessable("pad",{bitDepth:[8,16]}),g==="set"){if(m.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let I=0;I<m.length;I++)m[I]===0&&(m[I]=.001)}else m=newArray_1(this.channels,null);Array.isArray(l)||(l=[l,l]);let x=this.width+l[0]*2,E=this.height+l[1]*2,S=this.channels,h=Image$1.createFrom(this,{width:x,height:E});copyImage(this,h,l[0],l[1]);for(let I=l[0];I<x-l[0];I++)for(let T=0;T<S;T++){let A=m[T]||h.data[(l[1]*x+I)*S+T];for(let k=0;k<l[1];k++)h.data[(k*x+I)*S+T]=A;A=m[T]||h.data[((E-l[1]-1)*x+I)*S+T];for(let k=E-l[1];k<E;k++)h.data[(k*x+I)*S+T]=A}for(let I=0;I<E;I++)for(let T=0;T<S;T++){let A=m[T]||h.data[(I*x+l[0])*S+T];for(let k=0;k<l[0];k++)h.data[(I*x+k)*S+T]=A;A=m[T]||h.data[(I*x+x-l[0]-1)*S+T];for(let k=x-l[0];k<x;k++)h.data[(I*x+k)*S+T]=A}return h}function colorDepth(p=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(p))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===p)return this.clone();let l=Image$1.createFrom(this,{bitDepth:p});switch(p){case 8:if(this.bitDepth===1)for(let g=0;g<this.size;g++)this.getBit(g)&&(l.data[g]=255);else for(let g=0;g<this.data.length;g++)l.data[g]=this.data[g]>>8;break;case 16:if(this.bitDepth===1)for(let g=0;g<this.size;g++)this.getBit(g)&&(l.data[g]=65535);else for(let g=0;g<this.data.length;g++)l.data[g]=this.data[g]<<8|this.data[g];break;default:throw new Error("colorDepth conversion unexpected case")}return l}function rotateFree(p,l={}){const{interpolation:g=validInterpolations.nearestneighbor,width:m=this.width,height:x=this.height}=l;if(typeof p!="number")throw new TypeError("degrees must be a number");const E=checkInterpolation(g),S=p*Math.PI/180,h=Math.floor(Math.abs(m*Math.cos(S))+Math.abs(x*Math.sin(S))),I=Math.floor(Math.abs(x*Math.cos(S))+Math.abs(m*Math.sin(S))),T=Image$1.createFrom(this,{width:h,height:I}),A=Math.cos(-S),k=Math.sin(-S);let P=h/2,D=I/2;h%2==0?(P=P-.5,I%2==0?D=D-.5:D=Math.floor(D)):(P=Math.floor(P),I%2==0?D=D-.5:D=Math.floor(D));const M=Math.floor(m/2-P),F=Math.floor(x/2-D);switch(E){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,T,M,F,P,D,A,k);case validInterpolations.bilinear:return rotateBilinear(this,T,M,F,P,D,A,k);default:throw new Error(`unsupported rotate interpolation: ${E}`)}}function rotateNearestNeighbor(p,l,g,m,x,E,S,h){for(let I=0;I<l.width;I+=1)for(let T=0;T<l.height;T+=1)for(let A=0;A<p.channels;A++){let k=Math.round((I-x)*S-(T-E)*h+x)+g,P=Math.round((T-E)*S+(I-x)*h+E)+m;k<0||k>=p.width||P<0||P>=p.height?p.alpha===1&&A===p.channels-1?l.setValueXY(I,T,A,0):l.setValueXY(I,T,A,p.maxValue):l.setValueXY(I,T,A,p.getValueXY(k,P,A))}return l}function rotateBilinear(p,l,g,m,x,E,S,h){let I=p.width*p.channels;for(let T=0;T<l.height;T++)for(let A=0;A<l.width;A++){let k=(A-x)*S-(T-E)*h+x+g,P=(T-E)*S+(A-x)*h+E+m,D=k|0,M=P|0,F=k-D,N=P-M;for(let B=0;B<p.channels;B++)if(k<0||k>=p.width||P<0||P>=p.height)p.alpha===1&&B===p.channels-1?l.setValueXY(A,T,B,0):l.setValueXY(A,T,B,p.maxValue);else{let U=(M*p.width+D)*p.channels+B,O=p.data[U],V=p.data[U+p.channels],Z=p.data[U+I],W=p.data[U+I+p.channels],Y=O+F*(V-O)+N*(Z-O)+F*N*(O-V-Z+W)|0;l.setValueXY(A,T,B,Y)}}return l}function rotate$1(p,l){if(typeof p!="number")throw new TypeError("angle must be a number");switch(p<0&&(p=Math.ceil(-p/360)*360+p),p%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,p,l)}}function rotateLeft(){const p=Image$1.createFrom(this,{width:this.height,height:this.width}),l=p.height-1;for(let g=0;g<this.height;g++)for(let m=0;m<this.width;m++)for(let x=0;x<this.channels;x++)p.setValueXY(g,l-m,x,this.getValueXY(m,g,x));return p}function rotateRight(){const p=Image$1.createFrom(this,{width:this.height,height:this.width}),l=p.width-1;for(let g=0;g<this.height;g++)for(let m=0;m<this.width;m++)for(let x=0;x<this.channels;x++)p.setValueXY(l-g,m,x,this.getValueXY(m,g,x));return p}function rotate180(){const p=Image$1.createFrom(this),l=p.width-1,g=p.height-1;for(let m=0;m<this.height;m++)for(let x=0;x<this.width;x++)for(let E=0;E<this.channels;E++)p.setValueXY(l-x,g-m,E,this.getValueXY(x,m,E));return p}function insert(p,l={}){const g=getImageParameters(p);this.checkProcessable("insert",g);let{x:m=0,y:x=0}=l;const E=getOutputImageOrInPlace(this,l,{copy:!0}),S=Math.min(E.height,x+p.height),h=Math.min(E.width,m+p.width);if(E.bitDepth===1)for(let I=x;I<S;I++)for(let T=m;T<h;T++)p.getBitXY(T-m,I-x)?E.setBitXY(T,I):E.clearBitXY(T,I);else for(let I=x;I<S;I++)for(let T=m;T<h;T++)E.setPixelXY(T,I,p.getPixelXY(T-m,I-x));return E}function setBorder(p={}){let{size:l=0,algorithm:g="copy",color:m}=p;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),g==="set"){if(m.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let h=0;h<m.length;h++)m[h]===0&&(m[h]=.001)}else m=newArray_1(this.channels,null);Array.isArray(l)||(l=[l,l]);let x=l[0],E=l[1],S=this.channels;for(let h=x;h<this.width-x;h++)for(let I=0;I<S;I++){let T=m[I]||this.data[(h+this.width*E)*S+I];for(let A=0;A<E;A++)this.data[(A*this.width+h)*S+I]=T;T=m[I]||this.data[(h+this.width*(this.height-E-1))*S+I];for(let A=this.height-E;A<this.height;A++)this.data[(A*this.width+h)*S+I]=T}for(let h=0;h<this.height;h++)for(let I=0;I<S;I++){let T=m[I]||this.data[(h*this.width+x)*S+I];for(let A=0;A<x;A++)this.data[(h*this.width+A)*S+I]=T;T=m[I]||this.data[(h*this.width+this.width-x-1)*S+I];for(let A=this.width-x;A<this.width;A++)this.data[(h*this.width+A)*S+I]=T}return this}function split(p={}){let{preserveAlpha:l=!0}=p;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let g=new Stack,m=this.data;if(this.alpha&&l)for(let x=0;x<this.components;x++){let E=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),S=0;for(let h=0;h<m.length;h+=this.channels)E.data[S++]=m[h+x],E.data[S++]=m[h+this.components];g.push(E)}else for(let x=0;x<this.channels;x++){let E=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),S=0;for(let h=0;h<m.length;h+=this.channels)E.data[S++]=m[h+x];g.push(E)}return g}function getChannel(p,l={}){let{keepAlpha:g=!1,mergeAlpha:m=!1}=l;g&=this.alpha,m&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),p=validateChannel(this,p);let x=Image$1.createFrom(this,{components:1,alpha:g,colorModel:GREY$1}),E=0;for(let S=0;S<this.data.length;S+=this.channels)m?x.data[E++]=this.data[S+p]*this.data[S+this.components]/this.maxValue:(x.data[E++]=this.data[S+p],g&&(x.data[E++]=this.data[S+this.components]));return x}function combineChannels(p=defaultCombineMethod,l={}){let{mergeAlpha:g=!1,keepAlpha:m=!1}=l;g&=this.alpha,m&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let x=Image$1.createFrom(this,{components:1,alpha:m,colorModel:GREY$1}),E=0;for(let S=0;S<this.size;S++){let h=p(this.getPixel(S));g?x.data[E++]=h*this.data[S*this.channels+this.components]/this.maxValue:(x.data[E++]=h,m&&(x.data[E++]=this.data[S*this.channels+this.components]))}return x}function defaultCombineMethod(p){return(p[0]+p[1]+p[2])/3}function setChannel(p,l){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),l.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),l.width!==this.width||l.height!==this.height)throw new Error("Images must have exactly the same width and height");p=validateChannel(this,p);let g=p;for(let m=0;m<l.data.length;m++)this.data[g]=l.data[m],g+=this.channels;return this}function getSimilarity(p,l={}){let{shift:g=[0,0],average:m,channels:x,defaultAlpha:E,normalize:S,border:h=[0,0]}=l;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(h)||(h=[h,h]),x=validateArrayOfChannels(this,{channels:x,defaultAlpha:E}),this.bitDepth!==p.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==p.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==p.colorModel)throw new Error("Both images must have the same colorModel");typeof m=="undefined"&&(m=!0);let I=Math.max(h[0],-g[0]),T=Math.min(this.width-h[0],this.width-g[0]),A=Math.max(h[1],-g[1]),k=Math.min(this.height-h[1],this.height-g[1]),P=newArray_1(x.length,0);for(let D=0;D<x.length;D++){let M=x[D],F=S?this.sum[M]:Math.max(this.sum[M],p.sum[M]),N=S?p.sum[M]:Math.max(this.sum[M],p.sum[M]);if(F!==0&&N!==0)for(let B=I;B<T;B++)for(let U=A;U<k;U++){let O=B*this.multiplierX+U*this.multiplierY+M,V=O+g[0]*this.multiplierX+g[1]*this.multiplierY;P[D]+=Math.min(this.data[O]/F,p.data[V]/N)}}return m?P.reduce((D,M)=>D+M)/P.length:P}function getPixelsGrid(p={}){let{sampling:l=[10,10],painted:g=!1,mask:m}=p;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(l)||(l=[l,l]);const x=l[0],E=l[1],S=[],h=[],I=this.width/x,T=this.height/E;let A=Math.floor(I/2);for(let P=0;P<x;P++){let D=Math.floor(T/2);for(let M=0;M<E;M++){let F=Math.round(A),N=Math.round(D);(!m||m.getBitXY(F,N))&&(S.push([F,N]),h.push(this.getPixelXY(F,N))),D+=T}A+=I}const k={xyS:S,zS:h};return g&&(k.painted=this.rgba8().paintPoints(S)),k}function Matrix(p,l,g){const m=new Array(p);for(let x=0;x<p;x++)m[x]=new Array(l);if(g)for(let x=0;x<p;x++)for(let E=0;E<l;E++)m[x][E]=g;return m.width=p,m.height=l,Object.setPrototypeOf(m,Matrix.prototype),m}Matrix.prototype.localMin=function(p,l){let g=this[p][l],m=[p,l];for(let x=Math.max(0,p-1);x<Math.min(this.length,p+2);x++)for(let E=Math.max(0,l-1);E<Math.min(this[0].length,l+2);E++)this[x][E]<g&&(g=this[x][E],m=[x,E]);return{position:m,value:g}};Matrix.prototype.localMax=function(p,l){let g=this[p][l],m=[p,l];for(let x=Math.max(0,p-1);x<Math.min(this.length,p+2);x++)for(let E=Math.max(0,l-1);E<Math.min(this[0].length,l+2);E++)this[x][E]>g&&(g=this[x][E],m=[x,E]);return{position:m,value:g}};Matrix.prototype.localSearch=function(p,l,g){let m=[];for(let x=Math.max(0,p-1);x<Math.min(this.length,p+2);x++)for(let E=Math.max(0,l-1);E<Math.min(this[0].length,l+2);E++)this[x][E]===g&&m.push([x,E]);return m};function getBestMatch(p,l={}){let{border:g}=l;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==p.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==p.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==p.colorModel)throw new Error("Both images must have the same colorModel");let m=new Matrix(p.width,p.height,-1/0),x=Math.floor(p.width/2),E=Math.floor(p.height/2),S=x,h=E,I=!1;for(;!I;){let T=m.localSearch(x,E,-1/0);for(let k=0;k<T.length;k++){let P=T[k],D=this.getSimilarity(p,{border:g,shift:[S-P[0],h-P[1]]});m[P[0]][P[1]]=D}let A=m.localMax(x,E);A.position[0]!==x||A.position[1]!==E?(x=A.position[0],E=A.position[1]):I=!0}return[x-S,E-h]}function getRow(p,l=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,p),checkChannel(this,l);let g=new Array(this.width),m=0,x=p*this.width*this.channels+l,E=x+this.width*this.channels;for(let S=x;S<E;S+=this.channels)g[m++]=this.data[S];return g}function getColumn(p,l=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,p),checkChannel(this,l);let g=new Array(this.height),m=0,x=this.width*this.channels;for(let E=l+p*this.channels;E<this.data.length;E+=x)g[m++]=this.data[E];return g}function getMatrix(p={}){let{channel:l}=p;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),l===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");l=0}let g=new Matrix$2(this.height,this.width);for(let m=0;m<this.height;m++)for(let x=0;x<this.width;x++)g.set(m,x,this.getValueXY(x,m,l));return g}function setMatrix(p,l={}){p=new Matrix$2(p);let{channel:g}=l;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),g===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");g=0}if(this.width!==p.columns||this.height!==p.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let m=0;m<this.height;m++)for(let x=0;x<this.width;x++)this.setValueXY(x,m,g,p.get(m,x))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let p=new Array(this.size),l=0;for(let g=0;g<this.data.length;g+=this.channels){let m=new Array(this.components);for(let x=0;x<this.components;x++)m[x]=this.data[g+x];p[l++]=m}return p}function getIntersection(p){let l=this,g=l.getClosestCommonParent(p),m=l.getRelativePosition(g,{defaultFurther:!0}),x=getRelativePositionForAllPixels(l,m),E=p.getRelativePosition(g,{defaultFurther:!0}),S=getRelativePositionForAllPixels(p,E),h=getCommonSurface(x,S),I={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let T=0;T<h.length;T++){let A=h[T],k=[A[0]-m[0],A[1]-m[1]],P=[A[0]-E[0],A[1]-E[1]],D=l.getBitXY(k[0],k[1]),M=p.getBitXY(P[0],P[1]);D===1&&M===1&&I.commonWhitePixels.push(A)}for(let T=0;T<x.length;T++){let A,k;T!==0&&(A=Math.floor(T/l.width),k=T%l.width),l.getBitXY(A,k)===1&&I.whitePixelsMask1.push(x[T])}for(let T=0;T<S.length;T++){let A=0,k=0;T!==0&&(A=Math.floor(T/p.width),k=T%p.width),p.getBitXY(A,k)===1&&I.whitePixelsMask2.push(S[T])}return I}function getRelativePositionForAllPixels(p,l){let g=[];for(let m=0;m<p.height;m++)for(let x=0;x<p.width;x++){let E=[m,x];g.push([E[0]+l[0],E[1]+l[1]])}return g}function getCommonSurface(p,l){let g=0,m=0,x=[];for(;g<p.length&&m<l.length;)p[g][0]===l[m][0]&&p[g][1]===l[m][1]?(x.push(p[g]),g++,m++):p[g][0]<l[m][0]||p[g][0]===l[m][0]&&p[g][1]<l[m][1]?g++:m++;return x}function getClosestCommonParent(p){let l=getDepth(this),g=getDepth(p),m;if(l>=g?m=getFurthestParent(this,l):m=getFurthestParent(p,g),l===0||g===0)return m;let x=this,E=p;for(;l!==g;)if(l>g){if(x=x.parent,x===null)return m;l=l-1}else{if(E=E.parent,E===null)return m;g=g-1}for(;x!==E&&x!==null&&E!==null;)if(x=x.parent,E=E.parent,x===null||E===null)return m;return x!==E?m:x}function getDepth(p){let l=0,g=p;for(;g.parent!=null;)g=g.parent,l++;return l}function getFurthestParent(p,l){let g=p;for(;l>0;)g=g.parent,l=l-1;return g}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(p,l){p.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),l=Object.assign({},defaultOptions$1,l);const g=p.width,m=p.height,x=p.maxValue,E={sigma:l.gaussianBlur,radius:3},S=p.gaussianFilter(E),h=S.convolution(Gy,convOptions),I=S.convolution(Gx,convOptions),T=I.hypotenuse(h),A=p.constructor,k=new A(g,m,{kind:"GREY",bitDepth:32}),P=new A(g,m,{kind:"GREY",bitDepth:32}),D=new A(g,m,{kind:"GREY"});for(var M=1;M<g-1;M++)for(var F=1;F<m-1;F++){var N=(Math.round(Math.atan2(I.getValueXY(M,F,0),h.getValueXY(M,F,0))*(5/Math.PI))+5)%5;N===0&&(T.getValueXY(M,F,0)<=T.getValueXY(M,F-1,0)||T.getValueXY(M,F,0)<=T.getValueXY(M,F+1,0))||N===1&&(T.getValueXY(M,F,0)<=T.getValueXY(M-1,F+1,0)||T.getValueXY(M,F,0)<=T.getValueXY(M+1,F-1,0))||N===2&&(T.getValueXY(M,F,0)<=T.getValueXY(M-1,F,0)||T.getValueXY(M,F,0)<=T.getValueXY(M+1,F,0))||N===3&&(T.getValueXY(M,F,0)<=T.getValueXY(M-1,F-1,0)||T.getValueXY(M,F,0)<=T.getValueXY(M+1,F+1,0))||k.setValueXY(M,F,0,T.getValueXY(M,F,0))}for(M=0;M<g*m;++M){var B=k.data[M],U=0;B>l.highThreshold&&(U++,D.data[M]=x),B>l.lowThreshold&&U++,P.data[M]=U}var O=[];for(M=1;M<g-1;++M)for(F=1;F<m-1;++F){if(P.getValueXY(M,F,0)!==1)continue;e:for(var V=M-1;V<M+2;++V)for(var Z=F-1;Z<F+2;++Z)if(P.getValueXY(V,Z,0)===2){O.push([M,F]),D.setValueXY(M,F,0,x);break e}}for(;O.length>0;){var W=[];for(M=0;M<O.length;++M)for(F=-1;F<2;++F)for(V=-1;V<2;++V)if(!(F===0&&V===0)){var Y=O[M][0]+F,X=O[M][1]+V;P.getValueXY(Y,X,0)===1&&D.getValueXY(Y,X,0)===0&&(W.push([Y,X]),D.setValueXY(Y,X,0,x))}O=W}return D}function cannyEdge(p){return cannyEdgeDetector(this,p)}function extract(p,l={}){let{position:g}=l;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!g&&(g=p.getRelativePosition(this),!g))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let m=Image$1.createFrom(this,{width:p.width,height:p.height,alpha:1,position:g,parent:this});for(let x=0;x<p.width;x++)for(let E=0;E<p.height;E++){for(let S=0;S<this.channels;S++){let h=this.getValueXY(x+g[0],E+g[1],S);m.setValueXY(x,E,S,h)}p.getBitXY(x,E)||m.setValueXY(x,E,this.components,0)}return m}else{let m=Image$1.createFrom(this,{width:p.width,height:p.height,position:g,parent:this});for(let x=0;x<p.height;x++)for(let E=0;E<p.width;E++)p.getBitXY(E,x)&&this.getBitXY(E+g[0],x+g[1])&&m.setBitXY(E,x);return m}}var fastList={exports:{}};(function(p,l){(function(){function g(x,E,S){this.next=S,S&&(S.prev=this),this.prev=E,E&&(E.next=this),this.data=x}function m(){if(!(this instanceof m))return new m;this._head=null,this._tail=null,this.length=0}m.prototype={push:function(x){this._tail=new g(x,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var x=this._tail;return this._tail=x.prev,x.prev&&(x.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),x.data}},unshift:function(x){this._head=new g(x,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var x=this._head;return this._head=x.next,x.next&&(x.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),x.data}},item:function(x){x<0&&(x=this.length+x);for(var E=this._head;x-- >0&&E;)E=E.next;return E?E.data:void 0},slice:function(x,E){if(x||(x=0),E||(E=this.length),E<0&&(E=this.length+E),x<0&&(x=this.length+x),E===x)return[];if(E<x)throw new Error("invalid offset: "+x+","+E+" (length="+this.length+")");for(var S=E-x,h=new Array(S),I=0,T=this._head;x-- >0&&T;)T=T.next;for(;I<S&&T;)h[I++]=T.data,T=T.next;return h},drop:function(){m.call(this)},forEach:function(x,E){for(var S=this._head,h=0,I=this.length;h<I&&S;)x.call(E||this,S.data,h,this),S=S.next,h++},map:function(x,E){var S=new m;return this.forEach(function(h,I,T){S.push(x.call(E||T,h,I,T))}),S},filter:function(x,E){var S=new m;return this.forEach(function(h,I,T){x.call(E||T,h,I,T)&&S.push(h)}),S},reduce:function(x,E,S){var h=0,I=this._head,T=this.length;for(E||(h=1,E=I&&I.data,I=I&&I.next);h<T&&I;)E=x.call(S||this,E,I.data,this),h++,I=I.next;return E}},p.exports=m})()})(fastList);var LinkedList=fastList.exports;function floodFill(p={}){const{x:l=0,y:g=0,inPlace:m=!0}=p,x=m?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(l,g))return x;const S=new LinkedList;for(S.push(new Node(l,g));S.length>0;){const h=S.shift();x.setBitXY(h.x,h.y);for(let I=h.x+1;I<this.width&&(!x.getBitXY(I,h.y)&&!this.getBitXY(I,h.y));I++)x.setBitXY(I,h.y),h.y+1<this.height&&!this.getBitXY(I,h.y+1)&&S.push(new Node(I,h.y+1)),h.y-1>=0&&!this.getBitXY(I,h.y-1)&&S.push(new Node(I,h.y-1));for(let I=h.x-1;I>=0&&(!x.getBitXY(I,h.y)&&!this.getBitXY(I,h.y));I++)x.setBitXY(I,h.y),h.y+1<this.height&&!this.getBitXY(I,h.y+1)&&S.push(new Node(I,h.y+1)),h.y-1>=0&&!this.getBitXY(I,h.y-1)&&S.push(new Node(I,h.y-1))}return x}function Node(p,l){this.x=p,this.y=l}function _extends(){return _extends=Object.assign||function(p){for(var l=1;l<arguments.length;l++){var g=arguments[l];for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(p[m]=g[m])}return p},_extends.apply(this,arguments)}function hsv2rgb(p,l,g){l=l/100,g=g/100;var m=[],x=g*l,E=p/60,S=x*(1-Math.abs(E%2-1)),h=g-x;return E>=0&&E<1?m=[x,S,0]:E>=1&&E<2?m=[S,x,0]:E>=2&&E<3?m=[0,x,S]:p>=3&&E<4?m=[0,S,x]:p>=4&&E<5?m=[S,0,x]:p>=5&&E<=6?m=[x,0,S]:m=[0,0,0],{r:Math.round(255*(m[0]+h)),g:Math.round(255*(m[1]+h)),b:Math.round(255*(m[2]+h))}}function hsl2hsv(p,l,g){return l*=(g<50?g:100-g)/100,{h:p,s:2*l/(g+l)*100,v:g+l}}function hsl2rgb$1(p,l,g){var m=hsl2hsv(p,l,g);return hsv2rgb(m.h,m.s,m.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(p){return named(p)||hex3(p)||hex6(p)||rgb(p)||rgba$1(p)||hsl(p)||hsla(p)}function named(p){var l=colors[p.toLowerCase()];if(!!l)return{r:l[0],g:l[1],b:l[2],a:100}}function rgb(p){var l=p.match(/rgb\(([^)]+)\)/);if(l){var g=l[1].split(/ *, */).map(Number);return{r:g[0],g:g[1],b:g[2],a:100}}}function rgba$1(p){var l=p.match(/rgba\(([^)]+)\)/);if(l){var g=l[1].split(/ *, */).map(Number);return{r:g[0],g:g[1],b:g[2],a:g[3]*100}}}function hex6(p){if(p[0]==="#"&&p.length===7)return{r:parseInt(p.slice(1,3),16),g:parseInt(p.slice(3,5),16),b:parseInt(p.slice(5,7),16),a:100}}function hex3(p){if(p[0]==="#"&&p.length===4)return{r:parseInt(p[1]+p[1],16),g:parseInt(p[2]+p[2],16),b:parseInt(p[3]+p[3],16),a:100}}function hsl(p){var l=p.match(/hsl\(([^)]+)\)/);if(l){var g=l[1].split(/ *, */),m=parseInt(g[0],10),x=parseInt(g[1],10),E=parseInt(g[2],10),S=hsl2rgb$1(m,x,E);return _extends({},S,{a:100})}}function hsla(p){var l=p.match(/hsla\(([^)]+)\)/);if(l){var g=l[1].split(/ *, */),m=parseInt(g[0],10),x=parseInt(g[1],10),E=parseInt(g[2],10),S=parseInt(parseFloat(g[3])*100,10),h=hsl2rgb$1(m,x,E);return _extends({},h,{a:S})}}function css2array(p){let l=parse(p);return[l.r,l.g,l.b,Math.round(l.a*255/100)]}function hue2rgb(p,l,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?p+(l-p)*6*g:g<1/2?l:g<2/3?p+(l-p)*(2/3-g)*6:p}function hsl2rgb(p,l,g){let m,x,E,S,h,I;return l/=100,g/=100,l===0?S=h=I=g*255:(g<=.5?x=g*(l+1):x=g+l-g*l,m=g*2-x,E=p/360,S=hue2rgb(m,x,E+1/3),h=hue2rgb(m,x,E),I=hue2rgb(m,x,E-1/3)),{r:S,g:h,b:I}}function getDistinctColors(p){let l=new Array(p),g=0;for(let m=0;m<360;m+=360/p){g++;let x=hsl2rgb(m,100,30+g%4*15);l[g-1]=[Math.round(x.r*255),Math.round(x.g*255),Math.round(x.b*255)]}return l}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(p){let{color:l,colors:g,randomColors:m,numberColors:x=50}=p;if(l&&!Array.isArray(l)&&(l=css2array(l)),l)return[l];if(g)return g=g.map(function(E){return Array.isArray(E)?E:css2array(E)}),g;if(m){g=new Array(x);for(let E=0;E<x;E++)g[E]=getRandomColor()}return getDistinctColors(x)}function paintLabels(p,l,g={}){let{color:m="blue",colors:x,font:E="12px Helvetica",rotate:S=0}=g;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(p))throw Error("paintLabels: labels must be an array");if(!Array.isArray(l))throw Error("paintLabels: positions must be an array");if(m&&!Array.isArray(m)&&(m=css2array(m)),x?x=x.map(function(T){return Array.isArray(T)?T:css2array(T)}):x=[m],p.length!==l.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(E)||(E=[E]),Array.isArray(S)||(S=[S]);let I=this.getCanvas().getContext("2d");for(let T=0;T<p.length;T++){I.save();let A=x[T%x.length];I.fillStyle=`rgba(${A[0]},${A[1]},${A[2]},${A[3]/this.maxValue})`,I.font=E[T%E.length];let k=l[T];I.translate(k[0],k[1]),I.rotate(S[T%S.length]/180*Math.PI),I.fillText(p[T],0,0),I.restore()}return this.data=Uint8Array.from(I.getImageData(0,0,this.width,this.height).data),this}function paintMasks(p,l={}){let{alpha:g=255,labels:m=[],labelsPosition:x=[],labelColor:E="blue",labelFont:S="12px Helvetica"}=l;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let h=getColors(Object.assign({},l,{numberColors:p.length}));Array.isArray(p)||(p=[p]);for(let I=0;I<p.length;I++){let T=p[I],A=h[I%h.length];for(let k=0;k<T.width;k++)for(let P=0;P<T.height;P++)if(T.getBitXY(k,P))for(let D=0;D<Math.min(this.components,A.length);D++)if(g===255)this.setValueXY(k+T.position[0],P+T.position[1],D,A[D]);else{let M=this.getValueXY(k+T.position[0],P+T.position[1],D);M=Math.round((M*(255-g)+A[D]*g)/255),this.setValueXY(k+T.position[0],P+T.position[1],D,M)}}if(Array.isArray(m)&&m.length>0){let T=this.getCanvas().getContext("2d");T.fillStyle=E,T.font=S;for(let A=0;A<Math.min(p.length,m.length);A++){let k=x[A]?x[A]:p[A].position;T.fillText(m[A],k[0],k[1])}this.data=Uint8Array.from(T.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(p,l){let g=new Array(p);for(let m=0;m<p;m++)g[m]=new Array(l).fill(0);return g}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(l={}){let{kind:g="cross",shape:m,size:x,width:E,height:S,filled:h=!0}=l;if(x&&(E=x,S=x),m)switch(m.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(E,S,{filled:h});break;case"circle":case"ellipse":this.matrix=ellipse(E,S,{filled:h});break;case"triangle":this.matrix=triangle(E,S,{filled:h});break;default:throw new Error(`Shape: unexpected shape: ${m}`)}else if(g)switch(g.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${g}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let l=this.matrix,g=[];for(let m=0;m<l.length;m++)for(let x=0;x<l[0].length;x++)l[m][x]&&g.push([x-this.halfWidth,m-this.halfHeight]);return g}getMask(){let l=new Image$1(this.width,this.height,{kind:BINARY});for(let g=0;g<this.matrix.length;g++)for(let m=0;m<this.matrix[0].length;m++)this.matrix[g][m]&&l.setBitXY(m,g);return l}}function rectangle(p,l,g){const m=zerosMatrix(l,p);if(g.filled)for(let x=0;x<l;x++)for(let E=0;E<p;E++)m[x][E]=1;else{for(let x of[0,l-1])for(let E=0;E<p;E++)m[x][E]=1;for(let x=0;x<l;x++)for(let E of[0,p-1])m[x][E]=1}return m}function ellipse(p,l,g){const m=zerosMatrix(l,p);let x=1-l%2,E=1-p%2,S=Math.floor((p-1)/2),h=Math.floor((l-1)/2),I=S*S,T=h*h;if(g.filled)for(let A=0;A<=h;A++){let k=Math.floor(Math.sqrt(I-I*A*A/T));for(let P=S-k;P<=S;P++)m[h-A][P]=1,m[h+A+x][P]=1,m[h-A][p-P-1]=1,m[h+A+x][p-P-1]=1}else{for(let A=0;A<=h;A++){let k=Math.floor(Math.sqrt(I-I*A*A/T)),P=S-k;m[h-A][P]=1,m[h+A+x][P]=1,m[h-A][p-P-1]=1,m[h+A+x][p-P-1]=1}for(let A=0;A<=S;A++){let k=Math.floor(Math.sqrt(T-T*A*A/I)),P=h-k;m[P][S-A]=1,m[P][S+A+E]=1,m[l-P-1][S-A]=1,m[l-P-1][S+A+E]=1}}return m}function triangle(p,l,g){if(!g.filled)throw new Error("Non filled triangle is not implemented");const m=zerosMatrix(l,p);for(let x=0;x<l;x++){let E=Math.floor((1-x/l)*p/2);for(let S=E;S<p-E;S++)m[x][S]=1}return m}function paintPoints(p,l={}){let{shape:g}=l;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let m=getColors(Object.assign({},l,{numberColors:p.length})),x=new Shape(g).getPoints(),E=Math.min(this.channels,m[0].length);for(let S=0;S<p.length;S++){let h=m[S%m.length],I=p[S][0],T=p[S][1];for(let A=0;A<x.length;A++){let k=x[A][0],P=x[A][1];if(I+k>=0&&T+P>=0&&I+k<this.width&&T+P<this.height){let D=(I+k+(T+P)*this.width)*this.channels;for(let M=0;M<E;M++)this.data[D+M]=h[M]}}}return this}function paintPolyline(p,l={}){let{color:g=[this.maxValue,0,0],closed:m=!1}=l;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let x=Math.min(this.channels,g.length);for(let E=0;E<p.length-1+m;E++){let S=p[E],h=p[(E+1)%p.length],I=h[0]-S[0],T=h[1]-S[1],A=Math.max(Math.abs(I),Math.abs(T)),k=I/A,P=T/A,D=S[0],M=S[1];for(let F=0;F<=A;F++){let N=Math.round(D),B=Math.round(M);if(N>=0&&B>=0&&N<this.width&&B<this.height)if(this.bitDepth===1)this.setBitXY(N,B);else{let U=(N+B*this.width)*this.channels;for(let O=0;O<x;O++)this.data[U+O]=g[O]}D=D+k,M=M+P}}return this}function paintPolylines(p,l={}){let g=Object.assign({},l);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let m=getColors(Object.assign({},l,{numberColors:p.length}));for(let x=0;x<p.length;x++)g.color=m[x%m.length],this.paintPolyline(p[x],g);return this}function paintPolygon(p,l={}){let{color:g=[this.maxValue,0,0],filled:m=!1}=l;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),l.closed=!0;let x=deleteDouble(p);if(m===!1)return this.paintPolyline(p,l);{let E=Array(this.height);for(let S=0;S<this.height;S++){E[S]=[];for(let h=0;h<this.width;h++)E[S].push(0)}for(let S=0;S<x.length;S++){const h=lineBetweenTwoPoints(x[S],x[(S+1)%x.length]);for(let I=0;I<this.height;I++)for(let T=0;T<this.width;T++)isAtTheRightOfTheLine(T,I,h,this.height)&&(E[I][T]=E[I][T]===0?1:0)}for(let S=0;S<this.height;S++)for(let h=0;h<this.width;h++)if(E[S][h]===1)if(this.bitDepth===1)this.setBitXY(h,S);else{let I=Math.min(this.channels,g.length),T=(h+S*this.width)*this.channels;for(let A=0;A<I;A++)this.data[T+A]=g[A]}return this.paintPolyline(p,l)}}function deleteDouble(p){let l=[];for(let g=0;g<p.length;g++)if(!(p[g][0]===p[(g+1)%p.length][0]&&p[g][1]===p[(g+1)%p.length][1])){if(p[g][0]===p[(g-1+p.length)%p.length][0]&&p[g][1]===p[(g-1+p.length)%p.length][1])continue;if(p[(g+1)%p.length][0]===p[(g-1+p.length)%p.length][0]&&p[(g-1+p.length)%p.length][1]===p[(g+1)%p.length][1])continue;l.push(p[g])}return l}function lineBetweenTwoPoints(p,l){if(p[0]===l[0])return{a:0,b:p[0],vertical:!0};{const g=(l[1]-p[1])/(l[0]-p[0]),m=p[1]-g*p[0];return{a:g,b:m,vertical:!1}}}function isAtTheRightOfTheLine(p,l,g,m){if(g.vertical===!0)return g.b<=p;if(g.a===0)return!1;{const x=(l-g.b)/g.a;return x<p&&x>=0&&x<=m}}function paintPolygons(p,l={}){let g=Object.assign({},l);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let m=getColors(Object.assign({},l,{numberColors:p.length}));for(let x=0;x<p.length;x++)g.color=m[x%m.length],this.paintPolygon(p[x],g);return this}function getHistogram(p={}){let{maxSlots:l=256,channel:g,useAlpha:m=!0}=p;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),g===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");g=0}return getChannelHistogram.call(this,g,{useAlpha:m,maxSlots:l})}function getHistograms(p={}){const{maxSlots:l=256,useAlpha:g=!0}=p;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let m=new Array(g?this.components:this.channels);for(let x=0;x<m.length;x++)m[x]=getChannelHistogram.call(this,x,{useAlpha:g,maxSlots:l});return m}function getChannelHistogram(p,l){let{useAlpha:g,maxSlots:m}=l;if(this.bitDepth===1){let I=[0,0];for(let T=0;T<this.height;T++)for(let A=0;A<this.width;A++){let k=this.getBitXY(T,A);k===0?I[0]+=1:k===1&&(I[1]+=1)}return I}let x=Math.log2(m);if(!isInteger(x))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let E=0;this.bitDepth>x&&(E=this.bitDepth-x);let S=this.data,h=newArray_1(Math.pow(2,Math.min(this.bitDepth,x)),0);if(g&&this.alpha){let I=this.channels-p-1;for(let T=p;T<S.length;T+=this.channels)h[S[T]>>E]+=S[T+I]/this.maxValue}else for(let I=p;I<S.length;I+=this.channels)h[S[I]>>E]++;return h}function getColorHistogram(p={}){let{useAlpha:l=!0,nbSlots:g=512}=p;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let m=Math.log(g)/Math.log(8);if(m!==Math.floor(m))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let x=this.bitDepth-m,E=this.data,S=newArray_1(Math.pow(8,m),0),h=Math.pow(2,m*2),I=Math.pow(2,m);for(let T=0;T<E.length;T+=this.channels){let A=(E[T]>>x)*h+(E[T+1]>>x)*I+(E[T+2]>>x);l&&this.alpha?S[A]+=E[T+this.channels-1]/this.maxValue:S[A]++}return S}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let p=newArray_1(this.channels,1/0);for(let l=0;l<this.data.length;l+=this.channels)for(let g=0;g<this.channels;g++)this.data[l+g]<p[g]&&(p[g]=this.data[l+g]);return p}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let p=newArray_1(this.channels,-1/0);for(let l=0;l<this.data.length;l+=this.channels)for(let g=0;g<this.channels;g++)this.data[l+g]>p[g]&&(p[g]=this.data[l+g]);return p}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let p=newArray_1(this.channels,0);for(let l=0;l<this.data.length;l+=this.channels)for(let g=0;g<this.channels;g++)p[g]+=this.data[l+g];return p}function getMoment(p=0,l=0){this.checkProcessable("getMoment",{bitDepth:[1]});let g=0;for(let m=0;m<this.width;m++)for(let x=0;x<this.height;x++)this.getBitXY(m,x)===1&&(g+=m**p*x**l);return g}function localMaxima(p={}){let{mask:l,region:g=3,removeClosePoints:m=0,invert:x=!1,maxEquals:E=2}=p,S=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),g*=4;let h=x?0:1,I=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],T=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],A=g<=8?1:2,k=[];for(let P=A;P<S.height-A;P++)for(let D=A;D<S.width-A;D++){if(l&&l.getBitXY(D,P)!==h)continue;let M=0,F=0,N=S.data[D+P*S.width];for(let B=0;B<g;B++)x?S.data[D+I[B]+(P+T[B])*S.width]>N&&M++:S.data[D+I[B]+(P+T[B])*S.width]<N&&M++,S.data[D+I[B]+(P+T[B])*S.width]===N&&F++;M+F===g&&F<=E&&k.push([D,P])}if(m>0)for(let P=0;P<k.length;P++)for(let D=P+1;D<k.length;D++)Math.sqrt(Math.pow(k[P][0]-k[D][0],2)+Math.pow(k[P][1]-k[D][1],2))<m&&(k[P][0]=k[P][0]+k[D][0]>>1,k[P][1]=k[P][1]+k[D][1]>>1,k.splice(D,1),D--);return k}function mean(){let p=this.getHistograms({maxSlots:this.maxValue+1}),l=new Array(p.length);for(let g=0;g<p.length;g++){let m=p[g];l[g]=mean$2(m)}return l}function median(){let p=this.getHistograms({maxSlots:this.maxValue+1}),l=new Array(p.length);for(let g=0;g<p.length;g++){let m=p[g];l[g]=median$2(m)}return l}function points(){this.checkProcessable("points",{bitDepth:[1]});const p=[];for(let l=0;l<this.width;l++)for(let g=0;g<this.height;g++)this.getBitXY(l,g)===1&&p.push([l,g]);return p}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const p=[];for(let l=0;l<this.height;l++)for(let g=0;g<this.width;g++)if(this.getBitXY(g,l)===1)for(p.push([g,l]),this.getBitXY(g+1,l)!==1?(p.push([g+1,l]),p.push([g+1,l+1]),this.getBitXY(g,l+1)!==1&&p.push([g,l+1])):this.getBitXY(g,l+1)!==1&&(p.push([g,l+1]),p.push([g+1,l+1]));g<this.width-2&&this.getBitXY(g+1,l)===1&&this.getBitXY(g+2,l)===1;)g++;return p}function getRelativePosition(p,l={}){if(this===p)return[0,0];let g=[0,0],m=this;for(;m;){if(m===p)return g;m.position&&(g[0]+=m.position[0],g[1]+=m.position[1]),m=m.parent}return l.defaultFurther?g:!1}function countAlphaPixels(p={}){let{alpha:l=1}=p;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let g=0;if(l!==void 0){for(let m=this.components;m<this.data.length;m+=this.channels)this.data[m]===l&&g++;return g}else return this.size}function monotoneChainConvexHull$1(p,l={}){l.sorted||p.sort(byXThenY);const g=p.length,m=new Array(g*2);for(var x=0,E=0;E<g;E++){const h=p[E];for(;x>=2&&cw(m[x-2],m[x-1],h)<=0;)x--;m[x++]=h}const S=x+1;for(E=g-2;E>=0;E--){const h=p[E];for(;x>=S&&cw(m[x-2],m[x-1],h)<=0;)x--;m[x++]=h}return m.slice(0,x-1)}function cw(p,l,g){return(l[1]-p[1])*(g[0]-p[0])-(l[0]-p[0])*(g[1]-p[1])}function byXThenY(p,l){return p[0]===l[0]?p[1]-l[1]:p[0]-l[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(p){for(let l=0;l<p.length;l++)p[l][0]=Math.round(p[l][0]),p[l][1]=Math.round(p[l][1]);return p}function difference(p,l){return[p[0]-l[0],p[1]-l[1]]}function normalize(p){let l=Math.sqrt(p[0]**2+p[1]**2);return[p[0]/l,p[1]/l]}function rotate(p,l,g){g===void 0&&(g=new Array(l.length));let m=Math.cos(p),x=Math.sin(p);for(let E=0;E<g.length;++E)g[E]=[m*l[E][0]-x*l[E][1],x*l[E][0]+m*l[E][1]];return g}function perimeter(p){let l=0;for(let g=0;g<p.length;g++){let m=p[g][0],x=p[g][1],E=p[g===p.length-1?0:g+1][0],S=p[g===p.length-1?0:g+1][1];l+=Math.sqrt((E-m)**2+(S-x)**2)}return l}function surface(p){let l=0;for(let g=0;g<p.length;g++){let m=p[g][0],x=p[g===p.length-1?0:g+1][1],E=p[g===p.length-1?0:g+1][0],S=p[g][1];l+=m*x*.5,l-=E*S*.5}return Math.abs(l)}function minMax(p){let l=1/0,g=1/0,m=-1/0,x=-1/0;for(let E=0;E<p.length;E++)p[E][0]<l&&(l=p[E][0]),p[E][0]>m&&(m=p[E][0]),p[E][1]<g&&(g=p[E][1]),p[E][1]>x&&(x=p[E][1]);return[[l,g],[m,x]]}function moveToZeroZero(p,l){l===void 0&&(l=new Array(p.length).fill(0).map(()=>[]));let g=minMax(p),m=g[0][0],x=g[0][1];for(let E=0;E<p.length;E++)l[E][0]=p[E][0]-m,l[E][1]=p[E][1]-x;return l}function minimalBoundingRectangle(p={}){const{originalPoints:l=monotoneChainConvexHull.call(this)}=p;if(l.length===0)return[];if(l.length===1)return[l[0],l[0],l[0],l[0]];const g=new Array(l.length);let m=1/0,x=0,E;for(let S=0;S<g.length;S++){let h=getAngle$1(l[S],l[(S+1)%g.length]);rotate(-h,l,g);let I=g[S][0],T=g[S][1],A=g[(S+1)%g.length][0],k=g[(S+1)%g.length][1],P=!0,D=0,M=0,F=0;for(let O=0;O<g.length;O++){let V=g[O][0],Z=g[O][1],W=(V-I)/(A-I);P===!0?(P=!1,D=W,M=W):(W<D&&(D=W),W>M&&(M=W));let Y=(-(A-I)*Z+A*T-k*I)/(A-I);Math.abs(Y)>Math.abs(F)&&(F=Y)}let N=[I+D*(A-I),T],B=[I+M*(A-I),T],U=Math.abs(F*(D-M)*(A-I));U<m&&(x=h,m=U,E=[N,B,[B[0],B[1]-F],[N[0],N[1]-F]])}return rotate(x,E,E),E}function getAngle$1(p,l){let g=difference(l,p),m=normalize(g),x=Math.acos(m[0]);return m[1]<0?-x:x}function extend$4(p){let l={inPlace:!0};p.extendMethod("invert",invert),p.extendMethod("abs",abs),p.extendMethod("level",level,l),p.extendMethod("add",add,l),p.extendMethod("subtract",subtract,l),p.extendMethod("subtractImage",subtractImage),p.extendMethod("multiply",multiply,l),p.extendMethod("divide",divide,l),p.extendMethod("hypotenuse",hypotenuse),p.extendMethod("background",background$1),p.extendMethod("flipX",flipX),p.extendMethod("flipY",flipY),p.extendMethod("blurFilter",blurFilter),p.extendMethod("medianFilter",medianFilter),p.extendMethod("gaussianFilter",gaussianFilter),p.extendMethod("sobelFilter",sobelFilter),p.extendMethod("gradientFilter",gradientFilter),p.extendMethod("scharrFilter",scharrFilter),p.extendMethod("dilate",dilate),p.extendMethod("erode",erode),p.extendMethod("open",open),p.extendMethod("close",close),p.extendMethod("topHat",topHat),p.extendMethod("blackHat",blackHat),p.extendMethod("morphologicalGradient",morphologicalGradient),p.extendMethod("warpingFourPoints",warpingFourPoints),p.extendMethod("crop",crop),p.extendMethod("cropAlpha",cropAlpha),p.extendMethod("resize",resize).extendMethod("scale",resize),p.extendMethod("hsv",hsv),p.extendMethod("hsl",hsl$1),p.extendMethod("cmyk",cmyk),p.extendMethod("rgba8",rgba8),p.extendMethod("grey",grey).extendMethod("gray",grey),p.extendMethod("mask",mask),p.extendMethod("pad",pad),p.extendMethod("colorDepth",colorDepth),p.extendMethod("setBorder",setBorder,l),p.extendMethod("rotate",rotate$1),p.extendMethod("rotateLeft",rotateLeft),p.extendMethod("rotateRight",rotateRight),p.extendMethod("insert",insert),p.extendMethod("getRow",getRow),p.extendMethod("getColumn",getColumn),p.extendMethod("getMatrix",getMatrix),p.extendMethod("setMatrix",setMatrix),p.extendMethod("getPixelsArray",getPixelsArray),p.extendMethod("getIntersection",getIntersection),p.extendMethod("getClosestCommonParent",getClosestCommonParent),p.extendMethod("getThreshold",getThreshold),p.extendMethod("split",split),p.extendMethod("getChannel",getChannel),p.extendMethod("combineChannels",combineChannels),p.extendMethod("setChannel",setChannel),p.extendMethod("getSimilarity",getSimilarity),p.extendMethod("getPixelsGrid",getPixelsGrid),p.extendMethod("getBestMatch",getBestMatch),p.extendMethod("cannyEdge",cannyEdge),p.extendMethod("convolution",convolution),p.extendMethod("extract",extract),p.extendMethod("floodFill",floodFill),p.extendMethod("paintLabels",paintLabels,l),p.extendMethod("paintMasks",paintMasks,l),p.extendMethod("paintPoints",paintPoints,l),p.extendMethod("paintPolyline",paintPolyline,l),p.extendMethod("paintPolylines",paintPolylines,l),p.extendMethod("paintPolygon",paintPolygon,l),p.extendMethod("paintPolygons",paintPolygons,l),p.extendMethod("countAlphaPixels",countAlphaPixels),p.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),p.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),p.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),p.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),p.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),p.extendMethod("getMin",min).extendProperty("min",min),p.extendMethod("getMax",max).extendProperty("max",max),p.extendMethod("getSum",sum).extendProperty("sum",sum),p.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),p.extendMethod("getLocalMaxima",localMaxima),p.extendMethod("getMedian",median).extendProperty("median",median),p.extendMethod("getMean",mean).extendProperty("mean",mean),p.extendMethod("getPoints",points).extendProperty("points",points),p.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),p.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(p,l){(function(g,m){p.exports=m()})(commonjsGlobal,function(){function g(ke){return typeof ke=="string"||ke instanceof String}var m=Number.isFinite||window.isFinite;function x(ke){return m(ke)}function E(ke){return ke}function S(ke){var Ke={};return ke.filter(function(re){return Ke.hasOwnProperty(re)?!1:Ke[re]=!0})}function h(ke,Ke){if(Ke.length!==ke.length)return!1;for(var re=0;re<ke.length;re++)if(Ke[re].compareArray&&!Ke[re].compareArray(ke[re])||Ke[re]!==ke[re])return!1;return!0}function I(ke,Ke){Object.keys(Ke).forEach(function(re){ke[re]=Ke[re]})}function T(){for(var ke=1,Ke=0,re=0;re<arguments.length;re++){var le=arguments[re];Ke=Ke+P(le),ke*=le}return Ke!==0?k(ke,Ke):ke}function A(ke,Ke){if(Ke===0)throw new Error("Divide by zero");var re=Math.pow(10,P(Ke)),le=re/(re*Ke);return T(ke,le)}function k(ke,Ke){return Math.round(ke*Math.pow(10,Ke))/Math.pow(10,Ke)}function P(ke){if(!isFinite(ke))return 0;for(var Ke=0;ke%1!=0;)ke*=10,Ke++;return Ke}function D(){var ke;if(!this)return ke=Object.create(D.prototype),D.apply(ke,arguments),ke;ke=Error.apply(this,arguments),this.name="QtyError",this.message=ke.message,this.stack=ke.stack}D.prototype=Object.create(Error.prototype,{constructor:{value:D}});function M(ke,Ke){throw new D("Incompatible units: "+ke+" and "+Ke)}var F={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},N=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],B="<1>",U=[B];function O(ke,Ke){var re=Ke[1],le=Ke[3]||[],Se=Ke[4]||[];if(!x(re))throw new D(ke+": Invalid unit definition. 'scalar' must be a number");le.forEach(function(Ne){if(F[Ne]===void 0)throw new D(ke+": Invalid unit definition. Unit "+Ne+" in 'numerator' is not recognized")}),Se.forEach(function(Ne){if(F[Ne]===void 0)throw new D(ke+": Invalid unit definition. Unit "+Ne+" in 'denominator' is not recognized")})}var V={},Z={},W={},Y={},X={};for(var J in F)if(F.hasOwnProperty(J)){var q=F[J];if(q[2]==="prefix"){V[J]=q[1];for(var te=0;te<q[0].length;te++)Z[q[0][te]]=J}else{O(J,q),W[J]={scalar:q[1],numerator:q[3],denominator:q[4]};for(var ne=0;ne<q[0].length;ne++)Y[q[0][ne]]=J}X[J]=q[0][0]}function de(ke){var Ke,re=[],le=Object.keys(F);if(typeof ke=="undefined")for(Ke=0;Ke<le.length;Ke++)["","prefix"].indexOf(F[le[Ke]][2])===-1&&re.push(le[Ke].substr(1,le[Ke].length-2));else{if(this.getKinds().indexOf(ke)===-1)throw new D("Kind not recognized");for(Ke=0;Ke<le.length;Ke++)F[le[Ke]][2]===ke&&re.push(le[Ke].substr(1,le[Ke].length-2))}return re.sort(function(Se,Ne){return Se.toLowerCase()<Ne.toLowerCase()?-1:Se.toLowerCase()>Ne.toLowerCase()?1:0})}function oe(ke){if(!Y[ke])throw new D("Unit not recognized");return F[Y[ke]][0]}var we=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Ae(){if(this.signature)return this.signature;for(var ke=ye.call(this),Ke=0;Ke<ke.length;Ke++)ke[Ke]*=Math.pow(20,Ke);return ke.reduce(function(re,le){return re+le},0)}function ye(){if(!this.isBase())return ye.call(this.toBase());for(var ke=new Array(we.length),Ke=0;Ke<ke.length;Ke++)ke[Ke]=0;for(var re,le,Se=0;Se<this.numerator.length;Se++)(re=F[this.numerator[Se]])&&(le=we.indexOf(re[2]),le>=0&&(ke[le]=ke[le]+1));for(var Ne=0;Ne<this.denominator.length;Ne++)(re=F[this.denominator[Ne]])&&(le=we.indexOf(re[2]),le>=0&&(ke[le]=ke[le]-1));return ke}var me="[+-]",xe="\\d+",Le=me+"?"+xe,Ze="\\."+xe,Xe="(?:"+xe+"(?:"+Ze+")?)|(?:"+Ze+")",je="[Ee]"+Le,Ie="(?:"+Xe+")(?:"+je+")?",Pe=me+"?\\s*"+Ie,De="("+Pe+")?\\s*([^/]*)(?:/(.+))?",ze=new RegExp("^"+De+"$"),it="\\^|\\*{2}",tt="[01234]",ot=new RegExp("([^ \\*\\d]+?)(?:"+it+")?(-?"+tt+"(?![a-zA-Z]))"),lt=new RegExp("([^ \\*\\d]+?)(?:"+it+")?("+tt+"(?![a-zA-Z]))");function St(ke){g(ke)||(ke=ke.toString()),ke=ke.trim();var Ke=ze.exec(ke);if(!Ke)throw new D(ke+": Quantity not recognized");var re=Ke[1];re?(re=re.replace(/\s/g,""),this.scalar=parseFloat(re)):this.scalar=1;for(var le=Ke[2],Se=Ke[3],Ne,We,nt;Ke=ot.exec(le);){if(Ne=parseFloat(Ke[2]),isNaN(Ne))throw new D("Unit exponent is not a number");if(Ne===0&&!He.test(Ke[1]))throw new D("Unit not recognized");We=Ke[1]+" ",nt="";for(var vt=0;vt<Math.abs(Ne);vt++)nt+=We;Ne>=0?le=le.replace(Ke[0],nt):(Se=Se?Se+nt:nt,le=le.replace(Ke[0],""))}for(;Ke=lt.exec(Se);){if(Ne=parseFloat(Ke[2]),isNaN(Ne))throw new D("Unit exponent is not a number");if(Ne===0&&!He.test(Ke[1]))throw new D("Unit not recognized");We=Ke[1]+" ",nt="";for(var Dt=0;Dt<Ne;Dt++)nt+=We;Se=Se.replace(Ke[0],nt)}le&&(this.numerator=pe(le.trim())),Se&&(this.denominator=pe(Se.trim()))}var et=Object.keys(Z).sort(function(ke,Ke){return Ke.length-ke.length}).join("|"),Je=Object.keys(Y).sort(function(ke,Ke){return Ke.length-ke.length}).join("|"),Be="\\b|$",Ge="("+et+")??("+Je+")(?:"+Be+")",He=new RegExp("^\\s*("+Ge+"[\\s\\*]*)+$"),ve=new RegExp(Ge,"g"),_e={};function pe(ke){var Ke=_e[ke];if(Ke)return Ke;var re,le=[];if(!He.test(ke))throw new D("Unit not recognized");for(;re=ve.exec(ke);)le.push(re.slice(1));return le=le.map(function(Se){return Z[Se[0]]?[Z[Se[0]],Y[Se[1]]]:[Y[Se[1]]]}),le=le.reduce(function(Se,Ne){return Se.concat(Ne)},[]),le=le.filter(function(Se){return Se}),_e[ke]=le,le}function fe(ke){if(!g(ke))throw new D("Argument should be a string");try{return this(ke)}catch{return null}}function ue(ke){return ke instanceof ce}function ce(ke,Ke){if(Ee.apply(null,arguments),!ue(this))return new ce(ke,Ke);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=U,this.denominator=U,Ye(ke)?(this.scalar=ke.scalar,this.numerator=ke.numerator&&ke.numerator.length!==0?ke.numerator:U,this.denominator=ke.denominator&&ke.denominator.length!==0?ke.denominator:U):Ke?(St.call(this,Ke),this.scalar=ke):St.call(this,ke),this.denominator.join("*").indexOf("temp")>=0)throw new D("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new D("Cannot multiply by temperatures");if(!h(this.denominator,U))throw new D("Cannot divide with temperatures")}if(this.initValue=ke,ft.call(this),this.isTemperature()&&this.baseScalar<0)throw new D("Temperatures must not be less than absolute zero")}ce.prototype={constructor:ce};function Ee(ke,Ke){if(Ke){if(!(x(ke)&&g(Ke)))throw new D("Only number accepted as initialization value when units are explicitly provided")}else if(!(g(ke)||x(ke)||ue(ke)||Ye(ke)))throw new D("Only string, number or quantity accepted as single initialization value")}function Ye(ke){return ke&&typeof ke=="object"&&ke.hasOwnProperty("scalar")}function ft(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Ae.call(this);else{var ke=this.toBase();this.baseScalar=ke.scalar,this.signature=ke.signature}}var _t={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber","0":"unitless","1":"length","2":"area","3":"volume","20":"time","400":"temperature","7941":"yank","7942":"power","7959":"pressure","7961":"force","7962":"energy","7979":"viscosity","7981":"momentum","7982":"angular_momentum","7997":"density","7998":"area_density","8000":"mass","152020":"radiation_exposure","159999":"magnetism","160000":"current","160020":"charge","312058":"conductance","312078":"capacitance","3199980":"activity","3199997":"molar_concentration","3200000":"substance","63999998":"illuminance","64000000":"luminous_power","1280000000":"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function It(){return S(Object.keys(_t).map(function(ke){return _t[ke]}))}ce.prototype.kind=function(){return _t[this.signature.toString()]},I(ce.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&h(this.denominator,U)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function $t(ke,Ke){var re=ke.units(),le=Ke.to(re),Se=ce(zt(re));return ce({scalar:ke.scalar-le.scalar,numerator:Se.numerator,denominator:Se.denominator})}function Yt(ke,Ke){var re=Ke.to(zt(ke.units()));return ce({scalar:ke.scalar-re.scalar,numerator:ke.numerator,denominator:ke.denominator})}function ii(ke,Ke){var re=Ke.to(zt(ke.units()));return ce({scalar:ke.scalar+re.scalar,numerator:ke.numerator,denominator:ke.denominator})}function zt(ke){if(ke==="tempK")return"degK";if(ke==="tempC")return"degC";if(ke==="tempF")return"degF";if(ke==="tempR")return"degR";throw new D("Unknown type for temp conversion from: "+ke)}function qt(ke,Ke){var re=Vt(ke),le=Ke.units(),Se;if(le==="degK")Se=re.scalar;else if(le==="degC")Se=re.scalar;else if(le==="degF")Se=re.scalar*9/5;else if(le==="degR")Se=re.scalar*9/5;else throw new D("Unknown type for degree conversion to: "+le);return ce({scalar:Se,numerator:Ke.numerator,denominator:Ke.denominator})}function Vt(ke){var Ke=ke.units(),re;if(Ke.match(/(deg)[CFRK]/))re=ke.baseScalar;else if(Ke==="tempK")re=ke.scalar;else if(Ke==="tempC")re=ke.scalar;else if(Ke==="tempF")re=ke.scalar*5/9;else if(Ke==="tempR")re=ke.scalar*5/9;else throw new D("Unknown type for temp conversion from: "+Ke);return ce({scalar:re,numerator:["<kelvin>"],denominator:U})}function fi(ke,Ke){var re=Ke.units(),le;if(re==="tempK")le=ke.baseScalar;else if(re==="tempC")le=ke.baseScalar-273.15;else if(re==="tempF")le=ke.baseScalar*9/5-459.67;else if(re==="tempR")le=ke.baseScalar*9/5;else throw new D("Unknown type for temp conversion to: "+re);return ce({scalar:le,numerator:Ke.numerator,denominator:Ke.denominator})}function hi(ke){var Ke=ke.units(),re;if(Ke.match(/(deg)[CFRK]/))re=ke.baseScalar;else if(Ke==="tempK")re=ke.scalar;else if(Ke==="tempC")re=ke.scalar+273.15;else if(Ke==="tempF")re=(ke.scalar+459.67)*5/9;else if(Ke==="tempR")re=ke.scalar*5/9;else throw new D("Unknown type for temp conversion from: "+Ke);return ce({scalar:re,numerator:["<temp-K>"],denominator:U})}I(ce.prototype,{to:function(ke){var Ke,re;if(ke==null)return this;if(!g(ke))return this.to(ke.units());if(Ke=this._conversionCache[ke],Ke)return Ke;if(re=ce(ke),re.units()===this.units())return this;if(!this.isCompatible(re))this.isInverse(re)?re=this.inverse().to(ke):M(this.units(),re.units());else if(re.isTemperature())re=fi(this,re);else if(re.isDegrees())re=qt(this,re);else{var le=A(this.baseScalar,re.baseScalar);re=ce({scalar:le,numerator:re.numerator,denominator:re.denominator})}return this._conversionCache[ke]=re,re},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return hi(this);var ke=bt[this.units()];return ke||(ke=At(this.numerator,this.denominator),bt[this.units()]=ke),ke.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new D("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(ke){if(g(ke)&&(ke=ce(ke)),x(ke)&&(ke=ce(ke+" "+this.units())),this.isUnitless()?ke.isUnitless()||M(this.units(),ke.units()):ke=ke.to(this.units()),ke.scalar===0)throw new D("Divide by zero");var Ke=T(Math.round(this.scalar/ke.scalar),ke.scalar);return ce(Ke+this.units())}});function Me(ke,Ke){var re=ce(ke),le=ce(Ke);if(re.eq(le))return E;var Se;return re.isTemperature()?Se=function(Ne){return re.mul(Ne).to(le).scalar}:Se=function(Ne){return Ne*re.baseScalar/le.baseScalar},function(We){var nt,vt,Dt;if(Array.isArray(We)){for(vt=We.length,Dt=[],nt=0;nt<vt;nt++)Dt.push(Se(We[nt]));return Dt}else return Se(We)}}var bt={};function At(ke,Ke){for(var re=[],le=[],Se=1,Ne,We=0;We<ke.length;We++)Ne=ke[We],V[Ne]?Se=T(Se,V[Ne]):W[Ne]&&(Se*=W[Ne].scalar,W[Ne].numerator&&re.push(W[Ne].numerator),W[Ne].denominator&&le.push(W[Ne].denominator));for(var nt=0;nt<Ke.length;nt++)Ne=Ke[nt],V[Ne]?Se/=V[Ne]:W[Ne]&&(Se/=W[Ne].scalar,W[Ne].numerator&&le.push(W[Ne].numerator),W[Ne].denominator&&re.push(W[Ne].denominator));return re=re.reduce(function(vt,Dt){return vt.concat(Dt)},[]),le=le.reduce(function(vt,Dt){return vt.concat(Dt)},[]),ce({scalar:Se,numerator:re,denominator:le})}ce.parse=fe,ce.getUnits=de,ce.getAliases=oe,ce.mulSafe=T,ce.divSafe=A,ce.getKinds=It,ce.swiftConverter=Me,ce.Error=D,I(ce.prototype,{add:function(ke){if(g(ke)&&(ke=ce(ke)),this.isCompatible(ke)||M(this.units(),ke.units()),this.isTemperature()&&ke.isTemperature())throw new D("Cannot add two temperatures");return this.isTemperature()?ii(this,ke):ke.isTemperature()?ii(ke,this):ce({scalar:this.scalar+ke.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(ke){if(g(ke)&&(ke=ce(ke)),this.isCompatible(ke)||M(this.units(),ke.units()),this.isTemperature()&&ke.isTemperature())return $t(this,ke);if(this.isTemperature())return Yt(this,ke);if(ke.isTemperature())throw new D("Cannot subtract a temperature from a differential degree unit");return ce({scalar:this.scalar-ke.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(ke){if(x(ke))return ce({scalar:T(this.scalar,ke),numerator:this.numerator,denominator:this.denominator});if(g(ke)&&(ke=ce(ke)),(this.isTemperature()||ke.isTemperature())&&!(this.isUnitless()||ke.isUnitless()))throw new D("Cannot multiply by temperatures");var Ke=this,re=ke;Ke.isCompatible(re)&&Ke.signature!==400&&(re=re.to(Ke));var le=Bt(Ke.numerator,Ke.denominator,re.numerator,re.denominator);return ce({scalar:T(Ke.scalar,re.scalar,le[2]),numerator:le[0],denominator:le[1]})},div:function(ke){if(x(ke)){if(ke===0)throw new D("Divide by zero");return ce({scalar:this.scalar/ke,numerator:this.numerator,denominator:this.denominator})}else g(ke)&&(ke=ce(ke));if(ke.scalar===0)throw new D("Divide by zero");if(ke.isTemperature())throw new D("Cannot divide with temperatures");if(this.isTemperature()&&!ke.isUnitless())throw new D("Cannot divide with temperatures");var Ke=this,re=ke;Ke.isCompatible(re)&&Ke.signature!==400&&(re=re.to(Ke));var le=Bt(Ke.numerator,Ke.denominator,re.denominator,re.numerator);return ce({scalar:T(Ke.scalar,le[2])/re.scalar,numerator:le[0],denominator:le[1]})},inverse:function(){if(this.isTemperature())throw new D("Cannot divide with temperatures");if(this.scalar===0)throw new D("Divide by zero");return ce({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Bt(ke,Ke,re,le){function Se(ri){return ri!==B}ke=ke.filter(Se),re=re.filter(Se),Ke=Ke.filter(Se),le=le.filter(Se);var Ne={};function We(ri,Ht){for(var _i,ai,Ct,Ut=0;Ut<ri.length;Ut++)if(V[ri[Ut]]?(_i=ri[Ut+1],ai=ri[Ut],Ct=V[ai],Ut++):(_i=ri[Ut],ai=null,Ct=1),_i&&_i!==B)if(Ne[_i]){Ne[_i][0]+=Ht;var Mi=Ne[_i][2]?V[Ne[_i][2]]:1;Ne[_i][Ht===1?3:4]*=A(Ct,Mi)}else Ne[_i]=[Ht,_i,ai,1,1]}We(ke,1),We(Ke,-1),We(re,1),We(le,-1);var nt=[],vt=[],Dt=1;for(var wt in Ne)if(Ne.hasOwnProperty(wt)){var Tt=Ne[wt],Nt;if(Tt[0]>0)for(Nt=0;Nt<Tt[0];Nt++)nt.push(Tt[2]===null?Tt[1]:[Tt[2],Tt[1]]);else if(Tt[0]<0)for(Nt=0;Nt<-Tt[0];Nt++)vt.push(Tt[2]===null?Tt[1]:[Tt[2],Tt[1]]);Dt*=A(Tt[3],Tt[4])}return nt.length===0&&(nt=U),vt.length===0&&(vt=U),nt=nt.reduce(function(ri,Ht){return ri.concat(Ht)},[]),vt=vt.reduce(function(ri,Ht){return ri.concat(Ht)},[]),[nt,vt,Dt]}I(ce.prototype,{eq:function(ke){return this.compareTo(ke)===0},lt:function(ke){return this.compareTo(ke)===-1},lte:function(ke){return this.eq(ke)||this.lt(ke)},gt:function(ke){return this.compareTo(ke)===1},gte:function(ke){return this.eq(ke)||this.gt(ke)},compareTo:function(ke){if(g(ke))return this.compareTo(ce(ke));if(this.isCompatible(ke)||M(this.units(),ke.units()),this.baseScalar<ke.baseScalar)return-1;if(this.baseScalar===ke.baseScalar)return 0;if(this.baseScalar>ke.baseScalar)return 1},same:function(ke){return this.scalar===ke.scalar&&this.units()===ke.units()}}),I(ce.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(ke){return h(ke,U)})},isCompatible:function(ke){return g(ke)?this.isCompatible(ce(ke)):ue(ke)&&ke.signature!==void 0?this.signature===ke.signature:!1},isInverse:function(ke){return this.inverse().isCompatible(ke)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(ke){ke!==B&&N.indexOf(ke)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function pt(){}pt.prototype.get=function(ke){return arguments.length>1&&(ke=Array.apply(null,arguments)),ke.reduce(function(Ke,re,le){if(Ke){var Se=Ke[re];return le===ke.length-1?Se?Se.data:void 0:Se}},this)},pt.prototype.set=function(ke,Ke){return arguments.length>2&&(ke=Array.prototype.slice.call(arguments,0,-1),Ke=arguments[arguments.length-1]),ke.reduce(function(re,le,Se){var Ne=re[le];return Ne===void 0&&(Ne=re[le]={}),Se===ke.length-1?(Ne.data=Ke,Ke):Ne},this)};function Rt(ke,Ke){return(ke+" "+Ke).trim()}ce.formatter=Rt,I(ce.prototype,{units:function(){if(this._units!==void 0)return this._units;var ke=h(this.numerator,U),Ke=h(this.denominator,U);if(ke&&Ke)return this._units="",this._units;var re=jt(this.numerator),le=jt(this.denominator);return this._units=re+(Ke?"":"/"+le),this._units},toString:function(ke,Ke){var re;if(x(ke))re=this.units(),Ke=ke;else if(g(ke))re=ke;else if(ue(ke))return this.toPrec(ke).toString(Ke);var le=this.to(re),Se=Ke!==void 0?k(le.scalar,Ke):le.scalar;return le=(Se+" "+le.units()).trim(),le},format:function(ke,Ke){arguments.length===1&&typeof ke=="function"&&(Ke=ke,ke=void 0),Ke=Ke||ce.formatter;var re=this.to(ke);return Ke.call(this,re.scalar,re.units())}});var Ve=new pt;function jt(ke){var Ke=Ve.get(ke);if(Ke)return Ke;var re=h(ke,U);return re?Ke="1":Ke=ie(mi(ke)).join("*"),Ve.set(ke,Ke),Ke}function mi(ke){for(var Ke=[],re,le,Se=0;Se<ke.length;Se++)re=ke[Se],le=ke[Se+1],V[re]?(Ke.push(X[re]+X[le]),Se++):Ke.push(X[re]);return Ke}function ie(ke){var Ke=ke.reduce(function(re,le){var Se=re[le];return Se||re.push(Se=re[le]=[le,0]),Se[1]++,re},[]);return Ke.map(function(re){return re[0]+(re[1]>1?re[1]:"")})}return ce.version="1.7.6",ce})})(quantities);var Qty=quantities.exports;function deepValue(p,l=""){let g=l.split(".");for(let m of g){if(p[m]===void 0)return;p=p[m]}return p}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(p,l,g){var m=p*l,x=SPLITTER*p,E=x-p,S=x-E,h=p-S,I=SPLITTER*l,T=I-l,A=I-T,k=l-A,P=m-S*A,D=P-h*A,M=D-S*k,F=h*k-M;return g?(g[0]=F,g[1]=m,g):[F,m]}var robustSum=linearExpansionSum;function scalarScalar$1(p,l){var g=p+l,m=g-p,x=g-m,E=l-m,S=p-x,h=S+E;return h?[h,g]:[g]}function linearExpansionSum(p,l){var g=p.length|0,m=l.length|0;if(g===1&&m===1)return scalarScalar$1(p[0],l[0]);var x=g+m,E=new Array(x),S=0,h=0,I=0,T=Math.abs,A=p[h],k=T(A),P=l[I],D=T(P),M,F;k<D?(F=A,h+=1,h<g&&(A=p[h],k=T(A))):(F=P,I+=1,I<m&&(P=l[I],D=T(P))),h<g&&k<D||I>=m?(M=A,h+=1,h<g&&(A=p[h],k=T(A))):(M=P,I+=1,I<m&&(P=l[I],D=T(P)));for(var N=M+F,B=N-M,U=F-B,O=U,V=N,Z,W,Y,X,J;h<g&&I<m;)k<D?(M=A,h+=1,h<g&&(A=p[h],k=T(A))):(M=P,I+=1,I<m&&(P=l[I],D=T(P))),F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z;for(;h<g;)M=A,F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z,h+=1,h<g&&(A=p[h]);for(;I<m;)M=P,F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z,I+=1,I<m&&(P=l[I]);return O&&(E[S++]=O),V&&(E[S++]=V),S||(E[S++]=0),E.length=S,E}var twoSum$1=fastTwoSum;function fastTwoSum(p,l,g){var m=p+l,x=m-p,E=m-x,S=l-x,h=p-E;return g?(g[0]=h+S,g[1]=m,g):[h+S,m]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(p,l){var g=p.length;if(g===1){var m=twoProduct(p[0],l);return m[0]?m:[m[1]]}var x=new Array(2*g),E=[.1,.1],S=[.1,.1],h=0;twoProduct(p[0],l,E),E[0]&&(x[h++]=E[0]);for(var I=1;I<g;++I){twoProduct(p[I],l,S);var T=E[1];twoSum(T,S[0],E),E[0]&&(x[h++]=E[0]);var A=S[1],k=E[1],P=A+k,D=P-A,M=k-D;E[1]=P,M&&(x[h++]=M)}return E[1]&&(x[h++]=E[1]),h===0&&(x[h++]=0),x.length=h,x}var robustDiff=robustSubtract;function scalarScalar(p,l){var g=p+l,m=g-p,x=g-m,E=l-m,S=p-x,h=S+E;return h?[h,g]:[g]}function robustSubtract(p,l){var g=p.length|0,m=l.length|0;if(g===1&&m===1)return scalarScalar(p[0],-l[0]);var x=g+m,E=new Array(x),S=0,h=0,I=0,T=Math.abs,A=p[h],k=T(A),P=-l[I],D=T(P),M,F;k<D?(F=A,h+=1,h<g&&(A=p[h],k=T(A))):(F=P,I+=1,I<m&&(P=-l[I],D=T(P))),h<g&&k<D||I>=m?(M=A,h+=1,h<g&&(A=p[h],k=T(A))):(M=P,I+=1,I<m&&(P=-l[I],D=T(P)));for(var N=M+F,B=N-M,U=F-B,O=U,V=N,Z,W,Y,X,J;h<g&&I<m;)k<D?(M=A,h+=1,h<g&&(A=p[h],k=T(A))):(M=P,I+=1,I<m&&(P=-l[I],D=T(P))),F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z;for(;h<g;)M=A,F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z,h+=1,h<g&&(A=p[h]);for(;I<m;)M=P,F=O,N=M+F,B=N-M,U=F-B,U&&(E[S++]=U),Z=V+N,W=Z-V,Y=Z-W,X=N-W,J=V-Y,O=J+X,V=Z,I+=1,I<m&&(P=-l[I]);return O&&(E[S++]=O),V&&(E[S++]=V),S||(E[S++]=0),E.length=S,E}(function(p){var l=twoProduct_1,g=robustSum,m=robustScale,x=robustDiff,E=5,S=11102230246251565e-32,h=(3+16*S)*S,I=(7+56*S)*S;function T(O,V,Z,W){return function(X,J,q){var te=O(O(V(J[1],q[0]),V(-q[1],J[0])),O(V(X[1],J[0]),V(-J[1],X[0]))),ne=O(V(X[1],q[0]),V(-q[1],X[0])),de=W(te,ne);return de[de.length-1]}}function A(O,V,Z,W){return function(X,J,q,te){var ne=O(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),J[2]),O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),-q[2]),Z(O(V(J[1],q[0]),V(-q[1],J[0])),te[2]))),O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),te[2])))),de=O(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-q[2]),Z(O(V(X[1],q[0]),V(-q[1],X[0])),te[2]))),O(Z(O(V(J[1],q[0]),V(-q[1],J[0])),X[2]),O(Z(O(V(X[1],q[0]),V(-q[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),q[2])))),oe=W(ne,de);return oe[oe.length-1]}}function k(O,V,Z,W){return function(X,J,q,te,ne){var de=O(O(O(Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),q[2]),O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),-te[2]),Z(O(V(q[1],te[0]),V(-te[1],q[0])),ne[2]))),J[3]),O(Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),J[2]),O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),-te[2]),Z(O(V(J[1],te[0]),V(-te[1],J[0])),ne[2]))),-q[3]),Z(O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),J[2]),O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),-q[2]),Z(O(V(J[1],q[0]),V(-q[1],J[0])),ne[2]))),te[3]))),O(Z(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),J[2]),O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),-q[2]),Z(O(V(J[1],q[0]),V(-q[1],J[0])),te[2]))),-ne[3]),O(Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),J[2]),O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),-te[2]),Z(O(V(J[1],te[0]),V(-te[1],J[0])),ne[2]))),X[3]),Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-te[2]),Z(O(V(X[1],te[0]),V(-te[1],X[0])),ne[2]))),-J[3])))),O(O(Z(O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),ne[2]))),te[3]),O(Z(O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),te[2]))),-ne[3]),Z(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),J[2]),O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),-q[2]),Z(O(V(J[1],q[0]),V(-q[1],J[0])),te[2]))),X[3]))),O(Z(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-q[2]),Z(O(V(X[1],q[0]),V(-q[1],X[0])),te[2]))),-J[3]),O(Z(O(Z(O(V(J[1],te[0]),V(-te[1],J[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),te[2]))),q[3]),Z(O(Z(O(V(J[1],q[0]),V(-q[1],J[0])),X[2]),O(Z(O(V(X[1],q[0]),V(-q[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),q[2]))),-te[3]))))),oe=O(O(O(Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),q[2]),O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),-te[2]),Z(O(V(q[1],te[0]),V(-te[1],q[0])),ne[2]))),X[3]),Z(O(Z(O(V(te[1],ne[0]),V(-ne[1],te[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-te[2]),Z(O(V(X[1],te[0]),V(-te[1],X[0])),ne[2]))),-q[3])),O(Z(O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-q[2]),Z(O(V(X[1],q[0]),V(-q[1],X[0])),ne[2]))),te[3]),Z(O(Z(O(V(q[1],te[0]),V(-te[1],q[0])),X[2]),O(Z(O(V(X[1],te[0]),V(-te[1],X[0])),-q[2]),Z(O(V(X[1],q[0]),V(-q[1],X[0])),te[2]))),-ne[3]))),O(O(Z(O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),J[2]),O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),-q[2]),Z(O(V(J[1],q[0]),V(-q[1],J[0])),ne[2]))),X[3]),Z(O(Z(O(V(q[1],ne[0]),V(-ne[1],q[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-q[2]),Z(O(V(X[1],q[0]),V(-q[1],X[0])),ne[2]))),-J[3])),O(Z(O(Z(O(V(J[1],ne[0]),V(-ne[1],J[0])),X[2]),O(Z(O(V(X[1],ne[0]),V(-ne[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),ne[2]))),q[3]),Z(O(Z(O(V(J[1],q[0]),V(-q[1],J[0])),X[2]),O(Z(O(V(X[1],q[0]),V(-q[1],X[0])),-J[2]),Z(O(V(X[1],J[0]),V(-J[1],X[0])),q[2]))),-ne[3])))),we=W(de,oe);return we[we.length-1]}}function P(O){var V=O===3?T:O===4?A:k;return V(g,l,m,x)}var D=P(3),M=P(4),F=[function(){return 0},function(){return 0},function(V,Z){return Z[0]-V[0]},function(V,Z,W){var Y=(V[1]-W[1])*(Z[0]-W[0]),X=(V[0]-W[0])*(Z[1]-W[1]),J=Y-X,q;if(Y>0){if(X<=0)return J;q=Y+X}else if(Y<0){if(X>=0)return J;q=-(Y+X)}else return J;var te=h*q;return J>=te||J<=-te?J:D(V,Z,W)},function(V,Z,W,Y){var X=V[0]-Y[0],J=Z[0]-Y[0],q=W[0]-Y[0],te=V[1]-Y[1],ne=Z[1]-Y[1],de=W[1]-Y[1],oe=V[2]-Y[2],we=Z[2]-Y[2],Ae=W[2]-Y[2],ye=J*de,me=q*ne,xe=q*te,Le=X*de,Ze=X*ne,Xe=J*te,je=oe*(ye-me)+we*(xe-Le)+Ae*(Ze-Xe),Ie=(Math.abs(ye)+Math.abs(me))*Math.abs(oe)+(Math.abs(xe)+Math.abs(Le))*Math.abs(we)+(Math.abs(Ze)+Math.abs(Xe))*Math.abs(Ae),Pe=I*Ie;return je>Pe||-je>Pe?je:M(V,Z,W,Y)}];function N(O){var V=F[O.length];return V||(V=F[O.length]=P(O.length)),V.apply(void 0,O)}function B(O,V,Z,W,Y,X,J){return function(te,ne,de,oe,we){switch(arguments.length){case 0:case 1:return 0;case 2:return W(te,ne);case 3:return Y(te,ne,de);case 4:return X(te,ne,de,oe);case 5:return J(te,ne,de,oe,we)}for(var Ae=new Array(arguments.length),ye=0;ye<arguments.length;++ye)Ae[ye]=arguments[ye];return O(Ae)}}function U(){for(;F.length<=E;)F.push(P(F.length));p.exports=B.apply(void 0,[N].concat(F));for(var O=0;O<=E;++O)p.exports[O]=F[O]}U()})(orientation);var robustPnp=robustPointInPolygon,orient=orientation.exports;function robustPointInPolygon(p,l){for(var g=l[0],m=l[1],x=p.length,E=1,S=x,h=0,I=x-1;h<S;I=h++){var T=p[h],A=p[I],k=T[1],P=A[1];if(P<k){if(P<m&&m<k){var D=orient(T,A,l);if(D===0)return 0;E^=0<D|0}else if(m===k){var M=p[(h+1)%x],F=M[1];if(k<F){var D=orient(T,A,l);if(D===0)return 0;E^=0<D|0}}}else if(k<P){if(k<m&&m<P){var D=orient(T,A,l);if(D===0)return 0;E^=D<0|0}else if(m===k){var M=p[(h+1)%x],F=M[1];if(F<k){var D=orient(T,A,l);if(D===0)return 0;E^=D<0|0}}}else if(m===k){var N=Math.min(T[0],A[0]),B=Math.max(T[0],A[0]);if(h===0){for(;I>0;){var U=(I+x-1)%x,O=p[U];if(O[1]!==m)break;var V=O[0];N=Math.min(N,V),B=Math.max(B,V),I=U}if(I===0)return N<=g&&g<=B?0:1;S=I+1}for(var Z=p[(I+x-1)%x][1];h+1<S;){var O=p[h+1];if(O[1]!==m)break;var V=O[0];N=Math.min(N,V),B=Math.max(B,V),h+=1}if(N<=g&&g<=B)return 0;var W=p[(h+1)%x][1];g<N&&Z<m!=W<m&&(E^=1)}}return 2*E-1}var robustPointInPolygon$1=robustPnp;function feretDiameters(p={}){const{originalPoints:l=monotoneChainConvexHull.call(this)}=p;if(l.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(l.length===1)return{min:1,max:1,minLine:[l[0],l[0]],maxLine:[l[0],l[0]],aspectRatio:1};const g=new Array(l.length);let m=1/0,x=0,E=[];for(let T=0;T<l.length;T++){let A=getAngle(l[T],l[(T+1)%l.length]);rotate(-A,l,g);let k=0,P=[];for(let D=0;D<l.length;D++){let M=Math.abs(g[T][1]-g[D][1]);M>k&&(k=M,P=[],P.push([g[D][0],g[T][1]],[g[D][0],g[D][1]]))}k<m&&(m=k,x=A,E=P)}rotate(x,E,E);let S=0,h=[],I=0;for(let T=0;T<l.length-1;T++)for(let A=T+1;A<l.length;A++){let k=(l[T][0]-l[A][0])**2+(l[T][1]-l[A][1])**2;k>I&&(I=k,S=Math.sqrt(k),h=[l[T],l[A]])}return{min:m,minLine:E,max:S,maxLine:h,aspectRatio:m/S}}function getAngle(p,l){let g=difference(l,p),m=normalize(g),x=Math.acos(m[0]);return m[1]<0?-x:x}class Roi{constructor(l,g){this.map=l,this.id=g,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(l={}){const{scale:g=1,kind:m=""}=l;let x;switch(m){case"contour":x=this.contourMask;break;case"box":x=this.boxMask;break;case"filled":x=this.filledMask;break;case"center":x=this.centerMask;break;case"mbr":x=this.mbrFilledMask;break;case"hull":x=this.convexHullFilledMask;break;case"hullContour":x=this.convexHullMask;break;case"mbrContour":x=this.mbrMask;break;case"feret":x=this.feretMask;break;default:x=this.mask}return g<1&&(x=x.resize({factor:g}),x.parent=this.mask.parent,x.position[0]+=this.minX,x.position[1]+=this.minY),x}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let l=this.borderIDs,g=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let m=this.internalIDs;for(let x=0;x<l.length;x++)m.includes(l[x])||(this.computed.externalIDs.push(l[x]),this.computed.externalLengths.push(g[x]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let l=getBorders(this);this.computed.borderIDs=l.ids,this.computed.borderLengths=l.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let l=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let g=0;g<this.width;g++)for(let m=0;m<this.height;m++)this.map.data[g+this.minX+(m+this.minY)*this.map.width]===this.id&&(g>0&&g<this.width-1&&m>0&&m<this.height-1?(this.map.data[g-1+this.minX+(m+this.minY)*this.map.width]!==this.id||this.map.data[g+1+this.minX+(m+this.minY)*this.map.width]!==this.id||this.map.data[g+this.minX+(m-1+this.minY)*this.map.width]!==this.id||this.map.data[g+this.minX+(m+1+this.minY)*this.map.width]!==this.id)&&l.setBitXY(g,m):l.setBitXY(g,m));this.computed.contourMask=l}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let l=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let g=0;g<this.width;g++)l.setBitXY(g,0),l.setBitXY(g,this.height-1);for(let g=0;g<this.height;g++)l.setBitXY(0,g),l.setBitXY(this.width-1,g);this.computed.boxMask=l}return this.computed.boxMask}get mask(){if(!this.computed.mask){let l=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let g=0;g<this.width;g++)for(let m=0;m<this.height;m++)this.map.data[g+this.minX+(m+this.minY)*this.map.width]===this.id&&l.setBitXY(g,m);this.computed.mask=l}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let l=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let g=0;g<this.width;g++)for(let m=0;m<this.height;m++){let x=g+this.minX+(m+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[x])&&l.setBitXY(g,m)}this.computed.filledMask=l}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let l=new Shape({kind:"smallCross"}).getMask();l.parent=this.map.parent,l.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=l}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const l=[];for(let m=0;m<this.width;m++)for(let x=0;x<this.height;x++)this.map.data[m+this.minX+(x+this.minY)*this.map.width]===this.id&&(m>0&&m<this.width-1&&x>0&&x<this.height-1?(this.map.data[m-1+this.minX+(x+this.minY)*this.map.width]!==this.id||this.map.data[m+1+this.minX+(x+this.minY)*this.map.width]!==this.id||this.map.data[m+this.minX+(x-1+this.minY)*this.map.width]!==this.id||this.map.data[m+this.minX+(x+1+this.minY)*this.map.width]!==this.id)&&(l.push([m,x]),l.push([m+1,x]),l.push([m,x+1]),l.push([m+1,x+1])):(l.push([m,x]),l.push([m+1,x]),l.push([m,x+1]),l.push([m+1,x+1])));const g=monotoneChainConvexHull$1(l);this.computed.convexHull={polyline:g,surface:surface(g),perimeter:perimeter(g)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const l=this.convexHull,g=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});g.paintPolyline(l.polyline,{closed:!0}),this.computed.convexHullMask=g}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const l=this.convexHull,g=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let m=0;m<this.width;m++)for(let x=0;x<this.height;x++)robustPointInPolygon$1(l.polyline,[m,x])!==1&&g.setBitXY(m,x);this.computed.convexHullFilledMask=g}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let l=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(l.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:l};else{let g=l[0],m=l[1],x=l[2],E=Math.sqrt((g[0]-m[0])**2+(g[1]-m[1])**2),S=Math.sqrt((x[0]-m[0])**2+(x[1]-m[1])**2);this.computed.mbr={width:E,height:S,elongation:1-E/S,aspectRatio:E/S,surface:E*S,perimeter:(E+S)*2,rectangle:l}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let l=this.perimeterInfo,g=2-Math.sqrt(2);return l.one+l.two*2+l.three*3+l.four*4-g*(l.two+l.three*2+l.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const l=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});l.paintPolyline(this.feretDiameters.minLine),l.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=l}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let l=round(this.mbr.rectangle);if(l.length>0){const g=minMax(l),m=new Image$1(g[1][0]-g[0][0]+1,g[1][1]-g[0][1]+1,{kind:BINARY,position:[this.minX+g[0][0],this.minY+g[0][1]],parent:this.map.parent});l=moveToZeroZero(l),m.paintPolyline(l,{closed:!0}),this.computed.mbrMask=m}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const l=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),g=this.mask.minimalBoundingRectangle();for(let m=0;m<this.width;m++)for(let x=0;x<this.height;x++)robustPointInPolygon$1(g,[m,x])!==1&&l.setBitXY(m,x);this.computed.mbrFilledMask=l}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let l=[];for(let g=0;g<this.height;g++)for(let m=0;m<this.width;m++){let x=(g+this.minY)*this.map.width+m+this.minX;this.map.data[x]===this.id&&l.push([m,g])}this.computed.points=l}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let l=0,g;const m=this.points;for(let x=0;x<m.length;x++)for(let E=x+1;E<m.length;E++){let S=Math.pow(m[x][0]-m[E][0],2)+Math.pow(m[x][1]-m[E][1],2);S>=l&&(l=S,g=[m[x],m[E]])}this.computed.maxLengthPoints=g}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let l=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=l}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let l=this.maxLengthPoints,g=-Math.atan2(l[0][1]-l[1][1],l[0][0]-l[1][0])*180/Math.PI;this.computed.angle=g}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(p){let l=p.map,g=l.data,m=new Set,x=new Map,E=new Set,S=[1,0,-1,0],h=[0,1,0,-1];for(let A=p.minX;A<=p.maxX;A++)for(let k=p.minY;k<=p.maxY;k++){let P=A+k*l.width;if(g[P]===p.id)for(let D=0;D<4;D++){let M=A+S[D],F=k+h[D];if(M>=0&&F>=0&&M<l.width&&F<l.height){let N=M+F*l.width;if(g[N]!==p.id&&!E.has(N)){E.add(N),m.add(g[N]);let B=x.get(g[N]);B?x.set(g[N],++B):x.set(g[N],1)}}}}let I=Array.from(m),T=I.map(function(A){return x.get(A)});return{ids:I,lengths:T}}function getBoxIDs(p){let l=new Set,g=p.map,m=g.data;for(let x of[0,p.height-1])for(let E=0;E<p.width;E++){let S=(x+p.minY)*g.width+E+p.minX;if(E-p.minX>0&&m[S]===p.id&&m[S-1]!==p.id){let h=m[S-1];l.add(h)}if(g.width-E-p.minX>1&&m[S]===p.id&&m[S+1]!==p.id){let h=m[S+1];l.add(h)}}for(let x of[0,p.width-1])for(let E=0;E<p.height;E++){let S=(E+p.minY)*g.width+x+p.minX;if(E-p.minY>0&&m[S]===p.id&&m[S-g.width]!==p.id){let h=m[S-g.width];l.add(h)}if(g.height-E-p.minY>1&&m[S]===p.id&&m[S+g.width]!==p.id){let h=m[S+g.width];l.add(h)}}return Array.from(l)}function getBox(p){let l=0,g=p.map,m=g.data,x=[0];p.height>1&&(x[1]=p.height-1);for(let S of x)for(let h=1;h<p.width-1;h++){let I=(S+p.minY)*g.width+h+p.minX;m[I]===p.id&&l++}let E=[0];p.width>1&&(E[1]=p.width-1);for(let S of E)for(let h=0;h<p.height;h++){let I=(h+p.minY)*g.width+S+p.minX;m[I]===p.id&&l++}return l}function getBorder(p){let l=0,g=p.map,m=g.data;for(let x=1;x<p.width-1;x++)for(let E=1;E<p.height-1;E++){let S=(E+p.minY)*g.width+x+p.minX;m[S]===p.id&&(m[S-1]!==p.id||m[S+1]!==p.id||m[S-g.width]!==p.id||m[S+g.width]!==p.id)&&l++}return l+p.box}function getPerimeterInfo(p){let l=p.map,g=l.data,m=0,x=0,E=0,S=0;for(let h=0;h<p.width;h++)for(let I=0;I<p.height;I++){let T=(I+p.minY)*l.width+h+p.minX;if(g[T]===p.id){let A=0;switch((h===0||p.externalIDs.includes(g[T-1]))&&A++,(h===p.width-1||p.externalIDs.includes(g[T+1]))&&A++,(I===0||p.externalIDs.includes(g[T-l.width]))&&A++,(I===p.height-1||p.externalIDs.includes(g[T+l.width]))&&A++,A){case 1:m++;break;case 2:x++;break;case 3:E++;break;case 4:S++;break}}}return{one:m,two:x,three:E,four:S}}function getExternal(p){let l=0,g=p.map,m=g.data;for(let x=1;x<p.width-1;x++)for(let E=1;E<p.height-1;E++){let S=(E+p.minY)*g.width+x+p.minX;m[S]===p.id&&(p.externalIDs.includes(m[S-1])||p.externalIDs.includes(m[S+1])||p.externalIDs.includes(m[S-g.width])||p.externalIDs.includes(m[S+g.width]))&&l++}return l+p.box}function getHolesInfo(p){let l=0,g=p.map.width,m=p.map.data;for(let x=1;x<p.width-1;x++)for(let E=1;E<p.height-1;E++){let S=(E+p.minY)*g+x+p.minX;p.internalIDs.includes(m[S])&&m[S]!==p.id&&l++}return{number:p.internalIDs.length-1,surface:l}}function getInternalIDs(p){let l=[p.id],g=p.map,m=g.data;if(p.height>2)for(let E=0;E<p.width;E++){let S=p.minY*g.width+E+p.minX;if(l.includes(m[S])){let h=m[S+g.width];!l.includes(h)&&!p.boxIDs.includes(h)&&l.push(h)}}let x=new Array(4);for(let E=1;E<p.width-1;E++)for(let S=1;S<p.height-1;S++){let h=(S+p.minY)*g.width+E+p.minX;if(l.includes(m[h])){x[0]=m[h-1],x[1]=m[h+1],x[2]=m[h-g.width],x[3]=m[h+g.width];for(let I=0;I<4;I++){let T=x[I];!l.includes(T)&&!p.boxIDs.includes(T)&&l.push(T)}}}return l}class RoiLayer{constructor(l,g){this.roiMap=l,this.options=g,this.roi=this.createRoi()}createRoi(){let l=this.roiMap.data,g={};this.roiMap.positive=0,this.roiMap.negative=0;for(let h=0;h<l.length;h++)l[h]&&!g[l[h]]&&(g[l[h]]=!0,l[h]>0?this.roiMap.positive++:this.roiMap.negative++);let m={};for(let h in g)m[h]=new Roi(this.roiMap,h*1);let x=this.roiMap.width,E=this.roiMap.height;for(let h=0;h<E;h++)for(let I=0;I<x;I++){let T=h*x+I;if(l[T]!==0){const A=l[T],k=m[A];I<k.minX&&(k.minX=I),I>k.maxX&&(k.maxX=I),h<k.minY&&(k.minY=h),h>k.maxY&&(k.maxY=h),k.meanX+=I,k.meanY+=h,k.surface++}}let S=[];for(let h in g)m[h].meanX/=m[h].surface,m[h].meanY/=m[h].surface,S.push(m[h]);return S}}function commonBorderLength(p){let l=p.data,g=[1,0,-1,0],m=[0,1,0,-1],x=p.minMax,E=-x.min,S=x.max+E,h=[];for(let T=0;T<=S;T++)h.push(Object.create(null));for(let T=0;T<p.width;T++)for(let A=0;A<p.height;A++){let k=T+A*p.width,P=l[k];if(P!==0){let D=Object.create(null),M=!1;for(let F=0;F<4;F++){let N=T+g[F],B=A+m[F];if(N>=0&&B>=0&&N<p.width&&B<p.height){let U=l[N+B*p.width];P!==U&&(M=!0,U!==0&&D[U]===void 0&&(D[U]=!0,h[U+E][P]?h[U+E][P]++:h[U+E][P]=1))}else M=!0}M&&(h[P+E][P]?h[P+E][P]++:h[P+E][P]=1)}}let I={};for(let T=0;T<h.length;T++)Object.keys(h[T]).length>0&&(I[T-E]=h[T]);return I}function mergeRoi(p={}){const{algorithm:l="commonBorderLength",minCommonBorderLength:g=5,maxCommonBorderLength:m=100,minCommonBorderRatio:x=.3,maxCommonBorderRatio:E=1}=p;let S=function(N,B,U){return N[U]>=g&&N[U]<=m};typeof l=="function"&&(S=l),l.toLowerCase()==="commonborderratio"&&(S=function(N,B,U){let O=Math.min(N[U]/N[B],1);return O>=x&&O<=E});const h=this,I=h.commonBorderLength;let T={},A={};for(let N of Object.keys(I)){let B=I[N],U=Object.keys(B);for(let O of U)if(O!==N&&S(B,N,O)){let V=O;A[O]&&(V=A[O]);let Z=N;if(A[N]&&(Z=A[N]),Number(V)!==Z){let W=Math.min(V,Z),Y=Math.max(V,Z);if(T[W]||(T[W]={}),T[W][Y]=!0,A[Y]=W,T[Y]){for(let X of Object.keys(T[Y]))T[W][X]=!0,A[X]=W;delete T[Y]}}}}let k=h.minMax,P=-k.min,D=k.max+P,M=new Array(D+1).fill(0);for(let N of Object.keys(A))M[Number(N)+P]=A[N];let F=h.data;for(let N=0;N<F.length;N++){let B=F[N];if(B!==0){let U=M[B+P];U!==0&&(F[N]=U)}}return h.computed={},h}class RoiMap{constructor(l,g){this.parent=l,this.width=l.width,this.height=l.height,this.data=g,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let l=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;for(let m=0;m<this.data.length;m++)this.data[m]<l&&(l=this.data[m]),this.data[m]>g&&(g=this.data[m]);return{min:l,max:g}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(l={}){return mergeRoi.call(this,l)}mergeRois(l){const g=l[0],m=l.slice(1);for(let x=0;x<this.data.length;x++)m.includes(this.data[x])&&(this.data[x]=g)}rowsInfo(){let l=new Array(this.height),g=0;for(let m=0;m<this.data.length;m+=this.width){let x={row:g,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};l[g++]=x;let E={},S={},h=[],I=this.data[m],T=0;for(let A=m;A<m+this.width;A++){let k=this.data[A];I!==k&&(I=k,h.push(T),T=0),T++,k>0?(x.positivePixel++,E[k]||(E[k]=!0)):k<0?(x.negativePixel++,S[k]||(S[k]=!0)):x.zeroPixel++}h.push(T),x.medianChange=h.sort((A,k)=>A-k)[Math.floor(h.length/2)],x.positiveRoiIDs=Object.keys(E),x.negativeRoiIDs=Object.keys(S),x.positiveRoi=x.positiveRoiIDs.length,x.negativeRoi=x.negativeRoiIDs.length}return l}colsInfo(){let l=new Array(this.width),g=0;for(let m=0;m<this.width;m++){let x={col:g,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};l[g++]=x;let E={},S={},h=[],I=this.data[m],T=0;for(let A=m;A<m+this.data.length;A+=this.width){let k=this.data[A];I!==k&&(I=k,h.push(T),T=0),T++,k>0?(x.positivePixel++,E[k]||(E[k]=!0)):k<0?(x.negativePixel++,S[k]||(S[k]=!0)):x.zeroPixel++}h.push(T),x.medianChange=h.sort((A,k)=>A-k)[Math.floor(h.length/2)],x.positiveRoiIDs=Object.keys(E),x.negativeRoiIDs=Object.keys(S),x.positiveRoi=x.positiveRoiIDs.length,x.negativeRoi=x.negativeRoiIDs.length}return l}}function fromMask(p,l={}){const{allowCorners:g=!1}=l,m=65535;let x=new Int16Array(p.size),E=0,S=0,h=new Uint16Array(m+1),I=new Uint16Array(m+1);for(let A=0;A<p.width;A++)for(let k=0;k<p.height;k++)x[k*p.width+A]===0&&T(A,k);function T(A,k){let P=0,D=0,M=p.getBitXY(A,k),F=M?++E:--S;if(E>32767||S<-32768)throw new Error("Too many regions of interest");for(h[0]=A,I[0]=k;P<=D;){let N=h[P&m],B=I[P&m];if(x[B*p.width+N]=F,N>0&&x[B*p.width+N-1]===0&&p.getBitXY(N-1,B)===M&&(D++,h[D&m]=N-1,I[D&m]=B,x[B*p.width+N-1]=-32768),B>0&&x[(B-1)*p.width+N]===0&&p.getBitXY(N,B-1)===M&&(D++,h[D&m]=N,I[D&m]=B-1,x[(B-1)*p.width+N]=-32768),N<p.width-1&&x[B*p.width+N+1]===0&&p.getBitXY(N+1,B)===M&&(D++,h[D&m]=N+1,I[D&m]=B,x[B*p.width+N+1]=-32768),B<p.height-1&&x[(B+1)*p.width+N]===0&&p.getBitXY(N,B+1)===M&&(D++,h[D&m]=N,I[D&m]=B+1,x[(B+1)*p.width+N]=-32768),g&&(N>0&&B>0&&x[(B-1)*p.width+N-1]===0&&p.getBitXY(N-1,B-1)===M&&(D++,h[D&m]=N-1,I[D&m]=B-1,x[(B-1)*p.width+N-1]=-32768),N<p.width-1&&B>0&&x[(B-1)*p.width+N+1]===0&&p.getBitXY(N+1,B-1)===M&&(D++,h[D&m]=N+1,I[D&m]=B-1,x[(B-1)*p.width+N+1]=-32768),N>0&&B<p.height-1&&x[(B+1)*p.width+N-1]===0&&p.getBitXY(N-1,B+1)===M&&(D++,h[D&m]=N-1,I[D&m]=B+1,x[(B+1)*p.width+N-1]=-32768),N<p.width-1&&B<p.height-1&&x[(B+1)*p.width+N+1]===0&&p.getBitXY(N+1,B+1)===M&&(D++,h[D&m]=N+1,I[D&m]=B+1,x[(B+1)*p.width+N+1]=-32768)),P++,D-P>m)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(p,x)}class DisjointSet{constructor(){this.nodes=new Map}add(l){var g=this.nodes.get(l);return g||(g=new DisjointSetNode(l),this.nodes.set(l,g)),g}union(l,g){const m=this.find(l),x=this.find(g);m!==x&&(m.rank<x.rank?m.parent=x:m.rank>x.rank?x.parent=m:(x.parent=m,m.rank++))}find(l){for(var g=l;g.parent!==null;)g=g.parent;for(var m=l;m.parent!==null;){var x=m;m=m.parent,x.parent=g}return g}connected(l,g){return this.find(l)===this.find(g)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(p){this.value=p,this.parent=null,this.rank=0}var DisjointSet$1=DisjointSet_1;const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(p,l={}){const{allowCorners:g=!1}=l;let m=4;g&&(m=8);let x,E,S;if(m===8)x=direction8X,E=direction8Y,S=neighbours8;else if(m===4)x=direction4X,E=direction4Y,S=neighbours4;else throw new RangeError(`unsupported neighbours count: ${m}`);const h=p.size,I=p.width,T=p.height,A=new Array(h),k=new Uint32Array(h),P=new DisjointSet$1;let D=1;for(let M=0;M<T;M++)for(let F=0;F<I;F++){const N=F+M*I;if(p.getBit(N)){let B=null;for(let U=0;U<S.length;U++){const O=F+x[U],V=M+E[U];if(O>=0&&V>=0&&O<I&&V<T){const Z=O+V*I;let W=A[Z];W?(S[U]=W,(!B||S[U].value<B.value)&&(B=S[U])):S[U]=null}}if(!B)A[N]=P.add(D++);else{A[N]=B;for(let U=0;U<S.length;U++)S[U]&&S[U]!==B&&P.union(B,S[U])}}}for(let M=0;M<T;M++)for(let F=0;F<I;F++){const N=F+M*I;p.getBit(N)&&(k[N]=P.find(A[N]).value)}return new RoiMap(p,k)}function fromMaxima(p={}){let{allowCorner:l=!0,onlyTop:g=!1,invert:m=!1}=p,x=this;x.checkProcessable("fromMaxima",{components:[1]});const E=1,S=2;let h=0,I=0,T=new Int16Array(x.size),A=new Int8Array(x.size),k=new Float32Array(x.size),P=1048575,D=new Uint16Array(P+1),M=new Uint16Array(P+1),F=0,N=0,B=new Uint16Array(P+1),U=new Uint16Array(P+1),O=0,V=0;for(Z(x);F<N;){let X=D[F&P],J=M[F&P];Y(X,J,S),F++}return new RoiMap(x,T);function Z({maxima:X=!0}){for(let J=1;J<x.height-1;J++)for(let q=1;q<x.width-1;q++){let te=q+J*x.width;if(A[te]===0){let ne=X?x.data[te]:-x.data[q+J*x.width];if(x.data[J*x.width+q-1]>ne||x.data[J*x.width+q+1]>ne||x.data[(J-1)*x.width+q]>ne||x.data[(J+1)*x.width+q]>ne||l&&(x.data[(J-1)*x.width+q-1]>ne||x.data[(J-1)*x.width+q+1]>ne||x.data[(J+1)*x.width+q-1]>ne||x.data[(J+1)*x.width+q+1]>ne))continue;T[te]=X?++h:--I,W(q,J)||(X?--h:++I)}}}function W(X,J){let q=N;O=0,V=1,B[0]=X,U[0]=J;let te=!0;for(;O<V;){let ne=B[O&P],de=U[O&P];te&=Y(ne,de,E),O++}if(!te){for(let ne=0;ne<V;ne++){let de=B[ne&P],we=U[ne&P]*x.width+de;T[we]=0}N=q}return te}function Y(X,J,q){let te=T[J*x.width+X],ne=x.data[J*x.width+X];for(let de=J-1;de<=J+1;de++)for(let oe=X-1;oe<=X+1;oe++){let we=de*x.width+oe;if(A[we]===0)switch(A[we]=1,k[we]=x.data[we]-ne,q){case E:if(k[we]===0){if(oe===0||de===0||oe===x.width-1||de===x.height-1)return!1;T[we]=te,B[V&P]=oe,U[V&P]=de,V++}else{if(k[we]>0)return!1;g||(T[we]=te,D[N&P]=oe,M[N&P]=de,N++)}break;case S:k[we]<=0&&(T[we]=te,D[N&P]=oe,M[N&P]=de,N++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(p,l={}){let g=new Shape(l),m=new Int16Array(this.size),x=0,E=g.getPoints();for(let S=0;S<p.length;S++){x++;let h=p[S][0],I=p[S][1];for(let T=0;T<E.length;T++){let A=E[T][0],k=E[T][1];h+A>=0&&I+k>=0&&h+A<this.width&&I+k<this.height&&(m[h+A+(I+k)*this.width]=x)}}return new RoiMap(this,m)}var priorityQueue={exports:{}};(function(p,l){(function(g){p.exports=g()})(function(){return function g(m,x,E){function S(T,A){if(!x[T]){if(!m[T]){var k=typeof commonjsRequire=="function"&&commonjsRequire;if(!A&&k)return k(T,!0);if(h)return h(T,!0);var P=new Error("Cannot find module '"+T+"'");throw P.code="MODULE_NOT_FOUND",P}var D=x[T]={exports:{}};m[T][0].call(D.exports,function(M){var F=m[T][1][M];return S(F||M)},D,D.exports,g,m,x,E)}return x[T].exports}for(var h=typeof commonjsRequire=="function"&&commonjsRequire,I=0;I<E.length;I++)S(E[I]);return S}({1:[function(g,m,x){var E,S,h,I,T,A=function(P,D){for(var M in D)k.call(D,M)&&(P[M]=D[M]);function F(){this.constructor=P}return F.prototype=D.prototype,P.prototype=new F,P.__super__=D.prototype,P},k={}.hasOwnProperty;E=g("./PriorityQueue/AbstractPriorityQueue"),S=g("./PriorityQueue/ArrayStrategy"),I=g("./PriorityQueue/BinaryHeapStrategy"),h=g("./PriorityQueue/BHeapStrategy"),T=function(P){A(D,P);function D(M){M||(M={}),M.strategy||(M.strategy=I),M.comparator||(M.comparator=function(F,N){return(F||0)-(N||0)}),D.__super__.constructor.call(this,M)}return D}(E),T.ArrayStrategy=S,T.BinaryHeapStrategy=I,T.BHeapStrategy=h,m.exports=T},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(g,m,x){m.exports=function(){function E(S){var h;if((S!=null?S.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((S!=null?S.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new S.strategy(S),this.length=(S!=null&&(h=S.initialValues)!=null?h.length:void 0)||0}return E.prototype.queue=function(S){this.length++,this.priv.queue(S)},E.prototype.dequeue=function(S){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},E.prototype.peek=function(S){if(!this.length)throw"Empty queue";return this.priv.peek()},E.prototype.clear=function(){return this.length=0,this.priv.clear()},E}()},{}],3:[function(g,m,x){var E;E=function(S,h,I){var T,A,k;for(A=0,T=S.length;A<T;)k=A+T>>>1,I(S[k],h)>=0?A=k+1:T=k;return A},m.exports=function(){function S(h){var I;this.options=h,this.comparator=this.options.comparator,this.data=((I=this.options.initialValues)!=null?I.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return S.prototype.queue=function(h){var I;I=E(this.data,h,this.comparator),this.data.splice(I,0,h)},S.prototype.dequeue=function(){return this.data.pop()},S.prototype.peek=function(){return this.data[this.data.length-1]},S.prototype.clear=function(){this.data.length=0},S}()},{}],4:[function(g,m,x){m.exports=function(){function E(S){var h,I,T,A,k,P,D,M;for(this.comparator=(S!=null?S.comparator:void 0)||function(F,N){return F-N},this.pageSize=(S!=null?S.pageSize:void 0)||512,this.length=0,D=0;1<<D<this.pageSize;)D+=1;if(1<<D!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=D,this._emptyMemoryPageTemplate=h=[],I=0,k=this.pageSize;0<=k?I<k:I>k;0<=k?++I:--I)h.push(null);if(this._memory=[],this._mask=this.pageSize-1,S.initialValues)for(P=S.initialValues,T=0,A=P.length;T<A;T++)M=P[T],this.queue(M)}return E.prototype.queue=function(S){this.length+=1,this._write(this.length,S),this._bubbleUp(this.length,S)},E.prototype.dequeue=function(){var S,h;return S=this._read(1),h=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,h),this._bubbleDown(1,h)),S},E.prototype.peek=function(){return this._read(1)},E.prototype.clear=function(){this.length=0,this._memory.length=0},E.prototype._write=function(S,h){var I;for(I=S>>this._shift;I>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[I][S&this._mask]=h},E.prototype._read=function(S){return this._memory[S>>this._shift][S&this._mask]},E.prototype._bubbleUp=function(S,h){var I,T,A,k;for(I=this.comparator;S>1&&(T=S&this._mask,S<this.pageSize||T>3?A=S&~this._mask|T>>1:T<2?(A=S-this.pageSize>>this._shift,A+=A&~(this._mask>>1),A|=this.pageSize>>1):A=S-2,k=this._read(A),!(I(k,h)<0));)this._write(A,h),this._write(S,k),S=A},E.prototype._bubbleDown=function(S,h){var I,T,A,k,P;for(P=this.comparator;S<this.length;)if(S>this._mask&&!(S&this._mask-1)?I=T=S+2:S&this.pageSize>>1?(I=(S&~this._mask)>>1,I|=S&this._mask>>1,I=I+1<<this._shift,T=I+1):(I=S+(S&this._mask),T=I+1),I!==T&&T<=this.length)if(A=this._read(I),k=this._read(T),P(A,h)<0&&P(A,k)<=0)this._write(I,h),this._write(S,A),S=I;else if(P(k,h)<0)this._write(T,h),this._write(S,k),S=T;else break;else if(I<=this.length)if(A=this._read(I),P(A,h)<0)this._write(I,h),this._write(S,A),S=I;else break;else break},E}()},{}],5:[function(g,m,x){m.exports=function(){function E(S){var h;this.comparator=(S!=null?S.comparator:void 0)||function(I,T){return I-T},this.length=0,this.data=((h=S.initialValues)!=null?h.slice(0):void 0)||[],this._heapify()}return E.prototype._heapify=function(){var S,h,I;if(this.data.length>0)for(S=h=1,I=this.data.length;1<=I?h<I:h>I;S=1<=I?++h:--h)this._bubbleUp(S)},E.prototype.queue=function(S){this.data.push(S),this._bubbleUp(this.data.length-1)},E.prototype.dequeue=function(){var S,h;return h=this.data[0],S=this.data.pop(),this.data.length>0&&(this.data[0]=S,this._bubbleDown(0)),h},E.prototype.peek=function(){return this.data[0]},E.prototype.clear=function(){this.length=0,this.data.length=0},E.prototype._bubbleUp=function(S){for(var h,I;S>0&&(h=S-1>>>1,this.comparator(this.data[S],this.data[h])<0);)I=this.data[h],this.data[h]=this.data[S],this.data[S]=I,S=h},E.prototype._bubbleDown=function(S){var h,I,T,A,k;for(h=this.data.length-1;I=(S<<1)+1,A=I+1,T=S,I<=h&&this.comparator(this.data[I],this.data[T])<0&&(T=I),A<=h&&this.comparator(this.data[A],this.data[T])<0&&(T=A),T!==S;)k=this.data[T],this.data[T]=this.data[S],this.data[S]=k,S=T},E}()},{}]},{},[1])(1)})})(priorityQueue);var PriorityQueue=priorityQueue.exports;const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(p={}){let{points:l,mask:g,image:m,fillMaxValue:x=this.maxValue,invert:E=!1}=p,S=m||this;S.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),E=!E,l||(l=S.getLocalMaxima({invert:E,mask:g}));let h=E?0:1,I=new Int16Array(S.size),T=S.width,A=S.height,k=new PriorityQueue({comparator:(P,D)=>P[2]-D[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let P=0;P<l.length;P++){let D=l[P][0]+l[P][1]*T;I[D]=P+1;let M=S.data[D];(E&&M<=x||!E&&M>=x)&&k.queue([l[P][0],l[P][1],M])}for(;k.length>0;){let P=k.dequeue(),D=P[0]+P[1]*T;for(let M=0;M<4;M++){let F=P[0]+dxs[M],N=P[1]+dys[M];if(F>=0&&N>=0&&F<T&&N<A){let B=F+N*T;if(!g||g.getBit(B)===h){let U=S.data[B];(E&&U<=x||!E&&U>=x)&&I[B]===0&&(I[B]=I[D],k.queue([P[0]+dxs[M],P[1]+dys[M],U]))}}}}return new RoiMap(S,I)}class RoiManager{constructor(l,g={}){this._image=l,this._options=g,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(l={}){let g=Object.assign({},this._options,l),m=fromMaxima.call(this._image,l);this._layers[g.label]=new RoiLayer(m,g)}fromPoints(l,g={}){let m=Object.assign({},this._options,g),x=fromPoints.call(this._image,l,g);return this._layers[m.label]=new RoiLayer(x,m),this}putMap(l,g={}){let m=new RoiMap(this._image,l),x=Object.assign({},this._options,g);return this._layers[x.label]=new RoiLayer(m,x),this}fromWaterShed(l={}){let g=Object.assign({},this._options,l),m=fromWaterShed.call(this._image,l);this._layers[g.label]=new RoiLayer(m,g)}fromMask(l,g={}){let m=Object.assign({},this._options,g),x=fromMask.call(this._image,l,g);return this._layers[m.label]=new RoiLayer(x,m),this}fromMaskConnectedComponentLabelingAlgorithm(l,g={}){let m=Object.assign({},this._options,g),x=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,l,g);return this._layers[m.label]=new RoiLayer(x,m),this}getMap(l={}){let g=Object.assign({},this._options,l);return this._assertLayerWithLabel(g.label),this._layers[g.label].roiMap}rowsInfo(l={}){return this.getMap(l).rowsInfo()}colsInfo(l={}){return this.getMap(l).rowsInfo()}getRoiIds(l={}){let g=this.getRois(l);if(g){let m=new Array(g.length);for(let x=0;x<g.length;x++)m[x]=g[x].id;return m}throw new Error("ROIs not found")}getRois(l={}){let{label:g=this._options.label,positive:m=!0,negative:x=!0,minSurface:E=0,maxSurface:S=Number.POSITIVE_INFINITY,minWidth:h=0,maxWidth:I=Number.POSITIVE_INFINITY,minHeight:T=0,maxHeight:A=Number.POSITIVE_INFINITY,minRatio:k=0,maxRatio:P=Number.POSITIVE_INFINITY}=l;if(!this._layers[g])throw new Error(`this Roi layer (${g}) does not exist`);const D=this._layers[g].roi,M=[];for(const F of D)(F.id<0&&x||F.id>0&&m)&&F.surface>=E&&F.surface<=S&&F.width>=h&&F.width<=I&&F.height>=T&&F.height<=A&&F.ratio>=k&&F.ratio<=P&&M.push(F);return M}getRoi(l,g={}){const{label:m=this._options.label}=g;if(!this._layers[m])throw new Error(`this Roi layer (${m}) does not exist`);const x=this._layers[m].roi.find(E=>E.id===l);if(!x)throw new Error(`found no Roi with id ${l}`);return x}getMasks(l={}){let g=this.getRois(l),m=new Array(g.length);for(let x=0;x<g.length;x++)m[x]=g[x].getMask(l);return m}getAnalysisMasks(l={}){const{analysisProperty:g}=l;let m=`${g}Mask`,x=this.getRois(l);return x.length===0||!x[0][m]?[]:x.map(E=>E[m])}getData(l={}){let g=Object.assign({},this._options,l);return this._assertLayerWithLabel(g.label),this._layers[g.label].roiMap.data}paint(l={}){let{labelProperty:g,analysisProperty:m}=l;this._painted||(this._painted=this._image.rgba8());let x=this.getMasks(l);if(g){const E=this.getRois(l);l.labels=E.map(T=>deepValue(T,g));const S=Math.max(...l.labels);let h=!1,I=!1;if(g.includes("surface")?h=!0:/(?:perimeter|min|max|external|width|height|length)/.test(g)&&(I=!0),isFinite(S)){let T="";if(l.unit!=="pixel"&&l.pixelSize&&(I||h)){T=h?`${l.unit}^2`:l.unit;let A=h?"m^2":"m",k=h?l.pixelSize**2:l.pixelSize;const P=Qty.swiftConverter(A,T);l.labels=l.labels.map(D=>P(k*D))}S>50?l.labels=l.labels.map(A=>Math.round(A)+T):S>10?l.labels=l.labels.map(A=>A.toFixed(1)+T):l.labels=l.labels.map(A=>A.toFixed(2)+T)}l.labelsPosition=E.map(T=>[T.meanX,T.meanY])}if(this._painted.paintMasks(x,l),m){let E=this.getAnalysisMasks(l);this._painted.paintMasks(E,{color:l.analysisColor,alpha:l.analysisAlpha})}return this._painted}getMask(l={}){let g=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),m=this.getMasks(l);for(let x=0;x<m.length;x++){let E=m[x];for(let S=0;S<E.width;S++)for(let h=0;h<E.height;h++)E.getBitXY(S,h)&&g.setBitXY(S+E.position[0],h+E.position[1])}return g}resetPainted(l={}){const{image:g}=l;g?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(l={}){const g=this.getMap(l);return g.mergeRoi(l),this.putMap(g.data,l),this}mergeRois(l,g={}){if(!Array.isArray(l)||l.some(x=>!Number.isInteger(x)))throw new Error("Roi ids must be an array of integers");if(l.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(l).size!==l.length)throw new Error("Roi ids must be all different");l.forEach(x=>this.getRoi(x));const m=this.getMap(g);return m.mergeRois(l),this.putMap(m.data,g),this}findCorrespondingRoi(l,g={}){let m=this.getRois(g),x=[];for(let E=0;E<m.length;E++){let S=m[E],h=S.minX,I=S.minY,T=S.points,A=Math.sign(S.id),k=correspondingRoisInformation(h,I,T,l,A);x.push(k)}return x}_assertLayerWithLabel(l){if(!this._layers[l])throw new Error(`no layer with label ${l}`)}}function correspondingRoisInformation(p,l,g,m,x){let E={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let S=0;S<g.length;S++){let h=g[S],I=h[0],T=h[1],A=I+p+(T+l)*m.width,k=m.data[A];(k>0||k<0)&&(E.id.includes(k)?E.surface[E.id.indexOf(k)]+=1:(E.id.push(k),E.surface.push(1)))}for(let S=0;S<E.id.length;S++)Math.sign(E.id[S])===x?E.same+=E.surface[S]:E.opposite+=E.surface[S],E.roiSurfaceCovered[S]=E.surface[S]/g.length;return E.total=E.opposite+E.same,E}const objectToString$1=Object.prototype.toString;class Image$1{constructor(l,g,m,x){if(arguments.length===1?(x=l,{width:l,height:g,data:m}=x):m&&!m.length&&(x=m,{data:m}=x),l===void 0&&(l=1),g===void 0&&(g=1),x===void 0&&(x={}),typeof x!="object"||x===null)throw new TypeError("options must be an object");if(!Number.isInteger(l)||l<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(g)||g<=0)throw new RangeError("height must be a positive integer");const{kind:E=RGBA}=x;if(typeof E!="string")throw new TypeError("kind must be a string");const S=getKind(E),h=Object.assign({},x);for(const F in S)h[F]===void 0&&(h[F]=S[F]);verifyKindDefinition(h);const{components:I,bitDepth:T,colorModel:A}=h,k=h.alpha+0,P=l*g,D=I+k,M=T===32?Number.MAX_VALUE:2**T-1;if(m===void 0)m=createPixelArray(P,I,k,D,T,M);else{const F=getTheoreticalPixelArraySize(P,D,T);if(m.length!==F)throw new RangeError(`incorrect data size: ${m.length}. Should be ${F}`)}this.width=l,this.height=g,this.data=m,this.size=P,this.components=I,this.alpha=k,this.bitDepth=T,this.maxValue=M,this.colorModel=A,this.channels=D,this.meta=x.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:x.parent||null}),this.position=x.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(l){return objectToString$1.call(l)==="[object IJSImage]"}static fromCanvas(l){const m=l.getContext("2d").getImageData(0,0,l.width,l.height);return new Image$1(m.width,m.height,m.data)}static createFrom(l,g){const m=getImageParameters(l);return Object.assign(m,{parent:l,position:[0,0]},g),new Image$1(m)}getRoiManager(l){return new RoiManager(this,l)}clone(){const l=this.data.slice();return new Image$1(this.width,this.height,l,this)}apply(l){for(let g=0;g<this.height;g++)for(let m=0;m<this.width;m++){let x=(g*this.width+m)*this.channels;l.call(this,x)}}}setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$4(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function p(){this._listeners={}}p.prototype.on=function(g,m){if(this._listeners[g])throw new RangeError("there is already a listener for "+g);if(typeof m!="function")throw new TypeError("callback argument must be a function");this._listeners[g]=m},p.prototype._send=function(g,m,x){x===void 0?x=[]:Array.isArray(x)||(x=[x]),self.postMessage({id:g,data:m},x)},p.prototype._trigger=function(g,m){if(!this._listeners[g])throw new Error("event "+g+" is not defined");this._listeners[g].apply(null,m)};var l=new p;self.onmessage=function(g){switch(g.data.action){case"exec":g.data.args.unshift(function(m,x){l._send(g.data.id,m,x)}),l._trigger(g.data.event,g.data.args);break;case"ping":l._send(g.data.id,"pong");break;default:throw new Error("unexpected action: "+g.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function p(l,g){var m=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(g)+`);
`,"(",l,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(m)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(p,l){if(typeof p!="string"&&typeof p!="function")throw new TypeError("func argument must be a function");if(l===void 0&&(l={}),typeof l!="object"||l===null)throw new TypeError("options argument must be an object");this._workerCode=p.toString(),l.maxWorkers===void 0||l.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):l.maxWorkers>0?this._numWorkers=Math.min(l.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=l.timeout||0,this._terminateOnError=!!l.terminateOnError;var g=l.deps;typeof g=="string"&&(g=[g]),Array.isArray(g)||(g=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(g)}WorkerManager.prototype._init=function(p){for(var l=workerTemplate.newWorkerURL(this._workerCode,p),g=0;g<this._numWorkers;g++){var m=new Worker(l);m.onmessage=this._onmessage.bind(this,m),m.onerror=this._onerror.bind(this,m),m.running=!1,m.id=g,this._workers.set(m,null)}URL.revokeObjectURL(l)};WorkerManager.prototype._onerror=function(p,l){if(!this._terminated){this._working--,p.running=!1;var g=this._workers.get(p);g&&g[1](l.message),this._workers.set(p,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(p,l){if(!this._terminated){this._working--,p.running=!1;var g=this._workers.get(p);g&&g[0](l.data.data),this._workers.set(p,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var p of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!p.running)for(var l=0;l<this._waiting.length;l++){var g=this._waiting[l];if(!(typeof g[4]=="number"&&g[4]!==p.id)){this._waiting.splice(l,1),p.postMessage({action:"exec",event:g[0],args:g[1]},g[2]),p.running=!0,p.time=Date.now(),this._workers.set(p,g[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var p of this._workers)p[0].terminate(),p[1]&&p[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(p,l){if(this._terminated)throw new Error("Cannot post (terminated)");var g=[];for(var m of this._workers.keys())g.push(this.post(p,l,[],m.id));return Promise.all(g)};WorkerManager.prototype.post=function(p,l,g,m){l===void 0&&(l=[]),g===void 0&&(g=[]),Array.isArray(l)||(l=[l]),Array.isArray(g)||(g=[g]);var x=this;return new Promise(function(E,S){if(x._terminated)throw new Error("Cannot post (terminated)");x._waiting.push([p,l,g,[E,S],m]),x._exec()})};var src=WorkerManager;const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(p,l,g){l=Object.assign({},defaultOptions,l);const m=this.manager;return Array.isArray(p)?Promise.all(p.map(function(x){const E=runOnce(m,x,l);return typeof g=="function"&&E.then(g),E})):runOnce(m,p,l)}function runOnce(p,l,g){return p.post("data",[l,g]).then(function(m){for(let x in m)m[x]=new Image$1(m[x]);return m})}function work(){worker.on("data",function(p,l,g){l=new IJS(l);const m={},x=[],E=l.grey(),S=E.sobelFilter();D("sobel",S);const h=S.level().mask({threshold:g.threshold});D("mask",h);const I=S.getRoiManager();I.fromMask(h);const T=I.getMask(g.roi);D("realMask",T);const A=E.getPixelsGrid({sampling:g.sampling,mask:T}),k=l.getBackground(A.xyS,A.zS,g.regression);D("background",k);const P=l.subtract(k);m.result=P,x.push(P.data.buffer),p(m,x);function D(M,F){g.include.includes(M)&&(m[M]=F,x.push(F.data.buffer))}})}const background={run,work};function extend$3(p){p.extendMethod("background",background)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(l){if(typeof l!="string")throw new TypeError("worker URL must be a string");this._url=l,this._deps[0]=l}static extendMethod(l,g){let m,x,E={};function S(...h){return m||(this.checkUrl(),x=this.url,m=new src(g.work,{deps:x}),E.manager=m),g.run.call(E,...h)}S.reset=function(){m&&(m.terminate(),m=new src(g.work,{deps:x}),E.manager=m)},Worker$1.prototype[l]=S}}extend$3(Worker$1);new Worker$1;function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(p=>p[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(p=>p)}async function verifyPermission(p,l){const g={};return l&&(g.writable=!0,g.mode="readwrite"),await p.queryPermission(g)==="granted"||await p.requestPermission(g)==="granted"}async function writeFileToDisk(p,l,g){let x=await(await p.getFileHandle(l,{create:!0})).createWritable();await x.write(g),await x.close()}async function fileExists(p,l){try{return await p.getFileHandle(l),!0}catch(g){if(g.name==="NotFoundError")return!1;if(g.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}function getHeightFromRgb(p,l,g,m){if(m===1)return-1e4+(p*256*256+l*256+g)*.1;if(m===2)return 22662+(p*256*256+l*256+g)*.1}async function getHeightArrayStats(p){let l=[],g={};g.minElevation=Number.MAX_VALUE,g.maxElevation=Number.MIN_VALUE,g.height=p.height,g.width=p.width;let m=p.getPixelsArray();for(const x of m){let E=x[0],S=x[1],h=x[2],I=getHeightFromRgb(E,S,h,1),T=getHeightFromRgb(E,S,h,2);I>g.maxElevation&&(g.maxElevation=I),I<g.minElevation&&(g.minElevation=I),l.push(T)}return{decodedHeightArray:l,stats:g}}async function createHeightMapImage(p,l,g){let m=await getHeightArrayStats(p),x=await convertImage(m.stats.width,m.stats.height,m.decodedHeightArray,l,g);return m.image=x,m}async function loadImageFromArray(p){return await Image$1.load(p)}async function convertImage(p,l,g,m,x){return new Image$1(p,l,g,{kind:x,bitDepth:m})}async function getMapboxTerrainRgb(p,l,g){let m,x=await fileExists(p,l.rgbFileName),E;return x===!1?m=await downloadTerrainRgb(g):m=await readFileFromDisk(p,l.rgbFileName),E=await loadImageFromArray(m),E}async function downloadTerrainRgb(p){return(await fetch(p)).arrayBuffer()}async function readFileFromDisk(p,l){return await(await(await p.getFileHandle(l)).getFile()).arrayBuffer()}var fileUtils={getDirHandle,verifyPermission,createHeightMapImage,convertImage,writeFileToDisk,getMapboxTerrainRgb,fileExists,getFileHandle,loadImageFromArray},mapboxGl={exports:{}};(function(p,l){(function(g,m){p.exports=m()})(commonjsGlobal,function(){var g,m,x;function E(h,I){if(!g)g=I;else if(!m)m=I;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",A={};g(A),x=I(A),typeof window!="undefined"&&(x.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}E(["exports"],function(h){var I="2.6.1",T=A;function A(b,d,w,C){this.cx=3*b,this.bx=3*(w-b)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(C-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=b,this.p1y=C,this.p2x=w,this.p2y=C}A.prototype.sampleCurveX=function(b){return((this.ax*b+this.bx)*b+this.cx)*b},A.prototype.sampleCurveY=function(b){return((this.ay*b+this.by)*b+this.cy)*b},A.prototype.sampleCurveDerivativeX=function(b){return(3*this.ax*b+2*this.bx)*b+this.cx},A.prototype.solveCurveX=function(b,d){var w,C,z,j,H;for(d===void 0&&(d=1e-6),z=b,H=0;H<8;H++){if(j=this.sampleCurveX(z)-b,Math.abs(j)<d)return z;var ee=this.sampleCurveDerivativeX(z);if(Math.abs(ee)<1e-6)break;z-=j/ee}if((z=b)<(w=0))return w;if(z>(C=1))return C;for(;w<C;){if(j=this.sampleCurveX(z),Math.abs(j-b)<d)return z;b>j?w=z:C=z,z=.5*(C-w)+w}return z},A.prototype.solve=function(b,d){return this.sampleCurveY(this.solveCurveX(b,d))};var k=P;function P(b,d){this.x=b,this.y=d}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,d){return this.clone()._rotateAround(b,d)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var d=b.x-this.x,w=b.y-this.y;return d*d+w*w},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,d){return Math.atan2(this.x*d-this.y*b,this.x*b+this.y*d)},_matMult:function(b){var d=b[2]*this.x+b[3]*this.y;return this.x=b[0]*this.x+b[1]*this.y,this.y=d,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var d=Math.cos(b),w=Math.sin(b),C=w*this.x+d*this.y;return this.x=d*this.x-w*this.y,this.y=C,this},_rotateAround:function(b,d){var w=Math.cos(b),C=Math.sin(b),z=d.y+C*(this.x-d.x)+w*(this.y-d.y);return this.x=d.x+w*(this.x-d.x)-C*(this.y-d.y),this.y=z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(b){return b instanceof P?b:Array.isArray(b)?new P(b[0],b[1]):b};var D=typeof self!="undefined"?self:{};const M=Math.pow(2,53)-1,F=Math.PI/180,N=180/Math.PI;function B(b){return b*F}function U(b){return b*N}const O=[[0,0],[1,0],[1,1],[0,1]];function V(b){if(b<=0)return 0;if(b>=1)return 1;const d=b*b,w=d*b;return 4*(b<.5?w:3*(b-d)+w-.75)}function Z(b,d,w,C){const z=new T(b,d,w,C);return function(j){return z.solve(j)}}const W=Z(.25,.1,.25,1);function Y(b,d,w){return Math.min(w,Math.max(d,b))}function X(b,d,w){const C=w-d,z=((b-d)%C+C)%C+d;return z===d?w:z}function J(b,d,w){if(!b.length)return w(null,[]);let C=b.length;const z=new Array(b.length);let j=null;b.forEach((H,ee)=>{d(H,(ae,he)=>{ae&&(j=ae),z[ee]=he,--C==0&&w(j,z)})})}function q(b){const d=[];for(const w in b)d.push(b[w]);return d}function te(b,...d){for(const w of d)for(const C in w)b[C]=w[C];return b}let ne=1;function de(){return ne++}function oe(){return function b(d){return d?(d^16*Math.random()>>d/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,b)}()}function we(b){return b<=1?1:Math.pow(2,Math.ceil(Math.log(b)/Math.LN2))}function Ae(b){return!!b&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(b)}function ye(b,d){b.forEach(w=>{d[w]&&(d[w]=d[w].bind(d))})}function me(b,d){return b.indexOf(d,b.length-d.length)!==-1}function xe(b,d,w){const C={};for(const z in b)C[z]=d.call(w||this,b[z],z,b);return C}function Le(b,d,w){const C={};for(const z in b)d.call(w||this,b[z],z,b)&&(C[z]=b[z]);return C}function Ze(b){return Array.isArray(b)?b.map(Ze):typeof b=="object"&&b?xe(b,Ze):b}const Xe={};function je(b){Xe[b]||(typeof console!="undefined"&&console.warn(b),Xe[b]=!0)}function Ie(b,d,w){return(w.y-b.y)*(d.x-b.x)>(d.y-b.y)*(w.x-b.x)}function Pe(b){let d=0;for(let w,C,z=0,j=b.length,H=j-1;z<j;H=z++)w=b[z],C=b[H],d+=(C.x-w.x)*(w.y+C.y);return d}function De(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ze(b){const d={};if(b.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(w,C,z,j)=>{const H=z||j;return d[C]=!H||H.toLowerCase(),""}),d["max-age"]){const w=parseInt(d["max-age"],10);isNaN(w)?delete d["max-age"]:d["max-age"]=w}return d}let it,tt,ot,lt=null;function St(b){if(lt==null){const d=b.navigator?b.navigator.userAgent:null;lt=!!b.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return lt}function et(b){try{const d=D[b];return d.setItem("_mapbox_test_",1),d.removeItem("_mapbox_test_"),!0}catch{return!1}}const Je={now:()=>ot!==void 0?ot:D.performance.now(),setNow(b){ot=b},restoreNow(){ot=void 0},frame(b){const d=D.requestAnimationFrame(b);return{cancel:()=>D.cancelAnimationFrame(d)}},getImageData(b,d=0){const w=D.document.createElement("canvas"),C=w.getContext("2d");if(!C)throw new Error("failed to create canvas 2d context");return w.width=b.width,w.height=b.height,C.drawImage(b,0,0,b.width,b.height),C.getImageData(-d,-d,b.width+2*d,b.height+2*d)},resolveURL:b=>(it||(it=D.document.createElement("a")),it.href=b,it.href),get devicePixelRatio(){return D.devicePixelRatio},get prefersReducedMotion(){return!!D.matchMedia&&(tt==null&&(tt=D.matchMedia("(prefers-reduced-motion: reduce)")),tt.matches)}};let Be;const Ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Be==null){const b=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Be={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):b}catch{Be=b}}return Be},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},He={supported:!1,testSupport:function(b){!pe&&_e&&(fe?ue(b):ve=b)}};let ve,_e,pe=!1,fe=!1;function ue(b){const d=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,_e),b.isContextLost())return;He.supported=!0}catch{}b.deleteTexture(d),pe=!0}D.document&&(_e=D.document.createElement("img"),_e.onload=function(){ve&&ue(ve),ve=null,fe=!0},_e.onerror=function(){pe=!0,ve=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ce="01",Ee="NO_ACCESS_TOKEN";function Ye(b){return b.indexOf("mapbox:")===0}function ft(b){return Ge.API_URL_REGEX.test(b)}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function It(b){const d=b.match(_t);if(!d)throw new Error("Unable to parse URL object");return{protocol:d[1],authority:d[2],path:d[3]||"/",params:d[4]?d[4].split("&"):[]}}function $t(b){const d=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${d}`}function Yt(b){if(!b)return null;const d=b.split(".");if(!d||d.length!==3)return null;try{return JSON.parse(decodeURIComponent(D.atob(d[1]).split("").map(w=>"%"+("00"+w.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ii{constructor(d){this.type=d,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(d){const w=Yt(Ge.ACCESS_TOKEN);let C="";return C=w&&w.u?D.btoa(encodeURIComponent(w.u).replace(/%([0-9A-F]{2})/g,(z,j)=>String.fromCharCode(Number("0x"+j)))):Ge.ACCESS_TOKEN||"",d?`mapbox.eventData.${d}:${C}`:`mapbox.eventData:${C}`}fetchEventData(){const d=et("localStorage"),w=this.getStorageKey(),C=this.getStorageKey("uuid");if(d)try{const z=D.localStorage.getItem(w);z&&(this.eventData=JSON.parse(z));const j=D.localStorage.getItem(C);j&&(this.anonId=j)}catch{je("Unable to read from LocalStorage")}}saveEventData(){const d=et("localStorage"),w=this.getStorageKey(),C=this.getStorageKey("uuid");if(d)try{D.localStorage.setItem(C,this.anonId),Object.keys(this.eventData).length>=1&&D.localStorage.setItem(w,JSON.stringify(this.eventData))}catch{je("Unable to write to LocalStorage")}}processRequests(d){}postEvent(d,w,C,z){if(!Ge.EVENTS_URL)return;const j=It(Ge.EVENTS_URL);j.params.push(`access_token=${z||Ge.ACCESS_TOKEN||""}`);const H={event:this.type,created:new Date(d).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:ce,userId:this.anonId},ee=w?te(H,w):H,ae={url:$t(j),headers:{"Content-Type":"text/plain"},body:JSON.stringify([ee])};this.pendingRequest=Ne(ae,he=>{this.pendingRequest=null,C(he),this.saveEventData(),this.processRequests(z)})}queueRequest(d,w){this.queue.push(d),this.processRequests(w)}}const zt=new class extends ii{constructor(b){super("appUserTurnstile"),this._customAccessToken=b}postTurnstileEvent(b,d){Ge.EVENTS_URL&&Ge.ACCESS_TOKEN&&Array.isArray(b)&&b.some(w=>Ye(w)||ft(w))&&this.queueRequest(Date.now(),d)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const d=Yt(Ge.ACCESS_TOKEN),w=d?d.u:Ge.ACCESS_TOKEN;let C=w!==this.eventData.tokenU;Ae(this.anonId)||(this.anonId=oe(),C=!0);const z=this.queue.shift();if(this.eventData.lastSuccess){const j=new Date(this.eventData.lastSuccess),H=new Date(z),ee=(z-this.eventData.lastSuccess)/864e5;C=C||ee>=1||ee<-1||j.getDate()!==H.getDate()}else C=!0;if(!C)return this.processRequests();this.postEvent(z,{"enabled.telemetry":!1},j=>{j||(this.eventData.lastSuccess=z,this.eventData.tokenU=w)},b)}},qt=zt.postTurnstileEvent.bind(zt),Vt=new class extends ii{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(b,d,w,C){this.skuToken=d,this.errorCb=C,Ge.EVENTS_URL&&(w||Ge.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},w):this.errorCb(new Error(Ee)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:w}=this.queue.shift();d&&this.success[d]||(this.anonId||this.fetchEventData(),Ae(this.anonId)||(this.anonId=oe()),this.postEvent(w,{skuToken:this.skuToken},C=>{C?this.errorCb(C):d&&(this.success[d]=!0)},b))}},fi=Vt.postMapLoadEvent.bind(Vt),hi=new class extends ii{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(b,d,w,C){if(!Ge.API_URL||!Ge.SESSION_PATH)return;const z=It(Ge.API_URL+Ge.SESSION_PATH);z.params.push(`sku=${d||""}`),z.params.push(`access_token=${C||Ge.ACCESS_TOKEN||""}`);const j={url:$t(z),headers:{"Content-Type":"text/plain"}};this.pendingRequest=We(j,H=>{this.pendingRequest=null,w(H),this.saveEventData(),this.processRequests(C)})}getSessionAPI(b,d,w,C){this.skuToken=d,this.errorCb=C,Ge.SESSION_PATH&&Ge.API_URL&&(w||Ge.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},w):this.errorCb(new Error(Ee)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:w}=this.queue.shift();d&&this.success[d]||this.getSession(w,this.skuToken,C=>{C?this.errorCb(C):d&&(this.success[d]=!0)},b)}},Me=hi.getSessionAPI.bind(hi),bt=new Set,At="mapbox-tiles";let Bt,pt,Rt=500,Ve=50;function jt(){D.caches&&!Bt&&(Bt=D.caches.open(At))}function mi(b){const d=b.indexOf("?");return d<0?b:b.slice(0,d)}let ie=1/0;const ke={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ke);class Ke extends Error{constructor(d,w,C){w===401&&ft(C)&&(d+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(d),this.status=w,this.url=C}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const re=De()?()=>self.worker&&self.worker.referrer:()=>(D.location.protocol==="blob:"?D.parent:D).location.href,le=function(b,d){if(!(/^file:/.test(w=b.url)||/^file:/.test(re())&&!/^\w+:/.test(w))){if(D.fetch&&D.Request&&D.AbortController&&D.Request.prototype.hasOwnProperty("signal"))return function(C,z){const j=new D.AbortController,H=new D.Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,referrer:re(),signal:j.signal});let ee=!1,ae=!1;const he=(be=H.url).indexOf("sku=")>0&&ft(be);var be;C.type==="json"&&H.headers.set("Accept","application/json");const Te=($e,qe,rt)=>{if(ae)return;if($e&&$e.message!=="SecurityError"&&je($e),qe&&rt)return Re(qe);const dt=Date.now();D.fetch(H).then(yt=>{if(yt.ok){const Mt=he?yt.clone():null;return Re(yt,Mt,dt)}return z(new Ke(yt.statusText,yt.status,C.url))}).catch(yt=>{yt.code!==20&&z(new Error(yt.message))})},Re=($e,qe,rt)=>{(C.type==="arrayBuffer"?$e.arrayBuffer():C.type==="json"?$e.json():$e.text()).then(dt=>{ae||(qe&&rt&&function(yt,Mt,Pt){if(jt(),!Bt)return;const Ot={status:Mt.status,statusText:Mt.statusText,headers:new D.Headers};Mt.headers.forEach((Ft,ei)=>Ot.headers.set(ei,Ft));const Lt=ze(Mt.headers.get("Cache-Control")||"");Lt["no-store"]||(Lt["max-age"]&&Ot.headers.set("Expires",new Date(Pt+1e3*Lt["max-age"]).toUTCString()),new Date(Ot.headers.get("Expires")).getTime()-Pt<42e4||function(Ft,ei){if(pt===void 0)try{new Response(new ReadableStream),pt=!0}catch{pt=!1}pt?ei(Ft.body):Ft.blob().then(ei)}(Mt,Ft=>{const ei=new D.Response(Ft,Ot);jt(),Bt&&Bt.then(Xt=>Xt.put(mi(yt.url),ei)).catch(Xt=>je(Xt.message))}))}(H,qe,rt),ee=!0,z(null,dt,$e.headers.get("Cache-Control"),$e.headers.get("Expires")))}).catch(dt=>{ae||z(new Error(dt.message))})};return he?function($e,qe){if(jt(),!Bt)return qe(null);const rt=mi($e.url);Bt.then(dt=>{dt.match(rt).then(yt=>{const Mt=function(Pt){if(!Pt)return!1;const Ot=new Date(Pt.headers.get("Expires")||0),Lt=ze(Pt.headers.get("Cache-Control")||"");return Ot>Date.now()&&!Lt["no-cache"]}(yt);dt.delete(rt),Mt&&dt.put(rt,yt.clone()),qe(null,yt,Mt)}).catch(qe)}).catch(qe)}(H,Te):Te(null,null),{cancel:()=>{ae=!0,ee||j.abort()}}}(b,d);if(De()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",b,d,void 0,!0)}var w;return function(C,z){const j=new D.XMLHttpRequest;j.open(C.method||"GET",C.url,!0),C.type==="arrayBuffer"&&(j.responseType="arraybuffer");for(const H in C.headers)j.setRequestHeader(H,C.headers[H]);return C.type==="json"&&(j.responseType="text",j.setRequestHeader("Accept","application/json")),j.withCredentials=C.credentials==="include",j.onerror=()=>{z(new Error(j.statusText))},j.onload=()=>{if((j.status>=200&&j.status<300||j.status===0)&&j.response!==null){let H=j.response;if(C.type==="json")try{H=JSON.parse(j.response)}catch(ee){return z(ee)}z(null,H,j.getResponseHeader("Cache-Control"),j.getResponseHeader("Expires"))}else z(new Ke(j.statusText,j.status,C.url))},j.send(C.body),{cancel:()=>j.abort()}}(b,d)},Se=function(b,d){return le(te(b,{type:"arrayBuffer"}),d)},Ne=function(b,d){return le(te(b,{method:"POST"}),d)},We=function(b,d){return le(te(b,{method:"GET"}),d)};function nt(b){const d=D.document.createElement("a");return d.href=b,d.protocol===D.document.location.protocol&&d.host===D.document.location.host}const vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Dt,wt;Dt=[],wt=0;const Tt=function(b,d){if(He.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),wt>=Ge.MAX_PARALLEL_IMAGE_REQUESTS){const j={requestParameters:b,callback:d,cancelled:!1,cancel(){this.cancelled=!0}};return Dt.push(j),j}wt++;let w=!1;const C=()=>{if(!w)for(w=!0,wt--;Dt.length&&wt<Ge.MAX_PARALLEL_IMAGE_REQUESTS;){const j=Dt.shift(),{requestParameters:H,callback:ee,cancelled:ae}=j;ae||(j.cancel=Tt(H,ee).cancel)}},z=Se(b,(j,H,ee,ae)=>{C(),j?d(j):H&&(D.createImageBitmap?function(he,be){const Te=new D.Blob([new Uint8Array(he)],{type:"image/png"});D.createImageBitmap(Te).then(Re=>{be(null,Re)}).catch(Re=>{be(new Error(`Could not load image because of ${Re.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(H,(he,be)=>d(he,be,ee,ae)):function(he,be){const Te=new D.Image,Re=D.URL;Te.onload=()=>{be(null,Te),Re.revokeObjectURL(Te.src),Te.onload=null,D.requestAnimationFrame(()=>{Te.src=vt})},Te.onerror=()=>be(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $e=new D.Blob([new Uint8Array(he)],{type:"image/png"});Te.src=he.byteLength?Re.createObjectURL($e):vt}(H,(he,be)=>d(he,be,ee,ae)))});return{cancel:()=>{z.cancel(),C()}}};function Nt(b,d,w){w[b]&&w[b].indexOf(d)!==-1||(w[b]=w[b]||[],w[b].push(d))}function ri(b,d,w){if(w&&w[b]){const C=w[b].indexOf(d);C!==-1&&w[b].splice(C,1)}}class Ht{constructor(d,w={}){te(this,w),this.type=d}}class _i extends Ht{constructor(d,w={}){super("error",te({error:d},w))}}class ai{on(d,w){return this._listeners=this._listeners||{},Nt(d,w,this._listeners),this}off(d,w){return ri(d,w,this._listeners),ri(d,w,this._oneTimeListeners),this}once(d,w){return w?(this._oneTimeListeners=this._oneTimeListeners||{},Nt(d,w,this._oneTimeListeners),this):new Promise(C=>this.once(d,C))}fire(d,w){typeof d=="string"&&(d=new Ht(d,w||{}));const C=d.type;if(this.listens(C)){d.target=this;const z=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const ee of z)ee.call(this,d);const j=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const ee of j)ri(C,ee,this._oneTimeListeners),ee.call(this,d);const H=this._eventedParent;H&&(te(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),H.fire(d))}else d instanceof _i&&console.error(d.error);return this}listens(d){return!!(this._listeners&&this._listeners[d]&&this._listeners[d].length>0||this._oneTimeListeners&&this._oneTimeListeners[d]&&this._oneTimeListeners[d].length>0||this._eventedParent&&this._eventedParent.listens(d))}setEventedParent(d,w){return this._eventedParent=d,this._eventedParentData=w,this}}var Ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ut{constructor(d,w,C,z){this.message=(d?`${d}: `:"")+C,z&&(this.identifier=z),w!=null&&w.__line__&&(this.line=w.__line__)}}function Mi(b){const d=b.value;return d?[new Ut(b.key,d,"constants have been deprecated as of v8")]:[]}function ki(b,...d){for(const w of d)for(const C in w)b[C]=w[C];return b}function Si(b){return b instanceof Number||b instanceof String||b instanceof Boolean?b.valueOf():b}function Bi(b){if(Array.isArray(b))return b.map(Bi);if(b instanceof Object&&!(b instanceof Number||b instanceof String||b instanceof Boolean)){const d={};for(const w in b)d[w]=Bi(b[w]);return d}return Si(b)}class zi extends Error{constructor(d,w){super(w),this.message=w,this.key=d}}class un{constructor(d,w=[]){this.parent=d,this.bindings={};for(const[C,z]of w)this.bindings[C]=z}concat(d){return new un(this,d)}get(d){if(this.bindings[d])return this.bindings[d];if(this.parent)return this.parent.get(d);throw new Error(`${d} not found in scope.`)}has(d){return!!this.bindings[d]||!!this.parent&&this.parent.has(d)}}const Gr={kind:"null"},gi={kind:"number"},Fi={kind:"string"},Oi={kind:"boolean"},ar={kind:"color"},Nn={kind:"object"},Ni={kind:"value"},no={kind:"collator"},ea={kind:"formatted"},ta={kind:"resolvedImage"};function Vr(b,d){return{kind:"array",itemType:b,N:d}}function sr(b){if(b.kind==="array"){const d=sr(b.itemType);return typeof b.N=="number"?`array<${d}, ${b.N}>`:b.itemType.kind==="value"?"array":`array<${d}>`}return b.kind}const cl=[Gr,gi,Fi,Oi,ar,ea,Nn,Vr(Ni),ta];function bn(b,d){if(d.kind==="error")return null;if(b.kind==="array"){if(d.kind==="array"&&(d.N===0&&d.itemType.kind==="value"||!bn(b.itemType,d.itemType))&&(typeof b.N!="number"||b.N===d.N))return null}else{if(b.kind===d.kind)return null;if(b.kind==="value"){for(const w of cl)if(!bn(w,d))return null}}return`Expected ${sr(b)} but found ${sr(d)} instead.`}function ls(b,d){return d.some(w=>w.kind===b.kind)}function en(b,d){return d.some(w=>w==="null"?b===null:w==="array"?Array.isArray(b):w==="object"?b&&!Array.isArray(b)&&typeof b=="object":w===typeof b)}function ao(b){var d={exports:{}};return b(d,d.exports),d.exports}var tn=ao(function(b,d){var w={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function C(ee){return(ee=Math.round(ee))<0?0:ee>255?255:ee}function z(ee){return C(ee[ee.length-1]==="%"?parseFloat(ee)/100*255:parseInt(ee))}function j(ee){return(ae=ee[ee.length-1]==="%"?parseFloat(ee)/100:parseFloat(ee))<0?0:ae>1?1:ae;var ae}function H(ee,ae,he){return he<0?he+=1:he>1&&(he-=1),6*he<1?ee+(ae-ee)*he*6:2*he<1?ae:3*he<2?ee+(ae-ee)*(2/3-he)*6:ee}try{d.parseCSSColor=function(ee){var ae,he=ee.replace(/ /g,"").toLowerCase();if(he in w)return w[he].slice();if(he[0]==="#")return he.length===4?(ae=parseInt(he.substr(1),16))>=0&&ae<=4095?[(3840&ae)>>4|(3840&ae)>>8,240&ae|(240&ae)>>4,15&ae|(15&ae)<<4,1]:null:he.length===7&&(ae=parseInt(he.substr(1),16))>=0&&ae<=16777215?[(16711680&ae)>>16,(65280&ae)>>8,255&ae,1]:null;var be=he.indexOf("("),Te=he.indexOf(")");if(be!==-1&&Te+1===he.length){var Re=he.substr(0,be),$e=he.substr(be+1,Te-(be+1)).split(","),qe=1;switch(Re){case"rgba":if($e.length!==4)return null;qe=j($e.pop());case"rgb":return $e.length!==3?null:[z($e[0]),z($e[1]),z($e[2]),qe];case"hsla":if($e.length!==4)return null;qe=j($e.pop());case"hsl":if($e.length!==3)return null;var rt=(parseFloat($e[0])%360+360)%360/360,dt=j($e[1]),yt=j($e[2]),Mt=yt<=.5?yt*(dt+1):yt+dt-yt*dt,Pt=2*yt-Mt;return[C(255*H(Pt,Mt,rt+1/3)),C(255*H(Pt,Mt,rt)),C(255*H(Pt,Mt,rt-1/3)),qe];default:return null}}return null}}catch{}});class Gi{constructor(d,w,C,z=1){this.r=d,this.g=w,this.b=C,this.a=z}static parse(d){if(!d)return;if(d instanceof Gi)return d;if(typeof d!="string")return;const w=tn.parseCSSColor(d);return w?new Gi(w[0]/255*w[3],w[1]/255*w[3],w[2]/255*w[3],w[3]):void 0}toString(){const[d,w,C,z]=this.toArray();return`rgba(${Math.round(d)},${Math.round(w)},${Math.round(C)},${z})`}toArray(){const{r:d,g:w,b:C,a:z}=this;return z===0?[0,0,0,0]:[255*d/z,255*w/z,255*C/z,z]}}Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1),Gi.blue=new Gi(0,0,1,1);class oo{constructor(d,w,C){this.sensitivity=d?w?"variant":"case":w?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(d,w){return this.collator.compare(d,w)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Un{constructor(d,w,C,z,j){this.text=d,this.image=w,this.scale=C,this.fontStack=z,this.textColor=j}}class kr{constructor(d){this.sections=d}static fromString(d){return new kr([new Un(d,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(d=>d.text.length!==0||d.image&&d.image.name.length!==0)}static factory(d){return d instanceof kr?d:kr.fromString(d)}toString(){return this.sections.length===0?"":this.sections.map(d=>d.text).join("")}serialize(){const d=["format"];for(const w of this.sections){if(w.image){d.push(["image",w.image.name]);continue}d.push(w.text);const C={};w.fontStack&&(C["text-font"]=["literal",w.fontStack.split(",")]),w.scale&&(C["font-scale"]=w.scale),w.textColor&&(C["text-color"]=["rgba"].concat(w.textColor.toArray())),d.push(C)}return d}}class Xr{constructor(d){this.name=d.name,this.available=d.available}toString(){return this.name}static fromString(d){return d?new Xr({name:d,available:!1}):null}serialize(){return["image",this.name]}}function fl(b,d,w,C){return typeof b=="number"&&b>=0&&b<=255&&typeof d=="number"&&d>=0&&d<=255&&typeof w=="number"&&w>=0&&w<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[b,d,w,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[b,d,w,C]:[b,d,w]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function so(b){if(b===null||typeof b=="string"||typeof b=="boolean"||typeof b=="number"||b instanceof Gi||b instanceof oo||b instanceof kr||b instanceof Xr)return!0;if(Array.isArray(b)){for(const d of b)if(!so(d))return!1;return!0}if(typeof b=="object"){for(const d in b)if(!so(b[d]))return!1;return!0}return!1}function fr(b){if(b===null)return Gr;if(typeof b=="string")return Fi;if(typeof b=="boolean")return Oi;if(typeof b=="number")return gi;if(b instanceof Gi)return ar;if(b instanceof oo)return no;if(b instanceof kr)return ea;if(b instanceof Xr)return ta;if(Array.isArray(b)){const d=b.length;let w;for(const C of b){const z=fr(C);if(w){if(w===z)continue;w=Ni;break}w=z}return Vr(w||Ni,d)}return Nn}function $n(b){const d=typeof b;return b===null?"":d==="string"||d==="number"||d==="boolean"?String(b):b instanceof Gi||b instanceof kr||b instanceof Xr?b.toString():JSON.stringify(b)}class jn{constructor(d,w){this.type=d,this.value=w}static parse(d,w){if(d.length!==2)return w.error(`'literal' expression requires exactly one argument, but found ${d.length-1} instead.`);if(!so(d[1]))return w.error("invalid value");const C=d[1];let z=fr(C);const j=w.expectedType;return z.kind!=="array"||z.N!==0||!j||j.kind!=="array"||typeof j.N=="number"&&j.N!==0||(z=j),new jn(z,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof kr?this.value.serialize():this.value}}class mr{constructor(d){this.name="ExpressionEvaluationError",this.message=d}toJSON(){return this.message}}const hs={string:Fi,number:gi,boolean:Oi,object:Nn};class rn{constructor(d,w){this.type=d,this.args=w}static parse(d,w){if(d.length<2)return w.error("Expected at least one argument.");let C,z=1;const j=d[0];if(j==="array"){let ee,ae;if(d.length>2){const he=d[1];if(typeof he!="string"||!(he in hs)||he==="object")return w.error('The item type argument of "array" must be one of string, number, boolean',1);ee=hs[he],z++}else ee=Ni;if(d.length>3){if(d[2]!==null&&(typeof d[2]!="number"||d[2]<0||d[2]!==Math.floor(d[2])))return w.error('The length argument to "array" must be a positive integer literal',2);ae=d[2],z++}C=Vr(ee,ae)}else C=hs[j];const H=[];for(;z<d.length;z++){const ee=w.parse(d[z],z,Ni);if(!ee)return null;H.push(ee)}return new rn(C,H)}evaluate(d){for(let w=0;w<this.args.length;w++){const C=this.args[w].evaluate(d);if(!bn(this.type,fr(C)))return C;if(w===this.args.length-1)throw new mr(`Expected value to be of type ${sr(this.type)}, but found ${sr(fr(C))} instead.`)}return null}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}serialize(){const d=this.type,w=[d.kind];if(d.kind==="array"){const C=d.itemType;if(C.kind==="string"||C.kind==="number"||C.kind==="boolean"){w.push(C.kind);const z=d.N;(typeof z=="number"||this.args.length>1)&&w.push(z)}}return w.concat(this.args.map(C=>C.serialize()))}}class Ia{constructor(d){this.type=ea,this.sections=d}static parse(d,w){if(d.length<2)return w.error("Expected at least one argument.");const C=d[1];if(!Array.isArray(C)&&typeof C=="object")return w.error("First argument must be an image or text section.");const z=[];let j=!1;for(let H=1;H<=d.length-1;++H){const ee=d[H];if(j&&typeof ee=="object"&&!Array.isArray(ee)){j=!1;let ae=null;if(ee["font-scale"]&&(ae=w.parse(ee["font-scale"],1,gi),!ae))return null;let he=null;if(ee["text-font"]&&(he=w.parse(ee["text-font"],1,Vr(Fi)),!he))return null;let be=null;if(ee["text-color"]&&(be=w.parse(ee["text-color"],1,ar),!be))return null;const Te=z[z.length-1];Te.scale=ae,Te.font=he,Te.textColor=be}else{const ae=w.parse(d[H],1,Ni);if(!ae)return null;const he=ae.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return w.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");j=!0,z.push({content:ae,scale:null,font:null,textColor:null})}}return new Ia(z)}evaluate(d){return new kr(this.sections.map(w=>{const C=w.content.evaluate(d);return fr(C)===ta?new Un("",C,null,null,null):new Un($n(C),null,w.scale?w.scale.evaluate(d):null,w.font?w.font.evaluate(d).join(","):null,w.textColor?w.textColor.evaluate(d):null)}))}eachChild(d){for(const w of this.sections)d(w.content),w.scale&&d(w.scale),w.font&&d(w.font),w.textColor&&d(w.textColor)}outputDefined(){return!1}serialize(){const d=["format"];for(const w of this.sections){d.push(w.content.serialize());const C={};w.scale&&(C["font-scale"]=w.scale.serialize()),w.font&&(C["text-font"]=w.font.serialize()),w.textColor&&(C["text-color"]=w.textColor.serialize()),d.push(C)}return d}}class lo{constructor(d){this.type=ta,this.input=d}static parse(d,w){if(d.length!==2)return w.error("Expected two arguments.");const C=w.parse(d[1],1,Fi);return C?new lo(C):w.error("No image name provided.")}evaluate(d){const w=this.input.evaluate(d),C=Xr.fromString(w);return C&&d.availableImages&&(C.available=d.availableImages.indexOf(w)>-1),C}eachChild(d){d(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Bh={"to-boolean":Oi,"to-color":ar,"to-number":gi,"to-string":Fi};class wn{constructor(d,w){this.type=d,this.args=w}static parse(d,w){if(d.length<2)return w.error("Expected at least one argument.");const C=d[0];if((C==="to-boolean"||C==="to-string")&&d.length!==2)return w.error("Expected one argument.");const z=Bh[C],j=[];for(let H=1;H<d.length;H++){const ee=w.parse(d[H],H,Ni);if(!ee)return null;j.push(ee)}return new wn(z,j)}evaluate(d){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(d));if(this.type.kind==="color"){let w,C;for(const z of this.args){if(w=z.evaluate(d),C=null,w instanceof Gi)return w;if(typeof w=="string"){const j=d.parseColor(w);if(j)return j}else if(Array.isArray(w)&&(C=w.length<3||w.length>4?`Invalid rbga value ${JSON.stringify(w)}: expected an array containing either three or four numeric values.`:fl(w[0],w[1],w[2],w[3]),!C))return new Gi(w[0]/255,w[1]/255,w[2]/255,w[3])}throw new mr(C||`Could not parse color from value '${typeof w=="string"?w:String(JSON.stringify(w))}'`)}if(this.type.kind==="number"){let w=null;for(const C of this.args){if(w=C.evaluate(d),w===null)return 0;const z=Number(w);if(!isNaN(z))return z}throw new mr(`Could not convert ${JSON.stringify(w)} to number.`)}return this.type.kind==="formatted"?kr.fromString($n(this.args[0].evaluate(d))):this.type.kind==="resolvedImage"?Xr.fromString($n(this.args[0].evaluate(d))):$n(this.args[0].evaluate(d))}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ia([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new lo(this.args[0]).serialize();const d=[`to-${this.type.kind}`];return this.eachChild(w=>{d.push(w.serialize())}),d}}const Oh=["Unknown","Point","LineString","Polygon"];class us{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Oh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const d=this.featureDistanceData.center,w=this.featureDistanceData.scale,{x:C,y:z}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(C*w-d[0])+this.featureDistanceData.bearing[1]*(z*w-d[1])}return 0}parseColor(d){let w=this._parseColorCache[d];return w||(w=this._parseColorCache[d]=Gi.parse(d)),w}}class Dr{constructor(d,w,C,z){this.name=d,this.type=w,this._evaluate=C,this.args=z}evaluate(d){return this._evaluate(d,this.args)}eachChild(d){this.args.forEach(d)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(d=>d.serialize()))}static parse(d,w){const C=d[0],z=Dr.definitions[C];if(!z)return w.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const j=Array.isArray(z)?z[0]:z.type,H=Array.isArray(z)?[[z[1],z[2]]]:z.overloads,ee=H.filter(([he])=>!Array.isArray(he)||he.length===d.length-1);let ae=null;for(const[he,be]of ee){ae=new go(w.registry,w.path,null,w.scope);const Te=[];let Re=!1;for(let $e=1;$e<d.length;$e++){const qe=d[$e],rt=Array.isArray(he)?he[$e-1]:he.type,dt=ae.parse(qe,1+Te.length,rt);if(!dt){Re=!0;break}Te.push(dt)}if(!Re)if(Array.isArray(he)&&he.length!==Te.length)ae.error(`Expected ${he.length} arguments, but found ${Te.length} instead.`);else{for(let $e=0;$e<Te.length;$e++){const qe=Array.isArray(he)?he[$e]:he.type,rt=Te[$e];ae.concat($e+1).checkSubtype(qe,rt.type)}if(ae.errors.length===0)return new Dr(C,j,be,Te)}}if(ee.length===1)w.errors.push(...ae.errors);else{const he=(ee.length?ee:H).map(([Te])=>{return Re=Te,Array.isArray(Re)?`(${Re.map(sr).join(", ")})`:`(${sr(Re.type)}...)`;var Re}).join(" | "),be=[];for(let Te=1;Te<d.length;Te++){const Re=w.parse(d[Te],1+be.length);if(!Re)return null;be.push(sr(Re.type))}w.error(`Expected arguments of type ${he}, but found (${be.join(", ")}) instead.`)}return null}static register(d,w){Dr.definitions=w;for(const C in w)d[C]=Dr}}class ho{constructor(d,w,C){this.type=no,this.locale=C,this.caseSensitive=d,this.diacriticSensitive=w}static parse(d,w){if(d.length!==2)return w.error("Expected one argument.");const C=d[1];if(typeof C!="object"||Array.isArray(C))return w.error("Collator options argument must be an object.");const z=w.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Oi);if(!z)return null;const j=w.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Oi);if(!j)return null;let H=null;return C.locale&&(H=w.parse(C.locale,1,Fi),!H)?null:new ho(z,j,H)}evaluate(d){return new oo(this.caseSensitive.evaluate(d),this.diacriticSensitive.evaluate(d),this.locale?this.locale.evaluate(d):null)}eachChild(d){d(this.caseSensitive),d(this.diacriticSensitive),this.locale&&d(this.locale)}outputDefined(){return!1}serialize(){const d={};return d["case-sensitive"]=this.caseSensitive.serialize(),d["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(d.locale=this.locale.serialize()),["collator",d]}}const En=8192;function cs(b,d){b[0]=Math.min(b[0],d[0]),b[1]=Math.min(b[1],d[1]),b[2]=Math.max(b[2],d[0]),b[3]=Math.max(b[3],d[1])}function uo(b,d){return!(b[0]<=d[0]||b[2]>=d[2]||b[1]<=d[1]||b[3]>=d[3])}function Fh(b,d){const w=(180+b[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b[1]*Math.PI/360)))/360,z=Math.pow(2,d.z);return[Math.round(w*z*En),Math.round(C*z*En)]}function zh(b,d,w){const C=b[0]-d[0],z=b[1]-d[1],j=b[0]-w[0],H=b[1]-w[1];return C*H-j*z==0&&C*j<=0&&z*H<=0}function co(b,d){let w=!1;for(let H=0,ee=d.length;H<ee;H++){const ae=d[H];for(let he=0,be=ae.length;he<be-1;he++){if(zh(b,ae[he],ae[he+1]))return!1;(z=ae[he])[1]>(C=b)[1]!=(j=ae[he+1])[1]>C[1]&&C[0]<(j[0]-z[0])*(C[1]-z[1])/(j[1]-z[1])+z[0]&&(w=!w)}}var C,z,j;return w}function fo(b,d){for(let w=0;w<d.length;w++)if(co(b,d[w]))return!0;return!1}function dl(b,d,w,C){const z=C[0]-w[0],j=C[1]-w[1],H=(b[0]-w[0])*j-z*(b[1]-w[1]),ee=(d[0]-w[0])*j-z*(d[1]-w[1]);return H>0&&ee<0||H<0&&ee>0}function Nh(b,d,w){for(const he of w)for(let be=0;be<he.length-1;++be)if((ee=[(H=he[be+1])[0]-(j=he[be])[0],H[1]-j[1]])[0]*(ae=[(z=d)[0]-(C=b)[0],z[1]-C[1]])[1]-ee[1]*ae[0]!=0&&dl(C,z,j,H)&&dl(j,H,C,z))return!0;var C,z,j,H,ee,ae;return!1}function pl(b,d){for(let w=0;w<b.length;++w)if(!co(b[w],d))return!1;for(let w=0;w<b.length-1;++w)if(Nh(b[w],b[w+1],d))return!1;return!0}function Uh(b,d){for(let w=0;w<d.length;w++)if(pl(b,d[w]))return!0;return!1}function Yr(b,d,w){const C=[];for(let z=0;z<b.length;z++){const j=[];for(let H=0;H<b[z].length;H++){const ee=Fh(b[z][H],w);cs(d,ee),j.push(ee)}C.push(j)}return C}function fs(b,d,w){const C=[];for(let z=0;z<b.length;z++){const j=Yr(b[z],d,w);C.push(j)}return C}function ds(b,d,w,C){if(b[0]<w[0]||b[0]>w[2]){const z=.5*C;let j=b[0]-w[0]>z?-C:w[0]-b[0]>z?C:0;j===0&&(j=b[0]-w[2]>z?-C:w[2]-b[0]>z?C:0),b[0]+=j}cs(d,b)}function ka(b,d,w,C){const z=Math.pow(2,C.z)*En,j=[C.x*En,C.y*En],H=[];for(const ee of b)for(const ae of ee){const he=[ae.x+j[0],ae.y+j[1]];ds(he,d,w,z),H.push(he)}return H}function ia(b,d,w,C){const z=Math.pow(2,C.z)*En,j=[C.x*En,C.y*En],H=[];for(const ae of b){const he=[];for(const be of ae){const Te=[be.x+j[0],be.y+j[1]];cs(d,Te),he.push(Te)}H.push(he)}if(d[2]-d[0]<=z/2){(ee=d)[0]=ee[1]=1/0,ee[2]=ee[3]=-1/0;for(const ae of H)for(const he of ae)ds(he,d,w,z)}var ee;return H}class Sn{constructor(d,w){this.type=Oi,this.geojson=d,this.geometries=w}static parse(d,w){if(d.length!==2)return w.error(`'within' expression requires exactly one argument, but found ${d.length-1} instead.`);if(so(d[1])){const C=d[1];if(C.type==="FeatureCollection")for(let z=0;z<C.features.length;++z){const j=C.features[z].geometry.type;if(j==="Polygon"||j==="MultiPolygon")return new Sn(C,C.features[z].geometry)}else if(C.type==="Feature"){const z=C.geometry.type;if(z==="Polygon"||z==="MultiPolygon")return new Sn(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Sn(C,C)}return w.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(d){if(d.geometry()!=null&&d.canonicalID()!=null){if(d.geometryType()==="Point")return function(w,C){const z=[1/0,1/0,-1/0,-1/0],j=[1/0,1/0,-1/0,-1/0],H=w.canonicalID();if(C.type==="Polygon"){const ee=Yr(C.coordinates,j,H),ae=ka(w.geometry(),z,j,H);if(!uo(z,j))return!1;for(const he of ae)if(!co(he,ee))return!1}if(C.type==="MultiPolygon"){const ee=fs(C.coordinates,j,H),ae=ka(w.geometry(),z,j,H);if(!uo(z,j))return!1;for(const he of ae)if(!fo(he,ee))return!1}return!0}(d,this.geometries);if(d.geometryType()==="LineString")return function(w,C){const z=[1/0,1/0,-1/0,-1/0],j=[1/0,1/0,-1/0,-1/0],H=w.canonicalID();if(C.type==="Polygon"){const ee=Yr(C.coordinates,j,H),ae=ia(w.geometry(),z,j,H);if(!uo(z,j))return!1;for(const he of ae)if(!pl(he,ee))return!1}if(C.type==="MultiPolygon"){const ee=fs(C.coordinates,j,H),ae=ia(w.geometry(),z,j,H);if(!uo(z,j))return!1;for(const he of ae)if(!Uh(he,ee))return!1}return!0}(d,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ra(b){if(b instanceof Dr&&(b.name==="get"&&b.args.length===1||b.name==="feature-state"||b.name==="has"&&b.args.length===1||b.name==="properties"||b.name==="geometry-type"||b.name==="id"||/^filter-/.test(b.name))||b instanceof Sn)return!1;let d=!0;return b.eachChild(w=>{d&&!ra(w)&&(d=!1)}),d}function po(b){if(b instanceof Dr&&b.name==="feature-state")return!1;let d=!0;return b.eachChild(w=>{d&&!po(w)&&(d=!1)}),d}function Ui(b,d){if(b instanceof Dr&&d.indexOf(b.name)>=0)return!1;let w=!0;return b.eachChild(C=>{w&&!Ui(C,d)&&(w=!1)}),w}class mo{constructor(d,w){this.type=w.type,this.name=d,this.boundExpression=w}static parse(d,w){if(d.length!==2||typeof d[1]!="string")return w.error("'var' expression requires exactly one string literal argument.");const C=d[1];return w.scope.has(C)?new mo(C,w.scope.get(C)):w.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(d){return this.boundExpression.evaluate(d)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class go{constructor(d,w=[],C,z=new un,j=[]){this.registry=d,this.path=w,this.key=w.map(H=>`[${H}]`).join(""),this.scope=z,this.errors=j,this.expectedType=C}parse(d,w,C,z,j={}){return w?this.concat(w,C,z)._parse(d,j):this._parse(d,j)}_parse(d,w){function C(z,j,H){return H==="assert"?new rn(j,[z]):H==="coerce"?new wn(j,[z]):z}if(d!==null&&typeof d!="string"&&typeof d!="boolean"&&typeof d!="number"||(d=["literal",d]),Array.isArray(d)){if(d.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const z=d[0];if(typeof z!="string")return this.error(`Expression name must be a string, but found ${typeof z} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const j=this.registry[z];if(j){let H=j.parse(d,this);if(!H)return null;if(this.expectedType){const ee=this.expectedType,ae=H.type;if(ee.kind!=="string"&&ee.kind!=="number"&&ee.kind!=="boolean"&&ee.kind!=="object"&&ee.kind!=="array"||ae.kind!=="value")if(ee.kind!=="color"&&ee.kind!=="formatted"&&ee.kind!=="resolvedImage"||ae.kind!=="value"&&ae.kind!=="string"){if(this.checkSubtype(ee,ae))return null}else H=C(H,ee,w.typeAnnotation||"coerce");else H=C(H,ee,w.typeAnnotation||"assert")}if(!(H instanceof jn)&&H.type.kind!=="resolvedImage"&&ps(H)){const ee=new us;try{H=new jn(H.type,H.evaluate(ee))}catch(ae){return this.error(ae.message),null}}return H}return this.error(`Unknown expression "${z}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(d===void 0?"'undefined' value invalid. Use null instead.":typeof d=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof d} instead.`)}concat(d,w,C){const z=typeof d=="number"?this.path.concat(d):this.path,j=C?this.scope.concat(C):this.scope;return new go(this.registry,z,w||null,j,this.errors)}error(d,...w){const C=`${this.key}${w.map(z=>`[${z}]`).join("")}`;this.errors.push(new zi(C,d))}checkSubtype(d,w){const C=bn(d,w);return C&&this.error(C),C}}function ps(b){if(b instanceof mo)return ps(b.boundExpression);if(b instanceof Dr&&b.name==="error"||b instanceof ho||b instanceof Sn)return!1;const d=b instanceof wn||b instanceof rn;let w=!0;return b.eachChild(C=>{w=d?w&&ps(C):w&&C instanceof jn}),!!w&&ra(b)&&Ui(b,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Da(b,d){const w=b.length-1;let C,z,j=0,H=w,ee=0;for(;j<=H;)if(ee=Math.floor((j+H)/2),C=b[ee],z=b[ee+1],C<=d){if(ee===w||d<z)return ee;j=ee+1}else{if(!(C>d))throw new mr("Input is not a number.");H=ee-1}return 0}class Ra{constructor(d,w,C){this.type=d,this.input=w,this.labels=[],this.outputs=[];for(const[z,j]of C)this.labels.push(z),this.outputs.push(j)}static parse(d,w){if(d.length-1<4)return w.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if((d.length-1)%2!=0)return w.error("Expected an even number of arguments.");const C=w.parse(d[1],1,gi);if(!C)return null;const z=[];let j=null;w.expectedType&&w.expectedType.kind!=="value"&&(j=w.expectedType);for(let H=1;H<d.length;H+=2){const ee=H===1?-1/0:d[H],ae=d[H+1],he=H,be=H+1;if(typeof ee!="number")return w.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',he);if(z.length&&z[z.length-1][0]>=ee)return w.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',he);const Te=w.parse(ae,be,j);if(!Te)return null;j=j||Te.type,z.push([ee,Te])}return new Ra(j,C,z)}evaluate(d){const w=this.labels,C=this.outputs;if(w.length===1)return C[0].evaluate(d);const z=this.input.evaluate(d);if(z<=w[0])return C[0].evaluate(d);const j=w.length;return z>=w[j-1]?C[j-1].evaluate(d):C[Da(w,z)].evaluate(d)}eachChild(d){d(this.input);for(const w of this.outputs)d(w)}outputDefined(){return this.outputs.every(d=>d.outputDefined())}serialize(){const d=["step",this.input.serialize()];for(let w=0;w<this.labels.length;w++)w>0&&d.push(this.labels[w]),d.push(this.outputs[w].serialize());return d}}function Vi(b,d,w){return b*(1-w)+d*w}var Pa=Object.freeze({__proto__:null,number:Vi,color:function(b,d,w){return new Gi(Vi(b.r,d.r,w),Vi(b.g,d.g,w),Vi(b.b,d.b,w),Vi(b.a,d.a,w))},array:function(b,d,w){return b.map((C,z)=>Vi(C,d[z],w))}});const _o=.95047,ms=1.08883,ml=4/29,La=6/29,gs=3*La*La,$h=Math.PI/180,gl=180/Math.PI;function _s(b){return b>.008856451679035631?Math.pow(b,1/3):b/gs+ml}function yo(b){return b>La?b*b*b:gs*(b-ml)}function vo(b){return 255*(b<=.0031308?12.92*b:1.055*Math.pow(b,1/2.4)-.055)}function xo(b){return(b/=255)<=.04045?b/12.92:Math.pow((b+.055)/1.055,2.4)}function ys(b){const d=xo(b.r),w=xo(b.g),C=xo(b.b),z=_s((.4124564*d+.3575761*w+.1804375*C)/_o),j=_s((.2126729*d+.7151522*w+.072175*C)/1);return{l:116*j-16,a:500*(z-j),b:200*(j-_s((.0193339*d+.119192*w+.9503041*C)/ms)),alpha:b.a}}function _l(b){let d=(b.l+16)/116,w=isNaN(b.a)?d:d+b.a/500,C=isNaN(b.b)?d:d-b.b/200;return d=1*yo(d),w=_o*yo(w),C=ms*yo(C),new Gi(vo(3.2404542*w-1.5371385*d-.4985314*C),vo(-.969266*w+1.8760108*d+.041556*C),vo(.0556434*w-.2040259*d+1.0572252*C),b.alpha)}function yl(b,d,w){const C=d-b;return b+w*(C>180||C<-180?C-360*Math.round(C/360):C)}const na={forward:ys,reverse:_l,interpolate:function(b,d,w){return{l:Vi(b.l,d.l,w),a:Vi(b.a,d.a,w),b:Vi(b.b,d.b,w),alpha:Vi(b.alpha,d.alpha,w)}}},Ba={forward:function(b){const{l:d,a:w,b:C}=ys(b),z=Math.atan2(C,w)*gl;return{h:z<0?z+360:z,c:Math.sqrt(w*w+C*C),l:d,alpha:b.a}},reverse:function(b){const d=b.h*$h,w=b.c;return _l({l:b.l,a:Math.cos(d)*w,b:Math.sin(d)*w,alpha:b.alpha})},interpolate:function(b,d,w){return{h:yl(b.h,d.h,w),c:Vi(b.c,d.c,w),l:Vi(b.l,d.l,w),alpha:Vi(b.alpha,d.alpha,w)}}};var vl=Object.freeze({__proto__:null,lab:na,hcl:Ba});class Zr{constructor(d,w,C,z,j){this.type=d,this.operator=w,this.interpolation=C,this.input=z,this.labels=[],this.outputs=[];for(const[H,ee]of j)this.labels.push(H),this.outputs.push(ee)}static interpolationFactor(d,w,C,z){let j=0;if(d.name==="exponential")j=vs(w,d.base,C,z);else if(d.name==="linear")j=vs(w,1,C,z);else if(d.name==="cubic-bezier"){const H=d.controlPoints;j=new T(H[0],H[1],H[2],H[3]).solve(vs(w,1,C,z))}return j}static parse(d,w){let[C,z,j,...H]=d;if(!Array.isArray(z)||z.length===0)return w.error("Expected an interpolation type expression.",1);if(z[0]==="linear")z={name:"linear"};else if(z[0]==="exponential"){const he=z[1];if(typeof he!="number")return w.error("Exponential interpolation requires a numeric base.",1,1);z={name:"exponential",base:he}}else{if(z[0]!=="cubic-bezier")return w.error(`Unknown interpolation type ${String(z[0])}`,1,0);{const he=z.slice(1);if(he.length!==4||he.some(be=>typeof be!="number"||be<0||be>1))return w.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);z={name:"cubic-bezier",controlPoints:he}}}if(d.length-1<4)return w.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if((d.length-1)%2!=0)return w.error("Expected an even number of arguments.");if(j=w.parse(j,2,gi),!j)return null;const ee=[];let ae=null;C==="interpolate-hcl"||C==="interpolate-lab"?ae=ar:w.expectedType&&w.expectedType.kind!=="value"&&(ae=w.expectedType);for(let he=0;he<H.length;he+=2){const be=H[he],Te=H[he+1],Re=he+3,$e=he+4;if(typeof be!="number")return w.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Re);if(ee.length&&ee[ee.length-1][0]>=be)return w.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Re);const qe=w.parse(Te,$e,ae);if(!qe)return null;ae=ae||qe.type,ee.push([be,qe])}return ae.kind==="number"||ae.kind==="color"||ae.kind==="array"&&ae.itemType.kind==="number"&&typeof ae.N=="number"?new Zr(ae,C,z,j,ee):w.error(`Type ${sr(ae)} is not interpolatable.`)}evaluate(d){const w=this.labels,C=this.outputs;if(w.length===1)return C[0].evaluate(d);const z=this.input.evaluate(d);if(z<=w[0])return C[0].evaluate(d);const j=w.length;if(z>=w[j-1])return C[j-1].evaluate(d);const H=Da(w,z),ee=Zr.interpolationFactor(this.interpolation,z,w[H],w[H+1]),ae=C[H].evaluate(d),he=C[H+1].evaluate(d);return this.operator==="interpolate"?Pa[this.type.kind.toLowerCase()](ae,he,ee):this.operator==="interpolate-hcl"?Ba.reverse(Ba.interpolate(Ba.forward(ae),Ba.forward(he),ee)):na.reverse(na.interpolate(na.forward(ae),na.forward(he),ee))}eachChild(d){d(this.input);for(const w of this.outputs)d(w)}outputDefined(){return this.outputs.every(d=>d.outputDefined())}serialize(){let d;d=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const w=[this.operator,d,this.input.serialize()];for(let C=0;C<this.labels.length;C++)w.push(this.labels[C],this.outputs[C].serialize());return w}}function vs(b,d,w,C){const z=C-w,j=b-w;return z===0?0:d===1?j/z:(Math.pow(d,j)-1)/(Math.pow(d,z)-1)}class bo{constructor(d,w){this.type=d,this.args=w}static parse(d,w){if(d.length<2)return w.error("Expectected at least one argument.");let C=null;const z=w.expectedType;z&&z.kind!=="value"&&(C=z);const j=[];for(const ee of d.slice(1)){const ae=w.parse(ee,1+j.length,C,void 0,{typeAnnotation:"omit"});if(!ae)return null;C=C||ae.type,j.push(ae)}const H=z&&j.some(ee=>bn(z,ee.type));return new bo(H?Ni:C,j)}evaluate(d){let w,C=null,z=0;for(const j of this.args)if(z++,C=j.evaluate(d),C&&C instanceof Xr&&!C.available&&(w||(w=C.name),C=null,z===this.args.length&&(C=w)),C!==null)break;return C}eachChild(d){this.args.forEach(d)}outputDefined(){return this.args.every(d=>d.outputDefined())}serialize(){const d=["coalesce"];return this.eachChild(w=>{d.push(w.serialize())}),d}}class Oa{constructor(d,w){this.type=w.type,this.bindings=[].concat(d),this.result=w}evaluate(d){return this.result.evaluate(d)}eachChild(d){for(const w of this.bindings)d(w[1]);d(this.result)}static parse(d,w){if(d.length<4)return w.error(`Expected at least 3 arguments, but found ${d.length-1} instead.`);const C=[];for(let j=1;j<d.length-1;j+=2){const H=d[j];if(typeof H!="string")return w.error(`Expected string, but found ${typeof H} instead.`,j);if(/[^a-zA-Z0-9_]/.test(H))return w.error("Variable names must contain only alphanumeric characters or '_'.",j);const ee=w.parse(d[j+1],j+1);if(!ee)return null;C.push([H,ee])}const z=w.parse(d[d.length-1],d.length-1,w.expectedType,C);return z?new Oa(C,z):null}outputDefined(){return this.result.outputDefined()}serialize(){const d=["let"];for(const[w,C]of this.bindings)d.push(w,C.serialize());return d.push(this.result.serialize()),d}}class xs{constructor(d,w,C){this.type=d,this.index=w,this.input=C}static parse(d,w){if(d.length!==3)return w.error(`Expected 2 arguments, but found ${d.length-1} instead.`);const C=w.parse(d[1],1,gi),z=w.parse(d[2],2,Vr(w.expectedType||Ni));return C&&z?new xs(z.type.itemType,C,z):null}evaluate(d){const w=this.index.evaluate(d),C=this.input.evaluate(d);if(w<0)throw new mr(`Array index out of bounds: ${w} < 0.`);if(w>=C.length)throw new mr(`Array index out of bounds: ${w} > ${C.length-1}.`);if(w!==Math.floor(w))throw new mr(`Array index must be an integer, but found ${w} instead.`);return C[w]}eachChild(d){d(this.index),d(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bs{constructor(d,w){this.type=Oi,this.needle=d,this.haystack=w}static parse(d,w){if(d.length!==3)return w.error(`Expected 2 arguments, but found ${d.length-1} instead.`);const C=w.parse(d[1],1,Ni),z=w.parse(d[2],2,Ni);return C&&z?ls(C.type,[Oi,Fi,gi,Gr,Ni])?new bs(C,z):w.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(C.type)} instead`):null}evaluate(d){const w=this.needle.evaluate(d),C=this.haystack.evaluate(d);if(!C)return!1;if(!en(w,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${sr(fr(w))} instead.`);if(!en(C,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${sr(fr(C))} instead.`);return C.indexOf(w)>=0}eachChild(d){d(this.needle),d(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wo{constructor(d,w,C){this.type=gi,this.needle=d,this.haystack=w,this.fromIndex=C}static parse(d,w){if(d.length<=2||d.length>=5)return w.error(`Expected 3 or 4 arguments, but found ${d.length-1} instead.`);const C=w.parse(d[1],1,Ni),z=w.parse(d[2],2,Ni);if(!C||!z)return null;if(!ls(C.type,[Oi,Fi,gi,Gr,Ni]))return w.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(C.type)} instead`);if(d.length===4){const j=w.parse(d[3],3,gi);return j?new wo(C,z,j):null}return new wo(C,z)}evaluate(d){const w=this.needle.evaluate(d),C=this.haystack.evaluate(d);if(!en(w,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${sr(fr(w))} instead.`);if(!en(C,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${sr(fr(C))} instead.`);if(this.fromIndex){const z=this.fromIndex.evaluate(d);return C.indexOf(w,z)}return C.indexOf(w)}eachChild(d){d(this.needle),d(this.haystack),this.fromIndex&&d(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const d=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),d]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Eo{constructor(d,w,C,z,j,H){this.inputType=d,this.type=w,this.input=C,this.cases=z,this.outputs=j,this.otherwise=H}static parse(d,w){if(d.length<5)return w.error(`Expected at least 4 arguments, but found only ${d.length-1}.`);if(d.length%2!=1)return w.error("Expected an even number of arguments.");let C,z;w.expectedType&&w.expectedType.kind!=="value"&&(z=w.expectedType);const j={},H=[];for(let he=2;he<d.length-1;he+=2){let be=d[he];const Te=d[he+1];Array.isArray(be)||(be=[be]);const Re=w.concat(he);if(be.length===0)return Re.error("Expected at least one branch label.");for(const qe of be){if(typeof qe!="number"&&typeof qe!="string")return Re.error("Branch labels must be numbers or strings.");if(typeof qe=="number"&&Math.abs(qe)>Number.MAX_SAFE_INTEGER)return Re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof qe=="number"&&Math.floor(qe)!==qe)return Re.error("Numeric branch labels must be integer values.");if(C){if(Re.checkSubtype(C,fr(qe)))return null}else C=fr(qe);if(j[String(qe)]!==void 0)return Re.error("Branch labels must be unique.");j[String(qe)]=H.length}const $e=w.parse(Te,he,z);if(!$e)return null;z=z||$e.type,H.push($e)}const ee=w.parse(d[1],1,Ni);if(!ee)return null;const ae=w.parse(d[d.length-1],d.length-1,z);return ae?ee.type.kind!=="value"&&w.concat(1).checkSubtype(C,ee.type)?null:new Eo(C,z,ee,j,H,ae):null}evaluate(d){const w=this.input.evaluate(d);return(fr(w)===this.inputType&&this.outputs[this.cases[w]]||this.otherwise).evaluate(d)}eachChild(d){d(this.input),this.outputs.forEach(d),d(this.otherwise)}outputDefined(){return this.outputs.every(d=>d.outputDefined())&&this.otherwise.outputDefined()}serialize(){const d=["match",this.input.serialize()],w=Object.keys(this.cases).sort(),C=[],z={};for(const H of w){const ee=z[this.cases[H]];ee===void 0?(z[this.cases[H]]=C.length,C.push([this.cases[H],[H]])):C[ee][1].push(H)}const j=H=>this.inputType.kind==="number"?Number(H):H;for(const[H,ee]of C)d.push(ee.length===1?j(ee[0]):ee.map(j)),d.push(this.outputs[H].serialize());return d.push(this.otherwise.serialize()),d}}class So{constructor(d,w,C){this.type=d,this.branches=w,this.otherwise=C}static parse(d,w){if(d.length<4)return w.error(`Expected at least 3 arguments, but found only ${d.length-1}.`);if(d.length%2!=0)return w.error("Expected an odd number of arguments.");let C;w.expectedType&&w.expectedType.kind!=="value"&&(C=w.expectedType);const z=[];for(let H=1;H<d.length-1;H+=2){const ee=w.parse(d[H],H,Oi);if(!ee)return null;const ae=w.parse(d[H+1],H+1,C);if(!ae)return null;z.push([ee,ae]),C=C||ae.type}const j=w.parse(d[d.length-1],d.length-1,C);return j?new So(C,z,j):null}evaluate(d){for(const[w,C]of this.branches)if(w.evaluate(d))return C.evaluate(d);return this.otherwise.evaluate(d)}eachChild(d){for(const[w,C]of this.branches)d(w),d(C);d(this.otherwise)}outputDefined(){return this.branches.every(([d,w])=>w.outputDefined())&&this.otherwise.outputDefined()}serialize(){const d=["case"];return this.eachChild(w=>{d.push(w.serialize())}),d}}class Mo{constructor(d,w,C,z){this.type=d,this.input=w,this.beginIndex=C,this.endIndex=z}static parse(d,w){if(d.length<=2||d.length>=5)return w.error(`Expected 3 or 4 arguments, but found ${d.length-1} instead.`);const C=w.parse(d[1],1,Ni),z=w.parse(d[2],2,gi);if(!C||!z)return null;if(!ls(C.type,[Vr(Ni),Fi,Ni]))return w.error(`Expected first argument to be of type array or string, but found ${sr(C.type)} instead`);if(d.length===4){const j=w.parse(d[3],3,gi);return j?new Mo(C.type,C,z,j):null}return new Mo(C.type,C,z)}evaluate(d){const w=this.input.evaluate(d),C=this.beginIndex.evaluate(d);if(!en(w,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${sr(fr(w))} instead.`);if(this.endIndex){const z=this.endIndex.evaluate(d);return w.slice(C,z)}return w.slice(C)}eachChild(d){d(this.input),d(this.beginIndex),this.endIndex&&d(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const d=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),d]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ws(b,d){return b==="=="||b==="!="?d.kind==="boolean"||d.kind==="string"||d.kind==="number"||d.kind==="null"||d.kind==="value":d.kind==="string"||d.kind==="number"||d.kind==="value"}function xl(b,d,w,C){return C.compare(d,w)===0}function aa(b,d,w){const C=b!=="=="&&b!=="!=";return class Jf{constructor(j,H,ee){this.type=Oi,this.lhs=j,this.rhs=H,this.collator=ee,this.hasUntypedArgument=j.type.kind==="value"||H.type.kind==="value"}static parse(j,H){if(j.length!==3&&j.length!==4)return H.error("Expected two or three arguments.");const ee=j[0];let ae=H.parse(j[1],1,Ni);if(!ae)return null;if(!ws(ee,ae.type))return H.concat(1).error(`"${ee}" comparisons are not supported for type '${sr(ae.type)}'.`);let he=H.parse(j[2],2,Ni);if(!he)return null;if(!ws(ee,he.type))return H.concat(2).error(`"${ee}" comparisons are not supported for type '${sr(he.type)}'.`);if(ae.type.kind!==he.type.kind&&ae.type.kind!=="value"&&he.type.kind!=="value")return H.error(`Cannot compare types '${sr(ae.type)}' and '${sr(he.type)}'.`);C&&(ae.type.kind==="value"&&he.type.kind!=="value"?ae=new rn(he.type,[ae]):ae.type.kind!=="value"&&he.type.kind==="value"&&(he=new rn(ae.type,[he])));let be=null;if(j.length===4){if(ae.type.kind!=="string"&&he.type.kind!=="string"&&ae.type.kind!=="value"&&he.type.kind!=="value")return H.error("Cannot use collator to compare non-string types.");if(be=H.parse(j[3],3,no),!be)return null}return new Jf(ae,he,be)}evaluate(j){const H=this.lhs.evaluate(j),ee=this.rhs.evaluate(j);if(C&&this.hasUntypedArgument){const ae=fr(H),he=fr(ee);if(ae.kind!==he.kind||ae.kind!=="string"&&ae.kind!=="number")throw new mr(`Expected arguments for "${b}" to be (string, string) or (number, number), but found (${ae.kind}, ${he.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const ae=fr(H),he=fr(ee);if(ae.kind!=="string"||he.kind!=="string")return d(j,H,ee)}return this.collator?w(j,H,ee,this.collator.evaluate(j)):d(j,H,ee)}eachChild(j){j(this.lhs),j(this.rhs),this.collator&&j(this.collator)}outputDefined(){return!0}serialize(){const j=[b];return this.eachChild(H=>{j.push(H.serialize())}),j}}}const bl=aa("==",function(b,d,w){return d===w},xl),wl=aa("!=",function(b,d,w){return d!==w},function(b,d,w,C){return!xl(0,d,w,C)}),jh=aa("<",function(b,d,w){return d<w},function(b,d,w,C){return C.compare(d,w)<0}),Gh=aa(">",function(b,d,w){return d>w},function(b,d,w,C){return C.compare(d,w)>0}),Vh=aa("<=",function(b,d,w){return d<=w},function(b,d,w,C){return C.compare(d,w)<=0}),Zh=aa(">=",function(b,d,w){return d>=w},function(b,d,w,C){return C.compare(d,w)>=0});class oa{constructor(d,w,C,z,j){this.type=Fi,this.number=d,this.locale=w,this.currency=C,this.minFractionDigits=z,this.maxFractionDigits=j}static parse(d,w){if(d.length!==3)return w.error("Expected two arguments.");const C=w.parse(d[1],1,gi);if(!C)return null;const z=d[2];if(typeof z!="object"||Array.isArray(z))return w.error("NumberFormat options argument must be an object.");let j=null;if(z.locale&&(j=w.parse(z.locale,1,Fi),!j))return null;let H=null;if(z.currency&&(H=w.parse(z.currency,1,Fi),!H))return null;let ee=null;if(z["min-fraction-digits"]&&(ee=w.parse(z["min-fraction-digits"],1,gi),!ee))return null;let ae=null;return z["max-fraction-digits"]&&(ae=w.parse(z["max-fraction-digits"],1,gi),!ae)?null:new oa(C,j,H,ee,ae)}evaluate(d){return new Intl.NumberFormat(this.locale?this.locale.evaluate(d):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(d):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(d):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(d):void 0}).format(this.number.evaluate(d))}eachChild(d){d(this.number),this.locale&&d(this.locale),this.currency&&d(this.currency),this.minFractionDigits&&d(this.minFractionDigits),this.maxFractionDigits&&d(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const d={};return this.locale&&(d.locale=this.locale.serialize()),this.currency&&(d.currency=this.currency.serialize()),this.minFractionDigits&&(d["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(d["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),d]}}class To{constructor(d){this.type=gi,this.input=d}static parse(d,w){if(d.length!==2)return w.error(`Expected 1 argument, but found ${d.length-1} instead.`);const C=w.parse(d[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?w.error(`Expected argument of type string or array, but found ${sr(C.type)} instead.`):new To(C):null}evaluate(d){const w=this.input.evaluate(d);if(typeof w=="string"||Array.isArray(w))return w.length;throw new mr(`Expected value to be of type string or array, but found ${sr(fr(w))} instead.`)}eachChild(d){d(this.input)}outputDefined(){return!1}serialize(){const d=["length"];return this.eachChild(w=>{d.push(w.serialize())}),d}}const Gn={"==":bl,"!=":wl,">":Gh,"<":jh,">=":Zh,"<=":Vh,array:rn,at:xs,boolean:rn,case:So,coalesce:bo,collator:ho,format:Ia,image:lo,in:bs,"index-of":wo,interpolate:Zr,"interpolate-hcl":Zr,"interpolate-lab":Zr,length:To,let:Oa,literal:jn,match:Eo,number:rn,"number-format":oa,object:rn,slice:Mo,step:Ra,string:rn,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:mo,within:Sn};function El(b,[d,w,C,z]){d=d.evaluate(b),w=w.evaluate(b),C=C.evaluate(b);const j=z?z.evaluate(b):1,H=fl(d,w,C,j);if(H)throw new mr(H);return new Gi(d/255*j,w/255*j,C/255*j,j)}function Sl(b,d){return b in d}function Es(b,d){const w=d[b];return w===void 0?null:w}function Mn(b){return{type:b}}function Ss(b){return{result:"success",value:b}}function Vn(b){return{result:"error",value:b}}function Tn(b){return b["property-type"]==="data-driven"||b["property-type"]==="cross-faded-data-driven"}function Ml(b){return!!b.expression&&b.expression.parameters.indexOf("zoom")>-1}function Ms(b){return!!b.expression&&b.expression.interpolated}function Zi(b){return b instanceof Number?"number":b instanceof String?"string":b instanceof Boolean?"boolean":Array.isArray(b)?"array":b===null?"null":typeof b}function Ao(b){return typeof b=="object"&&b!==null&&!Array.isArray(b)}function Hh(b){return b}function Tl(b,d){const w=d.type==="color",C=b.stops&&typeof b.stops[0][0]=="object",z=C||!(C||b.property!==void 0),j=b.type||(Ms(d)?"exponential":"interval");if(w&&((b=ki({},b)).stops&&(b.stops=b.stops.map(he=>[he[0],Gi.parse(he[1])])),b.default=Gi.parse(b.default?b.default:d.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!vl[b.colorSpace])throw new Error(`Unknown color space: ${b.colorSpace}`);let H,ee,ae;if(j==="exponential")H=Cl;else if(j==="interval")H=Co;else if(j==="categorical"){H=Al,ee=Object.create(null);for(const he of b.stops)ee[he[0]]=he[1];ae=typeof b.stops[0][0]}else{if(j!=="identity")throw new Error(`Unknown function type "${j}"`);H=Wh}if(C){const he={},be=[];for(let $e=0;$e<b.stops.length;$e++){const qe=b.stops[$e],rt=qe[0].zoom;he[rt]===void 0&&(he[rt]={zoom:rt,type:b.type,property:b.property,default:b.default,stops:[]},be.push(rt)),he[rt].stops.push([qe[0].value,qe[1]])}const Te=[];for(const $e of be)Te.push([he[$e].zoom,Tl(he[$e],d)]);const Re={name:"linear"};return{kind:"composite",interpolationType:Re,interpolationFactor:Zr.interpolationFactor.bind(void 0,Re),zoomStops:Te.map($e=>$e[0]),evaluate:({zoom:$e},qe)=>Cl({stops:Te,base:b.base},d,$e).evaluate($e,qe)}}if(z){const he=j==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:he,interpolationFactor:Zr.interpolationFactor.bind(void 0,he),zoomStops:b.stops.map(be=>be[0]),evaluate:({zoom:be})=>H(b,d,be,ee,ae)}}return{kind:"source",evaluate(he,be){const Te=be&&be.properties?be.properties[b.property]:void 0;return Te===void 0?sa(b.default,d.default):H(b,d,Te,ee,ae)}}}function sa(b,d,w){return b!==void 0?b:d!==void 0?d:w!==void 0?w:void 0}function Al(b,d,w,C,z){return sa(typeof w===z?C[w]:void 0,b.default,d.default)}function Co(b,d,w){if(Zi(w)!=="number")return sa(b.default,d.default);const C=b.stops.length;if(C===1||w<=b.stops[0][0])return b.stops[0][1];if(w>=b.stops[C-1][0])return b.stops[C-1][1];const z=Da(b.stops.map(j=>j[0]),w);return b.stops[z][1]}function Cl(b,d,w){const C=b.base!==void 0?b.base:1;if(Zi(w)!=="number")return sa(b.default,d.default);const z=b.stops.length;if(z===1||w<=b.stops[0][0])return b.stops[0][1];if(w>=b.stops[z-1][0])return b.stops[z-1][1];const j=Da(b.stops.map(be=>be[0]),w),H=function(be,Te,Re,$e){const qe=$e-Re,rt=be-Re;return qe===0?0:Te===1?rt/qe:(Math.pow(Te,rt)-1)/(Math.pow(Te,qe)-1)}(w,C,b.stops[j][0],b.stops[j+1][0]),ee=b.stops[j][1],ae=b.stops[j+1][1];let he=Pa[d.type]||Hh;if(b.colorSpace&&b.colorSpace!=="rgb"){const be=vl[b.colorSpace];he=(Te,Re)=>be.reverse(be.interpolate(be.forward(Te),be.forward(Re),H))}return typeof ee.evaluate=="function"?{evaluate(...be){const Te=ee.evaluate.apply(void 0,be),Re=ae.evaluate.apply(void 0,be);if(Te!==void 0&&Re!==void 0)return he(Te,Re,H)}}:he(ee,ae,H)}function Wh(b,d,w){return d.type==="color"?w=Gi.parse(w):d.type==="formatted"?w=kr.fromString(w.toString()):d.type==="resolvedImage"?w=Xr.fromString(w.toString()):Zi(w)===d.type||d.type==="enum"&&d.values[w]||(w=void 0),sa(w,b.default,d.default)}Dr.register(Gn,{error:[{kind:"error"},[Fi],(b,[d])=>{throw new mr(d.evaluate(b))}],typeof:[Fi,[Ni],(b,[d])=>sr(fr(d.evaluate(b)))],"to-rgba":[Vr(gi,4),[ar],(b,[d])=>d.evaluate(b).toArray()],rgb:[ar,[gi,gi,gi],El],rgba:[ar,[gi,gi,gi,gi],El],has:{type:Oi,overloads:[[[Fi],(b,[d])=>Sl(d.evaluate(b),b.properties())],[[Fi,Nn],(b,[d,w])=>Sl(d.evaluate(b),w.evaluate(b))]]},get:{type:Ni,overloads:[[[Fi],(b,[d])=>Es(d.evaluate(b),b.properties())],[[Fi,Nn],(b,[d,w])=>Es(d.evaluate(b),w.evaluate(b))]]},"feature-state":[Ni,[Fi],(b,[d])=>Es(d.evaluate(b),b.featureState||{})],properties:[Nn,[],b=>b.properties()],"geometry-type":[Fi,[],b=>b.geometryType()],id:[Ni,[],b=>b.id()],zoom:[gi,[],b=>b.globals.zoom],pitch:[gi,[],b=>b.globals.pitch||0],"distance-from-center":[gi,[],b=>b.distanceFromCenter()],"heatmap-density":[gi,[],b=>b.globals.heatmapDensity||0],"line-progress":[gi,[],b=>b.globals.lineProgress||0],"sky-radial-progress":[gi,[],b=>b.globals.skyRadialProgress||0],accumulated:[Ni,[],b=>b.globals.accumulated===void 0?null:b.globals.accumulated],"+":[gi,Mn(gi),(b,d)=>{let w=0;for(const C of d)w+=C.evaluate(b);return w}],"*":[gi,Mn(gi),(b,d)=>{let w=1;for(const C of d)w*=C.evaluate(b);return w}],"-":{type:gi,overloads:[[[gi,gi],(b,[d,w])=>d.evaluate(b)-w.evaluate(b)],[[gi],(b,[d])=>-d.evaluate(b)]]},"/":[gi,[gi,gi],(b,[d,w])=>d.evaluate(b)/w.evaluate(b)],"%":[gi,[gi,gi],(b,[d,w])=>d.evaluate(b)%w.evaluate(b)],ln2:[gi,[],()=>Math.LN2],pi:[gi,[],()=>Math.PI],e:[gi,[],()=>Math.E],"^":[gi,[gi,gi],(b,[d,w])=>Math.pow(d.evaluate(b),w.evaluate(b))],sqrt:[gi,[gi],(b,[d])=>Math.sqrt(d.evaluate(b))],log10:[gi,[gi],(b,[d])=>Math.log(d.evaluate(b))/Math.LN10],ln:[gi,[gi],(b,[d])=>Math.log(d.evaluate(b))],log2:[gi,[gi],(b,[d])=>Math.log(d.evaluate(b))/Math.LN2],sin:[gi,[gi],(b,[d])=>Math.sin(d.evaluate(b))],cos:[gi,[gi],(b,[d])=>Math.cos(d.evaluate(b))],tan:[gi,[gi],(b,[d])=>Math.tan(d.evaluate(b))],asin:[gi,[gi],(b,[d])=>Math.asin(d.evaluate(b))],acos:[gi,[gi],(b,[d])=>Math.acos(d.evaluate(b))],atan:[gi,[gi],(b,[d])=>Math.atan(d.evaluate(b))],min:[gi,Mn(gi),(b,d)=>Math.min(...d.map(w=>w.evaluate(b)))],max:[gi,Mn(gi),(b,d)=>Math.max(...d.map(w=>w.evaluate(b)))],abs:[gi,[gi],(b,[d])=>Math.abs(d.evaluate(b))],round:[gi,[gi],(b,[d])=>{const w=d.evaluate(b);return w<0?-Math.round(-w):Math.round(w)}],floor:[gi,[gi],(b,[d])=>Math.floor(d.evaluate(b))],ceil:[gi,[gi],(b,[d])=>Math.ceil(d.evaluate(b))],"filter-==":[Oi,[Fi,Ni],(b,[d,w])=>b.properties()[d.value]===w.value],"filter-id-==":[Oi,[Ni],(b,[d])=>b.id()===d.value],"filter-type-==":[Oi,[Fi],(b,[d])=>b.geometryType()===d.value],"filter-<":[Oi,[Fi,Ni],(b,[d,w])=>{const C=b.properties()[d.value],z=w.value;return typeof C==typeof z&&C<z}],"filter-id-<":[Oi,[Ni],(b,[d])=>{const w=b.id(),C=d.value;return typeof w==typeof C&&w<C}],"filter->":[Oi,[Fi,Ni],(b,[d,w])=>{const C=b.properties()[d.value],z=w.value;return typeof C==typeof z&&C>z}],"filter-id->":[Oi,[Ni],(b,[d])=>{const w=b.id(),C=d.value;return typeof w==typeof C&&w>C}],"filter-<=":[Oi,[Fi,Ni],(b,[d,w])=>{const C=b.properties()[d.value],z=w.value;return typeof C==typeof z&&C<=z}],"filter-id-<=":[Oi,[Ni],(b,[d])=>{const w=b.id(),C=d.value;return typeof w==typeof C&&w<=C}],"filter->=":[Oi,[Fi,Ni],(b,[d,w])=>{const C=b.properties()[d.value],z=w.value;return typeof C==typeof z&&C>=z}],"filter-id->=":[Oi,[Ni],(b,[d])=>{const w=b.id(),C=d.value;return typeof w==typeof C&&w>=C}],"filter-has":[Oi,[Ni],(b,[d])=>d.value in b.properties()],"filter-has-id":[Oi,[],b=>b.id()!==null&&b.id()!==void 0],"filter-type-in":[Oi,[Vr(Fi)],(b,[d])=>d.value.indexOf(b.geometryType())>=0],"filter-id-in":[Oi,[Vr(Ni)],(b,[d])=>d.value.indexOf(b.id())>=0],"filter-in-small":[Oi,[Fi,Vr(Ni)],(b,[d,w])=>w.value.indexOf(b.properties()[d.value])>=0],"filter-in-large":[Oi,[Fi,Vr(Ni)],(b,[d,w])=>function(C,z,j,H){for(;j<=H;){const ee=j+H>>1;if(z[ee]===C)return!0;z[ee]>C?H=ee-1:j=ee+1}return!1}(b.properties()[d.value],w.value,0,w.value.length-1)],all:{type:Oi,overloads:[[[Oi,Oi],(b,[d,w])=>d.evaluate(b)&&w.evaluate(b)],[Mn(Oi),(b,d)=>{for(const w of d)if(!w.evaluate(b))return!1;return!0}]]},any:{type:Oi,overloads:[[[Oi,Oi],(b,[d,w])=>d.evaluate(b)||w.evaluate(b)],[Mn(Oi),(b,d)=>{for(const w of d)if(w.evaluate(b))return!0;return!1}]]},"!":[Oi,[Oi],(b,[d])=>!d.evaluate(b)],"is-supported-script":[Oi,[Fi],(b,[d])=>{const w=b.globals&&b.globals.isSupportedScript;return!w||w(d.evaluate(b))}],upcase:[Fi,[Fi],(b,[d])=>d.evaluate(b).toUpperCase()],downcase:[Fi,[Fi],(b,[d])=>d.evaluate(b).toLowerCase()],concat:[Fi,Mn(Ni),(b,d)=>d.map(w=>$n(w.evaluate(b))).join("")],"resolved-locale":[Fi,[no],(b,[d])=>d.evaluate(b).resolvedLocale()]});class Ts{constructor(d,w){this.expression=d,this._warningHistory={},this._evaluator=new us,this._defaultValue=w?function(C){return C.type==="color"&&Ao(C.default)?new Gi(0,0,0,0):C.type==="color"?Gi.parse(C.default)||null:C.default===void 0?null:C.default}(w):null,this._enumValues=w&&w.type==="enum"?w.values:null}evaluateWithoutErrorHandling(d,w,C,z,j,H,ee,ae){return this._evaluator.globals=d,this._evaluator.feature=w,this._evaluator.featureState=C,this._evaluator.canonical=z,this._evaluator.availableImages=j||null,this._evaluator.formattedSection=H,this._evaluator.featureTileCoord=ee||null,this._evaluator.featureDistanceData=ae||null,this.expression.evaluate(this._evaluator)}evaluate(d,w,C,z,j,H,ee,ae){this._evaluator.globals=d,this._evaluator.feature=w||null,this._evaluator.featureState=C||null,this._evaluator.canonical=z,this._evaluator.availableImages=j||null,this._evaluator.formattedSection=H||null,this._evaluator.featureTileCoord=ee||null,this._evaluator.featureDistanceData=ae||null;try{const he=this.expression.evaluate(this._evaluator);if(he==null||typeof he=="number"&&he!=he)return this._defaultValue;if(this._enumValues&&!(he in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(be=>JSON.stringify(be)).join(", ")}, but found ${JSON.stringify(he)} instead.`);return he}catch(he){return this._warningHistory[he.message]||(this._warningHistory[he.message]=!0,typeof console!="undefined"&&console.warn(he.message)),this._defaultValue}}}function nn(b){return Array.isArray(b)&&b.length>0&&typeof b[0]=="string"&&b[0]in Gn}function la(b,d){const w=new go(Gn,[],d?function(z){const j={color:ar,string:Fi,number:gi,enum:Fi,boolean:Oi,formatted:ea,resolvedImage:ta};return z.type==="array"?Vr(j[z.value]||Ni,z.length):j[z.type]}(d):void 0),C=w.parse(b,void 0,void 0,void 0,d&&d.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?Ss(new Ts(C,d)):Vn(w.errors)}class An{constructor(d,w){this.kind=d,this._styleExpression=w,this.isStateDependent=d!=="constant"&&!po(w.expression)}evaluateWithoutErrorHandling(d,w,C,z,j,H){return this._styleExpression.evaluateWithoutErrorHandling(d,w,C,z,j,H)}evaluate(d,w,C,z,j,H){return this._styleExpression.evaluate(d,w,C,z,j,H)}}class Io{constructor(d,w,C,z){this.kind=d,this.zoomStops=C,this._styleExpression=w,this.isStateDependent=d!=="camera"&&!po(w.expression),this.interpolationType=z}evaluateWithoutErrorHandling(d,w,C,z,j,H){return this._styleExpression.evaluateWithoutErrorHandling(d,w,C,z,j,H)}evaluate(d,w,C,z,j,H){return this._styleExpression.evaluate(d,w,C,z,j,H)}interpolationFactor(d,w,C){return this.interpolationType?Zr.interpolationFactor(this.interpolationType,d,w,C):0}}function Il(b,d){if((b=la(b,d)).result==="error")return b;const w=b.value.expression,C=ra(w);if(!C&&!Tn(d))return Vn([new zi("","data expressions not supported")]);const z=Ui(w,["zoom","pitch","distance-from-center"]);if(!z&&!Ml(d))return Vn([new zi("","zoom expressions not supported")]);const j=Cn(w);return j||z?j instanceof zi?Vn([j]):j instanceof Zr&&!Ms(d)?Vn([new zi("",'"interpolate" expressions cannot be used with this property')]):Ss(j?new Io(C?"camera":"composite",b.value,j.labels,j instanceof Zr?j.interpolation:void 0):new An(C?"constant":"source",b.value)):Vn([new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ha{constructor(d,w){this._parameters=d,this._specification=w,ki(this,Tl(this._parameters,this._specification))}static deserialize(d){return new ha(d._parameters,d._specification)}static serialize(d){return{_parameters:d._parameters,_specification:d._specification}}}function Cn(b){let d=null;if(b instanceof Oa)d=Cn(b.result);else if(b instanceof bo){for(const w of b.args)if(d=Cn(w),d)break}else(b instanceof Ra||b instanceof Zr)&&b.input instanceof Dr&&b.input.name==="zoom"&&(d=b);return d instanceof zi||b.eachChild(w=>{const C=Cn(w);C instanceof zi?d=C:!d&&C?d=new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):d&&C&&d!==C&&(d=new zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),d}function Kr(b){const d=b.key,w=b.value,C=b.valueSpec||{},z=b.objectElementValidators||{},j=b.style,H=b.styleSpec;let ee=[];const ae=Zi(w);if(ae!=="object")return[new Ut(d,w,`object expected, ${ae} found`)];for(const he in w){const be=he.split(".")[0],Te=C[be]||C["*"];let Re;if(z[be])Re=z[be];else if(C[be])Re=Rr;else if(z["*"])Re=z["*"];else{if(!C["*"]){ee.push(new Ut(d,w[he],`unknown property "${he}"`));continue}Re=Rr}ee=ee.concat(Re({key:(d&&`${d}.`)+he,value:w[he],valueSpec:Te,style:j,styleSpec:H,object:w,objectKey:he},w))}for(const he in C)z[he]||C[he].required&&C[he].default===void 0&&w[he]===void 0&&ee.push(new Ut(d,w,`missing required property "${he}"`));return ee}function ko(b){const d=b.value,w=b.valueSpec,C=b.style,z=b.styleSpec,j=b.key,H=b.arrayElementValidator||Rr;if(Zi(d)!=="array")return[new Ut(j,d,`array expected, ${Zi(d)} found`)];if(w.length&&d.length!==w.length)return[new Ut(j,d,`array length ${w.length} expected, length ${d.length} found`)];if(w["min-length"]&&d.length<w["min-length"])return[new Ut(j,d,`array length at least ${w["min-length"]} expected, length ${d.length} found`)];let ee={type:w.value,values:w.values,minimum:w.minimum,maximum:w.maximum};z.$version<7&&(ee.function=w.function),Zi(w.value)==="object"&&(ee=w.value);let ae=[];for(let he=0;he<d.length;he++)ae=ae.concat(H({array:d,arrayIndex:he,value:d[he],valueSpec:ee,style:C,styleSpec:z,key:`${j}[${he}]`}));return ae}function As(b){const d=b.key,w=b.value,C=b.valueSpec;let z=Zi(w);if(z==="number"&&w!=w&&(z="NaN"),z!=="number")return[new Ut(d,w,`number expected, ${z} found`)];if("minimum"in C){let j=C.minimum;if(Zi(C.minimum)==="array"&&(j=C.minimum[b.arrayIndex]),w<j)return[new Ut(d,w,`${w} is less than the minimum value ${j}`)]}if("maximum"in C){let j=C.maximum;if(Zi(C.maximum)==="array"&&(j=C.maximum[b.arrayIndex]),w>j)return[new Ut(d,w,`${w} is greater than the maximum value ${j}`)]}return[]}function Do(b){const d=b.valueSpec,w=Si(b.value.type);let C,z,j,H={};const ee=w!=="categorical"&&b.value.property===void 0,ae=!ee,he=Zi(b.value.stops)==="array"&&Zi(b.value.stops[0])==="array"&&Zi(b.value.stops[0][0])==="object",be=Kr({key:b.key,value:b.value,valueSpec:b.styleSpec.function,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{stops:function($e){if(w==="identity")return[new Ut($e.key,$e.value,'identity function may not have a "stops" property')];let qe=[];const rt=$e.value;return qe=qe.concat(ko({key:$e.key,value:rt,valueSpec:$e.valueSpec,style:$e.style,styleSpec:$e.styleSpec,arrayElementValidator:Te})),Zi(rt)==="array"&&rt.length===0&&qe.push(new Ut($e.key,rt,"array must have at least one stop")),qe},default:function($e){return Rr({key:$e.key,value:$e.value,valueSpec:d,style:$e.style,styleSpec:$e.styleSpec})}}});return w==="identity"&&ee&&be.push(new Ut(b.key,b.value,'missing required property "property"')),w==="identity"||b.value.stops||be.push(new Ut(b.key,b.value,'missing required property "stops"')),w==="exponential"&&b.valueSpec.expression&&!Ms(b.valueSpec)&&be.push(new Ut(b.key,b.value,"exponential functions not supported")),b.styleSpec.$version>=8&&(ae&&!Tn(b.valueSpec)?be.push(new Ut(b.key,b.value,"property functions not supported")):ee&&!Ml(b.valueSpec)&&be.push(new Ut(b.key,b.value,"zoom functions not supported"))),w!=="categorical"&&!he||b.value.property!==void 0||be.push(new Ut(b.key,b.value,'"property" property is required')),be;function Te($e){let qe=[];const rt=$e.value,dt=$e.key;if(Zi(rt)!=="array")return[new Ut(dt,rt,`array expected, ${Zi(rt)} found`)];if(rt.length!==2)return[new Ut(dt,rt,`array length 2 expected, length ${rt.length} found`)];if(he){if(Zi(rt[0])!=="object")return[new Ut(dt,rt,`object expected, ${Zi(rt[0])} found`)];if(rt[0].zoom===void 0)return[new Ut(dt,rt,"object stop key must have zoom")];if(rt[0].value===void 0)return[new Ut(dt,rt,"object stop key must have value")];if(j&&j>Si(rt[0].zoom))return[new Ut(dt,rt[0].zoom,"stop zoom values must appear in ascending order")];Si(rt[0].zoom)!==j&&(j=Si(rt[0].zoom),z=void 0,H={}),qe=qe.concat(Kr({key:`${dt}[0]`,value:rt[0],valueSpec:{zoom:{}},style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{zoom:As,value:Re}}))}else qe=qe.concat(Re({key:`${dt}[0]`,value:rt[0],valueSpec:{},style:$e.style,styleSpec:$e.styleSpec},rt));return nn(Bi(rt[1]))?qe.concat([new Ut(`${dt}[1]`,rt[1],"expressions are not allowed in function stops.")]):qe.concat(Rr({key:`${dt}[1]`,value:rt[1],valueSpec:d,style:$e.style,styleSpec:$e.styleSpec}))}function Re($e,qe){const rt=Zi($e.value),dt=Si($e.value),yt=$e.value!==null?$e.value:qe;if(C){if(rt!==C)return[new Ut($e.key,yt,`${rt} stop domain type must match previous stop domain type ${C}`)]}else C=rt;if(rt!=="number"&&rt!=="string"&&rt!=="boolean")return[new Ut($e.key,yt,"stop domain value must be a number, string, or boolean")];if(rt!=="number"&&w!=="categorical"){let Mt=`number expected, ${rt} found`;return Tn(d)&&w===void 0&&(Mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut($e.key,yt,Mt)]}return w!=="categorical"||rt!=="number"||isFinite(dt)&&Math.floor(dt)===dt?w!=="categorical"&&rt==="number"&&z!==void 0&&dt<z?[new Ut($e.key,yt,"stop domain values must appear in ascending order")]:(z=dt,w==="categorical"&&dt in H?[new Ut($e.key,yt,"stop domain values must be unique")]:(H[dt]=!0,[])):[new Ut($e.key,yt,`integer expected, found ${dt}`)]}}function In(b){const d=(b.expressionContext==="property"?Il:la)(Bi(b.value),b.valueSpec);if(d.result==="error")return d.value.map(C=>new Ut(`${b.key}${C.key}`,b.value,C.message));const w=d.value.expression||d.value._styleExpression.expression;if(b.expressionContext==="property"&&b.propertyKey==="text-font"&&!w.outputDefined())return[new Ut(b.key,b.value,`Invalid data expression for "${b.propertyKey}". Output values must be contained as literals within the expression.`)];if(b.expressionContext==="property"&&b.propertyType==="layout"&&!po(w))return[new Ut(b.key,b.value,'"feature-state" data expressions are not supported with layout properties.')];if(b.expressionContext==="filter")return Cs(w,b);if(b.expressionContext&&b.expressionContext.indexOf("cluster")===0){if(!Ui(w,["zoom","feature-state"]))return[new Ut(b.key,b.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(b.expressionContext==="cluster-initial"&&!ra(w))return[new Ut(b.key,b.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(b,d){const w=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const z of d.valueSpec.expression.parameters)w.delete(z);if(w.size===0)return[];const C=[];return b instanceof Dr&&w.has(b.name)?[new Ut(d.key,d.value,`["${b.name}"] expression is not supported in a filter for a ${d.object.type} layer with id: ${d.object.id}`)]:(b.eachChild(z=>{C.push(...Cs(z,d))}),C)}function ua(b){const d=b.key,w=b.value,C=b.valueSpec,z=[];return Array.isArray(C.values)?C.values.indexOf(Si(w))===-1&&z.push(new Ut(d,w,`expected one of [${C.values.join(", ")}], ${JSON.stringify(w)} found`)):Object.keys(C.values).indexOf(Si(w))===-1&&z.push(new Ut(d,w,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(w)} found`)),z}function Ro(b){if(b===!0||b===!1)return!0;if(!Array.isArray(b)||b.length===0)return!1;switch(b[0]){case"has":return b.length>=2&&b[1]!=="$id"&&b[1]!=="$type";case"in":return b.length>=3&&(typeof b[1]!="string"||Array.isArray(b[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return b.length!==3||Array.isArray(b[1])||Array.isArray(b[2]);case"any":case"all":for(const d of b.slice(1))if(!Ro(d)&&typeof d!="boolean")return!1;return!0;default:return!0}}function Fa(b,d="fill"){if(b==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ro(b)||(b=Po(b));const w=b;let C=!0;try{C=function(he){if(!Hn(he))return he;let be=Bi(he);return Zn(be),be=Is(be),be}(w)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(w,null,2)}
        `)}const z=Ct[`filter_${d}`],j=la(C,z);let H=null;if(j.result==="error")throw new Error(j.value.map(he=>`${he.key}: ${he.message}`).join(", "));H=(he,be,Te)=>j.value.evaluate(he,be,{},Te);let ee=null,ae=null;if(C!==w){const he=la(w,z);if(he.result==="error")throw new Error(he.value.map(be=>`${be.key}: ${be.message}`).join(", "));ee=(be,Te,Re,$e,qe)=>he.value.evaluate(be,Te,{},Re,void 0,void 0,$e,qe),ae=!ra(he.value.expression)}return H=H,{filter:H,dynamicFilter:ee||void 0,needGeometry:Ds(C),needFeature:!!ae}}function Is(b){if(!Array.isArray(b))return b;const d=function(w){if(kl.has(w[0])){for(let C=1;C<w.length;C++)if(Hn(w[C]))return!0}return w}(b);return d===!0?d:d.map(w=>Is(w))}function Zn(b){let d=!1;const w=[];if(b[0]==="case"){for(let C=1;C<b.length-1;C+=2)d=d||Hn(b[C]),w.push(b[C+1]);w.push(b[b.length-1])}else if(b[0]==="match"){d=d||Hn(b[1]);for(let C=2;C<b.length-1;C+=2)w.push(b[C+1]);w.push(b[b.length-1])}else if(b[0]==="step"){d=d||Hn(b[1]);for(let C=1;C<b.length-1;C+=2)w.push(b[C+1])}d&&(b.length=0,b.push("any",...w));for(let C=1;C<b.length;C++)Zn(b[C])}function Hn(b){if(!Array.isArray(b))return!1;if((d=b[0])==="pitch"||d==="distance-from-center")return!0;var d;for(let w=1;w<b.length;w++)if(Hn(b[w]))return!0;return!1}const kl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ks(b,d){return b<d?-1:b>d?1:0}function Ds(b){if(!Array.isArray(b))return!1;if(b[0]==="within")return!0;for(let d=1;d<b.length;d++)if(Ds(b[d]))return!0;return!1}function Po(b){if(!b)return!0;const d=b[0];return b.length<=1?d!=="any":d==="=="?ca(b[1],b[2],"=="):d==="!="?Lo(ca(b[1],b[2],"==")):d==="<"||d===">"||d==="<="||d===">="?ca(b[1],b[2],d):d==="any"?(w=b.slice(1),["any"].concat(w.map(Po))):d==="all"?["all"].concat(b.slice(1).map(Po)):d==="none"?["all"].concat(b.slice(1).map(Po).map(Lo)):d==="in"?Dl(b[1],b.slice(2)):d==="!in"?Lo(Dl(b[1],b.slice(2))):d==="has"?Rl(b[1]):d==="!has"?Lo(Rl(b[1])):d!=="within"||b;var w}function ca(b,d,w){switch(b){case"$type":return[`filter-type-${w}`,d];case"$id":return[`filter-id-${w}`,d];default:return[`filter-${w}`,b,d]}}function Dl(b,d){if(d.length===0)return!1;switch(b){case"$type":return["filter-type-in",["literal",d]];case"$id":return["filter-id-in",["literal",d]];default:return d.length>200&&!d.some(w=>typeof w!=typeof d[0])?["filter-in-large",b,["literal",d.sort(ks)]]:["filter-in-small",b,["literal",d]]}}function Rl(b){switch(b){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",b]}}function Lo(b){return["!",b]}function Rs(b){if(Ro(Bi(b.value))){const d=Bi(b.layerType);return In(ki({},b,{expressionContext:"filter",valueSpec:b.styleSpec[`filter_${d||"fill"}`]}))}return Pl(b)}function Pl(b){const d=b.value,w=b.key;if(Zi(d)!=="array")return[new Ut(w,d,`array expected, ${Zi(d)} found`)];const C=b.styleSpec;let z,j=[];if(d.length<1)return[new Ut(w,d,"filter array must have at least 1 element")];switch(j=j.concat(ua({key:`${w}[0]`,value:d[0],valueSpec:C.filter_operator,style:b.style,styleSpec:b.styleSpec})),Si(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&Si(d[1])==="$type"&&j.push(new Ut(w,d,`"$type" cannot be use with operator "${d[0]}"`));case"==":case"!=":d.length!==3&&j.push(new Ut(w,d,`filter array for operator "${d[0]}" must have 3 elements`));case"in":case"!in":d.length>=2&&(z=Zi(d[1]),z!=="string"&&j.push(new Ut(`${w}[1]`,d[1],`string expected, ${z} found`)));for(let H=2;H<d.length;H++)z=Zi(d[H]),Si(d[1])==="$type"?j=j.concat(ua({key:`${w}[${H}]`,value:d[H],valueSpec:C.geometry_type,style:b.style,styleSpec:b.styleSpec})):z!=="string"&&z!=="number"&&z!=="boolean"&&j.push(new Ut(`${w}[${H}]`,d[H],`string, number, or boolean expected, ${z} found`));break;case"any":case"all":case"none":for(let H=1;H<d.length;H++)j=j.concat(Pl({key:`${w}[${H}]`,value:d[H],style:b.style,styleSpec:b.styleSpec}));break;case"has":case"!has":z=Zi(d[1]),d.length!==2?j.push(new Ut(w,d,`filter array for "${d[0]}" operator must have 2 elements`)):z!=="string"&&j.push(new Ut(`${w}[1]`,d[1],`string expected, ${z} found`));break;case"within":z=Zi(d[1]),d.length!==2?j.push(new Ut(w,d,`filter array for "${d[0]}" operator must have 2 elements`)):z!=="object"&&j.push(new Ut(`${w}[1]`,d[1],`object expected, ${z} found`))}return j}function za(b,d){const w=b.key,C=b.style,z=b.styleSpec,j=b.value,H=b.objectKey,ee=z[`${d}_${b.layerType}`];if(!ee)return[];const ae=H.match(/^(.*)-transition$/);if(d==="paint"&&ae&&ee[ae[1]]&&ee[ae[1]].transition)return Rr({key:w,value:j,valueSpec:z.transition,style:C,styleSpec:z});const he=b.valueSpec||ee[H];if(!he)return[new Ut(w,j,`unknown property "${H}"`)];let be;if(Zi(j)==="string"&&Tn(he)&&!he.tokens&&(be=/^{([^}]+)}$/.exec(j)))return[new Ut(w,j,`"${H}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(be[1])} }\`.`)];const Te=[];return b.layerType==="symbol"&&(H==="text-field"&&C&&!C.glyphs&&Te.push(new Ut(w,j,'use of "text-field" requires a style "glyphs" property')),H==="text-font"&&Ao(Bi(j))&&Si(j.type)==="identity"&&Te.push(new Ut(w,j,'"text-font" does not support identity functions'))),Te.concat(Rr({key:b.key,value:j,valueSpec:he,style:C,styleSpec:z,expressionContext:"property",propertyType:d,propertyKey:H}))}function Na(b){return za(b,"paint")}function Ur(b){return za(b,"layout")}function Ua(b){let d=[];const w=b.value,C=b.key,z=b.style,j=b.styleSpec;w.type||w.ref||d.push(new Ut(C,w,'either "type" or "ref" is required'));let H=Si(w.type);const ee=Si(w.ref);if(w.id){const ae=Si(w.id);for(let he=0;he<b.arrayIndex;he++){const be=z.layers[he];Si(be.id)===ae&&d.push(new Ut(C,w.id,`duplicate layer id "${w.id}", previously used at line ${be.id.__line__}`))}}if("ref"in w){let ae;["type","source","source-layer","filter","layout"].forEach(he=>{he in w&&d.push(new Ut(C,w[he],`"${he}" is prohibited for ref layers`))}),z.layers.forEach(he=>{Si(he.id)===ee&&(ae=he)}),ae?ae.ref?d.push(new Ut(C,w.ref,"ref cannot reference another ref layer")):H=Si(ae.type):d.push(new Ut(C,w.ref,`ref layer "${ee}" not found`))}else if(H!=="background"&&H!=="sky")if(w.source){const ae=z.sources&&z.sources[w.source],he=ae&&Si(ae.type);ae?he==="vector"&&H==="raster"?d.push(new Ut(C,w.source,`layer "${w.id}" requires a raster source`)):he==="raster"&&H!=="raster"?d.push(new Ut(C,w.source,`layer "${w.id}" requires a vector source`)):he!=="vector"||w["source-layer"]?he==="raster-dem"&&H!=="hillshade"?d.push(new Ut(C,w.source,"raster-dem source can only be used with layer type 'hillshade'.")):H!=="line"||!w.paint||!w.paint["line-gradient"]||he==="geojson"&&ae.lineMetrics||d.push(new Ut(C,w,`layer "${w.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):d.push(new Ut(C,w,`layer "${w.id}" must specify a "source-layer"`)):d.push(new Ut(C,w.source,`source "${w.source}" not found`))}else d.push(new Ut(C,w,'missing required property "source"'));return d=d.concat(Kr({key:C,value:w,valueSpec:j.layer,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rr({key:`${C}.type`,value:w.type,valueSpec:j.layer.type,style:b.style,styleSpec:b.styleSpec,object:w,objectKey:"type"}),filter:ae=>Rs(ki({layerType:H},ae)),layout:ae=>Kr({layer:w,key:ae.key,value:ae.value,style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{"*":he=>Ur(ki({layerType:H},he))}}),paint:ae=>Kr({layer:w,key:ae.key,value:ae.value,style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{"*":he=>Na(ki({layerType:H},he))}})}})),d}function fa(b){const d=b.value,w=b.key,C=Zi(d);return C!=="string"?[new Ut(w,d,`string expected, ${C} found`)]:[]}const Ll={promoteId:function({key:b,value:d}){if(Zi(d)==="string")return fa({key:b,value:d});{const w=[];for(const C in d)w.push(...fa({key:`${b}.${C}`,value:d[C]}));return w}}};function Bl(b){const d=b.value,w=b.key,C=b.styleSpec,z=b.style;if(!d.type)return[new Ut(w,d,'"type" is required')];const j=Si(d.type);let H;switch(j){case"vector":case"raster":case"raster-dem":return H=Kr({key:w,value:d,valueSpec:C[`source_${j.replace("-","_")}`],style:b.style,styleSpec:C,objectElementValidators:Ll}),H;case"geojson":if(H=Kr({key:w,value:d,valueSpec:C.source_geojson,style:z,styleSpec:C,objectElementValidators:Ll}),d.cluster)for(const ee in d.clusterProperties){const[ae,he]=d.clusterProperties[ee],be=typeof ae=="string"?[ae,["accumulated"],["get",ee]]:ae;H.push(...In({key:`${w}.${ee}.map`,value:he,expressionContext:"cluster-map"})),H.push(...In({key:`${w}.${ee}.reduce`,value:be,expressionContext:"cluster-reduce"}))}return H;case"video":return Kr({key:w,value:d,valueSpec:C.source_video,style:z,styleSpec:C});case"image":return Kr({key:w,value:d,valueSpec:C.source_image,style:z,styleSpec:C});case"canvas":return[new Ut(w,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ua({key:`${w}.type`,value:d.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:z,styleSpec:C})}}function Ol(b){const d=b.value,w=b.styleSpec,C=w.light,z=b.style;let j=[];const H=Zi(d);if(d===void 0)return j;if(H!=="object")return j=j.concat([new Ut("light",d,`object expected, ${H} found`)]),j;for(const ee in d){const ae=ee.match(/^(.*)-transition$/);j=j.concat(ae&&C[ae[1]]&&C[ae[1]].transition?Rr({key:ee,value:d[ee],valueSpec:w.transition,style:z,styleSpec:w}):C[ee]?Rr({key:ee,value:d[ee],valueSpec:C[ee],style:z,styleSpec:w}):[new Ut(ee,d[ee],`unknown property "${ee}"`)])}return j}function Bo(b){const d=b.value,w=b.key,C=b.style,z=b.styleSpec,j=z.terrain;let H=[];const ee=Zi(d);if(d===void 0)return H;if(ee!=="object")return H=H.concat([new Ut("terrain",d,`object expected, ${ee} found`)]),H;for(const ae in d){const he=ae.match(/^(.*)-transition$/);H=H.concat(he&&j[he[1]]&&j[he[1]].transition?Rr({key:ae,value:d[ae],valueSpec:z.transition,style:C,styleSpec:z}):j[ae]?Rr({key:ae,value:d[ae],valueSpec:j[ae],style:C,styleSpec:z}):[new Ut(ae,d[ae],`unknown property "${ae}"`)])}if(d.source){const ae=C.sources&&C.sources[d.source],he=ae&&Si(ae.type);ae?he!=="raster-dem"&&H.push(new Ut(w,d.source,`terrain cannot be used with a source of type ${he}, it only be used with a "raster-dem" source type`)):H.push(new Ut(w,d.source,`source "${d.source}" not found`))}else H.push(new Ut(w,d,'terrain is missing required property "source"'));return H}function Fl(b){const d=b.value,w=b.style,C=b.styleSpec,z=C.fog;let j=[];const H=Zi(d);if(d===void 0)return j;if(H!=="object")return j=j.concat([new Ut("fog",d,`object expected, ${H} found`)]),j;for(const ee in d){const ae=ee.match(/^(.*)-transition$/);j=j.concat(ae&&z[ae[1]]&&z[ae[1]].transition?Rr({key:ee,value:d[ee],valueSpec:C.transition,style:w,styleSpec:C}):z[ee]?Rr({key:ee,value:d[ee],valueSpec:z[ee],style:w,styleSpec:C}):[new Ut(ee,d[ee],`unknown property "${ee}"`)])}return j}const Oo={"*":()=>[],array:ko,boolean:function(b){const d=b.value,w=b.key,C=Zi(d);return C!=="boolean"?[new Ut(w,d,`boolean expected, ${C} found`)]:[]},number:As,color:function(b){const d=b.key,w=b.value,C=Zi(w);return C!=="string"?[new Ut(d,w,`color expected, ${C} found`)]:tn.parseCSSColor(w)===null?[new Ut(d,w,`color expected, "${w}" found`)]:[]},constants:Mi,enum:ua,filter:Rs,function:Do,layer:Ua,object:Kr,source:Bl,light:Ol,terrain:Bo,fog:Fl,string:fa,formatted:function(b){return fa(b).length===0?[]:In(b)},resolvedImage:function(b){return fa(b).length===0?[]:In(b)},projection:function(b){const d=b.value,w=b.styleSpec,C=w.projection,z=b.style;let j=[];const H=Zi(d);if(H==="object")for(const ee in d)j=j.concat(Rr({key:ee,value:d[ee],valueSpec:C[ee],style:z,styleSpec:w}));else H!=="string"&&(j=j.concat([new Ut("projection",d,`object or string expected, ${H} found`)]));return j}};function Rr(b){const d=b.value,w=b.valueSpec,C=b.styleSpec;return w.expression&&Ao(Si(d))?Do(b):w.expression&&nn(Bi(d))?In(b):w.type&&Oo[w.type]?Oo[w.type](b):Kr(ki({},b,{valueSpec:w.type?C[w.type]:w}))}function qh(b){const d=b.value,w=b.key,C=fa(b);return C.length||(d.indexOf("{fontstack}")===-1&&C.push(new Ut(w,d,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&C.push(new Ut(w,d,'"glyphs" url must include a "{range}" token'))),C}function an(b,d=Ct){let w=[];return w=w.concat(Rr({key:"",value:b,valueSpec:d.$root,styleSpec:d,style:b,objectElementValidators:{glyphs:qh,"*":()=>[]}})),b.constants&&(w=w.concat(Mi({key:"constants",value:b.constants,style:b,styleSpec:d}))),zl(w)}function zl(b){return[].concat(b).sort((d,w)=>d.line-w.line)}function mn(b){return function(...d){return zl(b.apply(this,d))}}an.source=mn(Bl),an.light=mn(Ol),an.terrain=mn(Bo),an.fog=mn(Fl),an.layer=mn(Ua),an.filter=mn(Rs),an.paintProperty=mn(Na),an.layoutProperty=mn(Ur);const Wn=an,Xh=Wn.light,Ps=Wn.fog,Fo=Wn.paintProperty,Nl=Wn.layoutProperty;function Ul(b,d){let w=!1;if(d&&d.length)for(const C of d)b.fire(new _i(new Error(C.message))),w=!0;return w}var da=cn;function cn(b,d,w){var C=this.cells=[];if(b instanceof ArrayBuffer){this.arrayBuffer=b;var z=new Int32Array(this.arrayBuffer);b=z[0],this.d=(d=z[1])+2*(w=z[2]);for(var j=0;j<this.d*this.d;j++){var H=z[3+j],ee=z[3+j+1];C.push(H===ee?null:z.subarray(H,ee))}var ae=z[3+C.length+1];this.keys=z.subarray(z[3+C.length],ae),this.bboxes=z.subarray(ae),this.insert=this._insertReadonly}else{this.d=d+2*w;for(var he=0;he<this.d*this.d;he++)C.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=b,this.padding=w,this.scale=d/b,this.uid=0;var be=w/d*b;this.min=-be,this.max=b+be}cn.prototype.insert=function(b,d,w,C,z){this._forEachCell(d,w,C,z,this._insertCell,this.uid++),this.keys.push(b),this.bboxes.push(d),this.bboxes.push(w),this.bboxes.push(C),this.bboxes.push(z)},cn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},cn.prototype._insertCell=function(b,d,w,C,z,j){this.cells[z].push(j)},cn.prototype.query=function(b,d,w,C,z){var j=this.min,H=this.max;if(b<=j&&d<=j&&H<=w&&H<=C&&!z)return Array.prototype.slice.call(this.keys);var ee=[];return this._forEachCell(b,d,w,C,this._queryCell,ee,{},z),ee},cn.prototype._queryCell=function(b,d,w,C,z,j,H,ee){var ae=this.cells[z];if(ae!==null)for(var he=this.keys,be=this.bboxes,Te=0;Te<ae.length;Te++){var Re=ae[Te];if(H[Re]===void 0){var $e=4*Re;(ee?ee(be[$e+0],be[$e+1],be[$e+2],be[$e+3]):b<=be[$e+2]&&d<=be[$e+3]&&w>=be[$e+0]&&C>=be[$e+1])?(H[Re]=!0,j.push(he[Re])):H[Re]=!1}}},cn.prototype._forEachCell=function(b,d,w,C,z,j,H,ee){for(var ae=this._convertToCellCoord(b),he=this._convertToCellCoord(d),be=this._convertToCellCoord(w),Te=this._convertToCellCoord(C),Re=ae;Re<=be;Re++)for(var $e=he;$e<=Te;$e++){var qe=this.d*$e+Re;if((!ee||ee(this._convertFromCellCoord(Re),this._convertFromCellCoord($e),this._convertFromCellCoord(Re+1),this._convertFromCellCoord($e+1)))&&z.call(this,b,d,w,C,qe,j,H,ee))return}},cn.prototype._convertFromCellCoord=function(b){return(b-this.padding)/this.scale},cn.prototype._convertToCellCoord=function(b){return Math.max(0,Math.min(this.d-1,Math.floor(b*this.scale)+this.padding))},cn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var b=this.cells,d=3+this.cells.length+1+1,w=0,C=0;C<this.cells.length;C++)w+=this.cells[C].length;var z=new Int32Array(d+w+this.keys.length+this.bboxes.length);z[0]=this.extent,z[1]=this.n,z[2]=this.padding;for(var j=d,H=0;H<b.length;H++){var ee=b[H];z[3+H]=j,z.set(ee,j),j+=ee.length}return z[3+b.length]=j,z.set(this.keys,j),z[3+b.length+1]=j+=this.keys.length,z.set(this.bboxes,j),j+=this.bboxes.length,z.buffer};const{ImageData:zo,ImageBitmap:$l}=D,$a={};function wi(b,d,w={}){Object.defineProperty(d,"_classRegistryKey",{value:b,writeable:!1}),$a[b]={klass:d,omit:w.omit||[],shallow:w.shallow||[]}}wi("Object",Object),da.serialize=function(b,d){const w=b.toArrayBuffer();return d&&d.push(w),{buffer:w}},da.deserialize=function(b){return new da(b.buffer)},wi("Grid",da),wi("Color",Gi),wi("Error",Error),wi("ResolvedImage",Xr),wi("StylePropertyFunction",ha),wi("StyleExpression",Ts,{omit:["_evaluator"]}),wi("ZoomDependentExpression",Io),wi("ZoomConstantExpression",An),wi("CompoundExpression",Dr,{omit:["_evaluate"]});for(const b in Gn)Gn[b]._classRegistryKey||wi(`Expression_${b}`,Gn[b]);function jl(b){return b&&typeof ArrayBuffer!="undefined"&&(b instanceof ArrayBuffer||b.constructor&&b.constructor.name==="ArrayBuffer")}function Ls(b){return $l&&b instanceof $l}function ja(b,d){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp)return b;if(jl(b)||Ls(b))return d&&d.push(b),b;if(ArrayBuffer.isView(b)){const w=b;return d&&d.push(w.buffer),w}if(b instanceof zo)return d&&d.push(b.data.buffer),b;if(Array.isArray(b)){const w=[];for(const C of b)w.push(ja(C,d));return w}if(typeof b=="object"){const w=b.constructor,C=w._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");const z=w.serialize?w.serialize(b,d):{};if(!w.serialize){for(const j in b){if(!b.hasOwnProperty(j)||$a[C].omit.indexOf(j)>=0)continue;const H=b[j];z[j]=$a[C].shallow.indexOf(j)>=0?H:ja(H,d)}b instanceof Error&&(z.message=b.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(z.$name=C),z}throw new Error("can't serialize object of type "+typeof b)}function Ga(b){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp||jl(b)||Ls(b)||ArrayBuffer.isView(b)||b instanceof zo)return b;if(Array.isArray(b))return b.map(Ga);if(typeof b=="object"){const d=b.$name||"Object",{klass:w}=$a[d];if(!w)throw new Error(`can't deserialize unregistered class ${d}`);if(w.deserialize)return w.deserialize(b);const C=Object.create(w.prototype);for(const z of Object.keys(b)){if(z==="$name")continue;const j=b[z];C[z]=$a[d].shallow.indexOf(z)>=0?j:Ga(j)}return C}throw new Error("can't deserialize object of type "+typeof b)}class Gl{constructor(){this.first=!0}update(d,w){const C=Math.floor(d);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=d,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=w):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=w),d!==this.lastZoom&&(this.lastZoom=d,this.lastFloorZoom=C,!0))}}const Vl=b=>b>=1536&&b<=1791,Zl=b=>b>=1872&&b<=1919,Hl=b=>b>=2208&&b<=2303,Wl=b=>b>=11904&&b<=12031,Va=b=>b>=12032&&b<=12255,ql=b=>b>=12272&&b<=12287,No=b=>b>=12288&&b<=12351,pa=b=>b>=12352&&b<=12447,Uo=b=>b>=12448&&b<=12543,Bs=b=>b>=12544&&b<=12591,Xl=b=>b>=12704&&b<=12735,Os=b=>b>=12736&&b<=12783,Fs=b=>b>=12784&&b<=12799,zs=b=>b>=12800&&b<=13055,Ns=b=>b>=13056&&b<=13311,$o=b=>b>=13312&&b<=19903,Za=b=>b>=19968&&b<=40959,Yl=b=>b>=40960&&b<=42127,Kl=b=>b>=42128&&b<=42191,Ha=b=>b>=44032&&b<=55215,Jl=b=>b>=63744&&b<=64255,kn=b=>b>=64336&&b<=65023,Ql=b=>b>=65040&&b<=65055,Wa=b=>b>=65072&&b<=65103,eh=b=>b>=65104&&b<=65135,Us=b=>b>=65136&&b<=65279,$s=b=>b>=65280&&b<=65519;function Dn(b){for(const d of b)if(js(d.charCodeAt(0)))return!0;return!1}function jo(b){for(const d of b)if(!qa(d.charCodeAt(0)))return!1;return!0}function qa(b){return!(Vl(b)||Zl(b)||Hl(b)||kn(b)||Us(b))}function js(b){return!(b!==746&&b!==747&&(b<4352||!(Xl(b)||Bs(b)||Wa(b)&&!(b>=65097&&b<=65103)||Jl(b)||Ns(b)||Wl(b)||Os(b)||!(!No(b)||b>=12296&&b<=12305||b>=12308&&b<=12319||b===12336)||$o(b)||Za(b)||zs(b)||(d=>d>=12592&&d<=12687)(b)||(d=>d>=43360&&d<=43391)(b)||(d=>d>=55216&&d<=55295)(b)||(d=>d>=4352&&d<=4607)(b)||Ha(b)||pa(b)||ql(b)||(d=>d>=12688&&d<=12703)(b)||Va(b)||Fs(b)||Uo(b)&&b!==12540||!(!$s(b)||b===65288||b===65289||b===65293||b>=65306&&b<=65310||b===65339||b===65341||b===65343||b>=65371&&b<=65503||b===65507||b>=65512&&b<=65519)||!(!eh(b)||b>=65112&&b<=65118||b>=65123&&b<=65126)||(d=>d>=5120&&d<=5759)(b)||(d=>d>=6320&&d<=6399)(b)||Ql(b)||(d=>d>=19904&&d<=19967)(b)||Yl(b)||Kl(b))))}function Gs(b){return!(js(b)||function(d){return!!((w=>w>=128&&w<=255)(d)&&(d===167||d===169||d===174||d===177||d===188||d===189||d===190||d===215||d===247)||(w=>w>=8192&&w<=8303)(d)&&(d===8214||d===8224||d===8225||d===8240||d===8241||d===8251||d===8252||d===8258||d===8263||d===8264||d===8265||d===8273)||(w=>w>=8448&&w<=8527)(d)||(w=>w>=8528&&w<=8591)(d)||(w=>w>=8960&&w<=9215)(d)&&(d>=8960&&d<=8967||d>=8972&&d<=8991||d>=8996&&d<=9e3||d===9003||d>=9085&&d<=9114||d>=9150&&d<=9165||d===9167||d>=9169&&d<=9179||d>=9186&&d<=9215)||(w=>w>=9216&&w<=9279)(d)&&d!==9251||(w=>w>=9280&&w<=9311)(d)||(w=>w>=9312&&w<=9471)(d)||(w=>w>=9632&&w<=9727)(d)||(w=>w>=9728&&w<=9983)(d)&&!(d>=9754&&d<=9759)||(w=>w>=11008&&w<=11263)(d)&&(d>=11026&&d<=11055||d>=11088&&d<=11097||d>=11192&&d<=11243)||No(d)||Uo(d)||(w=>w>=57344&&w<=63743)(d)||Wa(d)||eh(d)||$s(d)||d===8734||d===8756||d===8757||d>=9984&&d<=10087||d>=10102&&d<=10131||d===65532||d===65533)}(b))}function ma(b){return b>=1424&&b<=2303||kn(b)||Us(b)}function Yh(b,d){return!(!d&&ma(b)||b>=2304&&b<=3583||b>=3840&&b<=4255||(w=>w>=6016&&w<=6143)(b))}function Kh(b){for(const d of b)if(ma(d.charCodeAt(0)))return!0;return!1}const ga="deferred",$="loading",y="loaded";let L=null,G="unavailable",K=null;const Q=function(b){b&&typeof b=="string"&&b.indexOf("NetworkError")>-1&&(G="error"),L&&L(b)};function se(){ge.fire(new Ht("pluginStateChange",{pluginStatus:G,pluginURL:K}))}const ge=new ai,Ce=function(){return G},Oe=function(){if(G!==ga||!K)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");G=$,se(),K&&Se({url:K},b=>{b?Q(b):(G=y,se())})},Fe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>G===y||Fe.applyArabicShaping!=null,isLoading:()=>G===$,setState(b){G=b.pluginStatus,K=b.pluginURL},isParsed:()=>Fe.applyArabicShaping!=null&&Fe.processBidirectionalText!=null&&Fe.processStyledBidirectionalText!=null,getPluginURL:()=>K};class Ue{constructor(d,w){this.zoom=d,w?(this.now=w.now,this.fadeDuration=w.fadeDuration,this.zoomHistory=w.zoomHistory,this.transition=w.transition,this.pitch=w.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gl,this.transition={},this.pitch=0)}isSupportedScript(d){return function(w,C){for(const z of w)if(!Yh(z.charCodeAt(0),C))return!1;return!0}(d,Fe.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const d=this.zoom,w=d-Math.floor(d),C=this.crossFadingFactor();return d>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:w+(1-w)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*w}}}class Qe{constructor(d,w){this.property=d,this.value=w,this.expression=function(C,z){if(Ao(C))return new ha(C,z);if(nn(C)){const j=Il(C,z);if(j.result==="error")throw new Error(j.value.map(H=>`${H.key}: ${H.message}`).join(", "));return j.value}{let j=C;return typeof C=="string"&&z.type==="color"&&(j=Gi.parse(C)),{kind:"constant",evaluate:()=>j}}}(w===void 0?d.specification.default:w,d.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(d,w,C){return this.property.possiblyEvaluate(this,d,w,C)}}class ht{constructor(d){this.property=d,this.value=new Qe(d,void 0)}transitioned(d,w){return new at(this.property,this.value,w,te({},d.transition,this.transition),d.now)}untransitioned(){return new at(this.property,this.value,null,{},0)}}class ct{constructor(d){this._properties=d,this._values=Object.create(d.defaultTransitionablePropertyValues)}getValue(d){return Ze(this._values[d].value.value)}setValue(d,w){this._values.hasOwnProperty(d)||(this._values[d]=new ht(this._values[d].property)),this._values[d].value=new Qe(this._values[d].property,w===null?void 0:Ze(w))}getTransition(d){return Ze(this._values[d].transition)}setTransition(d,w){this._values.hasOwnProperty(d)||(this._values[d]=new ht(this._values[d].property)),this._values[d].transition=Ze(w)||void 0}serialize(){const d={};for(const w of Object.keys(this._values)){const C=this.getValue(w);C!==void 0&&(d[w]=C);const z=this.getTransition(w);z!==void 0&&(d[`${w}-transition`]=z)}return d}transitioned(d,w){const C=new mt(this._properties);for(const z of Object.keys(this._values))C._values[z]=this._values[z].transitioned(d,w._values[z]);return C}untransitioned(){const d=new mt(this._properties);for(const w of Object.keys(this._values))d._values[w]=this._values[w].untransitioned();return d}}class at{constructor(d,w,C,z,j){const H=z.delay||0,ee=z.duration||0;j=j||0,this.property=d,this.value=w,this.begin=j+H,this.end=this.begin+ee,d.specification.transition&&(z.delay||z.duration)&&(this.prior=C)}possiblyEvaluate(d,w,C){const z=d.now||0,j=this.value.possiblyEvaluate(d,w,C),H=this.prior;if(H){if(z>this.end)return this.prior=null,j;if(this.value.isDataDriven())return this.prior=null,j;if(z<this.begin)return H.possiblyEvaluate(d,w,C);{const ee=(z-this.begin)/(this.end-this.begin);return this.property.interpolate(H.possiblyEvaluate(d,w,C),j,V(ee))}}return j}}class mt{constructor(d){this._properties=d,this._values=Object.create(d.defaultTransitioningPropertyValues)}possiblyEvaluate(d,w,C){const z=new xt(this._properties);for(const j of Object.keys(this._values))z._values[j]=this._values[j].possiblyEvaluate(d,w,C);return z}hasTransition(){for(const d of Object.keys(this._values))if(this._values[d].prior)return!0;return!1}}class st{constructor(d){this._properties=d,this._values=Object.create(d.defaultPropertyValues)}getValue(d){return Ze(this._values[d].value)}setValue(d,w){this._values[d]=new Qe(this._values[d].property,w===null?void 0:Ze(w))}serialize(){const d={};for(const w of Object.keys(this._values)){const C=this.getValue(w);C!==void 0&&(d[w]=C)}return d}possiblyEvaluate(d,w,C){const z=new xt(this._properties);for(const j of Object.keys(this._values))z._values[j]=this._values[j].possiblyEvaluate(d,w,C);return z}}class gt{constructor(d,w,C){this.property=d,this.value=w,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(d){return this.value.kind==="constant"?this.value.value:d}evaluate(d,w,C,z){return this.property.evaluate(this.value,this.parameters,d,w,C,z)}}class xt{constructor(d){this._properties=d,this._values=Object.create(d.defaultPossiblyEvaluatedValues)}get(d){return this._values[d]}}class ut{constructor(d){this.specification=d}possiblyEvaluate(d,w){return d.expression.evaluate(w)}interpolate(d,w,C){const z=Pa[this.specification.type];return z?z(d,w,C):d}}class Et{constructor(d,w){this.specification=d,this.overrides=w}possiblyEvaluate(d,w,C,z){return new gt(this,d.expression.kind==="constant"||d.expression.kind==="camera"?{kind:"constant",value:d.expression.evaluate(w,null,{},C,z)}:d.expression,w)}interpolate(d,w,C){if(d.value.kind!=="constant"||w.value.kind!=="constant")return d;if(d.value.value===void 0||w.value.value===void 0)return new gt(this,{kind:"constant",value:void 0},d.parameters);const z=Pa[this.specification.type];return z?new gt(this,{kind:"constant",value:z(d.value.value,w.value.value,C)},d.parameters):d}evaluate(d,w,C,z,j,H){return d.kind==="constant"?d.value:d.evaluate(w,C,z,j,H)}}class kt extends Et{possiblyEvaluate(d,w,C,z){if(d.value===void 0)return new gt(this,{kind:"constant",value:void 0},w);if(d.expression.kind==="constant"){const j=d.expression.evaluate(w,null,{},C,z),H=d.property.specification.type==="resolvedImage"&&typeof j!="string"?j.name:j,ee=this._calculate(H,H,H,w);return new gt(this,{kind:"constant",value:ee},w)}if(d.expression.kind==="camera"){const j=this._calculate(d.expression.evaluate({zoom:w.zoom-1}),d.expression.evaluate({zoom:w.zoom}),d.expression.evaluate({zoom:w.zoom+1}),w);return new gt(this,{kind:"constant",value:j},w)}return new gt(this,d.expression,w)}evaluate(d,w,C,z,j,H){if(d.kind==="source"){const ee=d.evaluate(w,C,z,j,H);return this._calculate(ee,ee,ee,w)}return d.kind==="composite"?this._calculate(d.evaluate({zoom:Math.floor(w.zoom)-1},C,z),d.evaluate({zoom:Math.floor(w.zoom)},C,z),d.evaluate({zoom:Math.floor(w.zoom)+1},C,z),w):d.value}_calculate(d,w,C,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:d,to:w,other:C}:{from:C,to:w,other:d}}interpolate(d){return d}}class Wt{constructor(d){this.specification=d}possiblyEvaluate(d,w,C,z){if(d.value!==void 0){if(d.expression.kind==="constant"){const j=d.expression.evaluate(w,null,{},C,z);return this._calculate(j,j,j,w)}return this._calculate(d.expression.evaluate(new Ue(Math.floor(w.zoom-1),w)),d.expression.evaluate(new Ue(Math.floor(w.zoom),w)),d.expression.evaluate(new Ue(Math.floor(w.zoom+1),w)),w)}}_calculate(d,w,C,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:d,to:w}:{from:C,to:w}}interpolate(d){return d}}class Zt{constructor(d){this.specification=d}possiblyEvaluate(d,w,C,z){return!!d.expression.evaluate(w,null,{},C,z)}interpolate(){return!1}}class Jt{constructor(d){this.properties=d,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const w in d){const C=d[w];C.specification.overridable&&this.overridableProperties.push(w);const z=this.defaultPropertyValues[w]=new Qe(C,void 0),j=this.defaultTransitionablePropertyValues[w]=new ht(C);this.defaultTransitioningPropertyValues[w]=j.untransitioned(),this.defaultPossiblyEvaluatedValues[w]=z.possiblyEvaluate({})}}}function Qt(b,d){return 256*(b=Y(Math.floor(b),0,255))+Y(Math.floor(d),0,255)}wi("DataDrivenProperty",Et),wi("DataConstantProperty",ut),wi("CrossFadedDataDrivenProperty",kt),wi("CrossFadedProperty",Wt),wi("ColorRampProperty",Zt);const ci={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kt{constructor(d,w){this._structArray=d,this._pos1=w*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(d,w){return d._trim(),w&&(d.isTransferred=!0,w.push(d.arrayBuffer)),{length:d.length,arrayBuffer:d.arrayBuffer}}static deserialize(d){const w=Object.create(this.prototype);return w.arrayBuffer=d.arrayBuffer,w.length=d.length,w.capacity=d.arrayBuffer.byteLength/w.bytesPerElement,w._refreshViews(),w}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(d){this.reserve(d),this.length=d}reserve(d){if(d>this.capacity){this.capacity=Math.max(d,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const w=this.uint8;this._refreshViews(),w&&this.uint8.set(w)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gt(b,d=1){let w=0,C=0;return{members:b.map(z=>{const j=ci[z.type].BYTES_PER_ELEMENT,H=w=pi(w,Math.max(d,j)),ee=z.components||1;return C=Math.max(C,j),w+=j*ee,{name:z.name,type:z.type,components:ee,offset:H}}),size:pi(w,Math.max(C,d)),alignment:d}}function pi(b,d){return Math.ceil(b/d)*d}class Ei extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,w){const C=this.length;return this.resize(C+1),this.emplace(C,d,w)}emplace(d,w,C){const z=2*d;return this.int16[z+0]=w,this.int16[z+1]=C,d}}Ei.prototype.bytesPerElement=4,wi("StructArrayLayout2i4",Ei);class Ai extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,w,C,z){const j=this.length;return this.resize(j+1),this.emplace(j,d,w,C,z)}emplace(d,w,C,z,j){const H=4*d;return this.int16[H+0]=w,this.int16[H+1]=C,this.int16[H+2]=z,this.int16[H+3]=j,d}}Ai.prototype.bytesPerElement=8,wi("StructArrayLayout4i8",Ai);class Ci extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,d,w,C,z,j,H,ee)}emplace(d,w,C,z,j,H,ee,ae){const he=6*d,be=12*d,Te=3*d;return this.int16[he+0]=w,this.int16[he+1]=C,this.uint8[be+4]=z,this.uint8[be+5]=j,this.uint8[be+6]=H,this.uint8[be+7]=ee,this.float32[Te+2]=ae,d}}Ci.prototype.bytesPerElement=12,wi("StructArrayLayout2i4ub1f12",Ci);class Di extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,w,C){const z=this.length;return this.resize(z+1),this.emplace(z,d,w,C)}emplace(d,w,C,z){const j=3*d;return this.float32[j+0]=w,this.float32[j+1]=C,this.float32[j+2]=z,d}}Di.prototype.bytesPerElement=12,wi("StructArrayLayout3f12",Di);class Ri extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae,he,be){const Te=this.length;return this.resize(Te+1),this.emplace(Te,d,w,C,z,j,H,ee,ae,he,be)}emplace(d,w,C,z,j,H,ee,ae,he,be,Te){const Re=10*d;return this.uint16[Re+0]=w,this.uint16[Re+1]=C,this.uint16[Re+2]=z,this.uint16[Re+3]=j,this.uint16[Re+4]=H,this.uint16[Re+5]=ee,this.uint16[Re+6]=ae,this.uint16[Re+7]=he,this.uint16[Re+8]=be,this.uint16[Re+9]=Te,d}}Ri.prototype.bytesPerElement=20,wi("StructArrayLayout10ui20",Ri);class Ti extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae){const he=this.length;return this.resize(he+1),this.emplace(he,d,w,C,z,j,H,ee,ae)}emplace(d,w,C,z,j,H,ee,ae,he){const be=8*d;return this.uint16[be+0]=w,this.uint16[be+1]=C,this.uint16[be+2]=z,this.uint16[be+3]=j,this.uint16[be+4]=H,this.uint16[be+5]=ee,this.uint16[be+6]=ae,this.uint16[be+7]=he,d}}Ti.prototype.bytesPerElement=16,wi("StructArrayLayout8ui16",Ti);class Pi extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt)}emplace(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt){const Mt=16*d;return this.int16[Mt+0]=w,this.int16[Mt+1]=C,this.int16[Mt+2]=z,this.int16[Mt+3]=j,this.uint16[Mt+4]=H,this.uint16[Mt+5]=ee,this.uint16[Mt+6]=ae,this.uint16[Mt+7]=he,this.int16[Mt+8]=be,this.int16[Mt+9]=Te,this.int16[Mt+10]=Re,this.int16[Mt+11]=$e,this.int16[Mt+12]=qe,this.int16[Mt+13]=rt,this.int16[Mt+14]=dt,this.int16[Mt+15]=yt,d}}Pi.prototype.bytesPerElement=32,wi("StructArrayLayout4i4ui4i4i32",Pi);class Wi extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(d){const w=this.length;return this.resize(w+1),this.emplace(w,d)}emplace(d,w){return this.uint32[1*d+0]=w,d}}Wi.prototype.bytesPerElement=4,wi("StructArrayLayout1ul4",Wi);class gr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e){const qe=this.length;return this.resize(qe+1),this.emplace(qe,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e)}emplace(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe){const rt=20*d,dt=10*d;return this.int16[rt+0]=w,this.int16[rt+1]=C,this.int16[rt+2]=z,this.int16[rt+3]=j,this.int16[rt+4]=H,this.float32[dt+3]=ee,this.float32[dt+4]=ae,this.float32[dt+5]=he,this.float32[dt+6]=be,this.int16[rt+14]=Te,this.uint32[dt+8]=Re,this.uint16[rt+18]=$e,this.uint16[rt+19]=qe,d}}gr.prototype.bytesPerElement=40,wi("StructArrayLayout5i4f1i1ul2ui40",gr);class Tr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,d,w,C,z,j,H,ee)}emplace(d,w,C,z,j,H,ee,ae){const he=8*d;return this.int16[he+0]=w,this.int16[he+1]=C,this.int16[he+2]=z,this.int16[he+4]=j,this.int16[he+5]=H,this.int16[he+6]=ee,this.int16[he+7]=ae,d}}Tr.prototype.bytesPerElement=16,wi("StructArrayLayout3i2i2i16",Tr);class Pr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j){const H=this.length;return this.resize(H+1),this.emplace(H,d,w,C,z,j)}emplace(d,w,C,z,j,H){const ee=4*d,ae=8*d;return this.float32[ee+0]=w,this.float32[ee+1]=C,this.float32[ee+2]=z,this.int16[ae+6]=j,this.int16[ae+7]=H,d}}Pr.prototype.bytesPerElement=16,wi("StructArrayLayout2f1f2i16",Pr);class Fr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,w,C,z){const j=this.length;return this.resize(j+1),this.emplace(j,d,w,C,z)}emplace(d,w,C,z,j){const H=12*d,ee=3*d;return this.uint8[H+0]=w,this.uint8[H+1]=C,this.float32[ee+1]=z,this.float32[ee+2]=j,d}}Fr.prototype.bytesPerElement=12,wi("StructArrayLayout2ub2f12",Fr);class _r extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C){const z=this.length;return this.resize(z+1),this.emplace(z,d,w,C)}emplace(d,w,C,z){const j=3*d;return this.uint16[j+0]=w,this.uint16[j+1]=C,this.uint16[j+2]=z,d}}_r.prototype.bytesPerElement=6,wi("StructArrayLayout3ui6",_r);class gn extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt)}emplace(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt,Ft){const ei=30*d,Xt=15*d,yi=60*d;return this.int16[ei+0]=w,this.int16[ei+1]=C,this.int16[ei+2]=z,this.float32[Xt+2]=j,this.float32[Xt+3]=H,this.uint16[ei+8]=ee,this.uint16[ei+9]=ae,this.uint32[Xt+5]=he,this.uint32[Xt+6]=be,this.uint32[Xt+7]=Te,this.uint16[ei+16]=Re,this.uint16[ei+17]=$e,this.uint16[ei+18]=qe,this.float32[Xt+10]=rt,this.float32[Xt+11]=dt,this.uint8[yi+48]=yt,this.uint8[yi+49]=Mt,this.uint8[yi+50]=Pt,this.uint32[Xt+13]=Ot,this.int16[ei+28]=Lt,this.uint8[yi+58]=Ft,d}}gn.prototype.bytesPerElement=60,wi("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",gn);class fn extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt,Ft,ei,Xt,yi,oi,ti,si,ui,ni){const vi=this.length;return this.resize(vi+1),this.emplace(vi,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt,Ft,ei,Xt,yi,oi,ti,si,ui,ni)}emplace(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt,yt,Mt,Pt,Ot,Lt,Ft,ei,Xt,yi,oi,ti,si,ui,ni,vi){const bi=38*d,Li=19*d;return this.int16[bi+0]=w,this.int16[bi+1]=C,this.int16[bi+2]=z,this.float32[Li+2]=j,this.float32[Li+3]=H,this.int16[bi+8]=ee,this.int16[bi+9]=ae,this.int16[bi+10]=he,this.int16[bi+11]=be,this.int16[bi+12]=Te,this.int16[bi+13]=Re,this.uint16[bi+14]=$e,this.uint16[bi+15]=qe,this.uint16[bi+16]=rt,this.uint16[bi+17]=dt,this.uint16[bi+18]=yt,this.uint16[bi+19]=Mt,this.uint16[bi+20]=Pt,this.uint16[bi+21]=Ot,this.uint16[bi+22]=Lt,this.uint16[bi+23]=Ft,this.uint16[bi+24]=ei,this.uint16[bi+25]=Xt,this.uint16[bi+26]=yi,this.uint16[bi+27]=oi,this.uint16[bi+28]=ti,this.uint32[Li+15]=si,this.float32[Li+16]=ui,this.float32[Li+17]=ni,this.float32[Li+18]=vi,d}}fn.prototype.bytesPerElement=76,wi("StructArrayLayout3i2f6i15ui1ul3f76",fn);class rr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d){const w=this.length;return this.resize(w+1),this.emplace(w,d)}emplace(d,w){return this.float32[1*d+0]=w,d}}rr.prototype.bytesPerElement=4,wi("StructArrayLayout1f4",rr);class ur extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(d,w,C){const z=this.length;return this.resize(z+1),this.emplace(z,d,w,C)}emplace(d,w,C,z){const j=3*d;return this.int16[j+0]=w,this.int16[j+1]=C,this.int16[j+2]=z,d}}ur.prototype.bytesPerElement=6,wi("StructArrayLayout3i6",ur);class $i extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w,C,z){const j=this.length;return this.resize(j+1),this.emplace(j,d,w,C,z)}emplace(d,w,C,z,j){const H=6*d;return this.uint32[3*d+0]=w,this.uint16[H+2]=C,this.uint16[H+3]=z,this.uint16[H+4]=j,d}}$i.prototype.bytesPerElement=12,wi("StructArrayLayout1ul3ui12",$i);class or extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d,w){const C=this.length;return this.resize(C+1),this.emplace(C,d,w)}emplace(d,w,C){const z=2*d;return this.uint16[z+0]=w,this.uint16[z+1]=C,d}}or.prototype.bytesPerElement=4,wi("StructArrayLayout2ui4",or);class Ar extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(d){const w=this.length;return this.resize(w+1),this.emplace(w,d)}emplace(d,w){return this.uint16[1*d+0]=w,d}}Ar.prototype.bytesPerElement=2,wi("StructArrayLayout1ui2",Ar);class nr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,w){const C=this.length;return this.resize(C+1),this.emplace(C,d,w)}emplace(d,w,C){const z=2*d;return this.float32[z+0]=w,this.float32[z+1]=C,d}}nr.prototype.bytesPerElement=8,wi("StructArrayLayout2f8",nr);class Hr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(d,w,C,z){const j=this.length;return this.resize(j+1),this.emplace(j,d,w,C,z)}emplace(d,w,C,z,j){const H=4*d;return this.float32[H+0]=w,this.float32[H+1]=C,this.float32[H+2]=z,this.float32[H+3]=j,d}}Hr.prototype.bytesPerElement=16,wi("StructArrayLayout4f16",Hr);class Xa extends Kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xa.prototype.size=40;class $r extends gr{get(d){return new Xa(this,d)}}wi("CollisionBoxArray",$r);class Rn extends Kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(d){this._structArray.uint8[this._pos1+49]=d}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(d){this._structArray.uint8[this._pos1+50]=d}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(d){this._structArray.uint32[this._pos4+13]=d}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(d){this._structArray.uint8[this._pos1+58]=d}}Rn.prototype.size=60;class th extends gn{get(d){return new Rn(this,d)}}wi("PlacedSymbolArray",th);class Go extends Kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(d){this._structArray.uint32[this._pos4+15]=d}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Go.prototype.size=76;class _a extends fn{get(d){return new Go(this,d)}}wi("SymbolInstanceArray",_a);class ih extends rr{getoffsetX(d){return this.float32[1*d+0]}}wi("GlyphOffsetArray",ih);class Ya extends ur{getx(d){return this.int16[3*d+0]}gety(d){return this.int16[3*d+1]}gettileUnitDistanceFromAnchor(d){return this.int16[3*d+2]}}wi("SymbolLineVertexArray",Ya);class Vo extends Kt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vo.prototype.size=12;class Xu extends $i{get(d){return new Vo(this,d)}}wi("FeatureIndexArray",Xu);class Yu extends Kt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Yu.prototype.size=4;class Ku extends or{get(d){return new Yu(this,d)}}wi("FillExtrusionCentroidArray",Ku);const Qf=Gt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ed=Gt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ju=ao(function(b){b.exports=function(d,w){var C,z,j,H,ee,ae,he,be;for(z=d.length-(C=3&d.length),j=w,ee=3432918353,ae=461845907,be=0;be<z;)he=255&d.charCodeAt(be)|(255&d.charCodeAt(++be))<<8|(255&d.charCodeAt(++be))<<16|(255&d.charCodeAt(++be))<<24,++be,j=27492+(65535&(H=5*(65535&(j=(j^=he=(65535&(he=(he=(65535&he)*ee+(((he>>>16)*ee&65535)<<16)&4294967295)<<15|he>>>17))*ae+(((he>>>16)*ae&65535)<<16)&4294967295)<<13|j>>>19))+((5*(j>>>16)&65535)<<16)&4294967295))+((58964+(H>>>16)&65535)<<16);switch(he=0,C){case 3:he^=(255&d.charCodeAt(be+2))<<16;case 2:he^=(255&d.charCodeAt(be+1))<<8;case 1:j^=he=(65535&(he=(he=(65535&(he^=255&d.charCodeAt(be)))*ee+(((he>>>16)*ee&65535)<<16)&4294967295)<<15|he>>>17))*ae+(((he>>>16)*ae&65535)<<16)&4294967295}return j^=d.length,j=2246822507*(65535&(j^=j>>>16))+((2246822507*(j>>>16)&65535)<<16)&4294967295,j=3266489909*(65535&(j^=j>>>13))+((3266489909*(j>>>16)&65535)<<16)&4294967295,(j^=j>>>16)>>>0}}),td=ao(function(b){b.exports=function(d,w){for(var C,z=d.length,j=w^z,H=0;z>=4;)C=1540483477*(65535&(C=255&d.charCodeAt(H)|(255&d.charCodeAt(++H))<<8|(255&d.charCodeAt(++H))<<16|(255&d.charCodeAt(++H))<<24))+((1540483477*(C>>>16)&65535)<<16),j=1540483477*(65535&j)+((1540483477*(j>>>16)&65535)<<16)^(C=1540483477*(65535&(C^=C>>>24))+((1540483477*(C>>>16)&65535)<<16)),z-=4,++H;switch(z){case 3:j^=(255&d.charCodeAt(H+2))<<16;case 2:j^=(255&d.charCodeAt(H+1))<<8;case 1:j=1540483477*(65535&(j^=255&d.charCodeAt(H)))+((1540483477*(j>>>16)&65535)<<16)}return j=1540483477*(65535&(j^=j>>>13))+((1540483477*(j>>>16)&65535)<<16),(j^=j>>>15)>>>0}}),Vs=Ju,id=td;Vs.murmur3=Ju,Vs.murmur2=id;class rh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(d,w,C,z){this.ids.push(Qu(d)),this.positions.push(w,C,z)}getPositions(d){const w=Qu(d);let C=0,z=this.ids.length-1;for(;C<z;){const H=C+z>>1;this.ids[H]>=w?z=H:C=H+1}const j=[];for(;this.ids[C]===w;)j.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return j}static serialize(d,w){const C=new Float64Array(d.ids),z=new Uint32Array(d.positions);return Jh(C,z,0,C.length-1),w&&w.push(C.buffer,z.buffer),{ids:C,positions:z}}static deserialize(d){const w=new rh;return w.ids=d.ids,w.positions=d.positions,w.indexed=!0,w}}function Qu(b){const d=+b;return!isNaN(d)&&d<=M?d:Vs(String(b))}function Jh(b,d,w,C){for(;w<C;){const z=b[w+C>>1];let j=w-1,H=C+1;for(;;){do j++;while(b[j]<z);do H--;while(b[H]>z);if(j>=H)break;nh(b,j,H),nh(d,3*j,3*H),nh(d,3*j+1,3*H+1),nh(d,3*j+2,3*H+2)}H-w<C-H?(Jh(b,d,w,H),w=H+1):(Jh(b,d,H+1,C),C=H)}}function nh(b,d,w){const C=b[d];b[d]=b[w],b[w]=C}wi("FeaturePositionMap",rh);class qn{constructor(d,w){this.gl=d.gl,this.location=w}}class ah extends qn{constructor(d,w){super(d,w),this.current=0}set(d){this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class ec extends qn{constructor(d,w){super(d,w),this.current=[0,0,0,0]}set(d){d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3]))}}class tc extends qn{constructor(d,w){super(d,w),this.current=Gi.transparent}set(d){d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a))}}const rd=new Float32Array(16),nd=new Float32Array(9),ad=new Float32Array(4);function Qh(b){return[Qt(255*b.r,255*b.g),Qt(255*b.b,255*b.a)]}class Zs{constructor(d,w,C){this.value=d,this.uniformNames=w.map(z=>`u_${z}`),this.type=C}setUniform(d,w,C){d.set(C.constantOr(this.value))}getBinding(d,w,C){return this.type==="color"?new tc(d,w):new ah(d,w)}}class Zo{constructor(d,w){this.uniformNames=w.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(d,w){this.pixelRatioFrom=w.pixelRatio,this.pixelRatioTo=d.pixelRatio,this.patternFrom=w.tl.concat(w.br),this.patternTo=d.tl.concat(d.br)}setUniform(d,w,C,z){const j=z==="u_pattern_to"||z==="u_dash_to"?this.patternTo:z==="u_pattern_from"||z==="u_dash_from"?this.patternFrom:z==="u_pixel_ratio_to"?this.pixelRatioTo:z==="u_pixel_ratio_from"?this.pixelRatioFrom:null;j&&d.set(j)}getBinding(d,w,C){return C==="u_pattern_from"||C==="u_pattern_to"||C==="u_dash_from"||C==="u_dash_to"?new ec(d,w):new ah(d,w)}}class Xn{constructor(d,w,C,z){this.expression=d,this.type=C,this.maxValue=0,this.paintVertexAttributes=w.map(j=>({name:`a_${j}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new z}populatePaintArray(d,w,C,z,j,H){const ee=this.paintVertexArray.length,ae=this.expression.evaluate(new Ue(0),w,{},j,z,H);this.paintVertexArray.resize(d),this._setPaintValue(ee,d,ae)}updatePaintArray(d,w,C,z,j){const H=this.expression.evaluate({zoom:0},C,z,void 0,j);this._setPaintValue(d,w,H)}_setPaintValue(d,w,C){if(this.type==="color"){const z=Qh(C);for(let j=d;j<w;j++)this.paintVertexArray.emplace(j,z[0],z[1])}else{for(let z=d;z<w;z++)this.paintVertexArray.emplace(z,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(d){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=d.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _n{constructor(d,w,C,z,j,H){this.expression=d,this.uniformNames=w.map(ee=>`u_${ee}_t`),this.type=C,this.useIntegerZoom=z,this.zoom=j,this.maxValue=0,this.paintVertexAttributes=w.map(ee=>({name:`a_${ee}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new H}populatePaintArray(d,w,C,z,j,H){const ee=this.expression.evaluate(new Ue(this.zoom),w,{},j,z,H),ae=this.expression.evaluate(new Ue(this.zoom+1),w,{},j,z,H),he=this.paintVertexArray.length;this.paintVertexArray.resize(d),this._setPaintValue(he,d,ee,ae)}updatePaintArray(d,w,C,z,j){const H=this.expression.evaluate({zoom:this.zoom},C,z,void 0,j),ee=this.expression.evaluate({zoom:this.zoom+1},C,z,void 0,j);this._setPaintValue(d,w,H,ee)}_setPaintValue(d,w,C,z){if(this.type==="color"){const j=Qh(C),H=Qh(z);for(let ee=d;ee<w;ee++)this.paintVertexArray.emplace(ee,j[0],j[1],H[0],H[1])}else{for(let j=d;j<w;j++)this.paintVertexArray.emplace(j,C,z);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(z))}}upload(d){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=d.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(d,w){const C=this.useIntegerZoom?Math.floor(w.zoom):w.zoom,z=Y(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);d.set(z)}getBinding(d,w,C){return new ah(d,w)}}class ya{constructor(d,w,C,z,j,H,ee){this.expression=d,this.type=C,this.useIntegerZoom=z,this.zoom=j,this.layerId=ee,this.paintVertexAttributes=(C==="array"?ed:Qf).members;for(let ae=0;ae<w.length;++ae);this.zoomInPaintVertexArray=new H,this.zoomOutPaintVertexArray=new H}populatePaintArray(d,w,C){const z=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(d),this.zoomOutPaintVertexArray.resize(d),this._setPaintValues(z,d,w.patterns&&w.patterns[this.layerId],C)}updatePaintArray(d,w,C,z,j,H){this._setPaintValues(d,w,C.patterns&&C.patterns[this.layerId],H)}_setPaintValues(d,w,C,z){if(!z||!C)return;const{min:j,mid:H,max:ee}=C,ae=z[j],he=z[H],be=z[ee];if(ae&&he&&be)for(let Te=d;Te<w;Te++)this._setPaintValue(this.zoomInPaintVertexArray,Te,he,ae),this._setPaintValue(this.zoomOutPaintVertexArray,Te,he,be)}_setPaintValue(d,w,C,z){d.emplace(w,C.tl[0],C.tl[1],C.br[0],C.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],C.pixelRatio,z.pixelRatio)}upload(d){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=d.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=d.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yn{constructor(d,w,C=()=>!0){this.binders={},this._buffers=[];const z=[];for(const j in d.paint._values){if(!C(j))continue;const H=d.paint.get(j);if(!(H instanceof gt&&Tn(H.property.specification)))continue;const ee=sd(j,d.type),ae=H.value,he=H.property.specification.type,be=H.property.useIntegerZoom,Te=H.property.specification["property-type"],Re=Te==="cross-faded"||Te==="cross-faded-data-driven",$e=String(j)==="line-dasharray"&&d.layout.get("line-cap").value.kind!=="constant";if(ae.kind!=="constant"||$e)if(ae.kind==="source"||$e||Re){const qe=ic(j,he,"source");this.binders[j]=Re?new ya(ae,ee,he,be,w,qe,d.id):new Xn(ae,ee,he,qe),z.push(`/a_${j}`)}else{const qe=ic(j,he,"composite");this.binders[j]=new _n(ae,ee,he,be,w,qe),z.push(`/z_${j}`)}else this.binders[j]=Re?new Zo(ae.value,ee):new Zs(ae.value,ee,he),z.push(`/u_${j}`)}this.cacheKey=z.sort().join("")}getMaxValue(d){const w=this.binders[d];return w instanceof Xn||w instanceof _n?w.maxValue:0}populatePaintArrays(d,w,C,z,j,H){for(const ee in this.binders){const ae=this.binders[ee];(ae instanceof Xn||ae instanceof _n||ae instanceof ya)&&ae.populatePaintArray(d,w,C,z,j,H)}}setConstantPatternPositions(d,w){for(const C in this.binders){const z=this.binders[C];z instanceof Zo&&z.setConstantPatternPositions(d,w)}}updatePaintArrays(d,w,C,z,j,H){let ee=!1;for(const ae in d){const he=w.getPositions(ae);for(const be of he){const Te=C.feature(be.index);for(const Re in this.binders){const $e=this.binders[Re];if(($e instanceof Xn||$e instanceof _n||$e instanceof ya)&&$e.expression.isStateDependent===!0){const qe=z.paint.get(Re);$e.expression=qe.value,$e.updatePaintArray(be.start,be.end,Te,d[ae],j,H),ee=!0}}}}return ee}defines(){const d=[];for(const w in this.binders){const C=this.binders[w];(C instanceof Zs||C instanceof Zo)&&d.push(...C.uniformNames.map(z=>`#define HAS_UNIFORM_${z}`))}return d}getBinderAttributes(){const d=[];for(const w in this.binders){const C=this.binders[w];if(C instanceof Xn||C instanceof _n||C instanceof ya)for(let z=0;z<C.paintVertexAttributes.length;z++)d.push(C.paintVertexAttributes[z].name)}return d}getBinderUniforms(){const d=[];for(const w in this.binders){const C=this.binders[w];if(C instanceof Zs||C instanceof Zo||C instanceof _n)for(const z of C.uniformNames)d.push(z)}return d}getPaintVertexBuffers(){return this._buffers}getUniforms(d,w){const C=[];for(const z in this.binders){const j=this.binders[z];if(j instanceof Zs||j instanceof Zo||j instanceof _n){for(const H of j.uniformNames)if(w[H]){const ee=j.getBinding(d,w[H],H);C.push({name:H,property:z,binding:ee})}}}return C}setUniforms(d,w,C,z){for(const{name:j,property:H,binding:ee}of w)this.binders[H].setUniform(ee,z,C.get(H),j)}updatePaintBuffers(d){this._buffers=[];for(const w in this.binders){const C=this.binders[w];if(d&&C instanceof ya){const z=d.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;z&&this._buffers.push(z)}else(C instanceof Xn||C instanceof _n)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(d){for(const w in this.binders){const C=this.binders[w];(C instanceof Xn||C instanceof _n||C instanceof ya)&&C.upload(d)}this.updatePaintBuffers()}destroy(){for(const d in this.binders){const w=this.binders[d];(w instanceof Xn||w instanceof _n||w instanceof ya)&&w.destroy()}}}class Ka{constructor(d,w,C=()=>!0){this.programConfigurations={};for(const z of d)this.programConfigurations[z.id]=new Yn(z,w,C);this.needsUpload=!1,this._featureMap=new rh,this._bufferOffset=0}populatePaintArrays(d,w,C,z,j,H,ee){for(const ae in this.programConfigurations)this.programConfigurations[ae].populatePaintArrays(d,w,z,j,H,ee);w.id!==void 0&&this._featureMap.add(w.id,C,this._bufferOffset,d),this._bufferOffset=d,this.needsUpload=!0}updatePaintArrays(d,w,C,z,j){for(const H of C)this.needsUpload=this.programConfigurations[H.id].updatePaintArrays(d,this._featureMap,w,H,z,j)||this.needsUpload}get(d){return this.programConfigurations[d]}upload(d){if(this.needsUpload){for(const w in this.programConfigurations)this.programConfigurations[w].upload(d);this.needsUpload=!1}}destroy(){for(const d in this.programConfigurations)this.programConfigurations[d].destroy()}}const od={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function sd(b,d){return od[b]||[b.replace(`${d}-`,"").replace(/-/g,"_")]}const ld={"line-pattern":{source:Ri,composite:Ri},"fill-pattern":{source:Ri,composite:Ri},"fill-extrusion-pattern":{source:Ri,composite:Ri},"line-dasharray":{source:Ti,composite:Ti}},hd={color:{source:nr,composite:Hr},number:{source:rr,composite:nr}};function ic(b,d,w){const C=ld[b];return C&&C[w]||hd[d][w]}wi("ConstantBinder",Zs),wi("CrossFadedConstantBinder",Zo),wi("SourceExpressionBinder",Xn),wi("CrossFadedCompositeBinder",ya),wi("CompositeExpressionBinder",_n),wi("ProgramConfiguration",Yn,{omit:["_buffers"]}),wi("ProgramConfigurationSet",Ka);const oh="-transition";class yn extends ai{constructor(d,w){if(super(),this.id=d.id,this.type=d.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,d.type!=="custom"&&(this.metadata=(d=d).metadata,this.minzoom=d.minzoom,this.maxzoom=d.maxzoom,d.type!=="background"&&d.type!=="sky"&&(this.source=d.source,this.sourceLayer=d["source-layer"],this.filter=d.filter),w.layout&&(this._unevaluatedLayout=new st(w.layout)),w.paint)){this._transitionablePaint=new ct(w.paint);for(const C in d.paint)this.setPaintProperty(C,d.paint[C],{validate:!1});for(const C in d.layout)this.setLayoutProperty(C,d.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xt(w.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(d){return d==="visibility"?this.visibility:this._unevaluatedLayout.getValue(d)}setLayoutProperty(d,w,C={}){w!=null&&this._validate(Nl,`layers.${this.id}.layout.${d}`,d,w,C)||(d!=="visibility"?this._unevaluatedLayout.setValue(d,w):this.visibility=w)}getPaintProperty(d){return me(d,oh)?this._transitionablePaint.getTransition(d.slice(0,-oh.length)):this._transitionablePaint.getValue(d)}setPaintProperty(d,w,C={}){if(w!=null&&this._validate(Fo,`layers.${this.id}.paint.${d}`,d,w,C))return!1;if(me(d,oh))return this._transitionablePaint.setTransition(d.slice(0,-oh.length),w||void 0),!1;{const z=this._transitionablePaint._values[d],j=z.property.specification["property-type"]==="cross-faded-data-driven",H=z.value.isDataDriven(),ee=z.value;this._transitionablePaint.setValue(d,w),this._handleSpecialPaintPropertyUpdate(d);const ae=this._transitionablePaint._values[d].value;return ae.isDataDriven()||H||j||this._handleOverridablePaintPropertyUpdate(d,ee,ae)}}_handleSpecialPaintPropertyUpdate(d){}getProgramIds(){return null}getProgramConfiguration(d){return null}_handleOverridablePaintPropertyUpdate(d,w,C){return!1}isHidden(d){return!!(this.minzoom&&d<this.minzoom)||!!(this.maxzoom&&d>=this.maxzoom)||this.visibility==="none"}updateTransitions(d){this._transitioningPaint=this._transitionablePaint.transitioned(d,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(d,w){d.getCrossfadeParameters&&(this._crossfadeParameters=d.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(d,void 0,w)),this.paint=this._transitioningPaint.possiblyEvaluate(d,void 0,w)}serialize(){const d={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(d.layout=d.layout||{},d.layout.visibility=this.visibility),Le(d,(w,C)=>!(w===void 0||C==="layout"&&!Object.keys(w).length||C==="paint"&&!Object.keys(w).length))}_validate(d,w,C,z,j={}){return(!j||j.validate!==!1)&&Ul(this,d.call(Wn,{key:w,layerType:this.type,objectKey:C,value:z,styleSpec:Ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const d in this.paint._values){const w=this.paint.get(d);if(w instanceof gt&&Tn(w.property.specification)&&(w.value.kind==="source"||w.value.kind==="composite")&&w.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Fa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ud=Gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:cd}=ud;class Cr{constructor(d=[]){this.segments=d}prepareSegment(d,w,C,z){let j=this.segments[this.segments.length-1];return d>Cr.MAX_VERTEX_ARRAY_LENGTH&&je(`Max vertices per segment is ${Cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${d}`),(!j||j.vertexLength+d>Cr.MAX_VERTEX_ARRAY_LENGTH||j.sortKey!==z)&&(j={vertexOffset:w.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},z!==void 0&&(j.sortKey=z),this.segments.push(j)),j}get(){return this.segments}destroy(){for(const d of this.segments)for(const w in d.vaos)d.vaos[w].destroy()}static simpleSegment(d,w,C,z){return new Cr([{vertexOffset:d,primitiveOffset:w,vertexLength:C,primitiveLength:z,vaos:{},sortKey:0}])}}Cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wi("SegmentVector",Cr);var ji=8192;class Ja{constructor(d,w){d&&(w?this.setSouthWest(d).setNorthEast(w):d.length===4?this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]]):this.setSouthWest(d[0]).setNorthEast(d[1]))}setNorthEast(d){return this._ne=d instanceof Yi?new Yi(d.lng,d.lat):Yi.convert(d),this}setSouthWest(d){return this._sw=d instanceof Yi?new Yi(d.lng,d.lat):Yi.convert(d),this}extend(d){const w=this._sw,C=this._ne;let z,j;if(d instanceof Yi)z=d,j=d;else{if(!(d instanceof Ja))return Array.isArray(d)?d.length===4||d.every(Array.isArray)?this.extend(Ja.convert(d)):this.extend(Yi.convert(d)):this;if(z=d._sw,j=d._ne,!z||!j)return this}return w||C?(w.lng=Math.min(z.lng,w.lng),w.lat=Math.min(z.lat,w.lat),C.lng=Math.max(j.lng,C.lng),C.lat=Math.max(j.lat,C.lat)):(this._sw=new Yi(z.lng,z.lat),this._ne=new Yi(j.lng,j.lat)),this}getCenter(){return new Yi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yi(this.getWest(),this.getNorth())}getSouthEast(){return new Yi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(d){const{lng:w,lat:C}=Yi.convert(d);let z=this._sw.lng<=w&&w<=this._ne.lng;return this._sw.lng>this._ne.lng&&(z=this._sw.lng>=w&&w>=this._ne.lng),this._sw.lat<=C&&C<=this._ne.lat&&z}static convert(d){return!d||d instanceof Ja?d:new Ja(d)}}const rc=63710088e-1;class Yi{constructor(d,w){if(isNaN(d)||isNaN(w))throw new Error(`Invalid LngLat object: (${d}, ${w})`);if(this.lng=+d,this.lat=+w,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yi(X(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(d){const w=Math.PI/180,C=this.lat*w,z=d.lat*w,j=Math.sin(C)*Math.sin(z)+Math.cos(C)*Math.cos(z)*Math.cos((d.lng-this.lng)*w);return rc*Math.acos(Math.min(j,1))}toBounds(d=0){const w=360*d/40075017,C=w/Math.cos(Math.PI/180*this.lat);return new Ja(new Yi(this.lng-C,this.lat-w),new Yi(this.lng+C,this.lat+w))}static convert(d){if(d instanceof Yi)return d;if(Array.isArray(d)&&(d.length===2||d.length===3))return new Yi(Number(d[0]),Number(d[1]));if(!Array.isArray(d)&&typeof d=="object"&&d!==null)return new Yi(Number("lng"in d?d.lng:d.lon),Number(d.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const nc=2*Math.PI*rc;function ac(b){return nc*Math.cos(b*Math.PI/180)}function eu(b){return(180+b)/360}function tu(b){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b*Math.PI/360)))/360}function iu(b,d){return b/ac(d)}function Qa(b){return 360*b-180}function Pn(b){return 360/Math.PI*Math.atan(Math.exp((180-360*b)*Math.PI/180))-90}function ru(b,d){return b*ac(Pn(d))}const va=85.051129;class sh{constructor(d,w,C=0){this.x=+d,this.y=+w,this.z=+C}static fromLngLat(d,w=0){const C=Yi.convert(d);return new sh(eu(C.lng),tu(C.lat),iu(w,C.lat))}toLngLat(){return new Yi(Qa(this.x),Pn(this.y))}toAltitude(){return ru(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nc*(d=Pn(this.y),1/Math.cos(d*Math.PI/180));var d}}function nu(b,d,w,C,z,j,H,ee,ae){const he=(d+C)/2,be=(w+z)/2,Te=new k(he,be);ee(Te),function(Re,$e,qe,rt,dt,yt){const Mt=qe-dt,Pt=rt-yt;return Math.abs((rt-$e)*Mt-(qe-Re)*Pt)/Math.hypot(Mt,Pt)}(Te.x,Te.y,j.x,j.y,H.x,H.y)>=ae?(nu(b,d,w,he,be,j,Te,ee,ae),nu(b,he,be,C,z,Te,H,ee,ae)):b.push(H)}function fd(b,d,w){const C=[];let z,j,H;for(const ee of b){const{x:ae,y:he}=ee;d(ee),H?nu(C,z,j,ae,he,H,ee,d,w):C.push(ee),z=ae,j=he,H=ee}return C}const au=Math.pow(2,14)-1,oc=-au-1;function dd(b,d){const w=Math.round(b.x*d),C=Math.round(b.y*d);return b.x=Y(w,oc,au),b.y=Y(C,oc,au),(w<b.x||w>b.x+1||C<b.y||C>b.y+1)&&je("Geometry exceeds allowed extent, reduce your vector tile buffer size"),b}function Kn(b,d,w){const C=b.loadGeometry(),z=b.extent,j=ji/z;if(d&&w&&w.projection.name!=="mercator"){const H=1<<d.z,{scale:ee,x:ae,y:he,projection:be}=w,Te=Re=>{const $e=Qa((d.x+Re.x/z)/H),qe=Pn((d.y+Re.y/z)/H),rt=be.project($e,qe);Re.x=(rt.x*ee-ae)*z,Re.y=(rt.y*ee-he)*z};for(let Re=0;Re<C.length;Re++)if(b.type!==1)C[Re]=fd(C[Re],Te,1);else{const $e=[];for(const qe of C[Re])qe.x<0||qe.x>=z||qe.y<0||qe.y>=z||(Te(qe),$e.push(qe));C[Re]=$e}}for(const H of C)for(const ee of H)dd(ee,j);return C}function eo(b,d){return{type:b.type,id:b.id,properties:b.properties,geometry:d?Kn(b):[]}}function lh(b,d,w,C,z){b.emplaceBack(2*d+(C+1)/2,2*w+(z+1)/2)}class ou{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(w=>w.id),this.index=d.index,this.hasPattern=!1,this.layoutVertexArray=new Ei,this.indexArray=new _r,this.segments=new Cr,this.programConfigurations=new Ka(d.layers,d.zoom),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(d,w,C,z){const j=this.layers[0],H=[];let ee=null;j.type==="circle"&&(ee=j.layout.get("circle-sort-key"));for(const{feature:ae,id:he,index:be,sourceLayerIndex:Te}of d){const Re=this.layers[0]._featureFilter.needGeometry,$e=eo(ae,Re);if(!this.layers[0]._featureFilter.filter(new Ue(this.zoom),$e,C))continue;const qe=ee?ee.evaluate($e,{},C):void 0,rt={id:he,properties:ae.properties,type:ae.type,sourceLayerIndex:Te,index:be,geometry:Re?$e.geometry:Kn(ae,C,z),patterns:{},sortKey:qe};H.push(rt)}ee&&H.sort((ae,he)=>ae.sortKey-he.sortKey);for(const ae of H){const{geometry:he,index:be,sourceLayerIndex:Te}=ae,Re=d[be].feature;this.addFeature(ae,he,be,w.availableImages,C),w.featureIndex.insert(Re,he,be,Te,this.index)}}update(d,w,C,z){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,w,this.stateDependentLayers,C,z)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,cd),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(d,w,C,z,j){for(const H of w)for(const ee of H){const ae=ee.x,he=ee.y;if(ae<0||ae>=ji||he<0||he>=ji)continue;const be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,d.sortKey),Te=be.vertexLength;lh(this.layoutVertexArray,ae,he,-1,-1),lh(this.layoutVertexArray,ae,he,1,-1),lh(this.layoutVertexArray,ae,he,1,1),lh(this.layoutVertexArray,ae,he,-1,1),this.indexArray.emplaceBack(Te,Te+1,Te+2),this.indexArray.emplaceBack(Te,Te+3,Te+2),be.vertexLength+=4,be.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,{},z,j)}}function sc(b,d){for(let w=0;w<b.length;w++)if(Ho(d,b[w]))return!0;for(let w=0;w<d.length;w++)if(Ho(b,d[w]))return!0;return!!su(b,d)}function pd(b,d,w){return!!Ho(b,d)||!!lu(d,b,w)}function lc(b,d){if(b.length===1)return uc(d,b[0]);for(let w=0;w<d.length;w++){const C=d[w];for(let z=0;z<C.length;z++)if(Ho(b,C[z]))return!0}for(let w=0;w<b.length;w++)if(uc(d,b[w]))return!0;for(let w=0;w<d.length;w++)if(su(b,d[w]))return!0;return!1}function md(b,d,w){if(b.length>1){if(su(b,d))return!0;for(let C=0;C<d.length;C++)if(lu(d[C],b,w))return!0}for(let C=0;C<b.length;C++)if(lu(b[C],d,w))return!0;return!1}function su(b,d){if(b.length===0||d.length===0)return!1;for(let w=0;w<b.length-1;w++){const C=b[w],z=b[w+1];for(let j=0;j<d.length-1;j++)if(gd(C,z,d[j],d[j+1]))return!0}return!1}function gd(b,d,w,C){return Ie(b,w,C)!==Ie(d,w,C)&&Ie(b,d,w)!==Ie(b,d,C)}function lu(b,d,w){const C=w*w;if(d.length===1)return b.distSqr(d[0])<C;for(let z=1;z<d.length;z++)if(hc(b,d[z-1],d[z])<C)return!0;return!1}function hc(b,d,w){const C=d.distSqr(w);if(C===0)return b.distSqr(d);const z=((b.x-d.x)*(w.x-d.x)+(b.y-d.y)*(w.y-d.y))/C;return b.distSqr(z<0?d:z>1?w:w.sub(d)._mult(z)._add(d))}function uc(b,d){let w,C,z,j=!1;for(let H=0;H<b.length;H++){w=b[H];for(let ee=0,ae=w.length-1;ee<w.length;ae=ee++)C=w[ee],z=w[ae],C.y>d.y!=z.y>d.y&&d.x<(z.x-C.x)*(d.y-C.y)/(z.y-C.y)+C.x&&(j=!j)}return j}function Ho(b,d){let w=!1;for(let C=0,z=b.length-1;C<b.length;z=C++){const j=b[C],H=b[z];j.y>d.y!=H.y>d.y&&d.x<(H.x-j.x)*(d.y-j.y)/(H.y-j.y)+j.x&&(w=!w)}return w}function cc(b,d,w,C,z){for(const H of b)if(d<=H.x&&w<=H.y&&C>=H.x&&z>=H.y)return!0;const j=[new k(d,w),new k(d,z),new k(C,z),new k(C,w)];if(b.length>2){for(const H of j)if(Ho(b,H))return!0}for(let H=0;H<b.length-1;H++)if(_d(b[H],b[H+1],j))return!0;return!1}function _d(b,d,w){const C=w[0],z=w[2];if(b.x<C.x&&d.x<C.x||b.x>z.x&&d.x>z.x||b.y<C.y&&d.y<C.y||b.y>z.y&&d.y>z.y)return!1;const j=Ie(b,d,w[0]);return j!==Ie(b,d,w[1])||j!==Ie(b,d,w[2])||j!==Ie(b,d,w[3])}function Wo(b,d,w){const C=d.paint.get(b).value;return C.kind==="constant"?C.value:w.programConfigurations.get(d.id).getMaxValue(b)}function hh(b){return Math.sqrt(b[0]*b[0]+b[1]*b[1])}function fc(b,d,w,C,z){if(!d[0]&&!d[1])return b;const j=k.convert(d)._mult(z);w==="viewport"&&j._rotate(-C);const H=[];for(let ee=0;ee<b.length;ee++)H.push(b[ee].sub(j));return H}function dc(b,d,w,C){const z=k.convert(b)._mult(C);return d==="viewport"&&z._rotate(-w),z}wi("CircleBucket",ou,{omit:["layers"]});const yd=new Jt({"circle-sort-key":new Et(Ct.layout_circle["circle-sort-key"])});var vd={paint:new Jt({"circle-radius":new Et(Ct.paint_circle["circle-radius"]),"circle-color":new Et(Ct.paint_circle["circle-color"]),"circle-blur":new Et(Ct.paint_circle["circle-blur"]),"circle-opacity":new Et(Ct.paint_circle["circle-opacity"]),"circle-translate":new ut(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(Ct.paint_circle["circle-stroke-opacity"])}),layout:yd},jr=typeof Float32Array!="undefined"?Float32Array:Array;function pc(){var b=new jr(9);return jr!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}function hu(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function mc(b,d,w){var C=d[0],z=d[1],j=d[2],H=d[3],ee=d[4],ae=d[5],he=d[6],be=d[7],Te=d[8],Re=d[9],$e=d[10],qe=d[11],rt=d[12],dt=d[13],yt=d[14],Mt=d[15],Pt=w[0],Ot=w[1],Lt=w[2],Ft=w[3];return b[0]=Pt*C+Ot*ee+Lt*Te+Ft*rt,b[1]=Pt*z+Ot*ae+Lt*Re+Ft*dt,b[2]=Pt*j+Ot*he+Lt*$e+Ft*yt,b[3]=Pt*H+Ot*be+Lt*qe+Ft*Mt,b[4]=(Pt=w[4])*C+(Ot=w[5])*ee+(Lt=w[6])*Te+(Ft=w[7])*rt,b[5]=Pt*z+Ot*ae+Lt*Re+Ft*dt,b[6]=Pt*j+Ot*he+Lt*$e+Ft*yt,b[7]=Pt*H+Ot*be+Lt*qe+Ft*Mt,b[8]=(Pt=w[8])*C+(Ot=w[9])*ee+(Lt=w[10])*Te+(Ft=w[11])*rt,b[9]=Pt*z+Ot*ae+Lt*Re+Ft*dt,b[10]=Pt*j+Ot*he+Lt*$e+Ft*yt,b[11]=Pt*H+Ot*be+Lt*qe+Ft*Mt,b[12]=(Pt=w[12])*C+(Ot=w[13])*ee+(Lt=w[14])*Te+(Ft=w[15])*rt,b[13]=Pt*z+Ot*ae+Lt*Re+Ft*dt,b[14]=Pt*j+Ot*he+Lt*$e+Ft*yt,b[15]=Pt*H+Ot*be+Lt*qe+Ft*Mt,b}Math.hypot||(Math.hypot=function(){for(var b=0,d=arguments.length;d--;)b+=arguments[d]*arguments[d];return Math.sqrt(b)});var xd=mc;function uh(){var b=new jr(3);return jr!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b}function gc(b){return Math.hypot(b[0],b[1],b[2])}function qo(b,d,w){var C=new jr(3);return C[0]=b,C[1]=d,C[2]=w,C}function _c(b,d,w){return b[0]=d[0]-w[0],b[1]=d[1]-w[1],b[2]=d[2]-w[2],b}function yc(b,d,w){return b[0]=d[0]*w[0],b[1]=d[1]*w[1],b[2]=d[2]*w[2],b}function vc(b,d,w,C){return b[0]=d[0]+w[0]*C,b[1]=d[1]+w[1]*C,b[2]=d[2]+w[2]*C,b}function xc(b,d){var w=d[0],C=d[1],z=d[2],j=w*w+C*C+z*z;return j>0&&(j=1/Math.sqrt(j)),b[0]=d[0]*j,b[1]=d[1]*j,b[2]=d[2]*j,b}function bc(b,d,w){var C=w[0],z=w[1],j=w[2],H=d[0],ee=d[1],ae=d[2],he=z*ae-j*ee,be=j*H-C*ae,Te=C*ee-z*H,Re=z*Te-j*be,$e=j*he-C*Te,qe=C*be-z*he,rt=2*w[3];return be*=rt,Te*=rt,$e*=2,qe*=2,b[0]=H+(he*=rt)+(Re*=2),b[1]=ee+be+$e,b[2]=ae+Te+qe,b}var Hs,bd=_c,wd=yc,Ed=gc;function Ws(b,d,w){var C=d[0],z=d[1],j=d[2],H=d[3];return b[0]=w[0]*C+w[4]*z+w[8]*j+w[12]*H,b[1]=w[1]*C+w[5]*z+w[9]*j+w[13]*H,b[2]=w[2]*C+w[6]*z+w[10]*j+w[14]*H,b[3]=w[3]*C+w[7]*z+w[11]*j+w[15]*H,b}function uu(){var b=new jr(4);return jr!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b[3]=1,b}function wc(b){return b[0]=0,b[1]=0,b[2]=0,b[3]=1,b}function Ec(b,d,w){w*=.5;var C=d[0],z=d[1],j=d[2],H=d[3],ee=Math.sin(w),ae=Math.cos(w);return b[0]=C*ae+H*ee,b[1]=z*ae+j*ee,b[2]=j*ae-z*ee,b[3]=H*ae-C*ee,b}function Sc(b,d){return b[0]===d[0]&&b[1]===d[1]}function Mc(b,d,w,C,z,j,H,ee,ae){if(j&&b.queryGeometry.isAboveHorizon)return!1;j&&(ae*=b.pixelToTileUnitsFactor);for(const he of d)for(const be of he){const Te=be.add(ee),Re=z&&w.elevation?w.elevation.exaggeration()*z.getElevationAt(Te.x,Te.y,!0):0,$e=j?Te:Sd(Te,Re,C),qe=j?b.tilespaceRays.map(dt=>Td(dt,Re)):b.queryGeometry.screenGeometry,rt=Ws([],[be.x,be.y,Re,1],C);if(!H&&j?ae*=rt[3]/w.cameraToCenterDistance:H&&!j&&(ae*=w.cameraToCenterDistance/rt[3]),pd(qe,$e,ae))return!0}return!1}function Sd(b,d,w){const C=Ws([],[b.x,b.y,d,1],w);return new k(C[0]/C[3],C[1]/C[3])}uh(),Hs=new jr(4),jr!=Float32Array&&(Hs[0]=0,Hs[1]=0,Hs[2]=0,Hs[3]=0),uh(),qo(1,0,0),qo(0,1,0),uu(),uu(),pc(),function(){var b;b=new jr(2),jr!=Float32Array&&(b[0]=0,b[1]=0)}();const Tc=qo(0,0,0),Md=qo(0,0,1);function Td(b,d){const w=uh();return Tc[2]=d,b.intersectsPlane(Tc,Md,w),new k(w[0],w[1])}class Ac extends ou{}function cu(b,{width:d,height:w},C,z){if(z){if(z instanceof Uint8ClampedArray)z=new Uint8Array(z.buffer);else if(z.length!==d*w*C)throw new RangeError("mismatched image size")}else z=new Uint8Array(d*w*C);return b.width=d,b.height=w,b.data=z,b}function Cc(b,{width:d,height:w},C){if(d===b.width&&w===b.height)return;const z=cu({},{width:d,height:w},C);fu(b,z,{x:0,y:0},{x:0,y:0},{width:Math.min(b.width,d),height:Math.min(b.height,w)},C),b.width=d,b.height=w,b.data=z.data}function fu(b,d,w,C,z,j){if(z.width===0||z.height===0)return d;if(z.width>b.width||z.height>b.height||w.x>b.width-z.width||w.y>b.height-z.height)throw new RangeError("out of range source coordinates for image copy");if(z.width>d.width||z.height>d.height||C.x>d.width-z.width||C.y>d.height-z.height)throw new RangeError("out of range destination coordinates for image copy");const H=b.data,ee=d.data;for(let ae=0;ae<z.height;ae++){const he=((w.y+ae)*b.width+w.x)*j,be=((C.y+ae)*d.width+C.x)*j;for(let Te=0;Te<z.width*j;Te++)ee[be+Te]=H[he+Te]}return d}wi("HeatmapBucket",Ac,{omit:["layers"]});class xa{constructor(d,w){cu(this,d,1,w)}resize(d){Cc(this,d,1)}clone(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(d,w,C,z,j){fu(d,w,C,z,j,1)}}class on{constructor(d,w){cu(this,d,4,w)}resize(d){Cc(this,d,4)}replace(d,w){w?this.data.set(d):this.data=d instanceof Uint8ClampedArray?new Uint8Array(d.buffer):d}clone(){return new on({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(d,w,C,z,j){fu(d,w,C,z,j,4)}}wi("AlphaImage",xa),wi("RGBAImage",on);var Ad={paint:new Jt({"heatmap-radius":new Et(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zt(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Ct.paint_heatmap["heatmap-opacity"])})};function du(b){const d={},w=b.resolution||256,C=b.clips?b.clips.length:1,z=b.image||new on({width:w,height:C}),j=(H,ee,ae)=>{d[b.evaluationKey]=ae;const he=b.expression.evaluate(d);z.data[H+ee+0]=Math.floor(255*he.r/he.a),z.data[H+ee+1]=Math.floor(255*he.g/he.a),z.data[H+ee+2]=Math.floor(255*he.b/he.a),z.data[H+ee+3]=Math.floor(255*he.a)};if(b.clips)for(let H=0,ee=0;H<C;++H,ee+=4*w)for(let ae=0,he=0;ae<w;ae++,he+=4){const be=ae/(w-1),{start:Te,end:Re}=b.clips[H];j(ee,he,Te*(1-be)+Re*be)}else for(let H=0,ee=0;H<w;H++,ee+=4)j(0,ee,H/(w-1));return z}var Cd={paint:new Jt({"hillshade-illumination-direction":new ut(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Ct.paint_hillshade["hillshade-accent-color"])})};const Id=Gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:kd}=Id;var ch=fh,Dd=fh;function fh(b,d,w){w=w||2;var C,z,j,H,ee,ae,he,be=d&&d.length,Te=be?d[0]*w:b.length,Re=Ic(b,0,Te,w,!0),$e=[];if(!Re||Re.next===Re.prev)return $e;if(be&&(Re=function(rt,dt,yt,Mt){var Pt,Ot,Lt,Ft=[];for(Pt=0,Ot=dt.length;Pt<Ot;Pt++)(Lt=Ic(rt,dt[Pt]*Mt,Pt<Ot-1?dt[Pt+1]*Mt:rt.length,Mt,!1))===Lt.next&&(Lt.steiner=!0),Ft.push(Nd(Lt));for(Ft.sort(Od),Pt=0;Pt<Ft.length;Pt++)yt=ba(yt=Fd(Ft[Pt],yt),yt.next);return yt}(b,d,Re,w)),b.length>80*w){C=j=b[0],z=H=b[1];for(var qe=w;qe<Te;qe+=w)(ee=b[qe])<C&&(C=ee),(ae=b[qe+1])<z&&(z=ae),ee>j&&(j=ee),ae>H&&(H=ae);he=(he=Math.max(j-C,H-z))!==0?1/he:0}return qs(Re,$e,w,C,z,he),$e}function Ic(b,d,w,C,z){var j,H;if(z===gu(b,d,w,C)>0)for(j=d;j<w;j+=C)H=Rc(j,b[j],b[j+1],H);else for(j=w-C;j>=d;j-=C)H=Rc(j,b[j],b[j+1],H);return H&&dh(H,H.next)&&(Ys(H),H=H.next),H}function ba(b,d){if(!b)return b;d||(d=b);var w,C=b;do if(w=!1,C.steiner||!dh(C,C.next)&&dr(C.prev,C,C.next)!==0)C=C.next;else{if(Ys(C),(C=d=C.prev)===C.next)break;w=!0}while(w||C!==d);return d}function qs(b,d,w,C,z,j,H){if(b){!H&&j&&function(be,Te,Re,$e){var qe=be;do qe.z===null&&(qe.z=pu(qe.x,qe.y,Te,Re,$e)),qe.prevZ=qe.prev,qe.nextZ=qe.next,qe=qe.next;while(qe!==be);qe.prevZ.nextZ=null,qe.prevZ=null,function(rt){var dt,yt,Mt,Pt,Ot,Lt,Ft,ei,Xt=1;do{for(yt=rt,rt=null,Ot=null,Lt=0;yt;){for(Lt++,Mt=yt,Ft=0,dt=0;dt<Xt&&(Ft++,Mt=Mt.nextZ);dt++);for(ei=Xt;Ft>0||ei>0&&Mt;)Ft!==0&&(ei===0||!Mt||yt.z<=Mt.z)?(Pt=yt,yt=yt.nextZ,Ft--):(Pt=Mt,Mt=Mt.nextZ,ei--),Ot?Ot.nextZ=Pt:rt=Pt,Pt.prevZ=Ot,Ot=Pt;yt=Mt}Ot.nextZ=null,Xt*=2}while(Lt>1)}(qe)}(b,C,z,j);for(var ee,ae,he=b;b.prev!==b.next;)if(ee=b.prev,ae=b.next,j?Pd(b,C,z,j):Rd(b))d.push(ee.i/w),d.push(b.i/w),d.push(ae.i/w),Ys(b),b=ae.next,he=ae.next;else if((b=ae)===he){H?H===1?qs(b=Ld(ba(b),d,w),d,w,C,z,j,2):H===2&&Bd(b,d,w,C,z,j):qs(ba(b),d,w,C,z,j,1);break}}}function Rd(b){var d=b.prev,w=b,C=b.next;if(dr(d,w,C)>=0)return!1;for(var z=b.next.next;z!==b.prev;){if(Xo(d.x,d.y,w.x,w.y,C.x,C.y,z.x,z.y)&&dr(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function Pd(b,d,w,C){var z=b.prev,j=b,H=b.next;if(dr(z,j,H)>=0)return!1;for(var ee=z.x>j.x?z.x>H.x?z.x:H.x:j.x>H.x?j.x:H.x,ae=z.y>j.y?z.y>H.y?z.y:H.y:j.y>H.y?j.y:H.y,he=pu(z.x<j.x?z.x<H.x?z.x:H.x:j.x<H.x?j.x:H.x,z.y<j.y?z.y<H.y?z.y:H.y:j.y<H.y?j.y:H.y,d,w,C),be=pu(ee,ae,d,w,C),Te=b.prevZ,Re=b.nextZ;Te&&Te.z>=he&&Re&&Re.z<=be;){if(Te!==b.prev&&Te!==b.next&&Xo(z.x,z.y,j.x,j.y,H.x,H.y,Te.x,Te.y)&&dr(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Re!==b.prev&&Re!==b.next&&Xo(z.x,z.y,j.x,j.y,H.x,H.y,Re.x,Re.y)&&dr(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Te&&Te.z>=he;){if(Te!==b.prev&&Te!==b.next&&Xo(z.x,z.y,j.x,j.y,H.x,H.y,Te.x,Te.y)&&dr(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Re&&Re.z<=be;){if(Re!==b.prev&&Re!==b.next&&Xo(z.x,z.y,j.x,j.y,H.x,H.y,Re.x,Re.y)&&dr(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function Ld(b,d,w){var C=b;do{var z=C.prev,j=C.next.next;!dh(z,j)&&kc(z,C,C.next,j)&&Xs(z,j)&&Xs(j,z)&&(d.push(z.i/w),d.push(C.i/w),d.push(j.i/w),Ys(C),Ys(C.next),C=b=j),C=C.next}while(C!==b);return ba(C)}function Bd(b,d,w,C,z,j){var H=b;do{for(var ee=H.next.next;ee!==H.prev;){if(H.i!==ee.i&&Ud(H,ee)){var ae=Dc(H,ee);return H=ba(H,H.next),ae=ba(ae,ae.next),qs(H,d,w,C,z,j),void qs(ae,d,w,C,z,j)}ee=ee.next}H=H.next}while(H!==b)}function Od(b,d){return b.x-d.x}function Fd(b,d){var w=function(j,H){var ee,ae=H,he=j.x,be=j.y,Te=-1/0;do{if(be<=ae.y&&be>=ae.next.y&&ae.next.y!==ae.y){var Re=ae.x+(be-ae.y)*(ae.next.x-ae.x)/(ae.next.y-ae.y);if(Re<=he&&Re>Te){if(Te=Re,Re===he){if(be===ae.y)return ae;if(be===ae.next.y)return ae.next}ee=ae.x<ae.next.x?ae:ae.next}}ae=ae.next}while(ae!==H);if(!ee)return null;if(he===Te)return ee;var $e,qe=ee,rt=ee.x,dt=ee.y,yt=1/0;ae=ee;do he>=ae.x&&ae.x>=rt&&he!==ae.x&&Xo(be<dt?he:Te,be,rt,dt,be<dt?Te:he,be,ae.x,ae.y)&&($e=Math.abs(be-ae.y)/(he-ae.x),Xs(ae,j)&&($e<yt||$e===yt&&(ae.x>ee.x||ae.x===ee.x&&zd(ee,ae)))&&(ee=ae,yt=$e)),ae=ae.next;while(ae!==qe);return ee}(b,d);if(!w)return d;var C=Dc(w,b),z=ba(w,w.next);return ba(C,C.next),d===w?z:d}function zd(b,d){return dr(b.prev,b,d.prev)<0&&dr(d.next,b,b.next)<0}function pu(b,d,w,C,z){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-w)*z)|b<<8))|b<<4))|b<<2))|b<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=32767*(d-C)*z)|d<<8))|d<<4))|d<<2))|d<<1))<<1}function Nd(b){var d=b,w=b;do(d.x<w.x||d.x===w.x&&d.y<w.y)&&(w=d),d=d.next;while(d!==b);return w}function Xo(b,d,w,C,z,j,H,ee){return(z-H)*(d-ee)-(b-H)*(j-ee)>=0&&(b-H)*(C-ee)-(w-H)*(d-ee)>=0&&(w-H)*(j-ee)-(z-H)*(C-ee)>=0}function Ud(b,d){return b.next.i!==d.i&&b.prev.i!==d.i&&!function(w,C){var z=w;do{if(z.i!==w.i&&z.next.i!==w.i&&z.i!==C.i&&z.next.i!==C.i&&kc(z,z.next,w,C))return!0;z=z.next}while(z!==w);return!1}(b,d)&&(Xs(b,d)&&Xs(d,b)&&function(w,C){var z=w,j=!1,H=(w.x+C.x)/2,ee=(w.y+C.y)/2;do z.y>ee!=z.next.y>ee&&z.next.y!==z.y&&H<(z.next.x-z.x)*(ee-z.y)/(z.next.y-z.y)+z.x&&(j=!j),z=z.next;while(z!==w);return j}(b,d)&&(dr(b.prev,b,d.prev)||dr(b,d.prev,d))||dh(b,d)&&dr(b.prev,b,b.next)>0&&dr(d.prev,d,d.next)>0)}function dr(b,d,w){return(d.y-b.y)*(w.x-d.x)-(d.x-b.x)*(w.y-d.y)}function dh(b,d){return b.x===d.x&&b.y===d.y}function kc(b,d,w,C){var z=mh(dr(b,d,w)),j=mh(dr(b,d,C)),H=mh(dr(w,C,b)),ee=mh(dr(w,C,d));return z!==j&&H!==ee||!(z!==0||!ph(b,w,d))||!(j!==0||!ph(b,C,d))||!(H!==0||!ph(w,b,C))||!(ee!==0||!ph(w,d,C))}function ph(b,d,w){return d.x<=Math.max(b.x,w.x)&&d.x>=Math.min(b.x,w.x)&&d.y<=Math.max(b.y,w.y)&&d.y>=Math.min(b.y,w.y)}function mh(b){return b>0?1:b<0?-1:0}function Xs(b,d){return dr(b.prev,b,b.next)<0?dr(b,d,b.next)>=0&&dr(b,b.prev,d)>=0:dr(b,d,b.prev)<0||dr(b,b.next,d)<0}function Dc(b,d){var w=new mu(b.i,b.x,b.y),C=new mu(d.i,d.x,d.y),z=b.next,j=d.prev;return b.next=d,d.prev=b,w.next=z,z.prev=w,C.next=w,w.prev=C,j.next=C,C.prev=j,C}function Rc(b,d,w,C){var z=new mu(b,d,w);return C?(z.next=C.next,z.prev=C,C.next.prev=z,C.next=z):(z.prev=z,z.next=z),z}function Ys(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function mu(b,d,w){this.i=b,this.x=d,this.y=w,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gu(b,d,w,C){for(var z=0,j=d,H=w-C;j<w;j+=C)z+=(b[H]-b[j])*(b[j+1]+b[H+1]),H=j;return z}function $d(b,d,w,C,z){Pc(b,d,w||0,C||b.length-1,z||jd)}function Pc(b,d,w,C,z){for(;C>w;){if(C-w>600){var j=C-w+1,H=d-w+1,ee=Math.log(j),ae=.5*Math.exp(2*ee/3),he=.5*Math.sqrt(ee*ae*(j-ae)/j)*(H-j/2<0?-1:1);Pc(b,d,Math.max(w,Math.floor(d-H*ae/j+he)),Math.min(C,Math.floor(d+(j-H)*ae/j+he)),z)}var be=b[d],Te=w,Re=C;for(Ks(b,w,d),z(b[C],be)>0&&Ks(b,w,C);Te<Re;){for(Ks(b,Te,Re),Te++,Re--;z(b[Te],be)<0;)Te++;for(;z(b[Re],be)>0;)Re--}z(b[w],be)===0?Ks(b,w,Re):Ks(b,++Re,C),Re<=d&&(w=Re+1),d<=Re&&(C=Re-1)}}function Ks(b,d,w){var C=b[d];b[d]=b[w],b[w]=C}function jd(b,d){return b<d?-1:b>d?1:0}function _u(b,d){const w=b.length;if(w<=1)return[b];const C=[];let z,j;for(let H=0;H<w;H++){const ee=Pe(b[H]);ee!==0&&(b[H].area=Math.abs(ee),j===void 0&&(j=ee<0),j===ee<0?(z&&C.push(z),z=[b[H]]):z.push(b[H]))}if(z&&C.push(z),d>1)for(let H=0;H<C.length;H++)C[H].length<=d||($d(C[H],d,1,C[H].length-1,Gd),C[H]=C[H].slice(0,d));return C}function Gd(b,d){return d.area-b.area}function yu(b,d,w){const C=w.patternDependencies;let z=!1;for(const j of d){const H=j.paint.get(`${b}-pattern`);H.isConstant()||(z=!0);const ee=H.constantOr(null);ee&&(z=!0,C[ee.to]=!0,C[ee.from]=!0)}return z}function vu(b,d,w,C,z){const j=z.patternDependencies;for(const H of d){const ee=H.paint.get(`${b}-pattern`).value;if(ee.kind!=="constant"){let ae=ee.evaluate({zoom:C-1},w,{},z.availableImages),he=ee.evaluate({zoom:C},w,{},z.availableImages),be=ee.evaluate({zoom:C+1},w,{},z.availableImages);ae=ae&&ae.name?ae.name:ae,he=he&&he.name?he.name:he,be=be&&be.name?be.name:be,j[ae]=!0,j[he]=!0,j[be]=!0,w.patterns[H.id]={min:ae,mid:he,max:be}}}return w}fh.deviation=function(b,d,w,C){var z=d&&d.length,j=Math.abs(gu(b,0,z?d[0]*w:b.length,w));if(z)for(var H=0,ee=d.length;H<ee;H++)j-=Math.abs(gu(b,d[H]*w,H<ee-1?d[H+1]*w:b.length,w));var ae=0;for(H=0;H<C.length;H+=3){var he=C[H]*w,be=C[H+1]*w,Te=C[H+2]*w;ae+=Math.abs((b[he]-b[Te])*(b[be+1]-b[he+1])-(b[he]-b[be])*(b[Te+1]-b[he+1]))}return j===0&&ae===0?0:Math.abs((ae-j)/j)},fh.flatten=function(b){for(var d=b[0][0].length,w={vertices:[],holes:[],dimensions:d},C=0,z=0;z<b.length;z++){for(var j=0;j<b[z].length;j++)for(var H=0;H<d;H++)w.vertices.push(b[z][j][H]);z>0&&w.holes.push(C+=b[z-1].length)}return w},ch.default=Dd;class gh{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(w=>w.id),this.index=d.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ei,this.indexArray=new _r,this.indexArray2=new or,this.programConfigurations=new Ka(d.layers,d.zoom),this.segments=new Cr,this.segments2=new Cr,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(d,w,C,z){this.hasPattern=yu("fill",this.layers,w);const j=this.layers[0].layout.get("fill-sort-key"),H=[];for(const{feature:ee,id:ae,index:he,sourceLayerIndex:be}of d){const Te=this.layers[0]._featureFilter.needGeometry,Re=eo(ee,Te);if(!this.layers[0]._featureFilter.filter(new Ue(this.zoom),Re,C))continue;const $e=j?j.evaluate(Re,{},C,w.availableImages):void 0,qe={id:ae,properties:ee.properties,type:ee.type,sourceLayerIndex:be,index:he,geometry:Te?Re.geometry:Kn(ee,C,z),patterns:{},sortKey:$e};H.push(qe)}j&&H.sort((ee,ae)=>ee.sortKey-ae.sortKey);for(const ee of H){const{geometry:ae,index:he,sourceLayerIndex:be}=ee;if(this.hasPattern){const Te=vu("fill",this.layers,ee,this.zoom,w);this.patternFeatures.push(Te)}else this.addFeature(ee,ae,he,C,{},w.availableImages);w.featureIndex.insert(d[he].feature,ae,he,be,this.index)}}update(d,w,C,z){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,w,this.stateDependentLayers,C,z)}addFeatures(d,w,C,z){for(const j of this.patternFeatures)this.addFeature(j,j.geometry,j.index,w,C,z)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,kd),this.indexBuffer=d.createIndexBuffer(this.indexArray),this.indexBuffer2=d.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(d,w,C,z,j,H=[]){for(const ee of _u(w,500)){let ae=0;for(const qe of ee)ae+=qe.length;const he=this.segments.prepareSegment(ae,this.layoutVertexArray,this.indexArray),be=he.vertexLength,Te=[],Re=[];for(const qe of ee){if(qe.length===0)continue;qe!==ee[0]&&Re.push(Te.length/2);const rt=this.segments2.prepareSegment(qe.length,this.layoutVertexArray,this.indexArray2),dt=rt.vertexLength;this.layoutVertexArray.emplaceBack(qe[0].x,qe[0].y),this.indexArray2.emplaceBack(dt+qe.length-1,dt),Te.push(qe[0].x),Te.push(qe[0].y);for(let yt=1;yt<qe.length;yt++)this.layoutVertexArray.emplaceBack(qe[yt].x,qe[yt].y),this.indexArray2.emplaceBack(dt+yt-1,dt+yt),Te.push(qe[yt].x),Te.push(qe[yt].y);rt.vertexLength+=qe.length,rt.primitiveLength+=qe.length}const $e=ch(Te,Re);for(let qe=0;qe<$e.length;qe+=3)this.indexArray.emplaceBack(be+$e[qe],be+$e[qe+1],be+$e[qe+2]);he.vertexLength+=ae,he.primitiveLength+=$e.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,j,H,z)}}wi("FillBucket",gh,{omit:["layers","patternFeatures"]});const Vd=new Jt({"fill-sort-key":new Et(Ct.layout_fill["fill-sort-key"])});var Zd={paint:new Jt({"fill-antialias":new ut(Ct.paint_fill["fill-antialias"]),"fill-opacity":new Et(Ct.paint_fill["fill-opacity"]),"fill-color":new Et(Ct.paint_fill["fill-color"]),"fill-outline-color":new Et(Ct.paint_fill["fill-outline-color"]),"fill-translate":new ut(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Ct.paint_fill["fill-pattern"])}),layout:Vd};const Hd=Gt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wd=Gt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:qd}=Hd;var Lc=Yo;function Yo(b,d,w,C,z){this.properties={},this.extent=w,this.type=0,this._pbf=b,this._geometry=-1,this._keys=C,this._values=z,b.readFields(Xd,this,d)}function Xd(b,d,w){b==1?d.id=w.readVarint():b==2?function(C,z){for(var j=C.readVarint()+C.pos;C.pos<j;){var H=z._keys[C.readVarint()],ee=z._values[C.readVarint()];z.properties[H]=ee}}(w,d):b==3?d.type=w.readVarint():b==4&&(d._geometry=w.pos)}function Yd(b){for(var d,w,C=0,z=0,j=b.length,H=j-1;z<j;H=z++)C+=((w=b[H]).x-(d=b[z]).x)*(d.y+w.y);return C}Yo.types=["Unknown","Point","LineString","Polygon"],Yo.prototype.loadGeometry=function(){var b=this._pbf;b.pos=this._geometry;for(var d,w=b.readVarint()+b.pos,C=1,z=0,j=0,H=0,ee=[];b.pos<w;){if(z<=0){var ae=b.readVarint();C=7&ae,z=ae>>3}if(z--,C===1||C===2)j+=b.readSVarint(),H+=b.readSVarint(),C===1&&(d&&ee.push(d),d=[]),d.push(new k(j,H));else{if(C!==7)throw new Error("unknown command "+C);d&&d.push(d[0].clone())}}return d&&ee.push(d),ee},Yo.prototype.bbox=function(){var b=this._pbf;b.pos=this._geometry;for(var d=b.readVarint()+b.pos,w=1,C=0,z=0,j=0,H=1/0,ee=-1/0,ae=1/0,he=-1/0;b.pos<d;){if(C<=0){var be=b.readVarint();w=7&be,C=be>>3}if(C--,w===1||w===2)(z+=b.readSVarint())<H&&(H=z),z>ee&&(ee=z),(j+=b.readSVarint())<ae&&(ae=j),j>he&&(he=j);else if(w!==7)throw new Error("unknown command "+w)}return[H,ae,ee,he]},Yo.prototype.toGeoJSON=function(b,d,w){var C,z,j=this.extent*Math.pow(2,w),H=this.extent*b,ee=this.extent*d,ae=this.loadGeometry(),he=Yo.types[this.type];function be($e){for(var qe=0;qe<$e.length;qe++){var rt=$e[qe];$e[qe]=[360*(rt.x+H)/j-180,360/Math.PI*Math.atan(Math.exp((180-360*(rt.y+ee)/j)*Math.PI/180))-90]}}switch(this.type){case 1:var Te=[];for(C=0;C<ae.length;C++)Te[C]=ae[C][0];be(ae=Te);break;case 2:for(C=0;C<ae.length;C++)be(ae[C]);break;case 3:for(ae=function($e){var qe=$e.length;if(qe<=1)return[$e];for(var rt,dt,yt=[],Mt=0;Mt<qe;Mt++){var Pt=Yd($e[Mt]);Pt!==0&&(dt===void 0&&(dt=Pt<0),dt===Pt<0?(rt&&yt.push(rt),rt=[$e[Mt]]):rt.push($e[Mt]))}return rt&&yt.push(rt),yt}(ae),C=0;C<ae.length;C++)for(z=0;z<ae[C].length;z++)be(ae[C][z])}ae.length===1?ae=ae[0]:he="Multi"+he;var Re={type:"Feature",geometry:{type:he,coordinates:ae},properties:this.properties};return"id"in this&&(Re.id=this.id),Re};var Bc=Oc;function Oc(b,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=b,this._keys=[],this._values=[],this._features=[],b.readFields(Kd,this,d),this.length=this._features.length}function Kd(b,d,w){b===15?d.version=w.readVarint():b===1?d.name=w.readString():b===5?d.extent=w.readVarint():b===2?d._features.push(w.pos):b===3?d._keys.push(w.readString()):b===4&&d._values.push(function(C){for(var z=null,j=C.readVarint()+C.pos;C.pos<j;){var H=C.readVarint()>>3;z=H===1?C.readString():H===2?C.readFloat():H===3?C.readDouble():H===4?C.readVarint64():H===5?C.readVarint():H===6?C.readSVarint():H===7?C.readBoolean():null}return z}(w))}function Jd(b,d,w){if(b===3){var C=new Bc(w,w.readVarint()+w.pos);C.length&&(d[C.name]=C)}}Oc.prototype.feature=function(b){if(b<0||b>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[b];var d=this._pbf.readVarint()+this._pbf.pos;return new Lc(this._pbf,d,this.extent,this._keys,this._values)};var to={VectorTile:function(b,d){this.layers=b.readFields(Jd,{},d)},VectorTileFeature:Lc,VectorTileLayer:Bc};const Qd=to.VectorTileFeature.types,ep=Math.pow(2,13);function Js(b,d,w,C,z,j,H,ee){b.emplaceBack((d<<1)+H,(w<<1)+j,(Math.floor(C*ep)<<1)+z,Math.round(ee))}class Fc{constructor(){this.acc=new k(0,0),this.polyCount=[]}startRing(d){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new k(d.x,d.y),this.max=new k(d.x,d.y))}append(d,w){this.currentPolyCount.edges++,this.acc._add(d);let C=!!this.borders;const z=this.min,j=this.max;d.x<z.x?(z.x=d.x,C=!0):d.x>j.x&&(j.x=d.x,C=!0),d.y<z.y?(z.y=d.y,C=!0):d.y>j.y&&(j.y=d.y,C=!0),((d.x===0||d.x===ji)&&d.x===w.x)!=((d.y===0||d.y===ji)&&d.y===w.y)&&this.processBorderOverlap(d,w),C&&this.checkBorderIntersection(d,w)}checkBorderIntersection(d,w){w.x<0!=d.x<0&&this.addBorderIntersection(0,Vi(w.y,d.y,(0-w.x)/(d.x-w.x))),w.x>ji!=d.x>ji&&this.addBorderIntersection(1,Vi(w.y,d.y,(ji-w.x)/(d.x-w.x))),w.y<0!=d.y<0&&this.addBorderIntersection(2,Vi(w.x,d.x,(0-w.y)/(d.y-w.y))),w.y>ji!=d.y>ji&&this.addBorderIntersection(3,Vi(w.x,d.x,(ji-w.y)/(d.y-w.y)))}addBorderIntersection(d,w){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const C=this.borders[d];w<C[0]&&(C[0]=w),w>C[1]&&(C[1]=w)}processBorderOverlap(d,w){if(d.x===w.x){if(d.y===w.y)return;const C=d.x===0?0:1;this.addBorderIntersection(C,w.y),this.addBorderIntersection(C,d.y)}else{const C=d.y===0?2:3;this.addBorderIntersection(C,w.x),this.addBorderIntersection(C,d.x)}}centroid(){const d=this.polyCount.reduce((w,C)=>w+C.edges,0);return d!==0?this.acc.div(d)._round():new k(0,0)}span(){return new k(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((d,w)=>d+ +(w[0]!==Number.MAX_VALUE),0)}}class xu{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(w=>w.id),this.index=d.index,this.hasPattern=!1,this.layoutVertexArray=new Ai,this.centroidVertexArray=new Ku,this.indexArray=new _r,this.programConfigurations=new Ka(d.layers,d.zoom),this.segments=new Cr,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.enableTerrain=d.enableTerrain}populate(d,w,C,z){this.features=[],this.hasPattern=yu("fill-extrusion",this.layers,w),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(j){const H=Math.exp(Math.PI*(1-j.y/(1<<j.z)*2));return 80150034*H/(H*H+1)/ji/(1<<j.z)}(C);for(const{feature:j,id:H,index:ee,sourceLayerIndex:ae}of d){const he=this.layers[0]._featureFilter.needGeometry,be=eo(j,he);if(!this.layers[0]._featureFilter.filter(new Ue(this.zoom),be,C))continue;const Te={id:H,sourceLayerIndex:ae,index:ee,geometry:he?be.geometry:Kn(j,C,z),properties:j.properties,type:j.type,patterns:{}},Re=this.layoutVertexArray.length;this.hasPattern?this.features.push(vu("fill-extrusion",this.layers,Te,this.zoom,w)):this.addFeature(Te,Te.geometry,ee,C,{},w.availableImages),w.featureIndex.insert(j,Te.geometry,ee,ae,this.index,Re)}this.sortBorders()}addFeatures(d,w,C,z){for(const j of this.features){const{geometry:H}=j;this.addFeature(j,H,j.index,w,C,z)}this.sortBorders()}update(d,w,C,z){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,w,this.stateDependentLayers,C,z)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,qd),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}uploadCentroid(d){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=d.createVertexBuffer(this.centroidVertexArray,Wd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(d,w,C,z,j,H){const ee=this.enableTerrain?new Fc:null;for(const he of _u(w,500)){let be=0,Te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(he.length===0||(ae=he[0]).every(dt=>dt.x<=0)||ae.every(dt=>dt.x>=ji)||ae.every(dt=>dt.y<=0)||ae.every(dt=>dt.y>=ji))continue;for(let dt=0;dt<he.length;dt++){const yt=he[dt];if(yt.length===0)continue;be+=yt.length;let Mt=0;ee&&ee.startRing(yt[0]);for(let Pt=0;Pt<yt.length;Pt++){const Ot=yt[Pt];if(Pt>=1){const Lt=yt[Pt-1];if(!tp(Ot,Lt)){ee&&ee.append(Ot,Lt),Te.vertexLength+4>Cr.MAX_VERTEX_ARRAY_LENGTH&&(Te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ft=Ot.sub(Lt)._perp(),ei=Ft.x/(Math.abs(Ft.x)+Math.abs(Ft.y)),Xt=Ft.y>0?1:0,yi=Lt.dist(Ot);Mt+yi>32768&&(Mt=0),Js(this.layoutVertexArray,Ot.x,Ot.y,ei,Xt,0,0,Mt),Js(this.layoutVertexArray,Ot.x,Ot.y,ei,Xt,0,1,Mt),Mt+=yi,Js(this.layoutVertexArray,Lt.x,Lt.y,ei,Xt,0,0,Mt),Js(this.layoutVertexArray,Lt.x,Lt.y,ei,Xt,0,1,Mt);const oi=Te.vertexLength;this.indexArray.emplaceBack(oi,oi+2,oi+1),this.indexArray.emplaceBack(oi+1,oi+2,oi+3),Te.vertexLength+=4,Te.primitiveLength+=2}}}}if(Te.vertexLength+be>Cr.MAX_VERTEX_ARRAY_LENGTH&&(Te=this.segments.prepareSegment(be,this.layoutVertexArray,this.indexArray)),Qd[d.type]!=="Polygon")continue;const Re=[],$e=[],qe=Te.vertexLength;for(let dt=0;dt<he.length;dt++){const yt=he[dt];if(yt.length!==0){yt!==he[0]&&$e.push(Re.length/2);for(let Mt=0;Mt<yt.length;Mt++){const Pt=yt[Mt];Js(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),Re.push(Pt.x),Re.push(Pt.y),ee&&ee.currentPolyCount.top++}}}const rt=ch(Re,$e);for(let dt=0;dt<rt.length;dt+=3)this.indexArray.emplaceBack(qe+rt[dt],qe+rt[dt+2],qe+rt[dt+1]);Te.primitiveLength+=rt.length/3,Te.vertexLength+=be}var ae;if(ee&&ee.polyCount.length>0){if(ee.borders){ee.vertexArrayOffset=this.centroidVertexArray.length;const he=ee.borders,be=this.featuresOnBorder.push(ee)-1;for(let Te=0;Te<4;Te++)he[Te][0]!==Number.MAX_VALUE&&this.borders[Te].push(be)}this.encodeCentroid(ee.borders?void 0:ee.centroid(),ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,j,H,z)}sortBorders(){for(let d=0;d<4;d++)this.borders[d].sort((w,C)=>this.featuresOnBorder[w].borders[d][0]-this.featuresOnBorder[C].borders[d][0])}encodeCentroid(d,w,C=!0){let z,j;if(d)if(d.y!==0){const ee=w.span()._mult(this.tileToMeter);z=(Math.max(d.x,1)<<3)+Math.min(7,Math.round(ee.x/10)),j=(Math.max(d.y,1)<<3)+Math.min(7,Math.round(ee.y/10))}else z=Math.ceil(7*(d.x+450)),j=0;else z=0,j=+C;let H=C?this.centroidVertexArray.length:w.vertexArrayOffset;for(const ee of w.polyCount){C&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*ee.edges+ee.top);for(let ae=0;ae<2*ee.edges;ae++)this.centroidVertexArray.emplace(H++,0,j),this.centroidVertexArray.emplace(H++,z,j);for(let ae=0;ae<ee.top;ae++)this.centroidVertexArray.emplace(H++,z,j)}}}function tp(b,d){return b.x===d.x&&(b.x<0||b.x>ji)||b.y===d.y&&(b.y<0||b.y>ji)}wi("FillExtrusionBucket",xu,{omit:["layers","features"]}),wi("PartMetadata",Fc);var ip={paint:new Jt({"fill-extrusion-opacity":new ut(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Et(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Qs(b,d){return b.x*d.x+b.y*d.y}function zc(b,d){if(b.length===1){let w=0;const C=d[w++];let z;for(;!z||C.equals(z);)if(z=d[w++],!z)return 1/0;for(;w<d.length;w++){const j=d[w],H=b[0],ee=z.sub(C),ae=j.sub(C),he=H.sub(C),be=Qs(ee,ee),Te=Qs(ee,ae),Re=Qs(ae,ae),$e=Qs(he,ee),qe=Qs(he,ae),rt=be*Re-Te*Te,dt=(Re*$e-Te*qe)/rt,yt=(be*qe-Te*$e)/rt,Mt=C.z*(1-dt-yt)+z.z*dt+j.z*yt;if(isFinite(Mt))return Mt}return 1/0}{let w=1/0;for(const C of d)w=Math.min(w,C.z);return w}}function Nc(b){const d=new k(b[0],b[1]);return d.z=b[2],d}function rp(b,d,w,C,z,j,H,ee){const ae=H*z.getElevationAt(b,d,!0,!0),he=j[0]!==0,be=he?j[1]===0?H*(j[0]/7-450):H*function(Te,Re,$e){const qe=Math.floor(Re[0]/8),rt=Math.floor(Re[1]/8),dt=10*(Re[0]-8*qe),yt=10*(Re[1]-8*rt),Mt=Te.getElevationAt(qe,rt,!0,!0),Pt=Te.getMeterToDEM($e),Ot=Math.floor(.5*(dt*Pt-1)),Lt=Math.floor(.5*(yt*Pt-1)),Ft=Te.tileCoordToPixel(qe,rt),ei=2*Ot+1,Xt=2*Lt+1,yi=function(vi,bi,Li,Qi,Ii){return[vi.getElevationAtPixel(bi,Li,!0),vi.getElevationAtPixel(bi+Ii,Li,!0),vi.getElevationAtPixel(bi,Li+Ii,!0),vi.getElevationAtPixel(bi+Qi,Li+Ii,!0)]}(Te,Ft.x-Ot,Ft.y-Lt,ei,Xt),oi=Math.abs(yi[0]-yi[1]),ti=Math.abs(yi[2]-yi[3]),si=Math.abs(yi[0]-yi[2])+Math.abs(yi[1]-yi[3]),ui=Math.min(.25,.5*Pt*(oi+ti)/ei),ni=Math.min(.25,.5*Pt*si/Xt);return Mt+Math.max(ui*dt,ni*yt)}(z,j,ee):ae;return{base:ae+(w===0)?-1:w,top:he?Math.max(be+C,ae+w+2):ae+C}}const np=Gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ap}=np,op=Gt([{name:"a_packed",components:3,type:"Float32"}]),{members:sp}=op,lp=to.VectorTileFeature.types,hp=Math.cos(Math.PI/180*37.5);class _h{constructor(d){this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(w=>w.id),this.index=d.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(w=>{this.gradients[w.id]={}}),this.layoutVertexArray=new Ci,this.layoutVertexArray2=new Di,this.indexArray=new _r,this.programConfigurations=new Ka(d.layers,d.zoom),this.segments=new Cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(d,w,C,z){this.hasPattern=yu("line",this.layers,w);const j=this.layers[0].layout.get("line-sort-key"),H=[];for(const{feature:be,id:Te,index:Re,sourceLayerIndex:$e}of d){const qe=this.layers[0]._featureFilter.needGeometry,rt=eo(be,qe);if(!this.layers[0]._featureFilter.filter(new Ue(this.zoom),rt,C))continue;const dt=j?j.evaluate(rt,{},C):void 0,yt={id:Te,properties:be.properties,type:be.type,sourceLayerIndex:$e,index:Re,geometry:qe?rt.geometry:Kn(be,C,z),patterns:{},sortKey:dt};H.push(yt)}j&&H.sort((be,Te)=>be.sortKey-Te.sortKey);const{lineAtlas:ee,featureIndex:ae}=w,he=this.addConstantDashes(ee);for(const be of H){const{geometry:Te,index:Re,sourceLayerIndex:$e}=be;if(he&&this.addFeatureDashes(be,ee),this.hasPattern){const qe=vu("line",this.layers,be,this.zoom,w);this.patternFeatures.push(qe)}else this.addFeature(be,Te,Re,C,ee.positions,w.availableImages);ae.insert(d[Re].feature,Te,Re,$e,this.index)}}addConstantDashes(d){let w=!1;for(const C of this.layers){const z=C.paint.get("line-dasharray").value,j=C.layout.get("line-cap").value;if(z.kind!=="constant"||j.kind!=="constant")w=!0;else{const H=j.value,ee=z.value;if(!ee)continue;d.addDash(ee.from,H),d.addDash(ee.to,H),ee.other&&d.addDash(ee.other,H)}}return w}addFeatureDashes(d,w){const C=this.zoom;for(const z of this.layers){const j=z.paint.get("line-dasharray").value,H=z.layout.get("line-cap").value;if(j.kind==="constant"&&H.kind==="constant")continue;let ee,ae,he,be,Te,Re;if(j.kind==="constant"){const dt=j.value;if(!dt)continue;ee=dt.other||dt.to,ae=dt.to,he=dt.from}else ee=j.evaluate({zoom:C-1},d),ae=j.evaluate({zoom:C},d),he=j.evaluate({zoom:C+1},d);H.kind==="constant"?be=Te=Re=H.value:(be=H.evaluate({zoom:C-1},d),Te=H.evaluate({zoom:C},d),Re=H.evaluate({zoom:C+1},d)),w.addDash(ee,be),w.addDash(ae,Te),w.addDash(he,Re);const $e=w.getKey(ee,be),qe=w.getKey(ae,Te),rt=w.getKey(he,Re);d.patterns[z.id]={min:$e,mid:qe,max:rt}}}update(d,w,C,z){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(d,w,this.stateDependentLayers,C,z)}addFeatures(d,w,C,z){for(const j of this.patternFeatures)this.addFeature(j,j.geometry,j.index,w,C,z)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(d){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=d.createVertexBuffer(this.layoutVertexArray2,sp)),this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,ap),this.indexBuffer=d.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(d),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(d){if(d.properties&&d.properties.hasOwnProperty("mapbox_clip_start")&&d.properties.hasOwnProperty("mapbox_clip_end"))return{start:+d.properties.mapbox_clip_start,end:+d.properties.mapbox_clip_end}}addFeature(d,w,C,z,j,H){const ee=this.layers[0].layout,ae=ee.get("line-join").evaluate(d,{}),he=ee.get("line-cap").evaluate(d,{}),be=ee.get("line-miter-limit"),Te=ee.get("line-round-limit");this.lineClips=this.lineFeatureClips(d);for(const Re of w)this.addLine(Re,d,ae,he,be,Te);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,d,C,j,H,z)}addLine(d,w,C,z,j,H){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let yt=0;yt<d.length-1;yt++)this.totalDistance+=d[yt].dist(d[yt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const ee=lp[w.type]==="Polygon";let ae=d.length;for(;ae>=2&&d[ae-1].equals(d[ae-2]);)ae--;let he=0;for(;he<ae-1&&d[he].equals(d[he+1]);)he++;if(ae<(ee?3:2))return;C==="bevel"&&(j=1.05);const be=this.overscaling<=16?122880/(512*this.overscaling):0,Te=this.segments.prepareSegment(10*ae,this.layoutVertexArray,this.indexArray);let Re,$e,qe,rt,dt;this.e1=this.e2=-1,ee&&(Re=d[ae-2],dt=d[he].sub(Re)._unit()._perp());for(let yt=he;yt<ae;yt++){if(qe=yt===ae-1?ee?d[he+1]:void 0:d[yt+1],qe&&d[yt].equals(qe))continue;dt&&(rt=dt),Re&&($e=Re),Re=d[yt],dt=qe?qe.sub(Re)._unit()._perp():rt,rt=rt||dt;let Mt=rt.add(dt);Mt.x===0&&Mt.y===0||Mt._unit();const Pt=rt.x*dt.x+rt.y*dt.y,Ot=Mt.x*dt.x+Mt.y*dt.y,Lt=Ot!==0?1/Ot:1/0,Ft=2*Math.sqrt(2-2*Ot),ei=Ot<hp&&$e&&qe,Xt=rt.x*dt.y-rt.y*dt.x>0;if(ei&&yt>he){const ti=Re.dist($e);if(ti>2*be){const si=Re.sub(Re.sub($e)._mult(be/ti)._round());this.updateDistance($e,si),this.addCurrentVertex(si,rt,0,0,Te),$e=si}}const yi=$e&&qe;let oi=yi?C:ee?"butt":z;if(yi&&oi==="round"&&(Lt<H?oi="miter":Lt<=2&&(oi="fakeround")),oi==="miter"&&Lt>j&&(oi="bevel"),oi==="bevel"&&(Lt>2&&(oi="flipbevel"),Lt<j&&(oi="miter")),$e&&this.updateDistance($e,Re),oi==="miter")Mt._mult(Lt),this.addCurrentVertex(Re,Mt,0,0,Te);else if(oi==="flipbevel"){if(Lt>100)Mt=dt.mult(-1);else{const ti=Lt*rt.add(dt).mag()/rt.sub(dt).mag();Mt._perp()._mult(ti*(Xt?-1:1))}this.addCurrentVertex(Re,Mt,0,0,Te),this.addCurrentVertex(Re,Mt.mult(-1),0,0,Te)}else if(oi==="bevel"||oi==="fakeround"){const ti=-Math.sqrt(Lt*Lt-1),si=Xt?ti:0,ui=Xt?0:ti;if($e&&this.addCurrentVertex(Re,rt,si,ui,Te),oi==="fakeround"){const ni=Math.round(180*Ft/Math.PI/20);for(let vi=1;vi<ni;vi++){let bi=vi/ni;if(bi!==.5){const Qi=bi-.5;bi+=bi*Qi*(bi-1)*((1.0904+Pt*(Pt*(3.55645-1.43519*Pt)-3.2452))*Qi*Qi+(.848013+Pt*(.215638*Pt-1.06021)))}const Li=dt.sub(rt)._mult(bi)._add(rt)._unit()._mult(Xt?-1:1);this.addHalfVertex(Re,Li.x,Li.y,!1,Xt,0,Te)}}qe&&this.addCurrentVertex(Re,dt,-si,-ui,Te)}else if(oi==="butt")this.addCurrentVertex(Re,Mt,0,0,Te);else if(oi==="square"){const ti=$e?1:-1;$e||this.addCurrentVertex(Re,Mt,ti,ti,Te),this.addCurrentVertex(Re,Mt,0,0,Te),$e&&this.addCurrentVertex(Re,Mt,ti,ti,Te)}else oi==="round"&&($e&&(this.addCurrentVertex(Re,rt,0,0,Te),this.addCurrentVertex(Re,rt,1,1,Te,!0)),qe&&(this.addCurrentVertex(Re,dt,-1,-1,Te,!0),this.addCurrentVertex(Re,dt,0,0,Te)));if(ei&&yt<ae-1){const ti=Re.dist(qe);if(ti>2*be){const si=Re.add(qe.sub(Re)._mult(be/ti)._round());this.updateDistance(Re,si),this.addCurrentVertex(si,dt,0,0,Te),Re=si}}}}addCurrentVertex(d,w,C,z,j,H=!1){const ee=w.y*z-w.x,ae=-w.y-w.x*z;this.addHalfVertex(d,w.x+w.y*C,w.y-w.x*C,H,!1,C,j),this.addHalfVertex(d,ee,ae,H,!0,-z,j)}addHalfVertex({x:d,y:w},C,z,j,H,ee,ae){this.layoutVertexArray.emplaceBack((d<<1)+(j?1:0),(w<<1)+(H?1:0),Math.round(63*C)+128,Math.round(63*z)+128,1+(ee===0?0:ee<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const he=ae.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,he),ae.primitiveLength++),H?this.e2=he:this.e1=he}updateScaledDistance(){if(this.lineClips){const d=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=d*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(d,w){this.distance+=d.dist(w),this.updateScaledDistance()}}wi("LineBucket",_h,{omit:["layers","patternFeatures"]});const up=new Jt({"line-cap":new Et(Ct.layout_line["line-cap"]),"line-join":new Et(Ct.layout_line["line-join"]),"line-miter-limit":new ut(Ct.layout_line["line-miter-limit"]),"line-round-limit":new ut(Ct.layout_line["line-round-limit"]),"line-sort-key":new Et(Ct.layout_line["line-sort-key"])});var Uc={paint:new Jt({"line-opacity":new Et(Ct.paint_line["line-opacity"]),"line-color":new Et(Ct.paint_line["line-color"]),"line-translate":new ut(Ct.paint_line["line-translate"]),"line-translate-anchor":new ut(Ct.paint_line["line-translate-anchor"]),"line-width":new Et(Ct.paint_line["line-width"]),"line-gap-width":new Et(Ct.paint_line["line-gap-width"]),"line-offset":new Et(Ct.paint_line["line-offset"]),"line-blur":new Et(Ct.paint_line["line-blur"]),"line-dasharray":new kt(Ct.paint_line["line-dasharray"]),"line-pattern":new kt(Ct.paint_line["line-pattern"]),"line-gradient":new Zt(Ct.paint_line["line-gradient"])}),layout:up};const $c=new class extends Et{possiblyEvaluate(b,d){return d=new Ue(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(b,d)}evaluate(b,d,w,C){return d=te({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(b,d,w,C)}}(Uc.paint.properties["line-width"].specification);function jc(b,d){return d>0?d+2*b:b}$c.useIntegerZoom=!0;const cp=Gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),fp=Gt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dp=Gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pp=Gt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gc=Gt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mp=Gt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gt([{name:"triangle",components:3,type:"Uint16"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gt([{type:"Float32",name:"offsetX"}]),Gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Lr=24;const Ln=128;function bu(b,d){const{expression:w}=d;if(w.kind==="constant")return{kind:"constant",layoutSize:w.evaluate(new Ue(b+1))};if(w.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:z}=w;let j=0;for(;j<C.length&&C[j]<=b;)j++;j=Math.max(0,j-1);let H=j;for(;H<C.length&&C[H]<b+1;)H++;H=Math.min(C.length-1,H);const ee=C[j],ae=C[H];return w.kind==="composite"?{kind:"composite",minZoom:ee,maxZoom:ae,interpolationType:z}:{kind:"camera",minZoom:ee,maxZoom:ae,minSize:w.evaluate(new Ue(ee)),maxSize:w.evaluate(new Ue(ae)),interpolationType:z}}}function yh(b,{uSize:d,uSizeT:w},{lowerSize:C,upperSize:z}){return b.kind==="source"?C/Ln:b.kind==="composite"?Vi(C/Ln,z/Ln,w):d}function Ko(b,d){let w=0,C=0;if(b.kind==="constant")C=b.layoutSize;else if(b.kind!=="source"){const{interpolationType:z,minZoom:j,maxZoom:H}=b,ee=z?Y(Zr.interpolationFactor(z,d,j,H),0,1):0;b.kind==="camera"?C=Vi(b.minSize,b.maxSize,ee):w=ee}return{uSizeT:w,uSize:C}}var gp=Object.freeze({__proto__:null,getSizeData:bu,evaluateSizeForFeature:yh,evaluateSizeForZoom:Ko,SIZE_PACK_FACTOR:Ln});function _p(b,d,w){return b.sections.forEach(C=>{C.text=function(z,j,H){const ee=j.layout.get("text-transform").evaluate(H,{});return ee==="uppercase"?z=z.toLocaleUpperCase():ee==="lowercase"&&(z=z.toLocaleLowerCase()),Fe.applyArabicShaping&&(z=Fe.applyArabicShaping(z)),z}(C.text,d,w)}),b}const el={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function yp(b){return b==="\uFE36"||b==="\uFE48"||b==="\uFE38"||b==="\uFE44"||b==="\uFE42"||b==="\uFE3E"||b==="\uFE3C"||b==="\uFE3A"||b==="\uFE18"||b==="\uFE40"||b==="\uFE10"||b==="\uFE13"||b==="\uFE14"||b==="\uFF40"||b==="\uFFE3"||b==="\uFE11"||b==="\uFE12"}function vp(b){return b==="\uFE35"||b==="\uFE47"||b==="\uFE37"||b==="\uFE43"||b==="\uFE41"||b==="\uFE3D"||b==="\uFE3B"||b==="\uFE39"||b==="\uFE17"||b==="\uFE3F"}var Vc=function(b,d,w,C,z){var j,H,ee=8*z-C-1,ae=(1<<ee)-1,he=ae>>1,be=-7,Te=w?z-1:0,Re=w?-1:1,$e=b[d+Te];for(Te+=Re,j=$e&(1<<-be)-1,$e>>=-be,be+=ee;be>0;j=256*j+b[d+Te],Te+=Re,be-=8);for(H=j&(1<<-be)-1,j>>=-be,be+=C;be>0;H=256*H+b[d+Te],Te+=Re,be-=8);if(j===0)j=1-he;else{if(j===ae)return H?NaN:1/0*($e?-1:1);H+=Math.pow(2,C),j-=he}return($e?-1:1)*H*Math.pow(2,j-C)},Zc=function(b,d,w,C,z,j){var H,ee,ae,he=8*j-z-1,be=(1<<he)-1,Te=be>>1,Re=z===23?Math.pow(2,-24)-Math.pow(2,-77):0,$e=C?0:j-1,qe=C?1:-1,rt=d<0||d===0&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(ee=isNaN(d)?1:0,H=be):(H=Math.floor(Math.log(d)/Math.LN2),d*(ae=Math.pow(2,-H))<1&&(H--,ae*=2),(d+=H+Te>=1?Re/ae:Re*Math.pow(2,1-Te))*ae>=2&&(H++,ae/=2),H+Te>=be?(ee=0,H=be):H+Te>=1?(ee=(d*ae-1)*Math.pow(2,z),H+=Te):(ee=d*Math.pow(2,Te-1)*Math.pow(2,z),H=0));z>=8;b[w+$e]=255&ee,$e+=qe,ee/=256,z-=8);for(H=H<<z|ee,he+=z;he>0;b[w+$e]=255&H,$e+=qe,H/=256,he-=8);b[w+$e-qe]|=128*rt},tl=Ji;function Ji(b){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(b)?b:new Uint8Array(b||0),this.pos=0,this.type=0,this.length=this.buf.length}Ji.Varint=0,Ji.Fixed64=1,Ji.Bytes=2,Ji.Fixed32=5;var wu=4294967296,Hc=1/wu,Wc=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Jn(b){return b.type===Ji.Bytes?b.readVarint()+b.pos:b.pos+1}function Jo(b,d,w){return w?4294967296*d+(b>>>0):4294967296*(d>>>0)+(b>>>0)}function qc(b,d,w){var C=d<=16383?1:d<=2097151?2:d<=268435455?3:Math.floor(Math.log(d)/(7*Math.LN2));w.realloc(C);for(var z=w.pos-1;z>=b;z--)w.buf[z+C]=w.buf[z]}function xp(b,d){for(var w=0;w<b.length;w++)d.writeVarint(b[w])}function bp(b,d){for(var w=0;w<b.length;w++)d.writeSVarint(b[w])}function wp(b,d){for(var w=0;w<b.length;w++)d.writeFloat(b[w])}function Ep(b,d){for(var w=0;w<b.length;w++)d.writeDouble(b[w])}function Sp(b,d){for(var w=0;w<b.length;w++)d.writeBoolean(b[w])}function Mp(b,d){for(var w=0;w<b.length;w++)d.writeFixed32(b[w])}function Tp(b,d){for(var w=0;w<b.length;w++)d.writeSFixed32(b[w])}function Ap(b,d){for(var w=0;w<b.length;w++)d.writeFixed64(b[w])}function Cp(b,d){for(var w=0;w<b.length;w++)d.writeSFixed64(b[w])}function vh(b,d){return(b[d]|b[d+1]<<8|b[d+2]<<16)+16777216*b[d+3]}function Qo(b,d,w){b[w]=d,b[w+1]=d>>>8,b[w+2]=d>>>16,b[w+3]=d>>>24}function Xc(b,d){return(b[d]|b[d+1]<<8|b[d+2]<<16)+(b[d+3]<<24)}function Ip(b,d,w){d.glyphs=[],b===1&&w.readMessage(kp,d)}function kp(b,d,w){if(b===3){const{id:C,bitmap:z,width:j,height:H,left:ee,top:ae,advance:he}=w.readMessage(Dp,{});d.glyphs.push({id:C,bitmap:new xa({width:j+6,height:H+6},z),metrics:{width:j,height:H,left:ee,top:ae,advance:he}})}else b===4?d.ascender=w.readSVarint():b===5&&(d.descender=w.readSVarint())}function Dp(b,d,w){b===1?d.id=w.readVarint():b===2?d.bitmap=w.readBytes():b===3?d.width=w.readVarint():b===4?d.height=w.readVarint():b===5?d.left=w.readSVarint():b===6?d.top=w.readSVarint():b===7&&(d.advance=w.readVarint())}function Eu(b){let d=0,w=0;for(const H of b)d+=H.w*H.h,w=Math.max(w,H.w);b.sort((H,ee)=>ee.h-H.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(d/.95)),w),h:1/0}];let z=0,j=0;for(const H of b)for(let ee=C.length-1;ee>=0;ee--){const ae=C[ee];if(!(H.w>ae.w||H.h>ae.h)){if(H.x=ae.x,H.y=ae.y,j=Math.max(j,H.y+H.h),z=Math.max(z,H.x+H.w),H.w===ae.w&&H.h===ae.h){const he=C.pop();ee<C.length&&(C[ee]=he)}else H.h===ae.h?(ae.x+=H.w,ae.w-=H.w):H.w===ae.w?(ae.y+=H.h,ae.h-=H.h):(C.push({x:ae.x+H.w,y:ae.y,w:ae.w-H.w,h:H.h}),ae.y+=H.h,ae.h-=H.h);break}}return{w:z,h:j,fill:d/(z*j)||0}}Ji.prototype={destroy:function(){this.buf=null},readFields:function(b,d,w){for(w=w||this.length;this.pos<w;){var C=this.readVarint(),z=C>>3,j=this.pos;this.type=7&C,b(z,d,this),this.pos===j&&this.skip(C)}return d},readMessage:function(b,d){return this.readFields(b,d,this.readVarint()+this.pos)},readFixed32:function(){var b=vh(this.buf,this.pos);return this.pos+=4,b},readSFixed32:function(){var b=Xc(this.buf,this.pos);return this.pos+=4,b},readFixed64:function(){var b=vh(this.buf,this.pos)+vh(this.buf,this.pos+4)*wu;return this.pos+=8,b},readSFixed64:function(){var b=vh(this.buf,this.pos)+Xc(this.buf,this.pos+4)*wu;return this.pos+=8,b},readFloat:function(){var b=Vc(this.buf,this.pos,!0,23,4);return this.pos+=4,b},readDouble:function(){var b=Vc(this.buf,this.pos,!0,52,8);return this.pos+=8,b},readVarint:function(b){var d,w,C=this.buf;return d=127&(w=C[this.pos++]),w<128?d:(d|=(127&(w=C[this.pos++]))<<7,w<128?d:(d|=(127&(w=C[this.pos++]))<<14,w<128?d:(d|=(127&(w=C[this.pos++]))<<21,w<128?d:function(z,j,H){var ee,ae,he=H.buf;if(ee=(112&(ae=he[H.pos++]))>>4,ae<128||(ee|=(127&(ae=he[H.pos++]))<<3,ae<128)||(ee|=(127&(ae=he[H.pos++]))<<10,ae<128)||(ee|=(127&(ae=he[H.pos++]))<<17,ae<128)||(ee|=(127&(ae=he[H.pos++]))<<24,ae<128)||(ee|=(1&(ae=he[H.pos++]))<<31,ae<128))return Jo(z,ee,j);throw new Error("Expected varint not more than 10 bytes")}(d|=(15&(w=C[this.pos]))<<28,b,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var b=this.readVarint();return b%2==1?(b+1)/-2:b/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var b=this.readVarint()+this.pos,d=this.pos;return this.pos=b,b-d>=12&&Wc?function(w,C,z){return Wc.decode(w.subarray(C,z))}(this.buf,d,b):function(w,C,z){for(var j="",H=C;H<z;){var ee,ae,he,be=w[H],Te=null,Re=be>239?4:be>223?3:be>191?2:1;if(H+Re>z)break;Re===1?be<128&&(Te=be):Re===2?(192&(ee=w[H+1]))==128&&(Te=(31&be)<<6|63&ee)<=127&&(Te=null):Re===3?(ae=w[H+2],(192&(ee=w[H+1]))==128&&(192&ae)==128&&((Te=(15&be)<<12|(63&ee)<<6|63&ae)<=2047||Te>=55296&&Te<=57343)&&(Te=null)):Re===4&&(ae=w[H+2],he=w[H+3],(192&(ee=w[H+1]))==128&&(192&ae)==128&&(192&he)==128&&((Te=(15&be)<<18|(63&ee)<<12|(63&ae)<<6|63&he)<=65535||Te>=1114112)&&(Te=null)),Te===null?(Te=65533,Re=1):Te>65535&&(Te-=65536,j+=String.fromCharCode(Te>>>10&1023|55296),Te=56320|1023&Te),j+=String.fromCharCode(Te),H+=Re}return j}(this.buf,d,b)},readBytes:function(){var b=this.readVarint()+this.pos,d=this.buf.subarray(this.pos,b);return this.pos=b,d},readPackedVarint:function(b,d){if(this.type!==Ji.Bytes)return b.push(this.readVarint(d));var w=Jn(this);for(b=b||[];this.pos<w;)b.push(this.readVarint(d));return b},readPackedSVarint:function(b){if(this.type!==Ji.Bytes)return b.push(this.readSVarint());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readSVarint());return b},readPackedBoolean:function(b){if(this.type!==Ji.Bytes)return b.push(this.readBoolean());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readBoolean());return b},readPackedFloat:function(b){if(this.type!==Ji.Bytes)return b.push(this.readFloat());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readFloat());return b},readPackedDouble:function(b){if(this.type!==Ji.Bytes)return b.push(this.readDouble());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readDouble());return b},readPackedFixed32:function(b){if(this.type!==Ji.Bytes)return b.push(this.readFixed32());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readFixed32());return b},readPackedSFixed32:function(b){if(this.type!==Ji.Bytes)return b.push(this.readSFixed32());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readSFixed32());return b},readPackedFixed64:function(b){if(this.type!==Ji.Bytes)return b.push(this.readFixed64());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readFixed64());return b},readPackedSFixed64:function(b){if(this.type!==Ji.Bytes)return b.push(this.readSFixed64());var d=Jn(this);for(b=b||[];this.pos<d;)b.push(this.readSFixed64());return b},skip:function(b){var d=7&b;if(d===Ji.Varint)for(;this.buf[this.pos++]>127;);else if(d===Ji.Bytes)this.pos=this.readVarint()+this.pos;else if(d===Ji.Fixed32)this.pos+=4;else{if(d!==Ji.Fixed64)throw new Error("Unimplemented type: "+d);this.pos+=8}},writeTag:function(b,d){this.writeVarint(b<<3|d)},realloc:function(b){for(var d=this.length||16;d<this.pos+b;)d*=2;if(d!==this.length){var w=new Uint8Array(d);w.set(this.buf),this.buf=w,this.length=d}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(b){this.realloc(4),Qo(this.buf,b,this.pos),this.pos+=4},writeSFixed32:function(b){this.realloc(4),Qo(this.buf,b,this.pos),this.pos+=4},writeFixed64:function(b){this.realloc(8),Qo(this.buf,-1&b,this.pos),Qo(this.buf,Math.floor(b*Hc),this.pos+4),this.pos+=8},writeSFixed64:function(b){this.realloc(8),Qo(this.buf,-1&b,this.pos),Qo(this.buf,Math.floor(b*Hc),this.pos+4),this.pos+=8},writeVarint:function(b){(b=+b||0)>268435455||b<0?function(d,w){var C,z;if(d>=0?(C=d%4294967296|0,z=d/4294967296|0):(z=~(-d/4294967296),4294967295^(C=~(-d%4294967296))?C=C+1|0:(C=0,z=z+1|0)),d>=18446744073709552e3||d<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");w.realloc(10),function(j,H,ee){ee.buf[ee.pos++]=127&j|128,j>>>=7,ee.buf[ee.pos++]=127&j|128,j>>>=7,ee.buf[ee.pos++]=127&j|128,j>>>=7,ee.buf[ee.pos++]=127&j|128,ee.buf[ee.pos]=127&(j>>>=7)}(C,0,w),function(j,H){var ee=(7&j)<<4;H.buf[H.pos++]|=ee|((j>>>=3)?128:0),j&&(H.buf[H.pos++]=127&j|((j>>>=7)?128:0),j&&(H.buf[H.pos++]=127&j|((j>>>=7)?128:0),j&&(H.buf[H.pos++]=127&j|((j>>>=7)?128:0),j&&(H.buf[H.pos++]=127&j|((j>>>=7)?128:0),j&&(H.buf[H.pos++]=127&j)))))}(z,w)}(b,this):(this.realloc(4),this.buf[this.pos++]=127&b|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=b>>>7&127))))},writeSVarint:function(b){this.writeVarint(b<0?2*-b-1:2*b)},writeBoolean:function(b){this.writeVarint(Boolean(b))},writeString:function(b){b=String(b),this.realloc(4*b.length),this.pos++;var d=this.pos;this.pos=function(C,z,j){for(var H,ee,ae=0;ae<z.length;ae++){if((H=z.charCodeAt(ae))>55295&&H<57344){if(!ee){H>56319||ae+1===z.length?(C[j++]=239,C[j++]=191,C[j++]=189):ee=H;continue}if(H<56320){C[j++]=239,C[j++]=191,C[j++]=189,ee=H;continue}H=ee-55296<<10|H-56320|65536,ee=null}else ee&&(C[j++]=239,C[j++]=191,C[j++]=189,ee=null);H<128?C[j++]=H:(H<2048?C[j++]=H>>6|192:(H<65536?C[j++]=H>>12|224:(C[j++]=H>>18|240,C[j++]=H>>12&63|128),C[j++]=H>>6&63|128),C[j++]=63&H|128)}return j}(this.buf,b,this.pos);var w=this.pos-d;w>=128&&qc(d,w,this),this.pos=d-1,this.writeVarint(w),this.pos+=w},writeFloat:function(b){this.realloc(4),Zc(this.buf,b,this.pos,!0,23,4),this.pos+=4},writeDouble:function(b){this.realloc(8),Zc(this.buf,b,this.pos,!0,52,8),this.pos+=8},writeBytes:function(b){var d=b.length;this.writeVarint(d),this.realloc(d);for(var w=0;w<d;w++)this.buf[this.pos++]=b[w]},writeRawMessage:function(b,d){this.pos++;var w=this.pos;b(d,this);var C=this.pos-w;C>=128&&qc(w,C,this),this.pos=w-1,this.writeVarint(C),this.pos+=C},writeMessage:function(b,d,w){this.writeTag(b,Ji.Bytes),this.writeRawMessage(d,w)},writePackedVarint:function(b,d){d.length&&this.writeMessage(b,xp,d)},writePackedSVarint:function(b,d){d.length&&this.writeMessage(b,bp,d)},writePackedBoolean:function(b,d){d.length&&this.writeMessage(b,Sp,d)},writePackedFloat:function(b,d){d.length&&this.writeMessage(b,wp,d)},writePackedDouble:function(b,d){d.length&&this.writeMessage(b,Ep,d)},writePackedFixed32:function(b,d){d.length&&this.writeMessage(b,Mp,d)},writePackedSFixed32:function(b,d){d.length&&this.writeMessage(b,Tp,d)},writePackedFixed64:function(b,d){d.length&&this.writeMessage(b,Ap,d)},writePackedSFixed64:function(b,d){d.length&&this.writeMessage(b,Cp,d)},writeBytesField:function(b,d){this.writeTag(b,Ji.Bytes),this.writeBytes(d)},writeFixed32Field:function(b,d){this.writeTag(b,Ji.Fixed32),this.writeFixed32(d)},writeSFixed32Field:function(b,d){this.writeTag(b,Ji.Fixed32),this.writeSFixed32(d)},writeFixed64Field:function(b,d){this.writeTag(b,Ji.Fixed64),this.writeFixed64(d)},writeSFixed64Field:function(b,d){this.writeTag(b,Ji.Fixed64),this.writeSFixed64(d)},writeVarintField:function(b,d){this.writeTag(b,Ji.Varint),this.writeVarint(d)},writeSVarintField:function(b,d){this.writeTag(b,Ji.Varint),this.writeSVarint(d)},writeStringField:function(b,d){this.writeTag(b,Ji.Bytes),this.writeString(d)},writeFloatField:function(b,d){this.writeTag(b,Ji.Fixed32),this.writeFloat(d)},writeDoubleField:function(b,d){this.writeTag(b,Ji.Fixed64),this.writeDouble(d)},writeBooleanField:function(b,d){this.writeVarintField(b,Boolean(d))}};class Su{constructor(d,{pixelRatio:w,version:C,stretchX:z,stretchY:j,content:H}){this.paddedRect=d,this.pixelRatio=w,this.stretchX=z,this.stretchY=j,this.content=H,this.version=C}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Yc{constructor(d,w){const C={},z={};this.haveRenderCallbacks=[];const j=[];this.addImages(d,C,j),this.addImages(w,z,j);const{w:H,h:ee}=Eu(j),ae=new on({width:H||1,height:ee||1});for(const he in d){const be=d[he],Te=C[he].paddedRect;on.copy(be.data,ae,{x:0,y:0},{x:Te.x+1,y:Te.y+1},be.data)}for(const he in w){const be=w[he],Te=z[he].paddedRect,Re=Te.x+1,$e=Te.y+1,qe=be.data.width,rt=be.data.height;on.copy(be.data,ae,{x:0,y:0},{x:Re,y:$e},be.data),on.copy(be.data,ae,{x:0,y:rt-1},{x:Re,y:$e-1},{width:qe,height:1}),on.copy(be.data,ae,{x:0,y:0},{x:Re,y:$e+rt},{width:qe,height:1}),on.copy(be.data,ae,{x:qe-1,y:0},{x:Re-1,y:$e},{width:1,height:rt}),on.copy(be.data,ae,{x:0,y:0},{x:Re+qe,y:$e},{width:1,height:rt})}this.image=ae,this.iconPositions=C,this.patternPositions=z}addImages(d,w,C){for(const z in d){const j=d[z],H={x:0,y:0,w:j.data.width+2,h:j.data.height+2};C.push(H),w[z]=new Su(H,j),j.hasRenderCallback&&this.haveRenderCallbacks.push(z)}}patchUpdatedImages(d,w){d.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in d.updatedImages)this.patchUpdatedImage(this.iconPositions[C],d.getImage(C),w),this.patchUpdatedImage(this.patternPositions[C],d.getImage(C),w)}patchUpdatedImage(d,w,C){if(!d||!w||d.version===w.version)return;d.version=w.version;const[z,j]=d.tl;C.update(w.data,void 0,{x:z,y:j})}}wi("ImagePosition",Su),wi("ImageAtlas",Yc);const sn={horizontal:1,vertical:2,horizontalOnly:3};class il{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(d,w){const C=new il;return C.scale=d||1,C.fontStack=w,C}static forImage(d){const w=new il;return w.imageName=d,w}}class es{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(d,w){const C=new es;for(let z=0;z<d.sections.length;z++){const j=d.sections[z];j.image?C.addImageSection(j):C.addTextSection(j,w)}return C}length(){return this.text.length}getSection(d){return this.sections[this.sectionIndex[d]]}getSections(){return this.sections}getSectionIndex(d){return this.sectionIndex[d]}getCharCode(d){return this.text.charCodeAt(d)}verticalizePunctuation(d){this.text=function(w,C){let z="";for(let j=0;j<w.length;j++){const H=w.charCodeAt(j+1)||null,ee=w.charCodeAt(j-1)||null;z+=!C&&(H&&Gs(H)&&!el[w[j+1]]||ee&&Gs(ee)&&!el[w[j-1]])||!el[w[j]]?w[j]:el[w[j]]}return z}(this.text,d)}trim(){let d=0;for(let C=0;C<this.text.length&&xh[this.text.charCodeAt(C)];C++)d++;let w=this.text.length;for(let C=this.text.length-1;C>=0&&C>=d&&xh[this.text.charCodeAt(C)];C--)w--;this.text=this.text.substring(d,w),this.sectionIndex=this.sectionIndex.slice(d,w)}substring(d,w){const C=new es;return C.text=this.text.substring(d,w),C.sectionIndex=this.sectionIndex.slice(d,w),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((d,w)=>Math.max(d,this.sections[w].scale),0)}addTextSection(d,w){this.text+=d.text,this.sections.push(il.forText(d.scale,d.fontStack||w));const C=this.sections.length-1;for(let z=0;z<d.text.length;++z)this.sectionIndex.push(C)}addImageSection(d){const w=d.image?d.image.name:"";if(w.length===0)return void je("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(il.forImage(w)),this.sectionIndex.push(this.sections.length-1)):je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mu(b,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt){const dt=es.fromFeature(b,z);let yt;Te===sn.vertical&&dt.verticalizePunctuation(Re);const{processBidirectionalText:Mt,processStyledBidirectionalText:Pt}=Fe;if(Mt&&dt.sections.length===1){yt=[];const Ft=Mt(dt.toString(),Tu(dt,he,j,d,C,$e,qe));for(const ei of Ft){const Xt=new es;Xt.text=ei,Xt.sections=dt.sections;for(let yi=0;yi<ei.length;yi++)Xt.sectionIndex.push(0);yt.push(Xt)}}else if(Pt){yt=[];const Ft=Pt(dt.text,dt.sectionIndex,Tu(dt,he,j,d,C,$e,qe));for(const ei of Ft){const Xt=new es;Xt.text=ei[0],Xt.sectionIndex=ei[1],Xt.sections=dt.sections,yt.push(Xt)}}else yt=function(Ft,ei){const Xt=[],yi=Ft.text;let oi=0;for(const ti of ei)Xt.push(Ft.substring(oi,ti)),oi=ti;return oi<yi.length&&Xt.push(Ft.substring(oi,yi.length)),Xt}(dt,Tu(dt,he,j,d,C,$e,qe));const Ot=[],Lt={positionedLines:Ot,text:dt.toString(),top:be[1],bottom:be[1],left:be[0],right:be[0],writingMode:Te,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ft,ei,Xt,yi,oi,ti,si,ui,ni,vi,bi,Li){let Qi=0,Ii=0,qi=0;const xi=ui==="right"?1:ui==="left"?0:.5;let er=!1;for(const Ki of oi){const Xi=Ki.getSections();for(const lr of Xi){if(lr.imageName)continue;const Br=ei[lr.fontStack];if(Br&&(er=Br.ascender!==void 0&&Br.descender!==void 0,!er))break}if(!er)break}let Hi=0;for(const Ki of oi){Ki.trim();const Xi=Ki.getMaxScale(),lr=(Xi-1)*Lr,Br={positionedGlyphs:[],lineOffset:0};Ft.positionedLines[Hi]=Br;const xr=Br.positionedGlyphs;let Mr=0;if(!Ki.length()){Ii+=ti,++Hi;continue}let Or=0,hr=0;for(let tr=0;tr<Ki.length();tr++){const br=Ki.getSection(tr),wr=Ki.getSectionIndex(tr),pr=Ki.getCharCode(tr);let cr=br.scale,Sr=null,ir=null,zr=null,xn=Lr,ln=0;const pn=!(ni===sn.horizontal||!bi&&!js(pr)||bi&&(xh[pr]||(yr=pr,Vl(yr)||Zl(yr)||Hl(yr)||kn(yr)||Us(yr))));if(br.imageName){const hn=yi[br.imageName];if(!hn)continue;zr=br.imageName,Ft.iconsInText=Ft.iconsInText||!0,ir=hn.paddedRect;const Nr=hn.displaySize;cr=cr*Lr/Li,Sr={width:Nr[0],height:Nr[1],left:1,top:-3,advance:pn?Nr[1]:Nr[0],localGlyph:!1},ln=er?-Sr.height*cr:Xi*Lr-17-Nr[1]*cr,xn=Sr.advance;const Qn=(pn?Nr[0]:Nr[1])*cr-Lr*Xi;Qn>0&&Qn>Mr&&(Mr=Qn)}else{const hn=Xt[br.fontStack];if(!hn)continue;hn[pr]&&(ir=hn[pr]);const Nr=ei[br.fontStack];if(!Nr)continue;const Qn=Nr.glyphs[pr];if(!Qn)continue;if(Sr=Qn.metrics,xn=pr!==8203?Lr:0,er){const as=Nr.ascender!==void 0?Math.abs(Nr.ascender):0,os=Nr.descender!==void 0?Math.abs(Nr.descender):0,ss=(as+os)*cr;Or<ss&&(Or=ss,hr=(as-os)/2*cr),ln=-as*cr}else ln=(Xi-cr)*Lr-17}pn?(Ft.verticalizable=!0,xr.push({glyph:pr,imageName:zr,x:Qi,y:Ii+ln,vertical:pn,scale:cr,localGlyph:Sr.localGlyph,fontStack:br.fontStack,sectionIndex:wr,metrics:Sr,rect:ir}),Qi+=xn*cr+vi):(xr.push({glyph:pr,imageName:zr,x:Qi,y:Ii+ln,vertical:pn,scale:cr,localGlyph:Sr.localGlyph,fontStack:br.fontStack,sectionIndex:wr,metrics:Sr,rect:ir}),Qi+=Sr.advance*cr+vi)}xr.length!==0&&(qi=Math.max(Qi-vi,qi),er?tf(xr,xi,Mr,hr,ti*Xi/2):tf(xr,xi,Mr,0,ti/2)),Qi=0;const qr=ti*Xi+Mr;Br.lineOffset=Math.max(Mr,lr),Ii+=qr,++Hi}var yr;const vr=Ii,{horizontalAlign:Er,verticalAlign:Ir}=Au(si);(function(Ki,Xi,lr,Br,xr,Mr){const Or=(Xi-lr)*xr,hr=-Mr*Br;for(const qr of Ki)for(const tr of qr.positionedGlyphs)tr.x+=Or,tr.y+=hr})(Ft.positionedLines,xi,Er,Ir,qi,vr),Ft.top+=-Ir*vr,Ft.bottom=Ft.top+vr,Ft.left+=-Er*qi,Ft.right=Ft.left+qi,Ft.hasBaseline=er}(Lt,d,w,C,yt,H,ee,ae,Te,he,Re,rt),!function(Ft){for(const ei of Ft)if(ei.positionedGlyphs.length!==0)return!1;return!0}(Ot)&&Lt}const xh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kc(b,d,w,C,z,j){if(d.imageName){const H=C[d.imageName];return H?H.displaySize[0]*d.scale*Lr/j+z:0}{const H=w[d.fontStack],ee=H&&H.glyphs[b];return ee?ee.metrics.advance*d.scale+z:0}}function Jc(b,d,w,C){const z=Math.pow(b-d,2);return C?b<d?z/2:2*z:z+Math.abs(w)*w}function Pp(b,d,w){let C=0;return b===10&&(C-=1e4),w&&(C+=150),b!==40&&b!==65288||(C+=50),d!==41&&d!==65289||(C+=50),C}function Qc(b,d,w,C,z,j){let H=null,ee=Jc(d,w,z,j);for(const ae of C){const he=Jc(d-ae.x,w,z,j)+ae.badness;he<=ee&&(H=ae,ee=he)}return{index:b,x:d,priorBreak:H,badness:ee}}function ef(b){return b?ef(b.priorBreak).concat(b.index):[]}function Tu(b,d,w,C,z,j,H){if(j!=="point")return[];if(!b)return[];const ee=[],ae=function(Re,$e,qe,rt,dt,yt){let Mt=0;for(let Pt=0;Pt<Re.length();Pt++){const Ot=Re.getSection(Pt);Mt+=Kc(Re.getCharCode(Pt),Ot,rt,dt,$e,yt)}return Mt/Math.max(1,Math.ceil(Mt/qe))}(b,d,w,C,z,H),he=b.text.indexOf("\u200B")>=0;let be=0;for(let Re=0;Re<b.length();Re++){const $e=b.getSection(Re),qe=b.getCharCode(Re);if(xh[qe]||(be+=Kc(qe,$e,C,z,d,H)),Re<b.length()-1){const rt=!((Te=qe)<11904||!(Xl(Te)||Bs(Te)||Wa(Te)||Jl(Te)||Ns(Te)||Wl(Te)||Os(Te)||No(Te)||$o(Te)||Za(Te)||zs(Te)||$s(Te)||pa(Te)||ql(Te)||Va(Te)||Fs(Te)||Uo(Te)||Ql(Te)||Kl(Te)||Yl(Te)));(Rp[qe]||rt||$e.imageName)&&ee.push(Qc(Re+1,be,ae,ee,Pp(qe,b.getCharCode(Re+1),rt&&he),!1))}}var Te;return ef(Qc(b.length(),be,ae,ee,0,!0))}function Au(b){let d=.5,w=.5;switch(b){case"right":case"top-right":case"bottom-right":d=1;break;case"left":case"top-left":case"bottom-left":d=0}switch(b){case"bottom":case"bottom-right":case"bottom-left":w=1;break;case"top":case"top-right":case"top-left":w=0}return{horizontalAlign:d,verticalAlign:w}}function tf(b,d,w,C,z){if(!(d||w||C||z))return;const j=b.length-1,H=b[j],ee=(H.x+H.metrics.advance*H.scale)*d;for(let ae=0;ae<=j;ae++)b[ae].x-=ee,b[ae].y+=w+C+z}function Lp(b,d,w){const{horizontalAlign:C,verticalAlign:z}=Au(w),j=d[0]-b.displaySize[0]*C,H=d[1]-b.displaySize[1]*z;return{image:b,top:H,bottom:H+b.displaySize[1],left:j,right:j+b.displaySize[0]}}function rf(b,d,w,C,z,j){const H=b.image;let ee;if(H.content){const dt=H.content,yt=H.pixelRatio||1;ee=[dt[0]/yt,dt[1]/yt,H.displaySize[0]-dt[2]/yt,H.displaySize[1]-dt[3]/yt]}const ae=d.left*j,he=d.right*j;let be,Te,Re,$e;w==="width"||w==="both"?($e=z[0]+ae-C[3],Te=z[0]+he+C[1]):($e=z[0]+(ae+he-H.displaySize[0])/2,Te=$e+H.displaySize[0]);const qe=d.top*j,rt=d.bottom*j;return w==="height"||w==="both"?(be=z[1]+qe-C[0],Re=z[1]+rt+C[2]):(be=z[1]+(qe+rt-H.displaySize[1])/2,Re=be+H.displaySize[1]),{image:H,top:be,right:Te,bottom:Re,left:$e,collisionPadding:ee}}class wa extends k{constructor(d,w,C,z,j){super(d,w),this.angle=z,this.z=C,j!==void 0&&(this.segment=j)}clone(){return new wa(this.x,this.y,this.z,this.angle,this.segment)}}function nf(b,d,w,C,z){if(d.segment===void 0)return!0;let j=d,H=d.segment+1,ee=0;for(;ee>-w/2;){if(H--,H<0)return!1;ee-=b[H].dist(j),j=b[H]}ee+=b[H].dist(b[H+1]),H++;const ae=[];let he=0;for(;ee<w/2;){const be=b[H],Te=b[H+1];if(!Te)return!1;let Re=b[H-1].angleTo(be)-be.angleTo(Te);for(Re=Math.abs((Re+3*Math.PI)%(2*Math.PI)-Math.PI),ae.push({distance:ee,angleDelta:Re}),he+=Re;ee-ae[0].distance>C;)he-=ae.shift().angleDelta;if(he>z)return!1;H++,ee+=be.dist(Te)}return!0}function af(b){let d=0;for(let w=0;w<b.length-1;w++)d+=b[w].dist(b[w+1]);return d}function of(b,d,w){return b?.6*d*w:0}function sf(b,d){return Math.max(b?b.right-b.left:0,d?d.right-d.left:0)}function Bp(b,d,w,C,z,j){const H=of(w,z,j),ee=sf(w,C)*j;let ae=0;const he=af(b)/2;for(let be=0;be<b.length-1;be++){const Te=b[be],Re=b[be+1],$e=Te.dist(Re);if(ae+$e>he){const qe=(he-ae)/$e,rt=Vi(Te.x,Re.x,qe),dt=Vi(Te.y,Re.y,qe),yt=new wa(rt,dt,0,Re.angleTo(Te),be);return!H||nf(b,yt,ee,H,d)?yt:void 0}ae+=$e}}function Op(b,d,w,C,z,j,H,ee,ae){const he=of(C,j,H),be=sf(C,z),Te=be*H,Re=b[0].x===0||b[0].x===ae||b[0].y===0||b[0].y===ae;return d-Te<d/4&&(d=Te+d/4),lf(b,Re?d/2*ee%d:(be/2+2*j)*H*ee%d,d,he,w,Te,Re,!1,ae)}function lf(b,d,w,C,z,j,H,ee,ae){const he=j/2,be=af(b);let Te=0,Re=d-w,$e=[];for(let qe=0;qe<b.length-1;qe++){const rt=b[qe],dt=b[qe+1],yt=rt.dist(dt),Mt=dt.angleTo(rt);for(;Re+w<Te+yt;){Re+=w;const Pt=(Re-Te)/yt,Ot=Vi(rt.x,dt.x,Pt),Lt=Vi(rt.y,dt.y,Pt);if(Ot>=0&&Ot<ae&&Lt>=0&&Lt<ae&&Re-he>=0&&Re+he<=be){const Ft=new wa(Ot,Lt,0,Mt,qe);Ft._round(),C&&!nf(b,Ft,j,C,z)||$e.push(Ft)}}Te+=yt}return ee||$e.length||H||($e=lf(b,Te/2,w,C,z,j,H,!0,ae)),$e}function hf(b,d,w,C,z){const j=[];for(let H=0;H<b.length;H++){const ee=b[H];let ae;for(let he=0;he<ee.length-1;he++){let be=ee[he],Te=ee[he+1];be.x<d&&Te.x<d||(be.x<d?be=new k(d,be.y+(d-be.x)/(Te.x-be.x)*(Te.y-be.y))._round():Te.x<d&&(Te=new k(d,be.y+(d-be.x)/(Te.x-be.x)*(Te.y-be.y))._round()),be.y<w&&Te.y<w||(be.y<w?be=new k(be.x+(w-be.y)/(Te.y-be.y)*(Te.x-be.x),w)._round():Te.y<w&&(Te=new k(be.x+(w-be.y)/(Te.y-be.y)*(Te.x-be.x),w)._round()),be.x>=C&&Te.x>=C||(be.x>=C?be=new k(C,be.y+(C-be.x)/(Te.x-be.x)*(Te.y-be.y))._round():Te.x>=C&&(Te=new k(C,be.y+(C-be.x)/(Te.x-be.x)*(Te.y-be.y))._round()),be.y>=z&&Te.y>=z||(be.y>=z?be=new k(be.x+(z-be.y)/(Te.y-be.y)*(Te.x-be.x),z)._round():Te.y>=z&&(Te=new k(be.x+(z-be.y)/(Te.y-be.y)*(Te.x-be.x),z)._round()),ae&&be.equals(ae[ae.length-1])||(ae=[be],j.push(ae)),ae.push(Te)))))}}return j}wi("Anchor",wa);const rl=1e20;function uf(b,d,w,C,z,j,H,ee,ae){for(let he=d;he<d+C;he++)cf(b,w*j+he,j,z,H,ee,ae);for(let he=w;he<w+z;he++)cf(b,he*j+d,1,C,H,ee,ae)}function cf(b,d,w,C,z,j,H){j[0]=0,H[0]=-rl,H[1]=rl,z[0]=b[d];for(let ee=1,ae=0,he=0;ee<C;ee++){z[ee]=b[d+ee*w];const be=ee*ee;do{const Te=j[ae];he=(z[ee]-z[Te]+be-Te*Te)/(ee-Te)/2}while(he<=H[ae]&&--ae>-1);ae++,j[ae]=ee,H[ae]=he,H[ae+1]=rl}for(let ee=0,ae=0;ee<C;ee++){for(;H[ae+1]<ee;)ae++;const he=j[ae],be=ee-he;b[d+ee*w]=z[he]+be*be}}const Cu={none:0,ideographs:1,all:2};class ts{constructor(d,w,C){this.requestManager=d,this.localGlyphMode=w,this.localFontFamily=C,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(d){this.url=d}getGlyphs(d,w){const C=[];for(const z in d)for(const j of d[z])C.push({stack:z,id:j});J(C,({stack:z,id:j},H)=>{let ee=this.entries[z];ee||(ee=this.entries[z]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let ae=ee.glyphs[j];if(ae!==void 0)return void H(null,{stack:z,id:j,glyph:ae});if(ae=this._tinySDF(ee,z,j),ae)return ee.glyphs[j]=ae,void H(null,{stack:z,id:j,glyph:ae});const he=Math.floor(j/256);if(256*he>65535)return void H(new Error("glyphs > 65535 not supported"));if(ee.ranges[he])return void H(null,{stack:z,id:j,glyph:ae});let be=ee.requests[he];be||(be=ee.requests[he]=[],ts.loadGlyphRange(z,he,this.url,this.requestManager,(Te,Re)=>{if(Re){ee.ascender=Re.ascender,ee.descender=Re.descender;for(const $e in Re.glyphs)this._doesCharSupportLocalGlyph(+$e)||(ee.glyphs[+$e]=Re.glyphs[+$e]);ee.ranges[he]=!0}for(const $e of be)$e(Te,Re);delete ee.requests[he]})),be.push((Te,Re)=>{Te?H(Te):Re&&H(null,{stack:z,id:j,glyph:Re.glyphs[j]||null})})},(z,j)=>{if(z)w(z);else if(j){const H={};for(const{stack:ee,id:ae,glyph:he}of j)H[ee]===void 0&&(H[ee]={}),H[ee].glyphs===void 0&&(H[ee].glyphs={}),H[ee].glyphs[ae]=he&&{id:he.id,bitmap:he.bitmap.clone(),metrics:he.metrics},H[ee].ascender=this.entries[ee].ascender,H[ee].descender=this.entries[ee].descender;w(null,H)}})}_doesCharSupportLocalGlyph(d){return this.localGlyphMode!==Cu.none&&(this.localGlyphMode===Cu.all?!!this.localFontFamily:!!this.localFontFamily&&(Za(d)||Ha(d)||pa(d)||Uo(d))||No(d))}_tinySDF(d,w,C){const z=this.localFontFamily;if(!z||!this._doesCharSupportLocalGlyph(C))return;let j=d.tinySDF;if(!j){let rt="400";/bold/i.test(w)?rt="900":/medium/i.test(w)?rt="500":/light/i.test(w)&&(rt="200"),j=d.tinySDF=new ts.TinySDF({fontFamily:z,fontWeight:rt,fontSize:48,buffer:6,radius:16}),j.fontWeight=rt}if(this.localGlyphs[j.fontWeight][C])return this.localGlyphs[j.fontWeight][C];const H=String.fromCharCode(C),{data:ee,width:ae,height:he,glyphWidth:be,glyphHeight:Te,glyphLeft:Re,glyphTop:$e,glyphAdvance:qe}=j.draw(H);return this.localGlyphs[j.fontWeight][C]={id:C,bitmap:new xa({width:ae,height:he},ee),metrics:{width:be/2,height:Te/2,left:Re/2,top:$e/2-27,advance:qe/2,localGlyph:!0}}}}function ff(b,d,w,C){const z=[],j=b.image,H=j.pixelRatio,ee=j.paddedRect.w-2,ae=j.paddedRect.h-2,he=b.right-b.left,be=b.bottom-b.top,Te=j.stretchX||[[0,ee]],Re=j.stretchY||[[0,ae]],$e=(ti,si)=>ti+si[1]-si[0],qe=Te.reduce($e,0),rt=Re.reduce($e,0),dt=ee-qe,yt=ae-rt;let Mt=0,Pt=qe,Ot=0,Lt=rt,Ft=0,ei=dt,Xt=0,yi=yt;if(j.content&&C){const ti=j.content;Mt=bh(Te,0,ti[0]),Ot=bh(Re,0,ti[1]),Pt=bh(Te,ti[0],ti[2]),Lt=bh(Re,ti[1],ti[3]),Ft=ti[0]-Mt,Xt=ti[1]-Ot,ei=ti[2]-ti[0]-Pt,yi=ti[3]-ti[1]-Lt}const oi=(ti,si,ui,ni)=>{const vi=wh(ti.stretch-Mt,Pt,he,b.left),bi=Eh(ti.fixed-Ft,ei,ti.stretch,qe),Li=wh(si.stretch-Ot,Lt,be,b.top),Qi=Eh(si.fixed-Xt,yi,si.stretch,rt),Ii=wh(ui.stretch-Mt,Pt,he,b.left),qi=Eh(ui.fixed-Ft,ei,ui.stretch,qe),xi=wh(ni.stretch-Ot,Lt,be,b.top),er=Eh(ni.fixed-Xt,yi,ni.stretch,rt),Hi=new k(vi,Li),yr=new k(Ii,Li),vr=new k(Ii,xi),Er=new k(vi,xi),Ir=new k(bi/H,Qi/H),Ki=new k(qi/H,er/H),Xi=d*Math.PI/180;if(Xi){const xr=Math.sin(Xi),Mr=Math.cos(Xi),Or=[Mr,-xr,xr,Mr];Hi._matMult(Or),yr._matMult(Or),Er._matMult(Or),vr._matMult(Or)}const lr=ti.stretch+ti.fixed,Br=si.stretch+si.fixed;return{tl:Hi,tr:yr,bl:Er,br:vr,tex:{x:j.paddedRect.x+1+lr,y:j.paddedRect.y+1+Br,w:ui.stretch+ui.fixed-lr,h:ni.stretch+ni.fixed-Br},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ir,pixelOffsetBR:Ki,minFontScaleX:ei/H/he,minFontScaleY:yi/H/be,isSDF:w}};if(C&&(j.stretchX||j.stretchY)){const ti=df(Te,dt,qe),si=df(Re,yt,rt);for(let ui=0;ui<ti.length-1;ui++){const ni=ti[ui],vi=ti[ui+1];for(let bi=0;bi<si.length-1;bi++)z.push(oi(ni,si[bi],vi,si[bi+1]))}}else z.push(oi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ee+1},{fixed:0,stretch:ae+1}));return z}function bh(b,d,w){let C=0;for(const z of b)C+=Math.max(d,Math.min(w,z[1]))-Math.max(d,Math.min(w,z[0]));return C}function df(b,d,w){const C=[{fixed:-1,stretch:0}];for(const[z,j]of b){const H=C[C.length-1];C.push({fixed:z-H.stretch,stretch:H.stretch}),C.push({fixed:z-H.stretch,stretch:H.stretch+(j-z)})}return C.push({fixed:d+1,stretch:w}),C}function wh(b,d,w,C){return b/d*w+C}function Eh(b,d,w,C){return b-d*w/C}function Fp(b,d,w,C){const z=d+b.positionedLines[C].lineOffset;return C===0?w+z/2:w+(z+(d+b.positionedLines[C-1].lineOffset))/2}ts.loadGlyphRange=function(b,d,w,C,z){const j=256*d,H=j+255,ee=C.transformRequest(C.normalizeGlyphsURL(w).replace("{fontstack}",b).replace("{range}",`${j}-${H}`),ke.Glyphs);Se(ee,(ae,he)=>{if(ae)z(ae);else if(he){const be={},Te=function(Re){return new tl(Re).readFields(Ip,{})}(he);for(const Re of Te.glyphs)be[Re.id]=Re;z(null,{glyphs:be,ascender:Te.ascender,descender:Te.descender})}})},ts.TinySDF=class{constructor({fontSize:b=24,buffer:d=3,radius:w=8,cutoff:C=.25,fontFamily:z="sans-serif",fontWeight:j="normal",fontStyle:H="normal"}){this.buffer=d,this.cutoff=C,this.radius=w;const ee=this.size=b+4*d,ae=this._createCanvas(ee),he=this.ctx=ae.getContext("2d",{willReadFrequently:!0});he.font=`${H} ${j} ${b}px ${z}`,he.textBaseline="alphabetic",he.textAlign="left",he.fillStyle="black",this.gridOuter=new Float64Array(ee*ee),this.gridInner=new Float64Array(ee*ee),this.f=new Float64Array(ee),this.z=new Float64Array(ee+1),this.v=new Uint16Array(ee)}_createCanvas(b){const d=document.createElement("canvas");return d.width=d.height=b,d}draw(b){const{width:d,actualBoundingBoxAscent:w,actualBoundingBoxDescent:C,actualBoundingBoxLeft:z,actualBoundingBoxRight:j}=this.ctx.measureText(b),H=Math.floor(w),ee=Math.min(this.size-this.buffer,Math.ceil(j-z)),ae=Math.min(this.size-this.buffer,Math.ceil(w)+Math.ceil(C)),he=ee+2*this.buffer,be=ae+2*this.buffer,Te=he*be,Re=new Uint8ClampedArray(Te),$e={data:Re,width:he,height:be,glyphWidth:ee,glyphHeight:ae,glyphTop:H,glyphLeft:0,glyphAdvance:d};if(ee===0||ae===0)return $e;const{ctx:qe,buffer:rt,gridInner:dt,gridOuter:yt}=this;qe.clearRect(rt,rt,ee,ae),qe.fillText(b,rt,rt+H+1);const Mt=qe.getImageData(rt,rt,ee,ae);yt.fill(rl,0,Te),dt.fill(0,0,Te);for(let Pt=0;Pt<ae;Pt++)for(let Ot=0;Ot<ee;Ot++){const Lt=Mt.data[4*(Pt*ee+Ot)+3]/255;if(Lt===0)continue;const Ft=(Pt+rt)*he+Ot+rt;if(Lt===1)yt[Ft]=0,dt[Ft]=rl;else{const ei=.5-Lt;yt[Ft]=ei>0?ei*ei:0,dt[Ft]=ei<0?ei*ei:0}}uf(yt,0,0,he,be,he,this.f,this.v,this.z),uf(dt,rt,rt,ee,ae,he,this.f,this.v,this.z);for(let Pt=0;Pt<Te;Pt++){const Ot=Math.sqrt(yt[Pt])-Math.sqrt(dt[Pt]);Re[Pt]=Math.round(255-255*(Ot/this.radius+this.cutoff))}return $e}};class zp{constructor(d=[],w=Np){if(this.data=d,this.length=this.data.length,this.compare=w,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(d){this.data.push(d),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const d=this.data[0],w=this.data.pop();return this.length--,this.length>0&&(this.data[0]=w,this._down(0)),d}peek(){return this.data[0]}_up(d){const{data:w,compare:C}=this,z=w[d];for(;d>0;){const j=d-1>>1,H=w[j];if(C(z,H)>=0)break;w[d]=H,d=j}w[d]=z}_down(d){const{data:w,compare:C}=this,z=this.length>>1,j=w[d];for(;d<z;){let H=1+(d<<1),ee=w[H];const ae=H+1;if(ae<this.length&&C(w[ae],ee)<0&&(H=ae,ee=w[ae]),C(ee,j)>=0)break;w[d]=ee,d=H}w[d]=j}}function Np(b,d){return b<d?-1:b>d?1:0}function Up(b,d=1,w=!1){let C=1/0,z=1/0,j=-1/0,H=-1/0;const ee=b[0];for(let $e=0;$e<ee.length;$e++){const qe=ee[$e];(!$e||qe.x<C)&&(C=qe.x),(!$e||qe.y<z)&&(z=qe.y),(!$e||qe.x>j)&&(j=qe.x),(!$e||qe.y>H)&&(H=qe.y)}const ae=Math.min(j-C,H-z);let he=ae/2;const be=new zp([],$p);if(ae===0)return new k(C,z);for(let $e=C;$e<j;$e+=ae)for(let qe=z;qe<H;qe+=ae)be.push(new is($e+he,qe+he,he,b));let Te=function($e){let qe=0,rt=0,dt=0;const yt=$e[0];for(let Mt=0,Pt=yt.length,Ot=Pt-1;Mt<Pt;Ot=Mt++){const Lt=yt[Mt],Ft=yt[Ot],ei=Lt.x*Ft.y-Ft.x*Lt.y;rt+=(Lt.x+Ft.x)*ei,dt+=(Lt.y+Ft.y)*ei,qe+=3*ei}return new is(rt/qe,dt/qe,0,$e)}(b),Re=be.length;for(;be.length;){const $e=be.pop();($e.d>Te.d||!Te.d)&&(Te=$e,w&&console.log("found best %d after %d probes",Math.round(1e4*$e.d)/1e4,Re)),$e.max-Te.d<=d||(he=$e.h/2,be.push(new is($e.p.x-he,$e.p.y-he,he,b)),be.push(new is($e.p.x+he,$e.p.y-he,he,b)),be.push(new is($e.p.x-he,$e.p.y+he,he,b)),be.push(new is($e.p.x+he,$e.p.y+he,he,b)),Re+=4)}return w&&(console.log(`num probes: ${Re}`),console.log(`best distance: ${Te.d}`)),Te.p}function $p(b,d){return d.max-b.max}function is(b,d,w,C){this.p=new k(b,d),this.h=w,this.d=function(z,j){let H=!1,ee=1/0;for(let ae=0;ae<j.length;ae++){const he=j[ae];for(let be=0,Te=he.length,Re=Te-1;be<Te;Re=be++){const $e=he[be],qe=he[Re];$e.y>z.y!=qe.y>z.y&&z.x<(qe.x-$e.x)*(z.y-$e.y)/(qe.y-$e.y)+$e.x&&(H=!H),ee=Math.min(ee,hc(z,$e,qe))}}return(H?1:-1)*Math.sqrt(ee)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}const Iu=Number.POSITIVE_INFINITY,jp=Math.sqrt(2);function pf(b,d){return d[1]!==Iu?function(w,C,z){let j=0,H=0;switch(C=Math.abs(C),z=Math.abs(z),w){case"top-right":case"top-left":case"top":H=z-7;break;case"bottom-right":case"bottom-left":case"bottom":H=7-z}switch(w){case"top-right":case"bottom-right":case"right":j=-C;break;case"top-left":case"bottom-left":case"left":j=C}return[j,H]}(b,d[0],d[1]):function(w,C){let z=0,j=0;C<0&&(C=0);const H=C/jp;switch(w){case"top-right":case"top-left":j=H-7;break;case"bottom-right":case"bottom-left":j=7-H;break;case"bottom":j=7-C;break;case"top":j=C-7}switch(w){case"top-right":case"bottom-right":z=-H;break;case"top-left":case"bottom-left":z=H;break;case"left":z=C;break;case"right":z=-C}return[z,j]}(b,d[0])}function Gp(b,d,w,C,z,j,H,ee,ae){b.createArrays(),b.tilePixelRatio=ji/(512*b.overscaling),b.compareText={},b.iconsNeedLinear=!1;const he=b.layers[0].layout,be=b.layers[0]._unevaluatedLayout._values,Te={};if(b.textSizeData.kind==="composite"){const{minZoom:qe,maxZoom:rt}=b.textSizeData;Te.compositeTextSizes=[be["text-size"].possiblyEvaluate(new Ue(qe),ee),be["text-size"].possiblyEvaluate(new Ue(rt),ee)]}if(b.iconSizeData.kind==="composite"){const{minZoom:qe,maxZoom:rt}=b.iconSizeData;Te.compositeIconSizes=[be["icon-size"].possiblyEvaluate(new Ue(qe),ee),be["icon-size"].possiblyEvaluate(new Ue(rt),ee)]}Te.layoutTextSize=be["text-size"].possiblyEvaluate(new Ue(ae+1),ee),Te.layoutIconSize=be["icon-size"].possiblyEvaluate(new Ue(ae+1),ee),Te.textMaxSize=be["text-size"].possiblyEvaluate(new Ue(18),ee);const Re=he.get("text-rotation-alignment")==="map"&&he.get("symbol-placement")!=="point",$e=he.get("text-size");for(const qe of b.features){const rt=he.get("text-font").evaluate(qe,{},ee).join(","),dt=$e.evaluate(qe,{},ee),yt=Te.layoutTextSize.evaluate(qe,{},ee),Mt=(Te.layoutIconSize.evaluate(qe,{},ee),{horizontal:{},vertical:void 0}),Pt=qe.text;let Ot,Lt=[0,0];if(Pt){const Xt=Pt.toString(),yi=he.get("text-letter-spacing").evaluate(qe,{},ee)*Lr,oi=he.get("text-line-height").evaluate(qe,{},ee)*Lr,ti=jo(Xt)?yi:0,si=he.get("text-anchor").evaluate(qe,{},ee),ui=he.get("text-variable-anchor");if(!ui){const Ii=he.get("text-radial-offset").evaluate(qe,{},ee);Lt=Ii?pf(si,[Ii*Lr,Iu]):he.get("text-offset").evaluate(qe,{},ee).map(qi=>qi*Lr)}let ni=Re?"center":he.get("text-justify").evaluate(qe,{},ee);const vi=he.get("symbol-placement"),bi=vi==="point",Li=vi==="point"?he.get("text-max-width").evaluate(qe,{},ee)*Lr:0,Qi=Ii=>{b.allowVerticalPlacement&&Dn(Xt)&&(Mt.vertical=Mu(Pt,d,w,z,rt,Li,oi,si,Ii,ti,Lt,sn.vertical,!0,vi,yt,dt))};if(!Re&&ui){const Ii=ni==="auto"?ui.map(xi=>ku(xi)):[ni];let qi=!1;for(let xi=0;xi<Ii.length;xi++){const er=Ii[xi];if(!Mt.horizontal[er])if(qi)Mt.horizontal[er]=Mt.horizontal[0];else{const Hi=Mu(Pt,d,w,z,rt,Li,oi,"center",er,ti,Lt,sn.horizontal,!1,vi,yt,dt);Hi&&(Mt.horizontal[er]=Hi,qi=Hi.positionedLines.length===1)}}Qi("left")}else{if(ni==="auto"&&(ni=ku(si)),bi||he.get("text-writing-mode").indexOf("horizontal")>=0||!Dn(Xt)){const Ii=Mu(Pt,d,w,z,rt,Li,oi,si,ni,ti,Lt,sn.horizontal,!1,vi,yt,dt);Ii&&(Mt.horizontal[ni]=Ii)}Qi(vi==="point"?"left":ni)}}let Ft=!1;if(qe.icon&&qe.icon.name){const Xt=C[qe.icon.name];Xt&&(Ot=Lp(z[qe.icon.name],he.get("icon-offset").evaluate(qe,{},ee),he.get("icon-anchor").evaluate(qe,{},ee)),Ft=Xt.sdf,b.sdfIcons===void 0?b.sdfIcons=Xt.sdf:b.sdfIcons!==Xt.sdf&&je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xt.pixelRatio!==b.pixelRatio||he.get("icon-rotate").constantOr(1)!==0)&&(b.iconsNeedLinear=!0))}const ei=gf(Mt.horizontal)||Mt.vertical;b.iconsInText||(b.iconsInText=!!ei&&ei.iconsInText),(ei||Ot)&&Vp(b,qe,Mt,Ot,C,Te,yt,0,Lt,Ft,H,ee)}j&&b.generateCollisionDebugBuffers(ae,b.collisionBoxArray)}function ku(b){switch(b){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vp(b,d,w,C,z,j,H,ee,ae,he,be,Te){let Re=j.textMaxSize.evaluate(d,{},Te);Re===void 0&&(Re=H);const $e=b.layers[0].layout,qe=$e.get("icon-offset").evaluate(d,{},Te),rt=gf(w.horizontal)||w.vertical,dt=H/24,yt=b.tilePixelRatio*Re/24,Mt=b.tilePixelRatio*$e.get("symbol-spacing"),Pt=$e.get("text-padding")*b.tilePixelRatio,Ot=$e.get("icon-padding")*b.tilePixelRatio,Lt=B($e.get("text-max-angle")),Ft=$e.get("text-rotation-alignment")==="map"&&$e.get("symbol-placement")!=="point",ei=$e.get("icon-rotation-alignment")==="map"&&$e.get("symbol-placement")!=="point",Xt=$e.get("symbol-placement"),yi=Mt/2,oi=$e.get("icon-text-fit");let ti;C&&oi!=="none"&&(b.allowVerticalPlacement&&w.vertical&&(ti=rf(C,w.vertical,oi,$e.get("icon-text-fit-padding"),qe,dt)),rt&&(C=rf(C,rt,oi,$e.get("icon-text-fit-padding"),qe,dt)));const si=(ui,ni)=>{ni.x<0||ni.x>=ji||ni.y<0||ni.y>=ji||function(vi,bi,Li,Qi,Ii,qi,xi,er,Hi,yr,vr,Er,Ir,Ki,Xi,lr,Br,xr,Mr,Or,hr,qr,tr,br,wr){const pr=vi.addToLineVertexArray(bi,Qi);let cr,Sr,ir,zr,xn,ln,pn,hn=0,Nr=0,Qn=0,as=0,os=-1,ss=-1;const zn={};let qf=Vs(""),Zu=0,Hu=0;if(Hi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Zu,Hu]=Hi.layout.get("text-offset").evaluate(hr,{},wr).map(Jr=>Jr*Lr):(Zu=Hi.layout.get("text-radial-offset").evaluate(hr,{},wr)*Lr,Hu=Iu),vi.allowVerticalPlacement&&Ii.vertical){const Jr=Ii.vertical;if(Xi)ln=Du(Jr),er&&(pn=Du(er));else{const Qr=Hi.layout.get("text-rotate").evaluate(hr,{},wr)+90;ir=Sh(yr,Li,bi,vr,Er,Ir,Jr,Ki,Qr,lr),er&&(zr=Sh(yr,Li,bi,vr,Er,Ir,er,xr,Qr))}}if(qi){const Jr=Hi.layout.get("icon-rotate").evaluate(hr,{},wr),Qr=Hi.layout.get("icon-text-fit")!=="none",hl=ff(qi,Jr,tr,Qr),qu=er?ff(er,Jr,tr,Qr):void 0;Sr=Sh(yr,Li,bi,vr,Er,Ir,qi,xr,Jr),hn=4*hl.length;const Xf=vi.iconSizeData;let ro=null;Xf.kind==="source"?(ro=[Ln*Hi.layout.get("icon-size").evaluate(hr,{},wr)],ro[0]>Ea&&je(`${vi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Xf.kind==="composite"&&(ro=[Ln*qr.compositeIconSizes[0].evaluate(hr,{},wr),Ln*qr.compositeIconSizes[1].evaluate(hr,{},wr)],(ro[0]>Ea||ro[1]>Ea)&&je(`${vi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vi.addSymbols(vi.icon,hl,ro,Or,Mr,hr,!1,Li,bi,pr.lineStartIndex,pr.lineLength,-1,br,wr),os=vi.icon.placedSymbolArray.length-1,qu&&(Nr=4*qu.length,vi.addSymbols(vi.icon,qu,ro,Or,Mr,hr,sn.vertical,Li,bi,pr.lineStartIndex,pr.lineLength,-1,br,wr),ss=vi.icon.placedSymbolArray.length-1)}for(const Jr in Ii.horizontal){const Qr=Ii.horizontal[Jr];cr||(qf=Vs(Qr.text),Xi?xn=Du(Qr):cr=Sh(yr,Li,bi,vr,Er,Ir,Qr,Ki,Hi.layout.get("text-rotate").evaluate(hr,{},wr),lr));const hl=Qr.positionedLines.length===1;if(Qn+=mf(vi,Li,bi,Qr,xi,Hi,Xi,hr,lr,pr,Ii.vertical?sn.horizontal:sn.horizontalOnly,hl?Object.keys(Ii.horizontal):[Jr],zn,os,qr,br,wr),hl)break}Ii.vertical&&(as+=mf(vi,Li,bi,Ii.vertical,xi,Hi,Xi,hr,lr,pr,sn.vertical,["vertical"],zn,ss,qr,br,wr));let Ca=-1;const Wu=(Jr,Qr)=>Jr?Math.max(Jr,Qr):Qr;Ca=Wu(xn,Ca),Ca=Wu(ln,Ca),Ca=Wu(pn,Ca);const m0=Ca>-1?1:0;vi.glyphOffsetArray.length>=Sa.MAX_GLYPHS&&je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&vi.addToSortKeyRanges(vi.symbolInstances.length,hr.sortKey),vi.symbolInstances.emplaceBack(Li.x,Li.y,Li.z,bi.x,bi.y,zn.right>=0?zn.right:-1,zn.center>=0?zn.center:-1,zn.left>=0?zn.left:-1,zn.vertical>=0?zn.vertical:-1,os,ss,qf,cr!==void 0?cr:vi.collisionBoxArray.length,cr!==void 0?cr+1:vi.collisionBoxArray.length,ir!==void 0?ir:vi.collisionBoxArray.length,ir!==void 0?ir+1:vi.collisionBoxArray.length,Sr!==void 0?Sr:vi.collisionBoxArray.length,Sr!==void 0?Sr+1:vi.collisionBoxArray.length,zr||vi.collisionBoxArray.length,zr?zr+1:vi.collisionBoxArray.length,vr,Qn,as,hn,Nr,m0,0,Zu,Hu,Ca)}(b,ni,ni,ui,w,C,z,ti,b.layers[0],b.collisionBoxArray,d.index,d.sourceLayerIndex,b.index,Pt,Ft,ae,0,Ot,ei,qe,d,j,he,be,Te)};if(Xt==="line")for(const ui of hf(d.geometry,0,0,ji,ji)){const ni=Op(ui,Mt,Lt,w.vertical||rt,C,24,yt,b.overscaling,ji);for(const vi of ni){const bi=rt;bi&&Zp(b,bi.text,yi,vi)||si(ui,vi)}}else if(Xt==="line-center"){for(const ui of d.geometry)if(ui.length>1){const ni=Bp(ui,Lt,w.vertical||rt,C,24,yt);ni&&si(ui,ni)}}else if(d.type==="Polygon")for(const ui of _u(d.geometry,0)){const ni=Up(ui,16);si(ui[0],new wa(ni.x,ni.y,0,0,void 0))}else if(d.type==="LineString")for(const ui of d.geometry)si(ui,new wa(ui[0].x,ui[0].y,0,0,void 0));else if(d.type==="Point")for(const ui of d.geometry)for(const ni of ui)si([ni],new wa(ni.x,ni.y,0,0,void 0))}const Ea=32640;function mf(b,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt,dt){const yt=function(Ot,Lt,Ft,ei,Xt,yi,oi,ti){const si=[];if(Lt.positionedLines.length===0)return si;const ui=ei.layout.get("text-rotate").evaluate(yi,{})*Math.PI/180,ni=function(Ii){const qi=Ii[0],xi=Ii[1],er=qi*xi;return er>0?[qi,-xi]:er<0?[-qi,xi]:qi===0?[xi,qi]:[xi,-qi]}(Ft);let vi=Math.abs(Lt.top-Lt.bottom);for(const Ii of Lt.positionedLines)vi-=Ii.lineOffset;const bi=Lt.positionedLines.length,Li=vi/bi;let Qi=Lt.top-Ft[1];for(let Ii=0;Ii<bi;++Ii){const qi=Lt.positionedLines[Ii];Qi=Fp(Lt,Li,Qi,Ii);for(const xi of qi.positionedGlyphs){if(!xi.rect)continue;const er=xi.rect||{};let Hi=4,yr=!0,vr=1,Er=0;if(xi.imageName){const ir=oi[xi.imageName];if(!ir)continue;if(ir.sdf){je("SDF images are not supported in formatted text and will be ignored.");continue}yr=!1,vr=ir.pixelRatio,Hi=1/vr}const Ir=(Xt||ti)&&xi.vertical,Ki=xi.metrics.advance*xi.scale/2,Xi=xi.metrics,lr=xi.rect;if(lr===null)continue;ti&&Lt.verticalizable&&(Er=xi.imageName?Ki-xi.metrics.width*xi.scale/2:0);const Br=Xt?[xi.x+Ki,xi.y]:[0,0];let xr=[0,0],Mr=[0,0],Or=!1;Xt||(Ir?(Mr=[xi.x+Ki+ni[0],xi.y+ni[1]-Er],Or=!0):xr=[xi.x+Ki+Ft[0],xi.y+Ft[1]-Er]);const hr=lr.w*xi.scale/(vr*(xi.localGlyph?2:1)),qr=lr.h*xi.scale/(vr*(xi.localGlyph?2:1));let tr,br,wr,pr;if(Ir){const ir=xi.y-Qi,zr=new k(-Ki,Ki-ir),xn=-Math.PI/2,ln=new k(...Mr);tr=new k(-Ki+xr[0],xr[1]),tr._rotateAround(xn,zr)._add(ln),tr.x+=-ir+Ki,tr.y-=(Xi.left-Hi)*xi.scale;const pn=xi.imageName?Xi.advance*xi.scale:Lr*xi.scale,hn=String.fromCharCode(xi.glyph);yp(hn)?tr.x+=(1-Hi)*xi.scale:vp(hn)?tr.x+=pn-Xi.height*xi.scale+(-Hi-1)*xi.scale:tr.x+=xi.imageName||Xi.width+2*Hi===lr.w&&Xi.height+2*Hi===lr.h?(pn-qr)/2:(pn-(Xi.height+2*Hi)*xi.scale)/2,br=new k(tr.x,tr.y-hr),wr=new k(tr.x+qr,tr.y),pr=new k(tr.x+qr,tr.y-hr)}else{const ir=(Xi.left-Hi)*xi.scale-Ki+xr[0],zr=(-Xi.top-Hi)*xi.scale+xr[1],xn=ir+hr,ln=zr+qr;tr=new k(ir,zr),br=new k(xn,zr),wr=new k(ir,ln),pr=new k(xn,ln)}if(ui){let ir;ir=Xt?new k(0,0):Or?new k(ni[0],ni[1]):new k(Ft[0],Ft[1]),tr._rotateAround(ui,ir),br._rotateAround(ui,ir),wr._rotateAround(ui,ir),pr._rotateAround(ui,ir)}const cr=new k(0,0),Sr=new k(0,0);si.push({tl:tr,tr:br,bl:wr,br:pr,tex:er,writingMode:Lt.writingMode,glyphOffset:Br,sectionIndex:xi.sectionIndex,isSDF:yr,pixelOffsetTL:cr,pixelOffsetBR:Sr,minFontScaleX:0,minFontScaleY:0})}}return si}(0,C,ae,j,H,ee,z,b.allowVerticalPlacement),Mt=b.textSizeData;let Pt=null;Mt.kind==="source"?(Pt=[Ln*j.layout.get("text-size").evaluate(ee,{},dt)],Pt[0]>Ea&&je(`${b.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Mt.kind==="composite"&&(Pt=[Ln*qe.compositeTextSizes[0].evaluate(ee,{},dt),Ln*qe.compositeTextSizes[1].evaluate(ee,{},dt)],(Pt[0]>Ea||Pt[1]>Ea)&&je(`${b.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),b.addSymbols(b.text,yt,Pt,ae,H,ee,be,d,w,he.lineStartIndex,he.lineLength,$e,rt,dt);for(const Ot of Te)Re[Ot]=b.text.placedSymbolArray.length-1;return 4*yt.length}function gf(b){for(const d in b)return b[d];return null}function Sh(b,d,w,C,z,j,H,ee,ae,he){let be=H.top,Te=H.bottom,Re=H.left,$e=H.right;const qe=H.collisionPadding;if(qe&&(Re-=qe[0],be-=qe[1],$e+=qe[2],Te+=qe[3]),ae){const rt=new k(Re,be),dt=new k($e,be),yt=new k(Re,Te),Mt=new k($e,Te),Pt=B(ae);let Ot=new k(0,0);he&&(Ot=new k(he[0],he[1])),rt._rotateAround(Pt,Ot),dt._rotateAround(Pt,Ot),yt._rotateAround(Pt,Ot),Mt._rotateAround(Pt,Ot),Re=Math.min(rt.x,dt.x,yt.x,Mt.x),$e=Math.max(rt.x,dt.x,yt.x,Mt.x),be=Math.min(rt.y,dt.y,yt.y,Mt.y),Te=Math.max(rt.y,dt.y,yt.y,Mt.y)}return b.emplaceBack(d.x,d.y,d.z,w.x,w.y,Re,be,$e,Te,ee,C,z,j),b.length-1}function Du(b){b.collisionPadding&&(b.top-=b.collisionPadding[1],b.bottom+=b.collisionPadding[3]);const d=b.bottom-b.top;return d>0?Math.max(10,d):null}function Zp(b,d,w,C){const z=b.compareText;if(d in z){const j=z[d];for(let H=j.length-1;H>=0;H--)if(C.dist(j[H])<w)return!0}else z[d]=[];return z[d].push(C),!1}const Hp=to.VectorTileFeature.types,Wp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mh(b,d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt){const dt=be?Math.min(Ea,Math.round(be[0])):0,yt=be?Math.min(Ea,Math.round(be[1])):0;b.emplaceBack(d,w,Math.round(32*H),Math.round(32*ee),ae,he,(dt<<1)+(Te?1:0),yt,16*Re,16*$e,256*qe,256*rt,C,z,j,0)}function Ru(b,d,w){b.emplaceBack(d.x,d.y,w),b.emplaceBack(d.x,d.y,w),b.emplaceBack(d.x,d.y,w),b.emplaceBack(d.x,d.y,w)}function qp(b){for(const d of b.sections)if(Kh(d.text))return!0;return!1}class Pu{constructor(d){this.layoutVertexArray=new Pi,this.indexArray=new _r,this.programConfigurations=d,this.segments=new Cr,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new Wi,this.placedSymbolArray=new th}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(d,w,C,z){this.isEmpty()||(C&&(this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,cp.members),this.indexBuffer=d.createIndexBuffer(this.indexArray,w),this.dynamicLayoutVertexBuffer=d.createVertexBuffer(this.dynamicLayoutVertexArray,fp.members,!0),this.opacityVertexBuffer=d.createVertexBuffer(this.opacityVertexArray,Wp,!0),this.opacityVertexBuffer.itemSize=1),(C||z)&&this.programConfigurations.upload(d))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wi("SymbolBuffers",Pu);class Lu{constructor(d,w,C){this.layoutVertexArray=new d,this.layoutAttributes=w,this.indexArray=new C,this.segments=new Cr,this.collisionVertexArray=new Fr,this.collisionVertexArrayExt=new Di}upload(d){this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=d.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=d.createVertexBuffer(this.collisionVertexArray,dp.members,!0),this.collisionVertexBufferExt=d.createVertexBuffer(this.collisionVertexArrayExt,pp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}wi("CollisionBuffers",Lu);class Sa{constructor(d){this.collisionBoxArray=d.collisionBoxArray,this.zoom=d.zoom,this.overscaling=d.overscaling,this.layers=d.layers,this.layerIds=this.layers.map(H=>H.id),this.index=d.index,this.pixelRatio=d.pixelRatio,this.sourceLayerIndex=d.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=hu([]),this.placementViewportMatrix=hu([]);const w=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bu(this.zoom,w["text-size"]),this.iconSizeData=bu(this.zoom,w["icon-size"]);const C=this.layers[0].layout,z=C.get("symbol-sort-key"),j=C.get("symbol-z-order");this.canOverlap=C.get("text-allow-overlap")||C.get("icon-allow-overlap")||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=j!=="viewport-y"&&z.constantOr(1)!==void 0,this.sortFeaturesByY=(j==="viewport-y"||j==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=C.get("text-writing-mode").map(H=>sn[H]),this.stateDependentLayerIds=this.layers.filter(H=>H.isStateDependent()).map(H=>H.id),this.sourceID=d.sourceID}createArrays(){this.text=new Pu(new Ka(this.layers,this.zoom,d=>/^text/.test(d))),this.icon=new Pu(new Ka(this.layers,this.zoom,d=>/^icon/.test(d))),this.glyphOffsetArray=new ih,this.lineVertexArray=new Ya,this.symbolInstances=new _a}calculateGlyphDependencies(d,w,C,z,j){for(let H=0;H<d.length;H++)if(w[d.charCodeAt(H)]=!0,z&&j){const ee=el[d.charAt(H)];ee&&(w[ee.charCodeAt(0)]=!0)}}populate(d,w,C,z){const j=this.layers[0],H=j.layout,ee=H.get("text-font"),ae=H.get("text-field"),he=H.get("icon-image"),be=(ae.value.kind!=="constant"||ae.value.value instanceof kr&&!ae.value.value.isEmpty()||ae.value.value.toString().length>0)&&(ee.value.kind!=="constant"||ee.value.value.length>0),Te=he.value.kind!=="constant"||!!he.value.value||Object.keys(he.parameters).length>0,Re=H.get("symbol-sort-key");if(this.features=[],!be&&!Te)return;const $e=w.iconDependencies,qe=w.glyphDependencies,rt=w.availableImages,dt=new Ue(this.zoom);for(const{feature:yt,id:Mt,index:Pt,sourceLayerIndex:Ot}of d){const Lt=j._featureFilter.needGeometry,Ft=eo(yt,Lt);if(!j._featureFilter.filter(dt,Ft,C))continue;let ei,Xt;if(Lt||(Ft.geometry=Kn(yt,C,z)),be){const oi=j.getValueAndResolveTokens("text-field",Ft,C,rt),ti=kr.factory(oi);qp(ti)&&(this.hasRTLText=!0),(!this.hasRTLText||Ce()==="unavailable"||this.hasRTLText&&Fe.isParsed())&&(ei=_p(ti,j,Ft))}if(Te){const oi=j.getValueAndResolveTokens("icon-image",Ft,C,rt);Xt=oi instanceof Xr?oi:Xr.fromString(oi)}if(!ei&&!Xt)continue;const yi=this.sortFeaturesByKey?Re.evaluate(Ft,{},C):void 0;if(this.features.push({id:Mt,text:ei,icon:Xt,index:Pt,sourceLayerIndex:Ot,geometry:Ft.geometry,properties:yt.properties,type:Hp[yt.type],sortKey:yi}),Xt&&($e[Xt.name]=!0),ei){const oi=ee.evaluate(Ft,{},C).join(","),ti=H.get("text-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sn.vertical)>=0;for(const si of ei.sections)if(si.image)$e[si.image.name]=!0;else{const ui=Dn(ei.toString()),ni=si.fontStack||oi,vi=qe[ni]=qe[ni]||{};this.calculateGlyphDependencies(si.text,vi,ti,this.allowVerticalPlacement,ui)}}}H.get("symbol-placement")==="line"&&(this.features=function(yt){const Mt={},Pt={},Ot=[];let Lt=0;function Ft(oi){Ot.push(yt[oi]),Lt++}function ei(oi,ti,si){const ui=Pt[oi];return delete Pt[oi],Pt[ti]=ui,Ot[ui].geometry[0].pop(),Ot[ui].geometry[0]=Ot[ui].geometry[0].concat(si[0]),ui}function Xt(oi,ti,si){const ui=Mt[ti];return delete Mt[ti],Mt[oi]=ui,Ot[ui].geometry[0].shift(),Ot[ui].geometry[0]=si[0].concat(Ot[ui].geometry[0]),ui}function yi(oi,ti,si){const ui=si?ti[0][ti[0].length-1]:ti[0][0];return`${oi}:${ui.x}:${ui.y}`}for(let oi=0;oi<yt.length;oi++){const ti=yt[oi],si=ti.geometry,ui=ti.text?ti.text.toString():null;if(!ui){Ft(oi);continue}const ni=yi(ui,si),vi=yi(ui,si,!0);if(ni in Pt&&vi in Mt&&Pt[ni]!==Mt[vi]){const bi=Xt(ni,vi,si),Li=ei(ni,vi,Ot[bi].geometry);delete Mt[ni],delete Pt[vi],Pt[yi(ui,Ot[Li].geometry,!0)]=Li,Ot[bi].geometry=null}else ni in Pt?ei(ni,vi,si):vi in Mt?Xt(ni,vi,si):(Ft(oi),Mt[ni]=Lt-1,Pt[vi]=Lt-1)}return Ot.filter(oi=>oi.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((yt,Mt)=>yt.sortKey-Mt.sortKey)}update(d,w,C,z){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(d,w,this.layers,C,z),this.icon.programConfigurations.updatePaintArrays(d,w,this.layers,C,z))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(d){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(d),this.iconCollisionBox.upload(d)),this.text.upload(d,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(d,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(d,w){const C=this.lineVertexArray.length;if(d.segment!==void 0){let z=d.dist(w[d.segment+1]),j=d.dist(w[d.segment]);const H={};for(let ee=d.segment+1;ee<w.length;ee++)H[ee]={x:w[ee].x,y:w[ee].y,tileUnitDistanceFromAnchor:z},ee<w.length-1&&(z+=w[ee+1].dist(w[ee]));for(let ee=d.segment||0;ee>=0;ee--)H[ee]={x:w[ee].x,y:w[ee].y,tileUnitDistanceFromAnchor:j},ee>0&&(j+=w[ee-1].dist(w[ee]));for(let ee=0;ee<w.length;ee++){const ae=H[ee];this.lineVertexArray.emplaceBack(ae.x,ae.y,ae.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(d,w,C,z,j,H,ee,ae,he,be,Te,Re,$e,qe){const rt=d.indexArray,dt=d.layoutVertexArray,yt=d.segments.prepareSegment(4*w.length,dt,rt,this.canOverlap?H.sortKey:void 0),Mt=this.glyphOffsetArray.length,Pt=yt.vertexLength,Ot=this.allowVerticalPlacement&&ee===sn.vertical?Math.PI/2:0,Lt=H.text&&H.text.sections;for(let Ft=0;Ft<w.length;Ft++){const{tl:ei,tr:Xt,bl:yi,br:oi,tex:ti,pixelOffsetTL:si,pixelOffsetBR:ui,minFontScaleX:ni,minFontScaleY:vi,glyphOffset:bi,isSDF:Li,sectionIndex:Qi}=w[Ft],Ii=yt.vertexLength,qi=bi[1];Mh(dt,ae.x,ae.y,ae.z,he.x,he.y,ei.x,qi+ei.y,ti.x,ti.y,C,Li,si.x,si.y,ni,vi),Mh(dt,ae.x,ae.y,ae.z,he.x,he.y,Xt.x,qi+Xt.y,ti.x+ti.w,ti.y,C,Li,ui.x,si.y,ni,vi),Mh(dt,ae.x,ae.y,ae.z,he.x,he.y,yi.x,qi+yi.y,ti.x,ti.y+ti.h,C,Li,si.x,ui.y,ni,vi),Mh(dt,ae.x,ae.y,ae.z,he.x,he.y,oi.x,qi+oi.y,ti.x+ti.w,ti.y+ti.h,C,Li,ui.x,ui.y,ni,vi),Ru(d.dynamicLayoutVertexArray,ae,Ot),rt.emplaceBack(Ii,Ii+1,Ii+2),rt.emplaceBack(Ii+1,Ii+2,Ii+3),yt.vertexLength+=4,yt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bi[0]),Ft!==w.length-1&&Qi===w[Ft+1].sectionIndex||d.programConfigurations.populatePaintArrays(dt.length,H,H.index,{},$e,qe,Lt&&Lt[Qi])}d.placedSymbolArray.emplaceBack(ae.x,ae.y,ae.z,he.x,he.y,Mt,this.glyphOffsetArray.length-Mt,Pt,be,Te,he.segment,C?C[0]:0,C?C[1]:0,z[0],z[1],ee,0,!1,0,Re,0)}_commitLayoutVertex(d,w,C,z,j,H,ee){d.emplaceBack(w,C,z,j,H,Math.round(ee.x),Math.round(ee.y))}_addCollisionDebugVertices(d,w,C,z,j,H,ee){const ae=C.segments.prepareSegment(4,C.layoutVertexArray,C.indexArray),he=ae.vertexLength,be=ee.tileAnchorX,Te=ee.tileAnchorY;for(let $e=0;$e<4;$e++)C.collisionVertexArray.emplaceBack(0,0,0,0);C.collisionVertexArrayExt.emplaceBack(w,-d.padding,-d.padding),C.collisionVertexArrayExt.emplaceBack(w,d.padding,-d.padding),C.collisionVertexArrayExt.emplaceBack(w,d.padding,d.padding),C.collisionVertexArrayExt.emplaceBack(w,-d.padding,d.padding),this._commitLayoutVertex(C.layoutVertexArray,z,j,H,be,Te,new k(d.x1,d.y1)),this._commitLayoutVertex(C.layoutVertexArray,z,j,H,be,Te,new k(d.x2,d.y1)),this._commitLayoutVertex(C.layoutVertexArray,z,j,H,be,Te,new k(d.x2,d.y2)),this._commitLayoutVertex(C.layoutVertexArray,z,j,H,be,Te,new k(d.x1,d.y2)),ae.vertexLength+=4;const Re=C.indexArray;Re.emplaceBack(he,he+1),Re.emplaceBack(he+1,he+2),Re.emplaceBack(he+2,he+3),Re.emplaceBack(he+3,he),ae.primitiveLength+=4}_addTextDebugCollisionBoxes(d,w,C,z,j,H){for(let ee=z;ee<j;ee++){const ae=C.get(ee),he=this.getSymbolInstanceTextSize(d,H,w,ee);this._addCollisionDebugVertices(ae,he,this.textCollisionBox,ae.projectedAnchorX,ae.projectedAnchorY,ae.projectedAnchorZ,H)}}_addIconDebugCollisionBoxes(d,w,C,z,j,H){for(let ee=z;ee<j;ee++){const ae=C.get(ee),he=this.getSymbolInstanceIconSize(d,w,ee);this._addCollisionDebugVertices(ae,he,this.iconCollisionBox,ae.projectedAnchorX,ae.projectedAnchorY,ae.projectedAnchorZ,H)}}generateCollisionDebugBuffers(d,w){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lu(Tr,Gc.members,or),this.iconCollisionBox=new Lu(Tr,Gc.members,or);const C=Ko(this.iconSizeData,d),z=Ko(this.textSizeData,d);for(let j=0;j<this.symbolInstances.length;j++){const H=this.symbolInstances.get(j);this._addTextDebugCollisionBoxes(z,d,w,H.textBoxStartIndex,H.textBoxEndIndex,H),this._addTextDebugCollisionBoxes(z,d,w,H.verticalTextBoxStartIndex,H.verticalTextBoxEndIndex,H),this._addIconDebugCollisionBoxes(C,d,w,H.iconBoxStartIndex,H.iconBoxEndIndex,H),this._addIconDebugCollisionBoxes(C,d,w,H.verticalIconBoxStartIndex,H.verticalIconBoxEndIndex,H)}}getSymbolInstanceTextSize(d,w,C,z){const j=this.text.placedSymbolArray.get(w.rightJustifiedTextSymbolIndex>=0?w.rightJustifiedTextSymbolIndex:w.centerJustifiedTextSymbolIndex>=0?w.centerJustifiedTextSymbolIndex:w.leftJustifiedTextSymbolIndex>=0?w.leftJustifiedTextSymbolIndex:w.verticalPlacedTextSymbolIndex>=0?w.verticalPlacedTextSymbolIndex:z),H=yh(this.textSizeData,d,j)/Lr;return this.tilePixelRatio*H}getSymbolInstanceIconSize(d,w,C){const z=this.icon.placedSymbolArray.get(C),j=yh(this.iconSizeData,d,z);return this.tilePixelRatio*j}_commitDebugCollisionVertexUpdate(d,w,C){d.emplaceBack(w,-C,-C),d.emplaceBack(w,C,-C),d.emplaceBack(w,C,C),d.emplaceBack(w,-C,C)}_updateTextDebugCollisionBoxes(d,w,C,z,j,H){for(let ee=z;ee<j;ee++){const ae=C.get(ee),he=this.getSymbolInstanceTextSize(d,H,w,ee);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,he,ae.padding)}}_updateIconDebugCollisionBoxes(d,w,C,z,j){for(let H=z;H<j;H++){const ee=C.get(H),ae=this.getSymbolInstanceIconSize(d,w,H);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,ae,ee.padding)}}updateCollisionDebugBuffers(d,w){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const C=Ko(this.iconSizeData,d),z=Ko(this.textSizeData,d);for(let j=0;j<this.symbolInstances.length;j++){const H=this.symbolInstances.get(j);this._updateTextDebugCollisionBoxes(z,d,w,H.textBoxStartIndex,H.textBoxEndIndex,H),this._updateTextDebugCollisionBoxes(z,d,w,H.verticalTextBoxStartIndex,H.verticalTextBoxEndIndex,H),this._updateIconDebugCollisionBoxes(C,d,w,H.iconBoxStartIndex,H.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(C,d,w,H.verticalIconBoxStartIndex,H.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(d,w,C,z,j,H,ee,ae,he){const be={};for(let Te=w;Te<C;Te++){const Re=d.get(Te);be.textBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,padding:Re.padding,projectedAnchorX:Re.projectedAnchorX,projectedAnchorY:Re.projectedAnchorY,projectedAnchorZ:Re.projectedAnchorZ,tileAnchorX:Re.tileAnchorX,tileAnchorY:Re.tileAnchorY},be.textFeatureIndex=Re.featureIndex;break}for(let Te=z;Te<j;Te++){const Re=d.get(Te);be.verticalTextBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,padding:Re.padding,projectedAnchorX:Re.projectedAnchorX,projectedAnchorY:Re.projectedAnchorY,projectedAnchorZ:Re.projectedAnchorZ,tileAnchorX:Re.tileAnchorX,tileAnchorY:Re.tileAnchorY},be.verticalTextFeatureIndex=Re.featureIndex;break}for(let Te=H;Te<ee;Te++){const Re=d.get(Te);be.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,padding:Re.padding,projectedAnchorX:Re.projectedAnchorX,projectedAnchorY:Re.projectedAnchorY,projectedAnchorZ:Re.projectedAnchorZ,tileAnchorX:Re.tileAnchorX,tileAnchorY:Re.tileAnchorY},be.iconFeatureIndex=Re.featureIndex;break}for(let Te=ae;Te<he;Te++){const Re=d.get(Te);be.verticalIconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,padding:Re.padding,projectedAnchorX:Re.projectedAnchorX,projectedAnchorY:Re.projectedAnchorY,projectedAnchorZ:Re.projectedAnchorZ,tileAnchorX:Re.tileAnchorX,tileAnchorY:Re.tileAnchorY},be.verticalIconFeatureIndex=Re.featureIndex;break}return be}deserializeCollisionBoxes(d){this.collisionArrays=[];for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(d,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(d,w){const C=d.placedSymbolArray.get(w),z=C.vertexStartIndex+4*C.numGlyphs;for(let j=C.vertexStartIndex;j<z;j+=4)d.indexArray.emplaceBack(j,j+1,j+2),d.indexArray.emplaceBack(j+1,j+2,j+3)}getSortedSymbolIndexes(d){if(this.sortedAngle===d&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const w=Math.sin(d),C=Math.cos(d),z=[],j=[],H=[];for(let ee=0;ee<this.symbolInstances.length;++ee){H.push(ee);const ae=this.symbolInstances.get(ee);z.push(0|Math.round(w*ae.tileAnchorX+C*ae.tileAnchorY)),j.push(ae.featureIndex)}return H.sort((ee,ae)=>z[ee]-z[ae]||j[ae]-j[ee]),H}addToSortKeyRanges(d,w){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===w?C.symbolInstanceEnd=d+1:this.sortKeyRanges.push({sortKey:w,symbolInstanceStart:d,symbolInstanceEnd:d+1})}sortFeatures(d){if(this.sortFeaturesByY&&this.sortedAngle!==d&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(d),this.sortedAngle=d,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const w of this.symbolInstanceIndexes){const C=this.symbolInstances.get(w);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((z,j,H)=>{z>=0&&H.indexOf(z)===j&&this.addIndicesForPlacedSymbol(this.text,z)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}wi("SymbolBucket",Sa,{omit:["layers","collisionBoxArray","features","compareText"]}),Sa.MAX_GLYPHS=65535,Sa.addDynamicAttributes=Ru;const Xp=new Jt({"symbol-placement":new ut(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(Ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ut(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(Ct.layout_symbol["icon-size"]),"icon-text-fit":new ut(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(Ct.layout_symbol["icon-image"]),"icon-rotate":new Et(Ct.layout_symbol["icon-rotate"]),"icon-padding":new ut(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(Ct.layout_symbol["icon-offset"]),"icon-anchor":new Et(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new Et(Ct.layout_symbol["text-field"]),"text-font":new Et(Ct.layout_symbol["text-font"]),"text-size":new Et(Ct.layout_symbol["text-size"]),"text-max-width":new Et(Ct.layout_symbol["text-max-width"]),"text-line-height":new Et(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new Et(Ct.layout_symbol["text-justify"]),"text-radial-offset":new Et(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Ct.layout_symbol["text-variable-anchor"]),"text-anchor":new Et(Ct.layout_symbol["text-anchor"]),"text-max-angle":new ut(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new Et(Ct.layout_symbol["text-rotate"]),"text-padding":new ut(Ct.layout_symbol["text-padding"]),"text-keep-upright":new ut(Ct.layout_symbol["text-keep-upright"]),"text-transform":new Et(Ct.layout_symbol["text-transform"]),"text-offset":new Et(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ut(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Ct.layout_symbol["text-optional"])});var Bu={paint:new Jt({"icon-opacity":new Et(Ct.paint_symbol["icon-opacity"]),"icon-color":new Et(Ct.paint_symbol["icon-color"]),"icon-halo-color":new Et(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new Et(Ct.paint_symbol["text-opacity"]),"text-color":new Et(Ct.paint_symbol["text-color"],{runtimeType:ar,getOverride:b=>b.textColor,hasOverride:b=>!!b.textColor}),"text-halo-color":new Et(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new Et(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(Ct.paint_symbol["text-halo-blur"]),"text-translate":new ut(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Ct.paint_symbol["text-translate-anchor"])}),layout:Xp};class _f{constructor(d){this.type=d.property.overrides?d.property.overrides.runtimeType:Gr,this.defaultValue=d}evaluate(d){if(d.formattedSection){const w=this.defaultValue.property.overrides;if(w&&w.hasOverride(d.formattedSection))return w.getOverride(d.formattedSection)}return d.feature&&d.featureState?this.defaultValue.evaluate(d.feature,d.featureState):this.defaultValue.property.specification.default}eachChild(d){this.defaultValue.isConstant()||d(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wi("FormatSectionOverride",_f,{omit:["defaultValue"]});class Th extends yn{constructor(d){super(d,Bu)}recalculate(d,w){super.recalculate(d,w),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const C=this.layout.get("text-writing-mode");if(C){const z=[];for(const j of C)z.indexOf(j)<0&&z.push(j);this.layout._values["text-writing-mode"]=z}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(d,w,C,z){const j=this.layout.get(d).evaluate(w,{},C,z),H=this._unevaluatedLayout._values[d];return H.isDataDriven()||nn(H.value)||!j?j:function(ee,ae){return ae.replace(/{([^{}]+)}/g,(he,be)=>be in ee?String(ee[be]):"")}(w.properties,j)}createBucket(d){return new Sa(d)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const d of Bu.paint.overridableProperties){if(!Th.hasPaintOverride(this.layout,d))continue;const w=this.paint.get(d),C=new _f(w),z=new Ts(C,w.property.specification);let j=null;j=w.value.kind==="constant"||w.value.kind==="source"?new An("source",z):new Io("composite",z,w.value.zoomStops,w.value._interpolationType),this.paint._values[d]=new gt(w.property,j,w.parameters)}}_handleOverridablePaintPropertyUpdate(d,w,C){return!(!this.layout||w.isDataDriven()||C.isDataDriven())&&Th.hasPaintOverride(this.layout,d)}static hasPaintOverride(d,w){const C=d.get("text-field"),z=Bu.paint.properties[w];let j=!1;const H=ee=>{for(const ae of ee)if(z.overrides&&z.overrides.hasOverride(ae))return void(j=!0)};if(C.value.kind==="constant"&&C.value.value instanceof kr)H(C.value.value.sections);else if(C.value.kind==="source"){const ee=he=>{j||(he instanceof jn&&fr(he.value)===ea?H(he.value.sections):he instanceof Ia?H(he.sections):he.eachChild(ee))},ae=C.value;ae._styleExpression&&ee(ae._styleExpression.expression)}return j}getProgramConfiguration(d){return new Yn(this,d)}}var Yp={paint:new Jt({"background-color":new ut(Ct.paint_background["background-color"]),"background-pattern":new Wt(Ct.paint_background["background-pattern"]),"background-opacity":new ut(Ct.paint_background["background-opacity"])})},Kp={paint:new Jt({"raster-opacity":new ut(Ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Ct.paint_raster["raster-saturation"]),"raster-contrast":new ut(Ct.paint_raster["raster-contrast"]),"raster-resampling":new ut(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Ct.paint_raster["raster-fade-duration"])})};class Jp extends yn{constructor(d){super(d,{}),this.implementation=d}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(d){this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)}onRemove(d){this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)}}var Qp={paint:new Jt({"sky-type":new ut(Ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new ut(Ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ut(Ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ut(Ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ut(Ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new Zt(Ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ut(Ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ut(Ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ut(Ct.paint_sky["sky-opacity"])})};function Ou(b,d,w){const C=qo(0,0,1),z=wc(uu());return function(j,H,ee){ee*=.5;var ae=H[0],he=H[1],be=H[2],Te=H[3],Re=Math.sin(ee),$e=Math.cos(ee);j[0]=ae*$e-be*Re,j[1]=he*$e+Te*Re,j[2]=be*$e+ae*Re,j[3]=Te*$e-he*Re}(z,z,w?-B(b)+Math.PI:B(b)),Ec(z,z,-B(d)),bc(C,C,z),xc(C,C)}const e0={circle:class extends yn{constructor(b){super(b,vd)}createBucket(b){return new ou(b)}queryRadius(b){const d=b;return Wo("circle-radius",this,d)+Wo("circle-stroke-width",this,d)+hh(this.paint.get("circle-translate"))}queryIntersectsFeature(b,d,w,C,z,j,H,ee){const ae=dc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),j.angle,b.pixelToTileUnitsFactor),he=this.paint.get("circle-radius").evaluate(d,w)+this.paint.get("circle-stroke-width").evaluate(d,w);return Mc(b,C,j,H,ee,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ae,he)}getProgramIds(){return["circle"]}getProgramConfiguration(b){return new Yn(this,b)}},heatmap:class extends yn{createBucket(b){return new Ac(b)}constructor(b){super(b,Ad),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(b){b==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=du({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(b){return Wo("heatmap-radius",this,b)}queryIntersectsFeature(b,d,w,C,z,j,H,ee){const ae=this.paint.get("heatmap-radius").evaluate(d,w);return Mc(b,C,j,H,ee,!0,!0,new k(0,0),ae)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(b){return new Yn(this,b)}},hillshade:class extends yn{constructor(b){super(b,Cd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(b){return new Yn(this,b)}},fill:class extends yn{constructor(b){super(b,Zd)}getProgramIds(){const b=this.paint.get("fill-pattern"),d=b&&b.constantOr(1),w=[d?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&w.push(d&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),w}getProgramConfiguration(b){return new Yn(this,b)}recalculate(b,d){super.recalculate(b,d);const w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(b){return new gh(b)}queryRadius(){return hh(this.paint.get("fill-translate"))}queryIntersectsFeature(b,d,w,C,z,j){return!b.queryGeometry.isAboveHorizon&&lc(fc(b.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),j.angle,b.pixelToTileUnitsFactor),C)}isTileClipped(){return!0}},"fill-extrusion":class extends yn{constructor(b){super(b,ip)}createBucket(b){return new xu(b)}queryRadius(){return hh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(b){return new Yn(this,b)}queryIntersectsFeature(b,d,w,C,z,j,H,ee,ae){const he=dc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),j.angle,b.pixelToTileUnitsFactor),be=this.paint.get("fill-extrusion-height").evaluate(d,w),Te=this.paint.get("fill-extrusion-base").evaluate(d,w),Re=[0,0],$e=ee&&j.elevation,qe=j.elevation?j.elevation.exaggeration():1;if($e){const yt=b.tile.getBucket(this).centroidVertexArray,Mt=ae+1;if(Mt<yt.length){const Pt=yt.get(Mt);Re[0]=Pt.a_centroid_pos0,Re[1]=Pt.a_centroid_pos1}}if(Re[0]===0&&Re[1]===1)return!1;const rt=function(yt,Mt,Pt,Ot,Lt,Ft,ei,Xt,yi){return Ft?function(oi,ti,si,ui,ni,vi,bi,Li,Qi){const Ii=[],qi=[],xi=[0,0,0,1];for(const er of oi){const Hi=[],yr=[];for(const vr of er){const Er=vr.x+ui.x,Ir=vr.y+ui.y,Ki=rp(Er,Ir,ti,si,vi,bi,Li,Qi);xi[0]=Er,xi[1]=Ir,xi[2]=Ki.base,xi[3]=1,Ws(xi,xi,ni),xi[3]=Math.max(xi[3],1e-5);const Xi=Nc([xi[0]/xi[3],xi[1]/xi[3],xi[2]/xi[3]]);xi[0]=Er,xi[1]=Ir,xi[2]=Ki.top,xi[3]=1,Ws(xi,xi,ni),xi[3]=Math.max(xi[3],1e-5);const lr=Nc([xi[0]/xi[3],xi[1]/xi[3],xi[2]/xi[3]]);Hi.push(Xi),yr.push(lr)}Ii.push(Hi),qi.push(yr)}return[Ii,qi]}(yt,Mt,Pt,Ot,Lt,Ft,ei,Xt,yi):function(oi,ti,si,ui,ni){const vi=[],bi=[],Li=ni[8]*ti,Qi=ni[9]*ti,Ii=ni[10]*ti,qi=ni[11]*ti,xi=ni[8]*si,er=ni[9]*si,Hi=ni[10]*si,yr=ni[11]*si;for(const vr of oi){const Er=[],Ir=[];for(const Ki of vr){const Xi=Ki.x+ui.x,lr=Ki.y+ui.y,Br=ni[0]*Xi+ni[4]*lr+ni[12],xr=ni[1]*Xi+ni[5]*lr+ni[13],Mr=ni[2]*Xi+ni[6]*lr+ni[14],Or=ni[3]*Xi+ni[7]*lr+ni[15],hr=Br+Li,qr=xr+Qi,tr=Mr+Ii,br=Math.max(Or+qi,1e-5),wr=Br+xi,pr=xr+er,cr=Mr+Hi,Sr=Math.max(Or+yr,1e-5),ir=new k(hr/br,qr/br);ir.z=tr/br,Er.push(ir);const zr=new k(wr/Sr,pr/Sr);zr.z=cr/Sr,Ir.push(zr)}vi.push(Er),bi.push(Ir)}return[vi,bi]}(yt,Mt,Pt,Ot,Lt)}(C,Te,be,he,H,$e?ee:null,Re,qe,j.center.lat),dt=b.queryGeometry;return function(yt,Mt,Pt){let Ot=1/0;lc(Pt,Mt)&&(Ot=zc(Pt,Mt[0]));for(let Lt=0;Lt<Mt.length;Lt++){const Ft=Mt[Lt],ei=yt[Lt];for(let Xt=0;Xt<Ft.length-1;Xt++){const yi=Ft[Xt],oi=[yi,Ft[Xt+1],ei[Xt+1],ei[Xt],yi];sc(Pt,oi)&&(Ot=Math.min(Ot,zc(Pt,oi)))}}return Ot!==1/0&&Ot}(rt[0],rt[1],dt.isPointQuery()?dt.screenBounds:dt.screenGeometry)}},line:class extends yn{constructor(b){super(b,Uc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(b){if(b==="line-gradient"){const d=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=d._styleExpression&&d._styleExpression.expression instanceof Ra,this.gradientVersion=(this.gradientVersion+1)%M}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(b,d){super.recalculate(b,d),this.paint._values["line-floorwidth"]=$c.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,b)}createBucket(b){return new _h(b)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(b){return new Yn(this,b)}queryRadius(b){const d=b,w=jc(Wo("line-width",this,d),Wo("line-gap-width",this,d)),C=Wo("line-offset",this,d);return w/2+Math.abs(C)+hh(this.paint.get("line-translate"))}queryIntersectsFeature(b,d,w,C,z,j){if(b.queryGeometry.isAboveHorizon)return!1;const H=fc(b.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),j.angle,b.pixelToTileUnitsFactor),ee=b.pixelToTileUnitsFactor/2*jc(this.paint.get("line-width").evaluate(d,w),this.paint.get("line-gap-width").evaluate(d,w)),ae=this.paint.get("line-offset").evaluate(d,w);return ae&&(C=function(he,be){const Te=[],Re=new k(0,0);for(let $e=0;$e<he.length;$e++){const qe=he[$e],rt=[];for(let dt=0;dt<qe.length;dt++){const yt=qe[dt-1],Mt=qe[dt],Pt=qe[dt+1],Ot=dt===0?Re:Mt.sub(yt)._unit()._perp(),Lt=dt===qe.length-1?Re:Pt.sub(Mt)._unit()._perp(),Ft=Ot._add(Lt)._unit();Ft._mult(1/(Ft.x*Lt.x+Ft.y*Lt.y)),rt.push(Ft._mult(be)._add(Mt))}Te.push(rt)}return Te}(C,ae*b.pixelToTileUnitsFactor)),function(he,be,Te){for(let Re=0;Re<be.length;Re++){const $e=be[Re];if(he.length>=3){for(let qe=0;qe<$e.length;qe++)if(Ho(he,$e[qe]))return!0}if(md(he,$e,Te))return!0}return!1}(H,C,ee)}isTileClipped(){return!0}},symbol:Th,background:class extends yn{constructor(b){super(b,Yp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends yn{constructor(b){super(b,Kp)}getProgramIds(){return["raster"]}},sky:class extends yn{constructor(b){super(b,Qp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(b){b==="sky-gradient"?this._updateColorRamp():b!=="sky-atmosphere-sun"&&b!=="sky-atmosphere-halo-color"&&b!=="sky-atmosphere-color"&&b!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=du({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(b){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const d=b.style.light.properties.get("position");return this._lightPosition.azimuthal!==d.azimuthal||this._lightPosition.polar!==d.polar}}getCenter(b,d){const w=this.paint.get("sky-type");if(w==="atmosphere"){const C=this.paint.get("sky-atmosphere-sun"),z=!C,j=b.style.light,H=j.properties.get("position");return z&&j.properties.get("anchor")==="viewport"&&je("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),z?Ou(H.azimuthal,90-H.polar,d):Ou(C[0],90-C[1],d)}if(w==="gradient"){const C=this.paint.get("sky-gradient-center");return Ou(C[0],90-C[1],d)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(b){this._skyboxInvalidated=!1,this._lightPosition=b.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const b=this.paint.get("sky-type");return b==="atmosphere"?["skyboxCapture","skybox"]:b==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:yf,HTMLCanvasElement:vf,HTMLVideoElement:xf,ImageData:bf,ImageBitmap:Ah}=D;class Ch{constructor(d,w,C,z){this.context=d,this.format=C,this.texture=d.gl.createTexture(),this.update(w,z)}update(d,w,C){const{width:z,height:j}=d,{context:H}=this,{gl:ee}=H;if(ee.bindTexture(ee.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===ee.RGBA&&(!w||w.premultiply!==!1)),C||this.size&&this.size[0]===z&&this.size[1]===j){const{x:ae,y:he}=C||{x:0,y:0};d instanceof yf||d instanceof vf||d instanceof xf||d instanceof bf||Ah&&d instanceof Ah?ee.texSubImage2D(ee.TEXTURE_2D,0,ae,he,ee.RGBA,ee.UNSIGNED_BYTE,d):ee.texSubImage2D(ee.TEXTURE_2D,0,ae,he,z,j,ee.RGBA,ee.UNSIGNED_BYTE,d.data)}else this.size=[z,j],d instanceof yf||d instanceof vf||d instanceof xf||d instanceof bf||Ah&&d instanceof Ah?ee.texImage2D(ee.TEXTURE_2D,0,this.format,this.format,ee.UNSIGNED_BYTE,d):ee.texImage2D(ee.TEXTURE_2D,0,this.format,z,j,0,this.format,ee.UNSIGNED_BYTE,d.data);this.useMipmap=Boolean(w&&w.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&ee.generateMipmap(ee.TEXTURE_2D)}bind(d,w){const{context:C}=this,{gl:z}=C;z.bindTexture(z.TEXTURE_2D,this.texture),d!==this.filter&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,d),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,this.useMipmap?d===z.NEAREST?z.NEAREST_MIPMAP_NEAREST:z.LINEAR_MIPMAP_NEAREST:d),this.filter=d),w!==this.wrap&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,w),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,w),this.wrap=w)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}}class Fu{constructor(d,w){this.width=d,this.height=w,this.nextRow=0,this.image=new xa({width:d,height:w}),this.positions={},this.uploaded=!1}getDash(d,w){const C=this.getKey(d,w);return this.positions[C]}trim(){const d=this.width,w=this.height=we(this.nextRow);this.image.resize({width:d,height:w})}getKey(d,w){return d.join(",")+w}getDashRanges(d,w,C){const z=[];let j=d.length%2==1?-d[d.length-1]*C:0,H=d[0]*C,ee=!0;z.push({left:j,right:H,isDash:ee,zeroLength:d[0]===0});let ae=d[0];for(let he=1;he<d.length;he++){ee=!ee;const be=d[he];j=ae*C,ae+=be,H=ae*C,z.push({left:j,right:H,isDash:ee,zeroLength:be===0})}return z}addRoundDash(d,w,C){const z=w/2;for(let j=-C;j<=C;j++){const H=this.width*(this.nextRow+C+j);let ee=0,ae=d[ee];for(let he=0;he<this.width;he++){he/ae.right>1&&(ae=d[++ee]);const be=Math.abs(he-ae.left),Te=Math.abs(he-ae.right),Re=Math.min(be,Te);let $e;const qe=j/C*(z+1);if(ae.isDash){const rt=z-Math.abs(qe);$e=Math.sqrt(Re*Re+rt*rt)}else $e=z-Math.sqrt(Re*Re+qe*qe);this.image.data[H+he]=Math.max(0,Math.min(255,$e+128))}}}addRegularDash(d,w){for(let ae=d.length-1;ae>=0;--ae){const he=d[ae],be=d[ae+1];he.zeroLength?d.splice(ae,1):be&&be.isDash===he.isDash&&(be.left=he.left,d.splice(ae,1))}const C=d[0],z=d[d.length-1];C.isDash===z.isDash&&(C.left=z.left-this.width,z.right=C.right+this.width);const j=this.width*this.nextRow;let H=0,ee=d[H];for(let ae=0;ae<this.width;ae++){ae/ee.right>1&&(ee=d[++H]);const he=Math.abs(ae-ee.left),be=Math.abs(ae-ee.right),Te=Math.min(he,be);this.image.data[j+ae]=Math.max(0,Math.min(255,(ee.isDash?Te:-Te)+w+128))}}addDash(d,w){const C=this.getKey(d,w);if(this.positions[C])return this.positions[C];const z=w==="round",j=z?7:0,H=2*j+1;if(this.nextRow+H>this.height)return je("LineAtlas out of space"),null;d.length===0&&d.push(1);let ee=0;for(let be=0;be<d.length;be++)d[be]<0&&(je("Negative value is found in line dasharray, replacing values with 0"),d[be]=0),ee+=d[be];if(ee!==0){const be=this.width/ee,Te=this.getDashRanges(d,this.width,be);z?this.addRoundDash(Te,be,j):this.addRegularDash(Te,w==="square"?.5*be:0)}const ae=this.nextRow+j;this.nextRow+=H;const he={tl:[ae,j],br:[ee,0]};return this.positions[C]=he,he}}wi("LineAtlas",Fu);class t0{constructor(d){this._callback=d,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const i0=D.performance;function wf(b){const d=b?b.url.toString():void 0;return i0.getEntriesByName(d)}class r0{constructor(){this.tasks={},this.taskQueue=[],ye(["process"],this),this.invoker=new t0(this.process),this.nextId=0}add(d,w){const C=this.nextId++,z=function({type:j,isSymbolTile:H,zoom:ee}){return ee=ee||0,j==="message"?0:j!=="maybePrepare"||H?j!=="parseTile"||H?j==="parseTile"&&H?300-ee:j==="maybePrepare"&&H?400-ee:500:200-ee:100-ee}(w);if(z===0){De();try{d()}finally{}return{cancel:()=>{}}}return this.tasks[C]={fn:d,metadata:w,priority:z,id:C},this.taskQueue.push(C),this.invoker.trigger(),{cancel:()=>{delete this.tasks[C]}}}process(){De();try{if(this.taskQueue=this.taskQueue.filter(C=>!!this.tasks[C]),!this.taskQueue.length)return;const d=this.pick();if(d===null)return;const w=this.tasks[d];if(delete this.tasks[d],this.taskQueue.length&&this.invoker.trigger(),!w)return;w.fn()}finally{}}pick(){let d=null,w=1/0;for(let z=0;z<this.taskQueue.length;z++){const j=this.tasks[this.taskQueue[z]];j.priority<w&&(w=j.priority,d=z)}if(d===null)return null;const C=this.taskQueue[d];return this.taskQueue.splice(d,1),C}remove(){this.invoker.remove()}}function Ih(b,d){const w=Math.pow(2,-b.z),C=b.x*w,z=(b.x+1)*w,j=b.y*w,H=(b.y+1)*w;if(d.name==="mercator")return{scale:1<<b.z,x:b.x,y:b.y,x2:b.x+1,y2:b.y+1,projection:d};const ee=Qa(C),ae=Qa(z),he=Pn(j),be=Pn(H),Te=d.project(ee,he),Re=d.project(ae,he),$e=d.project(ae,be),qe=d.project(ee,be);let rt=Math.min(Te.x,Re.x,$e.x,qe.x),dt=Math.min(Te.y,Re.y,$e.y,qe.y),yt=Math.max(Te.x,Re.x,$e.x,qe.x),Mt=Math.max(Te.y,Re.y,$e.y,qe.y);const Pt=w/16;function Ot(Ft,ei,Xt,yi,oi,ti){const si=(Xt+oi)/2,ui=(yi+ti)/2,ni=d.project(Qa(si),Pn(ui)),vi=Math.max(0,rt-ni.x,dt-ni.y,ni.x-yt,ni.y-Mt);rt=Math.min(rt,ni.x),yt=Math.max(yt,ni.x),dt=Math.min(dt,ni.y),Mt=Math.max(Mt,ni.y),vi>Pt&&(Ot(Ft,ni,Xt,yi,si,ui),Ot(ni,ei,si,ui,oi,ti))}Ot(Te,Re,C,j,z,j),Ot(Re,$e,z,j,z,H),Ot($e,qe,z,H,C,H),Ot(qe,Te,C,H,C,j),rt-=Pt,dt-=Pt,yt+=Pt,Mt+=Pt;const Lt=1/Math.max(yt-rt,Mt-dt);return{scale:Lt,x:rt*Lt,y:dt*Lt,x2:yt*Lt,y2:Mt*Lt,projection:d}}function Ef(b,d,w){var C=2*Math.PI*6378137/256/Math.pow(2,w);return[b*C-2*Math.PI*6378137/2,d*C-2*Math.PI*6378137/2]}class zu{constructor(d,w,C){this.z=d,this.x=w,this.y=C,this.key=nl(0,d,d,w,C)}equals(d){return this.z===d.z&&this.x===d.x&&this.y===d.y}url(d,w){const C=(j=this.y,H=this.z,ee=Ef(256*(z=this.x),256*(j=Math.pow(2,H)-j-1),H),ae=Ef(256*(z+1),256*(j+1),H),ee[0]+","+ee[1]+","+ae[0]+","+ae[1]);var z,j,H,ee,ae;const he=function(be,Te,Re){let $e,qe="";for(let rt=be;rt>0;rt--)$e=1<<rt-1,qe+=(Te&$e?1:0)+(Re&$e?2:0);return qe}(this.z,this.x,this.y);return d[(this.x+this.y)%d.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(w==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",he).replace("{bbox-epsg-3857}",C)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Sf{constructor(d,w){this.wrap=d,this.canonical=w,this.key=nl(d,w.z,w.z,w.x,w.y)}}class Wr{constructor(d,w,C,z,j){this.overscaledZ=d,this.wrap=w,this.canonical=new zu(C,+z,+j),this.key=w===0&&d===C?this.canonical.key:nl(w,d,C,z,j)}equals(d){return this.overscaledZ===d.overscaledZ&&this.wrap===d.wrap&&this.canonical.equals(d.canonical)}scaledTo(d){const w=this.canonical.z-d;return d>this.canonical.z?new Wr(d,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(d,this.wrap,d,this.canonical.x>>w,this.canonical.y>>w)}calculateScaledKey(d,w=!0){if(this.overscaledZ===d&&w)return this.key;if(d>this.canonical.z)return nl(this.wrap*+w,d,this.canonical.z,this.canonical.x,this.canonical.y);{const C=this.canonical.z-d;return nl(this.wrap*+w,d,d,this.canonical.x>>C,this.canonical.y>>C)}}isChildOf(d){if(d.wrap!==this.wrap)return!1;const w=this.canonical.z-d.canonical.z;return d.overscaledZ===0||d.overscaledZ<this.overscaledZ&&d.canonical.x===this.canonical.x>>w&&d.canonical.y===this.canonical.y>>w}children(d){if(this.overscaledZ>=d)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const w=this.canonical.z+1,C=2*this.canonical.x,z=2*this.canonical.y;return[new Wr(w,this.wrap,w,C,z),new Wr(w,this.wrap,w,C+1,z),new Wr(w,this.wrap,w,C,z+1),new Wr(w,this.wrap,w,C+1,z+1)]}isLessThan(d){return this.wrap<d.wrap||!(this.wrap>d.wrap)&&(this.overscaledZ<d.overscaledZ||!(this.overscaledZ>d.overscaledZ)&&(this.canonical.x<d.canonical.x||!(this.canonical.x>d.canonical.x)&&this.canonical.y<d.canonical.y))}wrapped(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(d){return new Wr(this.overscaledZ,d,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Sf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nl(b,d,w,C,z){const j=1<<Math.min(w,22);let H=j*(z%j)+C%j;return b&&w<22&&(H+=j*j*((b<0?-2*b-1:2*b)%(1<<2*(22-w)))),16*(32*H+w)+(d-w)}wi("CanonicalTileID",zu),wi("OverscaledTileID",Wr,{omit:["projMatrix"]});class Mf{constructor(d){this._stringToNumber={},this._numberToString=[];for(let w=0;w<d.length;w++){const C=d[w];this._stringToNumber[C]=w,this._numberToString[w]=C}}encode(d){return this._stringToNumber[d]}decode(d){return this._numberToString[d]}}class Tf{constructor(d,w,C,z,j){this.type="Feature",this._vectorTileFeature=d,d._z=w,d._x=C,d._y=z,this.properties=d.properties,this.id=j}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(d){this._geometry=d}toJSON(){const d={geometry:this.geometry};for(const w in this)w!=="_geometry"&&w!=="_vectorTileFeature"&&(d[w]=this[w]);return d}}var n0=Gt([{name:"a_pos",type:"Int16",components:2}]);const dn=32,Bn=33,Ma=new Uint16Array(8184);for(let b=0;b<2046;b++){let d=b+2,w=0,C=0,z=0,j=0,H=0,ee=0;for(1&d?z=j=H=dn:w=C=ee=dn;(d>>=1)>1;){const he=w+z>>1,be=C+j>>1;1&d?(z=w,j=C,w=H,C=ee):(w=z,C=j,z=H,j=ee),H=he,ee=be}const ae=4*b;Ma[ae+0]=w,Ma[ae+1]=C,Ma[ae+2]=z,Ma[ae+3]=j}const On=new Uint16Array(2178),Ta=new Uint8Array(1089),kh=new Uint16Array(1089);function Af(b){return b===0?-.03125:b===32?.03125:0}var Nu=Gt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Cf={type:2,extent:ji,loadGeometry:()=>[[new k(0,0),new k(8193,0),new k(8193,8193),new k(0,8193),new k(0,0)]]};class If{constructor(d,w,C,z,j){this.tileID=d,this.uid=de(),this.uses=0,this.tileSize=w,this.tileZoom=C,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=j,this.expiredRequestCount=0,this.state="loading",z&&z.transform&&(this.projection=z.transform.projection)}registerFadeDuration(d){const w=d+this.timeAdded;w<Je.now()||this.fadeEndTime&&w<this.fadeEndTime||(this.fadeEndTime=w)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ih(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(d,w,C){if(this.unloadVectorData(),this.state="loaded",d){d.featureIndex&&(this.latestFeatureIndex=d.featureIndex,d.rawTileData?(this.latestRawTileData=d.rawTileData,this.latestFeatureIndex.rawTileData=d.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=d.collisionBoxArray,this.buckets=function(z,j){const H={};if(!j)return H;for(const ee of z){const ae=ee.layerIds.map(he=>j.getLayer(he)).filter(Boolean);if(ae.length!==0){ee.layers=ae,ee.stateDependentLayerIds&&(ee.stateDependentLayers=ee.stateDependentLayerIds.map(he=>ae.filter(be=>be.id===he)[0]));for(const he of ae)H[he.id]=ee}}return H}(d.buckets,w.style),this.hasSymbolBuckets=!1;for(const z in this.buckets){const j=this.buckets[z];if(j instanceof Sa){if(this.hasSymbolBuckets=!0,!C)break;j.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const z in this.buckets){const j=this.buckets[z];if(j instanceof Sa&&j.hasRTLText){this.hasRTLText=!0,Fe.isLoading()||Fe.isLoaded()||Ce()!=="deferred"||Oe();break}}this.queryPadding=0;for(const z in this.buckets){const j=this.buckets[z];this.queryPadding=Math.max(this.queryPadding,w.style.getLayer(z).queryRadius(j))}d.imageAtlas&&(this.imageAtlas=d.imageAtlas),d.glyphAtlasImage&&(this.glyphAtlasImage=d.glyphAtlasImage),d.lineAtlas&&(this.lineAtlas=d.lineAtlas)}else this.collisionBoxArray=new $r}unloadVectorData(){if(this.hasData()){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(d){return this.buckets[d.id]}upload(d){for(const C in this.buckets){const z=this.buckets[C];z.uploadPending()&&z.upload(d)}const w=d.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ch(d,this.imageAtlas.image,w.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ch(d,this.glyphAtlasImage,w.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ch(d,this.lineAtlas.image,w.ALPHA),this.lineAtlas.uploaded=!0)}prepare(d){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(d,this.imageAtlasTexture)}queryRenderedFeatures(d,w,C,z,j,H,ee,ae){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:z,pixelPosMatrix:ee,transform:H,params:j,tileTransform:this.tileTransform},d,w,C):{}}querySourceFeatures(d,w){const C=this.latestFeatureIndex;if(!C||!C.rawTileData)return;const z=C.loadVTLayers(),j=w?w.sourceLayer:"",H=z._geojsonTileLayer||z[j];if(!H)return;const ee=Fa(w&&w.filter),{z:ae,x:he,y:be}=this.tileID.canonical,Te={z:ae,x:he,y:be};for(let Re=0;Re<H.length;Re++){const $e=H.feature(Re);if(ee.needGeometry){const dt=eo($e,!0);if(!ee.filter(new Ue(this.tileID.overscaledZ),dt,this.tileID.canonical))continue}else if(!ee.filter(new Ue(this.tileID.overscaledZ),$e))continue;const qe=C.getId($e,j),rt=new Tf($e,ae,he,be,qe);rt.tile=Te,d.push(rt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(d){const w=this.expirationTime;if(d.cacheControl){const C=ze(d.cacheControl);C["max-age"]&&(this.expirationTime=Date.now()+1e3*C["max-age"])}else d.expires&&(this.expirationTime=new Date(d.expires).getTime());if(this.expirationTime){const C=Date.now();let z=!1;if(this.expirationTime>C)z=!1;else if(w)if(this.expirationTime<w)z=!0;else{const j=this.expirationTime-w;j?this.expirationTime=C+Math.max(j,3e4):z=!0}else z=!0;z?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(d,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(d).length===0||!w)return;const C=this.latestFeatureIndex.loadVTLayers(),z=w.style.listImages();for(const j in this.buckets){if(!w.style.hasLayer(j))continue;const H=this.buckets[j],ee=H.layers[0].sourceLayer||"_geojsonTileLayer",ae=C[ee],he=d[ee];if(!ae||!he||Object.keys(he).length===0)continue;if(H.update(he,ae,z,this.imageAtlas&&this.imageAtlas.patternPositions||{}),H instanceof _h||H instanceof gh){const Te=w.style._getSourceCache(H.layers[0].source);w._terrain&&w._terrain.enabled&&Te&&H.programConfigurations.needsUpload&&w._terrain._clearRenderCacheForTile(Te.id,this.tileID)}const be=w&&w.style&&w.style.getLayer(j);be&&(this.queryPadding=Math.max(this.queryPadding,be.queryRadius(H)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Je.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(d){this.symbolFadeHoldUntil=Je.now()+d}setDependencies(d,w){const C={};for(const z of w)C[z]=!0;this.dependencies[d]=C}hasDependency(d,w){for(const C of d){const z=this.dependencies[C];if(z){for(const j of w)if(z[j])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(d,w){if(!w||w.name==="mercator"||this._tileDebugBuffer)return;const C=Kn(Cf,this.tileID.canonical,this.tileTransform)[0],z=new Ei,j=new Ar;for(let H=0;H<C.length;H++){const{x:ee,y:ae}=C[H];z.emplaceBack(ee,ae),j.emplaceBack(H)}j.emplaceBack(0),this._tileDebugIndexBuffer=d.createIndexBuffer(j),this._tileDebugBuffer=d.createVertexBuffer(z,Nu.members),this._tileDebugSegments=Cr.simpleSegment(0,0,z.length,j.length)}_makeTileBoundsBuffers(d,w){if(this._tileBoundsBuffer||!w||w.name==="mercator")return;const C=Kn(Cf,this.tileID.canonical,this.tileTransform)[0];let z,j;if(this.isRaster){const H=function(ee,ae){const he=Ih(ee,ae),be=Math.pow(2,ee.z);for(let dt=0;dt<Bn;dt++)for(let yt=0;yt<Bn;yt++){const Mt=Qa((ee.x+(yt+Af(yt))/dn)/be),Pt=Pn((ee.y+(dt+Af(dt))/dn)/be),Ot=ae.project(Mt,Pt),Lt=dt*Bn+yt;On[2*Lt+0]=Math.round((Ot.x*he.scale-he.x)*ji),On[2*Lt+1]=Math.round((Ot.y*he.scale-he.y)*ji)}Ta.fill(0),kh.fill(0);for(let dt=2045;dt>=0;dt--){const yt=4*dt,Mt=Ma[yt+0],Pt=Ma[yt+1],Ot=Ma[yt+2],Lt=Ma[yt+3],Ft=Mt+Ot>>1,ei=Pt+Lt>>1,Xt=Ft+ei-Pt,yi=ei+Mt-Ft,oi=Pt*Bn+Mt,ti=Lt*Bn+Ot,si=ei*Bn+Ft,ui=Math.hypot((On[2*oi+0]+On[2*ti+0])/2-On[2*si+0],(On[2*oi+1]+On[2*ti+1])/2-On[2*si+1])>=16;if(Ta[si]=Ta[si]||(ui?1:0),dt<1022){const ni=(Pt+yi>>1)*Bn+(Mt+Xt>>1),vi=(Lt+yi>>1)*Bn+(Ot+Xt>>1);Ta[si]=Ta[si]||Ta[ni]||Ta[vi]}}const Te=new Ai,Re=new _r;let $e=0;function qe(dt,yt){const Mt=yt*Bn+dt;return kh[Mt]===0&&(Te.emplaceBack(On[2*Mt+0],On[2*Mt+1],dt*ji/dn,yt*ji/dn),kh[Mt]=++$e),kh[Mt]-1}function rt(dt,yt,Mt,Pt,Ot,Lt){const Ft=dt+Mt>>1,ei=yt+Pt>>1;if(Math.abs(dt-Ot)+Math.abs(yt-Lt)>1&&Ta[ei*Bn+Ft])rt(Ot,Lt,dt,yt,Ft,ei),rt(Mt,Pt,Ot,Lt,Ft,ei);else{const Xt=qe(dt,yt),yi=qe(Mt,Pt),oi=qe(Ot,Lt);Re.emplaceBack(Xt,yi,oi)}}return rt(0,0,dn,dn,dn,0),rt(dn,dn,0,0,0,dn),{vertices:Te,indices:Re}}(this.tileID.canonical,w);z=H.vertices,j=H.indices}else{z=new Ai,j=new _r;for(const{x:ee,y:ae}of C)z.emplaceBack(ee,ae,0,0);const H=ch(z.int16,void 0,4);for(let ee=0;ee<H.length;ee+=3)j.emplaceBack(H[ee],H[ee+1],H[ee+2])}this._tileBoundsBuffer=d.createVertexBuffer(z,Nu.members),this._tileBoundsIndexBuffer=d.createIndexBuffer(j),this._tileBoundsSegments=Cr.simpleSegment(0,0,z.length,j.length)}}class a0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(d,w,C){const z=String(w);if(this.stateChanges[d]=this.stateChanges[d]||{},this.stateChanges[d][z]=this.stateChanges[d][z]||{},te(this.stateChanges[d][z],C),this.deletedStates[d]===null){this.deletedStates[d]={};for(const j in this.state[d])j!==z&&(this.deletedStates[d][j]=null)}else if(this.deletedStates[d]&&this.deletedStates[d][z]===null){this.deletedStates[d][z]={};for(const j in this.state[d][z])C[j]||(this.deletedStates[d][z][j]=null)}else for(const j in C)this.deletedStates[d]&&this.deletedStates[d][z]&&this.deletedStates[d][z][j]===null&&delete this.deletedStates[d][z][j]}removeFeatureState(d,w,C){if(this.deletedStates[d]===null)return;const z=String(w);if(this.deletedStates[d]=this.deletedStates[d]||{},C&&w!==void 0)this.deletedStates[d][z]!==null&&(this.deletedStates[d][z]=this.deletedStates[d][z]||{},this.deletedStates[d][z][C]=null);else if(w!==void 0)if(this.stateChanges[d]&&this.stateChanges[d][z])for(C in this.deletedStates[d][z]={},this.stateChanges[d][z])this.deletedStates[d][z][C]=null;else this.deletedStates[d][z]=null;else this.deletedStates[d]=null}getState(d,w){const C=String(w),z=te({},(this.state[d]||{})[C],(this.stateChanges[d]||{})[C]);if(this.deletedStates[d]===null)return{};if(this.deletedStates[d]){const j=this.deletedStates[d][w];if(j===null)return{};for(const H in j)delete z[H]}return z}initializeTileState(d,w){d.setFeatureState(this.state,w)}coalesceChanges(d,w){const C={};for(const z in this.stateChanges){this.state[z]=this.state[z]||{};const j={};for(const H in this.stateChanges[z])this.state[z][H]||(this.state[z][H]={}),te(this.state[z][H],this.stateChanges[z][H]),j[H]=this.state[z][H];C[z]=j}for(const z in this.deletedStates){this.state[z]=this.state[z]||{};const j={};if(this.deletedStates[z]===null)for(const H in this.state[z])j[H]={},this.state[z][H]={};else for(const H in this.deletedStates[z]){if(this.deletedStates[z][H]===null)this.state[z][H]={};else for(const ee of Object.keys(this.deletedStates[z][H]))delete this.state[z][H][ee];j[H]=this.state[z][H]}C[z]=C[z]||{},te(C[z],j)}if(this.stateChanges={},this.deletedStates={},Object.keys(C).length!==0)for(const z in d)d[z].setFeatureState(C,w)}}class kf{constructor(d){this.size=d,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(d,w){const C=this.toIdx(d,w);return{min:this.minimums[C],max:this.maximums[C]}}isLeaf(d,w){return this.leaves[this.toIdx(d,w)]}toIdx(d,w){return w*this.size+d}}function Df(b,d,w,C){let z=0,j=Number.MAX_VALUE;for(let H=0;H<3;H++)if(Math.abs(C[H])<1e-15){if(w[H]<b[H]||w[H]>d[H])return null}else{const ee=1/C[H];let ae=(b[H]-w[H])*ee,he=(d[H]-w[H])*ee;if(ae>he){const be=ae;ae=he,he=be}if(ae>z&&(z=ae),he<j&&(j=he),z>j)return null}return z}function Rf(b,d,w,C,z,j,H,ee,ae,he,be){const Te=C-b,Re=z-d,$e=j-w,qe=H-b,rt=ee-d,dt=ae-w,yt=be[1]*dt-be[2]*rt,Mt=be[2]*qe-be[0]*dt,Pt=be[0]*rt-be[1]*qe,Ot=Te*yt+Re*Mt+$e*Pt;if(Math.abs(Ot)<1e-15)return null;const Lt=1/Ot,Ft=he[0]-b,ei=he[1]-d,Xt=he[2]-w,yi=(Ft*yt+ei*Mt+Xt*Pt)*Lt;if(yi<0||yi>1)return null;const oi=ei*$e-Xt*Re,ti=Xt*Te-Ft*$e,si=Ft*Re-ei*Te,ui=(be[0]*oi+be[1]*ti+be[2]*si)*Lt;return ui<0||yi+ui>1?null:(qe*oi+rt*ti+dt*si)*Lt}function Pf(b,d,w){return(b-d)/(w-d)}function Lf(b,d,w,C,z,j,H,ee,ae){const he=1<<w,be=j-C,Te=H-z,Re=(b+1)/he*be+C,$e=(d+0)/he*Te+z,qe=(d+1)/he*Te+z;ee[0]=(b+0)/he*be+C,ee[1]=$e,ae[0]=Re,ae[1]=qe}class Bf{constructor(d){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=d,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const w=function(j){const H=Math.ceil(Math.log2(j.dim/8)),ee=[];let ae=Math.ceil(Math.pow(2,H));const he=1/ae,be=($e,qe,rt,dt,yt)=>{const Mt=dt?1:0,Pt=($e+1)*rt-Mt,Ot=qe*rt,Lt=(qe+1)*rt-Mt;yt[0]=$e*rt,yt[1]=Ot,yt[2]=Pt,yt[3]=Lt};let Te=new kf(ae);const Re=[];for(let $e=0;$e<ae*ae;$e++){be($e%ae,Math.floor($e/ae),he,!1,Re);const qe=Aa(Re[0],Re[1],j),rt=Aa(Re[2],Re[1],j),dt=Aa(Re[2],Re[3],j),yt=Aa(Re[0],Re[3],j);Te.minimums.push(Math.min(qe,rt,dt,yt)),Te.maximums.push(Math.max(qe,rt,dt,yt)),Te.leaves.push(1)}for(ee.push(Te),ae/=2;ae>=1;ae/=2){const $e=ee[ee.length-1];Te=new kf(ae);for(let qe=0;qe<ae*ae;qe++){be(qe%ae,Math.floor(qe/ae),2,!0,Re);const rt=$e.getElevation(Re[0],Re[1]),dt=$e.getElevation(Re[2],Re[1]),yt=$e.getElevation(Re[2],Re[3]),Mt=$e.getElevation(Re[0],Re[3]),Pt=$e.isLeaf(Re[0],Re[1]),Ot=$e.isLeaf(Re[2],Re[1]),Lt=$e.isLeaf(Re[2],Re[3]),Ft=$e.isLeaf(Re[0],Re[3]),ei=Math.min(rt.min,dt.min,yt.min,Mt.min),Xt=Math.max(rt.max,dt.max,yt.max,Mt.max),yi=Pt&&Ot&&Lt&&Ft;Te.maximums.push(Xt),Te.minimums.push(ei),Te.leaves.push(Xt-ei<=5&&yi?1:0)}ee.push(Te)}return ee}(this.dem),C=w.length-1,z=w[C];this._addNode(z.minimums[0],z.maximums[0],z.leaves[0]),this._construct(w,0,0,C,0)}raycastRoot(d,w,C,z,j,H,ee=1){return Df([d,w,-100],[C,z,this.maximums[0]*ee],j,H)}raycast(d,w,C,z,j,H,ee=1){if(!this.nodeCount)return null;const ae=this.raycastRoot(d,w,C,z,j,H,ee);if(ae==null)return null;const he=[],be=[],Te=[],Re=[],$e=[{idx:0,t:ae,nodex:0,nodey:0,depth:0}];for(;$e.length>0;){const{idx:qe,t:rt,nodex:dt,nodey:yt,depth:Mt}=$e.pop();if(this.leaves[qe]){Lf(dt,yt,Mt,d,w,C,z,Te,Re);const Ot=1<<Mt,Lt=(dt+0)/Ot,Ft=(dt+1)/Ot,ei=(yt+0)/Ot,Xt=(yt+1)/Ot,yi=Aa(Lt,ei,this.dem)*ee,oi=Aa(Ft,ei,this.dem)*ee,ti=Aa(Ft,Xt,this.dem)*ee,si=Aa(Lt,Xt,this.dem)*ee,ui=Rf(Te[0],Te[1],yi,Re[0],Te[1],oi,Re[0],Re[1],ti,j,H),ni=Rf(Re[0],Re[1],ti,Te[0],Re[1],si,Te[0],Te[1],yi,j,H),vi=Math.min(ui!==null?ui:Number.MAX_VALUE,ni!==null?ni:Number.MAX_VALUE);if(vi!==Number.MAX_VALUE)return vi;{const bi=vc([],j,H,rt);if(Of(yi,oi,si,ti,Pf(bi[0],Te[0],Re[0]),Pf(bi[1],Te[1],Re[1]))>=bi[2])return rt}continue}let Pt=0;for(let Ot=0;Ot<this._siblingOffset.length;Ot++){Lf((dt<<1)+this._siblingOffset[Ot][0],(yt<<1)+this._siblingOffset[Ot][1],Mt+1,d,w,C,z,Te,Re),Te[2]=-100,Re[2]=this.maximums[this.childOffsets[qe]+Ot]*ee;const Lt=Df(Te,Re,j,H);if(Lt!=null){const Ft=Lt;he[Ot]=Ft;let ei=!1;for(let Xt=0;Xt<Pt&&!ei;Xt++)Ft>=he[be[Xt]]&&(be.splice(Xt,0,Ot),ei=!0);ei||(be[Pt]=Ot),Pt++}}for(let Ot=0;Ot<Pt;Ot++){const Lt=be[Ot];$e.push({idx:this.childOffsets[qe]+Lt,t:he[Lt],nodex:(dt<<1)+this._siblingOffset[Lt][0],nodey:(yt<<1)+this._siblingOffset[Lt][1],depth:Mt+1})}}return null}_addNode(d,w,C){return this.minimums.push(d),this.maximums.push(w),this.leaves.push(C),this.childOffsets.push(0),this.nodeCount++}_construct(d,w,C,z,j){if(d[z].isLeaf(w,C)===1)return;this.childOffsets[j]||(this.childOffsets[j]=this.nodeCount);const H=z-1,ee=d[H];let ae,he=0;for(let be=0;be<this._siblingOffset.length;be++){const Te=2*w+this._siblingOffset[be][0],Re=2*C+this._siblingOffset[be][1],$e=ee.getElevation(Te,Re),qe=ee.isLeaf(Te,Re),rt=this._addNode($e.min,$e.max,qe);qe&&(he|=1<<be),ae||(ae=rt)}for(let be=0;be<this._siblingOffset.length;be++)he&1<<be||this._construct(d,2*w+this._siblingOffset[be][0],2*C+this._siblingOffset[be][1],H,ae+be)}}function Of(b,d,w,C,z,j){return Vi(Vi(b,w,j),Vi(d,C,j),z)}function Aa(b,d,w){const C=w.dim,z=Y(b*C-.5,0,C-1),j=Y(d*C-.5,0,C-1),H=Math.floor(z),ee=Math.floor(j),ae=Math.min(H+1,C-1),he=Math.min(ee+1,C-1);return Of(w.get(H,ee),w.get(ae,ee),w.get(H,he),w.get(ae,he),z-H,j-ee)}const Ff={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Dh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(d,w,C,z=!1,j=!1){if(this.uid=d,w.height!==w.width)throw new RangeError("DEM tiles must be square");if(C&&C!=="mapbox"&&C!=="terrarium")return je(`"${C}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=w.height;const H=this.dim=w.height-2;if(this.data=new Uint32Array(w.data.buffer),this.encoding=C||"mapbox",this.borderReady=z,!z){for(let ee=0;ee<H;ee++)this.data[this._idx(-1,ee)]=this.data[this._idx(0,ee)],this.data[this._idx(H,ee)]=this.data[this._idx(H-1,ee)],this.data[this._idx(ee,-1)]=this.data[this._idx(ee,0)],this.data[this._idx(ee,H)]=this.data[this._idx(ee,H-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(H,-1)]=this.data[this._idx(H-1,0)],this.data[this._idx(-1,H)]=this.data[this._idx(0,H-1)],this.data[this._idx(H,H)]=this.data[this._idx(H-1,H-1)],j&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Bf(this)}get(d,w,C=!1){const z=new Uint8Array(this.data.buffer);C&&(d=Y(d,-1,this.dim),w=Y(w,-1,this.dim));const j=4*this._idx(d,w);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(z[j],z[j+1],z[j+2])}static getUnpackVector(d){return Ff[d]}get unpackVector(){return Ff[this.encoding]}_idx(d,w){if(d<-1||d>=this.dim+1||w<-1||w>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(w+1)*this.stride+(d+1)}_unpackMapbox(d,w,C){return(256*d*256+256*w+C)/10-1e4}_unpackTerrarium(d,w,C){return 256*d+w+C/256-32768}static pack(d,w){const C=[0,0,0,0],z=Dh.getUnpackVector(w);let j=Math.floor((d+z[3])/z[2]);return C[2]=j%256,j=Math.floor(j/256),C[1]=j%256,j=Math.floor(j/256),C[0]=j,C}getPixels(){return new on({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(d,w,C){if(this.dim!==d.dim)throw new Error("dem dimension mismatch");let z=w*this.dim,j=w*this.dim+this.dim,H=C*this.dim,ee=C*this.dim+this.dim;switch(w){case-1:z=j-1;break;case 1:j=z+1}switch(C){case-1:H=ee-1;break;case 1:ee=H+1}const ae=-w*this.dim,he=-C*this.dim;for(let be=H;be<ee;be++)for(let Te=z;Te<j;Te++)this.data[this._idx(Te,be)]=d.data[this._idx(Te+ae,be+he)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}wi("DEMData",Dh),wi("DemMinMaxQuadTree",Bf,{omit:["dem"]});class o0{constructor(d,w){this.max=d,this.onRemove=w,this.reset()}reset(){for(const d in this.data)for(const w of this.data[d])w.timeout&&clearTimeout(w.timeout),this.onRemove(w.value);return this.data={},this.order=[],this}add(d,w,C){const z=d.wrapped().key;this.data[z]===void 0&&(this.data[z]=[]);const j={value:w,timeout:void 0};if(C!==void 0&&(j.timeout=setTimeout(()=>{this.remove(d,j)},C)),this.data[z].push(j),this.order.push(z),this.order.length>this.max){const H=this._getAndRemoveByKey(this.order[0]);H&&this.onRemove(H)}return this}has(d){return d.wrapped().key in this.data}getAndRemove(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null}_getAndRemoveByKey(d){const w=this.data[d].shift();return w.timeout&&clearTimeout(w.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),w.value}getByKey(d){const w=this.data[d];return w?w[0].value:null}get(d){return this.has(d)?this.data[d.wrapped().key][0].value:null}remove(d,w){if(!this.has(d))return this;const C=d.wrapped().key,z=w===void 0?0:this.data[C].indexOf(w),j=this.data[C][z];return this.data[C].splice(z,1),j.timeout&&clearTimeout(j.timeout),this.data[C].length===0&&delete this.data[C],this.onRemove(j.value),this.order.splice(this.order.indexOf(C),1),this}setMaxSize(d){for(this.max=d;this.order.length>this.max;){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}filter(d){const w=[];for(const C in this.data)for(const z of this.data[C])d(z.value)||w.push(z);for(const C of w)this.remove(C.value.tileID,C)}}class rs{constructor(d,w,C){this.func=d,this.mask=w,this.range=C}}rs.ReadOnly=!1,rs.ReadWrite=!0,rs.disabled=new rs(519,rs.ReadOnly,[0,1]);const Uu=7680;class $u{constructor(d,w,C,z,j,H){this.test=d,this.ref=w,this.mask=C,this.fail=z,this.depthFail=j,this.pass=H}}$u.disabled=new $u({func:519,mask:0},0,0,Uu,Uu,Uu);class Fn{constructor(d,w,C){this.blendFunction=d,this.blendColor=w,this.mask=C}}Fn.Replace=[1,0],Fn.disabled=new Fn(Fn.Replace,Gi.transparent,[!1,!1,!1,!1]),Fn.unblended=new Fn(Fn.Replace,Gi.transparent,[!0,!0,!0,!0]),Fn.alphaBlended=new Fn([1,771],Gi.transparent,[!0,!0,!0,!0]);const ju=1029,Gu=2305;class vn{constructor(d,w,C){this.enable=d,this.mode=w,this.frontFace=C}}vn.disabled=new vn(!1,ju,Gu),vn.backCCW=new vn(!0,ju,Gu),vn.backCW=new vn(!0,ju,2304),vn.frontCW=new vn(!0,1028,2304),vn.frontCCW=new vn(!0,1028,Gu);class io extends ai{constructor(d,w,C){super(),this.id=d,this._onlySymbols=C,w.on("data",z=>{z.dataType==="source"&&z.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&z.dataType==="source"&&z.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),w.on("error",()=>{this._sourceErrored=!0}),this._source=w,this._tiles={},this._cache=new o0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new a0}onAdd(d){this.map=d,this._maxTileCacheSize=d?d._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const d in this._tiles){const w=this._tiles[d];if(w.state!=="loaded"&&w.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(d,w){return d.isSymbolTile=this._onlySymbols,this._source.loadTile(d,w)}_unloadTile(d){if(this._source.unloadTile)return this._source.unloadTile(d,()=>{})}_abortTile(d){if(this._source.abortTile)return this._source.abortTile(d,()=>{})}serialize(){return this._source.serialize()}prepare(d){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const w in this._tiles){const C=this._tiles[w];C.upload(d),C.prepare(this.map.style.imageManager)}}getIds(){return q(this._tiles).map(d=>d.tileID).sort(zf).map(d=>d.key)}getRenderableIds(d){const w=[];for(const C in this._tiles)this._isIdRenderable(+C,d)&&w.push(this._tiles[C]);return d?w.sort((C,z)=>{const j=C.tileID,H=z.tileID,ee=new k(j.canonical.x,j.canonical.y)._rotate(this.transform.angle),ae=new k(H.canonical.x,H.canonical.y)._rotate(this.transform.angle);return j.overscaledZ-H.overscaledZ||ae.y-ee.y||ae.x-ee.x}).map(C=>C.tileID.key):w.map(C=>C.tileID).sort(zf).map(C=>C.key)}hasRenderableParent(d){const w=this.findLoadedParent(d,0);return!!w&&this._isIdRenderable(w.tileID.key)}_isIdRenderable(d,w){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(w||!this._tiles[d].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(+d,"reloading")}}_reloadTile(d,w){const C=this._tiles[d];C&&(C.state!=="loading"&&(C.state=w),this._loadTile(C,this._tileLoaded.bind(this,C,d,w)))}_tileLoaded(d,w,C,z){if(z)return d.state="errored",void(z.status!==404?this._source.fire(new _i(z,{tile:d})):this.update(this.transform));d.timeAdded=Je.now(),C==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(w,d),this.getSource().type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null),this._source.fire(new Ht("data",{dataType:"source",tile:d,coord:d.tileID,sourceCacheId:this.id}))}_backfillDEM(d){const w=this.getRenderableIds();for(let z=0;z<w.length;z++){const j=w[z];if(d.neighboringTiles&&d.neighboringTiles[j]){const H=this.getTileByID(j);C(d,H),C(H,d)}}function C(z,j){if(!z.dem||z.dem.borderReady)return;z.needsHillshadePrepare=!0,z.needsDEMTextureUpload=!0;let H=j.tileID.canonical.x-z.tileID.canonical.x;const ee=j.tileID.canonical.y-z.tileID.canonical.y,ae=Math.pow(2,z.tileID.canonical.z),he=j.tileID.key;H===0&&ee===0||Math.abs(ee)>1||(Math.abs(H)>1&&(Math.abs(H+ae)===1?H+=ae:Math.abs(H-ae)===1&&(H-=ae)),j.dem&&z.dem&&(z.dem.backfillBorder(j.dem,H,ee),z.neighboringTiles&&z.neighboringTiles[he]&&(z.neighboringTiles[he].backfilled=!0)))}}getTile(d){return this.getTileByID(d.key)}getTileByID(d){return this._tiles[d]}_retainLoadedChildren(d,w,C,z){for(const j in this._tiles){let H=this._tiles[j];if(z[j]||!H.hasData()||H.tileID.overscaledZ<=w||H.tileID.overscaledZ>C)continue;let ee=H.tileID;for(;H&&H.tileID.overscaledZ>w+1;){const he=H.tileID.scaledTo(H.tileID.overscaledZ-1);H=this._tiles[he.key],H&&H.hasData()&&(ee=he)}let ae=ee;for(;ae.overscaledZ>w;)if(ae=ae.scaledTo(ae.overscaledZ-1),d[ae.key]){z[ee.key]=ee;break}}}findLoadedParent(d,w){if(d.key in this._loadedParentTiles){const C=this._loadedParentTiles[d.key];return C&&C.tileID.overscaledZ>=w?C:null}for(let C=d.overscaledZ-1;C>=w;C--){const z=d.scaledTo(C),j=this._getLoadedTile(z);if(j)return j}}_getLoadedTile(d){const w=this._tiles[d.key];return w&&w.hasData()?w:this._cache.getByKey(this._source.reparseOverscaled?d.wrapped().key:d.canonical.key)}updateCacheSize(d,w){w=w||this._source.tileSize;const C=Math.ceil(d.width/w)+1,z=Math.ceil(d.height/w)+1,j=Math.floor(C*z*5),H=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,j):j;this._cache.setMaxSize(H)}handleWrapJump(d){const w=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,w){const C={};for(const z in this._tiles){const j=this._tiles[z];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+w),C[j.tileID.key]=j}this._tiles=C;for(const z in this._timers)clearTimeout(this._timers[z]),delete this._timers[z];for(const z in this._tiles)this._setTileReloadTimer(+z,this._tiles[z])}}update(d,w,C){if(this.transform=d,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!C)return;let z;this.updateCacheSize(d,w),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?z=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new Wr(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y)):(z=d.coveringTiles({tileSize:w||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!C,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(z=z.filter(ee=>this._source.hasTile(ee)))):z=[];const j=this._updateRetainedTiles(z);if(Nf(this._source.type)&&z.length!==0){const ee={},ae={},he=Object.keys(j);for(const Te of he){const Re=j[Te],$e=this._tiles[Te];if(!$e||$e.fadeEndTime&&$e.fadeEndTime<=Je.now())continue;const qe=this.findLoadedParent(Re,Math.max(Re.overscaledZ-io.maxOverzooming,this._source.minzoom));qe&&(this._addTile(qe.tileID),ee[qe.tileID.key]=qe.tileID),ae[Te]=Re}const be=z[z.length-1].overscaledZ;for(const Te in this._tiles){const Re=this._tiles[Te];if(j[Te]||!Re.hasData())continue;let $e=Re.tileID;for(;$e.overscaledZ>be;){$e=$e.scaledTo($e.overscaledZ-1);const qe=this._tiles[$e.key];if(qe&&qe.hasData()&&ae[$e.key]){j[Te]=Re.tileID;break}}}for(const Te in ee)j[Te]||(this._coveredTiles[Te]=!0,j[Te]=ee[Te])}for(const ee in j)this._tiles[ee].clearFadeHold();const H=function(ee,ae){const he=[];for(const be in ee)be in ae||he.push(be);return he}(this._tiles,j);for(const ee of H){const ae=this._tiles[ee];ae.hasSymbolBuckets&&!ae.holdingForFade()?ae.setHoldDuration(this.map._fadeDuration):ae.hasSymbolBuckets&&!ae.symbolFadeFinished()||this._removeTile(+ee)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(+d)}_updateRetainedTiles(d){const w={};if(d.length===0)return w;const C={},z=d.reduce((he,be)=>Math.min(he,be.overscaledZ),1/0),j=d[0].overscaledZ,H=Math.max(j-io.maxOverzooming,this._source.minzoom),ee=Math.max(j+io.maxUnderzooming,this._source.minzoom),ae={};for(const he of d){const be=this._addTile(he);w[he.key]=he,be.hasData()||z<this._source.maxzoom&&(ae[he.key]=he)}this._retainLoadedChildren(ae,z,ee,w);for(const he of d){let be=this._tiles[he.key];if(be.hasData())continue;if(he.canonical.z>=this._source.maxzoom){const Re=he.children(this._source.maxzoom)[0],$e=this.getTile(Re);if($e&&$e.hasData()){w[Re.key]=Re;continue}}else{const Re=he.children(this._source.maxzoom);if(w[Re[0].key]&&w[Re[1].key]&&w[Re[2].key]&&w[Re[3].key])continue}let Te=be.wasRequested();for(let Re=he.overscaledZ-1;Re>=H;--Re){const $e=he.scaledTo(Re);if(C[$e.key]||(C[$e.key]=!0,be=this.getTile($e),!be&&Te&&(be=this._addTile($e)),be&&(w[$e.key]=$e,Te=be.wasRequested(),be.hasData())))break}}return w}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const d in this._tiles){const w=[];let C,z=this._tiles[d].tileID;for(;z.overscaledZ>0;){if(z.key in this._loadedParentTiles){C=this._loadedParentTiles[z.key];break}w.push(z.key);const j=z.scaledTo(z.overscaledZ-1);if(C=this._getLoadedTile(j),C)break;z=j}for(const j of w)this._loadedParentTiles[j]=C}}_addTile(d){let w=this._tiles[d.key];if(w)return w;w=this._cache.getAndRemove(d),w&&(this._setTileReloadTimer(d.key,w),w.tileID=d,this._state.initializeTileState(w,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,w)));const C=Boolean(w);if(!C){const z=this.map?this.map.painter:null;w=new If(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,z,this._source.type==="raster"||this._source.type==="raster-dem"),this._loadTile(w,this._tileLoaded.bind(this,w,d.key,w.state))}return w?(w.uses++,this._tiles[d.key]=w,C||this._source.fire(new Ht("dataloading",{tile:w,coord:w.tileID,dataType:"source"})),w):null}_setTileReloadTimer(d,w){d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);const C=w.getExpiryTimeout();C&&(this._timers[d]=setTimeout(()=>{this._reloadTile(d,"expired"),delete this._timers[d]},C))}_removeTile(d){const w=this._tiles[d];w&&(w.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),w.uses>0||(w.hasData()&&w.state!=="reloading"?this._cache.add(w.tileID,w,w.getExpiryTimeout()):(w.aborted=!0,this._abortTile(w),this._unloadTile(w))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const d in this._tiles)this._removeTile(+d);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(d,w,C){const z=[],j=this.transform;if(!j)return z;for(const H in this._tiles){const ee=this._tiles[H];if(C&&ee.clearQueryDebugViz(),ee.holdingForFade())continue;const ae=d.containsTile(ee,j,w);ae&&z.push(ae)}return z}getVisibleCoordinates(d){const w=this.getRenderableIds(d).map(C=>this._tiles[C].tileID);for(const C of w)C.projMatrix=this.transform.calculateProjMatrix(C.toUnwrapped());return w}hasTransition(){if(this._source.hasTransition())return!0;if(Nf(this._source.type))for(const d in this._tiles){const w=this._tiles[d];if(w.fadeEndTime!==void 0&&w.fadeEndTime>=Je.now())return!0}return!1}setFeatureState(d,w,C){this._state.updateState(d=d||"_geojsonTileLayer",w,C)}removeFeatureState(d,w,C){this._state.removeFeatureState(d=d||"_geojsonTileLayer",w,C)}getFeatureState(d,w){return this._state.getState(d=d||"_geojsonTileLayer",w)}setDependencies(d,w,C){const z=this._tiles[d];z&&z.setDependencies(w,C)}reloadTilesForDependencies(d,w){for(const C in this._tiles)this._tiles[C].hasDependency(d,w)&&this._reloadTile(+C,"reloading");this._cache.filter(C=>!C.hasDependency(d,w))}}function zf(b,d){const w=Math.abs(2*b.wrap)-+(b.wrap<0),C=Math.abs(2*d.wrap)-+(d.wrap<0);return b.overscaledZ-d.overscaledZ||C-w||d.canonical.y-b.canonical.y||d.canonical.x-b.canonical.x}function Nf(b){return b==="raster"||b==="image"||b==="video"}io.maxOverzooming=10,io.maxUnderzooming=3;class Rh{constructor(d,w,C){this._demTile=d,this._dem=this._demTile.dem,this._scale=w,this._offset=C}static create(d,w,C){const z=C||d.findDEMTileFor(w);if(!z||!z.dem)return;const j=z.dem,H=z.tileID,ee=1<<w.canonical.z-H.canonical.z;return new Rh(z,z.tileSize/ji/ee,[(w.canonical.x/ee-H.canonical.x)*j.dim,(w.canonical.y/ee-H.canonical.y)*j.dim])}tileCoordToPixel(d,w){const C=w*this._scale+this._offset[1],z=Math.floor(d*this._scale+this._offset[0]),j=Math.floor(C);return new k(z,j)}getElevationAt(d,w,C,z){const j=d*this._scale+this._offset[0],H=w*this._scale+this._offset[1],ee=Math.floor(j),ae=Math.floor(H),he=this._dem;return z=!!z,C?Vi(Vi(he.get(ee,ae,z),he.get(ee,ae+1,z),H-ae),Vi(he.get(ee+1,ae,z),he.get(ee+1,ae+1,z),H-ae),j-ee):he.get(ee,ae,z)}getElevationAtPixel(d,w,C){return this._dem.get(d,w,!!C)}getMeterToDEM(d){return(1<<this._demTile.tileID.canonical.z)*iu(1,d)*this._dem.stride}}class Uf{constructor(d,w){this.tileID=d,this.x=d.canonical.x,this.y=d.canonical.y,this.z=d.canonical.z,this.grid=new da(ji,16,0),this.featureIndexArray=new Xu,this.promoteId=w}insert(d,w,C,z,j,H=0){const ee=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,z,j,H);const ae=this.grid;for(let he=0;he<w.length;he++){const be=w[he],Te=[1/0,1/0,-1/0,-1/0];for(let Re=0;Re<be.length;Re++){const $e=be[Re];Te[0]=Math.min(Te[0],$e.x),Te[1]=Math.min(Te[1],$e.y),Te[2]=Math.max(Te[2],$e.x),Te[3]=Math.max(Te[3],$e.y)}Te[0]<ji&&Te[1]<ji&&Te[2]>=0&&Te[3]>=0&&ae.insert(ee,Te[0],Te[1],Te[2],Te[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new to.VectorTile(new tl(this.rawTileData)).layers,this.sourceLayerCoder=new Mf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const d in this.vtLayers)this.vtFeatures[d]=[]}return this.vtLayers}query(d,w,C,z){this.loadVTLayers();const j=d.params||{},H=Fa(j.filter),ee=d.tileResult,ae=d.transform,he=ee.bufferedTilespaceBounds,be=this.grid.query(he.min.x,he.min.y,he.max.x,he.max.y,(qe,rt,dt,yt)=>cc(ee.bufferedTilespaceGeometry,qe,rt,dt,yt));be.sort(s0);let Te=null;ae.elevation&&be.length>0&&(Te=Rh.create(ae.elevation,this.tileID));const Re={};let $e;for(let qe=0;qe<be.length;qe++){const rt=be[qe];if(rt===$e)continue;$e=rt;const dt=this.featureIndexArray.get(rt);let yt=null;this.loadMatchingFeature(Re,dt,H,j.layers,j.availableImages,w,C,z,(Mt,Pt,Ot,Lt=0)=>(yt||(yt=Kn(Mt,this.tileID.canonical,d.tileTransform)),Pt.queryIntersectsFeature(ee,Mt,Ot,yt,this.z,d.transform,d.pixelPosMatrix,Te,Lt)))}return Re}loadMatchingFeature(d,w,C,z,j,H,ee,ae,he){const{featureIndex:be,bucketIndex:Te,sourceLayerIndex:Re,layoutVertexArrayOffset:$e}=w,qe=this.bucketLayerIDs[Te];if(z&&!function(Mt,Pt){for(let Ot=0;Ot<Mt.length;Ot++)if(Pt.indexOf(Mt[Ot])>=0)return!0;return!1}(z,qe))return;const rt=this.sourceLayerCoder.decode(Re),dt=this.vtLayers[rt].feature(be);if(C.needGeometry){const Mt=eo(dt,!0);if(!C.filter(new Ue(this.tileID.overscaledZ),Mt,this.tileID.canonical))return}else if(!C.filter(new Ue(this.tileID.overscaledZ),dt))return;const yt=this.getId(dt,rt);for(let Mt=0;Mt<qe.length;Mt++){const Pt=qe[Mt];if(z&&z.indexOf(Pt)<0)continue;const Ot=H[Pt];if(!Ot)continue;let Lt={};yt!==void 0&&ae&&(Lt=ae.getState(Ot.sourceLayer||"_geojsonTileLayer",yt));const Ft=te({},ee[Pt]);Ft.paint=$f(Ft.paint,Ot.paint,dt,Lt,j),Ft.layout=$f(Ft.layout,Ot.layout,dt,Lt,j);const ei=!he||he(dt,Ot,Lt,$e);if(!ei)continue;const Xt=new Tf(dt,this.z,this.x,this.y,yt);Xt.layer=Ft;let yi=d[Pt];yi===void 0&&(yi=d[Pt]=[]),yi.push({featureIndex:be,feature:Xt,intersectionZ:ei})}}lookupSymbolFeatures(d,w,C,z,j,H,ee,ae){const he={};this.loadVTLayers();const be=Fa(j);for(const Te of d)this.loadMatchingFeature(he,{bucketIndex:C,sourceLayerIndex:z,featureIndex:Te,layoutVertexArrayOffset:0},be,H,ee,ae,w);return he}loadFeature(d){const{featureIndex:w,sourceLayerIndex:C}=d;this.loadVTLayers();const z=this.sourceLayerCoder.decode(C),j=this.vtFeatures[z];if(j[w])return j[w];const H=this.vtLayers[z].feature(w);return j[w]=H,H}hasLayer(d){for(const w of this.bucketLayerIDs)for(const C of w)if(d===C)return!0;return!1}getId(d,w){let C=d.id;return this.promoteId&&(C=d.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[w]],typeof C=="boolean"&&(C=Number(C))),C}}function $f(b,d,w,C,z){return xe(b,(j,H)=>{const ee=d instanceof xt?d.get(H):null;return ee&&ee.evaluate?ee.evaluate(w,C,z):ee})}function s0(b,d){return d-b}wi("FeatureIndex",Uf,{omit:["rawTileData","sourceLayerCoder"]});class jf{constructor(d){const w={},C=[];for(const ee in d){const ae=d[ee],he=w[ee]={};for(const be in ae.glyphs){const Te=ae.glyphs[+be];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const Re=Te.metrics.localGlyph?2:1,$e={x:0,y:0,w:Te.bitmap.width+2*Re,h:Te.bitmap.height+2*Re};C.push($e),he[be]=$e}}const{w:z,h:j}=Eu(C),H=new xa({width:z||1,height:j||1});for(const ee in d){const ae=d[ee];for(const he in ae.glyphs){const be=ae.glyphs[+he];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const Te=w[ee][he],Re=be.metrics.localGlyph?2:1;xa.copy(be.bitmap,H,{x:0,y:0},{x:Te.x+Re,y:Te.y+Re},be.bitmap)}}this.image=H,this.positions=w}}wi("GlyphAtlas",jf);class l0{constructor(d){this.tileID=new Wr(d.tileID.overscaledZ,d.tileID.wrap,d.tileID.canonical.z,d.tileID.canonical.x,d.tileID.canonical.y),this.tileZoom=d.tileZoom,this.uid=d.uid,this.zoom=d.zoom,this.canonical=d.tileID.canonical,this.pixelRatio=d.pixelRatio,this.tileSize=d.tileSize,this.source=d.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=d.showCollisionBoxes,this.collectResourceTiming=!!d.collectResourceTiming,this.returnDependencies=!!d.returnDependencies,this.promoteId=d.promoteId,this.enableTerrain=!!d.enableTerrain,this.isSymbolTile=d.isSymbolTile,d.projection&&(this.tileTransform=Ih(d.tileID.canonical,d.projection))}parse(d,w,C,z,j){this.status="parsing",this.data=d,this.collisionBoxArray=new $r;const H=new Mf(Object.keys(d.layers).sort()),ee=new Uf(this.tileID,this.promoteId);ee.bucketLayerIDs=[];const ae={},he=new Fu(256,256),be={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:he,availableImages:C},Te=w.familiesBySource[this.source];for(const Lt in Te){const Ft=d.layers[Lt];if(!Ft)continue;let ei=!1,Xt=!1;for(const ti of Te[Lt])ti[0].type==="symbol"?ei=!0:Xt=!0;if(this.isSymbolTile===!0&&!ei||this.isSymbolTile===!1&&!Xt)continue;Ft.version===1&&je(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yi=H.encode(Lt),oi=[];for(let ti=0;ti<Ft.length;ti++){const si=Ft.feature(ti),ui=ee.getId(si,Lt);oi.push({feature:si,id:ui,index:ti,sourceLayerIndex:yi})}for(const ti of Te[Lt]){const si=ti[0];this.isSymbolTile!==void 0&&si.type==="symbol"!==this.isSymbolTile||si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&(Vu(ti,this.zoom,C),(ae[si.id]=si.createBucket({index:ee.bucketLayerIDs.length,layers:ti,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yi,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:C})).populate(oi,be,this.tileID.canonical,this.tileTransform),ee.bucketLayerIDs.push(ti.map(ui=>ui.id)))}}let Re,$e,qe,rt;he.trim();const dt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},yt=xe(be.glyphDependencies,Lt=>Object.keys(Lt).map(Number));Object.keys(yt).length?z.send("getGlyphs",{uid:this.uid,stacks:yt},(Lt,Ft)=>{Re||(Re=Lt,$e=Ft,Ot.call(this))},void 0,!1,dt):$e={};const Mt=Object.keys(be.iconDependencies);Mt.length?z.send("getImages",{icons:Mt,source:this.source,tileID:this.tileID,type:"icons"},(Lt,Ft)=>{Re||(Re=Lt,qe=Ft,Ot.call(this))},void 0,!1,dt):qe={};const Pt=Object.keys(be.patternDependencies);function Ot(){if(Re)return j(Re);if($e&&qe&&rt){const Lt=new jf($e),Ft=new Yc(qe,rt);for(const ei in ae){const Xt=ae[ei];Xt instanceof Sa?(Vu(Xt.layers,this.zoom,C),Gp(Xt,$e,Lt.positions,qe,Ft.iconPositions,this.showCollisionBoxes,C,this.tileID.canonical,this.tileZoom)):Xt.hasPattern&&(Xt instanceof _h||Xt instanceof gh||Xt instanceof xu)&&(Vu(Xt.layers,this.zoom,C),Xt.addFeatures(be,this.tileID.canonical,Ft.patternPositions,C))}this.status="done",j(null,{buckets:q(ae).filter(ei=>!ei.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Lt.image,lineAtlas:he,imageAtlas:Ft,glyphMap:this.returnDependencies?$e:null,iconMap:this.returnDependencies?qe:null,glyphPositions:this.returnDependencies?Lt.positions:null})}}Pt.length?z.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"},(Lt,Ft)=>{Re||(Re=Lt,rt=Ft,Ot.call(this))},void 0,!1,dt):rt={},Ot.call(this)}}function Vu(b,d,w){const C=new Ue(d);for(const z of b)z.recalculate(C,w)}class Gf{constructor(d){this.entries={},this.scheduler=d}request(d,w,C,z){const j=this.entries[d]=this.entries[d]||{callbacks:[]};if(j.result){const[H,ee]=j.result;return this.scheduler?this.scheduler.add(()=>{z(H,ee)},w):z(H,ee),()=>{}}return j.callbacks.push(z),j.cancel||(j.cancel=C((H,ee)=>{j.result=[H,ee];for(const ae of j.callbacks)this.scheduler?this.scheduler.add(()=>{ae(H,ee)},w):ae(H,ee);setTimeout(()=>delete this.entries[d],3e3)})),()=>{j.result||(j.callbacks=j.callbacks.filter(H=>H!==z),j.callbacks.length||(j.cancel(),delete this.entries[d]))}}}function Vf(b,d,w){const C=JSON.stringify(b.request);return b.data&&(this.deduped.entries[C]={result:[null,b.data]}),this.deduped.request(C,{type:"parseTile",isSymbolTile:b.isSymbolTile,zoom:b.tileZoom},z=>{const j=Se(b.request,(H,ee,ae,he)=>{H?z(H):ee&&z(null,{vectorTile:w?void 0:new to.VectorTile(new tl(ee)),rawData:ee,cacheControl:ae,expires:he})});return()=>{j.cancel(),z()}},d)}var h0={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Sc(this.parallels,this.constants.parallels))return;const b=Math.sin(B(this.parallels[0])),d=(b+Math.sin(B(this.parallels[1])))/2,w=1+b*(2*d-b),C=Math.sqrt(w)/d;this.constants={n:d,c:w,r0:C,parallels:this.parallels}},project(b,d){this.initializeConstants();const w=B(b-this.center[0]),C=B(d),{n:z,c:j,r0:H}=this.constants,ee=Math.sqrt(j-2*z*Math.sin(C))/z;return{x:ee*Math.sin(w*z),y:ee*Math.cos(w*z)-H}},unproject(b,d){this.initializeConstants();const{n:w,c:C,r0:z}=this.constants,j=z+d;let H=Math.atan2(b,Math.abs(j))*Math.sign(j);j*w<0&&(H-=Math.PI*Math.sign(b)*Math.sign(j));const ee=B(this.center[0])*w;H=X(H,-Math.PI-ee,Math.PI-ee);const ae=U(H/w)+this.center[0],he=Math.asin(Y((C-(b*b+j*j)*w*w)/(2*w),-1,1)),be=Y(U(he),-85.051129,va);return new Yi(ae,be)}};const al=1.340264,ol=-.081106,sl=893e-6,ll=.003796,Ph=Math.sqrt(3)/2;var u0={name:"equalEarth",center:[0,0],range:[3.5,7],project(b,d){d=d/180*Math.PI,b=b/180*Math.PI;const w=Math.asin(Ph*Math.sin(d)),C=w*w,z=C*C*C;return{x:.5*(b*Math.cos(w)/(Ph*(al+3*ol*C+z*(7*sl+9*ll*C)))/Math.PI+.5),y:1-.5*(w*(al+ol*C+z*(sl+ll*C))/Math.PI+1)}},unproject(b,d){b=(2*b-.5)*Math.PI;let w=d=(2*(1-d)-1)*Math.PI,C=w*w,z=C*C*C;for(let he,be,Te,Re=0;Re<12&&(be=w*(al+ol*C+z*(sl+ll*C))-d,Te=al+3*ol*C+z*(7*sl+9*ll*C),he=be/Te,w=Y(w-he,-Math.PI/3,Math.PI/3),C=w*w,z=C*C*C,!(Math.abs(he)<1e-12));++Re);const j=Ph*b*(al+3*ol*C+z*(7*sl+9*ll*C))/Math.cos(w),H=Math.asin(Math.sin(w)/Ph),ee=Y(180*j/Math.PI,-180,180),ae=Y(180*H/Math.PI,-85.051129,va);return new Yi(ee,ae)}},c0={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(b,d)=>({x:.5+b/360,y:.5-d/360}),unproject(b,d){const w=360*(b-.5),C=Y(360*(.5-d),-85.051129,va);return new Yi(w,C)}};const ns=Math.PI/2;function Lh(b){return Math.tan((ns+b)/2)}var f0={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Sc(this.parallels,this.constants.parallels))return;const b=B(this.parallels[0]),d=B(this.parallels[1]),w=Math.cos(b),C=b===d?Math.sin(b):Math.log(w/Math.cos(d))/Math.log(Lh(d)/Lh(b)),z=w*Math.pow(Lh(b),C)/C;this.constants={n:C,f:z,parallels:this.parallels}},project(b,d){this.initializeConstants(),d=B(d),b=B(b-this.center[0]);const w=1e-6,{n:C,f:z}=this.constants;z>0?d<-ns+w&&(d=-ns+w):d>ns-w&&(d=ns-w);const j=z/Math.pow(Lh(d),C),H=j*Math.sin(C*b),ee=z-j*Math.cos(C*b);return{x:.5*(H/Math.PI+.5),y:1-.5*(ee/Math.PI+.5)}},unproject(b,d){this.initializeConstants(),b=(2*b-.5)*Math.PI,d=(2*(1-d)-.5)*Math.PI;const{n:w,f:C}=this.constants,z=C-d,j=Math.sign(z),H=Math.sign(w)*Math.sqrt(b*b+z*z);let ee=Math.atan2(b,Math.abs(z))*j;z*w<0&&(ee-=Math.PI*Math.sign(b)*j);const ae=Y(U(ee/w)+this.center[0],-180,180),he=Y(U(2*Math.atan(Math.pow(C/H,1/w))-ns),-85.051129,va);return new Yi(ae,he)}},d0={name:"mercator",wrap:!0,center:[0,0],project:(b,d)=>({x:eu(b),y:tu(d)}),unproject(b,d){const w=Qa(b),C=Pn(d);return new Yi(w,C)}};const Zf=B(va);var p0={name:"naturalEarth",center:[0,0],range:[3.5,7],project(b,d){const w=(d=B(d))*d,C=w*w;return{x:.5*((b=B(b))*(.8707-.131979*w+C*(C*(.003971*w-.001529*C)-.013791))/Math.PI+.5),y:1-.5*(d*(1.007226+w*(.015085+C*(.028874*w-.044475-.005916*C)))/Math.PI+1)}},unproject(b,d){b=(2*b-.5)*Math.PI;let w=d=(2*(1-d)-1)*Math.PI,C=25,z=0,j=w*w;do{j=w*w;const ae=j*j;z=(w*(1.007226+j*(.015085+ae*(.028874*j-.044475-.005916*ae)))-d)/(1.007226+j*(.045255+ae*(.259866*j-.311325-.005916*11*ae))),w=Y(w-z,-Zf,Zf)}while(Math.abs(z)>1e-6&&--C>0);j=w*w;const H=Y(U(b/(.8707+j*(j*(j*j*j*(.003971-.001529*j)-.013791)-.131979))),-180,180),ee=U(w);return new Yi(H,ee)}};const Hf=B(va),Wf={albers:h0,equalEarth:u0,equirectangular:c0,lambertConformalConic:f0,mercator:d0,naturalEarth:p0,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(b,d){d=B(d),b=B(b);const w=Math.cos(d),C=2/Math.PI,z=Math.acos(w*Math.cos(b/2)),j=Math.sin(z)/z,H=.5*(b*C+2*w*Math.sin(b/2)/j)||0,ee=.5*(d+Math.sin(d)/j)||0;return{x:.5*(H/Math.PI+.5),y:1-.5*(ee/Math.PI+1)}},unproject(b,d){let w=b=(2*b-.5)*Math.PI,C=d=(2*(1-d)-1)*Math.PI,z=25;const j=1e-6;let H=0,ee=0;do{const ae=Math.cos(C),he=Math.sin(C),be=2*he*ae,Te=he*he,Re=ae*ae,$e=Math.cos(w/2),qe=Math.sin(w/2),rt=2*$e*qe,dt=qe*qe,yt=1-Re*$e*$e,Mt=yt?1/yt:0,Pt=yt?Math.acos(ae*$e)*Math.sqrt(1/yt):0,Ot=.5*(2*Pt*ae*qe+2*w/Math.PI)-b,Lt=.5*(Pt*he+C)-d,Ft=.5*Mt*(Re*dt+Pt*ae*$e*Te)+1/Math.PI,ei=Mt*(rt*be/4-Pt*he*qe),Xt=.125*Mt*(be*qe-Pt*he*Re*rt),yi=.5*Mt*(Te*$e+Pt*dt*ae)+.5,oi=ei*Xt-yi*Ft;H=(Lt*ei-Ot*yi)/oi,ee=(Ot*Xt-Lt*Ft)/oi,w=Y(w-H,-Math.PI,Math.PI),C=Y(C-ee,-Hf,Hf)}while((Math.abs(H)>j||Math.abs(ee)>j)&&--z>0);return new Yi(U(w),U(C))}}};h.ARRAY_TYPE=jr,h.AUTH_ERR_MSG=Ee,h.Actor=class{constructor(b,d,w){this.target=b,this.parent=d,this.mapId=w,this.callbacks={},this.cancelCallbacks={},ye(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=De()?b:D,this.scheduler=new r0}send(b,d,w,C,z=!1,j){const H=Math.round(1e18*Math.random()).toString(36).substring(0,10);w&&(w.metadata=j,this.callbacks[H]=w);const ee=St(this.globalScope)?void 0:[];return this.target.postMessage({id:H,type:b,hasCallback:!!w,targetMapId:C,mustQueue:z,sourceMapId:this.mapId,data:ja(d,ee)},ee),{cancel:()=>{w&&delete this.callbacks[H],this.target.postMessage({id:H,type:"<cancel>",targetMapId:C,sourceMapId:this.mapId})}}}receive(b){const d=b.data,w=d.id;if(w&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){const C=this.cancelCallbacks[w];delete this.cancelCallbacks[w],C&&C.cancel()}else if(d.mustQueue||De()){const C=this.callbacks[w];this.cancelCallbacks[w]=this.scheduler.add(()=>this.processTask(w,d),C&&C.metadata||{type:"message"})}else this.processTask(w,d)}processTask(b,d){if(d.type==="<response>"){const w=this.callbacks[b];delete this.callbacks[b],w&&(d.error?w(Ga(d.error)):w(null,Ga(d.data)))}else{const w=St(this.globalScope)?void 0:[],C=d.hasCallback?(j,H)=>{delete this.cancelCallbacks[b],this.target.postMessage({id:b,type:"<response>",sourceMapId:this.mapId,error:j?ja(j):null,data:ja(H,w)},w)}:j=>{},z=Ga(d.data);if(this.parent[d.type])this.parent[d.type](d.sourceMapId,z,C);else if(this.parent.getWorkerSource){const j=d.type.split(".");this.parent.getWorkerSource(d.sourceMapId,j[0],z.source)[j[1]](z,C)}else C(new Error(`Could not find function ${d.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=zu,h.Color=Gi,h.ColorMode=Fn,h.CullFaceMode=vn,h.DEMData=Dh,h.DataConstantProperty=ut,h.DedupedRequest=Gf,h.DepthMode=rs,h.EXTENT=ji,h.Elevation=class{getAtPointOrZero(b,d=0){return this.getAtPoint(b,d)||0}getAtPoint(b,d,w=!0){d==null&&(d=null);const C=this._source();if(!C||b.y<0||b.y>1)return d;const z=C.getSource().maxzoom,j=1<<z,H=Math.floor(b.x),ee=b.x-H,ae=new Wr(z,H,z,Math.floor(ee*j),Math.floor(b.y*j)),he=this.findDEMTileFor(ae);if(!he||!he.dem)return d;const be=he.dem,Te=1<<he.tileID.canonical.z,Re=(ee*Te-he.tileID.canonical.x)*be.dim,$e=(b.y*Te-he.tileID.canonical.y)*be.dim,qe=Math.floor(Re),rt=Math.floor($e);return(w?this.exaggeration():1)*Vi(Vi(be.get(qe,rt),be.get(qe,rt+1),$e-rt),Vi(be.get(qe+1,rt),be.get(qe+1,rt+1),$e-rt),Re-qe)}getAtTileOffset(b,d,w){const C=1<<b.canonical.z;return this.getAtPointOrZero(new sh(b.wrap+(b.canonical.x+d/ji)/C,(b.canonical.y+w/ji)/C))}getForTilePoints(b,d,w,C){const z=Rh.create(this,b,C);return!!z&&(d.forEach(j=>{j[2]=this.exaggeration()*z.getElevationAt(j[0],j[1],w)}),!0)}getMinMaxForTile(b){const d=this.findDEMTileFor(b);if(!d||!d.dem)return null;const w=d.dem.tree,C=d.tileID,z=1<<b.canonical.z-C.canonical.z;let j=b.canonical.x/z-C.canonical.x,H=b.canonical.y/z-C.canonical.y,ee=0;for(let ae=0;ae<b.canonical.z-C.canonical.z&&!w.leaves[ee];ae++){j*=2,H*=2;const he=2*Math.floor(H)+Math.floor(j);ee=w.childOffsets[ee]+he,j%=1,H%=1}return{min:this.exaggeration()*w.minimums[ee],max:this.exaggeration()*w.maximums[ee]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(b,d,w){throw new Error("Pure virtual method called.")}pointCoordinate(b){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(b){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=_i,h.EvaluationParameters=Ue,h.Event=Ht,h.Evented=ai,h.GlyphManager=ts,h.ImagePosition=Su,h.LineAtlas=Fu,h.LngLat=Yi,h.LngLatBounds=Ja,h.LocalGlyphMode=Cu,h.MAX_MERCATOR_LATITUDE=va,h.MAX_SAFE_INTEGER=M,h.MercatorCoordinate=sh,h.ONE_EM=Lr,h.OverscaledTileID=Wr,h.Properties=Jt,h.RGBAImage=on,h.RequestManager=class{constructor(b,d,w){this._transformRequestFn=b,this._customAccessToken=d,this._silenceAuthErrors=!!w,this._createSkuToken()}_createSkuToken(){const b=function(){let d="";for(let w=0;w<10;w++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ce,d].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=b.token,this._skuTokenExpiresAt=b.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(b,d){return this._transformRequestFn&&this._transformRequestFn(b,d)||{url:b}}normalizeStyleURL(b,d){if(!Ye(b))return b;const w=It(b);return w.path=`/styles/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||d)}normalizeGlyphsURL(b,d){if(!Ye(b))return b;const w=It(b);return w.path=`/fonts/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||d)}normalizeSourceURL(b,d){if(!Ye(b))return b;const w=It(b);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),this._makeAPIURL(w,this._customAccessToken||d)}normalizeSpriteURL(b,d,w,C){const z=It(b);return Ye(b)?(z.path=`/styles/v1${z.path}/sprite${d}${w}`,this._makeAPIURL(z,this._customAccessToken||C)):(z.path+=`${d}${w}`,$t(z))}normalizeTileURL(b,d,w){if(this._isSkuTokenExpired()&&this._createSkuToken(),b&&!Ye(b))return b;const C=It(b);C.path=C.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||w&&C.authority!=="raster"&&w===512?"@2x":""}${He.supported?".webp":"$1"}`),C.authority==="raster"?C.path=`/${Ge.RASTER_URL_PREFIX}${C.path}`:(C.path=C.path.replace(/^.+\/v4\//,"/"),C.path=`/${Ge.TILE_URL_VERSION}${C.path}`);const z=this._customAccessToken||function(j){for(const H of j){const ee=H.match(/^access_token=(.*)$/);if(ee)return ee[1]}return null}(C.params)||Ge.ACCESS_TOKEN;return Ge.REQUIRE_ACCESS_TOKEN&&z&&this._skuToken&&C.params.push(`sku=${this._skuToken}`),this._makeAPIURL(C,z)}canonicalizeTileURL(b,d){const w=It(b);if(!w.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!w.path.match(/\.[\w]+$/))return b;let C="mapbox://";w.path.match(/^\/raster\/v1\//)?C+=`raster/${w.path.replace(`/${Ge.RASTER_URL_PREFIX}/`,"")}`:C+=`tiles/${w.path.replace(`/${Ge.TILE_URL_VERSION}/`,"")}`;let z=w.params;return d&&(z=z.filter(j=>!j.match(/^access_token=/))),z.length&&(C+=`?${z.join("&")}`),C}canonicalizeTileset(b,d){const w=!!d&&Ye(d),C=[];for(const z of b.tiles||[])ft(z)?C.push(this.canonicalizeTileURL(z,w)):C.push(z);return C}_makeAPIURL(b,d){const w="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",C=It(Ge.API_URL);if(b.protocol=C.protocol,b.authority=C.authority,b.protocol==="http"){const z=b.params.indexOf("secure");z>=0&&b.params.splice(z,1)}if(C.path!=="/"&&(b.path=`${C.path}${b.path}`),!Ge.REQUIRE_ACCESS_TOKEN)return $t(b);if(d=d||Ge.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${w}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${w}`)}return b.params=b.params.filter(z=>z.indexOf("access_token")===-1),b.params.push(`access_token=${d||""}`),$t(b)}},h.ResourceType=ke,h.SegmentVector=Cr,h.SourceCache=io,h.StencilMode=$u,h.StructArrayLayout1ui2=Ar,h.StructArrayLayout2f1f2i16=Pr,h.StructArrayLayout2i4=Ei,h.StructArrayLayout2ui4=or,h.StructArrayLayout3f12=Di,h.StructArrayLayout3ui6=_r,h.StructArrayLayout4i8=Ai,h.Texture=Ch,h.Tile=If,h.Transitionable=ct,h.Uniform1f=ah,h.Uniform1i=class extends qn{constructor(b,d){super(b,d),this.current=0}set(b){this.current!==b&&(this.current=b,this.gl.uniform1i(this.location,b))}},h.Uniform2f=class extends qn{constructor(b,d){super(b,d),this.current=[0,0]}set(b){b[0]===this.current[0]&&b[1]===this.current[1]||(this.current=b,this.gl.uniform2f(this.location,b[0],b[1]))}},h.Uniform3f=class extends qn{constructor(b,d){super(b,d),this.current=[0,0,0]}set(b){b[0]===this.current[0]&&b[1]===this.current[1]&&b[2]===this.current[2]||(this.current=b,this.gl.uniform3f(this.location,b[0],b[1],b[2]))}},h.Uniform4f=ec,h.UniformColor=tc,h.UniformMatrix2f=class extends qn{constructor(b,d){super(b,d),this.current=ad}set(b){for(let d=0;d<4;d++)if(b[d]!==this.current[d]){this.current=b,this.gl.uniformMatrix2fv(this.location,!1,b);break}}},h.UniformMatrix3f=class extends qn{constructor(b,d){super(b,d),this.current=nd}set(b){for(let d=0;d<9;d++)if(b[d]!==this.current[d]){this.current=b,this.gl.uniformMatrix3fv(this.location,!1,b);break}}},h.UniformMatrix4f=class extends qn{constructor(b,d){super(b,d),this.current=rd}set(b){if(b[12]!==this.current[12]||b[0]!==this.current[0])return this.current=b,void this.gl.uniformMatrix4fv(this.location,!1,b);for(let d=1;d<16;d++)if(b[d]!==this.current[d]){this.current=b,this.gl.uniformMatrix4fv(this.location,!1,b);break}}},h.UnwrappedTileID=Sf,h.ValidationError=Ut,h.VectorTileWorkerSource=class extends ai{constructor(b,d,w,C,z){super(),this.actor=b,this.layerIndex=d,this.availableImages=w,this.loadVectorData=z||Vf,this.loading={},this.loaded={},this.deduped=new Gf(b.scheduler),this.isSpriteLoaded=C,this.scheduler=b.scheduler}loadTile(b,d){const w=b.uid,C=b&&b.request,z=C&&C.collectResourceTiming,j=this.loading[w]=new l0(b);j.abort=this.loadVectorData(b,(H,ee)=>{const ae=!this.loading[w];if(delete this.loading[w],ae||H||!ee)return j.status="done",ae||(this.loaded[w]=j),d(H);const he=ee.rawData,be={};ee.expires&&(be.expires=ee.expires),ee.cacheControl&&(be.cacheControl=ee.cacheControl),j.vectorTile=ee.vectorTile||new to.VectorTile(new tl(he));const Te=()=>{j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor,(Re,$e)=>{if(Re||!$e)return d(Re);const qe={};if(z){const rt=wf(C);rt.length>0&&(qe.resourceTiming=JSON.parse(JSON.stringify(rt)))}d(null,te({rawTileData:he.slice(0)},$e,be,qe))})};this.isSpriteLoaded?Te():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Te,{type:"parseTile",isSymbolTile:b.isSymbolTile,zoom:b.tileZoom}):Te()}),this.loaded=this.loaded||{},this.loaded[w]=j})}reloadTile(b,d){const w=this.loaded,C=b.uid,z=this;if(w&&w[C]){const j=w[C];j.showCollisionBoxes=b.showCollisionBoxes,j.enableTerrain=!!b.enableTerrain;const H=(ee,ae)=>{const he=j.reloadCallback;he&&(delete j.reloadCallback,j.parse(j.vectorTile,z.layerIndex,this.availableImages,z.actor,he)),d(ee,ae)};j.status==="parsing"?j.reloadCallback=H:j.status==="done"&&(j.vectorTile?j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor,H):H())}}abortTile(b,d){const w=b.uid,C=this.loading[w];C&&(C.abort&&C.abort(),delete this.loading[w]),d()}removeTile(b,d){const w=this.loaded,C=b.uid;w&&w[C]&&delete w[C],d()}},h.WritingMode=sn,h.ZoomHistory=Gl,h.add=function(b,d,w){return b[0]=d[0]+w[0],b[1]=d[1]+w[1],b[2]=d[2]+w[2],b},h.addDynamicAttributes=Ru,h.altitudeFromMercatorZ=ru,h.asyncAll=J,h.bezier=Z,h.bindAll=ye,h.boundsAttributes=Nu,h.bufferConvexPolygon=function(b,d){const w=[];for(let C=0;C<b.length;C++){const z=X(C-1,-1,b.length-1),j=X(C+1,-1,b.length-1),H=b[C],ee=b[j],ae=b[z].sub(H).unit(),he=ee.sub(H).unit(),be=he.angleWithSep(ae.x,ae.y),Te=ae.add(he).unit().mult(-1*d/Math.sin(be/2));w.push(H.add(Te))}return w},h.cacheEntryPossiblyAdded=function(b){ie++,ie>Ve&&(b.getActor().send("enforceCacheSizeLimit",Rt),ie=0)},h.clamp=Y,h.clearTileCache=function(b){const d=D.caches.delete(At);b&&d.catch(b).then(()=>b())},h.clipLine=hf,h.clone=function(b){var d=new jr(3);return d[0]=b[0],d[1]=b[1],d[2]=b[2],d},h.clone$1=function(b){var d=new jr(16);return d[0]=b[0],d[1]=b[1],d[2]=b[2],d[3]=b[3],d[4]=b[4],d[5]=b[5],d[6]=b[6],d[7]=b[7],d[8]=b[8],d[9]=b[9],d[10]=b[10],d[11]=b[11],d[12]=b[12],d[13]=b[13],d[14]=b[14],d[15]=b[15],d},h.clone$2=Ze,h.collisionCircleLayout=mp,h.config=Ge,h.conjugate=function(b,d){return b[0]=-d[0],b[1]=-d[1],b[2]=-d[2],b[3]=d[3],b},h.copy=function(b,d){return b[0]=d[0],b[1]=d[1],b[2]=d[2],b},h.create=uh,h.create$1=function(){var b=new jr(16);return jr!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},h.create$2=pc,h.createExpression=la,h.createLayout=Gt,h.createStyleLayer=function(b){return b.type==="custom"?new Jp(b):new e0[b.type](b)},h.cross=function(b,d,w){var C=d[0],z=d[1],j=d[2],H=w[0],ee=w[1],ae=w[2];return b[0]=z*ae-j*ee,b[1]=j*H-C*ae,b[2]=C*ee-z*H,b},h.degToRad=B,h.div=function(b,d,w){return b[0]=d[0]/w[0],b[1]=d[1]/w[1],b[2]=d[2]/w[2],b},h.dot=function(b,d){return b[0]*d[0]+b[1]*d[1]+b[2]*d[2]},h.dot$1=function(b,d){return b[0]*d[0]+b[1]*d[1]+b[2]*d[2]+b[3]*d[3]},h.ease=W,h.easeCubicInOut=V,h.emitValidationErrors=Ul,h.endsWith=me,h.enforceCacheSizeLimit=function(b){jt(),Bt&&Bt.then(d=>{d.keys().then(w=>{for(let C=0;C<w.length-b;C++)d.delete(w[C])})})},h.evaluateSizeForFeature=yh,h.evaluateSizeForZoom=Ko,h.evaluateVariableOffset=pf,h.evented=ge,h.exactEquals=function(b,d){return b[0]===d[0]&&b[1]===d[1]&&b[2]===d[2]&&b[3]===d[3]},h.exactEquals$1=function(b,d){return b[0]===d[0]&&b[1]===d[1]&&b[2]===d[2]},h.exported=Je,h.exported$1=He,h.extend=te,h.filterObject=Le,h.fromMat4=function(b,d){return b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[4],b[4]=d[5],b[5]=d[6],b[6]=d[8],b[7]=d[9],b[8]=d[10],b},h.fromQuat=function(b,d){var w=d[0],C=d[1],z=d[2],j=d[3],H=w+w,ee=C+C,ae=z+z,he=w*H,be=C*H,Te=C*ee,Re=z*H,$e=z*ee,qe=z*ae,rt=j*H,dt=j*ee,yt=j*ae;return b[0]=1-Te-qe,b[1]=be+yt,b[2]=Re-dt,b[3]=0,b[4]=be-yt,b[5]=1-he-qe,b[6]=$e+rt,b[7]=0,b[8]=Re+dt,b[9]=$e-rt,b[10]=1-he-Te,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},h.fromRotation=function(b,d){var w=Math.sin(d),C=Math.cos(d);return b[0]=C,b[1]=w,b[2]=0,b[3]=-w,b[4]=C,b[5]=0,b[6]=0,b[7]=0,b[8]=1,b},h.fromScaling=function(b,d){return b[0]=d[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=d[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=d[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},h.furthestTileCorner=function(b){const d=Math.round((b+45+360)%360/90)%4;return O[d]},h.getAABBPointSquareDist=function(b,d,w){let C=0;for(let z=0;z<2;++z){const j=w?w[z]:0;b[z]>j&&(C+=(b[z]-j)*(b[z]-j)),d[z]<j&&(C+=(j-d[z])*(j-d[z]))}return C},h.getAnchorAlignment=Au,h.getAnchorJustification=ku,h.getBounds=function(b){let d=1/0,w=1/0,C=-1/0,z=-1/0;for(const j of b)d=Math.min(d,j.x),w=Math.min(w,j.y),C=Math.max(C,j.x),z=Math.max(z,j.y);return{min:new k(d,w),max:new k(C,z)}},h.getImage=Tt,h.getJSON=function(b,d){return le(te(b,{type:"json"}),d)},h.getMapSessionAPI=Me,h.getPerformanceMeasurement=wf,h.getProjection=function(b){const d=Wf[b.name];if(!d)throw new Error(`Invalid projection name: ${b.name}`);return d.conic?function(w,C){if(C.parallels&&Math.abs(C.parallels[0]+C.parallels[1])<.01){let z=function(j){const H=Math.max(.01,Math.cos(B(j))),ee=1/(2*Math.max(Math.PI*H,1/H));return{wrap:!0,project(ae,he){const be=B(ae)*H,Te=Math.sin(B(he))/H;return{x:be*ee+.5,y:-Te*ee+.5}},unproject(ae,he){const be=-(he-.5)/ee,Te=Y(U((ae-.5)/ee)/H,-180,180),Re=Math.asin(Y(be*H,-1,1)),$e=Y(U(Re),-85.051129,va);return new Yi(Te,$e)}}}(C.parallels[0]);if(C.name==="lambertConformalConic"){const{project:j,unproject:H}=Wf.mercator;z={wrap:!0,project:j,unproject:H}}return te({},w,C,z)}return te({},w,C)}(d,b):d},h.getRTLTextPluginStatus=Ce,h.getReferrer=re,h.getTilePoint=function(b,{x:d,y:w},C=0){return new k(((d-C)*b.scale-b.x)*ji,(w*b.scale-b.y)*ji)},h.getTileVec3=function(b,d,w=0){return qo(((d.x-w)*b.scale-b.x)*ji,(d.y*b.scale-b.y)*ji,ru(d.z,d.y))},h.getVideo=function(b,d){const w=D.document.createElement("video");w.muted=!0,w.onloadstart=function(){d(null,w)};for(let C=0;C<b.length;C++){const z=D.document.createElement("source");nt(b[C])||(w.crossOrigin="Anonymous"),z.src=b[C],w.appendChild(z)}return{cancel:()=>{}}},h.identity=hu,h.identity$1=wc,h.invert=function(b,d){var w=d[0],C=d[1],z=d[2],j=d[3],H=d[4],ee=d[5],ae=d[6],he=d[7],be=d[8],Te=d[9],Re=d[10],$e=d[11],qe=d[12],rt=d[13],dt=d[14],yt=d[15],Mt=w*ee-C*H,Pt=w*ae-z*H,Ot=w*he-j*H,Lt=C*ae-z*ee,Ft=C*he-j*ee,ei=z*he-j*ae,Xt=be*rt-Te*qe,yi=be*dt-Re*qe,oi=be*yt-$e*qe,ti=Te*dt-Re*rt,si=Te*yt-$e*rt,ui=Re*yt-$e*dt,ni=Mt*ui-Pt*si+Ot*ti+Lt*oi-Ft*yi+ei*Xt;return ni?(b[0]=(ee*ui-ae*si+he*ti)*(ni=1/ni),b[1]=(z*si-C*ui-j*ti)*ni,b[2]=(rt*ei-dt*Ft+yt*Lt)*ni,b[3]=(Re*Ft-Te*ei-$e*Lt)*ni,b[4]=(ae*oi-H*ui-he*yi)*ni,b[5]=(w*ui-z*oi+j*yi)*ni,b[6]=(dt*Ot-qe*ei-yt*Pt)*ni,b[7]=(be*ei-Re*Ot+$e*Pt)*ni,b[8]=(H*si-ee*oi+he*Xt)*ni,b[9]=(C*oi-w*si-j*Xt)*ni,b[10]=(qe*Ft-rt*Ot+yt*Mt)*ni,b[11]=(Te*Ot-be*Ft-$e*Mt)*ni,b[12]=(ee*yi-H*ti-ae*Xt)*ni,b[13]=(w*ti-C*yi+z*Xt)*ni,b[14]=(rt*Pt-qe*Lt-dt*Mt)*ni,b[15]=(be*Lt-Te*Pt+Re*Mt)*ni,b):null},h.isMapAuthenticated=function(b){return bt.has(b)},h.isMapboxURL=Ye,h.latFromMercatorY=Pn,h.len=Ed,h.length=gc,h.length$1=function(b){return Math.hypot(b[0],b[1],b[2],b[3])},h.loadVectorTile=Vf,h.makeRequest=le,h.mercatorXfromLng=eu,h.mercatorYfromLat=tu,h.mercatorZfromAltitude=iu,h.mul=function(b,d,w){return b[0]=d[0]*w[0],b[1]=d[1]*w[1],b[2]=d[2]*w[2],b[3]=d[3]*w[3],b},h.mul$1=xd,h.mul$2=wd,h.multiply=mc,h.multiply$1=yc,h.nextPowerOfTwo=we,h.normalize=xc,h.normalize$1=function(b,d){var w=d[0],C=d[1],z=d[2],j=d[3],H=w*w+C*C+z*z+j*j;return H>0&&(H=1/Math.sqrt(H)),b[0]=w*H,b[1]=C*H,b[2]=z*H,b[3]=j*H,b},h.number=Vi,h.ortho=function(b,d,w,C,z,j,H){var ee=1/(d-w),ae=1/(C-z),he=1/(j-H);return b[0]=-2*ee,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ae,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*he,b[11]=0,b[12]=(d+w)*ee,b[13]=(z+C)*ae,b[14]=(H+j)*he,b[15]=1,b},h.pbf=tl,h.perspective=function(b,d,w,C,z){var j,H=1/Math.tan(d/2);return b[0]=H/w,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=H,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,z!=null&&z!==1/0?(b[10]=(z+C)*(j=1/(C-z)),b[14]=2*z*C*j):(b[10]=-1,b[14]=-2*C),b},h.pick=function(b,d){const w={};for(let C=0;C<d.length;C++){const z=d[C];z in b&&(w[z]=b[z])}return w},h.plugin=Fe,h.pointGeometry=k,h.polygonIntersectsBox=cc,h.polygonIntersectsPolygon=sc,h.polygonizeBounds=function(b,d,w=0,C=!0){const z=new k(w,w),j=b.sub(z),H=d.add(z),ee=[j,new k(H.x,j.y),H,new k(j.x,H.y)];return C&&ee.push(j),ee},h.posAttributes=n0,h.postMapLoadEvent=fi,h.postTurnstileEvent=qt,h.potpack=Eu,h.prevPowerOfTwo=function(b){return b<=1?1:Math.pow(2,Math.floor(Math.log(b)/Math.LN2))},h.radToDeg=U,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(b){return b({pluginStatus:G,pluginURL:K}),ge.on("pluginStateChange",b),b},h.removeAuthState=function(b){bt.delete(b)},h.renderColorRamp=du,h.rotateX=function(b,d,w){var C=Math.sin(w),z=Math.cos(w),j=d[4],H=d[5],ee=d[6],ae=d[7],he=d[8],be=d[9],Te=d[10],Re=d[11];return d!==b&&(b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[3],b[12]=d[12],b[13]=d[13],b[14]=d[14],b[15]=d[15]),b[4]=j*z+he*C,b[5]=H*z+be*C,b[6]=ee*z+Te*C,b[7]=ae*z+Re*C,b[8]=he*z-j*C,b[9]=be*z-H*C,b[10]=Te*z-ee*C,b[11]=Re*z-ae*C,b},h.rotateX$1=Ec,h.rotateY=function(b,d,w){var C=Math.sin(w),z=Math.cos(w),j=d[0],H=d[1],ee=d[2],ae=d[3],he=d[8],be=d[9],Te=d[10],Re=d[11];return d!==b&&(b[4]=d[4],b[5]=d[5],b[6]=d[6],b[7]=d[7],b[12]=d[12],b[13]=d[13],b[14]=d[14],b[15]=d[15]),b[0]=j*z-he*C,b[1]=H*z-be*C,b[2]=ee*z-Te*C,b[3]=ae*z-Re*C,b[8]=j*C+he*z,b[9]=H*C+be*z,b[10]=ee*C+Te*z,b[11]=ae*C+Re*z,b},h.rotateZ=function(b,d,w){var C=Math.sin(w),z=Math.cos(w),j=d[0],H=d[1],ee=d[2],ae=d[3],he=d[4],be=d[5],Te=d[6],Re=d[7];return d!==b&&(b[8]=d[8],b[9]=d[9],b[10]=d[10],b[11]=d[11],b[12]=d[12],b[13]=d[13],b[14]=d[14],b[15]=d[15]),b[0]=j*z+he*C,b[1]=H*z+be*C,b[2]=ee*z+Te*C,b[3]=ae*z+Re*C,b[4]=he*z-j*C,b[5]=be*z-H*C,b[6]=Te*z-ee*C,b[7]=Re*z-ae*C,b},h.rotateZ$1=function(b,d,w){w*=.5;var C=d[0],z=d[1],j=d[2],H=d[3],ee=Math.sin(w),ae=Math.cos(w);return b[0]=C*ae+z*ee,b[1]=z*ae-C*ee,b[2]=j*ae+H*ee,b[3]=H*ae-j*ee,b},h.scale=function(b,d,w){return b[0]=d[0]*w,b[1]=d[1]*w,b[2]=d[2]*w,b},h.scale$1=function(b,d,w){var C=w[0],z=w[1],j=w[2];return b[0]=d[0]*C,b[1]=d[1]*C,b[2]=d[2]*C,b[3]=d[3]*C,b[4]=d[4]*z,b[5]=d[5]*z,b[6]=d[6]*z,b[7]=d[7]*z,b[8]=d[8]*j,b[9]=d[9]*j,b[10]=d[10]*j,b[11]=d[11]*j,b[12]=d[12],b[13]=d[13],b[14]=d[14],b[15]=d[15],b},h.scale$2=function(b,d,w){return b[0]=d[0]*w,b[1]=d[1]*w,b[2]=d[2]*w,b[3]=d[3]*w,b},h.scaleAndAdd=vc,h.setCacheLimits=function(b,d){Rt=b,Ve=d},h.setRTLTextPlugin=function(b,d,w=!1){if(G===ga||G===$||G===y)throw new Error("setRTLTextPlugin cannot be called multiple times.");K=Je.resolveURL(b),G=ga,L=d,se(),w||Oe()},h.smoothstep=function(b,d,w){return(w=Y((w-b)/(d-b),0,1))*w*(3-2*w)},h.spec=Ct,h.storeAuthState=function(b,d){d?bt.add(b):bt.delete(b)},h.sub=bd,h.subtract=_c,h.symbolSize=gp,h.tileTransform=Ih,h.transformMat3=function(b,d,w){var C=d[0],z=d[1],j=d[2];return b[0]=C*w[0]+z*w[3]+j*w[6],b[1]=C*w[1]+z*w[4]+j*w[7],b[2]=C*w[2]+z*w[5]+j*w[8],b},h.transformMat4=Ws,h.transformMat4$1=function(b,d,w){var C=d[0],z=d[1],j=d[2],H=w[3]*C+w[7]*z+w[11]*j+w[15];return b[0]=(w[0]*C+w[4]*z+w[8]*j+w[12])/(H=H||1),b[1]=(w[1]*C+w[5]*z+w[9]*j+w[13])/H,b[2]=(w[2]*C+w[6]*z+w[10]*j+w[14])/H,b},h.transformQuat=bc,h.translate=function(b,d,w){var C,z,j,H,ee,ae,he,be,Te,Re,$e,qe,rt=w[0],dt=w[1],yt=w[2];return d===b?(b[12]=d[0]*rt+d[4]*dt+d[8]*yt+d[12],b[13]=d[1]*rt+d[5]*dt+d[9]*yt+d[13],b[14]=d[2]*rt+d[6]*dt+d[10]*yt+d[14],b[15]=d[3]*rt+d[7]*dt+d[11]*yt+d[15]):(z=d[1],j=d[2],H=d[3],ee=d[4],ae=d[5],he=d[6],be=d[7],Te=d[8],Re=d[9],$e=d[10],qe=d[11],b[0]=C=d[0],b[1]=z,b[2]=j,b[3]=H,b[4]=ee,b[5]=ae,b[6]=he,b[7]=be,b[8]=Te,b[9]=Re,b[10]=$e,b[11]=qe,b[12]=C*rt+ee*dt+Te*yt+d[12],b[13]=z*rt+ae*dt+Re*yt+d[13],b[14]=j*rt+he*dt+$e*yt+d[14],b[15]=H*rt+be*dt+qe*yt+d[15]),b},h.triggerPluginCompletionEvent=Q,h.uniqueId=de,h.validateCustomStyleLayer=function(b){const d=[],w=b.id;return w===void 0&&d.push({message:`layers.${w}: missing required property "id"`}),b.render===void 0&&d.push({message:`layers.${w}: missing required method "render"`}),b.renderingMode&&b.renderingMode!=="2d"&&b.renderingMode!=="3d"&&d.push({message:`layers.${w}: property "renderingMode" must be either "2d" or "3d"`}),d},h.validateFog=Ps,h.validateLight=Xh,h.validateStyle=Wn,h.values=q,h.vectorTile=to,h.version=I,h.warnOnce=je,h.window=D,h.wrap=X}),E(["./shared"],function(h){function I(re){const le=typeof re;if(le==="number"||le==="boolean"||le==="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){let We="[";for(const nt of re)We+=`${I(nt)},`;return`${We}]`}const Se=Object.keys(re).sort();let Ne="{";for(let We=0;We<Se.length;We++)Ne+=`${JSON.stringify(Se[We])}:${I(re[Se[We]])},`;return`${Ne}}`}function T(re){let le="";for(const Se of h.refProperties)le+=`/${I(re[Se])}`;return le}class A{constructor(le){this.keyCache={},le&&this.replace(le)}replace(le){this._layerConfigs={},this._layers={},this.update(le,[])}update(le,Se){for(const We of le)this._layerConfigs[We.id]=We,(this._layers[We.id]=h.createStyleLayer(We)).compileFilter(),this.keyCache[We.id]&&delete this.keyCache[We.id];for(const We of Se)delete this.keyCache[We],delete this._layerConfigs[We],delete this._layers[We];this.familiesBySource={};const Ne=function(We,nt){const vt={};for(let wt=0;wt<We.length;wt++){const Tt=nt&&nt[We[wt].id]||T(We[wt]);nt&&(nt[We[wt].id]=Tt);let Nt=vt[Tt];Nt||(Nt=vt[Tt]=[]),Nt.push(We[wt])}const Dt=[];for(const wt in vt)Dt.push(vt[wt]);return Dt}(h.values(this._layerConfigs),this.keyCache);for(const We of Ne){const nt=We.map(ri=>this._layers[ri.id]),vt=nt[0];if(vt.visibility==="none")continue;const Dt=vt.source||"";let wt=this.familiesBySource[Dt];wt||(wt=this.familiesBySource[Dt]={});const Tt=vt.sourceLayer||"_geojsonTileLayer";let Nt=wt[Tt];Nt||(Nt=wt[Tt]=[]),Nt.push(nt)}}}const{ImageBitmap:k}=h.window;class P{loadTile(le,Se){const{uid:Ne,encoding:We,rawImageData:nt,padding:vt,buildQuadTree:Dt}=le,wt=k&&nt instanceof k?this.getImageData(nt,vt):nt;Se(null,new h.DEMData(Ne,wt,We,vt<1,Dt))}getImageData(le,Se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const Ne=this.offscreenCanvasContext.getImageData(-Se,-Se,le.width+2*Se,le.height+2*Se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:Ne.width,height:Ne.height},Ne.data)}}var D=function re(le,Se){var Ne,We=le&&le.type;if(We==="FeatureCollection")for(Ne=0;Ne<le.features.length;Ne++)re(le.features[Ne],Se);else if(We==="GeometryCollection")for(Ne=0;Ne<le.geometries.length;Ne++)re(le.geometries[Ne],Se);else if(We==="Feature")re(le.geometry,Se);else if(We==="Polygon")M(le.coordinates,Se);else if(We==="MultiPolygon")for(Ne=0;Ne<le.coordinates.length;Ne++)M(le.coordinates[Ne],Se);return le};function M(re,le){if(re.length!==0){F(re[0],le);for(var Se=1;Se<re.length;Se++)F(re[Se],!le)}}function F(re,le){for(var Se=0,Ne=0,We=0,nt=re.length,vt=nt-1;We<nt;vt=We++){var Dt=(re[We][0]-re[vt][0])*(re[vt][1]+re[We][1]),wt=Se+Dt;Ne+=Math.abs(Se)>=Math.abs(Dt)?Se-wt+Dt:Dt-wt+Se,Se=wt}Se+Ne>=0!=!!le&&re.reverse()}const N=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class B{constructor(le){this._feature=le,this.extent=h.EXTENT,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Se of this._feature.geometry)le.push([new h.pointGeometry(Se[0],Se[1])]);return le}{const le=[];for(const Se of this._feature.geometry){const Ne=[];for(const We of Se)Ne.push(new h.pointGeometry(We[0],We[1]));le.push(Ne)}return le}}toGeoJSON(le,Se,Ne){return N.call(this,le,Se,Ne)}}class U{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=le.length,this._features=le}feature(le){return new B(this._features[le])}}var O=h.vectorTile.VectorTileFeature,V=Z;function Z(re,le){this.options=le||{},this.features=re,this.length=re.length}function W(re,le){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=le||4096}Z.prototype.feature=function(re){return new W(this.features[re],this.options.extent)},W.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var le=0;le<re.length;le++){for(var Se=re[le],Ne=[],We=0;We<Se.length;We++)Ne.push(new h.pointGeometry(Se[We][0],Se[We][1]));this.geometry.push(Ne)}return this.geometry},W.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,le=1/0,Se=-1/0,Ne=1/0,We=-1/0,nt=0;nt<re.length;nt++)for(var vt=re[nt],Dt=0;Dt<vt.length;Dt++){var wt=vt[Dt];le=Math.min(le,wt.x),Se=Math.max(Se,wt.x),Ne=Math.min(Ne,wt.y),We=Math.max(We,wt.y)}return[le,Ne,Se,We]},W.prototype.toGeoJSON=O.prototype.toGeoJSON;var Y=J,X=V;function J(re){var le=new h.pbf;return function(Se,Ne){for(var We in Se.layers)Ne.writeMessage(3,q,Se.layers[We])}(re,le),le.finish()}function q(re,le){var Se;le.writeVarintField(15,re.version||1),le.writeStringField(1,re.name||""),le.writeVarintField(5,re.extent||4096);var Ne={keys:[],values:[],keycache:{},valuecache:{}};for(Se=0;Se<re.length;Se++)Ne.feature=re.feature(Se),le.writeMessage(2,te,Ne);var We=Ne.keys;for(Se=0;Se<We.length;Se++)le.writeStringField(3,We[Se]);var nt=Ne.values;for(Se=0;Se<nt.length;Se++)le.writeMessage(4,Ae,nt[Se])}function te(re,le){var Se=re.feature;Se.id!==void 0&&le.writeVarintField(1,Se.id),le.writeMessage(2,ne,re),le.writeVarintField(3,Se.type),le.writeMessage(4,we,Se)}function ne(re,le){var Se=re.feature,Ne=re.keys,We=re.values,nt=re.keycache,vt=re.valuecache;for(var Dt in Se.properties){var wt=Se.properties[Dt],Tt=nt[Dt];if(wt!==null){Tt===void 0&&(Ne.push(Dt),nt[Dt]=Tt=Ne.length-1),le.writeVarint(Tt);var Nt=typeof wt;Nt!=="string"&&Nt!=="boolean"&&Nt!=="number"&&(wt=JSON.stringify(wt));var ri=Nt+":"+wt,Ht=vt[ri];Ht===void 0&&(We.push(wt),vt[ri]=Ht=We.length-1),le.writeVarint(Ht)}}}function de(re,le){return(le<<3)+(7&re)}function oe(re){return re<<1^re>>31}function we(re,le){for(var Se=re.loadGeometry(),Ne=re.type,We=0,nt=0,vt=Se.length,Dt=0;Dt<vt;Dt++){var wt=Se[Dt],Tt=1;Ne===1&&(Tt=wt.length),le.writeVarint(de(1,Tt));for(var Nt=Ne===3?wt.length-1:wt.length,ri=0;ri<Nt;ri++){ri===1&&Ne!==1&&le.writeVarint(de(2,Nt-1));var Ht=wt[ri].x-We,_i=wt[ri].y-nt;le.writeVarint(oe(Ht)),le.writeVarint(oe(_i)),We+=Ht,nt+=_i}Ne===3&&le.writeVarint(de(7,1))}}function Ae(re,le){var Se=typeof re;Se==="string"?le.writeStringField(1,re):Se==="boolean"?le.writeBooleanField(7,re):Se==="number"&&(re%1!=0?le.writeDoubleField(3,re):re<0?le.writeSVarintField(6,re):le.writeVarintField(5,re))}function ye(re,le,Se,Ne,We,nt){if(We-Ne<=Se)return;const vt=Ne+We>>1;me(re,le,vt,Ne,We,nt%2),ye(re,le,Se,Ne,vt-1,nt+1),ye(re,le,Se,vt+1,We,nt+1)}function me(re,le,Se,Ne,We,nt){for(;We>Ne;){if(We-Ne>600){const Tt=We-Ne+1,Nt=Se-Ne+1,ri=Math.log(Tt),Ht=.5*Math.exp(2*ri/3),_i=.5*Math.sqrt(ri*Ht*(Tt-Ht)/Tt)*(Nt-Tt/2<0?-1:1);me(re,le,Se,Math.max(Ne,Math.floor(Se-Nt*Ht/Tt+_i)),Math.min(We,Math.floor(Se+(Tt-Nt)*Ht/Tt+_i)),nt)}const vt=le[2*Se+nt];let Dt=Ne,wt=We;for(xe(re,le,Ne,Se),le[2*We+nt]>vt&&xe(re,le,Ne,We);Dt<wt;){for(xe(re,le,Dt,wt),Dt++,wt--;le[2*Dt+nt]<vt;)Dt++;for(;le[2*wt+nt]>vt;)wt--}le[2*Ne+nt]===vt?xe(re,le,Ne,wt):(wt++,xe(re,le,wt,We)),wt<=Se&&(Ne=wt+1),Se<=wt&&(We=wt-1)}}function xe(re,le,Se,Ne){Le(re,Se,Ne),Le(le,2*Se,2*Ne),Le(le,2*Se+1,2*Ne+1)}function Le(re,le,Se){const Ne=re[le];re[le]=re[Se],re[Se]=Ne}function Ze(re,le,Se,Ne){const We=re-Se,nt=le-Ne;return We*We+nt*nt}Y.fromVectorTileJs=J,Y.fromGeojsonVt=function(re,le){le=le||{};var Se={};for(var Ne in re)Se[Ne]=new V(re[Ne].features,le),Se[Ne].name=Ne,Se[Ne].version=le.version,Se[Ne].extent=le.extent;return J({layers:Se})},Y.GeoJSONWrapper=X;const Xe=re=>re[0],je=re=>re[1];class Ie{constructor(le,Se=Xe,Ne=je,We=64,nt=Float64Array){this.nodeSize=We,this.points=le;const vt=le.length<65536?Uint16Array:Uint32Array,Dt=this.ids=new vt(le.length),wt=this.coords=new nt(2*le.length);for(let Tt=0;Tt<le.length;Tt++)Dt[Tt]=Tt,wt[2*Tt]=Se(le[Tt]),wt[2*Tt+1]=Ne(le[Tt]);ye(Dt,wt,We,0,Dt.length-1,0)}range(le,Se,Ne,We){return function(nt,vt,Dt,wt,Tt,Nt,ri){const Ht=[0,nt.length-1,0],_i=[];let ai,Ct;for(;Ht.length;){const Ut=Ht.pop(),Mi=Ht.pop(),ki=Ht.pop();if(Mi-ki<=ri){for(let zi=ki;zi<=Mi;zi++)ai=vt[2*zi],Ct=vt[2*zi+1],ai>=Dt&&ai<=Tt&&Ct>=wt&&Ct<=Nt&&_i.push(nt[zi]);continue}const Si=Math.floor((ki+Mi)/2);ai=vt[2*Si],Ct=vt[2*Si+1],ai>=Dt&&ai<=Tt&&Ct>=wt&&Ct<=Nt&&_i.push(nt[Si]);const Bi=(Ut+1)%2;(Ut===0?Dt<=ai:wt<=Ct)&&(Ht.push(ki),Ht.push(Si-1),Ht.push(Bi)),(Ut===0?Tt>=ai:Nt>=Ct)&&(Ht.push(Si+1),Ht.push(Mi),Ht.push(Bi))}return _i}(this.ids,this.coords,le,Se,Ne,We,this.nodeSize)}within(le,Se,Ne){return function(We,nt,vt,Dt,wt,Tt){const Nt=[0,We.length-1,0],ri=[],Ht=wt*wt;for(;Nt.length;){const _i=Nt.pop(),ai=Nt.pop(),Ct=Nt.pop();if(ai-Ct<=Tt){for(let Bi=Ct;Bi<=ai;Bi++)Ze(nt[2*Bi],nt[2*Bi+1],vt,Dt)<=Ht&&ri.push(We[Bi]);continue}const Ut=Math.floor((Ct+ai)/2),Mi=nt[2*Ut],ki=nt[2*Ut+1];Ze(Mi,ki,vt,Dt)<=Ht&&ri.push(We[Ut]);const Si=(_i+1)%2;(_i===0?vt-wt<=Mi:Dt-wt<=ki)&&(Nt.push(Ct),Nt.push(Ut-1),Nt.push(Si)),(_i===0?vt+wt>=Mi:Dt+wt>=ki)&&(Nt.push(Ut+1),Nt.push(ai),Nt.push(Si))}return ri}(this.ids,this.coords,le,Se,Ne,this.nodeSize)}}const Pe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},De=Math.fround||(ze=new Float32Array(1),re=>(ze[0]=+re,ze[0]));var ze;class it{constructor(le){this.options=Ge(Object.create(Pe),le),this.trees=new Array(this.options.maxZoom+1)}load(le){const{log:Se,minZoom:Ne,maxZoom:We,nodeSize:nt}=this.options;Se&&console.time("total time");const vt=`prepare ${le.length} points`;Se&&console.time(vt),this.points=le;let Dt=[];for(let wt=0;wt<le.length;wt++)le[wt].geometry&&Dt.push(ot(le[wt],wt));this.trees[We+1]=new Ie(Dt,He,ve,nt,Float32Array),Se&&console.timeEnd(vt);for(let wt=We;wt>=Ne;wt--){const Tt=+Date.now();Dt=this._cluster(Dt,wt),this.trees[wt]=new Ie(Dt,He,ve,nt,Float32Array),Se&&console.log("z%d: %d clusters in %dms",wt,Dt.length,+Date.now()-Tt)}return Se&&console.timeEnd("total time"),this}getClusters(le,Se){let Ne=((le[0]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,le[1]));let nt=le[2]===180?180:((le[2]+180)%360+360)%360-180;const vt=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)Ne=-180,nt=180;else if(Ne>nt){const Nt=this.getClusters([Ne,We,180,vt],Se),ri=this.getClusters([-180,We,nt,vt],Se);return Nt.concat(ri)}const Dt=this.trees[this._limitZoom(Se)],wt=Dt.range(et(Ne),Je(vt),et(nt),Je(We)),Tt=[];for(const Nt of wt){const ri=Dt.points[Nt];Tt.push(ri.numPoints?lt(ri):this.points[ri.index])}return Tt}getChildren(le){const Se=this._getOriginId(le),Ne=this._getOriginZoom(le),We="No cluster with the specified id.",nt=this.trees[Ne];if(!nt)throw new Error(We);const vt=nt.points[Se];if(!vt)throw new Error(We);const Dt=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),wt=nt.within(vt.x,vt.y,Dt),Tt=[];for(const Nt of wt){const ri=nt.points[Nt];ri.parentId===le&&Tt.push(ri.numPoints?lt(ri):this.points[ri.index])}if(Tt.length===0)throw new Error(We);return Tt}getLeaves(le,Se,Ne){const We=[];return this._appendLeaves(We,le,Se=Se||10,Ne=Ne||0,0),We}getTile(le,Se,Ne){const We=this.trees[this._limitZoom(le)],nt=Math.pow(2,le),{extent:vt,radius:Dt}=this.options,wt=Dt/vt,Tt=(Ne-wt)/nt,Nt=(Ne+1+wt)/nt,ri={features:[]};return this._addTileFeatures(We.range((Se-wt)/nt,Tt,(Se+1+wt)/nt,Nt),We.points,Se,Ne,nt,ri),Se===0&&this._addTileFeatures(We.range(1-wt/nt,Tt,1,Nt),We.points,nt,Ne,nt,ri),Se===nt-1&&this._addTileFeatures(We.range(0,Tt,wt/nt,Nt),We.points,-1,Ne,nt,ri),ri.features.length?ri:null}getClusterExpansionZoom(le){let Se=this._getOriginZoom(le)-1;for(;Se<=this.options.maxZoom;){const Ne=this.getChildren(le);if(Se++,Ne.length!==1)break;le=Ne[0].properties.cluster_id}return Se}_appendLeaves(le,Se,Ne,We,nt){const vt=this.getChildren(Se);for(const Dt of vt){const wt=Dt.properties;if(wt&&wt.cluster?nt+wt.point_count<=We?nt+=wt.point_count:nt=this._appendLeaves(le,wt.cluster_id,Ne,We,nt):nt<We?nt++:le.push(Dt),le.length===Ne)break}return nt}_addTileFeatures(le,Se,Ne,We,nt,vt){for(const Dt of le){const wt=Se[Dt],Tt=wt.numPoints;let Nt,ri,Ht;if(Tt)Nt=St(wt),ri=wt.x,Ht=wt.y;else{const Ct=this.points[wt.index];Nt=Ct.properties,ri=et(Ct.geometry.coordinates[0]),Ht=Je(Ct.geometry.coordinates[1])}const _i={type:1,geometry:[[Math.round(this.options.extent*(ri*nt-Ne)),Math.round(this.options.extent*(Ht*nt-We))]],tags:Nt};let ai;Tt?ai=wt.id:this.options.generateId?ai=wt.index:this.points[wt.index].id&&(ai=this.points[wt.index].id),ai!==void 0&&(_i.id=ai),vt.features.push(_i)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(+le,this.options.maxZoom+1))}_cluster(le,Se){const Ne=[],{radius:We,extent:nt,reduce:vt,minPoints:Dt}=this.options,wt=We/(nt*Math.pow(2,Se));for(let Tt=0;Tt<le.length;Tt++){const Nt=le[Tt];if(Nt.zoom<=Se)continue;Nt.zoom=Se;const ri=this.trees[Se+1],Ht=ri.within(Nt.x,Nt.y,wt),_i=Nt.numPoints||1;let ai=_i;for(const Ct of Ht){const Ut=ri.points[Ct];Ut.zoom>Se&&(ai+=Ut.numPoints||1)}if(ai>_i&&ai>=Dt){let Ct=Nt.x*_i,Ut=Nt.y*_i,Mi=vt&&_i>1?this._map(Nt,!0):null;const ki=(Tt<<5)+(Se+1)+this.points.length;for(const Si of Ht){const Bi=ri.points[Si];if(Bi.zoom<=Se)continue;Bi.zoom=Se;const zi=Bi.numPoints||1;Ct+=Bi.x*zi,Ut+=Bi.y*zi,Bi.parentId=ki,vt&&(Mi||(Mi=this._map(Nt,!0)),vt(Mi,this._map(Bi)))}Nt.parentId=ki,Ne.push(tt(Ct/ai,Ut/ai,ki,ai,Mi))}else if(Ne.push(Nt),ai>1)for(const Ct of Ht){const Ut=ri.points[Ct];Ut.zoom<=Se||(Ut.zoom=Se,Ne.push(Ut))}}return Ne}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,Se){if(le.numPoints)return Se?Ge({},le.properties):le.properties;const Ne=this.points[le.index].properties,We=this.options.map(Ne);return Se&&We===Ne?Ge({},We):We}}function tt(re,le,Se,Ne,We){return{x:De(re),y:De(le),zoom:1/0,id:Se,parentId:-1,numPoints:Ne,properties:We}}function ot(re,le){const[Se,Ne]=re.geometry.coordinates;return{x:De(et(Se)),y:De(Je(Ne)),zoom:1/0,index:le,parentId:-1}}function lt(re){return{type:"Feature",id:re.id,properties:St(re),geometry:{type:"Point",coordinates:[(le=re.x,360*(le-.5)),Be(re.y)]}};var le}function St(re){const le=re.numPoints,Se=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le;return Ge(Ge({},re.properties),{cluster:!0,cluster_id:re.id,point_count:le,point_count_abbreviated:Se})}function et(re){return re/360+.5}function Je(re){const le=Math.sin(re*Math.PI/180),Se=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return Se<0?0:Se>1?1:Se}function Be(re){const le=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function Ge(re,le){for(const Se in le)re[Se]=le[Se];return re}function He(re){return re.x}function ve(re){return re.y}function _e(re,le,Se,Ne){for(var We,nt=Ne,vt=Se-le>>1,Dt=Se-le,wt=re[le],Tt=re[le+1],Nt=re[Se],ri=re[Se+1],Ht=le+3;Ht<Se;Ht+=3){var _i=pe(re[Ht],re[Ht+1],wt,Tt,Nt,ri);if(_i>nt)We=Ht,nt=_i;else if(_i===nt){var ai=Math.abs(Ht-vt);ai<Dt&&(We=Ht,Dt=ai)}}nt>Ne&&(We-le>3&&_e(re,le,We,Ne),re[We+2]=nt,Se-We>3&&_e(re,We,Se,Ne))}function pe(re,le,Se,Ne,We,nt){var vt=We-Se,Dt=nt-Ne;if(vt!==0||Dt!==0){var wt=((re-Se)*vt+(le-Ne)*Dt)/(vt*vt+Dt*Dt);wt>1?(Se=We,Ne=nt):wt>0&&(Se+=vt*wt,Ne+=Dt*wt)}return(vt=re-Se)*vt+(Dt=le-Ne)*Dt}function fe(re,le,Se,Ne){var We={id:re===void 0?null:re,type:le,geometry:Se,tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var vt=nt.geometry,Dt=nt.type;if(Dt==="Point"||Dt==="MultiPoint"||Dt==="LineString")ue(nt,vt);else if(Dt==="Polygon"||Dt==="MultiLineString")for(var wt=0;wt<vt.length;wt++)ue(nt,vt[wt]);else if(Dt==="MultiPolygon")for(wt=0;wt<vt.length;wt++)for(var Tt=0;Tt<vt[wt].length;Tt++)ue(nt,vt[wt][Tt])}(We),We}function ue(re,le){for(var Se=0;Se<le.length;Se+=3)re.minX=Math.min(re.minX,le[Se]),re.minY=Math.min(re.minY,le[Se+1]),re.maxX=Math.max(re.maxX,le[Se]),re.maxY=Math.max(re.maxY,le[Se+1])}function ce(re,le,Se,Ne){if(le.geometry){var We=le.geometry.coordinates,nt=le.geometry.type,vt=Math.pow(Se.tolerance/((1<<Se.maxZoom)*Se.extent),2),Dt=[],wt=le.id;if(Se.promoteId?wt=le.properties[Se.promoteId]:Se.generateId&&(wt=Ne||0),nt==="Point")Ee(We,Dt);else if(nt==="MultiPoint")for(var Tt=0;Tt<We.length;Tt++)Ee(We[Tt],Dt);else if(nt==="LineString")Ye(We,Dt,vt,!1);else if(nt==="MultiLineString"){if(Se.lineMetrics){for(Tt=0;Tt<We.length;Tt++)Ye(We[Tt],Dt=[],vt,!1),re.push(fe(wt,"LineString",Dt,le.properties));return}ft(We,Dt,vt,!1)}else if(nt==="Polygon")ft(We,Dt,vt,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(Tt=0;Tt<le.geometry.geometries.length;Tt++)ce(re,{id:wt,geometry:le.geometry.geometries[Tt],properties:le.properties},Se,Ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Tt=0;Tt<We.length;Tt++){var Nt=[];ft(We[Tt],Nt,vt,!0),Dt.push(Nt)}}re.push(fe(wt,nt,Dt,le.properties))}}function Ee(re,le){le.push(_t(re[0])),le.push(It(re[1])),le.push(0)}function Ye(re,le,Se,Ne){for(var We,nt,vt=0,Dt=0;Dt<re.length;Dt++){var wt=_t(re[Dt][0]),Tt=It(re[Dt][1]);le.push(wt),le.push(Tt),le.push(0),Dt>0&&(vt+=Ne?(We*Tt-wt*nt)/2:Math.sqrt(Math.pow(wt-We,2)+Math.pow(Tt-nt,2))),We=wt,nt=Tt}var Nt=le.length-3;le[2]=1,_e(le,0,Nt,Se),le[Nt+2]=1,le.size=Math.abs(vt),le.start=0,le.end=le.size}function ft(re,le,Se,Ne){for(var We=0;We<re.length;We++){var nt=[];Ye(re[We],nt,Se,Ne),le.push(nt)}}function _t(re){return re/360+.5}function It(re){var le=Math.sin(re*Math.PI/180),Se=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return Se<0?0:Se>1?1:Se}function $t(re,le,Se,Ne,We,nt,vt,Dt){if(Ne/=le,nt>=(Se/=le)&&vt<Ne)return re;if(vt<Se||nt>=Ne)return null;for(var wt=[],Tt=0;Tt<re.length;Tt++){var Nt=re[Tt],ri=Nt.geometry,Ht=Nt.type,_i=We===0?Nt.minX:Nt.minY,ai=We===0?Nt.maxX:Nt.maxY;if(_i>=Se&&ai<Ne)wt.push(Nt);else if(!(ai<Se||_i>=Ne)){var Ct=[];if(Ht==="Point"||Ht==="MultiPoint")Yt(ri,Ct,Se,Ne,We);else if(Ht==="LineString")ii(ri,Ct,Se,Ne,We,!1,Dt.lineMetrics);else if(Ht==="MultiLineString")qt(ri,Ct,Se,Ne,We,!1);else if(Ht==="Polygon")qt(ri,Ct,Se,Ne,We,!0);else if(Ht==="MultiPolygon")for(var Ut=0;Ut<ri.length;Ut++){var Mi=[];qt(ri[Ut],Mi,Se,Ne,We,!0),Mi.length&&Ct.push(Mi)}if(Ct.length){if(Dt.lineMetrics&&Ht==="LineString"){for(Ut=0;Ut<Ct.length;Ut++)wt.push(fe(Nt.id,Ht,Ct[Ut],Nt.tags));continue}Ht!=="LineString"&&Ht!=="MultiLineString"||(Ct.length===1?(Ht="LineString",Ct=Ct[0]):Ht="MultiLineString"),Ht!=="Point"&&Ht!=="MultiPoint"||(Ht=Ct.length===3?"Point":"MultiPoint"),wt.push(fe(Nt.id,Ht,Ct,Nt.tags))}}}return wt.length?wt:null}function Yt(re,le,Se,Ne,We){for(var nt=0;nt<re.length;nt+=3){var vt=re[nt+We];vt>=Se&&vt<=Ne&&(le.push(re[nt]),le.push(re[nt+1]),le.push(re[nt+2]))}}function ii(re,le,Se,Ne,We,nt,vt){for(var Dt,wt,Tt=zt(re),Nt=We===0?fi:hi,ri=re.start,Ht=0;Ht<re.length-3;Ht+=3){var _i=re[Ht],ai=re[Ht+1],Ct=re[Ht+2],Ut=re[Ht+3],Mi=re[Ht+4],ki=We===0?_i:ai,Si=We===0?Ut:Mi,Bi=!1;vt&&(Dt=Math.sqrt(Math.pow(_i-Ut,2)+Math.pow(ai-Mi,2))),ki<Se?Si>Se&&(wt=Nt(Tt,_i,ai,Ut,Mi,Se),vt&&(Tt.start=ri+Dt*wt)):ki>Ne?Si<Ne&&(wt=Nt(Tt,_i,ai,Ut,Mi,Ne),vt&&(Tt.start=ri+Dt*wt)):Vt(Tt,_i,ai,Ct),Si<Se&&ki>=Se&&(wt=Nt(Tt,_i,ai,Ut,Mi,Se),Bi=!0),Si>Ne&&ki<=Ne&&(wt=Nt(Tt,_i,ai,Ut,Mi,Ne),Bi=!0),!nt&&Bi&&(vt&&(Tt.end=ri+Dt*wt),le.push(Tt),Tt=zt(re)),vt&&(ri+=Dt)}var zi=re.length-3;_i=re[zi],ai=re[zi+1],Ct=re[zi+2],(ki=We===0?_i:ai)>=Se&&ki<=Ne&&Vt(Tt,_i,ai,Ct),zi=Tt.length-3,nt&&zi>=3&&(Tt[zi]!==Tt[0]||Tt[zi+1]!==Tt[1])&&Vt(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&le.push(Tt)}function zt(re){var le=[];return le.size=re.size,le.start=re.start,le.end=re.end,le}function qt(re,le,Se,Ne,We,nt){for(var vt=0;vt<re.length;vt++)ii(re[vt],le,Se,Ne,We,nt,!1)}function Vt(re,le,Se,Ne){re.push(le),re.push(Se),re.push(Ne)}function fi(re,le,Se,Ne,We,nt){var vt=(nt-le)/(Ne-le);return re.push(nt),re.push(Se+(We-Se)*vt),re.push(1),vt}function hi(re,le,Se,Ne,We,nt){var vt=(nt-Se)/(We-Se);return re.push(le+(Ne-le)*vt),re.push(nt),re.push(1),vt}function Me(re,le){for(var Se=[],Ne=0;Ne<re.length;Ne++){var We,nt=re[Ne],vt=nt.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")We=bt(nt.geometry,le);else if(vt==="MultiLineString"||vt==="Polygon"){We=[];for(var Dt=0;Dt<nt.geometry.length;Dt++)We.push(bt(nt.geometry[Dt],le))}else if(vt==="MultiPolygon")for(We=[],Dt=0;Dt<nt.geometry.length;Dt++){for(var wt=[],Tt=0;Tt<nt.geometry[Dt].length;Tt++)wt.push(bt(nt.geometry[Dt][Tt],le));We.push(wt)}Se.push(fe(nt.id,vt,We,nt.tags))}return Se}function bt(re,le){var Se=[];Se.size=re.size,re.start!==void 0&&(Se.start=re.start,Se.end=re.end);for(var Ne=0;Ne<re.length;Ne+=3)Se.push(re[Ne]+le,re[Ne+1],re[Ne+2]);return Se}function At(re,le){if(re.transformed)return re;var Se,Ne,We,nt=1<<re.z,vt=re.x,Dt=re.y;for(Se=0;Se<re.features.length;Se++){var wt=re.features[Se],Tt=wt.geometry,Nt=wt.type;if(wt.geometry=[],Nt===1)for(Ne=0;Ne<Tt.length;Ne+=2)wt.geometry.push(Bt(Tt[Ne],Tt[Ne+1],le,nt,vt,Dt));else for(Ne=0;Ne<Tt.length;Ne++){var ri=[];for(We=0;We<Tt[Ne].length;We+=2)ri.push(Bt(Tt[Ne][We],Tt[Ne][We+1],le,nt,vt,Dt));wt.geometry.push(ri)}}return re.transformed=!0,re}function Bt(re,le,Se,Ne,We,nt){return[Math.round(Se*(re*Ne-We)),Math.round(Se*(le*Ne-nt))]}function pt(re,le,Se,Ne,We){for(var nt=le===We.maxZoom?0:We.tolerance/((1<<le)*We.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Se,y:Ne,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Dt=0;Dt<re.length;Dt++){vt.numFeatures++,Rt(vt,re[Dt],nt,We);var wt=re[Dt].minX,Tt=re[Dt].minY,Nt=re[Dt].maxX,ri=re[Dt].maxY;wt<vt.minX&&(vt.minX=wt),Tt<vt.minY&&(vt.minY=Tt),Nt>vt.maxX&&(vt.maxX=Nt),ri>vt.maxY&&(vt.maxY=ri)}return vt}function Rt(re,le,Se,Ne){var We=le.geometry,nt=le.type,vt=[];if(nt==="Point"||nt==="MultiPoint")for(var Dt=0;Dt<We.length;Dt+=3)vt.push(We[Dt]),vt.push(We[Dt+1]),re.numPoints++,re.numSimplified++;else if(nt==="LineString")Ve(vt,We,re,Se,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(Dt=0;Dt<We.length;Dt++)Ve(vt,We[Dt],re,Se,nt==="Polygon",Dt===0);else if(nt==="MultiPolygon")for(var wt=0;wt<We.length;wt++){var Tt=We[wt];for(Dt=0;Dt<Tt.length;Dt++)Ve(vt,Tt[Dt],re,Se,!0,Dt===0)}if(vt.length){var Nt=le.tags||null;if(nt==="LineString"&&Ne.lineMetrics){for(var ri in Nt={},le.tags)Nt[ri]=le.tags[ri];Nt.mapbox_clip_start=We.start/We.size,Nt.mapbox_clip_end=We.end/We.size}var Ht={geometry:vt,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:Nt};le.id!==null&&(Ht.id=le.id),re.features.push(Ht)}}function Ve(re,le,Se,Ne,We,nt){var vt=Ne*Ne;if(Ne>0&&le.size<(We?vt:Ne))Se.numPoints+=le.length/3;else{for(var Dt=[],wt=0;wt<le.length;wt+=3)(Ne===0||le[wt+2]>vt)&&(Se.numSimplified++,Dt.push(le[wt]),Dt.push(le[wt+1])),Se.numPoints++;We&&function(Tt,Nt){for(var ri=0,Ht=0,_i=Tt.length,ai=_i-2;Ht<_i;ai=Ht,Ht+=2)ri+=(Tt[Ht]-Tt[ai])*(Tt[Ht+1]+Tt[ai+1]);if(ri>0===Nt)for(Ht=0,_i=Tt.length;Ht<_i/2;Ht+=2){var Ct=Tt[Ht],Ut=Tt[Ht+1];Tt[Ht]=Tt[_i-2-Ht],Tt[Ht+1]=Tt[_i-1-Ht],Tt[_i-2-Ht]=Ct,Tt[_i-1-Ht]=Ut}}(Dt,nt),re.push(Dt)}}function jt(re,le){var Se=(le=this.options=function(We,nt){for(var vt in nt)We[vt]=nt[vt];return We}(Object.create(this.options),le)).debug;if(Se&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ne=function(We,nt){var vt=[];if(We.type==="FeatureCollection")for(var Dt=0;Dt<We.features.length;Dt++)ce(vt,We.features[Dt],nt,Dt);else ce(vt,We.type==="Feature"?We:{geometry:We},nt);return vt}(re,le);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ne=function(We,nt){var vt=nt.buffer/nt.extent,Dt=We,wt=$t(We,1,-1-vt,vt,0,-1,2,nt),Tt=$t(We,1,1-vt,2+vt,0,-1,2,nt);return(wt||Tt)&&(Dt=$t(We,1,-vt,1+vt,0,-1,2,nt)||[],wt&&(Dt=Me(wt,1).concat(Dt)),Tt&&(Dt=Dt.concat(Me(Tt,-1)))),Dt}(Ne,le)).length&&this.splitTile(Ne,0,0,0),Se&&(Ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mi(re,le,Se){return 32*((1<<re)*Se+le)+re}function ie(re,le){const Se=re.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const Ne=this._geoJSONIndex.getTile(Se.z,Se.x,Se.y);if(!Ne)return le(null,null);const We=new U(Ne.features);let nt=Y(We);nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),le(null,{vectorTile:We,rawData:nt.buffer})}jt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jt.prototype.splitTile=function(re,le,Se,Ne,We,nt,vt){for(var Dt=[re,le,Se,Ne],wt=this.options,Tt=wt.debug;Dt.length;){Ne=Dt.pop(),Se=Dt.pop(),le=Dt.pop(),re=Dt.pop();var Nt=1<<le,ri=mi(le,Se,Ne),Ht=this.tiles[ri];if(!Ht&&(Tt>1&&console.time("creation"),Ht=this.tiles[ri]=pt(re,le,Se,Ne,wt),this.tileCoords.push({z:le,x:Se,y:Ne}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,Se,Ne,Ht.numFeatures,Ht.numPoints,Ht.numSimplified),console.timeEnd("creation"));var _i="z"+le;this.stats[_i]=(this.stats[_i]||0)+1,this.total++}if(Ht.source=re,We){if(le===wt.maxZoom||le===We)continue;var ai=1<<We-le;if(Se!==Math.floor(nt/ai)||Ne!==Math.floor(vt/ai))continue}else if(le===wt.indexMaxZoom||Ht.numPoints<=wt.indexMaxPoints)continue;if(Ht.source=null,re.length!==0){Tt>1&&console.time("clipping");var Ct,Ut,Mi,ki,Si,Bi,zi=.5*wt.buffer/wt.extent,un=.5-zi,Gr=.5+zi,gi=1+zi;Ct=Ut=Mi=ki=null,Si=$t(re,Nt,Se-zi,Se+Gr,0,Ht.minX,Ht.maxX,wt),Bi=$t(re,Nt,Se+un,Se+gi,0,Ht.minX,Ht.maxX,wt),re=null,Si&&(Ct=$t(Si,Nt,Ne-zi,Ne+Gr,1,Ht.minY,Ht.maxY,wt),Ut=$t(Si,Nt,Ne+un,Ne+gi,1,Ht.minY,Ht.maxY,wt),Si=null),Bi&&(Mi=$t(Bi,Nt,Ne-zi,Ne+Gr,1,Ht.minY,Ht.maxY,wt),ki=$t(Bi,Nt,Ne+un,Ne+gi,1,Ht.minY,Ht.maxY,wt),Bi=null),Tt>1&&console.timeEnd("clipping"),Dt.push(Ct||[],le+1,2*Se,2*Ne),Dt.push(Ut||[],le+1,2*Se,2*Ne+1),Dt.push(Mi||[],le+1,2*Se+1,2*Ne),Dt.push(ki||[],le+1,2*Se+1,2*Ne+1)}}},jt.prototype.getTile=function(re,le,Se){var Ne=this.options,We=Ne.extent,nt=Ne.debug;if(re<0||re>24)return null;var vt=1<<re,Dt=mi(re,le=(le%vt+vt)%vt,Se);if(this.tiles[Dt])return At(this.tiles[Dt],We);nt>1&&console.log("drilling down to z%d-%d-%d",re,le,Se);for(var wt,Tt=re,Nt=le,ri=Se;!wt&&Tt>0;)Tt--,Nt=Math.floor(Nt/2),ri=Math.floor(ri/2),wt=this.tiles[mi(Tt,Nt,ri)];return wt&&wt.source?(nt>1&&console.log("found parent tile z%d-%d-%d",Tt,Nt,ri),nt>1&&console.time("drilling down"),this.splitTile(wt.source,Tt,Nt,ri,re,le,Se),nt>1&&console.timeEnd("drilling down"),this.tiles[Dt]?At(this.tiles[Dt],We):null):null};class ke extends h.VectorTileWorkerSource{constructor(le,Se,Ne,We,nt){super(le,Se,Ne,We,ie),nt&&(this.loadGeoJSON=nt)}loadData(le,Se){const Ne=le&&le.request,We=Ne&&Ne.collectResourceTiming;this.loadGeoJSON(le,(nt,vt)=>{if(nt||!vt)return Se(nt);if(typeof vt!="object")return Se(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{D(vt,!0);try{if(le.filter){const wt=h.createExpression(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(wt.result==="error")throw new Error(wt.value.map(Nt=>`${Nt.key}: ${Nt.message}`).join(", "));const Tt=vt.features.filter(Nt=>wt.value.evaluate({zoom:0},Nt));vt={type:"FeatureCollection",features:Tt}}this._geoJSONIndex=le.cluster?new it(function({superclusterOptions:wt,clusterProperties:Tt}){if(!Tt||!wt)return wt;const Nt={},ri={},Ht={accumulated:null,zoom:0},_i={properties:null},ai=Object.keys(Tt);for(const Ct of ai){const[Ut,Mi]=Tt[Ct],ki=h.createExpression(Mi),Si=h.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",Ct]]:Ut);Nt[Ct]=ki.value,ri[Ct]=Si.value}return wt.map=Ct=>{_i.properties=Ct;const Ut={};for(const Mi of ai)Ut[Mi]=Nt[Mi].evaluate(Ht,_i);return Ut},wt.reduce=(Ct,Ut)=>{_i.properties=Ut;for(const Mi of ai)Ht.accumulated=Ct[Mi],Ct[Mi]=ri[Mi].evaluate(Ht,_i)},wt}(le)).load(vt.features):function(wt,Tt){return new jt(wt,Tt)}(vt,le.geojsonVtOptions)}catch(wt){return Se(wt)}this.loaded={};const Dt={};if(We){const wt=h.getPerformanceMeasurement(Ne);wt&&(Dt.resourceTiming={},Dt.resourceTiming[le.source]=JSON.parse(JSON.stringify(wt)))}Se(null,Dt)}})}reloadTile(le,Se){const Ne=this.loaded;return Ne&&Ne[le.uid]?super.reloadTile(le,Se):this.loadTile(le,Se)}loadGeoJSON(le,Se){if(le.request)h.getJSON(le.request,Se);else{if(typeof le.data!="string")return Se(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return Se(null,JSON.parse(le.data))}catch{return Se(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,Se){try{Se(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(Ne){Se(Ne)}}getClusterChildren(le,Se){try{Se(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(Ne){Se(Ne)}}getClusterLeaves(le,Se){try{Se(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(Ne){Se(Ne)}}}class Ke{constructor(le){this.self=le,this.actor=new h.Actor(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:ke},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Se,Ne)=>{if(this.workerSourceTypes[Se])throw new Error(`Worker source with name "${Se}" already registered.`);this.workerSourceTypes[Se]=Ne},this.self.registerRTLTextPlugin=Se=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=Se.applyArabicShaping,h.plugin.processBidirectionalText=Se.processBidirectionalText,h.plugin.processStyledBidirectionalText=Se.processStyledBidirectionalText}}clearCaches(le,Se,Ne){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],Ne()}checkIfReady(le,Se,Ne){Ne()}setReferrer(le,Se){this.referrer=Se}spriteLoaded(le,Se){this.isSpriteLoaded[le]=Se;for(const Ne in this.workerSources[le]){const We=this.workerSources[le][Ne];for(const nt in We)We[nt]instanceof h.VectorTileWorkerSource&&(We[nt].isSpriteLoaded=Se,We[nt].fire(new h.Event("isSpriteLoaded")))}}setImages(le,Se,Ne){this.availableImages[le]=Se;for(const We in this.workerSources[le]){const nt=this.workerSources[le][We];for(const vt in nt)nt[vt].availableImages=Se}Ne()}enableTerrain(le,Se,Ne){this.terrain=Se,Ne()}setProjection(le,Se){this.projections[le]=h.getProjection(Se)}setLayers(le,Se,Ne){this.getLayerIndex(le).replace(Se),Ne()}updateLayers(le,Se,Ne){this.getLayerIndex(le).update(Se.layers,Se.removedIds),Ne()}loadTile(le,Se,Ne){const We=this.enableTerrain?h.extend({enableTerrain:this.terrain},Se):Se;We.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,Se.type,Se.source).loadTile(We,Ne)}loadDEMTile(le,Se,Ne){const We=this.enableTerrain?h.extend({buildQuadTree:this.terrain},Se):Se;this.getDEMWorkerSource(le,Se.source).loadTile(We,Ne)}reloadTile(le,Se,Ne){const We=this.enableTerrain?h.extend({enableTerrain:this.terrain},Se):Se;We.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,Se.type,Se.source).reloadTile(We,Ne)}abortTile(le,Se,Ne){this.getWorkerSource(le,Se.type,Se.source).abortTile(Se,Ne)}removeTile(le,Se,Ne){this.getWorkerSource(le,Se.type,Se.source).removeTile(Se,Ne)}removeSource(le,Se,Ne){if(!this.workerSources[le]||!this.workerSources[le][Se.type]||!this.workerSources[le][Se.type][Se.source])return;const We=this.workerSources[le][Se.type][Se.source];delete this.workerSources[le][Se.type][Se.source],We.removeSource!==void 0?We.removeSource(Se,Ne):Ne()}loadWorkerSource(le,Se,Ne){try{this.self.importScripts(Se.url),Ne()}catch(We){Ne(We.toString())}}syncRTLPluginState(le,Se,Ne){try{h.plugin.setState(Se);const We=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&We!=null){this.self.importScripts(We);const nt=h.plugin.isParsed();Ne(nt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${We}`),nt)}}catch(We){Ne(We.toString())}}getAvailableImages(le){let Se=this.availableImages[le];return Se||(Se=[]),Se}getLayerIndex(le){let Se=this.layerIndexes[le];return Se||(Se=this.layerIndexes[le]=new A),Se}getWorkerSource(le,Se,Ne){return this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][Se]||(this.workerSources[le][Se]={}),this.workerSources[le][Se][Ne]||(this.workerSources[le][Se][Ne]=new this.workerSourceTypes[Se]({send:(We,nt,vt,Dt,wt,Tt)=>{this.actor.send(We,nt,vt,le,wt,Tt)},scheduler:this.actor.scheduler},this.getLayerIndex(le),this.getAvailableImages(le),this.isSpriteLoaded[le])),this.workerSources[le][Se][Ne]}getDEMWorkerSource(le,Se){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][Se]||(this.demWorkerSources[le][Se]=new P),this.demWorkerSources[le][Se]}enforceCacheSizeLimit(le,Se){h.enforceCacheSizeLimit(Se)}getWorkerPerformanceMetrics(le,Se,Ne){Ne(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ke(self)),Ke}),E(["./shared"],function(h){var I=T;function T($){return!function(y){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var G,K,Q=new Blob([""],{type:"text/javascript"}),se=URL.createObjectURL(Q);try{K=new Worker(se),G=!0}catch{G=!1}return K&&K.terminate(),URL.revokeObjectURL(se),G}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var G=document.createElement("canvas");G.width=G.height=1;var K=G.getContext("2d");if(!K)return!1;var Q=K.getImageData(0,0,1,1);return Q&&Q.width===G.width}()?(A[L=y&&y.failIfMajorPerformanceCaveat]===void 0&&(A[L]=function(G){var K,Q=function(se){var ge=document.createElement("canvas"),Ce=Object.create(T.webGLContextAttributes);return Ce.failIfMajorPerformanceCaveat=se,ge.getContext("webgl",Ce)||ge.getContext("experimental-webgl",Ce)}(G);if(!Q)return!1;try{K=Q.createShader(Q.VERTEX_SHADER)}catch{return!1}return!(!K||Q.isContextLost())&&(Q.shaderSource(K,"void main() {}"),Q.compileShader(K),Q.getShaderParameter(K,Q.COMPILE_STATUS)===!0)}(L)),A[L]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var L}($)}var A={};function k($,y){if(Array.isArray($)){if(!Array.isArray(y)||$.length!==y.length)return!1;for(let L=0;L<$.length;L++)if(!k($[L],y[L]))return!1;return!0}if(typeof $=="object"&&$!==null&&y!==null){if(typeof y!="object"||Object.keys($).length!==Object.keys(y).length)return!1;for(const L in $)if(!k($[L],y[L]))return!1;return!0}return $===y}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const P={create:function($,y,L){const G=h.window.document.createElement($);return y!==void 0&&(G.className=y),L&&L.appendChild(G),G},createNS:function($,y){return h.window.document.createElementNS($,y)}},D=h.window.document&&h.window.document.documentElement.style,M=D&&D.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;P.disableDrag=function(){D&&M&&(F=D[M],D[M]="none")},P.enableDrag=function(){D&&M&&(D[M]=F)},P.setTransform=function($,y){$.style.transform=y};let N=!1;try{const $=Object.defineProperty({},"passive",{get(){N=!0}});h.window.addEventListener("test",$,$),h.window.removeEventListener("test",$,$)}catch{N=!1}P.addEventListener=function($,y,L,G={}){$.addEventListener(y,L,"passive"in G&&N?G:G.capture)},P.removeEventListener=function($,y,L,G={}){$.removeEventListener(y,L,"passive"in G&&N?G:G.capture)};const B=function($){$.preventDefault(),$.stopPropagation(),h.window.removeEventListener("click",B,!0)};function U($,y,L){const G=$.offsetWidth===y.width?1:$.offsetWidth/y.width;return new h.pointGeometry((L.clientX-y.left)*G,(L.clientY-y.top)*G)}function O($,y){var L=y[0],G=y[1],K=y[2],Q=y[3],se=L*Q-K*G;return se?($[0]=Q*(se=1/se),$[1]=-G*se,$[2]=-K*se,$[3]=L*se,$):null}P.suppressClick=function(){h.window.addEventListener("click",B,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",B,!0)},0)},P.mousePos=function($,y){const L=$.getBoundingClientRect();return U($,L,y)},P.touchPos=function($,y){const L=$.getBoundingClientRect(),G=[];for(let K=0;K<y.length;K++)G.push(U($,L,y[K]));return G},P.mouseButton=function($){return h.window.InstallTrigger!==void 0&&$.button===2&&$.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:$.button},P.remove=function($){$.parentNode&&$.parentNode.removeChild($)};class V{constructor(y,L){this.pos=y,this.dir=L}intersectsPlane(y,L,G){const K=h.dot(L,this.dir);if(Math.abs(K)<1e-6)return!1;const Q=h.dot(h.sub(h.create(),y,this.pos),L)/K,se=h.scaleAndAdd(h.create(),this.pos,this.dir,Q);return h.copy(G,se),!0}}class Z{constructor(y,L){this.points=y,this.planes=L}static fromInvProjectionMatrix(y,L,G){const K=Math.pow(2,G),Q=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ge=>{const Ce=h.transformMat4([],ge,y),Oe=1/Ce[3]/L*K;return h.mul(Ce,Ce,[Oe,Oe,1/Ce[3],Oe])}),se=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ge=>{const Ce=h.sub([],Q[ge[0]],Q[ge[1]]),Oe=h.sub([],Q[ge[2]],Q[ge[1]]),Fe=h.normalize([],h.cross([],Ce,Oe)),Ue=-h.dot(Fe,Q[ge[1]]);return Fe.concat(Ue)});return new Z(Q,se)}}class W{constructor(y,L){this.min=y,this.max=L,this.center=h.scale([],h.add([],this.min,this.max),.5)}quadrant(y){const L=[y%2==0,y<2],G=h.clone(this.min),K=h.clone(this.max);for(let Q=0;Q<L.length;Q++)G[Q]=L[Q]?this.min[Q]:this.center[Q],K[Q]=L[Q]?this.center[Q]:this.max[Q];return K[2]=this.max[2],new W(G,K)}distanceX(y){return Math.max(Math.min(this.max[0],y[0]),this.min[0])-y[0]}distanceY(y){return Math.max(Math.min(this.max[1],y[1]),this.min[1])-y[1]}distanceZ(y){return Math.max(Math.min(this.max[2],y[2]),this.min[2])-y[2]}intersects(y){const L=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let G=!0;for(let K=0;K<y.planes.length;K++){const Q=y.planes[K];let se=0;for(let ge=0;ge<L.length;ge++)se+=h.dot$1(Q,L[ge])>=0;if(se===0)return 0;se!==L.length&&(G=!1)}if(G)return 2;for(let K=0;K<3;K++){let Q=Number.MAX_VALUE,se=-Number.MAX_VALUE;for(let ge=0;ge<y.points.length;ge++){const Ce=y.points[ge][K]-this.min[K];Q=Math.min(Q,Ce),se=Math.max(se,Ce)}if(se<0||Q>this.max[K]-this.min[K])return 0}return 1}}function Y($){const{userImage:y}=$;return!!(y&&y.render&&y.render())&&($.data.replace(new Uint8Array(y.data.buffer)),!0)}class X extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(y){if(this.loaded!==y&&(this.loaded=y,y)){for(const{ids:L,callback:G}of this.requestors)this._notify(L,G);this.requestors=[]}}getImage(y){return this.images[y]}addImage(y,L){this._validate(y,L)&&(this.images[y]=L)}_validate(y,L){let G=!0;return this._validateStretch(L.stretchX,L.data&&L.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${y}" has invalid "stretchX" value`))),G=!1),this._validateStretch(L.stretchY,L.data&&L.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${y}" has invalid "stretchY" value`))),G=!1),this._validateContent(L.content,L)||(this.fire(new h.ErrorEvent(new Error(`Image "${y}" has invalid "content" value`))),G=!1),G}_validateStretch(y,L){if(!y)return!0;let G=0;for(const K of y){if(K[0]<G||K[1]<K[0]||L<K[1])return!1;G=K[1]}return!0}_validateContent(y,L){return!(y&&(y.length!==4||y[0]<0||L.data.width<y[0]||y[1]<0||L.data.height<y[1]||y[2]<0||L.data.width<y[2]||y[3]<0||L.data.height<y[3]||y[2]<y[0]||y[3]<y[1]))}updateImage(y,L){L.version=this.images[y].version+1,this.images[y]=L,this.updatedImages[y]=!0}removeImage(y){const L=this.images[y];delete this.images[y],delete this.patterns[y],L.userImage&&L.userImage.onRemove&&L.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(y,L){let G=!0;if(!this.isLoaded())for(const K of y)this.images[K]||(G=!1);this.isLoaded()||G?this._notify(y,L):this.requestors.push({ids:y,callback:L})}_notify(y,L){const G={};for(const K of y){this.images[K]||this.fire(new h.Event("styleimagemissing",{id:K}));const Q=this.images[K];Q?G[K]={data:Q.data.clone(),pixelRatio:Q.pixelRatio,sdf:Q.sdf,version:Q.version,stretchX:Q.stretchX,stretchY:Q.stretchY,content:Q.content,hasRenderCallback:Boolean(Q.userImage&&Q.userImage.render)}:h.warnOnce(`Image "${K}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}L(null,G)}getPixelSize(){const{width:y,height:L}=this.atlasImage;return{width:y,height:L}}getPattern(y){const L=this.patterns[y],G=this.getImage(y);if(!G)return null;if(L&&L.position.version===G.version)return L.position;if(L)L.position.version=G.version;else{const K={w:G.data.width+2,h:G.data.height+2,x:0,y:0},Q=new h.ImagePosition(K,G);this.patterns[y]={bin:K,position:Q}}return this._updatePatternAtlas(),this.patterns[y].position}bind(y){const L=y.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(y,this.atlasImage,L.RGBA),this.atlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE)}_updatePatternAtlas(){const y=[];for(const Q in this.patterns)y.push(this.patterns[Q].bin);const{w:L,h:G}=h.potpack(y),K=this.atlasImage;K.resize({width:L||1,height:G||1});for(const Q in this.patterns){const{bin:se}=this.patterns[Q],ge=se.x+1,Ce=se.y+1,Oe=this.images[Q].data,Fe=Oe.width,Ue=Oe.height;h.RGBAImage.copy(Oe,K,{x:0,y:0},{x:ge,y:Ce},{width:Fe,height:Ue}),h.RGBAImage.copy(Oe,K,{x:0,y:Ue-1},{x:ge,y:Ce-1},{width:Fe,height:1}),h.RGBAImage.copy(Oe,K,{x:0,y:0},{x:ge,y:Ce+Ue},{width:Fe,height:1}),h.RGBAImage.copy(Oe,K,{x:Fe-1,y:0},{x:ge-1,y:Ce},{width:1,height:Ue}),h.RGBAImage.copy(Oe,K,{x:0,y:0},{x:ge+Fe,y:Ce},{width:1,height:Ue})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(y){for(const L of y){if(this.callbackDispatchedThisFrame[L])continue;this.callbackDispatchedThisFrame[L]=!0;const G=this.images[L];Y(G)&&this.updateImage(L,G)}}}const J=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate($,y){return function([L,G,K]){const Q=h.degToRad(G+90),se=h.degToRad(K);return{x:L*Math.cos(Q)*Math.sin(se),y:L*Math.sin(Q)*Math.sin(se),z:L*Math.cos(se),azimuthal:G,polar:K}}($.expression.evaluate(y))}interpolate($,y,L){return{x:h.number($.x,y.x,L),y:h.number($.y,y.y,L),z:h.number($.z,y.z,L),azimuthal:h.number($.azimuthal,y.azimuthal,L),polar:h.number($.polar,y.polar,L)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),q="-transition";class te extends h.Evented{constructor(y){super(),this._transitionable=new h.Transitionable(J),this.setLight(y),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(y,L={}){if(!this._validate(h.validateLight,y,L))for(const G in y){const K=y[G];h.endsWith(G,q)?this._transitionable.setTransition(G.slice(0,-q.length),K):this._transitionable.setValue(G,K)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,L,G){return(!G||G.validate!==!1)&&h.emitValidationErrors(this,y.call(h.validateStyle,h.extend({value:L,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const ne=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),de="-transition";class oe extends h.Evented{constructor(y){super(),this._transitionable=new h.Transitionable(ne),this.set(y),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(y){for(const L in y){const G=y[L];h.endsWith(L,de)?this._transitionable.setTransition(L.slice(0,-de.length),G):this._transitionable.setValue(L,G)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}}function we($,y,L,G){const K=h.smoothstep(45,65,L),[Q,se]=Ae($,G),ge=h.length(y);let Ce=1-Math.min(1,Math.exp((ge-Q)/(se-Q)*-6));return Ce*=Ce*Ce,Ce=Math.min(1,1.00747*Ce),Ce*K*$.alpha}function Ae($,y){const L=.5/Math.tan(.5*y);return[$.range[0]+L,$.range[1]+L]}const ye=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"])}),me="-transition";class xe extends h.Evented{constructor(y,L){super(),this._transitionable=new h.Transitionable(ye),this.set(y),this._transitioning=this._transitionable.untransitioned(),this._transform=L}isSoftDisabled(){return this._transform.projection.name!=="mercator"}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(y,L={}){if(!this._validate(h.validateFog,y,L))for(const G in y){const K=y[G];h.endsWith(G,me)?this._transitionable.setTransition(G.slice(0,-me.length),K):this._transitionable.setValue(G,K)}}getOpacity(y){if(this.isSoftDisabled())return 0;const L=this.properties&&this.properties.get("color")||1;return h.smoothstep(45,65,y)*L.a}getOpacityAtLatLng(y,L){return this.isSoftDisabled()?0:function(G,K,Q){const se=h.MercatorCoordinate.fromLngLat(K),ge=Q.elevation?Q.elevation.getAtPointOrZero(se):0,Ce=[se.x,se.y,ge];return h.transformMat4$1(Ce,Ce,Q.mercatorFogMatrix),we(G,Ce,Q.pitch,Q._fov)}(this.state,y,L)}getFovAdjustedRange(y){return this.isSoftDisabled()?[0,1]:Ae(this.state,y)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,L,G){return(!G||G.validate!==!1)&&h.emitValidationErrors(this,y.call(h.validateStyle,h.extend({value:L,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class Le{constructor(y,L){this.workerPool=y,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const G=this.workerPool.acquire(this.id);for(let K=0;K<G.length;K++){const Q=new Le.Actor(G[K],L,this.id);Q.name=`Worker ${K}`,this.actors.push(Q)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(y,L,G){h.asyncAll(this.actors,(K,Q)=>{K.send(y,L,Q)},G=G||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(y=>{y.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ze($,y,L){return y*(h.EXTENT/($.tileSize*Math.pow(2,L-$.tileID.overscaledZ)))}Le.Actor=h.Actor;class Xe{constructor(y,L,G,K){this.screenBounds=y,this.cameraPoint=L,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=G,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(Q=>K.pointCoordinate3D(Q)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(y,L){let G,K;if(y instanceof h.pointGeometry||typeof y[0]=="number"){const Q=h.pointGeometry.convert(y);G=[h.pointGeometry.convert(y)],K=L.isPointAboveHorizon(Q)}else{const Q=h.pointGeometry.convert(y[0]),se=h.pointGeometry.convert(y[1]);G=[Q,se],K=h.polygonizeBounds(Q,se).every(ge=>L.isPointAboveHorizon(ge))}return new Xe(G,L.getCameraPoint(),K,L)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(y){return h.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],y)}bufferedCameraGeometry(y){const L=this.screenBounds[0],G=this.screenBounds.length===1?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],K=h.polygonizeBounds(L,G,0,!1);return this.cameraPoint.y>G.y&&(this.cameraPoint.x>L.x&&this.cameraPoint.x<G.x?K.splice(3,0,this.cameraPoint):this.cameraPoint.x>=G.x?K[2]=this.cameraPoint:this.cameraPoint.x<=L.x&&(K[3]=this.cameraPoint)),h.bufferConvexPolygon(K,y)}containsTile(y,L,G){const K=y.queryPadding+1,Q=y.tileID.wrap,se=G?this._bufferedCameraMercator(K,L).map(ct=>h.getTilePoint(y.tileTransform,ct,Q)):this._bufferedScreenMercator(K,L).map(ct=>h.getTilePoint(y.tileTransform,ct,Q)),ge=this.screenGeometryMercator.map(ct=>h.getTileVec3(y.tileTransform,ct,Q)),Ce=ge.map(ct=>new h.pointGeometry(ct[0],ct[1])),Oe=L.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),Fe=h.getTileVec3(y.tileTransform,Oe,Q),Ue=ge.map(ct=>{const at=h.sub(ct,ct,Fe);return h.normalize(at,at),new V(Fe,at)}),Qe=Ze(y,1,L.zoom);if(h.polygonIntersectsBox(se,0,0,h.EXTENT,h.EXTENT))return{queryGeometry:this,tilespaceGeometry:Ce,tilespaceRays:Ue,bufferedTilespaceGeometry:se,bufferedTilespaceBounds:(ht=h.getBounds(se),ht.min.x=h.clamp(ht.min.x,0,h.EXTENT),ht.min.y=h.clamp(ht.min.y,0,h.EXTENT),ht.max.x=h.clamp(ht.max.x,0,h.EXTENT),ht.max.y=h.clamp(ht.max.y,0,h.EXTENT),ht),tile:y,tileID:y.tileID,pixelToTileUnitsFactor:Qe};var ht}_bufferedScreenMercator(y,L){const G=je(y);if(this._screenRaycastCache[G])return this._screenRaycastCache[G];{const K=this.bufferedScreenGeometry(y).map(Q=>L.pointCoordinate3D(Q));return this._screenRaycastCache[G]=K,K}}_bufferedCameraMercator(y,L){const G=je(y);if(this._cameraRaycastCache[G])return this._cameraRaycastCache[G];{const K=this.bufferedCameraGeometry(y).map(Q=>L.pointCoordinate3D(Q));return this._cameraRaycastCache[G]=K,K}}}function je($){return 100*$|0}function Ie($,y,L){const G=function(K,Q){if(K)return L(K);if(Q){const se=h.pick(h.extend(Q,$),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);Q.vector_layers&&(se.vectorLayers=Q.vector_layers,se.vectorLayerIds=se.vectorLayers.map(ge=>ge.id)),se.tiles=y.canonicalizeTileset(se,$.url),L(null,se)}};return $.url?h.getJSON(y.transformRequest(y.normalizeSourceURL($.url),h.ResourceType.Source),G):h.exported.frame(()=>G(null,$))}class Pe{constructor(y,L,G){this.bounds=h.LngLatBounds.convert(this.validateBounds(y)),this.minzoom=L||0,this.maxzoom=G||24}validateBounds(y){return Array.isArray(y)&&y.length===4?[Math.max(-180,y[0]),Math.max(-90,y[1]),Math.min(180,y[2]),Math.min(90,y[3])]:[-180,-90,180,90]}contains(y){const L=Math.pow(2,y.z),G=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*L),K=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*L),Q=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*L),se=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*L);return y.x>=G&&y.x<Q&&y.y>=K&&y.y<se}}class De{constructor(y,L,G){this.context=y;const K=y.gl;this.buffer=K.createBuffer(),this.dynamicDraw=Boolean(G),this.context.unbindVAO(),y.bindElementBuffer.set(this.buffer),K.bufferData(K.ELEMENT_ARRAY_BUFFER,L.arrayBuffer,this.dynamicDraw?K.DYNAMIC_DRAW:K.STATIC_DRAW),this.dynamicDraw||delete L.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(y){const L=this.context.gl;this.context.unbindVAO(),this.bind(),L.bufferSubData(L.ELEMENT_ARRAY_BUFFER,0,y.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ze={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class it{constructor(y,L,G,K){this.length=L.length,this.attributes=G,this.itemSize=L.bytesPerElement,this.dynamicDraw=K,this.context=y;const Q=y.gl;this.buffer=Q.createBuffer(),y.bindVertexBuffer.set(this.buffer),Q.bufferData(Q.ARRAY_BUFFER,L.arrayBuffer,this.dynamicDraw?Q.DYNAMIC_DRAW:Q.STATIC_DRAW),this.dynamicDraw||delete L.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(y){const L=this.context.gl;this.bind(),L.bufferSubData(L.ARRAY_BUFFER,0,y.arrayBuffer)}enableAttributes(y,L){for(let G=0;G<this.attributes.length;G++){const K=L.attributes[this.attributes[G].name];K!==void 0&&y.enableVertexAttribArray(K)}}setVertexAttribPointers(y,L,G){for(let K=0;K<this.attributes.length;K++){const Q=this.attributes[K],se=L.attributes[Q.name];se!==void 0&&y.vertexAttribPointer(se,Q.components,y[ze[Q.type]],!1,this.itemSize,Q.offset+this.itemSize*(G||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tt{constructor(y){this.gl=y.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(y){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ot extends tt{getDefault(){return h.Color.transparent}set(y){const L=this.current;(y.r!==L.r||y.g!==L.g||y.b!==L.b||y.a!==L.a||this.dirty)&&(this.gl.clearColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class lt extends tt{getDefault(){return 1}set(y){(y!==this.current||this.dirty)&&(this.gl.clearDepth(y),this.current=y,this.dirty=!1)}}class St extends tt{getDefault(){return 0}set(y){(y!==this.current||this.dirty)&&(this.gl.clearStencil(y),this.current=y,this.dirty=!1)}}class et extends tt{getDefault(){return[!0,!0,!0,!0]}set(y){const L=this.current;(y[0]!==L[0]||y[1]!==L[1]||y[2]!==L[2]||y[3]!==L[3]||this.dirty)&&(this.gl.colorMask(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class Je extends tt{getDefault(){return!0}set(y){(y!==this.current||this.dirty)&&(this.gl.depthMask(y),this.current=y,this.dirty=!1)}}class Be extends tt{getDefault(){return 255}set(y){(y!==this.current||this.dirty)&&(this.gl.stencilMask(y),this.current=y,this.dirty=!1)}}class Ge extends tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(y){const L=this.current;(y.func!==L.func||y.ref!==L.ref||y.mask!==L.mask||this.dirty)&&(this.gl.stencilFunc(y.func,y.ref,y.mask),this.current=y,this.dirty=!1)}}class He extends tt{getDefault(){const y=this.gl;return[y.KEEP,y.KEEP,y.KEEP]}set(y){const L=this.current;(y[0]!==L[0]||y[1]!==L[1]||y[2]!==L[2]||this.dirty)&&(this.gl.stencilOp(y[0],y[1],y[2]),this.current=y,this.dirty=!1)}}class ve extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;y?L.enable(L.STENCIL_TEST):L.disable(L.STENCIL_TEST),this.current=y,this.dirty=!1}}class _e extends tt{getDefault(){return[0,1]}set(y){const L=this.current;(y[0]!==L[0]||y[1]!==L[1]||this.dirty)&&(this.gl.depthRange(y[0],y[1]),this.current=y,this.dirty=!1)}}class pe extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;y?L.enable(L.DEPTH_TEST):L.disable(L.DEPTH_TEST),this.current=y,this.dirty=!1}}class fe extends tt{getDefault(){return this.gl.LESS}set(y){(y!==this.current||this.dirty)&&(this.gl.depthFunc(y),this.current=y,this.dirty=!1)}}class ue extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;y?L.enable(L.BLEND):L.disable(L.BLEND),this.current=y,this.dirty=!1}}class ce extends tt{getDefault(){const y=this.gl;return[y.ONE,y.ZERO]}set(y){const L=this.current;(y[0]!==L[0]||y[1]!==L[1]||this.dirty)&&(this.gl.blendFunc(y[0],y[1]),this.current=y,this.dirty=!1)}}class Ee extends tt{getDefault(){return h.Color.transparent}set(y){const L=this.current;(y.r!==L.r||y.g!==L.g||y.b!==L.b||y.a!==L.a||this.dirty)&&(this.gl.blendColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class Ye extends tt{getDefault(){return this.gl.FUNC_ADD}set(y){(y!==this.current||this.dirty)&&(this.gl.blendEquation(y),this.current=y,this.dirty=!1)}}class ft extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;y?L.enable(L.CULL_FACE):L.disable(L.CULL_FACE),this.current=y,this.dirty=!1}}class _t extends tt{getDefault(){return this.gl.BACK}set(y){(y!==this.current||this.dirty)&&(this.gl.cullFace(y),this.current=y,this.dirty=!1)}}class It extends tt{getDefault(){return this.gl.CCW}set(y){(y!==this.current||this.dirty)&&(this.gl.frontFace(y),this.current=y,this.dirty=!1)}}class $t extends tt{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}}class Yt extends tt{getDefault(){return this.gl.TEXTURE0}set(y){(y!==this.current||this.dirty)&&(this.gl.activeTexture(y),this.current=y,this.dirty=!1)}}class ii extends tt{getDefault(){const y=this.gl;return[0,0,y.drawingBufferWidth,y.drawingBufferHeight]}set(y){const L=this.current;(y[0]!==L[0]||y[1]!==L[1]||y[2]!==L[2]||y[3]!==L[3]||this.dirty)&&(this.gl.viewport(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class zt extends tt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.bindFramebuffer(L.FRAMEBUFFER,y),this.current=y,this.dirty=!1}}class qt extends tt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.bindRenderbuffer(L.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class Vt extends tt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.bindTexture(L.TEXTURE_2D,y),this.current=y,this.dirty=!1}}class fi extends tt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.bindBuffer(L.ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class hi extends tt{getDefault(){return null}set(y){const L=this.gl;L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class Me extends tt{constructor(y){super(y),this.vao=y.extVertexArrayObject}getDefault(){return null}set(y){this.vao&&(y!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(y),this.current=y,this.dirty=!1)}}class bt extends tt{getDefault(){return 4}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.pixelStorei(L.UNPACK_ALIGNMENT,y),this.current=y,this.dirty=!1}}class At extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),this.current=y,this.dirty=!1}}class Bt extends tt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const L=this.gl;L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,y),this.current=y,this.dirty=!1}}class pt extends tt{constructor(y,L){super(y),this.context=y,this.parent=L}getDefault(){return null}}class Rt extends pt{setDirty(){this.dirty=!0}set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const L=this.gl;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,y,0),this.current=y,this.dirty=!1}}class Ve extends pt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const L=this.gl;L.framebufferRenderbuffer(L.FRAMEBUFFER,this.attachment(),L.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class jt extends Ve{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class mi{constructor(y,L,G,K){this.context=y,this.width=L,this.height=G;const Q=this.framebuffer=y.gl.createFramebuffer();this.colorAttachment=new Rt(y,Q),K&&(this.depthAttachment=new Ve(y,Q))}destroy(){const y=this.context.gl,L=this.colorAttachment.get();if(L&&y.deleteTexture(L),this.depthAttachment){const G=this.depthAttachment.get();G&&y.deleteRenderbuffer(G)}y.deleteFramebuffer(this.framebuffer)}}class ie{constructor(y){this.gl=y,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ot(this),this.clearDepth=new lt(this),this.clearStencil=new St(this),this.colorMask=new et(this),this.depthMask=new Je(this),this.stencilMask=new Be(this),this.stencilFunc=new Ge(this),this.stencilOp=new He(this),this.stencilTest=new ve(this),this.depthRange=new _e(this),this.depthTest=new pe(this),this.depthFunc=new fe(this),this.blend=new ue(this),this.blendFunc=new ce(this),this.blendColor=new Ee(this),this.blendEquation=new Ye(this),this.cullFace=new ft(this),this.cullFaceSide=new _t(this),this.frontFace=new It(this),this.program=new $t(this),this.activeTexture=new Yt(this),this.viewport=new ii(this),this.bindFramebuffer=new zt(this),this.bindRenderbuffer=new qt(this),this.bindTexture=new Vt(this),this.bindVertexBuffer=new fi(this),this.bindElementBuffer=new hi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Me(this),this.pixelStoreUnpack=new bt(this),this.pixelStoreUnpackPremultiplyAlpha=new At(this),this.pixelStoreUnpackFlipY=new Bt(this),this.extTextureFilterAnisotropic=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=y.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=y.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(y.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=y.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=y.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=y.getParameter(y.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(y,L){return new De(this,y,L)}createVertexBuffer(y,L,G){return new it(this,y,L,G)}createRenderbuffer(y,L,G){const K=this.gl,Q=K.createRenderbuffer();return this.bindRenderbuffer.set(Q),K.renderbufferStorage(K.RENDERBUFFER,y,L,G),this.bindRenderbuffer.set(null),Q}createFramebuffer(y,L,G){return new mi(this,y,L,G)}clear({color:y,depth:L,stencil:G}){const K=this.gl;let Q=0;y&&(Q|=K.COLOR_BUFFER_BIT,this.clearColor.set(y),this.colorMask.set([!0,!0,!0,!0])),L!==void 0&&(Q|=K.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(L),this.depthMask.set(!0)),G!==void 0&&(Q|=K.STENCIL_BUFFER_BIT,this.clearStencil.set(G),this.stencilMask.set(255)),K.clear(Q)}setCullFace(y){y.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(y.mode),this.frontFace.set(y.frontFace))}setDepthMode(y){y.func!==this.gl.ALWAYS||y.mask?(this.depthTest.set(!0),this.depthFunc.set(y.func),this.depthMask.set(y.mask),this.depthRange.set(y.range)):this.depthTest.set(!1)}setStencilMode(y){y.test.func!==this.gl.ALWAYS||y.mask?(this.stencilTest.set(!0),this.stencilMask.set(y.mask),this.stencilOp.set([y.fail,y.depthFail,y.pass]),this.stencilFunc.set({func:y.test.func,ref:y.ref,mask:y.test.mask})):this.stencilTest.set(!1)}setColorMode(y){k(y.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(y.blendFunction),this.blendColor.set(y.blendColor)),this.colorMask.set(y.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ke extends h.Evented{constructor(y,L,G,K){super(),this.id=y,this.dispatcher=G,this.setEventedParent(K),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},L),h.extend(this,h.pick(L,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ie(this._options,this.map._requestManager,(y,L)=>{this._tileJSONRequest=null,this._loaded=!0,y?this.fire(new h.ErrorEvent(y)):L&&(h.extend(this,L),L.bounds&&(this.tileBounds=new Pe(L.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(L.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(y){this.map=y,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,L){const G=h.exported.devicePixelRatio>=2,K=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),G,this.tileSize);y.request=h.getImage(this.map._requestManager.transformRequest(K,h.ResourceType.Tile),(Q,se,ge,Ce)=>{if(delete y.request,y.aborted)y.state="unloaded",L(null);else if(Q)y.state="errored",L(Q);else if(se){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:ge,expires:Ce});const Oe=this.map.painter.context,Fe=Oe.gl;y.texture=this.map.painter.getTileTexture(se.width),y.texture?y.texture.update(se,{useMipmap:!0}):(y.texture=new h.Texture(Oe,se,Fe.RGBA,{useMipmap:!0}),y.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Oe.extTextureFilterAnisotropic&&Fe.texParameterf(Fe.TEXTURE_2D,Oe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Oe.extTextureFilterAnisotropicMax)),y.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),L(null)}})}abortTile(y,L){y.request&&(y.request.cancel(),delete y.request),L()}unloadTile(y,L){y.texture&&this.map.painter.saveTileTexture(y.texture),L()}hasTransition(){return!1}}let Ke;class re extends h.Evented{constructor(y,L,G,K){super(),this.id=y,this.dispatcher=G,this.coordinates=L.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(K),this.options=L}load(y,L){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(G,K)=>{this._loaded=!0,G?this.fire(new h.ErrorEvent(G)):K&&(this.image=h.exported.getImageData(K),y&&(this.coordinates=y),L&&L(),this._finishLoading())})}loaded(){return this._loaded}updateImage(y){return this.image&&y.url?(this.options.url=y.url,this.load(y.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(y){this.map=y,this.load()}setCoordinates(y){this.coordinates=y,delete this._boundsArray;const L=y.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(G){let K=1/0,Q=1/0,se=-1/0,ge=-1/0;for(const Ue of G)K=Math.min(K,Ue.x),Q=Math.min(Q,Ue.y),se=Math.max(se,Ue.x),ge=Math.max(ge,Ue.y);const Ce=Math.max(se-K,ge-Q),Oe=Math.max(0,Math.floor(-Math.log(Ce)/Math.LN2)),Fe=Math.pow(2,Oe);return new h.CanonicalTileID(Oe,Math.floor((K+se)/2*Fe),Math.floor((Q+ge)/2*Fe))}(L),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const y=h.tileTransform(this.tileID,this.map.transform.projection),L=this.coordinates.map(G=>{const K=y.projection.project(G[0],G[1]);return h.getTilePoint(y,K)._round()});return this._boundsArray=new h.StructArrayLayout4i8,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,h.EXTENT,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,h.EXTENT),this._boundsArray.emplaceBack(L[2].x,L[2].y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,L=y.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new h.Texture(y,this.image,L.RGBA),this.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE));for(const G in this.tiles){const K=this.tiles[G];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}}loadTile(y,L){this.tileID&&this.tileID.equals(y.tileID.canonical)?(this.tiles[String(y.tileID.wrap)]=y,y.buckets={},L(null)):(y.state="errored",L(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const le={vector:class extends h.Evented{constructor($,y,L,G){if(super(),this.id=$,this.dispatcher=L,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(y,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(G),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ie(this._options,this.map._requestManager,($,y)=>{this._tileJSONRequest=null,this._loaded=!0,$?this.fire(new h.ErrorEvent($)):y&&(h.extend(this,y),y.bounds&&(this.tileBounds=new Pe(y.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(y.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile($){return!this.tileBounds||this.tileBounds.contains($.canonical)}onAdd($){this.map=$,this.load()}setSourceProperty($){this._tileJSONRequest&&this._tileJSONRequest.cancel(),$();const y=this.map.style._getSourceCaches(this.id);for(const L of y)L.clearTiles();this.load()}setTiles($){return this.setSourceProperty(()=>{this._options.tiles=$}),this}setUrl($){return this.setSourceProperty(()=>{this.url=$,this._options.url=$}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile($,y){const L=this.map._requestManager.normalizeTileURL($.tileID.canonical.url(this.tiles,this.scheme)),G={request:this.map._requestManager.transformRequest(L,h.ResourceType.Tile),data:void 0,uid:$.uid,tileID:$.tileID,tileZoom:$.tileZoom,zoom:$.tileID.overscaledZ,tileSize:this.tileSize*$.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:$.isSymbolTile};if(G.request.collectResourceTiming=this._collectResourceTiming,$.actor&&$.state!=="expired")$.state==="loading"?$.reloadCallback=y:$.request=$.actor.send("reloadTile",G,K.bind(this));else if($.actor=this._tileWorkers[L]=this._tileWorkers[L]||this.dispatcher.getActor(),this.dispatcher.ready)$.request=$.actor.send("loadTile",G,K.bind(this),void 0,!0);else{const Q=h.loadVectorTile.call({deduped:this._deduped},G,(se,ge)=>{se||!ge?K.call(this,se):(G.data={cacheControl:ge.cacheControl,expires:ge.expires,rawData:ge.rawData.slice(0)},$.actor&&$.actor.send("loadTile",G,K.bind(this),void 0,!0))},!0);$.request={cancel:Q}}function K(Q,se){return delete $.request,$.aborted?y(null):Q&&Q.status!==404?y(Q):(se&&se.resourceTiming&&($.resourceTiming=se.resourceTiming),this.map._refreshExpiredTiles&&se&&$.setExpiryData(se),$.loadVectorData(se,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),y(null),void($.reloadCallback&&(this.loadTile($,$.reloadCallback),$.reloadCallback=null)))}}abortTile($){$.request&&($.request.cancel(),delete $.request),$.actor&&$.actor.send("abortTile",{uid:$.uid,type:this.type,source:this.id})}unloadTile($){$.unloadVectorData(),$.actor&&$.actor.send("removeTile",{uid:$.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ke,"raster-dem":class extends ke{constructor($,y,L,G){super($,y,L,G),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}loadTile($,y){const L=this.map._requestManager.normalizeTileURL($.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function G(K,Q){K&&($.state="errored",y(K)),Q&&($.dem=Q,$.dem.onDeserialize(),$.needsHillshadePrepare=!0,$.needsDEMTextureUpload=!0,$.state="loaded",y(null))}$.request=h.getImage(this.map._requestManager.transformRequest(L,h.ResourceType.Tile),function(K,Q,se,ge){if(delete $.request,$.aborted)$.state="unloaded",y(null);else if(K)$.state="errored",y(K);else if(Q){this.map._refreshExpiredTiles&&$.setExpiryData({cacheControl:se,expires:ge});const Ce=h.window.ImageBitmap&&Q instanceof h.window.ImageBitmap&&(Ke==null&&(Ke=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&typeof h.window.createImageBitmap=="function"),Ke),Oe=1-(Q.width-h.prevPowerOfTwo(Q.width))/2;Oe<1||$.neighboringTiles||($.neighboringTiles=this._getNeighboringTiles($.tileID));const Fe=Ce?Q:h.exported.getImageData(Q,Oe),Ue={uid:$.uid,coord:$.tileID,source:this.id,rawImageData:Fe,encoding:this.encoding,padding:Oe};$.actor&&$.state!=="expired"||($.actor=this.dispatcher.getActor(),$.actor.send("loadDEMTile",Ue,G.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles($){const y=$.canonical,L=Math.pow(2,y.z),G=(y.x-1+L)%L,K=y.x===0?$.wrap-1:$.wrap,Q=(y.x+1+L)%L,se=y.x+1===L?$.wrap+1:$.wrap,ge={};return ge[new h.OverscaledTileID($.overscaledZ,K,y.z,G,y.y).key]={backfilled:!1},ge[new h.OverscaledTileID($.overscaledZ,se,y.z,Q,y.y).key]={backfilled:!1},y.y>0&&(ge[new h.OverscaledTileID($.overscaledZ,K,y.z,G,y.y-1).key]={backfilled:!1},ge[new h.OverscaledTileID($.overscaledZ,$.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},ge[new h.OverscaledTileID($.overscaledZ,se,y.z,Q,y.y-1).key]={backfilled:!1}),y.y+1<L&&(ge[new h.OverscaledTileID($.overscaledZ,K,y.z,G,y.y+1).key]={backfilled:!1},ge[new h.OverscaledTileID($.overscaledZ,$.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},ge[new h.OverscaledTileID($.overscaledZ,se,y.z,Q,y.y+1).key]={backfilled:!1}),ge}unloadTile($){$.demTexture&&this.map.painter.saveTileTexture($.demTexture),$.fbo&&($.fbo.destroy(),delete $.fbo),$.dem&&delete $.dem,delete $.neighboringTiles,$.state="unloaded"}},geojson:class extends h.Evented{constructor($,y,L,G){super(),this.id=$,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=L.getActor(),this.setEventedParent(G),this._data=y.data,this._options=h.extend({},y),this._collectResourceTiming=y.collectResourceTiming,y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;const K=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*K,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*K,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?y.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:h.EXTENT,radius:(y.clusterRadius!==void 0?y.clusterRadius:50)*K,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions)}onAdd($){this.map=$,this.setData(this._data)}setData($){return this._data=$,this._updateWorkerData(),this}getClusterExpansionZoom($,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:$,source:this.id},y),this}getClusterChildren($,y){return this.actor.send("geojson.getClusterChildren",{clusterId:$,source:this.id},y),this}getClusterLeaves($,y,L,G){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:$,limit:y,offset:L},G),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const $=h.extend({},this.workerOptions),y=this._data;typeof y=="string"?($.request=this.map._requestManager.transformRequest(h.exported.resolveURL(y),h.ResourceType.Source),$.request.collectResourceTiming=this._collectResourceTiming):$.data=JSON.stringify(y),this._pendingLoad=this.actor.send(`${this.type}.loadData`,$,(L,G)=>{if(this._loaded=!0,this._pendingLoad=null,L)this.fire(new h.ErrorEvent(L));else{const K={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&G&&G.resourceTiming&&G.resourceTiming[this.id]&&(K.resourceTiming=G.resourceTiming[this.id]),this.fire(new h.Event("data",K)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile($,y){const L=$.actor?"reloadTile":"loadTile";$.actor=this.actor,$.request=this.actor.send(L,{type:this.type,uid:$.uid,tileID:$.tileID,tileZoom:$.tileZoom,zoom:$.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(G,K)=>(delete $.request,$.unloadVectorData(),$.aborted?y(null):G?y(G):($.loadVectorData(K,this.map.painter,L==="reloadTile"),y(null))),void 0,L==="loadTile")}abortTile($){$.request&&($.request.cancel(),delete $.request),$.aborted=!0}unloadTile($){$.unloadVectorData(),this.actor.send("removeTile",{uid:$.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends re{constructor($,y,L,G){super($,y,L,G),this.roundZoom=!0,this.type="video",this.options=y}load(){this._loaded=!1;const $=this.options;this.urls=[];for(const y of $.urls)this.urls.push(this.map._requestManager.transformRequest(y,h.ResourceType.Source).url);h.getVideo(this.urls,(y,L)=>{this._loaded=!0,y?this.fire(new h.ErrorEvent(y)):L&&(this.video=L,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek($){if(this.video){const y=this.video.seekable;$<y.start(0)||$>y.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${y.start(0)} and ${y.end(0)}-second mark.`))):this.video.currentTime=$}}getVideo(){return this.video}onAdd($){this.map||(this.map=$,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const $=this.map.painter.context,y=$.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=$.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture($,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE));for(const L in this.tiles){const G=this.tiles[L];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:re,canvas:class extends re{constructor($,y,L,G){super($,y,L,G),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(K=>!Array.isArray(K)||K.length!==2||K.some(Q=>typeof Q!="number"))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${$}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${$}`,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${$}`,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${$}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${$}`,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd($){this.map=$,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let $=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,$=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,$=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const y=this.map.painter.context,L=y.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?($||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(y,this.canvas,L.RGBA,{premultiply:!0});for(const G in this.tiles){const K=this.tiles[G];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const $ of[this.canvas.width,this.canvas.height])if(isNaN($)||$<=0)return!0;return!1}}},Se=function($,y,L,G){const K=new le[y.type]($,y,L,G);if(K.id!==$)throw new Error(`Expected Source id to be ${$} instead of ${K.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],K),K};function Ne($,y){const L=h.identity([]);return h.scale$1(L,L,[.5*$.width,.5*-$.height,1]),h.translate(L,L,[1,-1,0]),h.multiply(L,L,$.calculateProjMatrix(y.toUnwrapped()))}function We($,y,L,G,K,Q,se,ge=!1){const Ce=$.tilesIn(G,se,ge);Ce.sort(vt);const Oe=[];for(const Ue of Ce)Oe.push({wrappedTileID:Ue.tile.tileID.wrapped().key,queryResults:Ue.tile.queryRenderedFeatures(y,L,$._state,Ue,K,Q,Ne($.transform,Ue.tile.tileID),ge)});const Fe=function(Ue){const Qe={},ht={};for(const ct of Ue){const at=ct.queryResults,mt=ct.wrappedTileID,st=ht[mt]=ht[mt]||{};for(const gt in at){const xt=at[gt],ut=st[gt]=st[gt]||{},Et=Qe[gt]=Qe[gt]||[];for(const kt of xt)ut[kt.featureIndex]||(ut[kt.featureIndex]=!0,Et.push(kt))}}return Qe}(Oe);for(const Ue in Fe)Fe[Ue].forEach(Qe=>{const ht=Qe.feature,ct=$.getFeatureState(ht.layer["source-layer"],ht.id);ht.source=ht.layer.source,ht.layer["source-layer"]&&(ht.sourceLayer=ht.layer["source-layer"]),ht.state=ct});return Fe}function nt($,y){const L=$.getRenderableIds().map(Q=>$.getTileByID(Q)),G=[],K={};for(let Q=0;Q<L.length;Q++){const se=L[Q],ge=se.tileID.canonical.key;K[ge]||(K[ge]=!0,se.querySourceFeatures(G,y))}return G}function vt($,y){const L=$.tileID,G=y.tileID;return L.overscaledZ-G.overscaledZ||L.canonical.y-G.canonical.y||L.wrap-G.wrap||L.canonical.x-G.canonical.x}function Dt(){return ga.workerClass!=null?new ga.workerClass:new h.window.Worker(ga.workerUrl)}const wt="mapboxgl_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(y){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Dt);return this.active[y]=!0,this.workers.slice()}release(y){delete this.active[y],this.numActive()===0&&(this.workers.forEach(L=>{L.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wt]}numActive(){return Object.keys(this.active).length}}let Nt;function ri(){return Nt||(Nt=new Tt),Nt}function Ht($,y){const L={};for(const G in $)G!=="ref"&&(L[G]=$[G]);return h.refProperties.forEach(G=>{G in y&&(L[G]=y[G])}),L}function _i($){$=$.slice();const y=Object.create(null);for(let L=0;L<$.length;L++)y[$[L].id]=$[L];for(let L=0;L<$.length;L++)"ref"in $[L]&&($[L]=Ht($[L],y[$[L].ref]));return $}Tt.workerCount=2;const ai={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ct($,y,L){L.push({command:ai.addSource,args:[$,y[$]]})}function Ut($,y,L){y.push({command:ai.removeSource,args:[$]}),L[$]=!0}function Mi($,y,L,G){Ut($,L,G),Ct($,y,L)}function ki($,y,L){let G;for(G in $[L])if($[L].hasOwnProperty(G)&&G!=="data"&&!k($[L][G],y[L][G]))return!1;for(G in y[L])if(y[L].hasOwnProperty(G)&&G!=="data"&&!k($[L][G],y[L][G]))return!1;return!0}function Si($,y,L,G,K,Q){let se;for(se in y=y||{},$=$||{})$.hasOwnProperty(se)&&(k($[se],y[se])||L.push({command:Q,args:[G,se,y[se],K]}));for(se in y)y.hasOwnProperty(se)&&!$.hasOwnProperty(se)&&(k($[se],y[se])||L.push({command:Q,args:[G,se,y[se],K]}))}function Bi($){return $.id}function zi($,y){return $[y.id]=y,$}class un{constructor(y,L){this.reset(y,L)}reset(y,L){this.points=y||[],this._distances=[0];for(let G=1;G<this.points.length;G++)this._distances[G]=this._distances[G-1]+this.points[G].dist(this.points[G-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(L||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(y){if(this.points.length===1)return this.points[0];y=h.clamp(y,0,1);let L=1,G=this._distances[L];const K=y*this.paddedLength+this.padding;for(;G<K&&L<this._distances.length;)G=this._distances[++L];const Q=L-1,se=this._distances[Q],ge=G-se,Ce=ge>0?(K-se)/ge:0;return this.points[Q].mult(1-Ce).add(this.points[L].mult(Ce))}}class Gr{constructor(y,L,G){const K=this.boxCells=[],Q=this.circleCells=[];this.xCellCount=Math.ceil(y/G),this.yCellCount=Math.ceil(L/G);for(let se=0;se<this.xCellCount*this.yCellCount;se++)K.push([]),Q.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=y,this.height=L,this.xScale=this.xCellCount/y,this.yScale=this.yCellCount/L,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(y,L,G,K,Q){this._forEachCell(L,G,K,Q,this._insertBoxCell,this.boxUid++),this.boxKeys.push(y),this.bboxes.push(L),this.bboxes.push(G),this.bboxes.push(K),this.bboxes.push(Q)}insertCircle(y,L,G,K){this._forEachCell(L-K,G-K,L+K,G+K,this._insertCircleCell,this.circleUid++),this.circleKeys.push(y),this.circles.push(L),this.circles.push(G),this.circles.push(K)}_insertBoxCell(y,L,G,K,Q,se){this.boxCells[Q].push(se)}_insertCircleCell(y,L,G,K,Q,se){this.circleCells[Q].push(se)}_query(y,L,G,K,Q,se){if(G<0||y>this.width||K<0||L>this.height)return!Q&&[];const ge=[];if(y<=0&&L<=0&&this.width<=G&&this.height<=K){if(Q)return!0;for(let Ce=0;Ce<this.boxKeys.length;Ce++)ge.push({key:this.boxKeys[Ce],x1:this.bboxes[4*Ce],y1:this.bboxes[4*Ce+1],x2:this.bboxes[4*Ce+2],y2:this.bboxes[4*Ce+3]});for(let Ce=0;Ce<this.circleKeys.length;Ce++){const Oe=this.circles[3*Ce],Fe=this.circles[3*Ce+1],Ue=this.circles[3*Ce+2];ge.push({key:this.circleKeys[Ce],x1:Oe-Ue,y1:Fe-Ue,x2:Oe+Ue,y2:Fe+Ue})}return se?ge.filter(se):ge}return this._forEachCell(y,L,G,K,this._queryCell,ge,{hitTest:Q,seenUids:{box:{},circle:{}}},se),Q?ge.length>0:ge}_queryCircle(y,L,G,K,Q){const se=y-G,ge=y+G,Ce=L-G,Oe=L+G;if(ge<0||se>this.width||Oe<0||Ce>this.height)return!K&&[];const Fe=[];return this._forEachCell(se,Ce,ge,Oe,this._queryCellCircle,Fe,{hitTest:K,circle:{x:y,y:L,radius:G},seenUids:{box:{},circle:{}}},Q),K?Fe.length>0:Fe}query(y,L,G,K,Q){return this._query(y,L,G,K,!1,Q)}hitTest(y,L,G,K,Q){return this._query(y,L,G,K,!0,Q)}hitTestCircle(y,L,G,K){return this._queryCircle(y,L,G,!0,K)}_queryCell(y,L,G,K,Q,se,ge,Ce){const Oe=ge.seenUids,Fe=this.boxCells[Q];if(Fe!==null){const Qe=this.bboxes;for(const ht of Fe)if(!Oe.box[ht]){Oe.box[ht]=!0;const ct=4*ht;if(y<=Qe[ct+2]&&L<=Qe[ct+3]&&G>=Qe[ct+0]&&K>=Qe[ct+1]&&(!Ce||Ce(this.boxKeys[ht]))){if(ge.hitTest)return se.push(!0),!0;se.push({key:this.boxKeys[ht],x1:Qe[ct],y1:Qe[ct+1],x2:Qe[ct+2],y2:Qe[ct+3]})}}}const Ue=this.circleCells[Q];if(Ue!==null){const Qe=this.circles;for(const ht of Ue)if(!Oe.circle[ht]){Oe.circle[ht]=!0;const ct=3*ht;if(this._circleAndRectCollide(Qe[ct],Qe[ct+1],Qe[ct+2],y,L,G,K)&&(!Ce||Ce(this.circleKeys[ht]))){if(ge.hitTest)return se.push(!0),!0;{const at=Qe[ct],mt=Qe[ct+1],st=Qe[ct+2];se.push({key:this.circleKeys[ht],x1:at-st,y1:mt-st,x2:at+st,y2:mt+st})}}}}}_queryCellCircle(y,L,G,K,Q,se,ge,Ce){const Oe=ge.circle,Fe=ge.seenUids,Ue=this.boxCells[Q];if(Ue!==null){const ht=this.bboxes;for(const ct of Ue)if(!Fe.box[ct]){Fe.box[ct]=!0;const at=4*ct;if(this._circleAndRectCollide(Oe.x,Oe.y,Oe.radius,ht[at+0],ht[at+1],ht[at+2],ht[at+3])&&(!Ce||Ce(this.boxKeys[ct])))return se.push(!0),!0}}const Qe=this.circleCells[Q];if(Qe!==null){const ht=this.circles;for(const ct of Qe)if(!Fe.circle[ct]){Fe.circle[ct]=!0;const at=3*ct;if(this._circlesCollide(ht[at],ht[at+1],ht[at+2],Oe.x,Oe.y,Oe.radius)&&(!Ce||Ce(this.circleKeys[ct])))return se.push(!0),!0}}}_forEachCell(y,L,G,K,Q,se,ge,Ce){const Oe=this._convertToXCellCoord(y),Fe=this._convertToYCellCoord(L),Ue=this._convertToXCellCoord(G),Qe=this._convertToYCellCoord(K);for(let ht=Oe;ht<=Ue;ht++)for(let ct=Fe;ct<=Qe;ct++)if(Q.call(this,y,L,G,K,this.xCellCount*ct+ht,se,ge,Ce))return}_convertToXCellCoord(y){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(y*this.xScale)))}_convertToYCellCoord(y){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(y*this.yScale)))}_circlesCollide(y,L,G,K,Q,se){const ge=K-y,Ce=Q-L,Oe=G+se;return Oe*Oe>ge*ge+Ce*Ce}_circleAndRectCollide(y,L,G,K,Q,se,ge){const Ce=(se-K)/2,Oe=Math.abs(y-(K+Ce));if(Oe>Ce+G)return!1;const Fe=(ge-Q)/2,Ue=Math.abs(L-(Q+Fe));if(Ue>Fe+G)return!1;if(Oe<=Ce||Ue<=Fe)return!0;const Qe=Oe-Ce,ht=Ue-Fe;return Qe*Qe+ht*ht<=G*G}}const gi=Math.tan(85*Math.PI/180);function Fi($,y,L,G,K){const Q=h.create$1();if(y){const se=O([],K);Q[0]=se[0],Q[1]=se[1],Q[4]=se[2],Q[5]=se[3],L||h.rotateZ(Q,Q,G.angle)}else h.multiply(Q,G.labelPlaneMatrix,$);return Q}function Oi($,y,L,G,K){if(y){const Q=h.clone$1($),se=h.identity([]);return se[0]=K[0],se[1]=K[1],se[4]=K[2],se[5]=K[3],h.multiply(Q,Q,se),L||h.rotateZ(Q,Q,-G.angle),Q}return G.glCoordMatrix}function ar($,y,L=0){const G=[$.x,$.y,L,1];L?h.transformMat4(G,G,y):ao(G,G,y);const K=G[3];return{point:new h.pointGeometry(G[0]/K,G[1]/K),signedDistanceFromCamera:K}}function Nn($,y){return Math.min(.5+$/y*.5,1.5)}function Ni($,y){const L=$[0]/$[3],G=$[1]/$[3];return L>=-y[0]&&L<=y[0]&&G>=-y[1]&&G<=y[1]}function no($,y,L,G,K,Q,se,ge,Ce){const Oe=G?$.textSizeData:$.iconSizeData,Fe=h.evaluateSizeForZoom(Oe,L.transform.zoom),Ue=[256/L.width*2+1,256/L.height*2+1],Qe=G?$.text.dynamicLayoutVertexArray:$.icon.dynamicLayoutVertexArray;Qe.clear();const ht=$.lineVertexArray,ct=G?$.text.placedSymbolArray:$.icon.placedSymbolArray,at=L.transform.width/L.transform.height;let mt=!1;for(let st=0;st<ct.length;st++){const gt=ct.get(st);if(gt.writingMode!==h.WritingMode.vertical||mt||st!==0&&ct.get(st-1).writingMode===h.WritingMode.horizontal||(mt=!0),gt.hidden||gt.writingMode===h.WritingMode.vertical&&!mt){en(gt.numGlyphs,Qe);continue}mt=!1;const xt=new h.pointGeometry(gt.tileAnchorX,gt.tileAnchorY),ut=Ce?Ce(xt):0,Et=[xt.x,xt.y,ut],kt=[...Et,1];if(h.transformMat4(kt,kt,y),!Ni(kt,Ue)){en(gt.numGlyphs,Qe);continue}const Wt=Nn(L.transform.cameraToCenterDistance,kt[3]),Zt=h.evaluateSizeForFeature(Oe,Fe,gt),Jt=se?Zt/Wt:Zt*Wt,Qt=ar(new h.pointGeometry(Et[0],Et[1]),K,Et[2]);if(Qt.signedDistanceFromCamera<=0){en(gt.numGlyphs,Qe);continue}let ci={};const Kt=se?null:Ce,di=Vr(gt,Jt,!1,ge,y,K,Q,$.glyphOffsetArray,ht,Qe,Qt.point,xt,ci,at,Kt);mt=di.useVertical,Kt&&di.needsFlipping&&(ci={}),(di.notEnoughRoom||mt||di.needsFlipping&&Vr(gt,Jt,!0,ge,y,K,Q,$.glyphOffsetArray,ht,Qe,Qt.point,xt,ci,at,Kt).notEnoughRoom)&&en(gt.numGlyphs,Qe)}G?$.text.dynamicLayoutVertexBuffer.updateData(Qe):$.icon.dynamicLayoutVertexBuffer.updateData(Qe)}function ea($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe){const ht=ge.glyphStartIndex+ge.numGlyphs,ct=ge.lineStartIndex,at=ge.lineStartIndex+ge.lineLength,mt=y.getoffsetX(ge.glyphStartIndex),st=y.getoffsetX(ht-1),gt=bn($*mt,L,G,K,Q,se,ge.segment,ct,at,Ce,Oe,Fe,Ue,Qe,!0);if(!gt)return null;const xt=bn($*st,L,G,K,Q,se,ge.segment,ct,at,Ce,Oe,Fe,Ue,Qe,!0);return xt?{first:gt,last:xt}:null}function ta($,y,L,G){return $.writingMode===h.WritingMode.horizontal&&Math.abs(L.y-y.y)>Math.abs(L.x-y.x)*G?{useVertical:!0}:$.writingMode===h.WritingMode.vertical?y.y<L.y?{needsFlipping:!0}:null:$.flipState!==0&&function(K,Q,se){const ge=(Q.x-K.x)*se;return ge===0||Math.abs((Q.y-K.y)/ge)>gi}(y,L,G)?$.flipState===1?{needsFlipping:!0}:null:y.x>L.x?{needsFlipping:!0}:null}function Vr($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct){const at=y/24,mt=$.lineOffsetX*at,st=$.lineOffsetY*at;let gt;if($.numGlyphs>1){const xt=$.glyphStartIndex+$.numGlyphs,ut=$.lineStartIndex,Et=$.lineStartIndex+$.lineLength,kt=ea(at,ge,mt,st,L,Fe,Ue,$,Ce,Q,Qe,ct,!1);if(!kt)return{notEnoughRoom:!0};const Wt=ar(kt.first.point,se).point,Zt=ar(kt.last.point,se).point;if(G&&!L){const Jt=ta($,Wt,Zt,ht);if($.flipState=Jt&&Jt.needsFlipping?1:2,Jt)return Jt}gt=[kt.first];for(let Jt=$.glyphStartIndex+1;Jt<xt-1;Jt++)gt.push(bn(at*ge.getoffsetX(Jt),mt,st,L,Fe,Ue,$.segment,ut,Et,Ce,Q,Qe,ct,!1,!1));gt.push(kt.last)}else{if(G&&!L){const ut=ar(Ue,K).point,Et=$.lineStartIndex+$.segment+1,kt=new h.pointGeometry(Ce.getx(Et),Ce.gety(Et)),Wt=ar(kt,K),Zt=ta($,ut,Wt.signedDistanceFromCamera>0?Wt.point:cl(Ue,kt,ut,1,K,void 0),ht);if($.flipState=Zt&&Zt.needsFlipping?1:2,Zt)return Zt}const xt=bn(at*ge.getoffsetX($.glyphStartIndex),mt,st,L,Fe,Ue,$.segment,$.lineStartIndex,$.lineStartIndex+$.lineLength,Ce,Q,Qe,ct,!1,!1);if(!xt)return{notEnoughRoom:!0};gt=[xt]}for(const xt of gt)h.addDynamicAttributes(Oe,xt.point,xt.angle);return{}}function sr($,y,L){const G={x:$.x,y:$.y,z:0};if(!L)return ar(G,y,G.z);const K=L($);return ar(new h.pointGeometry(G.x,G.y),y,G.z+K)}function cl($,y,L,G,K,Q){const se=sr($.add($.sub(y)._unit()),K,Q).point,ge=L.sub(se);return L.add(ge._mult(G/ge.mag()))}function bn($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct){const at=G?$-y:$+y;let mt=at>0?1:-1,st=0;G&&(mt*=-1,st=Math.PI),mt<0&&(st+=Math.PI);let gt=mt>0?ge+se:ge+se+1,xt=K,ut=K,Et=0,kt=0;const Wt=Math.abs(at),Zt=[],Jt=[];let Qt=Q;const ci=()=>{const Ai=gt-mt;return Et===0?Q:new h.pointGeometry(Oe.getx(Ai),Oe.gety(Ai))},Kt=()=>cl(ci(),Qt,ut,Wt-Et+1,Fe,Qe);for(;Et+kt<=Wt;){if(gt+=mt,gt<ge||gt>=Ce)return null;if(ut=xt,Zt.push(xt),ht&&Jt.push(Qt||ci()),xt=Ue[gt],xt===void 0){Qt=new h.pointGeometry(Oe.getx(gt),Oe.gety(gt));const Ai=sr(Qt,Fe,Qe);xt=Ai.signedDistanceFromCamera>0?Ue[gt]=Ai.point:Kt()}else Qt=null;Et+=kt,kt=ut.dist(xt)}ct&&Qe&&(Qt=Qt||new h.pointGeometry(Oe.getx(gt),Oe.gety(gt)),Ue[gt]=xt=Ue[gt]===void 0?xt:Kt(),kt=ut.dist(xt));const di=(Wt-Et)/kt,Gt=xt.sub(ut),pi=Gt.mult(di)._add(ut);L&&pi._add(Gt._unit()._perp()._mult(L*mt));const Ei=st+Math.atan2(xt.y-ut.y,xt.x-ut.x);return Zt.push(pi),ht&&(Qt=Qt||new h.pointGeometry(Oe.getx(gt),Oe.gety(gt)),Jt.push(function(Ai,Ci,Di){const Ri=1-Di;return new h.pointGeometry(Ai.x*Ri+Ci.x*Di,Ai.y*Ri+Ci.y*Di)}(Jt.length>0?Jt[Jt.length-1]:Qt,Qt,di))),{point:pi,angle:Ei,path:Zt,tilePath:Jt}}const ls=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function en($,y){for(let L=0;L<$;L++){const G=y.length;y.resize(G+4),y.float32.set(ls,3*G)}}function ao($,y,L){const G=y[0],K=y[1];return $[0]=L[0]*G+L[4]*K+L[12],$[1]=L[1]*G+L[5]*K+L[13],$[3]=L[3]*G+L[7]*K+L[15],$}const tn=100;class Gi{constructor(y,L,G=new Gr(y.width+200,y.height+200,25),K=new Gr(y.width+200,y.height+200,25)){this.transform=y,this.grid=G,this.ignoredGrid=K,this.pitchfactor=Math.cos(y._pitch)*y.cameraToCenterDistance,this.screenRightBoundary=y.width+tn,this.screenBottomBoundary=y.height+tn,this.gridRightBoundary=y.width+200,this.gridBottomBoundary=y.height+200,this.fogState=L}placeCollisionBox(y,L,G,K,Q,se,ge){let Ce=L.projectedAnchorZ;L.elevation&&(Ce+=L.elevation);const Oe=this.projectAndGetPerspectiveRatio(se,L.projectedAnchorX,L.projectedAnchorY,Ce,L.tileID),Fe=Q*Oe.perspectiveRatio,Ue=(L.x1*y+G.x-L.padding)*Fe+Oe.point.x,Qe=(L.y1*y+G.y-L.padding)*Fe+Oe.point.y,ht=(L.x2*y+G.x+L.padding)*Fe+Oe.point.x,ct=(L.y2*y+G.y+L.padding)*Fe+Oe.point.y,at=Oe.perspectiveRatio<=.55||Oe.aboveHorizon;return!this.isInsideGrid(Ue,Qe,ht,ct)||!K&&this.grid.hitTest(Ue,Qe,ht,ct,ge)||at?{box:[],offscreen:!1}:{box:[Ue,Qe,ht,ct],offscreen:this.isOffscreen(Ue,Qe,ht,ct)}}placeCollisionCircles(y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct){const at=[],mt=this.transform.elevation,st=mt?Kt=>mt.getAtTileOffset(ct,Kt.x,Kt.y):Kt=>0,gt=new h.pointGeometry(L.tileAnchorX,L.tileAnchorY),xt=st(gt),ut=this.projectAndGetPerspectiveRatio(se,gt.x,gt.y,xt,ct),{perspectiveRatio:Et}=ut,kt=(Fe?Q/Et:Q*Et)/h.ONE_EM,Wt=ar(gt,ge,xt).point,Zt=ut.signedDistanceFromCamera>0?ea(kt,K,L.lineOffsetX*kt,L.lineOffsetY*kt,!1,Wt,gt,L,G,ge,{},mt&&!Fe?st:null,Fe&&!!mt):null;let Jt=!1,Qt=!1,ci=!0;if(Zt&&!ut.aboveHorizon){const Kt=.5*Qe*Et+ht,di=new h.pointGeometry(-100,-100),Gt=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),pi=new un,Ei=Zt.first,Ai=Zt.last;let Ci=[];for(let Ti=Ei.path.length-1;Ti>=1;Ti--)Ci.push(Ei.path[Ti]);for(let Ti=1;Ti<Ai.path.length;Ti++)Ci.push(Ai.path[Ti]);const Di=2.5*Kt;if(Ce){const Ti=Ci.map(mt?(Pi,Wi)=>{const gr=st(Wi<Ei.path.length-1?Ei.tilePath[Ei.path.length-1-Wi]:Ai.tilePath[Wi-Ei.path.length+2]);return ar(Pi,Ce,gr)}:Pi=>ar(Pi,Ce));Ci=Ti.some(Pi=>Pi.signedDistanceFromCamera<=0)?[]:Ti.map(Pi=>Pi.point)}let Ri=[];if(Ci.length>0){const Ti=Ci[0].clone(),Pi=Ci[0].clone();for(let Wi=1;Wi<Ci.length;Wi++)Ti.x=Math.min(Ti.x,Ci[Wi].x),Ti.y=Math.min(Ti.y,Ci[Wi].y),Pi.x=Math.max(Pi.x,Ci[Wi].x),Pi.y=Math.max(Pi.y,Ci[Wi].y);Ri=Ti.x>=di.x&&Pi.x<=Gt.x&&Ti.y>=di.y&&Pi.y<=Gt.y?[Ci]:Pi.x<di.x||Ti.x>Gt.x||Pi.y<di.y||Ti.y>Gt.y?[]:h.clipLine([Ci],di.x,di.y,Gt.x,Gt.y)}for(const Ti of Ri){pi.reset(Ti,.25*Kt);let Pi=0;Pi=pi.length<=.5*Kt?1:Math.ceil(pi.paddedLength/Di)+1;for(let Wi=0;Wi<Pi;Wi++){const gr=Wi/Math.max(Pi-1,1),Tr=pi.lerp(gr),Pr=Tr.x+tn,Fr=Tr.y+tn;at.push(Pr,Fr,Kt,0);const _r=Pr-Kt,gn=Fr-Kt,fn=Pr+Kt,rr=Fr+Kt;if(ci=ci&&this.isOffscreen(_r,gn,fn,rr),Qt=Qt||this.isInsideGrid(_r,gn,fn,rr),!y&&this.grid.hitTestCircle(Pr,Fr,Kt,Ue)&&(Jt=!0,!Oe))return{circles:[],offscreen:!1,collisionDetected:Jt}}}}return{circles:!Oe&&Jt||!Qt?[]:at,offscreen:ci,collisionDetected:Jt}}queryRenderedSymbols(y){if(y.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const L=[];let G=1/0,K=1/0,Q=-1/0,se=-1/0;for(const Fe of y){const Ue=new h.pointGeometry(Fe.x+tn,Fe.y+tn);G=Math.min(G,Ue.x),K=Math.min(K,Ue.y),Q=Math.max(Q,Ue.x),se=Math.max(se,Ue.y),L.push(Ue)}const ge=this.grid.query(G,K,Q,se).concat(this.ignoredGrid.query(G,K,Q,se)),Ce={},Oe={};for(const Fe of ge){const Ue=Fe.key;if(Ce[Ue.bucketInstanceId]===void 0&&(Ce[Ue.bucketInstanceId]={}),Ce[Ue.bucketInstanceId][Ue.featureIndex])continue;const Qe=[new h.pointGeometry(Fe.x1,Fe.y1),new h.pointGeometry(Fe.x2,Fe.y1),new h.pointGeometry(Fe.x2,Fe.y2),new h.pointGeometry(Fe.x1,Fe.y2)];h.polygonIntersectsPolygon(L,Qe)&&(Ce[Ue.bucketInstanceId][Ue.featureIndex]=!0,Oe[Ue.bucketInstanceId]===void 0&&(Oe[Ue.bucketInstanceId]=[]),Oe[Ue.bucketInstanceId].push(Ue.featureIndex))}return Oe}insertCollisionBox(y,L,G,K,Q){(L?this.ignoredGrid:this.grid).insert({bucketInstanceId:G,featureIndex:K,collisionGroupID:Q},y[0],y[1],y[2],y[3])}insertCollisionCircles(y,L,G,K,Q){const se=L?this.ignoredGrid:this.grid,ge={bucketInstanceId:G,featureIndex:K,collisionGroupID:Q};for(let Ce=0;Ce<y.length;Ce+=4)se.insertCircle(ge,y[Ce],y[Ce+1],y[Ce+2])}projectAndGetPerspectiveRatio(y,L,G,K,Q){const se=[L,G,K||0,1];let ge=!1;if(K||this.transform.pitch>0){h.transformMat4(se,se,y);let Ce=!1;this.fogState&&Q&&(Ce=function(Oe,Fe,Ue,Qe,ht,ct){const at=ct.calculateFogTileMatrix(ht),mt=[Fe,Ue,Qe];return h.transformMat4$1(mt,mt,at),we(Oe,mt,ct.pitch,ct._fov)}(this.fogState,L,G,K||0,Q.toUnwrapped(),this.transform)>.9),ge=se[2]>se[3]||Ce}else ao(se,se,y);return{point:new h.pointGeometry((se[0]/se[3]+1)/2*this.transform.width+tn,(-se[1]/se[3]+1)/2*this.transform.height+tn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/se[3]*.5,1.5),signedDistanceFromCamera:se[3],aboveHorizon:ge}}isOffscreen(y,L,G,K){return G<tn||y>=this.screenRightBoundary||K<tn||L>this.screenBottomBoundary}isInsideGrid(y,L,G,K){return G>=0&&y<this.gridRightBoundary&&K>=0&&L<this.gridBottomBoundary}getViewportMatrix(){const y=h.identity([]);return h.translate(y,y,[-100,-100,0]),y}}class oo{constructor(y,L,G,K){this.opacity=y?Math.max(0,Math.min(1,y.opacity+(y.placed?L:-L))):K&&G?1:0,this.placed=G}isHidden(){return this.opacity===0&&!this.placed}}class Un{constructor(y,L,G,K,Q,se=!1){this.text=new oo(y?y.text:null,L,G,Q),this.icon=new oo(y?y.icon:null,L,K,Q),this.clipped=se}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kr{constructor(y,L,G,K=!1){this.text=y,this.icon=L,this.skipFade=G,this.clipped=K}}class Xr{constructor(){this.invProjMatrix=h.create$1(),this.viewportMatrix=h.create$1(),this.circles=[]}}class fl{constructor(y,L,G,K,Q){this.bucketInstanceId=y,this.featureIndex=L,this.sourceLayerIndex=G,this.bucketIndex=K,this.tileID=Q}}class so{constructor(y){this.crossSourceCollisions=y,this.maxGroupID=0,this.collisionGroups={}}get(y){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[y]){const L=++this.maxGroupID;this.collisionGroups[y]={ID:L,predicate:G=>G.collisionGroupID===L}}return this.collisionGroups[y]}}function fr($,y,L,G,K){const{horizontalAlign:Q,verticalAlign:se}=h.getAnchorAlignment($),ge=-(Q-.5)*y,Ce=-(se-.5)*L,Oe=h.evaluateVariableOffset($,G);return new h.pointGeometry(ge+Oe[0]*K,Ce+Oe[1]*K)}function $n($,y,L,G,K){const Q=new h.pointGeometry($,y);return L&&Q._rotate(G?K:-K),Q}class jn{constructor(y,L,G,K,Q){this.transform=y.clone(),this.collisionIndex=new Gi(this.transform,Q),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=L,this.retainedQueryData={},this.collisionGroups=new so(G),this.collisionCircleArrays={},this.prevPlacement=K,K&&(K.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(y,L,G,K){const Q=G.getBucket(L),se=G.latestFeatureIndex;if(!Q||!se||L.id!==Q.layerIds[0])return;const ge=Q.layers[0].layout,Ce=G.collisionBoxArray,Oe=Math.pow(2,this.transform.zoom-G.tileID.overscaledZ),Fe=G.tileSize/h.EXTENT,Ue=G.tileID.toUnwrapped(),Qe=this.transform.calculateProjMatrix(Ue),ht=ge.get("text-pitch-alignment")==="map",ct=ge.get("text-rotation-alignment")==="map";L.compileFilter();const at=L.dynamicFilter(),mt=L.dynamicFilterNeedsFeature(),st=this.transform.calculatePixelsToTileUnitsMatrix(G),gt=Fi(Qe,ht,ct,this.transform,st);let xt=null;if(ht){const kt=Oi(Qe,ht,ct,this.transform,st);xt=h.multiply([],this.transform.labelPlaneMatrix,kt)}let ut=null;at&&G.latestFeatureIndex&&(ut={unwrappedTileID:Ue,dynamicFilter:at,dynamicFilterNeedsFeature:mt,featureIndex:G.latestFeatureIndex}),this.retainedQueryData[Q.bucketInstanceId]=new fl(Q.bucketInstanceId,se,Q.sourceLayerIndex,Q.index,G.tileID);const Et={bucket:Q,layout:ge,posMatrix:Qe,textLabelPlaneMatrix:gt,labelToScreenMatrix:xt,clippingData:ut,scale:Oe,textPixelRatio:Fe,holdingForFade:G.holdingForFade(),collisionBoxArray:Ce,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(Q.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(Q.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(Q.sourceID)};if(K)for(const kt of Q.sortKeyRanges){const{sortKey:Wt,symbolInstanceStart:Zt,symbolInstanceEnd:Jt}=kt;y.push({sortKey:Wt,symbolInstanceStart:Zt,symbolInstanceEnd:Jt,parameters:Et})}else y.push({symbolInstanceStart:0,symbolInstanceEnd:Q.symbolInstances.length,parameters:Et})}attemptAnchorPlacement(y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct,at,mt,st,gt){const xt=[Qe.textOffset0,Qe.textOffset1],ut=fr(y,G,K,xt,Q),Et=this.collisionIndex.placeCollisionBox(Q,L,$n(ut.x,ut.y,se,ge,this.transform.angle),Ue,Ce,Oe,Fe.predicate);if((!mt||this.collisionIndex.placeCollisionBox(ct.getSymbolInstanceIconSize(gt,this.transform.zoom,ht),mt,$n(ut.x,ut.y,se,ge,this.transform.angle),Ue,Ce,Oe,Fe.predicate).box.length!==0)&&Et.box.length>0){let kt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Qe.crossTileID]&&this.prevPlacement.placements[Qe.crossTileID]&&this.prevPlacement.placements[Qe.crossTileID].text&&(kt=this.prevPlacement.variableOffsets[Qe.crossTileID].anchor),this.variableOffsets[Qe.crossTileID]={textOffset:xt,width:G,height:K,anchor:y,textScale:Q,prevAnchor:kt},this.markUsedJustification(ct,y,Qe,at),ct.allowVerticalPlacement&&(this.markUsedOrientation(ct,at,Qe),this.placedOrientations[Qe.crossTileID]=at),{shift:ut,placedGlyphBoxes:Et}}}placeLayerBucketPart(y,L,G,K){const{bucket:Q,layout:se,posMatrix:ge,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Oe,clippingData:Fe,textPixelRatio:Ue,holdingForFade:Qe,collisionBoxArray:ht,partiallyEvaluatedTextSize:ct,partiallyEvaluatedIconSize:at,collisionGroup:mt}=y.parameters,st=se.get("text-optional"),gt=se.get("icon-optional"),xt=se.get("text-allow-overlap"),ut=se.get("icon-allow-overlap"),Et=se.get("text-rotation-alignment")==="map",kt=se.get("text-pitch-alignment")==="map",Wt=se.get("icon-text-fit")!=="none",Zt=se.get("symbol-z-order")==="viewport-y",Jt=xt&&(ut||!Q.hasIconData()||gt),Qt=ut&&(xt||!Q.hasTextData()||st);!Q.collisionArrays&&ht&&Q.deserializeCollisionBoxes(ht),G&&K&&Q.updateCollisionDebugBuffers(this.transform.zoom,ht);const ci=(Kt,di,Gt)=>{if(Fe){const rr={zoom:this.transform.zoom,pitch:this.transform.pitch};let ur=null;if(Fe.dynamicFilterNeedsFeature){const $i=this.retainedQueryData[Q.bucketInstanceId];ur=Fe.featureIndex.loadFeature({featureIndex:Kt.featureIndex,bucketIndex:$i.bucketIndex,sourceLayerIndex:$i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Fe.dynamicFilter)(rr,ur,this.retainedQueryData[Q.bucketInstanceId].tileID.canonical,new h.pointGeometry(Kt.tileAnchorX,Kt.tileAnchorY),this.transform.calculateDistanceTileData(Fe.unwrappedTileID)))return this.placements[Kt.crossTileID]=new kr(!1,!1,!1,!0),void(L[Kt.crossTileID]=!0)}if(L[Kt.crossTileID])return;if(Qe)return void(this.placements[Kt.crossTileID]=new kr(!1,!1,!1));let pi=!1,Ei=!1,Ai=!0,Ci=null,Di={box:null,offscreen:null},Ri={box:null,offscreen:null},Ti=null,Pi=null,Wi=null,gr=0,Tr=0,Pr=0;Gt.textFeatureIndex?gr=Gt.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(gr=Kt.featureIndex),Gt.verticalTextFeatureIndex&&(Tr=Gt.verticalTextFeatureIndex);const Fr=rr=>{rr.tileID=this.retainedQueryData[Q.bucketInstanceId].tileID,(this.transform.elevation||rr.elevation)&&(rr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[Q.bucketInstanceId].tileID,rr.tileAnchorX,rr.tileAnchorY):0)},_r=Gt.textBox;if(_r){Fr(_r);const rr=$i=>{let or=h.WritingMode.horizontal;if(Q.allowVerticalPlacement&&!$i&&this.prevPlacement){const Ar=this.prevPlacement.placedOrientations[Kt.crossTileID];Ar&&(this.placedOrientations[Kt.crossTileID]=Ar,or=Ar,this.markUsedOrientation(Q,or,Kt))}return or},ur=($i,or)=>{if(Q.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&Gt.verticalTextBox){for(const Ar of Q.writingModes)if(Ar===h.WritingMode.vertical?(Di=or(),Ri=Di):Di=$i(),Di&&Di.box&&Di.box.length)break}else Di=$i()};if(se.get("text-variable-anchor")){let $i=se.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Kt.crossTileID]){const nr=this.prevPlacement.variableOffsets[Kt.crossTileID];$i.indexOf(nr.anchor)>0&&($i=$i.filter(Hr=>Hr!==nr.anchor),$i.unshift(nr.anchor))}const or=(nr,Hr,Xa)=>{const $r=Q.getSymbolInstanceTextSize(ct,Kt,this.transform.zoom,di),Rn=(nr.x2-nr.x1)*$r+2*nr.padding,th=(nr.y2-nr.y1)*$r+2*nr.padding,Go=Wt&&!ut?Hr:null;Go&&Fr(Go);let _a={box:[],offscreen:!1};const ih=xt?2*$i.length:$i.length;for(let Ya=0;Ya<ih;++Ya){const Vo=this.attemptAnchorPlacement($i[Ya%$i.length],nr,Rn,th,$r,Et,kt,Ue,ge,mt,Ya>=$i.length,Kt,di,Q,Xa,Go,ct,at);if(Vo&&(_a=Vo.placedGlyphBoxes,_a&&_a.box&&_a.box.length)){pi=!0,Ci=Vo.shift;break}}return _a};ur(()=>or(_r,Gt.iconBox,h.WritingMode.horizontal),()=>{const nr=Gt.verticalTextBox;return nr&&Fr(nr),Q.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&Kt.numVerticalGlyphVertices>0&&nr?or(nr,Gt.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),Di&&(pi=Di.box,Ai=Di.offscreen);const Ar=rr(Di&&Di.box);if(!pi&&this.prevPlacement){const nr=this.prevPlacement.variableOffsets[Kt.crossTileID];nr&&(this.variableOffsets[Kt.crossTileID]=nr,this.markUsedJustification(Q,nr.anchor,Kt,Ar))}}else{const $i=(or,Ar)=>{const nr=Q.getSymbolInstanceTextSize(ct,Kt,this.transform.zoom,di),Hr=this.collisionIndex.placeCollisionBox(nr,or,new h.pointGeometry(0,0),xt,Ue,ge,mt.predicate);return Hr&&Hr.box&&Hr.box.length&&(this.markUsedOrientation(Q,Ar,Kt),this.placedOrientations[Kt.crossTileID]=Ar),Hr};ur(()=>$i(_r,h.WritingMode.horizontal),()=>{const or=Gt.verticalTextBox;return Q.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&or?(Fr(or),$i(or,h.WritingMode.vertical)):{box:null,offscreen:null}}),rr(Di&&Di.box&&Di.box.length)}}if(Ti=Di,pi=Ti&&Ti.box&&Ti.box.length>0,Ai=Ti&&Ti.offscreen,Kt.useRuntimeCollisionCircles){const rr=Q.text.placedSymbolArray.get(Kt.centerJustifiedTextSymbolIndex>=0?Kt.centerJustifiedTextSymbolIndex:Kt.verticalPlacedTextSymbolIndex),ur=h.evaluateSizeForFeature(Q.textSizeData,ct,rr),$i=se.get("text-padding");Pi=this.collisionIndex.placeCollisionCircles(xt,rr,Q.lineVertexArray,Q.glyphOffsetArray,ur,ge,Ce,Oe,G,kt,mt.predicate,Kt.collisionCircleDiameter*ur/h.ONE_EM,$i,this.retainedQueryData[Q.bucketInstanceId].tileID),pi=xt||Pi.circles.length>0&&!Pi.collisionDetected,Ai=Ai&&Pi.offscreen}if(Gt.iconFeatureIndex&&(Pr=Gt.iconFeatureIndex),Gt.iconBox){const rr=ur=>{Fr(ur);const $i=Wt&&Ci?$n(Ci.x,Ci.y,Et,kt,this.transform.angle):new h.pointGeometry(0,0),or=Q.getSymbolInstanceIconSize(at,this.transform.zoom,di);return this.collisionIndex.placeCollisionBox(or,ur,$i,ut,Ue,ge,mt.predicate)};Ri&&Ri.box&&Ri.box.length&&Gt.verticalIconBox?(Wi=rr(Gt.verticalIconBox),Ei=Wi.box.length>0):(Wi=rr(Gt.iconBox),Ei=Wi.box.length>0),Ai=Ai&&Wi.offscreen}const gn=st||Kt.numHorizontalGlyphVertices===0&&Kt.numVerticalGlyphVertices===0,fn=gt||Kt.numIconVertices===0;if(gn||fn?fn?gn||(Ei=Ei&&pi):pi=Ei&&pi:Ei=pi=Ei&&pi,pi&&Ti&&Ti.box&&this.collisionIndex.insertCollisionBox(Ti.box,se.get("text-ignore-placement"),Q.bucketInstanceId,Ri&&Ri.box&&Tr?Tr:gr,mt.ID),Ei&&Wi&&this.collisionIndex.insertCollisionBox(Wi.box,se.get("icon-ignore-placement"),Q.bucketInstanceId,Pr,mt.ID),Pi&&(pi&&this.collisionIndex.insertCollisionCircles(Pi.circles,se.get("text-ignore-placement"),Q.bucketInstanceId,gr,mt.ID),G)){const rr=Q.bucketInstanceId;let ur=this.collisionCircleArrays[rr];ur===void 0&&(ur=this.collisionCircleArrays[rr]=new Xr);for(let $i=0;$i<Pi.circles.length;$i+=4)ur.circles.push(Pi.circles[$i+0]),ur.circles.push(Pi.circles[$i+1]),ur.circles.push(Pi.circles[$i+2]),ur.circles.push(Pi.collisionDetected?1:0)}this.placements[Kt.crossTileID]=new kr(pi||Jt,Ei||Qt,Ai||Q.justReloaded),L[Kt.crossTileID]=!0};if(Zt){const Kt=Q.getSortedSymbolIndexes(this.transform.angle);for(let di=Kt.length-1;di>=0;--di){const Gt=Kt[di];ci(Q.symbolInstances.get(Gt),Gt,Q.collisionArrays[Gt])}}else for(let Kt=y.symbolInstanceStart;Kt<y.symbolInstanceEnd;Kt++)ci(Q.symbolInstances.get(Kt),Kt,Q.collisionArrays[Kt]);if(G&&Q.bucketInstanceId in this.collisionCircleArrays){const Kt=this.collisionCircleArrays[Q.bucketInstanceId];h.invert(Kt.invProjMatrix,ge),Kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}Q.justReloaded=!1}markUsedJustification(y,L,G,K){let Q;Q=K===h.WritingMode.vertical?G.verticalPlacedTextSymbolIndex:{left:G.leftJustifiedTextSymbolIndex,center:G.centerJustifiedTextSymbolIndex,right:G.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(L)];const se=[G.leftJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.rightJustifiedTextSymbolIndex,G.verticalPlacedTextSymbolIndex];for(const ge of se)ge>=0&&(y.text.placedSymbolArray.get(ge).crossTileID=Q>=0&&ge!==Q?0:G.crossTileID)}markUsedOrientation(y,L,G){const K=L===h.WritingMode.horizontal||L===h.WritingMode.horizontalOnly?L:0,Q=L===h.WritingMode.vertical?L:0,se=[G.leftJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.rightJustifiedTextSymbolIndex];for(const ge of se)y.text.placedSymbolArray.get(ge).placedOrientation=K;G.verticalPlacedTextSymbolIndex&&(y.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).placedOrientation=Q)}commit(y){this.commitTime=y,this.zoomAtLastRecencyCheck=this.transform.zoom;const L=this.prevPlacement;let G=!1;this.prevZoomAdjustment=L?L.zoomAdjustment(this.transform.zoom):0;const K=L?L.symbolFadeChange(y):1,Q=L?L.opacities:{},se=L?L.variableOffsets:{},ge=L?L.placedOrientations:{};for(const Ce in this.placements){const Oe=this.placements[Ce],Fe=Q[Ce];Fe?(this.opacities[Ce]=new Un(Fe,K,Oe.text,Oe.icon,null,Oe.clipped),G=G||Oe.text!==Fe.text.placed||Oe.icon!==Fe.icon.placed):(this.opacities[Ce]=new Un(null,K,Oe.text,Oe.icon,Oe.skipFade,Oe.clipped),G=G||Oe.text||Oe.icon)}for(const Ce in Q){const Oe=Q[Ce];if(!this.opacities[Ce]){const Fe=new Un(Oe,K,!1,!1);Fe.isHidden()||(this.opacities[Ce]=Fe,G=G||Oe.text.placed||Oe.icon.placed)}}for(const Ce in se)this.variableOffsets[Ce]||!this.opacities[Ce]||this.opacities[Ce].isHidden()||(this.variableOffsets[Ce]=se[Ce]);for(const Ce in ge)this.placedOrientations[Ce]||!this.opacities[Ce]||this.opacities[Ce].isHidden()||(this.placedOrientations[Ce]=ge[Ce]);G?this.lastPlacementChangeTime=y:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=L?L.lastPlacementChangeTime:y)}updateLayerOpacities(y,L){const G={};for(const K of L){const Q=K.getBucket(y);Q&&K.latestFeatureIndex&&y.id===Q.layerIds[0]&&this.updateBucketOpacities(Q,G,K.collisionBoxArray)}}updateBucketOpacities(y,L,G){y.hasTextData()&&y.text.opacityVertexArray.clear(),y.hasIconData()&&y.icon.opacityVertexArray.clear(),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexArray.clear(),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexArray.clear();const K=y.layers[0].layout,Q=!!y.layers[0].dynamicFilter(),se=new Un(null,0,!1,!1,!0),ge=K.get("text-allow-overlap"),Ce=K.get("icon-allow-overlap"),Oe=K.get("text-variable-anchor"),Fe=K.get("text-rotation-alignment")==="map",Ue=K.get("text-pitch-alignment")==="map",Qe=K.get("icon-text-fit")!=="none",ht=new Un(null,0,ge&&(Ce||!y.hasIconData()||K.get("icon-optional")),Ce&&(ge||!y.hasTextData()||K.get("text-optional")),!0);!y.collisionArrays&&G&&(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData())&&y.deserializeCollisionBoxes(G);const ct=(at,mt,st)=>{for(let gt=0;gt<mt/4;gt++)at.opacityVertexArray.emplaceBack(st)};for(let at=0;at<y.symbolInstances.length;at++){const mt=y.symbolInstances.get(at),{numHorizontalGlyphVertices:st,numVerticalGlyphVertices:gt,crossTileID:xt}=mt;let ut=this.opacities[xt];L[xt]?ut=se:ut||(ut=ht,this.opacities[xt]=ut),L[xt]=!0;const Et=mt.numIconVertices>0,kt=this.placedOrientations[mt.crossTileID],Wt=kt===h.WritingMode.vertical,Zt=kt===h.WritingMode.horizontal||kt===h.WritingMode.horizontalOnly;if(st>0||gt>0){const Jt=us(ut.text);ct(y.text,st,Wt?Dr:Jt),ct(y.text,gt,Zt?Dr:Jt);const Qt=ut.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(di=>{di>=0&&(y.text.placedSymbolArray.get(di).hidden=Qt||Wt?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(y.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=Qt||Zt?1:0);const ci=this.variableOffsets[mt.crossTileID];ci&&this.markUsedJustification(y,ci.anchor,mt,kt);const Kt=this.placedOrientations[mt.crossTileID];Kt&&(this.markUsedJustification(y,"left",mt,Kt),this.markUsedOrientation(y,Kt,mt))}if(Et){const Jt=us(ut.icon);mt.placedIconSymbolIndex>=0&&(ct(y.icon,mt.numIconVertices,Wt?Dr:Jt),y.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=ut.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(ct(y.icon,mt.numVerticalIconVertices,Zt?Dr:Jt),y.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=ut.icon.isHidden())}if(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData()){const Jt=y.collisionArrays[at];if(Jt){let Qt=new h.pointGeometry(0,0),ci=!0;if(Jt.textBox||Jt.verticalTextBox){if(Oe){const di=this.variableOffsets[xt];di?(Qt=fr(di.anchor,di.width,di.height,di.textOffset,di.textScale),Fe&&Qt._rotate(Ue?this.transform.angle:-this.transform.angle)):ci=!1}Q&&(ci=!ut.clipped),Jt.textBox&&mr(y.textCollisionBox.collisionVertexArray,ut.text.placed,!ci||Wt,Qt.x,Qt.y),Jt.verticalTextBox&&mr(y.textCollisionBox.collisionVertexArray,ut.text.placed,!ci||Zt,Qt.x,Qt.y)}const Kt=ci&&Boolean(!Zt&&Jt.verticalIconBox);Jt.iconBox&&mr(y.iconCollisionBox.collisionVertexArray,ut.icon.placed,Kt,Qe?Qt.x:0,Qe?Qt.y:0),Jt.verticalIconBox&&mr(y.iconCollisionBox.collisionVertexArray,ut.icon.placed,!Kt,Qe?Qt.x:0,Qe?Qt.y:0)}}}if(y.sortFeatures(this.transform.angle),this.retainedQueryData[y.bucketInstanceId]&&(this.retainedQueryData[y.bucketInstanceId].featureSortOrder=y.featureSortOrder),y.hasTextData()&&y.text.opacityVertexBuffer&&y.text.opacityVertexBuffer.updateData(y.text.opacityVertexArray),y.hasIconData()&&y.icon.opacityVertexBuffer&&y.icon.opacityVertexBuffer.updateData(y.icon.opacityVertexArray),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexBuffer&&y.iconCollisionBox.collisionVertexBuffer.updateData(y.iconCollisionBox.collisionVertexArray),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexBuffer&&y.textCollisionBox.collisionVertexBuffer.updateData(y.textCollisionBox.collisionVertexArray),y.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[y.bucketInstanceId];y.placementInvProjMatrix=at.invProjMatrix,y.placementViewportMatrix=at.viewportMatrix,y.collisionCircleArray=at.circles,delete this.collisionCircleArrays[y.bucketInstanceId]}}symbolFadeChange(y){return this.fadeDuration===0?1:(y-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(y){return Math.max(0,(this.transform.zoom-y)/1.5)}hasTransitions(y){return this.stale||y-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(y,L){const G=this.zoomAtLastRecencyCheck===L?1-this.zoomAdjustment(L):1;return this.zoomAtLastRecencyCheck=L,this.commitTime+this.fadeDuration*G>y}setStale(){this.stale=!0}}function mr($,y,L,G,K){$.emplaceBack(y?1:0,L?1:0,G||0,K||0),$.emplaceBack(y?1:0,L?1:0,G||0,K||0),$.emplaceBack(y?1:0,L?1:0,G||0,K||0),$.emplaceBack(y?1:0,L?1:0,G||0,K||0)}const hs=Math.pow(2,25),rn=Math.pow(2,24),Ia=Math.pow(2,17),lo=Math.pow(2,16),Bh=Math.pow(2,9),wn=Math.pow(2,8),Oh=Math.pow(2,1);function us($){if($.opacity===0&&!$.placed)return 0;if($.opacity===1&&$.placed)return 4294967295;const y=$.placed?1:0,L=Math.floor(127*$.opacity);return L*hs+y*rn+L*Ia+y*lo+L*Bh+y*wn+L*Oh+y}const Dr=0;class ho{constructor(y){this._sortAcrossTiles=y.layout.get("symbol-z-order")!=="viewport-y"&&y.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(y,L,G,K,Q){const se=this._bucketParts;for(;this._currentTileIndex<y.length;)if(L.getBucketParts(se,K,y[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Q())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,se.sort((ge,Ce)=>ge.sortKey-Ce.sortKey));this._currentPartIndex<se.length;){const ge=se[this._currentPartIndex];if(L.placeLayerBucketPart(ge,this._seenCrossTileIDs,G,ge.symbolInstanceStart===0),this._currentPartIndex++,Q())return!0}return!1}}class En{constructor(y,L,G,K,Q,se,ge,Ce){this.placement=new jn(y,Q,se,ge,Ce),this._currentPlacementIndex=L.length-1,this._forceFullPlacement=G,this._showCollisionBoxes=K,this._done=!1}isDone(){return this._done}continuePlacement(y,L,G){const K=h.exported.now(),Q=()=>{const se=h.exported.now()-K;return!this._forceFullPlacement&&se>2};for(;this._currentPlacementIndex>=0;){const se=L[y[this._currentPlacementIndex]],ge=this.placement.collisionIndex.transform.zoom;if(se.type==="symbol"&&(!se.minzoom||se.minzoom<=ge)&&(!se.maxzoom||se.maxzoom>ge)){if(this._inProgressLayer||(this._inProgressLayer=new ho(se)),this._inProgressLayer.continuePlacement(G[se.source],this.placement,this._showCollisionBoxes,se,Q))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(y){return this.placement.commit(y),this.placement}}const cs=512/h.EXTENT/2;class uo{constructor(y,L,G){this.tileID=y,this.indexedSymbolInstances={},this.bucketInstanceId=G;for(let K=0;K<L.length;K++){const Q=L.get(K),se=Q.key;this.indexedSymbolInstances[se]||(this.indexedSymbolInstances[se]=[]),this.indexedSymbolInstances[se].push({crossTileID:Q.crossTileID,coord:this.getScaledCoordinates(Q,y)})}}getScaledCoordinates(y,L){const G=cs/Math.pow(2,L.canonical.z-this.tileID.canonical.z);return{x:Math.floor((L.canonical.x*h.EXTENT+y.tileAnchorX)*G),y:Math.floor((L.canonical.y*h.EXTENT+y.tileAnchorY)*G)}}findMatches(y,L,G){const K=this.tileID.canonical.z<L.canonical.z?1:Math.pow(2,this.tileID.canonical.z-L.canonical.z);for(let Q=0;Q<y.length;Q++){const se=y.get(Q);if(se.crossTileID)continue;const ge=this.indexedSymbolInstances[se.key];if(!ge)continue;const Ce=this.getScaledCoordinates(se,L);for(const Oe of ge)if(Math.abs(Oe.coord.x-Ce.x)<=K&&Math.abs(Oe.coord.y-Ce.y)<=K&&!G[Oe.crossTileID]){G[Oe.crossTileID]=!0,se.crossTileID=Oe.crossTileID;break}}}}class Fh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(y){const L=Math.round((y-this.lng)/360);if(L!==0)for(const G in this.indexes){const K=this.indexes[G],Q={};for(const se in K){const ge=K[se];ge.tileID=ge.tileID.unwrapTo(ge.tileID.wrap+L),Q[ge.tileID.key]=ge}this.indexes[G]=Q}this.lng=y}addBucket(y,L,G){if(this.indexes[y.overscaledZ]&&this.indexes[y.overscaledZ][y.key]){if(this.indexes[y.overscaledZ][y.key].bucketInstanceId===L.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(y.overscaledZ,this.indexes[y.overscaledZ][y.key])}for(let Q=0;Q<L.symbolInstances.length;Q++)L.symbolInstances.get(Q).crossTileID=0;this.usedCrossTileIDs[y.overscaledZ]||(this.usedCrossTileIDs[y.overscaledZ]={});const K=this.usedCrossTileIDs[y.overscaledZ];for(const Q in this.indexes){const se=this.indexes[Q];if(Number(Q)>y.overscaledZ)for(const ge in se){const Ce=se[ge];Ce.tileID.isChildOf(y)&&Ce.findMatches(L.symbolInstances,y,K)}else{const ge=se[y.scaledTo(Number(Q)).key];ge&&ge.findMatches(L.symbolInstances,y,K)}}for(let Q=0;Q<L.symbolInstances.length;Q++){const se=L.symbolInstances.get(Q);se.crossTileID||(se.crossTileID=G.generate(),K[se.crossTileID]=!0)}return this.indexes[y.overscaledZ]===void 0&&(this.indexes[y.overscaledZ]={}),this.indexes[y.overscaledZ][y.key]=new uo(y,L.symbolInstances,L.bucketInstanceId),!0}removeBucketCrossTileIDs(y,L){for(const G in L.indexedSymbolInstances)for(const K of L.indexedSymbolInstances[G])delete this.usedCrossTileIDs[y][K.crossTileID]}removeStaleBuckets(y){let L=!1;for(const G in this.indexes){const K=this.indexes[G];for(const Q in K)y[K[Q].bucketInstanceId]||(this.removeBucketCrossTileIDs(G,K[Q]),delete K[Q],L=!0)}return L}}class co{constructor(){this.layerIndexes={},this.crossTileIDs=new Fh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(y,L,G){let K=this.layerIndexes[y.id];K===void 0&&(K=this.layerIndexes[y.id]=new zh);let Q=!1;const se={};K.handleWrapJump(G);for(const ge of L){const Ce=ge.getBucket(y);Ce&&y.id===Ce.layerIds[0]&&(Ce.bucketInstanceId||(Ce.bucketInstanceId=++this.maxBucketInstanceId),K.addBucket(ge.tileID,Ce,this.crossTileIDs)&&(Q=!0),se[Ce.bucketInstanceId]=!0)}return K.removeStaleBuckets(se)&&(Q=!0),Q}pruneUnusedLayers(y){const L={};y.forEach(G=>{L[G]=!0});for(const G in this.layerIndexes)L[G]||delete this.layerIndexes[G]}}const fo=($,y)=>h.emitValidationErrors($,y&&y.filter(L=>L.identifier!=="source.canvas")),dl=h.pick(ai,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Nh=h.pick(ai,["setCenter","setZoom","setBearing","setPitch"]),pl=function(){const $={},y=h.spec.$version;for(const L in h.spec.$root){const G=h.spec.$root[L];if(G.required){let K=null;K=L==="version"?y:G.type==="array"?[]:{},K!=null&&($[L]=K)}}return $}(),Uh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Yr extends h.Evented{constructor(y,L={}){super(),this.map=y,this.dispatcher=new Le(ri(),this),this.imageManager=new X,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(y._requestManager,L.localFontFamily?h.LocalGlyphMode.all:L.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,L.localFontFamily||L.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new co,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const G=this;this._rtlTextPluginCallback=Yr.registerForPluginStateChange(K=>{G.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:K.pluginStatus,pluginURL:K.pluginURL},(Q,se)=>{if(h.triggerPluginCompletionEvent(Q),se&&se.every(ge=>ge))for(const ge in G._sourceCaches){const Ce=G._sourceCaches[ge],Oe=Ce.getSource().type;Oe!=="vector"&&Oe!=="geojson"||Ce.reload()}})}),this.on("data",K=>{if(K.dataType!=="source"||K.sourceDataType!=="metadata")return;const Q=this.getSource(K.sourceId);if(Q&&Q.vectorLayerIds)for(const se in this._layers){const ge=this._layers[se];ge.source===Q.id&&this._validateLayer(ge)}})}loadURL(y,L={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const G=typeof L.validate=="boolean"?L.validate:!h.isMapboxURL(y);y=this.map._requestManager.normalizeStyleURL(y,L.accessToken);const K=this.map._requestManager.transformRequest(y,h.ResourceType.Style);this._request=h.getJSON(K,(Q,se)=>{this._request=null,Q?this.fire(new h.ErrorEvent(Q)):se&&this._load(se,G)})}loadJSON(y,L={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(y,L.validate!==!1)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(pl,!1)}_updateLayerCount(y,L){const G=L?1:-1;y.is3D()&&(this._num3DLayers+=G),y.type==="circle"&&(this._numCircleLayers+=G),y.type==="symbol"&&(this._numSymbolLayers+=G)}_load(y,L){if(L&&fo(this,h.validateStyle(y)))return;this._loaded=!0,this.stylesheet=y,this.updateProjection();for(const K in y.sources)this.addSource(K,y.sources[K],{validate:!1});this._changed=!1,y.sprite?this._loadSprite(y.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(y.glyphs);const G=_i(this.stylesheet.layers);this._order=G.map(K=>K.id),this._layers={},this._serializedLayers={};for(let K of G)K=h.createStyleLayer(K),K.setEventedParent(this,{layer:{id:K.id}}),this._layers[K.id]=K,this._serializedLayers[K.id]=K.serialize(),this._updateLayerCount(K,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new te(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}setProjection(y){y?this.stylesheet.projection=y:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const y=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),y){this.map.painter.clearBackgroundTiles();for(const L in this._sourceCaches)this._sourceCaches[L].clearTiles();this.map._update(!0)}}_loadSprite(y){this._spriteRequest=function(L,G,K){let Q,se,ge;const Ce=h.exported.devicePixelRatio>1?"@2x":"";let Oe=h.getJSON(G.transformRequest(G.normalizeSpriteURL(L,Ce,".json"),h.ResourceType.SpriteJSON),(Qe,ht)=>{Oe=null,ge||(ge=Qe,Q=ht,Ue())}),Fe=h.getImage(G.transformRequest(G.normalizeSpriteURL(L,Ce,".png"),h.ResourceType.SpriteImage),(Qe,ht)=>{Fe=null,ge||(ge=Qe,se=ht,Ue())});function Ue(){if(ge)K(ge);else if(Q&&se){const Qe=h.exported.getImageData(se),ht={};for(const ct in Q){const{width:at,height:mt,x:st,y:gt,sdf:xt,pixelRatio:ut,stretchX:Et,stretchY:kt,content:Wt}=Q[ct],Zt=new h.RGBAImage({width:at,height:mt});h.RGBAImage.copy(Qe,Zt,{x:st,y:gt},{x:0,y:0},{width:at,height:mt}),ht[ct]={data:Zt,pixelRatio:ut,sdf:xt,stretchX:Et,stretchY:kt,content:Wt}}K(null,ht)}}return{cancel(){Oe&&(Oe.cancel(),Oe=null),Fe&&(Fe.cancel(),Fe=null)}}}(y,this.map._requestManager,(L,G)=>{if(this._spriteRequest=null,L)this.fire(new h.ErrorEvent(L));else if(G)for(const K in G)this.imageManager.addImage(K,G[K]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(y){const L=this.getSource(y.source);if(!L)return;const G=y.sourceLayer;G&&(L.type==="geojson"||L.vectorLayerIds&&L.vectorLayerIds.indexOf(G)===-1)&&this.fire(new h.ErrorEvent(new Error(`Source layer "${G}" does not exist on source "${L.id}" as specified by style layer "${y.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const y in this._sourceCaches)if(!this._sourceCaches[y].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(y){const L=[];for(const G of y){const K=this._layers[G];K.type!=="custom"&&L.push(K.serialize())}return L}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const y in this._sourceCaches)if(this._sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(y){return!!this.terrain&&Uh[y.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(y){if(!this._loaded)return;const L=this._changed;if(this._changed){const K=Object.keys(this._updatedLayers),Q=Object.keys(this._removedLayers);(K.length||Q.length)&&this._updateWorkerLayers(K,Q);for(const se in this._updatedSources){const ge=this._updatedSources[se];ge==="reload"?this._reloadSource(se):ge==="clear"&&this._clearSource(se)}this._updateTilesForChangedImages();for(const se in this._updatedPaintProps)this._layers[se].updateTransitions(y);this.light.updateTransitions(y),this.fog&&this.fog.updateTransitions(y),this._resetUpdates()}const G={};for(const K in this._sourceCaches){const Q=this._sourceCaches[K];G[K]=Q.used,Q.used=!1}for(const K of this._order){const Q=this._layers[K];if(Q.recalculate(y,this._availableImages),!Q.isHidden(y.zoom)){const ge=this._getLayerSourceCache(Q);ge&&(ge.used=!0)}const se=this.map.painter;if(se){const ge=Q.getProgramIds();if(!ge)continue;const Ce=Q.getProgramConfiguration(y.zoom);for(const Oe of ge)se.useProgram(Oe,Ce)}}for(const K in G){const Q=this._sourceCaches[K];G[K]!==Q.used&&Q.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Q.getSource().id}))}this.light.recalculate(y),this.terrain&&this.terrain.recalculate(y),this.fog&&this.fog.recalculate(y),this.z=y.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),L&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const y=Object.keys(this._changedImages);if(y.length){for(const L in this._sourceCaches)this._sourceCaches[L].reloadTilesForDependencies(["icons","patterns"],y);this._changedImages={}}}_updateWorkerLayers(y,L){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(y),removedIds:L})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(y){if(this._checkLoaded(),fo(this,h.validateStyle(y)))return!1;(y=h.clone$2(y)).layers=_i(y.layers);const L=function(K,Q){if(!K)return[{command:ai.setStyle,args:[Q]}];let se=[];try{if(!k(K.version,Q.version))return[{command:ai.setStyle,args:[Q]}];k(K.center,Q.center)||se.push({command:ai.setCenter,args:[Q.center]}),k(K.zoom,Q.zoom)||se.push({command:ai.setZoom,args:[Q.zoom]}),k(K.bearing,Q.bearing)||se.push({command:ai.setBearing,args:[Q.bearing]}),k(K.pitch,Q.pitch)||se.push({command:ai.setPitch,args:[Q.pitch]}),k(K.sprite,Q.sprite)||se.push({command:ai.setSprite,args:[Q.sprite]}),k(K.glyphs,Q.glyphs)||se.push({command:ai.setGlyphs,args:[Q.glyphs]}),k(K.transition,Q.transition)||se.push({command:ai.setTransition,args:[Q.transition]}),k(K.light,Q.light)||se.push({command:ai.setLight,args:[Q.light]}),k(K.fog,Q.fog)||se.push({command:ai.setFog,args:[Q.fog]}),k(K.projection,Q.projection)||se.push({command:ai.setProjection,args:[Q.projection]});const ge={},Ce=[];(function(Ue,Qe,ht,ct){let at;for(at in Qe=Qe||{},Ue=Ue||{})Ue.hasOwnProperty(at)&&(Qe.hasOwnProperty(at)||Ut(at,ht,ct));for(at in Qe)Qe.hasOwnProperty(at)&&(Ue.hasOwnProperty(at)?k(Ue[at],Qe[at])||(Ue[at].type==="geojson"&&Qe[at].type==="geojson"&&ki(Ue,Qe,at)?ht.push({command:ai.setGeoJSONSourceData,args:[at,Qe[at].data]}):Mi(at,Qe,ht,ct)):Ct(at,Qe,ht))})(K.sources,Q.sources,Ce,ge);const Oe=[];K.layers&&K.layers.forEach(Ue=>{ge[Ue.source]?se.push({command:ai.removeLayer,args:[Ue.id]}):Oe.push(Ue)});let Fe=K.terrain;Fe&&ge[Fe.source]&&(se.push({command:ai.setTerrain,args:[void 0]}),Fe=void 0),se=se.concat(Ce),k(Fe,Q.terrain)||se.push({command:ai.setTerrain,args:[Q.terrain]}),function(Ue,Qe,ht){Qe=Qe||[];const ct=(Ue=Ue||[]).map(Bi),at=Qe.map(Bi),mt=Ue.reduce(zi,{}),st=Qe.reduce(zi,{}),gt=ct.slice(),xt=Object.create(null);let ut,Et,kt,Wt,Zt,Jt,Qt;for(ut=0,Et=0;ut<ct.length;ut++)kt=ct[ut],st.hasOwnProperty(kt)?Et++:(ht.push({command:ai.removeLayer,args:[kt]}),gt.splice(gt.indexOf(kt,Et),1));for(ut=0,Et=0;ut<at.length;ut++)kt=at[at.length-1-ut],gt[gt.length-1-ut]!==kt&&(mt.hasOwnProperty(kt)?(ht.push({command:ai.removeLayer,args:[kt]}),gt.splice(gt.lastIndexOf(kt,gt.length-Et),1)):Et++,Jt=gt[gt.length-ut],ht.push({command:ai.addLayer,args:[st[kt],Jt]}),gt.splice(gt.length-ut,0,kt),xt[kt]=!0);for(ut=0;ut<at.length;ut++)if(kt=at[ut],Wt=mt[kt],Zt=st[kt],!xt[kt]&&!k(Wt,Zt))if(k(Wt.source,Zt.source)&&k(Wt["source-layer"],Zt["source-layer"])&&k(Wt.type,Zt.type)){for(Qt in Si(Wt.layout,Zt.layout,ht,kt,null,ai.setLayoutProperty),Si(Wt.paint,Zt.paint,ht,kt,null,ai.setPaintProperty),k(Wt.filter,Zt.filter)||ht.push({command:ai.setFilter,args:[kt,Zt.filter]}),k(Wt.minzoom,Zt.minzoom)&&k(Wt.maxzoom,Zt.maxzoom)||ht.push({command:ai.setLayerZoomRange,args:[kt,Zt.minzoom,Zt.maxzoom]}),Wt)Wt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Si(Wt[Qt],Zt[Qt],ht,kt,Qt.slice(6),ai.setPaintProperty):k(Wt[Qt],Zt[Qt])||ht.push({command:ai.setLayerProperty,args:[kt,Qt,Zt[Qt]]}));for(Qt in Zt)Zt.hasOwnProperty(Qt)&&!Wt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Si(Wt[Qt],Zt[Qt],ht,kt,Qt.slice(6),ai.setPaintProperty):k(Wt[Qt],Zt[Qt])||ht.push({command:ai.setLayerProperty,args:[kt,Qt,Zt[Qt]]}))}else ht.push({command:ai.removeLayer,args:[kt]}),Jt=gt[gt.lastIndexOf(kt)+1],ht.push({command:ai.addLayer,args:[Zt,Jt]})}(Oe,Q.layers,se)}catch(ge){console.warn("Unable to compute style diff:",ge),se=[{command:ai.setStyle,args:[Q]}]}return se}(this.serialize(),y).filter(K=>!(K.command in Nh));if(L.length===0)return!1;const G=L.filter(K=>!(K.command in dl));if(G.length>0)throw new Error(`Unimplemented: ${G.map(K=>K.command).join(", ")}.`);return L.forEach(K=>{K.command!=="setTransition"&&this[K.command].apply(this,K.args)}),this.stylesheet=y,!0}addImage(y,L){if(this.getImage(y))return this.fire(new h.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(y,L),this._afterImageUpdated(y)}updateImage(y,L){this.imageManager.updateImage(y,L)}getImage(y){return this.imageManager.getImage(y)}removeImage(y){if(!this.getImage(y))return this.fire(new h.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(y),this._afterImageUpdated(y)}_afterImageUpdated(y){this._availableImages=this.imageManager.listImages(),this._changedImages[y]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(y,L,G={}){if(this._checkLoaded(),this.getSource(y)!==void 0)throw new Error("There is already a source with this ID");if(!L.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(L).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(L.type)>=0&&this._validate(h.validateStyle.source,`sources.${y}`,L,null,G))return;this.map&&this.map._collectResourceTiming&&(L.collectResourceTiming=!0);const K=Se(y,L,this.dispatcher,this);K.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:K.serialize(),sourceId:y}));const Q=se=>{const ge=(se?"symbol:":"other:")+y,Ce=this._sourceCaches[ge]=new h.SourceCache(ge,K,se);(se?this._symbolSourceCaches:this._otherSourceCaches)[y]=Ce,Ce.style=this,Ce.onAdd(this.map)};Q(!1),L.type!=="vector"&&L.type!=="geojson"||Q(!0),K.onAdd&&K.onAdd(this.map),this._changed=!0}removeSource(y){this._checkLoaded();const L=this.getSource(y);if(L===void 0)throw new Error("There is no source with this ID");for(const K in this._layers)if(this._layers[K].source===y)return this.fire(new h.ErrorEvent(new Error(`Source "${y}" cannot be removed while layer "${K}" is using it.`)));if(this.terrain&&this.terrain.get().source===y)return this.fire(new h.ErrorEvent(new Error(`Source "${y}" cannot be removed while terrain is using it.`)));const G=this._getSourceCaches(y);for(const K of G)delete this._sourceCaches[K.id],delete this._updatedSources[K.id],K.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:K.getSource().id})),K.setEventedParent(null),K.clearTiles();delete this._otherSourceCaches[y],delete this._symbolSourceCaches[y],L.setEventedParent(null),L.onRemove&&L.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(y,L){this._checkLoaded(),this.getSource(y).setData(L),this._changed=!0}getSource(y){const L=this._getSourceCache(y);return L&&L.getSource()}addLayer(y,L,G={}){this._checkLoaded();const K=y.id;if(this.getLayer(K))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${K}" already exists on this map`)));let Q;if(y.type==="custom"){if(fo(this,h.validateCustomStyleLayer(y)))return;Q=h.createStyleLayer(y)}else{if(typeof y.source=="object"&&(this.addSource(K,y.source),y=h.clone$2(y),y=h.extend(y,{source:K})),this._validate(h.validateStyle.layer,`layers.${K}`,y,{arrayIndex:-1},G))return;Q=h.createStyleLayer(y),this._validateLayer(Q),Q.setEventedParent(this,{layer:{id:K}}),this._serializedLayers[Q.id]=Q.serialize(),this._updateLayerCount(Q,!0)}const se=L?this._order.indexOf(L):this._order.length;if(L&&se===-1)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${L}" does not exist on this map.`)));this._order.splice(se,0,K),this._layerOrderChanged=!0,this._layers[K]=Q;const ge=this._getLayerSourceCache(Q);if(this._removedLayers[K]&&Q.source&&ge&&Q.type!=="custom"){const Ce=this._removedLayers[K];delete this._removedLayers[K],Ce.type!==Q.type?this._updatedSources[Q.source]="clear":(this._updatedSources[Q.source]="reload",ge.pause())}this._updateLayer(Q),Q.onAdd&&Q.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(y,L){if(this._checkLoaded(),this._changed=!0,!this._layers[y])return void this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be moved.`)));if(y===L)return;const G=this._order.indexOf(y);this._order.splice(G,1);const K=L?this._order.indexOf(L):this._order.length;L&&K===-1?this.fire(new h.ErrorEvent(new Error(`Layer with id "${L}" does not exist on this map.`))):(this._order.splice(K,0,y),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(y){this._checkLoaded();const L=this._layers[y];if(!L)return void this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be removed.`)));L.setEventedParent(null),this._updateLayerCount(L,!1);const G=this._order.indexOf(y);this._order.splice(G,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[y]=L,delete this._layers[y],delete this._serializedLayers[y],delete this._updatedLayers[y],delete this._updatedPaintProps[y],L.onRemove&&L.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(y){return this._layers[y]}hasLayer(y){return y in this._layers}hasLayerType(y){for(const L in this._layers)if(this._layers[L].type===y)return!0;return!1}setLayerZoomRange(y,L,G){this._checkLoaded();const K=this.getLayer(y);K?K.minzoom===L&&K.maxzoom===G||(L!=null&&(K.minzoom=L),G!=null&&(K.maxzoom=G),this._updateLayer(K)):this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(y,L,G={}){this._checkLoaded();const K=this.getLayer(y);if(K){if(!k(K.filter,L))return L==null?(K.filter=void 0,void this._updateLayer(K)):void(this._validate(h.validateStyle.filter,`layers.${K.id}.filter`,L,{layerType:K.type},G)||(K.filter=h.clone$2(L),this._updateLayer(K)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be filtered.`)))}getFilter(y){return h.clone$2(this.getLayer(y).filter)}setLayoutProperty(y,L,G,K={}){this._checkLoaded();const Q=this.getLayer(y);Q?k(Q.getLayoutProperty(L),G)||(Q.setLayoutProperty(L,G,K),this._updateLayer(Q)):this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(y,L){const G=this.getLayer(y);if(G)return G.getLayoutProperty(L);this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style.`)))}setPaintProperty(y,L,G,K={}){this._checkLoaded();const Q=this.getLayer(y);Q?k(Q.getPaintProperty(L),G)||(Q.setPaintProperty(L,G,K)&&this._updateLayer(Q),this._changed=!0,this._updatedPaintProps[y]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(y,L){return this.getLayer(y).getPaintProperty(L)}setFeatureState(y,L){this._checkLoaded();const G=y.source,K=y.sourceLayer,Q=this.getSource(G);if(Q===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${G}' does not exist in the map's style.`)));const se=Q.type;if(se==="geojson"&&K)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(se==="vector"&&!K)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));y.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const ge=this._getSourceCaches(G);for(const Ce of ge)Ce.setFeatureState(K,y.id,L)}removeFeatureState(y,L){this._checkLoaded();const G=y.source,K=this.getSource(G);if(K===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${G}' does not exist in the map's style.`)));const Q=K.type,se=Q==="vector"?y.sourceLayer:void 0;if(Q==="vector"&&!se)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(L&&typeof y.id!="string"&&typeof y.id!="number")return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const ge=this._getSourceCaches(G);for(const Ce of ge)Ce.removeFeatureState(se,y.id,L)}getFeatureState(y){this._checkLoaded();const L=y.source,G=y.sourceLayer,K=this.getSource(L);if(K!==void 0){if(K.type!=="vector"||G)return y.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(L)[0].getFeatureState(G,y.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${L}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const y={};for(const L in this._sourceCaches){const G=this._sourceCaches[L].getSource();y[G.id]||(y[G.id]=G.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:y,layers:this._serializeLayers(this._order)},L=>L!==void 0)}_updateLayer(y){this._updatedLayers[y.id]=!0;const L=this._getLayerSourceCache(y);y.source&&!this._updatedSources[y.source]&&L&&L.getSource().type!=="raster"&&(this._updatedSources[y.source]="reload",L.pause()),this._changed=!0,y.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(y){const L=se=>this._layers[se].type==="fill-extrusion",G={},K=[];for(let se=this._order.length-1;se>=0;se--){const ge=this._order[se];if(L(ge)){G[ge]=se;for(const Ce of y){const Oe=Ce[ge];if(Oe)for(const Fe of Oe)K.push(Fe)}}}K.sort((se,ge)=>ge.intersectionZ-se.intersectionZ);const Q=[];for(let se=this._order.length-1;se>=0;se--){const ge=this._order[se];if(L(ge))for(let Ce=K.length-1;Ce>=0;Ce--){const Oe=K[Ce].feature;if(G[Oe.layer.id]<se)break;Q.push(Oe),K.pop()}else for(const Ce of y){const Oe=Ce[ge];if(Oe)for(const Fe of Oe)Q.push(Fe.feature)}}return Q}queryRenderedFeatures(y,L,G){L&&L.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",L.filter,null,L);const K={};if(L&&L.layers){if(!Array.isArray(L.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Ce of L.layers){const Oe=this._layers[Ce];if(!Oe)return this.fire(new h.ErrorEvent(new Error(`The layer '${Ce}' does not exist in the map's style and cannot be queried for features.`))),[];K[Oe.source]=!0}}const Q=[];L.availableImages=this._availableImages;const se=L&&L.layers?L.layers.some(Ce=>{const Oe=this.getLayer(Ce);return Oe&&Oe.is3D()}):this.has3DLayers(),ge=Xe.createFromScreenPoints(y,G);for(const Ce in this._sourceCaches){const Oe=this._sourceCaches[Ce].getSource().id;L.layers&&!K[Oe]||Q.push(We(this._sourceCaches[Ce],this._layers,this._serializedLayers,ge,L,G,se,!!this.map._showQueryGeometry))}return this.placement&&Q.push(function(Ce,Oe,Fe,Ue,Qe,ht,ct){const at={},mt=ht.queryRenderedSymbols(Ue),st=[];for(const gt of Object.keys(mt).map(Number))st.push(ct[gt]);st.sort(vt);for(const gt of st){const xt=gt.featureIndex.lookupSymbolFeatures(mt[gt.bucketInstanceId],Oe,gt.bucketIndex,gt.sourceLayerIndex,Qe.filter,Qe.layers,Qe.availableImages,Ce);for(const ut in xt){const Et=at[ut]=at[ut]||[],kt=xt[ut];kt.sort((Wt,Zt)=>{const Jt=gt.featureSortOrder;if(Jt){const Qt=Jt.indexOf(Wt.featureIndex);return Jt.indexOf(Zt.featureIndex)-Qt}return Zt.featureIndex-Wt.featureIndex});for(const Wt of kt)Et.push(Wt)}}for(const gt in at)at[gt].forEach(xt=>{const ut=xt.feature,Et=Fe(Ce[gt]).getFeatureState(ut.layer["source-layer"],ut.id);ut.source=ut.layer.source,ut.layer["source-layer"]&&(ut.sourceLayer=ut.layer["source-layer"]),ut.state=Et});return at}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),ge.screenGeometry,L,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Q)}querySourceFeatures(y,L){L&&L.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",L.filter,null,L);const G=this._getSourceCaches(y);let K=[];for(const Q of G)K=K.concat(nt(Q,L));return K}addSourceType(y,L,G){return Yr.getSourceType(y)?G(new Error(`A source type called "${y}" already exists.`)):(Yr.setSourceType(y,L),L.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:y,url:L.workerSourceURL},G):G(null,null))}getLight(){return this.light.getLight()}setLight(y,L={}){this._checkLoaded();const G=this.light.getLight();let K=!1;for(const se in y)if(!k(y[se],G[se])){K=!0;break}if(!K)return;const Q={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(y,L),this.light.updateTransitions(Q)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(y){if(this._checkLoaded(),!y)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof y.source=="object"){const L="terrain-dem-src";this.addSource(L,y.source),y=h.clone$2(y),y=h.extend(y,{source:L})}if(!this._validate(h.validateStyle.terrain,"terrain",y)){if(this.terrain){const L=this.terrain,G=L.get();for(const K in y)if(!k(y[K],G[K])){L.set(y),this.stylesheet.terrain=y;const Q={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};L.updateTransitions(Q);break}}else this._createTerrain(y);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(y){const L=this.fog=new xe(y,this.map.transform);this.stylesheet.fog=y;const G={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};L.updateTransitions(G)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const y of this.map._markers)y._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(y){if(this._checkLoaded(),!y)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const L=this.fog,G=L.get();for(const K in y)if(!k(y[K],G[K])){L.set(y),this.stylesheet.fog=y;const Q={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};L.updateTransitions(Q);break}}else this._createFog(y);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const y=this._order.filter(G=>this.isLayerDraped(this._layers[G])),L=this._order.filter(G=>!this.isLayerDraped(this._layers[G]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...y),this._drapedFirstOrder.push(...L)}_createTerrain(y){const L=this.terrain=new oe(y);this.stylesheet.terrain=y,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const G={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};L.updateTransitions(G)}_force3DLayerUpdate(){for(const y in this._layers){const L=this._layers[y];L.type==="fill-extrusion"&&this._updateLayer(L)}}_validate(y,L,G,K,Q={}){return(!Q||Q.validate!==!1)&&fo(this,y.call(h.validateStyle,h.extend({key:L,style:this.serialize(),value:G,styleSpec:h.spec},K)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles(),this._sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(y){const L=this._getSourceCaches(y);for(const G of L)G.clearTiles()}_reloadSource(y){const L=this._getSourceCaches(y);for(const G of L)G.resume(),G.reload()}_updateSources(y){for(const L in this._sourceCaches)this._sourceCaches[L].update(y)}_generateCollisionBoxes(){for(const y in this._sourceCaches){const L=this._sourceCaches[y];L.resume(),L.reload()}}_updatePlacement(y,L,G,K,Q=!1){let se=!1,ge=!1;const Ce={};for(const Oe of this._order){const Fe=this._layers[Oe];if(Fe.type!=="symbol")continue;if(!Ce[Fe.source]){const Qe=this._getLayerSourceCache(Fe);if(!Qe)continue;Ce[Fe.source]=Qe.getRenderableIds(!0).map(ht=>Qe.getTileByID(ht)).sort((ht,ct)=>ct.tileID.overscaledZ-ht.tileID.overscaledZ||(ht.tileID.isLessThan(ct.tileID)?-1:1))}const Ue=this.crossTileSymbolIndex.addLayer(Fe,Ce[Fe.source],y.center.lng);se=se||Ue}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),Q=Q||this._layerOrderChanged||G===0,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(Q||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),y.zoom))&&(this.pauseablePlacement=new En(y,this._order,Q,L,G,K,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Ce),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),ge=!0),se&&this.pauseablePlacement.placement.setStale()),ge||se)for(const Oe of this._order){const Fe=this._layers[Oe];Fe.type==="symbol"&&this.placement.updateLayerOpacities(Fe,Ce[Fe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const y in this._sourceCaches)this._sourceCaches[y].releaseSymbolFadeTiles()}getImages(y,L,G){this.imageManager.getImages(L.icons,G),this._updateTilesForChangedImages();const K=Q=>{Q&&Q.setDependencies(L.tileID.key,L.type,L.icons)};K(this._otherSourceCaches[L.source]),K(this._symbolSourceCaches[L.source])}getGlyphs(y,L,G){this.glyphManager.getGlyphs(L.stacks,G)}getResource(y,L,G){return h.makeRequest(L,G)}_getSourceCache(y){return this._otherSourceCaches[y]}_getLayerSourceCache(y){return y.type==="symbol"?this._symbolSourceCaches[y.source]:this._otherSourceCaches[y.source]}_getSourceCaches(y){const L=[];return this._otherSourceCaches[y]&&L.push(this._otherSourceCaches[y]),this._symbolSourceCaches[y]&&L.push(this._symbolSourceCaches[y]),L}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}Yr.getSourceType=function($){return le[$]},Yr.setSourceType=function($,y){le[$]=y},Yr.registerForPluginStateChange=h.registerForPluginStateChange;var fs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ds="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ka={},ia={};ka=Ui("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else 
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),ia=Ui(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Sn=Ui(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ra=fs;var po={background:Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ui(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ui("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ui(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ui(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ui(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ui(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ui(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ds),skyboxGradient:Ui(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ds),skyboxCapture:Ui(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ui(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Ui(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Ui(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Ui($,y,L){const G=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,K=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,Q=y.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),se=$.match(K),ge=y.match(K),Ce=fs.match(K);let Oe=ge?ge.concat(se):se;L||(ka.staticUniforms&&(Oe=ka.staticUniforms.concat(Oe)),ia.staticUniforms&&(Oe=ia.staticUniforms.concat(Oe))),Oe&&(Oe=Oe.concat(Ce));const Fe={};return{fragmentSource:$=$.replace(G,(Ue,Qe,ht,ct,at)=>(Fe[at]=!0,Qe==="define"?`
#ifndef HAS_UNIFORM_u_${at}
varying ${ht} ${ct} ${at};
#else
uniform ${ht} ${ct} u_${at};
#endif
`:`
#ifdef HAS_UNIFORM_u_${at}
    ${ht} ${ct} ${at} = u_${at};
#endif
`)),vertexSource:y=y.replace(G,(Ue,Qe,ht,ct,at)=>{const mt=ct==="float"?"vec2":"vec4",st=at.match(/color/)?"color":mt;return Fe[at]?Qe==="define"?`
#ifndef HAS_UNIFORM_u_${at}
uniform lowp float u_${at}_t;
attribute ${ht} ${mt} a_${at};
varying ${ht} ${ct} ${at};
#else
uniform ${ht} ${ct} u_${at};
#endif
`:st==="vec4"?`
#ifndef HAS_UNIFORM_u_${at}
    ${at} = a_${at};
#else
    ${ht} ${ct} ${at} = u_${at};
#endif
`:`
#ifndef HAS_UNIFORM_u_${at}
    ${at} = unpack_mix_${st}(a_${at}, u_${at}_t);
#else
    ${ht} ${ct} ${at} = u_${at};
#endif
`:Qe==="define"?`
#ifndef HAS_UNIFORM_u_${at}
uniform lowp float u_${at}_t;
attribute ${ht} ${mt} a_${at};
#else
uniform ${ht} ${ct} u_${at};
#endif
`:st==="vec4"?`
#ifndef HAS_UNIFORM_u_${at}
    ${ht} ${ct} ${at} = a_${at};
#else
    ${ht} ${ct} ${at} = u_${at};
#endif
`:`
#ifndef HAS_UNIFORM_u_${at}
    ${ht} ${ct} ${at} = unpack_mix_${st}(a_${at}, u_${at}_t);
#else
    ${ht} ${ct} ${at} = u_${at};
#endif
`}),staticAttributes:Q,staticUniforms:Oe}}class mo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(y,L,G,K,Q,se,ge,Ce){this.context=y;let Oe=this.boundPaintVertexBuffers.length!==K.length;for(let Fe=0;!Oe&&Fe<K.length;Fe++)this.boundPaintVertexBuffers[Fe]!==K[Fe]&&(Oe=!0);y.extVertexArrayObject&&this.vao&&this.boundProgram===L&&this.boundLayoutVertexBuffer===G&&!Oe&&this.boundIndexBuffer===Q&&this.boundVertexOffset===se&&this.boundDynamicVertexBuffer===ge&&this.boundDynamicVertexBuffer2===Ce?(y.bindVertexArrayOES.set(this.vao),ge&&ge.bind(),Q&&Q.dynamicDraw&&Q.bind(),Ce&&Ce.bind()):this.freshBind(L,G,K,Q,se,ge,Ce)}freshBind(y,L,G,K,Q,se,ge){let Ce;const Oe=y.numAttributes,Fe=this.context,Ue=Fe.gl;if(Fe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Fe.extVertexArrayObject.createVertexArrayOES(),Fe.bindVertexArrayOES.set(this.vao),Ce=0,this.boundProgram=y,this.boundLayoutVertexBuffer=L,this.boundPaintVertexBuffers=G,this.boundIndexBuffer=K,this.boundVertexOffset=Q,this.boundDynamicVertexBuffer=se,this.boundDynamicVertexBuffer2=ge;else{Ce=Fe.currentNumAttributes||0;for(let Qe=Oe;Qe<Ce;Qe++)Ue.disableVertexAttribArray(Qe)}L.enableAttributes(Ue,y);for(const Qe of G)Qe.enableAttributes(Ue,y);se&&se.enableAttributes(Ue,y),ge&&ge.enableAttributes(Ue,y),L.bind(),L.setVertexAttribPointers(Ue,y,Q);for(const Qe of G)Qe.bind(),Qe.setVertexAttribPointers(Ue,y,Q);se&&(se.bind(),se.setVertexAttribPointers(Ue,y,Q)),K&&K.bind(),ge&&(ge.bind(),ge.setVertexAttribPointers(Ue,y,Q)),Fe.currentNumAttributes=Oe}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function go($,y){const L=Math.pow(2,y.canonical.z),G=y.canonical.y;return[new h.MercatorCoordinate(0,G/L).toLngLat().lat,new h.MercatorCoordinate(0,(G+1)/L).toLngLat().lat]}function ps($,y,L,G,K,Q,se){const ge=$.context,Ce=ge.gl,Oe=L.fbo;if(!Oe)return;$.prepareDrawTile(y);const Fe=$.useProgram("hillshade");ge.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_2D,Oe.colorAttachment.get());const Ue=((at,mt,st,gt)=>{const xt=st.paint.get("hillshade-shadow-color"),ut=st.paint.get("hillshade-highlight-color"),Et=st.paint.get("hillshade-accent-color");let kt=st.paint.get("hillshade-illumination-direction")*(Math.PI/180);st.paint.get("hillshade-illumination-anchor")==="viewport"&&(kt-=at.transform.angle);const Wt=!at.options.moving;return{u_matrix:gt||at.transform.calculateProjMatrix(mt.tileID.toUnwrapped(),Wt),u_image:0,u_latrange:go(0,mt.tileID),u_light:[st.paint.get("hillshade-exaggeration"),kt],u_shadow:xt,u_highlight:ut,u_accent:Et}})($,L,G,$.terrain?y.projMatrix:null);$.prepareDrawProgram(ge,Fe,y.toUnwrapped());const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:ht,tileBoundsSegments:ct}=$.getTileBoundsBuffers(L);Fe.draw(ge,Ce.TRIANGLES,K,Q,se,h.CullFaceMode.disabled,Ue,G.id,Qe,ht,ct)}function Da($,y,L){if(!y.needsDEMTextureUpload)return;const G=$.context,K=G.gl;G.pixelStoreUnpackPremultiplyAlpha.set(!1),y.demTexture=y.demTexture||$.getTileTexture(L.stride);const Q=L.getPixels();y.demTexture?y.demTexture.update(Q,{premultiply:!1}):y.demTexture=new h.Texture(G,Q,K.RGBA,{premultiply:!1}),y.needsDEMTextureUpload=!1}function Ra($,y,L,G,K,Q){const se=$.context,ge=se.gl;if(!y.dem)return;const Ce=y.dem;if(se.activeTexture.set(ge.TEXTURE1),Da($,y,Ce),!y.demTexture)return;y.demTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const Oe=Ce.dim;se.activeTexture.set(ge.TEXTURE0);let Fe=y.fbo;if(!Fe){const ct=new h.Texture(se,{width:Oe,height:Oe,data:null},ge.RGBA);ct.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Fe=y.fbo=se.createFramebuffer(Oe,Oe,!0),Fe.colorAttachment.set(ct.texture)}se.bindFramebuffer.set(Fe.framebuffer),se.viewport.set([0,0,Oe,Oe]);const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Qe,tileBoundsSegments:ht}=$.getMercatorTileBoundsBuffers();$.useProgram("hillshadePrepare").draw(se,ge.TRIANGLES,G,K,Q,h.CullFaceMode.disabled,((ct,at)=>{const mt=at.stride,st=h.create$1();return h.ortho(st,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(st,st,[0,-h.EXTENT,0]),{u_matrix:st,u_image:1,u_dimension:[mt,mt],u_zoom:ct.overscaledZ,u_unpack:at.unpackVector}})(y.tileID,Ce),L.id,Ue,Qe,ht),y.needsHillshadePrepare=!1}const Vi=($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_image0:new h.Uniform1i($,y.u_image0),u_skirt_height:new h.Uniform1f($,y.u_skirt_height)}),Pa=($,y)=>({u_matrix:$,u_image0:0,u_skirt_height:y}),_o=new class{constructor(){this.operations={}}newMorphing($,y,L,G,K){if($ in this.operations){const Q=this.operations[$];Q.to.tileID.key!==L.tileID.key&&(Q.queued=L)}else this.operations[$]={startTime:G,phase:0,duration:K,from:y,to:L,queued:null}}getMorphValuesForProxy($){if(!($ in this.operations))return null;const y=this.operations[$];return{from:y.from,to:y.to,phase:y.phase}}update($){for(const y in this.operations){const L=this.operations[y];for(L.phase=($-L.startTime)/L.duration;L.phase>=1||!this._validOp(L);)if(!this._nextOp(L,$)){delete this.operations[y];break}}}_nextOp($,y){return!!$.queued&&($.from=$.to,$.to=$.queued,$.queued=null,$.phase=0,$.startTime=y,!0)}_validOp($){return $.from.hasData()&&$.to.hasData()}},ms={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ml($,y){const L=1<<$.z;return!y&&($.x===0||$.x===L-1)||$.y===0||$.y===L-1}const La=$=>({u_matrix:$});function gs($,y,L,G,K){if(K>0){const Q=h.exported.now(),se=(Q-$.timeAdded)/K,ge=y?(Q-y.timeAdded)/K:-1,Ce=L.getSource(),Oe=G.coveringZoomLevel({tileSize:Ce.tileSize,roundZoom:Ce.roundZoom}),Fe=!y||Math.abs(y.tileID.overscaledZ-Oe)>Math.abs($.tileID.overscaledZ-Oe),Ue=Fe&&$.refreshedUponExpiration?1:h.clamp(Fe?se:1-ge,0,1);return $.refreshedUponExpiration&&se>=1&&($.refreshedUponExpiration=!1),y?{opacity:1,mix:1-Ue}:{opacity:Ue,mix:0}}return{opacity:1,mix:0}}class $h extends h.SourceCache{constructor(y){const L=Se("proxy",{type:"geojson",maxzoom:y.transform.maxZoom},new Le(ri(),null),y.style);super("proxy",L,!1),L.setEventedParent(this),this.map=this.getSource().map=y,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(y,L,G){if(y.freezeTileCoverage)return;this.transform=y;const K=y.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((Q,se)=>{if(Q[se.key]="",!this._tiles[se.key]){const ge=new h.Tile(se,this._source.tileSize*se.overscaleFactor(),y.tileZoom);ge.state="loaded",this._tiles[se.key]=ge}return Q},{});for(const Q in this._tiles)Q in K||(this.freeFBO(Q),this._tiles[Q].unloadVectorData(),delete this._tiles[Q])}freeFBO(y){const L=this.proxyCachedFBO[y];if(L!==void 0){const G=Object.values(L);this.renderCachePool.push(...G),delete this.proxyCachedFBO[y]}}deallocRenderCache(){this.renderCache.forEach(y=>y.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gl extends h.OverscaledTileID{constructor(y,L,G){super(y.overscaledZ,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y),this.proxyTileKey=L,this.projMatrix=G}}class _s extends h.Elevation{constructor(y,L){super(),this.painter=y,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[G,K,Q]=function(Ce){const Oe=new h.StructArrayLayout4i8,Fe=new h.StructArrayLayout3ui6,Ue=131;Oe.reserve(17161),Fe.reserve(33800);const Qe=h.EXTENT/128,ht=h.EXTENT+Qe/2,ct=ht+Qe;for(let mt=-Qe;mt<ct;mt+=Qe)for(let st=-Qe;st<ct;st+=Qe){const gt=st<0||st>ht||mt<0||mt>ht?24575:0,xt=h.clamp(Math.round(st),0,h.EXTENT),ut=h.clamp(Math.round(mt),0,h.EXTENT);Oe.emplaceBack(xt+gt,ut,xt,ut)}const at=(mt,st)=>{const gt=st*Ue+mt;Fe.emplaceBack(gt+1,gt,gt+Ue),Fe.emplaceBack(gt+Ue,gt+Ue+1,gt+1)};for(let mt=1;mt<129;mt++)for(let st=1;st<129;st++)at(st,mt);return[0,129].forEach(mt=>{for(let st=0;st<130;st++)at(st,mt),at(mt,st)}),[Oe,Fe,32768]}(),se=y.context;this.gridBuffer=se.createVertexBuffer(G,h.boundsAttributes.members),this.gridIndexBuffer=se.createIndexBuffer(K),this.gridSegments=h.SegmentVector.simpleSegment(0,0,G.length,K.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,G.length,Q),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $h(L.map),this.orthoMatrix=h.create$1(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const ge=se.gl;this._overlapStencilMode=new h.StencilMode({func:ge.GEQUAL,mask:255},0,255,ge.KEEP,ge.KEEP,ge.REPLACE),this._previousZoom=y.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=L,this._useVertexMorphing=!0,this._exaggeration=1}set style(y){y.on("data",this._onStyleDataEvent.bind(this)),y.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=y,this._checkRenderCacheEfficiency()}update(y,L,G){if(y&&y.terrain){this._style!==y&&(this.style=y),this.enabled=!0;const K=y.terrain.properties;this.sourceCache=y._getSourceCache(K.get("source")),this._exaggeration=K.get("exaggeration");const Q=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const se=this.sourceCache.getSource().tileSize/128,ge=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(L,se*ge,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,Q(),this._initializing=!0),Q(),L.updateElevation(!G),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(L),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const y=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||y.efficiency!==100&&h.warnOnce(`Terrain render cache efficiency is not optimal (${y.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${y.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(y){y.coord&&y.dataType==="source"?this._clearRenderCacheForTile(y.sourceCacheId,y.coord):y.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const y in this._style._sourceCaches)this._style._sourceCaches[y].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(y=>y.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const y=2*this.proxySourceCache.getSource().tileSize;return[y,y]}set useVertexMorphing(y){this._useVertexMorphing=y}updateTileBinding(y){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const L=this.proxySourceCache,G=this.painter.transform;this._initializing&&(this._initializing=G._centerAltitude===0&&this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(G.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const K=this.proxyCoords=L.getIds().map(Ce=>{const Oe=L.getTileByID(Ce).tileID;return Oe.projMatrix=G.calculateProjMatrix(Oe.toUnwrapped()),Oe});(function(Ce,Oe){const Fe=Oe.transform.pointCoordinate(Oe.transform.getCameraPoint()),Ue=new h.pointGeometry(Fe.x,Fe.y);Ce.sort((Qe,ht)=>{if(ht.overscaledZ-Qe.overscaledZ)return ht.overscaledZ-Qe.overscaledZ;const ct=new h.pointGeometry(Qe.canonical.x+(1<<Qe.canonical.z)*Qe.wrap,Qe.canonical.y),at=new h.pointGeometry(ht.canonical.x+(1<<ht.canonical.z)*ht.wrap,ht.canonical.y),mt=Ue.mult(1<<Qe.canonical.z);return mt.x-=.5,mt.y-=.5,mt.distSqr(ct)-mt.distSqr(at)})})(K,this.painter),this._previousZoom=G.zoom;const Q=this.proxyToSource||{};this.proxyToSource={},K.forEach(Ce=>{this.proxyToSource[Ce.key]={}}),this.terrainTileForTile={};const se=this._style._sourceCaches;for(const Ce in se){const Oe=se[Ce];if(!Oe.used||(Oe!==this.sourceCache&&(this._findCoveringTileCache[Oe.id]={}),this._setupProxiedCoordsForOrtho(Oe,y[Ce],Q),Oe.usedForTerrain))continue;const Fe=y[Ce];Oe.getSource().reparseOverscaled&&this._assignTerrainTiles(Fe)}this.proxiedCoords[L.id]=K.map(Ce=>new gl(Ce,Ce.key,this.orthoMatrix)),this._assignTerrainTiles(K),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(Q),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const ge={};this._visibleDemTiles=[];for(const Ce of this.proxyCoords){const Oe=this.terrainTileForTile[Ce.key];if(!Oe)continue;const Fe=Oe.tileID.key;Fe in ge||(this._visibleDemTiles.push(Oe),ge[Fe]=Fe)}}_assignTerrainTiles(y){this._initializing||y.forEach(L=>{if(this.terrainTileForTile[L.key])return;const G=this._findTileCoveringTileID(L,this.sourceCache);G&&(this.terrainTileForTile[L.key]=G)})}_prepareDEMTextures(){const y=this.painter.context,L=y.gl;for(const G in this.terrainTileForTile){const K=this.terrainTileForTile[G],Q=K.dem;!Q||K.demTexture&&!K.needsDEMTextureUpload||(y.activeTexture.set(L.TEXTURE1),Da(this.painter,K,Q))}}_prepareDemTileUniforms(y,L,G,K){if(!L||L.demTexture==null)return!1;const Q=y.tileID.canonical,se=Math.pow(2,L.tileID.canonical.z-Q.z),ge=K||"";return G[`u_dem_tl${ge}`]=[Q.x*se%1,Q.y*se%1],G[`u_dem_scale${ge}`]=se,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let y=0;const L=this._visibleDemTiles.reduce((G,K)=>{if(!K.dem)return G;const Q=K.dem.tree.minimums[0];return Q>0&&y++,G+Q},0);return y?L/y:0}_updateEmptyDEMTexture(){const y=this.painter.context,L=y.gl;y.activeTexture.set(L.TEXTURE2);const G=this._getLoadedAreaMinimum(),K={width:1,height:1,data:new Uint8Array(h.DEMData.pack(G,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let Q=this._emptyDEMTexture;return Q?Q.update(K,{premultiply:!1}):Q=this._emptyDEMTexture=new h.Texture(y,K,L.RGBA,{premultiply:!1}),Q}setupElevationDraw(y,L,G){const K=this.painter.context,Q=K.gl,se=(ge=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(ge),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var ge;se.u_dem_size=this.sourceCache.getSource().tileSize,se.u_exaggeration=this.exaggeration();let Ce=null,Oe=null,Fe=1;if(G&&G.morphing&&this._useVertexMorphing){const Ue=G.morphing.srcDemTile,Qe=G.morphing.dstDemTile;Fe=G.morphing.phase,Ue&&Qe&&(this._prepareDemTileUniforms(y,Ue,se,"_prev")&&(Oe=Ue),this._prepareDemTileUniforms(y,Qe,se)&&(Ce=Qe))}if(Oe&&Ce?(K.activeTexture.set(Q.TEXTURE2),Ce.demTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE,Q.NEAREST),K.activeTexture.set(Q.TEXTURE4),Oe.demTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE,Q.NEAREST),se.u_dem_lerp=Fe):(Ce=this.terrainTileForTile[y.tileID.key],K.activeTexture.set(Q.TEXTURE2),(this._prepareDemTileUniforms(y,Ce,se)?Ce.demTexture:this.emptyDEMTexture).bind(Q.NEAREST,Q.CLAMP_TO_EDGE)),G&&G.useDepthForOcclusion&&(K.activeTexture.set(Q.TEXTURE3),this._depthTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),se.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),G&&G.useMeterToDem&&Ce){const Ue=(1<<Ce.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;se.u_meter_to_dem=Ue}G&&G.labelPlaneMatrixInv&&(se.u_label_plane_matrix_inv=G.labelPlaneMatrixInv),L.setTerrainUniformValues(K,se)}renderToBackBuffer(y){const L=this.painter,G=this.painter.context;y.length!==0&&(G.bindFramebuffer.set(null),G.viewport.set([0,0,L.width,L.height]),this.renderingToTexture=!1,function(K,Q,se,ge,Ce){const Oe=K.context,Fe=Oe.gl;let Ue,Qe;const ht=K.options.showTerrainWireframe?2:0,ct=(xt,ut)=>{if(Qe===xt)return;const Et=[ms[xt]];ut&&Et.push(ms[ht]),Ue=K.useProgram("terrainRaster",null,Et),Qe=xt},at=K.colorModeForRenderPass(),mt=new h.DepthMode(Fe.LEQUAL,h.DepthMode.ReadWrite,K.depthRangeFor3D);_o.update(Ce);const st=K.transform,gt=6*Math.pow(1.5,22-st.zoom)*Q.exaggeration();(ht?[!1,!0]:[!1]).forEach(xt=>{Qe=-1;const ut=xt?Fe.LINES:Fe.TRIANGLES,[Et,kt]=xt?Q.getWirefameBuffer():[Q.gridIndexBuffer,Q.gridSegments];for(const Jt of ge){const Qt=se.getTile(Jt),ci=h.StencilMode.disabled,Kt=Q.prevTerrainTileForTile[Jt.key],di=Q.terrainTileForTile[Jt.key];Zt=di,(Wt=Kt)!=null&&Zt!=null&&Wt.hasData()&&Zt.hasData()&&Wt.demTexture!=null&&Zt.demTexture!=null&&Wt.tileID.key!==Zt.tileID.key&&_o.newMorphing(Jt.key,Kt,di,Ce,250),Oe.activeTexture.set(Fe.TEXTURE0),Qt.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE);const Gt=_o.getMorphValuesForProxy(Jt.key),pi=Gt?1:0;let Ei;Gt&&(Ei={morphing:{srcDemTile:Gt.from,dstDemTile:Gt.to,phase:h.easeCubicInOut(Gt.phase)}});const Ai=Pa(Jt.projMatrix,ml(Jt.canonical,st.renderWorldCopies)?gt/10:gt);ct(pi,xt),Q.setupElevationDraw(Qt,Ue,Ei),K.prepareDrawProgram(Oe,Ue,Jt.toUnwrapped()),Ue.draw(Oe,ut,mt,ci,at,h.CullFaceMode.backCCW,Ai,"terrain_raster",Q.gridBuffer,Et,kt)}var Wt,Zt})}(L,this,this.proxySourceCache,y,this._updateTimestamp),this.renderingToTexture=!0,y.splice(0,y.length))}renderBatch(y){if(this._drapedRenderBatches.length===0)return y+1;this.renderingToTexture=!0;const L=this.painter,G=this.painter.context,K=this.proxySourceCache,Q=this.proxiedCoords[K.id],se=this._drapedRenderBatches.shift(),ge=[],Ce=L.style.order;let Oe=0;for(const Fe of Q){const Ue=K.getTileByID(Fe.proxyTileKey),Qe=K.proxyCachedFBO[Fe.key]?K.proxyCachedFBO[Fe.key][y]:void 0,ht=Qe!==void 0?K.renderCache[Qe]:this.pool[Oe++],ct=Qe!==void 0;if(Ue.texture=ht.tex,ct&&!ht.dirty){ge.push(Ue.tileID);continue}let at;G.bindFramebuffer.set(ht.fb.framebuffer),this.renderedToTile=!1,ht.dirty&&(G.clear({color:h.Color.transparent}),ht.dirty=!1);for(let mt=se.start;mt<=se.end;++mt){const st=L.style._layers[Ce[mt]];if(st.isHidden(L.transform.zoom))continue;const gt=L.style._getLayerSourceCache(st),xt=gt?this.proxyToSource[Fe.key][gt.id]:[Fe];if(!xt)continue;const ut=xt;G.viewport.set([0,0,ht.fb.width,ht.fb.height]),at!==(gt?gt.id:null)&&(this._setupStencil(ht,xt,st,gt),at=gt?gt.id:null),L.renderLayer(L,gt,st,ut)}this.renderedToTile?(ht.dirty=!0,ge.push(Ue.tileID)):ct||--Oe,Oe===5&&(Oe=0,this.renderToBackBuffer(ge))}return this.renderToBackBuffer(ge),this.renderingToTexture=!1,G.bindFramebuffer.set(null),G.viewport.set([0,0,L.width,L.height]),se.end+1}postRender(){}renderCacheEfficiency(y){const L=y.order.length;if(L===0)return{efficiency:100};let G,K=0,Q=0,se=!1;for(let ge=0;ge<L;++ge){const Ce=y._layers[y.order[ge]];this._style.isLayerDraped(Ce)?(se&&++K,++Q):se||(se=!0,G=Ce.id)}return Q===0?{efficiency:100}:{efficiency:100*(1-K/Q),firstUndrapedLayer:G}}getMinElevationBelowMSL(){let y=0;return this._visibleDemTiles.filter(L=>L.dem).forEach(L=>{y=Math.min(y,L.dem.tree.minimums[0])}),y===0?y:(y-30)*this._exaggeration}raycast(y,L,G){if(!this._visibleDemTiles)return null;const K=this._visibleDemTiles.filter(Q=>Q.dem).map(Q=>{const se=Q.tileID,ge=Math.pow(2,se.overscaledZ),{x:Ce,y:Oe}=se.canonical,Fe=Ce/ge,Ue=(Ce+1)/ge,Qe=Oe/ge,ht=(Oe+1)/ge;return{minx:Fe,miny:Qe,maxx:Ue,maxy:ht,t:Q.dem.tree.raycastRoot(Fe,Qe,Ue,ht,y,L,G),tile:Q}});K.sort((Q,se)=>(Q.t!==null?Q.t:Number.MAX_VALUE)-(se.t!==null?se.t:Number.MAX_VALUE));for(const Q of K){if(Q.t==null)return null;const se=Q.tile.dem.tree.raycast(Q.minx,Q.miny,Q.maxx,Q.maxy,y,L,G);if(se!=null)return se}return null}_createFBO(){const y=this.painter.context,L=y.gl,G=this.drapeBufferSize;y.activeTexture.set(L.TEXTURE0);const K=new h.Texture(y,{width:G[0],height:G[1],data:null},L.RGBA);K.bind(L.LINEAR,L.CLAMP_TO_EDGE);const Q=y.createFramebuffer(G[0],G[1],!1);return Q.colorAttachment.set(K.texture),Q.depthAttachment=new jt(y,Q.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=y.createRenderbuffer(y.gl.DEPTH_STENCIL,G[0],G[1]),this._stencilRef=0,Q.depthAttachment.set(this._sharedDepthStencil),y.clear({stencil:0})):Q.depthAttachment.set(this._sharedDepthStencil),y.extTextureFilterAnisotropic&&!y.extTextureFilterAnisotropicForceOff&&L.texParameterf(L.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax),{fb:Q,tex:K,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y].hasTransition())return!0;return this._style.order.some(y=>{const L=this._style._layers[y],G=L.isHidden(this.painter.transform.zoom),K=L.getCrossfadeParameters(),Q=!!K&&K.t!==1,se=L.hasTransition();return L.type!=="custom"&&!G&&(Q||se)})}_clearRasterFadeFromRenderCache(){let y=!1;for(const L in this._style._sourceCaches)if(this._style._sourceCaches[L]._source instanceof ke){y=!0;break}if(y)for(let L=0;L<this._style.order.length;++L){const G=this._style._layers[this._style.order[L]],K=G.isHidden(this.painter.transform.zoom),Q=this._style._getLayerSourceCache(G);if(G.type!=="raster"||K||!Q)continue;const se=G.paint.get("raster-fade-duration");for(const ge of this.proxyCoords){const Ce=this.proxyToSource[ge.key][Q.id];if(Ce)for(const Oe of Ce){const Fe=gs(Q.getTile(Oe),Q.findLoadedParent(Oe,0),Q,this.painter.transform,se);(Fe.opacity!==1||Fe.mix!==0)&&this._clearRenderCacheForTile(Q.id,Oe)}}}}_setupDrapedRenderBatches(){const y=this._style.order,L=y.length;if(L===0)return;const G=[];let K,Q=0,se=this._style._layers[y[Q]];for(;!this._style.isLayerDraped(se)&&se.isHidden(this.painter.transform.zoom)&&++Q<L;)se=this._style._layers[y[Q]];for(;Q<L;++Q){const ge=this._style._layers[y[Q]];ge.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(ge)?K===void 0&&(K=Q):K!==void 0&&(G.push({start:K,end:Q-1}),K=void 0))}K!==void 0&&G.push({start:K,end:Q-1}),this._drapedRenderBatches=G}_setupRenderCache(y){const L=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,L.renderCache.length>L.renderCachePool.length){const se=Object.values(L.proxyCachedFBO);L.proxyCachedFBO={};for(let ge=0;ge<se.length;++ge){const Ce=Object.values(se[ge]);L.renderCachePool.push(...Ce)}}return}this._clearRasterFadeFromRenderCache();const G=this.proxyCoords,K=this._tilesDirty;for(let se=G.length-1;se>=0;se--){const ge=G[se];if(L.getTileByID(ge.key),L.proxyCachedFBO[ge.key]!==void 0){const Ce=y[ge.key],Oe=this.proxyToSource[ge.key];let Fe=0;for(const Ue in Oe){const Qe=Oe[Ue],ht=Ce[Ue];if(!ht||ht.length!==Qe.length||Qe.some((ct,at)=>ct!==ht[at]||K[Ue]&&K[Ue].hasOwnProperty(ct.key))){Fe=-1;break}++Fe}for(const Ue in L.proxyCachedFBO[ge.key])L.renderCache[L.proxyCachedFBO[ge.key][Ue]].dirty=Fe<0||Fe!==Object.values(Ce).length}}const Q=[...this._drapedRenderBatches];Q.sort((se,ge)=>ge.end-ge.start-(se.end-se.start));for(const se of Q)for(const ge of G){if(L.proxyCachedFBO[ge.key])continue;let Ce=L.renderCachePool.pop();Ce===void 0&&L.renderCache.length<50&&(Ce=L.renderCache.length,L.renderCache.push(this._createFBO())),Ce!==void 0&&(L.proxyCachedFBO[ge.key]={},L.proxyCachedFBO[ge.key][se.start]=Ce,L.renderCache[Ce].dirty=!0)}this._tilesDirty={}}_setupStencil(y,L,G,K){if(!K||!this._sourceTilesOverlap[K.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const Q=this.painter.context,se=Q.gl;if(L.length<=1)return void(this._overlapStencilType=!1);let ge;if(G.isTileClipped())ge=L.length,this._overlapStencilMode.test={func:se.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(L[0].overscaledZ>L[L.length-1].overscaledZ))return void(this._overlapStencilType=!1);ge=1,this._overlapStencilMode.test={func:se.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+ge>255&&(Q.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=ge,this._overlapStencilMode.ref=this._stencilRef,G.isTileClipped()&&this._renderTileClippingMasks(L,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(y){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[y.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(y,L){const G=this.painter,K=this.painter.context,Q=K.gl;G._tileClippingMaskIDs={},K.setColorMode(h.ColorMode.disabled),K.setDepthMode(h.DepthMode.disabled);const se=G.useProgram("clippingMask");for(const ge of y){const Ce=G._tileClippingMaskIDs[ge.key]=--L;se.draw(K,Q.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:Q.ALWAYS,mask:0},Ce,255,Q.KEEP,Q.KEEP,Q.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,La(ge.projMatrix),"$clipping",G.tileExtentBuffer,G.quadTriangleIndexBuffer,G.tileExtentSegments)}}pointCoordinate(y){const L=this.painter.transform;if(y.x<0||y.x>L.width||y.y<0||y.y>L.height)return null;const G=[y.x,y.y,1,1];h.transformMat4(G,G,L.pixelMatrixInverse),h.scale$2(G,G,1/G[3]),G[0]/=L.worldSize,G[1]/=L.worldSize;const K=L._camera.position,Q=h.mercatorZfromAltitude(1,L.center.lat),se=[K[0],K[1],K[2]/Q,0],ge=h.subtract([],G.slice(0,3),se);h.normalize(ge,ge);const Ce=this.raycast(se,ge,this._exaggeration);return Ce!==null&&Ce?(h.scaleAndAdd(se,se,ge,Ce),se[3]=se[2],se[2]*=Q,se):null}drawDepth(){const y=this.painter,L=y.context,G=this.proxySourceCache,K=Math.ceil(y.width),Q=Math.ceil(y.height);if(!this._depthFBO||this._depthFBO.width===K&&this._depthFBO.height===Q||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const se=L.gl,ge=L.createFramebuffer(K,Q,!0);L.activeTexture.set(se.TEXTURE0);const Ce=new h.Texture(L,{width:K,height:Q,data:null},se.RGBA);Ce.bind(se.NEAREST,se.CLAMP_TO_EDGE),ge.colorAttachment.set(Ce.texture);const Oe=L.createRenderbuffer(L.gl.DEPTH_COMPONENT16,K,Q);ge.depthAttachment.set(Oe),this._depthFBO=ge,this._depthTexture=Ce}L.bindFramebuffer.set(this._depthFBO.framebuffer),L.viewport.set([0,0,K,Q]),function(se,ge,Ce,Oe){const Fe=se.context,Ue=Fe.gl;Fe.clear({depth:1});const Qe=se.useProgram("terrainDepth"),ht=new h.DepthMode(Ue.LESS,h.DepthMode.ReadWrite,se.depthRangeFor3D);for(const ct of Oe){const at=Ce.getTile(ct),mt=Pa(ct.projMatrix,0);ge.setupElevationDraw(at,Qe),Qe.draw(Fe,Ue.TRIANGLES,ht,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,mt,"terrain_depth",ge.gridBuffer,ge.gridIndexBuffer,ge.gridNoSkirtSegments)}}(y,this,G,this.proxyCoords)}_setupProxiedCoordsForOrtho(y,L,G){if(y.getSource()instanceof re)return this._setupProxiedCoordsForImageSource(y,L,G);this._findCoveringTileCache[y.id]=this._findCoveringTileCache[y.id]||{};const K=this.proxiedCoords[y.id]=[],Q=this.proxyCoords;for(let ge=0;ge<Q.length;ge++){const Ce=Q[ge],Oe=this._findTileCoveringTileID(Ce,y);if(Oe){const Fe=this._createProxiedId(Ce,Oe,G[Ce.key]&&G[Ce.key][y.id]);K.push(Fe),this.proxyToSource[Ce.key][y.id]=[Fe]}}let se=!1;for(let ge=0;ge<L.length;ge++){const Ce=y.getTile(L[ge]);if(!Ce||!Ce.hasData())continue;const Oe=this._findTileCoveringTileID(Ce.tileID,this.proxySourceCache);if(Oe&&Oe.tileID.canonical.z!==Ce.tileID.canonical.z){const Fe=this.proxyToSource[Oe.tileID.key][y.id],Ue=this._createProxiedId(Oe.tileID,Ce,G[Oe.tileID.key]&&G[Oe.tileID.key][y.id]);Fe?Fe.splice(Fe.length-1,0,Ue):this.proxyToSource[Oe.tileID.key][y.id]=[Ue],K.push(Ue),se=!0}}this._sourceTilesOverlap[y.id]=se}_setupProxiedCoordsForImageSource(y,L,G){if(!y.getSource().loaded())return;const K=this.proxiedCoords[y.id]=[],Q=this.proxyCoords,se=y.getSource(),ge=new h.pointGeometry(se.tileID.x,se.tileID.y)._div(1<<se.tileID.z),Ce=se.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((Fe,Ue)=>(Fe.min.x=Math.min(Fe.min.x,Ue.x-ge.x),Fe.min.y=Math.min(Fe.min.y,Ue.y-ge.y),Fe.max.x=Math.max(Fe.max.x,Ue.x-ge.x),Fe.max.y=Math.max(Fe.max.y,Ue.y-ge.y),Fe),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Oe=(Fe,Ue)=>{const Qe=Fe.wrap+Fe.canonical.x/(1<<Fe.canonical.z),ht=Fe.canonical.y/(1<<Fe.canonical.z),ct=h.EXTENT/(1<<Fe.canonical.z),at=Ue.wrap+Ue.canonical.x/(1<<Ue.canonical.z),mt=Ue.canonical.y/(1<<Ue.canonical.z);return Qe+ct<at+Ce.min.x||Qe>at+Ce.max.x||ht+ct<mt+Ce.min.y||ht>mt+Ce.max.y};for(let Fe=0;Fe<Q.length;Fe++){const Ue=Q[Fe];for(let Qe=0;Qe<L.length;Qe++){const ht=y.getTile(L[Qe]);if(!ht||!ht.hasData()||Oe(Ue,ht.tileID))continue;const ct=this._createProxiedId(Ue,ht,G[Ue.key]&&G[Ue.key][y.id]),at=this.proxyToSource[Ue.key][y.id];at?at.push(ct):this.proxyToSource[Ue.key][y.id]=[ct],K.push(ct)}}}_createProxiedId(y,L,G){let K=this.orthoMatrix;if(G){const Q=G.find(se=>se.key===L.tileID.key);if(Q)return Q}if(L.tileID.key!==y.key){const Q=y.canonical.z-L.tileID.canonical.z;let se,ge,Ce;K=h.create$1();const Oe=L.tileID.wrap-y.wrap<<y.overscaledZ;Q>0?(se=h.EXTENT>>Q,ge=se*((L.tileID.canonical.x<<Q)-y.canonical.x+Oe),Ce=se*((L.tileID.canonical.y<<Q)-y.canonical.y)):(se=h.EXTENT<<-Q,ge=h.EXTENT*(L.tileID.canonical.x-(y.canonical.x+Oe<<-Q)),Ce=h.EXTENT*(L.tileID.canonical.y-(y.canonical.y<<-Q))),h.ortho(K,0,se,0,se,0,1),h.translate(K,K,[ge,Ce,0])}return new gl(L.tileID,y.key,K)}_findTileCoveringTileID(y,L){let G=L.getTile(y);if(G&&G.hasData())return G;const K=this._findCoveringTileCache[L.id],Q=K[y.key];if(G=Q?L.getTileByID(Q):null,G&&G.hasData()||Q===null)return G;let se=G?G.tileID:y,ge=se.overscaledZ;const Ce=L.getSource().minzoom,Oe=[];if(!Q){const Ue=L.getSource().maxzoom;if(y.canonical.z>=Ue){const Qe=y.canonical.z-Ue;L.getSource().reparseOverscaled?(ge=Math.max(y.canonical.z+2,L.transform.tileZoom),se=new h.OverscaledTileID(ge,y.wrap,Ue,y.canonical.x>>Qe,y.canonical.y>>Qe)):Qe!==0&&(ge=Ue,se=new h.OverscaledTileID(ge,y.wrap,Ue,y.canonical.x>>Qe,y.canonical.y>>Qe))}se.key!==y.key&&(Oe.push(se.key),G=L.getTile(se))}const Fe=Ue=>{Oe.forEach(Qe=>{K[Qe]=Ue}),Oe.length=0};for(ge-=1;ge>=Ce&&(!G||!G.hasData());ge--){G&&Fe(G.tileID.key);const Ue=se.calculateScaledKey(ge);if(G=L.getTileByID(Ue),G&&G.hasData())break;const Qe=K[Ue];if(Qe===null)break;Qe===void 0?Oe.push(Ue):G=L.getTileByID(Qe)}return Fe(G?G.tileID.key:null),G&&G.hasData()?G:null}findDEMTileFor(y){return this.enabled?this._findTileCoveringTileID(y,this.sourceCache):null}prepareDrawTile(y){this.renderedToTile=!0}_clearRenderCacheForTile(y,L){let G=this._tilesDirty[y];G||(G=this._tilesDirty[y]={}),G[L.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const y=function(L){let G,K,Q;const se=new h.StructArrayLayout2ui4,ge=131;for(K=1;K<129;K++){for(G=1;G<129;G++)Q=K*ge+G,se.emplaceBack(Q,Q+1),se.emplaceBack(Q,Q+ge),se.emplaceBack(Q+1,Q+ge),K===128&&se.emplaceBack(Q+ge,Q+ge+1);se.emplaceBack(Q+1,Q+1+ge)}return se}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(y),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,y.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function yo($){const y=[];for(let L=0;L<$.length;L++){if($[L]===null)continue;const G=$[L].split(" ");y.push(G.pop())}return y}class vo{static cacheKey(y,L,G){let K=`${y}${G?G.cacheKey:""}`;for(const Q of L)K+=`/${Q}`;return K}constructor(y,L,G,K,Q,se){const ge=y.gl;this.program=ge.createProgram();const Ce=yo(G.staticAttributes),Oe=K?K.getBinderAttributes():[],Fe=Ce.concat(Oe),Ue=G.staticUniforms?yo(G.staticUniforms):[],Qe=K?K.getBinderUniforms():[],ht=Ue.concat(Qe),ct=[];for(const Et of ht)ct.indexOf(Et)<0&&ct.push(Et);let at=K?K.defines():[];at=at.concat(se.map(Et=>`#define ${Et}`));const mt=at.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ra,Sn.fragmentSource,ia.fragmentSource,G.fragmentSource).join(`
`),st=at.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ra,Sn.vertexSource,ia.vertexSource,ka.vertexSource,G.vertexSource).join(`
`),gt=ge.createShader(ge.FRAGMENT_SHADER);if(ge.isContextLost())return void(this.failedToCreate=!0);ge.shaderSource(gt,mt),ge.compileShader(gt),ge.attachShader(this.program,gt);const xt=ge.createShader(ge.VERTEX_SHADER);if(ge.isContextLost())return void(this.failedToCreate=!0);ge.shaderSource(xt,st),ge.compileShader(xt),ge.attachShader(this.program,xt),this.attributes={};const ut={};this.numAttributes=Fe.length;for(let Et=0;Et<this.numAttributes;Et++)Fe[Et]&&(ge.bindAttribLocation(this.program,Et,Fe[Et]),this.attributes[Fe[Et]]=Et);ge.linkProgram(this.program),ge.deleteShader(xt),ge.deleteShader(gt);for(let Et=0;Et<ct.length;Et++){const kt=ct[Et];if(kt&&!ut[kt]){const Wt=ge.getUniformLocation(this.program,kt);Wt&&(ut[kt]=Wt)}}this.fixedUniforms=Q(y,ut),this.binderUniforms=K?K.getUniforms(y,ut):[],se.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Et,kt)=>({u_dem:new h.Uniform1i(Et,kt.u_dem),u_dem_prev:new h.Uniform1i(Et,kt.u_dem_prev),u_dem_unpack:new h.Uniform4f(Et,kt.u_dem_unpack),u_dem_tl:new h.Uniform2f(Et,kt.u_dem_tl),u_dem_scale:new h.Uniform1f(Et,kt.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(Et,kt.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(Et,kt.u_dem_scale_prev),u_dem_size:new h.Uniform1f(Et,kt.u_dem_size),u_dem_lerp:new h.Uniform1f(Et,kt.u_dem_lerp),u_exaggeration:new h.Uniform1f(Et,kt.u_exaggeration),u_depth:new h.Uniform1i(Et,kt.u_depth),u_depth_size_inv:new h.Uniform2f(Et,kt.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(Et,kt.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(Et,kt.u_label_plane_matrix_inv),u_tile_tl_up:new h.Uniform3f(Et,kt.u_tile_tl_up),u_tile_tr_up:new h.Uniform3f(Et,kt.u_tile_tr_up),u_tile_br_up:new h.Uniform3f(Et,kt.u_tile_br_up),u_tile_bl_up:new h.Uniform3f(Et,kt.u_tile_bl_up),u_tile_up_scale:new h.Uniform1f(Et,kt.u_tile_up_scale)}))(y,ut)),se.indexOf("FOG")!==-1&&(this.fogUniforms=((Et,kt)=>({u_fog_matrix:new h.UniformMatrix4f(Et,kt.u_fog_matrix),u_fog_range:new h.Uniform2f(Et,kt.u_fog_range),u_fog_color:new h.Uniform4f(Et,kt.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(Et,kt.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(Et,kt.u_fog_temporal_offset)}))(y,ut))}setTerrainUniformValues(y,L){if(!this.terrainUniforms)return;const G=this.terrainUniforms;if(!this.failedToCreate){y.program.set(this.program);for(const K in L)G[K].set(L[K])}}setFogUniformValues(y,L){if(!this.fogUniforms)return;const G=this.fogUniforms;if(!this.failedToCreate){y.program.set(this.program);for(const K in L)G[K].location&&G[K].set(L[K])}}draw(y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct,at,mt){const st=y.gl;if(this.failedToCreate)return;y.program.set(this.program),y.setDepthMode(G),y.setStencilMode(K),y.setColorMode(Q),y.setCullFace(se);for(const xt in this.fixedUniforms)this.fixedUniforms[xt].set(ge[xt]);ct&&ct.setUniforms(y,this.binderUniforms,Qe,{zoom:ht});const gt={[st.LINES]:2,[st.TRIANGLES]:3,[st.LINE_STRIP]:1}[L];for(const xt of Ue.get()){const ut=xt.vaos||(xt.vaos={});(ut[Ce]||(ut[Ce]=new mo)).bind(y,this,Oe,ct?ct.getPaintVertexBuffers():[],Fe,xt.vertexOffset,at,mt),st.drawElements(L,xt.primitiveLength*gt,st.UNSIGNED_SHORT,xt.primitiveOffset*gt*2)}}}function xo($,y,L){const G=1/Ze(L,1,y.transform.tileZoom),K=Math.pow(2,L.tileID.overscaledZ),Q=L.tileSize*Math.pow(2,y.transform.tileZoom)/K,se=Q*(L.tileID.canonical.x+L.tileID.wrap*K),ge=Q*L.tileID.canonical.y;return{u_image:0,u_texsize:L.imageAtlasTexture.size,u_scale:[G,$.fromScale,$.toScale],u_fade:$.t,u_pixel_coord_upper:[se>>16,ge>>16],u_pixel_coord_lower:[65535&se,65535&ge]}}const ys=($,y,L,G)=>{const K=y.style.light,Q=K.properties.get("position"),se=[Q.x,Q.y,Q.z],ge=h.create$2();K.properties.get("anchor")==="viewport"&&(h.fromRotation(ge,-y.transform.angle),h.transformMat3(se,se,ge));const Ce=K.properties.get("color");return{u_matrix:$,u_lightpos:se,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+L,u_opacity:G}},_l=($,y,L,G,K,Q,se)=>h.extend(ys($,y,L,G),xo(Q,y,se),{u_height_factor:-Math.pow(2,K.overscaledZ)/se.tileSize/8}),yl=$=>({u_matrix:$}),na=($,y,L,G)=>h.extend(yl($),xo(L,y,G)),Ba=($,y)=>({u_matrix:$,u_world:y}),vl=($,y,L,G,K)=>h.extend(na($,y,L,G),{u_world:K}),Zr=($,y,L,G)=>{const K=$.transform;let Q;return Q=G.paint.get("circle-pitch-alignment")==="map"?K.calculatePixelsToTileUnitsMatrix(L):new Float32Array([K.pixelsToGLUnits[0],0,0,K.pixelsToGLUnits[1]]),{u_camera_to_center_distance:K.cameraToCenterDistance,u_matrix:$.translatePosMatrix(y.projMatrix,L,G.paint.get("circle-translate"),G.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:Q}},vs=$=>{const y=[];return $.paint.get("circle-pitch-alignment")==="map"&&y.push("PITCH_WITH_MAP"),$.paint.get("circle-pitch-scale")==="map"&&y.push("SCALE_WITH_MAP"),y},bo=($,y,L)=>{const G=h.EXTENT/L.tileSize;return{u_matrix:$,u_camera_to_center_distance:y.cameraToCenterDistance,u_extrude_scale:[y.pixelsToGLUnits[0]/G,y.pixelsToGLUnits[1]/G]}},Oa=($,y,L=1)=>({u_matrix:$,u_color:y,u_overlay:0,u_overlay_scale:L}),xs=($,y,L,G)=>({u_matrix:$,u_extrude_scale:Ze(y,1,L),u_intensity:G}),bs=($,y,L,G,K,Q)=>{const se=$.transform,ge=se.calculatePixelsToTileUnitsMatrix(y),Ce={u_matrix:So($,y,L,K),u_pixels_to_tile_units:ge,u_device_pixel_ratio:h.exported.devicePixelRatio,u_units_to_pixels:[1/se.pixelsToGLUnits[0],1/se.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:Q,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(ws(L)){const Oe=Eo(y,$.transform);Ce.u_texsize=y.lineAtlasTexture.size,Ce.u_scale=[Oe,G.fromScale,G.toScale],Ce.u_mix=G.t}return Ce},wo=($,y,L,G,K)=>{const Q=$.transform,se=Eo(y,Q);return{u_matrix:So($,y,L,K),u_texsize:y.imageAtlasTexture.size,u_pixels_to_tile_units:Q.calculatePixelsToTileUnitsMatrix(y),u_device_pixel_ratio:h.exported.devicePixelRatio,u_image:0,u_scale:[se,G.fromScale,G.toScale],u_fade:G.t,u_units_to_pixels:[1/Q.pixelsToGLUnits[0],1/Q.pixelsToGLUnits[1]]}};function Eo($,y){return 1/Ze($,1,y.tileZoom)}function So($,y,L,G){return $.translatePosMatrix(G||y.tileID.projMatrix,y,L.paint.get("line-translate"),L.paint.get("line-translate-anchor"))}const Mo=$=>{const y=[];return ws($)&&y.push("RENDER_LINE_DASH"),$.paint.get("line-gradient")&&y.push("RENDER_LINE_GRADIENT"),y};function ws($){const y=$.paint.get("line-dasharray").value;return y.value||y.kind!=="constant"}const xl=($,y,L,G,K)=>{return{u_matrix:$,u_tl_parent:y,u_scale_parent:L,u_buffer_scale:1,u_fade_t:G.mix,u_opacity:G.opacity*K.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:K.paint.get("raster-brightness-min"),u_brightness_high:K.paint.get("raster-brightness-max"),u_saturation_factor:(se=K.paint.get("raster-saturation"),se>0?1-1/(1.001-se):-se),u_contrast_factor:(Q=K.paint.get("raster-contrast"),Q>0?1/(1-Q):1+Q),u_spin_weights:aa(K.paint.get("raster-hue-rotate"))};var Q,se};function aa($){$*=Math.PI/180;const y=Math.sin($),L=Math.cos($);return[(2*L+1)/3,(-Math.sqrt(3)*y-L+1)/3,(Math.sqrt(3)*y-L+1)/3]}const bl=($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht)=>{const ct=K.transform;return{u_is_size_zoom_constant:+($==="constant"||$==="source"),u_is_size_feature_constant:+($==="constant"||$==="camera"),u_size_t:y?y.uSizeT:0,u_size:y?y.uSize:0,u_camera_to_center_distance:ct.cameraToCenterDistance,u_pitch:ct.pitch/360*2*Math.PI,u_rotate_symbol:+L,u_aspect_ratio:ct.width/ct.height,u_fade_change:K.options.fadeDuration?K.symbolFadeChange:1,u_matrix:Q,u_label_plane_matrix:se,u_coord_matrix:ge,u_is_text:+Ce,u_pitch_with_map:+G,u_texsize:Oe,u_tile_id:Fe,u_zoom_transition:Ue,u_inv_rot_matrix:Qe,u_merc_center:ht,u_texture:0}},wl=($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht,ct)=>{const{cameraToCenterDistance:at,_pitch:mt}=K.transform;return h.extend(bl($,y,L,G,K,Q,se,ge,Ce,Oe,Ue,Qe,ht,ct),{u_gamma_scale:G?at*Math.cos(K.terrain?0:mt):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+Fe})},jh=($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue,Qe,ht)=>h.extend(wl($,y,L,G,K,Q,se,ge,!0,Ce,!0,Fe,Ue,Qe,ht),{u_texsize_icon:Oe,u_texture_icon:1}),Gh=($,y,L)=>({u_matrix:$,u_opacity:y,u_color:L}),Vh=($,y,L,G,K,Q)=>h.extend(function(se,ge,Ce,Oe){const Fe=Ce.imageManager.getPattern(se.from.toString()),Ue=Ce.imageManager.getPattern(se.to.toString()),{width:Qe,height:ht}=Ce.imageManager.getPixelSize(),ct=Math.pow(2,Oe.tileID.overscaledZ),at=Oe.tileSize*Math.pow(2,Ce.transform.tileZoom)/ct,mt=at*(Oe.tileID.canonical.x+Oe.tileID.wrap*ct),st=at*Oe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Fe.tl,u_pattern_br_a:Fe.br,u_pattern_tl_b:Ue.tl,u_pattern_br_b:Ue.br,u_texsize:[Qe,ht],u_mix:ge.t,u_pattern_size_a:Fe.displaySize,u_pattern_size_b:Ue.displaySize,u_scale_a:ge.fromScale,u_scale_b:ge.toScale,u_tile_units_to_pixels:1/Ze(Oe,1,Ce.transform.tileZoom),u_pixel_coord_upper:[mt>>16,st>>16],u_pixel_coord_lower:[65535&mt,65535&st]}}(G,Q,L,K),{u_matrix:$,u_opacity:y}),Zh={fillExtrusion:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_lightpos:new h.Uniform3f($,y.u_lightpos),u_lightintensity:new h.Uniform1f($,y.u_lightintensity),u_lightcolor:new h.Uniform3f($,y.u_lightcolor),u_vertical_gradient:new h.Uniform1f($,y.u_vertical_gradient),u_opacity:new h.Uniform1f($,y.u_opacity)}),fillExtrusionPattern:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_lightpos:new h.Uniform3f($,y.u_lightpos),u_lightintensity:new h.Uniform1f($,y.u_lightintensity),u_lightcolor:new h.Uniform3f($,y.u_lightcolor),u_vertical_gradient:new h.Uniform1f($,y.u_vertical_gradient),u_height_factor:new h.Uniform1f($,y.u_height_factor),u_image:new h.Uniform1i($,y.u_image),u_texsize:new h.Uniform2f($,y.u_texsize),u_pixel_coord_upper:new h.Uniform2f($,y.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f($,y.u_pixel_coord_lower),u_scale:new h.Uniform3f($,y.u_scale),u_fade:new h.Uniform1f($,y.u_fade),u_opacity:new h.Uniform1f($,y.u_opacity)}),fill:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix)}),fillPattern:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_image:new h.Uniform1i($,y.u_image),u_texsize:new h.Uniform2f($,y.u_texsize),u_pixel_coord_upper:new h.Uniform2f($,y.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f($,y.u_pixel_coord_lower),u_scale:new h.Uniform3f($,y.u_scale),u_fade:new h.Uniform1f($,y.u_fade)}),fillOutline:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_world:new h.Uniform2f($,y.u_world)}),fillOutlinePattern:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_world:new h.Uniform2f($,y.u_world),u_image:new h.Uniform1i($,y.u_image),u_texsize:new h.Uniform2f($,y.u_texsize),u_pixel_coord_upper:new h.Uniform2f($,y.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f($,y.u_pixel_coord_lower),u_scale:new h.Uniform3f($,y.u_scale),u_fade:new h.Uniform1f($,y.u_fade)}),circle:($,y)=>({u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_extrude_scale:new h.UniformMatrix2f($,y.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f($,y.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f($,y.u_matrix)}),collisionBox:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f($,y.u_extrude_scale)}),collisionCircle:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_inv_matrix:new h.UniformMatrix4f($,y.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f($,y.u_viewport_size)}),debug:($,y)=>({u_color:new h.UniformColor($,y.u_color),u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_overlay:new h.Uniform1i($,y.u_overlay),u_overlay_scale:new h.Uniform1f($,y.u_overlay_scale)}),clippingMask:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix)}),heatmap:($,y)=>({u_extrude_scale:new h.Uniform1f($,y.u_extrude_scale),u_intensity:new h.Uniform1f($,y.u_intensity),u_matrix:new h.UniformMatrix4f($,y.u_matrix)}),heatmapTexture:($,y)=>({u_image:new h.Uniform1i($,y.u_image),u_color_ramp:new h.Uniform1i($,y.u_color_ramp),u_opacity:new h.Uniform1f($,y.u_opacity)}),hillshade:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_image:new h.Uniform1i($,y.u_image),u_latrange:new h.Uniform2f($,y.u_latrange),u_light:new h.Uniform2f($,y.u_light),u_shadow:new h.UniformColor($,y.u_shadow),u_highlight:new h.UniformColor($,y.u_highlight),u_accent:new h.UniformColor($,y.u_accent)}),hillshadePrepare:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_image:new h.Uniform1i($,y.u_image),u_dimension:new h.Uniform2f($,y.u_dimension),u_zoom:new h.Uniform1f($,y.u_zoom),u_unpack:new h.Uniform4f($,y.u_unpack)}),line:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_pixels_to_tile_units:new h.UniformMatrix2f($,y.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f($,y.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f($,y.u_units_to_pixels),u_dash_image:new h.Uniform1i($,y.u_dash_image),u_gradient_image:new h.Uniform1i($,y.u_gradient_image),u_image_height:new h.Uniform1f($,y.u_image_height),u_texsize:new h.Uniform2f($,y.u_texsize),u_scale:new h.Uniform3f($,y.u_scale),u_mix:new h.Uniform1f($,y.u_mix)}),linePattern:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_texsize:new h.Uniform2f($,y.u_texsize),u_pixels_to_tile_units:new h.UniformMatrix2f($,y.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f($,y.u_device_pixel_ratio),u_image:new h.Uniform1i($,y.u_image),u_units_to_pixels:new h.Uniform2f($,y.u_units_to_pixels),u_scale:new h.Uniform3f($,y.u_scale),u_fade:new h.Uniform1f($,y.u_fade)}),raster:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_tl_parent:new h.Uniform2f($,y.u_tl_parent),u_scale_parent:new h.Uniform1f($,y.u_scale_parent),u_buffer_scale:new h.Uniform1f($,y.u_buffer_scale),u_fade_t:new h.Uniform1f($,y.u_fade_t),u_opacity:new h.Uniform1f($,y.u_opacity),u_image0:new h.Uniform1i($,y.u_image0),u_image1:new h.Uniform1i($,y.u_image1),u_brightness_low:new h.Uniform1f($,y.u_brightness_low),u_brightness_high:new h.Uniform1f($,y.u_brightness_high),u_saturation_factor:new h.Uniform1f($,y.u_saturation_factor),u_contrast_factor:new h.Uniform1f($,y.u_contrast_factor),u_spin_weights:new h.Uniform3f($,y.u_spin_weights)}),symbolIcon:($,y)=>({u_is_size_zoom_constant:new h.Uniform1i($,y.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i($,y.u_is_size_feature_constant),u_size_t:new h.Uniform1f($,y.u_size_t),u_size:new h.Uniform1f($,y.u_size),u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_pitch:new h.Uniform1f($,y.u_pitch),u_rotate_symbol:new h.Uniform1i($,y.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f($,y.u_aspect_ratio),u_fade_change:new h.Uniform1f($,y.u_fade_change),u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f($,y.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f($,y.u_coord_matrix),u_is_text:new h.Uniform1i($,y.u_is_text),u_pitch_with_map:new h.Uniform1i($,y.u_pitch_with_map),u_texsize:new h.Uniform2f($,y.u_texsize),u_tile_id:new h.Uniform3f($,y.u_tile_id),u_zoom_transition:new h.Uniform1f($,y.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f($,y.u_inv_rot_matrix),u_merc_center:new h.Uniform2f($,y.u_merc_center),u_texture:new h.Uniform1i($,y.u_texture)}),symbolSDF:($,y)=>({u_is_size_zoom_constant:new h.Uniform1i($,y.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i($,y.u_is_size_feature_constant),u_size_t:new h.Uniform1f($,y.u_size_t),u_size:new h.Uniform1f($,y.u_size),u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_pitch:new h.Uniform1f($,y.u_pitch),u_rotate_symbol:new h.Uniform1i($,y.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f($,y.u_aspect_ratio),u_fade_change:new h.Uniform1f($,y.u_fade_change),u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f($,y.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f($,y.u_coord_matrix),u_is_text:new h.Uniform1i($,y.u_is_text),u_pitch_with_map:new h.Uniform1i($,y.u_pitch_with_map),u_texsize:new h.Uniform2f($,y.u_texsize),u_texture:new h.Uniform1i($,y.u_texture),u_gamma_scale:new h.Uniform1f($,y.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f($,y.u_device_pixel_ratio),u_tile_id:new h.Uniform3f($,y.u_tile_id),u_zoom_transition:new h.Uniform1f($,y.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f($,y.u_inv_rot_matrix),u_merc_center:new h.Uniform2f($,y.u_merc_center),u_is_halo:new h.Uniform1i($,y.u_is_halo)}),symbolTextAndIcon:($,y)=>({u_is_size_zoom_constant:new h.Uniform1i($,y.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i($,y.u_is_size_feature_constant),u_size_t:new h.Uniform1f($,y.u_size_t),u_size:new h.Uniform1f($,y.u_size),u_camera_to_center_distance:new h.Uniform1f($,y.u_camera_to_center_distance),u_pitch:new h.Uniform1f($,y.u_pitch),u_rotate_symbol:new h.Uniform1i($,y.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f($,y.u_aspect_ratio),u_fade_change:new h.Uniform1f($,y.u_fade_change),u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f($,y.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f($,y.u_coord_matrix),u_is_text:new h.Uniform1i($,y.u_is_text),u_pitch_with_map:new h.Uniform1i($,y.u_pitch_with_map),u_texsize:new h.Uniform2f($,y.u_texsize),u_texsize_icon:new h.Uniform2f($,y.u_texsize_icon),u_texture:new h.Uniform1i($,y.u_texture),u_texture_icon:new h.Uniform1i($,y.u_texture_icon),u_gamma_scale:new h.Uniform1f($,y.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f($,y.u_device_pixel_ratio),u_is_halo:new h.Uniform1i($,y.u_is_halo)}),background:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_opacity:new h.Uniform1f($,y.u_opacity),u_color:new h.UniformColor($,y.u_color)}),backgroundPattern:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_opacity:new h.Uniform1f($,y.u_opacity),u_image:new h.Uniform1i($,y.u_image),u_pattern_tl_a:new h.Uniform2f($,y.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f($,y.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f($,y.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f($,y.u_pattern_br_b),u_texsize:new h.Uniform2f($,y.u_texsize),u_mix:new h.Uniform1f($,y.u_mix),u_pattern_size_a:new h.Uniform2f($,y.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f($,y.u_pattern_size_b),u_scale_a:new h.Uniform1f($,y.u_scale_a),u_scale_b:new h.Uniform1f($,y.u_scale_b),u_pixel_coord_upper:new h.Uniform2f($,y.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f($,y.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f($,y.u_tile_units_to_pixels)}),terrainRaster:Vi,terrainDepth:Vi,skybox:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_sun_direction:new h.Uniform3f($,y.u_sun_direction),u_cubemap:new h.Uniform1i($,y.u_cubemap),u_opacity:new h.Uniform1f($,y.u_opacity),u_temporal_offset:new h.Uniform1f($,y.u_temporal_offset)}),skyboxGradient:($,y)=>({u_matrix:new h.UniformMatrix4f($,y.u_matrix),u_color_ramp:new h.Uniform1i($,y.u_color_ramp),u_center_direction:new h.Uniform3f($,y.u_center_direction),u_radius:new h.Uniform1f($,y.u_radius),u_opacity:new h.Uniform1f($,y.u_opacity),u_temporal_offset:new h.Uniform1f($,y.u_temporal_offset)}),skyboxCapture:($,y)=>({u_matrix_3f:new h.UniformMatrix3f($,y.u_matrix_3f),u_sun_direction:new h.Uniform3f($,y.u_sun_direction),u_sun_intensity:new h.Uniform1f($,y.u_sun_intensity),u_color_tint_r:new h.Uniform4f($,y.u_color_tint_r),u_color_tint_m:new h.Uniform4f($,y.u_color_tint_m),u_luminance:new h.Uniform1f($,y.u_luminance)})};let oa;function To($,y,L,G,K,Q,se){const ge=$.context,Ce=ge.gl,Oe=$.useProgram("collisionBox"),Fe=[];let Ue=0,Qe=0;for(let xt=0;xt<G.length;xt++){const ut=G[xt],Et=y.getTile(ut),kt=Et.getBucket(L);if(!kt)continue;let Wt=ut.projMatrix;K[0]===0&&K[1]===0||(Wt=$.translatePosMatrix(ut.projMatrix,Et,K,Q));const Zt=se?kt.textCollisionBox:kt.iconCollisionBox,Jt=kt.collisionCircleArray;if(Jt.length>0){const Qt=h.create$1(),ci=Wt;h.mul$1(Qt,kt.placementInvProjMatrix,$.transform.glCoordMatrix),h.mul$1(Qt,Qt,kt.placementViewportMatrix),Fe.push({circleArray:Jt,circleOffset:Qe,transform:ci,invTransform:Qt}),Ue+=Jt.length/4,Qe=Ue}Zt&&($.terrain&&$.terrain.setupElevationDraw(Et,Oe),Oe.draw(ge,Ce.LINES,h.DepthMode.disabled,h.StencilMode.disabled,$.colorModeForRenderPass(),h.CullFaceMode.disabled,bo(Wt,$.transform,Et),L.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,null,$.transform.zoom,null,Zt.collisionVertexBuffer,Zt.collisionVertexBufferExt))}if(!se||!Fe.length)return;const ht=$.useProgram("collisionCircle"),ct=new h.StructArrayLayout2f1f2i16;ct.resize(4*Ue),ct._trim();let at=0;for(const xt of Fe)for(let ut=0;ut<xt.circleArray.length/4;ut++){const Et=4*ut,kt=xt.circleArray[Et+0],Wt=xt.circleArray[Et+1],Zt=xt.circleArray[Et+2],Jt=xt.circleArray[Et+3];ct.emplace(at++,kt,Wt,Zt,Jt,0),ct.emplace(at++,kt,Wt,Zt,Jt,1),ct.emplace(at++,kt,Wt,Zt,Jt,2),ct.emplace(at++,kt,Wt,Zt,Jt,3)}(!oa||oa.length<2*Ue)&&(oa=function(xt){const ut=2*xt,Et=new h.StructArrayLayout3ui6;Et.resize(ut),Et._trim();for(let kt=0;kt<ut;kt++){const Wt=6*kt;Et.uint16[Wt+0]=4*kt+0,Et.uint16[Wt+1]=4*kt+1,Et.uint16[Wt+2]=4*kt+2,Et.uint16[Wt+3]=4*kt+2,Et.uint16[Wt+4]=4*kt+3,Et.uint16[Wt+5]=4*kt+0}return Et}(Ue));const mt=ge.createIndexBuffer(oa,!0),st=ge.createVertexBuffer(ct,h.collisionCircleLayout.members,!0);for(const xt of Fe){const ut={u_matrix:xt.transform,u_inv_matrix:xt.invTransform,u_camera_to_center_distance:(gt=$.transform).cameraToCenterDistance,u_viewport_size:[gt.width,gt.height]};ht.draw(ge,Ce.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,$.colorModeForRenderPass(),h.CullFaceMode.disabled,ut,L.id,st,mt,h.SegmentVector.simpleSegment(0,2*xt.circleOffset,xt.circleArray.length,xt.circleArray.length/2),null,$.transform.zoom,null,null,null)}var gt;st.destroy(),mt.destroy()}const Gn=h.identity(new Float32Array(16));function El($,y,L,G,K,Q){const{horizontalAlign:se,verticalAlign:ge}=h.getAnchorAlignment($),Ce=-(se-.5)*y,Oe=-(ge-.5)*L,Fe=h.evaluateVariableOffset($,G);return new h.pointGeometry((Ce/K+Fe[0])*Q,(Oe/K+Fe[1])*Q)}function Sl($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue){const Qe=$.text.placedSymbolArray,ht=$.text.dynamicLayoutVertexArray,ct=$.icon.dynamicLayoutVertexArray,at={};ht.clear();for(let mt=0;mt<Qe.length;mt++){const st=Qe.get(mt),gt=$.allowVerticalPlacement&&!st.placedOrientation,xt=st.hidden||!st.crossTileID||gt?null:G[st.crossTileID];if(xt){const ut=new h.pointGeometry(st.tileAnchorX,st.tileAnchorY),Et=Ue(ut),kt=ar(ut,L?ge:se,Et),Wt=Nn(Q.cameraToCenterDistance,kt.signedDistanceFromCamera);let Zt=K.evaluateSizeForFeature($.textSizeData,Oe,st)*Wt/h.ONE_EM;L&&(Zt*=$.tilePixelRatio/Ce);const{width:Jt,height:Qt,anchor:ci,textOffset:Kt,textScale:di}=xt,Gt=El(ci,Jt,Qt,Kt,di,Zt),pi=L?ar(ut.add(Gt),se,Et).point:kt.point.add(y?Gt.rotate(-Q.angle):Gt),Ei=$.allowVerticalPlacement&&st.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let Ai=0;Ai<st.numGlyphs;Ai++)h.addDynamicAttributes(ht,pi,Ei);Fe&&st.associatedIconIndex>=0&&(at[st.associatedIconIndex]={shiftedAnchor:pi,angle:Ei})}else en(st.numGlyphs,ht)}if(Fe){ct.clear();const mt=$.icon.placedSymbolArray;for(let st=0;st<mt.length;st++){const gt=mt.get(st);if(gt.hidden)en(gt.numGlyphs,ct);else{const xt=at[st];if(xt)for(let ut=0;ut<gt.numGlyphs;ut++)h.addDynamicAttributes(ct,xt.shiftedAnchor,xt.angle);else en(gt.numGlyphs,ct)}}$.icon.dynamicLayoutVertexBuffer.updateData(ct)}$.text.dynamicLayoutVertexBuffer.updateData(ht)}function Es($,y,L){return L.iconsInText&&y?"symbolTextAndIcon":$?"symbolSDF":"symbolIcon"}function Mn($,y,L,G,K,Q,se,ge,Ce,Oe,Fe,Ue){const Qe=$.context,ht=Qe.gl,ct=$.transform,at=ge==="map",mt=Ce==="map",st=at&&L.layout.get("symbol-placement")!=="point",gt=at&&!mt&&!st,xt=L.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ut=!1;const Et=$.depthModeForSublayer(0,h.DepthMode.ReadOnly),kt=[0,0],Wt=L.layout.get("text-variable-anchor"),Zt=[],Jt=[];$.terrain&&mt&&Jt.push("PITCH_WITH_MAP_TERRAIN"),st&&Jt.push("PROJECTED_POS_ON_VIEWPORT");for(const Qt of G){const ci=y.getTile(Qt),Kt=ci.getBucket(L);if(!Kt)continue;const di=K?Kt.text:Kt.icon;if(!di||!di.segments.get().length)continue;const Gt=di.programConfigurations.get(L.id),pi=K||Kt.sdfIcons,Ei=K?Kt.textSizeData:Kt.iconSizeData,Ai=mt||ct.pitch!==0,Ci=$.useProgram(Es(pi,K,Kt),Gt,Jt),Di=h.evaluateSizeForZoom(Ei,ct.zoom),Ri=[Qt.canonical.x,Qt.canonical.y,1<<Qt.canonical.z];let Ti,Pi,Wi,gr,Tr=[0,0],Pr=null;if(K){if(Pi=ci.glyphAtlasTexture,Wi=ht.LINEAR,Ti=ci.glyphAtlasTexture.size,Kt.iconsInText){Tr=ci.imageAtlasTexture.size,Pr=ci.imageAtlasTexture;const $r=Ei.kind==="composite"||Ei.kind==="camera";gr=Ai||$.options.rotating||$.options.zooming||$r?ht.LINEAR:ht.NEAREST}}else{const $r=L.layout.get("icon-size").constantOr(0)!==1||Kt.iconsNeedLinear;Pi=ci.imageAtlasTexture,Wi=pi||$.options.rotating||$.options.zooming||$r||Ai?ht.LINEAR:ht.NEAREST,Ti=ci.imageAtlasTexture.size}const Fr=$.transform.calculatePixelsToTileUnitsMatrix(ci),_r=Fi(Qt.projMatrix,mt,at,$.transform,Fr),gn=$.terrain&&mt&&st?h.invert(new Float32Array(16),_r):Gn,fn=Oi(Qt.projMatrix,mt,at,$.transform,Fr),rr=Wt&&Kt.hasTextData(),ur=L.layout.get("icon-text-fit")!=="none"&&rr&&Kt.hasIconData();if(st){const $r=ct.elevation;no(Kt,Qt.projMatrix,$,K,_r,fn,mt,Oe,$r?Rn=>$r.getAtTileOffset(Qt,Rn.x,Rn.y):null)}const $i=$.translatePosMatrix(Qt.projMatrix,ci,Q,se),or=st||K&&Wt||ur?Gn:_r,Ar=$.translatePosMatrix(fn,ci,Q,se,!0),nr=pi&&L.paint.get(K?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Hr;Hr=pi?Kt.iconsInText?jh(Ei.kind,Di,gt,mt,$,$i,or,Ar,Ti,Tr,Ri,0,$.identityMat,kt):wl(Ei.kind,Di,gt,mt,$,$i,or,Ar,K,Ti,!0,Ri,0,$.identityMat,kt):bl(Ei.kind,Di,gt,mt,$,$i,or,Ar,K,Ti,Ri,0,$.identityMat,kt);const Xa={program:Ci,buffers:di,uniformValues:Hr,atlasTexture:Pi,atlasTextureIcon:Pr,atlasInterpolation:Wi,atlasInterpolationIcon:gr,isSDF:pi,hasHalo:nr,tile:ci,labelPlaneMatrixInv:gn};if(xt&&Kt.canOverlap){ut=!0;const $r=di.segments.get();for(const Rn of $r)Zt.push({segments:new h.SegmentVector([Rn]),sortKey:Rn.sortKey,state:Xa})}else Zt.push({segments:di.segments,sortKey:0,state:Xa})}ut&&Zt.sort((Qt,ci)=>Qt.sortKey-ci.sortKey);for(const Qt of Zt){const ci=Qt.state;if($.terrain&&$.terrain.setupElevationDraw(ci.tile,ci.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:ci.labelPlaneMatrixInv}),Qe.activeTexture.set(ht.TEXTURE0),ci.atlasTexture.bind(ci.atlasInterpolation,ht.CLAMP_TO_EDGE),ci.atlasTextureIcon&&(Qe.activeTexture.set(ht.TEXTURE1),ci.atlasTextureIcon&&ci.atlasTextureIcon.bind(ci.atlasInterpolationIcon,ht.CLAMP_TO_EDGE)),ci.isSDF){const Kt=ci.uniformValues;ci.hasHalo&&(Kt.u_is_halo=1,Ss(ci.buffers,Qt.segments,L,$,ci.program,Et,Fe,Ue,Kt)),Kt.u_is_halo=0}Ss(ci.buffers,Qt.segments,L,$,ci.program,Et,Fe,Ue,ci.uniformValues)}}function Ss($,y,L,G,K,Q,se,ge,Ce){const Oe=G.context;K.draw(Oe,Oe.gl.TRIANGLES,Q,se,ge,h.CullFaceMode.disabled,Ce,L.id,$.layoutVertexBuffer,$.indexBuffer,y,L.paint,G.transform.zoom,$.programConfigurations.get(L.id),$.dynamicLayoutVertexBuffer,$.opacityVertexBuffer)}function Vn($,y,L,G,K,Q,se){const ge=$.context.gl,Ce=L.paint.get("fill-pattern"),Oe=Ce&&Ce.constantOr(1),Fe=L.getCrossfadeParameters();let Ue,Qe,ht,ct,at;se?(Qe=Oe&&!L.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ue=ge.LINES):(Qe=Oe?"fillPattern":"fill",Ue=ge.TRIANGLES);for(const mt of G){const st=y.getTile(mt);if(Oe&&!st.patternsLoaded())continue;const gt=st.getBucket(L);if(!gt)continue;$.prepareDrawTile(mt);const xt=gt.programConfigurations.get(L.id),ut=$.useProgram(Qe,xt);Oe&&($.context.activeTexture.set(ge.TEXTURE0),st.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),xt.updatePaintBuffers(Fe));const Et=Ce.constantOr(null);if(Et&&st.imageAtlas){const Wt=st.imageAtlas,Zt=Wt.patternPositions[Et.to.toString()],Jt=Wt.patternPositions[Et.from.toString()];Zt&&Jt&&xt.setConstantPatternPositions(Zt,Jt)}const kt=$.translatePosMatrix(mt.projMatrix,st,L.paint.get("fill-translate"),L.paint.get("fill-translate-anchor"));if(se){ct=gt.indexBuffer2,at=gt.segments2;const Wt=$.terrain&&$.terrain.renderingToTexture?$.terrain.drapeBufferSize:[ge.drawingBufferWidth,ge.drawingBufferHeight];ht=Qe==="fillOutlinePattern"&&Oe?vl(kt,$,Fe,st,Wt):Ba(kt,Wt)}else ct=gt.indexBuffer,at=gt.segments,ht=Oe?na(kt,$,Fe,st):yl(kt);$.prepareDrawProgram($.context,ut,mt.toUnwrapped()),ut.draw($.context,Ue,K,$.stencilModeForClipping(mt),Q,h.CullFaceMode.disabled,ht,L.id,gt.layoutVertexBuffer,ct,at,L.paint,$.transform.zoom,xt)}}function Tn($,y,L,G,K,Q,se){const ge=$.context,Ce=ge.gl,Oe=L.paint.get("fill-extrusion-pattern"),Fe=Oe.constantOr(1),Ue=L.getCrossfadeParameters(),Qe=L.paint.get("fill-extrusion-opacity");for(const ht of G){const ct=y.getTile(ht),at=ct.getBucket(L);if(!at)continue;const mt=at.programConfigurations.get(L.id),st=$.useProgram(Fe?"fillExtrusionPattern":"fillExtrusion",mt);if($.terrain){const kt=$.terrain;if(!at.enableTerrain)continue;if(kt.setupElevationDraw(ct,st,{useMeterToDem:!0}),Ml(ge,y,ht,at,L,kt),!at.centroidVertexBuffer){const Wt=st.attributes.a_centroid_pos;Wt!==void 0&&Ce.vertexAttrib2f(Wt,0,0)}}Fe&&($.context.activeTexture.set(Ce.TEXTURE0),ct.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),mt.updatePaintBuffers(Ue));const gt=Oe.constantOr(null);if(gt&&ct.imageAtlas){const kt=ct.imageAtlas,Wt=kt.patternPositions[gt.to.toString()],Zt=kt.patternPositions[gt.from.toString()];Wt&&Zt&&mt.setConstantPatternPositions(Wt,Zt)}const xt=$.translatePosMatrix(ht.projMatrix,ct,L.paint.get("fill-extrusion-translate"),L.paint.get("fill-extrusion-translate-anchor")),ut=L.paint.get("fill-extrusion-vertical-gradient"),Et=Fe?_l(xt,$,ut,Qe,ht,Ue,ct):ys(xt,$,ut,Qe);$.prepareDrawProgram(ge,st,ht.toUnwrapped()),st.draw(ge,ge.gl.TRIANGLES,K,Q,se,h.CullFaceMode.backCCW,Et,L.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,L.paint,$.transform.zoom,mt,$.terrain?at.centroidVertexBuffer:null)}}function Ml($,y,L,G,K,Q){const se=[st=>{let gt=st.canonical.x-1,xt=st.wrap;return gt<0&&(gt=(1<<st.canonical.z)-1,xt--),new h.OverscaledTileID(st.overscaledZ,xt,st.canonical.z,gt,st.canonical.y)},st=>{let gt=st.canonical.x+1,xt=st.wrap;return gt===1<<st.canonical.z&&(gt=0,xt++),new h.OverscaledTileID(st.overscaledZ,xt,st.canonical.z,gt,st.canonical.y)},st=>new h.OverscaledTileID(st.overscaledZ,st.wrap,st.canonical.z,st.canonical.x,(st.canonical.y===0?1<<st.canonical.z:st.canonical.y)-1),st=>new h.OverscaledTileID(st.overscaledZ,st.wrap,st.canonical.z,st.canonical.x,st.canonical.y===(1<<st.canonical.z)-1?0:st.canonical.y+1)],ge=st=>{const gt=y.getSource().maxzoom,xt=Wt=>{const Zt=y.getTileByID(Wt);if(Zt&&Zt.hasData())return Zt.getBucket(K)};let ut,Et,kt;return(st.overscaledZ===st.canonical.z||st.overscaledZ>=gt)&&(ut=xt(st.key)),st.overscaledZ>=gt&&(Et=xt(st.calculateScaledKey(st.overscaledZ+1))),st.overscaledZ>gt&&(kt=xt(st.calculateScaledKey(st.overscaledZ-1))),ut||Et||kt},Ce=[0,0,0],Oe=(st,gt)=>(Ce[0]=Math.min(st.min.y,gt.min.y),Ce[1]=Math.max(st.max.y,gt.max.y),Ce[2]=h.EXTENT-gt.min.x>st.max.x?gt.min.x-h.EXTENT:st.max.x,Ce),Fe=(st,gt)=>(Ce[0]=Math.min(st.min.x,gt.min.x),Ce[1]=Math.max(st.max.x,gt.max.x),Ce[2]=h.EXTENT-gt.min.y>st.max.y?gt.min.y-h.EXTENT:st.max.y,Ce),Ue=[(st,gt)=>Oe(st,gt),(st,gt)=>Oe(gt,st),(st,gt)=>Fe(st,gt),(st,gt)=>Fe(gt,st)],Qe=new h.pointGeometry(0,0);let ht,ct,at;const mt=(st,gt,xt,ut,Et)=>{const kt=[[ut?xt:st,ut?st:xt,0],[ut?xt:gt,ut?gt:xt,0]],Wt=Et<0?h.EXTENT+Et:Et,Zt=[ut?Wt:(st+gt)/2,ut?(st+gt)/2:Wt,0];return xt===0&&Et<0||xt!==0&&Et>0?Q.getForTilePoints(at,[Zt],!0,ct):kt.push(Zt),Q.getForTilePoints(L,kt,!0,ht),Math.max(kt[0][2],kt[1][2],Zt[2])/Q.exaggeration()};for(let st=0;st<4;st++){const gt=G.borders[st];if(gt.length===0&&(G.borderDone[st]=!0),G.borderDone[st])continue;const xt=at=se[st](L),ut=ge(xt);if(!ut||!ut.enableTerrain||(ct=Q.findDEMTileFor(xt),!ct||!ct.dem))continue;if(!ht){const Zt=Q.findDEMTileFor(L);if(!Zt||!Zt.dem)return;ht=Zt}const Et=(st<2?1:5)-st,kt=ut.borders[Et];let Wt=0;for(let Zt=0;Zt<gt.length;Zt++){const Jt=G.featuresOnBorder[gt[Zt]],Qt=Jt.borders[st];let ci;for(;Wt<kt.length&&(ci=ut.featuresOnBorder[kt[Wt]],!(ci.borders[Et][1]>Qt[0]+3));)ut.borderDone[Et]||ut.encodeCentroid(void 0,ci,!1),Wt++;if(ci&&Wt<kt.length){const Kt=Wt;let di=0;for(;!(ci.borders[Et][0]>Qt[1]-3)&&(di++,++Wt!==kt.length);)ci=ut.featuresOnBorder[kt[Wt]];if(ci=ut.featuresOnBorder[kt[Kt]],Jt.intersectsCount()>1||ci.intersectsCount()>1||di!==1){di!==1&&(Wt=Kt),G.encodeCentroid(void 0,Jt,!1),ut.borderDone[Et]||ut.encodeCentroid(void 0,ci,!1);continue}const Gt=Ue[st](Jt,ci),pi=st%2?h.EXTENT-1:0;Qe.x=mt(Gt[0],Math.min(h.EXTENT-1,Gt[1]),pi,st<2,Gt[2]),Qe.y=0,G.encodeCentroid(Qe,Jt,!1),ut.borderDone[Et]||ut.encodeCentroid(Qe,ci,!1)}else G.encodeCentroid(void 0,Jt,!1)}G.borderDone[st]=G.needsCentroidUpdate=!0,ut.borderDone[Et]||(ut.borderDone[Et]=ut.needsCentroidUpdate=!0)}(G.needsCentroidUpdate||!G.centroidVertexBuffer&&G.centroidVertexArray.length!==0)&&G.uploadCentroid($)}const Ms=new h.Color(1,0,0,1),Zi=new h.Color(0,1,0,1),Ao=new h.Color(0,0,1,1),Hh=new h.Color(1,0,1,1),Tl=new h.Color(0,1,1,1);function sa($,y,L,G){Co($,0,y+L/2,$.transform.width,L,G)}function Al($,y,L,G){Co($,y-L/2,0,L,$.transform.height,G)}function Co($,y,L,G,K,Q){const se=$.context,ge=se.gl;ge.enable(ge.SCISSOR_TEST),ge.scissor(y*h.exported.devicePixelRatio,L*h.exported.devicePixelRatio,G*h.exported.devicePixelRatio,K*h.exported.devicePixelRatio),se.clear({color:Q}),ge.disable(ge.SCISSOR_TEST)}function Cl($,y,L){const G=$.context,K=G.gl,Q=L.projMatrix,se=$.useProgram("debug"),ge=y.getTileByID(L.key);$.terrain&&$.terrain.setupElevationDraw(ge,se);const Ce=h.DepthMode.disabled,Oe=h.StencilMode.disabled,Fe=$.colorModeForRenderPass(),Ue="$debug";G.activeTexture.set(K.TEXTURE0),$.emptyTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ge._makeDebugTileBoundsBuffers($.context,$.transform.projection);const Qe=ge._tileDebugBuffer||$.debugBuffer,ht=ge._tileDebugIndexBuffer||$.debugIndexBuffer,ct=ge._tileDebugSegments||$.debugSegments;se.draw(G,K.LINE_STRIP,Ce,Oe,Fe,h.CullFaceMode.disabled,Oa(Q,h.Color.red),Ue,Qe,ht,ct);const at=ge.latestRawTileData,mt=Math.floor((at&&at.byteLength||0)/1024),st=y.getTile(L).tileSize,gt=512/Math.min(st,512)*(L.overscaledZ/$.transform.zoom)*.5;let xt=L.canonical.toString();L.overscaledZ!==L.canonical.z&&(xt+=` => ${L.overscaledZ}`),function(ut,Et){ut.initDebugOverlayCanvas();const kt=ut.debugOverlayCanvas,Wt=ut.context.gl,Zt=ut.debugOverlayCanvas.getContext("2d");Zt.clearRect(0,0,kt.width,kt.height),Zt.shadowColor="white",Zt.shadowBlur=2,Zt.lineWidth=1.5,Zt.strokeStyle="white",Zt.textBaseline="top",Zt.font="bold 36px Open Sans, sans-serif",Zt.fillText(Et,5,5),Zt.strokeText(Et,5,5),ut.debugOverlayTexture.update(kt),ut.debugOverlayTexture.bind(Wt.LINEAR,Wt.CLAMP_TO_EDGE)}($,`${xt} ${mt}kb`),se.draw(G,K.TRIANGLES,Ce,Oe,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,Oa(Q,h.Color.transparent,gt),Ue,$.debugBuffer,$.quadTriangleIndexBuffer,$.debugSegments)}const Wh=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ts}=Wh;function nn($,y,L,G){$.emplaceBack(y,L,G)}class la{constructor(y){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,nn(this.vertexArray,-1,-1,1),nn(this.vertexArray,1,-1,1),nn(this.vertexArray,-1,1,1),nn(this.vertexArray,1,1,1),nn(this.vertexArray,-1,-1,-1),nn(this.vertexArray,1,-1,-1),nn(this.vertexArray,-1,1,-1),nn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=y.createVertexBuffer(this.vertexArray,Ts),this.indexBuffer=y.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function An($,y,L,G,K,Q){const se=$.gl,ge=y.paint.get("sky-atmosphere-color"),Ce=y.paint.get("sky-atmosphere-halo-color"),Oe=y.paint.get("sky-atmosphere-sun-intensity"),Fe=((Ue,Qe,ht,ct,at)=>({u_matrix_3f:Ue,u_sun_direction:Qe,u_sun_intensity:ht,u_color_tint_r:[ct.r,ct.g,ct.b,ct.a],u_color_tint_m:[at.r,at.g,at.b,at.a],u_luminance:5e-5}))(h.fromMat4([],G),K,Oe,ge,Ce);se.framebufferTexture2D(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_CUBE_MAP_POSITIVE_X+Q,y.skyboxTexture,0),L.draw($,se.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,Fe,"skyboxCapture",y.skyboxGeometry.vertexBuffer,y.skyboxGeometry.indexBuffer,y.skyboxGeometry.segment)}const Io={symbol:function($,y,L,G,K){if($.renderPass!=="translucent")return;const Q=h.StencilMode.disabled,se=$.colorModeForRenderPass();L.layout.get("text-variable-anchor")&&function(ge,Ce,Oe,Fe,Ue,Qe,ht){const ct=Ce.transform,at=Ue==="map",mt=Qe==="map";for(const st of ge){const gt=Fe.getTile(st),xt=gt.getBucket(Oe);if(!xt||!xt.text||!xt.text.segments.get().length)continue;const ut=h.evaluateSizeForZoom(xt.textSizeData,ct.zoom),Et=Ce.transform.calculatePixelsToTileUnitsMatrix(gt),kt=Fi(st.projMatrix,mt,at,Ce.transform,Et),Wt=Oe.layout.get("icon-text-fit")!=="none"&&xt.hasIconData();if(ut){const Zt=Math.pow(2,ct.zoom-gt.tileID.overscaledZ),Jt=ct.elevation;Sl(xt,at,mt,ht,h.symbolSize,ct,kt,st.projMatrix,Zt,ut,Wt,Jt?Qt=>Jt.getAtTileOffset(st,Qt.x,Qt.y):Qt=>0)}}}(G,$,L,y,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),K),L.paint.get("icon-opacity").constantOr(1)!==0&&Mn($,y,L,G,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),Q,se),L.paint.get("text-opacity").constantOr(1)!==0&&Mn($,y,L,G,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),Q,se),y.map.showCollisionBoxes&&(To($,y,L,G,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),!0),To($,y,L,G,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),!1))},circle:function($,y,L,G){if($.renderPass!=="translucent")return;const K=L.paint.get("circle-opacity"),Q=L.paint.get("circle-stroke-width"),se=L.paint.get("circle-stroke-opacity"),ge=L.layout.get("circle-sort-key").constantOr(1)!==void 0;if(K.constantOr(1)===0&&(Q.constantOr(1)===0||se.constantOr(1)===0))return;const Ce=$.context,Oe=Ce.gl,Fe=$.depthModeForSublayer(0,h.DepthMode.ReadOnly),Ue=h.StencilMode.disabled,Qe=$.colorModeForRenderPass(),ht=[];for(let ct=0;ct<G.length;ct++){const at=G[ct],mt=y.getTile(at),st=mt.getBucket(L);if(!st)continue;const gt=st.programConfigurations.get(L.id),xt=vs(L),ut={programConfiguration:gt,program:$.useProgram("circle",gt,xt),layoutVertexBuffer:st.layoutVertexBuffer,indexBuffer:st.indexBuffer,uniformValues:Zr($,at,mt,L),tile:mt};if(ge){const Et=st.segments.get();for(const kt of Et)ht.push({segments:new h.SegmentVector([kt]),sortKey:kt.sortKey,state:ut})}else ht.push({segments:st.segments,sortKey:0,state:ut})}ge&&ht.sort((ct,at)=>ct.sortKey-at.sortKey);for(const ct of ht){const{programConfiguration:at,program:mt,layoutVertexBuffer:st,indexBuffer:gt,uniformValues:xt,tile:ut}=ct.state,Et=ct.segments;$.terrain&&$.terrain.setupElevationDraw(ut,mt,{useDepthForOcclusion:!0}),$.prepareDrawProgram(Ce,mt,ut.tileID.toUnwrapped()),mt.draw(Ce,Oe.TRIANGLES,Fe,Ue,Qe,h.CullFaceMode.disabled,xt,L.id,st,gt,Et,L.paint,$.transform.zoom,at)}},heatmap:function($,y,L,G){if(L.paint.get("heatmap-opacity")!==0)if($.renderPass==="offscreen"){const K=$.context,Q=K.gl,se=h.StencilMode.disabled,ge=new h.ColorMode([Q.ONE,Q.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(Ce,Oe,Fe){const Ue=Ce.gl;Ce.activeTexture.set(Ue.TEXTURE1),Ce.viewport.set([0,0,Oe.width/4,Oe.height/4]);let Qe=Fe.heatmapFbo;if(Qe)Ue.bindTexture(Ue.TEXTURE_2D,Qe.colorAttachment.get()),Ce.bindFramebuffer.set(Qe.framebuffer);else{const ht=Ue.createTexture();Ue.bindTexture(Ue.TEXTURE_2D,ht),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR),Qe=Fe.heatmapFbo=Ce.createFramebuffer(Oe.width/4,Oe.height/4,!1),function(ct,at,mt,st){const gt=ct.gl;gt.texImage2D(gt.TEXTURE_2D,0,gt.RGBA,at.width/4,at.height/4,0,gt.RGBA,ct.extRenderToTextureHalfFloat?ct.extTextureHalfFloat.HALF_FLOAT_OES:gt.UNSIGNED_BYTE,null),st.colorAttachment.set(mt)}(Ce,Oe,ht,Qe)}})(K,$,L),K.clear({color:h.Color.transparent});for(let Ce=0;Ce<G.length;Ce++){const Oe=G[Ce];if(y.hasRenderableParent(Oe))continue;const Fe=y.getTile(Oe),Ue=Fe.getBucket(L);if(!Ue)continue;const Qe=Ue.programConfigurations.get(L.id),ht=$.useProgram("heatmap",Qe),{zoom:ct}=$.transform;$.terrain&&$.terrain.setupElevationDraw(Fe,ht),$.prepareDrawProgram(K,ht,Oe.toUnwrapped()),ht.draw(K,Q.TRIANGLES,h.DepthMode.disabled,se,ge,h.CullFaceMode.disabled,xs(Oe.projMatrix,Fe,ct,L.paint.get("heatmap-intensity")),L.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,L.paint,$.transform.zoom,Qe)}K.viewport.set([0,0,$.width,$.height])}else $.renderPass==="translucent"&&($.context.setColorMode($.colorModeForRenderPass()),function(K,Q){const se=K.context,ge=se.gl,Ce=Q.heatmapFbo;if(!Ce)return;se.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Ce.colorAttachment.get()),se.activeTexture.set(ge.TEXTURE1);let Oe=Q.colorRampTexture;Oe||(Oe=Q.colorRampTexture=new h.Texture(se,Q.colorRamp,ge.RGBA)),Oe.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(se,ge.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,K.colorModeForRenderPass(),h.CullFaceMode.disabled,((Fe,Ue,Qe,ht)=>({u_image:0,u_color_ramp:1,u_opacity:Ue.paint.get("heatmap-opacity")}))(0,Q),Q.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,Q.paint,K.transform.zoom)}($,L))},line:function($,y,L,G){if($.renderPass!=="translucent")return;const K=L.paint.get("line-opacity"),Q=L.paint.get("line-width");if(K.constantOr(1)===0||Q.constantOr(1)===0)return;const se=$.depthModeForSublayer(0,h.DepthMode.ReadOnly),ge=$.colorModeForRenderPass(),Ce=L.paint.get("line-dasharray"),Oe=Ce.constantOr(1),Fe=L.layout.get("line-cap"),Ue=L.paint.get("line-pattern"),Qe=Ue.constantOr(1),ht=L.paint.get("line-gradient"),ct=L.getCrossfadeParameters(),at=Qe?"linePattern":"line",mt=$.context,st=mt.gl;for(const gt of G){const xt=y.getTile(gt);if(Qe&&!xt.patternsLoaded())continue;const ut=xt.getBucket(L);if(!ut)continue;$.prepareDrawTile(gt);const Et=ut.programConfigurations.get(L.id),kt=Mo(L),Wt=$.useProgram(at,Et,kt),Zt=Ue.constantOr(null);if(Zt&&xt.imageAtlas){const di=xt.imageAtlas,Gt=di.patternPositions[Zt.to.toString()],pi=di.patternPositions[Zt.from.toString()];Gt&&pi&&Et.setConstantPatternPositions(Gt,pi)}const Jt=Ce.constantOr(null),Qt=Fe.constantOr(null);if(!Qe&&Jt&&Qt&&xt.lineAtlas){const di=xt.lineAtlas,Gt=di.getDash(Jt.to,Qt),pi=di.getDash(Jt.from,Qt);Gt&&pi&&Et.setConstantPatternPositions(Gt,pi)}const ci=$.terrain?gt.projMatrix:null,Kt=Qe?wo($,xt,L,ct,ci):bs($,xt,L,ct,ci,ut.lineClipsArray.length);if(ht){const di=ut.gradients[L.id];let Gt=di.texture;if(L.gradientVersion!==di.version){let pi=256;if(L.stepInterpolant){const Ei=y.getSource().maxzoom,Ai=gt.canonical.z===Ei?Math.ceil(1<<$.transform.maxZoom-gt.canonical.z):1;pi=h.clamp(h.nextPowerOfTwo(ut.maxLineLength/h.EXTENT*1024*Ai),256,mt.maxTextureSize)}di.gradient=h.renderColorRamp({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:di.gradient||void 0,clips:ut.lineClipsArray}),di.texture?di.texture.update(di.gradient):di.texture=new h.Texture(mt,di.gradient,st.RGBA),di.version=L.gradientVersion,Gt=di.texture}mt.activeTexture.set(st.TEXTURE1),Gt.bind(L.stepInterpolant?st.NEAREST:st.LINEAR,st.CLAMP_TO_EDGE)}Oe&&(mt.activeTexture.set(st.TEXTURE0),xt.lineAtlasTexture.bind(st.LINEAR,st.REPEAT),Et.updatePaintBuffers(ct)),Qe&&(mt.activeTexture.set(st.TEXTURE0),xt.imageAtlasTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE),Et.updatePaintBuffers(ct)),$.prepareDrawProgram(mt,Wt,gt.toUnwrapped()),Wt.draw(mt,st.TRIANGLES,se,$.stencilModeForClipping(gt),ge,h.CullFaceMode.disabled,Kt,L.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,L.paint,$.transform.zoom,Et,ut.layoutVertexBuffer2)}},fill:function($,y,L,G){const K=L.paint.get("fill-color"),Q=L.paint.get("fill-opacity");if(Q.constantOr(1)===0)return;const se=$.colorModeForRenderPass(),ge=L.paint.get("fill-pattern"),Ce=$.opaquePassEnabledForLayer()&&!ge.constantOr(1)&&K.constantOr(h.Color.transparent).a===1&&Q.constantOr(0)===1?"opaque":"translucent";if($.renderPass===Ce){const Oe=$.depthModeForSublayer(1,$.renderPass==="opaque"?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);Vn($,y,L,G,Oe,se,!1)}if($.renderPass==="translucent"&&L.paint.get("fill-antialias")){const Oe=$.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);Vn($,y,L,G,Oe,se,!0)}},"fill-extrusion":function($,y,L,G){const K=L.paint.get("fill-extrusion-opacity");if(K!==0&&$.renderPass==="translucent"){const Q=new h.DepthMode($.context.gl.LEQUAL,h.DepthMode.ReadWrite,$.depthRangeFor3D);if(K!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))Tn($,y,L,G,Q,h.StencilMode.disabled,h.ColorMode.disabled),Tn($,y,L,G,Q,$.stencilModeFor3D(),$.colorModeForRenderPass());else{const se=$.colorModeForRenderPass();Tn($,y,L,G,Q,h.StencilMode.disabled,se)}}},hillshade:function($,y,L,G){if($.renderPass!=="offscreen"&&$.renderPass!=="translucent")return;const K=$.context,Q=$.depthModeForSublayer(0,h.DepthMode.ReadOnly),se=$.colorModeForRenderPass(),ge=$.terrain&&$.terrain.renderingToTexture,[Ce,Oe]=$.renderPass!=="translucent"||ge?[{},G]:$.stencilConfigForOverlap(G);for(const Fe of Oe){const Ue=y.getTile(Fe);if(Ue.needsHillshadePrepare&&$.renderPass==="offscreen")Ra($,Ue,L,Q,h.StencilMode.disabled,se);else if($.renderPass==="translucent"){const Qe=ge&&$.terrain?$.terrain.stencilModeForRTTOverlap(Fe):Ce[Fe.overscaledZ];ps($,Fe,Ue,L,Q,Qe,se)}}K.viewport.set([0,0,$.width,$.height])},raster:function($,y,L,G,K,Q){if($.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!G.length)return;const se=$.context,ge=se.gl,Ce=y.getSource(),Oe=$.useProgram("raster"),Fe=$.colorModeForRenderPass(),Ue=$.terrain&&$.terrain.renderingToTexture,[Qe,ht]=Ce instanceof re||Ue?[{},G]:$.stencilConfigForOverlap(G),ct=ht[ht.length-1].overscaledZ,at=!$.options.moving;for(const mt of ht){const st=Ue?h.DepthMode.disabled:$.depthModeForSublayer(mt.overscaledZ-ct,L.paint.get("raster-opacity")===1?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,ge.LESS),gt=mt.toUnwrapped(),xt=y.getTile(mt);if(Ue&&(!xt||!xt.hasData()))continue;const ut=Ue?mt.projMatrix:$.transform.calculateProjMatrix(gt,at),Et=$.terrain&&Ue?$.terrain.stencilModeForRTTOverlap(mt):Qe[mt.overscaledZ],kt=Q?0:L.paint.get("raster-fade-duration");xt.registerFadeDuration(kt);const Wt=y.findLoadedParent(mt,0),Zt=gs(xt,Wt,y,$.transform,kt);let Jt,Qt;$.terrain&&$.terrain.prepareDrawTile(mt);const ci=L.paint.get("raster-resampling")==="nearest"?ge.NEAREST:ge.LINEAR;se.activeTexture.set(ge.TEXTURE0),xt.texture.bind(ci,ge.CLAMP_TO_EDGE),se.activeTexture.set(ge.TEXTURE1),Wt?(Wt.texture.bind(ci,ge.CLAMP_TO_EDGE),Jt=Math.pow(2,Wt.tileID.overscaledZ-xt.tileID.overscaledZ),Qt=[xt.tileID.canonical.x*Jt%1,xt.tileID.canonical.y*Jt%1]):xt.texture.bind(ci,ge.CLAMP_TO_EDGE);const Kt=xl(ut,Qt||[0,0],Jt||1,Zt,L);if($.prepareDrawProgram(se,Oe,gt),Ce instanceof re)Oe.draw(se,ge.TRIANGLES,st,h.StencilMode.disabled,Fe,h.CullFaceMode.disabled,Kt,L.id,Ce.boundsBuffer,$.quadTriangleIndexBuffer,Ce.boundsSegments);else{const{tileBoundsBuffer:di,tileBoundsIndexBuffer:Gt,tileBoundsSegments:pi}=$.getTileBoundsBuffers(xt);Oe.draw(se,ge.TRIANGLES,st,Et,Fe,h.CullFaceMode.disabled,Kt,L.id,di,Gt,pi)}}},background:function($,y,L,G){const K=L.paint.get("background-color"),Q=L.paint.get("background-opacity");if(Q===0)return;const se=$.context,ge=se.gl,Ce=$.transform,Oe=Ce.tileSize,Fe=L.paint.get("background-pattern");if($.isPatternMissing(Fe))return;const Ue=!Fe&&K.a===1&&Q===1&&$.opaquePassEnabledForLayer()?"opaque":"translucent";if($.renderPass!==Ue)return;const Qe=h.StencilMode.disabled,ht=$.depthModeForSublayer(0,Ue==="opaque"?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),ct=$.colorModeForRenderPass(),at=$.useProgram(Fe?"backgroundPattern":"background");let mt,st=G;st||(mt=$.getBackgroundTiles(),st=Object.values(mt).map(xt=>xt.tileID)),Fe&&(se.activeTexture.set(ge.TEXTURE0),$.imageManager.bind($.context));const gt=L.getCrossfadeParameters();for(const xt of st){const ut=xt.toUnwrapped(),Et=G?xt.projMatrix:$.transform.calculateProjMatrix(ut);$.prepareDrawTile(xt);const kt=y?y.getTile(xt):mt?mt[xt.key]:new h.Tile(xt,Oe,Ce.zoom,$),Wt=Fe?Vh(Et,Q,$,Fe,{tileID:xt,tileSize:Oe},gt):Gh(Et,Q,K);$.prepareDrawProgram(se,at,ut);const{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:Jt,tileBoundsSegments:Qt}=$.getTileBoundsBuffers(kt);at.draw(se,ge.TRIANGLES,ht,Qe,ct,h.CullFaceMode.disabled,Wt,L.id,Zt,Jt,Qt)}},sky:function($,y,L){const G=$.transform,K=G.projection.name==="mercator"?1:h.smoothstep(7,8,G.zoom),Q=L.paint.get("sky-opacity")*K;if(Q===0)return;const se=$.context,ge=L.paint.get("sky-type"),Ce=new h.DepthMode(se.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),Oe=$.frameCounter/1e3%1;ge==="atmosphere"?$.renderPass==="offscreen"?L.needsSkyboxCapture($)&&(function(Fe,Ue,Qe,ht){const ct=Fe.context,at=ct.gl;let mt=Ue.skyboxFbo;if(!mt){mt=Ue.skyboxFbo=ct.createFramebuffer(32,32,!1),Ue.skyboxGeometry=new la(ct),Ue.skyboxTexture=ct.gl.createTexture(),at.bindTexture(at.TEXTURE_CUBE_MAP,Ue.skyboxTexture),at.texParameteri(at.TEXTURE_CUBE_MAP,at.TEXTURE_WRAP_S,at.CLAMP_TO_EDGE),at.texParameteri(at.TEXTURE_CUBE_MAP,at.TEXTURE_WRAP_T,at.CLAMP_TO_EDGE),at.texParameteri(at.TEXTURE_CUBE_MAP,at.TEXTURE_MIN_FILTER,at.LINEAR),at.texParameteri(at.TEXTURE_CUBE_MAP,at.TEXTURE_MAG_FILTER,at.LINEAR);for(let ut=0;ut<6;++ut)at.texImage2D(at.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,at.RGBA,32,32,0,at.RGBA,at.UNSIGNED_BYTE,null)}ct.bindFramebuffer.set(mt.framebuffer),ct.viewport.set([0,0,32,32]);const st=Ue.getCenter(Fe,!0),gt=Fe.useProgram("skyboxCapture"),xt=new Float64Array(16);h.identity(xt),h.rotateY(xt,xt,.5*-Math.PI),An(ct,Ue,gt,xt,st,0),h.identity(xt),h.rotateY(xt,xt,.5*Math.PI),An(ct,Ue,gt,xt,st,1),h.identity(xt),h.rotateX(xt,xt,.5*-Math.PI),An(ct,Ue,gt,xt,st,2),h.identity(xt),h.rotateX(xt,xt,.5*Math.PI),An(ct,Ue,gt,xt,st,3),h.identity(xt),An(ct,Ue,gt,xt,st,4),h.identity(xt),h.rotateY(xt,xt,Math.PI),An(ct,Ue,gt,xt,st,5),ct.viewport.set([0,0,Fe.width,Fe.height])}($,L),L.markSkyboxValid($)):$.renderPass==="sky"&&function(Fe,Ue,Qe,ht,ct){const at=Fe.context,mt=at.gl,st=Fe.transform,gt=Fe.useProgram("skybox");at.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_CUBE_MAP,Ue.skyboxTexture);const xt=((ut,Et,kt,Wt,Zt)=>({u_matrix:ut,u_sun_direction:Et,u_cubemap:0,u_opacity:Wt,u_temporal_offset:Zt}))(st.skyboxMatrix,Ue.getCenter(Fe,!1),0,ht,ct);Fe.prepareDrawProgram(at,gt),gt.draw(at,mt.TRIANGLES,Qe,h.StencilMode.disabled,Fe.colorModeForRenderPass(),h.CullFaceMode.backCW,xt,"skybox",Ue.skyboxGeometry.vertexBuffer,Ue.skyboxGeometry.indexBuffer,Ue.skyboxGeometry.segment)}($,L,Ce,Q,Oe):ge==="gradient"&&$.renderPass==="sky"&&function(Fe,Ue,Qe,ht,ct){const at=Fe.context,mt=at.gl,st=Fe.transform,gt=Fe.useProgram("skyboxGradient");Ue.skyboxGeometry||(Ue.skyboxGeometry=new la(at)),at.activeTexture.set(mt.TEXTURE0);let xt=Ue.colorRampTexture;xt||(xt=Ue.colorRampTexture=new h.Texture(at,Ue.colorRamp,mt.RGBA)),xt.bind(mt.LINEAR,mt.CLAMP_TO_EDGE);const ut=((Et,kt,Wt,Zt,Jt)=>({u_matrix:Et,u_color_ramp:0,u_center_direction:kt,u_radius:h.degToRad(Wt),u_opacity:Zt,u_temporal_offset:Jt}))(st.skyboxMatrix,Ue.getCenter(Fe,!1),Ue.paint.get("sky-gradient-radius"),ht,ct);Fe.prepareDrawProgram(at,gt),gt.draw(at,mt.TRIANGLES,Qe,h.StencilMode.disabled,Fe.colorModeForRenderPass(),h.CullFaceMode.backCW,ut,"skyboxGradient",Ue.skyboxGeometry.vertexBuffer,Ue.skyboxGeometry.indexBuffer,Ue.skyboxGeometry.segment)}($,L,Ce,Q,Oe)},debug:function($,y,L){for(let G=0;G<L.length;G++)Cl($,y,L[G])},custom:function($,y,L){const G=$.context,K=L.implementation;if($.transform.projection.name==="mercator"){if($.renderPass==="offscreen"){const Q=K.prerender;Q&&($.setCustomLayerDefaults(),G.setColorMode($.colorModeForRenderPass()),Q.call(K,G.gl,$.transform.customLayerMatrix()),G.setDirty(),$.setBaseState())}else if($.renderPass==="translucent"){$.setCustomLayerDefaults(),G.setColorMode($.colorModeForRenderPass()),G.setStencilMode(h.StencilMode.disabled);const Q=K.renderingMode==="3d"?new h.DepthMode($.context.gl.LEQUAL,h.DepthMode.ReadWrite,$.depthRangeFor3D):$.depthModeForSublayer(0,h.DepthMode.ReadOnly);G.setDepthMode(Q),K.render(G.gl,$.transform.customLayerMatrix()),G.setDirty(),$.setBaseState(),G.bindFramebuffer.set(null)}}else h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Il{constructor(y,L){this.context=new ie(y),this.transform=L,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new co,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(y,L){const G=!!y&&!!y.terrain&&this.transform.projection.name==="mercator";if(!(G||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _s(this,y));const K=this._terrain;this.transform.elevation=G?K:null,K.update(y,this.transform,L)}_updateFog(y){const L=y.fog;if(!L||L.getOpacity(this.transform.pitch)<1||L.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[G,K]=L.getFovAdjustedRange(this.transform._fov);if(G>K)return void(this.transform.fogCullDistSq=null);const Q=G+.78*(K-G);this.transform.fogCullDistSq=Q*Q}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(y,L){if(this.width=y*h.exported.devicePixelRatio,this.height=L*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const G of this.style.order)this.style._layers[G].resize()}setup(){const y=this.context,L=new h.StructArrayLayout2i4;L.emplaceBack(0,0),L.emplaceBack(h.EXTENT,0),L.emplaceBack(0,h.EXTENT),L.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=y.createVertexBuffer(L,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const G=new h.StructArrayLayout2i4;G.emplaceBack(0,0),G.emplaceBack(h.EXTENT,0),G.emplaceBack(0,h.EXTENT),G.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=y.createVertexBuffer(G,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const K=new h.StructArrayLayout2i4;K.emplaceBack(-1,-1),K.emplaceBack(1,-1),K.emplaceBack(-1,1),K.emplaceBack(1,1),this.viewportBuffer=y.createVertexBuffer(K,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const Q=new h.StructArrayLayout4i8;Q.emplaceBack(0,0,0,0),Q.emplaceBack(h.EXTENT,0,h.EXTENT,0),Q.emplaceBack(0,h.EXTENT,0,h.EXTENT),Q.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=y.createVertexBuffer(Q,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const se=new h.StructArrayLayout3ui6;se.emplaceBack(0,1,2),se.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=y.createIndexBuffer(se);const ge=new h.StructArrayLayout1ui2;for(const Oe of[0,1,3,2,0])ge.emplaceBack(Oe);this.debugIndexBuffer=y.createIndexBuffer(ge),this.emptyTexture=new h.Texture(y,{width:1,height:1,data:new Uint8Array([0,0,0,0])},y.gl.RGBA),this.identityMat=h.create$1();const Ce=this.context.gl;this.stencilClearMode=new h.StencilMode({func:Ce.ALWAYS,mask:0},0,255,Ce.ZERO,Ce.ZERO,Ce.ZERO),this.loadTimeStamps.push(h.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(y){return y._makeTileBoundsBuffers(this.context,this.transform.projection),y._tileBoundsBuffer?{tileBoundsBuffer:y._tileBoundsBuffer,tileBoundsIndexBuffer:y._tileBoundsIndexBuffer,tileBoundsSegments:y._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const y=this.context,L=y.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(y,L.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,La(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(y,L,G){if(!(L&&this.currentStencilSource!==L.id&&y.isTileClipped()&&G&&G.length))return;this.currentStencilSource=L.id;const K=this.context,Q=K.gl;this.nextStencilID+G.length>256&&this.clearStencil(),K.setColorMode(h.ColorMode.disabled),K.setDepthMode(h.DepthMode.disabled);const se=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const ge of G){const Ce=L.getTile(ge),Oe=this._tileClippingMaskIDs[ge.key]=this.nextStencilID++,{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Qe}=this.getTileBoundsBuffers(Ce);se.draw(K,Q.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:Q.ALWAYS,mask:0},Oe,255,Q.KEEP,Q.KEEP,Q.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,La(ge.projMatrix),"$clipping",Fe,Ue,Qe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const y=this.nextStencilID++,L=this.context.gl;return new h.StencilMode({func:L.NOTEQUAL,mask:255},y,255,L.KEEP,L.KEEP,L.REPLACE)}stencilModeForClipping(y){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(y);const L=this.context.gl;return new h.StencilMode({func:L.EQUAL,mask:255},this._tileClippingMaskIDs[y.key],0,L.KEEP,L.KEEP,L.REPLACE)}stencilConfigForOverlap(y){const L=this.context.gl,G=y.sort((se,ge)=>ge.overscaledZ-se.overscaledZ),K=G[G.length-1].overscaledZ,Q=G[0].overscaledZ-K+1;if(Q>1){this.currentStencilSource=void 0,this.nextStencilID+Q>256&&this.clearStencil();const se={};for(let ge=0;ge<Q;ge++)se[ge+K]=new h.StencilMode({func:L.GEQUAL,mask:255},ge+this.nextStencilID,255,L.KEEP,L.KEEP,L.REPLACE);return this.nextStencilID+=Q,[se,G]}return[{[K]:h.StencilMode.disabled},G]}colorModeForRenderPass(){const y=this.context.gl;if(this._showOverdrawInspector){const L=1/8;return new h.ColorMode([y.CONSTANT_COLOR,y.ONE],new h.Color(L,L,L,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(y,L,G){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const K=1-((1+this.currentLayer)*this.numSublayers+y)*this.depthEpsilon;return new h.DepthMode(G||this.context.gl.LEQUAL,L,[K,K])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(y,L){this.style=y,this.options=L,this.lineAtlas=y.lineAtlas,this.imageManager=y.imageManager,this.glyphManager=y.glyphManager,this.symbolFadeChange=y.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const G=this.style.order,K=this.style._sourceCaches;for(const Oe in K){const Fe=K[Oe];Fe.used&&Fe.prepare(this.context)}const Q={},se={},ge={};for(const Oe in K){const Fe=K[Oe];Q[Oe]=Fe.getVisibleCoordinates(),se[Oe]=Q[Oe].slice().reverse(),ge[Oe]=Fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Oe=0;Oe<G.length;Oe++)if(this.style._layers[G[Oe]].is3D()){this.opaquePassCutoff=Oe;break}if(this.terrain&&(this.terrain.updateTileBinding(ge),this.opaquePassCutoff=0),!h.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Oe of G){const Fe=this.style._layers[Oe],Ue=y._getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Qe=Ue?se[Ue.id]:void 0;(Fe.type==="custom"||Fe.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Ue,Fe,Qe)}this.depthRangeFor3D=[0,1-(y.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Ce=h.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(Ce=this.style.fog.properties.get("color")),this.context.clear({color:L.showOverdrawInspector?h.Color.black:Ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=L.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=G.length-1;this.currentLayer>=0;this.currentLayer--){const Oe=this.style._layers[G[this.currentLayer]],Fe=y._getLayerSourceCache(Oe);if(Oe.isSky())continue;const Ue=Fe?se[Fe.id]:void 0;this._renderTileClippingMasks(Oe,Fe,Ue),this.renderLayer(this,Fe,Oe,Ue)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const Oe=this.style._layers[G[this.currentLayer]],Fe=y._getLayerSourceCache(Oe);Oe.isSky()&&this.renderLayer(this,Fe,Oe,Fe?se[Fe.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<G.length;){const Oe=this.style._layers[G[this.currentLayer]],Fe=y._getLayerSourceCache(Oe);if(Oe.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Oe)){if(Oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Ue=Fe?(Oe.type==="symbol"?ge:se)[Fe.id]:void 0;this._renderTileClippingMasks(Oe,Fe,Fe?Q[Fe.id]:void 0),this.renderLayer(this,Fe,Oe,Ue),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let Oe=null;h.values(this.style._layers).forEach(Fe=>{const Ue=y._getLayerSourceCache(Fe);Ue&&!Fe.isHidden(this.transform.zoom)&&(!Oe||Oe.getSource().maxzoom<Ue.getSource().maxzoom)&&(Oe=Ue)}),Oe&&this.options.showTileBoundaries&&Io.debug(this,Oe,Oe.getVisibleCoordinates())}this.options.showPadding&&function(Oe){const Fe=Oe.transform.padding;sa(Oe,Oe.transform.height-(Fe.top||0),3,Ms),sa(Oe,Fe.bottom||0,3,Zi),Al(Oe,Fe.left||0,3,Ao),Al(Oe,Oe.transform.width-(Fe.right||0),3,Hh);const Ue=Oe.transform.centerPoint;(function(Qe,ht,ct,at){Co(Qe,ht-1,ct-10,2,20,at),Co(Qe,ht-10,ct-1,20,2,at)})(Oe,Ue.x,Oe.transform.height-Ue.y,Tl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%h.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}renderLayer(y,L,G,K){G.isHidden(this.transform.zoom)||(G.type==="background"||G.type==="sky"||G.type==="custom"||K&&K.length)&&(this.id=G.id,this.gpuTimingStart(G),Io[G.type](y,L,G,K,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(y){if(!this.options.gpuTiming)return;const L=this.context.extTimerQuery;let G=this.gpuTimers[y.id];G||(G=this.gpuTimers[y.id]={calls:0,cpuTime:0,query:L.createQueryEXT()}),G.calls++,L.beginQueryEXT(L.TIME_ELAPSED_EXT,G.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const y=this.context.extTimerQuery;y.endQueryEXT(y.TIME_ELAPSED_EXT)}collectGpuTimers(){const y=this.gpuTimers;return this.gpuTimers={},y}queryGpuTimers(y){const L={};for(const G in y){const K=y[G],Q=this.context.extTimerQuery,se=Q.getQueryObjectEXT(K.query,Q.QUERY_RESULT_EXT)/1e6;Q.deleteQueryEXT(K.query),L[G]=se}return L}translatePosMatrix(y,L,G,K,Q){if(!G[0]&&!G[1])return y;const se=Q?K==="map"?this.transform.angle:0:K==="viewport"?-this.transform.angle:0;if(se){const Oe=Math.sin(se),Fe=Math.cos(se);G=[G[0]*Fe-G[1]*Oe,G[0]*Oe+G[1]*Fe]}const ge=[Q?G[0]:Ze(L,G[0],this.transform.zoom),Q?G[1]:Ze(L,G[1],this.transform.zoom),0],Ce=new Float32Array(16);return h.translate(Ce,y,ge),Ce}saveTileTexture(y){const L=this._tileTextures[y.size[0]];L?L.push(y):this._tileTextures[y.size[0]]=[y]}getTileTexture(y){const L=this._tileTextures[y];return L&&L.length>0?L.pop():null}isPatternMissing(y){if(!y)return!1;if(!y.from||!y.to)return!0;const L=this.imageManager.getPattern(y.from.toString()),G=this.imageManager.getPattern(y.to.toString());return!L||!G}currentGlobalDefines(){const y=this.terrain&&this.terrain.renderingToTexture,L=this.style&&this.style.fog,G=[];return this.terrain&&!this.terrain.renderingToTexture&&G.push("TERRAIN"),L&&!y&&L.getOpacity(this.transform.pitch)!==0&&G.push("FOG"),y&&G.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&G.push("OVERDRAW_INSPECTOR"),G}useProgram(y,L,G){this.cache=this.cache||{};const K=G||[],Q=this.currentGlobalDefines().concat(K),se=vo.cacheKey(y,Q,L);return this.cache[se]||(this.cache[se]=new vo(this.context,y,po[y],L,Zh[y],Q)),this.cache[se]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const y=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(y.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(y){this.terrain&&this.terrain.prepareDrawTile(y)}prepareDrawProgram(y,L,G){if(this.terrain&&this.terrain.renderingToTexture)return;const K=this.style.fog;if(K){const Q=K.getOpacity(this.transform.pitch);Q!==0&&L.setFogUniformValues(y,((se,ge,Ce,Oe)=>{const Fe=ge.properties.get("color"),Ue=se.frameCounter/1e3%1,Qe=[Fe.r/Fe.a,Fe.g/Fe.a,Fe.b/Fe.a,Oe];return{u_fog_matrix:Ce?se.transform.calculateFogTileMatrix(Ce):se.identityMat,u_fog_range:ge.getFovAdjustedRange(se.transform._fov),u_fog_color:Qe,u_fog_horizon_blend:ge.properties.get("horizon-blend"),u_fog_temporal_offset:Ue}})(this,K,G,Q))}}setTileLoadedFlag(y){this.tileLoaded=y}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const y=this.context.gl,L=y.createTexture();return y.bindTexture(y.TEXTURE_2D,L),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,y.drawingBufferWidth,y.drawingBufferHeight,0),L}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const y=this.style&&this.style.fog;return!!y&&y.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const y=this._backgroundTiles,L=this._backgroundTiles={},G=this.transform.coveringTiles({tileSize:512});for(const K of G)L[K.key]=y[K.key]||new h.Tile(K,512,this.transform.tileZoom,this);return L}clearBackgroundTiles(){this._backgroundTiles={}}}class ha{constructor(y=0,L=0,G=0,K=0){if(isNaN(y)||y<0||isNaN(L)||L<0||isNaN(G)||G<0||isNaN(K)||K<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=y,this.bottom=L,this.left=G,this.right=K}interpolate(y,L,G){return L.top!=null&&y.top!=null&&(this.top=h.number(y.top,L.top,G)),L.bottom!=null&&y.bottom!=null&&(this.bottom=h.number(y.bottom,L.bottom,G)),L.left!=null&&y.left!=null&&(this.left=h.number(y.left,L.left,G)),L.right!=null&&y.right!=null&&(this.right=h.number(y.right,L.right,G)),this}getCenter(y,L){const G=h.clamp((this.left+y-this.right)/2,0,y),K=h.clamp((this.top+L-this.bottom)/2,0,L);return new h.pointGeometry(G,K)}equals(y){return this.top===y.top&&this.bottom===y.bottom&&this.left===y.left&&this.right===y.right}clone(){return new ha(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Cn($,y){return[$[4*y],$[4*y+1],$[4*y+2],$[4*y+3]]}function Kr($,y,L){$[4*y+0]=L[0],$[4*y+1]=L[1],$[4*y+2]=L[2],$[4*y+3]=L[3]}function ko($,y){const L=Cn($,3);h.fromQuat($,y),Kr($,3,L)}function As($,y){Kr($,3,[y[0],y[1],y[2],1])}function Do($,y){const L=h.identity$1([]);return h.rotateZ$1(L,L,-y),h.rotateX$1(L,L,-$),L}function In($,y){const L=[$[0],$[1],0],G=[y[0],y[1],0];if(h.length(L)>=1e-15){const se=h.normalize([],L);h.scale(G,se,h.dot(G,se)),y[0]=G[0],y[1]=G[1]}const K=h.cross([],y,$);if(h.len(K)<1e-15)return null;const Q=Math.atan2(-K[1],K[0]);return Do(Math.atan2(Math.sqrt($[0]*$[0]+$[1]*$[1]),-$[2]),Q)}class Cs{constructor(y,L){this.position=y,this.orientation=L}get position(){return this._position}set position(y){this._position=this._renderWorldCopies?function(L){if(!L)return;const G=Array.isArray(L)?new h.MercatorCoordinate(L[0],L[1],L[2]):L;return G.x=h.wrap(G.x,0,1),G}(y):y}lookAtPoint(y,L){if(this.orientation=null,!this.position)return;const G=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(y)):0,K=this.position,Q=h.MercatorCoordinate.fromLngLat(y,G),se=[Q.x-K.x,Q.y-K.y,Q.z-K.z];L||(L=[0,0,1]),L[2]=Math.abs(L[2]),this.orientation=In(se,L)}setPitchBearing(y,L){this.orientation=Do(h.degToRad(y),h.degToRad(-L))}}class ua{constructor(y,L){this._transform=h.identity([]),this._orientation=h.identity$1([]),L&&(this._orientation=L,ko(this._transform,this._orientation)),y&&As(this._transform,y)}get mercatorPosition(){const y=this.position;return new h.MercatorCoordinate(y[0],y[1],y[2])}get position(){const y=Cn(this._transform,3);return[y[0],y[1],y[2]]}set position(y){As(this._transform,y)}get orientation(){return this._orientation}set orientation(y){this._orientation=y,ko(this._transform,this._orientation)}getPitchBearing(){const y=this.forward(),L=this.right();return{bearing:Math.atan2(-L[1],L[0]),pitch:Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2])}}setPitchBearing(y,L){this._orientation=Do(y,L),ko(this._transform,this._orientation)}forward(){const y=Cn(this._transform,2);return[-y[0],-y[1],-y[2]]}up(){const y=Cn(this._transform,1);return[-y[0],-y[1],-y[2]]}right(){const y=Cn(this._transform,0);return[y[0],y[1],y[2]]}getCameraToWorld(y,L){const G=new Float64Array(16);return h.invert(G,this.getWorldToCamera(y,L)),G}getWorldToCameraPosition(y,L,G){const K=this.position;h.scale(K,K,-y);const Q=new Float64Array(16);return h.fromScaling(Q,[G,G,G]),h.translate(Q,Q,K),Q[10]*=L,Q}getWorldToCamera(y,L){const G=new Float64Array(16),K=new Float64Array(4),Q=this.position;return h.conjugate(K,this._orientation),h.scale(Q,Q,-y),h.fromQuat(G,K),h.translate(G,G,Q),G[1]*=-1,G[5]*=-1,G[9]*=-1,G[13]*=-1,G[8]*=L,G[9]*=L,G[10]*=L,G[11]*=L,G}getCameraToClipPerspective(y,L,G,K){const Q=new Float64Array(16);return h.perspective(Q,y,L,G,K),Q}getDistanceToElevation(y){const L=y===0?0:h.mercatorZfromAltitude(y,this.position[1]),G=this.forward();return(L-this.position[2])/G[2]}clone(){return new ua([...this.position],[...this.orientation])}}function Ro($,y){const L=Is($),G=function(Q,se,ge,Ce,Oe){const Fe=new h.LngLat(ge.lng-180*Zn,ge.lat),Ue=new h.LngLat(ge.lng+180*Zn,ge.lat),Qe=Q.project(Fe.lng,Fe.lat),ht=Q.project(Ue.lng,Ue.lat),ct=-Math.atan2(ht.y-Qe.y,ht.x-Qe.x),at=h.MercatorCoordinate.fromLngLat(ge);at.y=h.clamp(at.y,-.999975,.999975);const mt=at.toLngLat(),st=Q.project(mt.lng,mt.lat),gt=h.MercatorCoordinate.fromLngLat(mt);gt.x+=Zn;const xt=gt.toLngLat(),ut=Q.project(xt.lng,xt.lat),Et=kl(ut.x-st.x,ut.y-st.y,ct),kt=h.MercatorCoordinate.fromLngLat(mt);kt.y+=Zn;const Wt=kt.toLngLat(),Zt=Q.project(Wt.lng,Wt.lat),Jt=kl(Zt.x-st.x,Zt.y-st.y,ct),Qt=Math.abs(Et.x)/Math.abs(Jt.y),ci=h.identity([]);h.rotateZ(ci,ci,-ct*(1-(Oe?0:Ce)));const Kt=h.identity([]);return h.scale$1(Kt,Kt,[1,1-(1-Qt)*Ce,1]),Kt[4]=-Jt.x/Jt.y*Ce,h.rotateZ(Kt,Kt,ct),h.multiply(Kt,ci,Kt),Kt}($.projection,0,$.center,L,y),K=Fa($);return h.scale$1(G,G,[K,K,1]),G}function Fa($){const y=$.projection,L=Is($),G=Hn(y,$.center),K=Hn(y,h.LngLat.convert(y.center));return Math.pow(2,G*L+(1-L)*K)}function Is($){const y=$.projection.range;if(!y)return 0;const L=Math.max($.width,$.height),G=Math.log(L/1024)/Math.LN2;return h.smoothstep(y[0]+G,y[1]+G,$.zoom)}const Zn=1/4e4;function Hn($,y){const L=h.clamp(y.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),G=new h.LngLat(y.lng-180*Zn,L),K=new h.LngLat(y.lng+180*Zn,L),Q=$.project(G.lng,L),se=$.project(K.lng,L),ge=h.MercatorCoordinate.fromLngLat(G),Ce=h.MercatorCoordinate.fromLngLat(K),Oe=se.x-Q.x,Fe=se.y-Q.y,Ue=Ce.x-ge.x,Qe=Ce.y-ge.y,ht=Math.sqrt((Ue*Ue+Qe*Qe)/(Oe*Oe+Fe*Fe));return Math.log(ht)/Math.LN2}function kl($,y,L){const G=Math.cos(L),K=Math.sin(L);return{x:$*G-y*K,y:$*K+y*G}}class ks{constructor(y,L,G,K,Q){this.tileSize=512,this._renderWorldCopies=Q===void 0||Q,this._minZoom=y||0,this._maxZoom=L||22,this._minPitch=G==null?0:G,this._maxPitch=K==null?60:K,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ha,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ua,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const y=new ks(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return y._elevation=this._elevation,y._centerAltitude=this._centerAltitude,y.tileSize=this.tileSize,y.setMaxBounds(this.getMaxBounds()),y.width=this.width,y.height=this.height,y.cameraElevationReference=this.cameraElevationReference,y._center=this._center,y._setZoom(this.zoom),y._cameraZoom=this._cameraZoom,y.angle=this.angle,y._fov=this._fov,y._pitch=this._pitch,y._averageElevation=this._averageElevation,y._unmodified=this._unmodified,y._edgeInsets=this._edgeInsets.clone(),y._camera=this._camera.clone(),y._calcMatrices(),y.freezeTileCoverage=this.freezeTileCoverage,y.setProjection(this.getProjection()),y}get elevation(){return this._elevation}set elevation(y){this._elevation!==y&&(this._elevation=y,y?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(y){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),y&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(y){y==null&&(y={name:"mercator"}),this.projectionOptions=y;const L=this.projection?this.getProjection():void 0;return this.projection=h.getProjection(y),!k(L,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(y){this._minZoom!==y&&(this._minZoom=y,this.zoom=Math.max(this.zoom,y))}get maxZoom(){return this._maxZoom}set maxZoom(y){this._maxZoom!==y&&(this._maxZoom=y,this.zoom=Math.min(this.zoom,y))}get minPitch(){return this._minPitch}set minPitch(y){this._minPitch!==y&&(this._minPitch=y,this.pitch=Math.max(this.pitch,y))}get maxPitch(){return this._maxPitch}set maxPitch(y){this._maxPitch!==y&&(this._maxPitch=y,this.pitch=Math.min(this.pitch,y))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.wrap===!0}set renderWorldCopies(y){y===void 0?y=!0:y===null&&(y=!1),this._renderWorldCopies=y}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const y=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(y))}get pixelsPerMeter(){return h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return h.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(y){this.rotation=y}get rotation(){return-this.angle/Math.PI*180}set rotation(y){const L=-y*Math.PI/180;var G;this.angle!==L&&(this._unmodified=!1,this.angle=L,this._calcMatrices(),this.rotationMatrix=(G=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(G[1]=0,G[2]=0),G[0]=1,G[3]=1,G),function(K,Q,se){var ge=Q[0],Ce=Q[1],Oe=Q[2],Fe=Q[3],Ue=Math.sin(se),Qe=Math.cos(se);K[0]=ge*Qe+Oe*Ue,K[1]=Ce*Qe+Fe*Ue,K[2]=ge*-Ue+Oe*Qe,K[3]=Ce*-Ue+Fe*Qe}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(y){const L=h.clamp(y,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==L&&(this._unmodified=!1,this._pitch=L,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(y){y=Math.max(.01,Math.min(60,y)),this._fov!==y&&(this._unmodified=!1,this._fov=y/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(y){this._averageElevation=y,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(y){const L=Math.min(Math.max(y,this.minZoom),this.maxZoom);this._zoom!==L&&(this._unmodified=!1,this._setZoom(L),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(y){this._zoom=y,this.scale=this.zoomScale(y),this.tileZoom=Math.floor(y),this.zoomFraction=y-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const y=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return y===-1?(this._cameraZoom=null,!1):(this._centerAltitude=y,!0)}_updateCameraOnTerrain(){const y=this.cameraToCenterDistance/this.worldSize,L=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(L+y)}sampleAverageElevation(){if(!this._elevation)return 0;const y=this._elevation,L=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],G=this.horizonLineFromTop();let K=0,Q=0;for(let se=0;se<L.length;se++){const ge=new h.pointGeometry(L[se][0]*this.width,G+L[se][1]*(this.height-G)),Ce=y.pointCoordinate(ge);if(!Ce)continue;const Oe=1/Math.hypot(Ce[0]-this._camera.position[0],Ce[1]-this._camera.position[1]);K+=Ce[3]*Oe,Q+=Oe}return Q===0?NaN:K/Q}get center(){return this._center}set center(y){y.lat===this._center.lat&&y.lng===this._center.lng||(this._unmodified=!1,this._center=y,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const y=this._cameraZoom,L=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),G=h.mercatorZfromAltitude(L,this.center.lat),K=this._mercatorZfromZoom(y),Q=this._mercatorZfromZoom(this._maxZoom),se=Math.max(K-G,Q);this._setZoom(this._zoomFromMercatorZ(se))}get padding(){return this._edgeInsets.toJSON()}set padding(y){this._edgeInsets.equals(y)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,y,1),this._calcMatrices())}computeZoomRelativeTo(y){const L=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,y.toAltitude()));let G;G=y.z<this._camera.position[2]?[L.x,L.y,L.z]:[y.x,y.y,y.z];const K=h.length(h.sub([],this._camera.position,G));return h.clamp(this._zoomFromMercatorZ(K),this._minZoom,this._maxZoom)}setFreeCameraOptions(y){if(!this.height||!y.position&&!y.orientation)return;this._updateCameraState();let L=!1;if(y.orientation&&!h.exactEquals(y.orientation,this._camera.orientation)&&(L=this._setCameraOrientation(y.orientation)),y.position){const G=[y.position.x,y.position.y,y.position.z];h.exactEquals$1(G,this._camera.position)||(this._setCameraPosition(G),L=!0)}L&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const y=this._camera.position,L=new Cs;return L.position=new h.MercatorCoordinate(y[0],y[1],y[2]),L.orientation=this._camera.orientation,L._elevation=this.elevation,L._renderWorldCopies=this.renderWorldCopies,L}_setCameraOrientation(y){if(!h.length$1(y))return!1;h.normalize$1(y,y);const L=h.transformQuat([],[0,0,-1],y),G=h.transformQuat([],[0,-1,0],y);if(G[2]<0)return!1;const K=In(L,G);return!!K&&(this._camera.orientation=K,!0)}_setCameraPosition(y){const L=this.zoomScale(this.minZoom)*this.tileSize,G=this.zoomScale(this.maxZoom)*this.tileSize,K=this.cameraToCenterDistance;y[2]=h.clamp(y[2],K/G,K/L),this._camera.position=y}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(y){return this._edgeInsets.equals(y)}interpolatePadding(y,L,G){this._unmodified=!1,this._edgeInsets.interpolate(y,L,G),this._constrain(),this._calcMatrices()}coveringZoomLevel(y){const L=(y.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/y.tileSize));return Math.max(0,L)}getVisibleUnwrappedCoordinates(y){const L=[new h.UnwrappedTileID(0,y)];if(this.renderWorldCopies){const G=this.pointCoordinate(new h.pointGeometry(0,0)),K=this.pointCoordinate(new h.pointGeometry(this.width,0)),Q=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),se=this.pointCoordinate(new h.pointGeometry(0,this.height)),ge=Math.floor(Math.min(G.x,K.x,Q.x,se.x)),Ce=Math.floor(Math.max(G.x,K.x,Q.x,se.x)),Oe=1;for(let Fe=ge-Oe;Fe<=Ce+Oe;Fe++)Fe!==0&&L.push(new h.UnwrappedTileID(Fe,y))}return L}coveringTiles(y){let L=this.coveringZoomLevel(y);const G=L,K=this.elevation&&!y.isTerrainDEM,Q=this.projection.name==="mercator";if(y.minzoom!==void 0&&L<y.minzoom)return[];y.maxzoom!==void 0&&L>y.maxzoom&&(L=y.maxzoom);const se=this.locationCoordinate(this.center),ge=1<<L,Ce=[ge*se.x,ge*se.y,0],Oe=Z.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,L),Fe=this.pointCoordinate(this.getCameraPoint()),Ue=ge*h.mercatorZfromAltitude(1,this.center.lat),Qe=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),ht=[ge*Fe.x,ge*Fe.y,Qe],ct=this.cameraToCenterDistance/y.tileSize*(y.roundZoom?1:.502),at=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&Q?L:0,mt=y.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,st=y.isTerrainDEM?-mt:this._elevation?this._elevation.getMinElevationBelowMSL():0,gt=Fa(this),xt=Gt=>{const pi=1/4e4,Ei=new h.MercatorCoordinate(Gt.x+pi,Gt.y,Gt.z),Ai=new h.MercatorCoordinate(Gt.x,Gt.y+pi,Gt.z),Ci=Gt.toLngLat(),Di=Ei.toLngLat(),Ri=Ai.toLngLat(),Ti=this.locationCoordinate(Ci),Pi=this.locationCoordinate(Di),Wi=this.locationCoordinate(Ri),gr=Math.hypot(Pi.x-Ti.x,Pi.y-Ti.y),Tr=Math.hypot(Wi.x-Ti.x,Wi.y-Ti.y);return Math.sqrt(gr*Tr)*gt/pi},ut=(Gt,pi,Ei,Ai,Ci,Di)=>{const Ri=h.tileTransform({z:Gt,x:pi,y:Ei},this.projection);return new W([(Ai+Ri.x/Ri.scale)*ge,ge*(Ri.y/Ri.scale),Ci],[(Ai+Ri.x2/Ri.scale)*ge,ge*(Ri.y2/Ri.scale),Di])},Et=Gt=>({aabb:ut(0,0,0,Gt,st,mt),zoom:0,x:0,y:0,wrap:Gt,fullyVisible:!1}),kt=[];let Wt=[];const Zt=L,Jt=y.reparseOverscaled?G:L,Qt=Gt=>{if(!this._elevation||!Gt.tileID)return;const pi=this._elevation.getMinMaxForTile(Gt.tileID),Ei=Gt.aabb;pi?(Ei.min[2]=pi.min,Ei.max[2]=pi.max,Ei.center[2]=(Ei.min[2]+Ei.max[2])/2):(Gt.shouldSplit=di(Gt),Gt.shouldSplit||(Ei.min[2]=Ei.max[2]=Ei.center[2]=this._centerAltitude))},ci=Gt=>Gt*Gt,Kt=ci((Qe-this._centerAltitude)*Ue),di=Gt=>{if(Gt.zoom<at)return!0;if(Gt.zoom===Zt)return!1;if(Gt.shouldSplit!=null)return Gt.shouldSplit;const pi=Gt.aabb.distanceX(ht),Ei=Gt.aabb.distanceY(ht);let Ai=Kt;K&&(Ai=ci(Gt.aabb.distanceZ(ht)*Ue));let Ci=1;if(!Q&&G<=5){const Ri=Math.pow(2,Gt.zoom),Ti=xt(new h.MercatorCoordinate((Gt.x+.5)/Ri,(Gt.y+.5)/Ri));Ci=Ti>.85?1:Ti}const Di=pi*pi+Ei*Ei+Ai;return Di<ci((1<<Zt-Gt.zoom)*ct*Ci*((Ri,Ti)=>{if(Ti*ci(.707)<Ri)return 1;const Pi=Math.sqrt(Ti/Ri);return Pi/(1.4144271570014144+(Math.pow(1.1,Pi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ai,Kt),Di))};if(this.renderWorldCopies)for(let Gt=1;Gt<=3;Gt++)kt.push(Et(-Gt)),kt.push(Et(Gt));for(kt.push(Et(0));kt.length>0;){const Gt=kt.pop(),pi=Gt.x,Ei=Gt.y;let Ai=Gt.fullyVisible;if(!Ai){const Ci=Gt.aabb.intersects(Oe);if(Ci===0)continue;Ai=Ci===2}if(Gt.zoom!==Zt&&di(Gt))for(let Ci=0;Ci<4;Ci++){const Di=(pi<<1)+Ci%2,Ri=(Ei<<1)+(Ci>>1),Ti={aabb:this.projection.name==="mercator"?Gt.aabb.quadrant(Ci):ut(Gt.zoom+1,Di,Ri,Gt.wrap,0,0),zoom:Gt.zoom+1,x:Di,y:Ri,wrap:Gt.wrap,fullyVisible:Ai,tileID:void 0,shouldSplit:void 0};K&&(Ti.tileID=new h.OverscaledTileID(Gt.zoom+1===Zt?Jt:Gt.zoom+1,Gt.wrap,Gt.zoom+1,Di,Ri),Qt(Ti)),kt.push(Ti)}else{const Ci=Gt.zoom===Zt?Jt:Gt.zoom;if(y.minzoom&&y.minzoom>Ci)continue;const Di=Ce[0]-(.5+pi+(Gt.wrap<<Gt.zoom))*(1<<L-Gt.zoom),Ri=Ce[1]-.5-Ei,Ti=Gt.tileID?Gt.tileID:new h.OverscaledTileID(Ci,Gt.wrap,Gt.zoom,pi,Ei);Wt.push({tileID:Ti,distanceSq:Di*Di+Ri*Ri})}}if(this.fogCullDistSq){const Gt=this.fogCullDistSq,pi=this.horizonLineFromTop();Wt=Wt.filter(Ei=>{const Ai=[0,0,0,1],Ci=[h.EXTENT,h.EXTENT,0,1],Di=this.calculateFogTileMatrix(Ei.tileID.toUnwrapped());h.transformMat4(Ai,Ai,Di),h.transformMat4(Ci,Ci,Di);const Ri=h.getAABBPointSquareDist(Ai,Ci);if(Ri===0)return!0;let Ti=!1;const Pi=this._elevation;if(Pi&&Ri>Gt&&pi!==0){const Wi=this.calculateProjMatrix(Ei.tileID.toUnwrapped());let gr;y.isTerrainDEM||(gr=Pi.getMinMaxForTile(Ei.tileID)),gr||(gr={min:st,max:mt});const Tr=h.furthestTileCorner(this.rotation),Pr=[Tr[0]*h.EXTENT,Tr[1]*h.EXTENT,gr.max];h.transformMat4$1(Pr,Pr,Wi),Ti=(1-Pr[1])*this.height*.5<pi}return Ri<Gt||Ti})}return Wt.sort((Gt,pi)=>Gt.distanceSq-pi.distanceSq).map(Gt=>Gt.tileID)}resize(y,L){this.width=y,this.height=L,this.pixelsToGLUnits=[2/y,-2/L],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(y){return Math.pow(2,y)}scaleZoom(y){return Math.log(y)/Math.LN2}project(y){const L=h.clamp(y.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),G=this.projection.project(y.lng,L);return new h.pointGeometry(G.x*this.worldSize,G.y*this.worldSize)}unproject(y){return this.projection.unproject(y.x/this.worldSize,y.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(y,L){const G=this.pointCoordinate(L),K=this.pointCoordinate(this.centerPoint),Q=this.locationCoordinate(y);this.setLocation(new h.MercatorCoordinate(Q.x-(G.x-K.x),Q.y-(G.y-K.y)))}setLocation(y){this.center=this.coordinateLocation(y),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(y){return this._coordinatePoint(this.locationCoordinate(y),!1)}locationPoint3D(y){return this._coordinatePoint(this.locationCoordinate(y),!0)}pointLocation(y){return this.coordinateLocation(this.pointCoordinate(y))}pointLocation3D(y){return this.coordinateLocation(this.pointCoordinate3D(y))}locationCoordinate(y,L){const G=L?h.mercatorZfromAltitude(L,y.lat):void 0,K=this.projection.project(y.lng,y.lat);return new h.MercatorCoordinate(K.x,K.y,G)}coordinateLocation(y){return this.projection.unproject(y.x,y.y)}pointRayIntersection(y,L){const G=L!=null?L:this._centerAltitude,K=[y.x,y.y,0,1],Q=[y.x,y.y,1,1];h.transformMat4(K,K,this.pixelMatrixInverse),h.transformMat4(Q,Q,this.pixelMatrixInverse);const se=Q[3];h.scale$2(K,K,1/K[3]),h.scale$2(Q,Q,1/se);const ge=K[2],Ce=Q[2];return{p0:K,p1:Q,t:ge===Ce?0:(G-ge)/(Ce-ge)}}screenPointToMercatorRay(y){const L=[y.x,y.y,0,1],G=[y.x,y.y,1,1];return h.transformMat4(L,L,this.pixelMatrixInverse),h.transformMat4(G,G,this.pixelMatrixInverse),h.scale$2(L,L,1/L[3]),h.scale$2(G,G,1/G[3]),L[2]=h.mercatorZfromAltitude(L[2],this._center.lat)*this.worldSize,G[2]=h.mercatorZfromAltitude(G[2],this._center.lat)*this.worldSize,h.scale$2(L,L,1/this.worldSize),h.scale$2(G,G,1/this.worldSize),new V([L[0],L[1],L[2]],h.normalize([],h.sub([],G,L)))}rayIntersectionCoordinate(y){const{p0:L,p1:G,t:K}=y,Q=h.mercatorZfromAltitude(L[2],this._center.lat),se=h.mercatorZfromAltitude(G[2],this._center.lat);return new h.MercatorCoordinate(h.number(L[0],G[0],K)/this.worldSize,h.number(L[1],G[1],K)/this.worldSize,h.number(Q,se,K))}pointCoordinate(y,L=this._centerAltitude){const G=this.horizonLineFromTop(!1),K=new h.pointGeometry(y.x,Math.max(G,y.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(K,L))}pointCoordinate3D(y){if(!this.elevation)return this.pointCoordinate(y);const L=this.elevation;let G=this.elevation.pointCoordinate(y);if(G)return new h.MercatorCoordinate(G[0],G[1],G[2]);let K=0,Q=this.horizonLineFromTop();if(y.y>Q)return this.pointCoordinate(y);const se=.02*Q,ge=y.clone();for(let Ce=0;Ce<10&&Q-K>se;Ce++){ge.y=h.number(K,Q,.66);const Oe=L.pointCoordinate(ge);Oe?(Q=ge.y,G=Oe):K=ge.y}return G?new h.MercatorCoordinate(G[0],G[1],G[2]):this.pointCoordinate(y)}isPointAboveHorizon(y){if(this.elevation)return!this.elevation.pointCoordinate(y);{const L=this.horizonLineFromTop();return y.y<L}}_coordinatePoint(y,L){const G=L&&this.elevation?this.elevation.getAtPointOrZero(y,this._centerAltitude):this._centerAltitude,K=[y.x*this.worldSize,y.y*this.worldSize,G+y.toAltitude(),1];return h.transformMat4(K,K,this.pixelMatrix),K[3]>0?new h.pointGeometry(K[0]/K[3],K[1]/K[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(y,L){const G=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),K=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),Q=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),se=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let ge=this.pointCoordinate(G,y),Ce=this.pointCoordinate(K,y);const Oe=this.pointCoordinate(Q,L),Fe=this.pointCoordinate(se,L),Ue=(Qe,ht)=>(ht.y-Qe.y)/(ht.x-Qe.x);return ge.y>1&&Ce.y>=0?ge=new h.MercatorCoordinate((1-Fe.y)/Ue(Fe,ge)+Fe.x,1):ge.y<0&&Ce.y<=1&&(ge=new h.MercatorCoordinate(-Fe.y/Ue(Fe,ge)+Fe.x,0)),Ce.y>1&&ge.y>=0?Ce=new h.MercatorCoordinate((1-Oe.y)/Ue(Oe,Ce)+Oe.x,1):Ce.y<0&&ge.y<=1&&(Ce=new h.MercatorCoordinate(-Oe.y/Ue(Oe,Ce)+Oe.x,0)),new h.LngLatBounds().extend(this.coordinateLocation(ge)).extend(this.coordinateLocation(Ce)).extend(this.coordinateLocation(Fe)).extend(this.coordinateLocation(Oe))}_getBounds3D(){const y=this.elevation,L=y.visibleDemTiles.reduce((G,K)=>{if(K.dem){const Q=K.dem.tree;G.min=Math.min(G.min,Q.minimums[0]),G.max=Math.max(G.max,Q.maximums[0])}return G},{min:Number.MAX_VALUE,max:0});return this._getBounds(L.min*y.exaggeration(),L.max*y.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(y=!0){const L=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,G=this.height/2-L*(1-this._horizonShift);return y?Math.max(0,G):G}getMaxBounds(){return this.maxBounds}setMaxBounds(y){this.maxBounds=y,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,y&&(this.minLat=y.getSouth(),this.maxLat=y.getNorth(),this.minLng=y.getWest(),this.maxLng=y.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(y,L){let G,K,Q;const se=y.canonical,ge=h.identity(new Float64Array(16));if(this.projection.name==="mercator")G=L/this.zoomScale(se.z),K=(se.x+Math.pow(2,se.z)*y.wrap)*G,Q=se.y*G;else{const Ce=h.tileTransform(se,this.projection);G=1,K=Ce.x+y.wrap*Ce.scale,Q=Ce.y,h.scale$1(ge,ge,[G/Ce.scale,G/Ce.scale,this.pixelsPerMeter/this.worldSize])}return h.translate(ge,ge,[K,Q,0]),h.scale$1(ge,ge,[G/h.EXTENT,G/h.EXTENT,1]),ge}calculateDistanceTileData(y){const L=y.key,G=this._distanceTileDataCache;if(G[L])return G[L];const K=y.canonical,Q=1/this.height,se=this.cameraWorldSize/this.zoomScale(K.z),ge=(K.x+Math.pow(2,K.z)*y.wrap)*se,Ce=K.y*se,Oe=this.point,Fe=this.angle,Ue=Math.sin(-Fe),Qe=-Math.cos(-Fe);return G[L]={bearing:[Ue,Qe],center:[(Oe.x-ge)*Q,(Oe.y-Ce)*Q],scale:se/h.EXTENT*Q},G[L]}calculateFogTileMatrix(y){const L=y.key,G=this._fogTileMatrixCache;if(G[L])return G[L];const K=this.calculatePosMatrix(y,this.cameraWorldSize);return h.multiply(K,this.worldToFogMatrix,K),G[L]=new Float32Array(K),G[L]}calculateProjMatrix(y,L=!1){const G=y.key,K=L?this._alignedProjMatrixCache:this._projMatrixCache;if(K[G])return K[G];const Q=this.calculatePosMatrix(y,this.worldSize);return h.multiply(Q,this.projection.name==="mercator"?L?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,Q),K[G]=new Float32Array(Q),K[G]}calculatePixelsToTileUnitsMatrix(y){const L=y.tileID.key,G=this._pixelsToTileUnitsCache;if(G[L])return G[L];const K=function(Q,se){const{scale:ge}=Q.tileTransform,Ce=ge*h.EXTENT/(Q.tileSize*Math.pow(2,se.zoom-Q.tileID.overscaledZ+Q.tileID.canonical.z));return Oe=new Float32Array(4),Qe=(Fe=se.inverseAdjustmentMatrix)[1],ht=Fe[2],ct=Fe[3],mt=(Ue=[Ce,Ce])[1],Oe[0]=Fe[0]*(at=Ue[0]),Oe[1]=Qe*at,Oe[2]=ht*mt,Oe[3]=ct*mt,Oe;var Oe,Fe,Ue,Qe,ht,ct,at,mt}(y,this);return G[L]=K,G[L]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const y=this._elevation;this._updateCameraState();const L=this._camera.position,G=this._camera.forward();if(L[2]<=0||G[2]>=0)return;const K=h.mercatorZfromAltitude(1,this._center.lat);L[2]/=K,G[2]/=K,h.normalize(G,G);const Q=y.raycast(L,G,y.exaggeration());if(Q){const se=h.scaleAndAdd([],L,G,Q),ge=new h.MercatorCoordinate(se[0],se[1],h.mercatorZfromAltitude(se[2],h.latFromMercatorY(se[1]))),Ce=this._camera.position,Oe=ge.z+h.length([ge.x-Ce[0],ge.y-Ce[1],ge.z-Ce[2]]);this._cameraZoom=this._zoomFromMercatorZ(Oe),this._centerAltitude=ge.toAltitude(),this._center=this.coordinateLocation(ge),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const y=this._elevation;this._updateCameraState();const L=y.getAtPointOrZero(this._camera.mercatorPosition),G=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),K=h.mercatorZfromAltitude(L,this._center.lat),Q=this._camera.position[2]-K;if(Q<G){const se=this.locationCoordinate(this._center,this._centerAltitude),ge=this._camera.mercatorPosition,Ce=[se.x-ge.x,se.y-ge.y,se.z-ge.z],Oe=h.length(Ce);Ce[2]-=G-Q;const Fe=h.length(Ce);if(Fe===0)return;h.scale(Ce,Ce,Oe/Fe),this._camera.position=[se.x-Ce[0],se.y-Ce[1],se.z-Ce[2]],this._camera.orientation=In(Ce,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.name!=="mercator"){const Ue=this.center;return Ue.lat=h.clamp(Ue.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(Ue.lng=h.clamp(Ue.lng,this.minLng,this.maxLng)),this.center=Ue,void(this._constraining=!1)}const y=this._unmodified,{x:L,y:G}=this.point;let K=0,Q=L,se=G;const ge=this.width/2,Ce=this.height/2,Oe=this.worldMinY*this.scale,Fe=this.worldMaxY*this.scale;if(G-Ce<Oe&&(se=Oe+Ce),G+Ce>Fe&&(se=Fe-Ce),Fe-Oe<this.height&&(K=Math.max(K,this.height/(Fe-Oe)),se=(Fe+Oe)/2),this.maxBounds||!this.renderWorldCopies){const Ue=this.worldMinX*this.scale,Qe=this.worldMaxX*this.scale,ht=this.worldSize/2-(Ue+Qe)/2;Q=(L+ht+this.worldSize)%this.worldSize-ht,Q-ge<Ue&&(Q=Ue+ge),Q+ge>Qe&&(Q=Qe-ge),Qe-Ue<this.width&&(K=Math.max(K,this.width/(Qe-Ue)),Q=(Qe+Ue)/2)}Q===L&&se===G||(this.center=this.unproject(new h.pointGeometry(Q,se))),K&&(this.zoom+=this.scaleZoom(K)),this._constrainCameraAltitude(),this._unmodified=y,this._constraining=!1}_minZoomForBounds(){let y=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(y=Math.max(y,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),y}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const y=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const L=this.pixelsPerMeter;this._updateCameraState();const G=Math.PI/2+this._pitch,K=this.fovAboveCenter,Q=this.elevation?this.elevation.getMinElevationBelowMSL()*L:0,se=(this._camera.position[2]*this.worldSize-Q)/Math.cos(this._pitch),ge=Math.sin(K)*se/Math.sin(h.clamp(Math.PI-G-K,.01,Math.PI-.01)),Ce=this.point,Oe=Ce.x,Fe=Ce.y,Ue=Math.cos(Math.PI/2-this._pitch)*ge+se,Qe=Math.min(1.01*Ue,se*(1/this._horizonShift)),ht=this.height/50,ct=this._camera.getWorldToCamera(this.worldSize,L),at=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,ht,Qe);at[8]=2*-y.x/this.width,at[9]=2*y.y/this.height;let mt=h.mul$1([],at,ct);if(this.projection.name!=="mercator"){const ci=this.locationCoordinate(this.center),Kt=h.identity([]);h.translate(Kt,Kt,[ci.x*this.worldSize,ci.y*this.worldSize,0]),h.multiply(Kt,Kt,Ro(this)),h.translate(Kt,Kt,[-ci.x*this.worldSize,-ci.y*this.worldSize,0]),h.multiply(mt,mt,Kt),this.inverseAdjustmentMatrix=function(di){const Gt=Ro(di,!0);return O([],[Gt[0],Gt[1],Gt[4],Gt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale$1([],mt,[this.worldSize,this.worldSize,this.worldSize/L]),this.projMatrix=mt,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const st=new Float32Array(16);h.identity(st),h.scale$1(st,st,[1,-1,1]),h.rotateX(st,st,this._pitch),h.rotateZ(st,st,this.angle);const gt=h.perspective(new Float32Array(16),this._fov,this.width/this.height,ht,Qe),xt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;gt[8]=2*-y.x/this.width,gt[9]=2*(y.y+xt)/this.height,this.skyboxMatrix=h.multiply(st,gt,st);const ut=this.width%2/2,Et=this.height%2/2,kt=Math.cos(this.angle),Wt=Math.sin(this.angle),Zt=Oe-Math.round(Oe)+kt*ut+Wt*Et,Jt=Fe-Math.round(Fe)+kt*Et+Wt*ut,Qt=new Float64Array(mt);if(h.translate(Qt,Qt,[Zt>.5?Zt-1:Zt,Jt>.5?Jt-1:Jt,0]),this.alignedProjMatrix=Qt,mt=h.create$1(),h.scale$1(mt,mt,[this.width/2,-this.height/2,1]),h.translate(mt,mt,[1,-1,0]),this.labelPlaneMatrix=mt,mt=h.create$1(),h.scale$1(mt,mt,[1,-1,1]),h.translate(mt,mt,[-1,-1,0]),h.scale$1(mt,mt,[2/this.width,2/this.height,1]),this.glCoordMatrix=mt,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},mt=h.invert(new Float64Array(16),this.pixelMatrix),!mt)throw new Error("failed to invert matrix");this.pixelMatrixInverse=mt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const y=this.cameraWorldSize,L=this.cameraPixelsPerMeter,G=this._camera.position,K=1/this.height,Q=[y,y,L];h.scale(Q,Q,K),h.scale(G,G,-1),h.multiply$1(G,G,Q);const se=h.create$1();h.translate(se,se,G),h.scale$1(se,se,Q),this.mercatorFogMatrix=se,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(y,L,K)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const y=this._camera.forward(),L=this.cameraToCenterDistance,G=this.point,K=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-h.mercatorZfromAltitude(this._centerAltitude,this.center.lat),Q=this.cameraToCenterDistance/K;this._camera.position=[G.x/this.worldSize-y[0]*L/Q,G.y/this.worldSize-y[1]*L/Q,h.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-y[2]*L/Q]}_translateCameraConstrained(y){const L=this._maxCameraBoundsDistance()*Math.cos(this._pitch),G=y[2];let K=1;G>0&&(K=Math.min((L-this._camera.position[2])/G,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,y,K),this._updateStateFromCamera()}_updateStateFromCamera(){const y=this._camera.position,L=this._camera.forward(),{pitch:G,bearing:K}=this._camera.getPitchBearing(),Q=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat),se=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),ge=Math.max((y[2]-Q)/Math.cos(G),se),Ce=this._zoomFromMercatorZ(ge);h.scaleAndAdd(y,y,L,ge),this._pitch=h.clamp(G,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(K,-Math.PI,Math.PI),this._setZoom(h.clamp(Ce,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new h.MercatorCoordinate(y[0],y[1],y[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(y){return Math.pow(2,y)*this.tileSize}_mercatorZfromZoom(y){return this.cameraToCenterDistance/this._worldSizeFromZoom(y)}_minimumHeightOverTerrain(){const y=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(y)}_zoomFromMercatorZ(y){return this.scaleZoom(this.cameraToCenterDistance/(y*this.tileSize))}_terrainEnabled(){return!(!this._elevation||this.projection.name!=="mercator"&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(y,L){const G=Math.min(y.x,L.x),K=Math.max(y.x,L.x),Q=Math.min(y.y,L.y),se=Math.max(y.y,L.y);if(Q<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const ge=[new h.pointGeometry(G,Q),new h.pointGeometry(K,se),new h.pointGeometry(G,se),new h.pointGeometry(K,Q)],Ce=this.renderWorldCopies?-3:0,Oe=this.renderWorldCopies?4:1;for(const Fe of ge){const Ue=this.pointRayIntersection(Fe);if(Ue.t<0)return!0;const Qe=this.rayIntersectionCoordinate(Ue);if(Qe.x<Ce||Qe.y<0||Qe.x>Oe||Qe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(y,L){const G=h.length(h.sub([],this._camera.position,y)),K=this._zoomFromMercatorZ(G)+L;return G-this._mercatorZfromZoom(K)}getCameraPoint(){const y=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,y))}}function Ds($,y){let L=!1,G=null;const K=()=>{G=null,L&&($(),G=setTimeout(K,y),L=!1)};return()=>(L=!0,G||K(),G)}class Po{constructor(y){this._hashName=y&&encodeURIComponent(y),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ds(this._updateHashUnthrottled.bind(this),300)}addTo(y){return this._map=y,h.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return h.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(y){const L=this._map.getCenter(),G=Math.round(100*this._map.getZoom())/100,K=Math.ceil((G*Math.LN2+Math.log(512/360/.5))/Math.LN10),Q=Math.pow(10,K),se=Math.round(L.lng*Q)/Q,ge=Math.round(L.lat*Q)/Q,Ce=this._map.getBearing(),Oe=this._map.getPitch();let Fe="";if(Fe+=y?`/${se}/${ge}/${G}`:`${G}/${ge}/${se}`,(Ce||Oe)&&(Fe+="/"+Math.round(10*Ce)/10),Oe&&(Fe+=`/${Math.round(Oe)}`),this._hashName){const Ue=this._hashName;let Qe=!1;const ht=h.window.location.hash.slice(1).split("&").map(ct=>{const at=ct.split("=")[0];return at===Ue?(Qe=!0,`${at}=${Fe}`):ct}).filter(ct=>ct);return Qe||ht.push(`${Ue}=${Fe}`),`#${ht.join("&")}`}return`#${Fe}`}_getCurrentHash(){const y=h.window.location.hash.replace("#","");if(this._hashName){let L;return y.split("&").map(G=>G.split("=")).forEach(G=>{G[0]===this._hashName&&(L=G)}),(L&&L[1]||"").split("/")}return y.split("/")}_onHashChange(){const y=this._getCurrentHash();if(y.length>=3&&!y.some(L=>isNaN(L))){const L=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:L,pitch:+(y[4]||0)}),!0}return!1}_updateHashUnthrottled(){const y=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,y)}}const ca={linearity:.3,easing:h.bezier(0,0,.3,1)},Dl=h.extend({deceleration:2500,maxSpeed:1400},ca),Rl=h.extend({deceleration:20,maxSpeed:1400},ca),Lo=h.extend({deceleration:1e3,maxSpeed:360},ca),Rs=h.extend({deceleration:1e3,maxSpeed:90},ca);class Pl{constructor(y){this._map=y,this.clear()}clear(){this._inertiaBuffer=[]}record(y){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:y})}_drainInertiaBuffer(){const y=this._inertiaBuffer,L=h.exported.now();for(;y.length>0&&L-y[0].time>160;)y.shift()}_onMoveEnd(y){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const L={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:Q}of this._inertiaBuffer)L.zoom+=Q.zoomDelta||0,L.bearing+=Q.bearingDelta||0,L.pitch+=Q.pitchDelta||0,Q.panDelta&&L.pan._add(Q.panDelta),Q.around&&(L.around=Q.around),Q.pinchAround&&(L.pinchAround=Q.pinchAround);const G=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,K={};if(L.pan.mag()){const Q=Na(L.pan.mag(),G,h.extend({},Dl,y||{}));K.offset=L.pan.mult(Q.amount/L.pan.mag()),K.center=this._map.transform.center,za(K,Q)}if(L.zoom){const Q=Na(L.zoom,G,Rl);K.zoom=this._map.transform.zoom+Q.amount,za(K,Q)}if(L.bearing){const Q=Na(L.bearing,G,Lo);K.bearing=this._map.transform.bearing+h.clamp(Q.amount,-179,179),za(K,Q)}if(L.pitch){const Q=Na(L.pitch,G,Rs);K.pitch=this._map.transform.pitch+Q.amount,za(K,Q)}if(K.zoom||K.bearing){const Q=L.pinchAround===void 0?L.around:L.pinchAround;K.around=Q?this._map.unproject(Q):this._map.getCenter()}return this.clear(),h.extend(K,{noMoveStart:!0})}}function za($,y){(!$.duration||$.duration<y.duration)&&($.duration=y.duration,$.easing=y.easing)}function Na($,y,L){const{maxSpeed:G,linearity:K,deceleration:Q}=L,se=h.clamp($*K/(y/1e3),-G,G),ge=Math.abs(se)/(Q*K);return{easing:L.easing,duration:1e3*ge,amount:se*(ge/2)}}class Ur extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,L,G,K={}){const Q=P.mousePos(L.getCanvasContainer(),G),se=L.unproject(Q);super(y,h.extend({point:Q,lngLat:se,originalEvent:G},K)),this._defaultPrevented=!1,this.target=L}}class Ua extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,L,G){const K=y==="touchend"?G.changedTouches:G.touches,Q=P.touchPos(L.getCanvasContainer(),K),se=Q.map(Ce=>L.unproject(Ce)),ge=Q.reduce((Ce,Oe,Fe,Ue)=>Ce.add(Oe.div(Ue.length)),new h.pointGeometry(0,0));super(y,{points:Q,point:ge,lngLats:se,lngLat:L.unproject(ge),originalEvent:G}),this._defaultPrevented=!1}}class fa extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,L,G){super(y,{originalEvent:G}),this._defaultPrevented=!1}}class Ll{constructor(y,L){this._map=y,this._clickTolerance=L.clickTolerance}reset(){delete this._mousedownPos}wheel(y){return this._firePreventable(new fa(y.type,this._map,y))}mousedown(y,L){return this._mousedownPos=L,this._firePreventable(new Ur(y.type,this._map,y))}mouseup(y){this._map.fire(new Ur(y.type,this._map,y))}preclick(y){const L=h.extend({},y);L.type="preclick",this._map.fire(new Ur(L.type,this._map,L))}click(y,L){this._mousedownPos&&this._mousedownPos.dist(L)>=this._clickTolerance||(this.preclick(y),this._map.fire(new Ur(y.type,this._map,y)))}dblclick(y){return this._firePreventable(new Ur(y.type,this._map,y))}mouseover(y){this._map.fire(new Ur(y.type,this._map,y))}mouseout(y){this._map.fire(new Ur(y.type,this._map,y))}touchstart(y){return this._firePreventable(new Ua(y.type,this._map,y))}touchmove(y){this._map.fire(new Ua(y.type,this._map,y))}touchend(y){this._map.fire(new Ua(y.type,this._map,y))}touchcancel(y){this._map.fire(new Ua(y.type,this._map,y))}_firePreventable(y){if(this._map.fire(y),y.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bl{constructor(y){this._map=y}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(y){this._map.fire(new Ur(y.type,this._map,y))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(y){this._delayContextMenu?this._contextMenuEvent=y:this._map.fire(new Ur(y.type,this._map,y)),this._map.listens("contextmenu")&&y.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ol{constructor(y,L){this._map=y,this._el=y.getCanvasContainer(),this._container=y.getContainer(),this._clickTolerance=L.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(y,L){this.isEnabled()&&y.shiftKey&&y.button===0&&(P.disableDrag(),this._startPos=this._lastPos=L,this._active=!0)}mousemoveWindow(y,L){if(!this._active)return;const G=L;if(this._lastPos.equals(G)||!this._box&&G.dist(this._startPos)<this._clickTolerance)return;const K=this._startPos;this._lastPos=G,this._box||(this._box=P.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",y));const Q=Math.min(K.x,G.x),se=Math.max(K.x,G.x),ge=Math.min(K.y,G.y),Ce=Math.max(K.y,G.y);this._map._requestDomTask(()=>{this._box&&(P.setTransform(this._box,`translate(${Q}px,${ge}px)`),this._box.style.width=se-Q+"px",this._box.style.height=Ce-ge+"px")})}mouseupWindow(y,L){if(!this._active||y.button!==0)return;const G=this._startPos,K=L;if(this.reset(),P.suppressClick(),G.x!==K.x||G.y!==K.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:y})),{cameraAnimation:Q=>Q.fitScreenCoordinates(G,K,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",y)}keydown(y){this._active&&y.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",y))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(y,L){return this._map.fire(new h.Event(y,{originalEvent:L}))}}function Bo($,y){const L={};for(let G=0;G<$.length;G++)L[$[G].identifier]=y[G];return L}class Fl{constructor(y){this.reset(),this.numTouches=y.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(y,L,G){(this.centroid||G.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=y.timeStamp),G.length===this.numTouches&&(this.centroid=function(K){const Q=new h.pointGeometry(0,0);for(const se of K)Q._add(se);return Q.div(K.length)}(L),this.touches=Bo(G,L)))}touchmove(y,L,G){if(this.aborted||!this.centroid)return;const K=Bo(G,L);for(const Q in this.touches){const se=this.touches[Q],ge=K[Q];(!ge||ge.dist(se)>30)&&(this.aborted=!0)}}touchend(y,L,G){if((!this.centroid||y.timeStamp-this.startTime>500)&&(this.aborted=!0),G.length===0){const K=!this.aborted&&this.centroid;if(this.reset(),K)return K}}}class Oo{constructor(y){this.singleTap=new Fl(y),this.numTaps=y.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(y,L,G){this.singleTap.touchstart(y,L,G)}touchmove(y,L,G){this.singleTap.touchmove(y,L,G)}touchend(y,L,G){const K=this.singleTap.touchend(y,L,G);if(K){const Q=y.timeStamp-this.lastTime<500,se=!this.lastTap||this.lastTap.dist(K)<30;if(Q&&se||this.reset(),this.count++,this.lastTime=y.timeStamp,this.lastTap=K,this.count===this.numTaps)return this.reset(),K}}}class Rr{constructor(){this._zoomIn=new Oo({numTouches:1,numTaps:2}),this._zoomOut=new Oo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(y,L,G){this._zoomIn.touchstart(y,L,G),this._zoomOut.touchstart(y,L,G)}touchmove(y,L,G){this._zoomIn.touchmove(y,L,G),this._zoomOut.touchmove(y,L,G)}touchend(y,L,G){const K=this._zoomIn.touchend(y,L,G),Q=this._zoomOut.touchend(y,L,G);return K?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:se=>se.easeTo({duration:300,zoom:se.getZoom()+1,around:se.unproject(K)},{originalEvent:y})}):Q?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:se=>se.easeTo({duration:300,zoom:se.getZoom()-1,around:se.unproject(Q)},{originalEvent:y})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qh={0:1,2:2};class an{constructor(y){this.reset(),this._clickTolerance=y.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(y,L){return!1}_move(y,L){return{}}mousedown(y,L){if(this._lastPoint)return;const G=P.mouseButton(y);this._correctButton(y,G)&&(this._lastPoint=L,this._eventButton=G)}mousemoveWindow(y,L){const G=this._lastPoint;if(G){if(y.preventDefault(),function(K,Q){const se=qh[Q];return K.buttons===void 0||(K.buttons&se)!==se}(y,this._eventButton))this.reset();else if(this._moved||!(L.dist(G)<this._clickTolerance))return this._moved=!0,this._lastPoint=L,this._move(G,L)}}mouseupWindow(y){this._lastPoint&&P.mouseButton(y)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zl extends an{mousedown(y,L){super.mousedown(y,L),this._lastPoint&&(this._active=!0)}_correctButton(y,L){return L===0&&!y.ctrlKey}_move(y,L){return{around:L,panDelta:L.sub(y)}}}class mn extends an{_correctButton(y,L){return L===0&&y.ctrlKey||L===2}_move(y,L){const G=.8*(L.x-y.x);if(G)return this._active=!0,{bearingDelta:G}}contextmenu(y){y.preventDefault()}}class Wn extends an{_correctButton(y,L){return L===0&&y.ctrlKey||L===2}_move(y,L){const G=-.5*(L.y-y.y);if(G)return this._active=!0,{pitchDelta:G}}contextmenu(y){y.preventDefault()}}class Xh{constructor(y,L){this._map=y,this._el=y.getCanvasContainer(),this._minTouches=1,this._clickTolerance=L.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(y,L,G){return this._calculateTransform(y,L,G)}touchmove(y,L,G){if(this._active&&!(G.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(G.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return y.preventDefault(),this._calculateTransform(y,L,G)}}touchend(y,L,G){this._calculateTransform(y,L,G),this._active&&G.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(y,L,G){G.length>0&&(this._active=!0);const K=Bo(G,L),Q=new h.pointGeometry(0,0),se=new h.pointGeometry(0,0);let ge=0;for(const Oe in K){const Fe=K[Oe],Ue=this._touches[Oe];Ue&&(Q._add(Fe),se._add(Fe.sub(Ue)),ge++,K[Oe]=Fe)}if(this._touches=K,ge<this._minTouches||!se.mag())return;const Ce=se.div(ge);return this._sum._add(Ce),this._sum.mag()<this._clickTolerance?void 0:{around:Q.div(ge),panDelta:Ce}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ps{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(y){}_move(y,L,G){return{}}touchstart(y,L,G){this._firstTwoTouches||G.length<2||(this._firstTwoTouches=[G[0].identifier,G[1].identifier],this._start([L[0],L[1]]))}touchmove(y,L,G){if(!this._firstTwoTouches)return;y.preventDefault();const[K,Q]=this._firstTwoTouches,se=Fo(G,L,K),ge=Fo(G,L,Q);if(!se||!ge)return;const Ce=this._aroundCenter?null:se.add(ge).div(2);return this._move([se,ge],Ce,y)}touchend(y,L,G){if(!this._firstTwoTouches)return;const[K,Q]=this._firstTwoTouches,se=Fo(G,L,K),ge=Fo(G,L,Q);se&&ge||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(y){this._enabled=!0,this._aroundCenter=!!y&&y.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fo($,y,L){for(let G=0;G<$.length;G++)if($[G].identifier===L)return y[G]}function Nl($,y){return Math.log($/y)/Math.LN2}class Ul extends Ps{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(y){this._startDistance=this._distance=y[0].dist(y[1])}_move(y,L){const G=this._distance;if(this._distance=y[0].dist(y[1]),this._active||!(Math.abs(Nl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nl(this._distance,G),pinchAround:L}}}function da($,y){return 180*$.angleWith(y)/Math.PI}class cn extends Ps{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(y){this._startVector=this._vector=y[0].sub(y[1]),this._minDiameter=y[0].dist(y[1])}_move(y,L){const G=this._vector;if(this._vector=y[0].sub(y[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:da(this._vector,G),pinchAround:L}}_isBelowThreshold(y){this._minDiameter=Math.min(this._minDiameter,y.mag());const L=25/(Math.PI*this._minDiameter)*360,G=da(y,this._startVector);return Math.abs(G)<L}}function zo($){return Math.abs($.y)>Math.abs($.x)}class $l extends Ps{constructor(y){super(),this._map=y}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(y){this._lastPoints=y,zo(y[0].sub(y[1]))&&(this._valid=!1)}_move(y,L,G){const K=y[0].sub(this._lastPoints[0]),Q=y[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&G.touches.length<3)&&(this._valid=this.gestureBeginsVertically(K,Q,G.timeStamp),this._valid))return this._lastPoints=y,this._active=!0,{pitchDelta:(K.y+Q.y)/2*-.5}}gestureBeginsVertically(y,L,G){if(this._valid!==void 0)return this._valid;const K=y.mag()>=2,Q=L.mag()>=2;if(!K&&!Q)return;if(!K||!Q)return this._firstMove===void 0&&(this._firstMove=G),G-this._firstMove<100&&void 0;const se=y.y>0==L.y>0;return zo(y)&&zo(L)&&se}}const $a={panStep:100,bearingStep:15,pitchStep:10};class wi{constructor(){const y=$a;this._panStep=y.panStep,this._bearingStep=y.bearingStep,this._pitchStep=y.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(y){if(y.altKey||y.ctrlKey||y.metaKey)return;let L=0,G=0,K=0,Q=0,se=0;switch(y.keyCode){case 61:case 107:case 171:case 187:L=1;break;case 189:case 109:case 173:L=-1;break;case 37:y.shiftKey?G=-1:(y.preventDefault(),Q=-1);break;case 39:y.shiftKey?G=1:(y.preventDefault(),Q=1);break;case 38:y.shiftKey?K=1:(y.preventDefault(),se=-1);break;case 40:y.shiftKey?K=-1:(y.preventDefault(),se=1);break;default:return}return this._rotationDisabled&&(G=0,K=0),{cameraAnimation:ge=>{const Ce=ge.getZoom();ge.easeTo({duration:300,easeId:"keyboardHandler",easing:jl,zoom:L?Math.round(Ce)+L*(y.shiftKey?2:1):Ce,bearing:ge.getBearing()+G*this._bearingStep,pitch:ge.getPitch()+K*this._pitchStep,offset:[-Q*this._panStep,-se*this._panStep],center:ge.getCenter()},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jl($){return $*(2-$)}const Ls=4.000244140625;class ja{constructor(y,L){this._map=y,this._el=y.getCanvasContainer(),this._handler=L,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(y){this._defaultZoomRate=y}setWheelZoomRate(y){this._wheelZoomRate=y}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(y){this.isEnabled()||(this._enabled=!0,this._aroundCenter=y&&y.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(y){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(y.ctrlKey||y.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let L=y.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*y.deltaY:y.deltaY;const G=h.exported.now(),K=G-(this._lastWheelEventTime||0);this._lastWheelEventTime=G,L!==0&&L%Ls==0?this._type="wheel":L!==0&&Math.abs(L)<4?this._type="trackpad":K>400?(this._type=null,this._lastValue=L,this._timeout=setTimeout(this._onTimeout,40,y)):this._type||(this._type=Math.abs(K*L)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,L+=this._lastValue)),y.shiftKey&&L&&(L/=4),this._type&&(this._lastWheelEvent=y,this._delta-=L,this._active||this._start(y)),y.preventDefault()}_onTimeout(y){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)}_start(y){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const L=P.mousePos(this._el,y);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:L,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const y=this._map.transform,L=()=>y._terrainEnabled()?y.computeZoomRelativeTo(this._aroundCoord):y.zoom;if(this._delta!==0){const Ce=this._type==="wheel"&&Math.abs(this._delta)>Ls?this._wheelZoomRate:this._defaultZoomRate;let Oe=2/(1+Math.exp(-Math.abs(this._delta*Ce)));this._delta<0&&Oe!==0&&(Oe=1/Oe);const Fe=L(),Ue=Math.pow(2,Fe),Qe=typeof this._targetZoom=="number"?y.zoomScale(this._targetZoom):Ue;this._targetZoom=Math.min(y.maxZoom,Math.max(y.minZoom,y.scaleZoom(Qe*Oe))),this._type==="wheel"&&(this._startZoom=L(),this._easing=this._smoothOutEasing(200)),this._delta=0}const G=typeof this._targetZoom=="number"?this._targetZoom:L(),K=this._startZoom,Q=this._easing;let se,ge=!1;if(this._type==="wheel"&&K&&Q){const Ce=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),Oe=Q(Ce);se=h.number(K,G,Oe),Ce<1?this._frameId||(this._frameId=!0):ge=!0}else se=G,ge=!0;return this._active=!0,ge&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ge,zoomDelta:se-L(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(y){let L=h.ease;if(this._prevEase){const G=this._prevEase,K=(h.exported.now()-G.start)/G.duration,Q=G.easing(K+.01)-G.easing(K),se=.27/Math.sqrt(Q*Q+1e-4)*.01,ge=Math.sqrt(.0729-se*se);L=h.bezier(se,ge,.25,1)}return this._prevEase={start:h.exported.now(),duration:y,easing:L},L}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!h.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ga{constructor(y,L){this._clickZoom=y,this._tapZoom=L}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(y,L){return y.preventDefault(),{cameraAnimation:G=>{G.easeTo({duration:300,zoom:G.getZoom()+(y.shiftKey?-1:1),around:G.unproject(L)},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vl{constructor(){this._tap=new Oo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(y,L,G){this._swipePoint||(this._tapTime&&y.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?G.length>0&&(this._swipePoint=L[0],this._swipeTouch=G[0].identifier):this._tap.touchstart(y,L,G))}touchmove(y,L,G){if(this._tapTime){if(this._swipePoint){if(G[0].identifier!==this._swipeTouch)return;const K=L[0],Q=K.y-this._swipePoint.y;return this._swipePoint=K,y.preventDefault(),this._active=!0,{zoomDelta:Q/128}}}else this._tap.touchmove(y,L,G)}touchend(y,L,G){this._tapTime?this._swipePoint&&G.length===0&&this.reset():this._tap.touchend(y,L,G)&&(this._tapTime=y.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(y,L,G){this._el=y,this._mousePan=L,this._touchPan=G}enable(y){this._inertiaOptions=y||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hl{constructor(y,L,G){this._pitchWithRotate=y.pitchWithRotate,this._mouseRotate=L,this._mousePitch=G}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wl{constructor(y,L,G,K){this._el=y,this._touchZoom=L,this._touchRotate=G,this._tapDragZoom=K,this._rotationDisabled=!1,this._enabled=!0}enable(y){this._touchZoom.enable(y),this._rotationDisabled||this._touchRotate.enable(y),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Va=$=>$.zoom||$.drag||$.pitch||$.rotate;class ql extends h.Event{}class No{constructor(){this.constants=[1,1,.01],this.radius=0}setup(y,L){const G=h.sub([],L,y);this.radius=h.length(G[2]<0?h.div([],G,this.constants):[G[0],G[1],0])}projectRay(y){h.div(y,y,this.constants),h.normalize(y,y),h.mul$2(y,y,this.constants);const L=h.scale([],y,this.radius);if(L[2]>0){const G=h.scale([],[0,0,1],h.dot(L,[0,0,1])),K=h.scale([],h.normalize([],[L[0],L[1],0]),this.radius),Q=h.add([],L,h.scale([],h.sub([],h.add([],K,G),L),2));L[0]=Q[0],L[1]=Q[1]}return L}}function pa($){return $.panDelta&&$.panDelta.mag()||$.zoomDelta||$.bearingDelta||$.pitchDelta}class Uo{constructor(y,L){this._map=y,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pl(y),this._bearingSnap=L.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new No,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(L),h.bindAll(["handleEvent","handleWindowEvent"],this);const G=this._el;this._listeners=[[G,"touchstart",{passive:!0}],[G,"touchmove",{passive:!1}],[G,"touchend",void 0],[G,"touchcancel",void 0],[G,"mousedown",void 0],[G,"mousemove",void 0],[G,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[G,"mouseover",void 0],[G,"mouseout",void 0],[G,"dblclick",void 0],[G,"click",void 0],[G,"keydown",{capture:!1}],[G,"keyup",void 0],[G,"wheel",{passive:!1}],[G,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[K,Q,se]of this._listeners)P.addEventListener(K,Q,K===h.window.document?this.handleWindowEvent:this.handleEvent,se)}destroy(){for(const[y,L,G]of this._listeners)P.removeEventListener(y,L,y===h.window.document?this.handleWindowEvent:this.handleEvent,G)}_addDefaultHandlers(y){const L=this._map,G=L.getCanvasContainer();this._add("mapEvent",new Ll(L,y));const K=L.boxZoom=new Ol(L,y);this._add("boxZoom",K);const Q=new Rr,se=new Gl;L.doubleClickZoom=new Ga(se,Q),this._add("tapZoom",Q),this._add("clickZoom",se);const ge=new Vl;this._add("tapDragZoom",ge);const Ce=L.touchPitch=new $l(L);this._add("touchPitch",Ce);const Oe=new mn(y),Fe=new Wn(y);L.dragRotate=new Hl(y,Oe,Fe),this._add("mouseRotate",Oe,["mousePitch"]),this._add("mousePitch",Fe,["mouseRotate"]);const Ue=new zl(y),Qe=new Xh(L,y);L.dragPan=new Zl(G,Ue,Qe),this._add("mousePan",Ue),this._add("touchPan",Qe,["touchZoom","touchRotate"]);const ht=new cn,ct=new Ul;L.touchZoomRotate=new Wl(G,ct,ht,ge),this._add("touchRotate",ht,["touchPan","touchZoom"]),this._add("touchZoom",ct,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bl(L));const at=L.scrollZoom=new ja(L,this);this._add("scrollZoom",at,["mousePan"]);const mt=L.keyboard=new wi;this._add("keyboard",mt);for(const st of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])y.interactive&&y[st]&&L[st].enable(y[st])}_add(y,L,G){this._handlers.push({handlerName:y,handler:L,allowed:G}),this._handlersById[y]=L}stop(y){if(!this._updatingCamera){for(const{handler:L}of this._handlers)L.reset();this._inertia.clear(),this._fireEvents({},{},y),this._changes=[]}}isActive(){for(const{handler:y}of this._handlers)if(y.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Va(this._eventsInProgress))||this.isZooming()}_blockedByActive(y,L,G){for(const K in y)if(K!==G&&(!L||L.indexOf(K)<0))return!0;return!1}handleWindowEvent(y){this.handleEvent(y,`${y.type}Window`)}_getMapTouches(y){const L=[];for(const G of y)this._el.contains(G.target)&&L.push(G);return L}handleEvent(y,L){this._updatingCamera=!0;const G=y.type==="renderFrame",K=G?void 0:y,Q={needsRenderFrame:!1},se={},ge={},Ce=y.touches?this._getMapTouches(y.touches):void 0,Oe=Ce?P.touchPos(this._el,Ce):G?void 0:P.mousePos(this._el,y);for(const{handlerName:Qe,handler:ht,allowed:ct}of this._handlers){if(!ht.isEnabled())continue;let at;this._blockedByActive(ge,ct,Qe)?ht.reset():ht[L||y.type]&&(at=ht[L||y.type](y,Oe,Ce),this.mergeHandlerResult(Q,se,at,Qe,K),at&&at.needsRenderFrame&&this._triggerRenderFrame()),(at||ht.isActive())&&(ge[Qe]=ht)}const Fe={};for(const Qe in this._previousActiveHandlers)ge[Qe]||(Fe[Qe]=K);this._previousActiveHandlers=ge,(Object.keys(Fe).length||pa(Q))&&(this._changes.push([Q,se,Fe]),this._triggerRenderFrame()),(Object.keys(ge).length||pa(Q))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ue}=Q;Ue&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ue(this._map))}mergeHandlerResult(y,L,G,K,Q){if(!G)return;h.extend(y,G);const se={handlerName:K,originalEvent:G.originalEvent||Q};G.zoomDelta!==void 0&&(L.zoom=se),G.panDelta!==void 0&&(L.drag=se),G.pitchDelta!==void 0&&(L.pitch=se),G.bearingDelta!==void 0&&(L.rotate=se)}_applyChanges(){const y={},L={},G={};for(const[K,Q,se]of this._changes)K.panDelta&&(y.panDelta=(y.panDelta||new h.pointGeometry(0,0))._add(K.panDelta)),K.zoomDelta&&(y.zoomDelta=(y.zoomDelta||0)+K.zoomDelta),K.bearingDelta&&(y.bearingDelta=(y.bearingDelta||0)+K.bearingDelta),K.pitchDelta&&(y.pitchDelta=(y.pitchDelta||0)+K.pitchDelta),K.around!==void 0&&(y.around=K.around),K.aroundCoord!==void 0&&(y.aroundCoord=K.aroundCoord),K.pinchAround!==void 0&&(y.pinchAround=K.pinchAround),K.noInertia&&(y.noInertia=K.noInertia),h.extend(L,Q),h.extend(G,se);this._updateMapTransform(y,L,G),this._changes=[]}_updateMapTransform(y,L,G){const K=this._map,Q=K.transform,se=gt=>[gt.x,gt.y,gt.z];if((gt=>{const xt=this._eventsInProgress.drag;return xt&&!this._handlersById[xt.handlerName].isActive()})()&&!pa(y)){const gt=Q.zoom;Q.cameraElevationReference="sea",Q.recenterOnTerrain(),Q.cameraElevationReference="ground",gt!==Q.zoom&&this._map._update(!0)}if(!pa(y))return this._fireEvents(L,G,!0);let{panDelta:ge,zoomDelta:Ce,bearingDelta:Oe,pitchDelta:Fe,around:Ue,aroundCoord:Qe,pinchAround:ht}=y;ht!==void 0&&(Ue=ht),(gt=>L.drag&&!this._eventsInProgress.drag)()&&Ue&&(this._dragOrigin=se(Q.pointCoordinate3D(Ue)),this._trackingEllipsoid.setup(Q._camera.position,this._dragOrigin)),Q.cameraElevationReference="sea",K._stop(!0),Ue=Ue||K.transform.centerPoint,Oe&&(Q.bearing+=Oe),Fe&&(Q.pitch+=Fe),Q._updateCameraState();const ct=[0,0,0];if(ge){const gt=Q.screenPointToMercatorRay(Ue),xt=Q.screenPointToMercatorRay(Ue.sub(ge)),ut=this._trackingEllipsoid.projectRay(gt.dir),Et=this._trackingEllipsoid.projectRay(xt.dir);ct[0]=Et[0]-ut[0],ct[1]=Et[1]-ut[1]}const at=Q.zoom,mt=[0,0,0];if(Ce){const gt=se(Qe||Q.pointCoordinate3D(Ue)),xt={dir:h.normalize([],h.sub([],gt,Q._camera.position))},ut=Q.screenPointToMercatorRay(Q.centerPoint);if(xt.dir[2]<0){const Et=h.altitudeFromMercatorZ(gt[2],gt[1]),kt=Q.rayIntersectionCoordinate(Q.pointRayIntersection(Q.centerPoint,Et)),Wt=Q.zoomDeltaToMovement(se(kt),Ce)*(ut.dir[2]/xt.dir[2]);h.scale(mt,xt.dir,Wt)}else if(Q._terrainEnabled()){const Et=Q.zoomDeltaToMovement(gt,Ce);h.scale(mt,xt.dir,Et)}}const st=h.add(ct,ct,mt);Q._translateCameraConstrained(st),Ce&&Math.abs(Q.zoom-at)>1e-4&&Q.recenterOnTerrain(),Q.cameraElevationReference="ground",this._map._update(),y.noInertia||this._inertia.record(y),this._fireEvents(L,G,!0)}_fireEvents(y,L,G){const K=Va(this._eventsInProgress),Q=Va(y),se={};for(const Fe in y){const{originalEvent:Ue}=y[Fe];this._eventsInProgress[Fe]||(se[`${Fe}start`]=Ue),this._eventsInProgress[Fe]=y[Fe]}!K&&Q&&this._fireEvent("movestart",Q.originalEvent);for(const Fe in se)this._fireEvent(Fe,se[Fe]);Q&&this._fireEvent("move",Q.originalEvent);for(const Fe in y){const{originalEvent:Ue}=y[Fe];this._fireEvent(Fe,Ue)}const ge={};let Ce;for(const Fe in this._eventsInProgress){const{handlerName:Ue,originalEvent:Qe}=this._eventsInProgress[Fe];this._handlersById[Ue].isActive()||(delete this._eventsInProgress[Fe],Ce=L[Ue]||Qe,ge[`${Fe}end`]=Ce)}for(const Fe in ge)this._fireEvent(Fe,ge[Fe]);const Oe=Va(this._eventsInProgress);if(G&&(K||Q)&&!Oe){this._updatingCamera=!0;const Fe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ue=Qe=>Qe!==0&&-this._bearingSnap<Qe&&Qe<this._bearingSnap;Fe?(Ue(Fe.bearing||this._map.getBearing())&&(Fe.bearing=0),this._map.easeTo(Fe,{originalEvent:Ce})):(this._map.fire(new h.Event("moveend",{originalEvent:Ce})),Ue(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(y,L){this._map.fire(new h.Event(y,L?{originalEvent:L}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(y=>{delete this._frameId,this.handleEvent(new ql("renderFrame",{timeStamp:y})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xl extends h.Evented{constructor(y,L){super(),this._moving=!1,this._zooming=!1,this.transform=y,this._bearingSnap=L.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(y,L){return this.jumpTo({center:y},L)}panBy(y,L,G){return y=h.pointGeometry.convert(y).mult(-1),this.panTo(this.transform.center,h.extend({offset:y},L),G)}panTo(y,L,G){return this.easeTo(h.extend({center:y},L),G)}getZoom(){return this.transform.zoom}setZoom(y,L){return this.jumpTo({zoom:y},L),this}zoomTo(y,L,G){return this.easeTo(h.extend({zoom:y},L),G)}zoomIn(y,L){return this.zoomTo(this.getZoom()+1,y,L),this}zoomOut(y,L){return this.zoomTo(this.getZoom()-1,y,L),this}getBearing(){return this.transform.bearing}setBearing(y,L){return this.jumpTo({bearing:y},L),this}getPadding(){return this.transform.padding}setPadding(y,L){return this.jumpTo({padding:y},L),this}rotateTo(y,L,G){return this.easeTo(h.extend({bearing:y},L),G)}resetNorth(y,L){return this.rotateTo(0,h.extend({duration:1e3},y),L),this}resetNorthPitch(y,L){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},y),L),this}snapToNorth(y,L){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(y,L):this}getPitch(){return this.transform.pitch}setPitch(y,L){return this.jumpTo({pitch:y},L),this}cameraForBounds(y,L){y=h.LngLatBounds.convert(y);const G=L&&L.bearing||0;return this._cameraForBoxAndBearing(y.getNorthWest(),y.getSouthEast(),G,L)}_extendCameraOptions(y){const L={top:0,bottom:0,right:0,left:0};if(typeof(y=h.extend({padding:L,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const G=y.padding;y.padding={top:G,bottom:G,right:G,left:G}}return y.padding=h.extend(L,y.padding),y}_cameraForBoxAndBearing(y,L,G,K){const Q=this._extendCameraOptions(K),se=this.transform,ge=se.padding,Ce=se.project(h.LngLat.convert(y)),Oe=se.project(h.LngLat.convert(L)),Fe=Ce.rotate(-h.degToRad(G)),Ue=Oe.rotate(-h.degToRad(G)),Qe=new h.pointGeometry(Math.max(Fe.x,Ue.x),Math.max(Fe.y,Ue.y)),ht=new h.pointGeometry(Math.min(Fe.x,Ue.x),Math.min(Fe.y,Ue.y)),ct=Qe.sub(ht),at=(se.width-(ge.left+ge.right+Q.padding.left+Q.padding.right))/ct.x,mt=(se.height-(ge.top+ge.bottom+Q.padding.top+Q.padding.bottom))/ct.y;if(mt<0||at<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const st=Math.min(se.scaleZoom(se.scale*Math.min(at,mt)),Q.maxZoom),gt=typeof Q.offset.x=="number"?new h.pointGeometry(Q.offset.x,Q.offset.y):h.pointGeometry.convert(Q.offset),xt=new h.pointGeometry((Q.padding.left-Q.padding.right)/2,(Q.padding.top-Q.padding.bottom)/2).rotate(G*Math.PI/180),ut=gt.add(xt).mult(se.scale/se.zoomScale(st));return{center:se.unproject(Ce.add(Oe).div(2).sub(ut)),zoom:st,bearing:G}}_cameraForBox(y,L,G,K,Q){const se=this._extendCameraOptions(Q);G=G||0,K=K||0,y=h.LngLat.convert(y),L=h.LngLat.convert(L);const ge=this.transform.clone();ge.padding=se.padding;const Ce=this.getFreeCameraOptions(),Oe=new h.LngLat(.5*(y.lng+L.lng),.5*(y.lat+L.lat)),Fe=.5*(G+K);if(ge._camera.position[2]<h.mercatorZfromAltitude(Fe,Oe.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ce.lookAtPoint(Oe),ge.setFreeCameraOptions(Ce);const Ue=h.MercatorCoordinate.fromLngLat(y),Qe=h.MercatorCoordinate.fromLngLat(L),ht=ge.pointRayIntersection(ge.centerPoint,Fe),ct=[(at=ge.rayIntersectionCoordinate(ht)).x,at.y,at.z];var at;const mt=ge.screenPointToMercatorRay(ge.centerPoint);let st,gt=0;do{const xt=Math.floor(ge.zoom),ut=1<<xt,Et=Math.min(ut*Ue.x,ut*Qe.x),kt=Math.min(ut*Ue.y,ut*Qe.y),Wt=Math.max(ut*Ue.x,ut*Qe.x),Zt=Math.max(ut*Ue.y,ut*Qe.y),Jt=new W([Et,kt,G],[Wt,Zt,K]),Qt=Z.fromInvProjectionMatrix(ge.invProjMatrix,ge.worldSize,xt);if(Jt.intersects(Qt)!==2){st&&(ge._camera.position=h.scaleAndAdd([],ge._camera.position,mt.dir,-st),ge._updateStateFromCamera());break}const ci=h.sub([],ge._camera.position,ct);st=.5*h.length(ci),ge._camera.position=h.scaleAndAdd([],ge._camera.position,mt.dir,st);try{ge._updateStateFromCamera()}catch{return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++gt<10);return{center:ge.center,zoom:ge.zoom,bearing:ge.bearing,pitch:ge.pitch}}fitBounds(y,L,G){return this._fitInternal(this.cameraForBounds(y,L),L,G)}_raycastElevationBox(y,L){const G=this.transform.elevation;if(!G)return;const K=new h.pointGeometry(y.x,L.y),Q=new h.pointGeometry(L.x,y.y),se=G.pointCoordinate(y);if(!se)return;const ge=G.pointCoordinate(L);if(!ge)return;const Ce=G.pointCoordinate(K);if(!Ce)return;const Oe=G.pointCoordinate(Q);if(!Oe)return;const Fe=new h.MercatorCoordinate(se[0],se[1]).toLngLat(),Ue=new h.MercatorCoordinate(ge[0],ge[1]).toLngLat(),Qe=new h.MercatorCoordinate(Ce[0],Ce[1]).toLngLat(),ht=new h.MercatorCoordinate(Oe[0],Oe[1]).toLngLat(),ct=Math.min(Fe.lng,Math.min(Ue.lng,Math.min(Qe.lng,ht.lng))),at=Math.min(Fe.lat,Math.min(Ue.lat,Math.min(Qe.lat,ht.lat))),mt=Math.max(Fe.lng,Math.max(Ue.lng,Math.max(Qe.lng,ht.lng))),st=Math.max(Fe.lat,Math.max(Ue.lat,Math.max(Qe.lat,ht.lat))),gt=Math.min(se[3],Math.min(ge[3],Math.min(Ce[3],Oe[3]))),xt=Math.max(se[3],Math.max(ge[3],Math.max(Ce[3],Oe[3])));return{minLngLat:new h.LngLat(ct,at),maxLngLat:new h.LngLat(mt,st),minAltitude:gt,maxAltitude:xt}}fitScreenCoordinates(y,L,G,K,Q){let se,ge,Ce,Oe;const Fe=h.pointGeometry.convert(y),Ue=h.pointGeometry.convert(L),Qe=this._raycastElevationBox(Fe,Ue);if(Qe)se=Qe.minLngLat,ge=Qe.maxLngLat,Ce=Qe.minAltitude,Oe=Qe.maxAltitude;else{if(this.transform.anyCornerOffEdge(Fe,Ue))return this;se=this.transform.pointLocation(Fe),ge=this.transform.pointLocation(Ue)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(y)),this.transform.pointLocation(h.pointGeometry.convert(L)),G,K):this._cameraForBox(se,ge,Ce,Oe,K),K,Q)}_fitInternal(y,L,G){return y?(delete(L=h.extend(y,L)).padding,L.linear?this.easeTo(L,G):this.flyTo(L,G)):this}jumpTo(y,L){this.stop();const G=this.transform;let K=!1,Q=!1,se=!1;return"zoom"in y&&G.zoom!==+y.zoom&&(K=!0,G.zoom=+y.zoom),y.center!==void 0&&(G.center=h.LngLat.convert(y.center)),"bearing"in y&&G.bearing!==+y.bearing&&(Q=!0,G.bearing=+y.bearing),"pitch"in y&&G.pitch!==+y.pitch&&(se=!0,G.pitch=+y.pitch),y.padding==null||G.isPaddingEqual(y.padding)||(G.padding=y.padding),this.fire(new h.Event("movestart",L)).fire(new h.Event("move",L)),K&&this.fire(new h.Event("zoomstart",L)).fire(new h.Event("zoom",L)).fire(new h.Event("zoomend",L)),Q&&this.fire(new h.Event("rotatestart",L)).fire(new h.Event("rotate",L)).fire(new h.Event("rotateend",L)),se&&this.fire(new h.Event("pitchstart",L)).fire(new h.Event("pitch",L)).fire(new h.Event("pitchend",L)),this.fire(new h.Event("moveend",L))}getFreeCameraOptions(){return this.transform.projection.name!=="mercator"&&h.warnOnce(Bs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(y,L){const G=this.transform;if(G.projection.name!=="mercator")return void h.warnOnce(Bs);this.stop();const K=G.zoom,Q=G.pitch,se=G.bearing;G.setFreeCameraOptions(y);const ge=K!==G.zoom,Ce=Q!==G.pitch,Oe=se!==G.bearing;return this.fire(new h.Event("movestart",L)).fire(new h.Event("move",L)),ge&&this.fire(new h.Event("zoomstart",L)).fire(new h.Event("zoom",L)).fire(new h.Event("zoomend",L)),Oe&&this.fire(new h.Event("rotatestart",L)).fire(new h.Event("rotate",L)).fire(new h.Event("rotateend",L)),Ce&&this.fire(new h.Event("pitchstart",L)).fire(new h.Event("pitch",L)).fire(new h.Event("pitchend",L)),this.fire(new h.Event("moveend",L)),this}easeTo(y,L){this._stop(!1,y.easeId),((y=h.extend({offset:[0,0],duration:500,easing:h.ease},y)).animate===!1||!y.essential&&h.exported.prefersReducedMotion)&&(y.duration=0);const G=this.transform,K=this.getZoom(),Q=this.getBearing(),se=this.getPitch(),ge=this.getPadding(),Ce="zoom"in y?+y.zoom:K,Oe="bearing"in y?this._normalizeBearing(y.bearing,Q):Q,Fe="pitch"in y?+y.pitch:se,Ue="padding"in y?y.padding:G.padding,Qe=h.pointGeometry.convert(y.offset);let ht=G.centerPoint.add(Qe);const ct=G.pointLocation(ht),at=h.LngLat.convert(y.center||ct);this._normalizeCenter(at);const mt=G.project(ct),st=G.project(at).sub(mt),gt=G.zoomScale(Ce-K);let xt,ut;y.around&&(xt=h.LngLat.convert(y.around),ut=G.locationPoint(xt));const Et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==K,this._rotating=this._rotating||Q!==Oe,this._pitching=this._pitching||Fe!==se,this._padding=!G.isPaddingEqual(Ue),this._easeId=y.easeId,this._prepareEase(L,y.noMoveStart,Et),this._ease(kt=>{if(this._zooming&&(G.zoom=h.number(K,Ce,kt)),this._rotating&&(G.bearing=h.number(Q,Oe,kt)),this._pitching&&(G.pitch=h.number(se,Fe,kt)),this._padding&&(G.interpolatePadding(ge,Ue,kt),ht=G.centerPoint.add(Qe)),xt)G.setLocationAtPoint(xt,ut);else{const Wt=G.zoomScale(G.zoom-K),Zt=Ce>K?Math.min(2,gt):Math.max(.5,gt),Jt=Math.pow(Zt,1-kt),Qt=G.unproject(mt.add(st.mult(kt*Jt)).mult(Wt));G.setLocationAtPoint(G.renderWorldCopies?Qt.wrap():Qt,ht)}this._fireMoveEvents(L)},kt=>{G.recenterOnTerrain(),this._afterEase(L,kt)},y),this}_prepareEase(y,L,G={}){this._moving=!0,this.transform.cameraElevationReference="sea",L||G.moving||this.fire(new h.Event("movestart",y)),this._zooming&&!G.zooming&&this.fire(new h.Event("zoomstart",y)),this._rotating&&!G.rotating&&this.fire(new h.Event("rotatestart",y)),this._pitching&&!G.pitching&&this.fire(new h.Event("pitchstart",y))}_fireMoveEvents(y){this.fire(new h.Event("move",y)),this._zooming&&this.fire(new h.Event("zoom",y)),this._rotating&&this.fire(new h.Event("rotate",y)),this._pitching&&this.fire(new h.Event("pitch",y))}_afterEase(y,L){if(this._easeId&&L&&this._easeId===L)return;delete this._easeId,this.transform.cameraElevationReference="ground";const G=this._zooming,K=this._rotating,Q=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,G&&this.fire(new h.Event("zoomend",y)),K&&this.fire(new h.Event("rotateend",y)),Q&&this.fire(new h.Event("pitchend",y)),this.fire(new h.Event("moveend",y))}flyTo(y,L){if(!y.essential&&h.exported.prefersReducedMotion){const pi=h.pick(y,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pi,L)}this.stop(),y=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},y);const G=this.transform,K=this.getZoom(),Q=this.getBearing(),se=this.getPitch(),ge=this.getPadding(),Ce="zoom"in y?h.clamp(+y.zoom,G.minZoom,G.maxZoom):K,Oe="bearing"in y?this._normalizeBearing(y.bearing,Q):Q,Fe="pitch"in y?+y.pitch:se,Ue="padding"in y?y.padding:G.padding,Qe=G.zoomScale(Ce-K),ht=h.pointGeometry.convert(y.offset);let ct=G.centerPoint.add(ht);const at=G.pointLocation(ct),mt=h.LngLat.convert(y.center||at);this._normalizeCenter(mt);const st=G.project(at),gt=G.project(mt).sub(st);let xt=y.curve;const ut=Math.max(G.width,G.height),Et=ut/Qe,kt=gt.mag();if("minZoom"in y){const pi=h.clamp(Math.min(y.minZoom,K,Ce),G.minZoom,G.maxZoom),Ei=ut/G.zoomScale(pi-K);xt=Math.sqrt(Ei/kt*2)}const Wt=xt*xt;function Zt(pi){const Ei=(Et*Et-ut*ut+(pi?-1:1)*Wt*Wt*kt*kt)/(2*(pi?Et:ut)*Wt*kt);return Math.log(Math.sqrt(Ei*Ei+1)-Ei)}function Jt(pi){return(Math.exp(pi)-Math.exp(-pi))/2}function Qt(pi){return(Math.exp(pi)+Math.exp(-pi))/2}const ci=Zt(0);let Kt=function(pi){return Qt(ci)/Qt(ci+xt*pi)},di=function(pi){return ut*((Qt(ci)*(Jt(Ei=ci+xt*pi)/Qt(Ei))-Jt(ci))/Wt)/kt;var Ei},Gt=(Zt(1)-ci)/xt;if(Math.abs(kt)<1e-6||!isFinite(Gt)){if(Math.abs(ut-Et)<1e-6)return this.easeTo(y,L);const pi=Et<ut?-1:1;Gt=Math.abs(Math.log(Et/ut))/xt,di=function(){return 0},Kt=function(Ei){return Math.exp(pi*xt*Ei)}}return y.duration="duration"in y?+y.duration:1e3*Gt/("screenSpeed"in y?+y.screenSpeed/xt:+y.speed),y.maxDuration&&y.duration>y.maxDuration&&(y.duration=0),this._zooming=!0,this._rotating=Q!==Oe,this._pitching=Fe!==se,this._padding=!G.isPaddingEqual(Ue),this._prepareEase(L,!1),this._ease(pi=>{const Ei=pi*Gt,Ai=1/Kt(Ei);G.zoom=pi===1?Ce:K+G.scaleZoom(Ai),this._rotating&&(G.bearing=h.number(Q,Oe,pi)),this._pitching&&(G.pitch=h.number(se,Fe,pi)),this._padding&&(G.interpolatePadding(ge,Ue,pi),ct=G.centerPoint.add(ht));const Ci=pi===1?mt:G.unproject(st.add(gt.mult(di(Ei))).mult(Ai));G.setLocationAtPoint(G.renderWorldCopies?Ci.wrap():Ci,ct),G._updateCenterElevation(),this._fireMoveEvents(L)},()=>this._afterEase(L),y),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(y,L){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const G=this._onEaseEnd;delete this._onEaseEnd,G.call(this,L)}if(!y){const G=this.handlers;G&&G.stop(!1)}return this}_ease(y,L,G){G.animate===!1||G.duration===0?(y(1),L()):(this._easeStart=h.exported.now(),this._easeOptions=G,this._onEaseFrame=y,this._onEaseEnd=L,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const y=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(y,L){y=h.wrap(y,-180,180);const G=Math.abs(y-L);return Math.abs(y-360-L)<G&&(y-=360),Math.abs(y+360-L)<G&&(y+=360),y}_normalizeCenter(y){const L=this.transform;if(!L.renderWorldCopies||L.maxBounds)return;const G=y.lng-L.center.lng;y.lng+=G>180?-360:G<-180?360:0}}class Os{constructor(y={}){this.options=y,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(y){const L=this.options&&this.options.compact;return this._map=y,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("button","mapboxgl-ctrl-attrib-button",this._container),P.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),L&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),L===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(y,L){const G=this._map._getUIString(`AttributionControl.${L}`);y.setAttribute("aria-label",G),y.firstElementChild&&y.firstElementChild.setAttribute("title",G)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let y=this._editLink;y||(y=this._editLink=this._container.querySelector(".mapbox-improve-map"));const L=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(y){const G=L.reduce((K,Q,se)=>(Q.value&&(K+=`${Q.key}=${Q.value}${se<L.length-1?"&":""}`),K),"?");y.href=`${h.config.FEEDBACK_URL}/${G}${this._map._hash?this._map._hash.getHashString(!0):""}`,y.rel="noopener nofollow",this._setElementTitle(y,"MapFeedback")}}_updateData(y){!y||y.sourceDataType!=="metadata"&&y.sourceDataType!=="visibility"&&y.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let y=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?y=y.concat(this.options.customAttribution.map(K=>typeof K!="string"?"":K)):typeof this.options.customAttribution=="string"&&y.push(this.options.customAttribution)),this._map.style.stylesheet){const K=this._map.style.stylesheet;this.styleOwner=K.owner,this.styleId=K.id}const L=this._map.style._sourceCaches;for(const K in L){const Q=L[K];if(Q.used){const se=Q.getSource();se.attribution&&y.indexOf(se.attribution)<0&&y.push(se.attribution)}}y.sort((K,Q)=>K.length-Q.length),y=y.filter((K,Q)=>{for(let se=Q+1;se<y.length;se++)if(y[se].indexOf(K)>=0)return!1;return!0});const G=y.join(" | ");G!==this._attribHTML&&(this._attribHTML=G,y.length?(this._innerContainer.innerHTML=G,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fs{constructor(){h.bindAll(["_updateLogo"],this),h.bindAll(["_updateCompact"],this)}onAdd(y){this._map=y,this._container=P.create("div","mapboxgl-ctrl");const L=P.create("a","mapboxgl-ctrl-logo");return L.target="_blank",L.rel="noopener nofollow",L.href="https://www.mapbox.com/",L.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),L.setAttribute("rel","noopener nofollow"),this._container.appendChild(L),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(y){y&&y.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const y=this._map.style._sourceCaches;if(Object.entries(y).length===0)return!0;for(const L in y){const G=y[L].getSource();if(G.hasOwnProperty("mapbox_logo")&&!G.mapbox_logo)return!1}return!0}_updateCompact(){const y=this._container.children;if(y.length){const L=y[0];this._map.getCanvasContainer().offsetWidth<250?L.classList.add("mapboxgl-compact"):L.classList.remove("mapboxgl-compact")}}}class zs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(y){const L=++this._id;return this._queue.push({callback:y,id:L,cancelled:!1}),L}remove(y){const L=this._currentlyRunning,G=L?this._queue.concat(L):this._queue;for(const K of G)if(K.id===y)return void(K.cancelled=!0)}run(y=0){const L=this._currentlyRunning=this._queue;this._queue=[];for(const G of L)if(!G.cancelled&&(G.callback(y),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ns($,y,L){if($=new h.LngLat($.lng,$.lat),y){const G=new h.LngLat($.lng-360,$.lat),K=new h.LngLat($.lng+360,$.lat),Q=360*Math.ceil(Math.abs($.lng-L.center.lng)/360),se=L.locationPoint($).distSqr(y),ge=y.x<0||y.y<0||y.x>L.width||y.y>L.height;L.locationPoint(G).distSqr(y)<se&&(ge||Math.abs(G.lng-L.center.lng)<Q)?$=G:L.locationPoint(K).distSqr(y)<se&&(ge||Math.abs(K.lng-L.center.lng)<Q)&&($=K)}for(;Math.abs($.lng-L.center.lng)>180;){const G=L.locationPoint($);if(G.x>=0&&G.y>=0&&G.x<=L.width&&G.y<=L.height)break;$.lng>L.center.lng?$.lng-=360:$.lng+=360}return $}const $o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Za extends h.Evented{constructor(y,L){if(super(),(y instanceof h.window.HTMLElement||L)&&(y=h.extend({element:y},L)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=y&&y.anchor||"center",this._color=y&&y.color||"#3FB1CE",this._scale=y&&y.scale||1,this._draggable=y&&y.draggable||!1,this._clickTolerance=y&&y.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=y&&y.rotation||0,this._rotationAlignment=y&&y.rotationAlignment||"auto",this._pitchAlignment=y&&y.pitchAlignment&&y.pitchAlignment!=="auto"?y.pitchAlignment:this._rotationAlignment,y&&y.element)this._element=y.element,this._offset=h.pointGeometry.convert(y&&y.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const K=P.createNS("http://www.w3.org/2000/svg","svg"),Q=41,se=27;K.setAttributeNS(null,"display","block"),K.setAttributeNS(null,"height",`${Q}px`),K.setAttributeNS(null,"width",`${se}px`),K.setAttributeNS(null,"viewBox",`0 0 ${se} ${Q}`);const ge=P.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"stroke","none"),ge.setAttributeNS(null,"stroke-width","1"),ge.setAttributeNS(null,"fill","none"),ge.setAttributeNS(null,"fill-rule","evenodd");const Ce=P.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"fill-rule","nonzero");const Oe=P.createNS("http://www.w3.org/2000/svg","g");Oe.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Oe.setAttributeNS(null,"fill","#000000");const Fe=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xt of Fe){const ut=P.createNS("http://www.w3.org/2000/svg","ellipse");ut.setAttributeNS(null,"opacity","0.04"),ut.setAttributeNS(null,"cx","10.5"),ut.setAttributeNS(null,"cy","5.80029008"),ut.setAttributeNS(null,"rx",xt.rx),ut.setAttributeNS(null,"ry",xt.ry),Oe.appendChild(ut)}const Ue=P.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"fill",this._color);const Qe=P.createNS("http://www.w3.org/2000/svg","path");Qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ue.appendChild(Qe);const ht=P.createNS("http://www.w3.org/2000/svg","g");ht.setAttributeNS(null,"opacity","0.25"),ht.setAttributeNS(null,"fill","#000000");const ct=P.createNS("http://www.w3.org/2000/svg","path");ct.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ht.appendChild(ct);const at=P.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(6.0, 7.0)"),at.setAttributeNS(null,"fill","#FFFFFF");const mt=P.createNS("http://www.w3.org/2000/svg","g");mt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const st=P.createNS("http://www.w3.org/2000/svg","circle");st.setAttributeNS(null,"fill","#000000"),st.setAttributeNS(null,"opacity","0.25"),st.setAttributeNS(null,"cx","5.5"),st.setAttributeNS(null,"cy","5.5"),st.setAttributeNS(null,"r","5.4999962");const gt=P.createNS("http://www.w3.org/2000/svg","circle");gt.setAttributeNS(null,"fill","#FFFFFF"),gt.setAttributeNS(null,"cx","5.5"),gt.setAttributeNS(null,"cy","5.5"),gt.setAttributeNS(null,"r","5.4999962"),mt.appendChild(st),mt.appendChild(gt),Ce.appendChild(Oe),Ce.appendChild(Ue),Ce.appendChild(ht),Ce.appendChild(at),Ce.appendChild(mt),K.appendChild(Ce),K.setAttributeNS(null,"height",Q*this._scale+"px"),K.setAttributeNS(null,"width",se*this._scale+"px"),this._element.appendChild(K),this._offset=h.pointGeometry.convert(y&&y.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",K=>{K.preventDefault()}),this._element.addEventListener("mousedown",K=>{K.preventDefault()});const G=this._element.classList;for(const K in $o)G.remove(`mapboxgl-marker-anchor-${K}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(y){return this.remove(),this._map=y,y.getCanvasContainer().appendChild(this._element),y.on("move",this._update),y.on("moveend",this._update),y.on("remove",this._clearFadeTimer),y._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=h.LngLat.convert(y),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(y){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),y){if(!("offset"in y.options)){const L=38.1,G=13.5,K=Math.sqrt(Math.pow(G,2)/2);y.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-L],"bottom-left":[K,-1*(L-G+K)],"bottom-right":[-K,-1*(L-G+K)],left:[G,-1*(L-G)],right:[-G,-1*(L-G)]}:this._offset}this._popup=y,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(y){const L=y.code,G=y.charCode||y.keyCode;L!=="Space"&&L!=="Enter"&&G!==32&&G!==13||this.togglePopup()}_onMapClick(y){const L=y.originalEvent.target,G=this._element;this._popup&&(L===G||G.contains(L))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const y=this._popup;return y?(y.isOpen()?(y.remove(),this._element.setAttribute("aria-expanded","false")):(y.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const y=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(y))return void this._clearFadeTimer();const L=this._map.unproject(y);let G=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const Q=this._map.getFreeCameraOptions();if(Q.position){const se=Q.position.toLngLat();G=se.distanceTo(L)<.9*se.distanceTo(this._lngLat)}}const K=(1-this._map._queryFogOpacity(L))*(G?.2:1);this._element.style.opacity=`${K}`,this._popup&&this._popup._setOpacity(`${K}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(y){const L=this._map.transform;return!!y&&y.x>=0&&y.x<L.width&&y.y>=0&&y.y<L.height}_update(y){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ns(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let L="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?L=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(L=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let G="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?G="rotateX(0deg)":this._pitchAlignment==="map"&&(G=`rotateX(${this._map.getPitch()}deg)`),y&&y.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&P.setTransform(this._element,`${$o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${G} ${L}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const y=this._map.transform,L=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&L._rotate(y.angle),this._pitchAlignment==="map"&&(L.y*=Math.cos(y._pitch)),L}getOffset(){return this._offset}setOffset(y){return this._offset=h.pointGeometry.convert(y),this._update(),this}_onMove(y){if(!this._isDragging){const L=this._clickTolerance||this._map._clickTolerance;this._isDragging=y.point.dist(this._pointerdownPos)>=L}this._isDragging&&(this._pos=y.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(y){this._element.contains(y.originalEvent.target)&&(y.preventDefault(),this._positionDelta=y.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=y.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(y){return this._draggable=!!y,this._map&&(y?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(y){return this._rotation=y||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(y){return this._rotationAlignment=y||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(y){return this._pitchAlignment=y&&y!=="auto"?y:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Yl{constructor(y){this.jumpTo(y)}getValue(y){if(y<=this._startTime)return this._start;if(y>=this._endTime)return this._end;const L=h.easeCubicInOut((y-this._startTime)/(this._endTime-this._startTime));return this._start*(1-L)+this._end*L}isEasing(y){return y>=this._startTime&&y<=this._endTime}jumpTo(y){this._startTime=-1/0,this._endTime=-1/0,this._start=y,this._end=y}easeTo(y,L,G){this._start=this.getValue(L),this._end=y,this._startTime=L,this._endTime=L+G}}const Kl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Ha,HTMLElement:Jl,ImageBitmap:kn}=h.window,Ql={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Wa($){$.parentNode&&$.parentNode.removeChild($)}const eh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Us{constructor(y,L,G=!1){this._clickTolerance=10,this.element=L,this.mouseRotate=new mn({clickTolerance:y.dragRotate._mouseRotate._clickTolerance}),this.map=y,G&&(this.mousePitch=new Wn({clickTolerance:y.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(L,"mousedown",this.mousedown),P.addEventListener(L,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(L,"touchmove",this.touchmove),P.addEventListener(L,"touchend",this.touchend),P.addEventListener(L,"touchcancel",this.reset)}down(y,L){this.mouseRotate.mousedown(y,L),this.mousePitch&&this.mousePitch.mousedown(y,L),P.disableDrag()}move(y,L){const G=this.map,K=this.mouseRotate.mousemoveWindow(y,L);if(K&&K.bearingDelta&&G.setBearing(G.getBearing()+K.bearingDelta),this.mousePitch){const Q=this.mousePitch.mousemoveWindow(y,L);Q&&Q.pitchDelta&&G.setPitch(G.getPitch()+Q.pitchDelta)}}off(){const y=this.element;P.removeEventListener(y,"mousedown",this.mousedown),P.removeEventListener(y,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(y,"touchmove",this.touchmove),P.removeEventListener(y,"touchend",this.touchend),P.removeEventListener(y,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(h.window,"mousemove",this.mousemove),P.removeEventListener(h.window,"mouseup",this.mouseup)}mousedown(y){this.down(h.extend({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),P.mousePos(this.element,y)),P.addEventListener(h.window,"mousemove",this.mousemove),P.addEventListener(h.window,"mouseup",this.mouseup)}mousemove(y){this.move(y,P.mousePos(this.element,y))}mouseup(y){this.mouseRotate.mouseupWindow(y),this.mousePitch&&this.mousePitch.mouseupWindow(y),this.offTemp()}touchstart(y){y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,y.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>y.preventDefault()},this._startPos))}touchmove(y){y.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,y.targetTouches)[0],this.move({preventDefault:()=>y.preventDefault()},this._lastPos))}touchend(y){y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $s={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Dn,jo=0,qa=!1;const js={maxWidth:100,unit:"metric"};function Gs($,y,L){const G=L&&L.maxWidth||100,K=$._container.getBoundingClientRect().height/2,Q=$.unproject([0,K]),se=$.unproject([G,K]),ge=Q.distanceTo(se);if(L&&L.unit==="imperial"){const Ce=3.2808*ge;Ce>5280?ma(y,G,Ce/5280,$._getUIString("ScaleControl.Miles"),$):ma(y,G,Ce,$._getUIString("ScaleControl.Feet"),$)}else L&&L.unit==="nautical"?ma(y,G,ge/1852,$._getUIString("ScaleControl.NauticalMiles"),$):ge>=1e3?ma(y,G,ge/1e3,$._getUIString("ScaleControl.Kilometers"),$):ma(y,G,ge,$._getUIString("ScaleControl.Meters"),$)}function ma($,y,L,G,K){const Q=function(ge){const Ce=Math.pow(10,`${Math.floor(ge)}`.length-1);let Oe=ge/Ce;return Oe=Oe>=10?10:Oe>=5?5:Oe>=3?3:Oe>=2?2:Oe>=1?1:function(Fe){const Ue=Math.pow(10,Math.ceil(-Math.log(Fe)/Math.LN10));return Math.round(Fe*Ue)/Ue}(Oe),Ce*Oe}(L),se=Q/L;K._requestDomTask(()=>{$.style.width=y*se+"px",$.innerHTML=`${Q}&nbsp;${G}`})}const Yh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ga={version:h.version,supported:I,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Xl{constructor($){if(($=h.extend({},Ql,$)).minZoom!=null&&$.maxZoom!=null&&$.minZoom>$.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if($.minPitch!=null&&$.maxPitch!=null&&$.minPitch>$.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if($.minPitch!=null&&$.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if($.maxPitch!=null&&$.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ks($.minZoom,$.maxZoom,$.minPitch,$.maxPitch,$.renderWorldCopies),$),this._interactive=$.interactive,this._maxTileCacheSize=$.maxTileCacheSize,this._failIfMajorPerformanceCaveat=$.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=$.preserveDrawingBuffer,this._antialias=$.antialias,this._trackResize=$.trackResize,this._bearingSnap=$.bearingSnap,this._refreshExpiredTiles=$.refreshExpiredTiles,this._fadeDuration=$.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=$.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=$.collectResourceTiming,this._optimizeForTerrain=$.optimizeForTerrain,this._renderTaskQueue=new zs,this._domRenderTaskQueue=new zs,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},Kl,$.locale),this._clickTolerance=$.clickTolerance,this._cooperativeGestures=$.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Yl(0),this._requestManager=new h.RequestManager($.transformRequest,$.accessToken,$.testMode),this._silenceAuthErrors=!!$.testMode,typeof $.container=="string"){if(this._container=h.window.document.getElementById($.container),!this._container)throw new Error(`Container '${$.container}' not found.`)}else{if(!($.container instanceof Jl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=$.container}if($.maxBounds&&this.setMaxBounds($.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),h.window!==void 0&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Uo(this,$),this._localFontFamily=$.localFontFamily,this._localIdeographFontFamily=$.localIdeographFontFamily,$.style&&this.setStyle($.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),$.projection&&this.setProjection($.projection),this._hash=$.hash&&new Po(typeof $.hash=="string"&&$.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:$.center,zoom:$.zoom,bearing:$.bearing,pitch:$.pitch}),$.bounds&&(this.resize(),this.fitBounds($.bounds,h.extend({},$.fitBoundsOptions,{duration:0})))),this.resize(),$.attributionControl&&this.addControl(new Os({customAttribution:$.customAttribution})),this._logoControl=new Fs,this.addControl(this._logoControl,$.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",y=>{this._update(y.dataType==="style"),this.fire(new h.Event(`${y.dataType}data`,y))}),this.on("dataloading",y=>{this.fire(new h.Event(`${y.dataType}dataloading`,y))})}_getMapId(){return this._mapId}addControl($,y){if(y===void 0&&(y=$.getDefaultPosition?$.getDefaultPosition():"top-right"),!$||!$.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const L=$.onAdd(this);this._controls.push($);const G=this._controlPositions[y];return y.indexOf("bottom")!==-1?G.insertBefore(L,G.firstChild):G.appendChild(L),this}removeControl($){if(!$||!$.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const y=this._controls.indexOf($);return y>-1&&this._controls.splice(y,1),$.onRemove(this),this}hasControl($){return this._controls.indexOf($)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize($){const[y,L]=this._containerDimensions();if(y===this.transform.width&&L===this.transform.height)return this;this._resizeCanvas(y,L),this.transform.resize(y,L),this.painter.resize(Math.ceil(y),Math.ceil(L));const G=!this._moving;return G&&this.fire(new h.Event("movestart",$)).fire(new h.Event("move",$)),this.fire(new h.Event("resize",$)),G&&this.fire(new h.Event("moveend",$)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds($){return this.transform.setMaxBounds(h.LngLatBounds.convert($)),this._update()}setMinZoom($){if(($=$==null?-2:$)>=-2&&$<=this.transform.maxZoom)return this.transform.minZoom=$,this._update(),this.getZoom()<$?this.setZoom($):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom($){if(($=$==null?22:$)>=this.transform.minZoom)return this.transform.maxZoom=$,this._update(),this.getZoom()>$?this.setZoom($):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch($){if(($=$==null?0:$)<0)throw new Error("minPitch must be greater than or equal to 0");if($>=0&&$<=this.transform.maxPitch)return this.transform.minPitch=$,this._update(),this.getPitch()<$?this.setPitch($):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch($){if(($=$==null?85:$)>85)throw new Error("maxPitch must be less than or equal to 85");if($>=this.transform.minPitch)return this.transform.maxPitch=$,this._update(),this.getPitch()>$?this.setPitch($):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies($){return this.transform.renderWorldCopies=$,this._update()}getProjection(){return this.transform.getProjection()}setProjection($){this._lazyInitEmptyStyle(),typeof $=="string"&&($={name:$}),this._runtimeProjection=$,this.style.updateProjection()}project($){return this.transform.locationPoint3D(h.LngLat.convert($))}unproject($){return this.transform.pointLocation3D(h.pointGeometry.convert($))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener($,y,L){if($==="mouseenter"||$==="mouseover"){let G=!1;const K=se=>{const ge=y.filter(Oe=>this.getLayer(Oe)),Ce=ge.length?this.queryRenderedFeatures(se.point,{layers:ge}):[];Ce.length?G||(G=!0,L.call(this,new Ur($,this,se.originalEvent,{features:Ce}))):G=!1},Q=()=>{G=!1};return{layers:new Set(y),listener:L,delegates:{mousemove:K,mouseout:Q}}}if($==="mouseleave"||$==="mouseout"){let G=!1;const K=se=>{const ge=y.filter(Ce=>this.getLayer(Ce));(ge.length?this.queryRenderedFeatures(se.point,{layers:ge}):[]).length?G=!0:G&&(G=!1,L.call(this,new Ur($,this,se.originalEvent)))},Q=se=>{G&&(G=!1,L.call(this,new Ur($,this,se.originalEvent)))};return{layers:new Set(y),listener:L,delegates:{mousemove:K,mouseout:Q}}}{const G=K=>{const Q=y.filter(ge=>this.getLayer(ge)),se=Q.length?this.queryRenderedFeatures(K.point,{layers:Q}):[];se.length&&(K.features=se,L.call(this,K),delete K.features)};return{layers:new Set(y),listener:L,delegates:{[$]:G}}}}on($,y,L){if(L===void 0)return super.on($,y);Array.isArray(y)||(y=[y]);const G=this._createDelegatedListener($,y,L);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[$]=this._delegatedListeners[$]||[],this._delegatedListeners[$].push(G);for(const K in G.delegates)this.on(K,G.delegates[K]);return this}once($,y,L){if(L===void 0)return super.once($,y);Array.isArray(y)||(y=[y]);const G=this._createDelegatedListener($,y,L);for(const K in G.delegates)this.once(K,G.delegates[K]);return this}off($,y,L){if(L===void 0)return super.off($,y);y=new Set(Array.isArray(y)?y:[y]);const G=(Q,se)=>{if(Q.size!==se.size)return!1;for(const ge of Q)if(!se.has(ge))return!1;return!0},K=this._delegatedListeners?this._delegatedListeners[$]:void 0;return K&&(Q=>{for(let se=0;se<Q.length;se++){const ge=Q[se];if(ge.listener===L&&G(ge.layers,y)){for(const Ce in ge.delegates)this.off(Ce,ge.delegates[Ce]);return Q.splice(se,1),this}}})(K),this}queryRenderedFeatures($,y){return this.style?(y!==void 0||$===void 0||$ instanceof h.pointGeometry||Array.isArray($)||(y=$,$=void 0),this.style.queryRenderedFeatures($=$||[[0,0],[this.transform.width,this.transform.height]],y=y||{},this.transform)):[]}querySourceFeatures($,y){return this.style.querySourceFeatures($,y)}queryTerrainElevation($,y){const L=this.transform.elevation;return L?(y=h.extend({},{exaggerated:!0},y),L.getAtPoint(h.MercatorCoordinate.fromLngLat($),null,y.exaggerated)):null}setStyle($,y){return(y=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&y.localFontFamily===this._localFontFamily&&this.style&&$?(this._diffStyle($,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._localFontFamily=y.localFontFamily,this._updateStyle($,y))}_getUIString($){const y=this._locale[$];if(y==null)throw new Error(`Missing UI string '${$}'`);return y}_updateStyle($,y){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),$&&(this.style=new Yr(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof $=="string"?this.style.loadURL($):this.style.loadJSON($)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Yr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle($,y){if(typeof $=="string"){const L=this._requestManager.normalizeStyleURL($),G=this._requestManager.transformRequest(L,h.ResourceType.Style);h.getJSON(G,(K,Q)=>{K?this.fire(new h.ErrorEvent(K)):Q&&this._updateDiff(Q,y)})}else typeof $=="object"&&this._updateDiff($,y)}_updateDiff($,y){try{this.style.setState($)&&this._update(!0)}catch(L){h.warnOnce(`Unable to perform style diff: ${L.message||L.error||L}.  Rebuilding the style from scratch.`),this._updateStyle($,y)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource($,y){return this._lazyInitEmptyStyle(),this.style.addSource($,y),this._update(!0)}isSourceLoaded($){const y=this.style&&this.style._getSourceCaches($);if(y.length!==0)return y.every(L=>L.loaded());this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${$}'`)))}areTilesLoaded(){const $=this.style&&this.style._sourceCaches;for(const y in $){const L=$[y]._tiles;for(const G in L){const K=L[G];if(K.state!=="loaded"&&K.state!=="errored")return!1}}return!0}addSourceType($,y,L){return this._lazyInitEmptyStyle(),this.style.addSourceType($,y,L)}removeSource($){return this.style.removeSource($),this._updateTerrain(),this._update(!0)}getSource($){return this.style.getSource($)}addImage($,y,{pixelRatio:L=1,sdf:G=!1,stretchX:K,stretchY:Q,content:se}={}){if(this._lazyInitEmptyStyle(),y instanceof Ha||kn&&y instanceof kn){const{width:ge,height:Ce,data:Oe}=h.exported.getImageData(y);this.style.addImage($,{data:new h.RGBAImage({width:ge,height:Ce},Oe),pixelRatio:L,stretchX:K,stretchY:Q,content:se,sdf:G,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ge,height:Ce,data:Oe}=y,Fe=y;this.style.addImage($,{data:new h.RGBAImage({width:ge,height:Ce},new Uint8Array(Oe)),pixelRatio:L,stretchX:K,stretchY:Q,content:se,sdf:G,version:0,userImage:Fe}),Fe.onAdd&&Fe.onAdd(this,$)}}}updateImage($,y){const L=this.style.getImage($);if(!L)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const G=y instanceof Ha||kn&&y instanceof kn?h.exported.getImageData(y):y,{width:K,height:Q,data:se}=G;return K===void 0||Q===void 0?this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):K!==L.data.width||Q!==L.data.height?this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(L.data.replace(se,!(y instanceof Ha||kn&&y instanceof kn)),void this.style.updateImage($,L))}hasImage($){return $?!!this.style.getImage($):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage($){this.style.removeImage($)}loadImage($,y){h.getImage(this._requestManager.transformRequest($,h.ResourceType.Image),(L,G)=>{y(L,G instanceof Ha?h.exported.getImageData(G):G)})}listImages(){return this.style.listImages()}addLayer($,y){return this._lazyInitEmptyStyle(),this.style.addLayer($,y),this._update(!0)}moveLayer($,y){return this.style.moveLayer($,y),this._update(!0)}removeLayer($){return this.style.removeLayer($),this._update(!0)}getLayer($){return this.style.getLayer($)}setLayerZoomRange($,y,L){return this.style.setLayerZoomRange($,y,L),this._update(!0)}setFilter($,y,L={}){return this.style.setFilter($,y,L),this._update(!0)}getFilter($){return this.style.getFilter($)}setPaintProperty($,y,L,G={}){return this.style.setPaintProperty($,y,L,G),this._update(!0)}getPaintProperty($,y){return this.style.getPaintProperty($,y)}setLayoutProperty($,y,L,G={}){return this.style.setLayoutProperty($,y,L,G),this._update(!0)}getLayoutProperty($,y){return this.style.getLayoutProperty($,y)}setLight($,y={}){return this._lazyInitEmptyStyle(),this.style.setLight($,y),this._update(!0)}getLight(){return this.style.getLight()}setTerrain($){return this._lazyInitEmptyStyle(),this.style.setTerrain($),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog($){return this._lazyInitEmptyStyle(),this.style.setFog($),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity($){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert($),this.transform):0}setFeatureState($,y){return this.style.setFeatureState($,y),this._update()}removeFeatureState($,y){return this.style.removeFeatureState($,y),this._update()}getFeatureState($){return this.style.getFeatureState($)}_containerDimensions(){let $=0,y=0;return this._container&&($=this._container.getBoundingClientRect().width||400,y=this._container.getBoundingClientRect().height||300),[$,y]}_detectMissingCSS(){h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const $=this._container;$.classList.add("mapboxgl-map"),(this._missingCSSCanary=P.create("div","mapboxgl-canary",$)).style.visibility="hidden",this._detectMissingCSS();const y=this._canvasContainer=P.create("div","mapboxgl-canvas-container",$);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=P.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const L=this._containerDimensions();this._resizeCanvas(L[0],L[1]);const G=this._controlContainer=P.create("div","mapboxgl-control-container",$),K=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Q=>{K[Q]=P.create("div",`mapboxgl-ctrl-${Q}`,G)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas($,y){const L=h.exported.devicePixelRatio||1;this._canvas.width=L*Math.ceil($),this._canvas.height=L*Math.ceil(y),this._canvas.style.width=`${$}px`,this._canvas.style.height=`${y}px`}_addMarker($){this._markers.push($)}_removeMarker($){const y=this._markers.indexOf($);y!==-1&&this._markers.splice(y,1)}_setupPainter(){const $=h.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",$)||this._canvas.getContext("experimental-webgl",$);y?(h.storeAuthState(y,!0),this.painter=new Il(y,this.transform),this.on("data",L=>{L.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(y)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost($){$.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:$}))}_contextRestored($){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:$}))}_onMapScroll($){if($.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update($){return this.style?(this._styleDirty=this._styleDirty||$,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame($){return this._update(),this._renderTaskQueue.add($)}_cancelRenderFrame($){this._renderTaskQueue.remove($)}_requestDomTask($){!this.loaded()||this.loaded()&&!this.isMoving()?$():this._domRenderTaskQueue.add($)}_render($){let y;const L=this.painter.context.extTimerQuery,G=h.exported.now();this.listens("gpu-timing-frame")&&(y=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,y));let K=this._updateAverageElevation(G);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run($),this._domRenderTaskQueue.run($),this._removed)return;let Q=!1;const se=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Ce=this.transform.zoom,Oe=this.transform.pitch,Fe=h.exported.now();this.style.zoomHistory.update(Ce,Fe);const Ue=new h.EvaluationParameters(Ce,{now:Fe,fadeDuration:se,pitch:Oe,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Qe=Ue.crossFadingFactor();Qe===1&&Qe===this._crossFadingFactor||(Q=!0,this._crossFadingFactor=Qe),this.style.update(Ue)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,se,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:se,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||Q)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const Ce=h.exported.now()-G;L.endQueryEXT(L.TIME_ELAPSED_EXT,y),setTimeout(()=>{const Oe=L.getQueryObjectEXT(y,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(y),this.fire(new h.Event("gpu-timing-frame",{cpuTime:Ce,gpuTime:Oe}))},50)}if(this.listens("gpu-timing-layer")){const Ce=this.painter.collectGpuTimers();setTimeout(()=>{const Oe=this.painter.queryGpuTimers(Ce);this.fire(new h.Event("gpu-timing-layer",{layerTimes:Oe}))},50)}const ge=this._sourcesDirty||this._styleDirty||this._placementDirty||K;if(ge||this._repaint)this.triggerRepaint();else{const Ce=!this.isMoving()&&this.loaded();if(Ce&&(K=this._updateAverageElevation(G,!0)),K)this.triggerRepaint();else if(this._triggerFrame(!1),Ce&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Oe=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:Oe})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||ge||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const $ of this._markers)$._update()}_updateAverageElevation($,y=!1){const L=G=>(this.transform.averageElevation=G,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&L(0);if((y||$-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing($)){const G=this.transform.averageElevation;let K=this.transform.sampleAverageElevation();isNaN(K)?K=0:this._averageElevationLastSampledAt=$;const Q=Math.abs(G-K);if(Q>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(K),L(K);this._averageElevation.easeTo(K,$,300)}else if(Q>1e-4)return this._averageElevation.jumpTo(K),L(K)}return!!this._averageElevation.isEasing($)&&L(this._averageElevation.getValue($))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,$=>{if($&&($.message===h.AUTH_ERR_MSG||$.status===401)){const y=this.painter.context.gl;h.storeAuthState(y,!1),this._logoControl instanceof Fs&&this._logoControl._updateLogo(),y&&y.clear(y.DEPTH_BUFFER_BIT|y.COLOR_BUFFER_BIT|y.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const $=this.painter.canvasCopy(),y=this.painter.getCanvasCopiesAndTimestamps();y.timeStamps.push(performance.now());const L=this.painter.context.gl,G=L.createFramebuffer();function K(Q){L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,Q,0);const se=new Uint8Array(L.drawingBufferWidth*L.drawingBufferHeight*4);return L.readPixels(0,0,L.drawingBufferWidth,L.drawingBufferHeight,L.RGBA,L.UNSIGNED_BYTE,se),se}return L.bindFramebuffer(L.FRAMEBUFFER,G),this._canvasPixelComparison(K($),y.canvasCopies.map(K),y.timeStamps)}_canvasPixelComparison($,y,L){let G=L[1]-L[0];const K=$.length/4;for(let Q=0;Q<y.length;Q++){const se=y[Q];let ge=0;for(let Ce=0;Ce<se.length;Ce+=4)se[Ce]===$[Ce]&&se[Ce+1]===$[Ce+1]&&se[Ce+2]===$[Ce+2]&&se[Ce+3]===$[Ce+3]&&(ge+=1);G+=(L[Q+2]-L[Q+1])*(1-ge/K)}return G}remove(){this._hash&&this._hash.remove();for(const y of this._controls)y.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),h.window!==void 0&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const $=this.painter.context.gl.getExtension("WEBGL_lose_context");$&&$.loseContext(),Wa(this._canvasContainer),Wa(this._controlContainer),Wa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame($){this._renderNextFrame=this._renderNextFrame||$,this.style&&!this._frame&&(this._frame=h.exported.frame(y=>{const L=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,L&&this._render(y)}))}_onWindowOnline(){this._update()}_onWindowResize($){this._trackResize&&this.resize({originalEvent:$})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries($){this._showTileBoundaries!==$&&(this._showTileBoundaries=$,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe($){this._showTerrainWireframe!==$&&(this._showTerrainWireframe=$,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming($){this._speedIndexTiming!==$&&(this._speedIndexTiming=$,this._update())}get showPadding(){return!!this._showPadding}set showPadding($){this._showPadding!==$&&(this._showPadding=$,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes($){this._showCollisionBoxes!==$&&(this._showCollisionBoxes=$,$?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector($){this._showOverdrawInspector!==$&&(this._showOverdrawInspector=$,this._update())}get repaint(){return!!this._repaint}set repaint($){this._repaint!==$&&(this._repaint=$,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices($){this._vertices=$,this._update()}_setCacheLimits($,y){h.setCacheLimits($,y)}get version(){return h.version}},NavigationControl:class{constructor($){this.options=h.extend({},eh,$),this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",y=>y.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",y=>this._map.zoomIn({},{originalEvent:y})),P.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",y=>this._map.zoomOut({},{originalEvent:y})),P.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",y=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:y}):this._map.resetNorth({},{originalEvent:y})}),this._compassIcon=P.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const $=this._map.getZoom(),y=$===this._map.getMaxZoom(),L=$===this._map.getMinZoom();this._zoomInButton.disabled=y,this._zoomOutButton.disabled=L,this._zoomInButton.setAttribute("aria-disabled",y.toString()),this._zoomOutButton.setAttribute("aria-disabled",L.toString())}_rotateCompassArrow(){const $=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=$)})}onAdd($){return this._map=$,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Us(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton($,y){const L=P.create("button",$,this._container);return L.type="button",L.addEventListener("click",y),L}_setButtonTitle($,y){const L=this._map._getUIString(`NavigationControl.${y}`);$.setAttribute("aria-label",L),$.firstElementChild&&$.firstElementChild.setAttribute("title",L)}},GeolocateControl:class extends h.Evented{constructor($){super(),this.options=h.extend({},$s,$),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ds(this._updateMarkerRotation,20)}onAdd($){var y;return this._map=$,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,Dn!==void 0?y(Dn):h.window.navigator.permissions!==void 0?h.window.navigator.permissions.query({name:"geolocation"}).then(L=>{Dn=L.state!=="denied",y(Dn)}):(Dn=!!h.window.navigator.geolocation,y(Dn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jo=0,qa=!1}_isOutOfMapMaxBounds($){const y=this._map.getMaxBounds(),L=$.coords;return y&&(L.longitude<y.getWest()||L.longitude>y.getEast()||L.latitude<y.getSouth()||L.latitude>y.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess($){if(this._map){if(this._isOutOfMapMaxBounds($))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",$)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=$,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker($),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera($),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",$)),this._finish()}}_updateCamera($){const y=new h.LngLat($.coords.longitude,$.coords.latitude),L=$.coords.accuracy,G=this._map.getBearing(),K=h.extend({bearing:G},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(L),K,{geolocateSource:!0})}_updateMarker($){if($){const y=new h.LngLat($.coords.longitude,$.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=$.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const $=this._map._container.getBoundingClientRect().height/2,y=this._map.unproject([0,$]),L=this._map.unproject([100,$]),G=y.distanceTo(L)/100,K=Math.ceil(2*this._accuracy/G);this._circleElement.style.width=`${K}px`,this._circleElement.style.height=`${K}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError($){if(this._map){if(this.options.trackUserLocation)if($.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if($.code===3&&qa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",$)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI($){if(this._container.addEventListener("contextmenu",y=>y.preventDefault()),this._geolocateButton=P.create("button","mapboxgl-ctrl-geolocate",this._container),P.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",$===!1){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y)}else{const y=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",y),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",y)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","mapboxgl-user-location"),this._dotElement.appendChild(P.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(P.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Za({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=P.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Za({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",y=>{y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||y.originalEvent&&y.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation($){this._userLocationDotMarker&&($.webkitCompassHeading?this._heading=$.webkitCompassHeading:$.absolute===!0&&(this._heading=-1*$.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jo--,qa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let $;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jo++,jo>1?($={maximumAge:6e5,timeout:0},qa=!0):($=this.options.positionOptions,qa=!1),this._geolocationWatchID=h.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,$),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else h.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const $=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};h.window.DeviceMotionEvent!==void 0&&typeof h.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(y=>{y==="granted"&&$()}).catch(console.error):$()}_clearWatch(){h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Os,ScaleControl:class{constructor($){this.options=h.extend({},js,$),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Gs(this._map,this._container,this.options)}onAdd($){return this._map=$,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",$.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit($){this.options.unit=$,Gs(this._map,this._container,this.options)}},FullscreenControl:class{constructor($){this._fullscreen=!1,$&&$.container&&($.container instanceof h.window.HTMLElement?this._container=$.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd($){return this._map=$,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const $=this._fullscreenButton=P.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","mapboxgl-ctrl-icon",$).setAttribute("aria-hidden",!0),$.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const $=this._getTitle();this._fullscreenButton.setAttribute("aria-label",$),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",$)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor($){super(),this.options=h.extend(Object.create(Yh),$),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set($&&$.className?$.className.trim().split(/\s+/):[])}addTo($){return this._map&&this.remove(),this._map=$,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat($){return this._lngLat=h.LngLat.convert($),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText($){return this.setDOMContent(h.window.document.createTextNode($))}setHTML($){const y=h.window.document.createDocumentFragment(),L=h.window.document.createElement("body");let G;for(L.innerHTML=$;G=L.firstChild,G;)y.appendChild(G);return this.setDOMContent(y)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth($){return this.options.maxWidth=$,this._update(),this}setDOMContent($){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild($),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName($){return this._classList.add($),this._container&&this._updateClassList(),this}removeClassName($){return this._classList.delete($),this._container&&this._updateClassList(),this}setOffset($){return this.options.offset=$,this._update(),this}toggleClassName($){let y;return this._classList.delete($)?y=!1:(this._classList.add($),y=!0),this._container&&this._updateClassList(),y}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp($){this._update($.point)}_onMouseMove($){this._update($.point)}_onDrag($){this._update($.point)}_getAnchor($){if(this.options.anchor)return this.options.anchor;const y=this._pos,L=this._container.offsetWidth,G=this._container.offsetHeight;let K;return K=y.y+$.bottom.y<G?["top"]:y.y>this._map.transform.height-G?["bottom"]:[],y.x<L/2?K.push("left"):y.x>this._map.transform.width-L/2&&K.push("right"),K.length===0?"bottom":K.join("-")}_updateClassList(){const $=[...this._classList];$.push("mapboxgl-popup"),this._anchor&&$.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&$.push("mapboxgl-popup-track-pointer"),this._container.className=$.join(" ")}_update($){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=P.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ns(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||$){const y=this._pos=this._trackPointer&&$?$:this._map.project(this._lngLat),L=function(Q){if(Q||(Q=new h.pointGeometry(0,0)),typeof Q=="number"){const se=Math.round(Math.sqrt(.5*Math.pow(Q,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,Q),"top-left":new h.pointGeometry(se,se),"top-right":new h.pointGeometry(-se,se),bottom:new h.pointGeometry(0,-Q),"bottom-left":new h.pointGeometry(se,-se),"bottom-right":new h.pointGeometry(-se,-se),left:new h.pointGeometry(Q,0),right:new h.pointGeometry(-Q,0)}}if(Q instanceof h.pointGeometry||Array.isArray(Q)){const se=h.pointGeometry.convert(Q);return{center:se,top:se,"top-left":se,"top-right":se,bottom:se,"bottom-left":se,"bottom-right":se,left:se,right:se}}return{center:h.pointGeometry.convert(Q.center||[0,0]),top:h.pointGeometry.convert(Q.top||[0,0]),"top-left":h.pointGeometry.convert(Q["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(Q["top-right"]||[0,0]),bottom:h.pointGeometry.convert(Q.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(Q["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(Q["bottom-right"]||[0,0]),left:h.pointGeometry.convert(Q.left||[0,0]),right:h.pointGeometry.convert(Q.right||[0,0])}}(this.options.offset),G=this._anchor=this._getAnchor(L),K=y.add(L[G]).round();this._map._requestDomTask(()=>{this._container&&G&&P.setTransform(this._container,`${$o[G]} translate(${K.x}px,${K.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const $=this._container.querySelector(Kh);$&&$.focus()}_onClose(){this.remove()}_setOpacity($){this._content&&(this._content.style.opacity=$),this._tip&&(this._tip.style.opacity=$)}},Marker:Za,Style:Yr,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:Cs,Evented:h.Evented,config:h.config,prewarm:function(){ri().acquire(wt)},clearPrewarmedResources:function(){const $=Nt;$&&($.isPreloaded()&&$.numActive()===1?($.release(wt),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken($){h.config.ACCESS_TOKEN=$},get baseApiUrl(){return h.config.API_URL},set baseApiUrl($){h.config.API_URL=$},get workerCount(){return Tt.workerCount},set workerCount($){Tt.workerCount=$},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests($){h.config.MAX_PARALLEL_IMAGE_REQUESTS=$},clearStorage($){h.clearTileCache($)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return ga});var S=x;return S})})(mapboxGl);var mapboxgl=mapboxGl.exports;function lng2tile(p,l){return Math.floor((p+180)/360*Math.pow(2,l))}function lat2tile(p,l){return Math.floor((1-Math.log(Math.tan(p*Math.PI/180)+1/Math.cos(p*Math.PI/180))/Math.PI)/2*Math.pow(2,l))}function tile2lng(p,l){return p/Math.pow(2,l)*360-180}function getTileInfo(p,l,g){let m={},x=Math.floor(g.getZoom()),E=40075016686e-3*Math.abs(Math.cos(l))/Math.pow(2,x),S=E/512;return m.z=x,m.x=lng2tile(p,x),m.y=lat2tile(l,x),m.long=p,m.lat=l,m.tileWidthInMeters=E,m.metersPerPixel=S,m.bb=getTileGeoJsonBB(m),m.mapbox_tile_name=m.z+"-"+m.x+"-"+m.y,m.rgbFileName="terrain-rgb-"+m.mapbox_tile_name+".png",m.thirtytwoFile={name:"thirtytwo-"+m.mapbox_tile_name+".png",bitDepth:32},m.sixteenFile={name:"sixteen-"+m.mapbox_tile_name,bitDepth:16},m}function getFeaturesFromBB(p,l){if(l){let g=[l.geometry.coordinates[0][4]],m=[l.geometry.coordinates[0][2]];const x=new mapboxgl.LngLat(g[0][0],g[0][1]),E=new mapboxgl.LngLat(m[0][0],m[0][1]),S=p.project(x),h=p.project(E);return p.queryRenderedFeatures([S,h])}}function tile2lat(p,l){let g=Math.PI-2*Math.PI*p/Math.pow(2,l);return Math.atan(Math.sinh(g))*180/Math.PI}function getTileGeoJsonBB(p){let l={};return l.north=tile2lat(p.y,p.z),l.south=tile2lat(p.y+1,p.z),l.west=tile2lng(p.x,p.z),l.east=tile2lng(p.x+1,p.z),{type:"Feature",geometry:{type:"Polygon",coordinates:[[[l.west,l.south],[l.east,l.south],[l.east,l.north],[l.west,l.north],[l.west,l.south]]]}}}var mapUtils={tile2lat,tile2lng,lat2tile,getTileInfo,getFeaturesFromBB};function mitt(p){return{all:p=p||new Map,on:function(l,g){var m=p.get(l);m?m.push(g):p.set(l,[g])},off:function(l,g){var m=p.get(l);m&&(g?m.splice(m.indexOf(g)>>>0,1):p.set(l,[]))},emit:function(l,g){var m=p.get(l);m&&m.slice().map(function(x){x(g)}),(m=p.get("*"))&&m.slice().map(function(x){x(l,g)})}}}var emitter=mitt(),immutable=extend$2,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$2(){for(var p={},l=0;l<arguments.length;l++){var g=arguments[l];for(var m in g)hasOwnProperty.call(g,m)&&(p[m]=g[m])}return p}var fuzzy$1={exports:{}};(function(p,l){(function(){var g={};p.exports=g,g.simpleFilter=function(m,x){return x.filter(function(E){return g.test(m,E)})},g.test=function(m,x){return g.match(m,x)!==null},g.match=function(m,x,E){E=E||{};var S=0,h=[],I=x.length,T=0,A=0,k=E.pre||"",P=E.post||"",D=E.caseSensitive&&x||x.toLowerCase(),M;m=E.caseSensitive&&m||m.toLowerCase();for(var F=0;F<I;F++)M=x[F],D[F]===m[S]?(M=k+M+P,S+=1,A+=1+A):A=0,T+=A,h[h.length]=M;return S===m.length?(T=D===m?1/0:T,{rendered:h.join(""),score:T}):null},g.filter=function(m,x,E){return!x||x.length===0?[]:typeof m!="string"?x:(E=E||{},x.reduce(function(S,h,I,T){var A=h;E.extract&&(A=E.extract(h));var k=g.match(m,A,E);return k!=null&&(S[S.length]={string:k.rendered,score:k.score,index:I,original:h}),S},[]).sort(function(S,h){var I=h.score-S.score;return I||S.index-h.index}))}})()})(fuzzy$1);var List$1=function(p){return this.component=p,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,p.el.parentNode.insertBefore(this.wrapper,p.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(p){this.items.push(p)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var p=0;p<this.items.length;p++)this.drawItem(this.items[p],this.active===p);this.show()};List$1.prototype.drawItem=function(p,l){var g=document.createElement("li"),m=document.createElement("a");l&&(g.className+=" active"),m.innerHTML=p.string,g.appendChild(m),this.element.appendChild(g),g.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),g.addEventListener("mouseup",function(){this.handleMouseUp.call(this,p)}.bind(this))};List$1.prototype.handleMouseUp=function(p){this.selectingListItem=!1,this.component.value(p.original),this.clear(),this.draw()};List$1.prototype.move=function(p){this.active=p,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(p){var l=document.createElement("li");l.innerHTML=p,this.element.appendChild(l),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzy$1.exports,List=list,Suggestions$1=function(p,l,g){return g=g||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},g),this.el=p,this.data=l||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(m){this.handleKeyUp(m.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(m){this.handleKeyDown(m)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(m){this.handlePaste(m)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(p){p===40||p===38||p===27||p===13||p===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(p){switch(p.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&p.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(p){if(p.clipboardData)this.handleInputChange(p.clipboardData.getData("Text"));else{var l=this;setTimeout(function(){l.handleInputChange(p.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(p){if(this.query=this.normalize(p),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(l){for(var g=0;g<l.length&&(this.list.add(l[g]),g!==this.options.limit-1);g++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(p){this.data=p,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(p){return p=p.toLowerCase(),p};Suggestions$1.prototype.match=function(p,l){return p.indexOf(l)>-1};Suggestions$1.prototype.value=function(p){if(this.selected=p,this.el.value=this.getItemValue(p),document.createEvent){var l=document.createEvent("HTMLEvents");l.initEvent("change",!0,!1),this.el.dispatchEvent(l)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(p){var l={pre:"<strong>",post:"</strong>",extract:function(m){return this.getItemValue(m)}.bind(this)},g;this.options.filter?(g=fuzzy.filter(this.query,this.data,l),g=g.map(function(m){return{original:m.original,string:this.render(m.original,m.string)}}.bind(this))):g=this.data.map(function(m){var x=this.render(m);return{original:m,string:x}}.bind(this)),p(g)};Suggestions$1.prototype.getItemValue=function(p){return p};Suggestions$1.prototype.render=function(p,l){if(l)return l;for(var g=p.original?this.getItemValue(p.original):this.getItemValue(p),m=this.normalize(g),x=m.lastIndexOf(this.query);x>-1;){var E=x+this.query.length;g=g.slice(0,x)+"<strong>"+g.slice(x,E)+"</strong>"+g.slice(E),x=m.slice(0,x).lastIndexOf(this.query)}return g};Suggestions$1.prototype.renderError=function(p){this.list.drawError(p)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window!="undefined"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$1(p,l,g){var m,x,E,S,h,I,T=0,A=!1,k=!1,P=!0;if(typeof p!="function")throw new TypeError(FUNC_ERROR_TEXT);l=toNumber(l)||0,isObject(g)&&(A=!!g.leading,k="maxWait"in g,E=k?nativeMax(toNumber(g.maxWait)||0,l):E,P="trailing"in g?!!g.trailing:P);function D(W){var Y=m,X=x;return m=x=void 0,T=W,S=p.apply(X,Y),S}function M(W){return T=W,h=setTimeout(B,l),A?D(W):S}function F(W){var Y=W-I,X=W-T,J=l-Y;return k?nativeMin(J,E-X):J}function N(W){var Y=W-I,X=W-T;return I===void 0||Y>=l||Y<0||k&&X>=E}function B(){var W=now();if(N(W))return U(W);h=setTimeout(B,F(W))}function U(W){return h=void 0,P&&m?D(W):(m=x=void 0,S)}function O(){h!==void 0&&clearTimeout(h),T=0,m=I=x=h=void 0}function V(){return h===void 0?S:U(now())}function Z(){var W=now(),Y=N(W);if(m=arguments,x=this,I=W,Y){if(h===void 0)return M(I);if(k)return h=setTimeout(B,l),D(I)}return h===void 0&&(h=setTimeout(B,l)),S}return Z.cancel=O,Z.flush=V,Z}function isObject(p){var l=typeof p;return!!p&&(l=="object"||l=="function")}function isObjectLike(p){return!!p&&typeof p=="object"}function isSymbol(p){return typeof p=="symbol"||isObjectLike(p)&&objectToString.call(p)==symbolTag}function toNumber(p){if(typeof p=="number")return p;if(isSymbol(p))return NAN;if(isObject(p)){var l=typeof p.valueOf=="function"?p.valueOf():p;p=isObject(l)?l+"":l}if(typeof p!="string")return p===0?p:+p;p=p.replace(reTrim,"");var g=reIsBinary.test(p);return g||reIsOctal.test(p)?freeParseInt(p.slice(2),g?2:8):reIsBadHex.test(p)?NAN:+p}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function p(l,g,m){return Function.prototype.apply.call(l,g,m)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:ReflectOwnKeys=function(l){return Object.getOwnPropertyNames(l)};function ProcessEmitWarning(p){console&&console.warn&&console.warn(p)}var NumberIsNaN=Number.isNaN||function p(l){return l!==l};function EventEmitter$2(){EventEmitter$2.init.call(this)}events$1.exports=EventEmitter$2;events$1.exports.once=once;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(p){if(typeof p!="number"||p<0||NumberIsNaN(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");defaultMaxListeners=p}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function p(l){if(typeof l!="number"||l<0||NumberIsNaN(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this};function _getMaxListeners(p){return p._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:p._maxListeners}EventEmitter$2.prototype.getMaxListeners=function p(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function p(l){for(var g=[],m=1;m<arguments.length;m++)g.push(arguments[m]);var x=l==="error",E=this._events;if(E!==void 0)x=x&&E.error===void 0;else if(!x)return!1;if(x){var S;if(g.length>0&&(S=g[0]),S instanceof Error)throw S;var h=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw h.context=S,h}var I=E[l];if(I===void 0)return!1;if(typeof I=="function")ReflectApply(I,this,g);else for(var T=I.length,A=arrayClone(I,T),m=0;m<T;++m)ReflectApply(A[m],this,g);return!0};function _addListener(p,l,g,m){var x,E,S;if(checkListener(g),E=p._events,E===void 0?(E=p._events=Object.create(null),p._eventsCount=0):(E.newListener!==void 0&&(p.emit("newListener",l,g.listener?g.listener:g),E=p._events),S=E[l]),S===void 0)S=E[l]=g,++p._eventsCount;else if(typeof S=="function"?S=E[l]=m?[g,S]:[S,g]:m?S.unshift(g):S.push(g),x=_getMaxListeners(p),x>0&&S.length>x&&!S.warned){S.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+S.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=p,h.type=l,h.count=S.length,ProcessEmitWarning(h)}return p}EventEmitter$2.prototype.addListener=function p(l,g){return _addListener(this,l,g,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function p(l,g){return _addListener(this,l,g,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(p,l,g){var m={fired:!1,wrapFn:void 0,target:p,type:l,listener:g},x=onceWrapper.bind(m);return x.listener=g,m.wrapFn=x,x}EventEmitter$2.prototype.once=function p(l,g){return checkListener(g),this.on(l,_onceWrap(this,l,g)),this};EventEmitter$2.prototype.prependOnceListener=function p(l,g){return checkListener(g),this.prependListener(l,_onceWrap(this,l,g)),this};EventEmitter$2.prototype.removeListener=function p(l,g){var m,x,E,S,h;if(checkListener(g),x=this._events,x===void 0)return this;if(m=x[l],m===void 0)return this;if(m===g||m.listener===g)--this._eventsCount==0?this._events=Object.create(null):(delete x[l],x.removeListener&&this.emit("removeListener",l,m.listener||g));else if(typeof m!="function"){for(E=-1,S=m.length-1;S>=0;S--)if(m[S]===g||m[S].listener===g){h=m[S].listener,E=S;break}if(E<0)return this;E===0?m.shift():spliceOne(m,E),m.length===1&&(x[l]=m[0]),x.removeListener!==void 0&&this.emit("removeListener",l,h||g)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function p(l){var g,m,x;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[l]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete m[l]),this;if(arguments.length===0){var E=Object.keys(m),S;for(x=0;x<E.length;++x)S=E[x],S!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(g=m[l],typeof g=="function")this.removeListener(l,g);else if(g!==void 0)for(x=g.length-1;x>=0;x--)this.removeListener(l,g[x]);return this};function _listeners(p,l,g){var m=p._events;if(m===void 0)return[];var x=m[l];return x===void 0?[]:typeof x=="function"?g?[x.listener||x]:[x]:g?unwrapListeners(x):arrayClone(x,x.length)}EventEmitter$2.prototype.listeners=function p(l){return _listeners(this,l,!0)};EventEmitter$2.prototype.rawListeners=function p(l){return _listeners(this,l,!1)};EventEmitter$2.listenerCount=function(p,l){return typeof p.listenerCount=="function"?p.listenerCount(l):listenerCount.call(p,l)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(p){var l=this._events;if(l!==void 0){var g=l[p];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}EventEmitter$2.prototype.eventNames=function p(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(p,l){for(var g=new Array(l),m=0;m<l;++m)g[m]=p[m];return g}function spliceOne(p,l){for(;l+1<p.length;l++)p[l]=p[l+1];p.pop()}function unwrapListeners(p){for(var l=new Array(p.length),g=0;g<l.length;++g)l[g]=p[g].listener||p[g];return l}function once(p,l){return new Promise(function(g,m){function x(S){p.removeListener(l,E),m(S)}function E(){typeof p.removeListener=="function"&&p.removeListener("error",x),g([].slice.call(arguments))}eventTargetAgnosticAddListener(p,l,E,{once:!0}),l!=="error"&&addErrorHandlerIfEventEmitter(p,x,{once:!0})})}function addErrorHandlerIfEventEmitter(p,l,g){typeof p.on=="function"&&eventTargetAgnosticAddListener(p,"error",l,g)}function eventTargetAgnosticAddListener(p,l,g,m){if(typeof p.on=="function")m.once?p.once(l,g):p.on(l,g);else if(typeof p.addEventListener=="function")p.addEventListener(l,function x(E){m.once&&p.removeEventListener(l,x),g(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam(p){var l=p.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return l?{key:l[1],value:l[2]}:null}function parseLink(p){var l=p.match(/<?([^>]*)>(.*)/);if(!l)return null;var g=l[1],m=l[2].split(";"),x=null,E=m.reduce(function(S,h){var I=parseParam(h);return I?I.key==="rel"?(x||(x=I.value),S):(S[I.key]=I.value,S):S},{});return x?{url:g,rel:x,params:E}:null}function parseLinkHeader$1(p){return p?p.split(/,\s*</).reduce(function(l,g){var m=parseLink(g);if(!m)return l;var x=m.rel.split(/\s+/);return x.forEach(function(E){l[E]||(l[E]={url:m.url,params:m.params})}),l},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(p,l){this.request=p,this.headers=l.headers,this.rawBody=l.body,this.statusCode=l.statusCode;try{this.body=JSON.parse(l.body||"{}")}catch{this.body=l.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function p(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function p(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$3=constants$4;function MapiError$1(p){var l=p.type||constants$3.ERROR_HTTP,g;if(p.body)try{g=JSON.parse(p.body)}catch{g=p.body}else g=null;var m=p.message||null;m||(typeof g=="string"?m=g:g&&typeof g.message=="string"?m=g.message:l===constants$3.ERROR_REQUEST_ABORTED&&(m="Request aborted")),this.message=m,this.type=l,this.statusCode=p.statusCode||null,this.request=p.request,this.body=g}var mapiError=MapiError$1;function parseSingleHeader(p){var l=p.indexOf(":"),g=p.substring(0,l).trim().toLowerCase(),m=p.substring(l+1).trim();return{name:g,value:m}}function parseHeaders$1(p){var l={};return p&&p.trim().split(/[\r|\n]+/).forEach(function(g){var m=parseSingleHeader(g);l[m.name]=m.value}),l}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants$2=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(p){var l=requestsUnderway[p.id];!l||(l.abort(),delete requestsUnderway[p.id])}function createResponse(p,l){return new MapiResponse(p,{body:l.response,headers:parseHeaders(l.getAllResponseHeaders()),statusCode:l.status})}function normalizeBrowserProgressEvent(p){var l=p.total,g=p.loaded,m=100*g/l;return{total:l,transferred:g,percent:m}}function sendRequestXhr(p,l){return new Promise(function(g,m){l.onprogress=function(S){p.emitter.emit(constants$2.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(S))};var x=p.file;x&&(l.upload.onprogress=function(S){p.emitter.emit(constants$2.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(S))}),l.onerror=function(S){m(S)},l.onabort=function(){var S=new MapiError({request:p,type:constants$2.ERROR_REQUEST_ABORTED});m(S)},l.onload=function(){if(delete requestsUnderway[p.id],l.status<200||l.status>=400){var S=new MapiError({request:p,body:l.response,statusCode:l.status});m(S);return}g(l)};var E=p.body;typeof E=="string"?l.send(E):E?l.send(JSON.stringify(E)):x?l.send(x):l.send(),requestsUnderway[p.id]=l}).then(function(g){return createResponse(p,g)})}function createRequestXhr(p,l){var g=p.url(l),m=new window.XMLHttpRequest;return m.open(p.method,g),Object.keys(p.headers).forEach(function(x){m.setRequestHeader(x,p.headers[x])}),m}function browserSend(p){return Promise.resolve().then(function(){var l=createRequestXhr(p,p.client.accessToken);return sendRequestXhr(p,l)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(p,l){(function(g){var m=l,x=p&&p.exports==m&&p,E=typeof commonjsGlobal=="object"&&commonjsGlobal;(E.global===E||E.window===E)&&(g=E);var S=function(M){this.message=M};S.prototype=new Error,S.prototype.name="InvalidCharacterError";var h=function(M){throw new S(M)},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/[\t\n\f\r ]/g,A=function(M){M=String(M).replace(T,"");var F=M.length;F%4==0&&(M=M.replace(/==?$/,""),F=M.length),(F%4==1||/[^+a-zA-Z0-9/]/.test(M))&&h("Invalid character: the string to be decoded is not correctly encoded.");for(var N=0,B,U,O="",V=-1;++V<F;)U=I.indexOf(M.charAt(V)),B=N%4?B*64+U:U,N++%4&&(O+=String.fromCharCode(255&B>>(-2*N&6)));return O},k=function(M){M=String(M),/[^\0-\xFF]/.test(M)&&h("The string to be encoded contains characters outside of the Latin1 range.");for(var F=M.length%3,N="",B=-1,U,O,V,Z,W=M.length-F;++B<W;)U=M.charCodeAt(B)<<16,O=M.charCodeAt(++B)<<8,V=M.charCodeAt(++B),Z=U+O+V,N+=I.charAt(Z>>18&63)+I.charAt(Z>>12&63)+I.charAt(Z>>6&63)+I.charAt(Z&63);return F==2?(U=M.charCodeAt(B)<<8,O=M.charCodeAt(++B),Z=U+O,N+=I.charAt(Z>>10)+I.charAt(Z>>4&63)+I.charAt(Z<<2&63)+"="):F==1&&(Z=M.charCodeAt(B),N+=I.charAt(Z>>2)+I.charAt(Z<<4&63)+"=="),N},P={encode:k,decode:A,version:"0.1.0"};if(m&&!m.nodeType)if(x)x.exports=P;else for(var D in P)P.hasOwnProperty(D)&&(m[D]=P[D]);else g.base64=P})(commonjsGlobal)})(base64$1,base64$1.exports);var base64=base64$1.exports,tokenCache={};function parseToken$2(p){if(tokenCache[p])return tokenCache[p];var l=p.split("."),g=l[0],m=l[1];if(!m)throw new Error("Invalid token");var x=parsePaylod(m),E={usage:g,user:x.u};return has(x,"a")&&(E.authorization=x.a),has(x,"exp")&&(E.expires=x.exp*1e3),has(x,"iat")&&(E.created=x.iat*1e3),has(x,"scopes")&&(E.scopes=x.scopes),has(x,"client")&&(E.client=x.client),has(x,"ll")&&(E.lastLogin=x.ll),has(x,"iu")&&(E.impersonator=x.iu),tokenCache[p]=E,E}function parsePaylod(p){try{return JSON.parse(base64.decode(p))}catch{throw new Error("Invalid token")}}function has(p,l){return Object.prototype.hasOwnProperty.call(p,l)}var parseMapboxToken=parseToken$2,eventemitter3={exports:{}};(function(p){var l=Object.prototype.hasOwnProperty,g="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(g=!1));function x(I,T,A){this.fn=I,this.context=T,this.once=A||!1}function E(I,T,A,k,P){if(typeof A!="function")throw new TypeError("The listener must be a function");var D=new x(A,k||I,P),M=g?g+T:T;return I._events[M]?I._events[M].fn?I._events[M]=[I._events[M],D]:I._events[M].push(D):(I._events[M]=D,I._eventsCount++),I}function S(I,T){--I._eventsCount==0?I._events=new m:delete I._events[T]}function h(){this._events=new m,this._eventsCount=0}h.prototype.eventNames=function(){var T=[],A,k;if(this._eventsCount===0)return T;for(k in A=this._events)l.call(A,k)&&T.push(g?k.slice(1):k);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(A)):T},h.prototype.listeners=function(T){var A=g?g+T:T,k=this._events[A];if(!k)return[];if(k.fn)return[k.fn];for(var P=0,D=k.length,M=new Array(D);P<D;P++)M[P]=k[P].fn;return M},h.prototype.listenerCount=function(T){var A=g?g+T:T,k=this._events[A];return k?k.fn?1:k.length:0},h.prototype.emit=function(T,A,k,P,D,M){var F=g?g+T:T;if(!this._events[F])return!1;var N=this._events[F],B=arguments.length,U,O;if(N.fn){switch(N.once&&this.removeListener(T,N.fn,void 0,!0),B){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,A),!0;case 3:return N.fn.call(N.context,A,k),!0;case 4:return N.fn.call(N.context,A,k,P),!0;case 5:return N.fn.call(N.context,A,k,P,D),!0;case 6:return N.fn.call(N.context,A,k,P,D,M),!0}for(O=1,U=new Array(B-1);O<B;O++)U[O-1]=arguments[O];N.fn.apply(N.context,U)}else{var V=N.length,Z;for(O=0;O<V;O++)switch(N[O].once&&this.removeListener(T,N[O].fn,void 0,!0),B){case 1:N[O].fn.call(N[O].context);break;case 2:N[O].fn.call(N[O].context,A);break;case 3:N[O].fn.call(N[O].context,A,k);break;case 4:N[O].fn.call(N[O].context,A,k,P);break;default:if(!U)for(Z=1,U=new Array(B-1);Z<B;Z++)U[Z-1]=arguments[Z];N[O].fn.apply(N[O].context,U)}}return!0},h.prototype.on=function(T,A,k){return E(this,T,A,k,!1)},h.prototype.once=function(T,A,k){return E(this,T,A,k,!0)},h.prototype.removeListener=function(T,A,k,P){var D=g?g+T:T;if(!this._events[D])return this;if(!A)return S(this,D),this;var M=this._events[D];if(M.fn)M.fn===A&&(!P||M.once)&&(!k||M.context===k)&&S(this,D);else{for(var F=0,N=[],B=M.length;F<B;F++)(M[F].fn!==A||P&&!M[F].once||k&&M[F].context!==k)&&N.push(M[F]);N.length?this._events[D]=N.length===1?N[0]:N:S(this,D)}return this},h.prototype.removeAllListeners=function(T){var A;return T?(A=g?g+T:T,this._events[A]&&S(this,A)):(this._events=new m,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=g,h.EventEmitter=h,p.exports=h})(eventemitter3);function encodeArray(p){return p.map(encodeURIComponent).join(",")}function encodeValue(p){return Array.isArray(p)?encodeArray(p):encodeURIComponent(String(p))}function appendQueryParam(p,l,g){if(g===!1||g===null)return p;var m=/\?/.test(p)?"&":"?",x=encodeURIComponent(l);return g!==void 0&&g!==""&&g!==!0&&(x+="="+encodeValue(g)),""+p+m+x}function appendQueryObject(p,l){if(!l)return p;var g=p;return Object.keys(l).forEach(function(m){var x=l[m];x!==void 0&&(Array.isArray(x)&&(x=x.filter(function(E){return E!=null}).join(",")),g=appendQueryParam(g,m,x))}),g}function prependOrigin(p,l){if(!l||p.slice(0,4)==="http")return p;var g=p[0]==="/"?"":"/";return""+l.replace(/\/$/,"")+g+p}function interpolateRouteParams(p,l){return l?p.replace(/\/:([a-zA-Z0-9]+)/g,function(g,m){var x=l[m];if(x===void 0)throw new Error("Unspecified route parameter "+m);var E=encodeValue(x);return"/"+E}):p}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},parseToken$1=parseMapboxToken,xtend$3=immutable,EventEmitter$1=eventemitter3.exports,urlUtils=urlUtils$1,constants$1=constants$4,requestId=1;function MapiRequest$1(p,l){if(!p)throw new Error("MapiRequest requires a client");if(!l||!l.path||!l.method)throw new Error("MapiRequest requires an options object with path and method properties");var g={};l.body&&(g["content-type"]="application/json");var m=xtend$3(g,l.headers),x=Object.keys(m).reduce(function(E,S){return E[S.toLowerCase()]=m[S],E},{});this.id=requestId++,this._options=l,this.emitter=new EventEmitter$1,this.client=p,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=l.path,this.method=l.method,this.origin=l.origin||p.origin,this.query=l.query||{},this.params=l.params||{},this.body=l.body||null,this.file=l.file||null,this.encoding=l.encoding||"utf8",this.sendFileAs=l.sendFileAs||null,this.headers=x}MapiRequest$1.prototype.url=function p(l){var g=urlUtils.prependOrigin(this.path,this.origin);g=urlUtils.appendQueryObject(g,this.query);var m=this.params,x=l==null?this.client.accessToken:l;if(x){g=urlUtils.appendQueryParam(g,"access_token",x);var E=parseToken$1(x).user;m=xtend$3({ownerId:E},m)}return g=urlUtils.interpolateRouteParams(g,m),g};MapiRequest$1.prototype.send=function p(){var l=this;if(l.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return l.sent=!0,l.client.sendRequest(l).then(function(g){return l.response=g,l.emitter.emit(constants$1.EVENT_RESPONSE,g),g},function(g){throw l.error=g,l.emitter.emit(constants$1.EVENT_ERROR,g),g})};MapiRequest$1.prototype.abort=function p(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function p(l){var g=this;function m(S){function h(){delete g._nextPageRequest;var I=S.nextPage();I&&(g._nextPageRequest=I,E(I))}l(null,S,h)}function x(S){l(S,null,function(){})}function E(S){S.send().then(m,x)}E(this)};MapiRequest$1.prototype.clone=function p(){return this._extend()};MapiRequest$1.prototype._extend=function p(l){var g=xtend$3(this._options,l);return new MapiRequest$1(this.client,g)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants=constants$4;function MapiClient$2(p){if(!p||!p.accessToken)throw new Error("Cannot create a client without an access token");parseToken(p.accessToken),this.accessToken=p.accessToken,this.origin=p.origin||constants.API_ORIGIN}MapiClient$2.prototype.createRequest=function p(l){return new MapiRequest(this,l)};var mapiClient=MapiClient$2,browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(p){MapiClient$1.call(this,p)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(p){return new BrowserClient(p)}var browserClient=createBrowserClient,client=browserClient,mapboxSdk=client,toString=Object.prototype.toString,isPlainObj=function(p){var l;return toString.call(p)==="[object Object]"&&(l=Object.getPrototypeOf(p),l===null||l===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$2=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$3={};v$3.assert=function(p,l){return l=l||{},function(g){var m=validate(p,g);if(!!m){var x=processMessage(m,l);throw l.apiName&&(x=l.apiName+": "+x),new Error(x)}}};v$3.shape=function p(l){var g=objectEntries(l);return function(x){var E=validate(v$3.plainObject,x);if(E)return E;for(var S,h,I=[],T=0;T<g.length;T++)S=g[T].key,h=g[T].value,E=validate(h,x[S]),E&&I.push([S].concat(E));return I.length<2?I[0]:function(A){I=I.map(function(D){var M=D[0],F=processMessage(D,A).split(`
`).join(NEWLINE_INDENT);return"- "+M+": "+F});var k=A.path.join("."),P=k===DEFAULT_ERROR_PATH?"":" of "+k;return"The following properties"+P+" have invalid values:"+NEWLINE_INDENT+I.join(NEWLINE_INDENT)}}};v$3.strictShape=function p(l){var g=v$3.shape(l);return function(x){var E=g(x);if(E)return E;var S=Object.keys(x).reduce(function(h,I){return l[I]===void 0&&h.push(I),h},[]);if(S.length!==0)return function(){return"The following keys are invalid: "+S.join(", ")}}};v$3.arrayOf=function p(l){return createArrayValidator(l)};v$3.tuple=function p(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(l)};function createArrayValidator(p){var l=Array.isArray(p),g=function(m){return l?p[m]:p};return function(x){var E=validate(v$3.plainArray,x);if(E)return E;if(l&&x.length!==p.length)return"an array with "+p.length+" items";for(var S=0;S<x.length;S++)if(E=validate(g(S),x[S]),E)return[S].concat(E)}}v$3.required=function p(l){function g(m){return m==null?function(x){return formatErrorMessage(x,isArrayCulprit(x.path)?"cannot be undefined/null.":"is required.")}:l.apply(this,arguments)}return g.__required=!0,g};v$3.oneOfType=function p(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(m){var x=l.map(function(E){return validate(E,m)}).filter(Boolean);if(x.length===l.length)return x.every(function(E){return E.length===1&&typeof E[0]=="string"})?orList(x.map(function(E){return E[0]})):x.reduce(function(E,S){return S.length>E.length?S:E})}};v$3.equal=function p(l){return function(m){if(m!==l)return JSON.stringify(l)}};v$3.oneOf=function p(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),g=l.map(function(m){return v$3.equal(m)});return v$3.oneOfType.apply(this,g)};v$3.range=function p(l){var g=l[0],m=l[1];return function(E){var S=validate(v$3.number,E);if(S||E<g||E>m)return"number between "+g+" & "+m+" (inclusive)"}};v$3.any=function p(){};v$3.boolean=function p(l){if(typeof l!="boolean")return"boolean"};v$3.number=function p(l){if(typeof l!="number")return"number"};v$3.plainArray=function p(l){if(!Array.isArray(l))return"array"};v$3.plainObject=function p(l){if(!isPlainObject(l))return"object"};v$3.string=function p(l){if(typeof l!="string")return"string"};v$3.func=function p(l){if(typeof l!="function")return"function"};function validate(p,l){if(!(l==null&&!p.hasOwnProperty("__required"))){var g=p(l);if(g)return Array.isArray(g)?g:[g]}}function processMessage(p,l){var g=p.length,m=p[g-1],x=p.slice(0,g-1);return x.length===0&&(x=[DEFAULT_ERROR_PATH]),l=xtend$2(l,{path:x}),typeof m=="function"?m(l):formatErrorMessage(l,prettifyResult(m))}function orList(p){return p.length<2?p[0]:p.length===2?p.join(" or "):p.slice(0,-1).join(", ")+", or "+p.slice(-1)}function prettifyResult(p){return"must be "+addArticle(p)+"."}function addArticle(p){return/^an? /.test(p)?p:/^[aeiou]/i.test(p)?"an "+p:/^[a-z]/i.test(p)?"a "+p:p}function formatErrorMessage(p,l){var g=isArrayCulprit(p.path),m=p.path.join(".")+" "+l,x=g?"Item at position ":"";return x+m}function isArrayCulprit(p){return typeof p[p.length-1]=="number"||typeof p[0]=="number"}function objectEntries(p){return Object.keys(p||{}).map(function(l){return{key:l,value:p[l]}})}v$3.validate=validate;v$3.processMessage=processMessage;var lib$1=v$3,xtend$1=immutable,v$2=lib$1;function file(p){if(typeof window!="undefined")return p instanceof commonjsGlobal.Blob||p instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof p=="string"||p.pipe!==void 0))return"Filename or Readable stream"}function assertShape(p,l){return v$2.assert(v$2.strictShape(p),l)}function date(p){var l="date";if(typeof p=="boolean")return l;try{var g=new Date(p);if(g.getTime&&isNaN(g.getTime()))return l}catch{return l}}function coordinates(p){return v$2.tuple(v$2.number,v$2.number)(p)}var validator=xtend$1(v$2,{file,date,coordinates,assertShape});function pick$1(p,l){var g=function(m,x){return l.indexOf(m)!==-1&&x!==void 0};return typeof l=="function"&&(g=l),Object.keys(p).filter(function(m){return g(m,p[m])}).reduce(function(m,x){return m[x]=p[x],m},{})}var pick_1=pick$1;function objectMap$1(p,l){return Object.keys(p).reduce(function(g,m){return g[m]=l(m,p[m]),g},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(p){return objectMap(p,function(l,g){return typeof g=="boolean"?JSON.stringify(g):g})}var stringifyBooleans$1=stringifyBoolean,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(p){return function(l){var g;MapiClient.prototype.isPrototypeOf(l)?g=l:g=createClient(l);var m=Object.create(p);return m.client=g,m}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v$1=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(p){v$1.assertShape({query:v$1.required(v$1.string),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),proximity:v$1.coordinates,types:v$1.arrayOf(v$1.oneOf(featureTypes)),autocomplete:v$1.boolean,bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),routing:v$1.boolean,fuzzyMatch:v$1.boolean,worldview:v$1.string})(p),p.mode=p.mode||"mapbox.places";var l=stringifyBooleans(xtend({country:p.countries},pick(p,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(p,["mode","query"]),query:l})};Geocoding.reverseGeocode=function(p){v$1.assertShape({query:v$1.required(v$1.coordinates),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),types:v$1.arrayOf(v$1.oneOf(featureTypes)),bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),reverseMode:v$1.oneOf("distance","score"),routing:v$1.boolean,worldview:v$1.string})(p),p.mode=p.mode||"mapbox.places";var l=stringifyBooleans(xtend({country:p.countries},pick(p,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(p,["mode","query"]),query:l})};var geocoding=createServiceFactory(Geocoding),crypto=self.crypto||self.msCrypto,url="-_",i$1=36;for(;i$1--;)url+=i$1.toString(36);i$1=36;for(;i$1---10;)url+=i$1.toString(36).toUpperCase();var index_browser=function(p){var l="",g=crypto.getRandomValues(new Uint8Array(p||21));for(i$1=p||21;i$1--;)l+=url[g[i$1]&63];return l},nanoid=index_browser;function MapboxEventManager$1(p){this.origin=p.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=p.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=p,this.send=this.send.bind(this),this.countries=p.countries?p.countries.split(","):null,this.types=p.types?p.types.split(","):null,this.bbox=p.bbox?p.bbox:null,this.language=p.language?p.language.split(","):null,this.limit=p.limit?+p.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(p),this.eventQueue=new Array,this.flushInterval=p.flushInterval||1e3,this.maxQueueSize=p.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(p,l){var g=this.getSelectedIndex(p,l),m=this.getEventPayload("search.select",l);if(m.resultIndex=g,m.resultPlaceName=p.place_name,m.resultId=p.id,!(g===this.lastSentIndex&&m.queryString===this.lastSentInput||g==-1)&&(this.lastSentIndex=g,this.lastSentInput=m.queryString,!!m.queryString))return this.push(m)},start:function(p){var l=this.getEventPayload("search.start",p);if(!!l.queryString)return this.push(l)},keyevent:function(p,l){if(!!p.key&&!(p.metaKey||[9,27,37,39,13,38,40].indexOf(p.keyCode)!==-1)){var g=this.getEventPayload("search.keystroke",l);if(g.lastAction=p.key,!!g.queryString)return this.push(g)}},send:function(p,l){if(!this.enableEventLogging)return l?l():void 0;var g=this.getRequestOptions(p);this.request(g,function(m){if(m)return this.handleError(m,l);if(l)return l()}.bind(this))},getRequestOptions:function(p){Array.isArray(p)||(p=[p]);var l={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(p)};return l},getEventPayload:function(p,l){var g;l.options.proximity?g=[l.options.proximity.longitude,l.options.proximity.latitude]:g=null;var m=l._map?l._map.getZoom():void 0,x={event:p,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:l.options.autocomplete,fuzzyMatch:l.options.fuzzyMatch,proximity:g,limit:l.options.limit,routing:l.options.routing,worldview:l.options.worldview,mapZoom:m,keyboardLocale:this.locale};return p==="search.select"?x.queryString=l.inputString:p!="search.select"&&l._inputEl?x.queryString=l._inputEl.value:x.queryString=l.inputString,x},request:function(p,l){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(this.readyState==4)return this.status==204?l(null):l(this.statusText)},g.open(p.method,p.host+"/"+p.path,!0);for(var m in p.headers){var x=p.headers[m];g.setRequestHeader(m,x)}g.send(p.body)},handleError:function(p,l){if(l)return l(p)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(p,l){if(!!l._typeahead){var g=l._typeahead.data,m=p.id,x=g.map(function(S){return S.id}),E=x.indexOf(m);return E}},shouldEnableLogging:function(p){return!(p.enableEventLogging===!1||p.origin&&p.origin.indexOf("api.mapbox.com")==-1||p.localGeocoder||p.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(p,l){this.eventQueue.push(p),(this.eventQueue.length>=this.maxQueueSize||l)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},localization$1={placeholder},subtag$1={exports:{}};(function(p){(function(l,g,m){p.exports?p.exports=m():l[g]=m()})(commonjsGlobal,"subtag",function(){var l="",g=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function m(I){return I.match(g)||[]}function x(I){return m(I).filter(function(T,A){return T&&A})}function E(I){return I=m(I),{language:I[1]||l,extlang:I[2]||l,script:I[3]||l,region:I[4]||l}}function S(I,T,A){Object.defineProperty(I,T,{value:A,enumerable:!0})}function h(I,T,A){function k(P){return m(P)[I]||l}S(k,"pattern",T),S(E,A,k)}return h(1,/^[a-zA-Z]{2,3}$/,"language"),h(2,/^[a-zA-Z]{3}$/,"extlang"),h(3,/^[a-zA-Z]{4}$/,"script"),h(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),S(E,"split",x),E})})(subtag$1);var Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter=events$1.exports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding,MapboxEventManager=events,localization=localization$1,subtag=subtag$1.exports;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function MapboxGeocoder(p){this._eventEmitter=new EventEmitter,this.options=extend({},this.options,p),this.inputString="",this.fresh=!0,this.lastSelected=null}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(p){return p.place_name},render:function(p){var l=p.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+l[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+l.splice(1,l.length).join(",")+"</div></div>"}},addTo:function(p){function l(g,m){if(!document.body.contains(m))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const x=g.onAdd();m.appendChild(x)}if(p._controlContainer)p.addControl(this);else if(p instanceof HTMLElement)l(this,p);else if(typeof p=="string"){const g=document.querySelectorAll(p);if(g.length===0)throw new Error("Element ",p,"not found.");if(g.length>1)throw new Error("Geocoder can only be added to a single html element");l(this,g[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(p){if(p&&typeof p!="string"&&(this._map=p),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var l=this.container=document.createElement("div");l.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var g=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(E){this.eventManager.keyevent(E,this)}.bind(this));var m=document.createElement("div");m.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var x=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(x),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),m.appendChild(this._clearEl),m.appendChild(this._loadingEl),l.appendChild(g),l.appendChild(this._inputEl),l.appendChild(m),this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),l},createIcon:function(p,l){var g=document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+p),g.setAttribute("viewBox","0 0 18 18"),g.setAttribute("xml:space","preserve"),g.setAttribute("width",18),g.setAttribute("height",18),"innerHTML"in g)g.innerHTML=l;else{var m=document.createElement("div");m.innerHTML="<svg>"+l.valueOf().toString()+"</svg>";var x=m.firstChild,E=x.firstChild;g.appendChild(E)}return g},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(p){var l=(p.clipboardData||window.clipboardData).getData("text");l.length>=this.options.minLength&&this._geocode(l)},_onKeyDown:function(p){var l=27,g=9;if(p.keyCode===l&&this.options.clearAndBlurOnEsc)return this._clear(p),this._inputEl.blur();var m=p.target&&p.target.shadowRoot?p.target.shadowRoot.activeElement:p.target,x=m?m.value:"";if(!x)return this.fresh=!0,p.keyCode!==g&&this.clear(p),this._clearEl.style.display="none";p.metaKey||[g,l,37,39,13,38,40].indexOf(p.keyCode)!==-1||m.value.length>=this.options.minLength&&this._geocode(m.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(p){this.options.clearOnBlur&&this._clearOnBlur(p),this.options.collapsed&&this._collapse()},_onChange:function(){var p=this._typeahead.selected;if(p&&JSON.stringify(p)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var l;if(p.properties&&exceptions[p.properties.short_code])l=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[p.properties.short_code].bbox,l);else if(p.bbox){var g=p.bbox;l=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[g[0],g[1]],[g[2],g[3]]],l)}else{var m={zoom:this.options.zoom};l=extend({},m,this.options.flyTo),p.center?l.center=p.center:p.geometry&&p.geometry.type&&p.geometry.type==="Point"&&p.geometry.coordinates&&(l.center=p.geometry.coordinates),this._map&&this._map.flyTo(l)}}this.options.marker&&this._mapboxgl&&this._handleMarker(p),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(p),this._eventEmitter.emit("result",{result:p}),this.eventManager.select(p,this)}},_requestType:function(p,l){var g;const m=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return p.localGeocoderOnly?g=GEOCODE_REQUEST_TYPE.LOCAL:p.reverseGeocode&&m.test(l)?g=GEOCODE_REQUEST_TYPE.REVERSE:g=GEOCODE_REQUEST_TYPE.FORWARD,g},_setupConfig:function(p,l){const g=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],m=/[\s,]+/;var x=this,E=g.reduce(function(h,I){if(x.options[I]===void 0||x.options[I]===null)return h;["countries","types","language"].indexOf(I)>-1?h[I]=x.options[I].split(m):h[I]=x.options[I];const T=typeof x.options[I].longitude=="number"&&typeof x.options[I].latitude=="number";if(I==="proximity"&&T){const A=x.options[I].longitude,k=x.options[I].latitude;h[I]=[A,k]}return h},{});switch(p){case GEOCODE_REQUEST_TYPE.REVERSE:{var S=l.split(m).map(function(h){return parseFloat(h,10)}).reverse();E.types&&E.types[0],E=extend(E,{query:S,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(h){h in E&&delete E[h]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(l)&&(l=l.replace(/,/g," ")),E=extend(E,{query:l});break}return E},_geocode:function(p){this.inputString=p,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:p});const l=this._requestType(this.options,p),g=this._setupConfig(l,p);var m;switch(l){case GEOCODE_REQUEST_TYPE.LOCAL:m=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:m=this.geocoderService.forwardGeocode(g).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:m=this.geocoderService.reverseGeocode(g).send();break}var x=this.options.localGeocoder?this.options.localGeocoder(p)||[]:[],E=[],S=null;return m.catch(function(h){S=h}.bind(this)).then(function(h){this._loadingEl.style.display="none";var I={};return h?h.statusCode=="200"&&(I=h.body,I.request=h.request,I.headers=h.headers):I={type:"FeatureCollection",features:[]},I.config=g,this.fresh&&(this.eventManager.start(this),this.fresh=!1),I.features=I.features?x.concat(I.features):x,this.options.externalGeocoder?(E=this.options.externalGeocoder(p,I.features)||[],E.then(function(T){return I.features=I.features?T.concat(I.features):T,I},function(){return I})):I}.bind(this)).then(function(h){if(S)throw S;this.options.filter&&h.features.length&&(h.features=h.features.filter(this.options.filter)),h.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",h),this._typeahead.update(h.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",h))}.bind(this)).catch(function(h){this._loadingEl.style.display="none",x.length&&this.options.localGeocoder||E.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(x)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:x}),this._eventEmitter.emit("error",{error:h})}.bind(this)),m},_clear:function(p){p&&p.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(p){this._clear(p),this._inputEl.focus()},_clearOnBlur:function(p){var l=this;p.relatedTarget&&l._clear(p)},_onQueryResult:function(p){var l=p.body;if(!!l.features.length){var g=l.features[0];this._typeahead.selected=g,this._inputEl.value=g.place_name,this._onChange()}},_updateProximity:function(){if(!!this._map)if(this._map.getZoom()>9){var p=this._map.getCenter().wrap();this.setProximity({longitude:p.lng,latitude:p.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(p){return this._geocode(p).then(this._onQueryResult),this},_renderError:function(){var p="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(p)},_renderNoResults:function(){var p="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(p)},_renderMessage:function(p){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(p)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var p=this.options.language.split(",")[0],l=subtag.language(p),g=localization.placeholder[l];if(g)return g}return"Search"},setInput:function(p){return this._inputEl.value=p,this._typeahead.selected=null,this._typeahead.clear(),p.length>=this.options.minLength&&this._geocode(p),this},setProximity:function(p){return this.options.proximity=p,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(p){return p&&typeof p=="function"&&(this._typeahead.render=p),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(p){var l=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=p||this.options.language||l,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(p){return this.options.zoom=p,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(p){return this.options.flyTo=p,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(p){return this.placeholder=p||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(p){return this.options.bbox=p,this},getCountries:function(){return this.options.countries},setCountries:function(p){return this.options.countries=p,this},getTypes:function(){return this.options.types},setTypes:function(p){return this.options.types=p,this},getMinLength:function(){return this.options.minLength},setMinLength:function(p){return this.options.minLength=p,this._typeahead&&(this._typeahead.options.minLength=p),this},getLimit:function(){return this.options.limit},setLimit:function(p){return this.options.limit=p,this._typeahead&&(this._typeahead.options.limit=p),this},getFilter:function(){return this.options.filter},setFilter:function(p){return this.options.filter=p,this},setOrigin:function(p){return this.options.origin=p,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(p){return this.options.autocomplete=p,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(p){return this.options.fuzzyMatch=p,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(p){return this.options.routing=p,this},getRouting:function(){return this.options.routing},setWorldview:function(p){return this.options.worldview=p,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(p){if(!!this._map){this._removeMarker();var l={color:"#4668F2"},g=extend({},l,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(g),p.center?this.mapMarker.setLngLat(p.center).addTo(this._map):p.geometry&&p.geometry.type&&p.geometry.type==="Point"&&p.geometry.coordinates&&this.mapMarker.setLngLat(p.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(p,l){return this._eventEmitter.on(p,l),this},off:function(p,l){return this._eventEmitter.removeListener(p,l),this.eventManager.remove(),this}};var lib=MapboxGeocoder,mapboxMapViewer_vue_vue_type_style_index_0_lang="";const _sfc_main$4={name:"mapbox-map-viewer",setup(){return{dirHandle:ref(""),style_url:ref(""),access_token:ref(""),mapbox_raster_png_dem:ref(""),terrain_threed_dem:ref(""),map:ref(""),bb:ref(null),threedview:ref(!1),style:ref("streets-v11"),style_options:[{label:"Default",value:"streets-v11"},{label:"Satellite",value:"satellite-streets-v11"}]}},mounted(){},methods:{async loadMapboxMap(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem"),this.terrain_threed_dem=await idbKeyval.get("terrain_threed_dem");let p=this,l=new mapboxgl.Map({container:"map",trackResize:!0,style:p.style_url,center:[-121.7598,46.876],zoom:9,doubleClickZoom:!0,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=l;const g=function(S){const h=S.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!h)return null;function I(P,D){return{center:[P,D],geometry:{type:"Point",coordinates:[P,D]},place_name:"Lat: "+D+" Lng: "+P,place_type:["coordinate"],properties:{},type:"Feature"}}const T=Number(h[1]),A=Number(h[2]),k=[];return(T<-90||T>90)&&k.push(I(T,A)),(A<-90||A>90)&&k.push(I(A,T)),k.length===0&&(k.push(I(T,A)),k.push(I(A,T))),k};l.addControl(new lib({accessToken:this.access_token,mapboxgl,localGeocoder:g,zoom:10,placeholder:"Try: -40, 170 or  Name",reverseGeocode:!0})),l.addControl(new mapboxgl.FullscreenControl({})),l.addControl(new mapboxgl.NavigationControl);const m=100,x=25;function E(S){return S*(2-S)}l.on("load",function(){l.getCanvas().focus(),l.getCanvas().addEventListener("keydown",S=>{S.preventDefault(),S.which===87?l.panBy([0,-m],{easing:E}):S.which===83?l.panBy([0,m],{easing:E}):S.which===65?l.easeTo({bearing:l.getBearing()-x,easing:E}):S.which===68&&l.easeTo({bearing:l.getBearing()+x,easing:E})},!0),l.addSource("mapbox_raster_png_dem",{type:"raster-dem",url:p.mapbox_raster_png_dem}),l.addLayer({id:"hillshading",source:"mapbox_raster_png_dem",type:"hillshade"}),l.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),l.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",layout:{},paint:{"fill-color":"#008888","fill-opacity":0}}),l.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),l.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),l.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),l.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),l.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),l.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon")}),l.on("error",S=>{console.error(S)}),l.on("click",async function(S){let h=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(h,!0)===!1){console.error(`User did not grant permission to '${h.name}'`);return}let I=S.lngLat.lng,T=S.lngLat.lat,A=mapUtils.getTileInfo(I,T,l);idbKeyval.set("tile_info",A),l.getSource("bounding_box_source").setData(A.bb),l.setPaintProperty("bounding_box","fill-opacity",.45);let P=await idbKeyval.get("mapbox_api_url")+`/mapbox.terrain-rgb/${A.z}/${A.x}/${A.y}@2x.pngraw?access_token=`+p.access_token,D=await fileUtils.getMapboxTerrainRgb(h,A,P),M=D.toBuffer();await idbKeyval.set("rgb_image_buffer",M),await fileUtils.writeFileToDisk(h,A.rgbFileName,M);let F=await fileUtils.createHeightMapImage(D,32,"GREY");if(await fileUtils.fileExists(h,A.thirtytwoFile.name)===!1){let B=await F.image.toBuffer();await fileUtils.writeFileToDisk(h,A.thirtytwoFile.name,B)}emitter.emit("updatePreviewImage",{dir_handle:h,tile_info:A,preview_image:F.image,stats:F.stats,map:l})}),l.on("mousemove",S=>{l.getCanvas().style.cursor="pointer";const h=l.queryRenderedFeatures(S.point);let I={};for(const T of h)if(Object.keys(T.type).length>0&&Object.keys(T.properties).length>0){let A=T.properties,k=T.layer;A.DEPTH&&(I.depth=A.DEPTH,console.log(I)),I.type=T.type,I.id=k.id}})},resizeMap(){this.map.resize()},async changeStyle(){this.map.getSource("mapbox-threeD")&&(this.map.setTerrain(null),this.map.removeSource("mapbox-threeD"),this.threedview=!1),this.map.setStyle("mapbox://styles/mapbox/"+this.style)},change3D(){this.threedview===!0?(this.map.addSource("mapbox-threeD",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.map.setTerrain({source:"mapbox-threeD",exaggeration:1.5})):(this.map.setTerrain(null),this.map.removeSource("mapbox-threeD"))},async geoCodeReverse(p){await lib.reverseGeocode({query:[p.lng,p.lat]}).send().then(function(l){l&&l.body&&l.body.features&&(p.address=l.body.features[0].place_name)})}}},_hoisted_1$4={id:"map"};function _sfc_render$3(p,l,g,m,x,E){const S=resolveComponent("q-option-group"),h=resolveComponent("q-toggle"),I=resolveComponent("q-toolbar");return openBlock(),createElementBlock("div",_hoisted_1$4,[createVNode(I,{id:"mb-tbar",class:"bg-black text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(S,{class:"q-pl-sm",modelValue:m.style,"onUpdate:modelValue":[l[0]||(l[0]=T=>m.style=T),E.changeStyle],options:m.style_options,color:"primary",inline:"",dense:"",dark:""},null,8,["modelValue","options","onUpdate:modelValue"]),createVNode(h,{dark:"",modelValue:m.threedview,"onUpdate:modelValue":[l[1]||(l[1]=T=>m.threedview=T),E.change3D],label:"3D view"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})])}var MapboxMapViewer=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]),jimp={exports:{}};(function(p,l){if((typeof g=="undefined"||!g)&&typeof self!="undefined")var g=self;(function(m){p.exports=m()})(function(){return function(){function m(x,E,S){function h(A,k){if(!E[A]){if(!x[A]){var P=typeof commonjsRequire=="function"&&commonjsRequire;if(!k&&P)return P(A,!0);if(I)return I(A,!0);var D=new Error("Cannot find module '"+A+"'");throw D.code="MODULE_NOT_FOUND",D}var M=E[A]={exports:{}};x[A][0].call(M.exports,function(F){var N=x[A][1][F];return h(N||F)},M,M.exports,m,x,E,S)}return E[A].exports}for(var I=typeof commonjsRequire=="function"&&commonjsRequire,T=0;T<S.length;T++)h(S[T]);return h}return m}()({1:[function(m,x,E){function S(h){if(Array.isArray(h))return h}x.exports=S},{}],2:[function(m,x,E){function S(h){if(Array.isArray(h)){for(var I=0,T=new Array(h.length);I<h.length;I++)T[I]=h[I];return T}}x.exports=S},{}],3:[function(m,x,E){function S(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}x.exports=S},{}],4:[function(m,x,E){function S(h,I){if(!(h instanceof I))throw new TypeError("Cannot call a class as a function")}x.exports=S},{}],5:[function(m,x,E){var S=m("./setPrototypeOf");function h(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function I(T,A,k){return h()?x.exports=I=Reflect.construct:x.exports=I=function(D,M,F){var N=[null];N.push.apply(N,M);var B=Function.bind.apply(D,N),U=new B;return F&&S(U,F.prototype),U},I.apply(null,arguments)}x.exports=I},{"./setPrototypeOf":18}],6:[function(m,x,E){function S(I,T){for(var A=0;A<T.length;A++){var k=T[A];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(I,k.key,k)}}function h(I,T,A){return T&&S(I.prototype,T),A&&S(I,A),I}x.exports=h},{}],7:[function(m,x,E){function S(h,I,T){return I in h?Object.defineProperty(h,I,{value:T,enumerable:!0,configurable:!0,writable:!0}):h[I]=T,h}x.exports=S},{}],8:[function(m,x,E){function S(){return x.exports=S=Object.assign||function(h){for(var I=1;I<arguments.length;I++){var T=arguments[I];for(var A in T)Object.prototype.hasOwnProperty.call(T,A)&&(h[A]=T[A])}return h},S.apply(this,arguments)}x.exports=S},{}],9:[function(m,x,E){function S(h){return x.exports=S=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},S(h)}x.exports=S},{}],10:[function(m,x,E){var S=m("./setPrototypeOf");function h(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(T&&T.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),T&&S(I,T)}x.exports=h},{"./setPrototypeOf":18}],11:[function(m,x,E){function S(h){return h&&h.__esModule?h:{default:h}}x.exports=S},{}],12:[function(m,x,E){var S=m("../helpers/typeof");function h(){if(typeof WeakMap!="function")return null;var T=new WeakMap;return h=function(){return T},T}function I(T){if(T&&T.__esModule)return T;if(T===null||S(T)!=="object"&&typeof T!="function")return{default:T};var A=h();if(A&&A.has(T))return A.get(T);var k={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in T)if(Object.prototype.hasOwnProperty.call(T,D)){var M=P?Object.getOwnPropertyDescriptor(T,D):null;M&&(M.get||M.set)?Object.defineProperty(k,D,M):k[D]=T[D]}return k.default=T,A&&A.set(T,k),k}x.exports=I},{"../helpers/typeof":21}],13:[function(m,x,E){function S(h){if(Symbol.iterator in Object(h)||Object.prototype.toString.call(h)==="[object Arguments]")return Array.from(h)}x.exports=S},{}],14:[function(m,x,E){function S(h,I){if(Symbol.iterator in Object(h)||Object.prototype.toString.call(h)==="[object Arguments]"){var T=[],A=!0,k=!1,P=void 0;try{for(var D=h[Symbol.iterator](),M;!(A=(M=D.next()).done)&&(T.push(M.value),!(I&&T.length===I));A=!0);}catch(F){k=!0,P=F}finally{try{!A&&D.return!=null&&D.return()}finally{if(k)throw P}}return T}}x.exports=S},{}],15:[function(m,x,E){function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}x.exports=S},{}],16:[function(m,x,E){function S(){throw new TypeError("Invalid attempt to spread non-iterable instance")}x.exports=S},{}],17:[function(m,x,E){var S=m("../helpers/typeof"),h=m("./assertThisInitialized");function I(T,A){return A&&(S(A)==="object"||typeof A=="function")?A:h(T)}x.exports=I},{"../helpers/typeof":21,"./assertThisInitialized":3}],18:[function(m,x,E){function S(h,I){return x.exports=S=Object.setPrototypeOf||function(A,k){return A.__proto__=k,A},S(h,I)}x.exports=S},{}],19:[function(m,x,E){var S=m("./arrayWithHoles"),h=m("./iterableToArrayLimit"),I=m("./nonIterableRest");function T(A,k){return S(A)||h(A,k)||I()}x.exports=T},{"./arrayWithHoles":1,"./iterableToArrayLimit":14,"./nonIterableRest":15}],20:[function(m,x,E){var S=m("./arrayWithoutHoles"),h=m("./iterableToArray"),I=m("./nonIterableSpread");function T(A){return S(A)||h(A)||I()}x.exports=T},{"./arrayWithoutHoles":2,"./iterableToArray":13,"./nonIterableSpread":16}],21:[function(m,x,E){function S(I){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?S=function(A){return typeof A}:S=function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},S(I)}function h(I){return typeof Symbol=="function"&&S(Symbol.iterator)==="symbol"?x.exports=h=function(A){return S(A)}:x.exports=h=function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":S(A)},h(I)}x.exports=h},{}],22:[function(m,x,E){x.exports=m("regenerator-runtime")},{"regenerator-runtime":153}],23:[function(m,x,E){var S=m("./src/converter");function h(I,T){var A=new S(I,T);return function(k){return A.convert(k)}}h.BIN="01",h.OCT="01234567",h.DEC="0123456789",h.HEX="0123456789abcdef",x.exports=h},{"./src/converter":24}],24:[function(m,x,E){function S(h,I){if(!h||!I||!h.length||!I.length)throw new Error("Bad alphabet");this.srcAlphabet=h,this.dstAlphabet=I}S.prototype.convert=function(h){var I,T,A,k={},P=this.srcAlphabet.length,D=this.dstAlphabet.length,M=h.length,F=typeof h=="string"?"":[];if(!this.isValid(h))throw new Error('Number "'+h+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return h;for(I=0;I<M;I++)k[I]=this.srcAlphabet.indexOf(h[I]);do{for(T=0,A=0,I=0;I<M;I++)T=T*P+k[I],T>=D?(k[A++]=parseInt(T/D,10),T=T%D):A>0&&(k[A++]=0);M=A,F=this.dstAlphabet.slice(T,T+1).concat(F)}while(A!==0);return F},S.prototype.isValid=function(h){for(var I=0;I<h.length;++I)if(this.srcAlphabet.indexOf(h[I])===-1)return!1;return!0},x.exports=S},{}],25:[function(m,x,E){(function(S){var h=m("object-assign");/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function I(ye,me){if(ye===me)return 0;for(var xe=ye.length,Le=me.length,Ze=0,Xe=Math.min(xe,Le);Ze<Xe;++Ze)if(ye[Ze]!==me[Ze]){xe=ye[Ze],Le=me[Ze];break}return xe<Le?-1:Le<xe?1:0}function T(ye){return S.Buffer&&typeof S.Buffer.isBuffer=="function"?S.Buffer.isBuffer(ye):!!(ye!=null&&ye._isBuffer)}var A=m("util/"),k=Object.prototype.hasOwnProperty,P=Array.prototype.slice,D=function(){return function(){}.name==="foo"}();function M(ye){return Object.prototype.toString.call(ye)}function F(ye){return T(ye)||typeof S.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(ye):ye?!!(ye instanceof DataView||ye.buffer&&ye.buffer instanceof ArrayBuffer):!1}var N=x.exports=Y,B=/\s*function\s+([^\(\s]*)\s*/;function U(ye){if(!!A.isFunction(ye)){if(D)return ye.name;var me=ye.toString(),xe=me.match(B);return xe&&xe[1]}}N.AssertionError=function(me){this.name="AssertionError",this.actual=me.actual,this.expected=me.expected,this.operator=me.operator,me.message?(this.message=me.message,this.generatedMessage=!1):(this.message=Z(this),this.generatedMessage=!0);var xe=me.stackStartFunction||W;if(Error.captureStackTrace)Error.captureStackTrace(this,xe);else{var Le=new Error;if(Le.stack){var Ze=Le.stack,Xe=U(xe),je=Ze.indexOf(`
`+Xe);if(je>=0){var Ie=Ze.indexOf(`
`,je+1);Ze=Ze.substring(Ie+1)}this.stack=Ze}}},A.inherits(N.AssertionError,Error);function O(ye,me){return typeof ye=="string"?ye.length<me?ye:ye.slice(0,me):ye}function V(ye){if(D||!A.isFunction(ye))return A.inspect(ye);var me=U(ye),xe=me?": "+me:"";return"[Function"+xe+"]"}function Z(ye){return O(V(ye.actual),128)+" "+ye.operator+" "+O(V(ye.expected),128)}function W(ye,me,xe,Le,Ze){throw new N.AssertionError({message:xe,actual:ye,expected:me,operator:Le,stackStartFunction:Ze})}N.fail=W;function Y(ye,me){ye||W(ye,!0,me,"==",N.ok)}N.ok=Y,N.equal=function(me,xe,Le){me!=xe&&W(me,xe,Le,"==",N.equal)},N.notEqual=function(me,xe,Le){me==xe&&W(me,xe,Le,"!=",N.notEqual)},N.deepEqual=function(me,xe,Le){X(me,xe,!1)||W(me,xe,Le,"deepEqual",N.deepEqual)},N.deepStrictEqual=function(me,xe,Le){X(me,xe,!0)||W(me,xe,Le,"deepStrictEqual",N.deepStrictEqual)};function X(ye,me,xe,Le){if(ye===me)return!0;if(T(ye)&&T(me))return I(ye,me)===0;if(A.isDate(ye)&&A.isDate(me))return ye.getTime()===me.getTime();if(A.isRegExp(ye)&&A.isRegExp(me))return ye.source===me.source&&ye.global===me.global&&ye.multiline===me.multiline&&ye.lastIndex===me.lastIndex&&ye.ignoreCase===me.ignoreCase;if((ye===null||typeof ye!="object")&&(me===null||typeof me!="object"))return xe?ye===me:ye==me;if(F(ye)&&F(me)&&M(ye)===M(me)&&!(ye instanceof Float32Array||ye instanceof Float64Array))return I(new Uint8Array(ye.buffer),new Uint8Array(me.buffer))===0;if(T(ye)!==T(me))return!1;Le=Le||{actual:[],expected:[]};var Ze=Le.actual.indexOf(ye);return Ze!==-1&&Ze===Le.expected.indexOf(me)?!0:(Le.actual.push(ye),Le.expected.push(me),q(ye,me,xe,Le))}function J(ye){return Object.prototype.toString.call(ye)=="[object Arguments]"}function q(ye,me,xe,Le){if(ye==null||me===null||me===void 0)return!1;if(A.isPrimitive(ye)||A.isPrimitive(me))return ye===me;if(xe&&Object.getPrototypeOf(ye)!==Object.getPrototypeOf(me))return!1;var Ze=J(ye),Xe=J(me);if(Ze&&!Xe||!Ze&&Xe)return!1;if(Ze)return ye=P.call(ye),me=P.call(me),X(ye,me,xe);var je=Ae(ye),Ie=Ae(me),Pe,De;if(je.length!==Ie.length)return!1;for(je.sort(),Ie.sort(),De=je.length-1;De>=0;De--)if(je[De]!==Ie[De])return!1;for(De=je.length-1;De>=0;De--)if(Pe=je[De],!X(ye[Pe],me[Pe],xe,Le))return!1;return!0}N.notDeepEqual=function(me,xe,Le){X(me,xe,!1)&&W(me,xe,Le,"notDeepEqual",N.notDeepEqual)},N.notDeepStrictEqual=te;function te(ye,me,xe){X(ye,me,!0)&&W(ye,me,xe,"notDeepStrictEqual",te)}N.strictEqual=function(me,xe,Le){me!==xe&&W(me,xe,Le,"===",N.strictEqual)},N.notStrictEqual=function(me,xe,Le){me===xe&&W(me,xe,Le,"!==",N.notStrictEqual)};function ne(ye,me){if(!ye||!me)return!1;if(Object.prototype.toString.call(me)=="[object RegExp]")return me.test(ye);try{if(ye instanceof me)return!0}catch{}return Error.isPrototypeOf(me)?!1:me.call({},ye)===!0}function de(ye){var me;try{ye()}catch(xe){me=xe}return me}function oe(ye,me,xe,Le){var Ze;if(typeof me!="function")throw new TypeError('"block" argument must be a function');typeof xe=="string"&&(Le=xe,xe=null),Ze=de(me),Le=(xe&&xe.name?" ("+xe.name+").":".")+(Le?" "+Le:"."),ye&&!Ze&&W(Ze,xe,"Missing expected exception"+Le);var Xe=typeof Le=="string",je=!ye&&A.isError(Ze),Ie=!ye&&Ze&&!xe;if((je&&Xe&&ne(Ze,xe)||Ie)&&W(Ze,xe,"Got unwanted exception"+Le),ye&&Ze&&xe&&!ne(Ze,xe)||!ye&&Ze)throw Ze}N.throws=function(ye,me,xe){oe(!0,ye,me,xe)},N.doesNotThrow=function(ye,me,xe){oe(!1,ye,me,xe)},N.ifError=function(ye){if(ye)throw ye};function we(ye,me){ye||W(ye,!0,me,"==",we)}N.strict=h(we,N,{equal:N.strictEqual,deepEqual:N.deepStrictEqual,notEqual:N.notStrictEqual,notDeepEqual:N.notDeepStrictEqual}),N.strict.strict=N.strict;var Ae=Object.keys||function(ye){var me=[];for(var xe in ye)k.call(ye,xe)&&me.push(xe);return me}}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"object-assign":84,"util/":28}],26:[function(m,x,E){typeof Object.create=="function"?x.exports=function(h,I){h.super_=I,h.prototype=Object.create(I.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:x.exports=function(h,I){h.super_=I;var T=function(){};T.prototype=I.prototype,h.prototype=new T,h.prototype.constructor=h}},{}],27:[function(m,x,E){x.exports=function(h){return h&&typeof h=="object"&&typeof h.copy=="function"&&typeof h.fill=="function"&&typeof h.readUInt8=="function"}},{}],28:[function(m,x,E){(function(S,h){var I=/%[sdj%]/g;E.format=function(Ie){if(!q(Ie)){for(var Pe=[],De=0;De<arguments.length;De++)Pe.push(k(arguments[De]));return Pe.join(" ")}for(var De=1,ze=arguments,it=ze.length,tt=String(Ie).replace(I,function(lt){if(lt==="%%")return"%";if(De>=it)return lt;switch(lt){case"%s":return String(ze[De++]);case"%d":return Number(ze[De++]);case"%j":try{return JSON.stringify(ze[De++])}catch{return"[Circular]"}default:return lt}}),ot=ze[De];De<it;ot=ze[++De])Y(ot)||!oe(ot)?tt+=" "+ot:tt+=" "+k(ot);return tt},E.deprecate=function(Ie,Pe){if(ne(h.process))return function(){return E.deprecate(Ie,Pe).apply(this,arguments)};if(S.noDeprecation===!0)return Ie;var De=!1;function ze(){if(!De){if(S.throwDeprecation)throw new Error(Pe);S.traceDeprecation?console.trace(Pe):console.error(Pe),De=!0}return Ie.apply(this,arguments)}return ze};var T={},A;E.debuglog=function(Ie){if(ne(A)&&(A=""),Ie=Ie.toUpperCase(),!T[Ie])if(new RegExp("\\b"+Ie+"\\b","i").test(A)){var Pe=S.pid;T[Ie]=function(){var De=E.format.apply(E,arguments);console.error("%s %d: %s",Ie,Pe,De)}}else T[Ie]=function(){};return T[Ie]};function k(Ie,Pe){var De={seen:[],stylize:D};return arguments.length>=3&&(De.depth=arguments[2]),arguments.length>=4&&(De.colors=arguments[3]),W(Pe)?De.showHidden=Pe:Pe&&E._extend(De,Pe),ne(De.showHidden)&&(De.showHidden=!1),ne(De.depth)&&(De.depth=2),ne(De.colors)&&(De.colors=!1),ne(De.customInspect)&&(De.customInspect=!0),De.colors&&(De.stylize=P),F(De,Ie,De.depth)}E.inspect=k,k.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},k.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function P(Ie,Pe){var De=k.styles[Pe];return De?"["+k.colors[De][0]+"m"+Ie+"["+k.colors[De][1]+"m":Ie}function D(Ie,Pe){return Ie}function M(Ie){var Pe={};return Ie.forEach(function(De,ze){Pe[De]=!0}),Pe}function F(Ie,Pe,De){if(Ie.customInspect&&Pe&&ye(Pe.inspect)&&Pe.inspect!==E.inspect&&!(Pe.constructor&&Pe.constructor.prototype===Pe)){var ze=Pe.inspect(De,Ie);return q(ze)||(ze=F(Ie,ze,De)),ze}var it=N(Ie,Pe);if(it)return it;var tt=Object.keys(Pe),ot=M(tt);if(Ie.showHidden&&(tt=Object.getOwnPropertyNames(Pe)),Ae(Pe)&&(tt.indexOf("message")>=0||tt.indexOf("description")>=0))return B(Pe);if(tt.length===0){if(ye(Pe)){var lt=Pe.name?": "+Pe.name:"";return Ie.stylize("[Function"+lt+"]","special")}if(de(Pe))return Ie.stylize(RegExp.prototype.toString.call(Pe),"regexp");if(we(Pe))return Ie.stylize(Date.prototype.toString.call(Pe),"date");if(Ae(Pe))return B(Pe)}var St="",et=!1,Je=["{","}"];if(Z(Pe)&&(et=!0,Je=["[","]"]),ye(Pe)){var Be=Pe.name?": "+Pe.name:"";St=" [Function"+Be+"]"}if(de(Pe)&&(St=" "+RegExp.prototype.toString.call(Pe)),we(Pe)&&(St=" "+Date.prototype.toUTCString.call(Pe)),Ae(Pe)&&(St=" "+B(Pe)),tt.length===0&&(!et||Pe.length==0))return Je[0]+St+Je[1];if(De<0)return de(Pe)?Ie.stylize(RegExp.prototype.toString.call(Pe),"regexp"):Ie.stylize("[Object]","special");Ie.seen.push(Pe);var Ge;return et?Ge=U(Ie,Pe,De,ot,tt):Ge=tt.map(function(He){return O(Ie,Pe,De,ot,He,et)}),Ie.seen.pop(),V(Ge,St,Je)}function N(Ie,Pe){if(ne(Pe))return Ie.stylize("undefined","undefined");if(q(Pe)){var De="'"+JSON.stringify(Pe).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ie.stylize(De,"string")}if(J(Pe))return Ie.stylize(""+Pe,"number");if(W(Pe))return Ie.stylize(""+Pe,"boolean");if(Y(Pe))return Ie.stylize("null","null")}function B(Ie){return"["+Error.prototype.toString.call(Ie)+"]"}function U(Ie,Pe,De,ze,it){for(var tt=[],ot=0,lt=Pe.length;ot<lt;++ot)je(Pe,String(ot))?tt.push(O(Ie,Pe,De,ze,String(ot),!0)):tt.push("");return it.forEach(function(St){St.match(/^\d+$/)||tt.push(O(Ie,Pe,De,ze,St,!0))}),tt}function O(Ie,Pe,De,ze,it,tt){var ot,lt,St;if(St=Object.getOwnPropertyDescriptor(Pe,it)||{value:Pe[it]},St.get?St.set?lt=Ie.stylize("[Getter/Setter]","special"):lt=Ie.stylize("[Getter]","special"):St.set&&(lt=Ie.stylize("[Setter]","special")),je(ze,it)||(ot="["+it+"]"),lt||(Ie.seen.indexOf(St.value)<0?(Y(De)?lt=F(Ie,St.value,null):lt=F(Ie,St.value,De-1),lt.indexOf(`
`)>-1&&(tt?lt=lt.split(`
`).map(function(et){return"  "+et}).join(`
`).substr(2):lt=`
`+lt.split(`
`).map(function(et){return"   "+et}).join(`
`))):lt=Ie.stylize("[Circular]","special")),ne(ot)){if(tt&&it.match(/^\d+$/))return lt;ot=JSON.stringify(""+it),ot.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ot=ot.substr(1,ot.length-2),ot=Ie.stylize(ot,"name")):(ot=ot.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ot=Ie.stylize(ot,"string"))}return ot+": "+lt}function V(Ie,Pe,De){var ze=Ie.reduce(function(it,tt){return tt.indexOf(`
`)>=0,it+tt.replace(/\u001b\[\d\d?m/g,"").length+1},0);return ze>60?De[0]+(Pe===""?"":Pe+`
 `)+" "+Ie.join(`,
  `)+" "+De[1]:De[0]+Pe+" "+Ie.join(", ")+" "+De[1]}function Z(Ie){return Array.isArray(Ie)}E.isArray=Z;function W(Ie){return typeof Ie=="boolean"}E.isBoolean=W;function Y(Ie){return Ie===null}E.isNull=Y;function X(Ie){return Ie==null}E.isNullOrUndefined=X;function J(Ie){return typeof Ie=="number"}E.isNumber=J;function q(Ie){return typeof Ie=="string"}E.isString=q;function te(Ie){return typeof Ie=="symbol"}E.isSymbol=te;function ne(Ie){return Ie===void 0}E.isUndefined=ne;function de(Ie){return oe(Ie)&&xe(Ie)==="[object RegExp]"}E.isRegExp=de;function oe(Ie){return typeof Ie=="object"&&Ie!==null}E.isObject=oe;function we(Ie){return oe(Ie)&&xe(Ie)==="[object Date]"}E.isDate=we;function Ae(Ie){return oe(Ie)&&(xe(Ie)==="[object Error]"||Ie instanceof Error)}E.isError=Ae;function ye(Ie){return typeof Ie=="function"}E.isFunction=ye;function me(Ie){return Ie===null||typeof Ie=="boolean"||typeof Ie=="number"||typeof Ie=="string"||typeof Ie=="symbol"||typeof Ie=="undefined"}E.isPrimitive=me,E.isBuffer=m("./support/isBuffer");function xe(Ie){return Object.prototype.toString.call(Ie)}function Le(Ie){return Ie<10?"0"+Ie.toString(10):Ie.toString(10)}var Ze=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Xe(){var Ie=new Date,Pe=[Le(Ie.getHours()),Le(Ie.getMinutes()),Le(Ie.getSeconds())].join(":");return[Ie.getDate(),Ze[Ie.getMonth()],Pe].join(" ")}E.log=function(){console.log("%s - %s",Xe(),E.format.apply(E,arguments))},E.inherits=m("inherits"),E._extend=function(Ie,Pe){if(!Pe||!oe(Pe))return Ie;for(var De=Object.keys(Pe),ze=De.length;ze--;)Ie[De[ze]]=Pe[De[ze]];return Ie};function je(Ie,Pe){return Object.prototype.hasOwnProperty.call(Ie,Pe)}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"./support/isBuffer":27,_process:133,inherits:26}],29:[function(m,x,E){E.byteLength=D,E.toByteArray=F,E.fromByteArray=U;for(var S=[],h=[],I=typeof Uint8Array!="undefined"?Uint8Array:Array,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=0,k=T.length;A<k;++A)S[A]=T[A],h[T.charCodeAt(A)]=A;h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63;function P(O){var V=O.length;if(V%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Z=O.indexOf("=");Z===-1&&(Z=V);var W=Z===V?0:4-Z%4;return[Z,W]}function D(O){var V=P(O),Z=V[0],W=V[1];return(Z+W)*3/4-W}function M(O,V,Z){return(V+Z)*3/4-Z}function F(O){var V,Z=P(O),W=Z[0],Y=Z[1],X=new I(M(O,W,Y)),J=0,q=Y>0?W-4:W,te;for(te=0;te<q;te+=4)V=h[O.charCodeAt(te)]<<18|h[O.charCodeAt(te+1)]<<12|h[O.charCodeAt(te+2)]<<6|h[O.charCodeAt(te+3)],X[J++]=V>>16&255,X[J++]=V>>8&255,X[J++]=V&255;return Y===2&&(V=h[O.charCodeAt(te)]<<2|h[O.charCodeAt(te+1)]>>4,X[J++]=V&255),Y===1&&(V=h[O.charCodeAt(te)]<<10|h[O.charCodeAt(te+1)]<<4|h[O.charCodeAt(te+2)]>>2,X[J++]=V>>8&255,X[J++]=V&255),X}function N(O){return S[O>>18&63]+S[O>>12&63]+S[O>>6&63]+S[O&63]}function B(O,V,Z){for(var W,Y=[],X=V;X<Z;X+=3)W=(O[X]<<16&16711680)+(O[X+1]<<8&65280)+(O[X+2]&255),Y.push(N(W));return Y.join("")}function U(O){for(var V,Z=O.length,W=Z%3,Y=[],X=16383,J=0,q=Z-W;J<q;J+=X)Y.push(B(O,J,J+X>q?q:J+X));return W===1?(V=O[Z-1],Y.push(S[V>>2]+S[V<<4&63]+"==")):W===2&&(V=(O[Z-2]<<8)+O[Z-1],Y.push(S[V>>10]+S[V>>4&63]+S[V<<2&63]+"=")),Y.join("")}},{}],30:[function(m,x,E){var S=m("./lib/encoder"),h=m("./lib/decoder");x.exports={encode:S,decode:h}},{"./lib/decoder":31,"./lib/encoder":32}],31:[function(m,x,E){(function(S){function h(I,T){if(this.pos=0,this.buffer=I,this.is_with_alpha=!!T,this.bottom_up=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!="BM")throw new Error("Invalid BMP File");this.parseHeader(),this.parseRGBA()}h.prototype.parseHeader=function(){if(this.fileSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.reserved=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.offset=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.headerSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.width=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.height=this.buffer.readInt32LE(this.pos),this.pos+=4,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compress=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.rawSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.hr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.vr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.colors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.importantColors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var I=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(I);for(var T=0;T<I;T++){var A=this.buffer.readUInt8(this.pos++),k=this.buffer.readUInt8(this.pos++),P=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++);this.palette[T]={red:P,green:k,blue:A,quad:D}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},h.prototype.parseRGBA=function(){var I="bit"+this.bitPP,T=this.width*this.height*4;this.data=new S(T),this[I]()},h.prototype.bit1=function(){for(var I=Math.ceil(this.width/8),T=I%4,A=this.height>=0?this.height-1:-this.height,A=this.height-1;A>=0;A--){for(var k=this.bottom_up?A:this.height-1-A,P=0;P<I;P++)for(var D=this.buffer.readUInt8(this.pos++),M=k*this.width*4+P*8*4,F=0;F<8&&P*8+F<this.width;F++){var N=this.palette[D>>7-F&1];this.data[M+F*4]=0,this.data[M+F*4+1]=N.blue,this.data[M+F*4+2]=N.green,this.data[M+F*4+3]=N.red}T!=0&&(this.pos+=4-T)}},h.prototype.bit4=function(){if(this.compress==2){let Y=function(X){var J=this.palette[X];this.data[I]=0,this.data[I+1]=J.blue,this.data[I+2]=J.green,this.data[I+3]=J.red,I+=4};this.data.fill(255);for(var I=0,T=this.bottom_up?this.height-1:0,A=!1;I<this.data.length;){var k=this.buffer.readUInt8(this.pos++),P=this.buffer.readUInt8(this.pos++);if(k==0)if(P==0){this.bottom_up?T--:T++,I=T*this.width*4,A=!1;continue}else{if(P==1)break;if(P==2){var D=this.buffer.readUInt8(this.pos++),M=this.buffer.readUInt8(this.pos++);this.bottom_up?T-=M:T+=M,I+=M*this.width*4+D*4}else{for(var F=this.buffer.readUInt8(this.pos++),N=0;N<P;N++)A?Y.call(this,F&15):Y.call(this,(F&240)>>4),N&1&&N+1<P&&(F=this.buffer.readUInt8(this.pos++)),A=!A;(P+1>>1&1)==1&&this.pos++}}else for(var N=0;N<k;N++)A?Y.call(this,P&15):Y.call(this,(P&240)>>4),A=!A}}else for(var B=Math.ceil(this.width/2),U=B%4,M=this.height-1;M>=0;M--){for(var O=this.bottom_up?M:this.height-1-M,D=0;D<B;D++){var P=this.buffer.readUInt8(this.pos++),I=O*this.width*4+D*2*4,V=P>>4,Z=P&15,W=this.palette[V];if(this.data[I]=0,this.data[I+1]=W.blue,this.data[I+2]=W.green,this.data[I+3]=W.red,D*2+1>=this.width)break;W=this.palette[Z],this.data[I+4]=0,this.data[I+4+1]=W.blue,this.data[I+4+2]=W.green,this.data[I+4+3]=W.red}U!=0&&(this.pos+=4-U)}},h.prototype.bit8=function(){if(this.compress==1){let O=function(V){var Z=this.palette[V];this.data[I]=0,this.data[I+1]=Z.blue,this.data[I+2]=Z.green,this.data[I+3]=Z.red,I+=4};this.data.fill(255);for(var I=0,T=this.bottom_up?this.height-1:0;I<this.data.length;){var A=this.buffer.readUInt8(this.pos++),k=this.buffer.readUInt8(this.pos++);if(A==0)if(k==0){this.bottom_up?T--:T++,I=T*this.width*4;continue}else{if(k==1)break;if(k==2){var P=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++);this.bottom_up?T-=D:T+=D,I+=D*this.width*4+P*4}else{for(var M=0;M<k;M++){var F=this.buffer.readUInt8(this.pos++);O.call(this,F)}k&!0&&this.pos++}}else for(var M=0;M<A;M++)O.call(this,k)}}else for(var N=this.width%4,D=this.height-1;D>=0;D--){for(var B=this.bottom_up?D:this.height-1-D,P=0;P<this.width;P++){var k=this.buffer.readUInt8(this.pos++),I=B*this.width*4+P*4;if(k<this.palette.length){var U=this.palette[k];this.data[I]=0,this.data[I+1]=U.blue,this.data[I+2]=U.green,this.data[I+3]=U.red}else this.data[I]=0,this.data[I+1]=255,this.data[I+2]=255,this.data[I+3]=255}N!=0&&(this.pos+=4-N)}},h.prototype.bit15=function(){for(var I=this.width%3,T=parseInt("11111",2),A=T,k=this.height-1;k>=0;k--){for(var P=this.bottom_up?k:this.height-1-k,D=0;D<this.width;D++){var M=this.buffer.readUInt16LE(this.pos);this.pos+=2;var F=(M&A)/A*255|0,N=(M>>5&A)/A*255|0,B=(M>>10&A)/A*255|0,U=M>>15?255:0,O=P*this.width*4+D*4;this.data[O]=U,this.data[O+1]=F,this.data[O+2]=N,this.data[O+3]=B}this.pos+=I}},h.prototype.bit16=function(){var I=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress==3&&(this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4);for(var T=[0,0,0],A=0;A<16;A++)this.maskRed>>A&1&&T[0]++,this.maskGreen>>A&1&&T[1]++,this.maskBlue>>A&1&&T[2]++;T[1]+=T[0],T[2]+=T[1],T[0]=8-T[0],T[1]-=8,T[2]-=8;for(var k=this.height-1;k>=0;k--){for(var P=this.bottom_up?k:this.height-1-k,D=0;D<this.width;D++){var M=this.buffer.readUInt16LE(this.pos);this.pos+=2;var F=(M&this.maskBlue)<<T[0],N=(M&this.maskGreen)>>T[1],B=(M&this.maskRed)>>T[2],U=P*this.width*4+D*4;this.data[U]=0,this.data[U+1]=F,this.data[U+2]=N,this.data[U+3]=B}this.pos+=I}},h.prototype.bit24=function(){for(var I=this.height-1;I>=0;I--){for(var T=this.bottom_up?I:this.height-1-I,A=0;A<this.width;A++){var k=this.buffer.readUInt8(this.pos++),P=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),M=T*this.width*4+A*4;this.data[M]=0,this.data[M+1]=k,this.data[M+2]=P,this.data[M+3]=D}this.pos+=this.width%4}},h.prototype.bit32=function(){if(this.compress==3){this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4;for(var I=this.height-1;I>=0;I--)for(var T=this.bottom_up?I:this.height-1-I,A=0;A<this.width;A++){var k=this.buffer.readUInt8(this.pos++),P=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),M=this.buffer.readUInt8(this.pos++),F=T*this.width*4+A*4;this.data[F]=k,this.data[F+1]=P,this.data[F+2]=D,this.data[F+3]=M}}else for(var I=this.height-1;I>=0;I--)for(var T=this.bottom_up?I:this.height-1-I,A=0;A<this.width;A++){var P=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),M=this.buffer.readUInt8(this.pos++),k=this.buffer.readUInt8(this.pos++),F=T*this.width*4+A*4;this.data[F]=k,this.data[F+1]=P,this.data[F+2]=D,this.data[F+3]=M}},h.prototype.getData=function(){return this.data},x.exports=function(I){var T=new h(I);return T}}).call(this,m("buffer").Buffer)},{buffer:48}],32:[function(m,x,E){(function(S){function h(I){this.buffer=I.data,this.width=I.width,this.height=I.height,this.extraBytes=this.width%4,this.rgbSize=this.height*(3*this.width+this.extraBytes),this.headerInfoSize=40,this.data=[],this.flag="BM",this.reserved=0,this.offset=54,this.fileSize=this.rgbSize+this.offset,this.planes=1,this.bitPP=24,this.compress=0,this.hr=0,this.vr=0,this.colors=0,this.importantColors=0}h.prototype.encode=function(){var I=new S(this.offset+this.rgbSize);this.pos=0,I.write(this.flag,this.pos,2),this.pos+=2,I.writeUInt32LE(this.fileSize,this.pos),this.pos+=4,I.writeUInt32LE(this.reserved,this.pos),this.pos+=4,I.writeUInt32LE(this.offset,this.pos),this.pos+=4,I.writeUInt32LE(this.headerInfoSize,this.pos),this.pos+=4,I.writeUInt32LE(this.width,this.pos),this.pos+=4,I.writeInt32LE(-this.height,this.pos),this.pos+=4,I.writeUInt16LE(this.planes,this.pos),this.pos+=2,I.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,I.writeUInt32LE(this.compress,this.pos),this.pos+=4,I.writeUInt32LE(this.rgbSize,this.pos),this.pos+=4,I.writeUInt32LE(this.hr,this.pos),this.pos+=4,I.writeUInt32LE(this.vr,this.pos),this.pos+=4,I.writeUInt32LE(this.colors,this.pos),this.pos+=4,I.writeUInt32LE(this.importantColors,this.pos),this.pos+=4;for(var T=0,A=3*this.width+this.extraBytes,k=0;k<this.height;k++){for(var P=0;P<this.width;P++){var D=this.pos+k*A+P*3;T++,I[D]=this.buffer[T++],I[D+1]=this.buffer[T++],I[D+2]=this.buffer[T++]}if(this.extraBytes>0){var M=this.pos+k*A+this.width*3;I.fill(0,M,M+this.extraBytes)}}return I},x.exports=function(I,T){var A=new h(I),k=A.encode();return{data:k,width:I.width,height:I.height}}}).call(this,m("buffer").Buffer)},{buffer:48}],33:[function(m,x,E){},{}],34:[function(m,x,E){(function(S,h){var I=m("assert"),T=m("pako/lib/zlib/zstream"),A=m("pako/lib/zlib/deflate.js"),k=m("pako/lib/zlib/inflate.js"),P=m("pako/lib/zlib/constants");for(var D in P)E[D]=P[D];E.NONE=0,E.DEFLATE=1,E.INFLATE=2,E.GZIP=3,E.GUNZIP=4,E.DEFLATERAW=5,E.INFLATERAW=6,E.UNZIP=7;var M=31,F=139;function N(B){if(typeof B!="number"||B<E.DEFLATE||B>E.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=B,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}N.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,I(this.init_done,"close before init"),I(this.mode<=E.UNZIP),this.mode===E.DEFLATE||this.mode===E.GZIP||this.mode===E.DEFLATERAW?A.deflateEnd(this.strm):(this.mode===E.INFLATE||this.mode===E.GUNZIP||this.mode===E.INFLATERAW||this.mode===E.UNZIP)&&k.inflateEnd(this.strm),this.mode=E.NONE,this.dictionary=null},N.prototype.write=function(B,U,O,V,Z,W,Y){return this._write(!0,B,U,O,V,Z,W,Y)},N.prototype.writeSync=function(B,U,O,V,Z,W,Y){return this._write(!1,B,U,O,V,Z,W,Y)},N.prototype._write=function(B,U,O,V,Z,W,Y,X){if(I.equal(arguments.length,8),I(this.init_done,"write before init"),I(this.mode!==E.NONE,"already finalized"),I.equal(!1,this.write_in_progress,"write already in progress"),I.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,I.equal(!1,U===void 0,"must provide flush value"),this.write_in_progress=!0,U!==E.Z_NO_FLUSH&&U!==E.Z_PARTIAL_FLUSH&&U!==E.Z_SYNC_FLUSH&&U!==E.Z_FULL_FLUSH&&U!==E.Z_FINISH&&U!==E.Z_BLOCK)throw new Error("Invalid flush value");if(O==null&&(O=h.alloc(0),Z=0,V=0),this.strm.avail_in=Z,this.strm.input=O,this.strm.next_in=V,this.strm.avail_out=X,this.strm.output=W,this.strm.next_out=Y,this.flush=U,!B)return this._process(),this._checkError()?this._afterSync():void 0;var J=this;return S.nextTick(function(){J._process(),J._after()}),this},N.prototype._afterSync=function(){var B=this.strm.avail_out,U=this.strm.avail_in;return this.write_in_progress=!1,[U,B]},N.prototype._process=function(){var B=null;switch(this.mode){case E.DEFLATE:case E.GZIP:case E.DEFLATERAW:this.err=A.deflate(this.strm,this.flush);break;case E.UNZIP:switch(this.strm.avail_in>0&&(B=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(B===null)break;if(this.strm.input[B]===M){if(this.gzip_id_bytes_read=1,B++,this.strm.avail_in===1)break}else{this.mode=E.INFLATE;break}case 1:if(B===null)break;this.strm.input[B]===F?(this.gzip_id_bytes_read=2,this.mode=E.GUNZIP):this.mode=E.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case E.INFLATE:case E.GUNZIP:case E.INFLATERAW:for(this.err=k.inflate(this.strm,this.flush),this.err===E.Z_NEED_DICT&&this.dictionary&&(this.err=k.inflateSetDictionary(this.strm,this.dictionary),this.err===E.Z_OK?this.err=k.inflate(this.strm,this.flush):this.err===E.Z_DATA_ERROR&&(this.err=E.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===E.GUNZIP&&this.err===E.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=k.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},N.prototype._checkError=function(){switch(this.err){case E.Z_OK:case E.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===E.Z_FINISH)return this._error("unexpected end of file"),!1;break;case E.Z_STREAM_END:break;case E.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},N.prototype._after=function(){if(!!this._checkError()){var B=this.strm.avail_out,U=this.strm.avail_in;this.write_in_progress=!1,this.callback(U,B),this.pending_close&&this.close()}},N.prototype._error=function(B){this.strm.msg&&(B=this.strm.msg),this.onerror(B,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},N.prototype.init=function(B,U,O,V,Z){I(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),I(B>=8&&B<=15,"invalid windowBits"),I(U>=-1&&U<=9,"invalid compression level"),I(O>=1&&O<=9,"invalid memlevel"),I(V===E.Z_FILTERED||V===E.Z_HUFFMAN_ONLY||V===E.Z_RLE||V===E.Z_FIXED||V===E.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(U,B,O,V,Z),this._setDictionary()},N.prototype.params=function(){throw new Error("deflateParams Not supported")},N.prototype.reset=function(){this._reset(),this._setDictionary()},N.prototype._init=function(B,U,O,V,Z){switch(this.level=B,this.windowBits=U,this.memLevel=O,this.strategy=V,this.flush=E.Z_NO_FLUSH,this.err=E.Z_OK,(this.mode===E.GZIP||this.mode===E.GUNZIP)&&(this.windowBits+=16),this.mode===E.UNZIP&&(this.windowBits+=32),(this.mode===E.DEFLATERAW||this.mode===E.INFLATERAW)&&(this.windowBits=-1*this.windowBits),this.strm=new T,this.mode){case E.DEFLATE:case E.GZIP:case E.DEFLATERAW:this.err=A.deflateInit2(this.strm,this.level,E.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case E.INFLATE:case E.GUNZIP:case E.INFLATERAW:case E.UNZIP:this.err=k.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==E.Z_OK&&this._error("Init error"),this.dictionary=Z,this.write_in_progress=!1,this.init_done=!0},N.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=E.Z_OK,this.mode){case E.DEFLATE:case E.DEFLATERAW:this.err=A.deflateSetDictionary(this.strm,this.dictionary);break}this.err!==E.Z_OK&&this._error("Failed to set dictionary")}},N.prototype._reset=function(){switch(this.err=E.Z_OK,this.mode){case E.DEFLATE:case E.DEFLATERAW:case E.GZIP:this.err=A.deflateReset(this.strm);break;case E.INFLATE:case E.INFLATERAW:case E.GUNZIP:this.err=k.inflateReset(this.strm);break}this.err!==E.Z_OK&&this._error("Failed to reset stream")},E.Zlib=N}).call(this,m("_process"),m("buffer").Buffer)},{_process:133,assert:25,buffer:48,"pako/lib/zlib/constants":38,"pako/lib/zlib/deflate.js":40,"pako/lib/zlib/inflate.js":42,"pako/lib/zlib/zstream":46}],35:[function(m,x,E){(function(S){var h=m("buffer").Buffer,I=m("stream").Transform,T=m("./binding"),A=m("util"),k=m("assert").ok,P=m("buffer").kMaxLength,D="Cannot create final Buffer. It would be larger than 0x"+P.toString(16)+" bytes";T.Z_MIN_WINDOWBITS=8,T.Z_MAX_WINDOWBITS=15,T.Z_DEFAULT_WINDOWBITS=15,T.Z_MIN_CHUNK=64,T.Z_MAX_CHUNK=1/0,T.Z_DEFAULT_CHUNK=16*1024,T.Z_MIN_MEMLEVEL=1,T.Z_MAX_MEMLEVEL=9,T.Z_DEFAULT_MEMLEVEL=8,T.Z_MIN_LEVEL=-1,T.Z_MAX_LEVEL=9,T.Z_DEFAULT_LEVEL=T.Z_DEFAULT_COMPRESSION;for(var M=Object.keys(T),F=0;F<M.length;F++){var N=M[F];N.match(/^Z/)&&Object.defineProperty(E,N,{enumerable:!0,value:T[N],writable:!1})}for(var B={Z_OK:T.Z_OK,Z_STREAM_END:T.Z_STREAM_END,Z_NEED_DICT:T.Z_NEED_DICT,Z_ERRNO:T.Z_ERRNO,Z_STREAM_ERROR:T.Z_STREAM_ERROR,Z_DATA_ERROR:T.Z_DATA_ERROR,Z_MEM_ERROR:T.Z_MEM_ERROR,Z_BUF_ERROR:T.Z_BUF_ERROR,Z_VERSION_ERROR:T.Z_VERSION_ERROR},U=Object.keys(B),O=0;O<U.length;O++){var V=U[O];B[B[V]]=V}Object.defineProperty(E,"codes",{enumerable:!0,value:Object.freeze(B),writable:!1}),E.Deflate=Y,E.Inflate=X,E.Gzip=J,E.Gunzip=q,E.DeflateRaw=te,E.InflateRaw=ne,E.Unzip=de,E.createDeflate=function(me){return new Y(me)},E.createInflate=function(me){return new X(me)},E.createDeflateRaw=function(me){return new te(me)},E.createInflateRaw=function(me){return new ne(me)},E.createGzip=function(me){return new J(me)},E.createGunzip=function(me){return new q(me)},E.createUnzip=function(me){return new de(me)},E.deflate=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new Y(xe),me,Le)},E.deflateSync=function(me,xe){return W(new Y(xe),me)},E.gzip=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new J(xe),me,Le)},E.gzipSync=function(me,xe){return W(new J(xe),me)},E.deflateRaw=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new te(xe),me,Le)},E.deflateRawSync=function(me,xe){return W(new te(xe),me)},E.unzip=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new de(xe),me,Le)},E.unzipSync=function(me,xe){return W(new de(xe),me)},E.inflate=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new X(xe),me,Le)},E.inflateSync=function(me,xe){return W(new X(xe),me)},E.gunzip=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new q(xe),me,Le)},E.gunzipSync=function(me,xe){return W(new q(xe),me)},E.inflateRaw=function(me,xe,Le){return typeof xe=="function"&&(Le=xe,xe={}),Z(new ne(xe),me,Le)},E.inflateRawSync=function(me,xe){return W(new ne(xe),me)};function Z(me,xe,Le){var Ze=[],Xe=0;me.on("error",Ie),me.on("end",Pe),me.end(xe),je();function je(){for(var De;(De=me.read())!==null;)Ze.push(De),Xe+=De.length;me.once("readable",je)}function Ie(De){me.removeListener("end",Pe),me.removeListener("readable",je),Le(De)}function Pe(){var De,ze=null;Xe>=P?ze=new RangeError(D):De=h.concat(Ze,Xe),Ze=[],me.close(),Le(ze,De)}}function W(me,xe){if(typeof xe=="string"&&(xe=h.from(xe)),!h.isBuffer(xe))throw new TypeError("Not a string or buffer");var Le=me._finishFlushFlag;return me._processChunk(xe,Le)}function Y(me){if(!(this instanceof Y))return new Y(me);we.call(this,me,T.DEFLATE)}function X(me){if(!(this instanceof X))return new X(me);we.call(this,me,T.INFLATE)}function J(me){if(!(this instanceof J))return new J(me);we.call(this,me,T.GZIP)}function q(me){if(!(this instanceof q))return new q(me);we.call(this,me,T.GUNZIP)}function te(me){if(!(this instanceof te))return new te(me);we.call(this,me,T.DEFLATERAW)}function ne(me){if(!(this instanceof ne))return new ne(me);we.call(this,me,T.INFLATERAW)}function de(me){if(!(this instanceof de))return new de(me);we.call(this,me,T.UNZIP)}function oe(me){return me===T.Z_NO_FLUSH||me===T.Z_PARTIAL_FLUSH||me===T.Z_SYNC_FLUSH||me===T.Z_FULL_FLUSH||me===T.Z_FINISH||me===T.Z_BLOCK}function we(me,xe){var Le=this;if(this._opts=me=me||{},this._chunkSize=me.chunkSize||E.Z_DEFAULT_CHUNK,I.call(this,me),me.flush&&!oe(me.flush))throw new Error("Invalid flush flag: "+me.flush);if(me.finishFlush&&!oe(me.finishFlush))throw new Error("Invalid flush flag: "+me.finishFlush);if(this._flushFlag=me.flush||T.Z_NO_FLUSH,this._finishFlushFlag=typeof me.finishFlush!="undefined"?me.finishFlush:T.Z_FINISH,me.chunkSize&&(me.chunkSize<E.Z_MIN_CHUNK||me.chunkSize>E.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+me.chunkSize);if(me.windowBits&&(me.windowBits<E.Z_MIN_WINDOWBITS||me.windowBits>E.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+me.windowBits);if(me.level&&(me.level<E.Z_MIN_LEVEL||me.level>E.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+me.level);if(me.memLevel&&(me.memLevel<E.Z_MIN_MEMLEVEL||me.memLevel>E.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+me.memLevel);if(me.strategy&&me.strategy!=E.Z_FILTERED&&me.strategy!=E.Z_HUFFMAN_ONLY&&me.strategy!=E.Z_RLE&&me.strategy!=E.Z_FIXED&&me.strategy!=E.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+me.strategy);if(me.dictionary&&!h.isBuffer(me.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new T.Zlib(xe);var Ze=this;this._hadError=!1,this._handle.onerror=function(Ie,Pe){Ae(Ze),Ze._hadError=!0;var De=new Error(Ie);De.errno=Pe,De.code=E.codes[Pe],Ze.emit("error",De)};var Xe=E.Z_DEFAULT_COMPRESSION;typeof me.level=="number"&&(Xe=me.level);var je=E.Z_DEFAULT_STRATEGY;typeof me.strategy=="number"&&(je=me.strategy),this._handle.init(me.windowBits||E.Z_DEFAULT_WINDOWBITS,Xe,me.memLevel||E.Z_DEFAULT_MEMLEVEL,je,me.dictionary),this._buffer=h.allocUnsafe(this._chunkSize),this._offset=0,this._level=Xe,this._strategy=je,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!Le._handle},configurable:!0,enumerable:!0})}A.inherits(we,I),we.prototype.params=function(me,xe,Le){if(me<E.Z_MIN_LEVEL||me>E.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+me);if(xe!=E.Z_FILTERED&&xe!=E.Z_HUFFMAN_ONLY&&xe!=E.Z_RLE&&xe!=E.Z_FIXED&&xe!=E.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+xe);if(this._level!==me||this._strategy!==xe){var Ze=this;this.flush(T.Z_SYNC_FLUSH,function(){k(Ze._handle,"zlib binding closed"),Ze._handle.params(me,xe),Ze._hadError||(Ze._level=me,Ze._strategy=xe,Le&&Le())})}else S.nextTick(Le)},we.prototype.reset=function(){return k(this._handle,"zlib binding closed"),this._handle.reset()},we.prototype._flush=function(me){this._transform(h.alloc(0),"",me)},we.prototype.flush=function(me,xe){var Le=this,Ze=this._writableState;(typeof me=="function"||me===void 0&&!xe)&&(xe=me,me=T.Z_FULL_FLUSH),Ze.ended?xe&&S.nextTick(xe):Ze.ending?xe&&this.once("end",xe):Ze.needDrain?xe&&this.once("drain",function(){return Le.flush(me,xe)}):(this._flushFlag=me,this.write(h.alloc(0),"",xe))},we.prototype.close=function(me){Ae(this,me),S.nextTick(ye,this)};function Ae(me,xe){xe&&S.nextTick(xe),!!me._handle&&(me._handle.close(),me._handle=null)}function ye(me){me.emit("close")}we.prototype._transform=function(me,xe,Le){var Ze,Xe=this._writableState,je=Xe.ending||Xe.ended,Ie=je&&(!me||Xe.length===me.length);if(me!==null&&!h.isBuffer(me))return Le(new Error("invalid input"));if(!this._handle)return Le(new Error("zlib binding closed"));Ie?Ze=this._finishFlushFlag:(Ze=this._flushFlag,me.length>=Xe.length&&(this._flushFlag=this._opts.flush||T.Z_NO_FLUSH)),this._processChunk(me,Ze,Le)},we.prototype._processChunk=function(me,xe,Le){var Ze=me&&me.length,Xe=this._chunkSize-this._offset,je=0,Ie=this,Pe=typeof Le=="function";if(!Pe){var De=[],ze=0,it;this.on("error",function(et){it=et}),k(this._handle,"zlib binding closed");do var tt=this._handle.writeSync(xe,me,je,Ze,this._buffer,this._offset,Xe);while(!this._hadError&&St(tt[0],tt[1]));if(this._hadError)throw it;if(ze>=P)throw Ae(this),new RangeError(D);var ot=h.concat(De,ze);return Ae(this),ot}k(this._handle,"zlib binding closed");var lt=this._handle.write(xe,me,je,Ze,this._buffer,this._offset,Xe);lt.buffer=me,lt.callback=St;function St(et,Je){if(this&&(this.buffer=null,this.callback=null),!Ie._hadError){var Be=Xe-Je;if(k(Be>=0,"have should not go down"),Be>0){var Ge=Ie._buffer.slice(Ie._offset,Ie._offset+Be);Ie._offset+=Be,Pe?Ie.push(Ge):(De.push(Ge),ze+=Ge.length)}if((Je===0||Ie._offset>=Ie._chunkSize)&&(Xe=Ie._chunkSize,Ie._offset=0,Ie._buffer=h.allocUnsafe(Ie._chunkSize)),Je===0){if(je+=Ze-et,Ze=et,!Pe)return!0;var He=Ie._handle.write(xe,me,je,Ze,Ie._buffer,Ie._offset,Ie._chunkSize);He.callback=St,He.buffer=me;return}if(!Pe)return!1;Le()}}},A.inherits(Y,we),A.inherits(X,we),A.inherits(J,we),A.inherits(q,we),A.inherits(te,we),A.inherits(ne,we),A.inherits(de,we)}).call(this,m("_process"))},{"./binding":34,_process:133,assert:25,buffer:48,stream:155,util:186}],36:[function(m,x,E){var S=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";function h(A,k){return Object.prototype.hasOwnProperty.call(A,k)}E.assign=function(A){for(var k=Array.prototype.slice.call(arguments,1);k.length;){var P=k.shift();if(!!P){if(typeof P!="object")throw new TypeError(P+"must be non-object");for(var D in P)h(P,D)&&(A[D]=P[D])}}return A},E.shrinkBuf=function(A,k){return A.length===k?A:A.subarray?A.subarray(0,k):(A.length=k,A)};var I={arraySet:function(A,k,P,D,M){if(k.subarray&&A.subarray){A.set(k.subarray(P,P+D),M);return}for(var F=0;F<D;F++)A[M+F]=k[P+F]},flattenChunks:function(A){var k,P,D,M,F,N;for(D=0,k=0,P=A.length;k<P;k++)D+=A[k].length;for(N=new Uint8Array(D),M=0,k=0,P=A.length;k<P;k++)F=A[k],N.set(F,M),M+=F.length;return N}},T={arraySet:function(A,k,P,D,M){for(var F=0;F<D;F++)A[M+F]=k[P+F]},flattenChunks:function(A){return[].concat.apply([],A)}};E.setTyped=function(A){A?(E.Buf8=Uint8Array,E.Buf16=Uint16Array,E.Buf32=Int32Array,E.assign(E,I)):(E.Buf8=Array,E.Buf16=Array,E.Buf32=Array,E.assign(E,T))},E.setTyped(S)},{}],37:[function(m,x,E){function S(h,I,T,A){for(var k=h&65535|0,P=h>>>16&65535|0,D=0;T!==0;){D=T>2e3?2e3:T,T-=D;do k=k+I[A++]|0,P=P+k|0;while(--D);k%=65521,P%=65521}return k|P<<16|0}x.exports=S},{}],38:[function(m,x,E){x.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],39:[function(m,x,E){function S(){for(var T,A=[],k=0;k<256;k++){T=k;for(var P=0;P<8;P++)T=T&1?3988292384^T>>>1:T>>>1;A[k]=T}return A}var h=S();function I(T,A,k,P){var D=h,M=P+k;T^=-1;for(var F=P;F<M;F++)T=T>>>8^D[(T^A[F])&255];return T^-1}x.exports=I},{}],40:[function(m,x,E){var S=m("../utils/common"),h=m("./trees"),I=m("./adler32"),T=m("./crc32"),A=m("./messages"),k=0,P=1,D=3,M=4,F=5,N=0,B=1,U=-2,O=-3,V=-5,Z=-1,W=1,Y=2,X=3,J=4,q=0,te=2,ne=8,de=9,oe=15,we=8,Ae=29,ye=256,me=ye+1+Ae,xe=30,Le=19,Ze=2*me+1,Xe=15,je=3,Ie=258,Pe=Ie+je+1,De=32,ze=42,it=69,tt=73,ot=91,lt=103,St=113,et=666,Je=1,Be=2,Ge=3,He=4,ve=3;function _e(ie,ke){return ie.msg=A[ke],ke}function pe(ie){return(ie<<1)-(ie>4?9:0)}function fe(ie){for(var ke=ie.length;--ke>=0;)ie[ke]=0}function ue(ie){var ke=ie.state,Ke=ke.pending;Ke>ie.avail_out&&(Ke=ie.avail_out),Ke!==0&&(S.arraySet(ie.output,ke.pending_buf,ke.pending_out,Ke,ie.next_out),ie.next_out+=Ke,ke.pending_out+=Ke,ie.total_out+=Ke,ie.avail_out-=Ke,ke.pending-=Ke,ke.pending===0&&(ke.pending_out=0))}function ce(ie,ke){h._tr_flush_block(ie,ie.block_start>=0?ie.block_start:-1,ie.strstart-ie.block_start,ke),ie.block_start=ie.strstart,ue(ie.strm)}function Ee(ie,ke){ie.pending_buf[ie.pending++]=ke}function Ye(ie,ke){ie.pending_buf[ie.pending++]=ke>>>8&255,ie.pending_buf[ie.pending++]=ke&255}function ft(ie,ke,Ke,re){var le=ie.avail_in;return le>re&&(le=re),le===0?0:(ie.avail_in-=le,S.arraySet(ke,ie.input,ie.next_in,le,Ke),ie.state.wrap===1?ie.adler=I(ie.adler,ke,le,Ke):ie.state.wrap===2&&(ie.adler=T(ie.adler,ke,le,Ke)),ie.next_in+=le,ie.total_in+=le,le)}function _t(ie,ke){var Ke=ie.max_chain_length,re=ie.strstart,le,Se,Ne=ie.prev_length,We=ie.nice_match,nt=ie.strstart>ie.w_size-Pe?ie.strstart-(ie.w_size-Pe):0,vt=ie.window,Dt=ie.w_mask,wt=ie.prev,Tt=ie.strstart+Ie,Nt=vt[re+Ne-1],ri=vt[re+Ne];ie.prev_length>=ie.good_match&&(Ke>>=2),We>ie.lookahead&&(We=ie.lookahead);do if(le=ke,!(vt[le+Ne]!==ri||vt[le+Ne-1]!==Nt||vt[le]!==vt[re]||vt[++le]!==vt[re+1])){re+=2,le++;do;while(vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&re<Tt);if(Se=Ie-(Tt-re),re=Tt-Ie,Se>Ne){if(ie.match_start=ke,Ne=Se,Se>=We)break;Nt=vt[re+Ne-1],ri=vt[re+Ne]}}while((ke=wt[ke&Dt])>nt&&--Ke!=0);return Ne<=ie.lookahead?Ne:ie.lookahead}function It(ie){var ke=ie.w_size,Ke,re,le,Se,Ne;do{if(Se=ie.window_size-ie.lookahead-ie.strstart,ie.strstart>=ke+(ke-Pe)){S.arraySet(ie.window,ie.window,ke,ke,0),ie.match_start-=ke,ie.strstart-=ke,ie.block_start-=ke,re=ie.hash_size,Ke=re;do le=ie.head[--Ke],ie.head[Ke]=le>=ke?le-ke:0;while(--re);re=ke,Ke=re;do le=ie.prev[--Ke],ie.prev[Ke]=le>=ke?le-ke:0;while(--re);Se+=ke}if(ie.strm.avail_in===0)break;if(re=ft(ie.strm,ie.window,ie.strstart+ie.lookahead,Se),ie.lookahead+=re,ie.lookahead+ie.insert>=je)for(Ne=ie.strstart-ie.insert,ie.ins_h=ie.window[Ne],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[Ne+1])&ie.hash_mask;ie.insert&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[Ne+je-1])&ie.hash_mask,ie.prev[Ne&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=Ne,Ne++,ie.insert--,!(ie.lookahead+ie.insert<je)););}while(ie.lookahead<Pe&&ie.strm.avail_in!==0)}function $t(ie,ke){var Ke=65535;for(Ke>ie.pending_buf_size-5&&(Ke=ie.pending_buf_size-5);;){if(ie.lookahead<=1){if(It(ie),ie.lookahead===0&&ke===k)return Je;if(ie.lookahead===0)break}ie.strstart+=ie.lookahead,ie.lookahead=0;var re=ie.block_start+Ke;if((ie.strstart===0||ie.strstart>=re)&&(ie.lookahead=ie.strstart-re,ie.strstart=re,ce(ie,!1),ie.strm.avail_out===0)||ie.strstart-ie.block_start>=ie.w_size-Pe&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):(ie.strstart>ie.block_start&&(ce(ie,!1),ie.strm.avail_out===0),Je)}function Yt(ie,ke){for(var Ke,re;;){if(ie.lookahead<Pe){if(It(ie),ie.lookahead<Pe&&ke===k)return Je;if(ie.lookahead===0)break}if(Ke=0,ie.lookahead>=je&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),Ke!==0&&ie.strstart-Ke<=ie.w_size-Pe&&(ie.match_length=_t(ie,Ke)),ie.match_length>=je)if(re=h._tr_tally(ie,ie.strstart-ie.match_start,ie.match_length-je),ie.lookahead-=ie.match_length,ie.match_length<=ie.max_lazy_match&&ie.lookahead>=je){ie.match_length--;do ie.strstart++,ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart;while(--ie.match_length!=0);ie.strstart++}else ie.strstart+=ie.match_length,ie.match_length=0,ie.ins_h=ie.window[ie.strstart],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+1])&ie.hash_mask;else re=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++;if(re&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=ie.strstart<je-1?ie.strstart:je-1,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function ii(ie,ke){for(var Ke,re,le;;){if(ie.lookahead<Pe){if(It(ie),ie.lookahead<Pe&&ke===k)return Je;if(ie.lookahead===0)break}if(Ke=0,ie.lookahead>=je&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),ie.prev_length=ie.match_length,ie.prev_match=ie.match_start,ie.match_length=je-1,Ke!==0&&ie.prev_length<ie.max_lazy_match&&ie.strstart-Ke<=ie.w_size-Pe&&(ie.match_length=_t(ie,Ke),ie.match_length<=5&&(ie.strategy===W||ie.match_length===je&&ie.strstart-ie.match_start>4096)&&(ie.match_length=je-1)),ie.prev_length>=je&&ie.match_length<=ie.prev_length){le=ie.strstart+ie.lookahead-je,re=h._tr_tally(ie,ie.strstart-1-ie.prev_match,ie.prev_length-je),ie.lookahead-=ie.prev_length-1,ie.prev_length-=2;do++ie.strstart<=le&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart);while(--ie.prev_length!=0);if(ie.match_available=0,ie.match_length=je-1,ie.strstart++,re&&(ce(ie,!1),ie.strm.avail_out===0))return Je}else if(ie.match_available){if(re=h._tr_tally(ie,0,ie.window[ie.strstart-1]),re&&ce(ie,!1),ie.strstart++,ie.lookahead--,ie.strm.avail_out===0)return Je}else ie.match_available=1,ie.strstart++,ie.lookahead--}return ie.match_available&&(re=h._tr_tally(ie,0,ie.window[ie.strstart-1]),ie.match_available=0),ie.insert=ie.strstart<je-1?ie.strstart:je-1,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function zt(ie,ke){for(var Ke,re,le,Se,Ne=ie.window;;){if(ie.lookahead<=Ie){if(It(ie),ie.lookahead<=Ie&&ke===k)return Je;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=je&&ie.strstart>0&&(le=ie.strstart-1,re=Ne[le],re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le])){Se=ie.strstart+Ie;do;while(re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&le<Se);ie.match_length=Ie-(Se-le),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=je?(Ke=h._tr_tally(ie,1,ie.match_length-je),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Ke=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Ke&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function qt(ie,ke){for(var Ke;;){if(ie.lookahead===0&&(It(ie),ie.lookahead===0)){if(ke===k)return Je;break}if(ie.match_length=0,Ke=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Ke&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function Vt(ie,ke,Ke,re,le){this.good_length=ie,this.max_lazy=ke,this.nice_length=Ke,this.max_chain=re,this.func=le}var fi;fi=[new Vt(0,0,0,0,$t),new Vt(4,4,8,4,Yt),new Vt(4,5,16,8,Yt),new Vt(4,6,32,32,Yt),new Vt(4,4,16,16,ii),new Vt(8,16,32,32,ii),new Vt(8,16,128,128,ii),new Vt(8,32,128,256,ii),new Vt(32,128,258,1024,ii),new Vt(32,258,258,4096,ii)];function hi(ie){ie.window_size=2*ie.w_size,fe(ie.head),ie.max_lazy_match=fi[ie.level].max_lazy,ie.good_match=fi[ie.level].good_length,ie.nice_match=fi[ie.level].nice_length,ie.max_chain_length=fi[ie.level].max_chain,ie.strstart=0,ie.block_start=0,ie.lookahead=0,ie.insert=0,ie.match_length=ie.prev_length=je-1,ie.match_available=0,ie.ins_h=0}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ne,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(Ze*2),this.dyn_dtree=new S.Buf16((2*xe+1)*2),this.bl_tree=new S.Buf16((2*Le+1)*2),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(Xe+1),this.heap=new S.Buf16(2*me+1),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*me+1),fe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function bt(ie){var ke;return!ie||!ie.state?_e(ie,U):(ie.total_in=ie.total_out=0,ie.data_type=te,ke=ie.state,ke.pending=0,ke.pending_out=0,ke.wrap<0&&(ke.wrap=-ke.wrap),ke.status=ke.wrap?ze:St,ie.adler=ke.wrap===2?0:1,ke.last_flush=k,h._tr_init(ke),N)}function At(ie){var ke=bt(ie);return ke===N&&hi(ie.state),ke}function Bt(ie,ke){return!ie||!ie.state||ie.state.wrap!==2?U:(ie.state.gzhead=ke,N)}function pt(ie,ke,Ke,re,le,Se){if(!ie)return U;var Ne=1;if(ke===Z&&(ke=6),re<0?(Ne=0,re=-re):re>15&&(Ne=2,re-=16),le<1||le>de||Ke!==ne||re<8||re>15||ke<0||ke>9||Se<0||Se>J)return _e(ie,U);re===8&&(re=9);var We=new Me;return ie.state=We,We.strm=ie,We.wrap=Ne,We.gzhead=null,We.w_bits=re,We.w_size=1<<We.w_bits,We.w_mask=We.w_size-1,We.hash_bits=le+7,We.hash_size=1<<We.hash_bits,We.hash_mask=We.hash_size-1,We.hash_shift=~~((We.hash_bits+je-1)/je),We.window=new S.Buf8(We.w_size*2),We.head=new S.Buf16(We.hash_size),We.prev=new S.Buf16(We.w_size),We.lit_bufsize=1<<le+6,We.pending_buf_size=We.lit_bufsize*4,We.pending_buf=new S.Buf8(We.pending_buf_size),We.d_buf=1*We.lit_bufsize,We.l_buf=(1+2)*We.lit_bufsize,We.level=ke,We.strategy=Se,We.method=Ke,At(ie)}function Rt(ie,ke){return pt(ie,ke,ne,oe,we,q)}function Ve(ie,ke){var Ke,re,le,Se;if(!ie||!ie.state||ke>F||ke<0)return ie?_e(ie,U):U;if(re=ie.state,!ie.output||!ie.input&&ie.avail_in!==0||re.status===et&&ke!==M)return _e(ie,ie.avail_out===0?V:U);if(re.strm=ie,Ke=re.last_flush,re.last_flush=ke,re.status===ze)if(re.wrap===2)ie.adler=0,Ee(re,31),Ee(re,139),Ee(re,8),re.gzhead?(Ee(re,(re.gzhead.text?1:0)+(re.gzhead.hcrc?2:0)+(re.gzhead.extra?4:0)+(re.gzhead.name?8:0)+(re.gzhead.comment?16:0)),Ee(re,re.gzhead.time&255),Ee(re,re.gzhead.time>>8&255),Ee(re,re.gzhead.time>>16&255),Ee(re,re.gzhead.time>>24&255),Ee(re,re.level===9?2:re.strategy>=Y||re.level<2?4:0),Ee(re,re.gzhead.os&255),re.gzhead.extra&&re.gzhead.extra.length&&(Ee(re,re.gzhead.extra.length&255),Ee(re,re.gzhead.extra.length>>8&255)),re.gzhead.hcrc&&(ie.adler=T(ie.adler,re.pending_buf,re.pending,0)),re.gzindex=0,re.status=it):(Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,re.level===9?2:re.strategy>=Y||re.level<2?4:0),Ee(re,ve),re.status=St);else{var Ne=ne+(re.w_bits-8<<4)<<8,We=-1;re.strategy>=Y||re.level<2?We=0:re.level<6?We=1:re.level===6?We=2:We=3,Ne|=We<<6,re.strstart!==0&&(Ne|=De),Ne+=31-Ne%31,re.status=St,Ye(re,Ne),re.strstart!==0&&(Ye(re,ie.adler>>>16),Ye(re,ie.adler&65535)),ie.adler=1}if(re.status===it)if(re.gzhead.extra){for(le=re.pending;re.gzindex<(re.gzhead.extra.length&65535)&&!(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size));)Ee(re,re.gzhead.extra[re.gzindex]&255),re.gzindex++;re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),re.gzindex===re.gzhead.extra.length&&(re.gzindex=0,re.status=tt)}else re.status=tt;if(re.status===tt)if(re.gzhead.name){le=re.pending;do{if(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size)){Se=1;break}re.gzindex<re.gzhead.name.length?Se=re.gzhead.name.charCodeAt(re.gzindex++)&255:Se=0,Ee(re,Se)}while(Se!==0);re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),Se===0&&(re.gzindex=0,re.status=ot)}else re.status=ot;if(re.status===ot)if(re.gzhead.comment){le=re.pending;do{if(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size)){Se=1;break}re.gzindex<re.gzhead.comment.length?Se=re.gzhead.comment.charCodeAt(re.gzindex++)&255:Se=0,Ee(re,Se)}while(Se!==0);re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),Se===0&&(re.status=lt)}else re.status=lt;if(re.status===lt&&(re.gzhead.hcrc?(re.pending+2>re.pending_buf_size&&ue(ie),re.pending+2<=re.pending_buf_size&&(Ee(re,ie.adler&255),Ee(re,ie.adler>>8&255),ie.adler=0,re.status=St)):re.status=St),re.pending!==0){if(ue(ie),ie.avail_out===0)return re.last_flush=-1,N}else if(ie.avail_in===0&&pe(ke)<=pe(Ke)&&ke!==M)return _e(ie,V);if(re.status===et&&ie.avail_in!==0)return _e(ie,V);if(ie.avail_in!==0||re.lookahead!==0||ke!==k&&re.status!==et){var nt=re.strategy===Y?qt(re,ke):re.strategy===X?zt(re,ke):fi[re.level].func(re,ke);if((nt===Ge||nt===He)&&(re.status=et),nt===Je||nt===Ge)return ie.avail_out===0&&(re.last_flush=-1),N;if(nt===Be&&(ke===P?h._tr_align(re):ke!==F&&(h._tr_stored_block(re,0,0,!1),ke===D&&(fe(re.head),re.lookahead===0&&(re.strstart=0,re.block_start=0,re.insert=0))),ue(ie),ie.avail_out===0))return re.last_flush=-1,N}return ke!==M?N:re.wrap<=0?B:(re.wrap===2?(Ee(re,ie.adler&255),Ee(re,ie.adler>>8&255),Ee(re,ie.adler>>16&255),Ee(re,ie.adler>>24&255),Ee(re,ie.total_in&255),Ee(re,ie.total_in>>8&255),Ee(re,ie.total_in>>16&255),Ee(re,ie.total_in>>24&255)):(Ye(re,ie.adler>>>16),Ye(re,ie.adler&65535)),ue(ie),re.wrap>0&&(re.wrap=-re.wrap),re.pending!==0?N:B)}function jt(ie){var ke;return!ie||!ie.state?U:(ke=ie.state.status,ke!==ze&&ke!==it&&ke!==tt&&ke!==ot&&ke!==lt&&ke!==St&&ke!==et?_e(ie,U):(ie.state=null,ke===St?_e(ie,O):N))}function mi(ie,ke){var Ke=ke.length,re,le,Se,Ne,We,nt,vt,Dt;if(!ie||!ie.state||(re=ie.state,Ne=re.wrap,Ne===2||Ne===1&&re.status!==ze||re.lookahead))return U;for(Ne===1&&(ie.adler=I(ie.adler,ke,Ke,0)),re.wrap=0,Ke>=re.w_size&&(Ne===0&&(fe(re.head),re.strstart=0,re.block_start=0,re.insert=0),Dt=new S.Buf8(re.w_size),S.arraySet(Dt,ke,Ke-re.w_size,re.w_size,0),ke=Dt,Ke=re.w_size),We=ie.avail_in,nt=ie.next_in,vt=ie.input,ie.avail_in=Ke,ie.next_in=0,ie.input=ke,It(re);re.lookahead>=je;){le=re.strstart,Se=re.lookahead-(je-1);do re.ins_h=(re.ins_h<<re.hash_shift^re.window[le+je-1])&re.hash_mask,re.prev[le&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=le,le++;while(--Se);re.strstart=le,re.lookahead=je-1,It(re)}return re.strstart+=re.lookahead,re.block_start=re.strstart,re.insert=re.lookahead,re.lookahead=0,re.match_length=re.prev_length=je-1,re.match_available=0,ie.next_in=nt,ie.input=vt,ie.avail_in=We,re.wrap=Ne,N}E.deflateInit=Rt,E.deflateInit2=pt,E.deflateReset=At,E.deflateResetKeep=bt,E.deflateSetHeader=Bt,E.deflate=Ve,E.deflateEnd=jt,E.deflateSetDictionary=mi,E.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":36,"./adler32":37,"./crc32":39,"./messages":44,"./trees":45}],41:[function(m,x,E){var S=30,h=12;x.exports=function(T,A){var k,P,D,M,F,N,B,U,O,V,Z,W,Y,X,J,q,te,ne,de,oe,we,Ae,ye,me,xe;k=T.state,P=T.next_in,me=T.input,D=P+(T.avail_in-5),M=T.next_out,xe=T.output,F=M-(A-T.avail_out),N=M+(T.avail_out-257),B=k.dmax,U=k.wsize,O=k.whave,V=k.wnext,Z=k.window,W=k.hold,Y=k.bits,X=k.lencode,J=k.distcode,q=(1<<k.lenbits)-1,te=(1<<k.distbits)-1;e:do{Y<15&&(W+=me[P++]<<Y,Y+=8,W+=me[P++]<<Y,Y+=8),ne=X[W&q];t:for(;;){if(de=ne>>>24,W>>>=de,Y-=de,de=ne>>>16&255,de===0)xe[M++]=ne&65535;else if(de&16){oe=ne&65535,de&=15,de&&(Y<de&&(W+=me[P++]<<Y,Y+=8),oe+=W&(1<<de)-1,W>>>=de,Y-=de),Y<15&&(W+=me[P++]<<Y,Y+=8,W+=me[P++]<<Y,Y+=8),ne=J[W&te];i:for(;;){if(de=ne>>>24,W>>>=de,Y-=de,de=ne>>>16&255,de&16){if(we=ne&65535,de&=15,Y<de&&(W+=me[P++]<<Y,Y+=8,Y<de&&(W+=me[P++]<<Y,Y+=8)),we+=W&(1<<de)-1,we>B){T.msg="invalid distance too far back",k.mode=S;break e}if(W>>>=de,Y-=de,de=M-F,we>de){if(de=we-de,de>O&&k.sane){T.msg="invalid distance too far back",k.mode=S;break e}if(Ae=0,ye=Z,V===0){if(Ae+=U-de,de<oe){oe-=de;do xe[M++]=Z[Ae++];while(--de);Ae=M-we,ye=xe}}else if(V<de){if(Ae+=U+V-de,de-=V,de<oe){oe-=de;do xe[M++]=Z[Ae++];while(--de);if(Ae=0,V<oe){de=V,oe-=de;do xe[M++]=Z[Ae++];while(--de);Ae=M-we,ye=xe}}}else if(Ae+=V-de,de<oe){oe-=de;do xe[M++]=Z[Ae++];while(--de);Ae=M-we,ye=xe}for(;oe>2;)xe[M++]=ye[Ae++],xe[M++]=ye[Ae++],xe[M++]=ye[Ae++],oe-=3;oe&&(xe[M++]=ye[Ae++],oe>1&&(xe[M++]=ye[Ae++]))}else{Ae=M-we;do xe[M++]=xe[Ae++],xe[M++]=xe[Ae++],xe[M++]=xe[Ae++],oe-=3;while(oe>2);oe&&(xe[M++]=xe[Ae++],oe>1&&(xe[M++]=xe[Ae++]))}}else if((de&64)==0){ne=J[(ne&65535)+(W&(1<<de)-1)];continue i}else{T.msg="invalid distance code",k.mode=S;break e}break}}else if((de&64)==0){ne=X[(ne&65535)+(W&(1<<de)-1)];continue t}else if(de&32){k.mode=h;break e}else{T.msg="invalid literal/length code",k.mode=S;break e}break}}while(P<D&&M<N);oe=Y>>3,P-=oe,Y-=oe<<3,W&=(1<<Y)-1,T.next_in=P,T.next_out=M,T.avail_in=P<D?5+(D-P):5-(P-D),T.avail_out=M<N?257+(N-M):257-(M-N),k.hold=W,k.bits=Y}},{}],42:[function(m,x,E){var S=m("../utils/common"),h=m("./adler32"),I=m("./crc32"),T=m("./inffast"),A=m("./inftrees"),k=0,P=1,D=2,M=4,F=5,N=6,B=0,U=1,O=2,V=-2,Z=-3,W=-4,Y=-5,X=8,J=1,q=2,te=3,ne=4,de=5,oe=6,we=7,Ae=8,ye=9,me=10,xe=11,Le=12,Ze=13,Xe=14,je=15,Ie=16,Pe=17,De=18,ze=19,it=20,tt=21,ot=22,lt=23,St=24,et=25,Je=26,Be=27,Ge=28,He=29,ve=30,_e=31,pe=32,fe=852,ue=592,ce=15,Ee=ce;function Ye(pt){return(pt>>>24&255)+(pt>>>8&65280)+((pt&65280)<<8)+((pt&255)<<24)}function ft(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new S.Buf16(320),this.work=new S.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _t(pt){var Rt;return!pt||!pt.state?V:(Rt=pt.state,pt.total_in=pt.total_out=Rt.total=0,pt.msg="",Rt.wrap&&(pt.adler=Rt.wrap&1),Rt.mode=J,Rt.last=0,Rt.havedict=0,Rt.dmax=32768,Rt.head=null,Rt.hold=0,Rt.bits=0,Rt.lencode=Rt.lendyn=new S.Buf32(fe),Rt.distcode=Rt.distdyn=new S.Buf32(ue),Rt.sane=1,Rt.back=-1,B)}function It(pt){var Rt;return!pt||!pt.state?V:(Rt=pt.state,Rt.wsize=0,Rt.whave=0,Rt.wnext=0,_t(pt))}function $t(pt,Rt){var Ve,jt;return!pt||!pt.state||(jt=pt.state,Rt<0?(Ve=0,Rt=-Rt):(Ve=(Rt>>4)+1,Rt<48&&(Rt&=15)),Rt&&(Rt<8||Rt>15))?V:(jt.window!==null&&jt.wbits!==Rt&&(jt.window=null),jt.wrap=Ve,jt.wbits=Rt,It(pt))}function Yt(pt,Rt){var Ve,jt;return pt?(jt=new ft,pt.state=jt,jt.window=null,Ve=$t(pt,Rt),Ve!==B&&(pt.state=null),Ve):V}function ii(pt){return Yt(pt,Ee)}var zt=!0,qt,Vt;function fi(pt){if(zt){var Rt;for(qt=new S.Buf32(512),Vt=new S.Buf32(32),Rt=0;Rt<144;)pt.lens[Rt++]=8;for(;Rt<256;)pt.lens[Rt++]=9;for(;Rt<280;)pt.lens[Rt++]=7;for(;Rt<288;)pt.lens[Rt++]=8;for(A(P,pt.lens,0,288,qt,0,pt.work,{bits:9}),Rt=0;Rt<32;)pt.lens[Rt++]=5;A(D,pt.lens,0,32,Vt,0,pt.work,{bits:5}),zt=!1}pt.lencode=qt,pt.lenbits=9,pt.distcode=Vt,pt.distbits=5}function hi(pt,Rt,Ve,jt){var mi,ie=pt.state;return ie.window===null&&(ie.wsize=1<<ie.wbits,ie.wnext=0,ie.whave=0,ie.window=new S.Buf8(ie.wsize)),jt>=ie.wsize?(S.arraySet(ie.window,Rt,Ve-ie.wsize,ie.wsize,0),ie.wnext=0,ie.whave=ie.wsize):(mi=ie.wsize-ie.wnext,mi>jt&&(mi=jt),S.arraySet(ie.window,Rt,Ve-jt,mi,ie.wnext),jt-=mi,jt?(S.arraySet(ie.window,Rt,Ve-jt,jt,0),ie.wnext=jt,ie.whave=ie.wsize):(ie.wnext+=mi,ie.wnext===ie.wsize&&(ie.wnext=0),ie.whave<ie.wsize&&(ie.whave+=mi))),0}function Me(pt,Rt){var Ve,jt,mi,ie,ke,Ke,re,le,Se,Ne,We,nt,vt,Dt,wt=0,Tt,Nt,ri,Ht,_i,ai,Ct,Ut,Mi=new S.Buf8(4),ki,Si,Bi=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!pt||!pt.state||!pt.output||!pt.input&&pt.avail_in!==0)return V;Ve=pt.state,Ve.mode===Le&&(Ve.mode=Ze),ke=pt.next_out,mi=pt.output,re=pt.avail_out,ie=pt.next_in,jt=pt.input,Ke=pt.avail_in,le=Ve.hold,Se=Ve.bits,Ne=Ke,We=re,Ut=B;e:for(;;)switch(Ve.mode){case J:if(Ve.wrap===0){Ve.mode=Ze;break}for(;Se<16;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(Ve.wrap&2&&le===35615){Ve.check=0,Mi[0]=le&255,Mi[1]=le>>>8&255,Ve.check=I(Ve.check,Mi,2,0),le=0,Se=0,Ve.mode=q;break}if(Ve.flags=0,Ve.head&&(Ve.head.done=!1),!(Ve.wrap&1)||(((le&255)<<8)+(le>>8))%31){pt.msg="incorrect header check",Ve.mode=ve;break}if((le&15)!==X){pt.msg="unknown compression method",Ve.mode=ve;break}if(le>>>=4,Se-=4,Ct=(le&15)+8,Ve.wbits===0)Ve.wbits=Ct;else if(Ct>Ve.wbits){pt.msg="invalid window size",Ve.mode=ve;break}Ve.dmax=1<<Ct,pt.adler=Ve.check=1,Ve.mode=le&512?me:Le,le=0,Se=0;break;case q:for(;Se<16;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(Ve.flags=le,(Ve.flags&255)!==X){pt.msg="unknown compression method",Ve.mode=ve;break}if(Ve.flags&57344){pt.msg="unknown header flags set",Ve.mode=ve;break}Ve.head&&(Ve.head.text=le>>8&1),Ve.flags&512&&(Mi[0]=le&255,Mi[1]=le>>>8&255,Ve.check=I(Ve.check,Mi,2,0)),le=0,Se=0,Ve.mode=te;case te:for(;Se<32;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.head&&(Ve.head.time=le),Ve.flags&512&&(Mi[0]=le&255,Mi[1]=le>>>8&255,Mi[2]=le>>>16&255,Mi[3]=le>>>24&255,Ve.check=I(Ve.check,Mi,4,0)),le=0,Se=0,Ve.mode=ne;case ne:for(;Se<16;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.head&&(Ve.head.xflags=le&255,Ve.head.os=le>>8),Ve.flags&512&&(Mi[0]=le&255,Mi[1]=le>>>8&255,Ve.check=I(Ve.check,Mi,2,0)),le=0,Se=0,Ve.mode=de;case de:if(Ve.flags&1024){for(;Se<16;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.length=le,Ve.head&&(Ve.head.extra_len=le),Ve.flags&512&&(Mi[0]=le&255,Mi[1]=le>>>8&255,Ve.check=I(Ve.check,Mi,2,0)),le=0,Se=0}else Ve.head&&(Ve.head.extra=null);Ve.mode=oe;case oe:if(Ve.flags&1024&&(nt=Ve.length,nt>Ke&&(nt=Ke),nt&&(Ve.head&&(Ct=Ve.head.extra_len-Ve.length,Ve.head.extra||(Ve.head.extra=new Array(Ve.head.extra_len)),S.arraySet(Ve.head.extra,jt,ie,nt,Ct)),Ve.flags&512&&(Ve.check=I(Ve.check,jt,nt,ie)),Ke-=nt,ie+=nt,Ve.length-=nt),Ve.length))break e;Ve.length=0,Ve.mode=we;case we:if(Ve.flags&2048){if(Ke===0)break e;nt=0;do Ct=jt[ie+nt++],Ve.head&&Ct&&Ve.length<65536&&(Ve.head.name+=String.fromCharCode(Ct));while(Ct&&nt<Ke);if(Ve.flags&512&&(Ve.check=I(Ve.check,jt,nt,ie)),Ke-=nt,ie+=nt,Ct)break e}else Ve.head&&(Ve.head.name=null);Ve.length=0,Ve.mode=Ae;case Ae:if(Ve.flags&4096){if(Ke===0)break e;nt=0;do Ct=jt[ie+nt++],Ve.head&&Ct&&Ve.length<65536&&(Ve.head.comment+=String.fromCharCode(Ct));while(Ct&&nt<Ke);if(Ve.flags&512&&(Ve.check=I(Ve.check,jt,nt,ie)),Ke-=nt,ie+=nt,Ct)break e}else Ve.head&&(Ve.head.comment=null);Ve.mode=ye;case ye:if(Ve.flags&512){for(;Se<16;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(le!==(Ve.check&65535)){pt.msg="header crc mismatch",Ve.mode=ve;break}le=0,Se=0}Ve.head&&(Ve.head.hcrc=Ve.flags>>9&1,Ve.head.done=!0),pt.adler=Ve.check=0,Ve.mode=Le;break;case me:for(;Se<32;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}pt.adler=Ve.check=Ye(le),le=0,Se=0,Ve.mode=xe;case xe:if(Ve.havedict===0)return pt.next_out=ke,pt.avail_out=re,pt.next_in=ie,pt.avail_in=Ke,Ve.hold=le,Ve.bits=Se,O;pt.adler=Ve.check=1,Ve.mode=Le;case Le:if(Rt===F||Rt===N)break e;case Ze:if(Ve.last){le>>>=Se&7,Se-=Se&7,Ve.mode=Be;break}for(;Se<3;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}switch(Ve.last=le&1,le>>>=1,Se-=1,le&3){case 0:Ve.mode=Xe;break;case 1:if(fi(Ve),Ve.mode=it,Rt===N){le>>>=2,Se-=2;break e}break;case 2:Ve.mode=Pe;break;case 3:pt.msg="invalid block type",Ve.mode=ve}le>>>=2,Se-=2;break;case Xe:for(le>>>=Se&7,Se-=Se&7;Se<32;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if((le&65535)!=(le>>>16^65535)){pt.msg="invalid stored block lengths",Ve.mode=ve;break}if(Ve.length=le&65535,le=0,Se=0,Ve.mode=je,Rt===N)break e;case je:Ve.mode=Ie;case Ie:if(nt=Ve.length,nt){if(nt>Ke&&(nt=Ke),nt>re&&(nt=re),nt===0)break e;S.arraySet(mi,jt,ie,nt,ke),Ke-=nt,ie+=nt,re-=nt,ke+=nt,Ve.length-=nt;break}Ve.mode=Le;break;case Pe:for(;Se<14;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(Ve.nlen=(le&31)+257,le>>>=5,Se-=5,Ve.ndist=(le&31)+1,le>>>=5,Se-=5,Ve.ncode=(le&15)+4,le>>>=4,Se-=4,Ve.nlen>286||Ve.ndist>30){pt.msg="too many length or distance symbols",Ve.mode=ve;break}Ve.have=0,Ve.mode=De;case De:for(;Ve.have<Ve.ncode;){for(;Se<3;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.lens[Bi[Ve.have++]]=le&7,le>>>=3,Se-=3}for(;Ve.have<19;)Ve.lens[Bi[Ve.have++]]=0;if(Ve.lencode=Ve.lendyn,Ve.lenbits=7,ki={bits:Ve.lenbits},Ut=A(k,Ve.lens,0,19,Ve.lencode,0,Ve.work,ki),Ve.lenbits=ki.bits,Ut){pt.msg="invalid code lengths set",Ve.mode=ve;break}Ve.have=0,Ve.mode=ze;case ze:for(;Ve.have<Ve.nlen+Ve.ndist;){for(;wt=Ve.lencode[le&(1<<Ve.lenbits)-1],Tt=wt>>>24,Nt=wt>>>16&255,ri=wt&65535,!(Tt<=Se);){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(ri<16)le>>>=Tt,Se-=Tt,Ve.lens[Ve.have++]=ri;else{if(ri===16){for(Si=Tt+2;Se<Si;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(le>>>=Tt,Se-=Tt,Ve.have===0){pt.msg="invalid bit length repeat",Ve.mode=ve;break}Ct=Ve.lens[Ve.have-1],nt=3+(le&3),le>>>=2,Se-=2}else if(ri===17){for(Si=Tt+3;Se<Si;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}le>>>=Tt,Se-=Tt,Ct=0,nt=3+(le&7),le>>>=3,Se-=3}else{for(Si=Tt+7;Se<Si;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}le>>>=Tt,Se-=Tt,Ct=0,nt=11+(le&127),le>>>=7,Se-=7}if(Ve.have+nt>Ve.nlen+Ve.ndist){pt.msg="invalid bit length repeat",Ve.mode=ve;break}for(;nt--;)Ve.lens[Ve.have++]=Ct}}if(Ve.mode===ve)break;if(Ve.lens[256]===0){pt.msg="invalid code -- missing end-of-block",Ve.mode=ve;break}if(Ve.lenbits=9,ki={bits:Ve.lenbits},Ut=A(P,Ve.lens,0,Ve.nlen,Ve.lencode,0,Ve.work,ki),Ve.lenbits=ki.bits,Ut){pt.msg="invalid literal/lengths set",Ve.mode=ve;break}if(Ve.distbits=6,Ve.distcode=Ve.distdyn,ki={bits:Ve.distbits},Ut=A(D,Ve.lens,Ve.nlen,Ve.ndist,Ve.distcode,0,Ve.work,ki),Ve.distbits=ki.bits,Ut){pt.msg="invalid distances set",Ve.mode=ve;break}if(Ve.mode=it,Rt===N)break e;case it:Ve.mode=tt;case tt:if(Ke>=6&&re>=258){pt.next_out=ke,pt.avail_out=re,pt.next_in=ie,pt.avail_in=Ke,Ve.hold=le,Ve.bits=Se,T(pt,We),ke=pt.next_out,mi=pt.output,re=pt.avail_out,ie=pt.next_in,jt=pt.input,Ke=pt.avail_in,le=Ve.hold,Se=Ve.bits,Ve.mode===Le&&(Ve.back=-1);break}for(Ve.back=0;wt=Ve.lencode[le&(1<<Ve.lenbits)-1],Tt=wt>>>24,Nt=wt>>>16&255,ri=wt&65535,!(Tt<=Se);){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(Nt&&(Nt&240)==0){for(Ht=Tt,_i=Nt,ai=ri;wt=Ve.lencode[ai+((le&(1<<Ht+_i)-1)>>Ht)],Tt=wt>>>24,Nt=wt>>>16&255,ri=wt&65535,!(Ht+Tt<=Se);){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}le>>>=Ht,Se-=Ht,Ve.back+=Ht}if(le>>>=Tt,Se-=Tt,Ve.back+=Tt,Ve.length=ri,Nt===0){Ve.mode=Je;break}if(Nt&32){Ve.back=-1,Ve.mode=Le;break}if(Nt&64){pt.msg="invalid literal/length code",Ve.mode=ve;break}Ve.extra=Nt&15,Ve.mode=ot;case ot:if(Ve.extra){for(Si=Ve.extra;Se<Si;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.length+=le&(1<<Ve.extra)-1,le>>>=Ve.extra,Se-=Ve.extra,Ve.back+=Ve.extra}Ve.was=Ve.length,Ve.mode=lt;case lt:for(;wt=Ve.distcode[le&(1<<Ve.distbits)-1],Tt=wt>>>24,Nt=wt>>>16&255,ri=wt&65535,!(Tt<=Se);){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if((Nt&240)==0){for(Ht=Tt,_i=Nt,ai=ri;wt=Ve.distcode[ai+((le&(1<<Ht+_i)-1)>>Ht)],Tt=wt>>>24,Nt=wt>>>16&255,ri=wt&65535,!(Ht+Tt<=Se);){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}le>>>=Ht,Se-=Ht,Ve.back+=Ht}if(le>>>=Tt,Se-=Tt,Ve.back+=Tt,Nt&64){pt.msg="invalid distance code",Ve.mode=ve;break}Ve.offset=ri,Ve.extra=Nt&15,Ve.mode=St;case St:if(Ve.extra){for(Si=Ve.extra;Se<Si;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}Ve.offset+=le&(1<<Ve.extra)-1,le>>>=Ve.extra,Se-=Ve.extra,Ve.back+=Ve.extra}if(Ve.offset>Ve.dmax){pt.msg="invalid distance too far back",Ve.mode=ve;break}Ve.mode=et;case et:if(re===0)break e;if(nt=We-re,Ve.offset>nt){if(nt=Ve.offset-nt,nt>Ve.whave&&Ve.sane){pt.msg="invalid distance too far back",Ve.mode=ve;break}nt>Ve.wnext?(nt-=Ve.wnext,vt=Ve.wsize-nt):vt=Ve.wnext-nt,nt>Ve.length&&(nt=Ve.length),Dt=Ve.window}else Dt=mi,vt=ke-Ve.offset,nt=Ve.length;nt>re&&(nt=re),re-=nt,Ve.length-=nt;do mi[ke++]=Dt[vt++];while(--nt);Ve.length===0&&(Ve.mode=tt);break;case Je:if(re===0)break e;mi[ke++]=Ve.length,re--,Ve.mode=tt;break;case Be:if(Ve.wrap){for(;Se<32;){if(Ke===0)break e;Ke--,le|=jt[ie++]<<Se,Se+=8}if(We-=re,pt.total_out+=We,Ve.total+=We,We&&(pt.adler=Ve.check=Ve.flags?I(Ve.check,mi,We,ke-We):h(Ve.check,mi,We,ke-We)),We=re,(Ve.flags?le:Ye(le))!==Ve.check){pt.msg="incorrect data check",Ve.mode=ve;break}le=0,Se=0}Ve.mode=Ge;case Ge:if(Ve.wrap&&Ve.flags){for(;Se<32;){if(Ke===0)break e;Ke--,le+=jt[ie++]<<Se,Se+=8}if(le!==(Ve.total&4294967295)){pt.msg="incorrect length check",Ve.mode=ve;break}le=0,Se=0}Ve.mode=He;case He:Ut=U;break e;case ve:Ut=Z;break e;case _e:return W;case pe:default:return V}return pt.next_out=ke,pt.avail_out=re,pt.next_in=ie,pt.avail_in=Ke,Ve.hold=le,Ve.bits=Se,(Ve.wsize||We!==pt.avail_out&&Ve.mode<ve&&(Ve.mode<Be||Rt!==M))&&hi(pt,pt.output,pt.next_out,We-pt.avail_out),Ne-=pt.avail_in,We-=pt.avail_out,pt.total_in+=Ne,pt.total_out+=We,Ve.total+=We,Ve.wrap&&We&&(pt.adler=Ve.check=Ve.flags?I(Ve.check,mi,We,pt.next_out-We):h(Ve.check,mi,We,pt.next_out-We)),pt.data_type=Ve.bits+(Ve.last?64:0)+(Ve.mode===Le?128:0)+(Ve.mode===it||Ve.mode===je?256:0),(Ne===0&&We===0||Rt===M)&&Ut===B&&(Ut=Y),Ut}function bt(pt){if(!pt||!pt.state)return V;var Rt=pt.state;return Rt.window&&(Rt.window=null),pt.state=null,B}function At(pt,Rt){var Ve;return!pt||!pt.state||(Ve=pt.state,(Ve.wrap&2)==0)?V:(Ve.head=Rt,Rt.done=!1,B)}function Bt(pt,Rt){var Ve=Rt.length,jt,mi,ie;return!pt||!pt.state||(jt=pt.state,jt.wrap!==0&&jt.mode!==xe)?V:jt.mode===xe&&(mi=1,mi=h(mi,Rt,Ve,0),mi!==jt.check)?Z:(ie=hi(pt,Rt,Ve,Ve),ie?(jt.mode=_e,W):(jt.havedict=1,B))}E.inflateReset=It,E.inflateReset2=$t,E.inflateResetKeep=_t,E.inflateInit=ii,E.inflateInit2=Yt,E.inflate=Me,E.inflateEnd=bt,E.inflateGetHeader=At,E.inflateSetDictionary=Bt,E.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":36,"./adler32":37,"./crc32":39,"./inffast":41,"./inftrees":43}],43:[function(m,x,E){var S=m("../utils/common"),h=15,I=852,T=592,A=0,k=1,P=2,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],M=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],N=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];x.exports=function(U,O,V,Z,W,Y,X,J){var q=J.bits,te=0,ne=0,de=0,oe=0,we=0,Ae=0,ye=0,me=0,xe=0,Le=0,Ze,Xe,je,Ie,Pe,De=null,ze=0,it,tt=new S.Buf16(h+1),ot=new S.Buf16(h+1),lt=null,St=0,et,Je,Be;for(te=0;te<=h;te++)tt[te]=0;for(ne=0;ne<Z;ne++)tt[O[V+ne]]++;for(we=q,oe=h;oe>=1&&tt[oe]===0;oe--);if(we>oe&&(we=oe),oe===0)return W[Y++]=1<<24|64<<16|0,W[Y++]=1<<24|64<<16|0,J.bits=1,0;for(de=1;de<oe&&tt[de]===0;de++);for(we<de&&(we=de),me=1,te=1;te<=h;te++)if(me<<=1,me-=tt[te],me<0)return-1;if(me>0&&(U===A||oe!==1))return-1;for(ot[1]=0,te=1;te<h;te++)ot[te+1]=ot[te]+tt[te];for(ne=0;ne<Z;ne++)O[V+ne]!==0&&(X[ot[O[V+ne]]++]=ne);if(U===A?(De=lt=X,it=19):U===k?(De=D,ze-=257,lt=M,St-=257,it=256):(De=F,lt=N,it=-1),Le=0,ne=0,te=de,Pe=Y,Ae=we,ye=0,je=-1,xe=1<<we,Ie=xe-1,U===k&&xe>I||U===P&&xe>T)return 1;for(;;){et=te-ye,X[ne]<it?(Je=0,Be=X[ne]):X[ne]>it?(Je=lt[St+X[ne]],Be=De[ze+X[ne]]):(Je=32+64,Be=0),Ze=1<<te-ye,Xe=1<<Ae,de=Xe;do Xe-=Ze,W[Pe+(Le>>ye)+Xe]=et<<24|Je<<16|Be|0;while(Xe!==0);for(Ze=1<<te-1;Le&Ze;)Ze>>=1;if(Ze!==0?(Le&=Ze-1,Le+=Ze):Le=0,ne++,--tt[te]==0){if(te===oe)break;te=O[V+X[ne]]}if(te>we&&(Le&Ie)!==je){for(ye===0&&(ye=we),Pe+=de,Ae=te-ye,me=1<<Ae;Ae+ye<oe&&(me-=tt[Ae+ye],!(me<=0));)Ae++,me<<=1;if(xe+=1<<Ae,U===k&&xe>I||U===P&&xe>T)return 1;je=Le&Ie,W[je]=we<<24|Ae<<16|Pe-Y|0}}return Le!==0&&(W[Pe+Le]=te-ye<<24|64<<16|0),J.bits=we,0}},{"../utils/common":36}],44:[function(m,x,E){x.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],45:[function(m,x,E){var S=m("../utils/common"),h=4,I=0,T=1,A=2;function k(Me){for(var bt=Me.length;--bt>=0;)Me[bt]=0}var P=0,D=1,M=2,F=3,N=258,B=29,U=256,O=U+1+B,V=30,Z=19,W=2*O+1,Y=15,X=16,J=7,q=256,te=16,ne=17,de=18,oe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],we=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ae=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ye=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],me=512,xe=new Array((O+2)*2);k(xe);var Le=new Array(V*2);k(Le);var Ze=new Array(me);k(Ze);var Xe=new Array(N-F+1);k(Xe);var je=new Array(B);k(je);var Ie=new Array(V);k(Ie);function Pe(Me,bt,At,Bt,pt){this.static_tree=Me,this.extra_bits=bt,this.extra_base=At,this.elems=Bt,this.max_length=pt,this.has_stree=Me&&Me.length}var De,ze,it;function tt(Me,bt){this.dyn_tree=Me,this.max_code=0,this.stat_desc=bt}function ot(Me){return Me<256?Ze[Me]:Ze[256+(Me>>>7)]}function lt(Me,bt){Me.pending_buf[Me.pending++]=bt&255,Me.pending_buf[Me.pending++]=bt>>>8&255}function St(Me,bt,At){Me.bi_valid>X-At?(Me.bi_buf|=bt<<Me.bi_valid&65535,lt(Me,Me.bi_buf),Me.bi_buf=bt>>X-Me.bi_valid,Me.bi_valid+=At-X):(Me.bi_buf|=bt<<Me.bi_valid&65535,Me.bi_valid+=At)}function et(Me,bt,At){St(Me,At[bt*2],At[bt*2+1])}function Je(Me,bt){var At=0;do At|=Me&1,Me>>>=1,At<<=1;while(--bt>0);return At>>>1}function Be(Me){Me.bi_valid===16?(lt(Me,Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0):Me.bi_valid>=8&&(Me.pending_buf[Me.pending++]=Me.bi_buf&255,Me.bi_buf>>=8,Me.bi_valid-=8)}function Ge(Me,bt){var At=bt.dyn_tree,Bt=bt.max_code,pt=bt.stat_desc.static_tree,Rt=bt.stat_desc.has_stree,Ve=bt.stat_desc.extra_bits,jt=bt.stat_desc.extra_base,mi=bt.stat_desc.max_length,ie,ke,Ke,re,le,Se,Ne=0;for(re=0;re<=Y;re++)Me.bl_count[re]=0;for(At[Me.heap[Me.heap_max]*2+1]=0,ie=Me.heap_max+1;ie<W;ie++)ke=Me.heap[ie],re=At[At[ke*2+1]*2+1]+1,re>mi&&(re=mi,Ne++),At[ke*2+1]=re,!(ke>Bt)&&(Me.bl_count[re]++,le=0,ke>=jt&&(le=Ve[ke-jt]),Se=At[ke*2],Me.opt_len+=Se*(re+le),Rt&&(Me.static_len+=Se*(pt[ke*2+1]+le)));if(Ne!==0){do{for(re=mi-1;Me.bl_count[re]===0;)re--;Me.bl_count[re]--,Me.bl_count[re+1]+=2,Me.bl_count[mi]--,Ne-=2}while(Ne>0);for(re=mi;re!==0;re--)for(ke=Me.bl_count[re];ke!==0;)Ke=Me.heap[--ie],!(Ke>Bt)&&(At[Ke*2+1]!==re&&(Me.opt_len+=(re-At[Ke*2+1])*At[Ke*2],At[Ke*2+1]=re),ke--)}}function He(Me,bt,At){var Bt=new Array(Y+1),pt=0,Rt,Ve;for(Rt=1;Rt<=Y;Rt++)Bt[Rt]=pt=pt+At[Rt-1]<<1;for(Ve=0;Ve<=bt;Ve++){var jt=Me[Ve*2+1];jt!==0&&(Me[Ve*2]=Je(Bt[jt]++,jt))}}function ve(){var Me,bt,At,Bt,pt,Rt=new Array(Y+1);for(At=0,Bt=0;Bt<B-1;Bt++)for(je[Bt]=At,Me=0;Me<1<<oe[Bt];Me++)Xe[At++]=Bt;for(Xe[At-1]=Bt,pt=0,Bt=0;Bt<16;Bt++)for(Ie[Bt]=pt,Me=0;Me<1<<we[Bt];Me++)Ze[pt++]=Bt;for(pt>>=7;Bt<V;Bt++)for(Ie[Bt]=pt<<7,Me=0;Me<1<<we[Bt]-7;Me++)Ze[256+pt++]=Bt;for(bt=0;bt<=Y;bt++)Rt[bt]=0;for(Me=0;Me<=143;)xe[Me*2+1]=8,Me++,Rt[8]++;for(;Me<=255;)xe[Me*2+1]=9,Me++,Rt[9]++;for(;Me<=279;)xe[Me*2+1]=7,Me++,Rt[7]++;for(;Me<=287;)xe[Me*2+1]=8,Me++,Rt[8]++;for(He(xe,O+1,Rt),Me=0;Me<V;Me++)Le[Me*2+1]=5,Le[Me*2]=Je(Me,5);De=new Pe(xe,oe,U+1,O,Y),ze=new Pe(Le,we,0,V,Y),it=new Pe(new Array(0),Ae,0,Z,J)}function _e(Me){var bt;for(bt=0;bt<O;bt++)Me.dyn_ltree[bt*2]=0;for(bt=0;bt<V;bt++)Me.dyn_dtree[bt*2]=0;for(bt=0;bt<Z;bt++)Me.bl_tree[bt*2]=0;Me.dyn_ltree[q*2]=1,Me.opt_len=Me.static_len=0,Me.last_lit=Me.matches=0}function pe(Me){Me.bi_valid>8?lt(Me,Me.bi_buf):Me.bi_valid>0&&(Me.pending_buf[Me.pending++]=Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0}function fe(Me,bt,At,Bt){pe(Me),Bt&&(lt(Me,At),lt(Me,~At)),S.arraySet(Me.pending_buf,Me.window,bt,At,Me.pending),Me.pending+=At}function ue(Me,bt,At,Bt){var pt=bt*2,Rt=At*2;return Me[pt]<Me[Rt]||Me[pt]===Me[Rt]&&Bt[bt]<=Bt[At]}function ce(Me,bt,At){for(var Bt=Me.heap[At],pt=At<<1;pt<=Me.heap_len&&(pt<Me.heap_len&&ue(bt,Me.heap[pt+1],Me.heap[pt],Me.depth)&&pt++,!ue(bt,Bt,Me.heap[pt],Me.depth));)Me.heap[At]=Me.heap[pt],At=pt,pt<<=1;Me.heap[At]=Bt}function Ee(Me,bt,At){var Bt,pt,Rt=0,Ve,jt;if(Me.last_lit!==0)do Bt=Me.pending_buf[Me.d_buf+Rt*2]<<8|Me.pending_buf[Me.d_buf+Rt*2+1],pt=Me.pending_buf[Me.l_buf+Rt],Rt++,Bt===0?et(Me,pt,bt):(Ve=Xe[pt],et(Me,Ve+U+1,bt),jt=oe[Ve],jt!==0&&(pt-=je[Ve],St(Me,pt,jt)),Bt--,Ve=ot(Bt),et(Me,Ve,At),jt=we[Ve],jt!==0&&(Bt-=Ie[Ve],St(Me,Bt,jt)));while(Rt<Me.last_lit);et(Me,q,bt)}function Ye(Me,bt){var At=bt.dyn_tree,Bt=bt.stat_desc.static_tree,pt=bt.stat_desc.has_stree,Rt=bt.stat_desc.elems,Ve,jt,mi=-1,ie;for(Me.heap_len=0,Me.heap_max=W,Ve=0;Ve<Rt;Ve++)At[Ve*2]!==0?(Me.heap[++Me.heap_len]=mi=Ve,Me.depth[Ve]=0):At[Ve*2+1]=0;for(;Me.heap_len<2;)ie=Me.heap[++Me.heap_len]=mi<2?++mi:0,At[ie*2]=1,Me.depth[ie]=0,Me.opt_len--,pt&&(Me.static_len-=Bt[ie*2+1]);for(bt.max_code=mi,Ve=Me.heap_len>>1;Ve>=1;Ve--)ce(Me,At,Ve);ie=Rt;do Ve=Me.heap[1],Me.heap[1]=Me.heap[Me.heap_len--],ce(Me,At,1),jt=Me.heap[1],Me.heap[--Me.heap_max]=Ve,Me.heap[--Me.heap_max]=jt,At[ie*2]=At[Ve*2]+At[jt*2],Me.depth[ie]=(Me.depth[Ve]>=Me.depth[jt]?Me.depth[Ve]:Me.depth[jt])+1,At[Ve*2+1]=At[jt*2+1]=ie,Me.heap[1]=ie++,ce(Me,At,1);while(Me.heap_len>=2);Me.heap[--Me.heap_max]=Me.heap[1],Ge(Me,bt),He(At,mi,Me.bl_count)}function ft(Me,bt,At){var Bt,pt=-1,Rt,Ve=bt[0*2+1],jt=0,mi=7,ie=4;for(Ve===0&&(mi=138,ie=3),bt[(At+1)*2+1]=65535,Bt=0;Bt<=At;Bt++)Rt=Ve,Ve=bt[(Bt+1)*2+1],!(++jt<mi&&Rt===Ve)&&(jt<ie?Me.bl_tree[Rt*2]+=jt:Rt!==0?(Rt!==pt&&Me.bl_tree[Rt*2]++,Me.bl_tree[te*2]++):jt<=10?Me.bl_tree[ne*2]++:Me.bl_tree[de*2]++,jt=0,pt=Rt,Ve===0?(mi=138,ie=3):Rt===Ve?(mi=6,ie=3):(mi=7,ie=4))}function _t(Me,bt,At){var Bt,pt=-1,Rt,Ve=bt[0*2+1],jt=0,mi=7,ie=4;for(Ve===0&&(mi=138,ie=3),Bt=0;Bt<=At;Bt++)if(Rt=Ve,Ve=bt[(Bt+1)*2+1],!(++jt<mi&&Rt===Ve)){if(jt<ie)do et(Me,Rt,Me.bl_tree);while(--jt!=0);else Rt!==0?(Rt!==pt&&(et(Me,Rt,Me.bl_tree),jt--),et(Me,te,Me.bl_tree),St(Me,jt-3,2)):jt<=10?(et(Me,ne,Me.bl_tree),St(Me,jt-3,3)):(et(Me,de,Me.bl_tree),St(Me,jt-11,7));jt=0,pt=Rt,Ve===0?(mi=138,ie=3):Rt===Ve?(mi=6,ie=3):(mi=7,ie=4)}}function It(Me){var bt;for(ft(Me,Me.dyn_ltree,Me.l_desc.max_code),ft(Me,Me.dyn_dtree,Me.d_desc.max_code),Ye(Me,Me.bl_desc),bt=Z-1;bt>=3&&Me.bl_tree[ye[bt]*2+1]===0;bt--);return Me.opt_len+=3*(bt+1)+5+5+4,bt}function $t(Me,bt,At,Bt){var pt;for(St(Me,bt-257,5),St(Me,At-1,5),St(Me,Bt-4,4),pt=0;pt<Bt;pt++)St(Me,Me.bl_tree[ye[pt]*2+1],3);_t(Me,Me.dyn_ltree,bt-1),_t(Me,Me.dyn_dtree,At-1)}function Yt(Me){var bt=4093624447,At;for(At=0;At<=31;At++,bt>>>=1)if(bt&1&&Me.dyn_ltree[At*2]!==0)return I;if(Me.dyn_ltree[9*2]!==0||Me.dyn_ltree[10*2]!==0||Me.dyn_ltree[13*2]!==0)return T;for(At=32;At<U;At++)if(Me.dyn_ltree[At*2]!==0)return T;return I}var ii=!1;function zt(Me){ii||(ve(),ii=!0),Me.l_desc=new tt(Me.dyn_ltree,De),Me.d_desc=new tt(Me.dyn_dtree,ze),Me.bl_desc=new tt(Me.bl_tree,it),Me.bi_buf=0,Me.bi_valid=0,_e(Me)}function qt(Me,bt,At,Bt){St(Me,(P<<1)+(Bt?1:0),3),fe(Me,bt,At,!0)}function Vt(Me){St(Me,D<<1,3),et(Me,q,xe),Be(Me)}function fi(Me,bt,At,Bt){var pt,Rt,Ve=0;Me.level>0?(Me.strm.data_type===A&&(Me.strm.data_type=Yt(Me)),Ye(Me,Me.l_desc),Ye(Me,Me.d_desc),Ve=It(Me),pt=Me.opt_len+3+7>>>3,Rt=Me.static_len+3+7>>>3,Rt<=pt&&(pt=Rt)):pt=Rt=At+5,At+4<=pt&&bt!==-1?qt(Me,bt,At,Bt):Me.strategy===h||Rt===pt?(St(Me,(D<<1)+(Bt?1:0),3),Ee(Me,xe,Le)):(St(Me,(M<<1)+(Bt?1:0),3),$t(Me,Me.l_desc.max_code+1,Me.d_desc.max_code+1,Ve+1),Ee(Me,Me.dyn_ltree,Me.dyn_dtree)),_e(Me),Bt&&pe(Me)}function hi(Me,bt,At){return Me.pending_buf[Me.d_buf+Me.last_lit*2]=bt>>>8&255,Me.pending_buf[Me.d_buf+Me.last_lit*2+1]=bt&255,Me.pending_buf[Me.l_buf+Me.last_lit]=At&255,Me.last_lit++,bt===0?Me.dyn_ltree[At*2]++:(Me.matches++,bt--,Me.dyn_ltree[(Xe[At]+U+1)*2]++,Me.dyn_dtree[ot(bt)*2]++),Me.last_lit===Me.lit_bufsize-1}E._tr_init=zt,E._tr_stored_block=qt,E._tr_flush_block=fi,E._tr_tally=hi,E._tr_align=Vt},{"../utils/common":36}],46:[function(m,x,E){function S(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}x.exports=S},{}],47:[function(m,x,E){arguments[4][33][0].apply(E,arguments)},{dup:33}],48:[function(m,x,E){(function(S){var h=m("base64-js"),I=m("ieee754"),T=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;E.Buffer=S,E.SlowBuffer=W,E.INSPECT_MAX_BYTES=50;var A=2147483647;E.kMaxLength=A,S.TYPED_ARRAY_SUPPORT=k(),!S.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function k(){try{var fe=new Uint8Array(1),ue={foo:function(){return 42}};return Object.setPrototypeOf(ue,Uint8Array.prototype),Object.setPrototypeOf(fe,ue),fe.foo()===42}catch{return!1}}Object.defineProperty(S.prototype,"parent",{enumerable:!0,get:function(){if(!!S.isBuffer(this))return this.buffer}}),Object.defineProperty(S.prototype,"offset",{enumerable:!0,get:function(){if(!!S.isBuffer(this))return this.byteOffset}});function P(fe){if(fe>A)throw new RangeError('The value "'+fe+'" is invalid for option "size"');var ue=new Uint8Array(fe);return Object.setPrototypeOf(ue,S.prototype),ue}function S(fe,ue,ce){if(typeof fe=="number"){if(typeof ue=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return N(fe)}return D(fe,ue,ce)}typeof Symbol!="undefined"&&Symbol.species!=null&&S[Symbol.species]===S&&Object.defineProperty(S,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),S.poolSize=8192;function D(fe,ue,ce){if(typeof fe=="string")return B(fe,ue);if(ArrayBuffer.isView(fe))return U(fe);if(fe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe);if(ve(fe,ArrayBuffer)||fe&&ve(fe.buffer,ArrayBuffer))return O(fe,ue,ce);if(typeof fe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Ee=fe.valueOf&&fe.valueOf();if(Ee!=null&&Ee!==fe)return S.from(Ee,ue,ce);var Ye=V(fe);if(Ye)return Ye;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof fe[Symbol.toPrimitive]=="function")return S.from(fe[Symbol.toPrimitive]("string"),ue,ce);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe)}S.from=function(fe,ue,ce){return D(fe,ue,ce)},Object.setPrototypeOf(S.prototype,Uint8Array.prototype),Object.setPrototypeOf(S,Uint8Array);function M(fe){if(typeof fe!="number")throw new TypeError('"size" argument must be of type number');if(fe<0)throw new RangeError('The value "'+fe+'" is invalid for option "size"')}function F(fe,ue,ce){return M(fe),fe<=0?P(fe):ue!==void 0?typeof ce=="string"?P(fe).fill(ue,ce):P(fe).fill(ue):P(fe)}S.alloc=function(fe,ue,ce){return F(fe,ue,ce)};function N(fe){return M(fe),P(fe<0?0:Z(fe)|0)}S.allocUnsafe=function(fe){return N(fe)},S.allocUnsafeSlow=function(fe){return N(fe)};function B(fe,ue){if((typeof ue!="string"||ue==="")&&(ue="utf8"),!S.isEncoding(ue))throw new TypeError("Unknown encoding: "+ue);var ce=Y(fe,ue)|0,Ee=P(ce),Ye=Ee.write(fe,ue);return Ye!==ce&&(Ee=Ee.slice(0,Ye)),Ee}function U(fe){for(var ue=fe.length<0?0:Z(fe.length)|0,ce=P(ue),Ee=0;Ee<ue;Ee+=1)ce[Ee]=fe[Ee]&255;return ce}function O(fe,ue,ce){if(ue<0||fe.byteLength<ue)throw new RangeError('"offset" is outside of buffer bounds');if(fe.byteLength<ue+(ce||0))throw new RangeError('"length" is outside of buffer bounds');var Ee;return ue===void 0&&ce===void 0?Ee=new Uint8Array(fe):ce===void 0?Ee=new Uint8Array(fe,ue):Ee=new Uint8Array(fe,ue,ce),Object.setPrototypeOf(Ee,S.prototype),Ee}function V(fe){if(S.isBuffer(fe)){var ue=Z(fe.length)|0,ce=P(ue);return ce.length===0||fe.copy(ce,0,0,ue),ce}if(fe.length!==void 0)return typeof fe.length!="number"||_e(fe.length)?P(0):U(fe);if(fe.type==="Buffer"&&Array.isArray(fe.data))return U(fe.data)}function Z(fe){if(fe>=A)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+A.toString(16)+" bytes");return fe|0}function W(fe){return+fe!=fe&&(fe=0),S.alloc(+fe)}S.isBuffer=function(ue){return ue!=null&&ue._isBuffer===!0&&ue!==S.prototype},S.compare=function(ue,ce){if(ve(ue,Uint8Array)&&(ue=S.from(ue,ue.offset,ue.byteLength)),ve(ce,Uint8Array)&&(ce=S.from(ce,ce.offset,ce.byteLength)),!S.isBuffer(ue)||!S.isBuffer(ce))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ue===ce)return 0;for(var Ee=ue.length,Ye=ce.length,ft=0,_t=Math.min(Ee,Ye);ft<_t;++ft)if(ue[ft]!==ce[ft]){Ee=ue[ft],Ye=ce[ft];break}return Ee<Ye?-1:Ye<Ee?1:0},S.isEncoding=function(ue){switch(String(ue).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.concat=function(ue,ce){if(!Array.isArray(ue))throw new TypeError('"list" argument must be an Array of Buffers');if(ue.length===0)return S.alloc(0);var Ee;if(ce===void 0)for(ce=0,Ee=0;Ee<ue.length;++Ee)ce+=ue[Ee].length;var Ye=S.allocUnsafe(ce),ft=0;for(Ee=0;Ee<ue.length;++Ee){var _t=ue[Ee];if(ve(_t,Uint8Array)&&(_t=S.from(_t)),!S.isBuffer(_t))throw new TypeError('"list" argument must be an Array of Buffers');_t.copy(Ye,ft),ft+=_t.length}return Ye};function Y(fe,ue){if(S.isBuffer(fe))return fe.length;if(ArrayBuffer.isView(fe)||ve(fe,ArrayBuffer))return fe.byteLength;if(typeof fe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof fe);var ce=fe.length,Ee=arguments.length>2&&arguments[2]===!0;if(!Ee&&ce===0)return 0;for(var Ye=!1;;)switch(ue){case"ascii":case"latin1":case"binary":return ce;case"utf8":case"utf-8":return et(fe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce*2;case"hex":return ce>>>1;case"base64":return Ge(fe).length;default:if(Ye)return Ee?-1:et(fe).length;ue=(""+ue).toLowerCase(),Ye=!0}}S.byteLength=Y;function X(fe,ue,ce){var Ee=!1;if((ue===void 0||ue<0)&&(ue=0),ue>this.length||((ce===void 0||ce>this.length)&&(ce=this.length),ce<=0)||(ce>>>=0,ue>>>=0,ce<=ue))return"";for(fe||(fe="utf8");;)switch(fe){case"hex":return Ie(this,ue,ce);case"utf8":case"utf-8":return xe(this,ue,ce);case"ascii":return Xe(this,ue,ce);case"latin1":case"binary":return je(this,ue,ce);case"base64":return me(this,ue,ce);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pe(this,ue,ce);default:if(Ee)throw new TypeError("Unknown encoding: "+fe);fe=(fe+"").toLowerCase(),Ee=!0}}S.prototype._isBuffer=!0;function J(fe,ue,ce){var Ee=fe[ue];fe[ue]=fe[ce],fe[ce]=Ee}S.prototype.swap16=function(){var ue=this.length;if(ue%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ce=0;ce<ue;ce+=2)J(this,ce,ce+1);return this},S.prototype.swap32=function(){var ue=this.length;if(ue%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ce=0;ce<ue;ce+=4)J(this,ce,ce+3),J(this,ce+1,ce+2);return this},S.prototype.swap64=function(){var ue=this.length;if(ue%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ce=0;ce<ue;ce+=8)J(this,ce,ce+7),J(this,ce+1,ce+6),J(this,ce+2,ce+5),J(this,ce+3,ce+4);return this},S.prototype.toString=function(){var ue=this.length;return ue===0?"":arguments.length===0?xe(this,0,ue):X.apply(this,arguments)},S.prototype.toLocaleString=S.prototype.toString,S.prototype.equals=function(ue){if(!S.isBuffer(ue))throw new TypeError("Argument must be a Buffer");return this===ue?!0:S.compare(this,ue)===0},S.prototype.inspect=function(){var ue="",ce=E.INSPECT_MAX_BYTES;return ue=this.toString("hex",0,ce).replace(/(.{2})/g,"$1 ").trim(),this.length>ce&&(ue+=" ... "),"<Buffer "+ue+">"},T&&(S.prototype[T]=S.prototype.inspect),S.prototype.compare=function(ue,ce,Ee,Ye,ft){if(ve(ue,Uint8Array)&&(ue=S.from(ue,ue.offset,ue.byteLength)),!S.isBuffer(ue))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ue);if(ce===void 0&&(ce=0),Ee===void 0&&(Ee=ue?ue.length:0),Ye===void 0&&(Ye=0),ft===void 0&&(ft=this.length),ce<0||Ee>ue.length||Ye<0||ft>this.length)throw new RangeError("out of range index");if(Ye>=ft&&ce>=Ee)return 0;if(Ye>=ft)return-1;if(ce>=Ee)return 1;if(ce>>>=0,Ee>>>=0,Ye>>>=0,ft>>>=0,this===ue)return 0;for(var _t=ft-Ye,It=Ee-ce,$t=Math.min(_t,It),Yt=this.slice(Ye,ft),ii=ue.slice(ce,Ee),zt=0;zt<$t;++zt)if(Yt[zt]!==ii[zt]){_t=Yt[zt],It=ii[zt];break}return _t<It?-1:It<_t?1:0};function q(fe,ue,ce,Ee,Ye){if(fe.length===0)return-1;if(typeof ce=="string"?(Ee=ce,ce=0):ce>2147483647?ce=2147483647:ce<-2147483648&&(ce=-2147483648),ce=+ce,_e(ce)&&(ce=Ye?0:fe.length-1),ce<0&&(ce=fe.length+ce),ce>=fe.length){if(Ye)return-1;ce=fe.length-1}else if(ce<0)if(Ye)ce=0;else return-1;if(typeof ue=="string"&&(ue=S.from(ue,Ee)),S.isBuffer(ue))return ue.length===0?-1:te(fe,ue,ce,Ee,Ye);if(typeof ue=="number")return ue=ue&255,typeof Uint8Array.prototype.indexOf=="function"?Ye?Uint8Array.prototype.indexOf.call(fe,ue,ce):Uint8Array.prototype.lastIndexOf.call(fe,ue,ce):te(fe,[ue],ce,Ee,Ye);throw new TypeError("val must be string, number or Buffer")}function te(fe,ue,ce,Ee,Ye){var ft=1,_t=fe.length,It=ue.length;if(Ee!==void 0&&(Ee=String(Ee).toLowerCase(),Ee==="ucs2"||Ee==="ucs-2"||Ee==="utf16le"||Ee==="utf-16le")){if(fe.length<2||ue.length<2)return-1;ft=2,_t/=2,It/=2,ce/=2}function $t(Vt,fi){return ft===1?Vt[fi]:Vt.readUInt16BE(fi*ft)}var Yt;if(Ye){var ii=-1;for(Yt=ce;Yt<_t;Yt++)if($t(fe,Yt)===$t(ue,ii===-1?0:Yt-ii)){if(ii===-1&&(ii=Yt),Yt-ii+1===It)return ii*ft}else ii!==-1&&(Yt-=Yt-ii),ii=-1}else for(ce+It>_t&&(ce=_t-It),Yt=ce;Yt>=0;Yt--){for(var zt=!0,qt=0;qt<It;qt++)if($t(fe,Yt+qt)!==$t(ue,qt)){zt=!1;break}if(zt)return Yt}return-1}S.prototype.includes=function(ue,ce,Ee){return this.indexOf(ue,ce,Ee)!==-1},S.prototype.indexOf=function(ue,ce,Ee){return q(this,ue,ce,Ee,!0)},S.prototype.lastIndexOf=function(ue,ce,Ee){return q(this,ue,ce,Ee,!1)};function ne(fe,ue,ce,Ee){ce=Number(ce)||0;var Ye=fe.length-ce;Ee?(Ee=Number(Ee),Ee>Ye&&(Ee=Ye)):Ee=Ye;var ft=ue.length;Ee>ft/2&&(Ee=ft/2);for(var _t=0;_t<Ee;++_t){var It=parseInt(ue.substr(_t*2,2),16);if(_e(It))return _t;fe[ce+_t]=It}return _t}function de(fe,ue,ce,Ee){return He(et(ue,fe.length-ce),fe,ce,Ee)}function oe(fe,ue,ce,Ee){return He(Je(ue),fe,ce,Ee)}function we(fe,ue,ce,Ee){return oe(fe,ue,ce,Ee)}function Ae(fe,ue,ce,Ee){return He(Ge(ue),fe,ce,Ee)}function ye(fe,ue,ce,Ee){return He(Be(ue,fe.length-ce),fe,ce,Ee)}S.prototype.write=function(ue,ce,Ee,Ye){if(ce===void 0)Ye="utf8",Ee=this.length,ce=0;else if(Ee===void 0&&typeof ce=="string")Ye=ce,Ee=this.length,ce=0;else if(isFinite(ce))ce=ce>>>0,isFinite(Ee)?(Ee=Ee>>>0,Ye===void 0&&(Ye="utf8")):(Ye=Ee,Ee=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ft=this.length-ce;if((Ee===void 0||Ee>ft)&&(Ee=ft),ue.length>0&&(Ee<0||ce<0)||ce>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ye||(Ye="utf8");for(var _t=!1;;)switch(Ye){case"hex":return ne(this,ue,ce,Ee);case"utf8":case"utf-8":return de(this,ue,ce,Ee);case"ascii":return oe(this,ue,ce,Ee);case"latin1":case"binary":return we(this,ue,ce,Ee);case"base64":return Ae(this,ue,ce,Ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ye(this,ue,ce,Ee);default:if(_t)throw new TypeError("Unknown encoding: "+Ye);Ye=(""+Ye).toLowerCase(),_t=!0}},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function me(fe,ue,ce){return ue===0&&ce===fe.length?h.fromByteArray(fe):h.fromByteArray(fe.slice(ue,ce))}function xe(fe,ue,ce){ce=Math.min(fe.length,ce);for(var Ee=[],Ye=ue;Ye<ce;){var ft=fe[Ye],_t=null,It=ft>239?4:ft>223?3:ft>191?2:1;if(Ye+It<=ce){var $t,Yt,ii,zt;switch(It){case 1:ft<128&&(_t=ft);break;case 2:$t=fe[Ye+1],($t&192)==128&&(zt=(ft&31)<<6|$t&63,zt>127&&(_t=zt));break;case 3:$t=fe[Ye+1],Yt=fe[Ye+2],($t&192)==128&&(Yt&192)==128&&(zt=(ft&15)<<12|($t&63)<<6|Yt&63,zt>2047&&(zt<55296||zt>57343)&&(_t=zt));break;case 4:$t=fe[Ye+1],Yt=fe[Ye+2],ii=fe[Ye+3],($t&192)==128&&(Yt&192)==128&&(ii&192)==128&&(zt=(ft&15)<<18|($t&63)<<12|(Yt&63)<<6|ii&63,zt>65535&&zt<1114112&&(_t=zt))}}_t===null?(_t=65533,It=1):_t>65535&&(_t-=65536,Ee.push(_t>>>10&1023|55296),_t=56320|_t&1023),Ee.push(_t),Ye+=It}return Ze(Ee)}var Le=4096;function Ze(fe){var ue=fe.length;if(ue<=Le)return String.fromCharCode.apply(String,fe);for(var ce="",Ee=0;Ee<ue;)ce+=String.fromCharCode.apply(String,fe.slice(Ee,Ee+=Le));return ce}function Xe(fe,ue,ce){var Ee="";ce=Math.min(fe.length,ce);for(var Ye=ue;Ye<ce;++Ye)Ee+=String.fromCharCode(fe[Ye]&127);return Ee}function je(fe,ue,ce){var Ee="";ce=Math.min(fe.length,ce);for(var Ye=ue;Ye<ce;++Ye)Ee+=String.fromCharCode(fe[Ye]);return Ee}function Ie(fe,ue,ce){var Ee=fe.length;(!ue||ue<0)&&(ue=0),(!ce||ce<0||ce>Ee)&&(ce=Ee);for(var Ye="",ft=ue;ft<ce;++ft)Ye+=pe[fe[ft]];return Ye}function Pe(fe,ue,ce){for(var Ee=fe.slice(ue,ce),Ye="",ft=0;ft<Ee.length;ft+=2)Ye+=String.fromCharCode(Ee[ft]+Ee[ft+1]*256);return Ye}S.prototype.slice=function(ue,ce){var Ee=this.length;ue=~~ue,ce=ce===void 0?Ee:~~ce,ue<0?(ue+=Ee,ue<0&&(ue=0)):ue>Ee&&(ue=Ee),ce<0?(ce+=Ee,ce<0&&(ce=0)):ce>Ee&&(ce=Ee),ce<ue&&(ce=ue);var Ye=this.subarray(ue,ce);return Object.setPrototypeOf(Ye,S.prototype),Ye};function De(fe,ue,ce){if(fe%1!=0||fe<0)throw new RangeError("offset is not uint");if(fe+ue>ce)throw new RangeError("Trying to access beyond buffer length")}S.prototype.readUIntLE=function(ue,ce,Ee){ue=ue>>>0,ce=ce>>>0,Ee||De(ue,ce,this.length);for(var Ye=this[ue],ft=1,_t=0;++_t<ce&&(ft*=256);)Ye+=this[ue+_t]*ft;return Ye},S.prototype.readUIntBE=function(ue,ce,Ee){ue=ue>>>0,ce=ce>>>0,Ee||De(ue,ce,this.length);for(var Ye=this[ue+--ce],ft=1;ce>0&&(ft*=256);)Ye+=this[ue+--ce]*ft;return Ye},S.prototype.readUInt8=function(ue,ce){return ue=ue>>>0,ce||De(ue,1,this.length),this[ue]},S.prototype.readUInt16LE=function(ue,ce){return ue=ue>>>0,ce||De(ue,2,this.length),this[ue]|this[ue+1]<<8},S.prototype.readUInt16BE=function(ue,ce){return ue=ue>>>0,ce||De(ue,2,this.length),this[ue]<<8|this[ue+1]},S.prototype.readUInt32LE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),(this[ue]|this[ue+1]<<8|this[ue+2]<<16)+this[ue+3]*16777216},S.prototype.readUInt32BE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),this[ue]*16777216+(this[ue+1]<<16|this[ue+2]<<8|this[ue+3])},S.prototype.readIntLE=function(ue,ce,Ee){ue=ue>>>0,ce=ce>>>0,Ee||De(ue,ce,this.length);for(var Ye=this[ue],ft=1,_t=0;++_t<ce&&(ft*=256);)Ye+=this[ue+_t]*ft;return ft*=128,Ye>=ft&&(Ye-=Math.pow(2,8*ce)),Ye},S.prototype.readIntBE=function(ue,ce,Ee){ue=ue>>>0,ce=ce>>>0,Ee||De(ue,ce,this.length);for(var Ye=ce,ft=1,_t=this[ue+--Ye];Ye>0&&(ft*=256);)_t+=this[ue+--Ye]*ft;return ft*=128,_t>=ft&&(_t-=Math.pow(2,8*ce)),_t},S.prototype.readInt8=function(ue,ce){return ue=ue>>>0,ce||De(ue,1,this.length),this[ue]&128?(255-this[ue]+1)*-1:this[ue]},S.prototype.readInt16LE=function(ue,ce){ue=ue>>>0,ce||De(ue,2,this.length);var Ee=this[ue]|this[ue+1]<<8;return Ee&32768?Ee|4294901760:Ee},S.prototype.readInt16BE=function(ue,ce){ue=ue>>>0,ce||De(ue,2,this.length);var Ee=this[ue+1]|this[ue]<<8;return Ee&32768?Ee|4294901760:Ee},S.prototype.readInt32LE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),this[ue]|this[ue+1]<<8|this[ue+2]<<16|this[ue+3]<<24},S.prototype.readInt32BE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),this[ue]<<24|this[ue+1]<<16|this[ue+2]<<8|this[ue+3]},S.prototype.readFloatLE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),I.read(this,ue,!0,23,4)},S.prototype.readFloatBE=function(ue,ce){return ue=ue>>>0,ce||De(ue,4,this.length),I.read(this,ue,!1,23,4)},S.prototype.readDoubleLE=function(ue,ce){return ue=ue>>>0,ce||De(ue,8,this.length),I.read(this,ue,!0,52,8)},S.prototype.readDoubleBE=function(ue,ce){return ue=ue>>>0,ce||De(ue,8,this.length),I.read(this,ue,!1,52,8)};function ze(fe,ue,ce,Ee,Ye,ft){if(!S.isBuffer(fe))throw new TypeError('"buffer" argument must be a Buffer instance');if(ue>Ye||ue<ft)throw new RangeError('"value" argument is out of bounds');if(ce+Ee>fe.length)throw new RangeError("Index out of range")}S.prototype.writeUIntLE=function(ue,ce,Ee,Ye){if(ue=+ue,ce=ce>>>0,Ee=Ee>>>0,!Ye){var ft=Math.pow(2,8*Ee)-1;ze(this,ue,ce,Ee,ft,0)}var _t=1,It=0;for(this[ce]=ue&255;++It<Ee&&(_t*=256);)this[ce+It]=ue/_t&255;return ce+Ee},S.prototype.writeUIntBE=function(ue,ce,Ee,Ye){if(ue=+ue,ce=ce>>>0,Ee=Ee>>>0,!Ye){var ft=Math.pow(2,8*Ee)-1;ze(this,ue,ce,Ee,ft,0)}var _t=Ee-1,It=1;for(this[ce+_t]=ue&255;--_t>=0&&(It*=256);)this[ce+_t]=ue/It&255;return ce+Ee},S.prototype.writeUInt8=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,1,255,0),this[ce]=ue&255,ce+1},S.prototype.writeUInt16LE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,2,65535,0),this[ce]=ue&255,this[ce+1]=ue>>>8,ce+2},S.prototype.writeUInt16BE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,2,65535,0),this[ce]=ue>>>8,this[ce+1]=ue&255,ce+2},S.prototype.writeUInt32LE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,4,4294967295,0),this[ce+3]=ue>>>24,this[ce+2]=ue>>>16,this[ce+1]=ue>>>8,this[ce]=ue&255,ce+4},S.prototype.writeUInt32BE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,4,4294967295,0),this[ce]=ue>>>24,this[ce+1]=ue>>>16,this[ce+2]=ue>>>8,this[ce+3]=ue&255,ce+4},S.prototype.writeIntLE=function(ue,ce,Ee,Ye){if(ue=+ue,ce=ce>>>0,!Ye){var ft=Math.pow(2,8*Ee-1);ze(this,ue,ce,Ee,ft-1,-ft)}var _t=0,It=1,$t=0;for(this[ce]=ue&255;++_t<Ee&&(It*=256);)ue<0&&$t===0&&this[ce+_t-1]!==0&&($t=1),this[ce+_t]=(ue/It>>0)-$t&255;return ce+Ee},S.prototype.writeIntBE=function(ue,ce,Ee,Ye){if(ue=+ue,ce=ce>>>0,!Ye){var ft=Math.pow(2,8*Ee-1);ze(this,ue,ce,Ee,ft-1,-ft)}var _t=Ee-1,It=1,$t=0;for(this[ce+_t]=ue&255;--_t>=0&&(It*=256);)ue<0&&$t===0&&this[ce+_t+1]!==0&&($t=1),this[ce+_t]=(ue/It>>0)-$t&255;return ce+Ee},S.prototype.writeInt8=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,1,127,-128),ue<0&&(ue=255+ue+1),this[ce]=ue&255,ce+1},S.prototype.writeInt16LE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,2,32767,-32768),this[ce]=ue&255,this[ce+1]=ue>>>8,ce+2},S.prototype.writeInt16BE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,2,32767,-32768),this[ce]=ue>>>8,this[ce+1]=ue&255,ce+2},S.prototype.writeInt32LE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,4,2147483647,-2147483648),this[ce]=ue&255,this[ce+1]=ue>>>8,this[ce+2]=ue>>>16,this[ce+3]=ue>>>24,ce+4},S.prototype.writeInt32BE=function(ue,ce,Ee){return ue=+ue,ce=ce>>>0,Ee||ze(this,ue,ce,4,2147483647,-2147483648),ue<0&&(ue=4294967295+ue+1),this[ce]=ue>>>24,this[ce+1]=ue>>>16,this[ce+2]=ue>>>8,this[ce+3]=ue&255,ce+4};function it(fe,ue,ce,Ee,Ye,ft){if(ce+Ee>fe.length)throw new RangeError("Index out of range");if(ce<0)throw new RangeError("Index out of range")}function tt(fe,ue,ce,Ee,Ye){return ue=+ue,ce=ce>>>0,Ye||it(fe,ue,ce,4),I.write(fe,ue,ce,Ee,23,4),ce+4}S.prototype.writeFloatLE=function(ue,ce,Ee){return tt(this,ue,ce,!0,Ee)},S.prototype.writeFloatBE=function(ue,ce,Ee){return tt(this,ue,ce,!1,Ee)};function ot(fe,ue,ce,Ee,Ye){return ue=+ue,ce=ce>>>0,Ye||it(fe,ue,ce,8),I.write(fe,ue,ce,Ee,52,8),ce+8}S.prototype.writeDoubleLE=function(ue,ce,Ee){return ot(this,ue,ce,!0,Ee)},S.prototype.writeDoubleBE=function(ue,ce,Ee){return ot(this,ue,ce,!1,Ee)},S.prototype.copy=function(ue,ce,Ee,Ye){if(!S.isBuffer(ue))throw new TypeError("argument should be a Buffer");if(Ee||(Ee=0),!Ye&&Ye!==0&&(Ye=this.length),ce>=ue.length&&(ce=ue.length),ce||(ce=0),Ye>0&&Ye<Ee&&(Ye=Ee),Ye===Ee||ue.length===0||this.length===0)return 0;if(ce<0)throw new RangeError("targetStart out of bounds");if(Ee<0||Ee>=this.length)throw new RangeError("Index out of range");if(Ye<0)throw new RangeError("sourceEnd out of bounds");Ye>this.length&&(Ye=this.length),ue.length-ce<Ye-Ee&&(Ye=ue.length-ce+Ee);var ft=Ye-Ee;if(this===ue&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(ce,Ee,Ye);else if(this===ue&&Ee<ce&&ce<Ye)for(var _t=ft-1;_t>=0;--_t)ue[_t+ce]=this[_t+Ee];else Uint8Array.prototype.set.call(ue,this.subarray(Ee,Ye),ce);return ft},S.prototype.fill=function(ue,ce,Ee,Ye){if(typeof ue=="string"){if(typeof ce=="string"?(Ye=ce,ce=0,Ee=this.length):typeof Ee=="string"&&(Ye=Ee,Ee=this.length),Ye!==void 0&&typeof Ye!="string")throw new TypeError("encoding must be a string");if(typeof Ye=="string"&&!S.isEncoding(Ye))throw new TypeError("Unknown encoding: "+Ye);if(ue.length===1){var ft=ue.charCodeAt(0);(Ye==="utf8"&&ft<128||Ye==="latin1")&&(ue=ft)}}else typeof ue=="number"?ue=ue&255:typeof ue=="boolean"&&(ue=Number(ue));if(ce<0||this.length<ce||this.length<Ee)throw new RangeError("Out of range index");if(Ee<=ce)return this;ce=ce>>>0,Ee=Ee===void 0?this.length:Ee>>>0,ue||(ue=0);var _t;if(typeof ue=="number")for(_t=ce;_t<Ee;++_t)this[_t]=ue;else{var It=S.isBuffer(ue)?ue:S.from(ue,Ye),$t=It.length;if($t===0)throw new TypeError('The value "'+ue+'" is invalid for argument "value"');for(_t=0;_t<Ee-ce;++_t)this[_t+ce]=It[_t%$t]}return this};var lt=/[^+/0-9A-Za-z-_]/g;function St(fe){if(fe=fe.split("=")[0],fe=fe.trim().replace(lt,""),fe.length<2)return"";for(;fe.length%4!=0;)fe=fe+"=";return fe}function et(fe,ue){ue=ue||1/0;for(var ce,Ee=fe.length,Ye=null,ft=[],_t=0;_t<Ee;++_t){if(ce=fe.charCodeAt(_t),ce>55295&&ce<57344){if(!Ye){if(ce>56319){(ue-=3)>-1&&ft.push(239,191,189);continue}else if(_t+1===Ee){(ue-=3)>-1&&ft.push(239,191,189);continue}Ye=ce;continue}if(ce<56320){(ue-=3)>-1&&ft.push(239,191,189),Ye=ce;continue}ce=(Ye-55296<<10|ce-56320)+65536}else Ye&&(ue-=3)>-1&&ft.push(239,191,189);if(Ye=null,ce<128){if((ue-=1)<0)break;ft.push(ce)}else if(ce<2048){if((ue-=2)<0)break;ft.push(ce>>6|192,ce&63|128)}else if(ce<65536){if((ue-=3)<0)break;ft.push(ce>>12|224,ce>>6&63|128,ce&63|128)}else if(ce<1114112){if((ue-=4)<0)break;ft.push(ce>>18|240,ce>>12&63|128,ce>>6&63|128,ce&63|128)}else throw new Error("Invalid code point")}return ft}function Je(fe){for(var ue=[],ce=0;ce<fe.length;++ce)ue.push(fe.charCodeAt(ce)&255);return ue}function Be(fe,ue){for(var ce,Ee,Ye,ft=[],_t=0;_t<fe.length&&!((ue-=2)<0);++_t)ce=fe.charCodeAt(_t),Ee=ce>>8,Ye=ce%256,ft.push(Ye),ft.push(Ee);return ft}function Ge(fe){return h.toByteArray(St(fe))}function He(fe,ue,ce,Ee){for(var Ye=0;Ye<Ee&&!(Ye+ce>=ue.length||Ye>=fe.length);++Ye)ue[Ye+ce]=fe[Ye];return Ye}function ve(fe,ue){return fe instanceof ue||fe!=null&&fe.constructor!=null&&fe.constructor.name!=null&&fe.constructor.name===ue.name}function _e(fe){return fe!==fe}var pe=function(){for(var fe="0123456789abcdef",ue=new Array(256),ce=0;ce<16;++ce)for(var Ee=ce*16,Ye=0;Ye<16;++Ye)ue[Ee+Ye]=fe[ce]+fe[Ye];return ue}()}).call(this,m("buffer").Buffer)},{"base64-js":29,buffer:48,ieee754:73}],49:[function(m,x,E){var S=m("buffer").Buffer;x.exports=function(h,I){if(!!S.isBuffer(h)&&!!S.isBuffer(I)){if(typeof h.equals=="function")return h.equals(I);if(h.length!==I.length)return!1;for(var T=0;T<h.length;T++)if(h[T]!==I[T])return!1;return!0}}},{buffer:48}],50:[function(m,x,E){x.exports={"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Unordered Collection","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","451":"Unavailable For Legal Reasons","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}},{}],51:[function(m,x,E){(function(S){function h(W){return Array.isArray?Array.isArray(W):Z(W)==="[object Array]"}E.isArray=h;function I(W){return typeof W=="boolean"}E.isBoolean=I;function T(W){return W===null}E.isNull=T;function A(W){return W==null}E.isNullOrUndefined=A;function k(W){return typeof W=="number"}E.isNumber=k;function P(W){return typeof W=="string"}E.isString=P;function D(W){return typeof W=="symbol"}E.isSymbol=D;function M(W){return W===void 0}E.isUndefined=M;function F(W){return Z(W)==="[object RegExp]"}E.isRegExp=F;function N(W){return typeof W=="object"&&W!==null}E.isObject=N;function B(W){return Z(W)==="[object Date]"}E.isDate=B;function U(W){return Z(W)==="[object Error]"||W instanceof Error}E.isError=U;function O(W){return typeof W=="function"}E.isFunction=O;function V(W){return W===null||typeof W=="boolean"||typeof W=="number"||typeof W=="string"||typeof W=="symbol"||typeof W=="undefined"}E.isPrimitive=V,E.isBuffer=S.isBuffer;function Z(W){return Object.prototype.toString.call(W)}}).call(this,{isBuffer:m("../../is-buffer/index.js")})},{"../../is-buffer/index.js":76}],52:[function(m,x,E){var S=Object.create||te,h=Object.keys||ne,I=Function.prototype.bind||de;function T(){(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events"))&&(this._events=S(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}x.exports=T,T.EventEmitter=T,T.prototype._events=void 0,T.prototype._maxListeners=void 0;var A=10,k;try{var P={};Object.defineProperty&&Object.defineProperty(P,"x",{value:0}),k=P.x===0}catch{k=!1}k?Object.defineProperty(T,"defaultMaxListeners",{enumerable:!0,get:function(){return A},set:function(oe){if(typeof oe!="number"||oe<0||oe!==oe)throw new TypeError('"defaultMaxListeners" must be a positive number');A=oe}}):T.defaultMaxListeners=A,T.prototype.setMaxListeners=function(we){if(typeof we!="number"||we<0||isNaN(we))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=we,this};function D(oe){return oe._maxListeners===void 0?T.defaultMaxListeners:oe._maxListeners}T.prototype.getMaxListeners=function(){return D(this)};function M(oe,we,Ae){if(we)oe.call(Ae);else for(var ye=oe.length,me=J(oe,ye),xe=0;xe<ye;++xe)me[xe].call(Ae)}function F(oe,we,Ae,ye){if(we)oe.call(Ae,ye);else for(var me=oe.length,xe=J(oe,me),Le=0;Le<me;++Le)xe[Le].call(Ae,ye)}function N(oe,we,Ae,ye,me){if(we)oe.call(Ae,ye,me);else for(var xe=oe.length,Le=J(oe,xe),Ze=0;Ze<xe;++Ze)Le[Ze].call(Ae,ye,me)}function B(oe,we,Ae,ye,me,xe){if(we)oe.call(Ae,ye,me,xe);else for(var Le=oe.length,Ze=J(oe,Le),Xe=0;Xe<Le;++Xe)Ze[Xe].call(Ae,ye,me,xe)}function U(oe,we,Ae,ye){if(we)oe.apply(Ae,ye);else for(var me=oe.length,xe=J(oe,me),Le=0;Le<me;++Le)xe[Le].apply(Ae,ye)}T.prototype.emit=function(we){var Ae,ye,me,xe,Le,Ze,Xe=we==="error";if(Ze=this._events,Ze)Xe=Xe&&Ze.error==null;else if(!Xe)return!1;if(Xe){if(arguments.length>1&&(Ae=arguments[1]),Ae instanceof Error)throw Ae;var je=new Error('Unhandled "error" event. ('+Ae+")");throw je.context=Ae,je}if(ye=Ze[we],!ye)return!1;var Ie=typeof ye=="function";switch(me=arguments.length,me){case 1:M(ye,Ie,this);break;case 2:F(ye,Ie,this,arguments[1]);break;case 3:N(ye,Ie,this,arguments[1],arguments[2]);break;case 4:B(ye,Ie,this,arguments[1],arguments[2],arguments[3]);break;default:for(xe=new Array(me-1),Le=1;Le<me;Le++)xe[Le-1]=arguments[Le];U(ye,Ie,this,xe)}return!0};function O(oe,we,Ae,ye){var me,xe,Le;if(typeof Ae!="function")throw new TypeError('"listener" argument must be a function');if(xe=oe._events,xe?(xe.newListener&&(oe.emit("newListener",we,Ae.listener?Ae.listener:Ae),xe=oe._events),Le=xe[we]):(xe=oe._events=S(null),oe._eventsCount=0),!Le)Le=xe[we]=Ae,++oe._eventsCount;else if(typeof Le=="function"?Le=xe[we]=ye?[Ae,Le]:[Le,Ae]:ye?Le.unshift(Ae):Le.push(Ae),!Le.warned&&(me=D(oe),me&&me>0&&Le.length>me)){Le.warned=!0;var Ze=new Error("Possible EventEmitter memory leak detected. "+Le.length+' "'+String(we)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');Ze.name="MaxListenersExceededWarning",Ze.emitter=oe,Ze.type=we,Ze.count=Le.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",Ze.name,Ze.message)}return oe}T.prototype.addListener=function(we,Ae){return O(this,we,Ae,!1)},T.prototype.on=T.prototype.addListener,T.prototype.prependListener=function(we,Ae){return O(this,we,Ae,!0)};function V(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var oe=new Array(arguments.length),we=0;we<oe.length;++we)oe[we]=arguments[we];this.listener.apply(this.target,oe)}}function Z(oe,we,Ae){var ye={fired:!1,wrapFn:void 0,target:oe,type:we,listener:Ae},me=I.call(V,ye);return me.listener=Ae,ye.wrapFn=me,me}T.prototype.once=function(we,Ae){if(typeof Ae!="function")throw new TypeError('"listener" argument must be a function');return this.on(we,Z(this,we,Ae)),this},T.prototype.prependOnceListener=function(we,Ae){if(typeof Ae!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(we,Z(this,we,Ae)),this},T.prototype.removeListener=function(we,Ae){var ye,me,xe,Le,Ze;if(typeof Ae!="function")throw new TypeError('"listener" argument must be a function');if(me=this._events,!me)return this;if(ye=me[we],!ye)return this;if(ye===Ae||ye.listener===Ae)--this._eventsCount==0?this._events=S(null):(delete me[we],me.removeListener&&this.emit("removeListener",we,ye.listener||Ae));else if(typeof ye!="function"){for(xe=-1,Le=ye.length-1;Le>=0;Le--)if(ye[Le]===Ae||ye[Le].listener===Ae){Ze=ye[Le].listener,xe=Le;break}if(xe<0)return this;xe===0?ye.shift():X(ye,xe),ye.length===1&&(me[we]=ye[0]),me.removeListener&&this.emit("removeListener",we,Ze||Ae)}return this},T.prototype.removeAllListeners=function(we){var Ae,ye,me;if(ye=this._events,!ye)return this;if(!ye.removeListener)return arguments.length===0?(this._events=S(null),this._eventsCount=0):ye[we]&&(--this._eventsCount==0?this._events=S(null):delete ye[we]),this;if(arguments.length===0){var xe=h(ye),Le;for(me=0;me<xe.length;++me)Le=xe[me],Le!=="removeListener"&&this.removeAllListeners(Le);return this.removeAllListeners("removeListener"),this._events=S(null),this._eventsCount=0,this}if(Ae=ye[we],typeof Ae=="function")this.removeListener(we,Ae);else if(Ae)for(me=Ae.length-1;me>=0;me--)this.removeListener(we,Ae[me]);return this};function W(oe,we,Ae){var ye=oe._events;if(!ye)return[];var me=ye[we];return me?typeof me=="function"?Ae?[me.listener||me]:[me]:Ae?q(me):J(me,me.length):[]}T.prototype.listeners=function(we){return W(this,we,!0)},T.prototype.rawListeners=function(we){return W(this,we,!1)},T.listenerCount=function(oe,we){return typeof oe.listenerCount=="function"?oe.listenerCount(we):Y.call(oe,we)},T.prototype.listenerCount=Y;function Y(oe){var we=this._events;if(we){var Ae=we[oe];if(typeof Ae=="function")return 1;if(Ae)return Ae.length}return 0}T.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function X(oe,we){for(var Ae=we,ye=Ae+1,me=oe.length;ye<me;Ae+=1,ye+=1)oe[Ae]=oe[ye];oe.pop()}function J(oe,we){for(var Ae=new Array(we),ye=0;ye<we;++ye)Ae[ye]=oe[ye];return Ae}function q(oe){for(var we=new Array(oe.length),Ae=0;Ae<we.length;++Ae)we[Ae]=oe[Ae].listener||oe[Ae];return we}function te(oe){var we=function(){};return we.prototype=oe,new we}function ne(oe){for(var we in oe)Object.prototype.hasOwnProperty.call(oe,we);return we}function de(oe){var we=this;return function(){return we.apply(oe,arguments)}}},{}],53:[function(m,x,E){var S=m("./lib/parser");function h(){return(0,eval)("this")}x.exports={create:function(I,T){if(T=T||h(),I instanceof T.ArrayBuffer){var A=m("./lib/dom-bufferstream");return new S(new A(I,0,I.byteLength,!0,T))}else{var k=m("./lib/bufferstream");return new S(new k(I,0,I.length,!0))}}}},{"./lib/bufferstream":54,"./lib/dom-bufferstream":56,"./lib/parser":60}],54:[function(m,x,E){function S(h,I,T,A){this.buffer=h,this.offset=I||0,T=typeof T=="number"?T:h.length,this.endPosition=this.offset+T,this.setBigEndian(A)}S.prototype={setBigEndian:function(h){this.bigEndian=!!h},nextUInt8:function(){var h=this.buffer.readUInt8(this.offset);return this.offset+=1,h},nextInt8:function(){var h=this.buffer.readInt8(this.offset);return this.offset+=1,h},nextUInt16:function(){var h=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,h},nextUInt32:function(){var h=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,h},nextInt16:function(){var h=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,h},nextInt32:function(){var h=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,h},nextFloat:function(){var h=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,h},nextDouble:function(){var h=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,h},nextBuffer:function(h){var I=this.buffer.slice(this.offset,this.offset+h);return this.offset+=h,I},remainingLength:function(){return this.endPosition-this.offset},nextString:function(h){var I=this.buffer.toString("utf8",this.offset,this.offset+h);return this.offset+=h,I},mark:function(){var h=this;return{openWithOffset:function(I){return I=(I||0)+this.offset,new S(h.buffer,I,h.endPosition-I,h.bigEndian)},offset:this.offset}},offsetFrom:function(h){return this.offset-h.offset},skip:function(h){this.offset+=h},branch:function(h,I){return I=typeof I=="number"?I:this.endPosition-(this.offset+h),new S(this.buffer,this.offset+h,I,this.bigEndian)}},x.exports=S},{}],55:[function(m,x,E){function S(D){return parseInt(D,10)}var h=3600,I=60;function T(D,M){D=D.map(S),M=M.map(S);var F=D[0],N=D[1]-1,B=D[2],U=M[0],O=M[1],V=M[2],Z=Date.UTC(F,N,B,U,O,V,0),W=Z/1e3;return W}function A(D){var M=D.substr(0,10).split("-"),F=D.substr(11,8).split(":"),N=D.substr(19,6),B=N.split(":").map(S),U=B[0]*h+B[1]*I,O=T(M,F);if(O-=U,typeof O=="number"&&!isNaN(O))return O}function k(D){var M=D.split(" "),F=M[0].split(":"),N=M[1].split(":"),B=T(F,N);if(typeof B=="number"&&!isNaN(B))return B}function P(D){var M=D.length===19&&D.charAt(4)===":",F=D.length===25&&D.charAt(10)==="T";if(F)return A(D);if(M)return k(D)}x.exports={parseDateWithSpecFormat:k,parseDateWithTimezoneFormat:A,parseExifDate:P}},{}],56:[function(m,x,E){function S(h,I,T,A,k,P){this.global=k,I=I||0,T=T||h.byteLength-I,this.arrayBuffer=h.slice(I,I+T),this.view=new k.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(A),this.offset=0,this.parentOffset=(P||0)+I}S.prototype={setBigEndian:function(h){this.littleEndian=!h},nextUInt8:function(){var h=this.view.getUint8(this.offset);return this.offset+=1,h},nextInt8:function(){var h=this.view.getInt8(this.offset);return this.offset+=1,h},nextUInt16:function(){var h=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,h},nextUInt32:function(){var h=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,h},nextInt16:function(){var h=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,h},nextInt32:function(){var h=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,h},nextFloat:function(){var h=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,h},nextDouble:function(){var h=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,h},nextBuffer:function(h){var I=this.arrayBuffer.slice(this.offset,this.offset+h);return this.offset+=h,I},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(h){var I=this.arrayBuffer.slice(this.offset,this.offset+h);return I=String.fromCharCode.apply(null,new this.global.Uint8Array(I)),this.offset+=h,I},mark:function(){var h=this;return{openWithOffset:function(I){return I=(I||0)+this.offset,new S(h.arrayBuffer,I,h.arrayBuffer.byteLength-I,!h.littleEndian,h.global,h.parentOffset)},offset:this.offset,getParentOffset:function(){return h.parentOffset}}},offsetFrom:function(h){return this.parentOffset+this.offset-(h.offset+h.getParentOffset())},skip:function(h){this.offset+=h},branch:function(h,I){return I=typeof I=="number"?I:this.arrayBuffer.byteLength-(this.offset+h),new S(this.arrayBuffer,this.offset+h,I,!this.littleEndian,this.global,this.parentOffset)}},x.exports=S},{}],57:[function(m,x,E){x.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}},{}],58:[function(m,x,E){function S(k,P){switch(k){case 1:return P.nextUInt8();case 3:return P.nextUInt16();case 4:return P.nextUInt32();case 5:return[P.nextUInt32(),P.nextUInt32()];case 6:return P.nextInt8();case 8:return P.nextUInt16();case 9:return P.nextUInt32();case 10:return[P.nextInt32(),P.nextInt32()];case 11:return P.nextFloat();case 12:return P.nextDouble();default:throw new Error("Invalid format while decoding: "+k)}}function h(k){switch(k){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function I(k,P){var D=P.nextUInt16(),M=P.nextUInt16(),F=h(M),N=P.nextUInt32(),B=F*N,U,O;if(B>4&&(P=k.openWithOffset(P.nextUInt32())),M===2){U=P.nextString(N);var V=U.indexOf("\0");V!==-1&&(U=U.substr(0,V))}else if(M===7)U=P.nextBuffer(N);else if(M!==0)for(U=[],O=0;O<N;++O)U.push(S(M,P));return B<4&&P.skip(4-B),[D,U,M]}function T(k,P,D){var M=P.nextUInt16(),F,N;for(N=0;N<M;++N)F=I(k,P),D(F[0],F[1],F[2])}function A(k){var P=k.nextString(6);if(P!=="Exif\0\0")throw new Error("Invalid EXIF header");var D=k.mark(),M=k.nextUInt16();if(M===18761)k.setBigEndian(!1);else if(M===19789)k.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(k.nextUInt16()!==42)throw new Error("Invalid TIFF data");return D}x.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(k,P){var D;try{D=A(k)}catch{return!1}var M,F,N,B=D.openWithOffset(k.nextUInt32()),U=this.IFD0;T(D,B,function(J,q,te){switch(J){case 34853:F=q[0];break;case 34665:M=q[0];break;default:P(U,J,q,te);break}});var O=B.nextUInt32();if(O!==0){var V=D.openWithOffset(O);T(D,V,P.bind(null,this.IFD1))}if(F){var Z=D.openWithOffset(F);T(D,Z,P.bind(null,this.GPSIFD))}if(M){var W=D.openWithOffset(M),Y=this.InteropIFD;T(D,W,function(J,q,te){J===40965?N=q[0]:P(Y,J,q,te)})}if(N){var X=D.openWithOffset(N);T(D,X,P.bind(null,this.InteropIFD))}return!0}}},{}],59:[function(m,x,E){x.exports={parseSections:function(S,h){var I,T;for(S.setBigEndian(!0);S.remainingLength()>0&&T!==218;){if(S.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");T=S.nextUInt8(),T>=208&&T<=217||T===218?I=0:I=S.nextUInt16()-2,h(T,S.branch(0,I)),S.skip(I)}},getSizeFromSOFSection:function(S){return S.skip(1),{height:S.nextUInt16(),width:S.nextUInt16()}},getSectionName:function(S){var h,I;switch(S){case 216:h="SOI";break;case 196:h="DHT";break;case 219:h="DQT";break;case 221:h="DRI";break;case 218:h="SOS";break;case 254:h="COM";break;case 217:h="EOI";break;default:S>=224&&S<=239?(h="APP",I=S-224):S>=192&&S<=207&&S!==196&&S!==200&&S!==204?(h="SOF",I=S-192):S>=208&&S<=215&&(h="RST",I=S-208);break}var T={name:h};return typeof I=="number"&&(T.index=I),T}}},{}],60:[function(m,x,E){var S=m("./jpeg"),h=m("./exif"),I=m("./simplify");function T(k,P,D,M,F,N,B){this.startMarker=k,this.tags=P,this.imageSize=D,this.thumbnailOffset=M,this.thumbnailLength=F,this.thumbnailType=N,this.app1Offset=B}T.prototype={hasThumbnail:function(k){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof k!="string"?!0:k.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:k.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var k=this._getThumbnailStream(),P;return S.parseSections(k,function(D,M){S.getSectionName(D).name==="SOF"&&(P=S.getSizeFromSOFSection(M))}),P}};function A(k){this.stream=k,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}A.prototype={enableBinaryFields:function(k){return this.flags.readBinaryTags=!!k,this},enablePointers:function(k){return this.flags.hidePointers=!k,this},enableTagNames:function(k){return this.flags.resolveTagNames=!!k,this},enableImageSize:function(k){return this.flags.imageSize=!!k,this},enableReturnTags:function(k){return this.flags.returnTags=!!k,this},enableSimpleValues:function(k){return this.flags.simplifyValues=!!k,this},parse:function(){var k=this.stream.mark(),P=k.openWithOffset(0),D=this.flags,M,F,N,B,U,O,V,Z,W;return D.resolveTagNames&&(V=m("./exif-tags")),D.resolveTagNames?(M={},Z=function(Y){return M[Y.name]},W=function(Y,X){M[Y.name]=X}):(M=[],Z=function(Y){var X;for(X=0;X<M.length;++X)if(M[X].type===Y.type&&M[X].section===Y.section)return M.value},W=function(Y,X){var J;for(J=0;J<M.length;++J)if(M[J].type===Y.type&&M[J].section===Y.section){M.value=X;return}}),S.parseSections(P,function(Y,X){var J,q=X.offsetFrom(k);Y===225?(J=h.parseTags(X,function(te,ne,de,oe){if(!(!D.readBinaryTags&&oe===7)){if(ne===513){if(N=de[0],D.hidePointers)return}else if(ne===514){if(B=de[0],D.hidePointers)return}else if(ne===259&&(U=de[0],D.hidePointers))return;if(!!D.returnTags)if(D.simplifyValues&&(de=I.simplifyValue(de,oe)),D.resolveTagNames){var we=te===h.GPSIFD?V.gps:V.exif,Ae=we[ne];Ae||(Ae=V.exif[ne]),M.hasOwnProperty(Ae)||(M[Ae]=de)}else M.push({section:te,type:ne,value:de})}}),J&&(O=q)):D.imageSize&&S.getSectionName(Y).name==="SOF"&&(F=S.getSizeFromSOFSection(X))}),D.simplifyValues&&(I.castDegreeValues(Z,W),I.castDateValues(Z,W)),new T(k,M,F,N,B,U,O)}},x.exports=A},{"./exif":58,"./exif-tags":57,"./jpeg":59,"./simplify":61}],61:[function(m,x,E){var S=m("./exif"),h=m("./date"),I=[{section:S.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:S.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],T=[{section:S.SubIFD,type:306,name:"ModifyDate"},{section:S.SubIFD,type:36867,name:"DateTimeOriginal"},{section:S.SubIFD,type:36868,name:"CreateDate"},{section:S.SubIFD,type:306,name:"ModifyDate"}];x.exports={castDegreeValues:function(A,k){I.forEach(function(P){var D=A(P);if(D){var M=A({section:P.section,type:P.refType,name:P.refName}),F=M===P.posVal?1:-1,N=(D[0]+D[1]/60+D[2]/3600)*F;k(P,N)}})},castDateValues:function(A,k){T.forEach(function(P){var D=A(P);if(D){var M=h.parseExifDate(D);typeof M!="undefined"&&k(P,M)}})},simplifyValue:function(A,k){return Array.isArray(A)&&(A=A.map(function(P){return k===10||k===5?P[0]/P[1]:P}),A.length===1&&(A=A[0])),A}}},{"./date":55,"./exif":58}],62:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault"),h=S(m("@babel/runtime/helpers/toConsumableArray")),I=function(D){return(0,h.default)(D).map(function(M){return M.charCodeAt(0)})},T=I("META-INF/mozilla.rsa"),A=I("[Content_Types].xml"),k=I("_rels/.rels");x.exports=function(P){var D=P instanceof Uint8Array?P:new Uint8Array(P);if(!(D&&D.length>1))return null;var M=function(te,ne){ne=Object.assign({offset:0},ne);for(var de=0;de<te.length;de++)if(ne.mask){if(te[de]!==(ne.mask[de]&D[de+ne.offset]))return!1}else if(te[de]!==D[de+ne.offset])return!1;return!0},F=function(te,ne){return M(I(te),ne)};if(M([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(M([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(M([71,73,70]))return{ext:"gif",mime:"image/gif"};if(M([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(M([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((M([73,73,42,0])||M([77,77,0,42]))&&M([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(M([73,73,42,0])||M([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(M([66,77]))return{ext:"bmp",mime:"image/bmp"};if(M([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(M([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(M([80,75,3,4])){if(M([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(M(T,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(F("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(F("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(F("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};var N=function(te){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return te.findIndex(function(de,oe,we){return oe>=ne&&we[oe]===80&&we[oe+1]===75&&we[oe+2]===3&&we[oe+3]===4})},B=0,U=!1,O=null;do{var V=B+30;if(U||(U=M(A,{offset:V})||M(k,{offset:V})),O||(F("word/",{offset:V})?O={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:F("ppt/",{offset:V})?O={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:F("xl/",{offset:V})&&(O={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),U&&O)return O;B=N(D,V)}while(B>=0);if(O)return O}if(M([80,75])&&(D[2]===3||D[2]===5||D[2]===7)&&(D[3]===4||D[3]===6||D[3]===8))return{ext:"zip",mime:"application/zip"};if(M([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(M([82,97,114,33,26,7])&&(D[6]===0||D[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(M([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(M([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(M([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(M([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(M([51,103,112,53])||M([0,0,0])&&M([102,116,121,112],{offset:4})&&(M([109,112,52,49],{offset:8})||M([109,112,52,50],{offset:8})||M([105,115,111,109],{offset:8})||M([105,115,111,50],{offset:8})||M([109,109,112,52],{offset:8})||M([77,52,86],{offset:8})||M([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(M([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(M([26,69,223,163])){var Z=D.subarray(4,4+4096),W=Z.findIndex(function(q,te,ne){return ne[te]===66&&ne[te+1]===130});if(W!==-1){var Y=W+3,X=function(te){return(0,h.default)(te).every(function(ne,de){return Z[Y+de]===ne.charCodeAt(0)})};if(X("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(X("webm"))return{ext:"webm",mime:"video/webm"}}}if(M([0,0,0,20,102,116,121,112,113,116,32,32])||M([102,114,101,101],{offset:4})||M([102,116,121,112,113,116,32,32],{offset:4})||M([109,100,97,116],{offset:4})||M([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(M([82,73,70,70])){if(M([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(M([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(M([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(M([48,38,178,117,142,102,207,17,166,217]))return{ext:"wmv",mime:"video/x-ms-wmv"};if(M([0,0,1,186])||M([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(M([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(var J=0;J<2&&J<D.length-16;J++){if(M([73,68,51],{offset:J})||M([255,226],{offset:J,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(M([255,228],{offset:J,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(M([255,248],{offset:J,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(M([255,240],{offset:J,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(M([102,116,121,112,77,52,65],{offset:4})||M([77,52,65,32]))return{ext:"m4a",mime:"audio/mp4"};if(M([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(M([79,103,103,83]))return M([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:M([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:M([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:M([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:M([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(M([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(M([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(M([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(M([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(M([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(M([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((D[0]===67||D[0]===70)&&M([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(M([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(M([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(M([119,79,70,70])&&(M([0,1,0,0],{offset:4})||M([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(M([119,79,70,50])&&(M([0,1,0,0],{offset:4})||M([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(M([76,80],{offset:34})&&(M([0,0,1],{offset:8})||M([1,0,2],{offset:8})||M([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(M([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(M([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(M([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(M([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(M([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(M([37,33]))return{ext:"ps",mime:"application/postscript"};if(M([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(M([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(M([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(M([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(M([77,83,67,70])||M([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(M([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(M([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(M([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(M([31,160])||M([31,157]))return{ext:"Z",mime:"application/x-compress"};if(M([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(M([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(M([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(M([71],{offset:4})&&(M([71],{offset:192})||M([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(M([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(M([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(M([0,0,0,12,106,80,32,32,13,10,135,10])){if(M([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(M([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(M([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(M([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(M([70,79,82,77,0]))return{ext:"aif",mime:"audio/aiff"};if(F("<?xml "))return{ext:"xml",mime:"application/xml"};if(M([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(M([102,116,121,112],{offset:4})){if(M([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(M([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(M([104,101,105,99],{offset:8})||M([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(M([104,101,118,99],{offset:8})||M([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return M([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:null}},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20}],63:[function(m,x,E){var S=m("is-callable"),h=Object.prototype.toString,I=Object.prototype.hasOwnProperty,T=function(M,F,N){for(var B=0,U=M.length;B<U;B++)I.call(M,B)&&(N==null?F(M[B],B,M):F.call(N,M[B],B,M))},A=function(M,F,N){for(var B=0,U=M.length;B<U;B++)N==null?F(M.charAt(B),B,M):F.call(N,M.charAt(B),B,M)},k=function(M,F,N){for(var B in M)I.call(M,B)&&(N==null?F(M[B],B,M):F.call(N,M[B],B,M))},P=function(M,F,N){if(!S(F))throw new TypeError("iterator must be a function");var B;arguments.length>=3&&(B=N),h.call(M)==="[object Array]"?T(M,F,B):typeof M=="string"?A(M,F,B):k(M,F,B)};x.exports=P},{"is-callable":77}],64:[function(m,x,E){function S(A,k,P,D){var M=0,D=D===void 0?{}:D,F=D.loop===void 0?null:D.loop,N=D.palette===void 0?null:D.palette;if(k<=0||P<=0||k>65535||P>65535)throw new Error("Width/Height invalid.");function B(J){var q=J.length;if(q<2||q>256||q&q-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return q}A[M++]=71,A[M++]=73,A[M++]=70,A[M++]=56,A[M++]=57,A[M++]=97;var U=0,O=0;if(N!==null){for(var V=B(N);V>>=1;)++U;if(V=1<<U,--U,D.background!==void 0){if(O=D.background,O>=V)throw new Error("Background index out of range.");if(O===0)throw new Error("Background index explicitly passed as 0.")}}if(A[M++]=k&255,A[M++]=k>>8&255,A[M++]=P&255,A[M++]=P>>8&255,A[M++]=(N!==null?128:0)|U,A[M++]=O,A[M++]=0,N!==null)for(var Z=0,W=N.length;Z<W;++Z){var Y=N[Z];A[M++]=Y>>16&255,A[M++]=Y>>8&255,A[M++]=Y&255}if(F!==null){if(F<0||F>65535)throw new Error("Loop count invalid.");A[M++]=33,A[M++]=255,A[M++]=11,A[M++]=78,A[M++]=69,A[M++]=84,A[M++]=83,A[M++]=67,A[M++]=65,A[M++]=80,A[M++]=69,A[M++]=50,A[M++]=46,A[M++]=48,A[M++]=3,A[M++]=1,A[M++]=F&255,A[M++]=F>>8&255,A[M++]=0}var X=!1;this.addFrame=function(J,q,te,ne,de,oe){if(X===!0&&(--M,X=!1),oe=oe===void 0?{}:oe,J<0||q<0||J>65535||q>65535)throw new Error("x/y invalid.");if(te<=0||ne<=0||te>65535||ne>65535)throw new Error("Width/Height invalid.");if(de.length<te*ne)throw new Error("Not enough pixels for the frame size.");var we=!0,Ae=oe.palette;if(Ae==null&&(we=!1,Ae=N),Ae==null)throw new Error("Must supply either a local or global palette.");for(var ye=B(Ae),me=0;ye>>=1;)++me;ye=1<<me;var xe=oe.delay===void 0?0:oe.delay,Le=oe.disposal===void 0?0:oe.disposal;if(Le<0||Le>3)throw new Error("Disposal out of range.");var Ze=!1,Xe=0;if(oe.transparent!==void 0&&oe.transparent!==null&&(Ze=!0,Xe=oe.transparent,Xe<0||Xe>=ye))throw new Error("Transparent color index.");if((Le!==0||Ze||xe!==0)&&(A[M++]=33,A[M++]=249,A[M++]=4,A[M++]=Le<<2|(Ze===!0?1:0),A[M++]=xe&255,A[M++]=xe>>8&255,A[M++]=Xe,A[M++]=0),A[M++]=44,A[M++]=J&255,A[M++]=J>>8&255,A[M++]=q&255,A[M++]=q>>8&255,A[M++]=te&255,A[M++]=te>>8&255,A[M++]=ne&255,A[M++]=ne>>8&255,A[M++]=we===!0?128|me-1:0,we===!0)for(var je=0,Ie=Ae.length;je<Ie;++je){var Pe=Ae[je];A[M++]=Pe>>16&255,A[M++]=Pe>>8&255,A[M++]=Pe&255}return M=h(A,M,me<2?2:me,de),M},this.end=function(){return X===!1&&(A[M++]=59,X=!0),M},this.getOutputBuffer=function(){return A},this.setOutputBuffer=function(J){A=J},this.getOutputBufferPosition=function(){return M},this.setOutputBufferPosition=function(J){M=J}}function h(A,k,P,D){A[k++]=P;var M=k++,F=1<<P,N=F-1,B=F+1,U=B+1,O=P+1,V=0,Z=0;function W(we){for(;V>=we;)A[k++]=Z&255,Z>>=8,V-=8,k===M+256&&(A[M]=255,M=k++)}function Y(we){Z|=we<<V,V+=O,W(8)}var X=D[0]&N,J={};Y(F);for(var q=1,te=D.length;q<te;++q){var ne=D[q]&N,de=X<<8|ne,oe=J[de];if(oe===void 0){for(Z|=X<<V,V+=O;V>=8;)A[k++]=Z&255,Z>>=8,V-=8,k===M+256&&(A[M]=255,M=k++);U===4096?(Y(F),U=B+1,O=P+1,J={}):(U>=1<<O&&++O,J[de]=U++),X=ne}else X=oe}return Y(X),Y(B),W(1),M+1===k?A[M]=0:(A[M]=k-M-1,A[k++]=0),k}function I(A){var k=0;if(A[k++]!==71||A[k++]!==73||A[k++]!==70||A[k++]!==56||(A[k++]+1&253)!=56||A[k++]!==97)throw new Error("Invalid GIF 87a/89a header.");var P=A[k++]|A[k++]<<8,D=A[k++]|A[k++]<<8,M=A[k++],F=M>>7,N=M&7,B=1<<N+1;A[k++],A[k++];var U=null,O=null;F&&(U=k,O=B,k+=B*3);var V=!0,Z=[],W=0,Y=null,X=0,J=null;for(this.width=P,this.height=D;V&&k<A.length;)switch(A[k++]){case 33:switch(A[k++]){case 255:if(A[k]!==11||A[k+1]==78&&A[k+2]==69&&A[k+3]==84&&A[k+4]==83&&A[k+5]==67&&A[k+6]==65&&A[k+7]==80&&A[k+8]==69&&A[k+9]==50&&A[k+10]==46&&A[k+11]==48&&A[k+12]==3&&A[k+13]==1&&A[k+16]==0)k+=14,J=A[k++]|A[k++]<<8,k++;else for(k+=12;;){var q=A[k++];if(!(q>=0))throw Error("Invalid block size");if(q===0)break;k+=q}break;case 249:if(A[k++]!==4||A[k+4]!==0)throw new Error("Invalid graphics extension block.");var te=A[k++];W=A[k++]|A[k++]<<8,Y=A[k++],(te&1)==0&&(Y=null),X=te>>2&7,k++;break;case 254:for(;;){var q=A[k++];if(!(q>=0))throw Error("Invalid block size");if(q===0)break;k+=q}break;default:throw new Error("Unknown graphic control label: 0x"+A[k-1].toString(16))}break;case 44:var ne=A[k++]|A[k++]<<8,de=A[k++]|A[k++]<<8,oe=A[k++]|A[k++]<<8,we=A[k++]|A[k++]<<8,Ae=A[k++],ye=Ae>>7,me=Ae>>6&1,xe=Ae&7,Le=1<<xe+1,Ze=U,Xe=O,je=!1;if(ye){var je=!0;Ze=k,Xe=Le,k+=Le*3}var Ie=k;for(k++;;){var q=A[k++];if(!(q>=0))throw Error("Invalid block size");if(q===0)break;k+=q}Z.push({x:ne,y:de,width:oe,height:we,has_local_palette:je,palette_offset:Ze,palette_size:Xe,data_offset:Ie,data_length:k-Ie,transparent_index:Y,interlaced:!!me,delay:W,disposal:X});break;case 59:V=!1;break;default:throw new Error("Unknown gif block: 0x"+A[k-1].toString(16))}this.numFrames=function(){return Z.length},this.loopCount=function(){return J},this.frameInfo=function(Pe){if(Pe<0||Pe>=Z.length)throw new Error("Frame index out of range.");return Z[Pe]},this.decodeAndBlitFrameBGRA=function(Pe,De){var ze=this.frameInfo(Pe),it=ze.width*ze.height,tt=new Uint8Array(it);T(A,ze.data_offset,tt,it);var ot=ze.palette_offset,lt=ze.transparent_index;lt===null&&(lt=256);var St=ze.width,et=P-St,Je=St,Be=(ze.y*P+ze.x)*4,Ge=((ze.y+ze.height)*P+ze.x)*4,He=Be,ve=et*4;ze.interlaced===!0&&(ve+=P*4*7);for(var _e=8,pe=0,fe=tt.length;pe<fe;++pe){var ue=tt[pe];if(Je===0&&(He+=ve,Je=St,He>=Ge&&(ve=et*4+P*4*(_e-1),He=Be+(St+et)*(_e<<1),_e>>=1)),ue===lt)He+=4;else{var ce=A[ot+ue*3],Ee=A[ot+ue*3+1],Ye=A[ot+ue*3+2];De[He++]=Ye,De[He++]=Ee,De[He++]=ce,De[He++]=255}--Je}},this.decodeAndBlitFrameRGBA=function(Pe,De){var ze=this.frameInfo(Pe),it=ze.width*ze.height,tt=new Uint8Array(it);T(A,ze.data_offset,tt,it);var ot=ze.palette_offset,lt=ze.transparent_index;lt===null&&(lt=256);var St=ze.width,et=P-St,Je=St,Be=(ze.y*P+ze.x)*4,Ge=((ze.y+ze.height)*P+ze.x)*4,He=Be,ve=et*4;ze.interlaced===!0&&(ve+=P*4*7);for(var _e=8,pe=0,fe=tt.length;pe<fe;++pe){var ue=tt[pe];if(Je===0&&(He+=ve,Je=St,He>=Ge&&(ve=et*4+P*4*(_e-1),He=Be+(St+et)*(_e<<1),_e>>=1)),ue===lt)He+=4;else{var ce=A[ot+ue*3],Ee=A[ot+ue*3+1],Ye=A[ot+ue*3+2];De[He++]=ce,De[He++]=Ee,De[He++]=Ye,De[He++]=255}--Je}}}function T(A,k,P,D){for(var M=A[k++],F=1<<M,N=F+1,B=N+1,U=M+1,O=(1<<U)-1,V=0,Z=0,W=0,Y=A[k++],X=new Int32Array(4096),J=null;;){for(;V<16&&Y!==0;)Z|=A[k++]<<V,V+=8,Y===1?Y=A[k++]:--Y;if(V<U)break;var q=Z&O;if(Z>>=U,V-=U,q===F){B=N+1,U=M+1,O=(1<<U)-1,J=null;continue}else if(q===N)break;for(var te=q<B?q:J,ne=0,de=te;de>F;)de=X[de]>>8,++ne;var oe=de,we=W+ne+(te!==q?1:0);if(we>D){console.log("Warning, gif stream longer than expected.");return}P[W++]=oe,W+=ne;var Ae=W;for(te!==q&&(P[W++]=oe),de=te;ne--;)de=X[de],P[--Ae]=de&255,de>>=8;J!==null&&B<4096&&(X[B++]=J<<8|oe,B>=O+1&&U<12&&(++U,O=O<<1|1)),J=q}return W!==D&&console.log("Warning, gif stream shorter than expected."),P}try{E.GifWriter=S,E.GifReader=I}catch{}},{}],65:[function(m,x,E){(function(S){class h{constructor(...T){if(T.length===0)throw new Error("constructor requires parameters");const A=T[0];if(A!==null&&typeof A=="object")if(A instanceof h){const k=A.bitmap;this.bitmap={width:k.width,height:k.height,data:new S(k.width*k.height*4)},k.data.copy(this.bitmap.data)}else if(A.width&&A.height&&A.data)this.bitmap=A;else throw new Error("unrecognized constructor parameters");else if(typeof A=="number"&&typeof T[1]=="number"){const k=A,P=T[1],D=T[2];this.bitmap={width:k,height:P},S.isBuffer(D)?this.bitmap.data=D:(this.bitmap.data=new S(k*P*4),typeof D=="number"&&this.fillRGBA(D))}else throw new Error("unrecognized constructor parameters")}blit(T,A,k,P,D,M,F){if(P+M>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(A+M>T.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(D+F>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(k+F>T.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const N=this.bitmap.data,B=T.bitmap.data,U=this.bitmap.width*4,O=T.bitmap.width*4,V=M*4;let Z=D*U+P*4,W=k*O+A*4;for(;--F>=0;)N.copy(B,W,Z,Z+V),Z+=U,W+=O;return this}fillRGBA(T){const A=this.bitmap.data,k=this.bitmap.height*4;let P=0;for(;P<k;)A.writeUInt32BE(T,P),P+=4;for(;P<A.length;)A.copy(A,P,0,k),P+=k;return this}getRGBA(T,A){const k=(A*this.bitmap.width+T)*4;return this.bitmap.data.readUInt32BE(k)}getRGBASet(){const T=new Set,A=this.bitmap.data;for(let k=0;k<A.length;k+=4)T.add(A.readUInt32BE(k,!0));return T}greyscale(){const T=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,(A,k,P)=>{const D=Math.round(.299*T[P]+.587*T[P+1]+.114*T[P+2]);T[P]=D,T[P+1]=D,T[P+2]=D}),this}reframe(T,A,k,P,D){const M=T<0?0:T,F=A<0?0:A,N=k+M>this.bitmap.width?this.bitmap.width-M:k,B=P+F>this.bitmap.height?this.bitmap.height-F:P,U=T<0?-T:0,O=A<0?-A:0;let V;if(D===void 0){if(M!==T||F!=A||N!==k||B!==P)throw new GifError("fillRGBA required for this reframing");V=new h(k,P)}else V=new h(k,P,D);return this.blit(V,U,O,M,F,N,B),this.bitmap=V.bitmap,this}scale(T){if(T===1)return;if(!Number.isInteger(T)||T<1)throw new Error("the scale must be an integer >= 1");const A=this.bitmap.width,k=this.bitmap.height,P=A*T*4,D=this.bitmap.data,M=new S(k*P*T);let F=0,N,B=0;for(let U=0;U<k;++U){N=B;for(let O=0;O<A;++O){const V=D.readUInt32BE(F,!0);for(let Z=0;Z<T;++Z)M.writeUInt32BE(V,B),B+=4;F+=4}for(let O=1;O<T;++O)M.copy(M,B,N,B),B+=P,N+=P}return this.bitmap={width:A*T,height:k*T,data:M},this}scanAllCoords(T){const A=this.bitmap.width,k=this.bitmap.data.length;let P=0,D=0;for(let M=0;M<k;M+=4)T(P,D,M),++P===A&&(P=0,++D)}scanAllIndexes(T){const A=this.bitmap.data.length;for(let k=0;k<A;k+=4)T(k)}}x.exports=h}).call(this,m("buffer").Buffer)},{buffer:48}],66:[function(m,x,E){class S{constructor(T,A,k){this.width=k.width,this.height=k.height,this.loops=k.loops,this.usesTransparency=k.usesTransparency,this.colorScope=k.colorScope,this.frames=A,this.buffer=T}}S.GlobalColorsPreferred=0,S.GlobalColorsOnly=1,S.LocalColorsOnly=2;class h extends Error{constructor(T){super(T);T instanceof Error&&(this.stack="Gif"+T.stack)}}E.Gif=S,E.GifError=h},{}],67:[function(m,x,E){(function(S,h){const I=m("omggif"),{Gif:T,GifError:A}=m("./gif");let k;S.nextTick(()=>{k=m("./gifutil")});const{GifFrame:P}=m("./gifframe"),D=200,M=100;class F{constructor(q={}){this._transparentRGB=null,typeof q.transparentRGB=="number"&&q.transparentRGB!==0&&(this._transparentRGBA=q.transparentRGB*256),this._testInitialBufferSize=0}decodeGif(q){try{let te;try{te=new I.GifReader(q)}catch(we){throw new A(we)}const ne=te.numFrames(),de=[],oe={width:te.width,height:te.height,loops:te.loopCount()};oe.usesTransparency=!1;for(let we=0;we<ne;++we){const Ae=this._decodeFrame(te,we,oe.usesTransparency);de.push(Ae.frame),Ae.usesTransparency&&(oe.usesTransparency=!0)}return Promise.resolve(new T(q,de,oe))}catch(te){return Promise.reject(te)}}encodeGif(q,te={}){try{if(q===null||q.length===0)throw new A("there are no frames");const ne=k.getMaxDimensions(q);return te=Object.assign({},te),te.width=ne.maxWidth,te.height=ne.maxHeight,te.loops=te.loops||0,te.colorScope=te.colorScope||T.GlobalColorsPreferred,Promise.resolve(this._encodeGif(q,te))}catch(ne){return Promise.reject(ne)}}_decodeFrame(q,te,ne){let de,oe;try{if(de=q.frameInfo(te),oe=new h(q.width*q.height*4),q.decodeAndBlitFrameRGBA(te,oe),de.width!==q.width||de.height!==q.height){if(de.y&&(oe=oe.slice(de.y*q.width*4)),q.width>de.width)for(let ye=0;ye<de.height;++ye)oe.copy(oe,ye*de.width*4,(de.x+ye*q.width)*4,(de.x+ye*q.width)*4+de.width*4);oe=oe.slice(0,de.width*de.height*4)}}catch(ye){throw new A(ye)}let we=!1;if(this._transparentRGBA===null){if(!ne)for(let ye=3;ye<oe.length;ye+=4)oe[ye]===0&&(we=!0,ye=oe.length)}else for(let ye=3;ye<oe.length;ye+=4)oe[ye]===0&&(oe.writeUInt32BE(this._transparentRGBA,ye-3),we=!0);return{frame:new P(de.width,de.height,oe,{xOffset:de.x,yOffset:de.y,disposalMethod:de.disposal,interlaced:de.interlaced,delayCentisecs:de.delay}),usesTransparency:we}}_encodeGif(q,te){let ne;if(te.colorScope===T.LocalColorsOnly)ne=k.getColorInfo(q,0);else if(ne=k.getColorInfo(q,256),!ne.colors){if(te.colorScope===T.GlobalColorsOnly)throw new A("Too many color indexes for global color table");te.colorScope=T.LocalColorsOnly}te.usesTransparency=ne.usesTransparency;const de=ne.palettes;return te.colorScope===T.LocalColorsOnly?O(q,te,2e3,de):U(q,te,2e3,ne)}_getSizeEstimateGlobal(q,te){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let ne=D+3*256;const de=Y(q);return te.forEach(oe=>{ne+=Z(oe,de)}),ne}_getSizeEstimateLocal(q,te){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let ne=D;for(let de=0;de<te.length;++de){const oe=q[de],we=Y(oe);ne+=Z(te[de],we)}return ne}}E.GifCodec=F;function N(J,q){const te=J.indexOf(q);return te===-1?null:te}function B(J,q){for(var te=0,ne=J.length-1,de;te<=ne;)if(de=Math.floor((te+ne)/2),J[de]>q)ne=de-1;else if(J[de]<q)te=de+1;else return de;return null}function U(J,q,te,ne){const de={colors:ne.colors.slice(),usesTransparency:ne.usesTransparency};V(de);const oe={palette:de.colors,loop:q.loops};let we=new h(te),Ae;try{Ae=new I.GifWriter(we,q.width,q.height,oe)}catch(ye){throw new A(ye)}for(let ye=0;ye<J.length;++ye)we=X(Ae,ye,J[ye],ne,!1);return new T(we.slice(0,Ae.end()),J,q)}function O(J,q,te,ne){const de={loop:q.loops};let oe=new h(te),we;try{we=new I.GifWriter(oe,q.width,q.height,de)}catch(Ae){throw new A(Ae)}for(let Ae=0;Ae<J.length;++Ae)oe=X(we,Ae,J[Ae],ne[Ae],!0);return new T(oe.slice(0,we.end()),J,q)}function V(J){const q=J.colors;J.usesTransparency&&q.push(0);const te=q.length;let ne=2;for(;te>ne;)ne<<=1;q.length=ne,q.fill(0,te)}function Z(J,q){let te=J.bitmap.width*J.bitmap.height;return te=Math.ceil(te*q/8),te+=Math.ceil(te/255),M+te+3*256}function W(J,q,te){const ne=te.colors,de=ne.length<=8?N:B,oe=q.bitmap.data,we=new h(oe.length/4);let Ae=ne.length,ye=0,me=0;for(;ye<oe.length;){if(oe[ye+3]!==0){const xe=oe.readUInt32BE(ye,!0)>>8&16777215;we[me]=de(ne,xe)}else we[me]=Ae;ye+=4,++me}if(te.usesTransparency){if(Ae===256)throw new A(`Frame ${J} already has 256 colorsand so can't use transparency`)}else Ae=null;return{buffer:we,transparentIndex:Ae}}function Y(J){let q=J.indexCount,te=0;for(--q;q;)++te,q>>=1;return te>0?te:1}function X(J,q,te,ne,de){if(te.interlaced)throw new A("writing interlaced GIFs is not supported");const oe=W(q,te,ne),we={delay:te.delayCentisecs,disposal:te.disposalMethod,transparent:oe.transparentIndex};de&&(V(ne),we.palette=ne.colors);try{let Ae=J.getOutputBuffer(),ye=J.getOutputBufferPosition(),me,xe=!0;for(;xe;)if(me=J.addFrame(te.xOffset,te.yOffset,te.bitmap.width,te.bitmap.height,oe.buffer,we),xe=!1,me>=Ae.length-1){const Le=new h(Ae.length*1.5);Ae.copy(Le),J.setOutputBuffer(Le),J.setOutputBufferPosition(ye),Ae=Le,xe=!0}return Ae}catch(Ae){throw new A(Ae)}}}).call(this,m("_process"),m("buffer").Buffer)},{"./gif":66,"./gifframe":68,"./gifutil":69,_process:133,buffer:48,omggif:64}],68:[function(m,x,E){const S=m("./bitmapimage");m("./gif");class h extends S{constructor(...T){super(...T);if(T[0]instanceof h){const A=T[0];this.xOffset=A.xOffset,this.yOffset=A.yOffset,this.disposalMethod=A.disposalMethod,this.delayCentisecs=A.delayCentisecs,this.interlaced=A.interlaced}else{const A=T[T.length-1];let k={};typeof A=="object"&&!(A instanceof S)&&(k=A),this.xOffset=k.xOffset||0,this.yOffset=k.yOffset||0,this.disposalMethod=k.disposalMethod!==void 0?k.disposalMethod:h.DisposeToBackgroundColor,this.delayCentisecs=k.delayCentisecs||8,this.interlaced=k.interlaced||!1}}getPalette(){const T=new Set,A=this.bitmap.data;let k=0,P=!1;for(;k<A.length;){if(A[k+3]===0)P=!0;else{const N=A.readUInt32BE(k,!0)>>8&16777215;T.add(N)}k+=4}const D=new Array(T.size),M=T.values();for(k=0;k<D.length;++k)D[k]=M.next().value;D.sort((N,B)=>N-B);let F=D.length;return P&&++F,{colors:D,usesTransparency:P,indexCount:F}}}h.DisposeToAnything=0,h.DisposeNothing=1,h.DisposeToBackgroundColor=2,h.DisposeToPrevious=3,E.GifFrame=h},{"./bitmapimage":65,"./gif":66}],69:[function(m,x,E){(function(S){const h=m("fs"),I=m("image-q"),T=m("./bitmapimage"),{GifFrame:A}=m("./gifframe"),{GifError:k}=m("./gif"),{GifCodec:P}=m("./gifcodec"),D=[".jpg",".jpeg",".png",".bmp"],M=new P;E.cloneFrames=function(U){let O=[];return U.forEach(V=>{O.push(new A(V))}),O},E.getColorInfo=function(U,O){let V=!1;const Z=[];for(let q=0;q<U.length;++q){let te=U[q].getPalette();if(te.usesTransparency&&(V=!0),te.indexCount>256)throw new k(`Frame ${q} uses more than 256 color indexes`);Z.push(te)}if(O===0)return{usesTransparency:V,palettes:Z};const W=new Set;Z.forEach(q=>{q.colors.forEach(te=>{W.add(te)})});let Y=W.size;if(V&&++Y,O&&Y>O)return{usesTransparency:V,palettes:Z};const X=new Array(W.size),J=W.values();for(let q=0;q<X.length;++q)X[q]=J.next().value;return X.sort((q,te)=>q-te),{colors:X,indexCount:Y,usesTransparency:V,palettes:Z}},E.copyAsJimp=function(U,O){return E.shareAsJimp(U,new T(O))},E.getMaxDimensions=function(U){let O=0,V=0;return U.forEach(Z=>{const W=Z.xOffset+Z.bitmap.width;W>O&&(O=W);const Y=Z.yOffset+Z.bitmap.height;Y>V&&(V=Y)}),{maxWidth:O,maxHeight:V}},E.quantizeDekker=function(U,O,V){O=O||256,F(U,"NeuQuantFloat",O,0,V)},E.quantizeSorokin=function(U,O,V,Z){O=O||256,V=V||"min-pop";let W;switch(V){case"min-pop":W=2;break;case"top-pop":W=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${V}'`)}F(U,"RGBQuant",O,W,Z)},E.quantizeWu=function(U,O,V,Z){if(O=O||256,V=V||5,V<1||V>8)throw new Error("Invalid quantization quality");F(U,"WuQuant",O,V,Z)},E.read=function(U,O){return O=O||M,S.isBuffer(U)?O.decodeGif(U):N(U).then(V=>O.decodeGif(V))},E.shareAsJimp=function(U,O){const V=new U(O.bitmap.width,O.bitmap.height,0);return V.bitmap.data=O.bitmap.data,V},E.write=function(U,O,V,Z){Z=Z||M;const W=U.match(/\.[a-zA-Z]+$/);if(W!==null&&D.includes(W[0].toLowerCase()))throw new Error(`GIF '${U}' has an unexpected suffix`);return Z.encodeGif(O,V).then(Y=>B(U,Y.buffer).then(()=>Y))};function F(U,O,V,Z,W){const Y=Array.isArray(U)?U:[U],X=["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"];if(W){if(X.indexOf(W.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${W.ditherAlgorithm}'`);W.serpentine===void 0&&(W.serpentine=!0),W.minimumColorDistanceToDither===void 0&&(W.minimumColorDistanceToDither=0),W.calculateErrorLikeGIMP===void 0&&(W.calculateErrorLikeGIMP=!1)}const J=new I.distance.Euclidean,q=new I.palette[O](J,V,Z);let te;W?te=new I.image.ErrorDiffusionArray(J,I.image.ErrorDiffusionArrayKernel[W.ditherAlgorithm],W.serpentine,W.minimumColorDistanceToDither,W.calculateErrorLikeGIMP):te=new I.image.NearestColor(J);const ne=[];Y.forEach(oe=>{const we=oe.bitmap.data,Ae=new ArrayBuffer(we.length),ye=new Uint32Array(Ae);for(let xe=0,Le=0;xe<we.length;xe+=4,++Le)ye[Le]=we.readUInt32LE(xe,!0);const me=I.utils.PointContainer.fromUint32Array(ye,oe.bitmap.width,oe.bitmap.height);q.sample(me),ne.push(me)});const de=q.quantize();for(let oe=0;oe<Y.length;++oe){const we=Y[oe].bitmap.data,ye=te.quantize(ne[oe],de).toUint32Array();for(let me=0,xe=0;me<we.length;me+=4,++xe)we.writeUInt32LE(ye[xe],me)}}function N(U){return new Promise((O,V)=>{h.readFile(U,(Z,W)=>Z?V(Z):O(W))})}function B(U,O){return new Promise((V,Z)=>{h.writeFile(U,O,W=>W?Z(W):V())})}}).call(this,{isBuffer:m("../../is-buffer/index.js")})},{"../../is-buffer/index.js":76,"./bitmapimage":65,"./gif":66,"./gifcodec":67,"./gifframe":68,fs:47,"image-q":74}],70:[function(m,x,E){const S=m("./bitmapimage"),{Gif:h,GifError:I}=m("./gif"),{GifCodec:T}=m("./gifcodec"),{GifFrame:A}=m("./gifframe"),k=m("./gifutil");x.exports={BitmapImage:S,Gif:h,GifCodec:T,GifFrame:A,GifUtil:k,GifError:I}},{"./bitmapimage":65,"./gif":66,"./gifcodec":67,"./gifframe":68,"./gifutil":69}],71:[function(m,x,E){(function(S){var h;typeof g!="undefined"?h=g:typeof S!="undefined"?h=S:typeof self!="undefined"?h=self:h={},x.exports=h}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{}],72:[function(m,x,E){var S=m("http"),h=m("url"),I=x.exports;for(var T in S)S.hasOwnProperty(T)&&(I[T]=S[T]);I.request=function(k,P){return k=A(k),S.request.call(this,k,P)},I.get=function(k,P){return k=A(k),S.get.call(this,k,P)};function A(k){if(typeof k=="string"&&(k=h.parse(k)),k.protocol||(k.protocol="https:"),k.protocol!=="https:")throw new Error('Protocol "'+k.protocol+'" not supported. Expected "https:"');return k}},{http:156,url:180}],73:[function(m,x,E){E.read=function(S,h,I,T,A){var k,P,D=A*8-T-1,M=(1<<D)-1,F=M>>1,N=-7,B=I?A-1:0,U=I?-1:1,O=S[h+B];for(B+=U,k=O&(1<<-N)-1,O>>=-N,N+=D;N>0;k=k*256+S[h+B],B+=U,N-=8);for(P=k&(1<<-N)-1,k>>=-N,N+=T;N>0;P=P*256+S[h+B],B+=U,N-=8);if(k===0)k=1-F;else{if(k===M)return P?NaN:(O?-1:1)*(1/0);P=P+Math.pow(2,T),k=k-F}return(O?-1:1)*P*Math.pow(2,k-T)},E.write=function(S,h,I,T,A,k){var P,D,M,F=k*8-A-1,N=(1<<F)-1,B=N>>1,U=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=T?0:k-1,V=T?1:-1,Z=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(D=isNaN(h)?1:0,P=N):(P=Math.floor(Math.log(h)/Math.LN2),h*(M=Math.pow(2,-P))<1&&(P--,M*=2),P+B>=1?h+=U/M:h+=U*Math.pow(2,1-B),h*M>=2&&(P++,M/=2),P+B>=N?(D=0,P=N):P+B>=1?(D=(h*M-1)*Math.pow(2,A),P=P+B):(D=h*Math.pow(2,B-1)*Math.pow(2,A),P=0));A>=8;S[I+O]=D&255,O+=V,D/=256,A-=8);for(P=P<<A|D,F+=A;F>0;S[I+O]=P&255,O+=V,P/=256,F-=8);S[I+O-V]|=Z*128}},{}],74:[function(m,x,E){(function(h,I){typeof E=="object"&&typeof x=="object"?x.exports=I():typeof E=="object"?E.iq=I():h.iq=I()})(this,function(){return function(S){var h={};function I(T){if(h[T])return h[T].exports;var A=h[T]={exports:{},id:T,loaded:!1};return S[T].call(A.exports,A,A.exports,I),A.loaded=!0,A.exports}return I.m=S,I.c=h,I.p="",I(0)}([function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var T=I(1);h.constants=T;var A=I(3);h.conversion=A;var k=I(12);h.distance=k;var P=I(20);h.palette=P;var D=I(30);h.image=D;var M=I(35);h.quality=M;var F=I(37);h.utils=F},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 */var T=I(2);h.bt709=T},function(S,h){var I;(function(k){k[k.RED=.2126]="RED",k[k.GREEN=.7152]="GREEN",k[k.BLUE=.0722]="BLUE",k[k.WHITE=1]="WHITE"})(I||(I={})),h.Y=I;var T;(function(k){k[k.RED=.64]="RED",k[k.GREEN=.3]="GREEN",k[k.BLUE=.15]="BLUE",k[k.WHITE=.3127]="WHITE"})(T||(T={})),h.x=T;var A;(function(k){k[k.RED=.33]="RED",k[k.GREEN=.6]="GREEN",k[k.BLUE=.06]="BLUE",k[k.WHITE=.329]="WHITE"})(A||(A={})),h.y=A},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var T=I(4);h.rgb2xyz=T.rgb2xyz;var A=I(5);h.rgb2hsl=A.rgb2hsl;var k=I(7);h.rgb2lab=k.rgb2lab;var P=I(9);h.lab2xyz=P.lab2xyz;var D=I(10);h.lab2rgb=D.lab2rgb;var M=I(8);h.xyz2lab=M.xyz2lab;var F=I(11);h.xyz2rgb=F.xyz2rgb},function(S,h){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 */function I(A){return A>.04045?Math.pow((A+.055)/1.055,2.4):A/12.92}function T(A,k,P){return A=I(A/255),k=I(k/255),P=I(P/255),{x:A*.4124+k*.3576+P*.1805,y:A*.2126+k*.7152+P*.0722,z:A*.0193+k*.1192+P*.9505}}h.rgb2xyz=T},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 */var T=I(6);function A(k,P,D){var M=T.min3(k,P,D),F=T.max3(k,P,D),N=F-M,B=(M+F)/510,U=0;B>0&&B<1&&(U=N/(B<.5?F+M:510-F-M));var O=0;return N>0&&(F===k?O=(P-D)/N:F===P?O=2+(D-k)/N:O=4+(k-P)/N,O*=60,O<0&&(O+=360)),{h:O,s:U,l:B}}h.rgb2hsl=A},function(S,h){function I(F){return F*(Math.PI/180)}h.degrees2radians=I;function T(F,N,B){var U=F;return U<N&&(U=N),U<B&&(U=B),U}h.max3=T;function A(F,N,B){var U=F;return U>N&&(U=N),U>B&&(U=B),U}h.min3=A;function k(F,N,B){return F>B&&(F=B),F<N&&(F=N),F|0}h.intInRange=k;function P(F){return F=Math.round(F),F>255?F=255:F<0&&(F=0),F}h.inRange0to255Rounded=P;function D(F){return F>255?F=255:F<0&&(F=0),F}h.inRange0to255=D;function M(F,N){var B=typeof F[0],U;if(B==="number"||B==="string"){for(var O=Object.create(null),V=0,Z=F.length;V<Z;V++){var W=F[V];O[W]||O[W]===0||(O[W]=V)}U=F.sort(function(X,J){return N(X,J)||O[X]-O[J]})}else{var Y=F.slice(0);U=F.sort(function(X,J){return N(X,J)||Y.indexOf(X)-Y.indexOf(J)})}return U}h.stableSort=M},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 */var T=I(4),A=I(8);function k(P,D,M){var F=T.rgb2xyz(P,D,M);return A.xyz2lab(F.x,F.y,F.z)}h.rgb2lab=k},function(S,h){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 */var I=.95047,T=1,A=1.08883;function k(D){return D>.008856?Math.pow(D,1/3):7.787*D+16/116}function P(D,M,F){if(D=k(D/I),M=k(M/T),F=k(F/A),116*M-16<0)throw new Error("xxx");return{L:Math.max(0,116*M-16),a:500*(D-M),b:200*(M-F)}}h.xyz2lab=P},function(S,h){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 */var I=.95047,T=1,A=1.08883;function k(D){return D>.206893034?Math.pow(D,3):(D-16/116)/7.787}function P(D,M,F){var N=(D+16)/116,B=M/500+N,U=N-F/200;return{x:I*k(B),y:T*k(N),z:A*k(U)}}h.lab2xyz=P},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 */var T=I(9),A=I(11);function k(P,D,M){var F=T.lab2xyz(P,D,M);return A.xyz2rgb(F.x,F.y,F.z)}h.lab2rgb=k},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 */var T=I(6);function A(P){return P>.0031308?1.055*Math.pow(P,1/2.4)-.055:12.92*P}function k(P,D,M){var F=A(P*3.2406+D*-1.5372+M*-.4986),N=A(P*-.9689+D*1.8758+M*.0415),B=A(P*.0557+D*-.204+M*1.057);return{r:T.inRange0to255Rounded(F*255),g:T.inRange0to255Rounded(N*255),b:T.inRange0to255Rounded(B*255)}}h.xyz2rgb=k},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var T=I(13);h.AbstractDistanceCalculator=T.AbstractDistanceCalculator;var A=I(14);h.CIE94Textiles=A.CIE94Textiles,h.CIE94GraphicArts=A.CIE94GraphicArts;var k=I(15);h.CIEDE2000=k.CIEDE2000;var P=I(16);h.CMETRIC=P.CMETRIC;var D=I(17);h.AbstractEuclidean=D.AbstractEuclidean,h.Euclidean=D.Euclidean,h.EuclideanRgbQuantWOAlpha=D.EuclideanRgbQuantWOAlpha,h.EuclideanRgbQuantWithAlpha=D.EuclideanRgbQuantWithAlpha;var M=I(18);h.AbstractManhattan=M.AbstractManhattan,h.Manhattan=M.Manhattan,h.ManhattanSRGB=M.ManhattanSRGB,h.ManhattanNommyde=M.ManhattanNommyde;var F=I(19);h.PNGQUANT=F.PNGQUANT},function(S,h){var I=function(){function T(){this._setDefaults(),this.setWhitePoint(255,255,255,255)}return T.prototype.setWhitePoint=function(A,k,P,D){this._whitePoint={r:A>0?255/A:0,g:k>0?255/k:0,b:P>0?255/P:0,a:D>0?255/D:0},this._maxDistance=this.calculateRaw(A,k,P,D,0,0,0,0)},T.prototype.calculateNormalized=function(A,k){return this.calculateRaw(A.r,A.g,A.b,A.a,k.r,k.g,k.b,k.a)/this._maxDistance},T.prototype._setDefaults=function(){},T}();h.AbstractDistanceCalculator=I},function(S,h,I){var T=this&&this.__extends||function(N,B){for(var U in B)B.hasOwnProperty(U)&&(N[U]=B[U]);function O(){this.constructor=N}N.prototype=B===null?Object.create(B):(O.prototype=B.prototype,new O)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 */var A=I(13),k=I(7),P=I(6),D=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype.calculateRaw=function(U,O,V,Z,W,Y,X,J){var q=k.rgb2lab(P.inRange0to255(U*this._whitePoint.r),P.inRange0to255(O*this._whitePoint.g),P.inRange0to255(V*this._whitePoint.b)),te=k.rgb2lab(P.inRange0to255(W*this._whitePoint.r),P.inRange0to255(Y*this._whitePoint.g),P.inRange0to255(X*this._whitePoint.b)),ne=q.L-te.L,de=q.a-te.a,oe=q.b-te.b,we=Math.sqrt(q.a*q.a+q.b*q.b),Ae=Math.sqrt(te.a*te.a+te.b*te.b),ye=we-Ae,me=de*de+oe*oe-ye*ye;me=me<0?0:Math.sqrt(me);var xe=(J-Z)*this._whitePoint.a*this._kA;return Math.sqrt(Math.pow(ne/this._Kl,2)+Math.pow(ye/(1+this._K1*we),2)+Math.pow(me/(1+this._K2*we),2)+Math.pow(xe,2))},B}(A.AbstractDistanceCalculator);h.AbstractCIE94=D;var M=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=.25*50/255},B}(D);h.CIE94Textiles=M;var F=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=.25*100/255},B}(D);h.CIE94GraphicArts=F},function(S,h,I){var T=this&&this.__extends||function(M,F){for(var N in F)F.hasOwnProperty(N)&&(M[N]=F[N]);function B(){this.constructor=M}M.prototype=F===null?Object.create(F):(B.prototype=F.prototype,new B)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 */var A=I(13),k=I(7),P=I(6),D=function(M){T(F,M);function F(){M.apply(this,arguments)}return F.prototype.calculateRaw=function(N,B,U,O,V,Z,W,Y){var X=k.rgb2lab(P.inRange0to255(N*this._whitePoint.r),P.inRange0to255(B*this._whitePoint.g),P.inRange0to255(U*this._whitePoint.b)),J=k.rgb2lab(P.inRange0to255(V*this._whitePoint.r),P.inRange0to255(Z*this._whitePoint.g),P.inRange0to255(W*this._whitePoint.b)),q=(Y-O)*this._whitePoint.a*F._kA,te=this.calculateRawInLab(X,J);return Math.sqrt(te+q*q)},F.prototype.calculateRawInLab=function(N,B){var U=N.L,O=N.a,V=N.b,Z=B.L,W=B.a,Y=B.b,X=Math.sqrt(O*O+V*V),J=Math.sqrt(W*W+Y*Y),q=Math.pow((X+J)/2,7),te=.5*(1-Math.sqrt(q/(q+F._pow25to7))),ne=(1+te)*O,de=(1+te)*W,oe=Math.sqrt(ne*ne+V*V),we=Math.sqrt(de*de+Y*Y),Ae=oe*we,ye=F._calculatehp(V,ne),me=F._calculatehp(Y,de),xe=Math.abs(ye-me),Le=Z-U,Ze=we-oe,Xe=F._calculate_dHp(Ae,xe,me,ye),je=F._calculate_ahp(Ae,xe,ye,me),Ie=F._calculateT(je),Pe=(oe+we)/2,De=Math.pow((U+Z)/2-50,2),ze=1+.015*De/Math.sqrt(20+De),it=1+.045*Pe,tt=1+.015*Ie*Pe,ot=F._calculateRT(je,Pe),lt=Le/ze,St=Ze/it,et=Xe/tt;return Math.pow(lt,2)+Math.pow(St,2)+Math.pow(et,2)+ot*St*et},F._calculatehp=function(N,B){var U=Math.atan2(N,B);return U>=0?U:U+F._deg360InRad},F._calculateRT=function(N,B){var U=Math.pow(B,7),O=2*Math.sqrt(U/(U+F._pow25to7)),V=F._deg30InRad*Math.exp(-Math.pow((N-F._deg275InRad)/F._deg25InRad,2));return-Math.sin(2*V)*O},F._calculateT=function(N){return 1-.17*Math.cos(N-F._deg30InRad)+.24*Math.cos(N*2)+.32*Math.cos(N*3+F._deg6InRad)-.2*Math.cos(N*4-F._deg63InRad)},F._calculate_ahp=function(N,B,U,O){var V=U+O;return N==0?V:B<=F._deg180InRad?V/2:V<F._deg360InRad?(V+F._deg360InRad)/2:(V-F._deg360InRad)/2},F._calculate_dHp=function(N,B,U,O){var V;return N==0?V=0:B<=F._deg180InRad?V=U-O:U<=O?V=U-O+F._deg360InRad:V=U-O-F._deg360InRad,2*Math.sqrt(N)*Math.sin(V/2)},F._kA=.25*100/255,F._pow25to7=Math.pow(25,7),F._deg360InRad=P.degrees2radians(360),F._deg180InRad=P.degrees2radians(180),F._deg30InRad=P.degrees2radians(30),F._deg6InRad=P.degrees2radians(6),F._deg63InRad=P.degrees2radians(63),F._deg275InRad=P.degrees2radians(275),F._deg25InRad=P.degrees2radians(25),F}(A.AbstractDistanceCalculator);h.CIEDE2000=D},function(S,h,I){var T=this&&this.__extends||function(P,D){for(var M in D)D.hasOwnProperty(M)&&(P[M]=D[M]);function F(){this.constructor=P}P.prototype=D===null?Object.create(D):(F.prototype=D.prototype,new F)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 */var A=I(13),k=function(P){T(D,P);function D(){P.apply(this,arguments)}return D.prototype.calculateRaw=function(M,F,N,B,U,O,V,Z){var W=(M+U)/2*this._whitePoint.r,Y=(M-U)*this._whitePoint.r,X=(F-O)*this._whitePoint.g,J=(N-V)*this._whitePoint.b,q=((512+W)*Y*Y>>8)+4*X*X+((767-W)*J*J>>8),te=(Z-B)*this._whitePoint.a;return Math.sqrt(q+te*te)},D}(A.AbstractDistanceCalculator);h.CMETRIC=k},function(S,h,I){var T=this&&this.__extends||function(N,B){for(var U in B)B.hasOwnProperty(U)&&(N[U]=B[U]);function O(){this.constructor=N}N.prototype=B===null?Object.create(B):(O.prototype=B.prototype,new O)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 */var A=I(13),k=I(2),P=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype.calculateRaw=function(U,O,V,Z,W,Y,X,J){var q=W-U,te=Y-O,ne=X-V,de=J-Z;return Math.sqrt(this._kR*q*q+this._kG*te*te+this._kB*ne*ne+this._kA*de*de)},B}(A.AbstractDistanceCalculator);h.AbstractEuclidean=P;var D=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=1,this._kG=1,this._kB=1,this._kA=1},B}(P);h.Euclidean=D;var M=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=k.Y.RED,this._kG=k.Y.GREEN,this._kB=k.Y.BLUE,this._kA=1},B}(P);h.EuclideanRgbQuantWithAlpha=M;var F=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=k.Y.RED,this._kG=k.Y.GREEN,this._kB=k.Y.BLUE,this._kA=0},B}(P);h.EuclideanRgbQuantWOAlpha=F},function(S,h,I){var T=this&&this.__extends||function(N,B){for(var U in B)B.hasOwnProperty(U)&&(N[U]=B[U]);function O(){this.constructor=N}N.prototype=B===null?Object.create(B):(O.prototype=B.prototype,new O)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 */var A=I(13),k=I(2),P=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype.calculateRaw=function(U,O,V,Z,W,Y,X,J){var q=W-U,te=Y-O,ne=X-V,de=J-Z;return q<0&&(q=0-q),te<0&&(te=0-te),ne<0&&(ne=0-ne),de<0&&(de=0-de),this._kR*q+this._kG*te+this._kB*ne+this._kA*de},B}(A.AbstractDistanceCalculator);h.AbstractManhattan=P;var D=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=1,this._kG=1,this._kB=1,this._kA=1},B}(P);h.Manhattan=D;var M=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1},B}(P);h.ManhattanNommyde=M;var F=function(N){T(B,N);function B(){N.apply(this,arguments)}return B.prototype._setDefaults=function(){this._kR=k.Y.RED,this._kG=k.Y.GREEN,this._kB=k.Y.BLUE,this._kA=1},B}(P);h.ManhattanSRGB=F},function(S,h,I){var T=this&&this.__extends||function(P,D){for(var M in D)D.hasOwnProperty(M)&&(P[M]=D[M]);function F(){this.constructor=P}P.prototype=D===null?Object.create(D):(F.prototype=D.prototype,new F)};/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 */var A=I(13),k=function(P){T(D,P);function D(){P.apply(this,arguments)}return D.prototype.calculateRaw=function(M,F,N,B,U,O,V,Z){var W=(Z-B)*this._whitePoint.a;return this._colordifference_ch(M*this._whitePoint.r,U*this._whitePoint.r,W)+this._colordifference_ch(F*this._whitePoint.g,O*this._whitePoint.g,W)+this._colordifference_ch(N*this._whitePoint.b,V*this._whitePoint.b,W)},D.prototype._colordifference_ch=function(M,F,N){var B=M-F,U=B+N;return B*B+U*U},D}(A.AbstractDistanceCalculator);h.PNGQUANT=k},function(S,h,I){var T=I(21);h.NeuQuant=T.NeuQuant;var A=I(25);h.NeuQuantFloat=A.NeuQuantFloat;var k=I(26);h.RGBQuant=k.RGBQuant;var P=I(27);h.ColorHistogram=P.ColorHistogram;var D=I(29);h.WuQuant=D.WuQuant,h.WuColorCube=D.WuColorCube},function(S,h,I){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 */var T=I(22),A=I(24),k=3,P=function(){function M(F){this.r=this.g=this.b=this.a=F}return M.prototype.toPoint=function(){return A.Point.createByRGBA(this.r>>k,this.g>>k,this.b>>k,this.a>>k)},M.prototype.subtract=function(F,N,B,U){this.r-=F|0,this.g-=N|0,this.b-=B|0,this.a-=U|0},M}(),D=function(){function M(F,N){N===void 0&&(N=256),this._distance=F,this._pointArray=[],this._sampleFactor=1,this._networkSize=N,this._distance.setWhitePoint(255<<k,255<<k,255<<k,255<<k)}return M.prototype.sample=function(F){this._pointArray=this._pointArray.concat(F.getPointArray())},M.prototype.quantize=function(){return this._init(),this._learn(),this._buildPalette()},M.prototype._init=function(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(var F=0;F<this._networkSize;F++)this._network[F]=new P((F<<k+8)/this._networkSize|0),this._freq[F]=M._initialBias/this._networkSize|0,this._bias[F]=0},M.prototype._learn=function(){var F=this._sampleFactor,N=this._pointArray.length;N<M._minpicturebytes&&(F=1);var B=30+(F-1)/3|0,U=N/F|0,O=U/M._nCycles|0,V=M._initAlpha,Z=(this._networkSize>>3)*M._radiusBias,W=Z>>M._radiusBiasShift;W<=1&&(W=0);for(var Y=0;Y<W;Y++)this._radPower[Y]=V*((W*W-Y*Y)*M._radBias/(W*W))>>>0;var X;N<M._minpicturebytes?X=1:N%M._prime1!=0?X=M._prime1:N%M._prime2!=0?X=M._prime2:N%M._prime3!=0?X=M._prime3:X=M._prime4;for(var Y=0,J=0;Y<U;){var q=this._pointArray[J],te=q.b<<k,ne=q.g<<k,de=q.r<<k,oe=q.a<<k,we=this._contest(te,ne,de,oe);if(this._alterSingle(V,we,te,ne,de,oe),W!==0&&this._alterNeighbour(W,we,te,ne,de,oe),J+=X,J>=N&&(J-=N),Y++,O===0&&(O=1),Y%O==0){V-=V/B|0,Z-=Z/M._radiusDecrease|0,W=Z>>M._radiusBiasShift,W<=1&&(W=0);for(var Ae=0;Ae<W;Ae++)this._radPower[Ae]=V*((W*W-Ae*Ae)*M._radBias/(W*W))>>>0}}},M.prototype._buildPalette=function(){var F=new T.Palette;return this._network.forEach(function(N){F.add(N.toPoint())}),F.sort(),F},M.prototype._alterNeighbour=function(F,N,B,U,O,V){var Z=N-F;Z<-1&&(Z=-1);var W=N+F;W>this._networkSize&&(W=this._networkSize);for(var Y=N+1,X=N-1,J=1;Y<W||X>Z;){var q=this._radPower[J++]/M._alphaRadBias;if(Y<W){var te=this._network[Y++];te.subtract(q*(te.r-O),q*(te.g-U),q*(te.b-B),q*(te.a-V))}if(X>Z){var te=this._network[X--];te.subtract(q*(te.r-O),q*(te.g-U),q*(te.b-B),q*(te.a-V))}}},M.prototype._alterSingle=function(F,N,B,U,O,V){F/=M._initAlpha;var Z=this._network[N];Z.subtract(F*(Z.r-O),F*(Z.g-U),F*(Z.b-B),F*(Z.a-V))},M.prototype._contest=function(F,N,B,U){for(var O=255*4<<k,V=~(1<<31),Z=V,W=-1,Y=W,X=0;X<this._networkSize;X++){var J=this._network[X],q=this._distance.calculateNormalized(J,{r:B,g:N,b:F,a:U})*O|0;q<V&&(V=q,W=X);var te=q-(this._bias[X]>>M._initialBiasShift-k);te<Z&&(Z=te,Y=X);var ne=this._freq[X]>>M._betaShift;this._freq[X]-=ne,this._bias[X]+=ne<<M._gammaShift}return this._freq[W]+=M._beta,this._bias[W]-=M._betaGamma,Y},M._prime1=499,M._prime2=491,M._prime3=487,M._prime4=503,M._minpicturebytes=M._prime4,M._nCycles=100,M._initialBiasShift=16,M._initialBias=1<<M._initialBiasShift,M._gammaShift=10,M._betaShift=10,M._beta=M._initialBias>>M._betaShift,M._betaGamma=M._initialBias<<M._gammaShift-M._betaShift,M._radiusBiasShift=6,M._radiusBias=1<<M._radiusBiasShift,M._radiusDecrease=30,M._alphaBiasShift=10,M._initAlpha=1<<M._alphaBiasShift,M._radBiasShift=8,M._radBias=1<<M._radBiasShift,M._alphaRadBiasShift=M._alphaBiasShift+M._radBiasShift,M._alphaRadBias=1<<M._alphaRadBiasShift,M}();h.NeuQuant=D},function(S,h,I){var T=I(23),A=I(5),k=10;function P(M,F){for(var N=360,B=N/F,U=B/2,O=1,V=B-U;O<F;O++,V+=B)if(M>=V&&M<V+B)return O;return 0}h.hueGroup=P;var D=function(){function M(){this._pointArray=[],this._i32idx={},this._pointContainer=new T.PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}return M.prototype.add=function(F){this._pointArray.push(F),this._pointContainer.setWidth(this._pointArray.length)},M.prototype.has=function(F){for(var N=this._pointArray.length-1;N>=0;N--)if(F.uint32===this._pointArray[N].uint32)return!0;return!1},M.prototype.getNearestColor=function(F,N){return this._pointArray[this.getNearestIndex(F,N)|0]},M.prototype.getPointContainer=function(){return this._pointContainer},M.prototype._nearestPointFromCache=function(F){return typeof this._i32idx[F]=="number"?this._i32idx[F]:-1},M.prototype.getNearestIndex=function(F,N){var B=this._nearestPointFromCache(""+N.uint32);if(B>=0)return B;var U=Number.MAX_VALUE;B=0;for(var O=0,V=this._pointArray.length;O<V;O++){var Z=this._pointArray[O],W=F.calculateRaw(N.r,N.g,N.b,N.a,Z.r,Z.g,Z.b,Z.a);W<U&&(U=W,B=O)}return this._i32idx[N.uint32]=B,B},M.prototype.sort=function(){this._i32idx={},this._pointArray.sort(function(F,N){var B=A.rgb2hsl(F.r,F.g,F.b),U=A.rgb2hsl(N.r,N.g,N.b),O=F.r===F.g&&F.g===F.b?0:1+P(B.h,k),V=N.r===N.g&&N.g===N.b?0:1+P(U.h,k),Z=V-O;if(Z)return-Z;var W=F.getLuminosity(!0),Y=N.getLuminosity(!0);if(Y-W!=0)return Y-W;var X=(U.s*100|0)-(B.s*100|0);return X?-X:0})},M}();h.Palette=D},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 */var T=I(24),A=function(){function k(){this._width=0,this._height=0,this._pointArray=[]}return k.prototype.getWidth=function(){return this._width},k.prototype.getHeight=function(){return this._height},k.prototype.setWidth=function(P){this._width=P},k.prototype.setHeight=function(P){this._height=P},k.prototype.getPointArray=function(){return this._pointArray},k.prototype.clone=function(){var P=new k;P._width=this._width,P._height=this._height;for(var D=0,M=this._pointArray.length;D<M;D++)P._pointArray[D]=T.Point.createByUint32(this._pointArray[D].uint32|0);return P},k.prototype.toUint32Array=function(){for(var P=this._pointArray.length,D=new Uint32Array(P),M=0;M<P;M++)D[M]=this._pointArray[M].uint32;return D},k.prototype.toUint8Array=function(){return new Uint8Array(this.toUint32Array().buffer)},k.fromHTMLImageElement=function(P){var D=P.naturalWidth,M=P.naturalHeight,F=document.createElement("canvas");F.width=D,F.height=M;var N=F.getContext("2d");return N.drawImage(P,0,0,D,M,0,0,D,M),k.fromHTMLCanvasElement(F)},k.fromHTMLCanvasElement=function(P){var D=P.width,M=P.height,F=P.getContext("2d"),N=F.getImageData(0,0,D,M);return k.fromImageData(N)},k.fromNodeCanvas=function(P){return k.fromHTMLCanvasElement(P)},k.fromImageData=function(P){var D=P.width,M=P.height;return k.fromCanvasPixelArray(P.data,D,M)},k.fromArray=function(P,D,M){var F=new Uint8Array(P);return k.fromUint8Array(F,D,M)},k.fromCanvasPixelArray=function(P,D,M){return k.fromArray(P,D,M)},k.fromUint8Array=function(P,D,M){return k.fromUint32Array(new Uint32Array(P.buffer),D,M)},k.fromUint32Array=function(P,D,M){var F=new k;F._width=D,F._height=M;for(var N=0,B=P.length;N<B;N++)F._pointArray[N]=T.Point.createByUint32(P[N]|0);return F},k}();h.PointContainer=A},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 */var T=I(2),A=function(){function k(){this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}return k.createByQuadruplet=function(P){var D=new k;return D.r=P[0]|0,D.g=P[1]|0,D.b=P[2]|0,D.a=P[3]|0,D._loadUINT32(),D._loadQuadruplet(),D},k.createByRGBA=function(P,D,M,F){var N=new k;return N.r=P|0,N.g=D|0,N.b=M|0,N.a=F|0,N._loadUINT32(),N._loadQuadruplet(),N},k.createByUint32=function(P){var D=new k;return D.uint32=P>>>0,D._loadRGBA(),D._loadQuadruplet(),D},k.prototype.from=function(P){this.r=P.r,this.g=P.g,this.b=P.b,this.a=P.a,this.uint32=P.uint32,this.rgba[0]=P.r,this.rgba[1]=P.g,this.rgba[2]=P.b,this.rgba[3]=P.a},k.prototype.getLuminosity=function(P){var D=this.r,M=this.g,F=this.b;return P&&(D=Math.min(255,255-this.a+this.a*D/255),M=Math.min(255,255-this.a+this.a*M/255),F=Math.min(255,255-this.a+this.a*F/255)),D*T.Y.RED+M*T.Y.GREEN+F*T.Y.BLUE},k.prototype._loadUINT32=function(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0},k.prototype._loadRGBA=function(){this.r=this.uint32&255,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255},k.prototype._loadQuadruplet=function(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a},k}();h.Point=A},function(S,h,I){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 */var T=I(22),A=I(24),k=3,P=function(){function M(F){this.r=this.g=this.b=this.a=F}return M.prototype.toPoint=function(){return A.Point.createByRGBA(this.r>>k,this.g>>k,this.b>>k,this.a>>k)},M.prototype.subtract=function(F,N,B,U){this.r-=F,this.g-=N,this.b-=B,this.a-=U},M}(),D=function(){function M(F,N){N===void 0&&(N=256),this._distance=F,this._pointArray=[],this._sampleFactor=1,this._networkSize=N,this._distance.setWhitePoint(255<<k,255<<k,255<<k,255<<k)}return M.prototype.sample=function(F){this._pointArray=this._pointArray.concat(F.getPointArray())},M.prototype.quantize=function(){return this._init(),this._learn(),this._buildPalette()},M.prototype._init=function(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(var F=0;F<this._networkSize;F++)this._network[F]=new P((F<<k+8)/this._networkSize),this._freq[F]=M._initialBias/this._networkSize,this._bias[F]=0},M.prototype._learn=function(){var F=this._sampleFactor,N=this._pointArray.length;N<M._minpicturebytes&&(F=1);var B=30+(F-1)/3,U=N/F,O=U/M._nCycles|0,V=M._initAlpha,Z=(this._networkSize>>3)*M._radiusBias,W=Z>>M._radiusBiasShift;W<=1&&(W=0);for(var Y=0;Y<W;Y++)this._radPower[Y]=V*((W*W-Y*Y)*M._radBias/(W*W));var X;N<M._minpicturebytes?X=1:N%M._prime1!=0?X=M._prime1:N%M._prime2!=0?X=M._prime2:N%M._prime3!=0?X=M._prime3:X=M._prime4;for(var Y=0,J=0;Y<U;){var q=this._pointArray[J],te=q.b<<k,ne=q.g<<k,de=q.r<<k,oe=q.a<<k,we=this._contest(te,ne,de,oe);if(this._alterSingle(V,we,te,ne,de,oe),W!=0&&this._alterNeighbour(W,we,te,ne,de,oe),J+=X,J>=N&&(J-=N),Y++,O==0&&(O=1),Y%O==0){V-=V/B,Z-=Z/M._radiusDecrease,W=Z>>M._radiusBiasShift,W<=1&&(W=0);for(var Ae=0;Ae<W;Ae++)this._radPower[Ae]=V*((W*W-Ae*Ae)*M._radBias/(W*W))}}},M.prototype._buildPalette=function(){var F=new T.Palette;return this._network.forEach(function(N){F.add(N.toPoint())}),F.sort(),F},M.prototype._alterNeighbour=function(F,N,B,U,O,V){var Z=N-F;Z<-1&&(Z=-1);var W=N+F;W>this._networkSize&&(W=this._networkSize);for(var Y=N+1,X=N-1,J=1;Y<W||X>Z;){var q=this._radPower[J++]/M._alphaRadBias;if(Y<W){var te=this._network[Y++];te.subtract(q*(te.r-O),q*(te.g-U),q*(te.b-B),q*(te.a-V))}if(X>Z){var te=this._network[X--];te.subtract(q*(te.r-O),q*(te.g-U),q*(te.b-B),q*(te.a-V))}}},M.prototype._alterSingle=function(F,N,B,U,O,V){F/=M._initAlpha;var Z=this._network[N];Z.subtract(F*(Z.r-O),F*(Z.g-U),F*(Z.b-B),F*(Z.a-V))},M.prototype._contest=function(F,N,B,U){for(var O=255*4<<k,V=~(1<<31),Z=V,W=-1,Y=W,X=0;X<this._networkSize;X++){var J=this._network[X],q=this._distance.calculateNormalized(J,{r:B,g:N,b:F,a:U})*O;q<V&&(V=q,W=X);var te=q-(this._bias[X]>>M._initialBiasShift-k);te<Z&&(Z=te,Y=X);var ne=this._freq[X]>>M._betaShift;this._freq[X]-=ne,this._bias[X]+=ne<<M._gammaShift}return this._freq[W]+=M._beta,this._bias[W]-=M._betaGamma,Y},M._prime1=499,M._prime2=491,M._prime3=487,M._prime4=503,M._minpicturebytes=M._prime4,M._nCycles=100,M._initialBiasShift=16,M._initialBias=1<<M._initialBiasShift,M._gammaShift=10,M._betaShift=10,M._beta=M._initialBias>>M._betaShift,M._betaGamma=M._initialBias<<M._gammaShift-M._betaShift,M._radiusBiasShift=6,M._radiusBias=1<<M._radiusBiasShift,M._radiusDecrease=30,M._alphaBiasShift=10,M._initAlpha=1<<M._alphaBiasShift,M._radBiasShift=8,M._radBias=1<<M._radBiasShift,M._alphaRadBiasShift=M._alphaBiasShift+M._radBiasShift,M._alphaRadBias=1<<M._alphaRadBiasShift,M}();h.NeuQuantFloat=D},function(S,h,I){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */var T=I(22),A=I(24),k=I(27),P=I(6),D=function(){function F(N,B,U){this.index=N,this.color=B,this.distance=U}return F}(),M=function(){function F(N,B,U){B===void 0&&(B=256),U===void 0&&(U=2),this._distance=N,this._colors=B,this._histogram=new k.ColorHistogram(U,B),this._initialDistance=.01,this._distanceIncrement=.005}return F.prototype.sample=function(N){this._histogram.sample(N)},F.prototype.quantize=function(){var N=this._histogram.getImportanceSortedColorsIDXI32();if(N.length===0)throw new Error("No colors in image");var B=this._buildPalette(N);return B.sort(),B},F.prototype._buildPalette=function(N){for(var B=new T.Palette,U=B.getPointContainer().getPointArray(),O=new Array(N.length),V=0;V<N.length;V++)U.push(A.Point.createByUint32(N[V])),O[V]=1;for(var Z=U.length,W=[],Y=Z,X=this._initialDistance;Y>this._colors;){W.length=0;for(var V=0;V<Z;V++)if(O[V]!==0){for(var J=U[V],q=V+1;q<Z;q++)if(O[q]!==0){var te=U[q],ne=this._distance.calculateNormalized(J,te);ne<X&&(W.push(new D(q,te,ne)),O[q]=0,Y--)}}X+=Y>this._colors*3?this._initialDistance:this._distanceIncrement}if(Y<this._colors){P.stableSort(W,function(ye,me){return me.distance-ye.distance});for(var de=0;Y<this._colors&&de<W.length;){var oe=W[de];O[oe.index]=1,Y++,de++}}for(var we=U.length,Ae=we-1;Ae>=0;Ae--)O[Ae]===0&&(Ae!==we-1&&(U[Ae]=U[we-1]),--we);return U.length=we,B},F}();h.RGBQuant=M},function(S,h,I){/**
 * @preserve TypeScript port:
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 */var T=I(28),A=I(6),k=function(){function P(D,M){this._method=D,this._minHueCols=M<<2,this._initColors=M<<2,this._hueStats=new T.HueStatistics(P._hueGroups,this._minHueCols),this._histogram=Object.create(null)}return P.prototype.sample=function(D){switch(this._method){case 1:this._colorStats1D(D);break;case 2:this._colorStats2D(D);break}},P.prototype.getImportanceSortedColorsIDXI32=function(){var D=this,M=A.stableSort(Object.keys(this._histogram),function(Z,W){return D._histogram[W]-D._histogram[Z]});if(M.length===0)return[];var F;switch(this._method){case 1:var N=Math.min(M.length,this._initColors),B=M[N-1],U=this._histogram[B];F=M.slice(0,N);for(var O=N,V=M.length;O<V&&this._histogram[M[O]]==U;)F.push(M[O++]);this._hueStats.injectIntoArray(F);break;case 2:F=M;break;default:throw new Error("Incorrect method")}return F.map(function(Z){return+Z})},P.prototype._colorStats1D=function(D){for(var M=this._histogram,F=D.getPointArray(),N=F.length,B=0;B<N;B++){var U=F[B].uint32;this._hueStats.check(U),U in M?M[U]++:M[U]=1}},P.prototype._colorStats2D=function(D){var M=this,F=D.getWidth(),N=D.getHeight(),B=D.getPointArray(),U=P._boxSize[0],O=P._boxSize[1],V=U*O,Z=this._makeBoxes(F,N,U,O),W=this._histogram;Z.forEach(function(Y){var X=Math.round(Y.w*Y.h/V)*P._boxPixels;X<2&&(X=2);var J={};M._iterateBox(Y,F,function(q){var te=B[q].uint32;M._hueStats.check(te),te in W?W[te]++:te in J?++J[te]>=X&&(W[te]=J[te]):J[te]=1})}),this._hueStats.injectIntoDictionary(W)},P.prototype._iterateBox=function(D,M,F){var N=D,B=N.y*M+N.x,U=(N.y+N.h-1)*M+(N.x+N.w-1),O=M-N.w+1,V=0,Z=B;do F.call(this,Z),Z+=++V%N.w==0?O:1;while(Z<=U)},P.prototype._makeBoxes=function(D,M,F,N){for(var B=D%F,U=M%N,O=D-B,V=M-U,Z=[],W=0;W<M;W+=N)for(var Y=0;Y<D;Y+=F)Z.push({x:Y,y:W,w:Y==O?B:F,h:W==V?U:N});return Z},P._boxSize=[64,64],P._boxPixels=2,P._hueGroups=10,P}();h.ColorHistogram=k},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 */var T=I(5),A=I(22),k=function(){function D(){this.num=0,this.cols=[]}return D}(),P=function(){function D(M,F){this._numGroups=M,this._minCols=F,this._stats=[];for(var N=0;N<=M;N++)this._stats[N]=new k;this._groupsFull=0}return D.prototype.check=function(M){this._groupsFull==this._numGroups+1&&(this.check=function(){});var F=M&255,N=M>>>8&255,B=M>>>16&255,U=F==N&&N==B?0:1+A.hueGroup(T.rgb2hsl(F,N,B).h,this._numGroups),O=this._stats[U],V=this._minCols;O.num++,!(O.num>V)&&(O.num==V&&this._groupsFull++,O.num<=V&&this._stats[U].cols.push(M))},D.prototype.injectIntoDictionary=function(M){for(var F=0;F<=this._numGroups;F++)this._stats[F].num<=this._minCols&&this._stats[F].cols.forEach(function(N){M[N]?M[N]++:M[N]=1})},D.prototype.injectIntoArray=function(M){for(var F=0;F<=this._numGroups;F++)this._stats[F].num<=this._minCols&&this._stats[F].cols.forEach(function(N){M.indexOf(N)==-1&&M.push(N)})},D}();h.HueStatistics=P},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 */var T=I(22),A=I(24);function k(U){for(var O=[],V=0;V<U;V++)O[V]=0;return O}function P(U,O,V,Z){for(var W=new Array(U),Y=0;Y<U;Y++){W[Y]=new Array(O);for(var X=0;X<O;X++){W[Y][X]=new Array(V);for(var J=0;J<V;J++){W[Y][X][J]=new Array(Z);for(var q=0;q<Z;q++)W[Y][X][J][q]=0}}}return W}function D(U,O,V){for(var Z=new Array(U),W=0;W<U;W++){Z[W]=new Array(O);for(var Y=0;Y<O;Y++){Z[W][Y]=new Array(V);for(var X=0;X<V;X++)Z[W][Y][X]=0}}return Z}function M(U,O,V,Z,W){for(var Y=0;Y<O;Y++){U[Y]=[];for(var X=0;X<V;X++){U[Y][X]=[];for(var J=0;J<Z;J++)U[Y][X][J]=W}}}function F(U,O,V){for(var Z=0;Z<O;Z++)U[Z]=V}var N=function(){function U(){}return U}();h.WuColorCube=N;var B=function(){function U(O,V,Z){V===void 0&&(V=256),Z===void 0&&(Z=5),this._distance=O,this._setQuality(Z),this._initialize(V)}return U.prototype.sample=function(O){for(var V=O.getPointArray(),Z=0,W=V.length;Z<W;Z++)this._addColor(V[Z]);this._pixels=this._pixels.concat(V)},U.prototype.quantize=function(){this._preparePalette();for(var O=new T.Palette,V=0;V<this._colors;V++)if(this._sums[V]>0){var Z=this._sums[V],W=this._reds[V]/Z,Y=this._greens[V]/Z,X=this._blues[V]/Z,J=this._alphas[V]/Z,q=A.Point.createByRGBA(W|0,Y|0,X|0,J|0);O.add(q)}return O.sort(),O},U.prototype._preparePalette=function(){this._calculateMoments();for(var O=0,V=k(this._colors),Z=1;Z<this._colors;++Z){this._cut(this._cubes[O],this._cubes[Z])?(V[O]=this._cubes[O].volume>1?this._calculateVariance(this._cubes[O]):0,V[Z]=this._cubes[Z].volume>1?this._calculateVariance(this._cubes[Z]):0):(V[O]=0,Z--),O=0;for(var W=V[0],Y=1;Y<=Z;++Y)V[Y]>W&&(W=V[Y],O=Y);if(W<=0){this._colors=Z+1;break}}for(var X=[],J=[],q=[],te=[],ne=0;ne<this._colors;++ne){var de=U._volume(this._cubes[ne],this._weights);de>0?(X[ne]=U._volume(this._cubes[ne],this._momentsRed)/de|0,J[ne]=U._volume(this._cubes[ne],this._momentsGreen)/de|0,q[ne]=U._volume(this._cubes[ne],this._momentsBlue)/de|0,te[ne]=U._volume(this._cubes[ne],this._momentsAlpha)/de|0):(X[ne]=0,J[ne]=0,q[ne]=0,te[ne]=0)}this._reds=k(this._colors+1),this._greens=k(this._colors+1),this._blues=k(this._colors+1),this._alphas=k(this._colors+1),this._sums=k(this._colors+1);for(var Y=0,oe=this._pixels.length;Y<oe;Y++){for(var we=this._pixels[Y],Ae=-1,ye=Ae,me=Number.MAX_VALUE,xe=0;xe<this._colors;xe++){var Le=X[xe],Ze=J[xe],Xe=q[xe],je=te[xe],Ie=this._distance.calculateRaw(Le,Ze,Xe,je,we.r,we.g,we.b,we.a);Ie<me&&(me=Ie,ye=xe)}this._reds[ye]+=we.r,this._greens[ye]+=we.g,this._blues[ye]+=we.b,this._alphas[ye]+=we.a,this._sums[ye]++}},U.prototype._addColor=function(O){var V=8-this._significantBitsPerChannel,Z=(O.r>>V)+1,W=(O.g>>V)+1,Y=(O.b>>V)+1,X=(O.a>>V)+1;this._weights[X][Z][W][Y]++,this._momentsRed[X][Z][W][Y]+=O.r,this._momentsGreen[X][Z][W][Y]+=O.g,this._momentsBlue[X][Z][W][Y]+=O.b,this._momentsAlpha[X][Z][W][Y]+=O.a,this._moments[X][Z][W][Y]+=this._table[O.r]+this._table[O.g]+this._table[O.b]+this._table[O.a]},U.prototype._calculateMoments=function(){for(var O=[],V=[],Z=[],W=[],Y=[],X=[],J=D(this._sideSize,this._sideSize,this._sideSize),q=D(this._sideSize,this._sideSize,this._sideSize),te=D(this._sideSize,this._sideSize,this._sideSize),ne=D(this._sideSize,this._sideSize,this._sideSize),de=D(this._sideSize,this._sideSize,this._sideSize),oe=D(this._sideSize,this._sideSize,this._sideSize),we=1;we<=this._alphaMaxSideIndex;++we){M(J,this._sideSize,this._sideSize,this._sideSize,0),M(q,this._sideSize,this._sideSize,this._sideSize,0),M(te,this._sideSize,this._sideSize,this._sideSize,0),M(ne,this._sideSize,this._sideSize,this._sideSize,0),M(de,this._sideSize,this._sideSize,this._sideSize,0),M(oe,this._sideSize,this._sideSize,this._sideSize,0);for(var Ae=1;Ae<=this._maxSideIndex;++Ae){F(O,this._sideSize,0),F(V,this._sideSize,0),F(Z,this._sideSize,0),F(W,this._sideSize,0),F(Y,this._sideSize,0),F(X,this._sideSize,0);for(var ye=1;ye<=this._maxSideIndex;++ye)for(var me=0,xe=0,Le=0,Ze=0,Xe=0,je=0,Ie=1;Ie<=this._maxSideIndex;++Ie)me+=this._weights[we][Ae][ye][Ie],xe+=this._momentsRed[we][Ae][ye][Ie],Le+=this._momentsGreen[we][Ae][ye][Ie],Ze+=this._momentsBlue[we][Ae][ye][Ie],Xe+=this._momentsAlpha[we][Ae][ye][Ie],je+=this._moments[we][Ae][ye][Ie],O[Ie]+=me,V[Ie]+=xe,Z[Ie]+=Le,W[Ie]+=Ze,Y[Ie]+=Xe,X[Ie]+=je,J[Ae][ye][Ie]=J[Ae-1][ye][Ie]+O[Ie],q[Ae][ye][Ie]=q[Ae-1][ye][Ie]+V[Ie],te[Ae][ye][Ie]=te[Ae-1][ye][Ie]+Z[Ie],ne[Ae][ye][Ie]=ne[Ae-1][ye][Ie]+W[Ie],de[Ae][ye][Ie]=de[Ae-1][ye][Ie]+Y[Ie],oe[Ae][ye][Ie]=oe[Ae-1][ye][Ie]+X[Ie],this._weights[we][Ae][ye][Ie]=this._weights[we-1][Ae][ye][Ie]+J[Ae][ye][Ie],this._momentsRed[we][Ae][ye][Ie]=this._momentsRed[we-1][Ae][ye][Ie]+q[Ae][ye][Ie],this._momentsGreen[we][Ae][ye][Ie]=this._momentsGreen[we-1][Ae][ye][Ie]+te[Ae][ye][Ie],this._momentsBlue[we][Ae][ye][Ie]=this._momentsBlue[we-1][Ae][ye][Ie]+ne[Ae][ye][Ie],this._momentsAlpha[we][Ae][ye][Ie]=this._momentsAlpha[we-1][Ae][ye][Ie]+de[Ae][ye][Ie],this._moments[we][Ae][ye][Ie]=this._moments[we-1][Ae][ye][Ie]+oe[Ae][ye][Ie]}}},U._volumeFloat=function(O,V){return V[O.alphaMaximum][O.redMaximum][O.greenMaximum][O.blueMaximum]-V[O.alphaMaximum][O.redMaximum][O.greenMinimum][O.blueMaximum]-V[O.alphaMaximum][O.redMinimum][O.greenMaximum][O.blueMaximum]+V[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMaximum]-V[O.alphaMinimum][O.redMaximum][O.greenMaximum][O.blueMaximum]+V[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMaximum]+V[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMaximum]-V[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMaximum]-(V[O.alphaMaximum][O.redMaximum][O.greenMaximum][O.blueMinimum]-V[O.alphaMinimum][O.redMaximum][O.greenMaximum][O.blueMinimum]-V[O.alphaMaximum][O.redMaximum][O.greenMinimum][O.blueMinimum]+V[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMinimum]-V[O.alphaMaximum][O.redMinimum][O.greenMaximum][O.blueMinimum]+V[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMinimum]+V[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMinimum]-V[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMinimum])},U._volume=function(O,V){return U._volumeFloat(O,V)|0},U._top=function(O,V,Z,W){var Y;switch(V){case U.alpha:Y=W[Z][O.redMaximum][O.greenMaximum][O.blueMaximum]-W[Z][O.redMaximum][O.greenMinimum][O.blueMaximum]-W[Z][O.redMinimum][O.greenMaximum][O.blueMaximum]+W[Z][O.redMinimum][O.greenMinimum][O.blueMaximum]-(W[Z][O.redMaximum][O.greenMaximum][O.blueMinimum]-W[Z][O.redMaximum][O.greenMinimum][O.blueMinimum]-W[Z][O.redMinimum][O.greenMaximum][O.blueMinimum]+W[Z][O.redMinimum][O.greenMinimum][O.blueMinimum]);break;case U.red:Y=W[O.alphaMaximum][Z][O.greenMaximum][O.blueMaximum]-W[O.alphaMaximum][Z][O.greenMinimum][O.blueMaximum]-W[O.alphaMinimum][Z][O.greenMaximum][O.blueMaximum]+W[O.alphaMinimum][Z][O.greenMinimum][O.blueMaximum]-(W[O.alphaMaximum][Z][O.greenMaximum][O.blueMinimum]-W[O.alphaMaximum][Z][O.greenMinimum][O.blueMinimum]-W[O.alphaMinimum][Z][O.greenMaximum][O.blueMinimum]+W[O.alphaMinimum][Z][O.greenMinimum][O.blueMinimum]);break;case U.green:Y=W[O.alphaMaximum][O.redMaximum][Z][O.blueMaximum]-W[O.alphaMaximum][O.redMinimum][Z][O.blueMaximum]-W[O.alphaMinimum][O.redMaximum][Z][O.blueMaximum]+W[O.alphaMinimum][O.redMinimum][Z][O.blueMaximum]-(W[O.alphaMaximum][O.redMaximum][Z][O.blueMinimum]-W[O.alphaMaximum][O.redMinimum][Z][O.blueMinimum]-W[O.alphaMinimum][O.redMaximum][Z][O.blueMinimum]+W[O.alphaMinimum][O.redMinimum][Z][O.blueMinimum]);break;case U.blue:Y=W[O.alphaMaximum][O.redMaximum][O.greenMaximum][Z]-W[O.alphaMaximum][O.redMaximum][O.greenMinimum][Z]-W[O.alphaMaximum][O.redMinimum][O.greenMaximum][Z]+W[O.alphaMaximum][O.redMinimum][O.greenMinimum][Z]-(W[O.alphaMinimum][O.redMaximum][O.greenMaximum][Z]-W[O.alphaMinimum][O.redMaximum][O.greenMinimum][Z]-W[O.alphaMinimum][O.redMinimum][O.greenMaximum][Z]+W[O.alphaMinimum][O.redMinimum][O.greenMinimum][Z]);break;default:throw new Error("impossible")}return Y|0},U._bottom=function(O,V,Z){switch(V){case U.alpha:return-Z[O.alphaMinimum][O.redMaximum][O.greenMaximum][O.blueMaximum]+Z[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMaximum]+Z[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMaximum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMaximum]-(-Z[O.alphaMinimum][O.redMaximum][O.greenMaximum][O.blueMinimum]+Z[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMinimum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMinimum]);case U.red:return-Z[O.alphaMaximum][O.redMinimum][O.greenMaximum][O.blueMaximum]+Z[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMaximum]+Z[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMaximum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMaximum]-(-Z[O.alphaMaximum][O.redMinimum][O.greenMaximum][O.blueMinimum]+Z[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMinimum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMinimum]);case U.green:return-Z[O.alphaMaximum][O.redMaximum][O.greenMinimum][O.blueMaximum]+Z[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMaximum]+Z[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMaximum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMaximum]-(-Z[O.alphaMaximum][O.redMaximum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMinimum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMinimum]);case U.blue:return-Z[O.alphaMaximum][O.redMaximum][O.greenMaximum][O.blueMinimum]+Z[O.alphaMaximum][O.redMaximum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMaximum][O.redMinimum][O.greenMaximum][O.blueMinimum]-Z[O.alphaMaximum][O.redMinimum][O.greenMinimum][O.blueMinimum]-(-Z[O.alphaMinimum][O.redMaximum][O.greenMaximum][O.blueMinimum]+Z[O.alphaMinimum][O.redMaximum][O.greenMinimum][O.blueMinimum]+Z[O.alphaMinimum][O.redMinimum][O.greenMaximum][O.blueMinimum]-Z[O.alphaMinimum][O.redMinimum][O.greenMinimum][O.blueMinimum]);default:return 0}},U.prototype._calculateVariance=function(O){var V=U._volume(O,this._momentsRed),Z=U._volume(O,this._momentsGreen),W=U._volume(O,this._momentsBlue),Y=U._volume(O,this._momentsAlpha),X=U._volumeFloat(O,this._moments),J=U._volume(O,this._weights),q=V*V+Z*Z+W*W+Y*Y;return X-q/J},U.prototype._maximize=function(O,V,Z,W,Y,X,J,q,te){for(var ne=U._bottom(O,V,this._momentsRed)|0,de=U._bottom(O,V,this._momentsGreen)|0,oe=U._bottom(O,V,this._momentsBlue)|0,we=U._bottom(O,V,this._momentsAlpha)|0,Ae=U._bottom(O,V,this._weights)|0,ye=0,me=-1,xe=Z;xe<W;++xe){var Le=ne+U._top(O,V,xe,this._momentsRed),Ze=de+U._top(O,V,xe,this._momentsGreen),Xe=oe+U._top(O,V,xe,this._momentsBlue),je=we+U._top(O,V,xe,this._momentsAlpha),Ie=Ae+U._top(O,V,xe,this._weights);if(Ie!=0){var Pe=Le*Le+Ze*Ze+Xe*Xe+je*je,De=Pe/Ie;Le=Y-Le,Ze=X-Ze,Xe=J-Xe,je=q-je,Ie=te-Ie,Ie!=0&&(Pe=Le*Le+Ze*Ze+Xe*Xe+je*je,De+=Pe/Ie,De>ye&&(ye=De,me=xe))}}return{max:ye,position:me}},U.prototype._cut=function(O,V){var Z,W=U._volume(O,this._momentsRed),Y=U._volume(O,this._momentsGreen),X=U._volume(O,this._momentsBlue),J=U._volume(O,this._momentsAlpha),q=U._volume(O,this._weights),te=this._maximize(O,U.red,O.redMinimum+1,O.redMaximum,W,Y,X,J,q),ne=this._maximize(O,U.green,O.greenMinimum+1,O.greenMaximum,W,Y,X,J,q),de=this._maximize(O,U.blue,O.blueMinimum+1,O.blueMaximum,W,Y,X,J,q),oe=this._maximize(O,U.alpha,O.alphaMinimum+1,O.alphaMaximum,W,Y,X,J,q);if(oe.max>=te.max&&oe.max>=ne.max&&oe.max>=de.max){if(Z=U.alpha,oe.position<0)return!1}else te.max>=oe.max&&te.max>=ne.max&&te.max>=de.max?Z=U.red:ne.max>=oe.max&&ne.max>=te.max&&ne.max>=de.max?Z=U.green:Z=U.blue;switch(V.redMaximum=O.redMaximum,V.greenMaximum=O.greenMaximum,V.blueMaximum=O.blueMaximum,V.alphaMaximum=O.alphaMaximum,Z){case U.red:V.redMinimum=O.redMaximum=te.position,V.greenMinimum=O.greenMinimum,V.blueMinimum=O.blueMinimum,V.alphaMinimum=O.alphaMinimum;break;case U.green:V.greenMinimum=O.greenMaximum=ne.position,V.redMinimum=O.redMinimum,V.blueMinimum=O.blueMinimum,V.alphaMinimum=O.alphaMinimum;break;case U.blue:V.blueMinimum=O.blueMaximum=de.position,V.redMinimum=O.redMinimum,V.greenMinimum=O.greenMinimum,V.alphaMinimum=O.alphaMinimum;break;case U.alpha:V.alphaMinimum=O.alphaMaximum=oe.position,V.blueMinimum=O.blueMinimum,V.redMinimum=O.redMinimum,V.greenMinimum=O.greenMinimum;break}return O.volume=(O.redMaximum-O.redMinimum)*(O.greenMaximum-O.greenMinimum)*(O.blueMaximum-O.blueMinimum)*(O.alphaMaximum-O.alphaMinimum),V.volume=(V.redMaximum-V.redMinimum)*(V.greenMaximum-V.greenMinimum)*(V.blueMaximum-V.blueMinimum)*(V.alphaMaximum-V.alphaMinimum),!0},U.prototype._initialize=function(O){this._colors=O,this._cubes=[];for(var V=0;V<O;V++)this._cubes[V]=new N;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=P(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(var Z=0;Z<256;++Z)this._table[Z]=Z*Z;this._pixels=[]},U.prototype._setQuality=function(O){O===void 0&&(O=5),this._significantBitsPerChannel=O,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1},U.alpha=3,U.red=2,U.green=1,U.blue=0,U}();h.WuQuant=B},function(S,h,I){var T=I(31);h.NearestColor=T.NearestColor;var A=I(32);h.ErrorDiffusionArray=A.ErrorDiffusionArray,h.ErrorDiffusionArrayKernel=A.ErrorDiffusionArrayKernel;var k=I(33);h.ErrorDiffusionRiemersma=k.ErrorDiffusionRiemersma},function(S,h){var I=function(){function T(A){this._distance=A}return T.prototype.quantize=function(A,k){for(var P=A.getPointArray(),D=A.getWidth(),M=A.getHeight(),F=0;F<M;F++)for(var N=0,B=F*D;N<D;N++,B++){var U=P[B];U.from(k.getNearestColor(this._distance,U))}return A},T}();h.NearestColor=I},function(S,h,I){var T=I(24),A=I(6);(function(D){D[D.FloydSteinberg=0]="FloydSteinberg",D[D.FalseFloydSteinberg=1]="FalseFloydSteinberg",D[D.Stucki=2]="Stucki",D[D.Atkinson=3]="Atkinson",D[D.Jarvis=4]="Jarvis",D[D.Burkes=5]="Burkes",D[D.Sierra=6]="Sierra",D[D.TwoSierra=7]="TwoSierra",D[D.SierraLite=8]="SierraLite"})(h.ErrorDiffusionArrayKernel||(h.ErrorDiffusionArrayKernel={}));var k=h.ErrorDiffusionArrayKernel,P=function(){function D(M,F,N,B,U){N===void 0&&(N=!0),B===void 0&&(B=0),U===void 0&&(U=!1),this._setKernel(F),this._distance=M,this._minColorDistance=B,this._serpentine=N,this._calculateErrorLikeGIMP=U}return D.prototype.quantize=function(M,F){for(var N=M.getPointArray(),B=new T.Point,U=M.getWidth(),O=M.getHeight(),V=[],Z=1,W=1,Y=0;Y<this._kernel.length;Y++){var X=this._kernel[Y][2]+1;W<X&&(W=X)}for(var Y=0;Y<W;Y++)this._fillErrorLine(V[Y]=[],U);for(var J=0;J<O;J++){this._serpentine&&(Z=Z*-1);var q=J*U,te=Z==1?0:U-1,ne=Z==1?U:-1;this._fillErrorLine(V[0],U),V.push(V.shift());for(var de=V[0],oe=te,we=q+te;oe!==ne;oe+=Z,we+=Z){var Ae=N[we],ye=de[oe];B.from(Ae);var me=T.Point.createByRGBA(A.inRange0to255Rounded(Ae.r+ye[0]),A.inRange0to255Rounded(Ae.g+ye[1]),A.inRange0to255Rounded(Ae.b+ye[2]),A.inRange0to255Rounded(Ae.a+ye[3])),xe=F.getNearestColor(this._distance,me);if(Ae.from(xe),this._minColorDistance){var Le=this._distance.calculateNormalized(Ae,xe);if(Le<this._minColorDistance)continue}var Ze=void 0,Xe=void 0,je=void 0,Ie=void 0;this._calculateErrorLikeGIMP?(Ze=me.r-xe.r,Xe=me.g-xe.g,je=me.b-xe.b,Ie=me.a-xe.a):(Ze=B.r-xe.r,Xe=B.g-xe.g,je=B.b-xe.b,Ie=B.a-xe.a);for(var Pe=Z==1?0:this._kernel.length-1,De=Z==1?this._kernel.length:-1,Y=Pe;Y!==De;Y+=Z){var ze=this._kernel[Y][1]*Z,it=this._kernel[Y][2];if(ze+oe>=0&&ze+oe<U&&it+J>=0&&it+J<O){var tt=this._kernel[Y][0],ot=V[it][ze+oe];ot[0]=ot[0]+Ze*tt,ot[1]=ot[1]+Xe*tt,ot[2]=ot[2]+je*tt,ot[3]=ot[3]+Ie*tt}}}}return M},D.prototype._fillErrorLine=function(M,F){M.length>F&&(M.length=F);for(var N=M.length,B=0;B<N;B++){var U=M[B];U[0]=U[1]=U[2]=U[3]=0}for(var B=N;B<F;B++)M[B]=[0,0,0,0]},D.prototype._setKernel=function(M){switch(M){case k.FloydSteinberg:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case k.FalseFloydSteinberg:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case k.Stucki:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case k.Atkinson:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case k.Jarvis:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case k.Burkes:this._kernel=[[8/32,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[8/32,0,1],[4/32,1,1],[2/32,2,1]];break;case k.Sierra:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case k.TwoSierra:this._kernel=[[4/16,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case k.SierraLite:this._kernel=[[2/4,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error("ErrorDiffusionArray: unknown kernel = "+M)}},D}();h.ErrorDiffusionArray=P},function(S,h,I){var T=I(34),A=I(24),k=I(6),P=function(){function D(M,F,N){F===void 0&&(F=16),N===void 0&&(N=1),this._distance=M,this._errorPropagation=N,this._errorQueueSize=F,this._max=this._errorQueueSize,this._createWeights()}return D.prototype.quantize=function(M,F){for(var N=this,B=new T.HilbertCurveBase,U=M.getPointArray(),O=M.getWidth(),V=M.getHeight(),Z=[],W=0,Y=0;Y<this._errorQueueSize;Y++)Z[Y]={r:0,g:0,b:0,a:0};return B.walk(O,V,function(X,J){for(var q=U[X+J*O],te=q.r,ne=q.g,de=q.b,oe=q.a,we=0;we<N._errorQueueSize;we++){var Ae=N._weights[we],ye=Z[(we+W)%N._errorQueueSize];te+=ye.r*Ae,ne+=ye.g*Ae,de+=ye.b*Ae,oe+=ye.a*Ae}var me=A.Point.createByRGBA(k.inRange0to255Rounded(te),k.inRange0to255Rounded(ne),k.inRange0to255Rounded(de),k.inRange0to255Rounded(oe)),xe=F.getNearestColor(N._distance,me);W=(W+1)%N._errorQueueSize;var Le=(W+N._errorQueueSize-1)%N._errorQueueSize;Z[Le].r=q.r-xe.r,Z[Le].g=q.g-xe.g,Z[Le].b=q.b-xe.b,Z[Le].a=q.a-xe.a,q.from(xe)}),M},D.prototype._createWeights=function(){this._weights=[];for(var M=Math.exp(Math.log(this._max)/(this._errorQueueSize-1)),F=0,N=1;F<this._errorQueueSize;F++)this._weights[F]=(N+.5|0)/this._max*this._errorPropagation,N*=M},D}();h.ErrorDiffusionRiemersma=P},function(S,h){var I;(function(A){A[A.NONE=0]="NONE",A[A.UP=1]="UP",A[A.LEFT=2]="LEFT",A[A.RIGHT=3]="RIGHT",A[A.DOWN=4]="DOWN"})(I||(I={}));var T=function(){function A(){}return A.prototype.walk=function(k,P,D){this._x=0,this._y=0,this._d=0,this._width=k,this._height=P,this._callback=D;var M=Math.max(k,P);this._level=Math.log(M)/Math.log(2)+1|0,this._walkHilbert(I.UP),this._visit(I.NONE)},A.prototype._walkHilbert=function(k){if(!(this._level<1)){switch(this._level--,k){case I.LEFT:this._walkHilbert(I.UP),this._visit(I.RIGHT),this._walkHilbert(I.LEFT),this._visit(I.DOWN),this._walkHilbert(I.LEFT),this._visit(I.LEFT),this._walkHilbert(I.DOWN);break;case I.RIGHT:this._walkHilbert(I.DOWN),this._visit(I.LEFT),this._walkHilbert(I.RIGHT),this._visit(I.UP),this._walkHilbert(I.RIGHT),this._visit(I.RIGHT),this._walkHilbert(I.UP);break;case I.UP:this._walkHilbert(I.LEFT),this._visit(I.DOWN),this._walkHilbert(I.UP),this._visit(I.RIGHT),this._walkHilbert(I.UP),this._visit(I.UP),this._walkHilbert(I.RIGHT);break;case I.DOWN:this._walkHilbert(I.RIGHT),this._visit(I.UP),this._walkHilbert(I.DOWN),this._visit(I.LEFT),this._walkHilbert(I.DOWN),this._visit(I.DOWN),this._walkHilbert(I.LEFT);break}this._level++}},A.prototype._visit=function(k){switch(this._x>=0&&this._x<this._width&&this._y>=0&&this._y<this._height&&(this._callback(this._x,this._y,this._d),this._d++),k){case I.LEFT:this._x--;break;case I.RIGHT:this._x++;break;case I.UP:this._y--;break;case I.DOWN:this._y++;break}},A}();h.HilbertCurveBase=T},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var T=I(36);h.SSIM=T.SSIM},function(S,h,I){var T=I(2),A=.01,k=.03,P=function(){function D(){}return D.prototype.compare=function(M,F){if(M.getHeight()!==F.getHeight()||M.getWidth()!==F.getWidth())throw new Error("Images have different sizes!");var N=8,B=(1<<N)-1,U=Math.pow(A*B,2),O=Math.pow(k*B,2),V=0,Z=0;return this._iterate(M,F,function(W,Y,X,J){for(var q=0,te=0,ne=0,de=0;de<W.length;de++)te+=Math.pow(W[de]-X,2),ne+=Math.pow(Y[de]-J,2),q+=(W[de]-X)*(Y[de]-J);var oe=W.length-1;te/=oe,ne/=oe,q/=oe;var we=(2*X*J+U)*(2*q+O),Ae=(Math.pow(X,2)+Math.pow(J,2)+U)*(te+ne+O),ye=we/Ae;Z+=ye,V++}),Z/V},D.prototype._iterate=function(M,F,N){for(var B=8,U=M.getWidth(),O=M.getHeight(),V=0;V<O;V+=B)for(var Z=0;Z<U;Z+=B){var W=Math.min(B,U-Z),Y=Math.min(B,O-V),X=this._calculateLumaValuesForWindow(M,Z,V,W,Y),J=this._calculateLumaValuesForWindow(F,Z,V,W,Y),q=this._calculateAverageLuma(X),te=this._calculateAverageLuma(J);N(X,J,q,te)}},D.prototype._calculateLumaValuesForWindow=function(M,F,N,B,U){for(var O=M.getPointArray(),V=[],Z=0,W=N;W<N+U;W++)for(var Y=W*M.getWidth(),X=F;X<F+B;X++){var J=O[Y+X];V[Z]=J.r*T.Y.RED+J.g*T.Y.GREEN+J.b*T.Y.BLUE,Z++}return V},D.prototype._calculateAverageLuma=function(M){for(var F=0,N=0;N<M.length;N++)F+=M[N];return F/M.length},D}();h.SSIM=P},function(S,h,I){/**
 * @preserve
 * Copyright 2015-2016 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */var T=I(6);h.arithmetic=T;var A=I(28);h.HueStatistics=A.HueStatistics;var k=I(22);h.Palette=k.Palette;var P=I(24);h.Point=P.Point;var D=I(23);h.PointContainer=D.PointContainer}])})},{}],75:[function(m,x,E){typeof Object.create=="function"?x.exports=function(h,I){I&&(h.super_=I,h.prototype=Object.create(I.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:x.exports=function(h,I){if(I){h.super_=I;var T=function(){};T.prototype=I.prototype,h.prototype=new T,h.prototype.constructor=h}}},{}],76:[function(m,x,E){/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */x.exports=function(I){return I!=null&&(S(I)||h(I)||!!I._isBuffer)};function S(I){return!!I.constructor&&typeof I.constructor.isBuffer=="function"&&I.constructor.isBuffer(I)}function h(I){return typeof I.readFloatLE=="function"&&typeof I.slice=="function"&&S(I.slice(0,0))}},{}],77:[function(m,x,E){var S=Function.prototype.toString,h=/^\s*class\b/,I=function(F){try{var N=S.call(F);return h.test(N)}catch{return!1}},T=function(F){try{return I(F)?!1:(S.call(F),!0)}catch{return!1}},A=Object.prototype.toString,k="[object Function]",P="[object GeneratorFunction]",D=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol";x.exports=function(F){if(!F||typeof F!="function"&&typeof F!="object")return!1;if(typeof F=="function"&&!F.prototype)return!0;if(D)return T(F);if(I(F))return!1;var N=A.call(F);return N===k||N===P}},{}],78:[function(m,x,E){x.exports=h;var S=Object.prototype.toString;function h(I){var T=S.call(I);return T==="[object Function]"||typeof I=="function"&&T!=="[object RegExp]"||typeof g!="undefined"&&(I===g.setTimeout||I===g.alert||I===g.confirm||I===g.prompt)}},{}],79:[function(m,x,E){var S={}.toString;x.exports=Array.isArray||function(h){return S.call(h)=="[object Array]"}},{}],80:[function(m,x,E){var S=m("./lib/encoder"),h=m("./lib/decoder");x.exports={encode:S,decode:h}},{"./lib/decoder":81,"./lib/encoder":82}],81:[function(m,x,E){(function(S){var h=function(){var A=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),k=4017,P=799,D=3406,M=2276,F=1567,N=3784,B=5793,U=2896;function O(){}function V(te,ne){for(var de=0,oe=[],we,Ae,ye=16;ye>0&&!te[ye-1];)ye--;oe.push({children:[],index:0});var me=oe[0],xe;for(we=0;we<ye;we++){for(Ae=0;Ae<te[we];Ae++){for(me=oe.pop(),me.children[me.index]=ne[de];me.index>0;){if(oe.length===0)throw new Error("Could not recreate Huffman Table");me=oe.pop()}for(me.index++,oe.push(me);oe.length<=we;)oe.push(xe={children:[],index:0}),me.children[me.index]=xe.children,me=xe;de++}we+1<ye&&(oe.push(xe={children:[],index:0}),me.children[me.index]=xe.children,me=xe)}return oe[0].children}function Z(te,ne,de,oe,we,Ae,ye,me,xe,Le){de.precision,de.samplesPerLine,de.scanLines;var Ze=de.mcusPerLine,Xe=de.progressive;de.maxH,de.maxV;var je=ne,Ie=0,Pe=0;function De(){if(Pe>0)return Pe--,Ie>>Pe&1;if(Ie=te[ne++],Ie==255){var zt=te[ne++];if(zt)throw new Error("unexpected marker: "+(Ie<<8|zt).toString(16))}return Pe=7,Ie>>>7}function ze(zt){for(var qt=zt,Vt;(Vt=De())!==null;){if(qt=qt[Vt],typeof qt=="number")return qt;if(typeof qt!="object")throw new Error("invalid huffman sequence")}return null}function it(zt){for(var qt=0;zt>0;){var Vt=De();if(Vt===null)return;qt=qt<<1|Vt,zt--}return qt}function tt(zt){var qt=it(zt);return qt>=1<<zt-1?qt:qt+(-1<<zt)+1}function ot(zt,qt){var Vt=ze(zt.huffmanTableDC),fi=Vt===0?0:tt(Vt);qt[0]=zt.pred+=fi;for(var hi=1;hi<64;){var Me=ze(zt.huffmanTableAC),bt=Me&15,At=Me>>4;if(bt===0){if(At<15)break;hi+=16;continue}hi+=At;var Bt=A[hi];qt[Bt]=tt(bt),hi++}}function lt(zt,qt){var Vt=ze(zt.huffmanTableDC),fi=Vt===0?0:tt(Vt)<<xe;qt[0]=zt.pred+=fi}function St(zt,qt){qt[0]|=De()<<xe}var et=0;function Je(zt,qt){if(et>0){et--;return}for(var Vt=Ae,fi=ye;Vt<=fi;){var hi=ze(zt.huffmanTableAC),Me=hi&15,bt=hi>>4;if(Me===0){if(bt<15){et=it(bt)+(1<<bt)-1;break}Vt+=16;continue}Vt+=bt;var At=A[Vt];qt[At]=tt(Me)*(1<<xe),Vt++}}var Be=0,Ge;function He(zt,qt){for(var Vt=Ae,fi=ye,hi=0;Vt<=fi;){var Me=A[Vt],bt=qt[Me]<0?-1:1;switch(Be){case 0:var At=ze(zt.huffmanTableAC),Bt=At&15,hi=At>>4;if(Bt===0)hi<15?(et=it(hi)+(1<<hi),Be=4):(hi=16,Be=1);else{if(Bt!==1)throw new Error("invalid ACn encoding");Ge=tt(Bt),Be=hi?2:3}continue;case 1:case 2:qt[Me]?qt[Me]+=(De()<<xe)*bt:(hi--,hi===0&&(Be=Be==2?3:0));break;case 3:qt[Me]?qt[Me]+=(De()<<xe)*bt:(qt[Me]=Ge<<xe,Be=0);break;case 4:qt[Me]&&(qt[Me]+=(De()<<xe)*bt);break}Vt++}Be===4&&(et--,et===0&&(Be=0))}function ve(zt,qt,Vt,fi,hi){var Me=Vt/Ze|0,bt=Vt%Ze,At=Me*zt.v+fi,Bt=bt*zt.h+hi;zt.blocks[At]===void 0&&Le.tolerantDecoding||qt(zt,zt.blocks[At][Bt])}function _e(zt,qt,Vt){var fi=Vt/zt.blocksPerLine|0,hi=Vt%zt.blocksPerLine;zt.blocks[fi]===void 0&&Le.tolerantDecoding||qt(zt,zt.blocks[fi][hi])}var pe=oe.length,fe,ue,ce,Ee,Ye,ft;Xe?Ae===0?ft=me===0?lt:St:ft=me===0?Je:He:ft=ot;var _t=0,It,$t;pe==1?$t=oe[0].blocksPerLine*oe[0].blocksPerColumn:$t=Ze*de.mcusPerColumn,we||(we=$t);for(var Yt,ii;_t<$t;){for(ue=0;ue<pe;ue++)oe[ue].pred=0;if(et=0,pe==1)for(fe=oe[0],Ye=0;Ye<we;Ye++)_e(fe,ft,_t),_t++;else for(Ye=0;Ye<we;Ye++){for(ue=0;ue<pe;ue++)for(fe=oe[ue],Yt=fe.h,ii=fe.v,ce=0;ce<ii;ce++)for(Ee=0;Ee<Yt;Ee++)ve(fe,ft,_t,ce,Ee);if(_t++,_t===$t)break}if(_t===$t)do{if(te[ne]===255&&te[ne+1]!==0)break;ne+=1}while(ne<te.length-2);if(Pe=0,It=te[ne]<<8|te[ne+1],It<65280)throw new Error("marker was not found");if(It>=65488&&It<=65495)ne+=2;else break}return ne-je}function W(te,ne){var de=[],oe=ne.blocksPerLine,we=ne.blocksPerColumn,Ae=oe<<3,ye=new Int32Array(64),me=new Uint8Array(64);function xe(it,tt,ot){var lt=ne.quantizationTable,St,et,Je,Be,Ge,He,ve,_e,pe,fe=ot,ue;for(ue=0;ue<64;ue++)fe[ue]=it[ue]*lt[ue];for(ue=0;ue<8;++ue){var ce=8*ue;if(fe[1+ce]==0&&fe[2+ce]==0&&fe[3+ce]==0&&fe[4+ce]==0&&fe[5+ce]==0&&fe[6+ce]==0&&fe[7+ce]==0){pe=B*fe[0+ce]+512>>10,fe[0+ce]=pe,fe[1+ce]=pe,fe[2+ce]=pe,fe[3+ce]=pe,fe[4+ce]=pe,fe[5+ce]=pe,fe[6+ce]=pe,fe[7+ce]=pe;continue}St=B*fe[0+ce]+128>>8,et=B*fe[4+ce]+128>>8,Je=fe[2+ce],Be=fe[6+ce],Ge=U*(fe[1+ce]-fe[7+ce])+128>>8,_e=U*(fe[1+ce]+fe[7+ce])+128>>8,He=fe[3+ce]<<4,ve=fe[5+ce]<<4,pe=St-et+1>>1,St=St+et+1>>1,et=pe,pe=Je*N+Be*F+128>>8,Je=Je*F-Be*N+128>>8,Be=pe,pe=Ge-ve+1>>1,Ge=Ge+ve+1>>1,ve=pe,pe=_e+He+1>>1,He=_e-He+1>>1,_e=pe,pe=St-Be+1>>1,St=St+Be+1>>1,Be=pe,pe=et-Je+1>>1,et=et+Je+1>>1,Je=pe,pe=Ge*M+_e*D+2048>>12,Ge=Ge*D-_e*M+2048>>12,_e=pe,pe=He*P+ve*k+2048>>12,He=He*k-ve*P+2048>>12,ve=pe,fe[0+ce]=St+_e,fe[7+ce]=St-_e,fe[1+ce]=et+ve,fe[6+ce]=et-ve,fe[2+ce]=Je+He,fe[5+ce]=Je-He,fe[3+ce]=Be+Ge,fe[4+ce]=Be-Ge}for(ue=0;ue<8;++ue){var Ee=ue;if(fe[1*8+Ee]==0&&fe[2*8+Ee]==0&&fe[3*8+Ee]==0&&fe[4*8+Ee]==0&&fe[5*8+Ee]==0&&fe[6*8+Ee]==0&&fe[7*8+Ee]==0){pe=B*ot[ue+0]+8192>>14,fe[0*8+Ee]=pe,fe[1*8+Ee]=pe,fe[2*8+Ee]=pe,fe[3*8+Ee]=pe,fe[4*8+Ee]=pe,fe[5*8+Ee]=pe,fe[6*8+Ee]=pe,fe[7*8+Ee]=pe;continue}St=B*fe[0*8+Ee]+2048>>12,et=B*fe[4*8+Ee]+2048>>12,Je=fe[2*8+Ee],Be=fe[6*8+Ee],Ge=U*(fe[1*8+Ee]-fe[7*8+Ee])+2048>>12,_e=U*(fe[1*8+Ee]+fe[7*8+Ee])+2048>>12,He=fe[3*8+Ee],ve=fe[5*8+Ee],pe=St-et+1>>1,St=St+et+1>>1,et=pe,pe=Je*N+Be*F+2048>>12,Je=Je*F-Be*N+2048>>12,Be=pe,pe=Ge-ve+1>>1,Ge=Ge+ve+1>>1,ve=pe,pe=_e+He+1>>1,He=_e-He+1>>1,_e=pe,pe=St-Be+1>>1,St=St+Be+1>>1,Be=pe,pe=et-Je+1>>1,et=et+Je+1>>1,Je=pe,pe=Ge*M+_e*D+2048>>12,Ge=Ge*D-_e*M+2048>>12,_e=pe,pe=He*P+ve*k+2048>>12,He=He*k-ve*P+2048>>12,ve=pe,fe[0*8+Ee]=St+_e,fe[7*8+Ee]=St-_e,fe[1*8+Ee]=et+ve,fe[6*8+Ee]=et-ve,fe[2*8+Ee]=Je+He,fe[5*8+Ee]=Je-He,fe[3*8+Ee]=Be+Ge,fe[4*8+Ee]=Be-Ge}for(ue=0;ue<64;++ue){var Ye=128+(fe[ue]+8>>4);tt[ue]=Ye<0?0:Ye>255?255:Ye}}q(Ae*we*8);for(var Le,Ze,Xe=0;Xe<we;Xe++){var je=Xe<<3;for(Le=0;Le<8;Le++)de.push(new Uint8Array(Ae));for(var Ie=0;Ie<oe;Ie++){xe(ne.blocks[Xe][Ie],me,ye);var Pe=0,De=Ie<<3;for(Ze=0;Ze<8;Ze++){var ze=de[je+Ze];for(Le=0;Le<8;Le++)ze[De+Le]=me[Pe++]}}}return de}function Y(te){return te<0?0:te>255?255:te}O.prototype={load:function(ne){var de=new XMLHttpRequest;de.open("GET",ne,!0),de.responseType="arraybuffer",de.onload=function(){var oe=new Uint8Array(de.response||de.mozResponseArrayBuffer);this.parse(oe),this.onload&&this.onload()}.bind(this),de.send(null)},parse:function(ne){var de=this.opts.maxResolutionInMP*1e3*1e3,oe=0;ne.length;function we(){var Me=ne[oe]<<8|ne[oe+1];return oe+=2,Me}function Ae(){var Me=we(),bt=ne.subarray(oe,oe+Me-2);return oe+=bt.length,bt}function ye(Me){var bt=0,At=0,Bt,pt;for(pt in Me.components)Me.components.hasOwnProperty(pt)&&(Bt=Me.components[pt],bt<Bt.h&&(bt=Bt.h),At<Bt.v&&(At=Bt.v));var Rt=Math.ceil(Me.samplesPerLine/8/bt),Ve=Math.ceil(Me.scanLines/8/At);for(pt in Me.components)if(Me.components.hasOwnProperty(pt)){Bt=Me.components[pt];var jt=Math.ceil(Math.ceil(Me.samplesPerLine/8)*Bt.h/bt),mi=Math.ceil(Math.ceil(Me.scanLines/8)*Bt.v/At),ie=Rt*Bt.h,ke=Ve*Bt.v,Ke=ke*ie,re=[];q(Ke*256);for(var le=0;le<ke;le++){for(var Se=[],Ne=0;Ne<ie;Ne++)Se.push(new Int32Array(64));re.push(Se)}Bt.blocksPerLine=jt,Bt.blocksPerColumn=mi,Bt.blocks=re}Me.maxH=bt,Me.maxV=At,Me.mcusPerLine=Rt,Me.mcusPerColumn=Ve}var me=null,xe=null,Le,Ze,Xe=[],je=[],Ie=[],Pe=[],De=we();if(this.comments=[],De!=65496)throw new Error("SOI not found");for(De=we();De!=65497;){var ze,it;switch(De){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var tt=Ae();if(De===65534){var ot=String.fromCharCode.apply(null,tt);this.comments.push(ot)}De===65504&&tt[0]===74&&tt[1]===70&&tt[2]===73&&tt[3]===70&&tt[4]===0&&(me={version:{major:tt[5],minor:tt[6]},densityUnits:tt[7],xDensity:tt[8]<<8|tt[9],yDensity:tt[10]<<8|tt[11],thumbWidth:tt[12],thumbHeight:tt[13],thumbData:tt.subarray(14,14+3*tt[12]*tt[13])}),De===65505&&tt[0]===69&&tt[1]===120&&tt[2]===105&&tt[3]===102&&tt[4]===0&&(this.exifBuffer=tt.subarray(5,tt.length)),De===65518&&tt[0]===65&&tt[1]===100&&tt[2]===111&&tt[3]===98&&tt[4]===101&&tt[5]===0&&(xe={version:tt[6],flags0:tt[7]<<8|tt[8],flags1:tt[9]<<8|tt[10],transformCode:tt[11]});break;case 65499:for(var lt=we(),St=lt+oe-2;oe<St;){var et=ne[oe++];q(64*4);var Je=new Int32Array(64);if(et>>4==0)for(it=0;it<64;it++){var Be=A[it];Je[Be]=ne[oe++]}else if(et>>4==1)for(it=0;it<64;it++){var Be=A[it];Je[Be]=we()}else throw new Error("DQT: invalid table spec");Xe[et&15]=Je}break;case 65472:case 65473:case 65474:we(),Le={},Le.extended=De===65473,Le.progressive=De===65474,Le.precision=ne[oe++],Le.scanLines=we(),Le.samplesPerLine=we(),Le.components={},Le.componentsOrder=[];var Ge=Le.scanLines*Le.samplesPerLine;if(Ge>de){var He=Math.ceil((Ge-de)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${He}MP`)}var ve=ne[oe++],_e;for(ze=0;ze<ve;ze++){_e=ne[oe];var pe=ne[oe+1]>>4,fe=ne[oe+1]&15,ue=ne[oe+2];Le.componentsOrder.push(_e),Le.components[_e]={h:pe,v:fe,quantizationIdx:ue},oe+=3}ye(Le),je.push(Le);break;case 65476:var ce=we();for(ze=2;ze<ce;){var Ee=ne[oe++],Ye=new Uint8Array(16),ft=0;for(it=0;it<16;it++,oe++)ft+=Ye[it]=ne[oe];q(16+ft);var _t=new Uint8Array(ft);for(it=0;it<ft;it++,oe++)_t[it]=ne[oe];ze+=17+ft,(Ee>>4==0?Pe:Ie)[Ee&15]=V(Ye,_t)}break;case 65501:we(),Ze=we();break;case 65500:we(),we();break;case 65498:we();var It=ne[oe++],$t=[],Yt;for(ze=0;ze<It;ze++){Yt=Le.components[ne[oe++]];var ii=ne[oe++];Yt.huffmanTableDC=Pe[ii>>4],Yt.huffmanTableAC=Ie[ii&15],$t.push(Yt)}var zt=ne[oe++],qt=ne[oe++],Vt=ne[oe++],fi=Z(ne,oe,Le,$t,Ze,zt,qt,Vt>>4,Vt&15,this.opts);oe+=fi;break;case 65535:ne[oe]!==255&&oe--;break;default:if(ne[oe-3]==255&&ne[oe-2]>=192&&ne[oe-2]<=254){oe-=3;break}throw new Error("unknown JPEG marker "+De.toString(16))}De=we()}if(je.length!=1)throw new Error("only single frame JPEGs supported");for(var ze=0;ze<je.length;ze++){var hi=je[ze].components;for(var it in hi)hi[it].quantizationTable=Xe[hi[it].quantizationIdx],delete hi[it].quantizationIdx}this.width=Le.samplesPerLine,this.height=Le.scanLines,this.jfif=me,this.adobe=xe,this.components=[];for(var ze=0;ze<Le.componentsOrder.length;ze++){var Yt=Le.components[Le.componentsOrder[ze]];this.components.push({lines:W(Le,Yt),scaleX:Yt.h/Le.maxH,scaleY:Yt.v/Le.maxV})}},getData:function(ne,de){var oe=this.width/ne,we=this.height/de,Ae,ye,me,xe,Le,Ze,Xe,je,Ie,Pe,De=0,ze,it,tt,ot,lt,St,et,Je,Be,Ge,He,ve=ne*de*this.components.length;q(ve);var _e=new Uint8Array(ve);switch(this.components.length){case 1:for(Ae=this.components[0],Pe=0;Pe<de;Pe++)for(Le=Ae.lines[0|Pe*Ae.scaleY*we],Ie=0;Ie<ne;Ie++)ze=Le[0|Ie*Ae.scaleX*oe],_e[De++]=ze;break;case 2:for(Ae=this.components[0],ye=this.components[1],Pe=0;Pe<de;Pe++)for(Le=Ae.lines[0|Pe*Ae.scaleY*we],Ze=ye.lines[0|Pe*ye.scaleY*we],Ie=0;Ie<ne;Ie++)ze=Le[0|Ie*Ae.scaleX*oe],_e[De++]=ze,ze=Ze[0|Ie*ye.scaleX*oe],_e[De++]=ze;break;case 3:for(He=!0,this.adobe&&this.adobe.transformCode?He=!0:typeof this.opts.colorTransform!="undefined"&&(He=!!this.opts.colorTransform),Ae=this.components[0],ye=this.components[1],me=this.components[2],Pe=0;Pe<de;Pe++)for(Le=Ae.lines[0|Pe*Ae.scaleY*we],Ze=ye.lines[0|Pe*ye.scaleY*we],Xe=me.lines[0|Pe*me.scaleY*we],Ie=0;Ie<ne;Ie++)He?(ze=Le[0|Ie*Ae.scaleX*oe],it=Ze[0|Ie*ye.scaleX*oe],tt=Xe[0|Ie*me.scaleX*oe],Je=Y(ze+1.402*(tt-128)),Be=Y(ze-.3441363*(it-128)-.71413636*(tt-128)),Ge=Y(ze+1.772*(it-128))):(Je=Le[0|Ie*Ae.scaleX*oe],Be=Ze[0|Ie*ye.scaleX*oe],Ge=Xe[0|Ie*me.scaleX*oe]),_e[De++]=Je,_e[De++]=Be,_e[De++]=Ge;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(He=!1,this.adobe&&this.adobe.transformCode?He=!0:typeof this.opts.colorTransform!="undefined"&&(He=!!this.opts.colorTransform),Ae=this.components[0],ye=this.components[1],me=this.components[2],xe=this.components[3],Pe=0;Pe<de;Pe++)for(Le=Ae.lines[0|Pe*Ae.scaleY*we],Ze=ye.lines[0|Pe*ye.scaleY*we],Xe=me.lines[0|Pe*me.scaleY*we],je=xe.lines[0|Pe*xe.scaleY*we],Ie=0;Ie<ne;Ie++)He?(ze=Le[0|Ie*Ae.scaleX*oe],it=Ze[0|Ie*ye.scaleX*oe],tt=Xe[0|Ie*me.scaleX*oe],ot=je[0|Ie*xe.scaleX*oe],lt=255-Y(ze+1.402*(tt-128)),St=255-Y(ze-.3441363*(it-128)-.71413636*(tt-128)),et=255-Y(ze+1.772*(it-128))):(lt=Le[0|Ie*Ae.scaleX*oe],St=Ze[0|Ie*ye.scaleX*oe],et=Xe[0|Ie*me.scaleX*oe],ot=je[0|Ie*xe.scaleX*oe]),_e[De++]=255-lt,_e[De++]=255-St,_e[De++]=255-et,_e[De++]=255-ot;break;default:throw new Error("Unsupported color mode")}return _e},copyToImageData:function(ne,de){var oe=ne.width,we=ne.height,Ae=ne.data,ye=this.getData(oe,we),me=0,xe=0,Le,Ze,Xe,je,Ie,Pe,De,ze,it;switch(this.components.length){case 1:for(Ze=0;Ze<we;Ze++)for(Le=0;Le<oe;Le++)Xe=ye[me++],Ae[xe++]=Xe,Ae[xe++]=Xe,Ae[xe++]=Xe,de&&(Ae[xe++]=255);break;case 3:for(Ze=0;Ze<we;Ze++)for(Le=0;Le<oe;Le++)De=ye[me++],ze=ye[me++],it=ye[me++],Ae[xe++]=De,Ae[xe++]=ze,Ae[xe++]=it,de&&(Ae[xe++]=255);break;case 4:for(Ze=0;Ze<we;Ze++)for(Le=0;Le<oe;Le++)Ie=ye[me++],Pe=ye[me++],Xe=ye[me++],je=ye[me++],De=255-Y(Ie*(1-je/255)+je),ze=255-Y(Pe*(1-je/255)+je),it=255-Y(Xe*(1-je/255)+je),Ae[xe++]=De,Ae[xe++]=ze,Ae[xe++]=it,de&&(Ae[xe++]=255);break;default:throw new Error("Unsupported color mode")}}};var X=0,J=0;function q(te=0){var ne=X+te;if(ne>J){var de=Math.ceil((ne-J)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${de}MB`)}X=ne}return O.resetMaxMemoryUsage=function(te){X=0,J=te},O.getBytesAllocated=function(){return X},O.requestMemoryAllocation=q,O}();typeof x!="undefined"?x.exports=I:typeof g!="undefined"&&(g["jpeg-js"]=g["jpeg-js"]||{},g["jpeg-js"].decode=I);function I(T,A={}){var k={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},P=ul(ul({},k),A),D=new Uint8Array(T),M=new h;M.opts=P,h.resetMaxMemoryUsage(P.maxMemoryUsageInMB*1024*1024),M.parse(D);var F=P.formatAsRGBA?4:3,N=M.width*M.height*F;try{h.requestMemoryAllocation(N);var B={width:M.width,height:M.height,exifBuffer:M.exifBuffer,data:P.useTArray?new Uint8Array(N):S.alloc(N)};M.comments.length>0&&(B.comments=M.comments)}catch(U){throw U instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+N):U}return M.copyToImageData(B,P.formatAsRGBA),B}}).call(this,m("buffer").Buffer)},{buffer:48}],82:[function(m,x,E){(function(S){function h(T){var A=Math.floor,k=new Array(64),P=new Array(64),D=new Array(64),M=new Array(64),F,N,B,U,O=new Array(65535),V=new Array(65535),Z=new Array(64),W=new Array(64),Y=[],X=0,J=7,q=new Array(64),te=new Array(64),ne=new Array(64),de=new Array(256),oe=new Array(2048),we,Ae=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ye=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],me=[0,1,2,3,4,5,6,7,8,9,10,11],xe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Le=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Ze=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Xe=[0,1,2,3,4,5,6,7,8,9,10,11],je=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ie=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Pe(Ee){for(var Ye=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ft=0;ft<64;ft++){var _t=A((Ye[ft]*Ee+50)/100);_t<1?_t=1:_t>255&&(_t=255),k[Ae[ft]]=_t}for(var It=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],$t=0;$t<64;$t++){var Yt=A((It[$t]*Ee+50)/100);Yt<1?Yt=1:Yt>255&&(Yt=255),P[Ae[$t]]=Yt}for(var ii=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],zt=0,qt=0;qt<8;qt++)for(var Vt=0;Vt<8;Vt++)D[zt]=1/(k[Ae[zt]]*ii[qt]*ii[Vt]*8),M[zt]=1/(P[Ae[zt]]*ii[qt]*ii[Vt]*8),zt++}function De(Ee,Ye){for(var ft=0,_t=0,It=new Array,$t=1;$t<=16;$t++){for(var Yt=1;Yt<=Ee[$t];Yt++)It[Ye[_t]]=[],It[Ye[_t]][0]=ft,It[Ye[_t]][1]=$t,_t++,ft++;ft*=2}return It}function ze(){F=De(ye,me),N=De(Ze,Xe),B=De(xe,Le),U=De(je,Ie)}function it(){for(var Ee=1,Ye=2,ft=1;ft<=15;ft++){for(var _t=Ee;_t<Ye;_t++)V[32767+_t]=ft,O[32767+_t]=[],O[32767+_t][1]=ft,O[32767+_t][0]=_t;for(var It=-(Ye-1);It<=-Ee;It++)V[32767+It]=ft,O[32767+It]=[],O[32767+It][1]=ft,O[32767+It][0]=Ye-1+It;Ee<<=1,Ye<<=1}}function tt(){for(var Ee=0;Ee<256;Ee++)oe[Ee]=19595*Ee,oe[Ee+256>>0]=38470*Ee,oe[Ee+512>>0]=7471*Ee+32768,oe[Ee+768>>0]=-11059*Ee,oe[Ee+1024>>0]=-21709*Ee,oe[Ee+1280>>0]=32768*Ee+8421375,oe[Ee+1536>>0]=-27439*Ee,oe[Ee+1792>>0]=-5329*Ee}function ot(Ee){for(var Ye=Ee[0],ft=Ee[1]-1;ft>=0;)Ye&1<<ft&&(X|=1<<J),ft--,J--,J<0&&(X==255?(lt(255),lt(0)):lt(X),J=7,X=0)}function lt(Ee){Y.push(Ee)}function St(Ee){lt(Ee>>8&255),lt(Ee&255)}function et(Ee,Ye){var ft,_t,It,$t,Yt,ii,zt,qt,Vt=0,fi,hi=8,Me=64;for(fi=0;fi<hi;++fi){ft=Ee[Vt],_t=Ee[Vt+1],It=Ee[Vt+2],$t=Ee[Vt+3],Yt=Ee[Vt+4],ii=Ee[Vt+5],zt=Ee[Vt+6],qt=Ee[Vt+7];var bt=ft+qt,At=ft-qt,Bt=_t+zt,pt=_t-zt,Rt=It+ii,Ve=It-ii,jt=$t+Yt,mi=$t-Yt,ie=bt+jt,ke=bt-jt,Ke=Bt+Rt,re=Bt-Rt;Ee[Vt]=ie+Ke,Ee[Vt+4]=ie-Ke;var le=(re+ke)*.707106781;Ee[Vt+2]=ke+le,Ee[Vt+6]=ke-le,ie=mi+Ve,Ke=Ve+pt,re=pt+At;var Se=(ie-re)*.382683433,Ne=.5411961*ie+Se,We=1.306562965*re+Se,nt=Ke*.707106781,vt=At+nt,Dt=At-nt;Ee[Vt+5]=Dt+Ne,Ee[Vt+3]=Dt-Ne,Ee[Vt+1]=vt+We,Ee[Vt+7]=vt-We,Vt+=8}for(Vt=0,fi=0;fi<hi;++fi){ft=Ee[Vt],_t=Ee[Vt+8],It=Ee[Vt+16],$t=Ee[Vt+24],Yt=Ee[Vt+32],ii=Ee[Vt+40],zt=Ee[Vt+48],qt=Ee[Vt+56];var wt=ft+qt,Tt=ft-qt,Nt=_t+zt,ri=_t-zt,Ht=It+ii,_i=It-ii,ai=$t+Yt,Ct=$t-Yt,Ut=wt+ai,Mi=wt-ai,ki=Nt+Ht,Si=Nt-Ht;Ee[Vt]=Ut+ki,Ee[Vt+32]=Ut-ki;var Bi=(Si+Mi)*.707106781;Ee[Vt+16]=Mi+Bi,Ee[Vt+48]=Mi-Bi,Ut=Ct+_i,ki=_i+ri,Si=ri+Tt;var zi=(Ut-Si)*.382683433,un=.5411961*Ut+zi,Gr=1.306562965*Si+zi,gi=ki*.707106781,Fi=Tt+gi,Oi=Tt-gi;Ee[Vt+40]=Oi+un,Ee[Vt+24]=Oi-un,Ee[Vt+8]=Fi+Gr,Ee[Vt+56]=Fi-Gr,Vt++}var ar;for(fi=0;fi<Me;++fi)ar=Ee[fi]*Ye[fi],Z[fi]=ar>0?ar+.5|0:ar-.5|0;return Z}function Je(){St(65504),St(16),lt(74),lt(70),lt(73),lt(70),lt(0),lt(1),lt(1),lt(0),St(1),St(1),lt(0),lt(0)}function Be(Ee){if(!!Ee){St(65505),Ee[0]===69&&Ee[1]===120&&Ee[2]===105&&Ee[3]===102?St(Ee.length+2):(St(Ee.length+5+2),lt(69),lt(120),lt(105),lt(102),lt(0));for(var Ye=0;Ye<Ee.length;Ye++)lt(Ee[Ye])}}function Ge(Ee,Ye){St(65472),St(17),lt(8),St(Ye),St(Ee),lt(3),lt(1),lt(17),lt(0),lt(2),lt(17),lt(1),lt(3),lt(17),lt(1)}function He(){St(65499),St(132),lt(0);for(var Ee=0;Ee<64;Ee++)lt(k[Ee]);lt(1);for(var Ye=0;Ye<64;Ye++)lt(P[Ye])}function ve(){St(65476),St(418),lt(0);for(var Ee=0;Ee<16;Ee++)lt(ye[Ee+1]);for(var Ye=0;Ye<=11;Ye++)lt(me[Ye]);lt(16);for(var ft=0;ft<16;ft++)lt(xe[ft+1]);for(var _t=0;_t<=161;_t++)lt(Le[_t]);lt(1);for(var It=0;It<16;It++)lt(Ze[It+1]);for(var $t=0;$t<=11;$t++)lt(Xe[$t]);lt(17);for(var Yt=0;Yt<16;Yt++)lt(je[Yt+1]);for(var ii=0;ii<=161;ii++)lt(Ie[ii])}function _e(){St(65498),St(12),lt(3),lt(1),lt(0),lt(2),lt(17),lt(3),lt(17),lt(0),lt(63),lt(0)}function pe(Ee,Ye,ft,_t,It){for(var $t=It[0],Yt=It[240],ii,zt=16,qt=63,Vt=64,fi=et(Ee,Ye),hi=0;hi<Vt;++hi)W[Ae[hi]]=fi[hi];var Me=W[0]-ft;ft=W[0],Me==0?ot(_t[0]):(ii=32767+Me,ot(_t[V[ii]]),ot(O[ii]));for(var bt=63;bt>0&&W[bt]==0;bt--);if(bt==0)return ot($t),ft;for(var At=1,Bt;At<=bt;){for(var pt=At;W[At]==0&&At<=bt;++At);var Rt=At-pt;if(Rt>=zt){Bt=Rt>>4;for(var Ve=1;Ve<=Bt;++Ve)ot(Yt);Rt=Rt&15}ii=32767+W[At],ot(It[(Rt<<4)+V[ii]]),ot(O[ii]),At++}return bt!=qt&&ot($t),ft}function fe(){for(var Ee=String.fromCharCode,Ye=0;Ye<256;Ye++)de[Ye]=Ee(Ye)}this.encode=function(Ee,Ye){new Date().getTime(),Ye&&ue(Ye),Y=new Array,X=0,J=7,St(65496),Je(),Be(Ee.exifBuffer),He(),Ge(Ee.width,Ee.height),ve(),_e();var ft=0,_t=0,It=0;X=0,J=7,this.encode.displayName="_encode_";for(var $t=Ee.data,Yt=Ee.width,ii=Ee.height,zt=Yt*4,qt,Vt=0,fi,hi,Me,bt,At,Bt,pt,Rt;Vt<ii;){for(qt=0;qt<zt;){for(bt=zt*Vt+qt,At=bt,Bt=-1,pt=0,Rt=0;Rt<64;Rt++)pt=Rt>>3,Bt=(Rt&7)*4,At=bt+pt*zt+Bt,Vt+pt>=ii&&(At-=zt*(Vt+1+pt-ii)),qt+Bt>=zt&&(At-=qt+Bt-zt+4),fi=$t[At++],hi=$t[At++],Me=$t[At++],q[Rt]=(oe[fi]+oe[hi+256>>0]+oe[Me+512>>0]>>16)-128,te[Rt]=(oe[fi+768>>0]+oe[hi+1024>>0]+oe[Me+1280>>0]>>16)-128,ne[Rt]=(oe[fi+1280>>0]+oe[hi+1536>>0]+oe[Me+1792>>0]>>16)-128;ft=pe(q,D,ft,F,B),_t=pe(te,M,_t,N,U),It=pe(ne,M,It,N,U),qt+=32}Vt+=8}if(J>=0){var Ve=[];Ve[1]=J+1,Ve[0]=(1<<J+1)-1,ot(Ve)}return St(65497),typeof x=="undefined"?new Uint8Array(Y):S.from(Y)};function ue(Ee){if(Ee<=0&&(Ee=1),Ee>100&&(Ee=100),we!=Ee){var Ye=0;Ee<50?Ye=Math.floor(5e3/Ee):Ye=Math.floor(200-Ee*2),Pe(Ye),we=Ee}}function ce(){var Ee=new Date().getTime();T||(T=50),fe(),ze(),it(),tt(),ue(T),new Date().getTime()-Ee}ce()}typeof x!="undefined"?x.exports=I:typeof g!="undefined"&&(g["jpeg-js"]=g["jpeg-js"]||{},g["jpeg-js"].encode=I);function I(T,A){typeof A=="undefined"&&(A=50);var k=new h(A),P=k.encode(T,A);return{data:P,width:T.width,height:T.height}}}).call(this,m("buffer").Buffer)},{buffer:48}],83:[function(m,x,E){(function(S){var h=m("path"),I=m("fs"),T=parseInt("0777",8);x.exports=A.mkdirp=A.mkdirP=A;function A(k,P,D,M){typeof P=="function"?(D=P,P={}):(!P||typeof P!="object")&&(P={mode:P});var F=P.mode,N=P.fs||I;F===void 0&&(F=T&~S.umask()),M||(M=null);var B=D||function(){};k=h.resolve(k),N.mkdir(k,F,function(U){if(!U)return M=M||k,B(null,M);switch(U.code){case"ENOENT":A(h.dirname(k),P,function(O,V){O?B(O,V):A(k,P,B,V)});break;default:N.stat(k,function(O,V){O||!V.isDirectory()?B(U,M):B(null,M)});break}})}A.sync=function k(P,D,M){(!D||typeof D!="object")&&(D={mode:D});var F=D.mode,N=D.fs||I;F===void 0&&(F=T&~S.umask()),M||(M=null),P=h.resolve(P);try{N.mkdirSync(P,F),M=M||P}catch(U){switch(U.code){case"ENOENT":M=k(h.dirname(P),D,M),k(P,D,M);break;default:var B;try{B=N.statSync(P)}catch{throw U}if(!B.isDirectory())throw U;break}}return M}}).call(this,m("_process"))},{_process:133,fs:47,path:107}],84:[function(m,x,E){var S=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;function T(k){if(k==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(k)}function A(){try{if(!Object.assign)return!1;var k=new String("abc");if(k[5]="de",Object.getOwnPropertyNames(k)[0]==="5")return!1;for(var P={},D=0;D<10;D++)P["_"+String.fromCharCode(D)]=D;var M=Object.getOwnPropertyNames(P).map(function(N){return P[N]});if(M.join("")!=="0123456789")return!1;var F={};return"abcdefghijklmnopqrst".split("").forEach(function(N){F[N]=N}),Object.keys(Object.assign({},F)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}x.exports=A()?Object.assign:function(k,P){for(var D,M=T(k),F,N=1;N<arguments.length;N++){D=Object(arguments[N]);for(var B in D)h.call(D,B)&&(M[B]=D[B]);if(S){F=S(D);for(var U=0;U<F.length;U++)I.call(D,F[U])&&(M[F[U]]=D[F[U]])}}return M}},{}],85:[function(m,x,E){arguments[4][64][0].apply(E,arguments)},{dup:64}],86:[function(m,x,E){var S=m("./lib/utils/common").assign,h=m("./lib/deflate"),I=m("./lib/inflate"),T=m("./lib/zlib/constants"),A={};S(A,h,I,T),x.exports=A},{"./lib/deflate":87,"./lib/inflate":88,"./lib/utils/common":89,"./lib/zlib/constants":92}],87:[function(m,x,E){var S=m("./zlib/deflate"),h=m("./utils/common"),I=m("./utils/strings"),T=m("./zlib/messages"),A=m("./zlib/zstream"),k=Object.prototype.toString,P=0,D=4,M=0,F=1,N=2,B=-1,U=0,O=8;function V(X){if(!(this instanceof V))return new V(X);this.options=h.assign({level:B,method:O,chunkSize:16384,windowBits:15,memLevel:8,strategy:U,to:""},X||{});var J=this.options;J.raw&&J.windowBits>0?J.windowBits=-J.windowBits:J.gzip&&J.windowBits>0&&J.windowBits<16&&(J.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;var q=S.deflateInit2(this.strm,J.level,J.method,J.windowBits,J.memLevel,J.strategy);if(q!==M)throw new Error(T[q]);if(J.header&&S.deflateSetHeader(this.strm,J.header),J.dictionary){var te;if(typeof J.dictionary=="string"?te=I.string2buf(J.dictionary):k.call(J.dictionary)==="[object ArrayBuffer]"?te=new Uint8Array(J.dictionary):te=J.dictionary,q=S.deflateSetDictionary(this.strm,te),q!==M)throw new Error(T[q]);this._dict_set=!0}}V.prototype.push=function(X,J){var q=this.strm,te=this.options.chunkSize,ne,de;if(this.ended)return!1;de=J===~~J?J:J===!0?D:P,typeof X=="string"?q.input=I.string2buf(X):k.call(X)==="[object ArrayBuffer]"?q.input=new Uint8Array(X):q.input=X,q.next_in=0,q.avail_in=q.input.length;do{if(q.avail_out===0&&(q.output=new h.Buf8(te),q.next_out=0,q.avail_out=te),ne=S.deflate(q,de),ne!==F&&ne!==M)return this.onEnd(ne),this.ended=!0,!1;(q.avail_out===0||q.avail_in===0&&(de===D||de===N))&&(this.options.to==="string"?this.onData(I.buf2binstring(h.shrinkBuf(q.output,q.next_out))):this.onData(h.shrinkBuf(q.output,q.next_out)))}while((q.avail_in>0||q.avail_out===0)&&ne!==F);return de===D?(ne=S.deflateEnd(this.strm),this.onEnd(ne),this.ended=!0,ne===M):(de===N&&(this.onEnd(M),q.avail_out=0),!0)},V.prototype.onData=function(X){this.chunks.push(X)},V.prototype.onEnd=function(X){X===M&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=X,this.msg=this.strm.msg};function Z(X,J){var q=new V(J);if(q.push(X,!0),q.err)throw q.msg||T[q.err];return q.result}function W(X,J){return J=J||{},J.raw=!0,Z(X,J)}function Y(X,J){return J=J||{},J.gzip=!0,Z(X,J)}E.Deflate=V,E.deflate=Z,E.deflateRaw=W,E.gzip=Y},{"./utils/common":89,"./utils/strings":90,"./zlib/deflate":94,"./zlib/messages":99,"./zlib/zstream":101}],88:[function(m,x,E){var S=m("./zlib/inflate"),h=m("./utils/common"),I=m("./utils/strings"),T=m("./zlib/constants"),A=m("./zlib/messages"),k=m("./zlib/zstream"),P=m("./zlib/gzheader"),D=Object.prototype.toString;function M(B){if(!(this instanceof M))return new M(B);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},B||{});var U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,U.windowBits===0&&(U.windowBits=-15)),U.windowBits>=0&&U.windowBits<16&&!(B&&B.windowBits)&&(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&(U.windowBits&15)==0&&(U.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var O=S.inflateInit2(this.strm,U.windowBits);if(O!==T.Z_OK)throw new Error(A[O]);this.header=new P,S.inflateGetHeader(this.strm,this.header)}M.prototype.push=function(B,U){var O=this.strm,V=this.options.chunkSize,Z=this.options.dictionary,W,Y,X,J,q,te,ne=!1;if(this.ended)return!1;Y=U===~~U?U:U===!0?T.Z_FINISH:T.Z_NO_FLUSH,typeof B=="string"?O.input=I.binstring2buf(B):D.call(B)==="[object ArrayBuffer]"?O.input=new Uint8Array(B):O.input=B,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new h.Buf8(V),O.next_out=0,O.avail_out=V),W=S.inflate(O,T.Z_NO_FLUSH),W===T.Z_NEED_DICT&&Z&&(typeof Z=="string"?te=I.string2buf(Z):D.call(Z)==="[object ArrayBuffer]"?te=new Uint8Array(Z):te=Z,W=S.inflateSetDictionary(this.strm,te)),W===T.Z_BUF_ERROR&&ne===!0&&(W=T.Z_OK,ne=!1),W!==T.Z_STREAM_END&&W!==T.Z_OK)return this.onEnd(W),this.ended=!0,!1;O.next_out&&(O.avail_out===0||W===T.Z_STREAM_END||O.avail_in===0&&(Y===T.Z_FINISH||Y===T.Z_SYNC_FLUSH))&&(this.options.to==="string"?(X=I.utf8border(O.output,O.next_out),J=O.next_out-X,q=I.buf2string(O.output,X),O.next_out=J,O.avail_out=V-J,J&&h.arraySet(O.output,O.output,X,J,0),this.onData(q)):this.onData(h.shrinkBuf(O.output,O.next_out))),O.avail_in===0&&O.avail_out===0&&(ne=!0)}while((O.avail_in>0||O.avail_out===0)&&W!==T.Z_STREAM_END);return W===T.Z_STREAM_END&&(Y=T.Z_FINISH),Y===T.Z_FINISH?(W=S.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===T.Z_OK):(Y===T.Z_SYNC_FLUSH&&(this.onEnd(T.Z_OK),O.avail_out=0),!0)},M.prototype.onData=function(B){this.chunks.push(B)},M.prototype.onEnd=function(B){B===T.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.msg=this.strm.msg};function F(B,U){var O=new M(U);if(O.push(B,!0),O.err)throw O.msg||A[O.err];return O.result}function N(B,U){return U=U||{},U.raw=!0,F(B,U)}E.Inflate=M,E.inflate=F,E.inflateRaw=N,E.ungzip=F},{"./utils/common":89,"./utils/strings":90,"./zlib/constants":92,"./zlib/gzheader":95,"./zlib/inflate":97,"./zlib/messages":99,"./zlib/zstream":101}],89:[function(m,x,E){arguments[4][36][0].apply(E,arguments)},{dup:36}],90:[function(m,x,E){var S=m("./common"),h=!0,I=!0;try{String.fromCharCode.apply(null,[0])}catch{h=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I=!1}for(var T=new S.Buf8(256),A=0;A<256;A++)T[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;T[254]=T[254]=1,E.string2buf=function(P){var D,M,F,N,B,U=P.length,O=0;for(N=0;N<U;N++)M=P.charCodeAt(N),(M&64512)==55296&&N+1<U&&(F=P.charCodeAt(N+1),(F&64512)==56320&&(M=65536+(M-55296<<10)+(F-56320),N++)),O+=M<128?1:M<2048?2:M<65536?3:4;for(D=new S.Buf8(O),B=0,N=0;B<O;N++)M=P.charCodeAt(N),(M&64512)==55296&&N+1<U&&(F=P.charCodeAt(N+1),(F&64512)==56320&&(M=65536+(M-55296<<10)+(F-56320),N++)),M<128?D[B++]=M:M<2048?(D[B++]=192|M>>>6,D[B++]=128|M&63):M<65536?(D[B++]=224|M>>>12,D[B++]=128|M>>>6&63,D[B++]=128|M&63):(D[B++]=240|M>>>18,D[B++]=128|M>>>12&63,D[B++]=128|M>>>6&63,D[B++]=128|M&63);return D};function k(P,D){if(D<65537&&(P.subarray&&I||!P.subarray&&h))return String.fromCharCode.apply(null,S.shrinkBuf(P,D));for(var M="",F=0;F<D;F++)M+=String.fromCharCode(P[F]);return M}E.buf2binstring=function(P){return k(P,P.length)},E.binstring2buf=function(P){for(var D=new S.Buf8(P.length),M=0,F=D.length;M<F;M++)D[M]=P.charCodeAt(M);return D},E.buf2string=function(P,D){var M,F,N,B,U=D||P.length,O=new Array(U*2);for(F=0,M=0;M<U;){if(N=P[M++],N<128){O[F++]=N;continue}if(B=T[N],B>4){O[F++]=65533,M+=B-1;continue}for(N&=B===2?31:B===3?15:7;B>1&&M<U;)N=N<<6|P[M++]&63,B--;if(B>1){O[F++]=65533;continue}N<65536?O[F++]=N:(N-=65536,O[F++]=55296|N>>10&1023,O[F++]=56320|N&1023)}return k(O,F)},E.utf8border=function(P,D){var M;for(D=D||P.length,D>P.length&&(D=P.length),M=D-1;M>=0&&(P[M]&192)==128;)M--;return M<0||M===0?D:M+T[P[M]]>D?M:D}},{"./common":89}],91:[function(m,x,E){arguments[4][37][0].apply(E,arguments)},{dup:37}],92:[function(m,x,E){arguments[4][38][0].apply(E,arguments)},{dup:38}],93:[function(m,x,E){arguments[4][39][0].apply(E,arguments)},{dup:39}],94:[function(m,x,E){var S=m("../utils/common"),h=m("./trees"),I=m("./adler32"),T=m("./crc32"),A=m("./messages"),k=0,P=1,D=3,M=4,F=5,N=0,B=1,U=-2,O=-3,V=-5,Z=-1,W=1,Y=2,X=3,J=4,q=0,te=2,ne=8,de=9,oe=15,we=8,Ae=29,ye=256,me=ye+1+Ae,xe=30,Le=19,Ze=2*me+1,Xe=15,je=3,Ie=258,Pe=Ie+je+1,De=32,ze=42,it=69,tt=73,ot=91,lt=103,St=113,et=666,Je=1,Be=2,Ge=3,He=4,ve=3;function _e(ie,ke){return ie.msg=A[ke],ke}function pe(ie){return(ie<<1)-(ie>4?9:0)}function fe(ie){for(var ke=ie.length;--ke>=0;)ie[ke]=0}function ue(ie){var ke=ie.state,Ke=ke.pending;Ke>ie.avail_out&&(Ke=ie.avail_out),Ke!==0&&(S.arraySet(ie.output,ke.pending_buf,ke.pending_out,Ke,ie.next_out),ie.next_out+=Ke,ke.pending_out+=Ke,ie.total_out+=Ke,ie.avail_out-=Ke,ke.pending-=Ke,ke.pending===0&&(ke.pending_out=0))}function ce(ie,ke){h._tr_flush_block(ie,ie.block_start>=0?ie.block_start:-1,ie.strstart-ie.block_start,ke),ie.block_start=ie.strstart,ue(ie.strm)}function Ee(ie,ke){ie.pending_buf[ie.pending++]=ke}function Ye(ie,ke){ie.pending_buf[ie.pending++]=ke>>>8&255,ie.pending_buf[ie.pending++]=ke&255}function ft(ie,ke,Ke,re){var le=ie.avail_in;return le>re&&(le=re),le===0?0:(ie.avail_in-=le,S.arraySet(ke,ie.input,ie.next_in,le,Ke),ie.state.wrap===1?ie.adler=I(ie.adler,ke,le,Ke):ie.state.wrap===2&&(ie.adler=T(ie.adler,ke,le,Ke)),ie.next_in+=le,ie.total_in+=le,le)}function _t(ie,ke){var Ke=ie.max_chain_length,re=ie.strstart,le,Se,Ne=ie.prev_length,We=ie.nice_match,nt=ie.strstart>ie.w_size-Pe?ie.strstart-(ie.w_size-Pe):0,vt=ie.window,Dt=ie.w_mask,wt=ie.prev,Tt=ie.strstart+Ie,Nt=vt[re+Ne-1],ri=vt[re+Ne];ie.prev_length>=ie.good_match&&(Ke>>=2),We>ie.lookahead&&(We=ie.lookahead);do if(le=ke,!(vt[le+Ne]!==ri||vt[le+Ne-1]!==Nt||vt[le]!==vt[re]||vt[++le]!==vt[re+1])){re+=2,le++;do;while(vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&vt[++re]===vt[++le]&&re<Tt);if(Se=Ie-(Tt-re),re=Tt-Ie,Se>Ne){if(ie.match_start=ke,Ne=Se,Se>=We)break;Nt=vt[re+Ne-1],ri=vt[re+Ne]}}while((ke=wt[ke&Dt])>nt&&--Ke!=0);return Ne<=ie.lookahead?Ne:ie.lookahead}function It(ie){var ke=ie.w_size,Ke,re,le,Se,Ne;do{if(Se=ie.window_size-ie.lookahead-ie.strstart,ie.strstart>=ke+(ke-Pe)){S.arraySet(ie.window,ie.window,ke,ke,0),ie.match_start-=ke,ie.strstart-=ke,ie.block_start-=ke,re=ie.hash_size,Ke=re;do le=ie.head[--Ke],ie.head[Ke]=le>=ke?le-ke:0;while(--re);re=ke,Ke=re;do le=ie.prev[--Ke],ie.prev[Ke]=le>=ke?le-ke:0;while(--re);Se+=ke}if(ie.strm.avail_in===0)break;if(re=ft(ie.strm,ie.window,ie.strstart+ie.lookahead,Se),ie.lookahead+=re,ie.lookahead+ie.insert>=je)for(Ne=ie.strstart-ie.insert,ie.ins_h=ie.window[Ne],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[Ne+1])&ie.hash_mask;ie.insert&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[Ne+je-1])&ie.hash_mask,ie.prev[Ne&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=Ne,Ne++,ie.insert--,!(ie.lookahead+ie.insert<je)););}while(ie.lookahead<Pe&&ie.strm.avail_in!==0)}function $t(ie,ke){var Ke=65535;for(Ke>ie.pending_buf_size-5&&(Ke=ie.pending_buf_size-5);;){if(ie.lookahead<=1){if(It(ie),ie.lookahead===0&&ke===k)return Je;if(ie.lookahead===0)break}ie.strstart+=ie.lookahead,ie.lookahead=0;var re=ie.block_start+Ke;if((ie.strstart===0||ie.strstart>=re)&&(ie.lookahead=ie.strstart-re,ie.strstart=re,ce(ie,!1),ie.strm.avail_out===0)||ie.strstart-ie.block_start>=ie.w_size-Pe&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):(ie.strstart>ie.block_start&&(ce(ie,!1),ie.strm.avail_out===0),Je)}function Yt(ie,ke){for(var Ke,re;;){if(ie.lookahead<Pe){if(It(ie),ie.lookahead<Pe&&ke===k)return Je;if(ie.lookahead===0)break}if(Ke=0,ie.lookahead>=je&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),Ke!==0&&ie.strstart-Ke<=ie.w_size-Pe&&(ie.match_length=_t(ie,Ke)),ie.match_length>=je)if(re=h._tr_tally(ie,ie.strstart-ie.match_start,ie.match_length-je),ie.lookahead-=ie.match_length,ie.match_length<=ie.max_lazy_match&&ie.lookahead>=je){ie.match_length--;do ie.strstart++,ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart;while(--ie.match_length!=0);ie.strstart++}else ie.strstart+=ie.match_length,ie.match_length=0,ie.ins_h=ie.window[ie.strstart],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+1])&ie.hash_mask;else re=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++;if(re&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=ie.strstart<je-1?ie.strstart:je-1,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function ii(ie,ke){for(var Ke,re,le;;){if(ie.lookahead<Pe){if(It(ie),ie.lookahead<Pe&&ke===k)return Je;if(ie.lookahead===0)break}if(Ke=0,ie.lookahead>=je&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),ie.prev_length=ie.match_length,ie.prev_match=ie.match_start,ie.match_length=je-1,Ke!==0&&ie.prev_length<ie.max_lazy_match&&ie.strstart-Ke<=ie.w_size-Pe&&(ie.match_length=_t(ie,Ke),ie.match_length<=5&&(ie.strategy===W||ie.match_length===je&&ie.strstart-ie.match_start>4096)&&(ie.match_length=je-1)),ie.prev_length>=je&&ie.match_length<=ie.prev_length){le=ie.strstart+ie.lookahead-je,re=h._tr_tally(ie,ie.strstart-1-ie.prev_match,ie.prev_length-je),ie.lookahead-=ie.prev_length-1,ie.prev_length-=2;do++ie.strstart<=le&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+je-1])&ie.hash_mask,Ke=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart);while(--ie.prev_length!=0);if(ie.match_available=0,ie.match_length=je-1,ie.strstart++,re&&(ce(ie,!1),ie.strm.avail_out===0))return Je}else if(ie.match_available){if(re=h._tr_tally(ie,0,ie.window[ie.strstart-1]),re&&ce(ie,!1),ie.strstart++,ie.lookahead--,ie.strm.avail_out===0)return Je}else ie.match_available=1,ie.strstart++,ie.lookahead--}return ie.match_available&&(re=h._tr_tally(ie,0,ie.window[ie.strstart-1]),ie.match_available=0),ie.insert=ie.strstart<je-1?ie.strstart:je-1,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function zt(ie,ke){for(var Ke,re,le,Se,Ne=ie.window;;){if(ie.lookahead<=Ie){if(It(ie),ie.lookahead<=Ie&&ke===k)return Je;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=je&&ie.strstart>0&&(le=ie.strstart-1,re=Ne[le],re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le])){Se=ie.strstart+Ie;do;while(re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&re===Ne[++le]&&le<Se);ie.match_length=Ie-(Se-le),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=je?(Ke=h._tr_tally(ie,1,ie.match_length-je),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Ke=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Ke&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function qt(ie,ke){for(var Ke;;){if(ie.lookahead===0&&(It(ie),ie.lookahead===0)){if(ke===k)return Je;break}if(ie.match_length=0,Ke=h._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Ke&&(ce(ie,!1),ie.strm.avail_out===0))return Je}return ie.insert=0,ke===M?(ce(ie,!0),ie.strm.avail_out===0?Ge:He):ie.last_lit&&(ce(ie,!1),ie.strm.avail_out===0)?Je:Be}function Vt(ie,ke,Ke,re,le){this.good_length=ie,this.max_lazy=ke,this.nice_length=Ke,this.max_chain=re,this.func=le}var fi;fi=[new Vt(0,0,0,0,$t),new Vt(4,4,8,4,Yt),new Vt(4,5,16,8,Yt),new Vt(4,6,32,32,Yt),new Vt(4,4,16,16,ii),new Vt(8,16,32,32,ii),new Vt(8,16,128,128,ii),new Vt(8,32,128,256,ii),new Vt(32,128,258,1024,ii),new Vt(32,258,258,4096,ii)];function hi(ie){ie.window_size=2*ie.w_size,fe(ie.head),ie.max_lazy_match=fi[ie.level].max_lazy,ie.good_match=fi[ie.level].good_length,ie.nice_match=fi[ie.level].nice_length,ie.max_chain_length=fi[ie.level].max_chain,ie.strstart=0,ie.block_start=0,ie.lookahead=0,ie.insert=0,ie.match_length=ie.prev_length=je-1,ie.match_available=0,ie.ins_h=0}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ne,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(Ze*2),this.dyn_dtree=new S.Buf16((2*xe+1)*2),this.bl_tree=new S.Buf16((2*Le+1)*2),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(Xe+1),this.heap=new S.Buf16(2*me+1),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*me+1),fe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function bt(ie){var ke;return!ie||!ie.state?_e(ie,U):(ie.total_in=ie.total_out=0,ie.data_type=te,ke=ie.state,ke.pending=0,ke.pending_out=0,ke.wrap<0&&(ke.wrap=-ke.wrap),ke.status=ke.wrap?ze:St,ie.adler=ke.wrap===2?0:1,ke.last_flush=k,h._tr_init(ke),N)}function At(ie){var ke=bt(ie);return ke===N&&hi(ie.state),ke}function Bt(ie,ke){return!ie||!ie.state||ie.state.wrap!==2?U:(ie.state.gzhead=ke,N)}function pt(ie,ke,Ke,re,le,Se){if(!ie)return U;var Ne=1;if(ke===Z&&(ke=6),re<0?(Ne=0,re=-re):re>15&&(Ne=2,re-=16),le<1||le>de||Ke!==ne||re<8||re>15||ke<0||ke>9||Se<0||Se>J)return _e(ie,U);re===8&&(re=9);var We=new Me;return ie.state=We,We.strm=ie,We.wrap=Ne,We.gzhead=null,We.w_bits=re,We.w_size=1<<We.w_bits,We.w_mask=We.w_size-1,We.hash_bits=le+7,We.hash_size=1<<We.hash_bits,We.hash_mask=We.hash_size-1,We.hash_shift=~~((We.hash_bits+je-1)/je),We.window=new S.Buf8(We.w_size*2),We.head=new S.Buf16(We.hash_size),We.prev=new S.Buf16(We.w_size),We.lit_bufsize=1<<le+6,We.pending_buf_size=We.lit_bufsize*4,We.pending_buf=new S.Buf8(We.pending_buf_size),We.d_buf=1*We.lit_bufsize,We.l_buf=(1+2)*We.lit_bufsize,We.level=ke,We.strategy=Se,We.method=Ke,At(ie)}function Rt(ie,ke){return pt(ie,ke,ne,oe,we,q)}function Ve(ie,ke){var Ke,re,le,Se;if(!ie||!ie.state||ke>F||ke<0)return ie?_e(ie,U):U;if(re=ie.state,!ie.output||!ie.input&&ie.avail_in!==0||re.status===et&&ke!==M)return _e(ie,ie.avail_out===0?V:U);if(re.strm=ie,Ke=re.last_flush,re.last_flush=ke,re.status===ze)if(re.wrap===2)ie.adler=0,Ee(re,31),Ee(re,139),Ee(re,8),re.gzhead?(Ee(re,(re.gzhead.text?1:0)+(re.gzhead.hcrc?2:0)+(re.gzhead.extra?4:0)+(re.gzhead.name?8:0)+(re.gzhead.comment?16:0)),Ee(re,re.gzhead.time&255),Ee(re,re.gzhead.time>>8&255),Ee(re,re.gzhead.time>>16&255),Ee(re,re.gzhead.time>>24&255),Ee(re,re.level===9?2:re.strategy>=Y||re.level<2?4:0),Ee(re,re.gzhead.os&255),re.gzhead.extra&&re.gzhead.extra.length&&(Ee(re,re.gzhead.extra.length&255),Ee(re,re.gzhead.extra.length>>8&255)),re.gzhead.hcrc&&(ie.adler=T(ie.adler,re.pending_buf,re.pending,0)),re.gzindex=0,re.status=it):(Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,0),Ee(re,re.level===9?2:re.strategy>=Y||re.level<2?4:0),Ee(re,ve),re.status=St);else{var Ne=ne+(re.w_bits-8<<4)<<8,We=-1;re.strategy>=Y||re.level<2?We=0:re.level<6?We=1:re.level===6?We=2:We=3,Ne|=We<<6,re.strstart!==0&&(Ne|=De),Ne+=31-Ne%31,re.status=St,Ye(re,Ne),re.strstart!==0&&(Ye(re,ie.adler>>>16),Ye(re,ie.adler&65535)),ie.adler=1}if(re.status===it)if(re.gzhead.extra){for(le=re.pending;re.gzindex<(re.gzhead.extra.length&65535)&&!(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size));)Ee(re,re.gzhead.extra[re.gzindex]&255),re.gzindex++;re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),re.gzindex===re.gzhead.extra.length&&(re.gzindex=0,re.status=tt)}else re.status=tt;if(re.status===tt)if(re.gzhead.name){le=re.pending;do{if(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size)){Se=1;break}re.gzindex<re.gzhead.name.length?Se=re.gzhead.name.charCodeAt(re.gzindex++)&255:Se=0,Ee(re,Se)}while(Se!==0);re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),Se===0&&(re.gzindex=0,re.status=ot)}else re.status=ot;if(re.status===ot)if(re.gzhead.comment){le=re.pending;do{if(re.pending===re.pending_buf_size&&(re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),ue(ie),le=re.pending,re.pending===re.pending_buf_size)){Se=1;break}re.gzindex<re.gzhead.comment.length?Se=re.gzhead.comment.charCodeAt(re.gzindex++)&255:Se=0,Ee(re,Se)}while(Se!==0);re.gzhead.hcrc&&re.pending>le&&(ie.adler=T(ie.adler,re.pending_buf,re.pending-le,le)),Se===0&&(re.status=lt)}else re.status=lt;if(re.status===lt&&(re.gzhead.hcrc?(re.pending+2>re.pending_buf_size&&ue(ie),re.pending+2<=re.pending_buf_size&&(Ee(re,ie.adler&255),Ee(re,ie.adler>>8&255),ie.adler=0,re.status=St)):re.status=St),re.pending!==0){if(ue(ie),ie.avail_out===0)return re.last_flush=-1,N}else if(ie.avail_in===0&&pe(ke)<=pe(Ke)&&ke!==M)return _e(ie,V);if(re.status===et&&ie.avail_in!==0)return _e(ie,V);if(ie.avail_in!==0||re.lookahead!==0||ke!==k&&re.status!==et){var nt=re.strategy===Y?qt(re,ke):re.strategy===X?zt(re,ke):fi[re.level].func(re,ke);if((nt===Ge||nt===He)&&(re.status=et),nt===Je||nt===Ge)return ie.avail_out===0&&(re.last_flush=-1),N;if(nt===Be&&(ke===P?h._tr_align(re):ke!==F&&(h._tr_stored_block(re,0,0,!1),ke===D&&(fe(re.head),re.lookahead===0&&(re.strstart=0,re.block_start=0,re.insert=0))),ue(ie),ie.avail_out===0))return re.last_flush=-1,N}return ke!==M?N:re.wrap<=0?B:(re.wrap===2?(Ee(re,ie.adler&255),Ee(re,ie.adler>>8&255),Ee(re,ie.adler>>16&255),Ee(re,ie.adler>>24&255),Ee(re,ie.total_in&255),Ee(re,ie.total_in>>8&255),Ee(re,ie.total_in>>16&255),Ee(re,ie.total_in>>24&255)):(Ye(re,ie.adler>>>16),Ye(re,ie.adler&65535)),ue(ie),re.wrap>0&&(re.wrap=-re.wrap),re.pending!==0?N:B)}function jt(ie){var ke;return!ie||!ie.state?U:(ke=ie.state.status,ke!==ze&&ke!==it&&ke!==tt&&ke!==ot&&ke!==lt&&ke!==St&&ke!==et?_e(ie,U):(ie.state=null,ke===St?_e(ie,O):N))}function mi(ie,ke){var Ke=ke.length,re,le,Se,Ne,We,nt,vt,Dt;if(!ie||!ie.state||(re=ie.state,Ne=re.wrap,Ne===2||Ne===1&&re.status!==ze||re.lookahead))return U;for(Ne===1&&(ie.adler=I(ie.adler,ke,Ke,0)),re.wrap=0,Ke>=re.w_size&&(Ne===0&&(fe(re.head),re.strstart=0,re.block_start=0,re.insert=0),Dt=new S.Buf8(re.w_size),S.arraySet(Dt,ke,Ke-re.w_size,re.w_size,0),ke=Dt,Ke=re.w_size),We=ie.avail_in,nt=ie.next_in,vt=ie.input,ie.avail_in=Ke,ie.next_in=0,ie.input=ke,It(re);re.lookahead>=je;){le=re.strstart,Se=re.lookahead-(je-1);do re.ins_h=(re.ins_h<<re.hash_shift^re.window[le+je-1])&re.hash_mask,re.prev[le&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=le,le++;while(--Se);re.strstart=le,re.lookahead=je-1,It(re)}return re.strstart+=re.lookahead,re.block_start=re.strstart,re.insert=re.lookahead,re.lookahead=0,re.match_length=re.prev_length=je-1,re.match_available=0,ie.next_in=nt,ie.input=vt,ie.avail_in=We,re.wrap=Ne,N}E.deflateInit=Rt,E.deflateInit2=pt,E.deflateReset=At,E.deflateResetKeep=bt,E.deflateSetHeader=Bt,E.deflate=Ve,E.deflateEnd=jt,E.deflateSetDictionary=mi,E.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":89,"./adler32":91,"./crc32":93,"./messages":99,"./trees":100}],95:[function(m,x,E){function S(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}x.exports=S},{}],96:[function(m,x,E){arguments[4][41][0].apply(E,arguments)},{dup:41}],97:[function(m,x,E){arguments[4][42][0].apply(E,arguments)},{"../utils/common":89,"./adler32":91,"./crc32":93,"./inffast":96,"./inftrees":98,dup:42}],98:[function(m,x,E){arguments[4][43][0].apply(E,arguments)},{"../utils/common":89,dup:43}],99:[function(m,x,E){arguments[4][44][0].apply(E,arguments)},{dup:44}],100:[function(m,x,E){var S=m("../utils/common"),h=4,I=0,T=1,A=2;function k(Me){for(var bt=Me.length;--bt>=0;)Me[bt]=0}var P=0,D=1,M=2,F=3,N=258,B=29,U=256,O=U+1+B,V=30,Z=19,W=2*O+1,Y=15,X=16,J=7,q=256,te=16,ne=17,de=18,oe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],we=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ae=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ye=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],me=512,xe=new Array((O+2)*2);k(xe);var Le=new Array(V*2);k(Le);var Ze=new Array(me);k(Ze);var Xe=new Array(N-F+1);k(Xe);var je=new Array(B);k(je);var Ie=new Array(V);k(Ie);function Pe(Me,bt,At,Bt,pt){this.static_tree=Me,this.extra_bits=bt,this.extra_base=At,this.elems=Bt,this.max_length=pt,this.has_stree=Me&&Me.length}var De,ze,it;function tt(Me,bt){this.dyn_tree=Me,this.max_code=0,this.stat_desc=bt}function ot(Me){return Me<256?Ze[Me]:Ze[256+(Me>>>7)]}function lt(Me,bt){Me.pending_buf[Me.pending++]=bt&255,Me.pending_buf[Me.pending++]=bt>>>8&255}function St(Me,bt,At){Me.bi_valid>X-At?(Me.bi_buf|=bt<<Me.bi_valid&65535,lt(Me,Me.bi_buf),Me.bi_buf=bt>>X-Me.bi_valid,Me.bi_valid+=At-X):(Me.bi_buf|=bt<<Me.bi_valid&65535,Me.bi_valid+=At)}function et(Me,bt,At){St(Me,At[bt*2],At[bt*2+1])}function Je(Me,bt){var At=0;do At|=Me&1,Me>>>=1,At<<=1;while(--bt>0);return At>>>1}function Be(Me){Me.bi_valid===16?(lt(Me,Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0):Me.bi_valid>=8&&(Me.pending_buf[Me.pending++]=Me.bi_buf&255,Me.bi_buf>>=8,Me.bi_valid-=8)}function Ge(Me,bt){var At=bt.dyn_tree,Bt=bt.max_code,pt=bt.stat_desc.static_tree,Rt=bt.stat_desc.has_stree,Ve=bt.stat_desc.extra_bits,jt=bt.stat_desc.extra_base,mi=bt.stat_desc.max_length,ie,ke,Ke,re,le,Se,Ne=0;for(re=0;re<=Y;re++)Me.bl_count[re]=0;for(At[Me.heap[Me.heap_max]*2+1]=0,ie=Me.heap_max+1;ie<W;ie++)ke=Me.heap[ie],re=At[At[ke*2+1]*2+1]+1,re>mi&&(re=mi,Ne++),At[ke*2+1]=re,!(ke>Bt)&&(Me.bl_count[re]++,le=0,ke>=jt&&(le=Ve[ke-jt]),Se=At[ke*2],Me.opt_len+=Se*(re+le),Rt&&(Me.static_len+=Se*(pt[ke*2+1]+le)));if(Ne!==0){do{for(re=mi-1;Me.bl_count[re]===0;)re--;Me.bl_count[re]--,Me.bl_count[re+1]+=2,Me.bl_count[mi]--,Ne-=2}while(Ne>0);for(re=mi;re!==0;re--)for(ke=Me.bl_count[re];ke!==0;)Ke=Me.heap[--ie],!(Ke>Bt)&&(At[Ke*2+1]!==re&&(Me.opt_len+=(re-At[Ke*2+1])*At[Ke*2],At[Ke*2+1]=re),ke--)}}function He(Me,bt,At){var Bt=new Array(Y+1),pt=0,Rt,Ve;for(Rt=1;Rt<=Y;Rt++)Bt[Rt]=pt=pt+At[Rt-1]<<1;for(Ve=0;Ve<=bt;Ve++){var jt=Me[Ve*2+1];jt!==0&&(Me[Ve*2]=Je(Bt[jt]++,jt))}}function ve(){var Me,bt,At,Bt,pt,Rt=new Array(Y+1);for(At=0,Bt=0;Bt<B-1;Bt++)for(je[Bt]=At,Me=0;Me<1<<oe[Bt];Me++)Xe[At++]=Bt;for(Xe[At-1]=Bt,pt=0,Bt=0;Bt<16;Bt++)for(Ie[Bt]=pt,Me=0;Me<1<<we[Bt];Me++)Ze[pt++]=Bt;for(pt>>=7;Bt<V;Bt++)for(Ie[Bt]=pt<<7,Me=0;Me<1<<we[Bt]-7;Me++)Ze[256+pt++]=Bt;for(bt=0;bt<=Y;bt++)Rt[bt]=0;for(Me=0;Me<=143;)xe[Me*2+1]=8,Me++,Rt[8]++;for(;Me<=255;)xe[Me*2+1]=9,Me++,Rt[9]++;for(;Me<=279;)xe[Me*2+1]=7,Me++,Rt[7]++;for(;Me<=287;)xe[Me*2+1]=8,Me++,Rt[8]++;for(He(xe,O+1,Rt),Me=0;Me<V;Me++)Le[Me*2+1]=5,Le[Me*2]=Je(Me,5);De=new Pe(xe,oe,U+1,O,Y),ze=new Pe(Le,we,0,V,Y),it=new Pe(new Array(0),Ae,0,Z,J)}function _e(Me){var bt;for(bt=0;bt<O;bt++)Me.dyn_ltree[bt*2]=0;for(bt=0;bt<V;bt++)Me.dyn_dtree[bt*2]=0;for(bt=0;bt<Z;bt++)Me.bl_tree[bt*2]=0;Me.dyn_ltree[q*2]=1,Me.opt_len=Me.static_len=0,Me.last_lit=Me.matches=0}function pe(Me){Me.bi_valid>8?lt(Me,Me.bi_buf):Me.bi_valid>0&&(Me.pending_buf[Me.pending++]=Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0}function fe(Me,bt,At,Bt){pe(Me),Bt&&(lt(Me,At),lt(Me,~At)),S.arraySet(Me.pending_buf,Me.window,bt,At,Me.pending),Me.pending+=At}function ue(Me,bt,At,Bt){var pt=bt*2,Rt=At*2;return Me[pt]<Me[Rt]||Me[pt]===Me[Rt]&&Bt[bt]<=Bt[At]}function ce(Me,bt,At){for(var Bt=Me.heap[At],pt=At<<1;pt<=Me.heap_len&&(pt<Me.heap_len&&ue(bt,Me.heap[pt+1],Me.heap[pt],Me.depth)&&pt++,!ue(bt,Bt,Me.heap[pt],Me.depth));)Me.heap[At]=Me.heap[pt],At=pt,pt<<=1;Me.heap[At]=Bt}function Ee(Me,bt,At){var Bt,pt,Rt=0,Ve,jt;if(Me.last_lit!==0)do Bt=Me.pending_buf[Me.d_buf+Rt*2]<<8|Me.pending_buf[Me.d_buf+Rt*2+1],pt=Me.pending_buf[Me.l_buf+Rt],Rt++,Bt===0?et(Me,pt,bt):(Ve=Xe[pt],et(Me,Ve+U+1,bt),jt=oe[Ve],jt!==0&&(pt-=je[Ve],St(Me,pt,jt)),Bt--,Ve=ot(Bt),et(Me,Ve,At),jt=we[Ve],jt!==0&&(Bt-=Ie[Ve],St(Me,Bt,jt)));while(Rt<Me.last_lit);et(Me,q,bt)}function Ye(Me,bt){var At=bt.dyn_tree,Bt=bt.stat_desc.static_tree,pt=bt.stat_desc.has_stree,Rt=bt.stat_desc.elems,Ve,jt,mi=-1,ie;for(Me.heap_len=0,Me.heap_max=W,Ve=0;Ve<Rt;Ve++)At[Ve*2]!==0?(Me.heap[++Me.heap_len]=mi=Ve,Me.depth[Ve]=0):At[Ve*2+1]=0;for(;Me.heap_len<2;)ie=Me.heap[++Me.heap_len]=mi<2?++mi:0,At[ie*2]=1,Me.depth[ie]=0,Me.opt_len--,pt&&(Me.static_len-=Bt[ie*2+1]);for(bt.max_code=mi,Ve=Me.heap_len>>1;Ve>=1;Ve--)ce(Me,At,Ve);ie=Rt;do Ve=Me.heap[1],Me.heap[1]=Me.heap[Me.heap_len--],ce(Me,At,1),jt=Me.heap[1],Me.heap[--Me.heap_max]=Ve,Me.heap[--Me.heap_max]=jt,At[ie*2]=At[Ve*2]+At[jt*2],Me.depth[ie]=(Me.depth[Ve]>=Me.depth[jt]?Me.depth[Ve]:Me.depth[jt])+1,At[Ve*2+1]=At[jt*2+1]=ie,Me.heap[1]=ie++,ce(Me,At,1);while(Me.heap_len>=2);Me.heap[--Me.heap_max]=Me.heap[1],Ge(Me,bt),He(At,mi,Me.bl_count)}function ft(Me,bt,At){var Bt,pt=-1,Rt,Ve=bt[0*2+1],jt=0,mi=7,ie=4;for(Ve===0&&(mi=138,ie=3),bt[(At+1)*2+1]=65535,Bt=0;Bt<=At;Bt++)Rt=Ve,Ve=bt[(Bt+1)*2+1],!(++jt<mi&&Rt===Ve)&&(jt<ie?Me.bl_tree[Rt*2]+=jt:Rt!==0?(Rt!==pt&&Me.bl_tree[Rt*2]++,Me.bl_tree[te*2]++):jt<=10?Me.bl_tree[ne*2]++:Me.bl_tree[de*2]++,jt=0,pt=Rt,Ve===0?(mi=138,ie=3):Rt===Ve?(mi=6,ie=3):(mi=7,ie=4))}function _t(Me,bt,At){var Bt,pt=-1,Rt,Ve=bt[0*2+1],jt=0,mi=7,ie=4;for(Ve===0&&(mi=138,ie=3),Bt=0;Bt<=At;Bt++)if(Rt=Ve,Ve=bt[(Bt+1)*2+1],!(++jt<mi&&Rt===Ve)){if(jt<ie)do et(Me,Rt,Me.bl_tree);while(--jt!=0);else Rt!==0?(Rt!==pt&&(et(Me,Rt,Me.bl_tree),jt--),et(Me,te,Me.bl_tree),St(Me,jt-3,2)):jt<=10?(et(Me,ne,Me.bl_tree),St(Me,jt-3,3)):(et(Me,de,Me.bl_tree),St(Me,jt-11,7));jt=0,pt=Rt,Ve===0?(mi=138,ie=3):Rt===Ve?(mi=6,ie=3):(mi=7,ie=4)}}function It(Me){var bt;for(ft(Me,Me.dyn_ltree,Me.l_desc.max_code),ft(Me,Me.dyn_dtree,Me.d_desc.max_code),Ye(Me,Me.bl_desc),bt=Z-1;bt>=3&&Me.bl_tree[ye[bt]*2+1]===0;bt--);return Me.opt_len+=3*(bt+1)+5+5+4,bt}function $t(Me,bt,At,Bt){var pt;for(St(Me,bt-257,5),St(Me,At-1,5),St(Me,Bt-4,4),pt=0;pt<Bt;pt++)St(Me,Me.bl_tree[ye[pt]*2+1],3);_t(Me,Me.dyn_ltree,bt-1),_t(Me,Me.dyn_dtree,At-1)}function Yt(Me){var bt=4093624447,At;for(At=0;At<=31;At++,bt>>>=1)if(bt&1&&Me.dyn_ltree[At*2]!==0)return I;if(Me.dyn_ltree[9*2]!==0||Me.dyn_ltree[10*2]!==0||Me.dyn_ltree[13*2]!==0)return T;for(At=32;At<U;At++)if(Me.dyn_ltree[At*2]!==0)return T;return I}var ii=!1;function zt(Me){ii||(ve(),ii=!0),Me.l_desc=new tt(Me.dyn_ltree,De),Me.d_desc=new tt(Me.dyn_dtree,ze),Me.bl_desc=new tt(Me.bl_tree,it),Me.bi_buf=0,Me.bi_valid=0,_e(Me)}function qt(Me,bt,At,Bt){St(Me,(P<<1)+(Bt?1:0),3),fe(Me,bt,At,!0)}function Vt(Me){St(Me,D<<1,3),et(Me,q,xe),Be(Me)}function fi(Me,bt,At,Bt){var pt,Rt,Ve=0;Me.level>0?(Me.strm.data_type===A&&(Me.strm.data_type=Yt(Me)),Ye(Me,Me.l_desc),Ye(Me,Me.d_desc),Ve=It(Me),pt=Me.opt_len+3+7>>>3,Rt=Me.static_len+3+7>>>3,Rt<=pt&&(pt=Rt)):pt=Rt=At+5,At+4<=pt&&bt!==-1?qt(Me,bt,At,Bt):Me.strategy===h||Rt===pt?(St(Me,(D<<1)+(Bt?1:0),3),Ee(Me,xe,Le)):(St(Me,(M<<1)+(Bt?1:0),3),$t(Me,Me.l_desc.max_code+1,Me.d_desc.max_code+1,Ve+1),Ee(Me,Me.dyn_ltree,Me.dyn_dtree)),_e(Me),Bt&&pe(Me)}function hi(Me,bt,At){return Me.pending_buf[Me.d_buf+Me.last_lit*2]=bt>>>8&255,Me.pending_buf[Me.d_buf+Me.last_lit*2+1]=bt&255,Me.pending_buf[Me.l_buf+Me.last_lit]=At&255,Me.last_lit++,bt===0?Me.dyn_ltree[At*2]++:(Me.matches++,bt--,Me.dyn_ltree[(Xe[At]+U+1)*2]++,Me.dyn_dtree[ot(bt)*2]++),Me.last_lit===Me.lit_bufsize-1}E._tr_init=zt,E._tr_stored_block=qt,E._tr_flush_block=fi,E._tr_tally=hi,E._tr_align=Vt},{"../utils/common":89}],101:[function(m,x,E){arguments[4][46][0].apply(E,arguments)},{dup:46}],102:[function(m,x,E){x.exports=function(A){if(!A)throw new Error("no data provided");A=A.toString().trim();var k={pages:[],chars:[],kernings:[]},P=A.split(/\r\n?|\n/g);if(P.length===0)throw new Error("no data in BMFont file");for(var D=0;D<P.length;D++){var M=S(P[D],D);if(!!M)if(M.key==="page"){if(typeof M.data.id!="number")throw new Error("malformed file at line "+D+" -- needs page id=N");if(typeof M.data.file!="string")throw new Error("malformed file at line "+D+' -- needs page file="path"');k.pages[M.data.id]=M.data.file}else M.key==="chars"||M.key==="kernings"||(M.key==="char"?k.chars.push(M.data):M.key==="kerning"?k.kernings.push(M.data):k[M.key]=M.data)}return k};function S(T,A){if(T=T.replace(/\t+/g," ").trim(),!T)return null;var k=T.indexOf(" ");if(k===-1)throw new Error("no named row at line "+A);var P=T.substring(0,k);T=T.substring(k+1),T=T.replace(/letter=[\'\"]\S+[\'\"]/gi,""),T=T.split("="),T=T.map(function(B){return B.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var D=[],M=0;M<T.length;M++){var F=T[M];M===0?D.push({key:F[0],data:""}):M===T.length-1?D[D.length-1].data=h(F[0]):(D[D.length-1].data=h(F[0]),D.push({key:F[1],data:""}))}var N={key:P,data:{}};return D.forEach(function(B){N.data[B.key]=B.data}),N}function h(T){return!T||T.length===0?"":T.indexOf('"')===0||T.indexOf("'")===0?T.substring(1,T.length-1):T.indexOf(",")!==-1?I(T):parseInt(T,10)}function I(T){return T.split(",").map(function(A){return parseInt(A,10)})}},{}],103:[function(m,x,E){var S=[66,77,70];x.exports=function(N){if(N.length<6)throw new Error("invalid buffer length for BMFont");var B=S.every(function(W,Y){return N.readUInt8(Y)===W});if(!B)throw new Error("BMFont missing BMF byte header");var U=3,O=N.readUInt8(U++);if(O>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var V={kernings:[],chars:[]},Z=0;Z<5;Z++)U+=h(V,N,U);return V};function h(F,N,B){if(B>N.length-1)return 0;var U=N.readUInt8(B++),O=N.readInt32LE(B);switch(B+=4,U){case 1:F.info=I(N,B);break;case 2:F.common=T(N,B);break;case 3:F.pages=A(N,B,O);break;case 4:F.chars=k(N,B,O);break;case 5:F.kernings=P(N,B,O);break}return 5+O}function I(F,N){var B={};B.size=F.readInt16LE(N);var U=F.readUInt8(N+2);return B.smooth=U>>7&1,B.unicode=U>>6&1,B.italic=U>>5&1,B.bold=U>>4&1,U>>3&1&&(B.fixedHeight=1),B.charset=F.readUInt8(N+3)||"",B.stretchH=F.readUInt16LE(N+4),B.aa=F.readUInt8(N+6),B.padding=[F.readInt8(N+7),F.readInt8(N+8),F.readInt8(N+9),F.readInt8(N+10)],B.spacing=[F.readInt8(N+11),F.readInt8(N+12)],B.outline=F.readUInt8(N+13),B.face=M(F,N+14),B}function T(F,N){var B={};return B.lineHeight=F.readUInt16LE(N),B.base=F.readUInt16LE(N+2),B.scaleW=F.readUInt16LE(N+4),B.scaleH=F.readUInt16LE(N+6),B.pages=F.readUInt16LE(N+8),F.readUInt8(N+10),B.packed=0,B.alphaChnl=F.readUInt8(N+11),B.redChnl=F.readUInt8(N+12),B.greenChnl=F.readUInt8(N+13),B.blueChnl=F.readUInt8(N+14),B}function A(F,N,B){for(var U=[],O=D(F,N),V=O.length+1,Z=B/V,W=0;W<Z;W++)U[W]=F.slice(N,N+O.length).toString("utf8"),N+=V;return U}function k(F,N,B){for(var U=[],O=B/20,V=0;V<O;V++){var Z={},W=V*20;Z.id=F.readUInt32LE(N+0+W),Z.x=F.readUInt16LE(N+4+W),Z.y=F.readUInt16LE(N+6+W),Z.width=F.readUInt16LE(N+8+W),Z.height=F.readUInt16LE(N+10+W),Z.xoffset=F.readInt16LE(N+12+W),Z.yoffset=F.readInt16LE(N+14+W),Z.xadvance=F.readInt16LE(N+16+W),Z.page=F.readUInt8(N+18+W),Z.chnl=F.readUInt8(N+19+W),U[V]=Z}return U}function P(F,N,B){for(var U=[],O=B/10,V=0;V<O;V++){var Z={},W=V*10;Z.first=F.readUInt32LE(N+0+W),Z.second=F.readUInt32LE(N+4+W),Z.amount=F.readInt16LE(N+8+W),U[V]=Z}return U}function D(F,N){for(var B=N;B<F.length&&F[B]!==0;B++);return F.slice(N,B)}function M(F,N){return D(F,N).toString("utf8")}},{}],104:[function(m,x,E){var S=m("./parse-attribs"),h=m("xml-parse-from-string"),I={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};x.exports=function(D){D=D.toString();var M=h(D),F={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(W){var Y=M.getElementsByTagName(W)[0];Y&&(F[W]=S(T(Y)))});var N=M.getElementsByTagName("pages")[0];if(!N)throw new Error("malformed file -- no <pages> element");for(var B=N.getElementsByTagName("page"),U=0;U<B.length;U++){var O=B[U],V=parseInt(O.getAttribute("id"),10),Z=O.getAttribute("file");if(isNaN(V))throw new Error('malformed file -- page "id" attribute is NaN');if(!Z)throw new Error('malformed file -- needs page "file" attribute');F.pages[parseInt(V,10)]=Z}return["chars","kernings"].forEach(function(W){var Y=M.getElementsByTagName(W)[0];if(!!Y)for(var X=W.substring(0,W.length-1),J=Y.getElementsByTagName(X),q=0;q<J.length;q++){var te=J[q];F[W].push(S(T(te)))}}),F};function T(P){var D=A(P);return D.reduce(function(M,F){var N=k(F.nodeName);return M[N]=F.nodeValue,M},{})}function A(P){for(var D=[],M=0;M<P.attributes.length;M++)D.push(P.attributes[M]);return D}function k(P){return I[P.toLowerCase()]||P}},{"./parse-attribs":105,"xml-parse-from-string":188}],105:[function(m,x,E){var S="chasrset";x.exports=function(T){S in T&&(T.charset=T[S],delete T[S]);for(var A in T)A==="face"||A==="charset"||(A==="padding"||A==="spacing"?T[A]=h(T[A]):T[A]=parseInt(T[A],10));return T};function h(I){return I.split(",").map(function(T){return parseInt(T,10)})}},{}],106:[function(m,x,E){var S=m("trim"),h=m("for-each"),I=function(T){return Object.prototype.toString.call(T)==="[object Array]"};x.exports=function(T){if(!T)return{};var A={};return h(S(T).split(`
`),function(k){var P=k.indexOf(":"),D=S(k.slice(0,P)).toLowerCase(),M=S(k.slice(P+1));typeof A[D]=="undefined"?A[D]=M:I(A[D])?A[D].push(M):A[D]=[A[D],M]}),A}},{"for-each":63,trim:179}],107:[function(m,x,E){(function(S){function h(k,P){for(var D=0,M=k.length-1;M>=0;M--){var F=k[M];F==="."?k.splice(M,1):F===".."?(k.splice(M,1),D++):D&&(k.splice(M,1),D--)}if(P)for(;D--;D)k.unshift("..");return k}E.resolve=function(){for(var k="",P=!1,D=arguments.length-1;D>=-1&&!P;D--){var M=D>=0?arguments[D]:S.cwd();if(typeof M!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!M)continue;k=M+"/"+k,P=M.charAt(0)==="/"}return k=h(T(k.split("/"),function(F){return!!F}),!P).join("/"),(P?"/":"")+k||"."},E.normalize=function(k){var P=E.isAbsolute(k),D=A(k,-1)==="/";return k=h(T(k.split("/"),function(M){return!!M}),!P).join("/"),!k&&!P&&(k="."),k&&D&&(k+="/"),(P?"/":"")+k},E.isAbsolute=function(k){return k.charAt(0)==="/"},E.join=function(){var k=Array.prototype.slice.call(arguments,0);return E.normalize(T(k,function(P,D){if(typeof P!="string")throw new TypeError("Arguments to path.join must be strings");return P}).join("/"))},E.relative=function(k,P){k=E.resolve(k).substr(1),P=E.resolve(P).substr(1);function D(V){for(var Z=0;Z<V.length&&V[Z]==="";Z++);for(var W=V.length-1;W>=0&&V[W]==="";W--);return Z>W?[]:V.slice(Z,W-Z+1)}for(var M=D(k.split("/")),F=D(P.split("/")),N=Math.min(M.length,F.length),B=N,U=0;U<N;U++)if(M[U]!==F[U]){B=U;break}for(var O=[],U=B;U<M.length;U++)O.push("..");return O=O.concat(F.slice(B)),O.join("/")},E.sep="/",E.delimiter=":",E.dirname=function(k){if(typeof k!="string"&&(k=k+""),k.length===0)return".";for(var P=k.charCodeAt(0),D=P===47,M=-1,F=!0,N=k.length-1;N>=1;--N)if(P=k.charCodeAt(N),P===47){if(!F){M=N;break}}else F=!1;return M===-1?D?"/":".":D&&M===1?"/":k.slice(0,M)};function I(k){typeof k!="string"&&(k=k+"");var P=0,D=-1,M=!0,F;for(F=k.length-1;F>=0;--F)if(k.charCodeAt(F)===47){if(!M){P=F+1;break}}else D===-1&&(M=!1,D=F+1);return D===-1?"":k.slice(P,D)}E.basename=function(k,P){var D=I(k);return P&&D.substr(-1*P.length)===P&&(D=D.substr(0,D.length-P.length)),D},E.extname=function(k){typeof k!="string"&&(k=k+"");for(var P=-1,D=0,M=-1,F=!0,N=0,B=k.length-1;B>=0;--B){var U=k.charCodeAt(B);if(U===47){if(!F){D=B+1;break}continue}M===-1&&(F=!1,M=B+1),U===46?P===-1?P=B:N!==1&&(N=1):P!==-1&&(N=-1)}return P===-1||M===-1||N===0||N===1&&P===M-1&&P===D+1?"":k.slice(P,M)};function T(k,P){if(k.filter)return k.filter(P);for(var D=[],M=0;M<k.length;M++)P(k[M],M,k)&&D.push(k[M]);return D}var A="ab".substr(-1)==="b"?function(k,P,D){return k.substr(P,D)}:function(k,P,D){return P<0&&(P=k.length+P),k.substr(P,D)}}).call(this,m("_process"))},{_process:133}],108:[function(m,x,E){(function(S){var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},I=m("http"),T=m("https"),A=m("url"),k=m("querystring"),P=m("zlib"),D=m("util"),M=function(N,B){if(typeof N!="string"&&!N.hasOwnProperty("url"))throw new Error("Missing url option from options for request method.");var U=(typeof N=="undefined"?"undefined":h(N))==="object"?A.parse(N.url):A.parse(N),O={hostname:U.hostname,port:U.port||(U.protocol.toLowerCase()==="http:"?80:443),path:U.path,method:"GET",headers:{},auth:U.auth||null,parse:"none",stream:!1};if((typeof N=="undefined"?"undefined":h(N))==="object"&&(O=Object.assign(O,N)),O.port=Number(O.port),O.hasOwnProperty("timeout")&&delete O.timeout,O.compressed===!0&&(O.headers["accept-encoding"]="gzip, deflate"),N.hasOwnProperty("form")){if(h(N.form)!=="object")throw new Error("phin 'form' option must be of type Object if present.");var V=k.stringify(N.form);O.headers["Content-Type"]="application/x-www-form-urlencoded",O.headers["Content-Length"]=S.byteLength(V),N.data=V}var Z=void 0,W=function(q){var te=q;O.compressed===!0&&(q.headers["content-encoding"]==="gzip"?te=q.pipe(P.createGunzip()):q.headers["content-encoding"]==="deflate"&&(te=q.pipe(P.createInflate()))),O.stream===!0?(q.stream=te,B(null,q)):(q.body=new S([]),te.on("data",function(ne){q.body=S.concat([q.body,ne])}),te.on("end",function(){if(B){if(O.parse==="json")try{q.body=JSON.parse(q.body.toString())}catch{B("Invalid JSON received.",q);return}B(null,q)}}))};switch(U.protocol.toLowerCase()){case"http:":Z=I.request(O,W);break;case"https:":Z=T.request(O,W);break;default:B&&B(new Error("Invalid / unknown URL protocol. Expected HTTP or HTTPS."),null);return}if(typeof N.timeout=="number"&&Z.setTimeout(N.timeout,function(){Z.abort(),B(new Error("Timeout has been reached."),null),B=null}),Z.on("error",function(J){B&&B(J,null)}),N.hasOwnProperty("data")){var Y=N.data;if(!(N.data instanceof S)&&h(N.data)==="object"){var X=O.headers["content-type"]||O.headers["Content-Type"];if(X==="application/x-www-form-urlencoded")Y=k.stringify(N.data);else try{Y=JSON.stringify(N.data)}catch{B(new Error("Couldn't stringify object. (Likely due to a circular reference.)"),null)}}Z.write(Y)}Z.end()};M.promisified=function(F,N){return new Promise(function(B,U){M(F,function(O,V){O?U(O):B(V)})})},D.promisify&&(M[D.promisify.custom]=M.promisified),x.exports=M}).call(this,m("buffer").Buffer)},{buffer:48,http:156,https:72,querystring:137,url:180,util:186,zlib:35}],109:[function(m,x,E){x.exports=S;function S(F,N,B,U,O,V){V||(V={});for(var Z=V.threshold===void 0?.1:V.threshold,W=35215*Z*Z,Y=0,X=0;X<O;X++)for(var J=0;J<U;J++){var q=(X*U+J)*4,te=I(F,N,q,q);if(te>W)!V.includeAA&&(h(F,J,X,U,O,N)||h(N,J,X,U,O,F))?B&&D(B,q,255,255,0):(B&&D(B,q,255,0,0),Y++);else if(B){var ne=P(M(F,q),.1);D(B,q,ne,ne,ne)}}return Y}function h(F,N,B,U,O,V){for(var Z=Math.max(N-1,0),W=Math.max(B-1,0),Y=Math.min(N+1,U-1),X=Math.min(B+1,O-1),J=(B*U+N)*4,q=0,te=0,ne=0,de=0,oe=0,we,Ae,ye,me,xe=Z;xe<=Y;xe++)for(var Le=W;Le<=X;Le++)if(!(xe===N&&Le===B)){var Ze=I(F,F,J,(Le*U+xe)*4,!0);if(Ze===0?q++:Ze<0?ne++:Ze>0&&te++,q>2)return!1;!V||(Ze<de&&(de=Ze,we=xe,Ae=Le),Ze>oe&&(oe=Ze,ye=xe,me=Le))}return V?ne===0||te===0?!1:!h(F,we,Ae,U,O)&&!h(V,we,Ae,U,O)||!h(F,ye,me,U,O)&&!h(V,ye,me,U,O):!0}function I(F,N,B,U,O){var V=F[B+3]/255,Z=N[U+3]/255,W=P(F[B+0],V),Y=P(F[B+1],V),X=P(F[B+2],V),J=P(N[U+0],Z),q=P(N[U+1],Z),te=P(N[U+2],Z),ne=T(W,Y,X)-T(J,q,te);if(O)return ne;var de=A(W,Y,X)-A(J,q,te),oe=k(W,Y,X)-k(J,q,te);return .5053*ne*ne+.299*de*de+.1957*oe*oe}function T(F,N,B){return F*.29889531+N*.58662247+B*.11448223}function A(F,N,B){return F*.59597799-N*.2741761-B*.32180189}function k(F,N,B){return F*.21147017-N*.52261711+B*.31114694}function P(F,N){return 255+(F-255)*N}function D(F,N,B,U,O){F[N+0]=B,F[N+1]=U,F[N+2]=O,F[N+3]=255}function M(F,N){var B=F[N+3]/255,U=P(F[N+0],B),O=P(F[N+1],B),V=P(F[N+2],B);return T(U,O,V)}},{}],110:[function(m,x,E){(function(S){var h=m("./interlace"),I={1:{0:0,1:0,2:0,3:255},2:{0:0,1:0,2:0,3:1},3:{0:0,1:1,2:2,3:255},4:{0:0,1:1,2:2,3:3}};function T(P,D){var M=[],F=0;function N(){if(F===P.length)throw new Error("Ran out of data");var B=P[F];F++;var U,O,V,Z,W,Y,X,J;switch(D){default:throw new Error("unrecognised depth");case 16:X=P[F],F++,M.push((B<<8)+X);break;case 4:X=B&15,J=B>>4,M.push(J,X);break;case 2:W=B&3,Y=B>>2&3,X=B>>4&3,J=B>>6&3,M.push(J,X,Y,W);break;case 1:U=B&1,O=B>>1&1,V=B>>2&1,Z=B>>3&1,W=B>>4&1,Y=B>>5&1,X=B>>6&1,J=B>>7&1,M.push(J,X,Y,W,Z,V,O,U);break}}return{get:function(B){for(;M.length<B;)N();var U=M.slice(0,B);return M=M.slice(B),U},resetAfterLine:function(){M.length=0},end:function(){if(F!==P.length)throw new Error("extra data found")}}}function A(P,D,M,F,N,B){for(var U=P.width,O=P.height,V=P.index,Z=0;Z<O;Z++)for(var W=0;W<U;W++){for(var Y=M(W,Z,V),X=0;X<4;X++){var J=I[F][X];if(J===255)D[Y+X]=255;else{var q=J+B;if(q===N.length)throw new Error("Ran out of data");D[Y+X]=N[q]}}B+=F}return B}function k(P,D,M,F,N,B){for(var U=P.width,O=P.height,V=P.index,Z=0;Z<O;Z++){for(var W=0;W<U;W++)for(var Y=N.get(F),X=M(W,Z,V),J=0;J<4;J++){var q=I[F][J];D[X+J]=q!==255?Y[q]:B}N.resetAfterLine()}}E.dataToBitMap=function(P,D){var M=D.width,F=D.height,N=D.depth,B=D.bpp,U=D.interlace;if(N!==8)var O=T(P,N);var V;N<=8?V=new S(M*F*4):V=new Uint16Array(M*F*4);var Z=Math.pow(2,N)-1,W=0,Y,X;if(U)Y=h.getImagePasses(M,F),X=h.getInterlaceIterator(M,F);else{var J=0;X=function(){var te=J;return J+=4,te},Y=[{width:M,height:F}]}for(var q=0;q<Y.length;q++)N===8?W=A(Y[q],V,X,B,P,W):k(Y[q],V,X,B,O,Z);if(N===8){if(W!==P.length)throw new Error("extra data found")}else O.end();return V}}).call(this,m("buffer").Buffer)},{"./interlace":120,buffer:48}],111:[function(m,x,E){(function(S){var h=m("./constants");x.exports=function(I,T,A,k){var P=[h.COLORTYPE_COLOR_ALPHA,h.COLORTYPE_ALPHA].indexOf(k.colorType)!==-1;if(k.colorType===k.inputColorType){var D=function(){var te=new ArrayBuffer(2);return new DataView(te).setInt16(0,256,!0),new Int16Array(te)[0]!==256}();if(k.bitDepth===8||k.bitDepth===16&&D)return I}var M=k.bitDepth!==16?I:new Uint16Array(I.buffer),F=255,N=h.COLORTYPE_TO_BPP_MAP[k.inputColorType];N==4&&!k.inputHasAlpha&&(N=3);var B=h.COLORTYPE_TO_BPP_MAP[k.colorType];k.bitDepth===16&&(F=65535,B*=2);var U=new S(T*A*B),O=0,V=0,Z=k.bgColor||{};Z.red===void 0&&(Z.red=F),Z.green===void 0&&(Z.green=F),Z.blue===void 0&&(Z.blue=F);function W(te,ne){var de,oe,we,Ae=F;switch(k.inputColorType){case h.COLORTYPE_COLOR_ALPHA:Ae=te[ne+3],de=te[ne],oe=te[ne+1],we=te[ne+2];break;case h.COLORTYPE_COLOR:de=te[ne],oe=te[ne+1],we=te[ne+2];break;case h.COLORTYPE_ALPHA:Ae=te[ne+1],de=te[ne],oe=de,we=de;break;case h.COLORTYPE_GRAYSCALE:de=te[ne],oe=de,we=de;break;default:throw new Error("input color type:"+k.inputColorType+" is not supported at present")}return k.inputHasAlpha&&(P||(Ae/=F,de=Math.min(Math.max(Math.round((1-Ae)*Z.red+Ae*de),0),F),oe=Math.min(Math.max(Math.round((1-Ae)*Z.green+Ae*oe),0),F),we=Math.min(Math.max(Math.round((1-Ae)*Z.blue+Ae*we),0),F))),{red:de,green:oe,blue:we,alpha:Ae}}for(var Y=0;Y<A;Y++)for(var X=0;X<T;X++){var J=W(M,O);switch(k.colorType){case h.COLORTYPE_COLOR_ALPHA:case h.COLORTYPE_COLOR:k.bitDepth===8?(U[V]=J.red,U[V+1]=J.green,U[V+2]=J.blue,P&&(U[V+3]=J.alpha)):(U.writeUInt16BE(J.red,V),U.writeUInt16BE(J.green,V+2),U.writeUInt16BE(J.blue,V+4),P&&U.writeUInt16BE(J.alpha,V+6));break;case h.COLORTYPE_ALPHA:case h.COLORTYPE_GRAYSCALE:var q=(J.red+J.green+J.blue)/3;k.bitDepth===8?(U[V]=q,P&&(U[V+1]=J.alpha)):(U.writeUInt16BE(q,V),P&&U.writeUInt16BE(J.alpha,V+2));break}O+=N,V+=B}return U}}).call(this,m("buffer").Buffer)},{"./constants":113,buffer:48}],112:[function(m,x,E){(function(S,h){var I=m("util"),T=m("stream"),A=x.exports=function(){T.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};I.inherits(A,T),A.prototype.read=function(k,P){this._reads.push({length:Math.abs(k),allowLess:k<0,func:P}),S.nextTick(function(){this._process(),this._paused&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},A.prototype.write=function(k,P){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;var D;return h.isBuffer(k)?D=k:D=new h(k,P||this._encoding),this._buffers.push(D),this._buffered+=D.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},A.prototype.end=function(k,P){k&&this.write(k,P),this.writable=!1,!!this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))},A.prototype.destroySoon=A.prototype.end,A.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("There are some read requests waiting on finished stream")),this.destroy()},A.prototype.destroy=function(){!this._buffers||(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},A.prototype._processReadAllowingLess=function(k){this._reads.shift();var P=this._buffers[0];P.length>k.length?(this._buffered-=k.length,this._buffers[0]=P.slice(k.length),k.func.call(this,P.slice(0,k.length))):(this._buffered-=P.length,this._buffers.shift(),k.func.call(this,P))},A.prototype._processRead=function(k){this._reads.shift();for(var P=0,D=0,M=new h(k.length);P<k.length;){var F=this._buffers[D++],N=Math.min(F.length,k.length-P);F.copy(M,P,0,N),P+=N,N!==F.length&&(this._buffers[--D]=F.slice(N))}D>0&&this._buffers.splice(0,D),this._buffered-=k.length,k.func.call(this,M)},A.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){var k=this._reads[0];if(k.allowLess)this._processReadAllowingLess(k);else if(this._buffered>=k.length)this._processRead(k);else break}this._buffers&&this._buffers.length>0&&this._buffers[0]===null&&this._end()}catch(P){this.emit("error",P)}}}).call(this,m("_process"),m("buffer").Buffer)},{_process:133,buffer:48,stream:155,util:186}],113:[function(m,x,E){x.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],114:[function(m,x,E){var S=[];(function(){for(var I=0;I<256;I++){for(var T=I,A=0;A<8;A++)T&1?T=3988292384^T>>>1:T=T>>>1;S[I]=T}})();var h=x.exports=function(){this._crc=-1};h.prototype.write=function(I){for(var T=0;T<I.length;T++)this._crc=S[(this._crc^I[T])&255]^this._crc>>>8;return!0},h.prototype.crc32=function(){return this._crc^-1},h.crc32=function(I){for(var T=-1,A=0;A<I.length;A++)T=S[(T^I[A])&255]^T>>>8;return T^-1}},{}],115:[function(m,x,E){(function(S){var h=m("./paeth-predictor");function I(V,Z,W,Y,X){for(var J=0;J<W;J++)Y[X+J]=V[Z+J]}function T(V,Z,W){for(var Y=0,X=Z+W,J=Z;J<X;J++)Y+=Math.abs(V[J]);return Y}function A(V,Z,W,Y,X,J){for(var q=0;q<W;q++){var te=q>=J?V[Z+q-J]:0,ne=V[Z+q]-te;Y[X+q]=ne}}function k(V,Z,W,Y){for(var X=0,J=0;J<W;J++){var q=J>=Y?V[Z+J-Y]:0,te=V[Z+J]-q;X+=Math.abs(te)}return X}function P(V,Z,W,Y,X){for(var J=0;J<W;J++){var q=Z>0?V[Z+J-W]:0,te=V[Z+J]-q;Y[X+J]=te}}function D(V,Z,W){for(var Y=0,X=Z+W,J=Z;J<X;J++){var q=Z>0?V[J-W]:0,te=V[J]-q;Y+=Math.abs(te)}return Y}function M(V,Z,W,Y,X,J){for(var q=0;q<W;q++){var te=q>=J?V[Z+q-J]:0,ne=Z>0?V[Z+q-W]:0,de=V[Z+q]-(te+ne>>1);Y[X+q]=de}}function F(V,Z,W,Y){for(var X=0,J=0;J<W;J++){var q=J>=Y?V[Z+J-Y]:0,te=Z>0?V[Z+J-W]:0,ne=V[Z+J]-(q+te>>1);X+=Math.abs(ne)}return X}function N(V,Z,W,Y,X,J){for(var q=0;q<W;q++){var te=q>=J?V[Z+q-J]:0,ne=Z>0?V[Z+q-W]:0,de=Z>0&&q>=J?V[Z+q-(W+J)]:0,oe=V[Z+q]-h(te,ne,de);Y[X+q]=oe}}function B(V,Z,W,Y){for(var X=0,J=0;J<W;J++){var q=J>=Y?V[Z+J-Y]:0,te=Z>0?V[Z+J-W]:0,ne=Z>0&&J>=Y?V[Z+J-(W+Y)]:0,de=V[Z+J]-h(q,te,ne);X+=Math.abs(de)}return X}var U={0:I,1:A,2:P,3:M,4:N},O={0:T,1:k,2:D,3:F,4:B};x.exports=function(V,Z,W,Y,X){var J;if(!("filterType"in Y)||Y.filterType===-1)J=[0,1,2,3,4];else if(typeof Y.filterType=="number")J=[Y.filterType];else throw new Error("unrecognised filter types");Y.bitDepth===16&&(X*=2);for(var q=Z*X,te=0,ne=0,de=new S((q+1)*W),oe=J[0],we=0;we<W;we++){if(J.length>1)for(var Ae=1/0,ye=0;ye<J.length;ye++){var me=O[J[ye]](V,ne,q,X);me<Ae&&(oe=J[ye],Ae=me)}de[te]=oe,te++,U[oe](V,ne,q,de,te,X),te+=q,ne+=q}return de}}).call(this,m("buffer").Buffer)},{"./paeth-predictor":124,buffer:48}],116:[function(m,x,E){(function(S){var h=m("util"),I=m("./chunkstream"),T=m("./filter-parse"),A=x.exports=function(k){I.call(this);var P=[],D=this;this._filter=new T(k,{read:this.read.bind(this),write:function(M){P.push(M)},complete:function(){D.emit("complete",S.concat(P))}}),this._filter.start()};h.inherits(A,I)}).call(this,m("buffer").Buffer)},{"./chunkstream":112,"./filter-parse":118,buffer:48,util:186}],117:[function(m,x,E){(function(S){var h=m("./sync-reader"),I=m("./filter-parse");E.process=function(T,A){var k=[],P=new h(T),D=new I(A,{read:P.read.bind(P),write:function(M){k.push(M)},complete:function(){}});return D.start(),P.process(),S.concat(k)}}).call(this,m("buffer").Buffer)},{"./filter-parse":118,"./sync-reader":131,buffer:48}],118:[function(m,x,E){(function(S){var h=m("./interlace"),I=m("./paeth-predictor");function T(k,P,D){var M=k*P;return D!==8&&(M=Math.ceil(M/(8/D))),M}var A=x.exports=function(k,P){var D=k.width,M=k.height,F=k.interlace,N=k.bpp,B=k.depth;if(this.read=P.read,this.write=P.write,this.complete=P.complete,this._imageIndex=0,this._images=[],F)for(var U=h.getImagePasses(D,M),O=0;O<U.length;O++)this._images.push({byteWidth:T(U[O].width,N,B),height:U[O].height,lineIndex:0});else this._images.push({byteWidth:T(D,N,B),height:M,lineIndex:0});B===8?this._xComparison=N:B===16?this._xComparison=N*2:this._xComparison=1};A.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},A.prototype._unFilterType1=function(k,P,D){for(var M=this._xComparison,F=M-1,N=0;N<D;N++){var B=k[1+N],U=N>F?P[N-M]:0;P[N]=B+U}},A.prototype._unFilterType2=function(k,P,D){for(var M=this._lastLine,F=0;F<D;F++){var N=k[1+F],B=M?M[F]:0;P[F]=N+B}},A.prototype._unFilterType3=function(k,P,D){for(var M=this._xComparison,F=M-1,N=this._lastLine,B=0;B<D;B++){var U=k[1+B],O=N?N[B]:0,V=B>F?P[B-M]:0,Z=Math.floor((V+O)/2);P[B]=U+Z}},A.prototype._unFilterType4=function(k,P,D){for(var M=this._xComparison,F=M-1,N=this._lastLine,B=0;B<D;B++){var U=k[1+B],O=N?N[B]:0,V=B>F?P[B-M]:0,Z=B>F&&N?N[B-M]:0,W=I(V,O,Z);P[B]=U+W}},A.prototype._reverseFilterLine=function(k){var P=k[0],D,M=this._images[this._imageIndex],F=M.byteWidth;if(P===0)D=k.slice(1,F+1);else switch(D=new S(F),P){case 1:this._unFilterType1(k,D,F);break;case 2:this._unFilterType2(k,D,F);break;case 3:this._unFilterType3(k,D,F);break;case 4:this._unFilterType4(k,D,F);break;default:throw new Error("Unrecognised filter type - "+P)}this.write(D),M.lineIndex++,M.lineIndex>=M.height?(this._lastLine=null,this._imageIndex++,M=this._images[this._imageIndex]):this._lastLine=D,M?this.read(M.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this,m("buffer").Buffer)},{"./interlace":120,"./paeth-predictor":124,buffer:48}],119:[function(m,x,E){(function(S){function h(A,k,P,D,M){for(var F=0,N=0;N<D;N++)for(var B=0;B<P;B++){var U=M[A[F]];if(!U)throw new Error("index "+A[F]+" not in palette");for(var O=0;O<4;O++)k[F+O]=U[O];F+=4}}function I(A,k,P,D,M){for(var F=0,N=0;N<D;N++)for(var B=0;B<P;B++){var U=!1;if(M.length===1?M[0]===A[F]&&(U=!0):M[0]===A[F]&&M[1]===A[F+1]&&M[2]===A[F+2]&&(U=!0),U)for(var O=0;O<4;O++)k[F+O]=0;F+=4}}function T(A,k,P,D,M){for(var F=255,N=Math.pow(2,M)-1,B=0,U=0;U<D;U++)for(var O=0;O<P;O++){for(var V=0;V<4;V++)k[B+V]=Math.floor(A[B+V]*F/N+.5);B+=4}}x.exports=function(A,k){var P=k.depth,D=k.width,M=k.height,F=k.colorType,N=k.transColor,B=k.palette,U=A;return F===3?h(A,U,D,M,B):(N&&I(A,U,D,M,N),P!==8&&(P===16&&(U=new S(D*M*4)),T(A,U,D,M,P))),U}}).call(this,m("buffer").Buffer)},{buffer:48}],120:[function(m,x,E){var S=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];E.getImagePasses=function(h,I){for(var T=[],A=h%8,k=I%8,P=(h-A)/8,D=(I-k)/8,M=0;M<S.length;M++){for(var F=S[M],N=P*F.x.length,B=D*F.y.length,U=0;U<F.x.length&&F.x[U]<A;U++)N++;for(U=0;U<F.y.length&&F.y[U]<k;U++)B++;N>0&&B>0&&T.push({width:N,height:B,index:M})}return T},E.getInterlaceIterator=function(h){return function(I,T,A){var k=I%S[A].x.length,P=(I-k)/S[A].x.length*8+S[A].x[k],D=T%S[A].y.length,M=(T-D)/S[A].y.length*8+S[A].y[D];return P*4+M*h*4}}},{}],121:[function(m,x,E){(function(S){var h=m("util"),I=m("stream"),T=m("./constants"),A=m("./packer"),k=x.exports=function(P){I.call(this);var D=P||{};this._packer=new A(D),this._deflate=this._packer.createDeflate(),this.readable=!0};h.inherits(k,I),k.prototype.pack=function(P,D,M,F){this.emit("data",new S(T.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(D,M)),F&&this.emit("data",this._packer.packGAMA(F));var N=this._packer.filterData(P,D,M);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(B){this.emit("data",this._packer.packIDAT(B))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(N)}}).call(this,m("buffer").Buffer)},{"./constants":113,"./packer":123,buffer:48,stream:155,util:186}],122:[function(m,x,E){(function(S){var h=!0,I=m("zlib");I.deflateSync||(h=!1);var T=m("./constants"),A=m("./packer");x.exports=function(k,P){if(!h)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var D=P||{},M=new A(D),F=[];F.push(new S(T.PNG_SIGNATURE)),F.push(M.packIHDR(k.width,k.height)),k.gamma&&F.push(M.packGAMA(k.gamma));var N=M.filterData(k.data,k.width,k.height),B=I.deflateSync(N,M.getDeflateOptions());if(N=null,!B||!B.length)throw new Error("bad png - invalid compressed data response");return F.push(M.packIDAT(B)),F.push(M.packIEND()),S.concat(F)}}).call(this,m("buffer").Buffer)},{"./constants":113,"./packer":123,buffer:48,zlib:35}],123:[function(m,x,E){(function(S){var h=m("./constants"),I=m("./crc"),T=m("./bitpacker"),A=m("./filter-pack"),k=m("zlib"),P=x.exports=function(D){if(this._options=D,D.deflateChunkSize=D.deflateChunkSize||32*1024,D.deflateLevel=D.deflateLevel!=null?D.deflateLevel:9,D.deflateStrategy=D.deflateStrategy!=null?D.deflateStrategy:3,D.inputHasAlpha=D.inputHasAlpha!=null?D.inputHasAlpha:!0,D.deflateFactory=D.deflateFactory||k.createDeflate,D.bitDepth=D.bitDepth||8,D.colorType=typeof D.colorType=="number"?D.colorType:h.COLORTYPE_COLOR_ALPHA,D.inputColorType=typeof D.inputColorType=="number"?D.inputColorType:h.COLORTYPE_COLOR_ALPHA,[h.COLORTYPE_GRAYSCALE,h.COLORTYPE_COLOR,h.COLORTYPE_COLOR_ALPHA,h.COLORTYPE_ALPHA].indexOf(D.colorType)===-1)throw new Error("option color type:"+D.colorType+" is not supported at present");if([h.COLORTYPE_GRAYSCALE,h.COLORTYPE_COLOR,h.COLORTYPE_COLOR_ALPHA,h.COLORTYPE_ALPHA].indexOf(D.inputColorType)===-1)throw new Error("option input color type:"+D.inputColorType+" is not supported at present");if(D.bitDepth!==8&&D.bitDepth!==16)throw new Error("option bit depth:"+D.bitDepth+" is not supported at present")};P.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},P.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},P.prototype.filterData=function(D,M,F){var N=T(D,M,F,this._options),B=h.COLORTYPE_TO_BPP_MAP[this._options.colorType],U=A(N,M,F,this._options,B);return U},P.prototype._packChunk=function(D,M){var F=M?M.length:0,N=new S(F+12);return N.writeUInt32BE(F,0),N.writeUInt32BE(D,4),M&&M.copy(N,8),N.writeInt32BE(I.crc32(N.slice(4,N.length-4)),N.length-4),N},P.prototype.packGAMA=function(D){var M=new S(4);return M.writeUInt32BE(Math.floor(D*h.GAMMA_DIVISION),0),this._packChunk(h.TYPE_gAMA,M)},P.prototype.packIHDR=function(D,M){var F=new S(13);return F.writeUInt32BE(D,0),F.writeUInt32BE(M,4),F[8]=this._options.bitDepth,F[9]=this._options.colorType,F[10]=0,F[11]=0,F[12]=0,this._packChunk(h.TYPE_IHDR,F)},P.prototype.packIDAT=function(D){return this._packChunk(h.TYPE_IDAT,D)},P.prototype.packIEND=function(){return this._packChunk(h.TYPE_IEND,null)}}).call(this,m("buffer").Buffer)},{"./bitpacker":111,"./constants":113,"./crc":114,"./filter-pack":115,buffer:48,zlib:35}],124:[function(m,x,E){x.exports=function(h,I,T){var A=h+I-T,k=Math.abs(A-h),P=Math.abs(A-I),D=Math.abs(A-T);return k<=P&&k<=D?h:P<=D?I:T}},{}],125:[function(m,x,E){var S=m("util"),h=m("zlib"),I=m("./chunkstream"),T=m("./filter-parse-async"),A=m("./parser"),k=m("./bitmapper"),P=m("./format-normaliser"),D=x.exports=function(M){I.call(this),this._parser=new A(M,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this)}),this._options=M,this.writable=!0,this._parser.start()};S.inherits(D,I),D.prototype._handleError=function(M){this.emit("error",M),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},D.prototype._inflateData=function(M){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=h.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var F=(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3)+1,N=F*this._bitmapInfo.height,B=Math.max(N,h.Z_MIN_CHUNK);this._inflate=h.createInflate({chunkSize:B});var U=N,O=this.emit.bind(this,"error");this._inflate.on("error",function(Z){!U||O(Z)}),this._filter.on("complete",this._complete.bind(this));var V=this._filter.write.bind(this._filter);this._inflate.on("data",function(Z){!U||(Z.length>U&&(Z=Z.slice(0,U)),U-=Z.length,V(Z))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(M)},D.prototype._handleMetaData=function(M){this.emit("metadata",M),this._bitmapInfo=Object.create(M),this._filter=new T(this._bitmapInfo)},D.prototype._handleTransColor=function(M){this._bitmapInfo.transColor=M},D.prototype._handlePalette=function(M){this._bitmapInfo.palette=M},D.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"),this.destroySoon())},D.prototype._complete=function(M){if(!this.errord){try{var F=k.dataToBitMap(M,this._bitmapInfo),N=P(F,this._bitmapInfo);F=null}catch(B){this._handleError(B);return}this.emit("parsed",N)}}},{"./bitmapper":110,"./chunkstream":112,"./filter-parse-async":116,"./format-normaliser":119,"./parser":127,util:186,zlib:35}],126:[function(m,x,E){(function(S){var h=!0,I=m("zlib"),T=m("./sync-inflate");I.deflateSync||(h=!1);var A=m("./sync-reader"),k=m("./filter-parse-sync"),P=m("./parser"),D=m("./bitmapper"),M=m("./format-normaliser");x.exports=function(F,N){if(!h)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var B;function U(Le){B=Le}var O;function V(Le){O=Le}function Z(Le){O.transColor=Le}function W(Le){O.palette=Le}var Y;function X(Le){Y=Le}var J=[];function q(Le){J.push(Le)}var te=new A(F),ne=new P(N,{read:te.read.bind(te),error:U,metadata:V,gamma:X,palette:W,transColor:Z,inflateData:q});if(ne.start(),te.process(),B)throw B;var de=S.concat(J);J.length=0;var oe;if(O.interlace)oe=I.inflateSync(de);else{var we=(O.width*O.bpp*O.depth+7>>3)+1,Ae=we*O.height;oe=T(de,{chunkSize:Ae,maxLength:Ae})}if(de=null,!oe||!oe.length)throw new Error("bad png - invalid inflate data response");var ye=k.process(oe,O);de=null;var me=D.dataToBitMap(ye,O);ye=null;var xe=M(me,O);return O.data=xe,O.gamma=Y||0,O}}).call(this,m("buffer").Buffer)},{"./bitmapper":110,"./filter-parse-sync":117,"./format-normaliser":119,"./parser":127,"./sync-inflate":130,"./sync-reader":131,buffer:48,zlib:35}],127:[function(m,x,E){(function(S){var h=m("./constants"),I=m("./crc"),T=x.exports=function(A,k){this._options=A,A.checkCRC=A.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[h.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[h.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[h.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[h.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[h.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[h.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=k.read,this.error=k.error,this.metadata=k.metadata,this.gamma=k.gamma,this.transColor=k.transColor,this.palette=k.palette,this.parsed=k.parsed,this.inflateData=k.inflateData,this.finished=k.finished};T.prototype.start=function(){this.read(h.PNG_SIGNATURE.length,this._parseSignature.bind(this))},T.prototype._parseSignature=function(A){for(var k=h.PNG_SIGNATURE,P=0;P<k.length;P++)if(A[P]!==k[P]){this.error(new Error("Invalid file signature"));return}this.read(8,this._parseChunkBegin.bind(this))},T.prototype._parseChunkBegin=function(A){for(var k=A.readUInt32BE(0),P=A.readUInt32BE(4),D="",M=4;M<8;M++)D+=String.fromCharCode(A[M]);var F=Boolean(A[4]&32);if(!this._hasIHDR&&P!==h.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}if(this._crc=new I,this._crc.write(new S(D)),this._chunks[P])return this._chunks[P](k);if(!F){this.error(new Error("Unsupported critical chunk type "+D));return}this.read(k+4,this._skipChunk.bind(this))},T.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},T.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},T.prototype._parseChunkEnd=function(A){var k=A.readInt32BE(0),P=this._crc.crc32();if(this._options.checkCRC&&P!==k){this.error(new Error("Crc error - "+k+" - "+P));return}this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},T.prototype._handleIHDR=function(A){this.read(A,this._parseIHDR.bind(this))},T.prototype._parseIHDR=function(A){this._crc.write(A);var k=A.readUInt32BE(0),P=A.readUInt32BE(4),D=A[8],M=A[9],F=A[10],N=A[11],B=A[12];if(D!==8&&D!==4&&D!==2&&D!==1&&D!==16){this.error(new Error("Unsupported bit depth "+D));return}if(!(M in h.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(F!==0){this.error(new Error("Unsupported compression method"));return}if(N!==0){this.error(new Error("Unsupported filter method"));return}if(B!==0&&B!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=M;var U=h.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:k,height:P,depth:D,interlace:Boolean(B),palette:Boolean(M&h.COLORTYPE_PALETTE),color:Boolean(M&h.COLORTYPE_COLOR),alpha:Boolean(M&h.COLORTYPE_ALPHA),bpp:U,colorType:M}),this._handleChunkEnd()},T.prototype._handlePLTE=function(A){this.read(A,this._parsePLTE.bind(this))},T.prototype._parsePLTE=function(A){this._crc.write(A);for(var k=Math.floor(A.length/3),P=0;P<k;P++)this._palette.push([A[P*3],A[P*3+1],A[P*3+2],255]);this.palette(this._palette),this._handleChunkEnd()},T.prototype._handleTRNS=function(A){this.read(A,this._parseTRNS.bind(this))},T.prototype._parseTRNS=function(A){if(this._crc.write(A),this._colorType===h.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(A.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(var k=0;k<A.length;k++)this._palette[k][3]=A[k];this.palette(this._palette)}this._colorType===h.COLORTYPE_GRAYSCALE&&this.transColor([A.readUInt16BE(0)]),this._colorType===h.COLORTYPE_COLOR&&this.transColor([A.readUInt16BE(0),A.readUInt16BE(2),A.readUInt16BE(4)]),this._handleChunkEnd()},T.prototype._handleGAMA=function(A){this.read(A,this._parseGAMA.bind(this))},T.prototype._parseGAMA=function(A){this._crc.write(A),this.gamma(A.readUInt32BE(0)/h.GAMMA_DIVISION),this._handleChunkEnd()},T.prototype._handleIDAT=function(A){this.read(-A,this._parseIDAT.bind(this,A))},T.prototype._parseIDAT=function(A,k){if(this._crc.write(k),this._colorType===h.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(k);var P=A-k.length;P>0?this._handleIDAT(P):this._handleChunkEnd()},T.prototype._handleIEND=function(A){this.read(A,this._parseIEND.bind(this))},T.prototype._parseIEND=function(A){this._crc.write(A),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this,m("buffer").Buffer)},{"./constants":113,"./crc":114,buffer:48}],128:[function(m,x,E){var S=m("./parser-sync"),h=m("./packer-sync");E.read=function(I,T){return S(I,T||{})},E.write=function(I,T){return h(I,T)}},{"./packer-sync":122,"./parser-sync":126}],129:[function(m,x,E){(function(S,h){var I=m("util"),T=m("stream"),A=m("./parser-async"),k=m("./packer-async"),P=m("./png-sync"),D=E.PNG=function(M){T.call(this),M=M||{},this.width=M.width|0,this.height=M.height|0,this.data=this.width>0&&this.height>0?new h(4*this.width*this.height):null,M.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new A(M),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(F){this.data=F,this.emit("parsed",F)}.bind(this)),this._packer=new k(M),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};I.inherits(D,T),D.sync=P,D.prototype.pack=function(){return!this.data||!this.data.length?(this.emit("error","No data provided"),this):(S.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this)},D.prototype.parse=function(M,F){if(F){var N,B;N=function(U){this.removeListener("error",B),this.data=U,F(null,this)}.bind(this),B=function(U){this.removeListener("parsed",N),F(U,null)}.bind(this),this.once("parsed",N),this.once("error",B)}return this.end(M),this},D.prototype.write=function(M){return this._parser.write(M),!0},D.prototype.end=function(M){this._parser.end(M)},D.prototype._metadata=function(M){this.width=M.width,this.height=M.height,this.emit("metadata",M)},D.prototype._gamma=function(M){this.gamma=M},D.prototype._handleClose=function(){!this._parser.writable&&!this._packer.readable&&this.emit("close")},D.bitblt=function(M,F,N,B,U,O,V,Z){if(N|=0,B|=0,U|=0,O|=0,V|=0,Z|=0,N>M.width||B>M.height||N+U>M.width||B+O>M.height)throw new Error("bitblt reading outside image");if(V>F.width||Z>F.height||V+U>F.width||Z+O>F.height)throw new Error("bitblt writing outside image");for(var W=0;W<O;W++)M.data.copy(F.data,(Z+W)*F.width+V<<2,(B+W)*M.width+N<<2,(B+W)*M.width+N+U<<2)},D.prototype.bitblt=function(M,F,N,B,U,O,V){return D.bitblt(this,M,F,N,B,U,O,V),this},D.adjustGamma=function(M){if(M.gamma){for(var F=0;F<M.height;F++)for(var N=0;N<M.width;N++)for(var B=M.width*F+N<<2,U=0;U<3;U++){var O=M.data[B+U]/255;O=Math.pow(O,1/2.2/M.gamma),M.data[B+U]=Math.round(O*255)}M.gamma=0}},D.prototype.adjustGamma=function(){D.adjustGamma(this)}}).call(this,m("_process"),m("buffer").Buffer)},{"./packer-async":121,"./parser-async":125,"./png-sync":128,_process:133,buffer:48,stream:155,util:186}],130:[function(m,x,E){(function(S,h){var I=m("assert").ok,T=m("zlib"),A=m("util"),k=m("buffer").kMaxLength;function P(B){if(!(this instanceof P))return new P(B);B&&B.chunkSize<T.Z_MIN_CHUNK&&(B.chunkSize=T.Z_MIN_CHUNK),T.Inflate.call(this,B),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,B&&B.maxLength!=null&&(this._maxLength=B.maxLength)}function D(B){return new P(B)}function M(B,U){U&&S.nextTick(U),!!B._handle&&(B._handle.close(),B._handle=null)}P.prototype._processChunk=function(B,U,O){if(typeof O=="function")return T.Inflate._processChunk.call(this,B,U,O);var V=this,Z=B&&B.length,W=this._chunkSize-this._offset,Y=this._maxLength,X=0,J=[],q=0,te;this.on("error",function(we){te=we});function ne(we,Ae){if(!V._hadError){var ye=W-Ae;if(I(ye>=0,"have should not go down"),ye>0){var me=V._buffer.slice(V._offset,V._offset+ye);if(V._offset+=ye,me.length>Y&&(me=me.slice(0,Y)),J.push(me),q+=me.length,Y-=me.length,Y===0)return!1}return(Ae===0||V._offset>=V._chunkSize)&&(W=V._chunkSize,V._offset=0,V._buffer=h.allocUnsafe(V._chunkSize)),Ae===0?(X+=Z-we,Z=we,!0):!1}}I(this._handle,"zlib binding closed");do{var de=this._handle.writeSync(U,B,X,Z,this._buffer,this._offset,W);de=de||this._writeState}while(!this._hadError&&ne(de[0],de[1]));if(this._hadError)throw te;if(q>=k)throw M(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+k.toString(16)+" bytes");var oe=h.concat(J,q);return M(this),oe},A.inherits(P,T.Inflate);function F(B,U){if(typeof U=="string"&&(U=h.from(U)),!(U instanceof h))throw new TypeError("Not a string or buffer");var O=B._finishFlushFlag;return O==null&&(O=T.Z_FINISH),B._processChunk(U,O)}function N(B,U){return F(new P(U),B)}x.exports=E=N,E.Inflate=P,E.createInflate=D,E.inflateSync=N}).call(this,m("_process"),m("buffer").Buffer)},{_process:133,assert:25,buffer:48,util:186,zlib:35}],131:[function(m,x,E){var S=x.exports=function(h){this._buffer=h,this._reads=[]};S.prototype.read=function(h,I){this._reads.push({length:Math.abs(h),allowLess:h<0,func:I})},S.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){var h=this._reads[0];if(this._buffer.length&&(this._buffer.length>=h.length||h.allowLess)){this._reads.shift();var I=this._buffer;this._buffer=I.slice(h.length),h.func.call(this,I.slice(0,h.length))}else break}if(this._reads.length>0)return new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)return new Error("unrecognised content at end of stream")}},{}],132:[function(m,x,E){(function(S){typeof S=="undefined"||!S.version||S.version.indexOf("v0.")===0||S.version.indexOf("v1.")===0&&S.version.indexOf("v1.8.")!==0?x.exports={nextTick:h}:x.exports=S;function h(I,T,A,k){if(typeof I!="function")throw new TypeError('"callback" argument must be a function');var P=arguments.length,D,M;switch(P){case 0:case 1:return S.nextTick(I);case 2:return S.nextTick(function(){I.call(null,T)});case 3:return S.nextTick(function(){I.call(null,T,A)});case 4:return S.nextTick(function(){I.call(null,T,A,k)});default:for(D=new Array(P-1),M=0;M<D.length;)D[M++]=arguments[M];return S.nextTick(function(){I.apply(null,D)})}}}).call(this,m("_process"))},{_process:133}],133:[function(m,x,E){var S=x.exports={},h,I;function T(){throw new Error("setTimeout has not been defined")}function A(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?h=setTimeout:h=T}catch{h=T}try{typeof clearTimeout=="function"?I=clearTimeout:I=A}catch{I=A}})();function k(Z){if(h===setTimeout)return setTimeout(Z,0);if((h===T||!h)&&setTimeout)return h=setTimeout,setTimeout(Z,0);try{return h(Z,0)}catch{try{return h.call(null,Z,0)}catch{return h.call(this,Z,0)}}}function P(Z){if(I===clearTimeout)return clearTimeout(Z);if((I===A||!I)&&clearTimeout)return I=clearTimeout,clearTimeout(Z);try{return I(Z)}catch{try{return I.call(null,Z)}catch{return I.call(this,Z)}}}var D=[],M=!1,F,N=-1;function B(){!M||!F||(M=!1,F.length?D=F.concat(D):N=-1,D.length&&U())}function U(){if(!M){var Z=k(B);M=!0;for(var W=D.length;W;){for(F=D,D=[];++N<W;)F&&F[N].run();N=-1,W=D.length}F=null,M=!1,P(Z)}}S.nextTick=function(Z){var W=new Array(arguments.length-1);if(arguments.length>1)for(var Y=1;Y<arguments.length;Y++)W[Y-1]=arguments[Y];D.push(new O(Z,W)),D.length===1&&!M&&k(U)};function O(Z,W){this.fun=Z,this.array=W}O.prototype.run=function(){this.fun.apply(null,this.array)},S.title="browser",S.browser=!0,S.argv=[],S.version="",S.versions={};function V(){}S.on=V,S.addListener=V,S.once=V,S.off=V,S.removeListener=V,S.removeAllListeners=V,S.emit=V,S.prependListener=V,S.prependOnceListener=V,S.listeners=function(Z){return[]},S.binding=function(Z){throw new Error("process.binding is not supported")},S.cwd=function(){return"/"},S.chdir=function(Z){throw new Error("process.chdir is not supported")},S.umask=function(){return 0}},{}],134:[function(m,x,E){(function(S){(function(h){var I=typeof E=="object"&&E&&!E.nodeType&&E,T=typeof x=="object"&&x&&!x.nodeType&&x,A=typeof S=="object"&&S;(A.global===A||A.window===A||A.self===A)&&(h=A);var k,P=2147483647,D=36,M=1,F=26,N=38,B=700,U=72,O=128,V="-",Z=/^xn--/,W=/[^\x20-\x7E]/,Y=/[\x2E\u3002\uFF0E\uFF61]/g,X={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},J=D-M,q=Math.floor,te=String.fromCharCode,ne;function de(Pe){throw new RangeError(X[Pe])}function oe(Pe,De){for(var ze=Pe.length,it=[];ze--;)it[ze]=De(Pe[ze]);return it}function we(Pe,De){var ze=Pe.split("@"),it="";ze.length>1&&(it=ze[0]+"@",Pe=ze[1]),Pe=Pe.replace(Y,".");var tt=Pe.split("."),ot=oe(tt,De).join(".");return it+ot}function Ae(Pe){for(var De=[],ze=0,it=Pe.length,tt,ot;ze<it;)tt=Pe.charCodeAt(ze++),tt>=55296&&tt<=56319&&ze<it?(ot=Pe.charCodeAt(ze++),(ot&64512)==56320?De.push(((tt&1023)<<10)+(ot&1023)+65536):(De.push(tt),ze--)):De.push(tt);return De}function ye(Pe){return oe(Pe,function(De){var ze="";return De>65535&&(De-=65536,ze+=te(De>>>10&1023|55296),De=56320|De&1023),ze+=te(De),ze}).join("")}function me(Pe){return Pe-48<10?Pe-22:Pe-65<26?Pe-65:Pe-97<26?Pe-97:D}function xe(Pe,De){return Pe+22+75*(Pe<26)-((De!=0)<<5)}function Le(Pe,De,ze){var it=0;for(Pe=ze?q(Pe/B):Pe>>1,Pe+=q(Pe/De);Pe>J*F>>1;it+=D)Pe=q(Pe/J);return q(it+(J+1)*Pe/(Pe+N))}function Ze(Pe){var De=[],ze=Pe.length,it,tt=0,ot=O,lt=U,St,et,Je,Be,Ge,He,ve,_e,pe;for(St=Pe.lastIndexOf(V),St<0&&(St=0),et=0;et<St;++et)Pe.charCodeAt(et)>=128&&de("not-basic"),De.push(Pe.charCodeAt(et));for(Je=St>0?St+1:0;Je<ze;){for(Be=tt,Ge=1,He=D;Je>=ze&&de("invalid-input"),ve=me(Pe.charCodeAt(Je++)),(ve>=D||ve>q((P-tt)/Ge))&&de("overflow"),tt+=ve*Ge,_e=He<=lt?M:He>=lt+F?F:He-lt,!(ve<_e);He+=D)pe=D-_e,Ge>q(P/pe)&&de("overflow"),Ge*=pe;it=De.length+1,lt=Le(tt-Be,it,Be==0),q(tt/it)>P-ot&&de("overflow"),ot+=q(tt/it),tt%=it,De.splice(tt++,0,ot)}return ye(De)}function Xe(Pe){var De,ze,it,tt,ot,lt,St,et,Je,Be,Ge,He=[],ve,_e,pe,fe;for(Pe=Ae(Pe),ve=Pe.length,De=O,ze=0,ot=U,lt=0;lt<ve;++lt)Ge=Pe[lt],Ge<128&&He.push(te(Ge));for(it=tt=He.length,tt&&He.push(V);it<ve;){for(St=P,lt=0;lt<ve;++lt)Ge=Pe[lt],Ge>=De&&Ge<St&&(St=Ge);for(_e=it+1,St-De>q((P-ze)/_e)&&de("overflow"),ze+=(St-De)*_e,De=St,lt=0;lt<ve;++lt)if(Ge=Pe[lt],Ge<De&&++ze>P&&de("overflow"),Ge==De){for(et=ze,Je=D;Be=Je<=ot?M:Je>=ot+F?F:Je-ot,!(et<Be);Je+=D)fe=et-Be,pe=D-Be,He.push(te(xe(Be+fe%pe,0))),et=q(fe/pe);He.push(te(xe(et,0))),ot=Le(ze,_e,it==tt),ze=0,++it}++ze,++De}return He.join("")}function je(Pe){return we(Pe,function(De){return Z.test(De)?Ze(De.slice(4).toLowerCase()):De})}function Ie(Pe){return we(Pe,function(De){return W.test(De)?"xn--"+Xe(De):De})}if(k={version:"1.4.1",ucs2:{decode:Ae,encode:ye},decode:Ze,encode:Xe,toASCII:Ie,toUnicode:je},I&&T)if(x.exports==I)T.exports=k;else for(ne in k)k.hasOwnProperty(ne)&&(I[ne]=k[ne]);else h.punycode=k})(this)}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{}],135:[function(m,x,E){function S(I,T){return Object.prototype.hasOwnProperty.call(I,T)}x.exports=function(I,T,A,k){T=T||"&",A=A||"=";var P={};if(typeof I!="string"||I.length===0)return P;var D=/\+/g;I=I.split(T);var M=1e3;k&&typeof k.maxKeys=="number"&&(M=k.maxKeys);var F=I.length;M>0&&F>M&&(F=M);for(var N=0;N<F;++N){var B=I[N].replace(D,"%20"),U=B.indexOf(A),O,V,Z,W;U>=0?(O=B.substr(0,U),V=B.substr(U+1)):(O=B,V=""),Z=decodeURIComponent(O),W=decodeURIComponent(V),S(P,Z)?h(P[Z])?P[Z].push(W):P[Z]=[P[Z],W]:P[Z]=W}return P};var h=Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"}},{}],136:[function(m,x,E){var S=function(A){switch(typeof A){case"string":return A;case"boolean":return A?"true":"false";case"number":return isFinite(A)?A:"";default:return""}};x.exports=function(A,k,P,D){return k=k||"&",P=P||"=",A===null&&(A=void 0),typeof A=="object"?I(T(A),function(M){var F=encodeURIComponent(S(M))+P;return h(A[M])?I(A[M],function(N){return F+encodeURIComponent(S(N))}).join(k):F+encodeURIComponent(S(A[M]))}).join(k):D?encodeURIComponent(S(D))+P+encodeURIComponent(S(A)):""};var h=Array.isArray||function(A){return Object.prototype.toString.call(A)==="[object Array]"};function I(A,k){if(A.map)return A.map(k);for(var P=[],D=0;D<A.length;D++)P.push(k(A[D],D));return P}var T=Object.keys||function(A){var k=[];for(var P in A)Object.prototype.hasOwnProperty.call(A,P)&&k.push(P);return k}},{}],137:[function(m,x,E){E.decode=E.parse=m("./decode"),E.encode=E.stringify=m("./encode")},{"./decode":135,"./encode":136}],138:[function(m,x,E){x.exports=m("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":139}],139:[function(m,x,E){var S=m("process-nextick-args"),h=Object.keys||function(B){var U=[];for(var O in B)U.push(O);return U};x.exports=M;var I=m("core-util-is");I.inherits=m("inherits");var T=m("./_stream_readable"),A=m("./_stream_writable");I.inherits(M,T);for(var k=h(A.prototype),P=0;P<k.length;P++){var D=k[P];M.prototype[D]||(M.prototype[D]=A.prototype[D])}function M(B){if(!(this instanceof M))return new M(B);T.call(this,B),A.call(this,B),B&&B.readable===!1&&(this.readable=!1),B&&B.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,B&&B.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",F)}Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function F(){this.allowHalfOpen||this._writableState.ended||S.nextTick(N,this)}function N(B){B.end()}Object.defineProperty(M.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(B){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=B,this._writableState.destroyed=B)}}),M.prototype._destroy=function(B,U){this.push(null),this.end(),S.nextTick(U,B)}},{"./_stream_readable":141,"./_stream_writable":143,"core-util-is":51,inherits:75,"process-nextick-args":132}],140:[function(m,x,E){x.exports=I;var S=m("./_stream_transform"),h=m("core-util-is");h.inherits=m("inherits"),h.inherits(I,S);function I(T){if(!(this instanceof I))return new I(T);S.call(this,T)}I.prototype._transform=function(T,A,k){k(null,T)}},{"./_stream_transform":142,"core-util-is":51,inherits:75}],141:[function(m,x,E){(function(S,h){var I=m("process-nextick-args");x.exports=q;var T=m("isarray"),A;q.ReadableState=J,m("events").EventEmitter;var k=function(Be,Ge){return Be.listeners(Ge).length},P=m("./internal/streams/stream"),D=m("safe-buffer").Buffer,M=h.Uint8Array||function(){};function F(Be){return D.from(Be)}function N(Be){return D.isBuffer(Be)||Be instanceof M}var B=m("core-util-is");B.inherits=m("inherits");var U=m("util"),O=void 0;U&&U.debuglog?O=U.debuglog("stream"):O=function(){};var V=m("./internal/streams/BufferList"),Z=m("./internal/streams/destroy"),W;B.inherits(q,P);var Y=["error","close","destroy","pause","resume"];function X(Be,Ge,He){if(typeof Be.prependListener=="function")return Be.prependListener(Ge,He);!Be._events||!Be._events[Ge]?Be.on(Ge,He):T(Be._events[Ge])?Be._events[Ge].unshift(He):Be._events[Ge]=[He,Be._events[Ge]]}function J(Be,Ge){A=A||m("./_stream_duplex"),Be=Be||{};var He=Ge instanceof A;this.objectMode=!!Be.objectMode,He&&(this.objectMode=this.objectMode||!!Be.readableObjectMode);var ve=Be.highWaterMark,_e=Be.readableHighWaterMark,pe=this.objectMode?16:16*1024;ve||ve===0?this.highWaterMark=ve:He&&(_e||_e===0)?this.highWaterMark=_e:this.highWaterMark=pe,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new V,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=Be.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Be.encoding&&(W||(W=m("string_decoder/").StringDecoder),this.decoder=new W(Be.encoding),this.encoding=Be.encoding)}function q(Be){if(A=A||m("./_stream_duplex"),!(this instanceof q))return new q(Be);this._readableState=new J(Be,this),this.readable=!0,Be&&(typeof Be.read=="function"&&(this._read=Be.read),typeof Be.destroy=="function"&&(this._destroy=Be.destroy)),P.call(this)}Object.defineProperty(q.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Be){!this._readableState||(this._readableState.destroyed=Be)}}),q.prototype.destroy=Z.destroy,q.prototype._undestroy=Z.undestroy,q.prototype._destroy=function(Be,Ge){this.push(null),Ge(Be)},q.prototype.push=function(Be,Ge){var He=this._readableState,ve;return He.objectMode?ve=!0:typeof Be=="string"&&(Ge=Ge||He.defaultEncoding,Ge!==He.encoding&&(Be=D.from(Be,Ge),Ge=""),ve=!0),te(this,Be,Ge,!1,ve)},q.prototype.unshift=function(Be){return te(this,Be,null,!0,!1)};function te(Be,Ge,He,ve,_e){var pe=Be._readableState;if(Ge===null)pe.reading=!1,me(Be,pe);else{var fe;_e||(fe=de(pe,Ge)),fe?Be.emit("error",fe):pe.objectMode||Ge&&Ge.length>0?(typeof Ge!="string"&&!pe.objectMode&&Object.getPrototypeOf(Ge)!==D.prototype&&(Ge=F(Ge)),ve?pe.endEmitted?Be.emit("error",new Error("stream.unshift() after end event")):ne(Be,pe,Ge,!0):pe.ended?Be.emit("error",new Error("stream.push() after EOF")):(pe.reading=!1,pe.decoder&&!He?(Ge=pe.decoder.write(Ge),pe.objectMode||Ge.length!==0?ne(Be,pe,Ge,!1):Ze(Be,pe)):ne(Be,pe,Ge,!1))):ve||(pe.reading=!1)}return oe(pe)}function ne(Be,Ge,He,ve){Ge.flowing&&Ge.length===0&&!Ge.sync?(Be.emit("data",He),Be.read(0)):(Ge.length+=Ge.objectMode?1:He.length,ve?Ge.buffer.unshift(He):Ge.buffer.push(He),Ge.needReadable&&xe(Be)),Ze(Be,Ge)}function de(Be,Ge){var He;return!N(Ge)&&typeof Ge!="string"&&Ge!==void 0&&!Be.objectMode&&(He=new TypeError("Invalid non-string/buffer chunk")),He}function oe(Be){return!Be.ended&&(Be.needReadable||Be.length<Be.highWaterMark||Be.length===0)}q.prototype.isPaused=function(){return this._readableState.flowing===!1},q.prototype.setEncoding=function(Be){return W||(W=m("string_decoder/").StringDecoder),this._readableState.decoder=new W(Be),this._readableState.encoding=Be,this};var we=8388608;function Ae(Be){return Be>=we?Be=we:(Be--,Be|=Be>>>1,Be|=Be>>>2,Be|=Be>>>4,Be|=Be>>>8,Be|=Be>>>16,Be++),Be}function ye(Be,Ge){return Be<=0||Ge.length===0&&Ge.ended?0:Ge.objectMode?1:Be!==Be?Ge.flowing&&Ge.length?Ge.buffer.head.data.length:Ge.length:(Be>Ge.highWaterMark&&(Ge.highWaterMark=Ae(Be)),Be<=Ge.length?Be:Ge.ended?Ge.length:(Ge.needReadable=!0,0))}q.prototype.read=function(Be){O("read",Be),Be=parseInt(Be,10);var Ge=this._readableState,He=Be;if(Be!==0&&(Ge.emittedReadable=!1),Be===0&&Ge.needReadable&&(Ge.length>=Ge.highWaterMark||Ge.ended))return O("read: emitReadable",Ge.length,Ge.ended),Ge.length===0&&Ge.ended?St(this):xe(this),null;if(Be=ye(Be,Ge),Be===0&&Ge.ended)return Ge.length===0&&St(this),null;var ve=Ge.needReadable;O("need readable",ve),(Ge.length===0||Ge.length-Be<Ge.highWaterMark)&&(ve=!0,O("length less than watermark",ve)),Ge.ended||Ge.reading?(ve=!1,O("reading or ended",ve)):ve&&(O("do read"),Ge.reading=!0,Ge.sync=!0,Ge.length===0&&(Ge.needReadable=!0),this._read(Ge.highWaterMark),Ge.sync=!1,Ge.reading||(Be=ye(He,Ge)));var _e;return Be>0?_e=it(Be,Ge):_e=null,_e===null?(Ge.needReadable=!0,Be=0):Ge.length-=Be,Ge.length===0&&(Ge.ended||(Ge.needReadable=!0),He!==Be&&Ge.ended&&St(this)),_e!==null&&this.emit("data",_e),_e};function me(Be,Ge){if(!Ge.ended){if(Ge.decoder){var He=Ge.decoder.end();He&&He.length&&(Ge.buffer.push(He),Ge.length+=Ge.objectMode?1:He.length)}Ge.ended=!0,xe(Be)}}function xe(Be){var Ge=Be._readableState;Ge.needReadable=!1,Ge.emittedReadable||(O("emitReadable",Ge.flowing),Ge.emittedReadable=!0,Ge.sync?I.nextTick(Le,Be):Le(Be))}function Le(Be){O("emit readable"),Be.emit("readable"),ze(Be)}function Ze(Be,Ge){Ge.readingMore||(Ge.readingMore=!0,I.nextTick(Xe,Be,Ge))}function Xe(Be,Ge){for(var He=Ge.length;!Ge.reading&&!Ge.flowing&&!Ge.ended&&Ge.length<Ge.highWaterMark&&(O("maybeReadMore read 0"),Be.read(0),He!==Ge.length);)He=Ge.length;Ge.readingMore=!1}q.prototype._read=function(Be){this.emit("error",new Error("_read() is not implemented"))},q.prototype.pipe=function(Be,Ge){var He=this,ve=this._readableState;switch(ve.pipesCount){case 0:ve.pipes=Be;break;case 1:ve.pipes=[ve.pipes,Be];break;default:ve.pipes.push(Be);break}ve.pipesCount+=1,O("pipe count=%d opts=%j",ve.pipesCount,Ge);var _e=(!Ge||Ge.end!==!1)&&Be!==S.stdout&&Be!==S.stderr,pe=_e?ue:ii;ve.endEmitted?I.nextTick(pe):He.once("end",pe),Be.on("unpipe",fe);function fe(zt,qt){O("onunpipe"),zt===He&&qt&&qt.hasUnpiped===!1&&(qt.hasUnpiped=!0,Ye())}function ue(){O("onend"),Be.end()}var ce=je(He);Be.on("drain",ce);var Ee=!1;function Ye(){O("cleanup"),Be.removeListener("close",$t),Be.removeListener("finish",Yt),Be.removeListener("drain",ce),Be.removeListener("error",It),Be.removeListener("unpipe",fe),He.removeListener("end",ue),He.removeListener("end",ii),He.removeListener("data",_t),Ee=!0,ve.awaitDrain&&(!Be._writableState||Be._writableState.needDrain)&&ce()}var ft=!1;He.on("data",_t);function _t(zt){O("ondata"),ft=!1;var qt=Be.write(zt);qt===!1&&!ft&&((ve.pipesCount===1&&ve.pipes===Be||ve.pipesCount>1&&Je(ve.pipes,Be)!==-1)&&!Ee&&(O("false write response, pause",He._readableState.awaitDrain),He._readableState.awaitDrain++,ft=!0),He.pause())}function It(zt){O("onerror",zt),ii(),Be.removeListener("error",It),k(Be,"error")===0&&Be.emit("error",zt)}X(Be,"error",It);function $t(){Be.removeListener("finish",Yt),ii()}Be.once("close",$t);function Yt(){O("onfinish"),Be.removeListener("close",$t),ii()}Be.once("finish",Yt);function ii(){O("unpipe"),He.unpipe(Be)}return Be.emit("pipe",He),ve.flowing||(O("pipe resume"),He.resume()),Be};function je(Be){return function(){var Ge=Be._readableState;O("pipeOnDrain",Ge.awaitDrain),Ge.awaitDrain&&Ge.awaitDrain--,Ge.awaitDrain===0&&k(Be,"data")&&(Ge.flowing=!0,ze(Be))}}q.prototype.unpipe=function(Be){var Ge=this._readableState,He={hasUnpiped:!1};if(Ge.pipesCount===0)return this;if(Ge.pipesCount===1)return Be&&Be!==Ge.pipes?this:(Be||(Be=Ge.pipes),Ge.pipes=null,Ge.pipesCount=0,Ge.flowing=!1,Be&&Be.emit("unpipe",this,He),this);if(!Be){var ve=Ge.pipes,_e=Ge.pipesCount;Ge.pipes=null,Ge.pipesCount=0,Ge.flowing=!1;for(var pe=0;pe<_e;pe++)ve[pe].emit("unpipe",this,He);return this}var fe=Je(Ge.pipes,Be);return fe===-1?this:(Ge.pipes.splice(fe,1),Ge.pipesCount-=1,Ge.pipesCount===1&&(Ge.pipes=Ge.pipes[0]),Be.emit("unpipe",this,He),this)},q.prototype.on=function(Be,Ge){var He=P.prototype.on.call(this,Be,Ge);if(Be==="data")this._readableState.flowing!==!1&&this.resume();else if(Be==="readable"){var ve=this._readableState;!ve.endEmitted&&!ve.readableListening&&(ve.readableListening=ve.needReadable=!0,ve.emittedReadable=!1,ve.reading?ve.length&&xe(this):I.nextTick(Ie,this))}return He},q.prototype.addListener=q.prototype.on;function Ie(Be){O("readable nexttick read 0"),Be.read(0)}q.prototype.resume=function(){var Be=this._readableState;return Be.flowing||(O("resume"),Be.flowing=!0,Pe(this,Be)),this};function Pe(Be,Ge){Ge.resumeScheduled||(Ge.resumeScheduled=!0,I.nextTick(De,Be,Ge))}function De(Be,Ge){Ge.reading||(O("resume read 0"),Be.read(0)),Ge.resumeScheduled=!1,Ge.awaitDrain=0,Be.emit("resume"),ze(Be),Ge.flowing&&!Ge.reading&&Be.read(0)}q.prototype.pause=function(){return O("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(O("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function ze(Be){var Ge=Be._readableState;for(O("flow",Ge.flowing);Ge.flowing&&Be.read()!==null;);}q.prototype.wrap=function(Be){var Ge=this,He=this._readableState,ve=!1;Be.on("end",function(){if(O("wrapped end"),He.decoder&&!He.ended){var fe=He.decoder.end();fe&&fe.length&&Ge.push(fe)}Ge.push(null)}),Be.on("data",function(fe){if(O("wrapped data"),He.decoder&&(fe=He.decoder.write(fe)),!(He.objectMode&&fe==null)&&!(!He.objectMode&&(!fe||!fe.length))){var ue=Ge.push(fe);ue||(ve=!0,Be.pause())}});for(var _e in Be)this[_e]===void 0&&typeof Be[_e]=="function"&&(this[_e]=function(fe){return function(){return Be[fe].apply(Be,arguments)}}(_e));for(var pe=0;pe<Y.length;pe++)Be.on(Y[pe],this.emit.bind(this,Y[pe]));return this._read=function(fe){O("wrapped _read",fe),ve&&(ve=!1,Be.resume())},this},Object.defineProperty(q.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),q._fromList=it;function it(Be,Ge){if(Ge.length===0)return null;var He;return Ge.objectMode?He=Ge.buffer.shift():!Be||Be>=Ge.length?(Ge.decoder?He=Ge.buffer.join(""):Ge.buffer.length===1?He=Ge.buffer.head.data:He=Ge.buffer.concat(Ge.length),Ge.buffer.clear()):He=tt(Be,Ge.buffer,Ge.decoder),He}function tt(Be,Ge,He){var ve;return Be<Ge.head.data.length?(ve=Ge.head.data.slice(0,Be),Ge.head.data=Ge.head.data.slice(Be)):Be===Ge.head.data.length?ve=Ge.shift():ve=He?ot(Be,Ge):lt(Be,Ge),ve}function ot(Be,Ge){var He=Ge.head,ve=1,_e=He.data;for(Be-=_e.length;He=He.next;){var pe=He.data,fe=Be>pe.length?pe.length:Be;if(fe===pe.length?_e+=pe:_e+=pe.slice(0,Be),Be-=fe,Be===0){fe===pe.length?(++ve,He.next?Ge.head=He.next:Ge.head=Ge.tail=null):(Ge.head=He,He.data=pe.slice(fe));break}++ve}return Ge.length-=ve,_e}function lt(Be,Ge){var He=D.allocUnsafe(Be),ve=Ge.head,_e=1;for(ve.data.copy(He),Be-=ve.data.length;ve=ve.next;){var pe=ve.data,fe=Be>pe.length?pe.length:Be;if(pe.copy(He,He.length-Be,0,fe),Be-=fe,Be===0){fe===pe.length?(++_e,ve.next?Ge.head=ve.next:Ge.head=Ge.tail=null):(Ge.head=ve,ve.data=pe.slice(fe));break}++_e}return Ge.length-=_e,He}function St(Be){var Ge=Be._readableState;if(Ge.length>0)throw new Error('"endReadable()" called on non-empty stream');Ge.endEmitted||(Ge.ended=!0,I.nextTick(et,Ge,Be))}function et(Be,Ge){!Be.endEmitted&&Be.length===0&&(Be.endEmitted=!0,Ge.readable=!1,Ge.emit("end"))}function Je(Be,Ge){for(var He=0,ve=Be.length;He<ve;He++)if(Be[He]===Ge)return He;return-1}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"./_stream_duplex":139,"./internal/streams/BufferList":144,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:133,"core-util-is":51,events:52,inherits:75,isarray:79,"process-nextick-args":132,"safe-buffer":147,"string_decoder/":148,util:33}],142:[function(m,x,E){x.exports=T;var S=m("./_stream_duplex"),h=m("core-util-is");h.inherits=m("inherits"),h.inherits(T,S);function I(P,D){var M=this._transformState;M.transforming=!1;var F=M.writecb;if(!F)return this.emit("error",new Error("write callback called multiple times"));M.writechunk=null,M.writecb=null,D!=null&&this.push(D),F(P);var N=this._readableState;N.reading=!1,(N.needReadable||N.length<N.highWaterMark)&&this._read(N.highWaterMark)}function T(P){if(!(this instanceof T))return new T(P);S.call(this,P),this._transformState={afterTransform:I.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,P&&(typeof P.transform=="function"&&(this._transform=P.transform),typeof P.flush=="function"&&(this._flush=P.flush)),this.on("prefinish",A)}function A(){var P=this;typeof this._flush=="function"?this._flush(function(D,M){k(P,D,M)}):k(this,null,null)}T.prototype.push=function(P,D){return this._transformState.needTransform=!1,S.prototype.push.call(this,P,D)},T.prototype._transform=function(P,D,M){throw new Error("_transform() is not implemented")},T.prototype._write=function(P,D,M){var F=this._transformState;if(F.writecb=M,F.writechunk=P,F.writeencoding=D,!F.transforming){var N=this._readableState;(F.needTransform||N.needReadable||N.length<N.highWaterMark)&&this._read(N.highWaterMark)}},T.prototype._read=function(P){var D=this._transformState;D.writechunk!==null&&D.writecb&&!D.transforming?(D.transforming=!0,this._transform(D.writechunk,D.writeencoding,D.afterTransform)):D.needTransform=!0},T.prototype._destroy=function(P,D){var M=this;S.prototype._destroy.call(this,P,function(F){D(F),M.emit("close")})};function k(P,D,M){if(D)return P.emit("error",D);if(M!=null&&P.push(M),P._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(P._transformState.transforming)throw new Error("Calling transform done when still transforming");return P.push(null)}},{"./_stream_duplex":139,"core-util-is":51,inherits:75}],143:[function(m,x,E){(function(S,h,I){var T=m("process-nextick-args");x.exports=X;function A(De){var ze=this;this.next=null,this.entry=null,this.finish=function(){Pe(ze,De)}}var k=!S.browser&&["v0.10","v0.9."].indexOf(S.version.slice(0,5))>-1?I:T.nextTick,P;X.WritableState=W;var D=m("core-util-is");D.inherits=m("inherits");var M={deprecate:m("util-deprecate")},F=m("./internal/streams/stream"),N=m("safe-buffer").Buffer,B=h.Uint8Array||function(){};function U(De){return N.from(De)}function O(De){return N.isBuffer(De)||De instanceof B}var V=m("./internal/streams/destroy");D.inherits(X,F);function Z(){}function W(De,ze){P=P||m("./_stream_duplex"),De=De||{};var it=ze instanceof P;this.objectMode=!!De.objectMode,it&&(this.objectMode=this.objectMode||!!De.writableObjectMode);var tt=De.highWaterMark,ot=De.writableHighWaterMark,lt=this.objectMode?16:16*1024;tt||tt===0?this.highWaterMark=tt:it&&(ot||ot===0)?this.highWaterMark=ot:this.highWaterMark=lt,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var St=De.decodeStrings===!1;this.decodeStrings=!St,this.defaultEncoding=De.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(et){Ae(ze,et)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new A(this)}W.prototype.getBuffer=function(){for(var ze=this.bufferedRequest,it=[];ze;)it.push(ze),ze=ze.next;return it},function(){try{Object.defineProperty(W.prototype,"buffer",{get:M.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Y;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Y=Function.prototype[Symbol.hasInstance],Object.defineProperty(X,Symbol.hasInstance,{value:function(De){return Y.call(this,De)?!0:this!==X?!1:De&&De._writableState instanceof W}})):Y=function(De){return De instanceof this};function X(De){if(P=P||m("./_stream_duplex"),!Y.call(X,this)&&!(this instanceof P))return new X(De);this._writableState=new W(De,this),this.writable=!0,De&&(typeof De.write=="function"&&(this._write=De.write),typeof De.writev=="function"&&(this._writev=De.writev),typeof De.destroy=="function"&&(this._destroy=De.destroy),typeof De.final=="function"&&(this._final=De.final)),F.call(this)}X.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function J(De,ze){var it=new Error("write after end");De.emit("error",it),T.nextTick(ze,it)}function q(De,ze,it,tt){var ot=!0,lt=!1;return it===null?lt=new TypeError("May not write null values to stream"):typeof it!="string"&&it!==void 0&&!ze.objectMode&&(lt=new TypeError("Invalid non-string/buffer chunk")),lt&&(De.emit("error",lt),T.nextTick(tt,lt),ot=!1),ot}X.prototype.write=function(De,ze,it){var tt=this._writableState,ot=!1,lt=!tt.objectMode&&O(De);return lt&&!N.isBuffer(De)&&(De=U(De)),typeof ze=="function"&&(it=ze,ze=null),lt?ze="buffer":ze||(ze=tt.defaultEncoding),typeof it!="function"&&(it=Z),tt.ended?J(this,it):(lt||q(this,tt,De,it))&&(tt.pendingcb++,ot=ne(this,tt,lt,De,ze,it)),ot},X.prototype.cork=function(){var De=this._writableState;De.corked++},X.prototype.uncork=function(){var De=this._writableState;De.corked&&(De.corked--,!De.writing&&!De.corked&&!De.finished&&!De.bufferProcessing&&De.bufferedRequest&&xe(this,De))},X.prototype.setDefaultEncoding=function(ze){if(typeof ze=="string"&&(ze=ze.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((ze+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+ze);return this._writableState.defaultEncoding=ze,this};function te(De,ze,it){return!De.objectMode&&De.decodeStrings!==!1&&typeof ze=="string"&&(ze=N.from(ze,it)),ze}Object.defineProperty(X.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function ne(De,ze,it,tt,ot,lt){if(!it){var St=te(ze,tt,ot);tt!==St&&(it=!0,ot="buffer",tt=St)}var et=ze.objectMode?1:tt.length;ze.length+=et;var Je=ze.length<ze.highWaterMark;if(Je||(ze.needDrain=!0),ze.writing||ze.corked){var Be=ze.lastBufferedRequest;ze.lastBufferedRequest={chunk:tt,encoding:ot,isBuf:it,callback:lt,next:null},Be?Be.next=ze.lastBufferedRequest:ze.bufferedRequest=ze.lastBufferedRequest,ze.bufferedRequestCount+=1}else de(De,ze,!1,et,tt,ot,lt);return Je}function de(De,ze,it,tt,ot,lt,St){ze.writelen=tt,ze.writecb=St,ze.writing=!0,ze.sync=!0,it?De._writev(ot,ze.onwrite):De._write(ot,lt,ze.onwrite),ze.sync=!1}function oe(De,ze,it,tt,ot){--ze.pendingcb,it?(T.nextTick(ot,tt),T.nextTick(je,De,ze),De._writableState.errorEmitted=!0,De.emit("error",tt)):(ot(tt),De._writableState.errorEmitted=!0,De.emit("error",tt),je(De,ze))}function we(De){De.writing=!1,De.writecb=null,De.length-=De.writelen,De.writelen=0}function Ae(De,ze){var it=De._writableState,tt=it.sync,ot=it.writecb;if(we(it),ze)oe(De,it,tt,ze,ot);else{var lt=Le(it);!lt&&!it.corked&&!it.bufferProcessing&&it.bufferedRequest&&xe(De,it),tt?k(ye,De,it,lt,ot):ye(De,it,lt,ot)}}function ye(De,ze,it,tt){it||me(De,ze),ze.pendingcb--,tt(),je(De,ze)}function me(De,ze){ze.length===0&&ze.needDrain&&(ze.needDrain=!1,De.emit("drain"))}function xe(De,ze){ze.bufferProcessing=!0;var it=ze.bufferedRequest;if(De._writev&&it&&it.next){var tt=ze.bufferedRequestCount,ot=new Array(tt),lt=ze.corkedRequestsFree;lt.entry=it;for(var St=0,et=!0;it;)ot[St]=it,it.isBuf||(et=!1),it=it.next,St+=1;ot.allBuffers=et,de(De,ze,!0,ze.length,ot,"",lt.finish),ze.pendingcb++,ze.lastBufferedRequest=null,lt.next?(ze.corkedRequestsFree=lt.next,lt.next=null):ze.corkedRequestsFree=new A(ze),ze.bufferedRequestCount=0}else{for(;it;){var Je=it.chunk,Be=it.encoding,Ge=it.callback,He=ze.objectMode?1:Je.length;if(de(De,ze,!1,He,Je,Be,Ge),it=it.next,ze.bufferedRequestCount--,ze.writing)break}it===null&&(ze.lastBufferedRequest=null)}ze.bufferedRequest=it,ze.bufferProcessing=!1}X.prototype._write=function(De,ze,it){it(new Error("_write() is not implemented"))},X.prototype._writev=null,X.prototype.end=function(De,ze,it){var tt=this._writableState;typeof De=="function"?(it=De,De=null,ze=null):typeof ze=="function"&&(it=ze,ze=null),De!=null&&this.write(De,ze),tt.corked&&(tt.corked=1,this.uncork()),!tt.ending&&!tt.finished&&Ie(this,tt,it)};function Le(De){return De.ending&&De.length===0&&De.bufferedRequest===null&&!De.finished&&!De.writing}function Ze(De,ze){De._final(function(it){ze.pendingcb--,it&&De.emit("error",it),ze.prefinished=!0,De.emit("prefinish"),je(De,ze)})}function Xe(De,ze){!ze.prefinished&&!ze.finalCalled&&(typeof De._final=="function"?(ze.pendingcb++,ze.finalCalled=!0,T.nextTick(Ze,De,ze)):(ze.prefinished=!0,De.emit("prefinish")))}function je(De,ze){var it=Le(ze);return it&&(Xe(De,ze),ze.pendingcb===0&&(ze.finished=!0,De.emit("finish"))),it}function Ie(De,ze,it){ze.ending=!0,je(De,ze),it&&(ze.finished?T.nextTick(it):De.once("finish",it)),ze.ended=!0,De.writable=!1}function Pe(De,ze,it){var tt=De.entry;for(De.entry=null;tt;){var ot=tt.callback;ze.pendingcb--,ot(it),tt=tt.next}ze.corkedRequestsFree?ze.corkedRequestsFree.next=De:ze.corkedRequestsFree=De}Object.defineProperty(X.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(De){!this._writableState||(this._writableState.destroyed=De)}}),X.prototype.destroy=V.destroy,X.prototype._undestroy=V.undestroy,X.prototype._destroy=function(De,ze){this.end(),ze(De)}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{},m("timers").setImmediate)},{"./_stream_duplex":139,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:133,"core-util-is":51,inherits:75,"process-nextick-args":132,"safe-buffer":147,timers:176,"util-deprecate":183}],144:[function(m,x,E){function S(A,k){if(!(A instanceof k))throw new TypeError("Cannot call a class as a function")}var h=m("safe-buffer").Buffer,I=m("util");function T(A,k,P){A.copy(k,P)}x.exports=function(){function A(){S(this,A),this.head=null,this.tail=null,this.length=0}return A.prototype.push=function(P){var D={data:P,next:null};this.length>0?this.tail.next=D:this.head=D,this.tail=D,++this.length},A.prototype.unshift=function(P){var D={data:P,next:this.head};this.length===0&&(this.tail=D),this.head=D,++this.length},A.prototype.shift=function(){if(this.length!==0){var P=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,P}},A.prototype.clear=function(){this.head=this.tail=null,this.length=0},A.prototype.join=function(P){if(this.length===0)return"";for(var D=this.head,M=""+D.data;D=D.next;)M+=P+D.data;return M},A.prototype.concat=function(P){if(this.length===0)return h.alloc(0);if(this.length===1)return this.head.data;for(var D=h.allocUnsafe(P>>>0),M=this.head,F=0;M;)T(M.data,D,F),F+=M.data.length,M=M.next;return D},A}(),I&&I.inspect&&I.inspect.custom&&(x.exports.prototype[I.inspect.custom]=function(){var A=I.inspect({length:this.length});return this.constructor.name+" "+A})},{"safe-buffer":147,util:33}],145:[function(m,x,E){var S=m("process-nextick-args");function h(A,k){var P=this,D=this._readableState&&this._readableState.destroyed,M=this._writableState&&this._writableState.destroyed;return D||M?(k?k(A):A&&(!this._writableState||!this._writableState.errorEmitted)&&S.nextTick(T,this,A),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(A||null,function(F){!k&&F?(S.nextTick(T,P,F),P._writableState&&(P._writableState.errorEmitted=!0)):k&&k(F)}),this)}function I(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function T(A,k){A.emit("error",k)}x.exports={destroy:h,undestroy:I}},{"process-nextick-args":132}],146:[function(m,x,E){x.exports=m("events").EventEmitter},{events:52}],147:[function(m,x,E){var S=m("buffer"),h=S.Buffer;function I(A,k){for(var P in A)k[P]=A[P]}h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?x.exports=S:(I(S,E),E.Buffer=T);function T(A,k,P){return h(A,k,P)}I(h,T),T.from=function(A,k,P){if(typeof A=="number")throw new TypeError("Argument must not be a number");return h(A,k,P)},T.alloc=function(A,k,P){if(typeof A!="number")throw new TypeError("Argument must be a number");var D=h(A);return k!==void 0?typeof P=="string"?D.fill(k,P):D.fill(k):D.fill(0),D},T.allocUnsafe=function(A){if(typeof A!="number")throw new TypeError("Argument must be a number");return h(A)},T.allocUnsafeSlow=function(A){if(typeof A!="number")throw new TypeError("Argument must be a number");return S.SlowBuffer(A)}},{buffer:48}],148:[function(m,x,E){var S=m("safe-buffer").Buffer,h=S.isEncoding||function(Y){switch(Y=""+Y,Y&&Y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function I(Y){if(!Y)return"utf8";for(var X;;)switch(Y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Y;default:if(X)return;Y=(""+Y).toLowerCase(),X=!0}}function T(Y){var X=I(Y);if(typeof X!="string"&&(S.isEncoding===h||!h(Y)))throw new Error("Unknown encoding: "+Y);return X||Y}E.StringDecoder=A;function A(Y){this.encoding=T(Y);var X;switch(this.encoding){case"utf16le":this.text=B,this.end=U,X=4;break;case"utf8":this.fillLast=M,X=4;break;case"base64":this.text=O,this.end=V,X=3;break;default:this.write=Z,this.end=W;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=S.allocUnsafe(X)}A.prototype.write=function(Y){if(Y.length===0)return"";var X,J;if(this.lastNeed){if(X=this.fillLast(Y),X===void 0)return"";J=this.lastNeed,this.lastNeed=0}else J=0;return J<Y.length?X?X+this.text(Y,J):this.text(Y,J):X||""},A.prototype.end=N,A.prototype.text=F,A.prototype.fillLast=function(Y){if(this.lastNeed<=Y.length)return Y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Y.length),this.lastNeed-=Y.length};function k(Y){return Y<=127?0:Y>>5==6?2:Y>>4==14?3:Y>>3==30?4:Y>>6==2?-1:-2}function P(Y,X,J){var q=X.length-1;if(q<J)return 0;var te=k(X[q]);return te>=0?(te>0&&(Y.lastNeed=te-1),te):--q<J||te===-2?0:(te=k(X[q]),te>=0?(te>0&&(Y.lastNeed=te-2),te):--q<J||te===-2?0:(te=k(X[q]),te>=0?(te>0&&(te===2?te=0:Y.lastNeed=te-3),te):0))}function D(Y,X,J){if((X[0]&192)!=128)return Y.lastNeed=0,"\uFFFD";if(Y.lastNeed>1&&X.length>1){if((X[1]&192)!=128)return Y.lastNeed=1,"\uFFFD";if(Y.lastNeed>2&&X.length>2&&(X[2]&192)!=128)return Y.lastNeed=2,"\uFFFD"}}function M(Y){var X=this.lastTotal-this.lastNeed,J=D(this,Y);if(J!==void 0)return J;if(this.lastNeed<=Y.length)return Y.copy(this.lastChar,X,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Y.copy(this.lastChar,X,0,Y.length),this.lastNeed-=Y.length}function F(Y,X){var J=P(this,Y,X);if(!this.lastNeed)return Y.toString("utf8",X);this.lastTotal=J;var q=Y.length-(J-this.lastNeed);return Y.copy(this.lastChar,0,q),Y.toString("utf8",X,q)}function N(Y){var X=Y&&Y.length?this.write(Y):"";return this.lastNeed?X+"\uFFFD":X}function B(Y,X){if((Y.length-X)%2==0){var J=Y.toString("utf16le",X);if(J){var q=J.charCodeAt(J.length-1);if(q>=55296&&q<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Y[Y.length-2],this.lastChar[1]=Y[Y.length-1],J.slice(0,-1)}return J}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Y[Y.length-1],Y.toString("utf16le",X,Y.length-1)}function U(Y){var X=Y&&Y.length?this.write(Y):"";if(this.lastNeed){var J=this.lastTotal-this.lastNeed;return X+this.lastChar.toString("utf16le",0,J)}return X}function O(Y,X){var J=(Y.length-X)%3;return J===0?Y.toString("base64",X):(this.lastNeed=3-J,this.lastTotal=3,J===1?this.lastChar[0]=Y[Y.length-1]:(this.lastChar[0]=Y[Y.length-2],this.lastChar[1]=Y[Y.length-1]),Y.toString("base64",X,Y.length-J))}function V(Y){var X=Y&&Y.length?this.write(Y):"";return this.lastNeed?X+this.lastChar.toString("base64",0,3-this.lastNeed):X}function Z(Y){return Y.toString(this.encoding)}function W(Y){return Y&&Y.length?this.write(Y):""}},{"safe-buffer":147}],149:[function(m,x,E){x.exports=m("./readable").PassThrough},{"./readable":150}],150:[function(m,x,E){E=x.exports=m("./lib/_stream_readable.js"),E.Stream=E,E.Readable=E,E.Writable=m("./lib/_stream_writable.js"),E.Duplex=m("./lib/_stream_duplex.js"),E.Transform=m("./lib/_stream_transform.js"),E.PassThrough=m("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":139,"./lib/_stream_passthrough.js":140,"./lib/_stream_readable.js":141,"./lib/_stream_transform.js":142,"./lib/_stream_writable.js":143}],151:[function(m,x,E){x.exports=m("./readable").Transform},{"./readable":150}],152:[function(m,x,E){x.exports=m("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":143}],153:[function(m,x,E){var S=function(h){var I=Object.prototype,T=I.hasOwnProperty,A,k=typeof Symbol=="function"?Symbol:{},P=k.iterator||"@@iterator",D=k.asyncIterator||"@@asyncIterator",M=k.toStringTag||"@@toStringTag";function F(Xe,je,Ie,Pe){var De=je&&je.prototype instanceof W?je:W,ze=Object.create(De.prototype),it=new xe(Pe||[]);return ze._invoke=we(Xe,Ie,it),ze}h.wrap=F;function N(Xe,je,Ie){try{return{type:"normal",arg:Xe.call(je,Ie)}}catch(Pe){return{type:"throw",arg:Pe}}}var B="suspendedStart",U="suspendedYield",O="executing",V="completed",Z={};function W(){}function Y(){}function X(){}var J={};J[P]=function(){return this};var q=Object.getPrototypeOf,te=q&&q(q(Le([])));te&&te!==I&&T.call(te,P)&&(J=te);var ne=X.prototype=W.prototype=Object.create(J);Y.prototype=ne.constructor=X,X.constructor=Y,X[M]=Y.displayName="GeneratorFunction";function de(Xe){["next","throw","return"].forEach(function(je){Xe[je]=function(Ie){return this._invoke(je,Ie)}})}h.isGeneratorFunction=function(Xe){var je=typeof Xe=="function"&&Xe.constructor;return je?je===Y||(je.displayName||je.name)==="GeneratorFunction":!1},h.mark=function(Xe){return Object.setPrototypeOf?Object.setPrototypeOf(Xe,X):(Xe.__proto__=X,M in Xe||(Xe[M]="GeneratorFunction")),Xe.prototype=Object.create(ne),Xe},h.awrap=function(Xe){return{__await:Xe}};function oe(Xe){function je(De,ze,it,tt){var ot=N(Xe[De],Xe,ze);if(ot.type==="throw")tt(ot.arg);else{var lt=ot.arg,St=lt.value;return St&&typeof St=="object"&&T.call(St,"__await")?Promise.resolve(St.__await).then(function(et){je("next",et,it,tt)},function(et){je("throw",et,it,tt)}):Promise.resolve(St).then(function(et){lt.value=et,it(lt)},function(et){return je("throw",et,it,tt)})}}var Ie;function Pe(De,ze){function it(){return new Promise(function(tt,ot){je(De,ze,tt,ot)})}return Ie=Ie?Ie.then(it,it):it()}this._invoke=Pe}de(oe.prototype),oe.prototype[D]=function(){return this},h.AsyncIterator=oe,h.async=function(Xe,je,Ie,Pe){var De=new oe(F(Xe,je,Ie,Pe));return h.isGeneratorFunction(je)?De:De.next().then(function(ze){return ze.done?ze.value:De.next()})};function we(Xe,je,Ie){var Pe=B;return function(ze,it){if(Pe===O)throw new Error("Generator is already running");if(Pe===V){if(ze==="throw")throw it;return Ze()}for(Ie.method=ze,Ie.arg=it;;){var tt=Ie.delegate;if(tt){var ot=Ae(tt,Ie);if(ot){if(ot===Z)continue;return ot}}if(Ie.method==="next")Ie.sent=Ie._sent=Ie.arg;else if(Ie.method==="throw"){if(Pe===B)throw Pe=V,Ie.arg;Ie.dispatchException(Ie.arg)}else Ie.method==="return"&&Ie.abrupt("return",Ie.arg);Pe=O;var lt=N(Xe,je,Ie);if(lt.type==="normal"){if(Pe=Ie.done?V:U,lt.arg===Z)continue;return{value:lt.arg,done:Ie.done}}else lt.type==="throw"&&(Pe=V,Ie.method="throw",Ie.arg=lt.arg)}}}function Ae(Xe,je){var Ie=Xe.iterator[je.method];if(Ie===A){if(je.delegate=null,je.method==="throw"){if(Xe.iterator.return&&(je.method="return",je.arg=A,Ae(Xe,je),je.method==="throw"))return Z;je.method="throw",je.arg=new TypeError("The iterator does not provide a 'throw' method")}return Z}var Pe=N(Ie,Xe.iterator,je.arg);if(Pe.type==="throw")return je.method="throw",je.arg=Pe.arg,je.delegate=null,Z;var De=Pe.arg;if(!De)return je.method="throw",je.arg=new TypeError("iterator result is not an object"),je.delegate=null,Z;if(De.done)je[Xe.resultName]=De.value,je.next=Xe.nextLoc,je.method!=="return"&&(je.method="next",je.arg=A);else return De;return je.delegate=null,Z}de(ne),ne[M]="Generator",ne[P]=function(){return this},ne.toString=function(){return"[object Generator]"};function ye(Xe){var je={tryLoc:Xe[0]};1 in Xe&&(je.catchLoc=Xe[1]),2 in Xe&&(je.finallyLoc=Xe[2],je.afterLoc=Xe[3]),this.tryEntries.push(je)}function me(Xe){var je=Xe.completion||{};je.type="normal",delete je.arg,Xe.completion=je}function xe(Xe){this.tryEntries=[{tryLoc:"root"}],Xe.forEach(ye,this),this.reset(!0)}h.keys=function(Xe){var je=[];for(var Ie in Xe)je.push(Ie);return je.reverse(),function Pe(){for(;je.length;){var De=je.pop();if(De in Xe)return Pe.value=De,Pe.done=!1,Pe}return Pe.done=!0,Pe}};function Le(Xe){if(Xe){var je=Xe[P];if(je)return je.call(Xe);if(typeof Xe.next=="function")return Xe;if(!isNaN(Xe.length)){var Ie=-1,Pe=function De(){for(;++Ie<Xe.length;)if(T.call(Xe,Ie))return De.value=Xe[Ie],De.done=!1,De;return De.value=A,De.done=!0,De};return Pe.next=Pe}}return{next:Ze}}h.values=Le;function Ze(){return{value:A,done:!0}}return xe.prototype={constructor:xe,reset:function(Xe){if(this.prev=0,this.next=0,this.sent=this._sent=A,this.done=!1,this.delegate=null,this.method="next",this.arg=A,this.tryEntries.forEach(me),!Xe)for(var je in this)je.charAt(0)==="t"&&T.call(this,je)&&!isNaN(+je.slice(1))&&(this[je]=A)},stop:function(){this.done=!0;var Xe=this.tryEntries[0],je=Xe.completion;if(je.type==="throw")throw je.arg;return this.rval},dispatchException:function(Xe){if(this.done)throw Xe;var je=this;function Ie(ot,lt){return ze.type="throw",ze.arg=Xe,je.next=ot,lt&&(je.method="next",je.arg=A),!!lt}for(var Pe=this.tryEntries.length-1;Pe>=0;--Pe){var De=this.tryEntries[Pe],ze=De.completion;if(De.tryLoc==="root")return Ie("end");if(De.tryLoc<=this.prev){var it=T.call(De,"catchLoc"),tt=T.call(De,"finallyLoc");if(it&&tt){if(this.prev<De.catchLoc)return Ie(De.catchLoc,!0);if(this.prev<De.finallyLoc)return Ie(De.finallyLoc)}else if(it){if(this.prev<De.catchLoc)return Ie(De.catchLoc,!0)}else if(tt){if(this.prev<De.finallyLoc)return Ie(De.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(Xe,je){for(var Ie=this.tryEntries.length-1;Ie>=0;--Ie){var Pe=this.tryEntries[Ie];if(Pe.tryLoc<=this.prev&&T.call(Pe,"finallyLoc")&&this.prev<Pe.finallyLoc){var De=Pe;break}}De&&(Xe==="break"||Xe==="continue")&&De.tryLoc<=je&&je<=De.finallyLoc&&(De=null);var ze=De?De.completion:{};return ze.type=Xe,ze.arg=je,De?(this.method="next",this.next=De.finallyLoc,Z):this.complete(ze)},complete:function(Xe,je){if(Xe.type==="throw")throw Xe.arg;return Xe.type==="break"||Xe.type==="continue"?this.next=Xe.arg:Xe.type==="return"?(this.rval=this.arg=Xe.arg,this.method="return",this.next="end"):Xe.type==="normal"&&je&&(this.next=je),Z},finish:function(Xe){for(var je=this.tryEntries.length-1;je>=0;--je){var Ie=this.tryEntries[je];if(Ie.finallyLoc===Xe)return this.complete(Ie.completion,Ie.afterLoc),me(Ie),Z}},catch:function(Xe){for(var je=this.tryEntries.length-1;je>=0;--je){var Ie=this.tryEntries[je];if(Ie.tryLoc===Xe){var Pe=Ie.completion;if(Pe.type==="throw"){var De=Pe.arg;me(Ie)}return De}}throw new Error("illegal catch attempt")},delegateYield:function(Xe,je,Ie){return this.delegate={iterator:Le(Xe),resultName:je,nextLoc:Ie},this.method==="next"&&(this.arg=A),Z}},h}(typeof x=="object"?x.exports:{});try{regeneratorRuntime=S}catch{Function("r","regeneratorRuntime = r")(S)}},{}],154:[function(m,x,E){var S=m("buffer"),h=S.Buffer;function I(A,k){for(var P in A)k[P]=A[P]}h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?x.exports=S:(I(S,E),E.Buffer=T);function T(A,k,P){return h(A,k,P)}T.prototype=Object.create(h.prototype),I(h,T),T.from=function(A,k,P){if(typeof A=="number")throw new TypeError("Argument must not be a number");return h(A,k,P)},T.alloc=function(A,k,P){if(typeof A!="number")throw new TypeError("Argument must be a number");var D=h(A);return k!==void 0?typeof P=="string"?D.fill(k,P):D.fill(k):D.fill(0),D},T.allocUnsafe=function(A){if(typeof A!="number")throw new TypeError("Argument must be a number");return h(A)},T.allocUnsafeSlow=function(A){if(typeof A!="number")throw new TypeError("Argument must be a number");return S.SlowBuffer(A)}},{buffer:48}],155:[function(m,x,E){x.exports=I;var S=m("events").EventEmitter,h=m("inherits");h(I,S),I.Readable=m("readable-stream/readable.js"),I.Writable=m("readable-stream/writable.js"),I.Duplex=m("readable-stream/duplex.js"),I.Transform=m("readable-stream/transform.js"),I.PassThrough=m("readable-stream/passthrough.js"),I.Stream=I;function I(){S.call(this)}I.prototype.pipe=function(T,A){var k=this;function P(O){T.writable&&T.write(O)===!1&&k.pause&&k.pause()}k.on("data",P);function D(){k.readable&&k.resume&&k.resume()}T.on("drain",D),!T._isStdio&&(!A||A.end!==!1)&&(k.on("end",F),k.on("close",N));var M=!1;function F(){M||(M=!0,T.end())}function N(){M||(M=!0,typeof T.destroy=="function"&&T.destroy())}function B(O){if(U(),S.listenerCount(this,"error")===0)throw O}k.on("error",B),T.on("error",B);function U(){k.removeListener("data",P),T.removeListener("drain",D),k.removeListener("end",F),k.removeListener("close",N),k.removeListener("error",B),T.removeListener("error",B),k.removeListener("end",U),k.removeListener("close",U),T.removeListener("close",U)}return k.on("end",U),k.on("close",U),T.on("close",U),T.emit("pipe",k),T}},{events:52,inherits:75,"readable-stream/duplex.js":138,"readable-stream/passthrough.js":149,"readable-stream/readable.js":150,"readable-stream/transform.js":151,"readable-stream/writable.js":152}],156:[function(m,x,E){(function(S){var h=m("./lib/request"),I=m("./lib/response"),T=m("xtend"),A=m("builtin-status-codes"),k=m("url"),P=E;P.request=function(D,M){typeof D=="string"?D=k.parse(D):D=T(D);var F=S.location.protocol.search(/^https?:$/)===-1?"http:":"",N=D.protocol||F,B=D.hostname||D.host,U=D.port,O=D.path||"/";B&&B.indexOf(":")!==-1&&(B="["+B+"]"),D.url=(B?N+"//"+B:"")+(U?":"+U:"")+O,D.method=(D.method||"GET").toUpperCase(),D.headers=D.headers||{};var V=new h(D);return M&&V.on("response",M),V},P.get=function(M,F){var N=P.request(M,F);return N.end(),N},P.ClientRequest=h,P.IncomingMessage=I.IncomingMessage,P.Agent=function(){},P.Agent.defaultMaxSockets=4,P.globalAgent=new P.Agent,P.STATUS_CODES=A,P.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"./lib/request":158,"./lib/response":159,"builtin-status-codes":50,url:180,xtend:189}],157:[function(m,x,E){(function(S){E.fetch=A(S.fetch)&&A(S.ReadableStream),E.writableStream=A(S.WritableStream),E.abortController=A(S.AbortController);var h;function I(){if(h!==void 0)return h;if(S.XMLHttpRequest){h=new S.XMLHttpRequest;try{h.open("GET",S.XDomainRequest?"/":"https://example.com")}catch{h=null}}else h=null;return h}function T(k){var P=I();if(!P)return!1;try{return P.responseType=k,P.responseType===k}catch{}return!1}E.arraybuffer=E.fetch||T("arraybuffer"),E.msstream=!E.fetch&&T("ms-stream"),E.mozchunkedarraybuffer=!E.fetch&&T("moz-chunked-arraybuffer"),E.overrideMimeType=E.fetch||(I()?A(I().overrideMimeType):!1);function A(k){return typeof k=="function"}h=null}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{}],158:[function(m,x,E){(function(S,h,I){var T=m("./capability"),A=m("inherits"),k=m("./response"),P=m("readable-stream"),D=k.IncomingMessage,M=k.readyStates;function F(O,V){return T.fetch&&V?"fetch":T.mozchunkedarraybuffer?"moz-chunked-arraybuffer":T.msstream?"ms-stream":T.arraybuffer&&O?"arraybuffer":"text"}var N=x.exports=function(O){var V=this;P.Writable.call(V),V._opts=O,V._body=[],V._headers={},O.auth&&V.setHeader("Authorization","Basic "+I.from(O.auth).toString("base64")),Object.keys(O.headers).forEach(function(Y){V.setHeader(Y,O.headers[Y])});var Z,W=!0;if(O.mode==="disable-fetch"||"requestTimeout"in O&&!T.abortController)W=!1,Z=!0;else if(O.mode==="prefer-streaming")Z=!1;else if(O.mode==="allow-wrong-content-type")Z=!T.overrideMimeType;else if(!O.mode||O.mode==="default"||O.mode==="prefer-fast")Z=!0;else throw new Error("Invalid value for opts.mode");V._mode=F(Z,W),V._fetchTimer=null,V.on("finish",function(){V._onFinish()})};A(N,P.Writable),N.prototype.setHeader=function(O,V){var Z=this,W=O.toLowerCase();U.indexOf(W)===-1&&(Z._headers[W]={name:O,value:V})},N.prototype.getHeader=function(O){var V=this._headers[O.toLowerCase()];return V?V.value:null},N.prototype.removeHeader=function(O){var V=this;delete V._headers[O.toLowerCase()]},N.prototype._onFinish=function(){var O=this;if(!O._destroyed){var V=O._opts,Z=O._headers,W=null;V.method!=="GET"&&V.method!=="HEAD"&&(W=new Blob(O._body,{type:(Z["content-type"]||{}).value||""}));var Y=[];if(Object.keys(Z).forEach(function(te){var ne=Z[te].name,de=Z[te].value;Array.isArray(de)?de.forEach(function(oe){Y.push([ne,oe])}):Y.push([ne,de])}),O._mode==="fetch"){var X=null;if(T.abortController){var J=new AbortController;X=J.signal,O._fetchAbortController=J,"requestTimeout"in V&&V.requestTimeout!==0&&(O._fetchTimer=h.setTimeout(function(){O.emit("requestTimeout"),O._fetchAbortController&&O._fetchAbortController.abort()},V.requestTimeout))}h.fetch(O._opts.url,{method:O._opts.method,headers:Y,body:W||void 0,mode:"cors",credentials:V.withCredentials?"include":"same-origin",signal:X}).then(function(te){O._fetchResponse=te,O._connect()},function(te){h.clearTimeout(O._fetchTimer),O._destroyed||O.emit("error",te)})}else{var q=O._xhr=new h.XMLHttpRequest;try{q.open(O._opts.method,O._opts.url,!0)}catch(te){S.nextTick(function(){O.emit("error",te)});return}"responseType"in q&&(q.responseType=O._mode),"withCredentials"in q&&(q.withCredentials=!!V.withCredentials),O._mode==="text"&&"overrideMimeType"in q&&q.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in V&&(q.timeout=V.requestTimeout,q.ontimeout=function(){O.emit("requestTimeout")}),Y.forEach(function(te){q.setRequestHeader(te[0],te[1])}),O._response=null,q.onreadystatechange=function(){switch(q.readyState){case M.LOADING:case M.DONE:O._onXHRProgress();break}},O._mode==="moz-chunked-arraybuffer"&&(q.onprogress=function(){O._onXHRProgress()}),q.onerror=function(){O._destroyed||O.emit("error",new Error("XHR error"))};try{q.send(W)}catch(te){S.nextTick(function(){O.emit("error",te)});return}}}};function B(O){try{var V=O.status;return V!==null&&V!==0}catch{return!1}}N.prototype._onXHRProgress=function(){var O=this;!B(O._xhr)||O._destroyed||(O._response||O._connect(),O._response._onXHRProgress())},N.prototype._connect=function(){var O=this;O._destroyed||(O._response=new D(O._xhr,O._fetchResponse,O._mode,O._fetchTimer),O._response.on("error",function(V){O.emit("error",V)}),O.emit("response",O._response))},N.prototype._write=function(O,V,Z){var W=this;W._body.push(O),Z()},N.prototype.abort=N.prototype.destroy=function(){var O=this;O._destroyed=!0,h.clearTimeout(O._fetchTimer),O._response&&(O._response._destroyed=!0),O._xhr?O._xhr.abort():O._fetchAbortController&&O._fetchAbortController.abort()},N.prototype.end=function(O,V,Z){var W=this;typeof O=="function"&&(Z=O,O=void 0),P.Writable.prototype.end.call(W,O,V,Z)},N.prototype.flushHeaders=function(){},N.prototype.setTimeout=function(){},N.prototype.setNoDelay=function(){},N.prototype.setSocketKeepAlive=function(){};var U=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{},m("buffer").Buffer)},{"./capability":157,"./response":159,_process:133,buffer:48,inherits:75,"readable-stream":174}],159:[function(m,x,E){(function(S,h,I){var T=m("./capability"),A=m("inherits"),k=m("readable-stream"),P=E.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},D=E.IncomingMessage=function(M,F,N,B){var U=this;if(k.Readable.call(U),U._mode=N,U.headers={},U.rawHeaders=[],U.trailers={},U.rawTrailers=[],U.on("end",function(){S.nextTick(function(){U.emit("close")})}),N==="fetch"){let X=function(){V.read().then(function(J){if(!U._destroyed){if(J.done){h.clearTimeout(B),U.push(null);return}U.push(I.from(J.value)),X()}}).catch(function(J){h.clearTimeout(B),U._destroyed||U.emit("error",J)})};if(U._fetchResponse=F,U.url=F.url,U.statusCode=F.status,U.statusMessage=F.statusText,F.headers.forEach(function(J,q){U.headers[q.toLowerCase()]=J,U.rawHeaders.push(q,J)}),T.writableStream){var O=new WritableStream({write:function(J){return new Promise(function(q,te){U._destroyed?te():U.push(I.from(J))?q():U._resumeFetch=q})},close:function(){h.clearTimeout(B),U._destroyed||U.push(null)},abort:function(J){U._destroyed||U.emit("error",J)}});try{F.body.pipeTo(O).catch(function(J){h.clearTimeout(B),U._destroyed||U.emit("error",J)});return}catch{}}var V=F.body.getReader();X()}else{U._xhr=M,U._pos=0,U.url=M.responseURL,U.statusCode=M.status,U.statusMessage=M.statusText;var Z=M.getAllResponseHeaders().split(/\r?\n/);if(Z.forEach(function(X){var J=X.match(/^([^:]+):\s*(.*)/);if(J){var q=J[1].toLowerCase();q==="set-cookie"?(U.headers[q]===void 0&&(U.headers[q]=[]),U.headers[q].push(J[2])):U.headers[q]!==void 0?U.headers[q]+=", "+J[2]:U.headers[q]=J[2],U.rawHeaders.push(J[1],J[2])}}),U._charset="x-user-defined",!T.overrideMimeType){var W=U.rawHeaders["mime-type"];if(W){var Y=W.match(/;\s*charset=([^;])(;|$)/);Y&&(U._charset=Y[1].toLowerCase())}U._charset||(U._charset="utf-8")}}};A(D,k.Readable),D.prototype._read=function(){var M=this,F=M._resumeFetch;F&&(M._resumeFetch=null,F())},D.prototype._onXHRProgress=function(){var M=this,F=M._xhr,N=null;switch(M._mode){case"text":if(N=F.responseText,N.length>M._pos){var B=N.substr(M._pos);if(M._charset==="x-user-defined"){for(var U=I.alloc(B.length),O=0;O<B.length;O++)U[O]=B.charCodeAt(O)&255;M.push(U)}else M.push(B,M._charset);M._pos=N.length}break;case"arraybuffer":if(F.readyState!==P.DONE||!F.response)break;N=F.response,M.push(I.from(new Uint8Array(N)));break;case"moz-chunked-arraybuffer":if(N=F.response,F.readyState!==P.LOADING||!N)break;M.push(I.from(new Uint8Array(N)));break;case"ms-stream":if(N=F.response,F.readyState!==P.LOADING)break;var V=new h.MSStreamReader;V.onprogress=function(){V.result.byteLength>M._pos&&(M.push(I.from(new Uint8Array(V.result.slice(M._pos)))),M._pos=V.result.byteLength)},V.onload=function(){M.push(null)},V.readAsArrayBuffer(N);break}M._xhr.readyState===P.DONE&&M._mode!=="ms-stream"&&M.push(null)}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{},m("buffer").Buffer)},{"./capability":157,_process:133,buffer:48,inherits:75,"readable-stream":174}],160:[function(m,x,E){function S(D,M){D.prototype=Object.create(M.prototype),D.prototype.constructor=D,D.__proto__=M}var h={};function I(D,M,F){F||(F=Error);function N(U,O,V){return typeof M=="string"?M:M(U,O,V)}var B=function(U){S(O,U);function O(V,Z,W){return U.call(this,N(V,Z,W))||this}return O}(F);B.prototype.name=F.name,B.prototype.code=D,h[D]=B}function T(D,M){if(Array.isArray(D)){var F=D.length;return D=D.map(function(N){return String(N)}),F>2?"one of ".concat(M," ").concat(D.slice(0,F-1).join(", "),", or ")+D[F-1]:F===2?"one of ".concat(M," ").concat(D[0]," or ").concat(D[1]):"of ".concat(M," ").concat(D[0])}else return"of ".concat(M," ").concat(String(D))}function A(D,M,F){return D.substr(!F||F<0?0:+F,M.length)===M}function k(D,M,F){return(F===void 0||F>D.length)&&(F=D.length),D.substring(F-M.length,F)===M}function P(D,M,F){return typeof F!="number"&&(F=0),F+M.length>D.length?!1:D.indexOf(M,F)!==-1}I("ERR_INVALID_OPT_VALUE",function(D,M){return'The value "'+M+'" is invalid for option "'+D+'"'},TypeError),I("ERR_INVALID_ARG_TYPE",function(D,M,F){var N;typeof M=="string"&&A(M,"not ")?(N="must not be",M=M.replace(/^not /,"")):N="must be";var B;if(k(D," argument"))B="The ".concat(D," ").concat(N," ").concat(T(M,"type"));else{var U=P(D,".")?"property":"argument";B='The "'.concat(D,'" ').concat(U," ").concat(N," ").concat(T(M,"type"))}return B+=". Received type ".concat(typeof F),B},TypeError),I("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),I("ERR_METHOD_NOT_IMPLEMENTED",function(D){return"The "+D+" method is not implemented"}),I("ERR_STREAM_PREMATURE_CLOSE","Premature close"),I("ERR_STREAM_DESTROYED",function(D){return"Cannot call "+D+" after a stream was destroyed"}),I("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),I("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),I("ERR_STREAM_WRITE_AFTER_END","write after end"),I("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),I("ERR_UNKNOWN_ENCODING",function(D){return"Unknown encoding: "+D},TypeError),I("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),x.exports.codes=h},{}],161:[function(m,x,E){(function(S){var h=new Set;function I(A){if(!h.has(A)){var k=A+" is an experimental feature. This feature could change at any time";h.add(A),S.emitWarning(k,"ExperimentalWarning")}}function T(){}x.exports.emitExperimentalWarning=S.emitWarning?I:T}).call(this,m("_process"))},{_process:133}],162:[function(m,x,E){(function(S){var h=Object.keys||function(N){var B=[];for(var U in N)B.push(U);return B};x.exports=D;var I=m("./_stream_readable"),T=m("./_stream_writable");m("inherits")(D,I);for(var A=h(T.prototype),k=0;k<A.length;k++){var P=A[k];D.prototype[P]||(D.prototype[P]=T.prototype[P])}function D(N){if(!(this instanceof D))return new D(N);I.call(this,N),T.call(this,N),this.allowHalfOpen=!0,N&&(N.readable===!1&&(this.readable=!1),N.writable===!1&&(this.writable=!1),N.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",M)))}Object.defineProperty(D.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(D.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(D.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function M(){this._writableState.ended||S.nextTick(F,this)}function F(N){N.end()}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(B){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=B,this._writableState.destroyed=B)}})}).call(this,m("_process"))},{"./_stream_readable":164,"./_stream_writable":166,_process:133,inherits:75}],163:[function(m,x,E){x.exports=h;var S=m("./_stream_transform");m("inherits")(h,S);function h(I){if(!(this instanceof h))return new h(I);S.call(this,I)}h.prototype._transform=function(I,T,A){A(null,I)}},{"./_stream_transform":165,inherits:75}],164:[function(m,x,E){(function(S,h){x.exports=ye;var I;ye.ReadableState=Ae,m("events").EventEmitter;var T=function(pe,fe){return pe.listeners(fe).length},A=m("./internal/streams/stream"),k=m("buffer").Buffer,P=h.Uint8Array||function(){};function D(_e){return k.from(_e)}function M(_e){return k.isBuffer(_e)||_e instanceof P}var F=m("util"),N;F&&F.debuglog?N=F.debuglog("stream"):N=function(){};var B=m("./internal/streams/buffer_list"),U=m("./internal/streams/destroy"),O=m("./internal/streams/state"),V=O.getHighWaterMark,Z=m("../errors").codes,W=Z.ERR_INVALID_ARG_TYPE,Y=Z.ERR_STREAM_PUSH_AFTER_EOF,X=Z.ERR_METHOD_NOT_IMPLEMENTED,J=Z.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,q=m("../experimentalWarning"),te=q.emitExperimentalWarning,ne,de;m("inherits")(ye,A);var oe=["error","close","destroy","pause","resume"];function we(_e,pe,fe){if(typeof _e.prependListener=="function")return _e.prependListener(pe,fe);!_e._events||!_e._events[pe]?_e.on(pe,fe):Array.isArray(_e._events[pe])?_e._events[pe].unshift(fe):_e._events[pe]=[fe,_e._events[pe]]}function Ae(_e,pe,fe){I=I||m("./_stream_duplex"),_e=_e||{},typeof fe!="boolean"&&(fe=pe instanceof I),this.objectMode=!!_e.objectMode,fe&&(this.objectMode=this.objectMode||!!_e.readableObjectMode),this.highWaterMark=V(this,_e,"readableHighWaterMark",fe),this.buffer=new B,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=_e.emitClose!==!1,this.destroyed=!1,this.defaultEncoding=_e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,_e.encoding&&(ne||(ne=m("string_decoder/").StringDecoder),this.decoder=new ne(_e.encoding),this.encoding=_e.encoding)}function ye(_e){if(I=I||m("./_stream_duplex"),!(this instanceof ye))return new ye(_e);var pe=this instanceof I;this._readableState=new Ae(_e,this,pe),this.readable=!0,_e&&(typeof _e.read=="function"&&(this._read=_e.read),typeof _e.destroy=="function"&&(this._destroy=_e.destroy)),A.call(this)}Object.defineProperty(ye.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(pe){!this._readableState||(this._readableState.destroyed=pe)}}),ye.prototype.destroy=U.destroy,ye.prototype._undestroy=U.undestroy,ye.prototype._destroy=function(_e,pe){pe(_e)},ye.prototype.push=function(_e,pe){var fe=this._readableState,ue;return fe.objectMode?ue=!0:typeof _e=="string"&&(pe=pe||fe.defaultEncoding,pe!==fe.encoding&&(_e=k.from(_e,pe),pe=""),ue=!0),me(this,_e,pe,!1,ue)},ye.prototype.unshift=function(_e){return me(this,_e,null,!0,!1)};function me(_e,pe,fe,ue,ce){N("readableAddChunk",pe);var Ee=_e._readableState;if(pe===null)Ee.reading=!1,Ie(_e,Ee);else{var Ye;if(ce||(Ye=Le(Ee,pe)),Ye)_e.emit("error",Ye);else if(Ee.objectMode||pe&&pe.length>0)if(typeof pe!="string"&&!Ee.objectMode&&Object.getPrototypeOf(pe)!==k.prototype&&(pe=D(pe)),ue)Ee.endEmitted?_e.emit("error",new J):xe(_e,Ee,pe,!0);else if(Ee.ended)_e.emit("error",new Y);else{if(Ee.destroyed)return!1;Ee.reading=!1,Ee.decoder&&!fe?(pe=Ee.decoder.write(pe),Ee.objectMode||pe.length!==0?xe(_e,Ee,pe,!1):ze(_e,Ee)):xe(_e,Ee,pe,!1)}else ue||(Ee.reading=!1,ze(_e,Ee))}return!Ee.ended&&(Ee.length<Ee.highWaterMark||Ee.length===0)}function xe(_e,pe,fe,ue){pe.flowing&&pe.length===0&&!pe.sync?(pe.awaitDrain=0,_e.emit("data",fe)):(pe.length+=pe.objectMode?1:fe.length,ue?pe.buffer.unshift(fe):pe.buffer.push(fe),pe.needReadable&&Pe(_e)),ze(_e,pe)}function Le(_e,pe){var fe;return!M(pe)&&typeof pe!="string"&&pe!==void 0&&!_e.objectMode&&(fe=new W("chunk",["string","Buffer","Uint8Array"],pe)),fe}ye.prototype.isPaused=function(){return this._readableState.flowing===!1},ye.prototype.setEncoding=function(_e){return ne||(ne=m("string_decoder/").StringDecoder),this._readableState.decoder=new ne(_e),this._readableState.encoding=this._readableState.decoder.encoding,this};var Ze=8388608;function Xe(_e){return _e>=Ze?_e=Ze:(_e--,_e|=_e>>>1,_e|=_e>>>2,_e|=_e>>>4,_e|=_e>>>8,_e|=_e>>>16,_e++),_e}function je(_e,pe){return _e<=0||pe.length===0&&pe.ended?0:pe.objectMode?1:_e!==_e?pe.flowing&&pe.length?pe.buffer.head.data.length:pe.length:(_e>pe.highWaterMark&&(pe.highWaterMark=Xe(_e)),_e<=pe.length?_e:pe.ended?pe.length:(pe.needReadable=!0,0))}ye.prototype.read=function(_e){N("read",_e),_e=parseInt(_e,10);var pe=this._readableState,fe=_e;if(_e!==0&&(pe.emittedReadable=!1),_e===0&&pe.needReadable&&((pe.highWaterMark!==0?pe.length>=pe.highWaterMark:pe.length>0)||pe.ended))return N("read: emitReadable",pe.length,pe.ended),pe.length===0&&pe.ended?Ge(this):Pe(this),null;if(_e=je(_e,pe),_e===0&&pe.ended)return pe.length===0&&Ge(this),null;var ue=pe.needReadable;N("need readable",ue),(pe.length===0||pe.length-_e<pe.highWaterMark)&&(ue=!0,N("length less than watermark",ue)),pe.ended||pe.reading?(ue=!1,N("reading or ended",ue)):ue&&(N("do read"),pe.reading=!0,pe.sync=!0,pe.length===0&&(pe.needReadable=!0),this._read(pe.highWaterMark),pe.sync=!1,pe.reading||(_e=je(fe,pe)));var ce;return _e>0?ce=Be(_e,pe):ce=null,ce===null?(pe.needReadable=!0,_e=0):(pe.length-=_e,pe.awaitDrain=0),pe.length===0&&(pe.ended||(pe.needReadable=!0),fe!==_e&&pe.ended&&Ge(this)),ce!==null&&this.emit("data",ce),ce};function Ie(_e,pe){if(!pe.ended){if(pe.decoder){var fe=pe.decoder.end();fe&&fe.length&&(pe.buffer.push(fe),pe.length+=pe.objectMode?1:fe.length)}pe.ended=!0,pe.sync?Pe(_e):(pe.needReadable=!1,pe.emittedReadable||(pe.emittedReadable=!0,De(_e)))}}function Pe(_e){var pe=_e._readableState;pe.needReadable=!1,pe.emittedReadable||(N("emitReadable",pe.flowing),pe.emittedReadable=!0,S.nextTick(De,_e))}function De(_e){var pe=_e._readableState;N("emitReadable_",pe.destroyed,pe.length,pe.ended),!pe.destroyed&&(pe.length||pe.ended)&&_e.emit("readable"),pe.needReadable=!pe.flowing&&!pe.ended&&pe.length<=pe.highWaterMark,Je(_e)}function ze(_e,pe){pe.readingMore||(pe.readingMore=!0,S.nextTick(it,_e,pe))}function it(_e,pe){for(;!pe.reading&&!pe.ended&&(pe.length<pe.highWaterMark||pe.flowing&&pe.length===0);){var fe=pe.length;if(N("maybeReadMore read 0"),_e.read(0),fe===pe.length)break}pe.readingMore=!1}ye.prototype._read=function(_e){this.emit("error",new X("_read()"))},ye.prototype.pipe=function(_e,pe){var fe=this,ue=this._readableState;switch(ue.pipesCount){case 0:ue.pipes=_e;break;case 1:ue.pipes=[ue.pipes,_e];break;default:ue.pipes.push(_e);break}ue.pipesCount+=1,N("pipe count=%d opts=%j",ue.pipesCount,pe);var ce=(!pe||pe.end!==!1)&&_e!==S.stdout&&_e!==S.stderr,Ee=ce?ft:Vt;ue.endEmitted?S.nextTick(Ee):fe.once("end",Ee),_e.on("unpipe",Ye);function Ye(fi,hi){N("onunpipe"),fi===fe&&hi&&hi.hasUnpiped===!1&&(hi.hasUnpiped=!0,$t())}function ft(){N("onend"),_e.end()}var _t=tt(fe);_e.on("drain",_t);var It=!1;function $t(){N("cleanup"),_e.removeListener("close",zt),_e.removeListener("finish",qt),_e.removeListener("drain",_t),_e.removeListener("error",ii),_e.removeListener("unpipe",Ye),fe.removeListener("end",ft),fe.removeListener("end",Vt),fe.removeListener("data",Yt),It=!0,ue.awaitDrain&&(!_e._writableState||_e._writableState.needDrain)&&_t()}fe.on("data",Yt);function Yt(fi){N("ondata");var hi=_e.write(fi);N("dest.write",hi),hi===!1&&((ue.pipesCount===1&&ue.pipes===_e||ue.pipesCount>1&&ve(ue.pipes,_e)!==-1)&&!It&&(N("false write response, pause",ue.awaitDrain),ue.awaitDrain++),fe.pause())}function ii(fi){N("onerror",fi),Vt(),_e.removeListener("error",ii),T(_e,"error")===0&&_e.emit("error",fi)}we(_e,"error",ii);function zt(){_e.removeListener("finish",qt),Vt()}_e.once("close",zt);function qt(){N("onfinish"),_e.removeListener("close",zt),Vt()}_e.once("finish",qt);function Vt(){N("unpipe"),fe.unpipe(_e)}return _e.emit("pipe",fe),ue.flowing||(N("pipe resume"),fe.resume()),_e};function tt(_e){return function(){var fe=_e._readableState;N("pipeOnDrain",fe.awaitDrain),fe.awaitDrain&&fe.awaitDrain--,fe.awaitDrain===0&&T(_e,"data")&&(fe.flowing=!0,Je(_e))}}ye.prototype.unpipe=function(_e){var pe=this._readableState,fe={hasUnpiped:!1};if(pe.pipesCount===0)return this;if(pe.pipesCount===1)return _e&&_e!==pe.pipes?this:(_e||(_e=pe.pipes),pe.pipes=null,pe.pipesCount=0,pe.flowing=!1,_e&&_e.emit("unpipe",this,fe),this);if(!_e){var ue=pe.pipes,ce=pe.pipesCount;pe.pipes=null,pe.pipesCount=0,pe.flowing=!1;for(var Ee=0;Ee<ce;Ee++)ue[Ee].emit("unpipe",this,{hasUnpiped:!1});return this}var Ye=ve(pe.pipes,_e);return Ye===-1?this:(pe.pipes.splice(Ye,1),pe.pipesCount-=1,pe.pipesCount===1&&(pe.pipes=pe.pipes[0]),_e.emit("unpipe",this,fe),this)},ye.prototype.on=function(_e,pe){var fe=A.prototype.on.call(this,_e,pe),ue=this._readableState;return _e==="data"?(ue.readableListening=this.listenerCount("readable")>0,ue.flowing!==!1&&this.resume()):_e==="readable"&&!ue.endEmitted&&!ue.readableListening&&(ue.readableListening=ue.needReadable=!0,ue.flowing=!1,ue.emittedReadable=!1,N("on readable",ue.length,ue.reading),ue.length?Pe(this):ue.reading||S.nextTick(lt,this)),fe},ye.prototype.addListener=ye.prototype.on,ye.prototype.removeListener=function(_e,pe){var fe=A.prototype.removeListener.call(this,_e,pe);return _e==="readable"&&S.nextTick(ot,this),fe},ye.prototype.removeAllListeners=function(_e){var pe=A.prototype.removeAllListeners.apply(this,arguments);return(_e==="readable"||_e===void 0)&&S.nextTick(ot,this),pe};function ot(_e){var pe=_e._readableState;pe.readableListening=_e.listenerCount("readable")>0,pe.resumeScheduled&&!pe.paused?pe.flowing=!0:_e.listenerCount("data")>0&&_e.resume()}function lt(_e){N("readable nexttick read 0"),_e.read(0)}ye.prototype.resume=function(){var _e=this._readableState;return _e.flowing||(N("resume"),_e.flowing=!_e.readableListening,St(this,_e)),_e.paused=!1,this};function St(_e,pe){pe.resumeScheduled||(pe.resumeScheduled=!0,S.nextTick(et,_e,pe))}function et(_e,pe){N("resume",pe.reading),pe.reading||_e.read(0),pe.resumeScheduled=!1,_e.emit("resume"),Je(_e),pe.flowing&&!pe.reading&&_e.read(0)}ye.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Je(_e){var pe=_e._readableState;for(N("flow",pe.flowing);pe.flowing&&_e.read()!==null;);}ye.prototype.wrap=function(_e){var pe=this,fe=this._readableState,ue=!1;_e.on("end",function(){if(N("wrapped end"),fe.decoder&&!fe.ended){var Ye=fe.decoder.end();Ye&&Ye.length&&pe.push(Ye)}pe.push(null)}),_e.on("data",function(Ye){if(N("wrapped data"),fe.decoder&&(Ye=fe.decoder.write(Ye)),!(fe.objectMode&&Ye==null)&&!(!fe.objectMode&&(!Ye||!Ye.length))){var ft=pe.push(Ye);ft||(ue=!0,_e.pause())}});for(var ce in _e)this[ce]===void 0&&typeof _e[ce]=="function"&&(this[ce]=function(ft){return function(){return _e[ft].apply(_e,arguments)}}(ce));for(var Ee=0;Ee<oe.length;Ee++)_e.on(oe[Ee],this.emit.bind(this,oe[Ee]));return this._read=function(Ye){N("wrapped _read",Ye),ue&&(ue=!1,_e.resume())},this},typeof Symbol=="function"&&(ye.prototype[Symbol.asyncIterator]=function(){return te("Readable[Symbol.asyncIterator]"),de===void 0&&(de=m("./internal/streams/async_iterator")),de(this)}),Object.defineProperty(ye.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(ye.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(ye.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(pe){this._readableState&&(this._readableState.flowing=pe)}}),ye._fromList=Be,Object.defineProperty(ye.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Be(_e,pe){if(pe.length===0)return null;var fe;return pe.objectMode?fe=pe.buffer.shift():!_e||_e>=pe.length?(pe.decoder?fe=pe.buffer.join(""):pe.buffer.length===1?fe=pe.buffer.first():fe=pe.buffer.concat(pe.length),pe.buffer.clear()):fe=pe.buffer.consume(_e,pe.decoder),fe}function Ge(_e){var pe=_e._readableState;N("endReadable",pe.endEmitted),pe.endEmitted||(pe.ended=!0,S.nextTick(He,pe,_e))}function He(_e,pe){N("endReadableNT",_e.endEmitted,_e.length),!_e.endEmitted&&_e.length===0&&(_e.endEmitted=!0,pe.readable=!1,pe.emit("end"))}function ve(_e,pe){for(var fe=0,ue=_e.length;fe<ue;fe++)if(_e[fe]===pe)return fe;return-1}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"../errors":160,"../experimentalWarning":161,"./_stream_duplex":162,"./internal/streams/async_iterator":167,"./internal/streams/buffer_list":168,"./internal/streams/destroy":169,"./internal/streams/state":172,"./internal/streams/stream":173,_process:133,buffer:48,events:52,inherits:75,"string_decoder/":175,util:33}],165:[function(m,x,E){x.exports=D;var S=m("../errors").codes,h=S.ERR_METHOD_NOT_IMPLEMENTED,I=S.ERR_MULTIPLE_CALLBACK,T=S.ERR_TRANSFORM_ALREADY_TRANSFORMING,A=S.ERR_TRANSFORM_WITH_LENGTH_0,k=m("./_stream_duplex");m("inherits")(D,k);function P(N,B){var U=this._transformState;U.transforming=!1;var O=U.writecb;if(O===null)return this.emit("error",new I);U.writechunk=null,U.writecb=null,B!=null&&this.push(B),O(N);var V=this._readableState;V.reading=!1,(V.needReadable||V.length<V.highWaterMark)&&this._read(V.highWaterMark)}function D(N){if(!(this instanceof D))return new D(N);k.call(this,N),this._transformState={afterTransform:P.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,N&&(typeof N.transform=="function"&&(this._transform=N.transform),typeof N.flush=="function"&&(this._flush=N.flush)),this.on("prefinish",M)}function M(){var N=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(B,U){F(N,B,U)}):F(this,null,null)}D.prototype.push=function(N,B){return this._transformState.needTransform=!1,k.prototype.push.call(this,N,B)},D.prototype._transform=function(N,B,U){U(new h("_transform()"))},D.prototype._write=function(N,B,U){var O=this._transformState;if(O.writecb=U,O.writechunk=N,O.writeencoding=B,!O.transforming){var V=this._readableState;(O.needTransform||V.needReadable||V.length<V.highWaterMark)&&this._read(V.highWaterMark)}},D.prototype._read=function(N){var B=this._transformState;B.writechunk!==null&&!B.transforming?(B.transforming=!0,this._transform(B.writechunk,B.writeencoding,B.afterTransform)):B.needTransform=!0},D.prototype._destroy=function(N,B){k.prototype._destroy.call(this,N,function(U){B(U)})};function F(N,B,U){if(B)return N.emit("error",B);if(U!=null&&N.push(U),N._writableState.length)throw new A;if(N._transformState.transforming)throw new T;return N.push(null)}},{"../errors":160,"./_stream_duplex":162,inherits:75}],166:[function(m,x,E){(function(S,h){x.exports=we;function I(et){var Je=this;this.next=null,this.entry=null,this.finish=function(){St(Je,et)}}var T;we.WritableState=de;var A={deprecate:m("util-deprecate")},k=m("./internal/streams/stream"),P=m("buffer").Buffer,D=h.Uint8Array||function(){};function M(et){return P.from(et)}function F(et){return P.isBuffer(et)||et instanceof D}var N=m("./internal/streams/destroy"),B=m("./internal/streams/state"),U=B.getHighWaterMark,O=m("../errors").codes,V=O.ERR_INVALID_ARG_TYPE,Z=O.ERR_METHOD_NOT_IMPLEMENTED,W=O.ERR_MULTIPLE_CALLBACK,Y=O.ERR_STREAM_CANNOT_PIPE,X=O.ERR_STREAM_DESTROYED,J=O.ERR_STREAM_NULL_VALUES,q=O.ERR_STREAM_WRITE_AFTER_END,te=O.ERR_UNKNOWN_ENCODING;m("inherits")(we,k);function ne(){}function de(et,Je,Be){T=T||m("./_stream_duplex"),et=et||{},typeof Be!="boolean"&&(Be=Je instanceof T),this.objectMode=!!et.objectMode,Be&&(this.objectMode=this.objectMode||!!et.writableObjectMode),this.highWaterMark=U(this,et,"writableHighWaterMark",Be),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Ge=et.decodeStrings===!1;this.decodeStrings=!Ge,this.defaultEncoding=et.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(He){je(Je,He)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=et.emitClose!==!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new I(this)}de.prototype.getBuffer=function(){for(var Je=this.bufferedRequest,Be=[];Je;)Be.push(Je),Je=Je.next;return Be},function(){try{Object.defineProperty(de.prototype,"buffer",{get:A.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var oe;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(oe=Function.prototype[Symbol.hasInstance],Object.defineProperty(we,Symbol.hasInstance,{value:function(Je){return oe.call(this,Je)?!0:this!==we?!1:Je&&Je._writableState instanceof de}})):oe=function(Je){return Je instanceof this};function we(et){T=T||m("./_stream_duplex");var Je=this instanceof T;if(!Je&&!oe.call(we,this))return new we(et);this._writableState=new de(et,this,Je),this.writable=!0,et&&(typeof et.write=="function"&&(this._write=et.write),typeof et.writev=="function"&&(this._writev=et.writev),typeof et.destroy=="function"&&(this._destroy=et.destroy),typeof et.final=="function"&&(this._final=et.final)),k.call(this)}we.prototype.pipe=function(){this.emit("error",new Y)};function Ae(et,Je){var Be=new q;et.emit("error",Be),S.nextTick(Je,Be)}function ye(et,Je,Be,Ge){var He;return Be===null?He=new J:typeof Be!="string"&&!Je.objectMode&&(He=new V("chunk",["string","Buffer"],Be)),He?(et.emit("error",He),S.nextTick(Ge,He),!1):!0}we.prototype.write=function(et,Je,Be){var Ge=this._writableState,He=!1,ve=!Ge.objectMode&&F(et);return ve&&!P.isBuffer(et)&&(et=M(et)),typeof Je=="function"&&(Be=Je,Je=null),ve?Je="buffer":Je||(Je=Ge.defaultEncoding),typeof Be!="function"&&(Be=ne),Ge.ending?Ae(this,Be):(ve||ye(this,Ge,et,Be))&&(Ge.pendingcb++,He=xe(this,Ge,ve,et,Je,Be)),He},we.prototype.cork=function(){this._writableState.corked++},we.prototype.uncork=function(){var et=this._writableState;et.corked&&(et.corked--,!et.writing&&!et.corked&&!et.bufferProcessing&&et.bufferedRequest&&De(this,et))},we.prototype.setDefaultEncoding=function(Je){if(typeof Je=="string"&&(Je=Je.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Je+"").toLowerCase())>-1))throw new te(Je);return this._writableState.defaultEncoding=Je,this},Object.defineProperty(we.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function me(et,Je,Be){return!et.objectMode&&et.decodeStrings!==!1&&typeof Je=="string"&&(Je=P.from(Je,Be)),Je}Object.defineProperty(we.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function xe(et,Je,Be,Ge,He,ve){if(!Be){var _e=me(Je,Ge,He);Ge!==_e&&(Be=!0,He="buffer",Ge=_e)}var pe=Je.objectMode?1:Ge.length;Je.length+=pe;var fe=Je.length<Je.highWaterMark;if(fe||(Je.needDrain=!0),Je.writing||Je.corked){var ue=Je.lastBufferedRequest;Je.lastBufferedRequest={chunk:Ge,encoding:He,isBuf:Be,callback:ve,next:null},ue?ue.next=Je.lastBufferedRequest:Je.bufferedRequest=Je.lastBufferedRequest,Je.bufferedRequestCount+=1}else Le(et,Je,!1,pe,Ge,He,ve);return fe}function Le(et,Je,Be,Ge,He,ve,_e){Je.writelen=Ge,Je.writecb=_e,Je.writing=!0,Je.sync=!0,Je.destroyed?Je.onwrite(new X("write")):Be?et._writev(He,Je.onwrite):et._write(He,ve,Je.onwrite),Je.sync=!1}function Ze(et,Je,Be,Ge,He){--Je.pendingcb,Be?(S.nextTick(He,Ge),S.nextTick(ot,et,Je),et._writableState.errorEmitted=!0,et.emit("error",Ge)):(He(Ge),et._writableState.errorEmitted=!0,et.emit("error",Ge),ot(et,Je))}function Xe(et){et.writing=!1,et.writecb=null,et.length-=et.writelen,et.writelen=0}function je(et,Je){var Be=et._writableState,Ge=Be.sync,He=Be.writecb;if(typeof He!="function")throw new W;if(Xe(Be),Je)Ze(et,Be,Ge,Je,He);else{var ve=ze(Be)||et.destroyed;!ve&&!Be.corked&&!Be.bufferProcessing&&Be.bufferedRequest&&De(et,Be),Ge?S.nextTick(Ie,et,Be,ve,He):Ie(et,Be,ve,He)}}function Ie(et,Je,Be,Ge){Be||Pe(et,Je),Je.pendingcb--,Ge(),ot(et,Je)}function Pe(et,Je){Je.length===0&&Je.needDrain&&(Je.needDrain=!1,et.emit("drain"))}function De(et,Je){Je.bufferProcessing=!0;var Be=Je.bufferedRequest;if(et._writev&&Be&&Be.next){var Ge=Je.bufferedRequestCount,He=new Array(Ge),ve=Je.corkedRequestsFree;ve.entry=Be;for(var _e=0,pe=!0;Be;)He[_e]=Be,Be.isBuf||(pe=!1),Be=Be.next,_e+=1;He.allBuffers=pe,Le(et,Je,!0,Je.length,He,"",ve.finish),Je.pendingcb++,Je.lastBufferedRequest=null,ve.next?(Je.corkedRequestsFree=ve.next,ve.next=null):Je.corkedRequestsFree=new I(Je),Je.bufferedRequestCount=0}else{for(;Be;){var fe=Be.chunk,ue=Be.encoding,ce=Be.callback,Ee=Je.objectMode?1:fe.length;if(Le(et,Je,!1,Ee,fe,ue,ce),Be=Be.next,Je.bufferedRequestCount--,Je.writing)break}Be===null&&(Je.lastBufferedRequest=null)}Je.bufferedRequest=Be,Je.bufferProcessing=!1}we.prototype._write=function(et,Je,Be){Be(new Z("_write()"))},we.prototype._writev=null,we.prototype.end=function(et,Je,Be){var Ge=this._writableState;return typeof et=="function"?(Be=et,et=null,Je=null):typeof Je=="function"&&(Be=Je,Je=null),et!=null&&this.write(et,Je),Ge.corked&&(Ge.corked=1,this.uncork()),Ge.ending||lt(this,Ge,Be),this},Object.defineProperty(we.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ze(et){return et.ending&&et.length===0&&et.bufferedRequest===null&&!et.finished&&!et.writing}function it(et,Je){et._final(function(Be){Je.pendingcb--,Be&&et.emit("error",Be),Je.prefinished=!0,et.emit("prefinish"),ot(et,Je)})}function tt(et,Je){!Je.prefinished&&!Je.finalCalled&&(typeof et._final=="function"&&!Je.destroyed?(Je.pendingcb++,Je.finalCalled=!0,S.nextTick(it,et,Je)):(Je.prefinished=!0,et.emit("prefinish")))}function ot(et,Je){var Be=ze(Je);return Be&&(tt(et,Je),Je.pendingcb===0&&(Je.finished=!0,et.emit("finish"))),Be}function lt(et,Je,Be){Je.ending=!0,ot(et,Je),Be&&(Je.finished?S.nextTick(Be):et.once("finish",Be)),Je.ended=!0,et.writable=!1}function St(et,Je,Be){var Ge=et.entry;for(et.entry=null;Ge;){var He=Ge.callback;Je.pendingcb--,He(Be),Ge=Ge.next}Je.corkedRequestsFree.next=et}Object.defineProperty(we.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Je){!this._writableState||(this._writableState.destroyed=Je)}}),we.prototype.destroy=N.destroy,we.prototype._undestroy=N.undestroy,we.prototype._destroy=function(et,Je){Je(et)}}).call(this,m("_process"),typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{"../errors":160,"./_stream_duplex":162,"./internal/streams/destroy":169,"./internal/streams/state":172,"./internal/streams/stream":173,_process:133,buffer:48,inherits:75,"util-deprecate":183}],167:[function(m,x,E){(function(S){var h;function I(X,J,q){return J in X?Object.defineProperty(X,J,{value:q,enumerable:!0,configurable:!0,writable:!0}):X[J]=q,X}var T=m("./end-of-stream"),A=Symbol("lastResolve"),k=Symbol("lastReject"),P=Symbol("error"),D=Symbol("ended"),M=Symbol("lastPromise"),F=Symbol("handlePromise"),N=Symbol("stream");function B(X,J){return{value:X,done:J}}function U(X){var J=X[A];if(J!==null){var q=X[N].read();q!==null&&(X[M]=null,X[A]=null,X[k]=null,J(B(q,!1)))}}function O(X){S.nextTick(U,X)}function V(X,J){return function(q,te){X.then(function(){if(J[D]){q(B(void 0,!0));return}J[F](q,te)},te)}}var Z=Object.getPrototypeOf(function(){}),W=Object.setPrototypeOf((h={get stream(){return this[N]},next:function(){var J=this,q=this[P];if(q!==null)return Promise.reject(q);if(this[D])return Promise.resolve(B(void 0,!0));if(this[N].destroyed)return new Promise(function(oe,we){S.nextTick(function(){J[P]?we(J[P]):oe(B(void 0,!0))})});var te=this[M],ne;if(te)ne=new Promise(V(te,this));else{var de=this[N].read();if(de!==null)return Promise.resolve(B(de,!1));ne=new Promise(this[F])}return this[M]=ne,ne}},I(h,Symbol.asyncIterator,function(){return this}),I(h,"return",function(){var J=this;return new Promise(function(q,te){J[N].destroy(null,function(ne){if(ne){te(ne);return}q(B(void 0,!0))})})}),h),Z),Y=function(J){var q,te=Object.create(W,(q={},I(q,N,{value:J,writable:!0}),I(q,A,{value:null,writable:!0}),I(q,k,{value:null,writable:!0}),I(q,P,{value:null,writable:!0}),I(q,D,{value:J._readableState.endEmitted,writable:!0}),I(q,F,{value:function(de,oe){var we=te[N].read();we?(te[M]=null,te[A]=null,te[k]=null,de(B(we,!1))):(te[A]=de,te[k]=oe)},writable:!0}),q));return te[M]=null,T(J,function(ne){if(ne&&ne.code!=="ERR_STREAM_PREMATURE_CLOSE"){var de=te[k];de!==null&&(te[M]=null,te[A]=null,te[k]=null,de(ne)),te[P]=ne;return}var oe=te[A];oe!==null&&(te[M]=null,te[A]=null,te[k]=null,oe(B(void 0,!0))),te[D]=!0}),J.on("readable",O.bind(null,te)),te};x.exports=Y}).call(this,m("_process"))},{"./end-of-stream":170,_process:133}],168:[function(m,x,E){function S(M){for(var F=1;F<arguments.length;F++){var N=arguments[F]!=null?arguments[F]:{},B=Object.keys(N);typeof Object.getOwnPropertySymbols=="function"&&(B=B.concat(Object.getOwnPropertySymbols(N).filter(function(U){return Object.getOwnPropertyDescriptor(N,U).enumerable}))),B.forEach(function(U){h(M,U,N[U])})}return M}function h(M,F,N){return F in M?Object.defineProperty(M,F,{value:N,enumerable:!0,configurable:!0,writable:!0}):M[F]=N,M}var I=m("buffer"),T=I.Buffer,A=m("util"),k=A.inspect,P=k&&k.custom||"inspect";function D(M,F,N){T.prototype.copy.call(M,F,N)}x.exports=function(){function M(){this.head=null,this.tail=null,this.length=0}var F=M.prototype;return F.push=function(B){var U={data:B,next:null};this.length>0?this.tail.next=U:this.head=U,this.tail=U,++this.length},F.unshift=function(B){var U={data:B,next:this.head};this.length===0&&(this.tail=U),this.head=U,++this.length},F.shift=function(){if(this.length!==0){var B=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,B}},F.clear=function(){this.head=this.tail=null,this.length=0},F.join=function(B){if(this.length===0)return"";for(var U=this.head,O=""+U.data;U=U.next;)O+=B+U.data;return O},F.concat=function(B){if(this.length===0)return T.alloc(0);for(var U=T.allocUnsafe(B>>>0),O=this.head,V=0;O;)D(O.data,U,V),V+=O.data.length,O=O.next;return U},F.consume=function(B,U){var O;return B<this.head.data.length?(O=this.head.data.slice(0,B),this.head.data=this.head.data.slice(B)):B===this.head.data.length?O=this.shift():O=U?this._getString(B):this._getBuffer(B),O},F.first=function(){return this.head.data},F._getString=function(B){var U=this.head,O=1,V=U.data;for(B-=V.length;U=U.next;){var Z=U.data,W=B>Z.length?Z.length:B;if(W===Z.length?V+=Z:V+=Z.slice(0,B),B-=W,B===0){W===Z.length?(++O,U.next?this.head=U.next:this.head=this.tail=null):(this.head=U,U.data=Z.slice(W));break}++O}return this.length-=O,V},F._getBuffer=function(B){var U=T.allocUnsafe(B),O=this.head,V=1;for(O.data.copy(U),B-=O.data.length;O=O.next;){var Z=O.data,W=B>Z.length?Z.length:B;if(Z.copy(U,U.length-B,0,W),B-=W,B===0){W===Z.length?(++V,O.next?this.head=O.next:this.head=this.tail=null):(this.head=O,O.data=Z.slice(W));break}++V}return this.length-=V,U},F[P]=function(N,B){return k(this,S({},B,{depth:0,customInspect:!1}))},M}()},{buffer:48,util:33}],169:[function(m,x,E){(function(S){function h(P,D){var M=this,F=this._readableState&&this._readableState.destroyed,N=this._writableState&&this._writableState.destroyed;return F||N?(D?D(P):P&&(!this._writableState||!this._writableState.errorEmitted)&&S.nextTick(k,this,P),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(P||null,function(B){!D&&B?(S.nextTick(I,M,B),M._writableState&&(M._writableState.errorEmitted=!0)):D?(S.nextTick(T,M),D(B)):S.nextTick(T,M)}),this)}function I(P,D){k(P,D),T(P)}function T(P){P._writableState&&!P._writableState.emitClose||P._readableState&&!P._readableState.emitClose||P.emit("close")}function A(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function k(P,D){P.emit("error",D)}x.exports={destroy:h,undestroy:A}}).call(this,m("_process"))},{_process:133}],170:[function(m,x,E){var S=m("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function h(k){var P=!1;return function(){if(!P){P=!0;for(var D=arguments.length,M=new Array(D),F=0;F<D;F++)M[F]=arguments[F];k.apply(this,M)}}}function I(){}function T(k){return k.setHeader&&typeof k.abort=="function"}function A(k,P,D){if(typeof P=="function")return A(k,null,P);P||(P={}),D=h(D||I);var M=P.readable||P.readable!==!1&&k.readable,F=P.writable||P.writable!==!1&&k.writable,N=function(){k.writable||U()},B=k._writableState&&k._writableState.finished,U=function(){F=!1,B=!0,M||D.call(k)},O=k._readableState&&k._readableState.endEmitted,V=function(){M=!1,O=!0,F||D.call(k)},Z=function(J){D.call(k,J)},W=function(){var J;if(M&&!O)return(!k._readableState||!k._readableState.ended)&&(J=new S),D.call(k,J);if(F&&!B)return(!k._writableState||!k._writableState.ended)&&(J=new S),D.call(k,J)},Y=function(){k.req.on("finish",U)};return T(k)?(k.on("complete",U),k.on("abort",W),k.req?Y():k.on("request",Y)):F&&!k._writableState&&(k.on("end",N),k.on("close",N)),k.on("end",V),k.on("finish",U),P.error!==!1&&k.on("error",Z),k.on("close",W),function(){k.removeListener("complete",U),k.removeListener("abort",W),k.removeListener("request",Y),k.req&&k.req.removeListener("finish",U),k.removeListener("end",N),k.removeListener("close",N),k.removeListener("finish",U),k.removeListener("end",V),k.removeListener("error",Z),k.removeListener("close",W)}}x.exports=A},{"../../../errors":160}],171:[function(m,x,E){var S;function h(U){var O=!1;return function(){O||(O=!0,U.apply(void 0,arguments))}}var I=m("../../../errors").codes,T=I.ERR_MISSING_ARGS,A=I.ERR_STREAM_DESTROYED;function k(U){if(U)throw U}function P(U){return U.setHeader&&typeof U.abort=="function"}function D(U,O,V,Z){Z=h(Z);var W=!1;U.on("close",function(){W=!0}),S===void 0&&(S=m("./end-of-stream")),S(U,{readable:O,writable:V},function(X){if(X)return Z(X);W=!0,Z()});var Y=!1;return function(X){if(!W&&!Y){if(Y=!0,P(U))return U.abort();if(typeof U.destroy=="function")return U.destroy();Z(X||new A("pipe"))}}}function M(U){U()}function F(U,O){return U.pipe(O)}function N(U){return!U.length||typeof U[U.length-1]!="function"?k:U.pop()}function B(){for(var U=arguments.length,O=new Array(U),V=0;V<U;V++)O[V]=arguments[V];var Z=N(O);if(Array.isArray(O[0])&&(O=O[0]),O.length<2)throw new T("streams");var W,Y=O.map(function(X,J){var q=J<O.length-1,te=J>0;return D(X,q,te,function(ne){W||(W=ne),ne&&Y.forEach(M),!q&&(Y.forEach(M),Z(W))})});return O.reduce(F)}x.exports=B},{"../../../errors":160,"./end-of-stream":170}],172:[function(m,x,E){var S=m("../../../errors").codes.ERR_INVALID_OPT_VALUE;function h(T,A,k){return T.highWaterMark!=null?T.highWaterMark:A?T[k]:null}function I(T,A,k,P){var D=h(A,P,k);if(D!=null){if(!(isFinite(D)&&Math.floor(D)===D)||D<0){var M=P?k:"highWaterMark";throw new S(M,D)}return Math.floor(D)}return T.objectMode?16:16*1024}x.exports={getHighWaterMark:I}},{"../../../errors":160}],173:[function(m,x,E){arguments[4][146][0].apply(E,arguments)},{dup:146,events:52}],174:[function(m,x,E){E=x.exports=m("./lib/_stream_readable.js"),E.Stream=E,E.Readable=E,E.Writable=m("./lib/_stream_writable.js"),E.Duplex=m("./lib/_stream_duplex.js"),E.Transform=m("./lib/_stream_transform.js"),E.PassThrough=m("./lib/_stream_passthrough.js"),E.finished=m("./lib/internal/streams/end-of-stream.js"),E.pipeline=m("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":162,"./lib/_stream_passthrough.js":163,"./lib/_stream_readable.js":164,"./lib/_stream_transform.js":165,"./lib/_stream_writable.js":166,"./lib/internal/streams/end-of-stream.js":170,"./lib/internal/streams/pipeline.js":171}],175:[function(m,x,E){arguments[4][148][0].apply(E,arguments)},{dup:148,"safe-buffer":154}],176:[function(m,x,E){(function(S,h){var I=m("process/browser.js").nextTick,T=Function.prototype.apply,A=Array.prototype.slice,k={},P=0;E.setTimeout=function(){return new D(T.call(setTimeout,g,arguments),clearTimeout)},E.setInterval=function(){return new D(T.call(setInterval,g,arguments),clearInterval)},E.clearTimeout=E.clearInterval=function(M){M.close()};function D(M,F){this._id=M,this._clearFn=F}D.prototype.unref=D.prototype.ref=function(){},D.prototype.close=function(){this._clearFn.call(g,this._id)},E.enroll=function(M,F){clearTimeout(M._idleTimeoutId),M._idleTimeout=F},E.unenroll=function(M){clearTimeout(M._idleTimeoutId),M._idleTimeout=-1},E._unrefActive=E.active=function(M){clearTimeout(M._idleTimeoutId);var F=M._idleTimeout;F>=0&&(M._idleTimeoutId=setTimeout(function(){M._onTimeout&&M._onTimeout()},F))},E.setImmediate=typeof S=="function"?S:function(M){var F=P++,N=arguments.length<2?!1:A.call(arguments,1);return k[F]=!0,I(function(){k[F]&&(N?M.apply(null,N):M.call(null),E.clearImmediate(F))}),F},E.clearImmediate=typeof h=="function"?h:function(M){delete k[M]}}).call(this,m("timers").setImmediate,m("timers").clearImmediate)},{"process/browser.js":133,timers:176}],177:[function(m,x,E){(function(S){Object.defineProperty(E,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me};E.clone=P,E.addLast=F,E.addFirst=N,E.removeLast=B,E.removeFirst=U,E.insert=O,E.removeAt=V,E.replaceAt=Z,E.getIn=W,E.set=Y,E.setIn=J,E.update=q,E.updateIn=te,E.merge=ne,E.mergeDeep=de,E.mergeIn=oe,E.omit=we,E.addDefaults=Ae;/*!
 * Timm
 *
 * Immutability helpers with fast reads and acceptable writes.
 *
 * @copyright Guillermo Grau Panea 2016
 * @license MIT
 */var I="INVALID_ARGS";function T(me){throw new Error(me)}function A(me){var xe=Object.keys(me);return Object.getOwnPropertySymbols?xe.concat(Object.getOwnPropertySymbols(me)):xe}var k={}.hasOwnProperty;function P(me){if(Array.isArray(me))return me.slice();for(var xe=A(me),Le={},Ze=0;Ze<xe.length;Ze++){var Xe=xe[Ze];Le[Xe]=me[Xe]}return Le}function D(me,xe,Le){var Ze=Le;Ze==null&&T(I);for(var Xe=!1,je=arguments.length,Ie=Array(je>3?je-3:0),Pe=3;Pe<je;Pe++)Ie[Pe-3]=arguments[Pe];for(var De=0;De<Ie.length;De++){var ze=Ie[De];if(ze!=null){var it=A(ze);if(!!it.length)for(var tt=0;tt<=it.length;tt++){var ot=it[tt];if(!(me&&Ze[ot]!==void 0)){var lt=ze[ot];xe&&M(Ze[ot])&&M(lt)&&(lt=D(me,xe,Ze[ot],lt)),!(lt===void 0||lt===Ze[ot])&&(Xe||(Xe=!0,Ze=P(Ze)),Ze[ot]=lt)}}}}return Ze}function M(me){var xe=typeof me=="undefined"?"undefined":h(me);return me!=null&&xe==="object"}function F(me,xe){return Array.isArray(xe)?me.concat(xe):me.concat([xe])}function N(me,xe){return Array.isArray(xe)?xe.concat(me):[xe].concat(me)}function B(me){return me.length?me.slice(0,me.length-1):me}function U(me){return me.length?me.slice(1):me}function O(me,xe,Le){return me.slice(0,xe).concat(Array.isArray(Le)?Le:[Le]).concat(me.slice(xe))}function V(me,xe){return xe>=me.length||xe<0?me:me.slice(0,xe).concat(me.slice(xe+1))}function Z(me,xe,Le){if(me[xe]===Le)return me;for(var Ze=me.length,Xe=Array(Ze),je=0;je<Ze;je++)Xe[je]=me[je];return Xe[xe]=Le,Xe}function W(me,xe){if(!Array.isArray(xe)&&T(I),me!=null){for(var Le=me,Ze=0;Ze<xe.length;Ze++){var Xe=xe[Ze];if(Le=Le!=null?Le[Xe]:void 0,Le===void 0)return Le}return Le}}function Y(me,xe,Le){var Ze=typeof xe=="number"?[]:{},Xe=me==null?Ze:me;if(Xe[xe]===Le)return Xe;var je=P(Xe);return je[xe]=Le,je}function X(me,xe,Le,Ze){var Xe=void 0,je=xe[Ze];if(Ze===xe.length-1)Xe=Le;else{var Ie=M(me)&&M(me[je])?me[je]:typeof xe[Ze+1]=="number"?[]:{};Xe=X(Ie,xe,Le,Ze+1)}return Y(me,je,Xe)}function J(me,xe,Le){return xe.length?X(me,xe,Le,0):Le}function q(me,xe,Le){var Ze=me==null?void 0:me[xe],Xe=Le(Ze);return Y(me,xe,Xe)}function te(me,xe,Le){var Ze=W(me,xe),Xe=Le(Ze);return J(me,xe,Xe)}function ne(me,xe,Le,Ze,Xe,je){for(var Ie=arguments.length,Pe=Array(Ie>6?Ie-6:0),De=6;De<Ie;De++)Pe[De-6]=arguments[De];return Pe.length?D.call.apply(D,[null,!1,!1,me,xe,Le,Ze,Xe,je].concat(Pe)):D(!1,!1,me,xe,Le,Ze,Xe,je)}function de(me,xe,Le,Ze,Xe,je){for(var Ie=arguments.length,Pe=Array(Ie>6?Ie-6:0),De=6;De<Ie;De++)Pe[De-6]=arguments[De];return Pe.length?D.call.apply(D,[null,!1,!0,me,xe,Le,Ze,Xe,je].concat(Pe)):D(!1,!0,me,xe,Le,Ze,Xe,je)}function oe(me,xe,Le,Ze,Xe,je,Ie){var Pe=W(me,xe);Pe==null&&(Pe={});for(var De=void 0,ze=arguments.length,it=Array(ze>7?ze-7:0),tt=7;tt<ze;tt++)it[tt-7]=arguments[tt];return it.length?De=D.call.apply(D,[null,!1,!1,Pe,Le,Ze,Xe,je,Ie].concat(it)):De=D(!1,!1,Pe,Le,Ze,Xe,je,Ie),J(me,xe,De)}function we(me,xe){for(var Le=Array.isArray(xe)?xe:[xe],Ze=!1,Xe=0;Xe<Le.length;Xe++)if(k.call(me,Le[Xe])){Ze=!0;break}if(!Ze)return me;for(var je={},Ie=A(me),Pe=0;Pe<Ie.length;Pe++){var De=Ie[Pe];Le.indexOf(De)>=0||(je[De]=me[De])}return je}function Ae(me,xe,Le,Ze,Xe,je){for(var Ie=arguments.length,Pe=Array(Ie>6?Ie-6:0),De=6;De<Ie;De++)Pe[De-6]=arguments[De];return Pe.length?D.call.apply(D,[null,!0,!1,me,xe,Le,Ze,Xe,je].concat(Pe)):D(!0,!1,me,xe,Le,Ze,Xe,je)}var ye={clone:P,addLast:F,addFirst:N,removeLast:B,removeFirst:U,insert:O,removeAt:V,replaceAt:Z,getIn:W,set:Y,setIn:J,update:q,updateIn:te,merge:ne,mergeDeep:de,mergeIn:oe,omit:we,addDefaults:Ae};E.default=ye}).call(this,m("_process"))},{_process:133}],178:[function(m,x,E){(function(S){var h=/^\s+/,I=/\s+$/,T=0,A=S.round,k=S.min,P=S.max,D=S.random;function M(ve,_e){if(ve=ve||"",_e=_e||{},ve instanceof M)return ve;if(!(this instanceof M))return new M(ve,_e);var pe=F(ve);this._originalInput=ve,this._r=pe.r,this._g=pe.g,this._b=pe.b,this._a=pe.a,this._roundA=A(100*this._a)/100,this._format=_e.format||pe.format,this._gradientType=_e.gradientType,this._r<1&&(this._r=A(this._r)),this._g<1&&(this._g=A(this._g)),this._b<1&&(this._b=A(this._b)),this._ok=pe.ok,this._tc_id=T++}M.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var ve=this.toRgb();return(ve.r*299+ve.g*587+ve.b*114)/1e3},getLuminance:function(){var ve=this.toRgb(),_e,pe,fe,ue,ce,Ee;return _e=ve.r/255,pe=ve.g/255,fe=ve.b/255,_e<=.03928?ue=_e/12.92:ue=S.pow((_e+.055)/1.055,2.4),pe<=.03928?ce=pe/12.92:ce=S.pow((pe+.055)/1.055,2.4),fe<=.03928?Ee=fe/12.92:Ee=S.pow((fe+.055)/1.055,2.4),.2126*ue+.7152*ce+.0722*Ee},setAlpha:function(ve){return this._a=Ie(ve),this._roundA=A(100*this._a)/100,this},toHsv:function(){var ve=O(this._r,this._g,this._b);return{h:ve.h*360,s:ve.s,v:ve.v,a:this._a}},toHsvString:function(){var ve=O(this._r,this._g,this._b),_e=A(ve.h*360),pe=A(ve.s*100),fe=A(ve.v*100);return this._a==1?"hsv("+_e+", "+pe+"%, "+fe+"%)":"hsva("+_e+", "+pe+"%, "+fe+"%, "+this._roundA+")"},toHsl:function(){var ve=B(this._r,this._g,this._b);return{h:ve.h*360,s:ve.s,l:ve.l,a:this._a}},toHslString:function(){var ve=B(this._r,this._g,this._b),_e=A(ve.h*360),pe=A(ve.s*100),fe=A(ve.l*100);return this._a==1?"hsl("+_e+", "+pe+"%, "+fe+"%)":"hsla("+_e+", "+pe+"%, "+fe+"%, "+this._roundA+")"},toHex:function(ve){return Z(this._r,this._g,this._b,ve)},toHexString:function(ve){return"#"+this.toHex(ve)},toHex8:function(ve){return W(this._r,this._g,this._b,this._a,ve)},toHex8String:function(ve){return"#"+this.toHex8(ve)},toRgb:function(){return{r:A(this._r),g:A(this._g),b:A(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+A(this._r)+", "+A(this._g)+", "+A(this._b)+")":"rgba("+A(this._r)+", "+A(this._g)+", "+A(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:A(Pe(this._r,255)*100)+"%",g:A(Pe(this._g,255)*100)+"%",b:A(Pe(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+A(Pe(this._r,255)*100)+"%, "+A(Pe(this._g,255)*100)+"%, "+A(Pe(this._b,255)*100)+"%)":"rgba("+A(Pe(this._r,255)*100)+"%, "+A(Pe(this._g,255)*100)+"%, "+A(Pe(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:Xe[Z(this._r,this._g,this._b,!0)]||!1},toFilter:function(ve){var _e="#"+Y(this._r,this._g,this._b,this._a),pe=_e,fe=this._gradientType?"GradientType = 1, ":"";if(ve){var ue=M(ve);pe="#"+Y(ue._r,ue._g,ue._b,ue._a)}return"progid:DXImageTransform.Microsoft.gradient("+fe+"startColorstr="+_e+",endColorstr="+pe+")"},toString:function(ve){var _e=!!ve;ve=ve||this._format;var pe=!1,fe=this._a<1&&this._a>=0,ue=!_e&&fe&&(ve==="hex"||ve==="hex6"||ve==="hex3"||ve==="hex4"||ve==="hex8"||ve==="name");return ue?ve==="name"&&this._a===0?this.toName():this.toRgbString():(ve==="rgb"&&(pe=this.toRgbString()),ve==="prgb"&&(pe=this.toPercentageRgbString()),(ve==="hex"||ve==="hex6")&&(pe=this.toHexString()),ve==="hex3"&&(pe=this.toHexString(!0)),ve==="hex4"&&(pe=this.toHex8String(!0)),ve==="hex8"&&(pe=this.toHex8String()),ve==="name"&&(pe=this.toName()),ve==="hsl"&&(pe=this.toHslString()),ve==="hsv"&&(pe=this.toHsvString()),pe||this.toHexString())},clone:function(){return M(this.toString())},_applyModification:function(ve,_e){var pe=ve.apply(null,[this].concat([].slice.call(_e)));return this._r=pe._r,this._g=pe._g,this._b=pe._b,this.setAlpha(pe._a),this},lighten:function(){return this._applyModification(te,arguments)},brighten:function(){return this._applyModification(ne,arguments)},darken:function(){return this._applyModification(de,arguments)},desaturate:function(){return this._applyModification(X,arguments)},saturate:function(){return this._applyModification(J,arguments)},greyscale:function(){return this._applyModification(q,arguments)},spin:function(){return this._applyModification(oe,arguments)},_applyCombination:function(ve,_e){return ve.apply(null,[this].concat([].slice.call(_e)))},analogous:function(){return this._applyCombination(xe,arguments)},complement:function(){return this._applyCombination(we,arguments)},monochromatic:function(){return this._applyCombination(Le,arguments)},splitcomplement:function(){return this._applyCombination(me,arguments)},triad:function(){return this._applyCombination(Ae,arguments)},tetrad:function(){return this._applyCombination(ye,arguments)}},M.fromRatio=function(ve,_e){if(typeof ve=="object"){var pe={};for(var fe in ve)ve.hasOwnProperty(fe)&&(fe==="a"?pe[fe]=ve[fe]:pe[fe]=lt(ve[fe]));ve=pe}return M(ve,_e)};function F(ve){var _e={r:0,g:0,b:0},pe=1,fe=null,ue=null,ce=null,Ee=!1,Ye=!1;return typeof ve=="string"&&(ve=Ge(ve)),typeof ve=="object"&&(Be(ve.r)&&Be(ve.g)&&Be(ve.b)?(_e=N(ve.r,ve.g,ve.b),Ee=!0,Ye=String(ve.r).substr(-1)==="%"?"prgb":"rgb"):Be(ve.h)&&Be(ve.s)&&Be(ve.v)?(fe=lt(ve.s),ue=lt(ve.v),_e=V(ve.h,fe,ue),Ee=!0,Ye="hsv"):Be(ve.h)&&Be(ve.s)&&Be(ve.l)&&(fe=lt(ve.s),ce=lt(ve.l),_e=U(ve.h,fe,ce),Ee=!0,Ye="hsl"),ve.hasOwnProperty("a")&&(pe=ve.a)),pe=Ie(pe),{ok:Ee,format:ve.format||Ye,r:k(255,P(_e.r,0)),g:k(255,P(_e.g,0)),b:k(255,P(_e.b,0)),a:pe}}function N(ve,_e,pe){return{r:Pe(ve,255)*255,g:Pe(_e,255)*255,b:Pe(pe,255)*255}}function B(ve,_e,pe){ve=Pe(ve,255),_e=Pe(_e,255),pe=Pe(pe,255);var fe=P(ve,_e,pe),ue=k(ve,_e,pe),ce,Ee,Ye=(fe+ue)/2;if(fe==ue)ce=Ee=0;else{var ft=fe-ue;switch(Ee=Ye>.5?ft/(2-fe-ue):ft/(fe+ue),fe){case ve:ce=(_e-pe)/ft+(_e<pe?6:0);break;case _e:ce=(pe-ve)/ft+2;break;case pe:ce=(ve-_e)/ft+4;break}ce/=6}return{h:ce,s:Ee,l:Ye}}function U(ve,_e,pe){var fe,ue,ce;ve=Pe(ve,360),_e=Pe(_e,100),pe=Pe(pe,100);function Ee(_t,It,$t){return $t<0&&($t+=1),$t>1&&($t-=1),$t<1/6?_t+(It-_t)*6*$t:$t<1/2?It:$t<2/3?_t+(It-_t)*(2/3-$t)*6:_t}if(_e===0)fe=ue=ce=pe;else{var Ye=pe<.5?pe*(1+_e):pe+_e-pe*_e,ft=2*pe-Ye;fe=Ee(ft,Ye,ve+1/3),ue=Ee(ft,Ye,ve),ce=Ee(ft,Ye,ve-1/3)}return{r:fe*255,g:ue*255,b:ce*255}}function O(ve,_e,pe){ve=Pe(ve,255),_e=Pe(_e,255),pe=Pe(pe,255);var fe=P(ve,_e,pe),ue=k(ve,_e,pe),ce,Ee,Ye=fe,ft=fe-ue;if(Ee=fe===0?0:ft/fe,fe==ue)ce=0;else{switch(fe){case ve:ce=(_e-pe)/ft+(_e<pe?6:0);break;case _e:ce=(pe-ve)/ft+2;break;case pe:ce=(ve-_e)/ft+4;break}ce/=6}return{h:ce,s:Ee,v:Ye}}function V(ve,_e,pe){ve=Pe(ve,360)*6,_e=Pe(_e,100),pe=Pe(pe,100);var fe=S.floor(ve),ue=ve-fe,ce=pe*(1-_e),Ee=pe*(1-ue*_e),Ye=pe*(1-(1-ue)*_e),ft=fe%6,_t=[pe,Ee,ce,ce,Ye,pe][ft],It=[Ye,pe,pe,Ee,ce,ce][ft],$t=[ce,ce,Ye,pe,pe,Ee][ft];return{r:_t*255,g:It*255,b:$t*255}}function Z(ve,_e,pe,fe){var ue=[ot(A(ve).toString(16)),ot(A(_e).toString(16)),ot(A(pe).toString(16))];return fe&&ue[0].charAt(0)==ue[0].charAt(1)&&ue[1].charAt(0)==ue[1].charAt(1)&&ue[2].charAt(0)==ue[2].charAt(1)?ue[0].charAt(0)+ue[1].charAt(0)+ue[2].charAt(0):ue.join("")}function W(ve,_e,pe,fe,ue){var ce=[ot(A(ve).toString(16)),ot(A(_e).toString(16)),ot(A(pe).toString(16)),ot(St(fe))];return ue&&ce[0].charAt(0)==ce[0].charAt(1)&&ce[1].charAt(0)==ce[1].charAt(1)&&ce[2].charAt(0)==ce[2].charAt(1)&&ce[3].charAt(0)==ce[3].charAt(1)?ce[0].charAt(0)+ce[1].charAt(0)+ce[2].charAt(0)+ce[3].charAt(0):ce.join("")}function Y(ve,_e,pe,fe){var ue=[ot(St(fe)),ot(A(ve).toString(16)),ot(A(_e).toString(16)),ot(A(pe).toString(16))];return ue.join("")}M.equals=function(ve,_e){return!ve||!_e?!1:M(ve).toRgbString()==M(_e).toRgbString()},M.random=function(){return M.fromRatio({r:D(),g:D(),b:D()})};function X(ve,_e){_e=_e===0?0:_e||10;var pe=M(ve).toHsl();return pe.s-=_e/100,pe.s=De(pe.s),M(pe)}function J(ve,_e){_e=_e===0?0:_e||10;var pe=M(ve).toHsl();return pe.s+=_e/100,pe.s=De(pe.s),M(pe)}function q(ve){return M(ve).desaturate(100)}function te(ve,_e){_e=_e===0?0:_e||10;var pe=M(ve).toHsl();return pe.l+=_e/100,pe.l=De(pe.l),M(pe)}function ne(ve,_e){_e=_e===0?0:_e||10;var pe=M(ve).toRgb();return pe.r=P(0,k(255,pe.r-A(255*-(_e/100)))),pe.g=P(0,k(255,pe.g-A(255*-(_e/100)))),pe.b=P(0,k(255,pe.b-A(255*-(_e/100)))),M(pe)}function de(ve,_e){_e=_e===0?0:_e||10;var pe=M(ve).toHsl();return pe.l-=_e/100,pe.l=De(pe.l),M(pe)}function oe(ve,_e){var pe=M(ve).toHsl(),fe=(pe.h+_e)%360;return pe.h=fe<0?360+fe:fe,M(pe)}function we(ve){var _e=M(ve).toHsl();return _e.h=(_e.h+180)%360,M(_e)}function Ae(ve){var _e=M(ve).toHsl(),pe=_e.h;return[M(ve),M({h:(pe+120)%360,s:_e.s,l:_e.l}),M({h:(pe+240)%360,s:_e.s,l:_e.l})]}function ye(ve){var _e=M(ve).toHsl(),pe=_e.h;return[M(ve),M({h:(pe+90)%360,s:_e.s,l:_e.l}),M({h:(pe+180)%360,s:_e.s,l:_e.l}),M({h:(pe+270)%360,s:_e.s,l:_e.l})]}function me(ve){var _e=M(ve).toHsl(),pe=_e.h;return[M(ve),M({h:(pe+72)%360,s:_e.s,l:_e.l}),M({h:(pe+216)%360,s:_e.s,l:_e.l})]}function xe(ve,_e,pe){_e=_e||6,pe=pe||30;var fe=M(ve).toHsl(),ue=360/pe,ce=[M(ve)];for(fe.h=(fe.h-(ue*_e>>1)+720)%360;--_e;)fe.h=(fe.h+ue)%360,ce.push(M(fe));return ce}function Le(ve,_e){_e=_e||6;for(var pe=M(ve).toHsv(),fe=pe.h,ue=pe.s,ce=pe.v,Ee=[],Ye=1/_e;_e--;)Ee.push(M({h:fe,s:ue,v:ce})),ce=(ce+Ye)%1;return Ee}M.mix=function(ve,_e,pe){pe=pe===0?0:pe||50;var fe=M(ve).toRgb(),ue=M(_e).toRgb(),ce=pe/100,Ee={r:(ue.r-fe.r)*ce+fe.r,g:(ue.g-fe.g)*ce+fe.g,b:(ue.b-fe.b)*ce+fe.b,a:(ue.a-fe.a)*ce+fe.a};return M(Ee)},M.readability=function(ve,_e){var pe=M(ve),fe=M(_e);return(S.max(pe.getLuminance(),fe.getLuminance())+.05)/(S.min(pe.getLuminance(),fe.getLuminance())+.05)},M.isReadable=function(ve,_e,pe){var fe=M.readability(ve,_e),ue,ce;switch(ce=!1,ue=He(pe),ue.level+ue.size){case"AAsmall":case"AAAlarge":ce=fe>=4.5;break;case"AAlarge":ce=fe>=3;break;case"AAAsmall":ce=fe>=7;break}return ce},M.mostReadable=function(ve,_e,pe){var fe=null,ue=0,ce,Ee,Ye,ft;pe=pe||{},Ee=pe.includeFallbackColors,Ye=pe.level,ft=pe.size;for(var _t=0;_t<_e.length;_t++)ce=M.readability(ve,_e[_t]),ce>ue&&(ue=ce,fe=M(_e[_t]));return M.isReadable(ve,fe,{level:Ye,size:ft})||!Ee?fe:(pe.includeFallbackColors=!1,M.mostReadable(ve,["#fff","#000"],pe))};var Ze=M.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Xe=M.hexNames=je(Ze);function je(ve){var _e={};for(var pe in ve)ve.hasOwnProperty(pe)&&(_e[ve[pe]]=pe);return _e}function Ie(ve){return ve=parseFloat(ve),(isNaN(ve)||ve<0||ve>1)&&(ve=1),ve}function Pe(ve,_e){it(ve)&&(ve="100%");var pe=tt(ve);return ve=k(_e,P(0,parseFloat(ve))),pe&&(ve=parseInt(ve*_e,10)/100),S.abs(ve-_e)<1e-6?1:ve%_e/parseFloat(_e)}function De(ve){return k(1,P(0,ve))}function ze(ve){return parseInt(ve,16)}function it(ve){return typeof ve=="string"&&ve.indexOf(".")!=-1&&parseFloat(ve)===1}function tt(ve){return typeof ve=="string"&&ve.indexOf("%")!=-1}function ot(ve){return ve.length==1?"0"+ve:""+ve}function lt(ve){return ve<=1&&(ve=ve*100+"%"),ve}function St(ve){return S.round(parseFloat(ve)*255).toString(16)}function et(ve){return ze(ve)/255}var Je=function(){var ve="[-\\+]?\\d+%?",_e="[-\\+]?\\d*\\.\\d+%?",pe="(?:"+_e+")|(?:"+ve+")",fe="[\\s|\\(]+("+pe+")[,|\\s]+("+pe+")[,|\\s]+("+pe+")\\s*\\)?",ue="[\\s|\\(]+("+pe+")[,|\\s]+("+pe+")[,|\\s]+("+pe+")[,|\\s]+("+pe+")\\s*\\)?";return{CSS_UNIT:new RegExp(pe),rgb:new RegExp("rgb"+fe),rgba:new RegExp("rgba"+ue),hsl:new RegExp("hsl"+fe),hsla:new RegExp("hsla"+ue),hsv:new RegExp("hsv"+fe),hsva:new RegExp("hsva"+ue),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Be(ve){return!!Je.CSS_UNIT.exec(ve)}function Ge(ve){ve=ve.replace(h,"").replace(I,"").toLowerCase();var _e=!1;if(Ze[ve])ve=Ze[ve],_e=!0;else if(ve=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var pe;return(pe=Je.rgb.exec(ve))?{r:pe[1],g:pe[2],b:pe[3]}:(pe=Je.rgba.exec(ve))?{r:pe[1],g:pe[2],b:pe[3],a:pe[4]}:(pe=Je.hsl.exec(ve))?{h:pe[1],s:pe[2],l:pe[3]}:(pe=Je.hsla.exec(ve))?{h:pe[1],s:pe[2],l:pe[3],a:pe[4]}:(pe=Je.hsv.exec(ve))?{h:pe[1],s:pe[2],v:pe[3]}:(pe=Je.hsva.exec(ve))?{h:pe[1],s:pe[2],v:pe[3],a:pe[4]}:(pe=Je.hex8.exec(ve))?{r:ze(pe[1]),g:ze(pe[2]),b:ze(pe[3]),a:et(pe[4]),format:_e?"name":"hex8"}:(pe=Je.hex6.exec(ve))?{r:ze(pe[1]),g:ze(pe[2]),b:ze(pe[3]),format:_e?"name":"hex"}:(pe=Je.hex4.exec(ve))?{r:ze(pe[1]+""+pe[1]),g:ze(pe[2]+""+pe[2]),b:ze(pe[3]+""+pe[3]),a:et(pe[4]+""+pe[4]),format:_e?"name":"hex8"}:(pe=Je.hex3.exec(ve))?{r:ze(pe[1]+""+pe[1]),g:ze(pe[2]+""+pe[2]),b:ze(pe[3]+""+pe[3]),format:_e?"name":"hex"}:!1}function He(ve){var _e,pe;return ve=ve||{level:"AA",size:"small"},_e=(ve.level||"AA").toUpperCase(),pe=(ve.size||"small").toLowerCase(),_e!=="AA"&&_e!=="AAA"&&(_e="AA"),pe!=="small"&&pe!=="large"&&(pe="small"),{level:_e,size:pe}}typeof x!="undefined"&&x.exports?x.exports=M:g.tinycolor=M})(Math)},{}],179:[function(m,x,E){E=x.exports=S;function S(h){return h.replace(/^\s*|\s*$/g,"")}E.left=function(h){return h.replace(/^\s*/,"")},E.right=function(h){return h.replace(/\s*$/,"")}},{}],180:[function(m,x,E){var S=m("punycode"),h=m("./util");E.parse=X,E.resolve=q,E.resolveObject=te,E.format=J,E.Url=I;function I(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var T=/^([a-z0-9.+-]+:)/i,A=/:[0-9]*$/,k=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,P=["<",">",'"',"`"," ","\r",`
`,"	"],D=["{","}","|","\\","^","`"].concat(P),M=["'"].concat(D),F=["%","/","?",";","#"].concat(M),N=["/","?","#"],B=255,U=/^[+a-z0-9A-Z_-]{0,63}$/,O=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,V={javascript:!0,"javascript:":!0},Z={javascript:!0,"javascript:":!0},W={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Y=m("querystring");function X(ne,de,oe){if(ne&&h.isObject(ne)&&ne instanceof I)return ne;var we=new I;return we.parse(ne,de,oe),we}I.prototype.parse=function(ne,de,oe){if(!h.isString(ne))throw new TypeError("Parameter 'url' must be a string, not "+typeof ne);var we=ne.indexOf("?"),Ae=we!==-1&&we<ne.indexOf("#")?"?":"#",ye=ne.split(Ae),me=/\\/g;ye[0]=ye[0].replace(me,"/"),ne=ye.join(Ae);var xe=ne;if(xe=xe.trim(),!oe&&ne.split("#").length===1){var Le=k.exec(xe);if(Le)return this.path=xe,this.href=xe,this.pathname=Le[1],Le[2]?(this.search=Le[2],de?this.query=Y.parse(this.search.substr(1)):this.query=this.search.substr(1)):de&&(this.search="",this.query={}),this}var Ze=T.exec(xe);if(Ze){Ze=Ze[0];var Xe=Ze.toLowerCase();this.protocol=Xe,xe=xe.substr(Ze.length)}if(oe||Ze||xe.match(/^\/\/[^@\/]+@[^@\/]+/)){var je=xe.substr(0,2)==="//";je&&!(Ze&&Z[Ze])&&(xe=xe.substr(2),this.slashes=!0)}if(!Z[Ze]&&(je||Ze&&!W[Ze])){for(var Ie=-1,Pe=0;Pe<N.length;Pe++){var De=xe.indexOf(N[Pe]);De!==-1&&(Ie===-1||De<Ie)&&(Ie=De)}var ze,it;Ie===-1?it=xe.lastIndexOf("@"):it=xe.lastIndexOf("@",Ie),it!==-1&&(ze=xe.slice(0,it),xe=xe.slice(it+1),this.auth=decodeURIComponent(ze)),Ie=-1;for(var Pe=0;Pe<F.length;Pe++){var De=xe.indexOf(F[Pe]);De!==-1&&(Ie===-1||De<Ie)&&(Ie=De)}Ie===-1&&(Ie=xe.length),this.host=xe.slice(0,Ie),xe=xe.slice(Ie),this.parseHost(),this.hostname=this.hostname||"";var tt=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!tt)for(var ot=this.hostname.split(/\./),Pe=0,lt=ot.length;Pe<lt;Pe++){var St=ot[Pe];if(!!St&&!St.match(U)){for(var et="",Je=0,Be=St.length;Je<Be;Je++)St.charCodeAt(Je)>127?et+="x":et+=St[Je];if(!et.match(U)){var Ge=ot.slice(0,Pe),He=ot.slice(Pe+1),ve=St.match(O);ve&&(Ge.push(ve[1]),He.unshift(ve[2])),He.length&&(xe="/"+He.join(".")+xe),this.hostname=Ge.join(".");break}}}this.hostname.length>B?this.hostname="":this.hostname=this.hostname.toLowerCase(),tt||(this.hostname=S.toASCII(this.hostname));var _e=this.port?":"+this.port:"",pe=this.hostname||"";this.host=pe+_e,this.href+=this.host,tt&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),xe[0]!=="/"&&(xe="/"+xe))}if(!V[Xe])for(var Pe=0,lt=M.length;Pe<lt;Pe++){var fe=M[Pe];if(xe.indexOf(fe)!==-1){var ue=encodeURIComponent(fe);ue===fe&&(ue=escape(fe)),xe=xe.split(fe).join(ue)}}var ce=xe.indexOf("#");ce!==-1&&(this.hash=xe.substr(ce),xe=xe.slice(0,ce));var Ee=xe.indexOf("?");if(Ee!==-1?(this.search=xe.substr(Ee),this.query=xe.substr(Ee+1),de&&(this.query=Y.parse(this.query)),xe=xe.slice(0,Ee)):de&&(this.search="",this.query={}),xe&&(this.pathname=xe),W[Xe]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var _e=this.pathname||"",Ye=this.search||"";this.path=_e+Ye}return this.href=this.format(),this};function J(ne){return h.isString(ne)&&(ne=X(ne)),ne instanceof I?ne.format():I.prototype.format.call(ne)}I.prototype.format=function(){var ne=this.auth||"";ne&&(ne=encodeURIComponent(ne),ne=ne.replace(/%3A/i,":"),ne+="@");var de=this.protocol||"",oe=this.pathname||"",we=this.hash||"",Ae=!1,ye="";this.host?Ae=ne+this.host:this.hostname&&(Ae=ne+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(Ae+=":"+this.port)),this.query&&h.isObject(this.query)&&Object.keys(this.query).length&&(ye=Y.stringify(this.query));var me=this.search||ye&&"?"+ye||"";return de&&de.substr(-1)!==":"&&(de+=":"),this.slashes||(!de||W[de])&&Ae!==!1?(Ae="//"+(Ae||""),oe&&oe.charAt(0)!=="/"&&(oe="/"+oe)):Ae||(Ae=""),we&&we.charAt(0)!=="#"&&(we="#"+we),me&&me.charAt(0)!=="?"&&(me="?"+me),oe=oe.replace(/[?#]/g,function(xe){return encodeURIComponent(xe)}),me=me.replace("#","%23"),de+Ae+oe+me+we};function q(ne,de){return X(ne,!1,!0).resolve(de)}I.prototype.resolve=function(ne){return this.resolveObject(X(ne,!1,!0)).format()};function te(ne,de){return ne?X(ne,!1,!0).resolveObject(de):de}I.prototype.resolveObject=function(ne){if(h.isString(ne)){var de=new I;de.parse(ne,!1,!0),ne=de}for(var oe=new I,we=Object.keys(this),Ae=0;Ae<we.length;Ae++){var ye=we[Ae];oe[ye]=this[ye]}if(oe.hash=ne.hash,ne.href==="")return oe.href=oe.format(),oe;if(ne.slashes&&!ne.protocol){for(var me=Object.keys(ne),xe=0;xe<me.length;xe++){var Le=me[xe];Le!=="protocol"&&(oe[Le]=ne[Le])}return W[oe.protocol]&&oe.hostname&&!oe.pathname&&(oe.path=oe.pathname="/"),oe.href=oe.format(),oe}if(ne.protocol&&ne.protocol!==oe.protocol){if(!W[ne.protocol]){for(var Ze=Object.keys(ne),Xe=0;Xe<Ze.length;Xe++){var je=Ze[Xe];oe[je]=ne[je]}return oe.href=oe.format(),oe}if(oe.protocol=ne.protocol,!ne.host&&!Z[ne.protocol]){for(var lt=(ne.pathname||"").split("/");lt.length&&!(ne.host=lt.shift()););ne.host||(ne.host=""),ne.hostname||(ne.hostname=""),lt[0]!==""&&lt.unshift(""),lt.length<2&&lt.unshift(""),oe.pathname=lt.join("/")}else oe.pathname=ne.pathname;if(oe.search=ne.search,oe.query=ne.query,oe.host=ne.host||"",oe.auth=ne.auth,oe.hostname=ne.hostname||ne.host,oe.port=ne.port,oe.pathname||oe.search){var Ie=oe.pathname||"",Pe=oe.search||"";oe.path=Ie+Pe}return oe.slashes=oe.slashes||ne.slashes,oe.href=oe.format(),oe}var De=oe.pathname&&oe.pathname.charAt(0)==="/",ze=ne.host||ne.pathname&&ne.pathname.charAt(0)==="/",it=ze||De||oe.host&&ne.pathname,tt=it,ot=oe.pathname&&oe.pathname.split("/")||[],lt=ne.pathname&&ne.pathname.split("/")||[],St=oe.protocol&&!W[oe.protocol];if(St&&(oe.hostname="",oe.port=null,oe.host&&(ot[0]===""?ot[0]=oe.host:ot.unshift(oe.host)),oe.host="",ne.protocol&&(ne.hostname=null,ne.port=null,ne.host&&(lt[0]===""?lt[0]=ne.host:lt.unshift(ne.host)),ne.host=null),it=it&&(lt[0]===""||ot[0]==="")),ze)oe.host=ne.host||ne.host===""?ne.host:oe.host,oe.hostname=ne.hostname||ne.hostname===""?ne.hostname:oe.hostname,oe.search=ne.search,oe.query=ne.query,ot=lt;else if(lt.length)ot||(ot=[]),ot.pop(),ot=ot.concat(lt),oe.search=ne.search,oe.query=ne.query;else if(!h.isNullOrUndefined(ne.search)){if(St){oe.hostname=oe.host=ot.shift();var et=oe.host&&oe.host.indexOf("@")>0?oe.host.split("@"):!1;et&&(oe.auth=et.shift(),oe.host=oe.hostname=et.shift())}return oe.search=ne.search,oe.query=ne.query,(!h.isNull(oe.pathname)||!h.isNull(oe.search))&&(oe.path=(oe.pathname?oe.pathname:"")+(oe.search?oe.search:"")),oe.href=oe.format(),oe}if(!ot.length)return oe.pathname=null,oe.search?oe.path="/"+oe.search:oe.path=null,oe.href=oe.format(),oe;for(var Je=ot.slice(-1)[0],Be=(oe.host||ne.host||ot.length>1)&&(Je==="."||Je==="..")||Je==="",Ge=0,He=ot.length;He>=0;He--)Je=ot[He],Je==="."?ot.splice(He,1):Je===".."?(ot.splice(He,1),Ge++):Ge&&(ot.splice(He,1),Ge--);if(!it&&!tt)for(;Ge--;Ge)ot.unshift("..");it&&ot[0]!==""&&(!ot[0]||ot[0].charAt(0)!=="/")&&ot.unshift(""),Be&&ot.join("/").substr(-1)!=="/"&&ot.push("");var ve=ot[0]===""||ot[0]&&ot[0].charAt(0)==="/";if(St){oe.hostname=oe.host=ve?"":ot.length?ot.shift():"";var et=oe.host&&oe.host.indexOf("@")>0?oe.host.split("@"):!1;et&&(oe.auth=et.shift(),oe.host=oe.hostname=et.shift())}return it=it||oe.host&&ot.length,it&&!ve&&ot.unshift(""),ot.length?oe.pathname=ot.join("/"):(oe.pathname=null,oe.path=null),(!h.isNull(oe.pathname)||!h.isNull(oe.search))&&(oe.path=(oe.pathname?oe.pathname:"")+(oe.search?oe.search:"")),oe.auth=ne.auth||oe.auth,oe.slashes=oe.slashes||ne.slashes,oe.href=oe.format(),oe},I.prototype.parseHost=function(){var ne=this.host,de=A.exec(ne);de&&(de=de[0],de!==":"&&(this.port=de.substr(1)),ne=ne.substr(0,ne.length-de.length)),ne&&(this.hostname=ne)}},{"./util":181,punycode:134,querystring:137}],181:[function(m,x,E){x.exports={isString:function(S){return typeof S=="string"},isObject:function(S){return typeof S=="object"&&S!==null},isNull:function(S){return S===null},isNullOrUndefined:function(S){return S==null}}},{}],182:[function(m,x,E){(function(S){(function(){var h={};typeof x=="object"?x.exports=h:self.UTIF=h;var I;typeof m=="function"?I=m("pako"):I=self.pako;function T(){typeof S=="undefined"&&console.log.apply(console,arguments)}(function(A,k){(function(){var P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},D=function(){function F(N){this.message="JPEG error: "+N}return F.prototype=Error(),F.prototype.name="JpegError",F.constructor=F}(),M=function(){function F(N,B){this.message=N,this.g=B}return F.prototype=Error(),F.prototype.name="DNLMarkerError",F.constructor=F}();(function(){function F(){this.M=null,this.B=-1}function N(Z,W){for(var Y=0,X=[],J,q,te=16;0<te&&!Z[te-1];)te--;X.push({children:[],index:0});var ne=X[0],de;for(J=0;J<te;J++){for(q=0;q<Z[J];q++){for(ne=X.pop(),ne.children[ne.index]=W[Y];0<ne.index;)ne=X.pop();for(ne.index++,X.push(ne);X.length<=J;)X.push(de={children:[],index:0}),ne.children[ne.index]=de.children,ne=de;Y++}J+1<te&&(X.push(de={children:[],index:0}),ne.children[ne.index]=de.children,ne=de)}return X[0].children}function B(Z,W,Y,X,J,q,te,ne,de){function oe(){if(0<ze)return ze--,De>>ze&1;if(De=Z[W++],De===255){var ce=Z[W++];if(ce){if(ce===220&&je){W+=2;var Ee=Z[W++]<<8|Z[W++];if(0<Ee&&Ee!==Y.g)throw new M("Found DNL marker (0xFFDC) while parsing scan data",Ee)}throw new D("unexpected marker "+(De<<8|ce).toString(16))}}return ze=7,De>>>7}function we(ce){for(;;){if(ce=ce[oe()],typeof ce=="number")return ce;if((typeof ce=="undefined"?"undefined":P(ce))!=="object")throw new D("invalid huffman sequence")}}function Ae(ce){for(var Ee=0;0<ce;)Ee=Ee<<1|oe(),ce--;return Ee}function ye(ce){if(ce===1)return oe()===1?1:-1;var Ee=Ae(ce);return Ee>=1<<ce-1?Ee:Ee+(-1<<ce)+1}function me(ce,Ee){var Ye=we(ce.D);for(Ye=Ye===0?0:ye(Ye),ce.a[Ee]=ce.m+=Ye,Ye=1;64>Ye;){var ft=we(ce.o),_t=ft&15;if(ft>>=4,_t===0){if(15>ft)break;Ye+=16}else Ye+=ft,ce.a[Ee+V[Ye]]=ye(_t),Ye++}}function xe(ce,Ee){var Ye=we(ce.D);Ye=Ye===0?0:ye(Ye)<<de,ce.a[Ee]=ce.m+=Ye}function Le(ce,Ee){ce.a[Ee]|=oe()<<de}function Ze(ce,Ee){if(0<it)it--;else for(var Ye=q;Ye<=te;){var ft=we(ce.o),_t=ft&15;if(ft>>=4,_t===0){if(15>ft){it=Ae(ft)+(1<<ft)-1;break}Ye+=16}else Ye+=ft,ce.a[Ee+V[Ye]]=ye(_t)*(1<<de),Ye++}}function Xe(ce,Ee){for(var Ye=q,ft=0,_t;Ye<=te;){_t=Ee+V[Ye];var It=0>ce.a[_t]?-1:1;switch(tt){case 0:if(ft=we(ce.o),_t=ft&15,ft>>=4,_t===0)15>ft?(it=Ae(ft)+(1<<ft),tt=4):(ft=16,tt=1);else{if(_t!==1)throw new D("invalid ACn encoding");ot=ye(_t),tt=ft?2:3}continue;case 1:case 2:ce.a[_t]?ce.a[_t]+=It*(oe()<<de):(ft--,ft===0&&(tt=tt===2?3:0));break;case 3:ce.a[_t]?ce.a[_t]+=It*(oe()<<de):(ce.a[_t]=ot<<de,tt=0);break;case 4:ce.a[_t]&&(ce.a[_t]+=It*(oe()<<de))}Ye++}tt===4&&(it--,it===0&&(tt=0))}for(var je=9<arguments.length&&arguments[9]!==void 0?arguments[9]:!1,Ie=Y.P,Pe=W,De=0,ze=0,it=0,tt=0,ot,lt=X.length,St,et,Je,Be,Ge=Y.S?q===0?ne===0?xe:Le:ne===0?Ze:Xe:me,He=0,ve=lt===1?X[0].c*X[0].l:Ie*Y.O,_e,pe;He<ve;){var fe=J?Math.min(ve-He,J):ve;for(St=0;St<lt;St++)X[St].m=0;if(it=0,lt===1){var ue=X[0];for(Be=0;Be<fe;Be++)Ge(ue,64*((ue.c+1)*(He/ue.c|0)+He%ue.c)),He++}else for(Be=0;Be<fe;Be++){for(St=0;St<lt;St++)for(ue=X[St],_e=ue.h,pe=ue.j,et=0;et<pe;et++)for(Je=0;Je<_e;Je++)Ge(ue,64*((ue.c+1)*((He/Ie|0)*ue.j+et)+(He%Ie*ue.h+Je)));He++}if(ze=0,(ue=O(Z,W))&&ue.f&&((0,_util.warn)("decodeScan - unexpected MCU data, current marker is: "+ue.f),W=ue.offset),ue=ue&&ue.F,!ue||65280>=ue)throw new D("marker was not found");if(65488<=ue&&65495>=ue)W+=2;else break}return(ue=O(Z,W))&&ue.f&&((0,_util.warn)("decodeScan - unexpected Scan data, current marker is: "+ue.f),W=ue.offset),W-Pe}function U(Z,W){for(var Y=W.c,X=W.l,J=new Int16Array(64),q=0;q<X;q++)for(var te=0;te<Y;te++){var ne=64*((W.c+1)*q+te),de=J,oe=W.G,we=W.a;if(!oe)throw new D("missing required Quantization Table.");for(var Ae=0;64>Ae;Ae+=8){var ye=we[ne+Ae],me=we[ne+Ae+1],xe=we[ne+Ae+2],Le=we[ne+Ae+3],Ze=we[ne+Ae+4],Xe=we[ne+Ae+5],je=we[ne+Ae+6],Ie=we[ne+Ae+7];if(ye*=oe[Ae],(me|xe|Le|Ze|Xe|je|Ie)==0)ye=5793*ye+512>>10,de[Ae]=ye,de[Ae+1]=ye,de[Ae+2]=ye,de[Ae+3]=ye,de[Ae+4]=ye,de[Ae+5]=ye,de[Ae+6]=ye,de[Ae+7]=ye;else{me*=oe[Ae+1],xe*=oe[Ae+2],Le*=oe[Ae+3],Ze*=oe[Ae+4],Xe*=oe[Ae+5],je*=oe[Ae+6],Ie*=oe[Ae+7];var Pe=5793*ye+128>>8,De=5793*Ze+128>>8,ze=xe,it=je;Ze=2896*(me-Ie)+128>>8,Ie=2896*(me+Ie)+128>>8,Le<<=4,Xe<<=4,Pe=Pe+De+1>>1,De=Pe-De,ye=3784*ze+1567*it+128>>8,ze=1567*ze-3784*it+128>>8,it=ye,Ze=Ze+Xe+1>>1,Xe=Ze-Xe,Ie=Ie+Le+1>>1,Le=Ie-Le,Pe=Pe+it+1>>1,it=Pe-it,De=De+ze+1>>1,ze=De-ze,ye=2276*Ze+3406*Ie+2048>>12,Ze=3406*Ze-2276*Ie+2048>>12,Ie=ye,ye=799*Le+4017*Xe+2048>>12,Le=4017*Le-799*Xe+2048>>12,Xe=ye,de[Ae]=Pe+Ie,de[Ae+7]=Pe-Ie,de[Ae+1]=De+Xe,de[Ae+6]=De-Xe,de[Ae+2]=ze+Le,de[Ae+5]=ze-Le,de[Ae+3]=it+Ze,de[Ae+4]=it-Ze}}for(oe=0;8>oe;++oe)ye=de[oe],me=de[oe+8],xe=de[oe+16],Le=de[oe+24],Ze=de[oe+32],Xe=de[oe+40],je=de[oe+48],Ie=de[oe+56],(me|xe|Le|Ze|Xe|je|Ie)==0?(ye=5793*ye+8192>>14,ye=-2040>ye?0:2024<=ye?255:ye+2056>>4,we[ne+oe]=ye,we[ne+oe+8]=ye,we[ne+oe+16]=ye,we[ne+oe+24]=ye,we[ne+oe+32]=ye,we[ne+oe+40]=ye,we[ne+oe+48]=ye,we[ne+oe+56]=ye):(Pe=5793*ye+2048>>12,De=5793*Ze+2048>>12,ze=xe,it=je,Ze=2896*(me-Ie)+2048>>12,Ie=2896*(me+Ie)+2048>>12,Pe=(Pe+De+1>>1)+4112,De=Pe-De,ye=3784*ze+1567*it+2048>>12,ze=1567*ze-3784*it+2048>>12,it=ye,Ze=Ze+Xe+1>>1,Xe=Ze-Xe,Ie=Ie+Le+1>>1,Le=Ie-Le,Pe=Pe+it+1>>1,it=Pe-it,De=De+ze+1>>1,ze=De-ze,ye=2276*Ze+3406*Ie+2048>>12,Ze=3406*Ze-2276*Ie+2048>>12,Ie=ye,ye=799*Le+4017*Xe+2048>>12,Le=4017*Le-799*Xe+2048>>12,Xe=ye,ye=Pe+Ie,Ie=Pe-Ie,me=De+Xe,je=De-Xe,xe=ze+Le,Xe=ze-Le,Le=it+Ze,Ze=it-Ze,ye=16>ye?0:4080<=ye?255:ye>>4,me=16>me?0:4080<=me?255:me>>4,xe=16>xe?0:4080<=xe?255:xe>>4,Le=16>Le?0:4080<=Le?255:Le>>4,Ze=16>Ze?0:4080<=Ze?255:Ze>>4,Xe=16>Xe?0:4080<=Xe?255:Xe>>4,je=16>je?0:4080<=je?255:je>>4,Ie=16>Ie?0:4080<=Ie?255:Ie>>4,we[ne+oe]=ye,we[ne+oe+8]=me,we[ne+oe+16]=xe,we[ne+oe+24]=Le,we[ne+oe+32]=Ze,we[ne+oe+40]=Xe,we[ne+oe+48]=je,we[ne+oe+56]=Ie)}return W.a}function O(Z,W){var Y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:W,X=Z.length-1;if(Y=Y<W?Y:W,W>=X)return null;var J=Z[W]<<8|Z[W+1];if(65472<=J&&65534>=J)return{f:null,F:J,offset:W};for(var q=Z[Y]<<8|Z[Y+1];!(65472<=q&&65534>=q);){if(++Y>=X)return null;q=Z[Y]<<8|Z[Y+1]}return{f:J.toString(16),F:q,offset:Y}}var V=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);F.prototype={parse:function(Z){function W(){var ze=Z[te]<<8|Z[te+1];return te+=2,ze}function Y(){var ze=W();ze=te+ze-2;var it=O(Z,ze,te);return it&&it.f&&((0,_util.warn)("readDataBlock - incorrect length, current marker is: "+it.f),ze=it.offset),ze=Z.subarray(te,ze),te+=ze.length,ze}function X(ze){for(var it=Math.ceil(ze.v/8/ze.s),tt=Math.ceil(ze.g/8/ze.u),ot=0;ot<ze.b.length;ot++){Pe=ze.b[ot];var lt=Math.ceil(Math.ceil(ze.v/8)*Pe.h/ze.s),St=Math.ceil(Math.ceil(ze.g/8)*Pe.j/ze.u);Pe.a=new Int16Array(64*tt*Pe.j*(it*Pe.h+1)),Pe.c=lt,Pe.l=St}ze.P=it,ze.O=tt}var J=(1<arguments.length&&arguments[1]!==void 0?arguments[1]:{}).N,q=J===void 0?null:J,te=0,ne=null,de=0;J=[];var oe=[],we=[],Ae=W();if(Ae!==65496)throw new D("SOI not found");for(Ae=W();Ae!==65497;){switch(Ae){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var ye=Y();Ae===65518&&ye[0]===65&&ye[1]===100&&ye[2]===111&&ye[3]===98&&ye[4]===101&&(ne={version:ye[5]<<8|ye[6],Y:ye[7]<<8|ye[8],Z:ye[9]<<8|ye[10],W:ye[11]});break;case 65499:Ae=W()+te-2;for(var me;te<Ae;){var xe=Z[te++],Le=new Uint16Array(64);if(xe>>4==0)for(ye=0;64>ye;ye++)me=V[ye],Le[me]=Z[te++];else if(xe>>4==1)for(ye=0;64>ye;ye++)me=V[ye],Le[me]=W();else throw new D("DQT - invalid table spec");J[xe&15]=Le}break;case 65472:case 65473:case 65474:if(Ze)throw new D("Only single frame JPEGs supported");W();var Ze={};for(Ze.X=Ae===65473,Ze.S=Ae===65474,Ze.precision=Z[te++],Ae=W(),Ze.g=q||Ae,Ze.v=W(),Ze.b=[],Ze.C={},ye=Z[te++],Ae=Le=xe=0;Ae<ye;Ae++){me=Z[te];var Xe=Z[te+1]>>4,je=Z[te+1]&15;xe<Xe&&(xe=Xe),Le<je&&(Le=je),Xe=Ze.b.push({h:Xe,j:je,T:Z[te+2],G:null}),Ze.C[me]=Xe-1,te+=3}Ze.s=xe,Ze.u=Le,X(Ze);break;case 65476:for(me=W(),Ae=2;Ae<me;){for(xe=Z[te++],Le=new Uint8Array(16),ye=Xe=0;16>ye;ye++,te++)Xe+=Le[ye]=Z[te];for(je=new Uint8Array(Xe),ye=0;ye<Xe;ye++,te++)je[ye]=Z[te];Ae+=17+Xe,(xe>>4==0?we:oe)[xe&15]=N(Le,je)}break;case 65501:W();var Ie=W();break;case 65498:for(ye=++de==1&&!q,W(),xe=Z[te++],me=[],Ae=0;Ae<xe;Ae++){Le=Ze.C[Z[te++]];var Pe=Ze.b[Le];Le=Z[te++],Pe.D=we[Le>>4],Pe.o=oe[Le&15],me.push(Pe)}Ae=Z[te++],xe=Z[te++],Le=Z[te++];try{var De=B(Z,te,Ze,me,Ie,Ae,xe,Le>>4,Le&15,ye);te+=De}catch(ze){if(ze instanceof M)return(0,_util.warn)('Attempting to re-parse JPEG image using "scanLines" parameter found in DNL marker (0xFFDC) segment.'),this.parse(Z,{N:ze.g});throw ze}break;case 65500:te+=4;break;case 65535:Z[te]!==255&&te--;break;default:if(Z[te-3]===255&&192<=Z[te-2]&&254>=Z[te-2])te-=3;else if((ye=O(Z,te-2))&&ye.f)(0,_util.warn)("JpegImage.parse - unexpected data, current marker is: "+ye.f),te=ye.offset;else throw new D("unknown marker "+Ae.toString(16))}Ae=W()}for(this.width=Ze.v,this.height=Ze.g,this.A=ne,this.b=[],Ae=0;Ae<Ze.b.length;Ae++)Pe=Ze.b[Ae],(Ie=J[Pe.T])&&(Pe.G=Ie),this.b.push({R:U(Ze,Pe),U:Pe.h/Ze.s,V:Pe.j/Ze.u,c:Pe.c,l:Pe.l});this.i=this.b.length},L:function(Z,W){var Y=this.width/Z,X=this.height/W,J,q,te=this.b.length,ne=Z*W*te,de=new Uint8ClampedArray(ne),oe=new Uint32Array(Z);for(q=0;q<te;q++){var we=this.b[q],Ae=we.U*Y,ye=we.V*X,me=q,xe=we.R,Le=we.c+1<<3;for(J=0;J<Z;J++)we=0|J*Ae,oe[J]=(we&4294967288)<<3|we&7;for(Ae=0;Ae<W;Ae++)for(we=0|Ae*ye,we=Le*(we&4294967288)|(we&7)<<3,J=0;J<Z;J++)de[me]=xe[we+oe[J]],me+=te}if(X=this.M)for(q=0;q<ne;)for(Y=we=0;we<te;we++,q++,Y+=2)de[q]=(de[q]*X[Y]>>8)+X[Y+1];return de},w:function(){return this.A?!!this.A.W:this.i===3?this.B!==0:this.B===1},I:function(Z){for(var W,Y,X,J=0,q=Z.length;J<q;J+=3)W=Z[J],Y=Z[J+1],X=Z[J+2],Z[J]=W-179.456+1.402*X,Z[J+1]=W+135.459-.344*Y-.714*X,Z[J+2]=W-226.816+1.772*Y;return Z},K:function(Z){for(var W,Y,X,J,q=0,te=0,ne=Z.length;te<ne;te+=4)W=Z[te],Y=Z[te+1],X=Z[te+2],J=Z[te+3],Z[q++]=-122.67195406894+Y*(-660635669420364e-19*Y+.000437130475926232*X-54080610064599e-18*W+.00048449797120281*J-.154362151871126)+X*(-.000957964378445773*X+.000817076911346625*W-.00477271405408747*J+1.53380253221734)+W*(.000961250184130688*W-.00266257332283933*J+.48357088451265)+J*(-.000336197177618394*J+.484791561490776),Z[q++]=107.268039397724+Y*(219927104525741e-19*Y-.000640992018297945*X+.000659397001245577*W+.000426105652938837*J-.176491792462875)+X*(-.000778269941513683*X+.00130872261408275*W+.000770482631801132*J-.151051492775562)+W*(.00126935368114843*W-.00265090189010898*J+.25802910206845)+J*(-.000318913117588328*J-.213742400323665),Z[q++]=-20.810012546947+Y*(-.000570115196973677*Y-263409051004589e-19*X+.0020741088115012*W-.00288260236853442*J+.814272968359295)+X*(-153496057440975e-19*X-.000132689043961446*W+.000560833691242812*J-.195152027534049)+W*(.00174418132927582*W-.00255243321439347*J+.116935020465145)+J*(-.000343531996510555*J+.24165260232407);return Z.subarray(0,q)},J:function(Z){for(var W,Y,X,J=0,q=Z.length;J<q;J+=4)W=Z[J],Y=Z[J+1],X=Z[J+2],Z[J]=434.456-W-1.402*X,Z[J+1]=119.541-W+.344*Y+.714*X,Z[J+2]=481.816-W-1.772*Y;return Z},H:function(Z){for(var W,Y,X,J,q=0,te=1/255,ne=0,de=Z.length;ne<de;ne+=4)W=Z[ne]*te,Y=Z[ne+1]*te,X=Z[ne+2]*te,J=Z[ne+3]*te,Z[q++]=255+W*(-4.387332384609988*W+54.48615194189176*Y+18.82290502165302*X+212.25662451639585*J-285.2331026137004)+Y*(1.7149763477362134*Y-5.6096736904047315*X-17.873870861415444*J-5.497006427196366)+X*(-2.5217340131683033*X-21.248923337353073*J+17.5119270841813)-J*(21.86122147463605*J+189.48180835922747),Z[q++]=255+W*(8.841041422036149*W+60.118027045597366*Y+6.871425592049007*X+31.159100130055922*J-79.2970844816548)+Y*(-15.310361306967817*Y+17.575251261109482*X+131.35250912493976*J-190.9453302588951)+X*(4.444339102852739*X+9.8632861493405*J-24.86741582555878)-J*(20.737325471181034*J+187.80453709719578),Z[q++]=255+W*(.8842522430003296*W+8.078677503112928*Y+30.89978309703729*X-.23883238689178934*J-14.183576799673286)+Y*(10.49593273432072*Y+63.02378494754052*X+50.606957656360734*J-112.23884253719248)+X*(.03296041114873217*X+115.60384449646641*J-193.58209356861505)-J*(22.33816807309886*J+180.12613974708367);return Z.subarray(0,q)},getData:function(Z,W,Y){if(4<this.i)throw new D("Unsupported color mode");if(Z=this.L(Z,W),this.i===1&&Y){Y=Z.length,W=new Uint8ClampedArray(3*Y);for(var X=0,J=0;J<Y;J++){var q=Z[J];W[X++]=q,W[X++]=q,W[X++]=q}return W}if(this.i===3&&this.w())return this.I(Z);if(this.i===4){if(this.w())return Y?this.K(Z):this.J(Z);if(Y)return this.H(Z)}return Z}},A.JpegDecoder=F})()})(),A.encodeImage=function(P,D,M,F){var N={t256:[D],t257:[M],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[M],t279:[D*M*4],t282:[1],t283:[1],t284:[1],t286:[0],t287:[0],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(F)for(var B in F)N[B]=F[B];for(var U=new Uint8Array(A.encode([N])),O=new Uint8Array(P),V=new Uint8Array(1e3+D*M*4),B=0;B<U.length;B++)V[B]=U[B];for(var B=0;B<O.length;B++)V[1e3+B]=O[B];return V.buffer},A.encode=function(P){var D=new Uint8Array(2e4),M=4,F=A._binBE;D[0]=77,D[1]=77,D[3]=42;var N=8;F.writeUint(D,M,N),M+=4;for(var B=0;B<P.length;B++){var U=A._writeIFD(F,D,N,P[B]);N=U[1],B<P.length-1&&F.writeUint(D,U[0],N)}return D.slice(0,N).buffer},A.decode=function(P){A.decode._decodeG3.allow2D=null;var D=new Uint8Array(P),M=0,F=A._binBE.readASCII(D,M,2);M+=2;var N=F=="II"?A._binLE:A._binBE;N.readUshort(D,M),M+=2;var B=N.readUint(D,M);M+=4;for(var U=[];;){var O=A._readIFD(N,D,B,U);if(B=N.readUint(D,O),B==0)break}return U},A.decodeImages=function(P,D){for(var M=new Uint8Array(P),F=A._binBE.readASCII(M,0,2),N=0;N<D.length;N++){var B=D[N];if(B.t256!=null){B.isLE=F=="II",B.width=B.t256[0],B.height=B.t257[0];var U=B.t259?B.t259[0]:1,O=B.t266?B.t266[0]:1;B.t284&&B.t284[0]==2&&T("PlanarConfiguration 2 should not be used!");var V=(B.t258?Math.min(32,B.t258[0]):1)*(B.t277?B.t277[0]:1),Z=Math.ceil(B.width*V/8)*8,W=B.t273;W==null&&(W=B.t324);var Y=B.t279;U==1&&W.length==1&&(Y=[B.height*(Z>>>3)]),Y==null&&(Y=B.t325);var X=new Uint8Array(B.height*(Z>>>3)),J=0;if(B.t322!=null){for(var q=B.t322[0],te=B.t323[0],ne=Math.floor((B.width+q-1)/q),de=Math.floor((B.height+te-1)/te),oe=new Uint8Array(Math.ceil(q*te*V/8)|0),we=0;we<de;we++)for(var Ae=0;Ae<ne;Ae++){for(var ye=we*ne+Ae,me=0;me<oe.length;me++)oe[me]=0;A.decode._decompress(B,M,W[ye],Y[ye],U,oe,0,O),U==6?X=oe:A._copyTile(oe,Math.ceil(q*V/8)|0,te,X,Math.ceil(B.width*V/8)|0,B.height,Math.ceil(Ae*q*V/8)|0,we*te)}J=X.length*8}else{var xe=B.t278?B.t278[0]:B.height;xe=Math.min(xe,B.height);for(var ye=0;ye<W.length;ye++)A.decode._decompress(B,M,W[ye],Y[ye],U,X,Math.ceil(J/8)|0,O),J+=Z*xe;J=Math.min(J,X.length*8)}B.data=new Uint8Array(X.buffer,0,Math.ceil(J/8)|0)}}},A.decode._decompress=function(P,D,M,F,N,B,U,O){if(N==1)for(var V=0;V<F;V++)B[U+V]=D[M+V];else if(N==3)A.decode._decodeG3(D,M,F,B,U,P.width,O);else if(N==4)A.decode._decodeG4(D,M,F,B,U,P.width,O);else if(N==5)A.decode._decodeLZW(D,M,B,U);else if(N==6)A.decode._decodeOldJPEG(P,D,M,F,B,U);else if(N==7)A.decode._decodeNewJPEG(P,D,M,F,B,U);else if(N==8)for(var Z=new Uint8Array(D.buffer,M,F),W=k.inflate(Z),Y=0;Y<W.length;Y++)B[U+Y]=W[Y];else N==32773?A.decode._decodePackBits(D,M,F,B,U):N==32809?A.decode._decodeThunder(D,M,F,B,U):T("Unknown compression",N);if(P.t317&&P.t317[0]==2)for(var X=P.t277?P.t277[0]:1,J=P.t278?P.t278[0]:P.height,q=P.width*X,te=0;te<J;te++){var ne=U+te*q;if(X==3)for(var V=3;V<q;V+=3)B[ne+V]=B[ne+V]+B[ne+V-3]&255,B[ne+V+1]=B[ne+V+1]+B[ne+V-2]&255,B[ne+V+2]=B[ne+V+2]+B[ne+V-1]&255;else for(var V=X;V<q;V++)B[ne+V]=B[ne+V]+B[ne+V-X]&255}},A.decode._decodeNikon=function(P,D,M,F,N){var B,U,M;T(P.slice(D,D+100)),B=P[D],D++,U=P[D],D++,T(B.toString(16),U.toString(16),M)},A.decode._decodeNewJPEG=function(P,D,M,F,N,B){var U=P.t347,O=U?U.length:0,V=new Uint8Array(O+F);if(U){for(var Z=216,W=217,Y=0,X=0;X<O-1&&!(U[X]==255&&U[X+1]==W);X++)V[Y++]=U[X];var J=D[M],q=D[M+1];(J!=255||q!=Z)&&(V[Y++]=J,V[Y++]=q);for(var X=2;X<F;X++)V[Y++]=D[M+X]}else for(var X=0;X<F;X++)V[X]=D[M+X];if(P.t262==32803){var te=P.t258[0],ne=new LosslessJpegDecoder,de=ne.decode(V),oe=de.length;if(te==16)for(var X=0;X<oe;X++)N[B++]=de[X]&255,N[B++]=de[X]>>>8;else if(te==12)for(var X=0;X<oe;X+=2)N[B++]=de[X]>>>4,N[B++]=(de[X]<<4|de[X+1]>>>8)&255,N[B++]=de[X+1]&255;else throw new Error("unsupported bit depth "+te)}else{var we=new A.JpegDecoder;we.parse(V);for(var Ae=we.getData(we.width,we.height),X=0;X<Ae.length;X++)N[B+X]=Ae[X]}P.t262[0]==6&&(P.t262[0]=2)},A.decode._decodeOldJPEGInit=function(P,D,M,F){var N=216,B=219,U=196,O=221,V=192,Z=218,W=0,Y=0,X,J,q=!1,te,ne,de,oe=P.t513,we=oe?oe[0]:0,Ae=P.t514,ye=Ae?Ae[0]:0,me=P.t324||P.t273||oe,xe=P.t530,Le=0,Ze=0,Xe=P.t277?P.t277[0]:1,je=P.t515;if(me&&(Y=me[0],q=me.length>1),!q){if(D[M]==255&&D[M+1]==N)return{jpegOffset:M};if(oe!=null&&(D[M+we]==255&&D[M+we+1]==N?W=M+we:T("JPEGInterchangeFormat does not point to SOI"),Ae==null?T("JPEGInterchangeFormatLength field is missing"):(we>=Y||we+ye<=Y)&&T("JPEGInterchangeFormatLength field value is invalid"),W!=null))return{jpegOffset:W}}if(xe!=null&&(Le=xe[0],Ze=xe[1]),oe!=null&&Ae!=null)if(ye>=2&&we+ye<=Y){for(D[M+we+ye-2]==255&&D[M+we+ye-1]==N?X=new Uint8Array(ye-2):X=new Uint8Array(ye),te=0;te<X.length;te++)X[te]=D[M+we+te];T("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else T("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(X==null){var Ie=0,Pe=[];Pe[Ie++]=255,Pe[Ie++]=N;var De=P.t519;if(De==null)throw new Error("JPEGQTables tag is missing");for(te=0;te<De.length;te++)for(Pe[Ie++]=255,Pe[Ie++]=B,Pe[Ie++]=0,Pe[Ie++]=67,Pe[Ie++]=te,ne=0;ne<64;ne++)Pe[Ie++]=D[M+De[te]+ne];for(de=0;de<2;de++){var ze=P[de==0?"t520":"t521"];if(ze==null)throw new Error((de==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(te=0;te<ze.length;te++){Pe[Ie++]=255,Pe[Ie++]=U;var it=19;for(ne=0;ne<16;ne++)it+=D[M+ze[te]+ne];for(Pe[Ie++]=it>>>8,Pe[Ie++]=it&255,Pe[Ie++]=te|de<<4,ne=0;ne<16;ne++)Pe[Ie++]=D[M+ze[te]+ne];for(ne=0;ne<it;ne++)Pe[Ie++]=D[M+ze[te]+16+ne]}}if(Pe[Ie++]=255,Pe[Ie++]=V,Pe[Ie++]=0,Pe[Ie++]=8+3*Xe,Pe[Ie++]=8,Pe[Ie++]=P.height>>>8&255,Pe[Ie++]=P.height&255,Pe[Ie++]=P.width>>>8&255,Pe[Ie++]=P.width&255,Pe[Ie++]=Xe,Xe==1)Pe[Ie++]=1,Pe[Ie++]=17,Pe[Ie++]=0;else for(te=0;te<3;te++)Pe[Ie++]=te+1,Pe[Ie++]=te!=0?17:(Le&15)<<4|Ze&15,Pe[Ie++]=te;je!=null&&je[0]!=0&&(Pe[Ie++]=255,Pe[Ie++]=O,Pe[Ie++]=0,Pe[Ie++]=4,Pe[Ie++]=je[0]>>>8&255,Pe[Ie++]=je[0]&255),X=new Uint8Array(Pe)}var tt=-1;for(te=0;te<X.length-1;){if(X[te]==255&&X[te+1]==V){tt=te;break}te++}if(tt==-1){var ot=new Uint8Array(X.length+10+3*Xe);ot.set(X);var lt=X.length;if(tt=X.length,X=ot,X[lt++]=255,X[lt++]=V,X[lt++]=0,X[lt++]=8+3*Xe,X[lt++]=8,X[lt++]=P.height>>>8&255,X[lt++]=P.height&255,X[lt++]=P.width>>>8&255,X[lt++]=P.width&255,X[lt++]=Xe,Xe==1)X[lt++]=1,X[lt++]=17,X[lt++]=0;else for(te=0;te<3;te++)X[lt++]=te+1,X[lt++]=te!=0?17:(Le&15)<<4|Ze&15,X[lt++]=te}if(D[Y]==255&&D[Y+1]==Z){var St=D[Y+2]<<8|D[Y+3];for(J=new Uint8Array(St+2),J[0]=D[Y],J[1]=D[Y+1],J[2]=D[Y+2],J[3]=D[Y+3],te=0;te<St-2;te++)J[te+4]=D[Y+te+4]}else{J=new Uint8Array(2+6+2*Xe);var et=0;if(J[et++]=255,J[et++]=Z,J[et++]=0,J[et++]=6+2*Xe,J[et++]=Xe,Xe==1)J[et++]=1,J[et++]=0;else for(te=0;te<3;te++)J[et++]=te+1,J[et++]=te<<4|te;J[et++]=0,J[et++]=63,J[et++]=0}return{jpegOffset:M,tables:X,sosMarker:J,sofPosition:tt}},A.decode._decodeOldJPEG=function(P,D,M,F,N,B){var U,O,V,Z,W=A.decode._decodeOldJPEGInit(P,D,M,F);if(W.jpegOffset!=null)for(O=M+F-W.jpegOffset,Z=new Uint8Array(O),U=0;U<O;U++)Z[U]=D[W.jpegOffset+U];else{for(V=W.tables.length,Z=new Uint8Array(V+W.sosMarker.length+F+2),Z.set(W.tables),Z[W.sofPosition+5]=P.height>>>8&255,Z[W.sofPosition+6]=P.height&255,Z[W.sofPosition+7]=P.width>>>8&255,Z[W.sofPosition+8]=P.width&255,(D[M]!=255||D[M+1]!=SOS)&&(Z.set(W.sosMarker,bufoff),bufoff+=sosMarker.length),U=0;U<F;U++)Z[bufoff++]=D[M+U];Z[bufoff++]=255,Z[bufoff++]=EOI}var Y=new A.JpegDecoder;Y.parse(Z);for(var X=Y.getData(Y.width,Y.height),U=0;U<X.length;U++)N[B+U]=X[U];P.t262[0]==6&&(P.t262[0]=2)},A.decode._decodePackBits=function(P,D,M,F,N){for(var B=new Int8Array(P.buffer),U=new Int8Array(F.buffer),O=D+M;D<O;){var V=B[D];if(D++,V>=0&&V<128)for(var Z=0;Z<V+1;Z++)U[N]=B[D],N++,D++;if(V>=-127&&V<0){for(var Z=0;Z<-V+1;Z++)U[N]=B[D],N++;D++}}},A.decode._decodeThunder=function(P,D,M,F,N){for(var B=[0,1,0,-1],U=[0,1,2,3,0,-3,-2,-1],O=D+M,V=N*2,Z=0;D<O;){var W=P[D],Y=W>>>6,X=W&63;if(D++,Y==3&&(Z=X&15,F[V>>>1]|=Z<<4*(1-V&1),V++),Y==0)for(var J=0;J<X;J++)F[V>>>1]|=Z<<4*(1-V&1),V++;if(Y==2)for(var J=0;J<2;J++){var q=X>>>3*(1-J)&7;q!=4&&(Z+=U[q],F[V>>>1]|=Z<<4*(1-V&1),V++)}if(Y==1)for(var J=0;J<3;J++){var q=X>>>2*(2-J)&3;q!=2&&(Z+=B[q],F[V>>>1]|=Z<<4*(1-V&1),V++)}}},A.decode._dmap={"1":0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},A.decode._lens=function(){var P=function(V,Z,W,Y){for(var X=0;X<Z.length;X++)V[Z[X]]=W+X*Y},D="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",M="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",F="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",N="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",B="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";D=D.split(","),M=M.split(","),F=F.split(","),N=N.split(","),B=B.split(",");var U={},O={};return P(U,D,0,1),P(U,F,64,64),P(U,B,1792,64),P(O,M,0,1),P(O,N,64,64),P(O,B,1792,64),[U,O]}(),A.decode._decodeG4=function(P,D,M,F,N,B,U){for(var O=A.decode,V=D<<3,Z=0,W="",Y=[],X=[],J=0;J<B;J++)X.push(0);X=O._makeDiff(X);for(var q=0,te=0,ne=0,de=0,oe=0,we=0,Ae="",ye=0,me=Math.ceil(B/8)*8;V>>>3<D+M;){ne=O._findDiff(X,q+(q==0?0:1),1-oe),de=O._findDiff(X,ne,oe);var xe=0;if(U==1&&(xe=P[V>>>3]>>>7-(V&7)&1),U==2&&(xe=P[V>>>3]>>>(V&7)&1),V++,W+=xe,Ae=="H"){if(O._lens[oe][W]!=null){var Le=O._lens[oe][W];W="",Z+=Le,Le<64&&(O._addNtimes(Y,Z,oe),q+=Z,oe=1-oe,Z=0,ye--,ye==0&&(Ae=""))}}else W=="0001"&&(W="",O._addNtimes(Y,de-q,oe),q=de),W=="001"&&(W="",Ae="H",ye=2),O._dmap[W]!=null&&(te=ne+O._dmap[W],O._addNtimes(Y,te-q,oe),q=te,W="",oe=1-oe);Y.length==B&&Ae==""&&(O._writeBits(Y,F,N*8+we*me),oe=0,we++,q=0,X=O._makeDiff(Y),Y=[])}},A.decode._findDiff=function(P,D,M){for(var F=0;F<P.length;F+=2)if(P[F]>=D&&P[F+1]==M)return P[F]},A.decode._makeDiff=function(P){var D=[];P[0]==1&&D.push(0,1);for(var M=1;M<P.length;M++)P[M-1]!=P[M]&&D.push(M,P[M]);return D.push(P.length,0,P.length,1),D},A.decode._decodeG3=function(P,D,M,F,N,B,U){for(var O=A.decode,V=D<<3,Z=0,W="",Y=[],X=[],J=0;J<B;J++)Y.push(0);for(var q=0,te=0,ne=0,de=0,oe=0,we=-1,Ae="",ye=0,me=!1,xe=Math.ceil(B/8)*8;V>>>3<D+M;){ne=O._findDiff(X,q+(q==0?0:1),1-oe),de=O._findDiff(X,ne,oe);var Le=0;if(U==1&&(Le=P[V>>>3]>>>7-(V&7)&1),U==2&&(Le=P[V>>>3]>>>(V&7)&1),V++,W+=Le,me){if(O._lens[oe][W]!=null){var Ze=O._lens[oe][W];W="",Z+=Ze,Ze<64&&(O._addNtimes(Y,Z,oe),oe=1-oe,Z=0)}}else if(Ae=="H"){if(O._lens[oe][W]!=null){var Ze=O._lens[oe][W];W="",Z+=Ze,Ze<64&&(O._addNtimes(Y,Z,oe),q+=Z,oe=1-oe,Z=0,ye--,ye==0&&(Ae=""))}}else W=="0001"&&(W="",O._addNtimes(Y,de-q,oe),q=de),W=="001"&&(W="",Ae="H",ye=2),O._dmap[W]!=null&&(te=ne+O._dmap[W],O._addNtimes(Y,te-q,oe),q=te,W="",oe=1-oe);W.endsWith("000000000001")&&(we>=0&&O._writeBits(Y,F,N*8+we*xe),U==1&&(me=(P[V>>>3]>>>7-(V&7)&1)==1),U==2&&(me=(P[V>>>3]>>>(V&7)&1)==1),V++,O._decodeG3.allow2D==null&&(O._decodeG3.allow2D=me),O._decodeG3.allow2D||(me=!0,V--),W="",oe=0,we++,q=0,X=O._makeDiff(Y),Y=[])}Y.length==B&&O._writeBits(Y,F,N*8+we*xe)},A.decode._addNtimes=function(P,D,M){for(var F=0;F<D;F++)P.push(M)},A.decode._writeBits=function(P,D,M){for(var F=0;F<P.length;F++)D[M+F>>>3]|=P[F]<<7-(M+F&7)},A.decode._decodeLZW=function(P,D,M,F){if(A.decode._lzwTab==null){for(var N=new Uint32Array(65535),B=new Uint16Array(65535),W=new Uint8Array(2e6),U=0;U<256;U++)W[U<<2]=U,N[U]=U<<2,B[U]=1;A.decode._lzwTab=[N,B,W]}for(var O=A.decode._copyData,V=A.decode._lzwTab[0],Z=A.decode._lzwTab[1],W=A.decode._lzwTab[2],Y=258,X=258<<2,J=9,q=D<<3,te=256,ne=257,de=0,oe=0,we=0;de=P[q>>>3]<<16|P[q+8>>>3]<<8|P[q+16>>>3],oe=de>>24-(q&7)-J&(1<<J)-1,q+=J,oe!=ne;){if(oe==te){if(J=9,Y=258,X=258<<2,de=P[q>>>3]<<16|P[q+8>>>3]<<8|P[q+16>>>3],oe=de>>24-(q&7)-J&(1<<J)-1,q+=J,oe==ne)break;M[F]=oe,F++}else if(oe<Y){var Ae=V[oe],ye=Z[oe];if(O(W,Ae,M,F,ye),F+=ye,we>=Y)V[Y]=X,W[V[Y]]=Ae[0],Z[Y]=1,X=X+1+3&~3,Y++;else{V[Y]=X;var me=V[we],xe=Z[we];O(W,me,W,X,xe),W[X+xe]=W[Ae],xe++,Z[Y]=xe,Y++,X=X+xe+3&~3}Y+1==1<<J&&J++}else{if(we>=Y)V[Y]=X,Z[Y]=0,Y++;else{V[Y]=X;var me=V[we],xe=Z[we];O(W,me,W,X,xe),W[X+xe]=W[X],xe++,Z[Y]=xe,Y++,O(W,X,M,F,xe),F+=xe,X=X+xe+3&~3}Y+1==1<<J&&J++}we=oe}},A.decode._copyData=function(P,D,M,F,N){for(var B=0;B<N;B+=4)M[F+B]=P[D+B],M[F+B+1]=P[D+B+1],M[F+B+2]=P[D+B+2],M[F+B+3]=P[D+B+3]},A.tags={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffset",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",296:"ResolutionUnit",297:"PageNumber",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffset",325:"TileByteCounts",330:"SubIFDs",336:"DotRange",338:"ExtraSample",339:"SampleFormat",347:"JPEGTables",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",700:"XMP",33421:"CFARepeatPatternDim",33422:"CFAPattern",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33723:"IPTC/NAA",34377:"Photoshop",34665:"ExifIFD",34675:"ICC Profile",34850:"ExposureProgram",34853:"GPSInfo",34855:"ISOSpeedRatings",34858:"TimeZoneOffset",34859:"SelfTimeMode",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37377:"ShutterSpeedValue",37378:"ApertureValue",37380:"ExposureBiasValue",37383:"MeteringMode",37385:"Flash",37386:"FocalLength",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37398:"TIFF/EPStandardID",37399:"SensingMethod",37500:"MakerNote",37510:"UserComment",37724:"ImageSourceData",40092:"XPComment",40094:"XPKeywords",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelXDimension",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50733:"BayerGreenSplit",50738:"AntiAliasStrength",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50727:"AnalogBalance",50728:"AsShotNeutral",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50827:"OriginalRawFileName",50829:"ActiveArea",50830:"MaskedAreas",50931:"CameraCalibrationSignature",50932:"ProfileCalibrationSignature",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualityFinalSize",51091:"OriginalDefaultCropSize",51125:"DefaultUserCrop"},A.ttypes={256:3,257:3,258:3,259:3,262:3,273:4,274:3,277:3,278:4,279:4,282:5,283:5,284:3,286:5,287:5,296:3,305:2,306:2,338:3,513:4,514:4,34665:4},A._readIFD=function(P,D,M,F){var N=P.readUshort(D,M);M+=2;var B={};F.push(B);for(var U=0;U<N;U++){var O=P.readUshort(D,M);M+=2;var V=P.readUshort(D,M);M+=2;var Z=P.readUint(D,M);M+=4;var W=P.readUint(D,M);M+=4;var Y=[];if(B["t"+O]=Y,V==1||V==7)for(var X=0;X<Z;X++)Y.push(D[(Z<5?M-4:W)+X]);if(V==2&&Y.push(P.readASCII(D,Z<5?M-4:W,Z-1)),V==3)for(var X=0;X<Z;X++)Y.push(P.readUshort(D,(Z<3?M-4:W)+2*X));if(V==4)for(var X=0;X<Z;X++)Y.push(P.readUint(D,(Z<2?M-4:W)+4*X));if(V==5)for(var X=0;X<Z;X++)Y.push(P.readUint(D,W+X*8)/P.readUint(D,W+X*8+4));if(V==8)for(var X=0;X<Z;X++)Y.push(P.readShort(D,(Z<3?M-4:W)+2*X));if(V==9)for(var X=0;X<Z;X++)Y.push(P.readInt(D,(Z<2?M-4:W)+4*X));if(V==10)for(var X=0;X<Z;X++)Y.push(P.readInt(D,W+X*8)/P.readInt(D,W+X*8+4));if(V==11)for(var X=0;X<Z;X++)Y.push(P.readFloat(D,W+X*4));if(V==12)for(var X=0;X<Z;X++)Y.push(P.readDouble(D,W+X*8));if(Z!=0&&Y.length==0&&T("unknown TIFF tag type: ",V,"num:",Z),O==330)for(var X=0;X<Z;X++)A._readIFD(P,D,Y[X],F)}return M},A._writeIFD=function(P,D,M,F){var N=Object.keys(F);P.writeUshort(D,M,N.length),M+=2;for(var B=M+N.length*12+4,U=0;U<N.length;U++){var O=N[U],V=parseInt(O.slice(1)),Z=A.ttypes[V];if(Z==null)throw new Error("unknown type of tag: "+V);var W=F[O];Z==2&&(W=W[0]+"\0");var Y=W.length;P.writeUshort(D,M,V),M+=2,P.writeUshort(D,M,Z),M+=2,P.writeUint(D,M,Y),M+=4;var X=[-1,1,1,2,4,8,0,0,0,0,0,0,8][Z]*Y,J=M;if(X>4&&(P.writeUint(D,M,B),J=B),Z==2&&P.writeASCII(D,J,W),Z==3)for(var q=0;q<Y;q++)P.writeUshort(D,J+2*q,W[q]);if(Z==4)for(var q=0;q<Y;q++)P.writeUint(D,J+4*q,W[q]);if(Z==5)for(var q=0;q<Y;q++)P.writeUint(D,J+8*q,Math.round(W[q]*1e4)),P.writeUint(D,J+8*q+4,1e4);if(Z==12)for(var q=0;q<Y;q++)P.writeDouble(D,J+8*q,W[q]);X>4&&(X+=X&1,B+=X),M+=4}return[M,B]},A.toRGBA8=function(P){var D=P.width,M=P.height,F=D*M,N=F*4,B=P.data,U=new Uint8Array(F*4),O=P.t262[0],V=P.t258?Math.min(32,P.t258[0]):1,Z=P.isLE?1:0;if(O==0)for(var W=Math.ceil(V*D/8),Y=0;Y<M;Y++){var X=Y*W,J=Y*D;if(V==1)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+(q>>3)]>>7-(q&7)&1;U[te]=U[te+1]=U[te+2]=(1-ne)*255,U[te+3]=255}if(V==4)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+(q>>1)]>>4-4*(q&1)&15;U[te]=U[te+1]=U[te+2]=(15-ne)*17,U[te+3]=255}if(V==8)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+q];U[te]=U[te+1]=U[te+2]=255-ne,U[te+3]=255}}else if(O==1)for(var W=Math.ceil(V*D/8),Y=0;Y<M;Y++){var X=Y*W,J=Y*D;if(V==1)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+(q>>3)]>>7-(q&7)&1;U[te]=U[te+1]=U[te+2]=ne*255,U[te+3]=255}if(V==2)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+(q>>2)]>>6-2*(q&3)&3;U[te]=U[te+1]=U[te+2]=ne*85,U[te+3]=255}if(V==8)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+q];U[te]=U[te+1]=U[te+2]=ne,U[te+3]=255}if(V==16)for(var q=0;q<D;q++){var te=J+q<<2,ne=B[X+(2*q+Z)];U[te]=U[te+1]=U[te+2]=Math.min(255,ne),U[te+3]=255}}else if(O==2)if(V==8)if(P.t338)if(P.t338[0]>0)for(var q=0;q<N;q++)U[q]=B[q];else for(var q=0;q<N;q+=4)U[q]=B[q],U[q+1]=B[q+1],U[q+2]=B[q+2],U[q+3]=255;else{var de=P.t258?P.t258.length:3;if(de==4)for(var q=0;q<N;q++)U[q]=B[q];if(de==3)for(var q=0;q<F;q++){var te=q<<2,oe=q*3;U[te]=B[oe],U[te+1]=B[oe+1],U[te+2]=B[oe+2],U[te+3]=255}}else for(var q=0;q<F;q++){var te=q<<2,oe=q*6;U[te]=B[oe],U[te+1]=B[oe+2],U[te+2]=B[oe+4],U[te+3]=255}else if(O==3)for(var we=P.t320,q=0;q<F;q++){var te=q<<2,Ae=B[q];U[te]=we[Ae]>>8,U[te+1]=we[256+Ae]>>8,U[te+2]=we[512+Ae]>>8,U[te+3]=255}else if(O==5)for(var de=P.t258?P.t258.length:4,ye=de>4?1:0,q=0;q<F;q++){var te=q<<2,me=q*de,xe=255-B[me],Le=255-B[me+1],Ze=255-B[me+2],Xe=(255-B[me+3])*(1/255);U[te]=~~(xe*Xe+.5),U[te+1]=~~(Le*Xe+.5),U[te+2]=~~(Ze*Xe+.5),U[te+3]=255*(1-ye)+B[me+4]*ye}else T("Unknown Photometric interpretation: "+O);return U},A.replaceIMG=function(){for(var P=document.getElementsByTagName("img"),D=0;D<P.length;D++){var M=P[D],F=M.getAttribute("src");if(F!=null){var N=F.split(".").pop().toLowerCase();if(!(N!="tif"&&N!="tiff")){var B=new XMLHttpRequest;A._xhrs.push(B),A._imgs.push(M),B.open("GET",F),B.responseType="arraybuffer",B.onload=A._imgLoaded,B.send()}}}},A._xhrs=[],A._imgs=[],A._imgLoaded=function(P){var D=P.target.response,M=A.decode(D),F=M[0];A.decodeImages(D,M);var N=A.toRGBA8(F),B=F.width,U=F.height,O=A._xhrs.indexOf(P.target),V=A._imgs[O];A._xhrs.splice(O,1),A._imgs.splice(O,1);var Z=document.createElement("canvas");Z.width=B,Z.height=U;for(var W=Z.getContext("2d"),Y=W.createImageData(B,U),X=0;X<N.length;X++)Y.data[X]=N[X];W.putImageData(Y,0,0);for(var J=["style","class","id"],X=0;X<J.length;X++)Z.setAttribute(J[X],V.getAttribute(J[X]));V.parentNode.replaceChild(Z,V)},A._binBE={nextZero:function(P,D){for(;P[D]!=0;)D++;return D},readUshort:function(P,D){return P[D]<<8|P[D+1]},readShort:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+1],M[1]=P[D+0],A._binBE.i16[0]},readInt:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+3],M[1]=P[D+2],M[2]=P[D+1],M[3]=P[D+0],A._binBE.i32[0]},readUint:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+3],M[1]=P[D+2],M[2]=P[D+1],M[3]=P[D+0],A._binBE.ui32[0]},readASCII:function(P,D,M){for(var F="",N=0;N<M;N++)F+=String.fromCharCode(P[D+N]);return F},readFloat:function(P,D){for(var M=A._binBE.ui8,F=0;F<4;F++)M[F]=P[D+3-F];return A._binBE.fl32[0]},readDouble:function(P,D){for(var M=A._binBE.ui8,F=0;F<8;F++)M[F]=P[D+7-F];return A._binBE.fl64[0]},writeUshort:function(P,D,M){P[D]=M>>8&255,P[D+1]=M&255},writeUint:function(P,D,M){P[D]=M>>24&255,P[D+1]=M>>16&255,P[D+2]=M>>8&255,P[D+3]=M>>0&255},writeASCII:function(P,D,M){for(var F=0;F<M.length;F++)P[D+F]=M.charCodeAt(F)},writeDouble:function(P,D,M){A._binBE.fl64[0]=M;for(var F=0;F<8;F++)P[D+F]=A._binBE.ui8[7-F]}},A._binBE.ui8=new Uint8Array(8),A._binBE.i16=new Int16Array(A._binBE.ui8.buffer),A._binBE.i32=new Int32Array(A._binBE.ui8.buffer),A._binBE.ui32=new Uint32Array(A._binBE.ui8.buffer),A._binBE.fl32=new Float32Array(A._binBE.ui8.buffer),A._binBE.fl64=new Float64Array(A._binBE.ui8.buffer),A._binLE={nextZero:A._binBE.nextZero,readUshort:function(P,D){return P[D+1]<<8|P[D]},readShort:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+0],M[1]=P[D+1],A._binBE.i16[0]},readInt:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+0],M[1]=P[D+1],M[2]=P[D+2],M[3]=P[D+3],A._binBE.i32[0]},readUint:function(P,D){var M=A._binBE.ui8;return M[0]=P[D+0],M[1]=P[D+1],M[2]=P[D+2],M[3]=P[D+3],A._binBE.ui32[0]},readASCII:A._binBE.readASCII,readFloat:function(P,D){for(var M=A._binBE.ui8,F=0;F<4;F++)M[F]=P[D+F];return A._binBE.fl32[0]},readDouble:function(P,D){for(var M=A._binBE.ui8,F=0;F<8;F++)M[F]=P[D+F];return A._binBE.fl64[0]}},A._copyTile=function(P,D,M,F,N,B,U,O){for(var V=Math.min(D,N-U),Z=Math.min(M,B-O),W=0;W<Z;W++)for(var Y=(O+W)*N+U,X=W*D,J=0;J<V;J++)F[Y+J]=P[X+J]}})(h,I)})()}).call(this,m("_process"))},{_process:133,pako:86}],183:[function(m,x,E){(function(S){x.exports=h;function h(T,A){if(I("noDeprecation"))return T;var k=!1;function P(){if(!k){if(I("throwDeprecation"))throw new Error(A);I("traceDeprecation")?console.trace(A):console.warn(A),k=!0}return T.apply(this,arguments)}return P}function I(T){try{if(!S.localStorage)return!1}catch{return!1}var A=S.localStorage[T];return A==null?!1:String(A).toLowerCase()==="true"}}).call(this,typeof commonjsGlobal!="undefined"?commonjsGlobal:typeof self!="undefined"?self:typeof g!="undefined"?g:{})},{}],184:[function(m,x,E){arguments[4][26][0].apply(E,arguments)},{dup:26}],185:[function(m,x,E){arguments[4][27][0].apply(E,arguments)},{dup:27}],186:[function(m,x,E){arguments[4][28][0].apply(E,arguments)},{"./support/isBuffer":185,_process:133,dup:28,inherits:184}],187:[function(m,x,E){var S=m("global/window"),h=m("is-function"),I=m("parse-headers"),T=m("xtend");x.exports=D,x.exports.default=D,D.XMLHttpRequest=S.XMLHttpRequest||N,D.XDomainRequest="withCredentials"in new D.XMLHttpRequest?D.XMLHttpRequest:S.XDomainRequest,A(["get","put","post","patch","head","delete"],function(B){D[B==="delete"?"del":B]=function(U,O,V){return O=P(U,O,V),O.method=B.toUpperCase(),M(O)}});function A(B,U){for(var O=0;O<B.length;O++)U(B[O])}function k(B){for(var U in B)if(B.hasOwnProperty(U))return!1;return!0}function P(B,U,O){var V=B;return h(U)?(O=U,typeof B=="string"&&(V={uri:B})):V=T(U,{uri:B}),V.callback=O,V}function D(B,U,O){return U=P(B,U,O),M(U)}function M(B){if(typeof B.callback=="undefined")throw new Error("callback argument missing");var U=!1,O=function(Le,Ze,Xe){U||(U=!0,B.callback(Le,Ze,Xe))};function V(){X.readyState===4&&setTimeout(Y,0)}function Z(){var xe=void 0;if(X.response?xe=X.response:xe=X.responseText||F(X),Ae)try{xe=JSON.parse(xe)}catch{}return xe}function W(xe){return clearTimeout(ye),xe instanceof Error||(xe=new Error(""+(xe||"Unknown XMLHttpRequest Error"))),xe.statusCode=0,O(xe,me)}function Y(){if(!q){var xe;clearTimeout(ye),B.useXDR&&X.status===void 0?xe=200:xe=X.status===1223?204:X.status;var Le=me,Ze=null;return xe!==0?(Le={body:Z(),statusCode:xe,method:ne,headers:{},url:te,rawRequest:X},X.getAllResponseHeaders&&(Le.headers=I(X.getAllResponseHeaders()))):Ze=new Error("Internal XMLHttpRequest Error"),O(Ze,Le,Le.body)}}var X=B.xhr||null;X||(B.cors||B.useXDR?X=new D.XDomainRequest:X=new D.XMLHttpRequest);var J,q,te=X.url=B.uri||B.url,ne=X.method=B.method||"GET",de=B.body||B.data,oe=X.headers=B.headers||{},we=!!B.sync,Ae=!1,ye,me={body:void 0,headers:{},statusCode:0,method:ne,url:te,rawRequest:X};if("json"in B&&B.json!==!1&&(Ae=!0,oe.accept||oe.Accept||(oe.Accept="application/json"),ne!=="GET"&&ne!=="HEAD"&&(oe["content-type"]||oe["Content-Type"]||(oe["Content-Type"]="application/json"),de=JSON.stringify(B.json===!0?de:B.json))),X.onreadystatechange=V,X.onload=Y,X.onerror=W,X.onprogress=function(){},X.onabort=function(){q=!0},X.ontimeout=W,X.open(ne,te,!we,B.username,B.password),we||(X.withCredentials=!!B.withCredentials),!we&&B.timeout>0&&(ye=setTimeout(function(){if(!q){q=!0,X.abort("timeout");var xe=new Error("XMLHttpRequest timeout");xe.code="ETIMEDOUT",W(xe)}},B.timeout)),X.setRequestHeader)for(J in oe)oe.hasOwnProperty(J)&&X.setRequestHeader(J,oe[J]);else if(B.headers&&!k(B.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in B&&(X.responseType=B.responseType),"beforeSend"in B&&typeof B.beforeSend=="function"&&B.beforeSend(X),X.send(de||null),X}function F(B){try{if(B.responseType==="document")return B.responseXML;var U=B.responseXML&&B.responseXML.documentElement.nodeName==="parsererror";if(B.responseType===""&&!U)return B.responseXML}catch{}return null}function N(){}},{"global/window":71,"is-function":78,"parse-headers":106,xtend:189}],188:[function(m,x,E){x.exports=function(){return typeof self.DOMParser!="undefined"?function(h){var I=new self.DOMParser;return I.parseFromString(h,"application/xml")}:typeof self.ActiveXObject!="undefined"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(h){var I=new self.ActiveXObject("Microsoft.XMLDOM");return I.async="false",I.loadXML(h),I}:function(h){var I=document.createElement("div");return I.innerHTML=h,I}}()},{}],189:[function(m,x,E){x.exports=h;var S=Object.prototype.hasOwnProperty;function h(){for(var I={},T=0;T<arguments.length;T++){var A=arguments[T];for(var k in A)S.call(A,k)&&(I[k]=A[k])}return I}},{}],190:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.srcOver=S,E.dstOver=h,E.multiply=I,E.add=T,E.screen=A,E.overlay=k,E.darken=P,E.lighten=D,E.hardLight=M,E.difference=F,E.exclusion=N;function S(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=(B.r*B.a+U.r*U.a*(1-B.a))/V,W=(B.g*B.a+U.g*U.a*(1-B.a))/V,Y=(B.b*B.a+U.b*U.a*(1-B.a))/V;return{r:Z,g:W,b:Y,a:V}}function h(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=(U.r*U.a+B.r*B.a*(1-U.a))/V,W=(U.g*U.a+B.g*B.a*(1-U.a))/V,Y=(U.b*U.a+B.b*B.a*(1-U.a))/V;return{r:Z,g:W,b:Y,a:V}}function I(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Z*X+Z*(1-U.a)+X*(1-B.a))/V,ne=(W*J+W*(1-U.a)+J*(1-B.a))/V,de=(Y*q+Y*(1-U.a)+q*(1-B.a))/V;return{r:te,g:ne,b:de,a:V}}function T(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Z+X)/V,ne=(W+J)/V,de=(Y+q)/V;return{r:te,g:ne,b:de,a:V}}function A(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Z*U.a+X*B.a-Z*X+Z*(1-U.a)+X*(1-B.a))/V,ne=(W*U.a+J*B.a-W*J+W*(1-U.a)+J*(1-B.a))/V,de=(Y*U.a+q*B.a-Y*q+Y*(1-U.a)+q*(1-B.a))/V;return{r:te,g:ne,b:de,a:V}}function k(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(2*X<=U.a?2*Z*X+Z*(1-U.a)+X*(1-B.a):Z*(1+U.a)+X*(1+B.a)-2*X*Z-U.a*B.a)/V,ne=(2*J<=U.a?2*W*J+W*(1-U.a)+J*(1-B.a):W*(1+U.a)+J*(1+B.a)-2*J*W-U.a*B.a)/V,de=(2*q<=U.a?2*Y*q+Y*(1-U.a)+q*(1-B.a):Y*(1+U.a)+q*(1+B.a)-2*q*Y-U.a*B.a)/V;return{r:te,g:ne,b:de,a:V}}function P(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Math.min(Z*U.a,X*B.a)+Z*(1-U.a)+X*(1-B.a))/V,ne=(Math.min(W*U.a,J*B.a)+W*(1-U.a)+J*(1-B.a))/V,de=(Math.min(Y*U.a,q*B.a)+Y*(1-U.a)+q*(1-B.a))/V;return{r:te,g:ne,b:de,a:V}}function D(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Math.max(Z*U.a,X*B.a)+Z*(1-U.a)+X*(1-B.a))/V,ne=(Math.max(W*U.a,J*B.a)+W*(1-U.a)+J*(1-B.a))/V,de=(Math.max(Y*U.a,q*B.a)+Y*(1-U.a)+q*(1-B.a))/V;return{r:te,g:ne,b:de,a:V}}function M(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(2*Z<=B.a?2*Z*X+Z*(1-U.a)+X*(1-B.a):Z*(1+U.a)+X*(1+B.a)-2*X*Z-U.a*B.a)/V,ne=(2*W<=B.a?2*W*J+W*(1-U.a)+J*(1-B.a):W*(1+U.a)+J*(1+B.a)-2*J*W-U.a*B.a)/V,de=(2*Y<=B.a?2*Y*q+Y*(1-U.a)+q*(1-B.a):Y*(1+U.a)+q*(1+B.a)-2*q*Y-U.a*B.a)/V;return{r:te,g:ne,b:de,a:V}}function F(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Z+X-2*Math.min(Z*U.a,X*B.a))/V,ne=(W+J-2*Math.min(W*U.a,J*B.a))/V,de=(Y+q-2*Math.min(Y*U.a,q*B.a))/V;return{r:te,g:ne,b:de,a:V}}function N(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;B.a*=O;var V=U.a+B.a-U.a*B.a,Z=B.r*B.a,W=B.g*B.a,Y=B.b*B.a,X=U.r*U.a,J=U.g*U.a,q=U.b*U.a,te=(Z*U.a+X*B.a-2*Z*X+Z*(1-U.a)+X*(1-B.a))/V,ne=(W*U.a+J*B.a-2*W*J+W*(1-U.a)+J*(1-B.a))/V,de=(Y*U.a+q*B.a-2*Y*q+Y*(1-U.a)+q*(1-B.a))/V;return{r:te,g:ne,b:de,a:V}}},{}],191:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(E,"__esModule",{value:!0}),E.default=A;var h=m("@jimp/utils"),I=S(m("../constants")),T=S(m("./composite-modes"));function A(k,P,D){var M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},F=arguments.length>4?arguments[4]:void 0;if(typeof M=="function"&&(F=M,M={}),!(k instanceof this.constructor))return h.throwError.call(this,"The source must be a Jimp image",F);if(typeof P!="number"||typeof D!="number")return h.throwError.call(this,"x and y must be numbers",F);var N=M,B=N.mode,U=N.opacitySource,O=N.opacityDest;B||(B=I.BLEND_SOURCE_OVER),(typeof U!="number"||U<0||U>1)&&(U=1),(typeof O!="number"||O<0||O>1)&&(O=1);var V=T[B];P=Math.round(P),D=Math.round(D);var Z=this;return O!==1&&Z.opacity(O),k.scanQuiet(0,0,k.bitmap.width,k.bitmap.height,function(W,Y,X){var J=Z.getPixelIndex(P+W,D+Y,I.EDGE_CROP),q=V({r:this.bitmap.data[X+0]/255,g:this.bitmap.data[X+1]/255,b:this.bitmap.data[X+2]/255,a:this.bitmap.data[X+3]/255},{r:Z.bitmap.data[J+0]/255,g:Z.bitmap.data[J+1]/255,b:Z.bitmap.data[J+2]/255,a:Z.bitmap.data[J+3]/255},U);Z.bitmap.data[J+0]=this.constructor.limit255(q.r*255),Z.bitmap.data[J+1]=this.constructor.limit255(q.g*255),Z.bitmap.data[J+2]=this.constructor.limit255(q.b*255),Z.bitmap.data[J+3]=this.constructor.limit255(q.a*255)}),(0,h.isNodePattern)(F)&&F.call(this,null,this),this}x.exports=E.default},{"../constants":192,"./composite-modes":190,"@babel/runtime/helpers/interopRequireWildcard":12,"@jimp/utils":235}],192:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.EDGE_CROP=E.EDGE_WRAP=E.EDGE_EXTEND=E.BLEND_EXCLUSION=E.BLEND_DIFFERENCE=E.BLEND_HARDLIGHT=E.BLEND_LIGHTEN=E.BLEND_DARKEN=E.BLEND_OVERLAY=E.BLEND_SCREEN=E.BLEND_ADD=E.BLEND_MULTIPLY=E.BLEND_DESTINATION_OVER=E.BLEND_SOURCE_OVER=E.VERTICAL_ALIGN_BOTTOM=E.VERTICAL_ALIGN_MIDDLE=E.VERTICAL_ALIGN_TOP=E.HORIZONTAL_ALIGN_RIGHT=E.HORIZONTAL_ALIGN_CENTER=E.HORIZONTAL_ALIGN_LEFT=E.AUTO=void 0;var S=-1;E.AUTO=S;var h=1;E.HORIZONTAL_ALIGN_LEFT=h;var I=2;E.HORIZONTAL_ALIGN_CENTER=I;var T=4;E.HORIZONTAL_ALIGN_RIGHT=T;var A=8;E.VERTICAL_ALIGN_TOP=A;var k=16;E.VERTICAL_ALIGN_MIDDLE=k;var P=32;E.VERTICAL_ALIGN_BOTTOM=P;var D="srcOver";E.BLEND_SOURCE_OVER=D;var M="dstOver";E.BLEND_DESTINATION_OVER=M;var F="multiply";E.BLEND_MULTIPLY=F;var N="add";E.BLEND_ADD=N;var B="screen";E.BLEND_SCREEN=B;var U="overlay";E.BLEND_OVERLAY=U;var O="darken";E.BLEND_DARKEN=O;var V="lighten";E.BLEND_LIGHTEN=V;var Z="hardLight";E.BLEND_HARDLIGHT=Z;var W="difference";E.BLEND_DIFFERENCE=W;var Y="exclusion";E.BLEND_EXCLUSION=Y;var X=1;E.EDGE_EXTEND=X;var J=2;E.EDGE_WRAP=J;var q=3;E.EDGE_CROP=q},{}],193:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireWildcard"),I=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.addConstants=lt,E.addJimpMethods=St,E.jimpEvMethod=et,E.jimpEvChange=Je,Object.defineProperty(E,"addType",{enumerable:!0,get:function(){return we.addType}}),E.default=void 0;for(var T=I(m("@babel/runtime/helpers/construct")),A=I(m("@babel/runtime/helpers/slicedToArray")),k=I(m("@babel/runtime/helpers/classCallCheck")),P=I(m("@babel/runtime/helpers/createClass")),D=I(m("@babel/runtime/helpers/possibleConstructorReturn")),M=I(m("@babel/runtime/helpers/getPrototypeOf")),F=I(m("@babel/runtime/helpers/assertThisInitialized")),N=I(m("@babel/runtime/helpers/inherits")),B=I(m("@babel/runtime/helpers/defineProperty")),U=I(m("@babel/runtime/helpers/typeof")),O=I(m("fs")),V=I(m("path")),Z=I(m("events")),W=m("@jimp/utils"),Y=I(m("any-base")),X=I(m("mkdirp")),J=I(m("pixelmatch")),q=I(m("tinycolor2")),te=I(m("./modules/phash")),ne=I(m("./request")),de=I(m("./composite")),oe=I(m("./utils/promisify")),we=h(m("./utils/mime")),Ae=m("./utils/image-bitmap"),ye=h(m("./constants")),me="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",xe=[NaN,NaN],Le=2;Le<65;Le++){var Ze=(0,Y.default)(Y.default.BIN,me.slice(0,Le))(new Array(64+1).join("1"));xe.push(Ze.length)}function Xe(){}function je(He){return Object.prototype.toString.call(He).toLowerCase().indexOf("arraybuffer")>-1}function Ie(He){for(var ve=S.alloc(He.byteLength),_e=new Uint8Array(He),pe=0;pe<ve.length;++pe)ve[pe]=_e[pe];return ve}function Pe(He,ve){(0,ne.default)(He,function(_e,pe,fe){if(_e)return ve(_e);if("headers"in pe&&"location"in pe.headers)return He.url=pe.headers.location,Pe(He,ve);if((0,U.default)(fe)==="object"&&S.isBuffer(fe))return ve(null,fe);var ue="Could not load Buffer from <"+He.url+"> (HTTP: "+pe.statusCode+")";return new Error(ue)})}function De(He,ve){O.default&&typeof O.default.readFile=="function"&&!He.match(/^(http|ftp)s?:\/\/./)?O.default.readFile(He,ve):Pe({url:He},ve)}function ze(He){return He&&(0,U.default)(He)==="object"&&typeof He.width=="number"&&typeof He.height=="number"&&(S.isBuffer(He.data)||He.data instanceof Uint8Array||typeof Uint8ClampedArray=="function"&&He.data instanceof Uint8ClampedArray)&&(He.data.length===He.width*He.height*4||He.data.length===He.width*He.height*3)}function it(He){if(He.length%3!=0)throw new Error("Buffer length is incorrect");for(var ve=S.allocUnsafe(He.length/3*4),_e=0,pe=0;pe<He.length;pe++)ve[_e]=He[pe],(pe+1)%3==0&&(ve[++_e]=255),_e++;return ve}var tt={data:null,width:null,height:null},ot=function(He){(0,N.default)(ve,He);function ve(){for(var _e,pe=arguments.length,fe=new Array(pe),ue=0;ue<pe;ue++)fe[ue]=arguments[ue];(0,k.default)(this,ve),_e=(0,D.default)(this,(0,M.default)(ve).call(this)),(0,B.default)((0,F.default)(_e),"bitmap",tt),(0,B.default)((0,F.default)(_e),"_background",0),(0,B.default)((0,F.default)(_e),"_originalMime",ve.MIME_PNG),(0,B.default)((0,F.default)(_e),"_exif",null),(0,B.default)((0,F.default)(_e),"_rgba",!0),(0,B.default)((0,F.default)(_e),"writeAsync",function(hi){return(0,oe.default)(_e.write,(0,F.default)(_e),hi)}),(0,B.default)((0,F.default)(_e),"getBase64Async",function(hi){return(0,oe.default)(_e.getBase64,(0,F.default)(_e),hi)}),(0,B.default)((0,F.default)(_e),"getBuffer",Ae.getBuffer),(0,B.default)((0,F.default)(_e),"getBufferAsync",Ae.getBufferAsync),(0,B.default)((0,F.default)(_e),"getPixelColour",_e.getPixelColor),(0,B.default)((0,F.default)(_e),"setPixelColour",_e.setPixelColor);var ce=(0,F.default)(_e),Ee=Xe;je(fe[0])&&(fe[0]=Ie(fe[0]));function Ye(){for(var hi=arguments.length,Me=new Array(hi),bt=0;bt<hi;bt++)Me[bt]=arguments[bt];var At=Me[0],Bt=At||{};Bt.methodName="constructor",setTimeout(function(){var pt;At&&Ee===Xe?ce.emitError("constructor",At):At||ce.emitMulti("constructor","initialized"),(pt=Ee).call.apply(pt,[ce].concat(Me))},1)}if(typeof fe[0]=="number"&&typeof fe[1]=="number"||parseInt(fe[0],10)&&parseInt(fe[1],10)){var ft=parseInt(fe[0],10),_t=parseInt(fe[1],10);if(Ee=fe[2],typeof fe[2]=="number"&&(_e._background=fe[2],Ee=fe[3]),typeof fe[2]=="string"&&(_e._background=ve.cssColorToHex(fe[2]),Ee=fe[3]),typeof Ee=="undefined"&&(Ee=Xe),typeof Ee!="function")return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"cb must be a function",Ye));_e.bitmap={data:S.alloc(ft*_t*4),width:ft,height:_t};for(var It=0;It<_e.bitmap.data.length;It+=4)_e.bitmap.data.writeUInt32BE(_e._background,It);Ye(null,(0,F.default)(_e))}else if((0,U.default)(fe[0])==="object"&&fe[0].url){if(Ee=fe[1]||Xe,typeof Ee!="function")return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"cb must be a function",Ye));Pe(fe[0],function(hi,Me){if(hi)return W.throwError.call((0,F.default)(_e),hi,Ye);_e.parseBitmap(Me,fe[0].url,Ye)})}else if(fe[0]instanceof ve){var $t=fe[0];if(Ee=fe[1],typeof Ee=="undefined"&&(Ee=Xe),typeof Ee!="function")return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"cb must be a function",Ye));_e.bitmap={data:S.from($t.bitmap.data),width:$t.bitmap.width,height:$t.bitmap.height},_e._quality=$t._quality,_e._deflateLevel=$t._deflateLevel,_e._deflateStrategy=$t._deflateStrategy,_e._filterType=$t._filterType,_e._rgba=$t._rgba,_e._background=$t._background,_e._originalMime=$t._originalMime,Ye(null,(0,F.default)(_e))}else if(ze(fe[0])){var Yt=fe[0];Ee=fe[1]||Xe;var ii=Yt.width*Yt.height*4===Yt.data.length,zt=ii?S.from(Yt.data):it(Yt.data);_e.bitmap={data:zt,width:Yt.width,height:Yt.height},Ye(null,(0,F.default)(_e))}else if(typeof fe[0]=="string"){var qt=fe[0];if(Ee=fe[1],typeof Ee=="undefined"&&(Ee=Xe),typeof Ee!="function")return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"cb must be a function",Ye));De(qt,function(hi,Me){if(hi)return W.throwError.call((0,F.default)(_e),hi,Ye);_e.parseBitmap(Me,qt,Ye)})}else if((0,U.default)(fe[0])==="object"&&S.isBuffer(fe[0])){var Vt=fe[0];if(Ee=fe[1],typeof Ee!="function")return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"cb must be a function",Ye));_e.parseBitmap(Vt,null,Ye)}else{Ee=fe[fe.length-1],typeof Ee!="function"&&(Ee=fe[fe.length-2],typeof Ee!="function"&&(Ee=Xe));var fi=ve.__extraConstructors.find(function(hi){return hi.test.apply(hi,fe)});if(fi)new Promise(function(hi,Me){var bt;return(bt=fi.run).call.apply(bt,[(0,F.default)(_e),hi,Me].concat(fe))}).then(function(){return Ye(null,(0,F.default)(_e))}).catch(Ye);else return(0,D.default)(_e,W.throwError.call((0,F.default)(_e),"No matching constructor overloading was found. Please see the docs for how to call the Jimp constructor.",Ye))}return _e}return(0,P.default)(ve,[{key:"parseBitmap",value:function(pe,fe,ue){Ae.parseBitmap.call(this,pe,null,ue)}},{key:"rgba",value:function(pe,fe){return typeof pe!="boolean"?W.throwError.call(this,"bool must be a boolean, true for RGBA or false for RGB",fe):(this._rgba=pe,(0,W.isNodePattern)(fe)&&fe.call(this,null,this),this)}},{key:"emitMulti",value:function(pe,fe){var ue=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue=Object.assign(ue,{methodName:pe,eventName:fe}),this.emit("any",ue),pe&&this.emit(pe,ue),this.emit(fe,ue)}},{key:"emitError",value:function(pe,fe){this.emitMulti(pe,"error",fe)}},{key:"getHeight",value:function(){return this.bitmap.height}},{key:"getWidth",value:function(){return this.bitmap.width}},{key:"inspect",value:function(){return"<Jimp "+(this.bitmap===tt?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}},{key:"toString",value:function(){return"[object Jimp]"}},{key:"getMIME",value:function(){var pe=this._originalMime||ve.MIME_PNG;return pe}},{key:"getExtension",value:function(){var pe=this.getMIME();return we.getExtension(pe)}},{key:"write",value:function(pe,fe){var ue=this;if(!O.default||!O.default.createWriteStream)throw new Error("Cant access the filesystem. You can use the getBase64 method.");if(typeof pe!="string")return W.throwError.call(this,"path must be a string",fe);if(typeof fe=="undefined"&&(fe=Xe),typeof fe!="function")return W.throwError.call(this,"cb must be a function",fe);var ce=we.getType(pe)||this.getMIME(),Ee=V.default.parse(pe);return Ee.dir&&X.default.sync(Ee.dir),this.getBuffer(ce,function(Ye,ft){if(Ye)return W.throwError.call(ue,Ye,fe);var _t=O.default.createWriteStream(pe);_t.on("open",function(){_t.write(ft),_t.end()}).on("error",function(It){return W.throwError.call(ue,It,fe)}),_t.on("finish",function(){fe.call(ue,null,ue)})}),this}},{key:"getBase64",value:function(pe,fe){return pe===ve.AUTO&&(pe=this.getMIME()),typeof pe!="string"?W.throwError.call(this,"mime must be a string",fe):typeof fe!="function"?W.throwError.call(this,"cb must be a function",fe):(this.getBuffer(pe,function(ue,ce){if(ue)return W.throwError.call(this,ue,fe);var Ee="data:"+pe+";base64,"+ce.toString("base64");fe.call(this,null,Ee)}),this)}},{key:"hash",value:function(pe,fe){if(pe=pe||64,typeof pe=="function"&&(fe=pe,pe=64),typeof pe!="number")return W.throwError.call(this,"base must be a number",fe);if(pe<2||pe>64)return W.throwError.call(this,"base must be a number between 2 and 64",fe);var ue=this.pHash();for(ue=(0,Y.default)(Y.default.BIN,me.slice(0,pe))(ue);ue.length<xe[pe];)ue="0"+ue;return(0,W.isNodePattern)(fe)&&fe.call(this,null,ue),ue}},{key:"pHash",value:function(){var pe=new te.default;return pe.getHash(this)}},{key:"distanceFromHash",value:function(pe){var fe=new te.default,ue=fe.getHash(this);return fe.distance(ue,pe)}},{key:"getPixelIndex",value:function(pe,fe,ue,ce){var Ee,Ye;if(typeof ue=="function"&&typeof ce=="undefined"&&(ce=ue,ue=null),ue||(ue=ve.EDGE_EXTEND),typeof pe!="number"||typeof fe!="number")return W.throwError.call(this,"x and y must be numbers",ce);pe=Math.round(pe),fe=Math.round(fe),Ee=pe,Ye=fe,ue===ve.EDGE_EXTEND&&(pe<0&&(Ee=0),pe>=this.bitmap.width&&(Ee=this.bitmap.width-1),fe<0&&(Ye=0),fe>=this.bitmap.height&&(Ye=this.bitmap.height-1)),ue===ve.EDGE_WRAP&&(pe<0&&(Ee=this.bitmap.width+pe),pe>=this.bitmap.width&&(Ee=pe%this.bitmap.width),fe<0&&(Ee=this.bitmap.height+fe),fe>=this.bitmap.height&&(Ye=fe%this.bitmap.height));var ft=this.bitmap.width*Ye+Ee<<2;return(Ee<0||Ee>=this.bitmap.width)&&(ft=-1),(Ye<0||Ye>=this.bitmap.height)&&(ft=-1),(0,W.isNodePattern)(ce)&&ce.call(this,null,ft),ft}},{key:"getPixelColor",value:function(pe,fe,ue){if(typeof pe!="number"||typeof fe!="number")return W.throwError.call(this,"x and y must be numbers",ue);pe=Math.round(pe),fe=Math.round(fe);var ce=this.getPixelIndex(pe,fe),Ee=this.bitmap.data.readUInt32BE(ce);return(0,W.isNodePattern)(ue)&&ue.call(this,null,Ee),Ee}},{key:"setPixelColor",value:function(pe,fe,ue,ce){if(typeof pe!="number"||typeof fe!="number"||typeof ue!="number")return W.throwError.call(this,"hex, x and y must be numbers",ce);fe=Math.round(fe),ue=Math.round(ue);var Ee=this.getPixelIndex(fe,ue);return this.bitmap.data.writeUInt32BE(pe,Ee),(0,W.isNodePattern)(ce)&&ce.call(this,null,this),this}},{key:"hasAlpha",value:function(){for(var pe=0;pe<this.bitmap.height;pe++)for(var fe=0;fe<this.bitmap.width;fe++){var ue=this.bitmap.width*pe+fe<<2,ce=this.bitmap.data[ue+3];if(ce!==255)return!0}return!1}},{key:"scanIterator",value:function(pe,fe,ue,ce){return typeof pe!="number"||typeof fe!="number"?W.throwError.call(this,"x and y must be numbers"):typeof ue!="number"||typeof ce!="number"?W.throwError.call(this,"w and h must be numbers"):(0,W.scanIterator)(this,pe,fe,ue,ce)}}]),ve}(Z.default);function lt(He){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;Object.entries(He).forEach(function(_e){var pe=(0,A.default)(_e,2),fe=pe[0],ue=pe[1];ve[fe]=ue})}function St(He){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;Object.entries(He).forEach(function(_e){var pe=(0,A.default)(_e,2),fe=pe[0],ue=pe[1];ve.prototype[fe]=ue})}lt(ye),St({composite:de.default}),ot.__extraConstructors=[],ot.appendConstructorOption=function(He,ve,_e){ot.__extraConstructors.push({name:He,test:ve,run:_e})},ot.read=function(){for(var He=arguments.length,ve=new Array(He),_e=0;_e<He;_e++)ve[_e]=arguments[_e];return new Promise(function(pe,fe){(0,T.default)(ot,ve.concat([function(ue,ce){ue?fe(ue):pe(ce)}]))})},ot.create=ot.read,ot.rgbaToInt=function(He,ve,_e,pe,fe){if(typeof He!="number"||typeof ve!="number"||typeof _e!="number"||typeof pe!="number")return W.throwError.call(this,"r, g, b and a must be numbers",fe);if(He<0||He>255)return W.throwError.call(this,"r must be between 0 and 255",fe);if((ve<0||ve>255)&&W.throwError.call(this,"g must be between 0 and 255",fe),_e<0||_e>255)return W.throwError.call(this,"b must be between 0 and 255",fe);if(pe<0||pe>255)return W.throwError.call(this,"a must be between 0 and 255",fe);He=Math.round(He),_e=Math.round(_e),ve=Math.round(ve),pe=Math.round(pe);var ue=He*Math.pow(256,3)+ve*Math.pow(256,2)+_e*Math.pow(256,1)+pe*Math.pow(256,0);return(0,W.isNodePattern)(fe)&&fe.call(this,null,ue),ue},ot.intToRGBA=function(He,ve){if(typeof He!="number")return W.throwError.call(this,"i must be a number",ve);var _e={};return _e.r=Math.floor(He/Math.pow(256,3)),_e.g=Math.floor((He-_e.r*Math.pow(256,3))/Math.pow(256,2)),_e.b=Math.floor((He-_e.r*Math.pow(256,3)-_e.g*Math.pow(256,2))/Math.pow(256,1)),_e.a=Math.floor((He-_e.r*Math.pow(256,3)-_e.g*Math.pow(256,2)-_e.b*Math.pow(256,1))/Math.pow(256,0)),(0,W.isNodePattern)(ve)&&ve.call(this,null,_e),_e},ot.cssColorToHex=function(He){return He=He||0,typeof He=="number"?Number(He):parseInt((0,q.default)(He).toHex8(),16)},ot.limit255=function(He){return He=Math.max(He,0),He=Math.min(He,255),He},ot.diff=function(He,ve){var _e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.1;if(!(He instanceof ot)||!(ve instanceof ot))return W.throwError.call(this,"img1 and img2 must be an Jimp images");var pe=He.bitmap,fe=ve.bitmap;if((pe.width!==fe.width||pe.height!==fe.height)&&(pe.width*pe.height>fe.width*fe.height?He=He.cloneQuiet().resize(fe.width,fe.height):ve=ve.cloneQuiet().resize(pe.width,pe.height)),typeof _e!="number"||_e<0||_e>1)return W.throwError.call(this,"threshold must be a number between 0 and 1");var ue=new ot(pe.width,pe.height,4294967295),ce=(0,J.default)(pe.data,fe.data,ue.bitmap.data,ue.bitmap.width,ue.bitmap.height,{threshold:_e});return{percent:ce/(ue.bitmap.width*ue.bitmap.height),image:ue}},ot.distance=function(He,ve){var _e=new te.default,pe=_e.getHash(He),fe=_e.getHash(ve);return _e.distance(pe,fe)},ot.compareHashes=function(He,ve){var _e=new te.default;return _e.distance(He,ve)},ot.colorDiff=function(He,ve){var _e=function(ce){return Math.pow(ce,2)},pe=Math.max,fe=255*255*3;return He.a!==0&&!He.a&&(He.a=255),ve.a!==0&&!ve.a&&(ve.a=255),(pe(_e(He.r-ve.r),_e(He.r-ve.r-He.a+ve.a))+pe(_e(He.g-ve.g),_e(He.g-ve.g-He.a+ve.a))+pe(_e(He.b-ve.b),_e(He.b-ve.b-He.a+ve.a)))/fe};function et(He,ve,_e){var pe="before-"+ve,fe=ve.replace(/e$/,"")+"ed";ot.prototype[He]=function(){for(var ue,ce=arguments.length,Ee=new Array(ce),Ye=0;Ye<ce;Ye++)Ee[Ye]=arguments[Ye];var ft=Ee[_e.length-1],_t=this;typeof ft=="function"?(ue=function(){for(var Yt=arguments.length,ii=new Array(Yt),zt=0;zt<Yt;zt++)ii[zt]=arguments[zt];var qt=ii[0],Vt=ii[1];qt?_t.emitError(He,qt):_t.emitMulti(He,fe,(0,B.default)({},He,Vt)),ft.apply(this,ii)},Ee[Ee.length-1]=ue):ue=!1,this.emitMulti(He,pe);var It;try{It=_e.apply(this,Ee),ue||this.emitMulti(He,fe,(0,B.default)({},He,It))}catch($t){$t.methodName=He,this.emitError(He,$t)}return It},ot.prototype[He+"Quiet"]=_e}et("clone","clone",function(He){var ve=new ot(this);return(0,W.isNodePattern)(He)&&He.call(ve,null,ve),ve});function Je(He,ve){et(He,"change",ve)}Je("background",function(He,ve){return typeof He!="number"?W.throwError.call(this,"hex must be a hexadecimal rgba value",ve):(this._background=He,(0,W.isNodePattern)(ve)&&ve.call(this,null,this),this)}),Je("scan",function(He,ve,_e,pe,fe,ue){if(typeof He!="number"||typeof ve!="number")return W.throwError.call(this,"x and y must be numbers",ue);if(typeof _e!="number"||typeof pe!="number")return W.throwError.call(this,"w and h must be numbers",ue);if(typeof fe!="function")return W.throwError.call(this,"f must be a function",ue);var ce=(0,W.scan)(this,He,ve,_e,pe,fe);return(0,W.isNodePattern)(ue)&&ue.call(this,null,ce),ce});{var Be;typeof g!="undefined"&&(typeof g=="undefined"?"undefined":(0,U.default)(g))==="object"&&(Be=g),typeof self!="undefined"&&(typeof self=="undefined"?"undefined":(0,U.default)(self))==="object"&&(Be=self),Be.Jimp=ot,Be.Buffer=S}var Ge=ot;E.default=Ge}).call(this,m("buffer").Buffer)},{"./composite":191,"./constants":192,"./modules/phash":194,"./request":195,"./utils/image-bitmap":196,"./utils/mime":197,"./utils/promisify":198,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/construct":5,"@babel/runtime/helpers/createClass":6,"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/getPrototypeOf":9,"@babel/runtime/helpers/inherits":10,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/possibleConstructorReturn":17,"@babel/runtime/helpers/slicedToArray":19,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,"any-base":23,buffer:48,events:52,fs:47,mkdirp:83,path:107,pixelmatch:109,tinycolor2:178}],194:[function(m,x,E){function S(k,P){this.size=this.size||k,this.smallerSize=this.smallerSize||P,T(this.size)}S.prototype.size=32,S.prototype.smallerSize=8,S.prototype.distance=function(k,P){for(var D=0,M=0;M<k.length;M++)k[M]!==P[M]&&D++;return D/k.length},S.prototype.getHash=function(k){k=k.clone().resize(this.size,this.size),k.grayscale();for(var P=[],D=0;D<k.bitmap.width;D++){P[D]=[];for(var M=0;M<k.bitmap.height;M++)P[D][M]=h(k.getPixelColor(D,M)).b}for(var F=A(P,this.size),N=0,B=0;B<this.smallerSize;B++)for(var U=0;U<this.smallerSize;U++)N+=F[B][U];for(var O=N/(this.smallerSize*this.smallerSize),V="",Z=0;Z<this.smallerSize;Z++)for(var W=0;W<this.smallerSize;W++)V+=F[Z][W]>O?"1":"0";return V};function h(k){var P={};return P.r=Math.floor(k/Math.pow(256,3)),P.g=Math.floor((k-P.r*Math.pow(256,3))/Math.pow(256,2)),P.b=Math.floor((k-P.r*Math.pow(256,3)-P.g*Math.pow(256,2))/Math.pow(256,1)),P.a=Math.floor((k-P.r*Math.pow(256,3)-P.g*Math.pow(256,2)-P.b*Math.pow(256,1))/Math.pow(256,0)),P}var I=[];function T(k){for(var P=1;P<k;P++)I[P]=1;I[0]=1/Math.sqrt(2)}function A(k,P){for(var D=P,M=[],F=0;F<D;F++){M[F]=[];for(var N=0;N<D;N++){for(var B=0,U=0;U<D;U++)for(var O=0;O<D;O++)B+=Math.cos((2*U+1)/(2*D)*F*Math.PI)*Math.cos((2*O+1)/(2*D)*N*Math.PI)*k[U][O];B*=I[F]*I[N]/4,M[F][N]=B}}return M}x.exports=S},{}],195:[function(m,x,E){(function(S,h){var I=m("@babel/runtime/helpers/interopRequireDefault"),T=I(m("@babel/runtime/helpers/defineProperty")),A=I(m("@babel/runtime/helpers/extends"));function k(D,M){var F=Object.keys(D);if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(D);M&&(N=N.filter(function(B){return Object.getOwnPropertyDescriptor(D,B).enumerable})),F.push.apply(F,N)}return F}function P(D){for(var M=1;M<arguments.length;M++){var F=arguments[M]!=null?arguments[M]:{};M%2?k(F,!0).forEach(function(N){(0,T.default)(D,N,F[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(F)):k(F).forEach(function(N){Object.defineProperty(D,N,Object.getOwnPropertyDescriptor(F,N))})}return D}S.browser,x.exports=function(D,M){var F=new XMLHttpRequest;F.open("GET",D.url,!0),F.responseType="arraybuffer",F.addEventListener("load",function(){if(F.status<400)try{var N=h.from(this.response);M(null,F,N)}catch(B){return M(new Error("Response is not a buffer for url "+D.url+". Error: "+B.message))}else M(new Error("HTTP Status "+F.status+" for url "+D.url))}),F.addEventListener("error",function(N){M(N)}),F.send()}}).call(this,m("_process"),m("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/extends":8,"@babel/runtime/helpers/interopRequireDefault":11,_process:133,buffer:48,phin:108}],196:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireWildcard"),I=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.parseBitmap=Z,E.getBuffer=Y,E.getBufferAsync=X;var T=I(m("@babel/runtime/helpers/slicedToArray")),A=I(m("file-type")),k=I(m("exif-parser")),P=m("@jimp/utils"),D=h(m("../constants")),M=h(m("./mime")),F=I(m("./promisify"));function N(J,q){var te=(0,A.default)(J);return te?te.mime:q?M.getType(q):null}function B(J){return J._exif&&J._exif.tags&&J._exif.tags.Orientation||1}function U(J){var q=J.getWidth(),te=J.getHeight();switch(B(J)){case 1:return null;case 2:return function(ne,de){return[q-ne-1,de]};case 3:return function(ne,de){return[q-ne-1,te-de-1]};case 4:return function(ne,de){return[ne,te-de-1]};case 5:return function(ne,de){return[de,ne]};case 6:return function(ne,de){return[de,te-ne-1]};case 7:return function(ne,de){return[q-de-1,te-ne-1]};case 8:return function(ne,de){return[q-de-1,ne]};default:return null}}function O(J,q,te,ne){for(var de=J.bitmap.data,oe=J.bitmap.width,we=S.alloc(de.length),Ae=0;Ae<q;Ae++)for(var ye=0;ye<te;ye++){var me=ne(Ae,ye),xe=(0,T.default)(me,2),Le=xe[0],Ze=xe[1],Xe=q*ye+Ae<<2,je=oe*Ze+Le<<2,Ie=de.readUInt32BE(je);we.writeUInt32BE(Ie,Xe)}J.bitmap.data=we,J.bitmap.width=q,J.bitmap.height=te}function V(J){if(!(B(J)<2)){var q=U(J),te=B(J)>4,ne=te?J.bitmap.height:J.bitmap.width,de=te?J.bitmap.width:J.bitmap.height;O(J,ne,de,q)}}function Z(J,q,te){var ne=N(J,q);if(typeof ne!="string")return te(new Error("Could not find MIME for Buffer <"+q+">"));this._originalMime=ne.toLowerCase();try{var de=this.getMIME();if(this.constructor.decoders[de])this.bitmap=this.constructor.decoders[de](J);else return P.throwError.call(this,"Unsupported MIME type: "+de,te)}catch(oe){return te.call(this,oe,this)}try{this._exif=k.default.create(J).parse(),V(this)}catch{}return te.call(this,null,this),this}function W(J,q){return new J(q.bitmap.width,q.bitmap.height,q._background).composite(q,0,0).bitmap}function Y(J,q){if(J===D.AUTO&&(J=this.getMIME()),typeof J!="string")return P.throwError.call(this,"mime must be a string",q);if(typeof q!="function")return P.throwError.call(this,"cb must be a function",q);if(J=J.toLowerCase(),this._rgba&&this.constructor.hasAlpha[J]?this.bitmap.data=S.from(this.bitmap.data):this.bitmap.data=W(this.constructor,this).data,this.constructor.encoders[J]){var te=this.constructor.encoders[J](this);q.call(this,null,te)}else q.call(this,"Unsupported MIME type: "+J);return this}function X(J){return(0,F.default)(Y,this,J)}}).call(this,m("buffer").Buffer)},{"../constants":192,"./mime":197,"./promisify":198,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/slicedToArray":19,"@jimp/utils":235,buffer:48,"exif-parser":53,"file-type":62}],197:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.getExtension=E.getType=E.addType=void 0;var S={},h=function(P){return Object.entries(S).find(function(D){return D[1].includes(P)})||[]},I=function(P,D){S[P]=D};E.addType=I;var T=function(P){var D=P.split("/").slice(-1),M=D[D.length-1].split(".").pop(),F=h(M);return F[0]};E.getType=T;var A=function(P){return(S[P.toLowerCase()]||[])[0]};E.getExtension=A},{}],198:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=function(T,A){for(var k=arguments.length,P=new Array(k>2?k-2:0),D=2;D<k;D++)P[D-2]=arguments[D];return new Promise(function(M,F){P.push(function(N,B){N&&F(N),M(B)}),T.bind(A).apply(void 0,P)})},h=S;E.default=h,x.exports=E.default},{}],199:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireWildcard"),h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=M;var I=h(m("@babel/runtime/helpers/toConsumableArray")),T=h(m("@babel/runtime/helpers/defineProperty")),A=h(m("@babel/runtime/helpers/slicedToArray")),k=S(m("@jimp/core"));function P(F,N){var B=Object.keys(F);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(F);N&&(U=U.filter(function(O){return Object.getOwnPropertyDescriptor(F,O).enumerable})),B.push.apply(B,U)}return B}function D(F){for(var N=1;N<arguments.length;N++){var B=arguments[N]!=null?arguments[N]:{};N%2?P(B,!0).forEach(function(U){(0,T.default)(F,U,B[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(B)):P(B).forEach(function(U){Object.defineProperty(F,U,Object.getOwnPropertyDescriptor(B,U))})}return F}function M(F){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:k.default,B={hasAlpha:{},encoders:{},decoders:{},class:{},constants:{}};function U(Z){Object.entries(Z).forEach(function(W){var Y=(0,A.default)(W,2),X=Y[0],J=Y[1];B[X]=D({},B[X],{},J)})}function O(Z){var W=Z();Array.isArray(W.mime)?k.addType.apply(void 0,(0,I.default)(W.mime)):Object.entries(W.mime).forEach(function(Y){return k.addType.apply(void 0,(0,I.default)(Y))}),delete W.mime,U(W)}function V(Z){var W=Z(k.jimpEvChange)||{};!W.class&&!W.constants?U({class:W}):U(W)}return F.types&&(F.types.forEach(O),N.decoders=D({},N.decoders,{},B.decoders),N.encoders=D({},N.encoders,{},B.encoders),N.hasAlpha=D({},N.hasAlpha,{},B.hasAlpha)),F.plugins&&F.plugins.forEach(V),(0,k.addJimpMethods)(B.class,N),(0,k.addConstants)(B.constants,N),k.default}x.exports=E.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/interopRequireWildcard":12,"@babel/runtime/helpers/slicedToArray":19,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/core":193}],200:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@jimp/custom")),I=S(m("@jimp/types")),T=S(m("@jimp/plugins")),A=(0,h.default)({types:[I.default],plugins:[T.default]});E.default=A,x.exports=E.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/custom":199,"@jimp/plugins":228,"@jimp/types":234}],201:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/typeof")),I=m("@jimp/utils"),T=function(){return{blit:function(P,D,M,F,N,B,U,O){if(!(P instanceof this.constructor))return I.throwError.call(this,"The source must be a Jimp image",O);if(typeof D!="number"||typeof M!="number")return I.throwError.call(this,"x and y must be numbers",O);if(typeof F=="function")O=F,F=0,N=0,B=P.bitmap.width,U=P.bitmap.height;else if((0,h.default)(F)===(0,h.default)(N)&&(0,h.default)(N)===(0,h.default)(B)&&(0,h.default)(B)===(0,h.default)(U))F=F||0,N=N||0,B=B||P.bitmap.width,U=U||P.bitmap.height;else return I.throwError.call(this,"srcx, srcy, srcw, srch must be numbers",O);D=Math.round(D),M=Math.round(M),F=Math.round(F),N=Math.round(N),B=Math.round(B),U=Math.round(U);var V=this.bitmap.width,Z=this.bitmap.height,W=this;return P.scanQuiet(F,N,B,U,function(Y,X,J){var q=D+Y-F,te=M+X-N;if(q>=0&&te>=0&&V-q>0&&Z-te>0){var ne=W.getPixelIndex(q,te),de={r:this.bitmap.data[J],g:this.bitmap.data[J+1],b:this.bitmap.data[J+2],a:this.bitmap.data[J+3]},oe={r:W.bitmap.data[ne],g:W.bitmap.data[ne+1],b:W.bitmap.data[ne+2],a:W.bitmap.data[ne+3]};W.bitmap.data[ne]=(de.a*(de.r-oe.r)-oe.r+255>>8)+oe.r,W.bitmap.data[ne+1]=(de.a*(de.g-oe.g)-oe.g+255>>8)+oe.g,W.bitmap.data[ne+2]=(de.a*(de.b-oe.b)-oe.b+255>>8)+oe.b,W.bitmap.data[ne+3]=this.constructor.limit255(oe.a+de.a)}}),(0,I.isNodePattern)(O)&&O.call(this,null,this),this}}};E.default=T,x.exports=E.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235}],202:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.shgTable=E.mulTable=void 0;var S=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];E.mulTable=S;var h=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];E.shgTable=h},{}],203:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=m("./blur-tables"),I=function(){return{blur:function(k,P){if(typeof k!="number")return S.throwError.call(this,"r must be a number",P);if(k<1)return S.throwError.call(this,"r must be greater than 0",P);for(var D,M,F,N,B,U,O,V,Z,W,Y,X,J,q,te=this.bitmap.width-1,ne=this.bitmap.height-1,de=k+1,oe=h.mulTable[k],we=h.shgTable[k],Ae=[],ye=[],me=[],xe=[],Le=[],Ze=[],Xe=2;Xe-- >0;){for(X=0,J=0,U=0;U<this.bitmap.height;U++){for(D=this.bitmap.data[J]*de,M=this.bitmap.data[J+1]*de,F=this.bitmap.data[J+2]*de,N=this.bitmap.data[J+3]*de,O=1;O<=k;O++)V=J+((O>te?te:O)<<2),D+=this.bitmap.data[V++],M+=this.bitmap.data[V++],F+=this.bitmap.data[V++],N+=this.bitmap.data[V];for(B=0;B<this.bitmap.width;B++)Ae[X]=D,ye[X]=M,me[X]=F,xe[X]=N,U===0&&(Le[B]=((V=B+de)<te?V:te)<<2,Ze[B]=(V=B-k)>0?V<<2:0),Z=J+Le[B],W=J+Ze[B],D+=this.bitmap.data[Z++]-this.bitmap.data[W++],M+=this.bitmap.data[Z++]-this.bitmap.data[W++],F+=this.bitmap.data[Z++]-this.bitmap.data[W++],N+=this.bitmap.data[Z]-this.bitmap.data[W],X++;J+=this.bitmap.width<<2}for(B=0;B<this.bitmap.width;B++){for(Y=B,D=Ae[Y]*de,M=ye[Y]*de,F=me[Y]*de,N=xe[Y]*de,O=1;O<=k;O++)Y+=O>ne?0:this.bitmap.width,D+=Ae[Y],M+=ye[Y],F+=me[Y],N+=xe[Y];for(X=B<<2,U=0;U<this.bitmap.height;U++)q=N*oe>>>we,this.bitmap.data[X+3]=q,q>255&&(this.bitmap.data[X+3]=255),q>0?(q=255/q,this.bitmap.data[X]=(D*oe>>>we)*q,this.bitmap.data[X+1]=(M*oe>>>we)*q,this.bitmap.data[X+2]=(F*oe>>>we)*q):(this.bitmap.data[X+2]=0,this.bitmap.data[X+1]=0,this.bitmap.data[X]=0),B===0&&(Le[U]=((V=U+de)<ne?V:ne)*this.bitmap.width,Ze[U]=(V=U-k)>0?V*this.bitmap.width:0),Z=B+Le[U],W=B+Ze[U],D+=Ae[Z]-Ae[W],M+=ye[Z]-ye[W],F+=me[Z]-me[W],N+=xe[Z]-xe[W],X+=this.bitmap.width<<2}}return(0,S.isNodePattern)(P)&&P.call(this,null,this),this}}};E.default=I,x.exports=E.default},{"./blur-tables":202,"@jimp/utils":235}],204:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{circle:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;typeof A=="function"&&(k=A,A={});var P=A.radius||(this.bitmap.width>this.bitmap.height?this.bitmap.height:this.bitmap.width)/2,D={x:typeof A.x=="number"?A.x:this.bitmap.width/2,y:typeof A.y=="number"?A.y:this.bitmap.height/2};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(M,F,N){var B=Math.sqrt(Math.pow(M-D.x,2)+Math.pow(F-D.y,2));P-B<=0?this.bitmap.data[N+3]=0:P-B<1&&(this.bitmap.data[N+3]=255*(P-B))}),(0,S.isNodePattern)(k)&&k.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],205:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var I=h(m("@babel/runtime/helpers/toConsumableArray")),T=h(m("tinycolor2")),A=m("@jimp/utils");function k(B,U,O,V){for(var Z=[0,0,0],W=(U.length-1)/2,Y=0;Y<U.length;Y+=1)for(var X=0;X<U[Y].length;X+=1){var J=B.getPixelIndex(O+Y-W,V+X-W);Z[0]+=B.bitmap.data[J]*U[Y][X],Z[1]+=B.bitmap.data[J+1]*U[Y][X],Z[2]+=B.bitmap.data[J+2]*U[Y][X]}return Z}var P=function(U){return typeof U!="undefined"&&U!==null};function D(B){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,O,V){var Z=parseInt(.2126*this.bitmap.data[V]+.7152*this.bitmap.data[V+1]+.0722*this.bitmap.data[V+2],10);this.bitmap.data[V]=Z,this.bitmap.data[V+1]=Z,this.bitmap.data[V+2]=Z}),(0,A.isNodePattern)(B)&&B.call(this,null,this),this}function M(B,U){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:50;return{r:(U.r-B.r)*(O/100)+B.r,g:(U.g-B.g)*(O/100)+B.g,b:(U.b-B.b)*(O/100)+B.b}}function F(B,U){var O=this;return!B||!Array.isArray(B)?A.throwError.call(this,"actions must be an array",U):(B=B.map(function(V){return(V.apply==="xor"||V.apply==="mix")&&(V.params[0]=(0,T.default)(V.params[0]).toRgb()),V}),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(V,Z,W){var Y={r:O.bitmap.data[W],g:O.bitmap.data[W+1],b:O.bitmap.data[W+2]},X=function(q,te){return O.constructor.limit255(Y[q]+te)};B.forEach(function(J){if(J.apply==="mix")Y=M(Y,J.params[0],J.params[1]);else if(J.apply==="tint")Y=M(Y,{r:255,g:255,b:255},J.params[0]);else if(J.apply==="shade")Y=M(Y,{r:0,g:0,b:0},J.params[0]);else if(J.apply==="xor")Y={r:Y.r^J.params[0].r,g:Y.g^J.params[0].g,b:Y.b^J.params[0].b};else if(J.apply==="red")Y.r=X("r",J.params[0]);else if(J.apply==="green")Y.g=X("g",J.params[0]);else if(J.apply==="blue")Y.b=X("b",J.params[0]);else{var q;if(J.apply==="hue"&&(J.apply="spin"),Y=(0,T.default)(Y),!Y[J.apply])return A.throwError.call(O,"action "+J.apply+" not supported",U);Y=(q=Y)[J.apply].apply(q,(0,I.default)(J.params)).toRgb()}}),O.bitmap.data[W]=Y.r,O.bitmap.data[W+1]=Y.g,O.bitmap.data[W+2]=Y.b}),(0,A.isNodePattern)(U)&&U.call(this,null,this),this)}var N=function(){return{brightness:function(O,V){return typeof O!="number"?A.throwError.call(this,"val must be numbers",V):O<-1||O>1?A.throwError.call(this,"val must be a number between -1 and +1",V):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Z,W,Y){O<0?(this.bitmap.data[Y]=this.bitmap.data[Y]*(1+O),this.bitmap.data[Y+1]=this.bitmap.data[Y+1]*(1+O),this.bitmap.data[Y+2]=this.bitmap.data[Y+2]*(1+O)):(this.bitmap.data[Y]=this.bitmap.data[Y]+(255-this.bitmap.data[Y])*O,this.bitmap.data[Y+1]=this.bitmap.data[Y+1]+(255-this.bitmap.data[Y+1])*O,this.bitmap.data[Y+2]=this.bitmap.data[Y+2]+(255-this.bitmap.data[Y+2])*O)}),(0,A.isNodePattern)(V)&&V.call(this,null,this),this)},contrast:function(O,V){if(typeof O!="number")return A.throwError.call(this,"val must be numbers",V);if(O<-1||O>1)return A.throwError.call(this,"val must be a number between -1 and +1",V);var Z=(O+1)/(1-O);function W(Y){return Y=Math.floor(Z*(Y-127)+127),Y<0?0:Y>255?255:Y}return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Y,X,J){this.bitmap.data[J]=W(this.bitmap.data[J]),this.bitmap.data[J+1]=W(this.bitmap.data[J+1]),this.bitmap.data[J+2]=W(this.bitmap.data[J+2])}),(0,A.isNodePattern)(V)&&V.call(this,null,this),this},posterize:function(O,V){return typeof O!="number"?A.throwError.call(this,"n must be numbers",V):(O<2&&(O=2),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Z,W,Y){this.bitmap.data[Y]=Math.floor(this.bitmap.data[Y]/255*(O-1))/(O-1)*255,this.bitmap.data[Y+1]=Math.floor(this.bitmap.data[Y+1]/255*(O-1))/(O-1)*255,this.bitmap.data[Y+2]=Math.floor(this.bitmap.data[Y+2]/255*(O-1))/(O-1)*255}),(0,A.isNodePattern)(V)&&V.call(this,null,this),this)},greyscale:D,grayscale:D,opacity:function(O,V){return typeof O!="number"?A.throwError.call(this,"f must be a number",V):O<0||O>1?A.throwError.call(this,"f must be a number from 0 to 1",V):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Z,W,Y){var X=this.bitmap.data[Y+3]*O;this.bitmap.data[Y+3]=X}),(0,A.isNodePattern)(V)&&V.call(this,null,this),this)},sepia:function(O){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(V,Z,W){var Y=this.bitmap.data[W],X=this.bitmap.data[W+1],J=this.bitmap.data[W+2];Y=Y*.393+X*.769+J*.189,X=Y*.349+X*.686+J*.168,J=Y*.272+X*.534+J*.131,this.bitmap.data[W]=Y<255?Y:255,this.bitmap.data[W+1]=X<255?X:255,this.bitmap.data[W+2]=J<255?J:255}),(0,A.isNodePattern)(O)&&O.call(this,null,this),this},fade:function(O,V){return typeof O!="number"?A.throwError.call(this,"f must be a number",V):O<0||O>1?A.throwError.call(this,"f must be a number from 0 to 1",V):(this.opacity(1-O),(0,A.isNodePattern)(V)&&V.call(this,null,this),this)},convolution:function(O,V,Z){typeof V=="function"&&typeof Z=="undefined"&&(Z=V,V=null),V||(V=this.constructor.EDGE_EXTEND);var W=S.from(this.bitmap.data),Y=O.length,X=O[0].length,J=Math.floor(Y/2),q=Math.floor(X/2),te=-J,ne=-q,de,oe,we,Ae,ye,me,xe,Le,Ze,Xe;return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(je,Ie,Pe){Ae=0,we=0,oe=0;for(var De=te;De<=J;De++)for(var ze=ne;ze<=q;ze++)Le=je+ze,Ze=Ie+De,de=O[De+J][ze+q],Xe=this.getPixelIndex(Le,Ze,V),Xe===-1?(xe=0,me=0,ye=0):(ye=this.bitmap.data[Xe+0],me=this.bitmap.data[Xe+1],xe=this.bitmap.data[Xe+2]),oe+=de*ye,we+=de*me,Ae+=de*xe;oe<0&&(oe=0),we<0&&(we=0),Ae<0&&(Ae=0),oe>255&&(oe=255),we>255&&(we=255),Ae>255&&(Ae=255),W[Pe+0]=oe,W[Pe+1]=we,W[Pe+2]=Ae}),this.bitmap.data=W,(0,A.isNodePattern)(Z)&&Z.call(this,null,this),this},opaque:function(O){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(V,Z,W){this.bitmap.data[W+3]=255}),(0,A.isNodePattern)(O)&&O.call(this,null,this),this},pixelate:function(O,V,Z,W,Y,X){if(typeof V=="function")X=V,Y=null,W=null,Z=null,V=null;else{if(typeof O!="number")return A.throwError.call(this,"size must be a number",X);if(P(V)&&typeof V!="number")return A.throwError.call(this,"x must be a number",X);if(P(Z)&&typeof Z!="number")return A.throwError.call(this,"y must be a number",X);if(P(W)&&typeof W!="number")return A.throwError.call(this,"w must be a number",X);if(P(Y)&&typeof Y!="number")return A.throwError.call(this,"h must be a number",X)}var J=[[1/16,2/16,1/16],[2/16,4/16,2/16],[1/16,2/16,1/16]];V=V||0,Z=Z||0,W=P(W)?W:this.bitmap.width-V,Y=P(Y)?Y:this.bitmap.height-Z;var q=this.cloneQuiet();return this.scanQuiet(V,Z,W,Y,function(te,ne,de){te=O*Math.floor(te/O),ne=O*Math.floor(ne/O);var oe=k(q,J,te,ne);this.bitmap.data[de]=oe[0],this.bitmap.data[de+1]=oe[1],this.bitmap.data[de+2]=oe[2]}),(0,A.isNodePattern)(X)&&X.call(this,null,this),this},convolute:function(O,V,Z,W,Y,X){if(!Array.isArray(O))return A.throwError.call(this,"the kernel must be an array",X);if(typeof V=="function")X=V,V=null,Z=null,W=null,Y=null;else{if(P(V)&&typeof V!="number")return A.throwError.call(this,"x must be a number",X);if(P(Z)&&typeof Z!="number")return A.throwError.call(this,"y must be a number",X);if(P(W)&&typeof W!="number")return A.throwError.call(this,"w must be a number",X);if(P(Y)&&typeof Y!="number")return A.throwError.call(this,"h must be a number",X)}var J=(O.length-1)/2;V=P(V)?V:J,Z=P(Z)?Z:J,W=P(W)?W:this.bitmap.width-V,Y=P(Y)?Y:this.bitmap.height-Z;var q=this.cloneQuiet();return this.scanQuiet(V,Z,W,Y,function(te,ne,de){var oe=k(q,O,te,ne);this.bitmap.data[de]=this.constructor.limit255(oe[0]),this.bitmap.data[de+1]=this.constructor.limit255(oe[1]),this.bitmap.data[de+2]=this.constructor.limit255(oe[2])}),(0,A.isNodePattern)(X)&&X.call(this,null,this),this},color:F,colour:F}};E.default=N,x.exports=E.default}).call(this,m("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/utils":235,buffer:48,tinycolor2:178}],206:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{contain:function(A,k,P,D,M){if(typeof A!="number"||typeof k!="number")return S.throwError.call(this,"w and h must be numbers",M);typeof P=="string"&&(typeof D=="function"&&typeof M=="undefined"&&(M=D),D=P,P=null),typeof P=="function"&&(typeof M=="undefined"&&(M=P),D=null,P=null),typeof D=="function"&&typeof M=="undefined"&&(M=D,D=null),P=P||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;var F=P&(1<<3)-1,N=P>>3;if(!(F!==0&&!(F&F-1)||N!==0&&!(N&N-1)))return S.throwError.call(this,"only use one flag per alignment direction",M);var B=F>>1,U=N>>1,O=A/k>this.bitmap.width/this.bitmap.height?k/this.bitmap.height:A/this.bitmap.width,V=this.cloneQuiet().scale(O,D);return this.resize(A,k,D),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(Z,W,Y){this.bitmap.data.writeUInt32BE(this._background,Y)}),this.blit(V,(this.bitmap.width-V.bitmap.width)/2*B,(this.bitmap.height-V.bitmap.height)/2*U),(0,S.isNodePattern)(M)&&M.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],207:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{cover:function(A,k,P,D,M){if(typeof A!="number"||typeof k!="number")return S.throwError.call(this,"w and h must be numbers",M);P&&typeof P=="function"&&typeof M=="undefined"?(M=P,P=null,D=null):typeof D=="function"&&typeof M=="undefined"&&(M=D,D=null),P=P||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;var F=P&(1<<3)-1,N=P>>3;if(!(F!==0&&!(F&F-1)||N!==0&&!(N&N-1)))return S.throwError.call(this,"only use one flag per alignment direction",M);var B=F>>1,U=N>>1,O=A/k>this.bitmap.width/this.bitmap.height?A/this.bitmap.width:k/this.bitmap.height;return this.scale(O,D),this.crop((this.bitmap.width-A)/2*B,(this.bitmap.height-k)/2*U,A,k),(0,S.isNodePattern)(M)&&M.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],208:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=A;var I=h(m("@babel/runtime/helpers/typeof")),T=m("@jimp/utils");function A(k){return k("crop",function(P,D,M,F,N){if(typeof P!="number"||typeof D!="number")return T.throwError.call(this,"x and y must be numbers",N);if(typeof M!="number"||typeof F!="number")return T.throwError.call(this,"w and h must be numbers",N);if(P=Math.round(P),D=Math.round(D),M=Math.round(M),F=Math.round(F),P===0&&M===this.bitmap.width){var B=M*D+P<<2,U=B+F*M<<2;this.bitmap.data=this.bitmap.data.slice(B,U)}else{var O=S.allocUnsafe(M*F*4),V=0;this.scanQuiet(P,D,M,F,function(Z,W,Y){var X=this.bitmap.data.readUInt32BE(Y,!0);O.writeUInt32BE(X,V,!0),V+=4}),this.bitmap.data=O}return this.bitmap.width=M,this.bitmap.height=F,(0,T.isNodePattern)(N)&&N.call(this,null,this),this}),{class:{autocrop:function(){for(var D=this.bitmap.width,M=this.bitmap.height,F=1,N,B=0,U=2e-4,O=!0,V=!1,Z={north:!1,south:!1,east:!1,west:!1},W=arguments.length,Y=new Array(W),X=0;X<W;X++)Y[X]=arguments[X];for(var J=0,q=Y.length;J<q;J++)if(typeof Y[J]=="number"&&(U=Y[J]),typeof Y[J]=="boolean"&&(O=Y[J]),typeof Y[J]=="function"&&(N=Y[J]),(0,I.default)(Y[J])==="object"){var te=Y[J];typeof te.tolerance!="undefined"&&(U=te.tolerance),typeof te.cropOnlyFrames!="undefined"&&(O=te.cropOnlyFrames),typeof te.cropSymmetric!="undefined"&&(V=te.cropSymmetric),typeof te.leaveBorder!="undefined"&&(B=te.leaveBorder),typeof te.ignoreSides!="undefined"&&(Z=te.ignoreSides)}var ne=this.getPixelColor(0,0),de=this.constructor.intToRGBA(ne),oe=0,we=0,Ae=0,ye=0;if(ne=this.getPixelColor(0,0),!Z.north){e:for(var me=0;me<M-F;me++){for(var xe=0;xe<D;xe++){var Le=this.getPixelColor(xe,me),Ze=this.constructor.intToRGBA(Le);if(this.constructor.colorDiff(de,Ze)>U)break e}oe++}}if(ne=this.getPixelColor(D,0),!Z.east){e:for(var Xe=0;Xe<D-F;Xe++){for(var je=0+oe;je<M;je++){var Ie=this.getPixelColor(Xe,je),Pe=this.constructor.intToRGBA(Ie);if(this.constructor.colorDiff(de,Pe)>U)break e}we++}}if(ne=this.getPixelColor(0,M),!Z.south){e:for(var De=M-1;De>=oe+F;De--){for(var ze=D-we-1;ze>=0;ze--){var it=this.getPixelColor(ze,De),tt=this.constructor.intToRGBA(it);if(this.constructor.colorDiff(de,tt)>U)break e}Ae++}}if(ne=this.getPixelColor(D,M),!Z.west){e:for(var ot=D-1;ot>=0+we+F;ot--){for(var lt=M-1;lt>=0+oe;lt--){var St=this.getPixelColor(ot,lt),et=this.constructor.intToRGBA(St);if(this.constructor.colorDiff(de,et)>U)break e}ye++}}var Je=!1;if(ye-=B,we-=B,oe-=B,Ae-=B,V){var Be=Math.min(we,ye),Ge=Math.min(oe,Ae);ye=Be,we=Be,oe=Ge,Ae=Ge}ye=ye>=0?ye:0,we=we>=0?we:0,oe=oe>=0?oe:0,Ae=Ae>=0?Ae:0;var He=D-(ye+we),ve=M-(Ae+oe);return O?Je=we!==0&&oe!==0&&ye!==0&&Ae!==0:Je=we!==0||oe!==0||ye!==0||Ae!==0,Je&&this.crop(we,oe,He,ve),(0,T.isNodePattern)(N)&&N.call(this,null,this),this}}}}x.exports=E.default}).call(this,m("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,buffer:48}],209:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/typeof")),I=m("@jimp/utils"),T=function(){return{displace:function(P,D,M){if((0,h.default)(P)!=="object"||P.constructor!==this.constructor)return I.throwError.call(this,"The source must be a Jimp image",M);if(typeof D!="number")return I.throwError.call(this,"factor must be a number",M);var F=this.cloneQuiet();return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(N,B,U){var O=P.bitmap.data[U]/256*D;O=Math.round(O);var V=this.getPixelIndex(N+O,B);this.bitmap.data[V]=F.bitmap.data[U],this.bitmap.data[V+1]=F.bitmap.data[U+1],this.bitmap.data[V+2]=F.bitmap.data[U+2]}),(0,I.isNodePattern)(M)&&M.call(this,null,this),this}}};E.default=T,x.exports=E.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235}],210:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils");function h(T){var A=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(k,P,D){var M=((P&3)<<2)+k%4,F=A[M];this.bitmap.data[D]=Math.min(this.bitmap.data[D]+F,255),this.bitmap.data[D+1]=Math.min(this.bitmap.data[D+1]+F,255),this.bitmap.data[D+2]=Math.min(this.bitmap.data[D+2]+F,255)}),(0,S.isNodePattern)(T)&&T.call(this,null,this),this}var I=function(){return{dither565:h,dither16:h}};E.default=I,x.exports=E.default},{"@jimp/utils":235}],211:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{fisheye:function(){var A=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{r:2.5},P=arguments.length>1?arguments[1]:void 0;typeof k=="function"&&(P=k,k={r:2.5});var D=this.cloneQuiet(),M=D.bitmap,F=M.width,N=M.height;return D.scanQuiet(0,0,F,N,function(B,U){var O=B/F,V=U/N,Z=Math.sqrt(Math.pow(O-.5,2)+Math.pow(V-.5,2)),W=2*Math.pow(Z,k.r),Y=(O-.5)/Z,X=(V-.5)/Z,J=Math.round((W*Y+.5)*F),q=Math.round((W*X+.5)*N),te=D.getPixelColor(J,q);A.setPixelColor(te,B,U)}),this.setPixelColor(D.getPixelColor(F/2,N/2),F/2,N/2),(0,S.isNodePattern)(P)&&P.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],212:[function(m,x,E){(function(S){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=m("@jimp/utils");function I(A,k,P){if(typeof A!="boolean"||typeof k!="boolean")return h.throwError.call(this,"horizontal and vertical must be Booleans",P);var D=S.alloc(this.bitmap.data.length);return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(M,F,N){var B=A?this.bitmap.width-1-M:M,U=k?this.bitmap.height-1-F:F,O=this.bitmap.width*U+B<<2,V=this.bitmap.data.readUInt32BE(N);D.writeUInt32BE(V,O)}),this.bitmap.data=S.from(D),(0,h.isNodePattern)(P)&&P.call(this,null,this),this}var T=function(){return{flip:I,mirror:I}};E.default=T,x.exports=E.default}).call(this,m("buffer").Buffer)},{"@jimp/utils":235,buffer:48}],213:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{gaussian:function(A,k){if(typeof A!="number")return S.throwError.call(this,"r must be a number",k);if(A<1)return S.throwError.call(this,"r must be greater than 0",k);for(var P=Math.ceil(A*2.57),D=P*2+1,M=A*A*2,F=M*Math.PI,N=[],B=0;B<D;B++){N[B]=[];for(var U=0;U<D;U++){var O=Math.pow(U-P,2)+Math.pow(B-P,2);N[B][U]=Math.exp(-O/M)/F}}for(var V=0;V<this.bitmap.height;V++)for(var Z=0;Z<this.bitmap.width;Z++)for(var W=0,Y=0,X=0,J=0,q=0,te=0;te<D;te++){for(var ne=0;ne<D;ne++){var de=Math.min(this.bitmap.width-1,Math.max(0,ne+Z-P)),oe=Math.min(this.bitmap.height-1,Math.max(0,te+V-P)),we=N[te][ne],Ae=oe*this.bitmap.width+de<<2;W+=this.bitmap.data[Ae]*we,Y+=this.bitmap.data[Ae+1]*we,X+=this.bitmap.data[Ae+2]*we,J+=this.bitmap.data[Ae+3]*we,q+=we}var ye=V*this.bitmap.width+Z<<2;this.bitmap.data[ye]=Math.round(W/q),this.bitmap.data[ye+1]=Math.round(Y/q),this.bitmap.data[ye+2]=Math.round(X/q),this.bitmap.data[ye+3]=Math.round(J/q)}return(0,S.isNodePattern)(k)&&k.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],214:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{invert:function(A){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(k,P,D){this.bitmap.data[D]=255-this.bitmap.data[D],this.bitmap.data[D+1]=255-this.bitmap.data[D+1],this.bitmap.data[D+2]=255-this.bitmap.data[D+2]}),(0,S.isNodePattern)(A)&&A.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],215:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{mask:function(A){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,D=arguments.length>3?arguments[3]:void 0;if(!(A instanceof this.constructor))return S.throwError.call(this,"The source must be a Jimp image",D);if(typeof k!="number"||typeof P!="number")return S.throwError.call(this,"x and y must be numbers",D);k=Math.round(k),P=Math.round(P);var M=this.bitmap.width,F=this.bitmap.height,N=this;return A.scanQuiet(0,0,A.bitmap.width,A.bitmap.height,function(B,U,O){var V=k+B,Z=P+U;if(V>=0&&Z>=0&&V<M&&Z<F){var W=N.getPixelIndex(V,Z),Y=this.bitmap.data,X=(Y[O+0]+Y[O+1]+Y[O+2])/3;N.bitmap.data[W+3]*=X/255}}),(0,S.isNodePattern)(D)&&D.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],216:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils");function h(){var k={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(P,D,M){k.r[this.bitmap.data[M+0]]++,k.g[this.bitmap.data[M+1]]++,k.b[this.bitmap.data[M+2]]++}),k}var I=function(P,D,M){return(P-D)*255/(M-D)},T=function(P){return[P.findIndex(function(D){return D>0}),255-P.slice().reverse().findIndex(function(D){return D>0})]},A=function(){return{normalize:function(D){var M=h.call(this),F={r:T(M.r),g:T(M.g),b:T(M.b)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(N,B,U){var O=this.bitmap.data[U+0],V=this.bitmap.data[U+1],Z=this.bitmap.data[U+2];this.bitmap.data[U+0]=I(O,F.r[0],F.r[1]),this.bitmap.data[U+1]=I(V,F.g[0],F.g[1]),this.bitmap.data[U+2]=I(Z,F.b[0],F.b[1])}),(0,S.isNodePattern)(D)&&D.call(this,null,this),this}}};E.default=A,x.exports=E.default},{"@jimp/utils":235}],217:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var I=h(m("@babel/runtime/helpers/typeof")),T=h(m("@babel/runtime/helpers/toConsumableArray")),A=h(m("path")),k=h(m("load-bmfont")),P=m("@jimp/utils"),D=m("./measure-text");function M(Z,W,Y,X,J){return J===Z.HORIZONTAL_ALIGN_LEFT?0:J===Z.HORIZONTAL_ALIGN_CENTER?(X-(0,D.measureText)(W,Y))/2:X-(0,D.measureText)(W,Y)}function F(Z,W,Y,X,J){if(J.width>0&&J.height>0){var q=W.pages[J.page];Z.blit(q,Y+J.xoffset,X+J.yoffset,J.x,J.y,J.width,J.height)}return Z}function N(Z,W,Y,X,J){for(var q=0;q<X.length;q++){var te=void 0;Z.chars[X[q]]?te=X[q]:/\s/.test(X[q])?te="":te="?";var ne=Z.chars[te]||{},de=Z.kernings[te];F(this,Z,W,Y,ne||{});var oe=de&&de[X[q+1]]?de[X[q+1]]:0;W+=oe+(ne.xadvance||J)}}function B(Z,W,Y){var X=W.split(" "),J=[],q=[],te=0;return X.forEach(function(ne){var de=[].concat((0,T.default)(q),[ne]).join(" "),oe=(0,D.measureText)(Z,de);oe<=Y?(oe>te&&(te=oe),q.push(ne)):(J.push(q),q=[ne])}),J.push(q),{lines:J,longestLine:te}}function U(Z,W,Y){var X=Y.map(function(J){return Z.read(W+"/"+J)});return Promise.all(X)}var O="browser/lib/",V=function(){return{constants:{measureText:D.measureText,measureTextHeight:D.measureTextHeight,FONT_SANS_8_BLACK:A.default.join(O,"fonts/open-sans/open-sans-8-black/open-sans-8-black.fnt"),FONT_SANS_10_BLACK:A.default.join(O,"fonts/open-sans/open-sans-10-black/open-sans-10-black.fnt"),FONT_SANS_12_BLACK:A.default.join(O,"fonts/open-sans/open-sans-12-black/open-sans-12-black.fnt"),FONT_SANS_14_BLACK:A.default.join(O,"fonts/open-sans/open-sans-14-black/open-sans-14-black.fnt"),FONT_SANS_16_BLACK:A.default.join(O,"fonts/open-sans/open-sans-16-black/open-sans-16-black.fnt"),FONT_SANS_32_BLACK:A.default.join(O,"fonts/open-sans/open-sans-32-black/open-sans-32-black.fnt"),FONT_SANS_64_BLACK:A.default.join(O,"fonts/open-sans/open-sans-64-black/open-sans-64-black.fnt"),FONT_SANS_128_BLACK:A.default.join(O,"fonts/open-sans/open-sans-128-black/open-sans-128-black.fnt"),FONT_SANS_8_WHITE:A.default.join(O,"fonts/open-sans/open-sans-8-white/open-sans-8-white.fnt"),FONT_SANS_16_WHITE:A.default.join(O,"fonts/open-sans/open-sans-16-white/open-sans-16-white.fnt"),FONT_SANS_32_WHITE:A.default.join(O,"fonts/open-sans/open-sans-32-white/open-sans-32-white.fnt"),FONT_SANS_64_WHITE:A.default.join(O,"fonts/open-sans/open-sans-64-white/open-sans-64-white.fnt"),FONT_SANS_128_WHITE:A.default.join(O,"fonts/open-sans/open-sans-128-white/open-sans-128-white.fnt"),loadFont:function(Y,X){var J=this;return typeof Y!="string"?P.throwError.call(this,"file must be a string",X):new Promise(function(q,te){X=X||function(ne,de){ne?te(ne):q(de)},(0,k.default)(Y,function(ne,de){var oe={},we={};if(ne)return P.throwError.call(J,ne,X);for(var Ae=0;Ae<de.chars.length;Ae++)oe[String.fromCharCode(de.chars[Ae].id)]=de.chars[Ae];for(var ye=0;ye<de.kernings.length;ye++){var me=String.fromCharCode(de.kernings[ye].first);we[me]=we[me]||{},we[me][String.fromCharCode(de.kernings[ye].second)]=de.kernings[ye].amount}U(J,A.default.dirname(Y),de.pages).then(function(xe){X(null,{chars:oe,kernings:we,pages:xe,common:de.common,info:de.info})})})})}},class:{print:function(Y,X,J,q,te,ne,de){var oe=this;if(typeof te=="function"&&typeof de=="undefined"&&(de=te,te=1/0),typeof te=="undefined"&&(te=1/0),typeof ne=="function"&&typeof de=="undefined"&&(de=ne,ne=1/0),typeof ne=="undefined"&&(ne=1/0),(0,I.default)(Y)!=="object")return P.throwError.call(this,"font must be a Jimp loadFont",de);if(typeof X!="number"||typeof J!="number"||typeof te!="number")return P.throwError.call(this,"x, y and maxWidth must be numbers",de);if(typeof te!="number")return P.throwError.call(this,"maxWidth must be a number",de);if(typeof ne!="number")return P.throwError.call(this,"maxHeight must be a number",de);var we,Ae;if((0,I.default)(q)==="object"&&q.text!==null&&q.text!==void 0){we=q.alignmentX||this.constructor.HORIZONTAL_ALIGN_LEFT,Ae=q.alignmentY||this.constructor.VERTICAL_ALIGN_TOP;var ye=q;q=ye.text}else we=this.constructor.HORIZONTAL_ALIGN_LEFT,Ae=this.constructor.VERTICAL_ALIGN_TOP,q=q.toString();ne!==1/0&&Ae===this.constructor.VERTICAL_ALIGN_BOTTOM?J+=ne-(0,D.measureTextHeight)(Y,q,te):ne!==1/0&&Ae===this.constructor.VERTICAL_ALIGN_MIDDLE&&(J+=ne/2-(0,D.measureTextHeight)(Y,q,te)/2);var me=Object.entries(Y.chars)[0][1].xadvance,xe=B(Y,q,te),Le=xe.lines,Ze=xe.longestLine;return Le.forEach(function(Xe){var je=Xe.join(" "),Ie=M(oe.constructor,Y,je,te,we);N.call(oe,Y,X+Ie,J,je,me),J+=Y.common.lineHeight}),(0,P.isNodePattern)(de)&&de.call(this,null,this,{x:X+Ze,y:J}),this}}}};E.default=V,x.exports=E.default}).call(this,"/../../node_modules/@jimp/plugin-print/dist")},{"./measure-text":218,"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@babel/runtime/helpers/typeof":21,"@jimp/utils":235,"load-bmfont":219,path:107}],218:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.measureText=S,E.measureTextHeight=h;function S(I,T){for(var A=0,k=0;k<T.length;k++)if(I.chars[T[k]]){var P=I.kernings[T[k]]&&I.kernings[T[k]][T[k+1]]?I.kernings[T[k]][T[k+1]]:0;A+=(I.chars[T[k]].xadvance||0)+P}return A}function h(I,T,A){for(var k=T.split(" "),P="",D=I.common.lineHeight,M=0;M<k.length;M++){var F=P+k[M]+" ",N=S(I,F);N>A&&M>0?(D+=I.common.lineHeight,P=k[M]+" "):P=F}return D}},{}],219:[function(m,x,E){(function(S){var h=m("xhr"),I=function(){},T=m("parse-bmfont-ascii"),A=m("parse-bmfont-xml"),k=m("parse-bmfont-binary"),P=m("./lib/is-binary"),D=m("xtend"),M=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();x.exports=function(B,U){U=typeof U=="function"?U:I,typeof B=="string"?B={uri:B}:B||(B={});var O=B.binary;O&&(B=N(B)),h(B,function(V,Z,W){if(V)return U(V);if(!/^2/.test(Z.statusCode))return U(new Error("http status code: "+Z.statusCode));if(!W)return U(new Error("no body result"));var Y=!1;if(F(W)){var X=new Uint8Array(W);W=new S(X,"binary")}P(W)&&(Y=!0,typeof W=="string"&&(W=new S(W,"binary"))),Y||(S.isBuffer(W)&&(W=W.toString(B.encoding)),W=W.trim());var J;try{var q=Z.headers["content-type"];Y?J=k(W):/json/.test(q)||W.charAt(0)==="{"?J=JSON.parse(W):/xml/.test(q)||W.charAt(0)==="<"?J=A(W):J=T(W)}catch(te){U(new Error("error parsing font "+te.message)),U=I}U(null,J)})};function F(B){var U=Object.prototype.toString;return U.call(B)==="[object ArrayBuffer]"}function N(B){if(M)return D(B,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest=="undefined")throw new Error("your browser does not support XHR loading");var U=new self.XMLHttpRequest;return U.overrideMimeType("text/plain; charset=x-user-defined"),D({xhr:U},B)}}).call(this,m("buffer").Buffer)},{"./lib/is-binary":220,buffer:48,"parse-bmfont-ascii":102,"parse-bmfont-binary":103,"parse-bmfont-xml":104,xhr:187,xtend:189}],220:[function(m,x,E){(function(S){var h=m("buffer-equal"),I=new S([66,77,70,3]);x.exports=function(T){return typeof T=="string"?T.substring(0,3)==="BMF":T.length>4&&h(T.slice(0,4),I)}}).call(this,m("buffer").Buffer)},{buffer:48,"buffer-equal":49}],221:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var I=m("@jimp/utils"),T=h(m("./modules/resize")),A=h(m("./modules/resize2")),k=function(){return{constants:{RESIZE_NEAREST_NEIGHBOR:"nearestNeighbor",RESIZE_BILINEAR:"bilinearInterpolation",RESIZE_BICUBIC:"bicubicInterpolation",RESIZE_HERMITE:"hermiteInterpolation",RESIZE_BEZIER:"bezierInterpolation"},class:{resize:function(M,F,N,B){if(typeof M!="number"||typeof F!="number")return I.throwError.call(this,"w and h must be numbers",B);if(typeof N=="function"&&typeof B=="undefined"&&(B=N,N=null),M===this.constructor.AUTO&&F===this.constructor.AUTO)return I.throwError.call(this,"w and h cannot both be set to auto",B);if(M===this.constructor.AUTO&&(M=this.bitmap.width*(F/this.bitmap.height)),F===this.constructor.AUTO&&(F=this.bitmap.height*(M/this.bitmap.width)),M<0||F<0)return I.throwError.call(this,"w and h must be positive numbers",B);if(M=Math.round(M),F=Math.round(F),typeof A.default[N]=="function"){var U={data:S.alloc(M*F*4),width:M,height:F};A.default[N](this.bitmap,U),this.bitmap=U}else{var O=this,V=new T.default(this.bitmap.width,this.bitmap.height,M,F,!0,!0,function(Z){O.bitmap.data=S.from(Z),O.bitmap.width=M,O.bitmap.height=F});V.resize(this.bitmap.data)}return(0,I.isNodePattern)(B)&&B.call(this,null,this),this}}}};E.default=k,x.exports=E.default}).call(this,m("buffer").Buffer)},{"./modules/resize":222,"./modules/resize2":223,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,buffer:48}],222:[function(m,x,E){function S(h,I,T,A,k,P,D){this.widthOriginal=Math.abs(Math.floor(h)||0),this.heightOriginal=Math.abs(Math.floor(I)||0),this.targetWidth=Math.abs(Math.floor(T)||0),this.targetHeight=Math.abs(Math.floor(A)||0),this.colorChannels=k?4:3,this.interpolationPass=Boolean(P),this.resizeCallback=typeof D=="function"?D:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}S.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0)this.configurePasses();else throw new Error("Invalid settings specified for the resizer.")},S.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))},S.prototype._resizeWidthInterpolatedRGBChannels=function(h,I){var T=I?4:3,A=this.ratioWeightWidthPass,k=this.widthBuffer,P=0,D=0,M=0,F=0,N=0,B;for(B=0;P<1/3;B+=T,P+=A)for(D=B,M=0;D<this.widthPassResultSize;M+=this.originalWidthMultipliedByChannels,D+=this.targetWidthMultipliedByChannels)k[D]=h[M],k[D+1]=h[M+1],k[D+2]=h[M+2],I&&(k[D+3]=h[M+3]);P-=1/3;var U;for(U=this.widthOriginal-1;P<U;B+=T,P+=A)for(N=P%1,F=1-N,D=B,M=Math.floor(P)*T;D<this.widthPassResultSize;M+=this.originalWidthMultipliedByChannels,D+=this.targetWidthMultipliedByChannels)k[D+0]=h[M+0]*F+h[M+T+0]*N,k[D+1]=h[M+1]*F+h[M+T+1]*N,k[D+2]=h[M+2]*F+h[M+T+2]*N,I&&(k[D+3]=h[M+3]*F+h[M+T+3]*N);for(U=this.originalWidthMultipliedByChannels-T;B<this.targetWidthMultipliedByChannels;B+=T)for(D=B,M=U;D<this.widthPassResultSize;M+=this.originalWidthMultipliedByChannels,D+=this.targetWidthMultipliedByChannels)k[D]=h[M],k[D+1]=h[M+1],k[D+2]=h[M+2],I&&(k[D+3]=h[M+3]);return k},S.prototype._resizeWidthRGBChannels=function(h,I){var T=I?4:3,A=this.ratioWeightWidthPass,k=1/A,P=this.originalWidthMultipliedByChannels-T+1,D=this.targetWidthMultipliedByChannels-T+1,M=this.outputWidthWorkBench,F=this.widthBuffer,N=this.outputWidthWorkBenchOpaquePixelsCount,B=0,U=0,O=0,V=0,Z=0,W=0,Y=0,X=1,J=0,q=0,te=0,ne=0;do{for(Z=0;Z<this.originalHeightMultipliedByChannels;)M[Z++]=0,M[Z++]=0,M[Z++]=0,I&&(M[Z++]=0,N[Z/T-1]=0);B=A;do{for(U=1+O-V,X=Math.min(B,U),Z=0,W=O;Z<this.originalHeightMultipliedByChannels;W+=P)J=h[W],q=h[++W],te=h[++W],ne=I?h[++W]:255,M[Z++]+=(ne?J:0)*X,M[Z++]+=(ne?q:0)*X,M[Z++]+=(ne?te:0)*X,I&&(M[Z++]+=ne*X,N[Z/T-1]+=ne?X:0);if(B>=U)O+=T,V=O,B-=U;else{V+=B;break}}while(B>0&&O<this.originalWidthMultipliedByChannels);for(Z=0,W=Y;Z<this.originalHeightMultipliedByChannels;W+=D)B=I?N[Z/T]:1,X=I?B?1/B:0:k,F[W]=M[Z++]*X,F[++W]=M[Z++]*X,F[++W]=M[Z++]*X,I&&(F[++W]=M[Z++]*k);Y+=T}while(Y<this.targetWidthMultipliedByChannels);return F},S.prototype._resizeHeightRGBChannels=function(h,I){var T=this.ratioWeightHeightPass,A=1/T,k=this.outputHeightWorkBench,P=this.heightBuffer,D=this.outputHeightWorkBenchOpaquePixelsCount,M=0,F=0,N=0,B=0,U=0,O=0,V=0,Z=1,W=0,Y=0,X=0,J=0;do{for(U=0;U<this.targetWidthMultipliedByChannels;)k[U++]=0,k[U++]=0,k[U++]=0,I&&(k[U++]=0,D[U/4-1]=0);M=T;do{for(F=1+N-B,Z=Math.min(M,F),V=N,U=0;U<this.targetWidthMultipliedByChannels;)W=h[V++],Y=h[V++],X=h[V++],J=I?h[V++]:255,k[U++]+=(J?W:0)*Z,k[U++]+=(J?Y:0)*Z,k[U++]+=(J?X:0)*Z,I&&(k[U++]+=J*Z,D[U/4-1]+=J?Z:0);if(M>=F)N=V,B=N,M-=F;else{B+=M;break}}while(M>0&&N<this.widthPassResultSize);for(U=0;U<this.targetWidthMultipliedByChannels;)M=I?D[U/4]:1,Z=I?M?1/M:0:A,P[O++]=Math.round(k[U++]*Z),P[O++]=Math.round(k[U++]*Z),P[O++]=Math.round(k[U++]*Z),I&&(P[O++]=Math.round(k[U++]*A))}while(O<this.finalResultSize);return P},S.prototype.resizeWidthInterpolatedRGB=function(h){return this._resizeWidthInterpolatedRGBChannels(h,!1)},S.prototype.resizeWidthInterpolatedRGBA=function(h){return this._resizeWidthInterpolatedRGBChannels(h,!0)},S.prototype.resizeWidthRGB=function(h){return this._resizeWidthRGBChannels(h,!1)},S.prototype.resizeWidthRGBA=function(h){return this._resizeWidthRGBChannels(h,!0)},S.prototype.resizeHeightInterpolated=function(h){for(var I=this.ratioWeightHeightPass,T=this.heightBuffer,A=0,k=0,P=0,D=0,M=0,F=0,N=0,B;A<1/3;A+=I)for(P=0;P<this.targetWidthMultipliedByChannels;)T[k++]=Math.round(h[P++]);for(A-=1/3,B=this.heightOriginal-1;A<B;A+=I)for(N=A%1,F=1-N,D=Math.floor(A)*this.targetWidthMultipliedByChannels,M=D+this.targetWidthMultipliedByChannels,P=0;P<this.targetWidthMultipliedByChannels;++P)T[k++]=Math.round(h[D++]*F+h[M++]*N);for(;k<this.finalResultSize;)for(P=0,D=B*this.targetWidthMultipliedByChannels;P<this.targetWidthMultipliedByChannels;++P)T[k++]=Math.round(h[D++]);return T},S.prototype.resizeHeightRGB=function(h){return this._resizeHeightRGBChannels(h,!1)},S.prototype.resizeHeightRGBA=function(h){return this._resizeHeightRGBChannels(h,!0)},S.prototype.resize=function(h){this.resizeCallback(this.resizeHeight(this.resizeWidth(h)))},S.prototype.bypassResizer=function(h){return h},S.prototype.initializeFirstPassBuffers=function(h){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),h||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},S.prototype.initializeSecondPassBuffers=function(h){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),h||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},S.prototype.generateFloatBuffer=function(h){try{return new Float32Array(h)}catch{return[]}},S.prototype.generateFloat64Buffer=function(h){try{return new Float64Array(h)}catch{return[]}},S.prototype.generateUint8Buffer=function(h){try{return new Uint8Array(h)}catch{return[]}},x.exports=S},{}],223:[function(m,x,E){(function(S){x.exports={nearestNeighbor:function(I,T){for(var A=I.width,k=I.height,P=T.width,D=T.height,M=I.data,F=T.data,N=0;N<D;N++)for(var B=0;B<P;B++){var U=(N*P+B)*4,O=Math.floor(N*k/D),V=Math.floor(B*A/P),Z=(O*A+V)*4;F[U++]=M[Z++],F[U++]=M[Z++],F[U++]=M[Z++],F[U++]=M[Z++]}},bilinearInterpolation:function(I,T){for(var A=I.width,k=I.height,P=T.width,D=T.height,M=I.data,F=T.data,N=function(ne,de,oe,we,Ae){return de===we?oe:Math.round((ne-de)*Ae+(we-ne)*oe)},B=function(ne,de,oe,we,Ae,ye,me,xe){var Le=(me*A+we)*4+de,Ze=(me*A+Ae)*4+de,Xe=N(oe,we,M[Le],Ae,M[Ze]);if(xe===me)F[ne+de]=Xe;else{Le=(xe*A+we)*4+de,Ze=(xe*A+Ae)*4+de;var je=N(oe,we,M[Le],Ae,M[Ze]);F[ne+de]=N(ye,me,Xe,xe,je)}},U=0;U<D;U++)for(var O=0;O<P;O++){var V=(U*P+O)*4,Z=O*A/P,W=Math.floor(Z),Y=Math.min(Math.ceil(Z),A-1),X=U*k/D,J=Math.floor(X),q=Math.min(Math.ceil(X),k-1);B(V,0,Z,W,Y,X,J,q),B(V,1,Z,W,Y,X,J,q),B(V,2,Z,W,Y,X,J,q),B(V,3,Z,W,Y,X,J,q)}},_interpolate2D:function(I,T,A,k){for(var P=I.data,D=T.data,M=I.width,F=I.height,N=T.width,B=T.height,U=Math.max(1,Math.floor(M/N)),O=N*U,V=Math.max(1,Math.floor(F/B)),Z=B*V,W=S.alloc(O*F*4),Y=0;Y<F;Y++)for(var X=0;X<O;X++)for(var J=X*(M-1)/O,q=Math.floor(J),te=J-q,ne=(Y*M+q)*4,de=(Y*O+X)*4,oe=0;oe<4;oe++){var we=ne+oe,Ae=q>0?P[we-4]:2*P[we]-P[we+4],ye=P[we],me=P[we+4],xe=q<M-2?P[we+8]:2*P[we+4]-P[we];W[de+oe]=k(Ae,ye,me,xe,te)}for(var Le=S.alloc(O*Z*4),Ze=0;Ze<Z;Ze++)for(var Xe=0;Xe<O;Xe++)for(var je=Ze*(F-1)/Z,Ie=Math.floor(je),Pe=je-Ie,De=(Ie*O+Xe)*4,ze=(Ze*O+Xe)*4,it=0;it<4;it++){var tt=De+it,ot=Ie>0?W[tt-O*4]:2*W[tt]-W[tt+O*4],lt=W[tt],St=W[tt+O*4],et=Ie<F-2?W[tt+O*8]:2*W[tt+O*4]-W[tt];Le[ze+it]=k(ot,lt,St,et,Pe)}var Je=U*V;if(Je>1)for(var Be=0;Be<B;Be++)for(var Ge=0;Ge<N;Ge++){for(var He=0,ve=0,_e=0,pe=0,fe=0,ue=0;ue<V;ue++)for(var ce=Be*V+ue,Ee=0;Ee<U;Ee++){var Ye=Ge*U+Ee,ft=(ce*O+Ye)*4,_t=Le[ft+3];_t&&(He+=Le[ft],ve+=Le[ft+1],_e+=Le[ft+2],fe++),pe+=_t}var It=(Be*N+Ge)*4;D[It]=fe?Math.round(He/fe):0,D[It+1]=fe?Math.round(ve/fe):0,D[It+2]=fe?Math.round(_e/fe):0,D[It+3]=Math.round(pe/Je)}else T.data=Le},bicubicInterpolation:function(I,T,A){var k=function(D,M,F,N,B){var U=N-F-D+M,O=D-M-U,V=F-D,Z=M;return Math.max(0,Math.min(255,U*(B*B*B)+O*(B*B)+V*B+Z))};return this._interpolate2D(I,T,A,k)},hermiteInterpolation:function(I,T,A){var k=function(D,M,F,N,B){var U=M,O=.5*(F-D),V=D-2.5*M+2*F-.5*N,Z=.5*(N-D)+1.5*(M-F);return Math.max(0,Math.min(255,Math.round(((Z*B+V)*B+O)*B+U)))};return this._interpolate2D(I,T,A,k)},bezierInterpolation:function(I,T,A){var k=function(D,M,F,N,B){var U=M+(F-D)/4,O=F-(N-M)/4,V=1-B,Z=M*V*V*V,W=3*U*V*V*B,Y=3*O*V*B*B,X=F*B*B*B;return Math.max(0,Math.min(255,Math.round(Z+W+Y+X)))};return this._interpolate2D(I,T,A,k)}}}).call(this,m("buffer").Buffer)},{buffer:48}],224:[function(m,x,E){(function(S){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=m("@jimp/utils");function I(A,k){A%=360;var P=A*Math.PI/180,D=Math.cos(P),M=Math.sin(P),F=this.bitmap.width,N=this.bitmap.height;if(k===!0||typeof k=="string"){F=Math.ceil(Math.abs(this.bitmap.width*D)+Math.abs(this.bitmap.height*M))+1,N=Math.ceil(Math.abs(this.bitmap.width*M)+Math.abs(this.bitmap.height*D))+1,F%2!=0&&F++,N%2!=0&&N++;var B=this.cloneQuiet();this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(me,xe,Le){this.bitmap.data.writeUInt32BE(this._background,Le)});var U=Math.max(F,N,this.bitmap.width,this.bitmap.height);this.resize(U,U,k),this.blit(B,this.bitmap.width/2-B.bitmap.width/2,this.bitmap.height/2-B.bitmap.height/2)}var O=this.bitmap.width,V=this.bitmap.height,Z=S.alloc(this.bitmap.data.length);function W(me,xe){return function(Le,Ze){return{x:Le+me,y:Ze+xe}}}for(var Y=W(-(O/2),-(V/2)),X=W(O/2+.5,V/2+.5),J=1;J<=V;J++)for(var q=1;q<=O;q++){var te=Y(q,J),ne=X(D*te.x-M*te.y,D*te.y+M*te.x),de=O*(J-1)+q-1<<2;if(ne.x>=0&&ne.x<O&&ne.y>=0&&ne.y<V){var oe=(O*(ne.y|0)+ne.x|0)<<2,we=this.bitmap.data.readUInt32BE(oe);Z.writeUInt32BE(we,de)}else Z.writeUInt32BE(this._background,de)}if(this.bitmap.data=Z,k===!0||typeof k=="string"){var Ae=O/2-F/2,ye=V/2-N/2;this.crop(Ae,ye,F,N)}}var T=function(){return{rotate:function(P,D,M){return(typeof D=="undefined"||D===null)&&(D=!0),typeof D=="function"&&typeof M=="undefined"&&(M=D,D=!0),typeof P!="number"?h.throwError.call(this,"deg must be a number",M):typeof D!="boolean"&&typeof D!="string"?h.throwError.call(this,"mode must be a boolean or a string",M):(I.call(this,P,D,M),(0,h.isNodePattern)(M)&&M.call(this,null,this),this)}}};E.default=T,x.exports=E.default}).call(this,m("buffer").Buffer)},{"@jimp/utils":235,buffer:48}],225:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{scale:function(A,k,P){if(typeof A!="number")return S.throwError.call(this,"f must be a number",P);if(A<0)return S.throwError.call(this,"f must be a positive number",P);typeof k=="function"&&typeof P=="undefined"&&(P=k,k=null);var D=this.bitmap.width*A,M=this.bitmap.height*A;return this.resize(D,M,k),(0,S.isNodePattern)(P)&&P.call(this,null,this),this},scaleToFit:function(A,k,P,D){if(typeof A!="number"||typeof k!="number")return S.throwError.call(this,"w and h must be numbers",D);typeof P=="function"&&typeof D=="undefined"&&(D=P,P=null);var M=A/k>this.bitmap.width/this.bitmap.height?k/this.bitmap.height:A/this.bitmap.width;return this.scale(M,P),(0,S.isNodePattern)(D)&&D.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],226:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{shadow:function(){var A=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=arguments.length>1?arguments[1]:void 0;typeof k=="function"&&(P=k,k={});var D=k,M=D.opacity,F=M===void 0?.7:M,N=D.size,B=N===void 0?1.1:N,U=D.x,O=U===void 0?-25:U,V=D.y,Z=V===void 0?25:V,W=D.blur,Y=W===void 0?5:W,X=this.clone(),J=this.clone();return J.scan(0,0,J.bitmap.width,J.bitmap.height,function(q,te,ne){J.bitmap.data[ne]=0,J.bitmap.data[ne+1]=0,J.bitmap.data[ne+2]=0,J.bitmap.data[ne+3]=J.constructor.limit255(J.bitmap.data[ne+3]*F),A.bitmap.data[ne]=0,A.bitmap.data[ne+1]=0,A.bitmap.data[ne+2]=0,A.bitmap.data[ne+3]=0}),J.resize(J.bitmap.width*B,J.bitmap.height*B).blur(Y),this.composite(J,O,Z),this.composite(X,0,0),(0,S.isNodePattern)(P)&&P.call(this,null,this),this}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],227:[function(m,x,E){Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var S=m("@jimp/utils"),h=function(){return{threshold:function(A,k){var P=this,D=A.max,M=A.replace,F=M===void 0?255:M,N=A.autoGreyscale,B=N===void 0?!0:N;return typeof D!="number"?S.throwError.call(this,"max must be a number",k):typeof F!="number"?S.throwError.call(this,"replace must be a number",k):typeof B!="boolean"?S.throwError.call(this,"autoGreyscale must be a boolean",k):(D=this.constructor.limit255(D),F=this.constructor.limit255(F),B&&this.greyscale(),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,O,V){var Z=P.bitmap.data[V]<D?P.bitmap.data[V]:F;P.bitmap.data[V]=Z,P.bitmap.data[V+1]=Z,P.bitmap.data[V+2]=Z}),(0,S.isNodePattern)(k)&&k.call(this,null,this),this)}}};E.default=h,x.exports=E.default},{"@jimp/utils":235}],228:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/toConsumableArray")),I=m("timm"),T=S(m("@jimp/plugin-blit")),A=S(m("@jimp/plugin-blur")),k=S(m("@jimp/plugin-circle")),P=S(m("@jimp/plugin-color")),D=S(m("@jimp/plugin-contain")),M=S(m("@jimp/plugin-cover")),F=S(m("@jimp/plugin-crop")),N=S(m("@jimp/plugin-displace")),B=S(m("@jimp/plugin-dither")),U=S(m("@jimp/plugin-fisheye")),O=S(m("@jimp/plugin-flip")),V=S(m("@jimp/plugin-gaussian")),Z=S(m("@jimp/plugin-invert")),W=S(m("@jimp/plugin-mask")),Y=S(m("@jimp/plugin-normalize")),X=S(m("@jimp/plugin-print")),J=S(m("@jimp/plugin-resize")),q=S(m("@jimp/plugin-rotate")),te=S(m("@jimp/plugin-scale")),ne=S(m("@jimp/plugin-shadow")),de=S(m("@jimp/plugin-threshold")),oe=[T.default,A.default,k.default,P.default,D.default,M.default,F.default,N.default,B.default,U.default,O.default,V.default,Z.default,W.default,Y.default,X.default,J.default,q.default,te.default,ne.default,de.default],we=function(ye){var me=oe.map(function(xe){var Le=xe(ye)||{};return!Le.class&&!Le.constants&&(Le={class:Le}),Le});return I.mergeDeep.apply(void 0,(0,h.default)(me))};E.default=we,x.exports=E.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/helpers/toConsumableArray":20,"@jimp/plugin-blit":201,"@jimp/plugin-blur":203,"@jimp/plugin-circle":204,"@jimp/plugin-color":205,"@jimp/plugin-contain":206,"@jimp/plugin-cover":207,"@jimp/plugin-crop":208,"@jimp/plugin-displace":209,"@jimp/plugin-dither":210,"@jimp/plugin-fisheye":211,"@jimp/plugin-flip":212,"@jimp/plugin-gaussian":213,"@jimp/plugin-invert":214,"@jimp/plugin-mask":215,"@jimp/plugin-normalize":216,"@jimp/plugin-print":217,"@jimp/plugin-resize":221,"@jimp/plugin-rotate":224,"@jimp/plugin-scale":225,"@jimp/plugin-shadow":226,"@jimp/plugin-threshold":227,timm:177}],229:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/defineProperty")),I=S(m("bmp-js")),T=m("@jimp/utils"),A="image/bmp",k="image/x-ms-bmp";function P(B){return(0,T.scan)(B,0,0,B.bitmap.width,B.bitmap.height,function(U,O,V){var Z=this.bitmap.data[V+0],W=this.bitmap.data[V+1],Y=this.bitmap.data[V+2],X=this.bitmap.data[V+3];this.bitmap.data[V+0]=X,this.bitmap.data[V+1]=Y,this.bitmap.data[V+2]=W,this.bitmap.data[V+3]=Z}).bitmap}function D(B){return(0,T.scan)({bitmap:B},0,0,B.width,B.height,function(U,O,V){var Z=this.bitmap.data[V+0],W=this.bitmap.data[V+1],Y=this.bitmap.data[V+2],X=this.bitmap.data[V+3];this.bitmap.data[V+0]=X,this.bitmap.data[V+1]=Y,this.bitmap.data[V+2]=W,this.bitmap.data[V+3]=B.is_with_alpha?Z:255}).bitmap}var M=function(U){return D(I.default.decode(U))},F=function(U){return I.default.encode(P(U)).data},N=function(){var U,O;return{mime:(0,h.default)({},A,["bmp"]),constants:{MIME_BMP:A,MIME_X_MS_BMP:k},decoders:(U={},(0,h.default)(U,A,M),(0,h.default)(U,k,M),U),encoders:(O={},(0,h.default)(O,A,F),(0,h.default)(O,k,F),O)}};E.default=N,x.exports=E.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,"bmp-js":30}],230:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var I=h(m("@babel/runtime/helpers/defineProperty")),T=h(m("omggif")),A=m("gifwrap"),k="image/gif",P=function(){return{mime:(0,I.default)({},k,["gif"]),constants:{MIME_GIF:k},decoders:(0,I.default)({},k,function(M){var F=new T.default.GifReader(M),N=S.alloc(F.width*F.height*4);return F.decodeAndBlitFrameRGBA(0,N),{data:N,width:F.width,height:F.height}}),encoders:(0,I.default)({},k,function(M){var F=new A.BitmapImage(M.bitmap);A.GifUtil.quantizeDekker(F,256);var N=new A.GifFrame(F),B=new A.GifCodec;return B.encodeGif([N],{}).then(function(U){return U.buffer})})}};E.default=P,x.exports=E.default}).call(this,m("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,buffer:48,gifwrap:70,omggif:85}],231:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/defineProperty")),I=S(m("jpeg-js")),T=m("@jimp/utils"),A="image/jpeg",k=function(){return{mime:(0,h.default)({},A,["jpeg","jpg","jpe"]),constants:{MIME_JPEG:A},decoders:(0,h.default)({},A,I.default.decode),encoders:(0,h.default)({},A,function(D){return I.default.encode(D.bitmap,D._quality).data}),class:{_quality:100,quality:function(M,F){return typeof M!="number"?T.throwError.call(this,"n must be a number",F):M<0||M>100?T.throwError.call(this,"n must be a number 0 - 100",F):(this._quality=Math.round(M),(0,T.isNodePattern)(F)&&F.call(this,null,this),this)}}}};E.default=k,x.exports=E.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,"jpeg-js":80}],232:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=S(m("@babel/runtime/helpers/defineProperty")),I=m("pngjs"),T=m("@jimp/utils"),A="image/png",k=-1,P=0,D=1,M=2,F=3,N=4,B=function(){return{mime:(0,h.default)({},A,["png"]),constants:{MIME_PNG:A,PNG_FILTER_AUTO:k,PNG_FILTER_NONE:P,PNG_FILTER_SUB:D,PNG_FILTER_UP:M,PNG_FILTER_AVERAGE:F,PNG_FILTER_PATH:N},hasAlpha:(0,h.default)({},A,!0),decoders:(0,h.default)({},A,I.PNG.sync.read),encoders:(0,h.default)({},A,function(O){var V=new I.PNG({width:O.bitmap.width,height:O.bitmap.height});return V.data=O.bitmap.data,I.PNG.sync.write(V,{width:O.bitmap.width,height:O.bitmap.height,deflateLevel:O._deflateLevel,deflateStrategy:O._deflateStrategy,filterType:O._filterType,colorType:typeof O._colorType=="number"?O._colorType:O._rgba?6:2,inputHasAlpha:O._rgba})}),class:{_deflateLevel:9,_deflateStrategy:3,_filterType:k,_colorType:null,deflateLevel:function(V,Z){return typeof V!="number"?T.throwError.call(this,"l must be a number",Z):V<0||V>9?T.throwError.call(this,"l must be a number 0 - 9",Z):(this._deflateLevel=Math.round(V),(0,T.isNodePattern)(Z)&&Z.call(this,null,this),this)},deflateStrategy:function(V,Z){return typeof V!="number"?T.throwError.call(this,"s must be a number",Z):V<0||V>3?T.throwError.call(this,"s must be a number 0 - 3",Z):(this._deflateStrategy=Math.round(V),(0,T.isNodePattern)(Z)&&Z.call(this,null,this),this)},filterType:function(V,Z){return typeof V!="number"?T.throwError.call(this,"n must be a number",Z):V<-1||V>4?T.throwError.call(this,"n must be -1 (auto) or a number 0 - 4",Z):(this._filterType=Math.round(V),(0,T.isNodePattern)(Z)&&Z.call(this,null,this),this)},colorType:function(V,Z){return typeof V!="number"?T.throwError.call(this,"s must be a number",Z):V!==0&&V!==2&&V!==4&&V!==6?T.throwError.call(this,"s must be a number 0, 2, 4, 6.",Z):(this._colorType=Math.round(V),(0,T.isNodePattern)(Z)&&Z.call(this,null,this),this)}}}};E.default=B,x.exports=E.default},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/utils":235,pngjs:129}],233:[function(m,x,E){(function(S){var h=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var I=h(m("@babel/runtime/helpers/defineProperty")),T=h(m("utif")),A="image/tiff",k=function(){return{mime:(0,I.default)({},A,["tiff","tif"]),constants:{MIME_TIFF:A},decoders:(0,I.default)({},A,function(D){var M=T.default.decode(D),F=M[0];T.default.decodeImages(D,M);var N=T.default.toRGBA8(F);return{data:S.from(N),width:F.t256[0],height:F.t257[0]}}),encoders:(0,I.default)({},A,function(D){var M=T.default.encodeImage(D.bitmap.data,D.bitmap.width,D.bitmap.height);return S.from(M)})}};E.default=k,x.exports=E.default}).call(this,m("buffer").Buffer)},{"@babel/runtime/helpers/defineProperty":7,"@babel/runtime/helpers/interopRequireDefault":11,buffer:48,utif:182}],234:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var h=m("timm"),I=S(m("@jimp/jpeg")),T=S(m("@jimp/png")),A=S(m("@jimp/bmp")),k=S(m("@jimp/tiff")),P=S(m("@jimp/gif")),D=function(){return(0,h.mergeDeep)((0,I.default)(),(0,T.default)(),(0,A.default)(),(0,k.default)(),(0,P.default)())};E.default=D,x.exports=E.default},{"@babel/runtime/helpers/interopRequireDefault":11,"@jimp/bmp":229,"@jimp/gif":230,"@jimp/jpeg":231,"@jimp/png":232,"@jimp/tiff":233,timm:177}],235:[function(m,x,E){var S=m("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(E,"__esModule",{value:!0}),E.isNodePattern=T,E.throwError=A,E.scan=k,E.scanIterator=P;var h=S(m("@babel/runtime/regenerator")),I=h.default.mark(P);function T(D){if(typeof D=="undefined")return!1;if(typeof D!="function")throw new TypeError("Callback must be a function");return!0}function A(D,M){if(typeof D=="string"&&(D=new Error(D)),typeof M=="function")return M.call(this,D);throw D}function k(D,M,F,N,B,U){M=Math.round(M),F=Math.round(F),N=Math.round(N),B=Math.round(B);for(var O=F;O<F+B;O++)for(var V=M;V<M+N;V++){var Z=D.bitmap.width*O+V<<2;U.call(D,V,O,Z)}return D}function P(D,M,F,N,B){var U,O,V;return h.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:M=Math.round(M),F=Math.round(F),N=Math.round(N),B=Math.round(B),U=F;case 5:if(!(U<F+B)){W.next=17;break}O=M;case 7:if(!(O<M+N)){W.next=14;break}return V=D.bitmap.width*U+O<<2,W.next=11,{x:O,y:U,idx:V,image:D};case 11:O++,W.next=7;break;case 14:U++,W.next=5;break;case 17:case"end":return W.stop()}},I)}},{"@babel/runtime/helpers/interopRequireDefault":11,"@babel/runtime/regenerator":22}]},{},[200])(200)})})(jimp);let vips;const _sfc_main$3={name:"SideNav",setup(){return{alert:ref(!1),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"4033x4033",value:4033},{label:"2017x2017",value:2017},{label:"1009x1009",value:1009},{label:"512x512-Downloaded-Size",value:512},{label:"505x505",value:505}],url:ref("thirtytwo-9-82-180.png"),tile_info:ref(""),stats:ref(""),dirHandle:ref(""),preview_imag:ref(""),rgb_image:ref(""),maxElevation:ref(""),minElevation:ref(""),minmax:ref(""),elevation_range:ref(""),tileWidthInMeters:ref(""),metersPerPixel:ref(""),zscale:ref(""),map:null}},async mounted(){vips=await Vips(),emitter.on("updatePreviewImage",p=>{this.updatePreviewImage(p)})},methods:{updateStats(){this.maxElevation!==""?(this.minElevation=this.minElevation.toFixed(3),this.maxElevation=this.maxElevation.toFixed(3),this.minmax=this.minElevation+" / "+this.maxElevation,this.elevation_range=(this.maxElevation-this.minElevation).toFixed(3),this.tileWidthInMeters=this.tileWidthInMeters.toFixed(3),this.metersPerPixel=this.metersPerPixel.toFixed(3)):this.minmax=""},getUnrealZScale(p){return p*100*.001953125},async updatePreviewImage(p){this.tile_info=p.tile_info,this.map=p.map,this.stats=p.stats,this.preview_image=p.preview_image,this.dirHandle=p.dirHandle;let l=await this.preview_image.toBlob();const g=URL.createObjectURL(l);this.url=g,this.maxElevation=this.stats.maxElevation,this.minElevation=this.stats.minElevation,this.tileWidthInMeters=this.tile_info.tileWidthInMeters,this.metersPerPixel=this.tile_info.metersPerPixel,this.zscale=this.getUnrealZScale(this.maxElevation).toFixed(3),this.updateStats()},async createSixteenHeightMap(){if(this.tile_info){let p=await idbKeyval.get("dirHandle");if(fileUtils.verifyPermission(p,!0)===!1){console.error(`User did not grant permission to '${p.name}'`);return}if(fileUtils.fileExists(p,this.tile_info.thirtytwoFile)){let g=await idbKeyval.get("rgb_image_buffer"),m=await fileUtils.loadImageFromArray(g),E=(await fileUtils.createHeightMapImage(m,16,"GREY")).image;this.tile_info.resolution=this.unrealLandscape.value;let S,h=await E.toBuffer();if(this.unrealLandscape.value!==512){let A=vips.Image.newFromBuffer(h);A=A.resize(this.unrealLandscape.value/A.width,{kernel:"lanczos3"});const k=A.writeToBuffer(".PNG");S=new Uint8Array(k)}else S=h;await fileUtils.writeFileToDisk(p,this.tile_info.sixteenFile.name+"-"+this.tile_info.resolution+".png",S);let I=JSON.stringify(mapUtils.getFeaturesFromBB(this.map,this.tile_info.bb)),T=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(p,"geojson-"+this.tile_info.mapbox_tile_name+"-"+this.tile_info.resolution+".json",I),await fileUtils.writeFileToDisk(p,"tile_info-"+this.tile_info.mapbox_tile_name+"-"+this.tile_info.resolution+".json",T)}else this.alert=!0}else this.alert=!0}}},_hoisted_1$3=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$3={class:"row justify-start q-pt-none"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_7$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_8$1={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_9={class:"row justify-center q-pt-lg"},_hoisted_10=createBaseVNode("div",{class:"text-h6"},"Alert",-1),_hoisted_11=createTextVNode(" Please select a tile to download first. ");function _sfc_render$2(p,l,g,m,x,E){const S=resolveComponent("q-img"),h=resolveComponent("q-field"),I=resolveComponent("q-select"),T=resolveComponent("q-btn"),A=resolveComponent("q-card-section"),k=resolveComponent("q-card-actions"),P=resolveComponent("q-card"),D=resolveComponent("q-dialog"),M=resolveDirective("close-popup");return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$3,createVNode(S,{src:m.url,height:"240px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$2,[createVNode(h,{dense:"",class:"text-weight-bolder q-pt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(m.minmax),1)]),_:1}),createVNode(h,{dense:"",label:"Elevation Range","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$1,toDisplayString(m.elevation_range),1)]),_:1}),createVNode(h,{dense:"",label:"Tile width in meters","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_6$1,toDisplayString(m.tileWidthInMeters),1)]),_:1}),createVNode(h,{dense:"",label:"Pixel width in meters","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_7$1,toDisplayString(m.metersPerPixel),1)]),_:1}),createVNode(h,{dense:"",label:"Unreal Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_8$1,toDisplayString(m.zscale),1)]),_:1}),createVNode(I,{dense:"",class:"q-pt-md",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:m.unrealLandscape,"onUpdate:modelValue":l[0]||(l[0]=F=>m.unrealLandscape=F),options:m.landscapeSize},null,8,["modelValue","options"])])]),createBaseVNode("div",_hoisted_9,[createVNode(T,{onClick:E.createSixteenHeightMap,dense:"",color:"primary","no-caps":"",label:"Download 16bit HeightMap"},null,8,["onClick"])]),createVNode(D,{modelValue:m.alert,"onUpdate:modelValue":l[1]||(l[1]=F=>m.alert=F)},{default:withCtx(()=>[createVNode(P,null,{default:withCtx(()=>[createVNode(A,null,{default:withCtx(()=>[_hoisted_10]),_:1}),createVNode(A,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_11]),_:1}),createVNode(k,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(T,{flat:"",label:"OK",color:"primary"},null,512),[[M]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var SideNav=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]);const _sfc_main$2={props:{},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$2=createBaseVNode("div",null,[createBaseVNode("div",{class:"text-weight-bold"},"Help Section")],-1),_hoisted_2$2=createBaseVNode("div",{class:""},"TODO:",-1);function _sfc_render$1(p,l,g,m,x,E){const S=resolveComponent("q-space"),h=resolveComponent("q-btn"),I=resolveComponent("q-card-section"),T=resolveComponent("q-separator"),A=resolveComponent("q-card-actions"),k=resolveComponent("q-card"),P=resolveComponent("q-dialog"),D=resolveDirective("close-popup");return openBlock(),createBlock(P,{class:"dialog-plugin",ref:"dialog",onHide:E.onDialogHide},{default:withCtx(()=>[createVNode(k,{style:{width:"600px",height:"600px"}},{default:withCtx(()=>[createVNode(I,{class:"row items-center no-wrap",style:{height:"50px"}},{default:withCtx(()=>[_hoisted_1$2,createVNode(S),withDirectives(createVNode(h,{flat:"",round:"",icon:"close"},null,512),[[D]])]),_:1}),createVNode(T),_hoisted_2$2,createVNode(A,{class:"absolute-bottom",align:"right"},{default:withCtx(()=>[createVNode(h,{color:"primary",label:"OK",onClick:E.onOKClick},null,8,["onClick"]),createVNode(h,{color:"primary",label:"Cancel",onClick:E.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var Help=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);try{self["workbox:window:6.4.1"]&&_()}catch(p){}function n(p,l){return new Promise(function(g){var m=new MessageChannel;m.port1.onmessage=function(x){g(x.data)},p.postMessage(l,[m.port2])})}function t(p,l){for(var g=0;g<l.length;g++){var m=l[g];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}function r(p,l){(l==null||l>p.length)&&(l=p.length);for(var g=0,m=new Array(l);g<l;g++)m[g]=p[g];return m}function e(p,l){var g;if(typeof Symbol=="undefined"||p[Symbol.iterator]==null){if(Array.isArray(p)||(g=function(x,E){if(x){if(typeof x=="string")return r(x,E);var S=Object.prototype.toString.call(x).slice(8,-1);return S==="Object"&&x.constructor&&(S=x.constructor.name),S==="Map"||S==="Set"?Array.from(x):S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?r(x,E):void 0}}(p))||l&&p&&typeof p.length=="number"){g&&(p=g);var m=0;return function(){return m>=p.length?{done:!0}:{done:!1,value:p[m++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(g=p[Symbol.iterator]()).next.bind(g)}try{self["workbox:core:6.4.1"]&&_()}catch(p){}var i=function(){var p=this;this.promise=new Promise(function(l,g){p.resolve=l,p.reject=g})};function o(p,l){var g=location.href;return new URL(p,g).href===new URL(l,g).href}var u=function(p,l){this.type=p,Object.assign(this,l)};function a(p,l,g){return g?l?l(p):p:(p&&p.then||(p=Promise.resolve(p)),l?p.then(l):p)}function c(){}var f={type:"SKIP_WAITING"};function s(p,l){if(!l)return p&&p.then?p.then(c):Promise.resolve()}var v=function(p){var l,g;function m(h,I){var T,A;return I===void 0&&(I={}),(T=p.call(this)||this).nn={},T.tn=0,T.rn=new i,T.en=new i,T.on=new i,T.un=0,T.an=new Set,T.cn=function(){var k=T.fn,P=k.installing;T.tn>0||!o(P.scriptURL,T.sn.toString())||performance.now()>T.un+6e4?(T.vn=P,k.removeEventListener("updatefound",T.cn)):(T.hn=P,T.an.add(P),T.rn.resolve(P)),++T.tn,P.addEventListener("statechange",T.ln)},T.ln=function(k){var P=T.fn,D=k.target,M=D.state,F=D===T.vn,N={sw:D,isExternal:F,originalEvent:k};!F&&T.mn&&(N.isUpdate=!0),T.dispatchEvent(new u(M,N)),M==="installed"?T.wn=self.setTimeout(function(){M==="installed"&&P.waiting===D&&T.dispatchEvent(new u("waiting",N))},200):M==="activating"&&(clearTimeout(T.wn),F||T.en.resolve(D))},T.dn=function(k){var P=T.hn,D=P!==navigator.serviceWorker.controller;T.dispatchEvent(new u("controlling",{isExternal:D,originalEvent:k,sw:P,isUpdate:T.mn})),D||T.on.resolve(P)},T.gn=(A=function(k){var P=k.data,D=k.ports,M=k.source;return a(T.getSW(),function(){T.an.has(M)&&T.dispatchEvent(new u("message",{data:P,originalEvent:k,ports:D,sw:M}))})},function(){for(var k=[],P=0;P<arguments.length;P++)k[P]=arguments[P];try{return Promise.resolve(A.apply(this,k))}catch(D){return Promise.reject(D)}}),T.sn=h,T.nn=I,navigator.serviceWorker.addEventListener("message",T.gn),T}g=p,(l=m).prototype=Object.create(g.prototype),l.prototype.constructor=l,l.__proto__=g;var x,E,S=m.prototype;return S.register=function(h){var I=(h===void 0?{}:h).immediate,T=I!==void 0&&I;try{var A=this;return function(k,P){var D=k();return D&&D.then?D.then(P):P(D)}(function(){if(!T&&document.readyState!=="complete")return s(new Promise(function(k){return window.addEventListener("load",k)}))},function(){return A.mn=Boolean(navigator.serviceWorker.controller),A.yn=A.pn(),a(A.bn(),function(k){A.fn=k,A.yn&&(A.hn=A.yn,A.en.resolve(A.yn),A.on.resolve(A.yn),A.yn.addEventListener("statechange",A.ln,{once:!0}));var P=A.fn.waiting;return P&&o(P.scriptURL,A.sn.toString())&&(A.hn=P,Promise.resolve().then(function(){A.dispatchEvent(new u("waiting",{sw:P,wasWaitingBeforeRegister:!0}))}).then(function(){})),A.hn&&(A.rn.resolve(A.hn),A.an.add(A.hn)),A.fn.addEventListener("updatefound",A.cn),navigator.serviceWorker.addEventListener("controllerchange",A.dn),A.fn})})}catch(k){return Promise.reject(k)}},S.update=function(){try{return this.fn?s(this.fn.update()):void 0}catch(h){return Promise.reject(h)}},S.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},S.messageSW=function(h){try{return a(this.getSW(),function(I){return n(I,h)})}catch(I){return Promise.reject(I)}},S.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,f)},S.pn=function(){var h=navigator.serviceWorker.controller;return h&&o(h.scriptURL,this.sn.toString())?h:void 0},S.bn=function(){try{var h=this;return function(I,T){try{var A=I()}catch(k){return T(k)}return A&&A.then?A.then(void 0,T):A}(function(){return a(navigator.serviceWorker.register(h.sn,h.nn),function(I){return h.un=performance.now(),I})},function(I){throw I})}catch(I){return Promise.reject(I)}},x=m,(E=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(x.prototype,E),m}(function(){function p(){this.Pn=new Map}var l=p.prototype;return l.addEventListener=function(g,m){this.Sn(g).add(m)},l.removeEventListener=function(g,m){this.Sn(g).delete(m)},l.dispatchEvent=function(g){g.target=this;for(var m,x=e(this.Sn(g.type));!(m=x()).done;)(0,m.value)(g)},l.Sn=function(g){return this.Pn.has(g)||this.Pn.set(g,new Set),this.Pn.get(g)},p}());function registerSW(p={}){const{immediate:l=!1,onNeedRefresh:g,onOfflineReady:m,onRegistered:x,onRegisterError:E}=p;let S;const h=async(I=!0)=>{};return"serviceWorker"in navigator&&(S=new v("/sw.js",{scope:"/"}),S.addEventListener("activated",I=>{I.isUpdate?window.location.reload():m==null||m()}),S.register({immediate:l}).then(I=>{x==null||x(I)}).catch(I=>{E==null||E(I)})),h}function useRegisterSW(p={}){const{immediate:l=!0,onNeedRefresh:g,onOfflineReady:m,onRegistered:x,onRegisterError:E}=p,S=ref(!1),h=ref(!1);return{updateServiceWorker:registerSW({immediate:l,onNeedRefresh(){S.value=!0,g==null||g()},onOfflineReady(){h.value=!0,m==null||m()},onRegistered:x,onRegisterError:E}),offlineReady:h,needRefresh:S}}var ReloadPrompt_vue_vue_type_style_index_0_lang="";const _hoisted_1$1={key:0,class:"pwa-toast",role:"alert"},_hoisted_2$1={class:"message"},_hoisted_3$1={key:0},_hoisted_4$1={key:1},_sfc_main$1=defineComponent({setup(p){const{offlineReady:l,needRefresh:g,updateServiceWorker:m}=useRegisterSW({onRegistered(E){console.log(`SW Registered: ${E}`)}}),x=async()=>{l.value=!1,g.value=!1};return(E,S)=>unref(l)||unref(g)?(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[unref(l)?(openBlock(),createElementBlock("span",_hoisted_3$1," App ready to work offline ")):(openBlock(),createElementBlock("span",_hoisted_4$1," New content available, click on reload button to update. "))]),unref(g)?(openBlock(),createElementBlock("button",{key:0,onClick:S[0]||(S[0]=h=>unref(m)())}," Reload ")):createCommentVNode("",!0),createBaseVNode("button",{onClick:x}," Close ")])):createCommentVNode("",!0)}}),_sfc_main={setup(){const p=useQuasar();return{showDialog(){p.dialog({component:Help,componentProps:{text:"something"}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),dirHandle:ref(""),dirName:ref(""),style_url:ref(""),access_token:ref(""),showPwaBtn:!0,isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){await idbKeyval.get("pwa-installed")&&(this.showPwaBtn=!1),idbKeyval.set("mapbox_api_url","https://api.mapbox.com/v4"),idbKeyval.set("mapbox_raster_png_dem","mapbox://mapbox.terrain-rgb"),idbKeyval.set("terrain_threed_dem","mapbox://mapbox.mapbox-terrain-dem-v1"),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap(),window.addEventListener("appinstalled",this.pwaInstalled)},methods:{pwaInstalled(){idbKeyval.set("pwa-installed",!0),this.showPwaBtn=!1},async installPWA(){console.log(window.installEvent),window.installEvent.prompt(),window.installEvent=null},resizeMap(){this.$refs.mapBoxViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.$refs.mapBoxViewer.loadMapboxMap()})},isRequiredSettings(){return this.access_token&&this.style_url&&this.dirName?!0:(this.redirectToSettings(),!1)},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let p;try{p=await fileUtils.getDirHandle()}catch(l){if(l.name==="AbortError")return;console.error("An error occured trying to open the file.",l)}!p||(idbKeyval.set("dirHandle",p),this.dirName=p.name)},saveUserSettings(){idbKeyval.set("access_token",this.access_token),idbKeyval.set("style_url",this.style_url),idbKeyval.set("create_folder",this.createFolder),this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken||"",this.style_url=await idbKeyval.get("style_url")||"",this.style_url===""&&(this.style_url="mapbox://styles/mapbox/streets-v11");let p=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.dirHandle=p,this.dirName=p.name}},components:{MapboxMapViewer,SideNav,Help,ReloadPrompt:_sfc_main$1}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2=createTextVNode(" See: "),_hoisted_3=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_4=createTextVNode(" See: "),_hoisted_5=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_6={class:"q-pa-none row items-start"},_hoisted_7={class:"col q-pa-none"},_hoisted_8=createBaseVNode("br",null,null,-1);function _sfc_render(p,l,g,m,x,E){const S=resolveComponent("q-header"),h=resolveComponent("ReloadPrompt"),I=resolveComponent("side-nav"),T=resolveComponent("q-card"),A=resolveComponent("q-drawer"),k=resolveComponent("q-btn"),P=resolveComponent("q-tab"),D=resolveComponent("q-tabs"),M=resolveComponent("q-separator"),F=resolveComponent("mapbox-map-viewer"),N=resolveComponent("q-tab-panel"),B=resolveComponent("q-icon"),U=resolveComponent("q-input"),O=resolveComponent("q-tab-panels"),V=resolveComponent("q-page"),Z=resolveComponent("q-page-container"),W=resolveComponent("q-layout");return openBlock(),createBlock(W,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(S,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(h),createVNode(A,{dense:"","show-if-above":"",modelValue:m.drawerLeft,"onUpdate:modelValue":l[0]||(l[0]=Y=>m.drawerLeft=Y),side:"left",onHide:E.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(T,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(I)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(Z,null,{default:withCtx(()=>[createVNode(V,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(T,{class:"col"},{default:withCtx(()=>[createVNode(D,{dense:"",modelValue:m.selectedTab,"onUpdate:modelValue":l[3]||(l[3]=Y=>m.selectedTab=Y),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(k,{dense:"",flat:"",onClick:E.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(P,{dense:"",name:"map",label:"Map"}),createVNode(P,{dense:"",name:"settings",label:"Settings"}),withDirectives(createVNode(k,{style:{color:"white"},label:"Install as App",class:"q-mr-lg bg-positive",onClick:l[1]||(l[1]=Y=>E.installPWA())},null,512),[[vShow,m.showPwaBtn]]),createVNode(k,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:m.showDialog},null,8,["onClick"]),createVNode(k,{dense:"",flat:"",round:"",onClick:l[2]||(l[2]=Y=>p.$q.dark.toggle()),icon:p.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(M),createVNode(O,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:m.selectedTab,"onUpdate:modelValue":l[10]||(l[10]=Y=>m.selectedTab=Y),animated:""},{default:withCtx(()=>[createVNode(N,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(F,{class:"col",ref:"mapBoxViewer"},null,512)]),_:1}),createVNode(N,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[_hoisted_2,_hoisted_3,createVNode(U,{dense:"",modelValue:m.access_token,"onUpdate:modelValue":l[5]||(l[5]=Y=>m.access_token=Y),label:"Mapbox Access Token *",filled:"",type:m.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[Y=>Y&&Y.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(B,{dense:"",name:m.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[4]||(l[4]=Y=>m.isPwd=!m.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),_hoisted_4,_hoisted_5,createVNode(U,{dense:"",class:"q-pb-lg",modelValue:m.style_url,"onUpdate:modelValue":l[6]||(l[6]=Y=>m.style_url=Y),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[Y=>Y&&Y.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[createVNode(U,{dense:"",class:"q-pb-none",modelValue:m.dirName,"onUpdate:modelValue":l[7]||(l[7]=Y=>m.dirName=Y),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[Y=>Y&&Y.length>0||"Please type something"],type:m.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(k,{class:"q-pb-none",dense:"",onClick:l[8]||(l[8]=Y=>E.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_8,createVNode(k,{class:"q-pt-none",dense:"",onClick:l[9]||(l[9]=Y=>E.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}var MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
